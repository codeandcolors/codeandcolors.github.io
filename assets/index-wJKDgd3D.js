var fP=Object.defineProperty;var pP=(n,e,t)=>e in n?fP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var tt=(n,e,t)=>(pP(n,typeof e!="symbol"?e+"":e,t),t);function YM(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const o in i)if(o!=="default"&&!(o in n)){const h=Object.getOwnPropertyDescriptor(i,o);h&&Object.defineProperty(n,o,h.get?h:{enumerable:!0,get:()=>i[o]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const h of o)if(h.type==="childList")for(const f of h.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function t(o){const h={};return o.integrity&&(h.integrity=o.integrity),o.referrerPolicy&&(h.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?h.credentials="include":o.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function i(o){if(o.ep)return;o.ep=!0;const h=t(o);fetch(o.href,h)}})();var mP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function KM(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var JM={exports:{}},$g={},QM={exports:{}},Bn={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Hf=Symbol.for("react.element"),gP=Symbol.for("react.portal"),_P=Symbol.for("react.fragment"),yP=Symbol.for("react.strict_mode"),vP=Symbol.for("react.profiler"),xP=Symbol.for("react.provider"),bP=Symbol.for("react.context"),wP=Symbol.for("react.forward_ref"),SP=Symbol.for("react.suspense"),MP=Symbol.for("react.memo"),TP=Symbol.for("react.lazy"),Ab=Symbol.iterator;function EP(n){return n===null||typeof n!="object"?null:(n=Ab&&n[Ab]||n["@@iterator"],typeof n=="function"?n:null)}var eT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},tT=Object.assign,nT={};function Eh(n,e,t){this.props=n,this.context=e,this.refs=nT,this.updater=t||eT}Eh.prototype.isReactComponent={};Eh.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};Eh.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function iT(){}iT.prototype=Eh.prototype;function Gv(n,e,t){this.props=n,this.context=e,this.refs=nT,this.updater=t||eT}var Hv=Gv.prototype=new iT;Hv.constructor=Gv;tT(Hv,Eh.prototype);Hv.isPureReactComponent=!0;var Cb=Array.isArray,rT=Object.prototype.hasOwnProperty,jv={current:null},sT={key:!0,ref:!0,__self:!0,__source:!0};function aT(n,e,t){var i,o={},h=null,f=null;if(e!=null)for(i in e.ref!==void 0&&(f=e.ref),e.key!==void 0&&(h=""+e.key),e)rT.call(e,i)&&!sT.hasOwnProperty(i)&&(o[i]=e[i]);var c=arguments.length-2;if(c===1)o.children=t;else if(1<c){for(var v=Array(c),w=0;w<c;w++)v[w]=arguments[w+2];o.children=v}if(n&&n.defaultProps)for(i in c=n.defaultProps,c)o[i]===void 0&&(o[i]=c[i]);return{$$typeof:Hf,type:n,key:h,ref:f,props:o,_owner:jv.current}}function AP(n,e){return{$$typeof:Hf,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function Wv(n){return typeof n=="object"&&n!==null&&n.$$typeof===Hf}function CP(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Pb=/\/+/g;function vy(n,e){return typeof n=="object"&&n!==null&&n.key!=null?CP(""+n.key):e.toString(36)}function Qm(n,e,t,i,o){var h=typeof n;(h==="undefined"||h==="boolean")&&(n=null);var f=!1;if(n===null)f=!0;else switch(h){case"string":case"number":f=!0;break;case"object":switch(n.$$typeof){case Hf:case gP:f=!0}}if(f)return f=n,o=o(f),n=i===""?"."+vy(f,0):i,Cb(o)?(t="",n!=null&&(t=n.replace(Pb,"$&/")+"/"),Qm(o,e,t,"",function(w){return w})):o!=null&&(Wv(o)&&(o=AP(o,t+(!o.key||f&&f.key===o.key?"":(""+o.key).replace(Pb,"$&/")+"/")+n)),e.push(o)),1;if(f=0,i=i===""?".":i+":",Cb(n))for(var c=0;c<n.length;c++){h=n[c];var v=i+vy(h,c);f+=Qm(h,e,t,v,o)}else if(v=EP(n),typeof v=="function")for(n=v.call(n),c=0;!(h=n.next()).done;)h=h.value,v=i+vy(h,c++),f+=Qm(h,e,t,v,o);else if(h==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return f}function lm(n,e,t){if(n==null)return n;var i=[],o=0;return Qm(n,i,"","",function(h){return e.call(t,h,o++)}),i}function PP(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var $r={current:null},eg={transition:null},RP={ReactCurrentDispatcher:$r,ReactCurrentBatchConfig:eg,ReactCurrentOwner:jv};Bn.Children={map:lm,forEach:function(n,e,t){lm(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return lm(n,function(){e++}),e},toArray:function(n){return lm(n,function(e){return e})||[]},only:function(n){if(!Wv(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};Bn.Component=Eh;Bn.Fragment=_P;Bn.Profiler=vP;Bn.PureComponent=Gv;Bn.StrictMode=yP;Bn.Suspense=SP;Bn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=RP;Bn.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=tT({},n.props),o=n.key,h=n.ref,f=n._owner;if(e!=null){if(e.ref!==void 0&&(h=e.ref,f=jv.current),e.key!==void 0&&(o=""+e.key),n.type&&n.type.defaultProps)var c=n.type.defaultProps;for(v in e)rT.call(e,v)&&!sT.hasOwnProperty(v)&&(i[v]=e[v]===void 0&&c!==void 0?c[v]:e[v])}var v=arguments.length-2;if(v===1)i.children=t;else if(1<v){c=Array(v);for(var w=0;w<v;w++)c[w]=arguments[w+2];i.children=c}return{$$typeof:Hf,type:n.type,key:o,ref:h,props:i,_owner:f}};Bn.createContext=function(n){return n={$$typeof:bP,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:xP,_context:n},n.Consumer=n};Bn.createElement=aT;Bn.createFactory=function(n){var e=aT.bind(null,n);return e.type=n,e};Bn.createRef=function(){return{current:null}};Bn.forwardRef=function(n){return{$$typeof:wP,render:n}};Bn.isValidElement=Wv;Bn.lazy=function(n){return{$$typeof:TP,_payload:{_status:-1,_result:n},_init:PP}};Bn.memo=function(n,e){return{$$typeof:MP,type:n,compare:e===void 0?null:e}};Bn.startTransition=function(n){var e=eg.transition;eg.transition={};try{n()}finally{eg.transition=e}};Bn.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};Bn.useCallback=function(n,e){return $r.current.useCallback(n,e)};Bn.useContext=function(n){return $r.current.useContext(n)};Bn.useDebugValue=function(){};Bn.useDeferredValue=function(n){return $r.current.useDeferredValue(n)};Bn.useEffect=function(n,e){return $r.current.useEffect(n,e)};Bn.useId=function(){return $r.current.useId()};Bn.useImperativeHandle=function(n,e,t){return $r.current.useImperativeHandle(n,e,t)};Bn.useInsertionEffect=function(n,e){return $r.current.useInsertionEffect(n,e)};Bn.useLayoutEffect=function(n,e){return $r.current.useLayoutEffect(n,e)};Bn.useMemo=function(n,e){return $r.current.useMemo(n,e)};Bn.useReducer=function(n,e,t){return $r.current.useReducer(n,e,t)};Bn.useRef=function(n){return $r.current.useRef(n)};Bn.useState=function(n){return $r.current.useState(n)};Bn.useSyncExternalStore=function(n,e,t){return $r.current.useSyncExternalStore(n,e,t)};Bn.useTransition=function(){return $r.current.useTransition()};Bn.version="18.2.0";QM.exports=Bn;var ct=QM.exports;const oT=KM(ct),IP=YM({__proto__:null,default:oT},[ct]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LP=ct,DP=Symbol.for("react.element"),zP=Symbol.for("react.fragment"),kP=Object.prototype.hasOwnProperty,FP=LP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,UP={key:!0,ref:!0,__self:!0,__source:!0};function lT(n,e,t){var i,o={},h=null,f=null;t!==void 0&&(h=""+t),e.key!==void 0&&(h=""+e.key),e.ref!==void 0&&(f=e.ref);for(i in e)kP.call(e,i)&&!UP.hasOwnProperty(i)&&(o[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)o[i]===void 0&&(o[i]=e[i]);return{$$typeof:DP,type:n,key:h,ref:f,props:o,_owner:FP.current}}$g.Fragment=zP;$g.jsx=lT;$g.jsxs=lT;JM.exports=$g;var ge=JM.exports,z0={},cT={exports:{}},xs={},uT={exports:{}},hT={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(Ce,Ke){var Ye=Ce.length;Ce.push(Ke);e:for(;0<Ye;){var pt=Ye-1>>>1,kt=Ce[pt];if(0<o(kt,Ke))Ce[pt]=Ke,Ce[Ye]=kt,Ye=pt;else break e}}function t(Ce){return Ce.length===0?null:Ce[0]}function i(Ce){if(Ce.length===0)return null;var Ke=Ce[0],Ye=Ce.pop();if(Ye!==Ke){Ce[0]=Ye;e:for(var pt=0,kt=Ce.length,_n=kt>>>1;pt<_n;){var Ze=2*(pt+1)-1,_t=Ce[Ze],Ct=Ze+1,St=Ce[Ct];if(0>o(_t,Ye))Ct<kt&&0>o(St,_t)?(Ce[pt]=St,Ce[Ct]=Ye,pt=Ct):(Ce[pt]=_t,Ce[Ze]=Ye,pt=Ze);else if(Ct<kt&&0>o(St,Ye))Ce[pt]=St,Ce[Ct]=Ye,pt=Ct;else break e}}return Ke}function o(Ce,Ke){var Ye=Ce.sortIndex-Ke.sortIndex;return Ye!==0?Ye:Ce.id-Ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var h=performance;n.unstable_now=function(){return h.now()}}else{var f=Date,c=f.now();n.unstable_now=function(){return f.now()-c}}var v=[],w=[],S=1,E=null,M=3,L=!1,U=!1,B=!1,z=typeof setTimeout=="function"?setTimeout:null,R=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(Ce){for(var Ke=t(w);Ke!==null;){if(Ke.callback===null)i(w);else if(Ke.startTime<=Ce)i(w),Ke.sortIndex=Ke.expirationTime,e(v,Ke);else break;Ke=t(w)}}function ee(Ce){if(B=!1,V(Ce),!U)if(t(v)!==null)U=!0,ut(fe);else{var Ke=t(w);Ke!==null&&st(ee,Ke.startTime-Ce)}}function fe(Ce,Ke){U=!1,B&&(B=!1,R(be),be=-1),L=!0;var Ye=M;try{for(V(Ke),E=t(v);E!==null&&(!(E.expirationTime>Ke)||Ce&&!Pe());){var pt=E.callback;if(typeof pt=="function"){E.callback=null,M=E.priorityLevel;var kt=pt(E.expirationTime<=Ke);Ke=n.unstable_now(),typeof kt=="function"?E.callback=kt:E===t(v)&&i(v),V(Ke)}else i(v);E=t(v)}if(E!==null)var _n=!0;else{var Ze=t(w);Ze!==null&&st(ee,Ze.startTime-Ke),_n=!1}return _n}finally{E=null,M=Ye,L=!1}}var Z=!1,te=null,be=-1,ae=5,K=-1;function Pe(){return!(n.unstable_now()-K<ae)}function ke(){if(te!==null){var Ce=n.unstable_now();K=Ce;var Ke=!0;try{Ke=te(!0,Ce)}finally{Ke?Te():(Z=!1,te=null)}}else Z=!1}var Te;if(typeof G=="function")Te=function(){G(ke)};else if(typeof MessageChannel<"u"){var je=new MessageChannel,it=je.port2;je.port1.onmessage=ke,Te=function(){it.postMessage(null)}}else Te=function(){z(ke,0)};function ut(Ce){te=Ce,Z||(Z=!0,Te())}function st(Ce,Ke){be=z(function(){Ce(n.unstable_now())},Ke)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ce){Ce.callback=null},n.unstable_continueExecution=function(){U||L||(U=!0,ut(fe))},n.unstable_forceFrameRate=function(Ce){0>Ce||125<Ce?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<Ce?Math.floor(1e3/Ce):5},n.unstable_getCurrentPriorityLevel=function(){return M},n.unstable_getFirstCallbackNode=function(){return t(v)},n.unstable_next=function(Ce){switch(M){case 1:case 2:case 3:var Ke=3;break;default:Ke=M}var Ye=M;M=Ke;try{return Ce()}finally{M=Ye}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ce,Ke){switch(Ce){case 1:case 2:case 3:case 4:case 5:break;default:Ce=3}var Ye=M;M=Ce;try{return Ke()}finally{M=Ye}},n.unstable_scheduleCallback=function(Ce,Ke,Ye){var pt=n.unstable_now();switch(typeof Ye=="object"&&Ye!==null?(Ye=Ye.delay,Ye=typeof Ye=="number"&&0<Ye?pt+Ye:pt):Ye=pt,Ce){case 1:var kt=-1;break;case 2:kt=250;break;case 5:kt=1073741823;break;case 4:kt=1e4;break;default:kt=5e3}return kt=Ye+kt,Ce={id:S++,callback:Ke,priorityLevel:Ce,startTime:Ye,expirationTime:kt,sortIndex:-1},Ye>pt?(Ce.sortIndex=Ye,e(w,Ce),t(v)===null&&Ce===t(w)&&(B?(R(be),be=-1):B=!0,st(ee,Ye-pt))):(Ce.sortIndex=kt,e(v,Ce),U||L||(U=!0,ut(fe))),Ce},n.unstable_shouldYield=Pe,n.unstable_wrapCallback=function(Ce){var Ke=M;return function(){var Ye=M;M=Ke;try{return Ce.apply(this,arguments)}finally{M=Ye}}}})(hT);uT.exports=hT;var NP=uT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dT=ct,vs=NP;function Mt(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var fT=new Set,bf={};function Mc(n,e){hh(n,e),hh(n+"Capture",e)}function hh(n,e){for(bf[n]=e,n=0;n<e.length;n++)fT.add(e[n])}var oo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),k0=Object.prototype.hasOwnProperty,OP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Rb={},Ib={};function BP(n){return k0.call(Ib,n)?!0:k0.call(Rb,n)?!1:OP.test(n)?Ib[n]=!0:(Rb[n]=!0,!1)}function VP(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function GP(n,e,t,i){if(e===null||typeof e>"u"||VP(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Xr(n,e,t,i,o,h,f){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=o,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=h,this.removeEmptyString=f}var pr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){pr[n]=new Xr(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];pr[e]=new Xr(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){pr[n]=new Xr(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){pr[n]=new Xr(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){pr[n]=new Xr(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){pr[n]=new Xr(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){pr[n]=new Xr(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){pr[n]=new Xr(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){pr[n]=new Xr(n,5,!1,n.toLowerCase(),null,!1,!1)});var $v=/[\-:]([a-z])/g;function Xv(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace($v,Xv);pr[e]=new Xr(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace($v,Xv);pr[e]=new Xr(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace($v,Xv);pr[e]=new Xr(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){pr[n]=new Xr(n,1,!1,n.toLowerCase(),null,!1,!1)});pr.xlinkHref=new Xr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){pr[n]=new Xr(n,1,!1,n.toLowerCase(),null,!0,!0)});function qv(n,e,t,i){var o=pr.hasOwnProperty(e)?pr[e]:null;(o!==null?o.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(GP(e,t,o,i)&&(t=null),i||o===null?BP(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):o.mustUseProperty?n[o.propertyName]=t===null?o.type===3?!1:"":t:(e=o.attributeName,i=o.attributeNamespace,t===null?n.removeAttribute(e):(o=o.type,t=o===3||o===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var po=dT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,cm=Symbol.for("react.element"),Uu=Symbol.for("react.portal"),Nu=Symbol.for("react.fragment"),Zv=Symbol.for("react.strict_mode"),F0=Symbol.for("react.profiler"),pT=Symbol.for("react.provider"),mT=Symbol.for("react.context"),Yv=Symbol.for("react.forward_ref"),U0=Symbol.for("react.suspense"),N0=Symbol.for("react.suspense_list"),Kv=Symbol.for("react.memo"),Jo=Symbol.for("react.lazy"),gT=Symbol.for("react.offscreen"),Lb=Symbol.iterator;function Nd(n){return n===null||typeof n!="object"?null:(n=Lb&&n[Lb]||n["@@iterator"],typeof n=="function"?n:null)}var Ei=Object.assign,xy;function nf(n){if(xy===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);xy=e&&e[1]||""}return`
`+xy+n}var by=!1;function wy(n,e){if(!n||by)return"";by=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(w){var i=w}Reflect.construct(n,[],e)}else{try{e.call()}catch(w){i=w}n.call(e.prototype)}else{try{throw Error()}catch(w){i=w}n()}}catch(w){if(w&&i&&typeof w.stack=="string"){for(var o=w.stack.split(`
`),h=i.stack.split(`
`),f=o.length-1,c=h.length-1;1<=f&&0<=c&&o[f]!==h[c];)c--;for(;1<=f&&0<=c;f--,c--)if(o[f]!==h[c]){if(f!==1||c!==1)do if(f--,c--,0>c||o[f]!==h[c]){var v=`
`+o[f].replace(" at new "," at ");return n.displayName&&v.includes("<anonymous>")&&(v=v.replace("<anonymous>",n.displayName)),v}while(1<=f&&0<=c);break}}}finally{by=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?nf(n):""}function HP(n){switch(n.tag){case 5:return nf(n.type);case 16:return nf("Lazy");case 13:return nf("Suspense");case 19:return nf("SuspenseList");case 0:case 2:case 15:return n=wy(n.type,!1),n;case 11:return n=wy(n.type.render,!1),n;case 1:return n=wy(n.type,!0),n;default:return""}}function O0(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Nu:return"Fragment";case Uu:return"Portal";case F0:return"Profiler";case Zv:return"StrictMode";case U0:return"Suspense";case N0:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case mT:return(n.displayName||"Context")+".Consumer";case pT:return(n._context.displayName||"Context")+".Provider";case Yv:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Kv:return e=n.displayName||null,e!==null?e:O0(n.type)||"Memo";case Jo:e=n._payload,n=n._init;try{return O0(n(e))}catch{}}return null}function jP(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return O0(e);case 8:return e===Zv?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function yl(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function _T(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function WP(n){var e=_T(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var o=t.get,h=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return o.call(this)},set:function(f){i=""+f,h.call(this,f)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(f){i=""+f},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function um(n){n._valueTracker||(n._valueTracker=WP(n))}function yT(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=_T(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function pg(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function B0(n,e){var t=e.checked;return Ei({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function Db(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=yl(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function vT(n,e){e=e.checked,e!=null&&qv(n,"checked",e,!1)}function V0(n,e){vT(n,e);var t=yl(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?G0(n,e.type,t):e.hasOwnProperty("defaultValue")&&G0(n,e.type,yl(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function zb(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function G0(n,e,t){(e!=="number"||pg(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var rf=Array.isArray;function th(n,e,t,i){if(n=n.options,e){e={};for(var o=0;o<t.length;o++)e["$"+t[o]]=!0;for(t=0;t<n.length;t++)o=e.hasOwnProperty("$"+n[t].value),n[t].selected!==o&&(n[t].selected=o),o&&i&&(n[t].defaultSelected=!0)}else{for(t=""+yl(t),e=null,o=0;o<n.length;o++){if(n[o].value===t){n[o].selected=!0,i&&(n[o].defaultSelected=!0);return}e!==null||n[o].disabled||(e=n[o])}e!==null&&(e.selected=!0)}}function H0(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(Mt(91));return Ei({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function kb(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(Mt(92));if(rf(t)){if(1<t.length)throw Error(Mt(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:yl(t)}}function xT(n,e){var t=yl(e.value),i=yl(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function Fb(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function bT(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function j0(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?bT(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var hm,wT=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,o){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,o)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(hm=hm||document.createElement("div"),hm.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=hm.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function wf(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var cf={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},$P=["Webkit","ms","Moz","O"];Object.keys(cf).forEach(function(n){$P.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),cf[e]=cf[n]})});function ST(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||cf.hasOwnProperty(n)&&cf[n]?(""+e).trim():e+"px"}function MT(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,o=ST(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,o):n[t]=o}}var XP=Ei({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function W0(n,e){if(e){if(XP[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(Mt(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(Mt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(Mt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(Mt(62))}}function $0(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var X0=null;function Jv(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var q0=null,nh=null,ih=null;function Ub(n){if(n=$f(n)){if(typeof q0!="function")throw Error(Mt(280));var e=n.stateNode;e&&(e=Kg(e),q0(n.stateNode,n.type,e))}}function TT(n){nh?ih?ih.push(n):ih=[n]:nh=n}function ET(){if(nh){var n=nh,e=ih;if(ih=nh=null,Ub(n),e)for(n=0;n<e.length;n++)Ub(e[n])}}function AT(n,e){return n(e)}function CT(){}var Sy=!1;function PT(n,e,t){if(Sy)return n(e,t);Sy=!0;try{return AT(n,e,t)}finally{Sy=!1,(nh!==null||ih!==null)&&(CT(),ET())}}function Sf(n,e){var t=n.stateNode;if(t===null)return null;var i=Kg(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(Mt(231,e,typeof t));return t}var Z0=!1;if(oo)try{var Od={};Object.defineProperty(Od,"passive",{get:function(){Z0=!0}}),window.addEventListener("test",Od,Od),window.removeEventListener("test",Od,Od)}catch{Z0=!1}function qP(n,e,t,i,o,h,f,c,v){var w=Array.prototype.slice.call(arguments,3);try{e.apply(t,w)}catch(S){this.onError(S)}}var uf=!1,mg=null,gg=!1,Y0=null,ZP={onError:function(n){uf=!0,mg=n}};function YP(n,e,t,i,o,h,f,c,v){uf=!1,mg=null,qP.apply(ZP,arguments)}function KP(n,e,t,i,o,h,f,c,v){if(YP.apply(this,arguments),uf){if(uf){var w=mg;uf=!1,mg=null}else throw Error(Mt(198));gg||(gg=!0,Y0=w)}}function Tc(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function RT(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function Nb(n){if(Tc(n)!==n)throw Error(Mt(188))}function JP(n){var e=n.alternate;if(!e){if(e=Tc(n),e===null)throw Error(Mt(188));return e!==n?null:n}for(var t=n,i=e;;){var o=t.return;if(o===null)break;var h=o.alternate;if(h===null){if(i=o.return,i!==null){t=i;continue}break}if(o.child===h.child){for(h=o.child;h;){if(h===t)return Nb(o),n;if(h===i)return Nb(o),e;h=h.sibling}throw Error(Mt(188))}if(t.return!==i.return)t=o,i=h;else{for(var f=!1,c=o.child;c;){if(c===t){f=!0,t=o,i=h;break}if(c===i){f=!0,i=o,t=h;break}c=c.sibling}if(!f){for(c=h.child;c;){if(c===t){f=!0,t=h,i=o;break}if(c===i){f=!0,i=h,t=o;break}c=c.sibling}if(!f)throw Error(Mt(189))}}if(t.alternate!==i)throw Error(Mt(190))}if(t.tag!==3)throw Error(Mt(188));return t.stateNode.current===t?n:e}function IT(n){return n=JP(n),n!==null?LT(n):null}function LT(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=LT(n);if(e!==null)return e;n=n.sibling}return null}var DT=vs.unstable_scheduleCallback,Ob=vs.unstable_cancelCallback,QP=vs.unstable_shouldYield,eR=vs.unstable_requestPaint,Vi=vs.unstable_now,tR=vs.unstable_getCurrentPriorityLevel,Qv=vs.unstable_ImmediatePriority,zT=vs.unstable_UserBlockingPriority,_g=vs.unstable_NormalPriority,nR=vs.unstable_LowPriority,kT=vs.unstable_IdlePriority,Xg=null,Sa=null;function iR(n){if(Sa&&typeof Sa.onCommitFiberRoot=="function")try{Sa.onCommitFiberRoot(Xg,n,void 0,(n.current.flags&128)===128)}catch{}}var ra=Math.clz32?Math.clz32:aR,rR=Math.log,sR=Math.LN2;function aR(n){return n>>>=0,n===0?32:31-(rR(n)/sR|0)|0}var dm=64,fm=4194304;function sf(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function yg(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,o=n.suspendedLanes,h=n.pingedLanes,f=t&268435455;if(f!==0){var c=f&~o;c!==0?i=sf(c):(h&=f,h!==0&&(i=sf(h)))}else f=t&~o,f!==0?i=sf(f):h!==0&&(i=sf(h));if(i===0)return 0;if(e!==0&&e!==i&&!(e&o)&&(o=i&-i,h=e&-e,o>=h||o===16&&(h&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-ra(e),o=1<<t,i|=n[t],e&=~o;return i}function oR(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function lR(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,o=n.expirationTimes,h=n.pendingLanes;0<h;){var f=31-ra(h),c=1<<f,v=o[f];v===-1?(!(c&t)||c&i)&&(o[f]=oR(c,e)):v<=e&&(n.expiredLanes|=c),h&=~c}}function K0(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function FT(){var n=dm;return dm<<=1,!(dm&4194240)&&(dm=64),n}function My(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function jf(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-ra(e),n[e]=t}function cR(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var o=31-ra(t),h=1<<o;e[o]=0,i[o]=-1,n[o]=-1,t&=~h}}function ex(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-ra(t),o=1<<i;o&e|n[i]&e&&(n[i]|=e),t&=~o}}var Qn=0;function UT(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var NT,tx,OT,BT,VT,J0=!1,pm=[],ol=null,ll=null,cl=null,Mf=new Map,Tf=new Map,tl=[],uR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Bb(n,e){switch(n){case"focusin":case"focusout":ol=null;break;case"dragenter":case"dragleave":ll=null;break;case"mouseover":case"mouseout":cl=null;break;case"pointerover":case"pointerout":Mf.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Tf.delete(e.pointerId)}}function Bd(n,e,t,i,o,h){return n===null||n.nativeEvent!==h?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:h,targetContainers:[o]},e!==null&&(e=$f(e),e!==null&&tx(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,o!==null&&e.indexOf(o)===-1&&e.push(o),n)}function hR(n,e,t,i,o){switch(e){case"focusin":return ol=Bd(ol,n,e,t,i,o),!0;case"dragenter":return ll=Bd(ll,n,e,t,i,o),!0;case"mouseover":return cl=Bd(cl,n,e,t,i,o),!0;case"pointerover":var h=o.pointerId;return Mf.set(h,Bd(Mf.get(h)||null,n,e,t,i,o)),!0;case"gotpointercapture":return h=o.pointerId,Tf.set(h,Bd(Tf.get(h)||null,n,e,t,i,o)),!0}return!1}function GT(n){var e=oc(n.target);if(e!==null){var t=Tc(e);if(t!==null){if(e=t.tag,e===13){if(e=RT(t),e!==null){n.blockedOn=e,VT(n.priority,function(){OT(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function tg(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=Q0(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);X0=i,t.target.dispatchEvent(i),X0=null}else return e=$f(t),e!==null&&tx(e),n.blockedOn=t,!1;e.shift()}return!0}function Vb(n,e,t){tg(n)&&t.delete(e)}function dR(){J0=!1,ol!==null&&tg(ol)&&(ol=null),ll!==null&&tg(ll)&&(ll=null),cl!==null&&tg(cl)&&(cl=null),Mf.forEach(Vb),Tf.forEach(Vb)}function Vd(n,e){n.blockedOn===e&&(n.blockedOn=null,J0||(J0=!0,vs.unstable_scheduleCallback(vs.unstable_NormalPriority,dR)))}function Ef(n){function e(o){return Vd(o,n)}if(0<pm.length){Vd(pm[0],n);for(var t=1;t<pm.length;t++){var i=pm[t];i.blockedOn===n&&(i.blockedOn=null)}}for(ol!==null&&Vd(ol,n),ll!==null&&Vd(ll,n),cl!==null&&Vd(cl,n),Mf.forEach(e),Tf.forEach(e),t=0;t<tl.length;t++)i=tl[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<tl.length&&(t=tl[0],t.blockedOn===null);)GT(t),t.blockedOn===null&&tl.shift()}var rh=po.ReactCurrentBatchConfig,vg=!0;function fR(n,e,t,i){var o=Qn,h=rh.transition;rh.transition=null;try{Qn=1,nx(n,e,t,i)}finally{Qn=o,rh.transition=h}}function pR(n,e,t,i){var o=Qn,h=rh.transition;rh.transition=null;try{Qn=4,nx(n,e,t,i)}finally{Qn=o,rh.transition=h}}function nx(n,e,t,i){if(vg){var o=Q0(n,e,t,i);if(o===null)zy(n,e,i,xg,t),Bb(n,i);else if(hR(o,n,e,t,i))i.stopPropagation();else if(Bb(n,i),e&4&&-1<uR.indexOf(n)){for(;o!==null;){var h=$f(o);if(h!==null&&NT(h),h=Q0(n,e,t,i),h===null&&zy(n,e,i,xg,t),h===o)break;o=h}o!==null&&i.stopPropagation()}else zy(n,e,i,null,t)}}var xg=null;function Q0(n,e,t,i){if(xg=null,n=Jv(i),n=oc(n),n!==null)if(e=Tc(n),e===null)n=null;else if(t=e.tag,t===13){if(n=RT(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return xg=n,null}function HT(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(tR()){case Qv:return 1;case zT:return 4;case _g:case nR:return 16;case kT:return 536870912;default:return 16}default:return 16}}var rl=null,ix=null,ng=null;function jT(){if(ng)return ng;var n,e=ix,t=e.length,i,o="value"in rl?rl.value:rl.textContent,h=o.length;for(n=0;n<t&&e[n]===o[n];n++);var f=t-n;for(i=1;i<=f&&e[t-i]===o[h-i];i++);return ng=o.slice(n,1<i?1-i:void 0)}function ig(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function mm(){return!0}function Gb(){return!1}function bs(n){function e(t,i,o,h,f){this._reactName=t,this._targetInst=o,this.type=i,this.nativeEvent=h,this.target=f,this.currentTarget=null;for(var c in n)n.hasOwnProperty(c)&&(t=n[c],this[c]=t?t(h):h[c]);return this.isDefaultPrevented=(h.defaultPrevented!=null?h.defaultPrevented:h.returnValue===!1)?mm:Gb,this.isPropagationStopped=Gb,this}return Ei(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=mm)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=mm)},persist:function(){},isPersistent:mm}),e}var Ah={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rx=bs(Ah),Wf=Ei({},Ah,{view:0,detail:0}),mR=bs(Wf),Ty,Ey,Gd,qg=Ei({},Wf,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:sx,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Gd&&(Gd&&n.type==="mousemove"?(Ty=n.screenX-Gd.screenX,Ey=n.screenY-Gd.screenY):Ey=Ty=0,Gd=n),Ty)},movementY:function(n){return"movementY"in n?n.movementY:Ey}}),Hb=bs(qg),gR=Ei({},qg,{dataTransfer:0}),_R=bs(gR),yR=Ei({},Wf,{relatedTarget:0}),Ay=bs(yR),vR=Ei({},Ah,{animationName:0,elapsedTime:0,pseudoElement:0}),xR=bs(vR),bR=Ei({},Ah,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),wR=bs(bR),SR=Ei({},Ah,{data:0}),jb=bs(SR),MR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},TR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ER={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function AR(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=ER[n])?!!e[n]:!1}function sx(){return AR}var CR=Ei({},Wf,{key:function(n){if(n.key){var e=MR[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=ig(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?TR[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:sx,charCode:function(n){return n.type==="keypress"?ig(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?ig(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),PR=bs(CR),RR=Ei({},qg,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Wb=bs(RR),IR=Ei({},Wf,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:sx}),LR=bs(IR),DR=Ei({},Ah,{propertyName:0,elapsedTime:0,pseudoElement:0}),zR=bs(DR),kR=Ei({},qg,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),FR=bs(kR),UR=[9,13,27,32],ax=oo&&"CompositionEvent"in window,hf=null;oo&&"documentMode"in document&&(hf=document.documentMode);var NR=oo&&"TextEvent"in window&&!hf,WT=oo&&(!ax||hf&&8<hf&&11>=hf),$b=" ",Xb=!1;function $T(n,e){switch(n){case"keyup":return UR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function XT(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ou=!1;function OR(n,e){switch(n){case"compositionend":return XT(e);case"keypress":return e.which!==32?null:(Xb=!0,$b);case"textInput":return n=e.data,n===$b&&Xb?null:n;default:return null}}function BR(n,e){if(Ou)return n==="compositionend"||!ax&&$T(n,e)?(n=jT(),ng=ix=rl=null,Ou=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return WT&&e.locale!=="ko"?null:e.data;default:return null}}var VR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function qb(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!VR[n.type]:e==="textarea"}function qT(n,e,t,i){TT(i),e=bg(e,"onChange"),0<e.length&&(t=new rx("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var df=null,Af=null;function GR(n){sE(n,0)}function Zg(n){var e=Gu(n);if(yT(e))return n}function HR(n,e){if(n==="change")return e}var ZT=!1;if(oo){var Cy;if(oo){var Py="oninput"in document;if(!Py){var Zb=document.createElement("div");Zb.setAttribute("oninput","return;"),Py=typeof Zb.oninput=="function"}Cy=Py}else Cy=!1;ZT=Cy&&(!document.documentMode||9<document.documentMode)}function Yb(){df&&(df.detachEvent("onpropertychange",YT),Af=df=null)}function YT(n){if(n.propertyName==="value"&&Zg(Af)){var e=[];qT(e,Af,n,Jv(n)),PT(GR,e)}}function jR(n,e,t){n==="focusin"?(Yb(),df=e,Af=t,df.attachEvent("onpropertychange",YT)):n==="focusout"&&Yb()}function WR(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Zg(Af)}function $R(n,e){if(n==="click")return Zg(e)}function XR(n,e){if(n==="input"||n==="change")return Zg(e)}function qR(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var aa=typeof Object.is=="function"?Object.is:qR;function Cf(n,e){if(aa(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var o=t[i];if(!k0.call(e,o)||!aa(n[o],e[o]))return!1}return!0}function Kb(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Jb(n,e){var t=Kb(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=Kb(t)}}function KT(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?KT(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function JT(){for(var n=window,e=pg();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=pg(n.document)}return e}function ox(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function ZR(n){var e=JT(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&KT(t.ownerDocument.documentElement,t)){if(i!==null&&ox(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var o=t.textContent.length,h=Math.min(i.start,o);i=i.end===void 0?h:Math.min(i.end,o),!n.extend&&h>i&&(o=i,i=h,h=o),o=Jb(t,h);var f=Jb(t,i);o&&f&&(n.rangeCount!==1||n.anchorNode!==o.node||n.anchorOffset!==o.offset||n.focusNode!==f.node||n.focusOffset!==f.offset)&&(e=e.createRange(),e.setStart(o.node,o.offset),n.removeAllRanges(),h>i?(n.addRange(e),n.extend(f.node,f.offset)):(e.setEnd(f.node,f.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var YR=oo&&"documentMode"in document&&11>=document.documentMode,Bu=null,ev=null,ff=null,tv=!1;function Qb(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;tv||Bu==null||Bu!==pg(i)||(i=Bu,"selectionStart"in i&&ox(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),ff&&Cf(ff,i)||(ff=i,i=bg(ev,"onSelect"),0<i.length&&(e=new rx("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=Bu)))}function gm(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Vu={animationend:gm("Animation","AnimationEnd"),animationiteration:gm("Animation","AnimationIteration"),animationstart:gm("Animation","AnimationStart"),transitionend:gm("Transition","TransitionEnd")},Ry={},QT={};oo&&(QT=document.createElement("div").style,"AnimationEvent"in window||(delete Vu.animationend.animation,delete Vu.animationiteration.animation,delete Vu.animationstart.animation),"TransitionEvent"in window||delete Vu.transitionend.transition);function Yg(n){if(Ry[n])return Ry[n];if(!Vu[n])return n;var e=Vu[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in QT)return Ry[n]=e[t];return n}var eE=Yg("animationend"),tE=Yg("animationiteration"),nE=Yg("animationstart"),iE=Yg("transitionend"),rE=new Map,ew="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function bl(n,e){rE.set(n,e),Mc(e,[n])}for(var Iy=0;Iy<ew.length;Iy++){var Ly=ew[Iy],KR=Ly.toLowerCase(),JR=Ly[0].toUpperCase()+Ly.slice(1);bl(KR,"on"+JR)}bl(eE,"onAnimationEnd");bl(tE,"onAnimationIteration");bl(nE,"onAnimationStart");bl("dblclick","onDoubleClick");bl("focusin","onFocus");bl("focusout","onBlur");bl(iE,"onTransitionEnd");hh("onMouseEnter",["mouseout","mouseover"]);hh("onMouseLeave",["mouseout","mouseover"]);hh("onPointerEnter",["pointerout","pointerover"]);hh("onPointerLeave",["pointerout","pointerover"]);Mc("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Mc("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Mc("onBeforeInput",["compositionend","keypress","textInput","paste"]);Mc("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Mc("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Mc("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var af="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),QR=new Set("cancel close invalid load scroll toggle".split(" ").concat(af));function tw(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,KP(i,e,void 0,n),n.currentTarget=null}function sE(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],o=i.event;i=i.listeners;e:{var h=void 0;if(e)for(var f=i.length-1;0<=f;f--){var c=i[f],v=c.instance,w=c.currentTarget;if(c=c.listener,v!==h&&o.isPropagationStopped())break e;tw(o,c,w),h=v}else for(f=0;f<i.length;f++){if(c=i[f],v=c.instance,w=c.currentTarget,c=c.listener,v!==h&&o.isPropagationStopped())break e;tw(o,c,w),h=v}}}if(gg)throw n=Y0,gg=!1,Y0=null,n}function mi(n,e){var t=e[av];t===void 0&&(t=e[av]=new Set);var i=n+"__bubble";t.has(i)||(aE(e,n,2,!1),t.add(i))}function Dy(n,e,t){var i=0;e&&(i|=4),aE(t,n,i,e)}var _m="_reactListening"+Math.random().toString(36).slice(2);function Pf(n){if(!n[_m]){n[_m]=!0,fT.forEach(function(t){t!=="selectionchange"&&(QR.has(t)||Dy(t,!1,n),Dy(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[_m]||(e[_m]=!0,Dy("selectionchange",!1,e))}}function aE(n,e,t,i){switch(HT(e)){case 1:var o=fR;break;case 4:o=pR;break;default:o=nx}t=o.bind(null,e,t,n),o=void 0,!Z0||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(o=!0),i?o!==void 0?n.addEventListener(e,t,{capture:!0,passive:o}):n.addEventListener(e,t,!0):o!==void 0?n.addEventListener(e,t,{passive:o}):n.addEventListener(e,t,!1)}function zy(n,e,t,i,o){var h=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var f=i.tag;if(f===3||f===4){var c=i.stateNode.containerInfo;if(c===o||c.nodeType===8&&c.parentNode===o)break;if(f===4)for(f=i.return;f!==null;){var v=f.tag;if((v===3||v===4)&&(v=f.stateNode.containerInfo,v===o||v.nodeType===8&&v.parentNode===o))return;f=f.return}for(;c!==null;){if(f=oc(c),f===null)return;if(v=f.tag,v===5||v===6){i=h=f;continue e}c=c.parentNode}}i=i.return}PT(function(){var w=h,S=Jv(t),E=[];e:{var M=rE.get(n);if(M!==void 0){var L=rx,U=n;switch(n){case"keypress":if(ig(t)===0)break e;case"keydown":case"keyup":L=PR;break;case"focusin":U="focus",L=Ay;break;case"focusout":U="blur",L=Ay;break;case"beforeblur":case"afterblur":L=Ay;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":L=Hb;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":L=_R;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":L=LR;break;case eE:case tE:case nE:L=xR;break;case iE:L=zR;break;case"scroll":L=mR;break;case"wheel":L=FR;break;case"copy":case"cut":case"paste":L=wR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":L=Wb}var B=(e&4)!==0,z=!B&&n==="scroll",R=B?M!==null?M+"Capture":null:M;B=[];for(var G=w,V;G!==null;){V=G;var ee=V.stateNode;if(V.tag===5&&ee!==null&&(V=ee,R!==null&&(ee=Sf(G,R),ee!=null&&B.push(Rf(G,ee,V)))),z)break;G=G.return}0<B.length&&(M=new L(M,U,null,t,S),E.push({event:M,listeners:B}))}}if(!(e&7)){e:{if(M=n==="mouseover"||n==="pointerover",L=n==="mouseout"||n==="pointerout",M&&t!==X0&&(U=t.relatedTarget||t.fromElement)&&(oc(U)||U[lo]))break e;if((L||M)&&(M=S.window===S?S:(M=S.ownerDocument)?M.defaultView||M.parentWindow:window,L?(U=t.relatedTarget||t.toElement,L=w,U=U?oc(U):null,U!==null&&(z=Tc(U),U!==z||U.tag!==5&&U.tag!==6)&&(U=null)):(L=null,U=w),L!==U)){if(B=Hb,ee="onMouseLeave",R="onMouseEnter",G="mouse",(n==="pointerout"||n==="pointerover")&&(B=Wb,ee="onPointerLeave",R="onPointerEnter",G="pointer"),z=L==null?M:Gu(L),V=U==null?M:Gu(U),M=new B(ee,G+"leave",L,t,S),M.target=z,M.relatedTarget=V,ee=null,oc(S)===w&&(B=new B(R,G+"enter",U,t,S),B.target=V,B.relatedTarget=z,ee=B),z=ee,L&&U)t:{for(B=L,R=U,G=0,V=B;V;V=hu(V))G++;for(V=0,ee=R;ee;ee=hu(ee))V++;for(;0<G-V;)B=hu(B),G--;for(;0<V-G;)R=hu(R),V--;for(;G--;){if(B===R||R!==null&&B===R.alternate)break t;B=hu(B),R=hu(R)}B=null}else B=null;L!==null&&nw(E,M,L,B,!1),U!==null&&z!==null&&nw(E,z,U,B,!0)}}e:{if(M=w?Gu(w):window,L=M.nodeName&&M.nodeName.toLowerCase(),L==="select"||L==="input"&&M.type==="file")var fe=HR;else if(qb(M))if(ZT)fe=XR;else{fe=WR;var Z=jR}else(L=M.nodeName)&&L.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(fe=$R);if(fe&&(fe=fe(n,w))){qT(E,fe,t,S);break e}Z&&Z(n,M,w),n==="focusout"&&(Z=M._wrapperState)&&Z.controlled&&M.type==="number"&&G0(M,"number",M.value)}switch(Z=w?Gu(w):window,n){case"focusin":(qb(Z)||Z.contentEditable==="true")&&(Bu=Z,ev=w,ff=null);break;case"focusout":ff=ev=Bu=null;break;case"mousedown":tv=!0;break;case"contextmenu":case"mouseup":case"dragend":tv=!1,Qb(E,t,S);break;case"selectionchange":if(YR)break;case"keydown":case"keyup":Qb(E,t,S)}var te;if(ax)e:{switch(n){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Ou?$T(n,t)&&(be="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(be="onCompositionStart");be&&(WT&&t.locale!=="ko"&&(Ou||be!=="onCompositionStart"?be==="onCompositionEnd"&&Ou&&(te=jT()):(rl=S,ix="value"in rl?rl.value:rl.textContent,Ou=!0)),Z=bg(w,be),0<Z.length&&(be=new jb(be,n,null,t,S),E.push({event:be,listeners:Z}),te?be.data=te:(te=XT(t),te!==null&&(be.data=te)))),(te=NR?OR(n,t):BR(n,t))&&(w=bg(w,"onBeforeInput"),0<w.length&&(S=new jb("onBeforeInput","beforeinput",null,t,S),E.push({event:S,listeners:w}),S.data=te))}sE(E,e)})}function Rf(n,e,t){return{instance:n,listener:e,currentTarget:t}}function bg(n,e){for(var t=e+"Capture",i=[];n!==null;){var o=n,h=o.stateNode;o.tag===5&&h!==null&&(o=h,h=Sf(n,t),h!=null&&i.unshift(Rf(n,h,o)),h=Sf(n,e),h!=null&&i.push(Rf(n,h,o))),n=n.return}return i}function hu(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function nw(n,e,t,i,o){for(var h=e._reactName,f=[];t!==null&&t!==i;){var c=t,v=c.alternate,w=c.stateNode;if(v!==null&&v===i)break;c.tag===5&&w!==null&&(c=w,o?(v=Sf(t,h),v!=null&&f.unshift(Rf(t,v,c))):o||(v=Sf(t,h),v!=null&&f.push(Rf(t,v,c)))),t=t.return}f.length!==0&&n.push({event:e,listeners:f})}var eI=/\r\n?/g,tI=/\u0000|\uFFFD/g;function iw(n){return(typeof n=="string"?n:""+n).replace(eI,`
`).replace(tI,"")}function ym(n,e,t){if(e=iw(e),iw(n)!==e&&t)throw Error(Mt(425))}function wg(){}var nv=null,iv=null;function rv(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var sv=typeof setTimeout=="function"?setTimeout:void 0,nI=typeof clearTimeout=="function"?clearTimeout:void 0,rw=typeof Promise=="function"?Promise:void 0,iI=typeof queueMicrotask=="function"?queueMicrotask:typeof rw<"u"?function(n){return rw.resolve(null).then(n).catch(rI)}:sv;function rI(n){setTimeout(function(){throw n})}function ky(n,e){var t=e,i=0;do{var o=t.nextSibling;if(n.removeChild(t),o&&o.nodeType===8)if(t=o.data,t==="/$"){if(i===0){n.removeChild(o),Ef(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=o}while(t);Ef(e)}function ul(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function sw(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var Ch=Math.random().toString(36).slice(2),xa="__reactFiber$"+Ch,If="__reactProps$"+Ch,lo="__reactContainer$"+Ch,av="__reactEvents$"+Ch,sI="__reactListeners$"+Ch,aI="__reactHandles$"+Ch;function oc(n){var e=n[xa];if(e)return e;for(var t=n.parentNode;t;){if(e=t[lo]||t[xa]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=sw(n);n!==null;){if(t=n[xa])return t;n=sw(n)}return e}n=t,t=n.parentNode}return null}function $f(n){return n=n[xa]||n[lo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Gu(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Mt(33))}function Kg(n){return n[If]||null}var ov=[],Hu=-1;function wl(n){return{current:n}}function _i(n){0>Hu||(n.current=ov[Hu],ov[Hu]=null,Hu--)}function hi(n,e){Hu++,ov[Hu]=n.current,n.current=e}var vl={},Ir=wl(vl),es=wl(!1),gc=vl;function dh(n,e){var t=n.type.contextTypes;if(!t)return vl;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var o={},h;for(h in t)o[h]=e[h];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=o),o}function ts(n){return n=n.childContextTypes,n!=null}function Sg(){_i(es),_i(Ir)}function aw(n,e,t){if(Ir.current!==vl)throw Error(Mt(168));hi(Ir,e),hi(es,t)}function oE(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var o in i)if(!(o in e))throw Error(Mt(108,jP(n)||"Unknown",o));return Ei({},t,i)}function Mg(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||vl,gc=Ir.current,hi(Ir,n),hi(es,es.current),!0}function ow(n,e,t){var i=n.stateNode;if(!i)throw Error(Mt(169));t?(n=oE(n,e,gc),i.__reactInternalMemoizedMergedChildContext=n,_i(es),_i(Ir),hi(Ir,n)):_i(es),hi(es,t)}var Qa=null,Jg=!1,Fy=!1;function lE(n){Qa===null?Qa=[n]:Qa.push(n)}function oI(n){Jg=!0,lE(n)}function Sl(){if(!Fy&&Qa!==null){Fy=!0;var n=0,e=Qn;try{var t=Qa;for(Qn=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}Qa=null,Jg=!1}catch(o){throw Qa!==null&&(Qa=Qa.slice(n+1)),DT(Qv,Sl),o}finally{Qn=e,Fy=!1}}return null}var ju=[],Wu=0,Tg=null,Eg=0,Is=[],Ls=0,_c=null,no=1,io="";function nc(n,e){ju[Wu++]=Eg,ju[Wu++]=Tg,Tg=n,Eg=e}function cE(n,e,t){Is[Ls++]=no,Is[Ls++]=io,Is[Ls++]=_c,_c=n;var i=no;n=io;var o=32-ra(i)-1;i&=~(1<<o),t+=1;var h=32-ra(e)+o;if(30<h){var f=o-o%5;h=(i&(1<<f)-1).toString(32),i>>=f,o-=f,no=1<<32-ra(e)+o|t<<o|i,io=h+n}else no=1<<h|t<<o|i,io=n}function lx(n){n.return!==null&&(nc(n,1),cE(n,1,0))}function cx(n){for(;n===Tg;)Tg=ju[--Wu],ju[Wu]=null,Eg=ju[--Wu],ju[Wu]=null;for(;n===_c;)_c=Is[--Ls],Is[Ls]=null,io=Is[--Ls],Is[Ls]=null,no=Is[--Ls],Is[Ls]=null}var _s=null,ms=null,xi=!1,na=null;function uE(n,e){var t=ks(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function lw(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,_s=n,ms=ul(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,_s=n,ms=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=_c!==null?{id:no,overflow:io}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=ks(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,_s=n,ms=null,!0):!1;default:return!1}}function lv(n){return(n.mode&1)!==0&&(n.flags&128)===0}function cv(n){if(xi){var e=ms;if(e){var t=e;if(!lw(n,e)){if(lv(n))throw Error(Mt(418));e=ul(t.nextSibling);var i=_s;e&&lw(n,e)?uE(i,t):(n.flags=n.flags&-4097|2,xi=!1,_s=n)}}else{if(lv(n))throw Error(Mt(418));n.flags=n.flags&-4097|2,xi=!1,_s=n}}}function cw(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;_s=n}function vm(n){if(n!==_s)return!1;if(!xi)return cw(n),xi=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!rv(n.type,n.memoizedProps)),e&&(e=ms)){if(lv(n))throw hE(),Error(Mt(418));for(;e;)uE(n,e),e=ul(e.nextSibling)}if(cw(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Mt(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ms=ul(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ms=null}}else ms=_s?ul(n.stateNode.nextSibling):null;return!0}function hE(){for(var n=ms;n;)n=ul(n.nextSibling)}function fh(){ms=_s=null,xi=!1}function ux(n){na===null?na=[n]:na.push(n)}var lI=po.ReactCurrentBatchConfig;function Qs(n,e){if(n&&n.defaultProps){e=Ei({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var Ag=wl(null),Cg=null,$u=null,hx=null;function dx(){hx=$u=Cg=null}function fx(n){var e=Ag.current;_i(Ag),n._currentValue=e}function uv(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function sh(n,e){Cg=n,hx=$u=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Qr=!0),n.firstContext=null)}function Bs(n){var e=n._currentValue;if(hx!==n)if(n={context:n,memoizedValue:e,next:null},$u===null){if(Cg===null)throw Error(Mt(308));$u=n,Cg.dependencies={lanes:0,firstContext:n}}else $u=$u.next=n;return e}var lc=null;function px(n){lc===null?lc=[n]:lc.push(n)}function dE(n,e,t,i){var o=e.interleaved;return o===null?(t.next=t,px(e)):(t.next=o.next,o.next=t),e.interleaved=t,co(n,i)}function co(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Qo=!1;function mx(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function so(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function hl(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,Wn&2){var o=i.pending;return o===null?e.next=e:(e.next=o.next,o.next=e),i.pending=e,co(n,t)}return o=i.interleaved,o===null?(e.next=e,px(i)):(e.next=o.next,o.next=e),i.interleaved=e,co(n,t)}function rg(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,ex(n,t)}}function uw(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var o=null,h=null;if(t=t.firstBaseUpdate,t!==null){do{var f={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};h===null?o=h=f:h=h.next=f,t=t.next}while(t!==null);h===null?o=h=e:h=h.next=e}else o=h=e;t={baseState:i.baseState,firstBaseUpdate:o,lastBaseUpdate:h,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function Pg(n,e,t,i){var o=n.updateQueue;Qo=!1;var h=o.firstBaseUpdate,f=o.lastBaseUpdate,c=o.shared.pending;if(c!==null){o.shared.pending=null;var v=c,w=v.next;v.next=null,f===null?h=w:f.next=w,f=v;var S=n.alternate;S!==null&&(S=S.updateQueue,c=S.lastBaseUpdate,c!==f&&(c===null?S.firstBaseUpdate=w:c.next=w,S.lastBaseUpdate=v))}if(h!==null){var E=o.baseState;f=0,S=w=v=null,c=h;do{var M=c.lane,L=c.eventTime;if((i&M)===M){S!==null&&(S=S.next={eventTime:L,lane:0,tag:c.tag,payload:c.payload,callback:c.callback,next:null});e:{var U=n,B=c;switch(M=e,L=t,B.tag){case 1:if(U=B.payload,typeof U=="function"){E=U.call(L,E,M);break e}E=U;break e;case 3:U.flags=U.flags&-65537|128;case 0:if(U=B.payload,M=typeof U=="function"?U.call(L,E,M):U,M==null)break e;E=Ei({},E,M);break e;case 2:Qo=!0}}c.callback!==null&&c.lane!==0&&(n.flags|=64,M=o.effects,M===null?o.effects=[c]:M.push(c))}else L={eventTime:L,lane:M,tag:c.tag,payload:c.payload,callback:c.callback,next:null},S===null?(w=S=L,v=E):S=S.next=L,f|=M;if(c=c.next,c===null){if(c=o.shared.pending,c===null)break;M=c,c=M.next,M.next=null,o.lastBaseUpdate=M,o.shared.pending=null}}while(!0);if(S===null&&(v=E),o.baseState=v,o.firstBaseUpdate=w,o.lastBaseUpdate=S,e=o.shared.interleaved,e!==null){o=e;do f|=o.lane,o=o.next;while(o!==e)}else h===null&&(o.shared.lanes=0);vc|=f,n.lanes=f,n.memoizedState=E}}function hw(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],o=i.callback;if(o!==null){if(i.callback=null,i=t,typeof o!="function")throw Error(Mt(191,o));o.call(i)}}}var pE=new dT.Component().refs;function hv(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Ei({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var Qg={isMounted:function(n){return(n=n._reactInternals)?Tc(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=Hr(),o=fl(n),h=so(i,o);h.payload=e,t!=null&&(h.callback=t),e=hl(n,h,o),e!==null&&(sa(e,n,o,i),rg(e,n,o))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=Hr(),o=fl(n),h=so(i,o);h.tag=1,h.payload=e,t!=null&&(h.callback=t),e=hl(n,h,o),e!==null&&(sa(e,n,o,i),rg(e,n,o))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Hr(),i=fl(n),o=so(t,i);o.tag=2,e!=null&&(o.callback=e),e=hl(n,o,i),e!==null&&(sa(e,n,i,t),rg(e,n,i))}};function dw(n,e,t,i,o,h,f){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,h,f):e.prototype&&e.prototype.isPureReactComponent?!Cf(t,i)||!Cf(o,h):!0}function mE(n,e,t){var i=!1,o=vl,h=e.contextType;return typeof h=="object"&&h!==null?h=Bs(h):(o=ts(e)?gc:Ir.current,i=e.contextTypes,h=(i=i!=null)?dh(n,o):vl),e=new e(t,h),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=Qg,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=h),e}function fw(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&Qg.enqueueReplaceState(e,e.state,null)}function dv(n,e,t,i){var o=n.stateNode;o.props=t,o.state=n.memoizedState,o.refs=pE,mx(n);var h=e.contextType;typeof h=="object"&&h!==null?o.context=Bs(h):(h=ts(e)?gc:Ir.current,o.context=dh(n,h)),o.state=n.memoizedState,h=e.getDerivedStateFromProps,typeof h=="function"&&(hv(n,e,h,t),o.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof o.getSnapshotBeforeUpdate=="function"||typeof o.UNSAFE_componentWillMount!="function"&&typeof o.componentWillMount!="function"||(e=o.state,typeof o.componentWillMount=="function"&&o.componentWillMount(),typeof o.UNSAFE_componentWillMount=="function"&&o.UNSAFE_componentWillMount(),e!==o.state&&Qg.enqueueReplaceState(o,o.state,null),Pg(n,t,o,i),o.state=n.memoizedState),typeof o.componentDidMount=="function"&&(n.flags|=4194308)}function Hd(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(Mt(309));var i=t.stateNode}if(!i)throw Error(Mt(147,n));var o=i,h=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===h?e.ref:(e=function(f){var c=o.refs;c===pE&&(c=o.refs={}),f===null?delete c[h]:c[h]=f},e._stringRef=h,e)}if(typeof n!="string")throw Error(Mt(284));if(!t._owner)throw Error(Mt(290,n))}return n}function xm(n,e){throw n=Object.prototype.toString.call(e),Error(Mt(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function pw(n){var e=n._init;return e(n._payload)}function gE(n){function e(R,G){if(n){var V=R.deletions;V===null?(R.deletions=[G],R.flags|=16):V.push(G)}}function t(R,G){if(!n)return null;for(;G!==null;)e(R,G),G=G.sibling;return null}function i(R,G){for(R=new Map;G!==null;)G.key!==null?R.set(G.key,G):R.set(G.index,G),G=G.sibling;return R}function o(R,G){return R=pl(R,G),R.index=0,R.sibling=null,R}function h(R,G,V){return R.index=V,n?(V=R.alternate,V!==null?(V=V.index,V<G?(R.flags|=2,G):V):(R.flags|=2,G)):(R.flags|=1048576,G)}function f(R){return n&&R.alternate===null&&(R.flags|=2),R}function c(R,G,V,ee){return G===null||G.tag!==6?(G=Hy(V,R.mode,ee),G.return=R,G):(G=o(G,V),G.return=R,G)}function v(R,G,V,ee){var fe=V.type;return fe===Nu?S(R,G,V.props.children,ee,V.key):G!==null&&(G.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===Jo&&pw(fe)===G.type)?(ee=o(G,V.props),ee.ref=Hd(R,G,V),ee.return=R,ee):(ee=ug(V.type,V.key,V.props,null,R.mode,ee),ee.ref=Hd(R,G,V),ee.return=R,ee)}function w(R,G,V,ee){return G===null||G.tag!==4||G.stateNode.containerInfo!==V.containerInfo||G.stateNode.implementation!==V.implementation?(G=jy(V,R.mode,ee),G.return=R,G):(G=o(G,V.children||[]),G.return=R,G)}function S(R,G,V,ee,fe){return G===null||G.tag!==7?(G=mc(V,R.mode,ee,fe),G.return=R,G):(G=o(G,V),G.return=R,G)}function E(R,G,V){if(typeof G=="string"&&G!==""||typeof G=="number")return G=Hy(""+G,R.mode,V),G.return=R,G;if(typeof G=="object"&&G!==null){switch(G.$$typeof){case cm:return V=ug(G.type,G.key,G.props,null,R.mode,V),V.ref=Hd(R,null,G),V.return=R,V;case Uu:return G=jy(G,R.mode,V),G.return=R,G;case Jo:var ee=G._init;return E(R,ee(G._payload),V)}if(rf(G)||Nd(G))return G=mc(G,R.mode,V,null),G.return=R,G;xm(R,G)}return null}function M(R,G,V,ee){var fe=G!==null?G.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return fe!==null?null:c(R,G,""+V,ee);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case cm:return V.key===fe?v(R,G,V,ee):null;case Uu:return V.key===fe?w(R,G,V,ee):null;case Jo:return fe=V._init,M(R,G,fe(V._payload),ee)}if(rf(V)||Nd(V))return fe!==null?null:S(R,G,V,ee,null);xm(R,V)}return null}function L(R,G,V,ee,fe){if(typeof ee=="string"&&ee!==""||typeof ee=="number")return R=R.get(V)||null,c(G,R,""+ee,fe);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case cm:return R=R.get(ee.key===null?V:ee.key)||null,v(G,R,ee,fe);case Uu:return R=R.get(ee.key===null?V:ee.key)||null,w(G,R,ee,fe);case Jo:var Z=ee._init;return L(R,G,V,Z(ee._payload),fe)}if(rf(ee)||Nd(ee))return R=R.get(V)||null,S(G,R,ee,fe,null);xm(G,ee)}return null}function U(R,G,V,ee){for(var fe=null,Z=null,te=G,be=G=0,ae=null;te!==null&&be<V.length;be++){te.index>be?(ae=te,te=null):ae=te.sibling;var K=M(R,te,V[be],ee);if(K===null){te===null&&(te=ae);break}n&&te&&K.alternate===null&&e(R,te),G=h(K,G,be),Z===null?fe=K:Z.sibling=K,Z=K,te=ae}if(be===V.length)return t(R,te),xi&&nc(R,be),fe;if(te===null){for(;be<V.length;be++)te=E(R,V[be],ee),te!==null&&(G=h(te,G,be),Z===null?fe=te:Z.sibling=te,Z=te);return xi&&nc(R,be),fe}for(te=i(R,te);be<V.length;be++)ae=L(te,R,be,V[be],ee),ae!==null&&(n&&ae.alternate!==null&&te.delete(ae.key===null?be:ae.key),G=h(ae,G,be),Z===null?fe=ae:Z.sibling=ae,Z=ae);return n&&te.forEach(function(Pe){return e(R,Pe)}),xi&&nc(R,be),fe}function B(R,G,V,ee){var fe=Nd(V);if(typeof fe!="function")throw Error(Mt(150));if(V=fe.call(V),V==null)throw Error(Mt(151));for(var Z=fe=null,te=G,be=G=0,ae=null,K=V.next();te!==null&&!K.done;be++,K=V.next()){te.index>be?(ae=te,te=null):ae=te.sibling;var Pe=M(R,te,K.value,ee);if(Pe===null){te===null&&(te=ae);break}n&&te&&Pe.alternate===null&&e(R,te),G=h(Pe,G,be),Z===null?fe=Pe:Z.sibling=Pe,Z=Pe,te=ae}if(K.done)return t(R,te),xi&&nc(R,be),fe;if(te===null){for(;!K.done;be++,K=V.next())K=E(R,K.value,ee),K!==null&&(G=h(K,G,be),Z===null?fe=K:Z.sibling=K,Z=K);return xi&&nc(R,be),fe}for(te=i(R,te);!K.done;be++,K=V.next())K=L(te,R,be,K.value,ee),K!==null&&(n&&K.alternate!==null&&te.delete(K.key===null?be:K.key),G=h(K,G,be),Z===null?fe=K:Z.sibling=K,Z=K);return n&&te.forEach(function(ke){return e(R,ke)}),xi&&nc(R,be),fe}function z(R,G,V,ee){if(typeof V=="object"&&V!==null&&V.type===Nu&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case cm:e:{for(var fe=V.key,Z=G;Z!==null;){if(Z.key===fe){if(fe=V.type,fe===Nu){if(Z.tag===7){t(R,Z.sibling),G=o(Z,V.props.children),G.return=R,R=G;break e}}else if(Z.elementType===fe||typeof fe=="object"&&fe!==null&&fe.$$typeof===Jo&&pw(fe)===Z.type){t(R,Z.sibling),G=o(Z,V.props),G.ref=Hd(R,Z,V),G.return=R,R=G;break e}t(R,Z);break}else e(R,Z);Z=Z.sibling}V.type===Nu?(G=mc(V.props.children,R.mode,ee,V.key),G.return=R,R=G):(ee=ug(V.type,V.key,V.props,null,R.mode,ee),ee.ref=Hd(R,G,V),ee.return=R,R=ee)}return f(R);case Uu:e:{for(Z=V.key;G!==null;){if(G.key===Z)if(G.tag===4&&G.stateNode.containerInfo===V.containerInfo&&G.stateNode.implementation===V.implementation){t(R,G.sibling),G=o(G,V.children||[]),G.return=R,R=G;break e}else{t(R,G);break}else e(R,G);G=G.sibling}G=jy(V,R.mode,ee),G.return=R,R=G}return f(R);case Jo:return Z=V._init,z(R,G,Z(V._payload),ee)}if(rf(V))return U(R,G,V,ee);if(Nd(V))return B(R,G,V,ee);xm(R,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,G!==null&&G.tag===6?(t(R,G.sibling),G=o(G,V),G.return=R,R=G):(t(R,G),G=Hy(V,R.mode,ee),G.return=R,R=G),f(R)):t(R,G)}return z}var ph=gE(!0),_E=gE(!1),Xf={},Ma=wl(Xf),Lf=wl(Xf),Df=wl(Xf);function cc(n){if(n===Xf)throw Error(Mt(174));return n}function gx(n,e){switch(hi(Df,e),hi(Lf,n),hi(Ma,Xf),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:j0(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=j0(e,n)}_i(Ma),hi(Ma,e)}function mh(){_i(Ma),_i(Lf),_i(Df)}function yE(n){cc(Df.current);var e=cc(Ma.current),t=j0(e,n.type);e!==t&&(hi(Lf,n),hi(Ma,t))}function _x(n){Lf.current===n&&(_i(Ma),_i(Lf))}var Mi=wl(0);function Rg(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var Uy=[];function yx(){for(var n=0;n<Uy.length;n++)Uy[n]._workInProgressVersionPrimary=null;Uy.length=0}var sg=po.ReactCurrentDispatcher,Ny=po.ReactCurrentBatchConfig,yc=0,Ti=null,qi=null,rr=null,Ig=!1,pf=!1,zf=0,cI=0;function Mr(){throw Error(Mt(321))}function vx(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!aa(n[t],e[t]))return!1;return!0}function xx(n,e,t,i,o,h){if(yc=h,Ti=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,sg.current=n===null||n.memoizedState===null?fI:pI,n=t(i,o),pf){h=0;do{if(pf=!1,zf=0,25<=h)throw Error(Mt(301));h+=1,rr=qi=null,e.updateQueue=null,sg.current=mI,n=t(i,o)}while(pf)}if(sg.current=Lg,e=qi!==null&&qi.next!==null,yc=0,rr=qi=Ti=null,Ig=!1,e)throw Error(Mt(300));return n}function bx(){var n=zf!==0;return zf=0,n}function _a(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rr===null?Ti.memoizedState=rr=n:rr=rr.next=n,rr}function Vs(){if(qi===null){var n=Ti.alternate;n=n!==null?n.memoizedState:null}else n=qi.next;var e=rr===null?Ti.memoizedState:rr.next;if(e!==null)rr=e,qi=n;else{if(n===null)throw Error(Mt(310));qi=n,n={memoizedState:qi.memoizedState,baseState:qi.baseState,baseQueue:qi.baseQueue,queue:qi.queue,next:null},rr===null?Ti.memoizedState=rr=n:rr=rr.next=n}return rr}function kf(n,e){return typeof e=="function"?e(n):e}function Oy(n){var e=Vs(),t=e.queue;if(t===null)throw Error(Mt(311));t.lastRenderedReducer=n;var i=qi,o=i.baseQueue,h=t.pending;if(h!==null){if(o!==null){var f=o.next;o.next=h.next,h.next=f}i.baseQueue=o=h,t.pending=null}if(o!==null){h=o.next,i=i.baseState;var c=f=null,v=null,w=h;do{var S=w.lane;if((yc&S)===S)v!==null&&(v=v.next={lane:0,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null}),i=w.hasEagerState?w.eagerState:n(i,w.action);else{var E={lane:S,action:w.action,hasEagerState:w.hasEagerState,eagerState:w.eagerState,next:null};v===null?(c=v=E,f=i):v=v.next=E,Ti.lanes|=S,vc|=S}w=w.next}while(w!==null&&w!==h);v===null?f=i:v.next=c,aa(i,e.memoizedState)||(Qr=!0),e.memoizedState=i,e.baseState=f,e.baseQueue=v,t.lastRenderedState=i}if(n=t.interleaved,n!==null){o=n;do h=o.lane,Ti.lanes|=h,vc|=h,o=o.next;while(o!==n)}else o===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function By(n){var e=Vs(),t=e.queue;if(t===null)throw Error(Mt(311));t.lastRenderedReducer=n;var i=t.dispatch,o=t.pending,h=e.memoizedState;if(o!==null){t.pending=null;var f=o=o.next;do h=n(h,f.action),f=f.next;while(f!==o);aa(h,e.memoizedState)||(Qr=!0),e.memoizedState=h,e.baseQueue===null&&(e.baseState=h),t.lastRenderedState=h}return[h,i]}function vE(){}function xE(n,e){var t=Ti,i=Vs(),o=e(),h=!aa(i.memoizedState,o);if(h&&(i.memoizedState=o,Qr=!0),i=i.queue,wx(SE.bind(null,t,i,n),[n]),i.getSnapshot!==e||h||rr!==null&&rr.memoizedState.tag&1){if(t.flags|=2048,Ff(9,wE.bind(null,t,i,o,e),void 0,null),sr===null)throw Error(Mt(349));yc&30||bE(t,e,o)}return o}function bE(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Ti.updateQueue,e===null?(e={lastEffect:null,stores:null},Ti.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function wE(n,e,t,i){e.value=t,e.getSnapshot=i,ME(e)&&TE(n)}function SE(n,e,t){return t(function(){ME(e)&&TE(n)})}function ME(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!aa(n,t)}catch{return!0}}function TE(n){var e=co(n,1);e!==null&&sa(e,n,1,-1)}function mw(n){var e=_a();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:kf,lastRenderedState:n},e.queue=n,n=n.dispatch=dI.bind(null,Ti,n),[e.memoizedState,n]}function Ff(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Ti.updateQueue,e===null?(e={lastEffect:null,stores:null},Ti.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function EE(){return Vs().memoizedState}function ag(n,e,t,i){var o=_a();Ti.flags|=n,o.memoizedState=Ff(1|e,t,void 0,i===void 0?null:i)}function e_(n,e,t,i){var o=Vs();i=i===void 0?null:i;var h=void 0;if(qi!==null){var f=qi.memoizedState;if(h=f.destroy,i!==null&&vx(i,f.deps)){o.memoizedState=Ff(e,t,h,i);return}}Ti.flags|=n,o.memoizedState=Ff(1|e,t,h,i)}function gw(n,e){return ag(8390656,8,n,e)}function wx(n,e){return e_(2048,8,n,e)}function AE(n,e){return e_(4,2,n,e)}function CE(n,e){return e_(4,4,n,e)}function PE(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function RE(n,e,t){return t=t!=null?t.concat([n]):null,e_(4,4,PE.bind(null,e,n),t)}function Sx(){}function IE(n,e){var t=Vs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&vx(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function LE(n,e){var t=Vs();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&vx(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function DE(n,e,t){return yc&21?(aa(t,e)||(t=FT(),Ti.lanes|=t,vc|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Qr=!0),n.memoizedState=t)}function uI(n,e){var t=Qn;Qn=t!==0&&4>t?t:4,n(!0);var i=Ny.transition;Ny.transition={};try{n(!1),e()}finally{Qn=t,Ny.transition=i}}function zE(){return Vs().memoizedState}function hI(n,e,t){var i=fl(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},kE(n))FE(e,t);else if(t=dE(n,e,t,i),t!==null){var o=Hr();sa(t,n,i,o),UE(t,e,i)}}function dI(n,e,t){var i=fl(n),o={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(kE(n))FE(e,o);else{var h=n.alternate;if(n.lanes===0&&(h===null||h.lanes===0)&&(h=e.lastRenderedReducer,h!==null))try{var f=e.lastRenderedState,c=h(f,t);if(o.hasEagerState=!0,o.eagerState=c,aa(c,f)){var v=e.interleaved;v===null?(o.next=o,px(e)):(o.next=v.next,v.next=o),e.interleaved=o;return}}catch{}finally{}t=dE(n,e,o,i),t!==null&&(o=Hr(),sa(t,n,i,o),UE(t,e,i))}}function kE(n){var e=n.alternate;return n===Ti||e!==null&&e===Ti}function FE(n,e){pf=Ig=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function UE(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,ex(n,t)}}var Lg={readContext:Bs,useCallback:Mr,useContext:Mr,useEffect:Mr,useImperativeHandle:Mr,useInsertionEffect:Mr,useLayoutEffect:Mr,useMemo:Mr,useReducer:Mr,useRef:Mr,useState:Mr,useDebugValue:Mr,useDeferredValue:Mr,useTransition:Mr,useMutableSource:Mr,useSyncExternalStore:Mr,useId:Mr,unstable_isNewReconciler:!1},fI={readContext:Bs,useCallback:function(n,e){return _a().memoizedState=[n,e===void 0?null:e],n},useContext:Bs,useEffect:gw,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,ag(4194308,4,PE.bind(null,e,n),t)},useLayoutEffect:function(n,e){return ag(4194308,4,n,e)},useInsertionEffect:function(n,e){return ag(4,2,n,e)},useMemo:function(n,e){var t=_a();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=_a();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=hI.bind(null,Ti,n),[i.memoizedState,n]},useRef:function(n){var e=_a();return n={current:n},e.memoizedState=n},useState:mw,useDebugValue:Sx,useDeferredValue:function(n){return _a().memoizedState=n},useTransition:function(){var n=mw(!1),e=n[0];return n=uI.bind(null,n[1]),_a().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Ti,o=_a();if(xi){if(t===void 0)throw Error(Mt(407));t=t()}else{if(t=e(),sr===null)throw Error(Mt(349));yc&30||bE(i,e,t)}o.memoizedState=t;var h={value:t,getSnapshot:e};return o.queue=h,gw(SE.bind(null,i,h,n),[n]),i.flags|=2048,Ff(9,wE.bind(null,i,h,t,e),void 0,null),t},useId:function(){var n=_a(),e=sr.identifierPrefix;if(xi){var t=io,i=no;t=(i&~(1<<32-ra(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=zf++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=cI++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},pI={readContext:Bs,useCallback:IE,useContext:Bs,useEffect:wx,useImperativeHandle:RE,useInsertionEffect:AE,useLayoutEffect:CE,useMemo:LE,useReducer:Oy,useRef:EE,useState:function(){return Oy(kf)},useDebugValue:Sx,useDeferredValue:function(n){var e=Vs();return DE(e,qi.memoizedState,n)},useTransition:function(){var n=Oy(kf)[0],e=Vs().memoizedState;return[n,e]},useMutableSource:vE,useSyncExternalStore:xE,useId:zE,unstable_isNewReconciler:!1},mI={readContext:Bs,useCallback:IE,useContext:Bs,useEffect:wx,useImperativeHandle:RE,useInsertionEffect:AE,useLayoutEffect:CE,useMemo:LE,useReducer:By,useRef:EE,useState:function(){return By(kf)},useDebugValue:Sx,useDeferredValue:function(n){var e=Vs();return qi===null?e.memoizedState=n:DE(e,qi.memoizedState,n)},useTransition:function(){var n=By(kf)[0],e=Vs().memoizedState;return[n,e]},useMutableSource:vE,useSyncExternalStore:xE,useId:zE,unstable_isNewReconciler:!1};function gh(n,e){try{var t="",i=e;do t+=HP(i),i=i.return;while(i);var o=t}catch(h){o=`
Error generating stack: `+h.message+`
`+h.stack}return{value:n,source:e,stack:o,digest:null}}function Vy(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function fv(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var gI=typeof WeakMap=="function"?WeakMap:Map;function NE(n,e,t){t=so(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){zg||(zg=!0,Sv=i),fv(n,e)},t}function OE(n,e,t){t=so(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var o=e.value;t.payload=function(){return i(o)},t.callback=function(){fv(n,e)}}var h=n.stateNode;return h!==null&&typeof h.componentDidCatch=="function"&&(t.callback=function(){fv(n,e),typeof i!="function"&&(dl===null?dl=new Set([this]):dl.add(this));var f=e.stack;this.componentDidCatch(e.value,{componentStack:f!==null?f:""})}),t}function _w(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new gI;var o=new Set;i.set(e,o)}else o=i.get(e),o===void 0&&(o=new Set,i.set(e,o));o.has(t)||(o.add(t),n=RI.bind(null,n,e,t),e.then(n,n))}function yw(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function vw(n,e,t,i,o){return n.mode&1?(n.flags|=65536,n.lanes=o,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=so(-1,1),e.tag=2,hl(t,e,1))),t.lanes|=1),n)}var _I=po.ReactCurrentOwner,Qr=!1;function Gr(n,e,t,i){e.child=n===null?_E(e,null,t,i):ph(e,n.child,t,i)}function xw(n,e,t,i,o){t=t.render;var h=e.ref;return sh(e,o),i=xx(n,e,t,i,h,o),t=bx(),n!==null&&!Qr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~o,uo(n,e,o)):(xi&&t&&lx(e),e.flags|=1,Gr(n,e,i,o),e.child)}function bw(n,e,t,i,o){if(n===null){var h=t.type;return typeof h=="function"&&!Ix(h)&&h.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=h,BE(n,e,h,i,o)):(n=ug(t.type,null,i,e,e.mode,o),n.ref=e.ref,n.return=e,e.child=n)}if(h=n.child,!(n.lanes&o)){var f=h.memoizedProps;if(t=t.compare,t=t!==null?t:Cf,t(f,i)&&n.ref===e.ref)return uo(n,e,o)}return e.flags|=1,n=pl(h,i),n.ref=e.ref,n.return=e,e.child=n}function BE(n,e,t,i,o){if(n!==null){var h=n.memoizedProps;if(Cf(h,i)&&n.ref===e.ref)if(Qr=!1,e.pendingProps=i=h,(n.lanes&o)!==0)n.flags&131072&&(Qr=!0);else return e.lanes=n.lanes,uo(n,e,o)}return pv(n,e,t,i,o)}function VE(n,e,t){var i=e.pendingProps,o=i.children,h=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},hi(qu,ps),ps|=t;else{if(!(t&1073741824))return n=h!==null?h.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,hi(qu,ps),ps|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=h!==null?h.baseLanes:t,hi(qu,ps),ps|=i}else h!==null?(i=h.baseLanes|t,e.memoizedState=null):i=t,hi(qu,ps),ps|=i;return Gr(n,e,o,t),e.child}function GE(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function pv(n,e,t,i,o){var h=ts(t)?gc:Ir.current;return h=dh(e,h),sh(e,o),t=xx(n,e,t,i,h,o),i=bx(),n!==null&&!Qr?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~o,uo(n,e,o)):(xi&&i&&lx(e),e.flags|=1,Gr(n,e,t,o),e.child)}function ww(n,e,t,i,o){if(ts(t)){var h=!0;Mg(e)}else h=!1;if(sh(e,o),e.stateNode===null)og(n,e),mE(e,t,i),dv(e,t,i,o),i=!0;else if(n===null){var f=e.stateNode,c=e.memoizedProps;f.props=c;var v=f.context,w=t.contextType;typeof w=="object"&&w!==null?w=Bs(w):(w=ts(t)?gc:Ir.current,w=dh(e,w));var S=t.getDerivedStateFromProps,E=typeof S=="function"||typeof f.getSnapshotBeforeUpdate=="function";E||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(c!==i||v!==w)&&fw(e,f,i,w),Qo=!1;var M=e.memoizedState;f.state=M,Pg(e,i,f,o),v=e.memoizedState,c!==i||M!==v||es.current||Qo?(typeof S=="function"&&(hv(e,t,S,i),v=e.memoizedState),(c=Qo||dw(e,t,c,i,M,v,w))?(E||typeof f.UNSAFE_componentWillMount!="function"&&typeof f.componentWillMount!="function"||(typeof f.componentWillMount=="function"&&f.componentWillMount(),typeof f.UNSAFE_componentWillMount=="function"&&f.UNSAFE_componentWillMount()),typeof f.componentDidMount=="function"&&(e.flags|=4194308)):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=v),f.props=i,f.state=v,f.context=w,i=c):(typeof f.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{f=e.stateNode,fE(n,e),c=e.memoizedProps,w=e.type===e.elementType?c:Qs(e.type,c),f.props=w,E=e.pendingProps,M=f.context,v=t.contextType,typeof v=="object"&&v!==null?v=Bs(v):(v=ts(t)?gc:Ir.current,v=dh(e,v));var L=t.getDerivedStateFromProps;(S=typeof L=="function"||typeof f.getSnapshotBeforeUpdate=="function")||typeof f.UNSAFE_componentWillReceiveProps!="function"&&typeof f.componentWillReceiveProps!="function"||(c!==E||M!==v)&&fw(e,f,i,v),Qo=!1,M=e.memoizedState,f.state=M,Pg(e,i,f,o);var U=e.memoizedState;c!==E||M!==U||es.current||Qo?(typeof L=="function"&&(hv(e,t,L,i),U=e.memoizedState),(w=Qo||dw(e,t,w,i,M,U,v)||!1)?(S||typeof f.UNSAFE_componentWillUpdate!="function"&&typeof f.componentWillUpdate!="function"||(typeof f.componentWillUpdate=="function"&&f.componentWillUpdate(i,U,v),typeof f.UNSAFE_componentWillUpdate=="function"&&f.UNSAFE_componentWillUpdate(i,U,v)),typeof f.componentDidUpdate=="function"&&(e.flags|=4),typeof f.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof f.componentDidUpdate!="function"||c===n.memoizedProps&&M===n.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&M===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=U),f.props=i,f.state=U,f.context=v,i=w):(typeof f.componentDidUpdate!="function"||c===n.memoizedProps&&M===n.memoizedState||(e.flags|=4),typeof f.getSnapshotBeforeUpdate!="function"||c===n.memoizedProps&&M===n.memoizedState||(e.flags|=1024),i=!1)}return mv(n,e,t,i,h,o)}function mv(n,e,t,i,o,h){GE(n,e);var f=(e.flags&128)!==0;if(!i&&!f)return o&&ow(e,t,!1),uo(n,e,h);i=e.stateNode,_I.current=e;var c=f&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&f?(e.child=ph(e,n.child,null,h),e.child=ph(e,null,c,h)):Gr(n,e,c,h),e.memoizedState=i.state,o&&ow(e,t,!0),e.child}function HE(n){var e=n.stateNode;e.pendingContext?aw(n,e.pendingContext,e.pendingContext!==e.context):e.context&&aw(n,e.context,!1),gx(n,e.containerInfo)}function Sw(n,e,t,i,o){return fh(),ux(o),e.flags|=256,Gr(n,e,t,i),e.child}var gv={dehydrated:null,treeContext:null,retryLane:0};function _v(n){return{baseLanes:n,cachePool:null,transitions:null}}function jE(n,e,t){var i=e.pendingProps,o=Mi.current,h=!1,f=(e.flags&128)!==0,c;if((c=f)||(c=n!==null&&n.memoizedState===null?!1:(o&2)!==0),c?(h=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(o|=1),hi(Mi,o&1),n===null)return cv(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(f=i.children,n=i.fallback,h?(i=e.mode,h=e.child,f={mode:"hidden",children:f},!(i&1)&&h!==null?(h.childLanes=0,h.pendingProps=f):h=i_(f,i,0,null),n=mc(n,i,t,null),h.return=e,n.return=e,h.sibling=n,e.child=h,e.child.memoizedState=_v(t),e.memoizedState=gv,n):Mx(e,f));if(o=n.memoizedState,o!==null&&(c=o.dehydrated,c!==null))return yI(n,e,f,i,c,o,t);if(h){h=i.fallback,f=e.mode,o=n.child,c=o.sibling;var v={mode:"hidden",children:i.children};return!(f&1)&&e.child!==o?(i=e.child,i.childLanes=0,i.pendingProps=v,e.deletions=null):(i=pl(o,v),i.subtreeFlags=o.subtreeFlags&14680064),c!==null?h=pl(c,h):(h=mc(h,f,t,null),h.flags|=2),h.return=e,i.return=e,i.sibling=h,e.child=i,i=h,h=e.child,f=n.child.memoizedState,f=f===null?_v(t):{baseLanes:f.baseLanes|t,cachePool:null,transitions:f.transitions},h.memoizedState=f,h.childLanes=n.childLanes&~t,e.memoizedState=gv,i}return h=n.child,n=h.sibling,i=pl(h,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function Mx(n,e){return e=i_({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function bm(n,e,t,i){return i!==null&&ux(i),ph(e,n.child,null,t),n=Mx(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function yI(n,e,t,i,o,h,f){if(t)return e.flags&256?(e.flags&=-257,i=Vy(Error(Mt(422))),bm(n,e,f,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(h=i.fallback,o=e.mode,i=i_({mode:"visible",children:i.children},o,0,null),h=mc(h,o,f,null),h.flags|=2,i.return=e,h.return=e,i.sibling=h,e.child=i,e.mode&1&&ph(e,n.child,null,f),e.child.memoizedState=_v(f),e.memoizedState=gv,h);if(!(e.mode&1))return bm(n,e,f,null);if(o.data==="$!"){if(i=o.nextSibling&&o.nextSibling.dataset,i)var c=i.dgst;return i=c,h=Error(Mt(419)),i=Vy(h,i,void 0),bm(n,e,f,i)}if(c=(f&n.childLanes)!==0,Qr||c){if(i=sr,i!==null){switch(f&-f){case 4:o=2;break;case 16:o=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:o=32;break;case 536870912:o=268435456;break;default:o=0}o=o&(i.suspendedLanes|f)?0:o,o!==0&&o!==h.retryLane&&(h.retryLane=o,co(n,o),sa(i,n,o,-1))}return Rx(),i=Vy(Error(Mt(421))),bm(n,e,f,i)}return o.data==="$?"?(e.flags|=128,e.child=n.child,e=II.bind(null,n),o._reactRetry=e,null):(n=h.treeContext,ms=ul(o.nextSibling),_s=e,xi=!0,na=null,n!==null&&(Is[Ls++]=no,Is[Ls++]=io,Is[Ls++]=_c,no=n.id,io=n.overflow,_c=e),e=Mx(e,i.children),e.flags|=4096,e)}function Mw(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),uv(n.return,e,t)}function Gy(n,e,t,i,o){var h=n.memoizedState;h===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:o}:(h.isBackwards=e,h.rendering=null,h.renderingStartTime=0,h.last=i,h.tail=t,h.tailMode=o)}function WE(n,e,t){var i=e.pendingProps,o=i.revealOrder,h=i.tail;if(Gr(n,e,i.children,t),i=Mi.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Mw(n,t,e);else if(n.tag===19)Mw(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(hi(Mi,i),!(e.mode&1))e.memoizedState=null;else switch(o){case"forwards":for(t=e.child,o=null;t!==null;)n=t.alternate,n!==null&&Rg(n)===null&&(o=t),t=t.sibling;t=o,t===null?(o=e.child,e.child=null):(o=t.sibling,t.sibling=null),Gy(e,!1,o,t,h);break;case"backwards":for(t=null,o=e.child,e.child=null;o!==null;){if(n=o.alternate,n!==null&&Rg(n)===null){e.child=o;break}n=o.sibling,o.sibling=t,t=o,o=n}Gy(e,!0,t,null,h);break;case"together":Gy(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function og(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function uo(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),vc|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(Mt(153));if(e.child!==null){for(n=e.child,t=pl(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=pl(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function vI(n,e,t){switch(e.tag){case 3:HE(e),fh();break;case 5:yE(e);break;case 1:ts(e.type)&&Mg(e);break;case 4:gx(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,o=e.memoizedProps.value;hi(Ag,i._currentValue),i._currentValue=o;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(hi(Mi,Mi.current&1),e.flags|=128,null):t&e.child.childLanes?jE(n,e,t):(hi(Mi,Mi.current&1),n=uo(n,e,t),n!==null?n.sibling:null);hi(Mi,Mi.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return WE(n,e,t);e.flags|=128}if(o=e.memoizedState,o!==null&&(o.rendering=null,o.tail=null,o.lastEffect=null),hi(Mi,Mi.current),i)break;return null;case 22:case 23:return e.lanes=0,VE(n,e,t)}return uo(n,e,t)}var $E,yv,XE,qE;$E=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};yv=function(){};XE=function(n,e,t,i){var o=n.memoizedProps;if(o!==i){n=e.stateNode,cc(Ma.current);var h=null;switch(t){case"input":o=B0(n,o),i=B0(n,i),h=[];break;case"select":o=Ei({},o,{value:void 0}),i=Ei({},i,{value:void 0}),h=[];break;case"textarea":o=H0(n,o),i=H0(n,i),h=[];break;default:typeof o.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=wg)}W0(t,i);var f;t=null;for(w in o)if(!i.hasOwnProperty(w)&&o.hasOwnProperty(w)&&o[w]!=null)if(w==="style"){var c=o[w];for(f in c)c.hasOwnProperty(f)&&(t||(t={}),t[f]="")}else w!=="dangerouslySetInnerHTML"&&w!=="children"&&w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(bf.hasOwnProperty(w)?h||(h=[]):(h=h||[]).push(w,null));for(w in i){var v=i[w];if(c=o!=null?o[w]:void 0,i.hasOwnProperty(w)&&v!==c&&(v!=null||c!=null))if(w==="style")if(c){for(f in c)!c.hasOwnProperty(f)||v&&v.hasOwnProperty(f)||(t||(t={}),t[f]="");for(f in v)v.hasOwnProperty(f)&&c[f]!==v[f]&&(t||(t={}),t[f]=v[f])}else t||(h||(h=[]),h.push(w,t)),t=v;else w==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,c=c?c.__html:void 0,v!=null&&c!==v&&(h=h||[]).push(w,v)):w==="children"?typeof v!="string"&&typeof v!="number"||(h=h||[]).push(w,""+v):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&(bf.hasOwnProperty(w)?(v!=null&&w==="onScroll"&&mi("scroll",n),h||c===v||(h=[])):(h=h||[]).push(w,v))}t&&(h=h||[]).push("style",t);var w=h;(e.updateQueue=w)&&(e.flags|=4)}};qE=function(n,e,t,i){t!==i&&(e.flags|=4)};function jd(n,e){if(!xi)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Tr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var o=n.child;o!==null;)t|=o.lanes|o.childLanes,i|=o.subtreeFlags&14680064,i|=o.flags&14680064,o.return=n,o=o.sibling;else for(o=n.child;o!==null;)t|=o.lanes|o.childLanes,i|=o.subtreeFlags,i|=o.flags,o.return=n,o=o.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function xI(n,e,t){var i=e.pendingProps;switch(cx(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tr(e),null;case 1:return ts(e.type)&&Sg(),Tr(e),null;case 3:return i=e.stateNode,mh(),_i(es),_i(Ir),yx(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(vm(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,na!==null&&(Ev(na),na=null))),yv(n,e),Tr(e),null;case 5:_x(e);var o=cc(Df.current);if(t=e.type,n!==null&&e.stateNode!=null)XE(n,e,t,i,o),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(Mt(166));return Tr(e),null}if(n=cc(Ma.current),vm(e)){i=e.stateNode,t=e.type;var h=e.memoizedProps;switch(i[xa]=e,i[If]=h,n=(e.mode&1)!==0,t){case"dialog":mi("cancel",i),mi("close",i);break;case"iframe":case"object":case"embed":mi("load",i);break;case"video":case"audio":for(o=0;o<af.length;o++)mi(af[o],i);break;case"source":mi("error",i);break;case"img":case"image":case"link":mi("error",i),mi("load",i);break;case"details":mi("toggle",i);break;case"input":Db(i,h),mi("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!h.multiple},mi("invalid",i);break;case"textarea":kb(i,h),mi("invalid",i)}W0(t,h),o=null;for(var f in h)if(h.hasOwnProperty(f)){var c=h[f];f==="children"?typeof c=="string"?i.textContent!==c&&(h.suppressHydrationWarning!==!0&&ym(i.textContent,c,n),o=["children",c]):typeof c=="number"&&i.textContent!==""+c&&(h.suppressHydrationWarning!==!0&&ym(i.textContent,c,n),o=["children",""+c]):bf.hasOwnProperty(f)&&c!=null&&f==="onScroll"&&mi("scroll",i)}switch(t){case"input":um(i),zb(i,h,!0);break;case"textarea":um(i),Fb(i);break;case"select":case"option":break;default:typeof h.onClick=="function"&&(i.onclick=wg)}i=o,e.updateQueue=i,i!==null&&(e.flags|=4)}else{f=o.nodeType===9?o:o.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=bT(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=f.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=f.createElement(t,{is:i.is}):(n=f.createElement(t),t==="select"&&(f=n,i.multiple?f.multiple=!0:i.size&&(f.size=i.size))):n=f.createElementNS(n,t),n[xa]=e,n[If]=i,$E(n,e,!1,!1),e.stateNode=n;e:{switch(f=$0(t,i),t){case"dialog":mi("cancel",n),mi("close",n),o=i;break;case"iframe":case"object":case"embed":mi("load",n),o=i;break;case"video":case"audio":for(o=0;o<af.length;o++)mi(af[o],n);o=i;break;case"source":mi("error",n),o=i;break;case"img":case"image":case"link":mi("error",n),mi("load",n),o=i;break;case"details":mi("toggle",n),o=i;break;case"input":Db(n,i),o=B0(n,i),mi("invalid",n);break;case"option":o=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},o=Ei({},i,{value:void 0}),mi("invalid",n);break;case"textarea":kb(n,i),o=H0(n,i),mi("invalid",n);break;default:o=i}W0(t,o),c=o;for(h in c)if(c.hasOwnProperty(h)){var v=c[h];h==="style"?MT(n,v):h==="dangerouslySetInnerHTML"?(v=v?v.__html:void 0,v!=null&&wT(n,v)):h==="children"?typeof v=="string"?(t!=="textarea"||v!=="")&&wf(n,v):typeof v=="number"&&wf(n,""+v):h!=="suppressContentEditableWarning"&&h!=="suppressHydrationWarning"&&h!=="autoFocus"&&(bf.hasOwnProperty(h)?v!=null&&h==="onScroll"&&mi("scroll",n):v!=null&&qv(n,h,v,f))}switch(t){case"input":um(n),zb(n,i,!1);break;case"textarea":um(n),Fb(n);break;case"option":i.value!=null&&n.setAttribute("value",""+yl(i.value));break;case"select":n.multiple=!!i.multiple,h=i.value,h!=null?th(n,!!i.multiple,h,!1):i.defaultValue!=null&&th(n,!!i.multiple,i.defaultValue,!0);break;default:typeof o.onClick=="function"&&(n.onclick=wg)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Tr(e),null;case 6:if(n&&e.stateNode!=null)qE(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(Mt(166));if(t=cc(Df.current),cc(Ma.current),vm(e)){if(i=e.stateNode,t=e.memoizedProps,i[xa]=e,(h=i.nodeValue!==t)&&(n=_s,n!==null))switch(n.tag){case 3:ym(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ym(i.nodeValue,t,(n.mode&1)!==0)}h&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[xa]=e,e.stateNode=i}return Tr(e),null;case 13:if(_i(Mi),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(xi&&ms!==null&&e.mode&1&&!(e.flags&128))hE(),fh(),e.flags|=98560,h=!1;else if(h=vm(e),i!==null&&i.dehydrated!==null){if(n===null){if(!h)throw Error(Mt(318));if(h=e.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(Mt(317));h[xa]=e}else fh(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Tr(e),h=!1}else na!==null&&(Ev(na),na=null),h=!0;if(!h)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Mi.current&1?Zi===0&&(Zi=3):Rx())),e.updateQueue!==null&&(e.flags|=4),Tr(e),null);case 4:return mh(),yv(n,e),n===null&&Pf(e.stateNode.containerInfo),Tr(e),null;case 10:return fx(e.type._context),Tr(e),null;case 17:return ts(e.type)&&Sg(),Tr(e),null;case 19:if(_i(Mi),h=e.memoizedState,h===null)return Tr(e),null;if(i=(e.flags&128)!==0,f=h.rendering,f===null)if(i)jd(h,!1);else{if(Zi!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(f=Rg(n),f!==null){for(e.flags|=128,jd(h,!1),i=f.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)h=t,n=i,h.flags&=14680066,f=h.alternate,f===null?(h.childLanes=0,h.lanes=n,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=f.childLanes,h.lanes=f.lanes,h.child=f.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=f.memoizedProps,h.memoizedState=f.memoizedState,h.updateQueue=f.updateQueue,h.type=f.type,n=f.dependencies,h.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return hi(Mi,Mi.current&1|2),e.child}n=n.sibling}h.tail!==null&&Vi()>_h&&(e.flags|=128,i=!0,jd(h,!1),e.lanes=4194304)}else{if(!i)if(n=Rg(f),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),jd(h,!0),h.tail===null&&h.tailMode==="hidden"&&!f.alternate&&!xi)return Tr(e),null}else 2*Vi()-h.renderingStartTime>_h&&t!==1073741824&&(e.flags|=128,i=!0,jd(h,!1),e.lanes=4194304);h.isBackwards?(f.sibling=e.child,e.child=f):(t=h.last,t!==null?t.sibling=f:e.child=f,h.last=f)}return h.tail!==null?(e=h.tail,h.rendering=e,h.tail=e.sibling,h.renderingStartTime=Vi(),e.sibling=null,t=Mi.current,hi(Mi,i?t&1|2:t&1),e):(Tr(e),null);case 22:case 23:return Px(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?ps&1073741824&&(Tr(e),e.subtreeFlags&6&&(e.flags|=8192)):Tr(e),null;case 24:return null;case 25:return null}throw Error(Mt(156,e.tag))}function bI(n,e){switch(cx(e),e.tag){case 1:return ts(e.type)&&Sg(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return mh(),_i(es),_i(Ir),yx(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return _x(e),null;case 13:if(_i(Mi),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(Mt(340));fh()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return _i(Mi),null;case 4:return mh(),null;case 10:return fx(e.type._context),null;case 22:case 23:return Px(),null;case 24:return null;default:return null}}var wm=!1,Pr=!1,wI=typeof WeakSet=="function"?WeakSet:Set,en=null;function Xu(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){Ii(n,e,i)}else t.current=null}function vv(n,e,t){try{t()}catch(i){Ii(n,e,i)}}var Tw=!1;function SI(n,e){if(nv=vg,n=JT(),ox(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var o=i.anchorOffset,h=i.focusNode;i=i.focusOffset;try{t.nodeType,h.nodeType}catch{t=null;break e}var f=0,c=-1,v=-1,w=0,S=0,E=n,M=null;t:for(;;){for(var L;E!==t||o!==0&&E.nodeType!==3||(c=f+o),E!==h||i!==0&&E.nodeType!==3||(v=f+i),E.nodeType===3&&(f+=E.nodeValue.length),(L=E.firstChild)!==null;)M=E,E=L;for(;;){if(E===n)break t;if(M===t&&++w===o&&(c=f),M===h&&++S===i&&(v=f),(L=E.nextSibling)!==null)break;E=M,M=E.parentNode}E=L}t=c===-1||v===-1?null:{start:c,end:v}}else t=null}t=t||{start:0,end:0}}else t=null;for(iv={focusedElem:n,selectionRange:t},vg=!1,en=e;en!==null;)if(e=en,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,en=n;else for(;en!==null;){e=en;try{var U=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(U!==null){var B=U.memoizedProps,z=U.memoizedState,R=e.stateNode,G=R.getSnapshotBeforeUpdate(e.elementType===e.type?B:Qs(e.type,B),z);R.__reactInternalSnapshotBeforeUpdate=G}break;case 3:var V=e.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Mt(163))}}catch(ee){Ii(e,e.return,ee)}if(n=e.sibling,n!==null){n.return=e.return,en=n;break}en=e.return}return U=Tw,Tw=!1,U}function mf(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var o=i=i.next;do{if((o.tag&n)===n){var h=o.destroy;o.destroy=void 0,h!==void 0&&vv(e,t,h)}o=o.next}while(o!==i)}}function t_(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function xv(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function ZE(n){var e=n.alternate;e!==null&&(n.alternate=null,ZE(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[xa],delete e[If],delete e[av],delete e[sI],delete e[aI])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function YE(n){return n.tag===5||n.tag===3||n.tag===4}function Ew(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||YE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function bv(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=wg));else if(i!==4&&(n=n.child,n!==null))for(bv(n,e,t),n=n.sibling;n!==null;)bv(n,e,t),n=n.sibling}function wv(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(wv(n,e,t),n=n.sibling;n!==null;)wv(n,e,t),n=n.sibling}var hr=null,ea=!1;function Go(n,e,t){for(t=t.child;t!==null;)KE(n,e,t),t=t.sibling}function KE(n,e,t){if(Sa&&typeof Sa.onCommitFiberUnmount=="function")try{Sa.onCommitFiberUnmount(Xg,t)}catch{}switch(t.tag){case 5:Pr||Xu(t,e);case 6:var i=hr,o=ea;hr=null,Go(n,e,t),hr=i,ea=o,hr!==null&&(ea?(n=hr,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):hr.removeChild(t.stateNode));break;case 18:hr!==null&&(ea?(n=hr,t=t.stateNode,n.nodeType===8?ky(n.parentNode,t):n.nodeType===1&&ky(n,t),Ef(n)):ky(hr,t.stateNode));break;case 4:i=hr,o=ea,hr=t.stateNode.containerInfo,ea=!0,Go(n,e,t),hr=i,ea=o;break;case 0:case 11:case 14:case 15:if(!Pr&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){o=i=i.next;do{var h=o,f=h.destroy;h=h.tag,f!==void 0&&(h&2||h&4)&&vv(t,e,f),o=o.next}while(o!==i)}Go(n,e,t);break;case 1:if(!Pr&&(Xu(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(c){Ii(t,e,c)}Go(n,e,t);break;case 21:Go(n,e,t);break;case 22:t.mode&1?(Pr=(i=Pr)||t.memoizedState!==null,Go(n,e,t),Pr=i):Go(n,e,t);break;default:Go(n,e,t)}}function Aw(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new wI),e.forEach(function(i){var o=LI.bind(null,n,i);t.has(i)||(t.add(i),i.then(o,o))})}}function qs(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var o=t[i];try{var h=n,f=e,c=f;e:for(;c!==null;){switch(c.tag){case 5:hr=c.stateNode,ea=!1;break e;case 3:hr=c.stateNode.containerInfo,ea=!0;break e;case 4:hr=c.stateNode.containerInfo,ea=!0;break e}c=c.return}if(hr===null)throw Error(Mt(160));KE(h,f,o),hr=null,ea=!1;var v=o.alternate;v!==null&&(v.return=null),o.return=null}catch(w){Ii(o,e,w)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)JE(e,n),e=e.sibling}function JE(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(qs(e,n),ga(n),i&4){try{mf(3,n,n.return),t_(3,n)}catch(B){Ii(n,n.return,B)}try{mf(5,n,n.return)}catch(B){Ii(n,n.return,B)}}break;case 1:qs(e,n),ga(n),i&512&&t!==null&&Xu(t,t.return);break;case 5:if(qs(e,n),ga(n),i&512&&t!==null&&Xu(t,t.return),n.flags&32){var o=n.stateNode;try{wf(o,"")}catch(B){Ii(n,n.return,B)}}if(i&4&&(o=n.stateNode,o!=null)){var h=n.memoizedProps,f=t!==null?t.memoizedProps:h,c=n.type,v=n.updateQueue;if(n.updateQueue=null,v!==null)try{c==="input"&&h.type==="radio"&&h.name!=null&&vT(o,h),$0(c,f);var w=$0(c,h);for(f=0;f<v.length;f+=2){var S=v[f],E=v[f+1];S==="style"?MT(o,E):S==="dangerouslySetInnerHTML"?wT(o,E):S==="children"?wf(o,E):qv(o,S,E,w)}switch(c){case"input":V0(o,h);break;case"textarea":xT(o,h);break;case"select":var M=o._wrapperState.wasMultiple;o._wrapperState.wasMultiple=!!h.multiple;var L=h.value;L!=null?th(o,!!h.multiple,L,!1):M!==!!h.multiple&&(h.defaultValue!=null?th(o,!!h.multiple,h.defaultValue,!0):th(o,!!h.multiple,h.multiple?[]:"",!1))}o[If]=h}catch(B){Ii(n,n.return,B)}}break;case 6:if(qs(e,n),ga(n),i&4){if(n.stateNode===null)throw Error(Mt(162));o=n.stateNode,h=n.memoizedProps;try{o.nodeValue=h}catch(B){Ii(n,n.return,B)}}break;case 3:if(qs(e,n),ga(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{Ef(e.containerInfo)}catch(B){Ii(n,n.return,B)}break;case 4:qs(e,n),ga(n);break;case 13:qs(e,n),ga(n),o=n.child,o.flags&8192&&(h=o.memoizedState!==null,o.stateNode.isHidden=h,!h||o.alternate!==null&&o.alternate.memoizedState!==null||(Ax=Vi())),i&4&&Aw(n);break;case 22:if(S=t!==null&&t.memoizedState!==null,n.mode&1?(Pr=(w=Pr)||S,qs(e,n),Pr=w):qs(e,n),ga(n),i&8192){if(w=n.memoizedState!==null,(n.stateNode.isHidden=w)&&!S&&n.mode&1)for(en=n,S=n.child;S!==null;){for(E=en=S;en!==null;){switch(M=en,L=M.child,M.tag){case 0:case 11:case 14:case 15:mf(4,M,M.return);break;case 1:Xu(M,M.return);var U=M.stateNode;if(typeof U.componentWillUnmount=="function"){i=M,t=M.return;try{e=i,U.props=e.memoizedProps,U.state=e.memoizedState,U.componentWillUnmount()}catch(B){Ii(i,t,B)}}break;case 5:Xu(M,M.return);break;case 22:if(M.memoizedState!==null){Pw(E);continue}}L!==null?(L.return=M,en=L):Pw(E)}S=S.sibling}e:for(S=null,E=n;;){if(E.tag===5){if(S===null){S=E;try{o=E.stateNode,w?(h=o.style,typeof h.setProperty=="function"?h.setProperty("display","none","important"):h.display="none"):(c=E.stateNode,v=E.memoizedProps.style,f=v!=null&&v.hasOwnProperty("display")?v.display:null,c.style.display=ST("display",f))}catch(B){Ii(n,n.return,B)}}}else if(E.tag===6){if(S===null)try{E.stateNode.nodeValue=w?"":E.memoizedProps}catch(B){Ii(n,n.return,B)}}else if((E.tag!==22&&E.tag!==23||E.memoizedState===null||E===n)&&E.child!==null){E.child.return=E,E=E.child;continue}if(E===n)break e;for(;E.sibling===null;){if(E.return===null||E.return===n)break e;S===E&&(S=null),E=E.return}S===E&&(S=null),E.sibling.return=E.return,E=E.sibling}}break;case 19:qs(e,n),ga(n),i&4&&Aw(n);break;case 21:break;default:qs(e,n),ga(n)}}function ga(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(YE(t)){var i=t;break e}t=t.return}throw Error(Mt(160))}switch(i.tag){case 5:var o=i.stateNode;i.flags&32&&(wf(o,""),i.flags&=-33);var h=Ew(n);wv(n,h,o);break;case 3:case 4:var f=i.stateNode.containerInfo,c=Ew(n);bv(n,c,f);break;default:throw Error(Mt(161))}}catch(v){Ii(n,n.return,v)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function MI(n,e,t){en=n,QE(n)}function QE(n,e,t){for(var i=(n.mode&1)!==0;en!==null;){var o=en,h=o.child;if(o.tag===22&&i){var f=o.memoizedState!==null||wm;if(!f){var c=o.alternate,v=c!==null&&c.memoizedState!==null||Pr;c=wm;var w=Pr;if(wm=f,(Pr=v)&&!w)for(en=o;en!==null;)f=en,v=f.child,f.tag===22&&f.memoizedState!==null?Rw(o):v!==null?(v.return=f,en=v):Rw(o);for(;h!==null;)en=h,QE(h),h=h.sibling;en=o,wm=c,Pr=w}Cw(n)}else o.subtreeFlags&8772&&h!==null?(h.return=o,en=h):Cw(n)}}function Cw(n){for(;en!==null;){var e=en;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:Pr||t_(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!Pr)if(t===null)i.componentDidMount();else{var o=e.elementType===e.type?t.memoizedProps:Qs(e.type,t.memoizedProps);i.componentDidUpdate(o,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var h=e.updateQueue;h!==null&&hw(e,h,i);break;case 3:var f=e.updateQueue;if(f!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}hw(e,f,t)}break;case 5:var c=e.stateNode;if(t===null&&e.flags&4){t=c;var v=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":v.autoFocus&&t.focus();break;case"img":v.src&&(t.src=v.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var w=e.alternate;if(w!==null){var S=w.memoizedState;if(S!==null){var E=S.dehydrated;E!==null&&Ef(E)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Mt(163))}Pr||e.flags&512&&xv(e)}catch(M){Ii(e,e.return,M)}}if(e===n){en=null;break}if(t=e.sibling,t!==null){t.return=e.return,en=t;break}en=e.return}}function Pw(n){for(;en!==null;){var e=en;if(e===n){en=null;break}var t=e.sibling;if(t!==null){t.return=e.return,en=t;break}en=e.return}}function Rw(n){for(;en!==null;){var e=en;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{t_(4,e)}catch(v){Ii(e,t,v)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var o=e.return;try{i.componentDidMount()}catch(v){Ii(e,o,v)}}var h=e.return;try{xv(e)}catch(v){Ii(e,h,v)}break;case 5:var f=e.return;try{xv(e)}catch(v){Ii(e,f,v)}}}catch(v){Ii(e,e.return,v)}if(e===n){en=null;break}var c=e.sibling;if(c!==null){c.return=e.return,en=c;break}en=e.return}}var TI=Math.ceil,Dg=po.ReactCurrentDispatcher,Tx=po.ReactCurrentOwner,Os=po.ReactCurrentBatchConfig,Wn=0,sr=null,Wi=null,fr=0,ps=0,qu=wl(0),Zi=0,Uf=null,vc=0,n_=0,Ex=0,gf=null,Jr=null,Ax=0,_h=1/0,Ja=null,zg=!1,Sv=null,dl=null,Sm=!1,sl=null,kg=0,_f=0,Mv=null,lg=-1,cg=0;function Hr(){return Wn&6?Vi():lg!==-1?lg:lg=Vi()}function fl(n){return n.mode&1?Wn&2&&fr!==0?fr&-fr:lI.transition!==null?(cg===0&&(cg=FT()),cg):(n=Qn,n!==0||(n=window.event,n=n===void 0?16:HT(n.type)),n):1}function sa(n,e,t,i){if(50<_f)throw _f=0,Mv=null,Error(Mt(185));jf(n,t,i),(!(Wn&2)||n!==sr)&&(n===sr&&(!(Wn&2)&&(n_|=t),Zi===4&&nl(n,fr)),ns(n,i),t===1&&Wn===0&&!(e.mode&1)&&(_h=Vi()+500,Jg&&Sl()))}function ns(n,e){var t=n.callbackNode;lR(n,e);var i=yg(n,n===sr?fr:0);if(i===0)t!==null&&Ob(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&Ob(t),e===1)n.tag===0?oI(Iw.bind(null,n)):lE(Iw.bind(null,n)),iI(function(){!(Wn&6)&&Sl()}),t=null;else{switch(UT(i)){case 1:t=Qv;break;case 4:t=zT;break;case 16:t=_g;break;case 536870912:t=kT;break;default:t=_g}t=o2(t,e2.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function e2(n,e){if(lg=-1,cg=0,Wn&6)throw Error(Mt(327));var t=n.callbackNode;if(ah()&&n.callbackNode!==t)return null;var i=yg(n,n===sr?fr:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Fg(n,i);else{e=i;var o=Wn;Wn|=2;var h=n2();(sr!==n||fr!==e)&&(Ja=null,_h=Vi()+500,pc(n,e));do try{CI();break}catch(c){t2(n,c)}while(!0);dx(),Dg.current=h,Wn=o,Wi!==null?e=0:(sr=null,fr=0,e=Zi)}if(e!==0){if(e===2&&(o=K0(n),o!==0&&(i=o,e=Tv(n,o))),e===1)throw t=Uf,pc(n,0),nl(n,i),ns(n,Vi()),t;if(e===6)nl(n,i);else{if(o=n.current.alternate,!(i&30)&&!EI(o)&&(e=Fg(n,i),e===2&&(h=K0(n),h!==0&&(i=h,e=Tv(n,h))),e===1))throw t=Uf,pc(n,0),nl(n,i),ns(n,Vi()),t;switch(n.finishedWork=o,n.finishedLanes=i,e){case 0:case 1:throw Error(Mt(345));case 2:ic(n,Jr,Ja);break;case 3:if(nl(n,i),(i&130023424)===i&&(e=Ax+500-Vi(),10<e)){if(yg(n,0)!==0)break;if(o=n.suspendedLanes,(o&i)!==i){Hr(),n.pingedLanes|=n.suspendedLanes&o;break}n.timeoutHandle=sv(ic.bind(null,n,Jr,Ja),e);break}ic(n,Jr,Ja);break;case 4:if(nl(n,i),(i&4194240)===i)break;for(e=n.eventTimes,o=-1;0<i;){var f=31-ra(i);h=1<<f,f=e[f],f>o&&(o=f),i&=~h}if(i=o,i=Vi()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*TI(i/1960))-i,10<i){n.timeoutHandle=sv(ic.bind(null,n,Jr,Ja),i);break}ic(n,Jr,Ja);break;case 5:ic(n,Jr,Ja);break;default:throw Error(Mt(329))}}}return ns(n,Vi()),n.callbackNode===t?e2.bind(null,n):null}function Tv(n,e){var t=gf;return n.current.memoizedState.isDehydrated&&(pc(n,e).flags|=256),n=Fg(n,e),n!==2&&(e=Jr,Jr=t,e!==null&&Ev(e)),n}function Ev(n){Jr===null?Jr=n:Jr.push.apply(Jr,n)}function EI(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var o=t[i],h=o.getSnapshot;o=o.value;try{if(!aa(h(),o))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function nl(n,e){for(e&=~Ex,e&=~n_,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-ra(e),i=1<<t;n[t]=-1,e&=~i}}function Iw(n){if(Wn&6)throw Error(Mt(327));ah();var e=yg(n,0);if(!(e&1))return ns(n,Vi()),null;var t=Fg(n,e);if(n.tag!==0&&t===2){var i=K0(n);i!==0&&(e=i,t=Tv(n,i))}if(t===1)throw t=Uf,pc(n,0),nl(n,e),ns(n,Vi()),t;if(t===6)throw Error(Mt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,ic(n,Jr,Ja),ns(n,Vi()),null}function Cx(n,e){var t=Wn;Wn|=1;try{return n(e)}finally{Wn=t,Wn===0&&(_h=Vi()+500,Jg&&Sl())}}function xc(n){sl!==null&&sl.tag===0&&!(Wn&6)&&ah();var e=Wn;Wn|=1;var t=Os.transition,i=Qn;try{if(Os.transition=null,Qn=1,n)return n()}finally{Qn=i,Os.transition=t,Wn=e,!(Wn&6)&&Sl()}}function Px(){ps=qu.current,_i(qu)}function pc(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,nI(t)),Wi!==null)for(t=Wi.return;t!==null;){var i=t;switch(cx(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&Sg();break;case 3:mh(),_i(es),_i(Ir),yx();break;case 5:_x(i);break;case 4:mh();break;case 13:_i(Mi);break;case 19:_i(Mi);break;case 10:fx(i.type._context);break;case 22:case 23:Px()}t=t.return}if(sr=n,Wi=n=pl(n.current,null),fr=ps=e,Zi=0,Uf=null,Ex=n_=vc=0,Jr=gf=null,lc!==null){for(e=0;e<lc.length;e++)if(t=lc[e],i=t.interleaved,i!==null){t.interleaved=null;var o=i.next,h=t.pending;if(h!==null){var f=h.next;h.next=o,i.next=f}t.pending=i}lc=null}return n}function t2(n,e){do{var t=Wi;try{if(dx(),sg.current=Lg,Ig){for(var i=Ti.memoizedState;i!==null;){var o=i.queue;o!==null&&(o.pending=null),i=i.next}Ig=!1}if(yc=0,rr=qi=Ti=null,pf=!1,zf=0,Tx.current=null,t===null||t.return===null){Zi=1,Uf=e,Wi=null;break}e:{var h=n,f=t.return,c=t,v=e;if(e=fr,c.flags|=32768,v!==null&&typeof v=="object"&&typeof v.then=="function"){var w=v,S=c,E=S.tag;if(!(S.mode&1)&&(E===0||E===11||E===15)){var M=S.alternate;M?(S.updateQueue=M.updateQueue,S.memoizedState=M.memoizedState,S.lanes=M.lanes):(S.updateQueue=null,S.memoizedState=null)}var L=yw(f);if(L!==null){L.flags&=-257,vw(L,f,c,h,e),L.mode&1&&_w(h,w,e),e=L,v=w;var U=e.updateQueue;if(U===null){var B=new Set;B.add(v),e.updateQueue=B}else U.add(v);break e}else{if(!(e&1)){_w(h,w,e),Rx();break e}v=Error(Mt(426))}}else if(xi&&c.mode&1){var z=yw(f);if(z!==null){!(z.flags&65536)&&(z.flags|=256),vw(z,f,c,h,e),ux(gh(v,c));break e}}h=v=gh(v,c),Zi!==4&&(Zi=2),gf===null?gf=[h]:gf.push(h),h=f;do{switch(h.tag){case 3:h.flags|=65536,e&=-e,h.lanes|=e;var R=NE(h,v,e);uw(h,R);break e;case 1:c=v;var G=h.type,V=h.stateNode;if(!(h.flags&128)&&(typeof G.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(dl===null||!dl.has(V)))){h.flags|=65536,e&=-e,h.lanes|=e;var ee=OE(h,c,e);uw(h,ee);break e}}h=h.return}while(h!==null)}r2(t)}catch(fe){e=fe,Wi===t&&t!==null&&(Wi=t=t.return);continue}break}while(!0)}function n2(){var n=Dg.current;return Dg.current=Lg,n===null?Lg:n}function Rx(){(Zi===0||Zi===3||Zi===2)&&(Zi=4),sr===null||!(vc&268435455)&&!(n_&268435455)||nl(sr,fr)}function Fg(n,e){var t=Wn;Wn|=2;var i=n2();(sr!==n||fr!==e)&&(Ja=null,pc(n,e));do try{AI();break}catch(o){t2(n,o)}while(!0);if(dx(),Wn=t,Dg.current=i,Wi!==null)throw Error(Mt(261));return sr=null,fr=0,Zi}function AI(){for(;Wi!==null;)i2(Wi)}function CI(){for(;Wi!==null&&!QP();)i2(Wi)}function i2(n){var e=a2(n.alternate,n,ps);n.memoizedProps=n.pendingProps,e===null?r2(n):Wi=e,Tx.current=null}function r2(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=bI(t,e),t!==null){t.flags&=32767,Wi=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Zi=6,Wi=null;return}}else if(t=xI(t,e,ps),t!==null){Wi=t;return}if(e=e.sibling,e!==null){Wi=e;return}Wi=e=n}while(e!==null);Zi===0&&(Zi=5)}function ic(n,e,t){var i=Qn,o=Os.transition;try{Os.transition=null,Qn=1,PI(n,e,t,i)}finally{Os.transition=o,Qn=i}return null}function PI(n,e,t,i){do ah();while(sl!==null);if(Wn&6)throw Error(Mt(327));t=n.finishedWork;var o=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(Mt(177));n.callbackNode=null,n.callbackPriority=0;var h=t.lanes|t.childLanes;if(cR(n,h),n===sr&&(Wi=sr=null,fr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||Sm||(Sm=!0,o2(_g,function(){return ah(),null})),h=(t.flags&15990)!==0,t.subtreeFlags&15990||h){h=Os.transition,Os.transition=null;var f=Qn;Qn=1;var c=Wn;Wn|=4,Tx.current=null,SI(n,t),JE(t,n),ZR(iv),vg=!!nv,iv=nv=null,n.current=t,MI(t),eR(),Wn=c,Qn=f,Os.transition=h}else n.current=t;if(Sm&&(Sm=!1,sl=n,kg=o),h=n.pendingLanes,h===0&&(dl=null),iR(t.stateNode),ns(n,Vi()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)o=e[t],i(o.value,{componentStack:o.stack,digest:o.digest});if(zg)throw zg=!1,n=Sv,Sv=null,n;return kg&1&&n.tag!==0&&ah(),h=n.pendingLanes,h&1?n===Mv?_f++:(_f=0,Mv=n):_f=0,Sl(),null}function ah(){if(sl!==null){var n=UT(kg),e=Os.transition,t=Qn;try{if(Os.transition=null,Qn=16>n?16:n,sl===null)var i=!1;else{if(n=sl,sl=null,kg=0,Wn&6)throw Error(Mt(331));var o=Wn;for(Wn|=4,en=n.current;en!==null;){var h=en,f=h.child;if(en.flags&16){var c=h.deletions;if(c!==null){for(var v=0;v<c.length;v++){var w=c[v];for(en=w;en!==null;){var S=en;switch(S.tag){case 0:case 11:case 15:mf(8,S,h)}var E=S.child;if(E!==null)E.return=S,en=E;else for(;en!==null;){S=en;var M=S.sibling,L=S.return;if(ZE(S),S===w){en=null;break}if(M!==null){M.return=L,en=M;break}en=L}}}var U=h.alternate;if(U!==null){var B=U.child;if(B!==null){U.child=null;do{var z=B.sibling;B.sibling=null,B=z}while(B!==null)}}en=h}}if(h.subtreeFlags&2064&&f!==null)f.return=h,en=f;else e:for(;en!==null;){if(h=en,h.flags&2048)switch(h.tag){case 0:case 11:case 15:mf(9,h,h.return)}var R=h.sibling;if(R!==null){R.return=h.return,en=R;break e}en=h.return}}var G=n.current;for(en=G;en!==null;){f=en;var V=f.child;if(f.subtreeFlags&2064&&V!==null)V.return=f,en=V;else e:for(f=G;en!==null;){if(c=en,c.flags&2048)try{switch(c.tag){case 0:case 11:case 15:t_(9,c)}}catch(fe){Ii(c,c.return,fe)}if(c===f){en=null;break e}var ee=c.sibling;if(ee!==null){ee.return=c.return,en=ee;break e}en=c.return}}if(Wn=o,Sl(),Sa&&typeof Sa.onPostCommitFiberRoot=="function")try{Sa.onPostCommitFiberRoot(Xg,n)}catch{}i=!0}return i}finally{Qn=t,Os.transition=e}}return!1}function Lw(n,e,t){e=gh(t,e),e=NE(n,e,1),n=hl(n,e,1),e=Hr(),n!==null&&(jf(n,1,e),ns(n,e))}function Ii(n,e,t){if(n.tag===3)Lw(n,n,t);else for(;e!==null;){if(e.tag===3){Lw(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(dl===null||!dl.has(i))){n=gh(t,n),n=OE(e,n,1),e=hl(e,n,1),n=Hr(),e!==null&&(jf(e,1,n),ns(e,n));break}}e=e.return}}function RI(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=Hr(),n.pingedLanes|=n.suspendedLanes&t,sr===n&&(fr&t)===t&&(Zi===4||Zi===3&&(fr&130023424)===fr&&500>Vi()-Ax?pc(n,0):Ex|=t),ns(n,e)}function s2(n,e){e===0&&(n.mode&1?(e=fm,fm<<=1,!(fm&130023424)&&(fm=4194304)):e=1);var t=Hr();n=co(n,e),n!==null&&(jf(n,e,t),ns(n,t))}function II(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),s2(n,t)}function LI(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,o=n.memoizedState;o!==null&&(t=o.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(Mt(314))}i!==null&&i.delete(e),s2(n,t)}var a2;a2=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||es.current)Qr=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Qr=!1,vI(n,e,t);Qr=!!(n.flags&131072)}else Qr=!1,xi&&e.flags&1048576&&cE(e,Eg,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;og(n,e),n=e.pendingProps;var o=dh(e,Ir.current);sh(e,t),o=xx(null,e,i,n,o,t);var h=bx();return e.flags|=1,typeof o=="object"&&o!==null&&typeof o.render=="function"&&o.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ts(i)?(h=!0,Mg(e)):h=!1,e.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,mx(e),o.updater=Qg,e.stateNode=o,o._reactInternals=e,dv(e,i,n,t),e=mv(null,e,i,!0,h,t)):(e.tag=0,xi&&h&&lx(e),Gr(null,e,o,t),e=e.child),e;case 16:i=e.elementType;e:{switch(og(n,e),n=e.pendingProps,o=i._init,i=o(i._payload),e.type=i,o=e.tag=zI(i),n=Qs(i,n),o){case 0:e=pv(null,e,i,n,t);break e;case 1:e=ww(null,e,i,n,t);break e;case 11:e=xw(null,e,i,n,t);break e;case 14:e=bw(null,e,i,Qs(i.type,n),t);break e}throw Error(Mt(306,i,""))}return e;case 0:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Qs(i,o),pv(n,e,i,o,t);case 1:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Qs(i,o),ww(n,e,i,o,t);case 3:e:{if(HE(e),n===null)throw Error(Mt(387));i=e.pendingProps,h=e.memoizedState,o=h.element,fE(n,e),Pg(e,i,null,t);var f=e.memoizedState;if(i=f.element,h.isDehydrated)if(h={element:i,isDehydrated:!1,cache:f.cache,pendingSuspenseBoundaries:f.pendingSuspenseBoundaries,transitions:f.transitions},e.updateQueue.baseState=h,e.memoizedState=h,e.flags&256){o=gh(Error(Mt(423)),e),e=Sw(n,e,i,t,o);break e}else if(i!==o){o=gh(Error(Mt(424)),e),e=Sw(n,e,i,t,o);break e}else for(ms=ul(e.stateNode.containerInfo.firstChild),_s=e,xi=!0,na=null,t=_E(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(fh(),i===o){e=uo(n,e,t);break e}Gr(n,e,i,t)}e=e.child}return e;case 5:return yE(e),n===null&&cv(e),i=e.type,o=e.pendingProps,h=n!==null?n.memoizedProps:null,f=o.children,rv(i,o)?f=null:h!==null&&rv(i,h)&&(e.flags|=32),GE(n,e),Gr(n,e,f,t),e.child;case 6:return n===null&&cv(e),null;case 13:return jE(n,e,t);case 4:return gx(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=ph(e,null,i,t):Gr(n,e,i,t),e.child;case 11:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Qs(i,o),xw(n,e,i,o,t);case 7:return Gr(n,e,e.pendingProps,t),e.child;case 8:return Gr(n,e,e.pendingProps.children,t),e.child;case 12:return Gr(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,o=e.pendingProps,h=e.memoizedProps,f=o.value,hi(Ag,i._currentValue),i._currentValue=f,h!==null)if(aa(h.value,f)){if(h.children===o.children&&!es.current){e=uo(n,e,t);break e}}else for(h=e.child,h!==null&&(h.return=e);h!==null;){var c=h.dependencies;if(c!==null){f=h.child;for(var v=c.firstContext;v!==null;){if(v.context===i){if(h.tag===1){v=so(-1,t&-t),v.tag=2;var w=h.updateQueue;if(w!==null){w=w.shared;var S=w.pending;S===null?v.next=v:(v.next=S.next,S.next=v),w.pending=v}}h.lanes|=t,v=h.alternate,v!==null&&(v.lanes|=t),uv(h.return,t,e),c.lanes|=t;break}v=v.next}}else if(h.tag===10)f=h.type===e.type?null:h.child;else if(h.tag===18){if(f=h.return,f===null)throw Error(Mt(341));f.lanes|=t,c=f.alternate,c!==null&&(c.lanes|=t),uv(f,t,e),f=h.sibling}else f=h.child;if(f!==null)f.return=h;else for(f=h;f!==null;){if(f===e){f=null;break}if(h=f.sibling,h!==null){h.return=f.return,f=h;break}f=f.return}h=f}Gr(n,e,o.children,t),e=e.child}return e;case 9:return o=e.type,i=e.pendingProps.children,sh(e,t),o=Bs(o),i=i(o),e.flags|=1,Gr(n,e,i,t),e.child;case 14:return i=e.type,o=Qs(i,e.pendingProps),o=Qs(i.type,o),bw(n,e,i,o,t);case 15:return BE(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,o=e.pendingProps,o=e.elementType===i?o:Qs(i,o),og(n,e),e.tag=1,ts(i)?(n=!0,Mg(e)):n=!1,sh(e,t),mE(e,i,o),dv(e,i,o,t),mv(null,e,i,!0,n,t);case 19:return WE(n,e,t);case 22:return VE(n,e,t)}throw Error(Mt(156,e.tag))};function o2(n,e){return DT(n,e)}function DI(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ks(n,e,t,i){return new DI(n,e,t,i)}function Ix(n){return n=n.prototype,!(!n||!n.isReactComponent)}function zI(n){if(typeof n=="function")return Ix(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Yv)return 11;if(n===Kv)return 14}return 2}function pl(n,e){var t=n.alternate;return t===null?(t=ks(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function ug(n,e,t,i,o,h){var f=2;if(i=n,typeof n=="function")Ix(n)&&(f=1);else if(typeof n=="string")f=5;else e:switch(n){case Nu:return mc(t.children,o,h,e);case Zv:f=8,o|=8;break;case F0:return n=ks(12,t,e,o|2),n.elementType=F0,n.lanes=h,n;case U0:return n=ks(13,t,e,o),n.elementType=U0,n.lanes=h,n;case N0:return n=ks(19,t,e,o),n.elementType=N0,n.lanes=h,n;case gT:return i_(t,o,h,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case pT:f=10;break e;case mT:f=9;break e;case Yv:f=11;break e;case Kv:f=14;break e;case Jo:f=16,i=null;break e}throw Error(Mt(130,n==null?n:typeof n,""))}return e=ks(f,t,e,o),e.elementType=n,e.type=i,e.lanes=h,e}function mc(n,e,t,i){return n=ks(7,n,i,e),n.lanes=t,n}function i_(n,e,t,i){return n=ks(22,n,i,e),n.elementType=gT,n.lanes=t,n.stateNode={isHidden:!1},n}function Hy(n,e,t){return n=ks(6,n,null,e),n.lanes=t,n}function jy(n,e,t){return e=ks(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function kI(n,e,t,i,o){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=My(0),this.expirationTimes=My(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=My(0),this.identifierPrefix=i,this.onRecoverableError=o,this.mutableSourceEagerHydrationData=null}function Lx(n,e,t,i,o,h,f,c,v){return n=new kI(n,e,t,c,v),e===1?(e=1,h===!0&&(e|=8)):e=0,h=ks(3,null,null,e),n.current=h,h.stateNode=n,h.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},mx(h),n}function FI(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Uu,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function l2(n){if(!n)return vl;n=n._reactInternals;e:{if(Tc(n)!==n||n.tag!==1)throw Error(Mt(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ts(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(Mt(171))}if(n.tag===1){var t=n.type;if(ts(t))return oE(n,t,e)}return e}function c2(n,e,t,i,o,h,f,c,v){return n=Lx(t,i,!0,n,o,h,f,c,v),n.context=l2(null),t=n.current,i=Hr(),o=fl(t),h=so(i,o),h.callback=e??null,hl(t,h,o),n.current.lanes=o,jf(n,o,i),ns(n,i),n}function r_(n,e,t,i){var o=e.current,h=Hr(),f=fl(o);return t=l2(t),e.context===null?e.context=t:e.pendingContext=t,e=so(h,f),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=hl(o,e,f),n!==null&&(sa(n,o,f,h),rg(n,o,f)),f}function Ug(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Dw(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Dx(n,e){Dw(n,e),(n=n.alternate)&&Dw(n,e)}function UI(){return null}var u2=typeof reportError=="function"?reportError:function(n){console.error(n)};function zx(n){this._internalRoot=n}s_.prototype.render=zx.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(Mt(409));r_(n,e,null,null)};s_.prototype.unmount=zx.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;xc(function(){r_(null,n,null,null)}),e[lo]=null}};function s_(n){this._internalRoot=n}s_.prototype.unstable_scheduleHydration=function(n){if(n){var e=BT();n={blockedOn:null,target:n,priority:e};for(var t=0;t<tl.length&&e!==0&&e<tl[t].priority;t++);tl.splice(t,0,n),t===0&&GT(n)}};function kx(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function a_(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function zw(){}function NI(n,e,t,i,o){if(o){if(typeof i=="function"){var h=i;i=function(){var w=Ug(f);h.call(w)}}var f=c2(e,i,n,0,null,!1,!1,"",zw);return n._reactRootContainer=f,n[lo]=f.current,Pf(n.nodeType===8?n.parentNode:n),xc(),f}for(;o=n.lastChild;)n.removeChild(o);if(typeof i=="function"){var c=i;i=function(){var w=Ug(v);c.call(w)}}var v=Lx(n,0,!1,null,null,!1,!1,"",zw);return n._reactRootContainer=v,n[lo]=v.current,Pf(n.nodeType===8?n.parentNode:n),xc(function(){r_(e,v,t,i)}),v}function o_(n,e,t,i,o){var h=t._reactRootContainer;if(h){var f=h;if(typeof o=="function"){var c=o;o=function(){var v=Ug(f);c.call(v)}}r_(e,f,n,o)}else f=NI(t,e,n,o,i);return Ug(f)}NT=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=sf(e.pendingLanes);t!==0&&(ex(e,t|1),ns(e,Vi()),!(Wn&6)&&(_h=Vi()+500,Sl()))}break;case 13:xc(function(){var i=co(n,1);if(i!==null){var o=Hr();sa(i,n,1,o)}}),Dx(n,1)}};tx=function(n){if(n.tag===13){var e=co(n,134217728);if(e!==null){var t=Hr();sa(e,n,134217728,t)}Dx(n,134217728)}};OT=function(n){if(n.tag===13){var e=fl(n),t=co(n,e);if(t!==null){var i=Hr();sa(t,n,e,i)}Dx(n,e)}};BT=function(){return Qn};VT=function(n,e){var t=Qn;try{return Qn=n,e()}finally{Qn=t}};q0=function(n,e,t){switch(e){case"input":if(V0(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var o=Kg(i);if(!o)throw Error(Mt(90));yT(i),V0(i,o)}}}break;case"textarea":xT(n,t);break;case"select":e=t.value,e!=null&&th(n,!!t.multiple,e,!1)}};AT=Cx;CT=xc;var OI={usingClientEntryPoint:!1,Events:[$f,Gu,Kg,TT,ET,Cx]},Wd={findFiberByHostInstance:oc,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},BI={bundleType:Wd.bundleType,version:Wd.version,rendererPackageName:Wd.rendererPackageName,rendererConfig:Wd.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:po.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=IT(n),n===null?null:n.stateNode},findFiberByHostInstance:Wd.findFiberByHostInstance||UI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Mm=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Mm.isDisabled&&Mm.supportsFiber)try{Xg=Mm.inject(BI),Sa=Mm}catch{}}xs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=OI;xs.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!kx(e))throw Error(Mt(200));return FI(n,e,null,t)};xs.createRoot=function(n,e){if(!kx(n))throw Error(Mt(299));var t=!1,i="",o=u2;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(o=e.onRecoverableError)),e=Lx(n,1,!1,null,null,t,!1,i,o),n[lo]=e.current,Pf(n.nodeType===8?n.parentNode:n),new zx(e)};xs.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(Mt(188)):(n=Object.keys(n).join(","),Error(Mt(268,n)));return n=IT(e),n=n===null?null:n.stateNode,n};xs.flushSync=function(n){return xc(n)};xs.hydrate=function(n,e,t){if(!a_(e))throw Error(Mt(200));return o_(null,n,e,!0,t)};xs.hydrateRoot=function(n,e,t){if(!kx(n))throw Error(Mt(405));var i=t!=null&&t.hydratedSources||null,o=!1,h="",f=u2;if(t!=null&&(t.unstable_strictMode===!0&&(o=!0),t.identifierPrefix!==void 0&&(h=t.identifierPrefix),t.onRecoverableError!==void 0&&(f=t.onRecoverableError)),e=c2(e,null,n,1,t??null,o,!1,h,f),n[lo]=e.current,Pf(n),i)for(n=0;n<i.length;n++)t=i[n],o=t._getVersion,o=o(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,o]:e.mutableSourceEagerHydrationData.push(t,o);return new s_(e)};xs.render=function(n,e,t){if(!a_(e))throw Error(Mt(200));return o_(null,n,e,!1,t)};xs.unmountComponentAtNode=function(n){if(!a_(n))throw Error(Mt(40));return n._reactRootContainer?(xc(function(){o_(null,null,n,!1,function(){n._reactRootContainer=null,n[lo]=null})}),!0):!1};xs.unstable_batchedUpdates=Cx;xs.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!a_(t))throw Error(Mt(200));if(n==null||n._reactInternals===void 0)throw Error(Mt(38));return o_(n,e,t,!1,i)};xs.version="18.2.0-next-9e3b772b8-20220608";function h2(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h2)}catch(n){console.error(n)}}h2(),cT.exports=xs;var Fx=cT.exports;const VI=KM(Fx),GI=YM({__proto__:null,default:VI},[Fx]);var kw=Fx;z0.createRoot=kw.createRoot,z0.hydrateRoot=kw.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Li(){return Li=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Li.apply(this,arguments)}var Bi;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(Bi||(Bi={}));const Fw="popstate";function HI(n){n===void 0&&(n={});function e(i,o){let{pathname:h,search:f,hash:c}=i.location;return Nf("",{pathname:h,search:f,hash:c},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(i,o){return typeof o=="string"?o:bc(o)}return WI(e,t,null,n)}function Fn(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function yh(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function jI(){return Math.random().toString(36).substr(2,8)}function Uw(n,e){return{usr:n.state,key:n.key,idx:e}}function Nf(n,e,t,i){return t===void 0&&(t=null),Li({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?mo(e):e,{state:t,key:e&&e.key||i||jI()})}function bc(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function mo(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function WI(n,e,t,i){i===void 0&&(i={});let{window:o=document.defaultView,v5Compat:h=!1}=i,f=o.history,c=Bi.Pop,v=null,w=S();w==null&&(w=0,f.replaceState(Li({},f.state,{idx:w}),""));function S(){return(f.state||{idx:null}).idx}function E(){c=Bi.Pop;let z=S(),R=z==null?null:z-w;w=z,v&&v({action:c,location:B.location,delta:R})}function M(z,R){c=Bi.Push;let G=Nf(B.location,z,R);t&&t(G,z),w=S()+1;let V=Uw(G,w),ee=B.createHref(G);try{f.pushState(V,"",ee)}catch(fe){if(fe instanceof DOMException&&fe.name==="DataCloneError")throw fe;o.location.assign(ee)}h&&v&&v({action:c,location:B.location,delta:1})}function L(z,R){c=Bi.Replace;let G=Nf(B.location,z,R);t&&t(G,z),w=S();let V=Uw(G,w),ee=B.createHref(G);f.replaceState(V,"",ee),h&&v&&v({action:c,location:B.location,delta:0})}function U(z){let R=o.location.origin!=="null"?o.location.origin:o.location.href,G=typeof z=="string"?z:bc(z);return G=G.replace(/ $/,"%20"),Fn(R,"No window.location.(origin|href) available to create URL for href: "+G),new URL(G,R)}let B={get action(){return c},get location(){return n(o,f)},listen(z){if(v)throw new Error("A history only accepts one active listener");return o.addEventListener(Fw,E),v=z,()=>{o.removeEventListener(Fw,E),v=null}},createHref(z){return e(o,z)},createURL:U,encodeLocation(z){let R=U(z);return{pathname:R.pathname,search:R.search,hash:R.hash}},push:M,replace:L,go(z){return f.go(z)}};return B}var Ri;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Ri||(Ri={}));const $I=new Set(["lazy","caseSensitive","path","id","index","children"]);function XI(n){return n.index===!0}function Av(n,e,t,i){return t===void 0&&(t=[]),i===void 0&&(i={}),n.map((o,h)=>{let f=[...t,h],c=typeof o.id=="string"?o.id:f.join("-");if(Fn(o.index!==!0||!o.children,"Cannot specify children on an index route"),Fn(!i[c],'Found a route id collision on id "'+c+`".  Route id's must be globally unique within Data Router usages`),XI(o)){let v=Li({},o,e(o),{id:c});return i[c]=v,v}else{let v=Li({},o,e(o),{id:c,children:void 0});return i[c]=v,o.children&&(v.children=Av(o.children,e,f,i)),v}})}function Zu(n,e,t){t===void 0&&(t="/");let i=typeof e=="string"?mo(e):e,o=ho(i.pathname||"/",t);if(o==null)return null;let h=d2(n);ZI(h);let f=null;for(let c=0;f==null&&c<h.length;++c){let v=aL(o);f=rL(h[c],v)}return f}function qI(n,e){let{route:t,pathname:i,params:o}=n;return{id:t.id,pathname:i,params:o,data:e[t.id],handle:t.handle}}function d2(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let o=(h,f,c)=>{let v={relativePath:c===void 0?h.path||"":c,caseSensitive:h.caseSensitive===!0,childrenIndex:f,route:h};v.relativePath.startsWith("/")&&(Fn(v.relativePath.startsWith(i),'Absolute route path "'+v.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),v.relativePath=v.relativePath.slice(i.length));let w=ao([i,v.relativePath]),S=t.concat(v);h.children&&h.children.length>0&&(Fn(h.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+w+'".')),d2(h.children,e,S,w)),!(h.path==null&&!h.index)&&e.push({path:w,score:nL(w,h.index),routesMeta:S})};return n.forEach((h,f)=>{var c;if(h.path===""||!((c=h.path)!=null&&c.includes("?")))o(h,f);else for(let v of f2(h.path))o(h,f,v)}),e}function f2(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,o=t.endsWith("?"),h=t.replace(/\?$/,"");if(i.length===0)return o?[h,""]:[h];let f=f2(i.join("/")),c=[];return c.push(...f.map(v=>v===""?h:[h,v].join("/"))),o&&c.push(...f),c.map(v=>n.startsWith("/")&&v===""?"/":v)}function ZI(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:iL(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const YI=/^:[\w-]+$/,KI=3,JI=2,QI=1,eL=10,tL=-2,Nw=n=>n==="*";function nL(n,e){let t=n.split("/"),i=t.length;return t.some(Nw)&&(i+=tL),e&&(i+=JI),t.filter(o=>!Nw(o)).reduce((o,h)=>o+(YI.test(h)?KI:h===""?QI:eL),i)}function iL(n,e){return n.length===e.length&&n.slice(0,-1).every((i,o)=>i===e[o])?n[n.length-1]-e[e.length-1]:0}function rL(n,e){let{routesMeta:t}=n,i={},o="/",h=[];for(let f=0;f<t.length;++f){let c=t[f],v=f===t.length-1,w=o==="/"?e:e.slice(o.length)||"/",S=Cv({path:c.relativePath,caseSensitive:c.caseSensitive,end:v},w);if(!S)return null;Object.assign(i,S.params);let E=c.route;h.push({params:i,pathname:ao([o,S.pathname]),pathnameBase:cL(ao([o,S.pathnameBase])),route:E}),S.pathnameBase!=="/"&&(o=ao([o,S.pathnameBase]))}return h}function Cv(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=sL(n.path,n.caseSensitive,n.end),o=e.match(t);if(!o)return null;let h=o[0],f=h.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:i.reduce((w,S,E)=>{let{paramName:M,isOptional:L}=S;if(M==="*"){let B=c[E]||"";f=h.slice(0,h.length-B.length).replace(/(.)\/+$/,"$1")}const U=c[E];return L&&!U?w[M]=void 0:w[M]=(U||"").replace(/%2F/g,"/"),w},{}),pathname:h,pathnameBase:f,pattern:n}}function sL(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),yh(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],o="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(f,c,v)=>(i.push({paramName:c,isOptional:v!=null}),v?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),o+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?o+="\\/*$":n!==""&&n!=="/"&&(o+="(?:(?=\\/|$))"),[new RegExp(o,e?void 0:"i"),i]}function aL(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return yh(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function ho(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function oL(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:o=""}=typeof n=="string"?mo(n):n;return{pathname:t?t.startsWith("/")?t:lL(t,e):e,search:uL(i),hash:hL(o)}}function lL(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(o=>{o===".."?t.length>1&&t.pop():o!=="."&&t.push(o)}),t.length>1?t.join("/"):"/"}function Wy(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function p2(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ux(n,e){let t=p2(n);return e?t.map((i,o)=>o===n.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function Nx(n,e,t,i){i===void 0&&(i=!1);let o;typeof n=="string"?o=mo(n):(o=Li({},n),Fn(!o.pathname||!o.pathname.includes("?"),Wy("?","pathname","search",o)),Fn(!o.pathname||!o.pathname.includes("#"),Wy("#","pathname","hash",o)),Fn(!o.search||!o.search.includes("#"),Wy("#","search","hash",o)));let h=n===""||o.pathname==="",f=h?"/":o.pathname,c;if(f==null)c=t;else{let E=e.length-1;if(!i&&f.startsWith("..")){let M=f.split("/");for(;M[0]==="..";)M.shift(),E-=1;o.pathname=M.join("/")}c=E>=0?e[E]:"/"}let v=oL(o,c),w=f&&f!=="/"&&f.endsWith("/"),S=(h||f===".")&&t.endsWith("/");return!v.pathname.endsWith("/")&&(w||S)&&(v.pathname+="/"),v}const ao=n=>n.join("/").replace(/\/\/+/g,"/"),cL=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),uL=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,hL=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class Ox{constructor(e,t,i,o){o===void 0&&(o=!1),this.status=e,this.statusText=t||"",this.internal=o,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}}function m2(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const g2=["post","put","patch","delete"],dL=new Set(g2),fL=["get",...g2],pL=new Set(fL),mL=new Set([301,302,303,307,308]),gL=new Set([307,308]),$y={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},_L={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},$d={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},_2=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,yL=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),y2="remix-router-transitions";function vL(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",i=!t;Fn(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let o;if(n.mapRouteProperties)o=n.mapRouteProperties;else if(n.detectErrorBoundary){let k=n.detectErrorBoundary;o=F=>({hasErrorBoundary:k(F)})}else o=yL;let h={},f=Av(n.routes,o,void 0,h),c,v=n.basename||"/",w=Li({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},n.future),S=null,E=new Set,M=null,L=null,U=null,B=n.hydrationData!=null,z=Zu(f,n.history.location,v),R=null;if(z==null){let k=Rs(404,{pathname:n.history.location.pathname}),{matches:F,route:j}=$w(f);z=F,R={[j.id]:k}}let G,V=z.some(k=>k.route.lazy),ee=z.some(k=>k.route.loader);if(V)G=!1;else if(!ee)G=!0;else if(w.v7_partialHydration){let k=n.hydrationData?n.hydrationData.loaderData:null,F=n.hydrationData?n.hydrationData.errors:null,j=Y=>Y.route.loader?Y.route.loader.hydrate===!0?!1:k&&k[Y.route.id]!==void 0||F&&F[Y.route.id]!==void 0:!0;if(F){let Y=z.findIndex(ue=>F[ue.route.id]!==void 0);G=z.slice(0,Y+1).every(j)}else G=z.every(j)}else G=n.hydrationData!=null;let fe,Z={historyAction:n.history.action,location:n.history.location,matches:z,initialized:G,navigation:$y,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||R,fetchers:new Map,blockers:new Map},te=Bi.Pop,be=!1,ae,K=!1,Pe=new Map,ke=null,Te=!1,je=!1,it=[],ut=[],st=new Map,Ce=0,Ke=-1,Ye=new Map,pt=new Set,kt=new Map,_n=new Map,Ze=new Set,_t=new Map,Ct=new Map,St=!1;function un(){if(S=n.history.listen(k=>{let{action:F,location:j,delta:Y}=k;if(St){St=!1;return}yh(Ct.size===0||Y!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let ue=Lt({currentLocation:Z.location,nextLocation:j,historyAction:F});if(ue&&Y!=null){St=!0,n.history.go(Y*-1),Rt(ue,{state:"blocked",location:j,proceed(){Rt(ue,{state:"proceeding",proceed:void 0,reset:void 0,location:j}),n.history.go(Y)},reset(){let ye=new Map(Z.blockers);ye.set(ue,$d),Fe({blockers:ye})}});return}return Wt(F,j)}),t){RL(e,Pe);let k=()=>IL(e,Pe);e.addEventListener("pagehide",k),ke=()=>e.removeEventListener("pagehide",k)}return Z.initialized||Wt(Bi.Pop,Z.location,{initialHydration:!0}),fe}function mn(){S&&S(),ke&&ke(),E.clear(),ae&&ae.abort(),Z.fetchers.forEach((k,F)=>Tt(F)),Z.blockers.forEach((k,F)=>nt(F))}function yn(k){return E.add(k),()=>E.delete(k)}function Fe(k,F){F===void 0&&(F={}),Z=Li({},Z,k);let j=[],Y=[];w.v7_fetcherPersist&&Z.fetchers.forEach((ue,ye)=>{ue.state==="idle"&&(Ze.has(ye)?Y.push(ye):j.push(ye))}),[...E].forEach(ue=>ue(Z,{deletedFetchers:Y,unstable_viewTransitionOpts:F.viewTransitionOpts,unstable_flushSync:F.flushSync===!0})),w.v7_fetcherPersist&&(j.forEach(ue=>Z.fetchers.delete(ue)),Y.forEach(ue=>Tt(ue)))}function dn(k,F,j){var Y,ue;let{flushSync:ye}=j===void 0?{}:j,xe=Z.actionData!=null&&Z.navigation.formMethod!=null&&ta(Z.navigation.formMethod)&&Z.navigation.state==="loading"&&((Y=k.state)==null?void 0:Y._isRedirect)!==!0,he;F.actionData?Object.keys(F.actionData).length>0?he=F.actionData:he=null:xe?he=Z.actionData:he=null;let Se=F.loaderData?Ww(Z.loaderData,F.loaderData,F.matches||[],F.errors):Z.loaderData,Ne=Z.blockers;Ne.size>0&&(Ne=new Map(Ne),Ne.forEach((yt,Ht)=>Ne.set(Ht,$d)));let Ge=be===!0||Z.navigation.formMethod!=null&&ta(Z.navigation.formMethod)&&((ue=k.state)==null?void 0:ue._isRedirect)!==!0;c&&(f=c,c=void 0),Te||te===Bi.Pop||(te===Bi.Push?n.history.push(k,k.state):te===Bi.Replace&&n.history.replace(k,k.state));let ze;if(te===Bi.Pop){let yt=Pe.get(Z.location.pathname);yt&&yt.has(k.pathname)?ze={currentLocation:Z.location,nextLocation:k}:Pe.has(k.pathname)&&(ze={currentLocation:k,nextLocation:Z.location})}else if(K){let yt=Pe.get(Z.location.pathname);yt?yt.add(k.pathname):(yt=new Set([k.pathname]),Pe.set(Z.location.pathname,yt)),ze={currentLocation:Z.location,nextLocation:k}}Fe(Li({},F,{actionData:he,loaderData:Se,historyAction:te,location:k,initialized:!0,navigation:$y,revalidation:"idle",restoreScrollPosition:wt(k,F.matches||Z.matches),preventScrollReset:Ge,blockers:Ne}),{viewTransitionOpts:ze,flushSync:ye===!0}),te=Bi.Pop,be=!1,K=!1,Te=!1,je=!1,it=[],ut=[]}async function an(k,F){if(typeof k=="number"){n.history.go(k);return}let j=Pv(Z.location,Z.matches,v,w.v7_prependBasename,k,w.v7_relativeSplatPath,F==null?void 0:F.fromRouteId,F==null?void 0:F.relative),{path:Y,submission:ue,error:ye}=Ow(w.v7_normalizeFormMethod,!1,j,F),xe=Z.location,he=Nf(Z.location,Y,F&&F.state);he=Li({},he,n.history.encodeLocation(he));let Se=F&&F.replace!=null?F.replace:void 0,Ne=Bi.Push;Se===!0?Ne=Bi.Replace:Se===!1||ue!=null&&ta(ue.formMethod)&&ue.formAction===Z.location.pathname+Z.location.search&&(Ne=Bi.Replace);let Ge=F&&"preventScrollReset"in F?F.preventScrollReset===!0:void 0,ze=(F&&F.unstable_flushSync)===!0,yt=Lt({currentLocation:xe,nextLocation:he,historyAction:Ne});if(yt){Rt(yt,{state:"blocked",location:he,proceed(){Rt(yt,{state:"proceeding",proceed:void 0,reset:void 0,location:he}),an(k,F)},reset(){let Ht=new Map(Z.blockers);Ht.set(yt,$d),Fe({blockers:Ht})}});return}return await Wt(Ne,he,{submission:ue,pendingError:ye,preventScrollReset:Ge,replace:F&&F.replace,enableViewTransition:F&&F.unstable_viewTransition,flushSync:ze})}function Vn(){if(nn(),Fe({revalidation:"loading"}),Z.navigation.state!=="submitting"){if(Z.navigation.state==="idle"){Wt(Z.historyAction,Z.location,{startUninterruptedRevalidation:!0});return}Wt(te||Z.historyAction,Z.navigation.location,{overrideNavigation:Z.navigation})}}async function Wt(k,F,j){ae&&ae.abort(),ae=null,te=k,Te=(j&&j.startUninterruptedRevalidation)===!0,rt(Z.location,Z.matches),be=(j&&j.preventScrollReset)===!0,K=(j&&j.enableViewTransition)===!0;let Y=c||f,ue=j&&j.overrideNavigation,ye=Zu(Y,F,v),xe=(j&&j.flushSync)===!0;if(!ye){let Ht=Rs(404,{pathname:F.pathname}),{matches:qt,route:sn}=$w(Y);Ot(),dn(F,{matches:qt,loaderData:{},errors:{[sn.id]:Ht}},{flushSync:xe});return}if(Z.initialized&&!je&&ML(Z.location,F)&&!(j&&j.submission&&ta(j.submission.formMethod))){dn(F,{matches:ye},{flushSync:xe});return}ae=new AbortController;let he=qd(n.history,F,ae.signal,j&&j.submission),Se,Ne;if(j&&j.pendingError)Ne={[yf(ye).route.id]:j.pendingError};else if(j&&j.submission&&ta(j.submission.formMethod)){let Ht=await En(he,F,j.submission,ye,{replace:j.replace,flushSync:xe});if(Ht.shortCircuited)return;Se=Ht.pendingActionData,Ne=Ht.pendingActionError,ue=Xy(F,j.submission),xe=!1,he=new Request(he.url,{signal:he.signal})}let{shortCircuited:Ge,loaderData:ze,errors:yt}=await J(he,F,ye,ue,j&&j.submission,j&&j.fetcherSubmission,j&&j.replace,j&&j.initialHydration===!0,xe,Se,Ne);Ge||(ae=null,dn(F,Li({matches:ye},Se?{actionData:Se}:{},{loaderData:ze,errors:yt})))}async function En(k,F,j,Y,ue){ue===void 0&&(ue={}),nn();let ye=CL(F,j);Fe({navigation:ye},{flushSync:ue.flushSync===!0});let xe,he=Iv(Y,F);if(!he.route.action&&!he.route.lazy)xe={type:Ri.error,error:Rs(405,{method:k.method,pathname:F.pathname,routeId:he.route.id})};else if(xe=await Xd("action",k,he,Y,h,o,v,w.v7_relativeSplatPath),k.signal.aborted)return{shortCircuited:!0};if(hc(xe)){let Se;return ue&&ue.replace!=null?Se=ue.replace:Se=xe.location===Z.location.pathname+Z.location.search,await at(Z,xe,{submission:j,replace:Se}),{shortCircuited:!0}}if(Yu(xe)){let Se=yf(Y,he.route.id);return(ue&&ue.replace)!==!0&&(te=Bi.Push),{pendingActionData:{},pendingActionError:{[Se.route.id]:xe.error}}}if(uc(xe))throw Rs(400,{type:"defer-action"});return{pendingActionData:{[he.route.id]:xe.data}}}async function J(k,F,j,Y,ue,ye,xe,he,Se,Ne,Ge){let ze=Y||Xy(F,ue),yt=ue||ye||Zw(ze),Ht=c||f,[qt,sn]=Bw(n.history,Z,j,yt,F,w.v7_partialHydration&&he===!0,je,it,ut,Ze,kt,pt,Ht,v,Ne,Ge);if(Ot(bt=>!(j&&j.some(Bt=>Bt.route.id===bt))||qt&&qt.some(Bt=>Bt.route.id===bt)),Ke=++Ce,qt.length===0&&sn.length===0){let bt=Nt();return dn(F,Li({matches:j,loaderData:{},errors:Ge||null},Ne?{actionData:Ne}:{},bt?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Se}),{shortCircuited:!0}}if(!Te&&(!w.v7_partialHydration||!he)){sn.forEach(Bt=>{let ln=Z.fetchers.get(Bt.key),Ft=Zd(void 0,ln?ln.data:void 0);Z.fetchers.set(Bt.key,Ft)});let bt=Ne||Z.actionData;Fe(Li({navigation:ze},bt?Object.keys(bt).length===0?{actionData:null}:{actionData:bt}:{},sn.length>0?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Se})}sn.forEach(bt=>{st.has(bt.key)&&qe(bt.key),bt.controller&&st.set(bt.key,bt.controller)});let on=()=>sn.forEach(bt=>qe(bt.key));ae&&ae.signal.addEventListener("abort",on);let{results:Hn,loaderResults:zn,fetcherResults:oe}=await ft(Z.matches,j,qt,sn,k);if(k.signal.aborted)return{shortCircuited:!0};ae&&ae.signal.removeEventListener("abort",on),sn.forEach(bt=>st.delete(bt.key));let Ee=Xw(Hn);if(Ee){if(Ee.idx>=qt.length){let bt=sn[Ee.idx-qt.length].key;pt.add(bt)}return await at(Z,Ee.result,{replace:xe}),{shortCircuited:!0}}let{loaderData:Ue,errors:Be}=jw(Z,j,qt,zn,Ge,sn,oe,_t);_t.forEach((bt,Bt)=>{bt.subscribe(ln=>{(ln||bt.done)&&_t.delete(Bt)})}),w.v7_partialHydration&&he&&Z.errors&&Object.entries(Z.errors).filter(bt=>{let[Bt]=bt;return!qt.some(ln=>ln.route.id===Bt)}).forEach(bt=>{let[Bt,ln]=bt;Be=Object.assign(Be||{},{[Bt]:ln})});let Ve=Nt(),vt=bn(Ke),jt=Ve||vt||sn.length>0;return Li({loaderData:Ue,errors:Be},jt?{fetchers:new Map(Z.fetchers)}:{})}function re(k,F,j,Y){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");st.has(k)&&qe(k);let ue=(Y&&Y.unstable_flushSync)===!0,ye=c||f,xe=Pv(Z.location,Z.matches,v,w.v7_prependBasename,j,w.v7_relativeSplatPath,F,Y==null?void 0:Y.relative),he=Zu(ye,xe,v);if(!he){Kt(k,F,Rs(404,{pathname:xe}),{flushSync:ue});return}let{path:Se,submission:Ne,error:Ge}=Ow(w.v7_normalizeFormMethod,!0,xe,Y);if(Ge){Kt(k,F,Ge,{flushSync:ue});return}let ze=Iv(he,Se);if(be=(Y&&Y.preventScrollReset)===!0,Ne&&ta(Ne.formMethod)){Je(k,F,Se,ze,he,ue,Ne);return}kt.set(k,{routeId:F,path:Se}),Xe(k,F,Se,ze,he,ue,Ne)}async function Je(k,F,j,Y,ue,ye,xe){if(nn(),kt.delete(k),!Y.route.action&&!Y.route.lazy){let Bt=Rs(405,{method:xe.formMethod,pathname:j,routeId:F});Kt(k,F,Bt,{flushSync:ye});return}let he=Z.fetchers.get(k);mt(k,PL(xe,he),{flushSync:ye});let Se=new AbortController,Ne=qd(n.history,j,Se.signal,xe);st.set(k,Se);let Ge=Ce,ze=await Xd("action",Ne,Y,ue,h,o,v,w.v7_relativeSplatPath);if(Ne.signal.aborted){st.get(k)===Se&&st.delete(k);return}if(w.v7_fetcherPersist&&Ze.has(k)){if(hc(ze)||Yu(ze)){mt(k,Yo(void 0));return}}else{if(hc(ze))if(st.delete(k),Ke>Ge){mt(k,Yo(void 0));return}else return pt.add(k),mt(k,Zd(xe)),at(Z,ze,{fetcherSubmission:xe});if(Yu(ze)){Kt(k,F,ze.error);return}}if(uc(ze))throw Rs(400,{type:"defer-action"});let yt=Z.navigation.location||Z.location,Ht=qd(n.history,yt,Se.signal),qt=c||f,sn=Z.navigation.state!=="idle"?Zu(qt,Z.navigation.location,v):Z.matches;Fn(sn,"Didn't find any matches after fetcher action");let on=++Ce;Ye.set(k,on);let Hn=Zd(xe,ze.data);Z.fetchers.set(k,Hn);let[zn,oe]=Bw(n.history,Z,sn,xe,yt,!1,je,it,ut,Ze,kt,pt,qt,v,{[Y.route.id]:ze.data},void 0);oe.filter(Bt=>Bt.key!==k).forEach(Bt=>{let ln=Bt.key,Ft=Z.fetchers.get(ln),vn=Zd(void 0,Ft?Ft.data:void 0);Z.fetchers.set(ln,vn),st.has(ln)&&qe(ln),Bt.controller&&st.set(ln,Bt.controller)}),Fe({fetchers:new Map(Z.fetchers)});let Ee=()=>oe.forEach(Bt=>qe(Bt.key));Se.signal.addEventListener("abort",Ee);let{results:Ue,loaderResults:Be,fetcherResults:Ve}=await ft(Z.matches,sn,zn,oe,Ht);if(Se.signal.aborted)return;Se.signal.removeEventListener("abort",Ee),Ye.delete(k),st.delete(k),oe.forEach(Bt=>st.delete(Bt.key));let vt=Xw(Ue);if(vt){if(vt.idx>=zn.length){let Bt=oe[vt.idx-zn.length].key;pt.add(Bt)}return at(Z,vt.result)}let{loaderData:jt,errors:bt}=jw(Z,Z.matches,zn,Be,void 0,oe,Ve,_t);if(Z.fetchers.has(k)){let Bt=Yo(ze.data);Z.fetchers.set(k,Bt)}bn(on),Z.navigation.state==="loading"&&on>Ke?(Fn(te,"Expected pending action"),ae&&ae.abort(),dn(Z.navigation.location,{matches:sn,loaderData:jt,errors:bt,fetchers:new Map(Z.fetchers)})):(Fe({errors:bt,loaderData:Ww(Z.loaderData,jt,sn,bt),fetchers:new Map(Z.fetchers)}),je=!1)}async function Xe(k,F,j,Y,ue,ye,xe){let he=Z.fetchers.get(k);mt(k,Zd(xe,he?he.data:void 0),{flushSync:ye});let Se=new AbortController,Ne=qd(n.history,j,Se.signal);st.set(k,Se);let Ge=Ce,ze=await Xd("loader",Ne,Y,ue,h,o,v,w.v7_relativeSplatPath);if(uc(ze)&&(ze=await b2(ze,Ne.signal,!0)||ze),st.get(k)===Se&&st.delete(k),!Ne.signal.aborted){if(Ze.has(k)){mt(k,Yo(void 0));return}if(hc(ze))if(Ke>Ge){mt(k,Yo(void 0));return}else{pt.add(k),await at(Z,ze);return}if(Yu(ze)){Kt(k,F,ze.error);return}Fn(!uc(ze),"Unhandled fetcher deferred data"),mt(k,Yo(ze.data))}}async function at(k,F,j){let{submission:Y,fetcherSubmission:ue,replace:ye}=j===void 0?{}:j;F.revalidate&&(je=!0);let xe=Nf(k.location,F.location,{_isRedirect:!0});if(Fn(xe,"Expected a location on the redirect navigation"),t){let yt=!1;if(F.reloadDocument)yt=!0;else if(_2.test(F.location)){const Ht=n.history.createURL(F.location);yt=Ht.origin!==e.location.origin||ho(Ht.pathname,v)==null}if(yt){ye?e.location.replace(F.location):e.location.assign(F.location);return}}ae=null;let he=ye===!0?Bi.Replace:Bi.Push,{formMethod:Se,formAction:Ne,formEncType:Ge}=k.navigation;!Y&&!ue&&Se&&Ne&&Ge&&(Y=Zw(k.navigation));let ze=Y||ue;if(gL.has(F.status)&&ze&&ta(ze.formMethod))await Wt(he,xe,{submission:Li({},ze,{formAction:F.location}),preventScrollReset:be});else{let yt=Xy(xe,Y);await Wt(he,xe,{overrideNavigation:yt,fetcherSubmission:ue,preventScrollReset:be})}}async function ft(k,F,j,Y,ue){let ye=await Promise.all([...j.map(Se=>Xd("loader",ue,Se,F,h,o,v,w.v7_relativeSplatPath)),...Y.map(Se=>Se.matches&&Se.match&&Se.controller?Xd("loader",qd(n.history,Se.path,Se.controller.signal),Se.match,Se.matches,h,o,v,w.v7_relativeSplatPath):{type:Ri.error,error:Rs(404,{pathname:Se.path})})]),xe=ye.slice(0,j.length),he=ye.slice(j.length);return await Promise.all([qw(k,j,xe,xe.map(()=>ue.signal),!1,Z.loaderData),qw(k,Y.map(Se=>Se.match),he,Y.map(Se=>Se.controller?Se.controller.signal:null),!0)]),{results:ye,loaderResults:xe,fetcherResults:he}}function nn(){je=!0,it.push(...Ot()),kt.forEach((k,F)=>{st.has(F)&&(ut.push(F),qe(F))})}function mt(k,F,j){j===void 0&&(j={}),Z.fetchers.set(k,F),Fe({fetchers:new Map(Z.fetchers)},{flushSync:(j&&j.flushSync)===!0})}function Kt(k,F,j,Y){Y===void 0&&(Y={});let ue=yf(Z.matches,F);Tt(k),Fe({errors:{[ue.route.id]:j},fetchers:new Map(Z.fetchers)},{flushSync:(Y&&Y.flushSync)===!0})}function rn(k){return w.v7_fetcherPersist&&(_n.set(k,(_n.get(k)||0)+1),Ze.has(k)&&Ze.delete(k)),Z.fetchers.get(k)||_L}function Tt(k){let F=Z.fetchers.get(k);st.has(k)&&!(F&&F.state==="loading"&&Ye.has(k))&&qe(k),kt.delete(k),Ye.delete(k),pt.delete(k),Ze.delete(k),Z.fetchers.delete(k)}function $t(k){if(w.v7_fetcherPersist){let F=(_n.get(k)||0)-1;F<=0?(_n.delete(k),Ze.add(k)):_n.set(k,F)}else Tt(k);Fe({fetchers:new Map(Z.fetchers)})}function qe(k){let F=st.get(k);Fn(F,"Expected fetch controller: "+k),F.abort(),st.delete(k)}function Gt(k){for(let F of k){let j=rn(F),Y=Yo(j.data);Z.fetchers.set(F,Y)}}function Nt(){let k=[],F=!1;for(let j of pt){let Y=Z.fetchers.get(j);Fn(Y,"Expected fetcher: "+j),Y.state==="loading"&&(pt.delete(j),k.push(j),F=!0)}return Gt(k),F}function bn(k){let F=[];for(let[j,Y]of Ye)if(Y<k){let ue=Z.fetchers.get(j);Fn(ue,"Expected fetcher: "+j),ue.state==="loading"&&(qe(j),Ye.delete(j),F.push(j))}return Gt(F),F.length>0}function wn(k,F){let j=Z.blockers.get(k)||$d;return Ct.get(k)!==F&&Ct.set(k,F),j}function nt(k){Z.blockers.delete(k),Ct.delete(k)}function Rt(k,F){let j=Z.blockers.get(k)||$d;Fn(j.state==="unblocked"&&F.state==="blocked"||j.state==="blocked"&&F.state==="blocked"||j.state==="blocked"&&F.state==="proceeding"||j.state==="blocked"&&F.state==="unblocked"||j.state==="proceeding"&&F.state==="unblocked","Invalid blocker state transition: "+j.state+" -> "+F.state);let Y=new Map(Z.blockers);Y.set(k,F),Fe({blockers:Y})}function Lt(k){let{currentLocation:F,nextLocation:j,historyAction:Y}=k;if(Ct.size===0)return;Ct.size>1&&yh(!1,"A router only supports one blocker at a time");let ue=Array.from(Ct.entries()),[ye,xe]=ue[ue.length-1],he=Z.blockers.get(ye);if(!(he&&he.state==="proceeding")&&xe({currentLocation:F,nextLocation:j,historyAction:Y}))return ye}function Ot(k){let F=[];return _t.forEach((j,Y)=>{(!k||k(Y))&&(j.cancel(),F.push(Y),_t.delete(Y))}),F}function $(k,F,j){if(M=k,U=F,L=j||null,!B&&Z.navigation===$y){B=!0;let Y=wt(Z.location,Z.matches);Y!=null&&Fe({restoreScrollPosition:Y})}return()=>{M=null,U=null,L=null}}function Le(k,F){return L&&L(k,F.map(Y=>qI(Y,Z.loaderData)))||k.key}function rt(k,F){if(M&&U){let j=Le(k,F);M[j]=U()}}function wt(k,F){if(M){let j=Le(k,F),Y=M[j];if(typeof Y=="number")return Y}return null}function se(k){h={},c=Av(k,o,void 0,h)}return fe={get basename(){return v},get future(){return w},get state(){return Z},get routes(){return f},get window(){return e},initialize:un,subscribe:yn,enableScrollRestoration:$,navigate:an,fetch:re,revalidate:Vn,createHref:k=>n.history.createHref(k),encodeLocation:k=>n.history.encodeLocation(k),getFetcher:rn,deleteFetcher:$t,dispose:mn,getBlocker:wn,deleteBlocker:nt,_internalFetchControllers:st,_internalActiveDeferreds:_t,_internalSetRoutes:se},fe}function xL(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function Pv(n,e,t,i,o,h,f,c){let v,w;if(f){v=[];for(let E of e)if(v.push(E),E.route.id===f){w=E;break}}else v=e,w=e[e.length-1];let S=Nx(o||".",Ux(v,h),ho(n.pathname,t)||n.pathname,c==="path");return o==null&&(S.search=n.search,S.hash=n.hash),(o==null||o===""||o===".")&&w&&w.route.index&&!Bx(S.search)&&(S.search=S.search?S.search.replace(/^\?/,"?index&"):"?index"),i&&t!=="/"&&(S.pathname=S.pathname==="/"?t:ao([t,S.pathname])),bc(S)}function Ow(n,e,t,i){if(!i||!xL(i))return{path:t};if(i.formMethod&&!AL(i.formMethod))return{path:t,error:Rs(405,{method:i.formMethod})};let o=()=>({path:t,error:Rs(400,{type:"invalid-body"})}),h=i.formMethod||"get",f=n?h.toUpperCase():h.toLowerCase(),c=x2(t);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!ta(f))return o();let M=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((L,U)=>{let[B,z]=U;return""+L+B+"="+z+`
`},""):String(i.body);return{path:t,submission:{formMethod:f,formAction:c,formEncType:i.formEncType,formData:void 0,json:void 0,text:M}}}else if(i.formEncType==="application/json"){if(!ta(f))return o();try{let M=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:t,submission:{formMethod:f,formAction:c,formEncType:i.formEncType,formData:void 0,json:M,text:void 0}}}catch{return o()}}}Fn(typeof FormData=="function","FormData is not available in this environment");let v,w;if(i.formData)v=Rv(i.formData),w=i.formData;else if(i.body instanceof FormData)v=Rv(i.body),w=i.body;else if(i.body instanceof URLSearchParams)v=i.body,w=Hw(v);else if(i.body==null)v=new URLSearchParams,w=new FormData;else try{v=new URLSearchParams(i.body),w=Hw(v)}catch{return o()}let S={formMethod:f,formAction:c,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:w,json:void 0,text:void 0};if(ta(S.formMethod))return{path:t,submission:S};let E=mo(t);return e&&E.search&&Bx(E.search)&&v.append("index",""),E.search="?"+v,{path:bc(E),submission:S}}function bL(n,e){let t=n;if(e){let i=n.findIndex(o=>o.route.id===e);i>=0&&(t=n.slice(0,i))}return t}function Bw(n,e,t,i,o,h,f,c,v,w,S,E,M,L,U,B){let z=B?Object.values(B)[0]:U?Object.values(U)[0]:void 0,R=n.createURL(e.location),G=n.createURL(o),V=B?Object.keys(B)[0]:void 0,fe=bL(t,V).filter((te,be)=>{let{route:ae}=te;if(ae.lazy)return!0;if(ae.loader==null)return!1;if(h)return ae.loader.hydrate?!0:e.loaderData[ae.id]===void 0&&(!e.errors||e.errors[ae.id]===void 0);if(wL(e.loaderData,e.matches[be],te)||c.some(ke=>ke===te.route.id))return!0;let K=e.matches[be],Pe=te;return Vw(te,Li({currentUrl:R,currentParams:K.params,nextUrl:G,nextParams:Pe.params},i,{actionResult:z,defaultShouldRevalidate:f||R.pathname+R.search===G.pathname+G.search||R.search!==G.search||v2(K,Pe)}))}),Z=[];return S.forEach((te,be)=>{if(h||!t.some(Te=>Te.route.id===te.routeId)||w.has(be))return;let ae=Zu(M,te.path,L);if(!ae){Z.push({key:be,routeId:te.routeId,path:te.path,matches:null,match:null,controller:null});return}let K=e.fetchers.get(be),Pe=Iv(ae,te.path),ke=!1;E.has(be)?ke=!1:v.includes(be)?ke=!0:K&&K.state!=="idle"&&K.data===void 0?ke=f:ke=Vw(Pe,Li({currentUrl:R,currentParams:e.matches[e.matches.length-1].params,nextUrl:G,nextParams:t[t.length-1].params},i,{actionResult:z,defaultShouldRevalidate:f})),ke&&Z.push({key:be,routeId:te.routeId,path:te.path,matches:ae,match:Pe,controller:new AbortController})}),[fe,Z]}function wL(n,e,t){let i=!e||t.route.id!==e.route.id,o=n[t.route.id]===void 0;return i||o}function v2(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function Vw(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}async function Gw(n,e,t){if(!n.lazy)return;let i=await n.lazy();if(!n.lazy)return;let o=t[n.id];Fn(o,"No route found in manifest");let h={};for(let f in i){let v=o[f]!==void 0&&f!=="hasErrorBoundary";yh(!v,'Route "'+o.id+'" has a static property "'+f+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+f+'" will be ignored.')),!v&&!$I.has(f)&&(h[f]=i[f])}Object.assign(o,h),Object.assign(o,Li({},e(o),{lazy:void 0}))}async function Xd(n,e,t,i,o,h,f,c,v){v===void 0&&(v={});let w,S,E,M=B=>{let z,R=new Promise((G,V)=>z=V);return E=()=>z(),e.signal.addEventListener("abort",E),Promise.race([B({request:e,params:t.params,context:v.requestContext}),R])};try{let B=t.route[n];if(t.route.lazy)if(B){let z,R=await Promise.all([M(B).catch(G=>{z=G}),Gw(t.route,h,o)]);if(z)throw z;S=R[0]}else if(await Gw(t.route,h,o),B=t.route[n],B)S=await M(B);else if(n==="action"){let z=new URL(e.url),R=z.pathname+z.search;throw Rs(405,{method:e.method,pathname:R,routeId:t.route.id})}else return{type:Ri.data,data:void 0};else if(B)S=await M(B);else{let z=new URL(e.url),R=z.pathname+z.search;throw Rs(404,{pathname:R})}Fn(S!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(B){w=Ri.error,S=B}finally{E&&e.signal.removeEventListener("abort",E)}if(EL(S)){let B=S.status;if(mL.has(B)){let R=S.headers.get("Location");if(Fn(R,"Redirects returned/thrown from loaders/actions must have a Location header"),!_2.test(R))R=Pv(new URL(e.url),i.slice(0,i.indexOf(t)+1),f,!0,R,c);else if(!v.isStaticRequest){let G=new URL(e.url),V=R.startsWith("//")?new URL(G.protocol+R):new URL(R),ee=ho(V.pathname,f)!=null;V.origin===G.origin&&ee&&(R=V.pathname+V.search+V.hash)}if(v.isStaticRequest)throw S.headers.set("Location",R),S;return{type:Ri.redirect,status:B,location:R,revalidate:S.headers.get("X-Remix-Revalidate")!==null,reloadDocument:S.headers.get("X-Remix-Reload-Document")!==null}}if(v.isRouteRequest)throw{type:w===Ri.error?Ri.error:Ri.data,response:S};let z;try{let R=S.headers.get("Content-Type");R&&/\bapplication\/json\b/.test(R)?S.body==null?z=null:z=await S.json():z=await S.text()}catch(R){return{type:Ri.error,error:R}}return w===Ri.error?{type:w,error:new Ox(B,S.statusText,z),headers:S.headers}:{type:Ri.data,data:z,statusCode:S.status,headers:S.headers}}if(w===Ri.error)return{type:w,error:S};if(TL(S)){var L,U;return{type:Ri.deferred,deferredData:S,statusCode:(L=S.init)==null?void 0:L.status,headers:((U=S.init)==null?void 0:U.headers)&&new Headers(S.init.headers)}}return{type:Ri.data,data:S}}function qd(n,e,t,i){let o=n.createURL(x2(e)).toString(),h={signal:t};if(i&&ta(i.formMethod)){let{formMethod:f,formEncType:c}=i;h.method=f.toUpperCase(),c==="application/json"?(h.headers=new Headers({"Content-Type":c}),h.body=JSON.stringify(i.json)):c==="text/plain"?h.body=i.text:c==="application/x-www-form-urlencoded"&&i.formData?h.body=Rv(i.formData):h.body=i.formData}return new Request(o,h)}function Rv(n){let e=new URLSearchParams;for(let[t,i]of n.entries())e.append(t,typeof i=="string"?i:i.name);return e}function Hw(n){let e=new FormData;for(let[t,i]of n.entries())e.append(t,i);return e}function SL(n,e,t,i,o){let h={},f=null,c,v=!1,w={};return t.forEach((S,E)=>{let M=e[E].route.id;if(Fn(!hc(S),"Cannot handle redirect results in processLoaderData"),Yu(S)){let L=yf(n,M),U=S.error;i&&(U=Object.values(i)[0],i=void 0),f=f||{},f[L.route.id]==null&&(f[L.route.id]=U),h[M]=void 0,v||(v=!0,c=m2(S.error)?S.error.status:500),S.headers&&(w[M]=S.headers)}else uc(S)?(o.set(M,S.deferredData),h[M]=S.deferredData.data):h[M]=S.data,S.statusCode!=null&&S.statusCode!==200&&!v&&(c=S.statusCode),S.headers&&(w[M]=S.headers)}),i&&(f=i,h[Object.keys(i)[0]]=void 0),{loaderData:h,errors:f,statusCode:c||200,loaderHeaders:w}}function jw(n,e,t,i,o,h,f,c){let{loaderData:v,errors:w}=SL(e,t,i,o,c);for(let S=0;S<h.length;S++){let{key:E,match:M,controller:L}=h[S];Fn(f!==void 0&&f[S]!==void 0,"Did not find corresponding fetcher result");let U=f[S];if(!(L&&L.signal.aborted))if(Yu(U)){let B=yf(n.matches,M==null?void 0:M.route.id);w&&w[B.route.id]||(w=Li({},w,{[B.route.id]:U.error})),n.fetchers.delete(E)}else if(hc(U))Fn(!1,"Unhandled fetcher revalidation redirect");else if(uc(U))Fn(!1,"Unhandled fetcher deferred data");else{let B=Yo(U.data);n.fetchers.set(E,B)}}return{loaderData:v,errors:w}}function Ww(n,e,t,i){let o=Li({},e);for(let h of t){let f=h.route.id;if(e.hasOwnProperty(f)?e[f]!==void 0&&(o[f]=e[f]):n[f]!==void 0&&h.route.loader&&(o[f]=n[f]),i&&i.hasOwnProperty(f))break}return o}function yf(n,e){return(e?n.slice(0,n.findIndex(i=>i.route.id===e)+1):[...n]).reverse().find(i=>i.route.hasErrorBoundary===!0)||n[0]}function $w(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Rs(n,e){let{pathname:t,routeId:i,method:o,type:h}=e===void 0?{}:e,f="Unknown Server Error",c="Unknown @remix-run/router error";return n===400?(f="Bad Request",o&&t&&i?c="You made a "+o+' request to "'+t+'" but '+('did not provide a `loader` for route "'+i+'", ')+"so there is no way to handle the request.":h==="defer-action"?c="defer() is not supported in actions":h==="invalid-body"&&(c="Unable to encode submission body")):n===403?(f="Forbidden",c='Route "'+i+'" does not match URL "'+t+'"'):n===404?(f="Not Found",c='No route matches URL "'+t+'"'):n===405&&(f="Method Not Allowed",o&&t&&i?c="You made a "+o.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+i+'", ')+"so there is no way to handle the request.":o&&(c='Invalid request method "'+o.toUpperCase()+'"')),new Ox(n||500,f,new Error(c),!0)}function Xw(n){for(let e=n.length-1;e>=0;e--){let t=n[e];if(hc(t))return{result:t,idx:e}}}function x2(n){let e=typeof n=="string"?mo(n):n;return bc(Li({},e,{hash:""}))}function ML(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function uc(n){return n.type===Ri.deferred}function Yu(n){return n.type===Ri.error}function hc(n){return(n&&n.type)===Ri.redirect}function TL(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function EL(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function AL(n){return pL.has(n.toLowerCase())}function ta(n){return dL.has(n.toLowerCase())}async function qw(n,e,t,i,o,h){for(let f=0;f<t.length;f++){let c=t[f],v=e[f];if(!v)continue;let w=n.find(E=>E.route.id===v.route.id),S=w!=null&&!v2(w,v)&&(h&&h[v.route.id])!==void 0;if(uc(c)&&(o||S)){let E=i[f];Fn(E,"Expected an AbortSignal for revalidating fetcher deferred result"),await b2(c,E,o).then(M=>{M&&(t[f]=M||t[f])})}}}async function b2(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:Ri.data,data:n.deferredData.unwrappedData}}catch(o){return{type:Ri.error,error:o}}return{type:Ri.data,data:n.deferredData.data}}}function Bx(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function Iv(n,e){let t=typeof e=="string"?mo(e).search:e.search;if(n[n.length-1].route.index&&Bx(t||""))return n[n.length-1];let i=p2(n);return i[i.length-1]}function Zw(n){let{formMethod:e,formAction:t,formEncType:i,text:o,formData:h,json:f}=n;if(!(!e||!t||!i)){if(o!=null)return{formMethod:e,formAction:t,formEncType:i,formData:void 0,json:void 0,text:o};if(h!=null)return{formMethod:e,formAction:t,formEncType:i,formData:h,json:void 0,text:void 0};if(f!==void 0)return{formMethod:e,formAction:t,formEncType:i,formData:void 0,json:f,text:void 0}}}function Xy(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function CL(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function Zd(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function PL(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function Yo(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function RL(n,e){try{let t=n.sessionStorage.getItem(y2);if(t){let i=JSON.parse(t);for(let[o,h]of Object.entries(i||{}))h&&Array.isArray(h)&&e.set(o,new Set(h||[]))}}catch{}}function IL(n,e){if(e.size>0){let t={};for(let[i,o]of e)t[i]=[...o];try{n.sessionStorage.setItem(y2,JSON.stringify(t))}catch(i){yh(!1,"Failed to save applied view transitions in sessionStorage ("+i+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Of(){return Of=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Of.apply(this,arguments)}const qf=ct.createContext(null),Vx=ct.createContext(null),Ml=ct.createContext(null),l_=ct.createContext(null),Tl=ct.createContext({outlet:null,matches:[],isDataRoute:!1}),w2=ct.createContext(null);function LL(n,e){let{relative:t}=e===void 0?{}:e;Zf()||Fn(!1);let{basename:i,navigator:o}=ct.useContext(Ml),{hash:h,pathname:f,search:c}=c_(n,{relative:t}),v=f;return i!=="/"&&(v=f==="/"?i:ao([i,f])),o.createHref({pathname:v,search:c,hash:h})}function Zf(){return ct.useContext(l_)!=null}function Yf(){return Zf()||Fn(!1),ct.useContext(l_).location}function S2(n){ct.useContext(Ml).static||ct.useLayoutEffect(n)}function Gx(){let{isDataRoute:n}=ct.useContext(Tl);return n?$L():DL()}function DL(){Zf()||Fn(!1);let n=ct.useContext(qf),{basename:e,future:t,navigator:i}=ct.useContext(Ml),{matches:o}=ct.useContext(Tl),{pathname:h}=Yf(),f=JSON.stringify(Ux(o,t.v7_relativeSplatPath)),c=ct.useRef(!1);return S2(()=>{c.current=!0}),ct.useCallback(function(w,S){if(S===void 0&&(S={}),!c.current)return;if(typeof w=="number"){i.go(w);return}let E=Nx(w,JSON.parse(f),h,S.relative==="path");n==null&&e!=="/"&&(E.pathname=E.pathname==="/"?e:ao([e,E.pathname])),(S.replace?i.replace:i.push)(E,S.state,S)},[e,i,f,h,n])}const zL=ct.createContext(null);function kL(n){let e=ct.useContext(Tl).outlet;return e&&ct.createElement(zL.Provider,{value:n},e)}function c_(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=ct.useContext(Ml),{matches:o}=ct.useContext(Tl),{pathname:h}=Yf(),f=JSON.stringify(Ux(o,i.v7_relativeSplatPath));return ct.useMemo(()=>Nx(n,JSON.parse(f),h,t==="path"),[n,f,h,t])}function FL(n,e,t,i){Zf()||Fn(!1);let{navigator:o}=ct.useContext(Ml),{matches:h}=ct.useContext(Tl),f=h[h.length-1],c=f?f.params:{};f&&f.pathname;let v=f?f.pathnameBase:"/";f&&f.route;let w=Yf(),S;if(e){var E;let z=typeof e=="string"?mo(e):e;v==="/"||(E=z.pathname)!=null&&E.startsWith(v)||Fn(!1),S=z}else S=w;let M=S.pathname||"/",L=M;if(v!=="/"){let z=v.replace(/^\//,"").split("/");L="/"+M.replace(/^\//,"").split("/").slice(z.length).join("/")}let U=Zu(n,{pathname:L}),B=VL(U&&U.map(z=>Object.assign({},z,{params:Object.assign({},c,z.params),pathname:ao([v,o.encodeLocation?o.encodeLocation(z.pathname).pathname:z.pathname]),pathnameBase:z.pathnameBase==="/"?v:ao([v,o.encodeLocation?o.encodeLocation(z.pathnameBase).pathname:z.pathnameBase])})),h,t,i);return e&&B?ct.createElement(l_.Provider,{value:{location:Of({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:Bi.Pop}},B):B}function UL(){let n=WL(),e=m2(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,o={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return ct.createElement(ct.Fragment,null,ct.createElement("h2",null,"Unexpected Application Error!"),ct.createElement("h3",{style:{fontStyle:"italic"}},e),t?ct.createElement("pre",{style:o},t):null,null)}const NL=ct.createElement(UL,null);class OL extends ct.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?ct.createElement(Tl.Provider,{value:this.props.routeContext},ct.createElement(w2.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function BL(n){let{routeContext:e,match:t,children:i}=n,o=ct.useContext(qf);return o&&o.static&&o.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(o.staticContext._deepestRenderedBoundaryId=t.route.id),ct.createElement(Tl.Provider,{value:e},i)}function VL(n,e,t,i){var o;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var h;if((h=t)!=null&&h.errors)n=t.matches;else return null}let f=n,c=(o=t)==null?void 0:o.errors;if(c!=null){let S=f.findIndex(E=>E.route.id&&(c==null?void 0:c[E.route.id]));S>=0||Fn(!1),f=f.slice(0,Math.min(f.length,S+1))}let v=!1,w=-1;if(t&&i&&i.v7_partialHydration)for(let S=0;S<f.length;S++){let E=f[S];if((E.route.HydrateFallback||E.route.hydrateFallbackElement)&&(w=S),E.route.id){let{loaderData:M,errors:L}=t,U=E.route.loader&&M[E.route.id]===void 0&&(!L||L[E.route.id]===void 0);if(E.route.lazy||U){v=!0,w>=0?f=f.slice(0,w+1):f=[f[0]];break}}}return f.reduceRight((S,E,M)=>{let L,U=!1,B=null,z=null;t&&(L=c&&E.route.id?c[E.route.id]:void 0,B=E.route.errorElement||NL,v&&(w<0&&M===0?(XL("route-fallback",!1),U=!0,z=null):w===M&&(U=!0,z=E.route.hydrateFallbackElement||null)));let R=e.concat(f.slice(0,M+1)),G=()=>{let V;return L?V=B:U?V=z:E.route.Component?V=ct.createElement(E.route.Component,null):E.route.element?V=E.route.element:V=S,ct.createElement(BL,{match:E,routeContext:{outlet:S,matches:R,isDataRoute:t!=null},children:V})};return t&&(E.route.ErrorBoundary||E.route.errorElement||M===0)?ct.createElement(OL,{location:t.location,revalidation:t.revalidation,component:B,error:L,children:G(),routeContext:{outlet:null,matches:R,isDataRoute:!0}}):G()},null)}var M2=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(M2||{}),Ng=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Ng||{});function GL(n){let e=ct.useContext(qf);return e||Fn(!1),e}function HL(n){let e=ct.useContext(Vx);return e||Fn(!1),e}function jL(n){let e=ct.useContext(Tl);return e||Fn(!1),e}function T2(n){let e=jL(),t=e.matches[e.matches.length-1];return t.route.id||Fn(!1),t.route.id}function WL(){var n;let e=ct.useContext(w2),t=HL(Ng.UseRouteError),i=T2(Ng.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function $L(){let{router:n}=GL(M2.UseNavigateStable),e=T2(Ng.UseNavigateStable),t=ct.useRef(!1);return S2(()=>{t.current=!0}),ct.useCallback(function(o,h){h===void 0&&(h={}),t.current&&(typeof o=="number"?n.navigate(o):n.navigate(o,Of({fromRouteId:e},h)))},[n,e])}const Yw={};function XL(n,e,t){!e&&!Yw[n]&&(Yw[n]=!0)}function qL(n){return kL(n.context)}function ZL(n){let{basename:e="/",children:t=null,location:i,navigationType:o=Bi.Pop,navigator:h,static:f=!1,future:c}=n;Zf()&&Fn(!1);let v=e.replace(/^\/*/,"/"),w=ct.useMemo(()=>({basename:v,navigator:h,static:f,future:Of({v7_relativeSplatPath:!1},c)}),[v,c,h,f]);typeof i=="string"&&(i=mo(i));let{pathname:S="/",search:E="",hash:M="",state:L=null,key:U="default"}=i,B=ct.useMemo(()=>{let z=ho(S,v);return z==null?null:{location:{pathname:z,search:E,hash:M,state:L,key:U},navigationType:o}},[v,S,E,M,L,U,o]);return B==null?null:ct.createElement(Ml.Provider,{value:w},ct.createElement(l_.Provider,{children:t,value:B}))}new Promise(()=>{});function YL(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:ct.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:ct.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:ct.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function vh(){return vh=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},vh.apply(this,arguments)}function E2(n,e){if(n==null)return{};var t={},i=Object.keys(n),o,h;for(h=0;h<i.length;h++)o=i[h],!(e.indexOf(o)>=0)&&(t[o]=n[o]);return t}function KL(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function JL(n,e){return n.button===0&&(!e||e==="_self")&&!KL(n)}const QL=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],eD=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],tD="6";try{window.__reactRouterVersion=tD}catch{}function nD(n,e){return vL({basename:e==null?void 0:e.basename,future:vh({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:HI({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||iD(),routes:n,mapRouteProperties:YL,window:e==null?void 0:e.window}).initialize()}function iD(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=vh({},e,{errors:rD(e.errors)})),e}function rD(n){if(!n)return null;let e=Object.entries(n),t={};for(let[i,o]of e)if(o&&o.__type==="RouteErrorResponse")t[i]=new Ox(o.status,o.statusText,o.data,o.internal===!0);else if(o&&o.__type==="Error"){if(o.__subType){let h=window[o.__subType];if(typeof h=="function")try{let f=new h(o.message);f.stack="",t[i]=f}catch{}}if(t[i]==null){let h=new Error(o.message);h.stack="",t[i]=h}}else t[i]=o;return t}const A2=ct.createContext({isTransitioning:!1}),sD=ct.createContext(new Map),aD="startTransition",Kw=IP[aD],oD="flushSync",Jw=GI[oD];function lD(n){Kw?Kw(n):n()}function Yd(n){Jw?Jw(n):n()}class cD{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=i=>{this.status==="pending"&&(this.status="resolved",e(i))},this.reject=i=>{this.status==="pending"&&(this.status="rejected",t(i))}})}}function uD(n){let{fallbackElement:e,router:t,future:i}=n,[o,h]=ct.useState(t.state),[f,c]=ct.useState(),[v,w]=ct.useState({isTransitioning:!1}),[S,E]=ct.useState(),[M,L]=ct.useState(),[U,B]=ct.useState(),z=ct.useRef(new Map),{v7_startTransition:R}=i||{},G=ct.useCallback(te=>{R?lD(te):te()},[R]),V=ct.useCallback((te,be)=>{let{deletedFetchers:ae,unstable_flushSync:K,unstable_viewTransitionOpts:Pe}=be;ae.forEach(Te=>z.current.delete(Te)),te.fetchers.forEach((Te,je)=>{Te.data!==void 0&&z.current.set(je,Te.data)});let ke=t.window==null||typeof t.window.document.startViewTransition!="function";if(!Pe||ke){K?Yd(()=>h(te)):G(()=>h(te));return}if(K){Yd(()=>{M&&(S&&S.resolve(),M.skipTransition()),w({isTransitioning:!0,flushSync:!0,currentLocation:Pe.currentLocation,nextLocation:Pe.nextLocation})});let Te=t.window.document.startViewTransition(()=>{Yd(()=>h(te))});Te.finished.finally(()=>{Yd(()=>{E(void 0),L(void 0),c(void 0),w({isTransitioning:!1})})}),Yd(()=>L(Te));return}M?(S&&S.resolve(),M.skipTransition(),B({state:te,currentLocation:Pe.currentLocation,nextLocation:Pe.nextLocation})):(c(te),w({isTransitioning:!0,flushSync:!1,currentLocation:Pe.currentLocation,nextLocation:Pe.nextLocation}))},[t.window,M,S,z,G]);ct.useLayoutEffect(()=>t.subscribe(V),[t,V]),ct.useEffect(()=>{v.isTransitioning&&!v.flushSync&&E(new cD)},[v]),ct.useEffect(()=>{if(S&&f&&t.window){let te=f,be=S.promise,ae=t.window.document.startViewTransition(async()=>{G(()=>h(te)),await be});ae.finished.finally(()=>{E(void 0),L(void 0),c(void 0),w({isTransitioning:!1})}),L(ae)}},[G,f,S,t.window]),ct.useEffect(()=>{S&&f&&o.location.key===f.location.key&&S.resolve()},[S,M,o.location,f]),ct.useEffect(()=>{!v.isTransitioning&&U&&(c(U.state),w({isTransitioning:!0,flushSync:!1,currentLocation:U.currentLocation,nextLocation:U.nextLocation}),B(void 0))},[v.isTransitioning,U]),ct.useEffect(()=>{},[]);let ee=ct.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:te=>t.navigate(te),push:(te,be,ae)=>t.navigate(te,{state:be,preventScrollReset:ae==null?void 0:ae.preventScrollReset}),replace:(te,be,ae)=>t.navigate(te,{replace:!0,state:be,preventScrollReset:ae==null?void 0:ae.preventScrollReset})}),[t]),fe=t.basename||"/",Z=ct.useMemo(()=>({router:t,navigator:ee,static:!1,basename:fe}),[t,ee,fe]);return ct.createElement(ct.Fragment,null,ct.createElement(qf.Provider,{value:Z},ct.createElement(Vx.Provider,{value:o},ct.createElement(sD.Provider,{value:z.current},ct.createElement(A2.Provider,{value:v},ct.createElement(ZL,{basename:fe,location:o.location,navigationType:o.historyAction,navigator:ee,future:{v7_relativeSplatPath:t.future.v7_relativeSplatPath}},o.initialized||t.future.v7_partialHydration?ct.createElement(hD,{routes:t.routes,future:t.future,state:o}):e))))),null)}function hD(n){let{routes:e,future:t,state:i}=n;return FL(e,void 0,i,t)}const dD=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",fD=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Lv=ct.forwardRef(function(e,t){let{onClick:i,relative:o,reloadDocument:h,replace:f,state:c,target:v,to:w,preventScrollReset:S,unstable_viewTransition:E}=e,M=E2(e,QL),{basename:L}=ct.useContext(Ml),U,B=!1;if(typeof w=="string"&&fD.test(w)&&(U=w,dD))try{let V=new URL(window.location.href),ee=w.startsWith("//")?new URL(V.protocol+w):new URL(w),fe=ho(ee.pathname,L);ee.origin===V.origin&&fe!=null?w=fe+ee.search+ee.hash:B=!0}catch{}let z=LL(w,{relative:o}),R=mD(w,{replace:f,state:c,target:v,preventScrollReset:S,relative:o,unstable_viewTransition:E});function G(V){i&&i(V),V.defaultPrevented||R(V)}return ct.createElement("a",vh({},M,{href:U||z,onClick:B||h?i:G,ref:t,target:v}))}),Tm=ct.forwardRef(function(e,t){let{"aria-current":i="page",caseSensitive:o=!1,className:h="",end:f=!1,style:c,to:v,unstable_viewTransition:w,children:S}=e,E=E2(e,eD),M=c_(v,{relative:E.relative}),L=Yf(),U=ct.useContext(Vx),{navigator:B,basename:z}=ct.useContext(Ml),R=U!=null&&gD(M)&&w===!0,G=B.encodeLocation?B.encodeLocation(M).pathname:M.pathname,V=L.pathname,ee=U&&U.navigation&&U.navigation.location?U.navigation.location.pathname:null;o||(V=V.toLowerCase(),ee=ee?ee.toLowerCase():null,G=G.toLowerCase()),ee&&z&&(ee=ho(ee,z)||ee);const fe=G!=="/"&&G.endsWith("/")?G.length-1:G.length;let Z=V===G||!f&&V.startsWith(G)&&V.charAt(fe)==="/",te=ee!=null&&(ee===G||!f&&ee.startsWith(G)&&ee.charAt(G.length)==="/"),be={isActive:Z,isPending:te,isTransitioning:R},ae=Z?i:void 0,K;typeof h=="function"?K=h(be):K=[h,Z?"active":null,te?"pending":null,R?"transitioning":null].filter(Boolean).join(" ");let Pe=typeof c=="function"?c(be):c;return ct.createElement(Lv,vh({},E,{"aria-current":ae,className:K,ref:t,style:Pe,to:v,unstable_viewTransition:w}),typeof S=="function"?S(be):S)});var Dv;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(Dv||(Dv={}));var Qw;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(Qw||(Qw={}));function pD(n){let e=ct.useContext(qf);return e||Fn(!1),e}function mD(n,e){let{target:t,replace:i,state:o,preventScrollReset:h,relative:f,unstable_viewTransition:c}=e===void 0?{}:e,v=Gx(),w=Yf(),S=c_(n,{relative:f});return ct.useCallback(E=>{if(JL(E,t)){E.preventDefault();let M=i!==void 0?i:bc(w)===bc(S);v(n,{replace:M,state:o,preventScrollReset:h,relative:f,unstable_viewTransition:c})}},[w,v,S,i,o,t,n,h,f,c])}function gD(n,e){e===void 0&&(e={});let t=ct.useContext(A2);t==null&&Fn(!1);let{basename:i}=pD(Dv.useViewTransitionState),o=c_(n,{relative:e.relative});if(!t.isTransitioning)return!1;let h=ho(t.currentLocation.pathname,i)||t.currentLocation.pathname,f=ho(t.nextLocation.pathname,i)||t.nextLocation.pathname;return Cv(o.pathname,f)!=null||Cv(o.pathname,h)!=null}function C2(n){return ge.jsx("div",{className:"body",children:n.children})}function u_(n){return ge.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[ge.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:n.heroBackground}),ge.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",color:"var(--white)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:[ge.jsx("h1",{children:n.title}),ge.jsx("h3",{children:n.subtitle})]})]})}const xh=7;function _D(n,e){switch(e){case n.FLOAT:return 4;case n.UNSIGNED_BYTE:return 1;case n.BYTE:case n.SHORT:case n.UNSIGNED_SHORT:default:throw new Error(`Unknown type ${e}`)}}class eS{constructor(e,t){tt(this,"program");this.gl=e,this.config=t;const i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,t.vertexSource),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));const o=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(o,t.fragmentSource),e.compileShader(o),!e.getShaderParameter(o,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(o));const h=e.createProgram();if(e.attachShader(h,i),e.attachShader(h,o),t.transformFeedbackVaryings&&e.transformFeedbackVaryings(h,t.transformFeedbackVaryings,e.SEPARATE_ATTRIBS),e.linkProgram(h),!e.getProgramParameter(h,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(h));e.detachShader(h,i),e.deleteShader(i),e.detachShader(h,o),e.deleteShader(o),this.program=h}getAttributeLocation(e){return this.gl.getAttribLocation(this.program,e)}getUniformLocation(e){return this.gl.getUniformLocation(this.program,e)}setUniformValue(e,t,i){const o=this.gl,h=this.getUniformLocation(e);switch(t){case"bool":o.uniform1i(h,i[0]);break;case"bvec2":o.uniform2i(h,i[0],i[1]);break;case"bvec3":o.uniform3i(h,i[0],i[1],i[2]);break;case"bvec4":o.uniform4i(h,i[0],i[1],i[2],i[3]);break;case"bool[]":o.uniform1iv(h,i);break;case"bvec2[]":o.uniform2iv(h,i);break;case"bvec3[]":o.uniform3iv(h,i);break;case"bvec4[]":o.uniform4iv(h,i);break;case"int":o.uniform1i(h,i[0]);break;case"ivec2":o.uniform2i(h,i[0],i[1]);break;case"ivec3":o.uniform3i(h,i[0],i[1],i[2]);break;case"ivec4":o.uniform4i(h,i[0],i[1],i[2],i[3]);break;case"int[]":o.uniform1iv(h,i);break;case"ivec2[]":o.uniform2iv(h,i);break;case"ivec3[]":o.uniform3iv(h,i);break;case"ivec4[]":o.uniform4iv(h,i);break;case"float":o.uniform1f(h,i[0]);break;case"vec2":o.uniform2f(h,i[0],i[1]);break;case"vec3":o.uniform3f(h,i[0],i[1],i[2]);break;case"vec4":o.uniform4f(h,i[0],i[1],i[2],i[3]);break;case"float[]":o.uniform1fv(h,i);break;case"vec2[]":o.uniform2fv(h,i);break;case"vec3[]":o.uniform3fv(h,i);break;case"vec4[]":o.uniform4fv(h,i);break;case"mat2":o.uniformMatrix2fv(h,!1,i);break;case"mat3":o.uniformMatrix3fv(h,!1,i);break;case"mat4":o.uniformMatrix4fv(h,!1,i);break;default:throw Error(`Type ${t} not implemented.`)}}destroy(){this.gl.deleteProgram(this.program)}}class Fs{constructor(e,t){tt(this,"buffer");tt(this,"dataPointType");this.gl=e,this.config=t;const i=e.createBuffer();if(e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t.data,t.changesOften?e.DYNAMIC_DRAW:e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.buffer=i,t.data.BYTES_PER_ELEMENT===4)this.dataPointType=e.FLOAT;else if(t.data.BYTES_PER_ELEMENT===2)this.dataPointType=e.UNSIGNED_SHORT;else if(t.data.BYTES_PER_ELEMENT===1)this.dataPointType=e.UNSIGNED_BYTE;else throw new Error("Buffer data may be Float32Array(gl.FLOAT), UInt16Array(gl.UNSIGNED_SHORT) or UInt8Array(gl.UNSIGNED_BYTE)")}updateData(e){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,e,this.config.changesOften?t.DYNAMIC_DRAW:t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.config.data=e}destroy(){this.gl.deleteBuffer(this.buffer)}}let bh=class{constructor(e,t,i,o,h,f,c,v,w,S){this.gl=e,this.textureType=t,this.texture=i,this.level=o,this.internalformat=h,this.format=f,this.type=c,this.width=v,this.height=w,this.border=S}static getTextureParas(e,t,i){switch(t){case"ubyte1":return{internalFormat:e.LUMINANCE,format:e.LUMINANCE,type:e.UNSIGNED_BYTE,binData:new Uint8Array(i),allowsInterpolation:!0,allowsRenderingTo:!0};case"ubyte4":return{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE,binData:new Uint8Array(i),allowsInterpolation:!0,allowsRenderingTo:!0};case"byte32":return{internalFormat:e.RGBA32I,format:e.RGBA_INTEGER,type:e.INT,binData:new Int32Array(i),allowsInterpolation:!1,allowsRenderingTo:!0};case"float1":return{internalFormat:e.R32F,format:e.RED,type:e.FLOAT,binData:new Float32Array(i),allowsInterpolation:!1,allowsRenderingTo:!1};case"float4":return{internalFormat:e.RGBA32F,format:e.RGBA,type:e.FLOAT,binData:new Float32Array(i),allowsInterpolation:!1,allowsRenderingTo:!1}}}destroy(){this.gl.deleteTexture(this.texture)}};class $i extends bh{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none"),t.mipmaps||(t.mipmaps=!1);const i=e.createTexture();if(!i)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+xh),e.bindTexture(e.TEXTURE_2D,i);const o=0,h=e.RGBA,f=e.RGBA,c=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,o,h,f,c,t.image),t.mipmaps&&e.generateMipmap(e.TEXTURE_2D),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"?(t.mipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,null);let v,w;t.image instanceof HTMLImageElement?(v=t.image.naturalWidth,w=t.image.naturalHeight):(v=t.image.width,w=t.image.height),super(e,"ubyte4",i,o,h,f,c,v,w,0),this.config=t}static async loadImage(e){const t=new Image;return t.src=e,await t.decode(),t}}class tS extends bh{constructor(e,t){const i=e.createTexture();if(!i)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+xh),e.bindTexture(e.TEXTURE_2D,i),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST);const o=0,h=e.RGBA,f=e.RGBA,c=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,o,h,f,c,t.video),super(e,"ubyte4",i,o,h,f,c,t.video.videoWidth,t.video.videoHeight,0),this.config=t}update(e){const t=this.gl;t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_2D,this.texture);const i=0,o=t.RGBA,h=t.RGBA,f=t.UNSIGNED_BYTE;t.texImage2D(t.TEXTURE_2D,i,o,h,f,this.config.video)}static async loadVideo(e){function t(i,o){const h=setInterval(()=>{i.currentTime>.1&&i.videoWidth>0&&(clearInterval(h),o(i))})}return new Promise((i,o)=>{var h=document.createElement("video");return h.autoplay=!0,h.src=e,h.volume=0,h.loop=!0,h.addEventListener("playing",()=>t(h,i)),h.onerror=o,h.play(),h})}}class Og extends bh{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none");const{data:i,t:o}=t,h=e.createTexture();if(!h)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+xh),e.bindTexture(e.TEXTURE_2D,h);let f=0,c=0,v=0,w=[];Array.isArray(i)?(f=i.length,c=i[0].length,v=i[0][0].length,w=i.flat().flat()):(f=i.height,c=i.width,v=i.channels,w=Array.from(i.data));const S=0,E=0,M=bh.getTextureParas(e,o,w);if(v!==4&&e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,S,M.internalFormat,c,f,E,M.format,M.type,M.binData),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"){if(!M.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,o,h,S,M.internalFormat,M.format,M.type,c,f,E),this.config=t}}class zs extends bh{constructor(e,t){const{width:i,height:o,type:h,edges:f,interpolate:c}=t;if(i<=0||o<=0)throw new Error("Width and height must be positive.");const v=e.createTexture();if(!v)throw new Error("No texture was created");const w=bh.getTextureParas(e,h,[]);if(e.activeTexture(e.TEXTURE0+xh),e.bindTexture(e.TEXTURE_2D,v),e.texImage2D(e.TEXTURE_2D,0,w.internalFormat,i,o,0,w.format,w.type,null),f==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):f==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),c==="linear"){if(!w.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else c==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,h,v,0,w.internalFormat,w.format,w.type,i,o,0),this.config=t}}class P2{constructor(e){tt(this,"attachedBuffers",{});tt(this,"indexBuffer");this.gl=e}attachBuffer(e,t){const i=this.gl,o=_D(i,e.dataPointType),h=t.location,f=t.nrInstances,c=t.normalize;switch(t.type){case"float":i.enableVertexAttribArray(h),i.vertexAttribPointer(h,1,e.dataPointType,c,1*o,0),f&&i.vertexAttribDivisor(h,f);break;case"vec2":i.enableVertexAttribArray(h),i.vertexAttribPointer(h,2,e.dataPointType,c,2*o,0),f&&i.vertexAttribDivisor(h,f);break;case"vec3":i.enableVertexAttribArray(h),i.vertexAttribPointer(h,3,e.dataPointType,c,3*o,0),f&&i.vertexAttribDivisor(h,f);break;case"vec4":i.enableVertexAttribArray(h),i.vertexAttribPointer(h,4,e.dataPointType,c,4*o,0),f&&i.vertexAttribDivisor(h,f);break;case"mat2":i.enableVertexAttribArray(h+0),i.vertexAttribPointer(h+0,2,e.dataPointType,c,4*o,0*2*o),f&&i.vertexAttribDivisor(h,f),i.enableVertexAttribArray(h+1),i.vertexAttribPointer(h+1,2,e.dataPointType,c,4*o,1*2*o),f&&i.vertexAttribDivisor(h+1,f);break;case"mat3":i.enableVertexAttribArray(h+0),i.vertexAttribPointer(h+0,3,e.dataPointType,c,9*o,0*3*o),f&&i.vertexAttribDivisor(h,f),i.enableVertexAttribArray(h+1),i.vertexAttribPointer(h+1,3,e.dataPointType,c,9*o,1*3*o),f&&i.vertexAttribDivisor(h+1,f),i.enableVertexAttribArray(h+2),i.vertexAttribPointer(h+2,3,e.dataPointType,c,9*o,2*3*o),f&&i.vertexAttribDivisor(h+2,f);break;case"mat4":i.enableVertexAttribArray(h+0),i.vertexAttribPointer(h+0,4,e.dataPointType,c,16*o,0*4*o),f&&i.vertexAttribDivisor(h,f),i.enableVertexAttribArray(h+1),i.vertexAttribPointer(h+1,4,e.dataPointType,c,16*o,1*4*o),f&&i.vertexAttribDivisor(h+1,f),i.enableVertexAttribArray(h+2),i.vertexAttribPointer(h+2,4,e.dataPointType,c,16*o,2*4*o),f&&i.vertexAttribDivisor(h+2,f),i.enableVertexAttribArray(h+3),i.vertexAttribPointer(h+3,4,e.dataPointType,c,16*o,3*4*o),f&&i.vertexAttribDivisor(h+3,f);break}this.attachedBuffers[t.location]={buffer:e,config:t}}detachBuffer(e){for(const[t,i]of Object.entries(this.attachedBuffers))i.buffer===e&&this.gl.disableVertexAttribArray(i.config.location)}attachIndexBuffer(e){const t=this.gl,i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.indexBuffer=i}}class yD extends P2{constructor(t,i){super(t);tt(this,"vertexArray");this.config=i;const o=t.createVertexArray();this.vertexArray=o}destroy(t=!1){if(t){for(const[i,o]of Object.entries(this.attachedBuffers))this.detachBuffer(o.buffer),o.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}this.gl.deleteVertexArray(this.vertexArray)}}class vD extends P2{constructor(e,t){super(e),this.config=t}destroy(e=!1){if(e){for(const[t,i]of Object.entries(this.attachedBuffers))this.detachBuffer(i.buffer),i.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}}}class R2{constructor(e){tt(this,"boundBuffers",[]);this.gl=e}attachBuffer(e,t){const i=t??this.boundBuffers.length;this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,i,e.buffer)}detachBuffer(e){const t=this.boundBuffers.indexOf(e);this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null)}}class xD extends R2{constructor(t,i){super(t);tt(this,"transformFeedback");this.config=i;const o=t.createTransformFeedback();this.transformFeedback=o}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(t=!1){if(t)for(const i of this.boundBuffers)this.detachBuffer(i),i.destroy();this.gl.deleteTransformFeedback(this.transformFeedback)}}class bD extends R2{constructor(e,t){super(e),this.config=t}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(e=!1){if(e)for(const t of this.boundBuffers)this.detachBuffer(t),t.destroy()}}class nS{constructor(e,t){tt(this,"frameBuffer");tt(this,"boundTextures",[]);tt(this,"boundDepthRenderBuffer");this.gl=e,this.config=t;const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),this.frameBuffer=i}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawBuffers(this.getBufferNames())}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}attachTexture(e,t=0){const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+t,i.TEXTURE_2D,e.texture,0),this.boundTextures[t]=e}attachDepthRenderBuffer(e){const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e.renderBuffer),this.boundDepthRenderBuffer=e}getBufferNames(){const e=[];for(let t=0;t<this.boundTextures.length;t++)t===0&&e.push(this.gl.COLOR_ATTACHMENT0),t===1&&e.push(this.gl.COLOR_ATTACHMENT1),t===2&&e.push(this.gl.COLOR_ATTACHMENT2),t===3&&e.push(this.gl.COLOR_ATTACHMENT3),t===4&&e.push(this.gl.COLOR_ATTACHMENT4),t===5&&e.push(this.gl.COLOR_ATTACHMENT5),t===6&&e.push(this.gl.COLOR_ATTACHMENT6),t===7&&e.push(this.gl.COLOR_ATTACHMENT7);return e}destroy(e=!1){if(e){for(const t of this.boundTextures)t.destroy();this.boundDepthRenderBuffer&&this.boundDepthRenderBuffer.destroy()}this.gl.deleteFramebuffer(this.frameBuffer)}}class Ph{constructor(e,t){tt(this,"boundProgram");tt(this,"boundVertexArray");tt(this,"defaultVertexArray");tt(this,"boundBuffer");tt(this,"boundTextures",[]);tt(this,"boundFrameBuffer");tt(this,"boundTransformFeedback");tt(this,"defaultTransformFeedback");this.gl=e,this.config=t,t.viewport&&e.viewport(...t.viewport),t.depthTest&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)),t.cullFace&&e.enable(e.CULL_FACE),t.allowAlpha&&(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),(t.colorBufferFloat===void 0||t.colorBufferFloat===!0)&&(e.getExtension("EXT_color_buffer_float")||console.error(`Could not load extension "EXT_color_buffer_float". Won't be able to render to f32 textures!`)),this.defaultVertexArray=new vD(e,{}),this.boundVertexArray=this.defaultVertexArray,this.defaultTransformFeedback=new bD(e,{}),this.boundTransformFeedback=this.defaultTransformFeedback}setViewPort(e){this.config.viewport=e,this.gl.viewport(...this.config.viewport)}bindProgram(e,t=!0){t&&e===this.boundProgram||(this.gl.useProgram(e.program),this.boundProgram=e)}bindVertexArray(e,t=!0){t&&e===this.boundVertexArray||(this.gl.bindVertexArray(e.vertexArray),this.boundVertexArray=e)}unbindVertexArray(){this.boundVertexArray!==this.defaultVertexArray&&(this.gl.bindVertexArray(null),this.boundVertexArray=this.defaultVertexArray)}bindBuffer(e){e!==this.boundBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.boundBuffer=e)}unbindBuffer(){this.boundBuffer!==void 0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.boundBuffer=void 0)}bindFramebuffer(e){this.boundFrameBuffer!==e&&(e.bind(),this.boundFrameBuffer=e,e.boundTextures.length>0&&this.setViewPort([0,0,e.boundTextures[0].width,e.boundTextures[0].height]))}unbindFramebuffer(){this.boundFrameBuffer!==void 0&&(this.boundFrameBuffer.unbind(),this.boundFrameBuffer=void 0,this.setViewPort([0,0,this.gl.canvas.width,this.gl.canvas.height]))}bindBufferToDefaultVertexArray(e,t){this.unbindVertexArray(),this.bindBuffer(e),this.defaultVertexArray.attachBuffer(e,t),this.unbindBuffer()}bindBufferToVertexArray(e,t,i){this.bindVertexArray(e),this.bindBuffer(t),e.attachBuffer(t,i),this.unbindBuffer()}bindIndexToVertexArray(e,t){this.bindVertexArray(e),e.attachIndexBuffer(t)}bindTextureToFramebuffer(e,t,i=0){this.bindFramebuffer(e),e.attachTexture(t,i),t.type===this.gl.FLOAT&&this.config.colorBufferFloat===!1&&console.warn(`You're trying to add a float-texture to a framebuffer.
        WebGL cannot render to float-textures - this won't work.
        https://registry.khronos.org/OpenGL/specs/es/3.0/es_spec_3.0.pdf#page=143&zoom=100,168,666`),e===this.boundFrameBuffer&&this.setViewPort([0,0,t.width,t.height])}bindDepthToFramebuffer(e,t){this.bindFramebuffer(e),e.attachDepthRenderBuffer(t)}getUniformLocation(e,t){return e.getUniformLocation(t)}setUniformValue(e,t,i,o){this.bindProgram(e),e.setUniformValue(t,i,o)}bindTextureToSlot(e,t){const i=this.gl,o=e.texture,h=t??this.boundTextures.length;if(h>i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${h}.`);return h===xh&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${xh}).
                            If after this call another texture is built, your shader will now use that new texture instead of this one!
                            Consider using another bind point.`),i.activeTexture(i.TEXTURE0+h),i.bindTexture(i.TEXTURE_2D,o),this.boundTextures[h]=e,h}bindTexUniformToSlot(e,t,i){this.bindProgram(e);const o=e.getUniformLocation(t);this.gl.uniform1i(o,i)}updateVideoTexture(e){for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]===e&&e.update(t)}bindTextureToUniform(e,t,i,o){const h=this.bindTextureToSlot(i,o);this.bindTexUniformToSlot(e,t,h)}bindTransformFeedback(e){this.boundTransformFeedback!==e&&(this.boundTransformFeedback=e,e.bind())}unbindTransformFeedback(){this.boundTransformFeedback!==this.defaultTransformFeedback&&(this.boundTransformFeedback.unbind(),this.boundTransformFeedback,this.defaultTransformFeedback)}bindBufferToTransformFeedback(e,t,i){var o;this.bindTransformFeedback(e),(o=this.boundTransformFeedback)==null||o.attachBuffer(t,i)}clearScreen(e,t){t?this.bindFramebuffer(t):this.unbindFramebuffer(),this.gl.clearColor(...e),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}drawArrays(e,t,i,o){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer();const h=Ko(this.gl,i);this.gl.drawArrays(h,0,o)}drawArraysInstanced(e,t,i,o,h){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const f=Ko(this.gl,i);this.gl.drawArraysInstanced(f,0,o,h)}drawArraysToFramebuffer(e,t,i,o,h){h?this.bindFramebuffer(h):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const f=Ko(this.gl,i);this.gl.drawArrays(f,0,o)}drawArraysInstancedToFramebuffer(e,t,i,o,h,f){f?this.bindFramebuffer(f):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const c=Ko(this.gl,i);this.gl.drawArraysInstanced(c,0,o,h)}drawArraysToTransformFeedback(e,t,i,o,h,f){const c=this.gl,v=Ko(this.gl,i);this.bindProgram(e),f||c.enable(c.RASTERIZER_DISCARD),this.bindTransformFeedback(h),c.beginTransformFeedback(v),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer(),this.gl.drawArrays(v,0,o),c.endTransformFeedback(),this.unbindTransformFeedback(),f||c.disable(c.RASTERIZER_DISCARD)}drawArraysToFramebufferAndTransformFeedback(e,t,i,o,h,f){const c=this.gl;f?this.bindFramebuffer(f):this.unbindFramebuffer();const v=Ko(this.gl,i);this.bindProgram(e),this.bindTransformFeedback(h),c.beginTransformFeedback(v),t?this.bindVertexArray(t):this.unbindVertexArray(),this.gl.drawArrays(v,0,o),c.endTransformFeedback(),this.unbindTransformFeedback()}drawElements(e,t,i,o,h){if(this.bindProgram(e),this.bindVertexArray(t),!t.indexBuffer)throw new Error("VertexArray has no index buffer attached. Cannot draw elements");h?this.bindFramebuffer(h):this.unbindFramebuffer();let f=Ko(this.gl,i);this.gl.drawElements(f,o,this.gl.UNSIGNED_SHORT,0)}destroy(e=!1){var t;this.boundTransformFeedback.destroy(e),this.boundFrameBuffer&&((t=this.boundFrameBuffer)==null||t.destroy(e));for(const i of this.boundTextures)i.destroy();this.boundBuffer&&this.boundBuffer.destroy(),this.boundVertexArray.destroy(e),this.boundProgram&&this.boundProgram.destroy()}}function Ko(n,e){switch(e){case"triangles":return n.TRIANGLES;case"lines":return n.LINES;case"points":return n.POINTS}}function wD(n){var i;const e=n.program.vertexSource,t=n.program.fragmentSource;for(const[o,h]of Object.entries(n.inputs.attributes)){const f=`in ${h.config.type} ${o};`;!e.includes(f)&&!t.includes(f)&&console.error(`Neither vertex nor fragment shader contain the string: ${f}`)}for(const[o,h]of Object.entries(n.inputs.uniforms)){const f=`uniform ${h.type} ${o};`;!e.includes(f)&&!t.includes(f)&&console.error(`Neither vertex nor fragment shader contain the string: ${f}`)}for(const[o,h]of Object.entries(n.inputs.textures)){const f=`uniform sampler2D ${o};`;!e.includes(f)&&!t.includes(f)&&console.error(`Neither vertex nor fragment shader contain the string: ${f}`)}for(const[o,h]of Object.entries(((i=n.outputs.transformFeedback)==null?void 0:i.data)??{})){const f=` ${o};`;e.includes(f)||console.error(`Vertex source doesn't contain the string ${f}`)}}class Di{constructor(e,t){tt(this,"program");tt(this,"vao");tt(this,"fb");tt(this,"tf");tt(this,"unboundFramebuffer");var i;this.gs=e,this.config=t,t.program instanceof eS?this.program=t.program:(wD(t),this.program=new eS(e.gl,{...t.program,transformFeedbackVaryings:Object.keys(((i=t.outputs.transformFeedback)==null?void 0:i.data)??[])})),this.vao=new yD(e.gl,{});for(const[o,h]of Object.entries(t.inputs.attributes)){const f=this.program.getAttributeLocation(o);this.gs.bindBufferToVertexArray(this.vao,h.buffer,{...h.config,location:f})}if(t.inputs.index&&this.gs.bindIndexToVertexArray(this.vao,t.inputs.index),this.config.outputs.frameBuffer){const o=this.config.outputs.frameBuffer;this.fb=new nS(e.gl,{});let h=0;for(const f of o.textures)e.bindTextureToFramebuffer(this.fb,f,h),h+=1;o.depth&&e.bindDepthToFramebuffer(this.fb,o.depth),this.fb.bind()}if(this.config.outputs.transformFeedback){this.tf=new xD(e.gl,{});let o=0;for(const[h,f]of Object.entries(this.config.outputs.transformFeedback.data))e.bindBufferToTransformFeedback(this.tf,f,o),o+=1}}activate(){this.gs.bindProgram(this.program),this.gs.bindVertexArray(this.vao);let e=0;for(const[t,i]of Object.entries(this.config.inputs.textures))this.gs.bindTextureToSlot(i,e),this.gs.bindTexUniformToSlot(this.program,t,e),e+=1;for(const[t,i]of Object.entries(this.config.inputs.uniforms))this.gs.setUniformValue(this.program,t,i.type,i.value);this.fb?this.gs.bindFramebuffer(this.fb):this.gs.unbindFramebuffer(),this.tf?this.gs.bindTransformFeedback(this.tf):this.gs.unbindTransformFeedback(),this.gs.setViewPort(this.config.settings.viewport)}updateUniform(e,t){const i=this.config.inputs.uniforms[e].type;this.config.inputs.uniforms[e].value=t,this.gs.setUniformValue(this.program,e,i,t)}updateTexture(e,t){let i=0;for(const[o,h]of Object.entries(this.config.inputs.textures))if(o===e){this.gs.bindTextureToUniform(this.program,e,h,i);break}else i+=1;this.config.inputs.textures[e]=t}updateViewport(e){this.gs.setViewPort(e),this.config.settings.viewport=e}updateFramebuffer(e){if(this.config.outputs.frameBuffer=e,e===void 0)this.gs.unbindFramebuffer(),this.unboundFramebuffer=this.fb,this.fb=void 0;else{const t=e;this.fb||(this.fb=this.unboundFramebuffer),this.fb||(console.warn("having to create new fb - is this on purpose?"),this.fb=new nS(this.gs.gl,{}));let i=0;for(const o of t.textures)this.gs.bindTextureToFramebuffer(this.fb,o,i),i+=1;t.depth&&this.gs.bindDepthToFramebuffer(this.fb,t.depth)}}draw(e){var o,h;e&&this.gs.clearScreen(e,this.fb??void 0);const t=this.gs.gl,i=this.config.settings;this.activate(),this.tf&&(this.gs.gl.beginTransformFeedback(Ko(t,i.drawingMode)),((o=this.config.outputs.transformFeedback)==null?void 0:o.runFragmentShader)===!1&&t.enable(t.RASTERIZER_DISCARD)),this.config.inputs.index?this.fb?this.gs.drawElements(this.program,this.vao,i.drawingMode,this.config.inputs.index.length,this.fb):this.gs.drawElements(this.program,this.vao,i.drawingMode,this.config.inputs.index.length):this.fb?i.instanced?this.gs.drawArraysInstancedToFramebuffer(this.program,this.vao,i.drawingMode,i.nrVertices,i.instanced,this.fb):this.gs.drawArraysToFramebuffer(this.program,this.vao,i.drawingMode,i.nrVertices,this.fb):i.instanced?this.gs.drawArraysInstanced(this.program,this.vao,i.drawingMode,i.nrVertices,i.instanced):this.gs.drawArrays(this.program,this.vao,i.drawingMode,i.nrVertices),this.tf&&(t.endTransformFeedback(),((h=this.config.outputs.transformFeedback)==null?void 0:h.runFragmentShader)===!1&&t.disable(t.RASTERIZER_DISCARD))}destroy(e=!1){this.tf&&this.tf.destroy(e),this.fb&&this.fb.destroy(e),this.vao.destroy(e),this.program.destroy()}}function SD(n,e){const t=[];for(let i=0;i<e;i++)t.push(n(i));return t}function I2(n,e,t){const i=[];for(let o=0;o<e;o++){const h=[];for(let f=0;f<t;f++)h.push(n(o,f));i.push(h)}return i}function Kf(n,e,t,i){const o=n-t/2,h=n+t/2,f=e+i/2,c=e-i/2;return[[o,f],[o,c],[h,c],[o,f],[h,c],[h,f]]}function iS(n,e,t=1,i=0){const o=n.gl.canvas,h=Kf(0,0,2,2),f=new Fs(n.gl,{data:new Float32Array(h.flat()),changesOften:!1});return new Di(n,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos + 1.0) / 2.0;
                uv.y = 1.0 - uv.y;
            }`,fragmentSource:`#version 300 es
            precision highp float;
            in vec2 uv;
            uniform float blur;
            uniform vec2 texSize;
            uniform sampler2D tex;
            out vec4 fragColor;
            void main() {
                vec4 color = texture(tex, uv);

                if (blur > 0.0) {
                  vec2 dX = blur * vec2(1.0 / texSize.x, 0);
                  vec2 dY = blur * vec2(0, 1.0 / texSize.y);
                  color *= 0.4;
                  color += 0.6 / 4.0 * texture(tex, uv + dX);
                  color += 0.6 / 4.0 * texture(tex, uv - dX);
                  color += 0.6 / 4.0 * texture(tex, uv + dY);
                  color += 0.6 / 4.0 * texture(tex, uv - dY);
                }

                fragColor = vec4(color.xyz, ${t});
            }`},inputs:{attributes:{pos:{buffer:f,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{texSize:{type:"vec2",value:[e.width,e.height]},blur:{type:"float",value:[i]}},textures:{tex:e}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:h.length,viewport:[0,0,o.width,o.height]}})}function rS(n,e,t){let i,o,h;if(e===0)i=o=h=t;else{const f=t<.5?t*(1+e):t+e-t*e,c=2*t-f;i=qy(c,f,n+1/3),o=qy(c,f,n),h=qy(c,f,n-1/3)}return[Math.round(i*255),Math.round(o*255),Math.round(h*255)]}function qy(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*(2/3-t)*6:n}class Ec{constructor(e,t){tt(this,"doesLoop",!1);tt(this,"lastRenderStart",+document.timeline.currentTime);this.loopTime=e,this.callback=t}loop(){const e=+document.timeline.currentTime;this.loopTime-(e-this.lastRenderStart)<0&&(this.lastRenderStart=e,this.callback(e)),this.doesLoop&&requestAnimationFrame(()=>this.loop())}startLoop(){this.doesLoop=!0,this.loop()}stopLoop(){this.doesLoop=!1}}class MD{constructor(e,t){tt(this,"movement1");tt(this,"movement2");tt(this,"pt1");tt(this,"pt2");tt(this,"i",0);const i=e.canvas,o=new Ph(e,{allowAlpha:!0}),h=t.nrParticles,f=new $i(e,{image:t.sdfImg,interpolate:"linear",edges:"clamp",mipmaps:!0}),c=SD(()=>[(Math.random()*2-1)*.8,(Math.random()*2-1)*.8,0,0],h),v=new Fs(e,{data:new Float32Array(c.flat()),changesOften:!1}),w=new Fs(e,{data:new Float32Array(c.flat()),changesOften:!1}),S=new zs(e,{width:i.width,height:i.height,type:"float4",interpolate:"none",edges:"clamp"}),E=new zs(e,{width:i.width,height:i.height,type:"float4",interpolate:"none",edges:"clamp"}),M=new Di(o,{program:{vertexSource:`#version 300 es
            in vec4 offset;
            uniform vec3 pointerPos;
            uniform vec2 lastPosTexSize;
            uniform vec2 sdfTextureSize;
            uniform sampler2D lastPosTex;
            uniform sampler2D sdfTexture;
            out vec4 offsetNew;

            float particleSize = 10.0;
            vec2 dxdyPos() {
                return vec2(particleSize / lastPosTexSize.x, particleSize / lastPosTexSize.y);
            }
            vec2 dxdySdf() {
              return vec2(1.0 / sdfTextureSize.x, 1.0 / sdfTextureSize.y);
            }

            vec4 sampleQuadrant(vec2 uv, vec2 dPrimary, vec2 dSecondary, sampler2D tex, int level) {
                vec4 data = vec4(0);

                if (level > -2) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.0 * dSecondary);
                }
                if (level > -1) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.1 * dSecondary);
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary - 0.1 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.0 * dSecondary);
                }
                if (level > 0) {
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.3 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary - 0.3 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.0 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.5 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary - 0.5 * dSecondary);
                }
                if (level > 1) {
                  data += 1.00 * texture(tex, uv + 1.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary - 1.0 * dSecondary);
                }
                if (level > 2) {
                  data += 0.50 * texture(tex, uv + 2.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary - 1.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary + 2.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary - 2.0 * dSecondary);
                }
                if (level > 3) {
                  data += 0.25 * texture(tex, uv + 3.0 * dPrimary + 0.0 * dSecondary);
                }
                return data;
            }

            vec4 sampleRight(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(dx, 0.0);
                vec2 dSecondary = vec2(0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleLeft(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(-dx, 0.0);
                vec2 dSecondary = vec2( 0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleTop(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleBottom(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, -dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            void main() {

                vec2 pos = offset.xy;
                vec2 speed = offset.zw;
                vec2 uv = (pos + 1.0) / 2.0;

                vec2 uvSdf = vec2(uv.x, uv.y);
                float dxSdf = dxdySdf().x;
                float dySdf = dxdySdf().y;
                float dist    = texture(sdfTexture, uvSdf).x;
                float dist_px = sampleRight (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_mx = sampleLeft  (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_py = sampleTop   (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_my = sampleBottom(uvSdf, dxdySdf(), sdfTexture, 3).x;
    
                float dDistdx = (dist_px - dist_mx) / (2.0 * dxSdf);
                float dDistdy = (dist_py - dist_my) / (2.0 * dySdf);
                float sign = 1.0;
                // if (dist >= 0.7) {
                //   sign *= -1.0;
                // }
                vec2 textAttractionForce = sign * vec2(dDistdx, dDistdy);



                float dxPos = dxdyPos().x;
                float dyPos = dxdyPos().y;
                vec4 presenceRight  = sampleRight (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceLeft   = sampleLeft  (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceTop    = sampleTop   (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceBottom = sampleBottom(uv, dxdyPos(), lastPosTex, 4);
                float pr = presenceRight.x * presenceRight.w;
                float pl = presenceLeft.x * presenceLeft.w;
                float pt = presenceTop.x * presenceTop.w;
                float pb = presenceBottom.x * presenceBottom.w;
                float dpdx = (pr - pl) / (2.0 * dxPos);
                float dpdy = (pt - pb) / (2.0 * dyPos);
                vec2 particleRepulsionForce = -0.0001 * vec2(dpdx, dpdy);



                vec2 mouseRepulsionForce = vec2(0);
                if (pointerPos.z > 0.5) {
                  vec2 mousePos = pointerPos.xy;
                  vec2 mouseDir = mousePos - pos;
                  float mouseDist = length(mouseDir);
                  if (mouseDist < 0.7) {
                    float mouseProx = (0.7 - mouseDist) / 0.7;
                    mouseRepulsionForce = -1.0 * (mouseProx * mouseProx) * mouseDir;
                  }
                }

                

                vec2 newSpeed = 0.800 * speed 
                              + 0.800 * particleRepulsionForce 
                              + 0.005 * textAttractionForce
                              + 2.0 * mouseRepulsionForce;
                vec2 newPos = pos + 0.04 * newSpeed;


                if (newPos.x < -1.0) {
                  newPos.x = 1.0 - (-1.0 - newPos.x);
                }
                if (newPos.x > 1.0) {
                  newPos.x = -1.0 + (1.0 - newPos.x);
                }
                if (newPos.y < -1.0) {
                  newPos.y = 1.0 - (-1.0 - newPos.y);
                }
                if (newPos.y > 1.0) {
                  newPos.y = -1.0 + (1.0 - newPos.y);
                }

                gl_Position = vec4(newPos, 0, 1);
                gl_PointSize = particleSize;
                offsetNew = vec4(newPos, newSpeed);
            }`,fragmentSource:`#version 300 es
            precision highp float;
            out vec4 fragColor;
            void main() {
                fragColor = vec4(1, 1, 1, 0.8);
            }`},inputs:{attributes:{offset:{buffer:v,config:{normalize:!1,nrInstances:0,type:"vec4"}}},uniforms:{lastPosTexSize:{type:"vec2",value:[S.width,S.height]},sdfTextureSize:{type:"vec2",value:[f.width,f.height]},pointerPos:{type:"vec3",value:[0,0,0]}},textures:{sdfTexture:f,lastPosTex:S}},outputs:{transformFeedback:{data:{offsetNew:w},runFragmentShader:!0},frameBuffer:{textures:[E]}},settings:{drawingMode:"points",instanced:!1,nrVertices:h,viewport:[0,0,i.width,i.height]}}),L=new Di(o,{...M.config,program:M.program,inputs:{...M.config.inputs,attributes:{...M.config.inputs.attributes,offset:{buffer:w,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{...M.config.inputs.textures,lastPosTex:E}},outputs:{...M.config.outputs,transformFeedback:{data:{offsetNew:v},runFragmentShader:!0},frameBuffer:{textures:[S]}}}),U=iS(o,E,t.opacity,t.blur),B=iS(o,S,t.opacity,t.blur);this.movement1=M,this.movement2=L,this.pt1=U,this.pt2=B}step(e){this.i%2===0?(this.movement1.updateUniform("pointerPos",e.pointerPos),this.movement1.draw([0,0,0,0]),this.pt1.draw()):(this.movement2.updateUniform("pointerPos",e.pointerPos),this.movement2.draw([0,0,0,0]),this.pt2.draw()),this.i++}destroy(e){this.pt2.destroy(e),this.pt1.destroy(e),this.movement2.destroy(e),this.movement1.destroy(e)}}class TD{constructor(){tt(this,"looper");tt(this,"p");tt(this,"canvas");tt(this,"destroyed",!1);tt(this,"pointerPos",[0,0,0]);tt(this,"onMouseMove",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect(),i=(e.clientX-t.left)/this.canvas.clientWidth,o=(e.clientY-t.top)/this.canvas.clientHeight;this.pointerPos[0]=(i-.5)*2,this.pointerPos[1]=(o-.5)*2,this.pointerPos[2]=1});tt(this,"timeout");tt(this,"onDevMove",e=>{let t=0;e.gamma&&(t=e.gamma/90);let i=0;e.beta&&(i=e.beta/180),this.pointerPos[0]=t,this.pointerPos[1]=i,this.pointerPos[2]=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.pointerPos[2]=0,60)})}async init(e){const t=await $i.loadImage("/c_c_fat_sdf.jpg");if(this.destroyed)return;const i=e.getContext("webgl2");this.p=new MD(i,{sdfImg:t,nrParticles:Math.max(e.width*3,3e3),opacity:.1,blur:0}),this.looper=new Ec(30,()=>{var o;(o=this.p)==null||o.step({pointerPos:this.pointerPos}),this.pointerPos[2]=0}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove)}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,i;(e=this.looper)==null||e.stopLoop(),(t=this.p)==null||t.destroy(!0),this.p=void 0,(i=this.canvas)==null||i.removeEventListener("mousemove",this.onMouseMove),this.canvas=void 0,this.destroyed=!0}}function ED(){const n=ct.useRef(null);return ct.useEffect(()=>{const e=new TD;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(180deg, var(--white) 0%, var(--primary4) 100%)",position:"relative"},children:ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"all"}})})}function Ku(n){return ge.jsx("div",{style:{height:n.height??"0",width:n.width??"0"}})}function AD(n){return ge.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"100%",padding:"0.25rem",position:"relative",background:"var(--primary2)"},children:ge.jsx("div",{style:{borderRadius:"100%",position:"absolute",width:"calc(100% - 2 * 0.25rem)",height:"calc(100% - 2 * 0.25rem)",overflow:"hidden",background:"var(--white)"},children:n.children})})}function CD(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`M 0 0 
  L 1 0
  L 1 0.9 
  C 0.8 -1.1   0.2 1.0   0 0.9
  Z`})})}function PD(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`
        M 0 0 
        C 0.3 1.8    0.5 0.5    1 0 
        L 1 1 
        L 0 1
        Z`})})}function RD(){return ge.jsx("div",{style:{minHeight:"5rem"},children:ge.jsxs("div",{style:{position:"relative",padding:"2rem",display:"flex",flexWrap:"wrap",flexDirection:"row",alignContent:"space-around",justifyContent:"space-around",width:"100%"},children:[ge.jsx("div",{children:"Site made by codeandcolors"}),ge.jsx("div",{children:ge.jsx(Lv,{to:"/imprint",children:"Imprint"})}),ge.jsx("div",{children:ge.jsx(Lv,{to:"/resources",children:"Resources"})})]})})}function ID(n,e){return{x:n.x-e.x,y:n.y-e.y}}function sS(n,e){return{x:n.x+e.x,y:n.y+e.y}}function ku(n,e){return{x:n.x*e,y:n.y*e}}function LD(n,e){const t=n.x-e.x,i=n.y-e.y;return Math.sqrt(t*t+i*i)}function DD(n,e){const t=LD(n.pos,e.pos),i=n.mass*e.mass/t,o=ID(e.pos,n.pos);return ku(o,i)}class zD{constructor(e=[]){tt(this,"balls",[]);tt(this,"dt",.05);tt(this,"loopHandle");tt(this,"j",0);this.circles=e;for(const t of this.circles)this.balls.push({pos:{x:+t.getAttribute("cx"),y:+t.getAttribute("cy")},r:+t.getAttribute("r"),vel:{x:0,y:0},acc:{x:0,y:0},mass:+t.getAttribute("r")*+t.getAttribute("r")*Math.PI})}loop(){const e=this.circles,t=this.balls,i=this.dt;for(let h=0;h<e.length;h++){const f=t[h],c=e[h],v={mass:Math.random(),pos:{x:Math.random(),y:Math.random()}},w=ku(DD(f,v),.5);f.acc=ku(w,i),f.vel=sS(f.vel,ku(f.acc,i)),f.pos=sS(f.pos,ku(f.vel,i));const S=Math.sqrt(f.mass/Math.PI);f.r=S*(1+.05*Math.sin(h+this.j/40)),this.j%1e3>=500&&(f.vel=ku(f.acc,.99)),c.setAttribute("cx",f.pos.x+""),c.setAttribute("cy",f.pos.y+""),c.setAttribute("r",f.r+"")}const o=setTimeout(()=>requestAnimationFrame(()=>this.loop()),50);this.loopHandle=o,this.j+=1}cancelLoop(){clearTimeout(this.loopHandle)}}function kD(n){const e=ct.useRef(null);return ct.useEffect(()=>{let t;if(e.current){const i=e.current.querySelectorAll("circle");t=new zD(Array.from(i)),t.loop()}return()=>t==null?void 0:t.cancelLoop()},[e.current]),ge.jsxs("div",{style:{position:"relative",background:"var(--white)"},children:[ge.jsxs("svg",{ref:e,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},viewBox:"0 0 1 1",preserveAspectRatio:"none",children:[ge.jsx("defs",{children:ge.jsx("filter",{id:"bbblurry-filter",children:ge.jsx("feGaussianBlur",{stdDeviation:"0.008",in:"SourceGraphic",edgeMode:"none",result:"blur"})})}),ge.jsxs("g",{filter:"url(#bbblurry-filter)",children:[ge.jsx("rect",{x:"-100",y:"-100",width:"200",height:"200",fill:"none"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--primary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--secondary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--tertiary4)",opacity:"0.3"})]})]}),ge.jsx("div",{style:{position:"relative"},children:n.children})]})}function FD(n){if(n.hasAttribute("width"))return{x:+n.getAttribute("width"),y:+n.getAttribute("height")};if(n.getBBox){const e=n.getBBox();return{x:e.width,y:e.height}}else return console.warn("Could not determine dimensions of svg-element ",n),{x:0,y:0}}function aS(n){var i;if((i=n.viewBox)!=null&&i.baseVal){const o=n.viewBox.baseVal;return{x:o.x+o.width/2,y:o.y+o.height/2}}const e=L2(n),t=FD(n);return{x:e.x+t.x/2,y:e.y+t.y/2}}function L2(n){return{x:+n.getAttribute("x"),y:+n.getAttribute("y")}}function UD(n,e){return{x:n.x-e.x,y:n.y-e.y}}function ND(n,e){return{x:n.x+e.x,y:n.y+e.y}}function OD(n,e){return{x:n.x*e,y:n.y*e}}class BD{constructor(){tt(this,"svg");tt(this,"io");tt(this,"doesLoop",!1)}init(e){this.doesLoop=!0,this.io=new IntersectionObserver((t,i)=>{for(const o of t)if(o.intersectionRatio>.7){const h=o.target;this.doesLoop&&(this.implode(h),i.unobserve(o.target))}}),this.io.observe(e)}delete(){var e,t;this.svg&&((e=this.io)==null||e.unobserve(this.svg)),(t=this.io)==null||t.disconnect(),this.doesLoop=!1}implode(e){const t=aS(e),i=[],o=Array.from(e.childNodes).filter(c=>!["defs"].includes(c.tagName));if(o.length<=0)return;for(const c of o){const v=L2(c);let w=aS(c);w.x===0&&w.y===0&&(w=structuredClone(t)),i.push({childTL:v,childCenter:w}),this.implode(c)}let h=30;const f=c=>{c<0||(o.map((v,w)=>{const{childTL:S,childCenter:E}=i[w],M=UD(E,t),L=ND(S,OD(M,c/h));v.setAttribute("x",L.x+""),v.setAttribute("y",L.y+"")}),this.doesLoop&&setTimeout(()=>requestAnimationFrame(()=>f(c-1)),30))};f(h)}}function VD(n){const e=ct.useRef(null);return ct.useEffect(()=>{const t=new BD;if(e.current){const o=e.current.firstChild;t.init(o)}return()=>t.delete()},[e.current]),ge.jsx("div",{ref:e,style:{width:"100%",height:"100%"},children:n.children})}function Jf(n){return ge.jsxs("div",{style:{position:"relative"},children:[n.hero,ge.jsxs("div",{style:{zIndex:1,position:"relative",marginTop:"-5rem",marginBottom:"-5rem"},children:[n.logo&&ge.jsx("div",{style:{zIndex:1,position:"absolute",width:"max(10%, 75px)",left:"max(5%, 1rem)",aspectRatio:"1/1"},children:ge.jsx(AD,{children:ge.jsx(VD,{children:n.logo})})}),ge.jsx("div",{style:{width:"100%",height:"5rem"},children:ge.jsx(PD,{fill:"var(--white)"})}),ge.jsxs("div",{children:[ge.jsx(Ku,{height:"5rem"}),ge.jsx(C2,{children:n.children}),ge.jsx(Ku,{height:"5rem"})]}),ge.jsx("div",{style:{width:"100%",height:"5rem"},children:ge.jsx(CD,{fill:"var(--white)"})})]}),ge.jsxs("div",{style:{position:"relative"},children:[ge.jsxs(kD,{children:[ge.jsx(Ku,{height:"5rem"}),n.footerContent,ge.jsx(Ku,{height:"5rem"}),ge.jsx(RD,{})]}),ge.jsx("div",{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"none",background:"linear-gradient(0deg, var(--primary2-transparent25) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 90%, var(--primary2-transparent25) 100%)",opacity:.5}})]})]})}function GD(){return ge.jsxs(Jf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(u_,{title:"",subtitle:"",heroBackground:ge.jsx(ED,{})})}),logo:ge.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",children:ge.jsxs("svg",{x:"0.1",y:"0.25",width:"0.8",height:"0.5",viewBox:"0 0 1 1",children:[ge.jsxs("defs",{children:[ge.jsx("path",{id:"envelopA",d:"M 0 0 L 1 0 L 1 0.2 L 0.5 0.6 L 0 0.2 Z",fill:"black"}),ge.jsx("path",{id:"envelopB",d:"M 0 0.2 L 0.5 0.6 L 1 0.2 L 1 1 L 0 1 Z",fill:"black"})]}),ge.jsx("use",{href:"#envelopA",x:"0",y:"0.0"}),ge.jsx("use",{href:"#envelopB",x:"0",y:"0.2"})]})}),footerContent:ge.jsxs(C2,{children:[ge.jsx("h2",{children:"See you soon!"}),ge.jsx(Ku,{height:"5rem"})]}),children:[ge.jsx("h1",{children:"Contact us!"}),ge.jsx("p",{children:"We'll be happy to answer all your requests."}),ge.jsx("div",{className:"ctaContainer",children:ge.jsx("a",{href:"mailto:michael.langbein@codeandcolors.net",children:ge.jsx("button",{type:"button",className:"ctaButton",children:"Send Email"})})})]})}function HD(){return ge.jsx("div",{children:ge.jsx("h1",{children:"Error"})})}function D2(){const n=Gx();return ge.jsx("div",{className:"ctaContainer",children:ge.jsxs("div",{className:"CTA",children:[ge.jsx("div",{children:ge.jsx("h2",{children:"Let's build something great together!"})}),ge.jsx("button",{className:"ctaButton",onClick:()=>n("/contact"),children:"Contact us"})]})})}class jD{constructor(e,t){tt(this,"graph");const i=e.getContext("webgl2"),o=new Ph(i,{colorBufferFloat:!1,allowAlpha:!0}),h=Kf(0,0,2,2),f=new Fs(i,{data:new Float32Array(h.flat()),changesOften:!1}),c=new $i(i,{image:t.heightImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),v=new $i(i,{image:t.rgbImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),w=new $i(i,{image:t.waterNormal1,interpolate:"linear",edges:"repeat",mipmaps:!0}),S=new $i(i,{image:t.waterNormal2,interpolate:"linear",edges:"repeat",mipmaps:!0}),E=new $i(i,{image:t.clouds,interpolate:"linear",edges:"mirror"}),M=new Di(o,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos - 1.0) / 2.0;
                uv.x = 1.0 - uv.x;
            }
        `,fragmentSource:`#version 300 es
            precision mediump float;
            in vec2 uv;
            uniform sampler2D imageTex;
            uniform sampler2D heightTex;
            uniform sampler2D waterNormalTexture1;
            uniform sampler2D waterNormalTexture2;
            uniform sampler2D cloudTexture;
            uniform float mousex;
            uniform float mousey;
            uniform float time;
            uniform vec2 textureSize;
            out vec4 fragColor;

            vec4 lighten(vec4 baseColor, vec4 lightenWith, float degree) {
              vec4 distance = lightenWith - baseColor;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 darken(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x -= degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y -= degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z -= degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 glow(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            void main() {
                float waterLine = ${t.waterLine};
                float dx = 1.0 / textureSize.x;
                float dy = 1.0 / textureSize.y;

                // 0. data

                vec2 sunPos = normalize(vec2(mousex * 2.0 - 1.0, mousey * 2.0 - 1.0));
                vec2 water1point = uv * 3.0 + 0.02 * time * vec2(0.1, 0.2);
                vec2 water2point = uv * 3.0 + 0.02 * time * vec2(-0.3, 0.1);
                vec4 waterNorm1 = 2.0 * (texture(waterNormalTexture1,  water1point) - 0.5);
                vec4 waterNorm2 = 2.0 * (texture(waterNormalTexture2,  water2point) - 0.5);
                vec4 waterNorm = mix(waterNorm1, waterNorm2, 0.5);
                vec2 waterNormXY = waterNorm.rg;

                // 1. perspective

                vec4 landColor = vec4(0);
                float height = texture(heightTex, uv).x;
                if (height >= waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + height * ${t.strength} * mouse;
                  landColor = texture(imageTex, queryPoint);
                }

                // 2. water reflection

                vec4 reflectionColor = vec4(0);
                float waveHeight = waterNorm.z;
                float reflection = dot(waterNormXY, sunPos);
                reflection *= reflection;
                if (height < waterLine) {
                  float proxToCenter = 0.25 - length(uv - vec2(0.5));
                  reflectionColor = vec4(reflection);
                }

                // 3. surf

                vec4 surfColor = vec4(0);
                float distFromShore = waterLine - height;
                float surf = sin(distFromShore * 200.0 + time * 1.0);
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  surfColor = vec4(surf, surf, surf, 1);
                }


                // 4. water refraction

                vec4 refractionColor = vec4(0);
                if (height < waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + (height + surf + waveHeight * 0.5) * ${t.strength} * mouse;
                  refractionColor = texture(imageTex, queryPoint);
                }


                // 5. clouds

                vec2 cloudUv = uv * 0.2;
                vec2 cloudTimeOffset = vec2(-0.005 * time, 0);
                vec2 cloudHeightOffset = 0.005 * vec2(mousex, mousey);
                vec4 cloudColor = texture(cloudTexture, cloudUv + cloudTimeOffset + cloudHeightOffset);

                
                // 6. mixing

                vec4 baseColor = landColor + refractionColor;
                vec4 combinedColor = baseColor;
                if (height < waterLine) {
                  // combinedColor = mix(combinedColor, reflectionColor, reflection);
                  // combinedColor = lighten(combinedColor, vec4(1.0), reflection);
                  combinedColor = darken(combinedColor, vec4(0.0), reflection);
                  // combinedColor = lighten(combinedColor, surfColor, 1.0 - distFromShore / 0.1);
                }
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  combinedColor.xyz *= (1.0 + surf * 0.25);
                }
                // combinedColor = mix(combinedColor, vec4(0), cloudColor.w * cloudColor.w * 0.2);
                combinedColor = glow(combinedColor, vec4(0), cloudColor.w * cloudColor.w * cloudColor.w * 2.0);

                fragColor = combinedColor;
            }
        `},inputs:{attributes:{pos:{buffer:f,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{heightTex:c,imageTex:v,waterNormalTexture1:w,waterNormalTexture2:S,cloudTexture:E},uniforms:{mousex:{type:"float",value:[0]},mousey:{type:"float",value:[0]},time:{type:"float",value:[0]},textureSize:{type:"vec2",value:[v.width,v.height]}}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:h.length,viewport:[0,0,e.width,e.height]}});this.graph=M}step(e){this.graph.updateUniform("mousex",[e.mousex]),this.graph.updateUniform("mousey",[e.mousey]),this.graph.updateUniform("time",[e.time]),this.graph.draw()}destroy(e){var t;(t=this.graph)==null||t.destroy(e)}}class WD{constructor(){tt(this,"looper");tt(this,"islands");tt(this,"canvas");tt(this,"destroyed",!1);tt(this,"mousex",0);tt(this,"mousey",0);tt(this,"onMouseMove",e=>{if(!this.canvas)return;const t=e.clientX/this.canvas.clientWidth,i=1-e.clientY/this.canvas.clientHeight;this.mousex=t,this.mousey=i});tt(this,"onDevMove",e=>{let t=0;e.gamma&&(t=e.gamma/90);let i=0;e.beta&&(i=e.beta/180);const o=Math.max(-1,Math.min(t*3,1)),h=Math.max(-1,Math.min(i*3,1));this.mousex=(o+1)/2,this.mousey=(h+1)/2})}async init(e){const t=await $i.loadImage("/hawaii_depth.jpg"),i=await $i.loadImage("/hawaii_bg2.jpg"),o=await $i.loadImage("/water-normal.png"),h=await $i.loadImage("/water-normal2.png"),f=await $i.loadImage("/clouds.png");this.destroyed||(this.islands=new jD(e,{heightImage:t,rgbImage:i,strength:.004,waterLine:.83,waterNormal1:o,waterNormal2:h,clouds:f}),this.looper=new Ec(30,c=>{var v;(v=this.islands)==null||v.step({mousex:this.mousex,mousey:this.mousey,time:c/1e3})}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove))}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,i;(e=this.looper)==null||e.stopLoop(),(t=this.islands)==null||t.destroy(!0),this.islands=void 0,(i=this.canvas)==null||i.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("deviceorientationabsolute",this.onDevMove),this.canvas=void 0,this.destroyed=!0}}function $D(){const n=ct.useRef(null);return ct.useEffect(()=>{const e=new WD;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,t.width<600&&(t.width=t.clientWidth*devicePixelRatio,t.height=t.clientHeight*devicePixelRatio),e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const z2="163",k2=300,Ju=1e3,Em=1001,oS=1002,lS=1003,XD=1006,qD=1008,ZD=1009,YD=1014,KD=1020,JD=1023,Zy=1026,cS=1027,QD="",e3=515,Am=2e3,uS=2001;let F2=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const h=o.indexOf(t);h!==-1&&o.splice(h,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let h=0,f=o.length;h<f;h++)o[h].call(this,e);e.target=null}}};const Er=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function Hx(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Er[n&255]+Er[n>>8&255]+Er[n>>16&255]+Er[n>>24&255]+"-"+Er[e&255]+Er[e>>8&255]+"-"+Er[e>>16&15|64]+Er[e>>24&255]+"-"+Er[t&63|128]+Er[t>>8&255]+"-"+Er[t>>16&255]+Er[t>>24&255]+Er[i&255]+Er[i>>8&255]+Er[i>>16&255]+Er[i>>24&255]).toLowerCase()}function eo(n,e,t){return Math.max(e,Math.min(t,n))}let Yy=class U2{constructor(e=0,t=0){U2.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6],this.y=o[1]*t+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(eo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),o=Math.sin(t),h=this.x-e.x,f=this.y-e.y;return this.x=h*i-f*o+e.x,this.y=h*o+f*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},jx=class N2{constructor(e,t,i,o,h,f,c,v,w){N2.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,o,h,f,c,v,w)}set(e,t,i,o,h,f,c,v,w){const S=this.elements;return S[0]=e,S[1]=o,S[2]=c,S[3]=t,S[4]=h,S[5]=v,S[6]=i,S[7]=f,S[8]=w,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,h=this.elements,f=i[0],c=i[3],v=i[6],w=i[1],S=i[4],E=i[7],M=i[2],L=i[5],U=i[8],B=o[0],z=o[3],R=o[6],G=o[1],V=o[4],ee=o[7],fe=o[2],Z=o[5],te=o[8];return h[0]=f*B+c*G+v*fe,h[3]=f*z+c*V+v*Z,h[6]=f*R+c*ee+v*te,h[1]=w*B+S*G+E*fe,h[4]=w*z+S*V+E*Z,h[7]=w*R+S*ee+E*te,h[2]=M*B+L*G+U*fe,h[5]=M*z+L*V+U*Z,h[8]=M*R+L*ee+U*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8];return t*f*S-t*c*w-i*h*S+i*c*v+o*h*w-o*f*v}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8],E=S*f-c*w,M=c*v-S*h,L=w*h-f*v,U=t*E+i*M+o*L;if(U===0)return this.set(0,0,0,0,0,0,0,0,0);const B=1/U;return e[0]=E*B,e[1]=(o*w-S*i)*B,e[2]=(c*i-o*f)*B,e[3]=M*B,e[4]=(S*t-o*v)*B,e[5]=(o*h-c*t)*B,e[6]=L*B,e[7]=(i*v-w*t)*B,e[8]=(f*t-i*h)*B,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,o,h,f,c){const v=Math.cos(h),w=Math.sin(h);return this.set(i*v,i*w,-i*(v*f+w*c)+f+e,-o*w,o*v,-o*(-w*f+v*c)+c+t,0,0,1),this}scale(e,t){return this.premultiply(Ky.makeScale(e,t)),this}rotate(e){return this.premultiply(Ky.makeRotation(-e)),this}translate(e,t){return this.premultiply(Ky.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<9;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const Ky=new jx;function hS(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Jy(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let du,t3=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{du===void 0&&(du=hS("canvas")),du.width=e.width,du.height=e.height;const i=du.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=du}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=hS("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),h=o.data;for(let f=0;f<h.length;f++)h[f]=Jy(h[f]/255)*255;return i.putImageData(o,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Jy(t[i]/255)*255):t[i]=Jy(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},n3=0,i3=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:n3++}),this.uuid=Hx(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let h;if(Array.isArray(o)){h=[];for(let f=0,c=o.length;f<c;f++)o[f].isDataTexture?h.push(Qy(o[f].image)):h.push(Qy(o[f]))}else h=Qy(o);i.url=h}return t||(e.images[this.uuid]=i),i}};function Qy(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?t3.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let r3=0,h_=class hg extends F2{constructor(e=hg.DEFAULT_IMAGE,t=hg.DEFAULT_MAPPING,i=Em,o=Em,h=XD,f=qD,c=JD,v=ZD,w=hg.DEFAULT_ANISOTROPY,S=QD){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:r3++}),this.uuid=Hx(),this.name="",this.source=new i3(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=o,this.magFilter=h,this.minFilter=f,this.anisotropy=w,this.format=c,this.internalFormat=null,this.type=v,this.offset=new Yy(0,0),this.repeat=new Yy(1,1),this.center=new Yy(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new jx,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==k2)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ju:e.x=e.x-Math.floor(e.x);break;case Em:e.x=e.x<0?0:1;break;case oS:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ju:e.y=e.y-Math.floor(e.y);break;case Em:e.y=e.y<0?0:1;break;case oS:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};h_.DEFAULT_IMAGE=null;h_.DEFAULT_MAPPING=k2;h_.DEFAULT_ANISOTROPY=1;let Qf=class{constructor(e=0,t=0,i=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=o}static slerpFlat(e,t,i,o,h,f,c){let v=i[o+0],w=i[o+1],S=i[o+2],E=i[o+3];const M=h[f+0],L=h[f+1],U=h[f+2],B=h[f+3];if(c===0){e[t+0]=v,e[t+1]=w,e[t+2]=S,e[t+3]=E;return}if(c===1){e[t+0]=M,e[t+1]=L,e[t+2]=U,e[t+3]=B;return}if(E!==B||v!==M||w!==L||S!==U){let z=1-c;const R=v*M+w*L+S*U+E*B,G=R>=0?1:-1,V=1-R*R;if(V>Number.EPSILON){const fe=Math.sqrt(V),Z=Math.atan2(fe,R*G);z=Math.sin(z*Z)/fe,c=Math.sin(c*Z)/fe}const ee=c*G;if(v=v*z+M*ee,w=w*z+L*ee,S=S*z+U*ee,E=E*z+B*ee,z===1-c){const fe=1/Math.sqrt(v*v+w*w+S*S+E*E);v*=fe,w*=fe,S*=fe,E*=fe}}e[t]=v,e[t+1]=w,e[t+2]=S,e[t+3]=E}static multiplyQuaternionsFlat(e,t,i,o,h,f){const c=i[o],v=i[o+1],w=i[o+2],S=i[o+3],E=h[f],M=h[f+1],L=h[f+2],U=h[f+3];return e[t]=c*U+S*E+v*L-w*M,e[t+1]=v*U+S*M+w*E-c*L,e[t+2]=w*U+S*L+c*M-v*E,e[t+3]=S*U-c*E-v*M-w*L,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,o){return this._x=e,this._y=t,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,o=e._y,h=e._z,f=e._order,c=Math.cos,v=Math.sin,w=c(i/2),S=c(o/2),E=c(h/2),M=v(i/2),L=v(o/2),U=v(h/2);switch(f){case"XYZ":this._x=M*S*E+w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E-M*L*U;break;case"YXZ":this._x=M*S*E+w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E+M*L*U;break;case"ZXY":this._x=M*S*E-w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E-M*L*U;break;case"ZYX":this._x=M*S*E-w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E+M*L*U;break;case"YZX":this._x=M*S*E+w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E-M*L*U;break;case"XZY":this._x=M*S*E-w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E+M*L*U;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],o=t[4],h=t[8],f=t[1],c=t[5],v=t[9],w=t[2],S=t[6],E=t[10],M=i+c+E;if(M>0){const L=.5/Math.sqrt(M+1);this._w=.25/L,this._x=(S-v)*L,this._y=(h-w)*L,this._z=(f-o)*L}else if(i>c&&i>E){const L=2*Math.sqrt(1+i-c-E);this._w=(S-v)/L,this._x=.25*L,this._y=(o+f)/L,this._z=(h+w)/L}else if(c>E){const L=2*Math.sqrt(1+c-i-E);this._w=(h-w)/L,this._x=(o+f)/L,this._y=.25*L,this._z=(v+S)/L}else{const L=2*Math.sqrt(1+E-i-c);this._w=(f-o)/L,this._x=(h+w)/L,this._y=(v+S)/L,this._z=.25*L}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(eo(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,t/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,o=e._y,h=e._z,f=e._w,c=t._x,v=t._y,w=t._z,S=t._w;return this._x=i*S+f*c+o*w-h*v,this._y=o*S+f*v+h*c-i*w,this._z=h*S+f*w+i*v-o*c,this._w=f*S-i*c-o*v-h*w,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,o=this._y,h=this._z,f=this._w;let c=f*e._w+i*e._x+o*e._y+h*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=f,this._x=i,this._y=o,this._z=h,this;const v=1-c*c;if(v<=Number.EPSILON){const L=1-t;return this._w=L*f+t*this._w,this._x=L*i+t*this._x,this._y=L*o+t*this._y,this._z=L*h+t*this._z,this.normalize(),this}const w=Math.sqrt(v),S=Math.atan2(w,c),E=Math.sin((1-t)*S)/w,M=Math.sin(t*S)/w;return this._w=f*E+this._w*M,this._x=i*E+this._x*M,this._y=o*E+this._y*M,this._z=h*E+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),o=Math.sqrt(1-i),h=Math.sqrt(i);return this.set(o*Math.sin(e),o*Math.cos(e),h*Math.sin(t),h*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},mr=class O2{constructor(e=0,t=0,i=0){O2.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(dS.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(dS.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,o=this.z,h=e.elements;return this.x=h[0]*t+h[3]*i+h[6]*o,this.y=h[1]*t+h[4]*i+h[7]*o,this.z=h[2]*t+h[5]*i+h[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,h=e.elements,f=1/(h[3]*t+h[7]*i+h[11]*o+h[15]);return this.x=(h[0]*t+h[4]*i+h[8]*o+h[12])*f,this.y=(h[1]*t+h[5]*i+h[9]*o+h[13])*f,this.z=(h[2]*t+h[6]*i+h[10]*o+h[14])*f,this}applyQuaternion(e){const t=this.x,i=this.y,o=this.z,h=e.x,f=e.y,c=e.z,v=e.w,w=2*(f*o-c*i),S=2*(c*t-h*o),E=2*(h*i-f*t);return this.x=t+v*w+f*E-c*S,this.y=i+v*S+c*w-h*E,this.z=o+v*E+h*S-f*w,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,o=this.z,h=e.elements;return this.x=h[0]*t+h[4]*i+h[8]*o,this.y=h[1]*t+h[5]*i+h[9]*o,this.z=h[2]*t+h[6]*i+h[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,o=e.y,h=e.z,f=t.x,c=t.y,v=t.z;return this.x=o*v-h*c,this.y=h*f-i*v,this.z=i*c-o*f,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return e0.copy(this).projectOnVector(e),this.sub(e0)}reflect(e){return this.sub(e0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(eo(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return t*t+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const o=Math.sin(t)*e;return this.x=o*Math.sin(i),this.y=Math.cos(t)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const e0=new mr,dS=new Qf;let oh=class zv{constructor(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z){zv.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z)}set(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z){const R=this.elements;return R[0]=e,R[4]=t,R[8]=i,R[12]=o,R[1]=h,R[5]=f,R[9]=c,R[13]=v,R[2]=w,R[6]=S,R[10]=E,R[14]=M,R[3]=L,R[7]=U,R[11]=B,R[15]=z,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new zv().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,o=1/fu.setFromMatrixColumn(e,0).length(),h=1/fu.setFromMatrixColumn(e,1).length(),f=1/fu.setFromMatrixColumn(e,2).length();return t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=0,t[4]=i[4]*h,t[5]=i[5]*h,t[6]=i[6]*h,t[7]=0,t[8]=i[8]*f,t[9]=i[9]*f,t[10]=i[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,o=e.y,h=e.z,f=Math.cos(i),c=Math.sin(i),v=Math.cos(o),w=Math.sin(o),S=Math.cos(h),E=Math.sin(h);if(e.order==="XYZ"){const M=f*S,L=f*E,U=c*S,B=c*E;t[0]=v*S,t[4]=-v*E,t[8]=w,t[1]=L+U*w,t[5]=M-B*w,t[9]=-c*v,t[2]=B-M*w,t[6]=U+L*w,t[10]=f*v}else if(e.order==="YXZ"){const M=v*S,L=v*E,U=w*S,B=w*E;t[0]=M+B*c,t[4]=U*c-L,t[8]=f*w,t[1]=f*E,t[5]=f*S,t[9]=-c,t[2]=L*c-U,t[6]=B+M*c,t[10]=f*v}else if(e.order==="ZXY"){const M=v*S,L=v*E,U=w*S,B=w*E;t[0]=M-B*c,t[4]=-f*E,t[8]=U+L*c,t[1]=L+U*c,t[5]=f*S,t[9]=B-M*c,t[2]=-f*w,t[6]=c,t[10]=f*v}else if(e.order==="ZYX"){const M=f*S,L=f*E,U=c*S,B=c*E;t[0]=v*S,t[4]=U*w-L,t[8]=M*w+B,t[1]=v*E,t[5]=B*w+M,t[9]=L*w-U,t[2]=-w,t[6]=c*v,t[10]=f*v}else if(e.order==="YZX"){const M=f*v,L=f*w,U=c*v,B=c*w;t[0]=v*S,t[4]=B-M*E,t[8]=U*E+L,t[1]=E,t[5]=f*S,t[9]=-c*S,t[2]=-w*S,t[6]=L*E+U,t[10]=M-B*E}else if(e.order==="XZY"){const M=f*v,L=f*w,U=c*v,B=c*w;t[0]=v*S,t[4]=-E,t[8]=w*S,t[1]=M*E+B,t[5]=f*S,t[9]=L*E-U,t[2]=U*E-L,t[6]=c*S,t[10]=B*E+M}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(s3,e,a3)}lookAt(e,t,i){const o=this.elements;return hs.subVectors(e,t),hs.lengthSq()===0&&(hs.z=1),hs.normalize(),Ho.crossVectors(i,hs),Ho.lengthSq()===0&&(Math.abs(i.z)===1?hs.x+=1e-4:hs.z+=1e-4,hs.normalize(),Ho.crossVectors(i,hs)),Ho.normalize(),Cm.crossVectors(hs,Ho),o[0]=Ho.x,o[4]=Cm.x,o[8]=hs.x,o[1]=Ho.y,o[5]=Cm.y,o[9]=hs.y,o[2]=Ho.z,o[6]=Cm.z,o[10]=hs.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,h=this.elements,f=i[0],c=i[4],v=i[8],w=i[12],S=i[1],E=i[5],M=i[9],L=i[13],U=i[2],B=i[6],z=i[10],R=i[14],G=i[3],V=i[7],ee=i[11],fe=i[15],Z=o[0],te=o[4],be=o[8],ae=o[12],K=o[1],Pe=o[5],ke=o[9],Te=o[13],je=o[2],it=o[6],ut=o[10],st=o[14],Ce=o[3],Ke=o[7],Ye=o[11],pt=o[15];return h[0]=f*Z+c*K+v*je+w*Ce,h[4]=f*te+c*Pe+v*it+w*Ke,h[8]=f*be+c*ke+v*ut+w*Ye,h[12]=f*ae+c*Te+v*st+w*pt,h[1]=S*Z+E*K+M*je+L*Ce,h[5]=S*te+E*Pe+M*it+L*Ke,h[9]=S*be+E*ke+M*ut+L*Ye,h[13]=S*ae+E*Te+M*st+L*pt,h[2]=U*Z+B*K+z*je+R*Ce,h[6]=U*te+B*Pe+z*it+R*Ke,h[10]=U*be+B*ke+z*ut+R*Ye,h[14]=U*ae+B*Te+z*st+R*pt,h[3]=G*Z+V*K+ee*je+fe*Ce,h[7]=G*te+V*Pe+ee*it+fe*Ke,h[11]=G*be+V*ke+ee*ut+fe*Ye,h[15]=G*ae+V*Te+ee*st+fe*pt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],o=e[8],h=e[12],f=e[1],c=e[5],v=e[9],w=e[13],S=e[2],E=e[6],M=e[10],L=e[14],U=e[3],B=e[7],z=e[11],R=e[15];return U*(+h*v*E-o*w*E-h*c*M+i*w*M+o*c*L-i*v*L)+B*(+t*v*L-t*w*M+h*f*M-o*f*L+o*w*S-h*v*S)+z*(+t*w*E-t*c*L-h*f*E+i*f*L+h*c*S-i*w*S)+R*(-o*c*S-t*v*E+t*c*M+o*f*E-i*f*M+i*v*S)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8],E=e[9],M=e[10],L=e[11],U=e[12],B=e[13],z=e[14],R=e[15],G=E*z*w-B*M*w+B*v*L-c*z*L-E*v*R+c*M*R,V=U*M*w-S*z*w-U*v*L+f*z*L+S*v*R-f*M*R,ee=S*B*w-U*E*w+U*c*L-f*B*L-S*c*R+f*E*R,fe=U*E*v-S*B*v-U*c*M+f*B*M+S*c*z-f*E*z,Z=t*G+i*V+o*ee+h*fe;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const te=1/Z;return e[0]=G*te,e[1]=(B*M*h-E*z*h-B*o*L+i*z*L+E*o*R-i*M*R)*te,e[2]=(c*z*h-B*v*h+B*o*w-i*z*w-c*o*R+i*v*R)*te,e[3]=(E*v*h-c*M*h-E*o*w+i*M*w+c*o*L-i*v*L)*te,e[4]=V*te,e[5]=(S*z*h-U*M*h+U*o*L-t*z*L-S*o*R+t*M*R)*te,e[6]=(U*v*h-f*z*h-U*o*w+t*z*w+f*o*R-t*v*R)*te,e[7]=(f*M*h-S*v*h+S*o*w-t*M*w-f*o*L+t*v*L)*te,e[8]=ee*te,e[9]=(U*E*h-S*B*h-U*i*L+t*B*L+S*i*R-t*E*R)*te,e[10]=(f*B*h-U*c*h+U*i*w-t*B*w-f*i*R+t*c*R)*te,e[11]=(S*c*h-f*E*h-S*i*w+t*E*w+f*i*L-t*c*L)*te,e[12]=fe*te,e[13]=(S*B*o-U*E*o+U*i*M-t*B*M-S*i*z+t*E*z)*te,e[14]=(U*c*o-f*B*o-U*i*v+t*B*v+f*i*z-t*c*z)*te,e[15]=(f*E*o-S*c*o+S*i*v-t*E*v-f*i*M+t*c*M)*te,this}scale(e){const t=this.elements,i=e.x,o=e.y,h=e.z;return t[0]*=i,t[4]*=o,t[8]*=h,t[1]*=i,t[5]*=o,t[9]*=h,t[2]*=i,t[6]*=o,t[10]*=h,t[3]*=i,t[7]*=o,t[11]*=h,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,o))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),o=Math.sin(t),h=1-i,f=e.x,c=e.y,v=e.z,w=h*f,S=h*c;return this.set(w*f+i,w*c-o*v,w*v+o*c,0,w*c+o*v,S*c+i,S*v-o*f,0,w*v-o*c,S*v+o*f,h*v*v+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,o,h,f){return this.set(1,i,h,0,e,1,f,0,t,o,1,0,0,0,0,1),this}compose(e,t,i){const o=this.elements,h=t._x,f=t._y,c=t._z,v=t._w,w=h+h,S=f+f,E=c+c,M=h*w,L=h*S,U=h*E,B=f*S,z=f*E,R=c*E,G=v*w,V=v*S,ee=v*E,fe=i.x,Z=i.y,te=i.z;return o[0]=(1-(B+R))*fe,o[1]=(L+ee)*fe,o[2]=(U-V)*fe,o[3]=0,o[4]=(L-ee)*Z,o[5]=(1-(M+R))*Z,o[6]=(z+G)*Z,o[7]=0,o[8]=(U+V)*te,o[9]=(z-G)*te,o[10]=(1-(M+B))*te,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,i){const o=this.elements;let h=fu.set(o[0],o[1],o[2]).length();const f=fu.set(o[4],o[5],o[6]).length(),c=fu.set(o[8],o[9],o[10]).length();this.determinant()<0&&(h=-h),e.x=o[12],e.y=o[13],e.z=o[14],Zs.copy(this);const w=1/h,S=1/f,E=1/c;return Zs.elements[0]*=w,Zs.elements[1]*=w,Zs.elements[2]*=w,Zs.elements[4]*=S,Zs.elements[5]*=S,Zs.elements[6]*=S,Zs.elements[8]*=E,Zs.elements[9]*=E,Zs.elements[10]*=E,t.setFromRotationMatrix(Zs),i.x=h,i.y=f,i.z=c,this}makePerspective(e,t,i,o,h,f,c=Am){const v=this.elements,w=2*h/(t-e),S=2*h/(i-o),E=(t+e)/(t-e),M=(i+o)/(i-o);let L,U;if(c===Am)L=-(f+h)/(f-h),U=-2*f*h/(f-h);else if(c===uS)L=-f/(f-h),U=-f*h/(f-h);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return v[0]=w,v[4]=0,v[8]=E,v[12]=0,v[1]=0,v[5]=S,v[9]=M,v[13]=0,v[2]=0,v[6]=0,v[10]=L,v[14]=U,v[3]=0,v[7]=0,v[11]=-1,v[15]=0,this}makeOrthographic(e,t,i,o,h,f,c=Am){const v=this.elements,w=1/(t-e),S=1/(i-o),E=1/(f-h),M=(t+e)*w,L=(i+o)*S;let U,B;if(c===Am)U=(f+h)*E,B=-2*E;else if(c===uS)U=h*E,B=-1*E;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return v[0]=2*w,v[4]=0,v[8]=0,v[12]=-M,v[1]=0,v[5]=2*S,v[9]=0,v[13]=-L,v[2]=0,v[6]=0,v[10]=B,v[14]=-U,v[3]=0,v[7]=0,v[11]=0,v[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<16;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const fu=new mr,Zs=new oh,s3=new mr(0,0,0),a3=new mr(1,1,1),Ho=new mr,Cm=new mr,hs=new mr,fS=new oh,pS=new Qf;let B2=class V2{constructor(e=0,t=0,i=0,o=V2.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,o=this._order){return this._x=e,this._y=t,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const o=e.elements,h=o[0],f=o[4],c=o[8],v=o[1],w=o[5],S=o[9],E=o[2],M=o[6],L=o[10];switch(t){case"XYZ":this._y=Math.asin(eo(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-S,L),this._z=Math.atan2(-f,h)):(this._x=Math.atan2(M,w),this._z=0);break;case"YXZ":this._x=Math.asin(-eo(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(c,L),this._z=Math.atan2(v,w)):(this._y=Math.atan2(-E,h),this._z=0);break;case"ZXY":this._x=Math.asin(eo(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-E,L),this._z=Math.atan2(-f,w)):(this._y=0,this._z=Math.atan2(v,h));break;case"ZYX":this._y=Math.asin(-eo(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(M,L),this._z=Math.atan2(v,h)):(this._x=0,this._z=Math.atan2(-f,w));break;case"YZX":this._z=Math.asin(eo(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-S,w),this._y=Math.atan2(-E,h)):(this._x=0,this._y=Math.atan2(c,L));break;case"XZY":this._z=Math.asin(-eo(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(M,w),this._y=Math.atan2(c,h)):(this._x=Math.atan2(-S,L),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return fS.makeRotationFromQuaternion(e),this.setFromRotationMatrix(fS,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return pS.setFromEuler(this),this.setFromQuaternion(pS,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};B2.DEFAULT_ORDER="XYZ";let o3=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},l3=0;const mS=new mr,pu=new Qf,Wa=new oh,Pm=new mr,Kd=new mr,c3=new mr,u3=new Qf,gS=new mr(1,0,0),_S=new mr(0,1,0),yS=new mr(0,0,1),vS={type:"added"},h3={type:"removed"},mu={type:"childadded",child:null},t0={type:"childremoved",child:null};let Wx=class dg extends F2{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:l3++}),this.uuid=Hx(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=dg.DEFAULT_UP.clone();const e=new mr,t=new B2,i=new Qf,o=new mr(1,1,1);function h(){i.setFromEuler(t,!1)}function f(){t.setFromQuaternion(i,void 0,!1)}t._onChange(h),i._onChange(f),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new oh},normalMatrix:{value:new jx}}),this.matrix=new oh,this.matrixWorld=new oh,this.matrixAutoUpdate=dg.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=dg.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new o3,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return pu.setFromAxisAngle(e,t),this.quaternion.multiply(pu),this}rotateOnWorldAxis(e,t){return pu.setFromAxisAngle(e,t),this.quaternion.premultiply(pu),this}rotateX(e){return this.rotateOnAxis(gS,e)}rotateY(e){return this.rotateOnAxis(_S,e)}rotateZ(e){return this.rotateOnAxis(yS,e)}translateOnAxis(e,t){return mS.copy(e).applyQuaternion(this.quaternion),this.position.add(mS.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(gS,e)}translateY(e){return this.translateOnAxis(_S,e)}translateZ(e){return this.translateOnAxis(yS,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Wa.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Pm.copy(e):Pm.set(e,t,i);const o=this.parent;this.updateWorldMatrix(!0,!1),Kd.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Wa.lookAt(Kd,Pm,this.up):Wa.lookAt(Pm,Kd,this.up),this.quaternion.setFromRotationMatrix(Wa),o&&(Wa.extractRotation(o.matrixWorld),pu.setFromRotationMatrix(Wa),this.quaternion.premultiply(pu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(vS),mu.child=e,this.dispatchEvent(mu),mu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(h3),t0.child=e,this.dispatchEvent(t0),t0.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Wa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Wa.multiply(e.parent.matrixWorld)),e.applyMatrix4(Wa),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(vS),mu.child=e,this.dispatchEvent(mu),mu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,o=this.children.length;i<o;i++){const f=this.children[i].getObjectByProperty(e,t);if(f!==void 0)return f}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const o=this.children;for(let h=0,f=o.length;h<f;h++)o[h].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kd,e,c3),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Kd,u3,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,o=t.length;i<o;i++){const h=t[i];(h.matrixWorldAutoUpdate===!0||e===!0)&&h.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const o=this.children;for(let h=0,f=o.length;h<f;h++){const c=o[h];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),o.maxGeometryCount=this._maxGeometryCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}));function h(c,v){return c[v.uuid]===void 0&&(c[v.uuid]=v.toJSON(e)),v.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=h(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const v=c.shapes;if(Array.isArray(v))for(let w=0,S=v.length;w<S;w++){const E=v[w];h(e.shapes,E)}else h(e.shapes,v)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(h(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let v=0,w=this.material.length;v<w;v++)c.push(h(e.materials,this.material[v]));o.material=c}else o.material=h(e.materials,this.material);if(this.children.length>0){o.children=[];for(let c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let c=0;c<this.animations.length;c++){const v=this.animations[c];o.animations.push(h(e.animations,v))}}if(t){const c=f(e.geometries),v=f(e.materials),w=f(e.textures),S=f(e.images),E=f(e.shapes),M=f(e.skeletons),L=f(e.animations),U=f(e.nodes);c.length>0&&(i.geometries=c),v.length>0&&(i.materials=v),w.length>0&&(i.textures=w),S.length>0&&(i.images=S),E.length>0&&(i.shapes=E),M.length>0&&(i.skeletons=M),L.length>0&&(i.animations=L),U.length>0&&(i.nodes=U)}return i.object=o,i;function f(c){const v=[];for(const w in c){const S=c[w];delete S.metadata,v.push(S)}return v}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}};Wx.DEFAULT_UP=new mr(0,1,0);Wx.DEFAULT_MATRIX_AUTO_UPDATE=!0;Wx.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let d3=class extends h_{constructor(e,t,i,o,h,f,c,v,w,S){if(S=S!==void 0?S:Zy,S!==Zy&&S!==cS)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&S===Zy&&(i=YD),i===void 0&&S===cS&&(i=KD),super(null,o,h,f,c,v,S,i,w),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=c!==void 0?c:lS,this.minFilter=v!==void 0?v:lS,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};const f3=new d3(1,1);f3.compareFunction=e3;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:z2}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=z2);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const $x="163",gu={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},_u={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},p3=0,xS=1,m3=2,G2=1,g3=2,Ka=3,xl=0,jr=1,to=2,ml=0,lh=1,bS=2,wS=3,SS=4,_3=5,sc=100,y3=101,v3=102,x3=103,b3=104,w3=200,S3=201,M3=202,T3=203,kv=204,Fv=205,E3=206,A3=207,C3=208,P3=209,R3=210,I3=211,L3=212,D3=213,z3=214,k3=0,F3=1,U3=2,Bg=3,N3=4,O3=5,B3=6,V3=7,H2=0,G3=1,H3=2,gl=0,j3=1,W3=2,$3=3,X3=4,q3=5,Z3=6,Y3=7,j2=300,wh=301,Sh=302,Uv=303,Nv=304,d_=306,Ov=1e3,dc=1001,Bv=1002,Us=1003,K3=1004,Rm=1005,ia=1006,n0=1007,fc=1008,_l=1009,J3=1010,Q3=1011,W2=1012,$2=1013,Mh=1014,al=1015,Vg=1016,X2=1017,q2=1018,ep=1020,ez=35902,tz=1021,nz=1022,wa=1023,iz=1024,rz=1025,ch=1026,Bf=1027,sz=1028,Z2=1029,az=1030,Y2=1031,K2=1033,i0=33776,r0=33777,s0=33778,a0=33779,MS=35840,TS=35841,ES=35842,AS=35843,J2=36196,CS=37492,PS=37496,RS=37808,IS=37809,LS=37810,DS=37811,zS=37812,kS=37813,FS=37814,US=37815,NS=37816,OS=37817,BS=37818,VS=37819,GS=37820,HS=37821,o0=36492,jS=36494,WS=36495,oz=36283,$S=36284,XS=36285,qS=36286,lz=3200,cz=3201,uz=0,hz=1,il="",ya="srgb",El="srgb-linear",Xx="display-p3",f_="display-p3-linear",Gg="linear",gi="srgb",Hg="rec709",jg="p3",yu=7680,ZS=519,dz=512,fz=513,pz=514,Q2=515,mz=516,gz=517,_z=518,yz=519,YS=35044,KS="300 es",ro=2e3,Wg=2001;class Ac{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const o=this._listeners[e];if(o!==void 0){const h=o.indexOf(t);h!==-1&&o.splice(h,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const o=i.slice(0);for(let h=0,f=o.length;h<f;h++)o[h].call(this,e);e.target=null}}}const Ar=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let JS=1234567;const vf=Math.PI/180,Vf=180/Math.PI;function Rh(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(Ar[n&255]+Ar[n>>8&255]+Ar[n>>16&255]+Ar[n>>24&255]+"-"+Ar[e&255]+Ar[e>>8&255]+"-"+Ar[e>>16&15|64]+Ar[e>>24&255]+"-"+Ar[t&63|128]+Ar[t>>8&255]+"-"+Ar[t>>16&255]+Ar[t>>24&255]+Ar[i&255]+Ar[i>>8&255]+Ar[i>>16&255]+Ar[i>>24&255]).toLowerCase()}function Rr(n,e,t){return Math.max(e,Math.min(t,n))}function qx(n,e){return(n%e+e)%e}function vz(n,e,t,i,o){return i+(n-e)*(o-i)/(t-e)}function xz(n,e,t){return n!==e?(t-n)/(e-n):0}function xf(n,e,t){return(1-t)*n+t*e}function bz(n,e,t,i){return xf(n,e,1-Math.exp(-t*i))}function wz(n,e=1){return e-Math.abs(qx(n,e*2)-e)}function Sz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function Mz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function Tz(n,e){return n+Math.floor(Math.random()*(e-n+1))}function Ez(n,e){return n+Math.random()*(e-n)}function Az(n){return n*(.5-Math.random())}function Cz(n){n!==void 0&&(JS=n);let e=JS+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function Pz(n){return n*vf}function Rz(n){return n*Vf}function Iz(n){return(n&n-1)===0&&n!==0}function Lz(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function Dz(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function zz(n,e,t,i,o){const h=Math.cos,f=Math.sin,c=h(t/2),v=f(t/2),w=h((e+i)/2),S=f((e+i)/2),E=h((e-i)/2),M=f((e-i)/2),L=h((i-e)/2),U=f((i-e)/2);switch(o){case"XYX":n.set(c*S,v*E,v*M,c*w);break;case"YZY":n.set(v*M,c*S,v*E,c*w);break;case"ZXZ":n.set(v*E,v*M,c*S,c*w);break;case"XZX":n.set(c*S,v*U,v*L,c*w);break;case"YXY":n.set(v*L,c*S,v*U,c*w);break;case"ZYZ":n.set(v*U,v*L,c*S,c*w);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+o)}}function Fu(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Br(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const kz={DEG2RAD:vf,RAD2DEG:Vf,generateUUID:Rh,clamp:Rr,euclideanModulo:qx,mapLinear:vz,inverseLerp:xz,lerp:xf,damp:bz,pingpong:wz,smoothstep:Sz,smootherstep:Mz,randInt:Tz,randFloat:Ez,randFloatSpread:Az,seededRandom:Cz,degToRad:Pz,radToDeg:Rz,isPowerOfTwo:Iz,ceilPowerOfTwo:Lz,floorPowerOfTwo:Dz,setQuaternionFromProperEuler:zz,normalize:Br,denormalize:Fu};class Pn{constructor(e=0,t=0){Pn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,o=e.elements;return this.x=o[0]*t+o[3]*i+o[6],this.y=o[1]*t+o[4]*i+o[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Rr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),o=Math.sin(t),h=this.x-e.x,f=this.y-e.y;return this.x=h*i-f*o+e.x,this.y=h*o+f*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Dn{constructor(e,t,i,o,h,f,c,v,w){Dn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,o,h,f,c,v,w)}set(e,t,i,o,h,f,c,v,w){const S=this.elements;return S[0]=e,S[1]=o,S[2]=c,S[3]=t,S[4]=h,S[5]=v,S[6]=i,S[7]=f,S[8]=w,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,h=this.elements,f=i[0],c=i[3],v=i[6],w=i[1],S=i[4],E=i[7],M=i[2],L=i[5],U=i[8],B=o[0],z=o[3],R=o[6],G=o[1],V=o[4],ee=o[7],fe=o[2],Z=o[5],te=o[8];return h[0]=f*B+c*G+v*fe,h[3]=f*z+c*V+v*Z,h[6]=f*R+c*ee+v*te,h[1]=w*B+S*G+E*fe,h[4]=w*z+S*V+E*Z,h[7]=w*R+S*ee+E*te,h[2]=M*B+L*G+U*fe,h[5]=M*z+L*V+U*Z,h[8]=M*R+L*ee+U*te,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8];return t*f*S-t*c*w-i*h*S+i*c*v+o*h*w-o*f*v}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8],E=S*f-c*w,M=c*v-S*h,L=w*h-f*v,U=t*E+i*M+o*L;if(U===0)return this.set(0,0,0,0,0,0,0,0,0);const B=1/U;return e[0]=E*B,e[1]=(o*w-S*i)*B,e[2]=(c*i-o*f)*B,e[3]=M*B,e[4]=(S*t-o*v)*B,e[5]=(o*h-c*t)*B,e[6]=L*B,e[7]=(i*v-w*t)*B,e[8]=(f*t-i*h)*B,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,o,h,f,c){const v=Math.cos(h),w=Math.sin(h);return this.set(i*v,i*w,-i*(v*f+w*c)+f+e,-o*w,o*v,-o*(-w*f+v*c)+c+t,0,0,1),this}scale(e,t){return this.premultiply(l0.makeScale(e,t)),this}rotate(e){return this.premultiply(l0.makeRotation(-e)),this}translate(e,t){return this.premultiply(l0.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<9;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const l0=new Dn;function eA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Gf(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function Fz(){const n=Gf("canvas");return n.style.display="block",n}const QS={};function Uz(n){n in QS||(QS[n]=!0,console.warn(n))}const eM=new Dn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tM=new Dn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Im={[El]:{transfer:Gg,primaries:Hg,toReference:n=>n,fromReference:n=>n},[ya]:{transfer:gi,primaries:Hg,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[f_]:{transfer:Gg,primaries:jg,toReference:n=>n.applyMatrix3(tM),fromReference:n=>n.applyMatrix3(eM)},[Xx]:{transfer:gi,primaries:jg,toReference:n=>n.convertSRGBToLinear().applyMatrix3(tM),fromReference:n=>n.applyMatrix3(eM).convertLinearToSRGB()}},Nz=new Set([El,f_]),ri={enabled:!0,_workingColorSpace:El,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!Nz.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=Im[e].toReference,o=Im[t].fromReference;return o(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Im[n].primaries},getTransfer:function(n){return n===il?Gg:Im[n].transfer}};function uh(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function c0(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let vu;class Oz{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{vu===void 0&&(vu=Gf("canvas")),vu.width=e.width,vu.height=e.height;const i=vu.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=vu}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Gf("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const o=i.getImageData(0,0,e.width,e.height),h=o.data;for(let f=0;f<h.length;f++)h[f]=uh(h[f]/255)*255;return i.putImageData(o,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(uh(t[i]/255)*255):t[i]=uh(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let Bz=0;class tA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Bz++}),this.uuid=Rh(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},o=this.data;if(o!==null){let h;if(Array.isArray(o)){h=[];for(let f=0,c=o.length;f<c;f++)o[f].isDataTexture?h.push(u0(o[f].image)):h.push(u0(o[f]))}else h=u0(o);i.url=h}return t||(e.images[this.uuid]=i),i}}function u0(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?Oz.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Vz=0;class Wr extends Ac{constructor(e=Wr.DEFAULT_IMAGE,t=Wr.DEFAULT_MAPPING,i=dc,o=dc,h=ia,f=fc,c=wa,v=_l,w=Wr.DEFAULT_ANISOTROPY,S=il){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Vz++}),this.uuid=Rh(),this.name="",this.source=new tA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=o,this.magFilter=h,this.minFilter=f,this.anisotropy=w,this.format=c,this.internalFormat=null,this.type=v,this.offset=new Pn(0,0),this.repeat=new Pn(1,1),this.center=new Pn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Dn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==j2)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ov:e.x=e.x-Math.floor(e.x);break;case dc:e.x=e.x<0?0:1;break;case Bv:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ov:e.y=e.y-Math.floor(e.y);break;case dc:e.y=e.y<0?0:1;break;case Bv:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Wr.DEFAULT_IMAGE=null;Wr.DEFAULT_MAPPING=j2;Wr.DEFAULT_ANISOTROPY=1;class dr{constructor(e=0,t=0,i=0,o=1){dr.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=o}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,o){return this.x=e,this.y=t,this.z=i,this.w=o,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,h=this.w,f=e.elements;return this.x=f[0]*t+f[4]*i+f[8]*o+f[12]*h,this.y=f[1]*t+f[5]*i+f[9]*o+f[13]*h,this.z=f[2]*t+f[6]*i+f[10]*o+f[14]*h,this.w=f[3]*t+f[7]*i+f[11]*o+f[15]*h,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,o,h;const v=e.elements,w=v[0],S=v[4],E=v[8],M=v[1],L=v[5],U=v[9],B=v[2],z=v[6],R=v[10];if(Math.abs(S-M)<.01&&Math.abs(E-B)<.01&&Math.abs(U-z)<.01){if(Math.abs(S+M)<.1&&Math.abs(E+B)<.1&&Math.abs(U+z)<.1&&Math.abs(w+L+R-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const V=(w+1)/2,ee=(L+1)/2,fe=(R+1)/2,Z=(S+M)/4,te=(E+B)/4,be=(U+z)/4;return V>ee&&V>fe?V<.01?(i=0,o=.707106781,h=.707106781):(i=Math.sqrt(V),o=Z/i,h=te/i):ee>fe?ee<.01?(i=.707106781,o=0,h=.707106781):(o=Math.sqrt(ee),i=Z/o,h=be/o):fe<.01?(i=.707106781,o=.707106781,h=0):(h=Math.sqrt(fe),i=te/h,o=be/h),this.set(i,o,h,t),this}let G=Math.sqrt((z-U)*(z-U)+(E-B)*(E-B)+(M-S)*(M-S));return Math.abs(G)<.001&&(G=1),this.x=(z-U)/G,this.y=(E-B)/G,this.z=(M-S)/G,this.w=Math.acos((w+L+R-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Gz extends Ac{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new dr(0,0,e,t),this.scissorTest=!1,this.viewport=new dr(0,0,e,t);const o={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:ia,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},i);const h=new Wr(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);h.flipY=!1,h.generateMipmaps=i.generateMipmaps,h.internalFormat=i.internalFormat,this.textures=[];const f=i.count;for(let c=0;c<f;c++)this.textures[c]=h.clone(),this.textures[c].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let o=0,h=this.textures.length;o<h;o++)this.textures[o].image.width=e,this.textures[o].image.height=t,this.textures[o].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,o=e.textures.length;i<o;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new tA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class wc extends Gz{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class nA extends Wr{constructor(e=null,t=1,i=1,o=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=Us,this.minFilter=Us,this.wrapR=dc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Hz extends Wr{constructor(e=null,t=1,i=1,o=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:o},this.magFilter=Us,this.minFilter=Us,this.wrapR=dc,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Sc{constructor(e=0,t=0,i=0,o=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=o}static slerpFlat(e,t,i,o,h,f,c){let v=i[o+0],w=i[o+1],S=i[o+2],E=i[o+3];const M=h[f+0],L=h[f+1],U=h[f+2],B=h[f+3];if(c===0){e[t+0]=v,e[t+1]=w,e[t+2]=S,e[t+3]=E;return}if(c===1){e[t+0]=M,e[t+1]=L,e[t+2]=U,e[t+3]=B;return}if(E!==B||v!==M||w!==L||S!==U){let z=1-c;const R=v*M+w*L+S*U+E*B,G=R>=0?1:-1,V=1-R*R;if(V>Number.EPSILON){const fe=Math.sqrt(V),Z=Math.atan2(fe,R*G);z=Math.sin(z*Z)/fe,c=Math.sin(c*Z)/fe}const ee=c*G;if(v=v*z+M*ee,w=w*z+L*ee,S=S*z+U*ee,E=E*z+B*ee,z===1-c){const fe=1/Math.sqrt(v*v+w*w+S*S+E*E);v*=fe,w*=fe,S*=fe,E*=fe}}e[t]=v,e[t+1]=w,e[t+2]=S,e[t+3]=E}static multiplyQuaternionsFlat(e,t,i,o,h,f){const c=i[o],v=i[o+1],w=i[o+2],S=i[o+3],E=h[f],M=h[f+1],L=h[f+2],U=h[f+3];return e[t]=c*U+S*E+v*L-w*M,e[t+1]=v*U+S*M+w*E-c*L,e[t+2]=w*U+S*L+c*M-v*E,e[t+3]=S*U-c*E-v*M-w*L,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,o){return this._x=e,this._y=t,this._z=i,this._w=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,o=e._y,h=e._z,f=e._order,c=Math.cos,v=Math.sin,w=c(i/2),S=c(o/2),E=c(h/2),M=v(i/2),L=v(o/2),U=v(h/2);switch(f){case"XYZ":this._x=M*S*E+w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E-M*L*U;break;case"YXZ":this._x=M*S*E+w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E+M*L*U;break;case"ZXY":this._x=M*S*E-w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E-M*L*U;break;case"ZYX":this._x=M*S*E-w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E+M*L*U;break;case"YZX":this._x=M*S*E+w*L*U,this._y=w*L*E+M*S*U,this._z=w*S*U-M*L*E,this._w=w*S*E-M*L*U;break;case"XZY":this._x=M*S*E-w*L*U,this._y=w*L*E-M*S*U,this._z=w*S*U+M*L*E,this._w=w*S*E+M*L*U;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+f)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,o=Math.sin(i);return this._x=e.x*o,this._y=e.y*o,this._z=e.z*o,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],o=t[4],h=t[8],f=t[1],c=t[5],v=t[9],w=t[2],S=t[6],E=t[10],M=i+c+E;if(M>0){const L=.5/Math.sqrt(M+1);this._w=.25/L,this._x=(S-v)*L,this._y=(h-w)*L,this._z=(f-o)*L}else if(i>c&&i>E){const L=2*Math.sqrt(1+i-c-E);this._w=(S-v)/L,this._x=.25*L,this._y=(o+f)/L,this._z=(h+w)/L}else if(c>E){const L=2*Math.sqrt(1+c-i-E);this._w=(h-w)/L,this._x=(o+f)/L,this._y=.25*L,this._z=(v+S)/L}else{const L=2*Math.sqrt(1+E-i-c);this._w=(f-o)/L,this._x=(h+w)/L,this._y=(v+S)/L,this._z=.25*L}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(Rr(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const o=Math.min(1,t/i);return this.slerp(e,o),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,o=e._y,h=e._z,f=e._w,c=t._x,v=t._y,w=t._z,S=t._w;return this._x=i*S+f*c+o*w-h*v,this._y=o*S+f*v+h*c-i*w,this._z=h*S+f*w+i*v-o*c,this._w=f*S-i*c-o*v-h*w,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,o=this._y,h=this._z,f=this._w;let c=f*e._w+i*e._x+o*e._y+h*e._z;if(c<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,c=-c):this.copy(e),c>=1)return this._w=f,this._x=i,this._y=o,this._z=h,this;const v=1-c*c;if(v<=Number.EPSILON){const L=1-t;return this._w=L*f+t*this._w,this._x=L*i+t*this._x,this._y=L*o+t*this._y,this._z=L*h+t*this._z,this.normalize(),this}const w=Math.sqrt(v),S=Math.atan2(w,c),E=Math.sin((1-t)*S)/w,M=Math.sin(t*S)/w;return this._w=f*E+this._w*M,this._x=i*E+this._x*M,this._y=o*E+this._y*M,this._z=h*E+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),o=Math.sqrt(1-i),h=Math.sqrt(i);return this.set(o*Math.sin(e),o*Math.cos(e),h*Math.sin(t),h*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class $e{constructor(e=0,t=0,i=0){$e.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(nM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nM.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,o=this.z,h=e.elements;return this.x=h[0]*t+h[3]*i+h[6]*o,this.y=h[1]*t+h[4]*i+h[7]*o,this.z=h[2]*t+h[5]*i+h[8]*o,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,o=this.z,h=e.elements,f=1/(h[3]*t+h[7]*i+h[11]*o+h[15]);return this.x=(h[0]*t+h[4]*i+h[8]*o+h[12])*f,this.y=(h[1]*t+h[5]*i+h[9]*o+h[13])*f,this.z=(h[2]*t+h[6]*i+h[10]*o+h[14])*f,this}applyQuaternion(e){const t=this.x,i=this.y,o=this.z,h=e.x,f=e.y,c=e.z,v=e.w,w=2*(f*o-c*i),S=2*(c*t-h*o),E=2*(h*i-f*t);return this.x=t+v*w+f*E-c*S,this.y=i+v*S+c*w-h*E,this.z=o+v*E+h*S-f*w,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,o=this.z,h=e.elements;return this.x=h[0]*t+h[4]*i+h[8]*o,this.y=h[1]*t+h[5]*i+h[9]*o,this.z=h[2]*t+h[6]*i+h[10]*o,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,o=e.y,h=e.z,f=t.x,c=t.y,v=t.z;return this.x=o*v-h*c,this.y=h*f-i*v,this.z=i*c-o*f,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return h0.copy(this).projectOnVector(e),this.sub(h0)}reflect(e){return this.sub(h0.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(Rr(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,o=this.z-e.z;return t*t+i*i+o*o}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const o=Math.sin(t)*e;return this.x=o*Math.sin(i),this.y=Math.cos(t)*e,this.z=o*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),o=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=o,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const h0=new $e,nM=new Sc;class tp{constructor(e=new $e(1/0,1/0,1/0),t=new $e(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Ys.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Ys.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ys.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const h=i.getAttribute("position");if(t===!0&&h!==void 0&&e.isInstancedMesh!==!0)for(let f=0,c=h.count;f<c;f++)e.isMesh===!0?e.getVertexPosition(f,Ys):Ys.fromBufferAttribute(h,f),Ys.applyMatrix4(e.matrixWorld),this.expandByPoint(Ys);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Lm.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Lm.copy(i.boundingBox)),Lm.applyMatrix4(e.matrixWorld),this.union(Lm)}const o=e.children;for(let h=0,f=o.length;h<f;h++)this.expandByObject(o[h],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ys),Ys.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Jd),Dm.subVectors(this.max,Jd),xu.subVectors(e.a,Jd),bu.subVectors(e.b,Jd),wu.subVectors(e.c,Jd),jo.subVectors(bu,xu),Wo.subVectors(wu,bu),Zl.subVectors(xu,wu);let t=[0,-jo.z,jo.y,0,-Wo.z,Wo.y,0,-Zl.z,Zl.y,jo.z,0,-jo.x,Wo.z,0,-Wo.x,Zl.z,0,-Zl.x,-jo.y,jo.x,0,-Wo.y,Wo.x,0,-Zl.y,Zl.x,0];return!d0(t,xu,bu,wu,Dm)||(t=[1,0,0,0,1,0,0,0,1],!d0(t,xu,bu,wu,Dm))?!1:(zm.crossVectors(jo,Wo),t=[zm.x,zm.y,zm.z],d0(t,xu,bu,wu,Dm))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ys).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ys).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:($a[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),$a[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),$a[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),$a[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),$a[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),$a[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),$a[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),$a[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints($a),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const $a=[new $e,new $e,new $e,new $e,new $e,new $e,new $e,new $e],Ys=new $e,Lm=new tp,xu=new $e,bu=new $e,wu=new $e,jo=new $e,Wo=new $e,Zl=new $e,Jd=new $e,Dm=new $e,zm=new $e,Yl=new $e;function d0(n,e,t,i,o){for(let h=0,f=n.length-3;h<=f;h+=3){Yl.fromArray(n,h);const c=o.x*Math.abs(Yl.x)+o.y*Math.abs(Yl.y)+o.z*Math.abs(Yl.z),v=e.dot(Yl),w=t.dot(Yl),S=i.dot(Yl);if(Math.max(-Math.max(v,w,S),Math.min(v,w,S))>c)return!1}return!0}const jz=new tp,Qd=new $e,f0=new $e;class Zx{constructor(e=new $e,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):jz.setFromPoints(e).getCenter(i);let o=0;for(let h=0,f=e.length;h<f;h++)o=Math.max(o,i.distanceToSquared(e[h]));return this.radius=Math.sqrt(o),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Qd.subVectors(e,this.center);const t=Qd.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),o=(i-this.radius)*.5;this.center.addScaledVector(Qd,o/i),this.radius+=o}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(f0.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Qd.copy(e.center).add(f0)),this.expandByPoint(Qd.copy(e.center).sub(f0))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Xa=new $e,p0=new $e,km=new $e,$o=new $e,m0=new $e,Fm=new $e,g0=new $e;class iA{constructor(e=new $e,t=new $e(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Xa)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Xa.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Xa.copy(this.origin).addScaledVector(this.direction,t),Xa.distanceToSquared(e))}distanceSqToSegment(e,t,i,o){p0.copy(e).add(t).multiplyScalar(.5),km.copy(t).sub(e).normalize(),$o.copy(this.origin).sub(p0);const h=e.distanceTo(t)*.5,f=-this.direction.dot(km),c=$o.dot(this.direction),v=-$o.dot(km),w=$o.lengthSq(),S=Math.abs(1-f*f);let E,M,L,U;if(S>0)if(E=f*v-c,M=f*c-v,U=h*S,E>=0)if(M>=-U)if(M<=U){const B=1/S;E*=B,M*=B,L=E*(E+f*M+2*c)+M*(f*E+M+2*v)+w}else M=h,E=Math.max(0,-(f*M+c)),L=-E*E+M*(M+2*v)+w;else M=-h,E=Math.max(0,-(f*M+c)),L=-E*E+M*(M+2*v)+w;else M<=-U?(E=Math.max(0,-(-f*h+c)),M=E>0?-h:Math.min(Math.max(-h,-v),h),L=-E*E+M*(M+2*v)+w):M<=U?(E=0,M=Math.min(Math.max(-h,-v),h),L=M*(M+2*v)+w):(E=Math.max(0,-(f*h+c)),M=E>0?h:Math.min(Math.max(-h,-v),h),L=-E*E+M*(M+2*v)+w);else M=f>0?-h:h,E=Math.max(0,-(f*M+c)),L=-E*E+M*(M+2*v)+w;return i&&i.copy(this.origin).addScaledVector(this.direction,E),o&&o.copy(p0).addScaledVector(km,M),L}intersectSphere(e,t){Xa.subVectors(e.center,this.origin);const i=Xa.dot(this.direction),o=Xa.dot(Xa)-i*i,h=e.radius*e.radius;if(o>h)return null;const f=Math.sqrt(h-o),c=i-f,v=i+f;return v<0?null:c<0?this.at(v,t):this.at(c,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,o,h,f,c,v;const w=1/this.direction.x,S=1/this.direction.y,E=1/this.direction.z,M=this.origin;return w>=0?(i=(e.min.x-M.x)*w,o=(e.max.x-M.x)*w):(i=(e.max.x-M.x)*w,o=(e.min.x-M.x)*w),S>=0?(h=(e.min.y-M.y)*S,f=(e.max.y-M.y)*S):(h=(e.max.y-M.y)*S,f=(e.min.y-M.y)*S),i>f||h>o||((h>i||isNaN(i))&&(i=h),(f<o||isNaN(o))&&(o=f),E>=0?(c=(e.min.z-M.z)*E,v=(e.max.z-M.z)*E):(c=(e.max.z-M.z)*E,v=(e.min.z-M.z)*E),i>v||c>o)||((c>i||i!==i)&&(i=c),(v<o||o!==o)&&(o=v),o<0)?null:this.at(i>=0?i:o,t)}intersectsBox(e){return this.intersectBox(e,Xa)!==null}intersectTriangle(e,t,i,o,h){m0.subVectors(t,e),Fm.subVectors(i,e),g0.crossVectors(m0,Fm);let f=this.direction.dot(g0),c;if(f>0){if(o)return null;c=1}else if(f<0)c=-1,f=-f;else return null;$o.subVectors(this.origin,e);const v=c*this.direction.dot(Fm.crossVectors($o,Fm));if(v<0)return null;const w=c*this.direction.dot(m0.cross($o));if(w<0||v+w>f)return null;const S=-c*$o.dot(g0);return S<0?null:this.at(S/f,h)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Yi{constructor(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z){Yi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z)}set(e,t,i,o,h,f,c,v,w,S,E,M,L,U,B,z){const R=this.elements;return R[0]=e,R[4]=t,R[8]=i,R[12]=o,R[1]=h,R[5]=f,R[9]=c,R[13]=v,R[2]=w,R[6]=S,R[10]=E,R[14]=M,R[3]=L,R[7]=U,R[11]=B,R[15]=z,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Yi().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,o=1/Su.setFromMatrixColumn(e,0).length(),h=1/Su.setFromMatrixColumn(e,1).length(),f=1/Su.setFromMatrixColumn(e,2).length();return t[0]=i[0]*o,t[1]=i[1]*o,t[2]=i[2]*o,t[3]=0,t[4]=i[4]*h,t[5]=i[5]*h,t[6]=i[6]*h,t[7]=0,t[8]=i[8]*f,t[9]=i[9]*f,t[10]=i[10]*f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,o=e.y,h=e.z,f=Math.cos(i),c=Math.sin(i),v=Math.cos(o),w=Math.sin(o),S=Math.cos(h),E=Math.sin(h);if(e.order==="XYZ"){const M=f*S,L=f*E,U=c*S,B=c*E;t[0]=v*S,t[4]=-v*E,t[8]=w,t[1]=L+U*w,t[5]=M-B*w,t[9]=-c*v,t[2]=B-M*w,t[6]=U+L*w,t[10]=f*v}else if(e.order==="YXZ"){const M=v*S,L=v*E,U=w*S,B=w*E;t[0]=M+B*c,t[4]=U*c-L,t[8]=f*w,t[1]=f*E,t[5]=f*S,t[9]=-c,t[2]=L*c-U,t[6]=B+M*c,t[10]=f*v}else if(e.order==="ZXY"){const M=v*S,L=v*E,U=w*S,B=w*E;t[0]=M-B*c,t[4]=-f*E,t[8]=U+L*c,t[1]=L+U*c,t[5]=f*S,t[9]=B-M*c,t[2]=-f*w,t[6]=c,t[10]=f*v}else if(e.order==="ZYX"){const M=f*S,L=f*E,U=c*S,B=c*E;t[0]=v*S,t[4]=U*w-L,t[8]=M*w+B,t[1]=v*E,t[5]=B*w+M,t[9]=L*w-U,t[2]=-w,t[6]=c*v,t[10]=f*v}else if(e.order==="YZX"){const M=f*v,L=f*w,U=c*v,B=c*w;t[0]=v*S,t[4]=B-M*E,t[8]=U*E+L,t[1]=E,t[5]=f*S,t[9]=-c*S,t[2]=-w*S,t[6]=L*E+U,t[10]=M-B*E}else if(e.order==="XZY"){const M=f*v,L=f*w,U=c*v,B=c*w;t[0]=v*S,t[4]=-E,t[8]=w*S,t[1]=M*E+B,t[5]=f*S,t[9]=L*E-U,t[2]=U*E-L,t[6]=c*S,t[10]=B*E+M}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Wz,e,$z)}lookAt(e,t,i){const o=this.elements;return ds.subVectors(e,t),ds.lengthSq()===0&&(ds.z=1),ds.normalize(),Xo.crossVectors(i,ds),Xo.lengthSq()===0&&(Math.abs(i.z)===1?ds.x+=1e-4:ds.z+=1e-4,ds.normalize(),Xo.crossVectors(i,ds)),Xo.normalize(),Um.crossVectors(ds,Xo),o[0]=Xo.x,o[4]=Um.x,o[8]=ds.x,o[1]=Xo.y,o[5]=Um.y,o[9]=ds.y,o[2]=Xo.z,o[6]=Um.z,o[10]=ds.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,o=t.elements,h=this.elements,f=i[0],c=i[4],v=i[8],w=i[12],S=i[1],E=i[5],M=i[9],L=i[13],U=i[2],B=i[6],z=i[10],R=i[14],G=i[3],V=i[7],ee=i[11],fe=i[15],Z=o[0],te=o[4],be=o[8],ae=o[12],K=o[1],Pe=o[5],ke=o[9],Te=o[13],je=o[2],it=o[6],ut=o[10],st=o[14],Ce=o[3],Ke=o[7],Ye=o[11],pt=o[15];return h[0]=f*Z+c*K+v*je+w*Ce,h[4]=f*te+c*Pe+v*it+w*Ke,h[8]=f*be+c*ke+v*ut+w*Ye,h[12]=f*ae+c*Te+v*st+w*pt,h[1]=S*Z+E*K+M*je+L*Ce,h[5]=S*te+E*Pe+M*it+L*Ke,h[9]=S*be+E*ke+M*ut+L*Ye,h[13]=S*ae+E*Te+M*st+L*pt,h[2]=U*Z+B*K+z*je+R*Ce,h[6]=U*te+B*Pe+z*it+R*Ke,h[10]=U*be+B*ke+z*ut+R*Ye,h[14]=U*ae+B*Te+z*st+R*pt,h[3]=G*Z+V*K+ee*je+fe*Ce,h[7]=G*te+V*Pe+ee*it+fe*Ke,h[11]=G*be+V*ke+ee*ut+fe*Ye,h[15]=G*ae+V*Te+ee*st+fe*pt,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],o=e[8],h=e[12],f=e[1],c=e[5],v=e[9],w=e[13],S=e[2],E=e[6],M=e[10],L=e[14],U=e[3],B=e[7],z=e[11],R=e[15];return U*(+h*v*E-o*w*E-h*c*M+i*w*M+o*c*L-i*v*L)+B*(+t*v*L-t*w*M+h*f*M-o*f*L+o*w*S-h*v*S)+z*(+t*w*E-t*c*L-h*f*E+i*f*L+h*c*S-i*w*S)+R*(-o*c*S-t*v*E+t*c*M+o*f*E-i*f*M+i*v*S)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const o=this.elements;return e.isVector3?(o[12]=e.x,o[13]=e.y,o[14]=e.z):(o[12]=e,o[13]=t,o[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8],E=e[9],M=e[10],L=e[11],U=e[12],B=e[13],z=e[14],R=e[15],G=E*z*w-B*M*w+B*v*L-c*z*L-E*v*R+c*M*R,V=U*M*w-S*z*w-U*v*L+f*z*L+S*v*R-f*M*R,ee=S*B*w-U*E*w+U*c*L-f*B*L-S*c*R+f*E*R,fe=U*E*v-S*B*v-U*c*M+f*B*M+S*c*z-f*E*z,Z=t*G+i*V+o*ee+h*fe;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const te=1/Z;return e[0]=G*te,e[1]=(B*M*h-E*z*h-B*o*L+i*z*L+E*o*R-i*M*R)*te,e[2]=(c*z*h-B*v*h+B*o*w-i*z*w-c*o*R+i*v*R)*te,e[3]=(E*v*h-c*M*h-E*o*w+i*M*w+c*o*L-i*v*L)*te,e[4]=V*te,e[5]=(S*z*h-U*M*h+U*o*L-t*z*L-S*o*R+t*M*R)*te,e[6]=(U*v*h-f*z*h-U*o*w+t*z*w+f*o*R-t*v*R)*te,e[7]=(f*M*h-S*v*h+S*o*w-t*M*w-f*o*L+t*v*L)*te,e[8]=ee*te,e[9]=(U*E*h-S*B*h-U*i*L+t*B*L+S*i*R-t*E*R)*te,e[10]=(f*B*h-U*c*h+U*i*w-t*B*w-f*i*R+t*c*R)*te,e[11]=(S*c*h-f*E*h-S*i*w+t*E*w+f*i*L-t*c*L)*te,e[12]=fe*te,e[13]=(S*B*o-U*E*o+U*i*M-t*B*M-S*i*z+t*E*z)*te,e[14]=(U*c*o-f*B*o-U*i*v+t*B*v+f*i*z-t*c*z)*te,e[15]=(f*E*o-S*c*o+S*i*v-t*E*v-f*i*M+t*c*M)*te,this}scale(e){const t=this.elements,i=e.x,o=e.y,h=e.z;return t[0]*=i,t[4]*=o,t[8]*=h,t[1]*=i,t[5]*=o,t[9]*=h,t[2]*=i,t[6]*=o,t[10]*=h,t[3]*=i,t[7]*=o,t[11]*=h,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],o=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,o))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),o=Math.sin(t),h=1-i,f=e.x,c=e.y,v=e.z,w=h*f,S=h*c;return this.set(w*f+i,w*c-o*v,w*v+o*c,0,w*c+o*v,S*c+i,S*v-o*f,0,w*v-o*c,S*v+o*f,h*v*v+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,o,h,f){return this.set(1,i,h,0,e,1,f,0,t,o,1,0,0,0,0,1),this}compose(e,t,i){const o=this.elements,h=t._x,f=t._y,c=t._z,v=t._w,w=h+h,S=f+f,E=c+c,M=h*w,L=h*S,U=h*E,B=f*S,z=f*E,R=c*E,G=v*w,V=v*S,ee=v*E,fe=i.x,Z=i.y,te=i.z;return o[0]=(1-(B+R))*fe,o[1]=(L+ee)*fe,o[2]=(U-V)*fe,o[3]=0,o[4]=(L-ee)*Z,o[5]=(1-(M+R))*Z,o[6]=(z+G)*Z,o[7]=0,o[8]=(U+V)*te,o[9]=(z-G)*te,o[10]=(1-(M+B))*te,o[11]=0,o[12]=e.x,o[13]=e.y,o[14]=e.z,o[15]=1,this}decompose(e,t,i){const o=this.elements;let h=Su.set(o[0],o[1],o[2]).length();const f=Su.set(o[4],o[5],o[6]).length(),c=Su.set(o[8],o[9],o[10]).length();this.determinant()<0&&(h=-h),e.x=o[12],e.y=o[13],e.z=o[14],Ks.copy(this);const w=1/h,S=1/f,E=1/c;return Ks.elements[0]*=w,Ks.elements[1]*=w,Ks.elements[2]*=w,Ks.elements[4]*=S,Ks.elements[5]*=S,Ks.elements[6]*=S,Ks.elements[8]*=E,Ks.elements[9]*=E,Ks.elements[10]*=E,t.setFromRotationMatrix(Ks),i.x=h,i.y=f,i.z=c,this}makePerspective(e,t,i,o,h,f,c=ro){const v=this.elements,w=2*h/(t-e),S=2*h/(i-o),E=(t+e)/(t-e),M=(i+o)/(i-o);let L,U;if(c===ro)L=-(f+h)/(f-h),U=-2*f*h/(f-h);else if(c===Wg)L=-f/(f-h),U=-f*h/(f-h);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+c);return v[0]=w,v[4]=0,v[8]=E,v[12]=0,v[1]=0,v[5]=S,v[9]=M,v[13]=0,v[2]=0,v[6]=0,v[10]=L,v[14]=U,v[3]=0,v[7]=0,v[11]=-1,v[15]=0,this}makeOrthographic(e,t,i,o,h,f,c=ro){const v=this.elements,w=1/(t-e),S=1/(i-o),E=1/(f-h),M=(t+e)*w,L=(i+o)*S;let U,B;if(c===ro)U=(f+h)*E,B=-2*E;else if(c===Wg)U=h*E,B=-1*E;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+c);return v[0]=2*w,v[4]=0,v[8]=0,v[12]=-M,v[1]=0,v[5]=2*S,v[9]=0,v[13]=-L,v[2]=0,v[6]=0,v[10]=B,v[14]=-U,v[3]=0,v[7]=0,v[11]=0,v[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let o=0;o<16;o++)if(t[o]!==i[o])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Su=new $e,Ks=new Yi,Wz=new $e(0,0,0),$z=new $e(1,1,1),Xo=new $e,Um=new $e,ds=new $e,iM=new Yi,rM=new Sc;class fo{constructor(e=0,t=0,i=0,o=fo.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=o}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,o=this._order){return this._x=e,this._y=t,this._z=i,this._order=o,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const o=e.elements,h=o[0],f=o[4],c=o[8],v=o[1],w=o[5],S=o[9],E=o[2],M=o[6],L=o[10];switch(t){case"XYZ":this._y=Math.asin(Rr(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-S,L),this._z=Math.atan2(-f,h)):(this._x=Math.atan2(M,w),this._z=0);break;case"YXZ":this._x=Math.asin(-Rr(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(c,L),this._z=Math.atan2(v,w)):(this._y=Math.atan2(-E,h),this._z=0);break;case"ZXY":this._x=Math.asin(Rr(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-E,L),this._z=Math.atan2(-f,w)):(this._y=0,this._z=Math.atan2(v,h));break;case"ZYX":this._y=Math.asin(-Rr(E,-1,1)),Math.abs(E)<.9999999?(this._x=Math.atan2(M,L),this._z=Math.atan2(v,h)):(this._x=0,this._z=Math.atan2(-f,w));break;case"YZX":this._z=Math.asin(Rr(v,-1,1)),Math.abs(v)<.9999999?(this._x=Math.atan2(-S,w),this._y=Math.atan2(-E,h)):(this._x=0,this._y=Math.atan2(c,L));break;case"XZY":this._z=Math.asin(-Rr(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(M,w),this._y=Math.atan2(c,h)):(this._x=Math.atan2(-S,L),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return iM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(iM,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rM.setFromEuler(this),this.setFromQuaternion(rM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}fo.DEFAULT_ORDER="XYZ";class rA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Xz=0;const sM=new $e,Mu=new Sc,qa=new Yi,Nm=new $e,ef=new $e,qz=new $e,Zz=new Sc,aM=new $e(1,0,0),oM=new $e(0,1,0),lM=new $e(0,0,1),cM={type:"added"},Yz={type:"removed"},Tu={type:"childadded",child:null},_0={type:"childremoved",child:null};class ys extends Ac{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Xz++}),this.uuid=Rh(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=ys.DEFAULT_UP.clone();const e=new $e,t=new fo,i=new Sc,o=new $e(1,1,1);function h(){i.setFromEuler(t,!1)}function f(){t.setFromQuaternion(i,void 0,!1)}t._onChange(h),i._onChange(f),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Yi},normalMatrix:{value:new Dn}}),this.matrix=new Yi,this.matrixWorld=new Yi,this.matrixAutoUpdate=ys.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=ys.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new rA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Mu.setFromAxisAngle(e,t),this.quaternion.multiply(Mu),this}rotateOnWorldAxis(e,t){return Mu.setFromAxisAngle(e,t),this.quaternion.premultiply(Mu),this}rotateX(e){return this.rotateOnAxis(aM,e)}rotateY(e){return this.rotateOnAxis(oM,e)}rotateZ(e){return this.rotateOnAxis(lM,e)}translateOnAxis(e,t){return sM.copy(e).applyQuaternion(this.quaternion),this.position.add(sM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(aM,e)}translateY(e){return this.translateOnAxis(oM,e)}translateZ(e){return this.translateOnAxis(lM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(qa.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Nm.copy(e):Nm.set(e,t,i);const o=this.parent;this.updateWorldMatrix(!0,!1),ef.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?qa.lookAt(ef,Nm,this.up):qa.lookAt(Nm,ef,this.up),this.quaternion.setFromRotationMatrix(qa),o&&(qa.extractRotation(o.matrixWorld),Mu.setFromRotationMatrix(qa),this.quaternion.premultiply(Mu.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(cM),Tu.child=e,this.dispatchEvent(Tu),Tu.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(Yz),_0.child=e,this.dispatchEvent(_0),_0.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),qa.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),qa.multiply(e.parent.matrixWorld)),e.applyMatrix4(qa),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(cM),Tu.child=e,this.dispatchEvent(Tu),Tu.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,o=this.children.length;i<o;i++){const f=this.children[i].getObjectByProperty(e,t);if(f!==void 0)return f}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const o=this.children;for(let h=0,f=o.length;h<f;h++)o[h].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ef,e,qz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(ef,Zz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,o=t.length;i<o;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,o=t.length;i<o;i++){const h=t[i];(h.matrixWorldAutoUpdate===!0||e===!0)&&h.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const o=this.children;for(let h=0,f=o.length;h<f;h++){const c=o[h];c.matrixWorldAutoUpdate===!0&&c.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const o={};o.uuid=this.uuid,o.type=this.type,this.name!==""&&(o.name=this.name),this.castShadow===!0&&(o.castShadow=!0),this.receiveShadow===!0&&(o.receiveShadow=!0),this.visible===!1&&(o.visible=!1),this.frustumCulled===!1&&(o.frustumCulled=!1),this.renderOrder!==0&&(o.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(o.userData=this.userData),o.layers=this.layers.mask,o.matrix=this.matrix.toArray(),o.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(o.matrixAutoUpdate=!1),this.isInstancedMesh&&(o.type="InstancedMesh",o.count=this.count,o.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(o.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(o.type="BatchedMesh",o.perObjectFrustumCulled=this.perObjectFrustumCulled,o.sortObjects=this.sortObjects,o.drawRanges=this._drawRanges,o.reservedRanges=this._reservedRanges,o.visibility=this._visibility,o.active=this._active,o.bounds=this._bounds.map(c=>({boxInitialized:c.boxInitialized,boxMin:c.box.min.toArray(),boxMax:c.box.max.toArray(),sphereInitialized:c.sphereInitialized,sphereRadius:c.sphere.radius,sphereCenter:c.sphere.center.toArray()})),o.maxGeometryCount=this._maxGeometryCount,o.maxVertexCount=this._maxVertexCount,o.maxIndexCount=this._maxIndexCount,o.geometryInitialized=this._geometryInitialized,o.geometryCount=this._geometryCount,o.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(o.boundingSphere={center:o.boundingSphere.center.toArray(),radius:o.boundingSphere.radius}),this.boundingBox!==null&&(o.boundingBox={min:o.boundingBox.min.toArray(),max:o.boundingBox.max.toArray()}));function h(c,v){return c[v.uuid]===void 0&&(c[v.uuid]=v.toJSON(e)),v.uuid}if(this.isScene)this.background&&(this.background.isColor?o.background=this.background.toJSON():this.background.isTexture&&(o.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(o.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){o.geometry=h(e.geometries,this.geometry);const c=this.geometry.parameters;if(c!==void 0&&c.shapes!==void 0){const v=c.shapes;if(Array.isArray(v))for(let w=0,S=v.length;w<S;w++){const E=v[w];h(e.shapes,E)}else h(e.shapes,v)}}if(this.isSkinnedMesh&&(o.bindMode=this.bindMode,o.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(h(e.skeletons,this.skeleton),o.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const c=[];for(let v=0,w=this.material.length;v<w;v++)c.push(h(e.materials,this.material[v]));o.material=c}else o.material=h(e.materials,this.material);if(this.children.length>0){o.children=[];for(let c=0;c<this.children.length;c++)o.children.push(this.children[c].toJSON(e).object)}if(this.animations.length>0){o.animations=[];for(let c=0;c<this.animations.length;c++){const v=this.animations[c];o.animations.push(h(e.animations,v))}}if(t){const c=f(e.geometries),v=f(e.materials),w=f(e.textures),S=f(e.images),E=f(e.shapes),M=f(e.skeletons),L=f(e.animations),U=f(e.nodes);c.length>0&&(i.geometries=c),v.length>0&&(i.materials=v),w.length>0&&(i.textures=w),S.length>0&&(i.images=S),E.length>0&&(i.shapes=E),M.length>0&&(i.skeletons=M),L.length>0&&(i.animations=L),U.length>0&&(i.nodes=U)}return i.object=o,i;function f(c){const v=[];for(const w in c){const S=c[w];delete S.metadata,v.push(S)}return v}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const o=e.children[i];this.add(o.clone())}return this}}ys.DEFAULT_UP=new $e(0,1,0);ys.DEFAULT_MATRIX_AUTO_UPDATE=!0;ys.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Js=new $e,Za=new $e,y0=new $e,Ya=new $e,Eu=new $e,Au=new $e,uM=new $e,v0=new $e,x0=new $e,b0=new $e;class ba{constructor(e=new $e,t=new $e,i=new $e){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,o){o.subVectors(i,t),Js.subVectors(e,t),o.cross(Js);const h=o.lengthSq();return h>0?o.multiplyScalar(1/Math.sqrt(h)):o.set(0,0,0)}static getBarycoord(e,t,i,o,h){Js.subVectors(o,t),Za.subVectors(i,t),y0.subVectors(e,t);const f=Js.dot(Js),c=Js.dot(Za),v=Js.dot(y0),w=Za.dot(Za),S=Za.dot(y0),E=f*w-c*c;if(E===0)return h.set(0,0,0),null;const M=1/E,L=(w*v-c*S)*M,U=(f*S-c*v)*M;return h.set(1-L-U,U,L)}static containsPoint(e,t,i,o){return this.getBarycoord(e,t,i,o,Ya)===null?!1:Ya.x>=0&&Ya.y>=0&&Ya.x+Ya.y<=1}static getInterpolation(e,t,i,o,h,f,c,v){return this.getBarycoord(e,t,i,o,Ya)===null?(v.x=0,v.y=0,"z"in v&&(v.z=0),"w"in v&&(v.w=0),null):(v.setScalar(0),v.addScaledVector(h,Ya.x),v.addScaledVector(f,Ya.y),v.addScaledVector(c,Ya.z),v)}static isFrontFacing(e,t,i,o){return Js.subVectors(i,t),Za.subVectors(e,t),Js.cross(Za).dot(o)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,o){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[o]),this}setFromAttributeAndIndices(e,t,i,o){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,o),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Js.subVectors(this.c,this.b),Za.subVectors(this.a,this.b),Js.cross(Za).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return ba.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return ba.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,o,h){return ba.getInterpolation(e,this.a,this.b,this.c,t,i,o,h)}containsPoint(e){return ba.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return ba.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,o=this.b,h=this.c;let f,c;Eu.subVectors(o,i),Au.subVectors(h,i),v0.subVectors(e,i);const v=Eu.dot(v0),w=Au.dot(v0);if(v<=0&&w<=0)return t.copy(i);x0.subVectors(e,o);const S=Eu.dot(x0),E=Au.dot(x0);if(S>=0&&E<=S)return t.copy(o);const M=v*E-S*w;if(M<=0&&v>=0&&S<=0)return f=v/(v-S),t.copy(i).addScaledVector(Eu,f);b0.subVectors(e,h);const L=Eu.dot(b0),U=Au.dot(b0);if(U>=0&&L<=U)return t.copy(h);const B=L*w-v*U;if(B<=0&&w>=0&&U<=0)return c=w/(w-U),t.copy(i).addScaledVector(Au,c);const z=S*U-L*E;if(z<=0&&E-S>=0&&L-U>=0)return uM.subVectors(h,o),c=(E-S)/(E-S+(L-U)),t.copy(o).addScaledVector(uM,c);const R=1/(z+B+M);return f=B*R,c=M*R,t.copy(i).addScaledVector(Eu,f).addScaledVector(Au,c)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const sA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},qo={h:0,s:0,l:0},Om={h:0,s:0,l:0};function w0(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}class si{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const o=e;o&&o.isColor?this.copy(o):typeof o=="number"?this.setHex(o):typeof o=="string"&&this.setStyle(o)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=ya){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,ri.toWorkingColorSpace(this,t),this}setRGB(e,t,i,o=ri.workingColorSpace){return this.r=e,this.g=t,this.b=i,ri.toWorkingColorSpace(this,o),this}setHSL(e,t,i,o=ri.workingColorSpace){if(e=qx(e,1),t=Rr(t,0,1),i=Rr(i,0,1),t===0)this.r=this.g=this.b=i;else{const h=i<=.5?i*(1+t):i+t-i*t,f=2*i-h;this.r=w0(f,h,e+1/3),this.g=w0(f,h,e),this.b=w0(f,h,e-1/3)}return ri.toWorkingColorSpace(this,o),this}setStyle(e,t=ya){function i(h){h!==void 0&&parseFloat(h)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let o;if(o=/^(\w+)\(([^\)]*)\)/.exec(e)){let h;const f=o[1],c=o[2];switch(f){case"rgb":case"rgba":if(h=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return i(h[4]),this.setRGB(Math.min(255,parseInt(h[1],10))/255,Math.min(255,parseInt(h[2],10))/255,Math.min(255,parseInt(h[3],10))/255,t);if(h=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return i(h[4]),this.setRGB(Math.min(100,parseInt(h[1],10))/100,Math.min(100,parseInt(h[2],10))/100,Math.min(100,parseInt(h[3],10))/100,t);break;case"hsl":case"hsla":if(h=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(c))return i(h[4]),this.setHSL(parseFloat(h[1])/360,parseFloat(h[2])/100,parseFloat(h[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(o=/^\#([A-Fa-f\d]+)$/.exec(e)){const h=o[1],f=h.length;if(f===3)return this.setRGB(parseInt(h.charAt(0),16)/15,parseInt(h.charAt(1),16)/15,parseInt(h.charAt(2),16)/15,t);if(f===6)return this.setHex(parseInt(h,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=ya){const i=sA[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=uh(e.r),this.g=uh(e.g),this.b=uh(e.b),this}copyLinearToSRGB(e){return this.r=c0(e.r),this.g=c0(e.g),this.b=c0(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=ya){return ri.fromWorkingColorSpace(Cr.copy(this),e),Math.round(Rr(Cr.r*255,0,255))*65536+Math.round(Rr(Cr.g*255,0,255))*256+Math.round(Rr(Cr.b*255,0,255))}getHexString(e=ya){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=ri.workingColorSpace){ri.fromWorkingColorSpace(Cr.copy(this),t);const i=Cr.r,o=Cr.g,h=Cr.b,f=Math.max(i,o,h),c=Math.min(i,o,h);let v,w;const S=(c+f)/2;if(c===f)v=0,w=0;else{const E=f-c;switch(w=S<=.5?E/(f+c):E/(2-f-c),f){case i:v=(o-h)/E+(o<h?6:0);break;case o:v=(h-i)/E+2;break;case h:v=(i-o)/E+4;break}v/=6}return e.h=v,e.s=w,e.l=S,e}getRGB(e,t=ri.workingColorSpace){return ri.fromWorkingColorSpace(Cr.copy(this),t),e.r=Cr.r,e.g=Cr.g,e.b=Cr.b,e}getStyle(e=ya){ri.fromWorkingColorSpace(Cr.copy(this),e);const t=Cr.r,i=Cr.g,o=Cr.b;return e!==ya?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${o.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(o*255)})`}offsetHSL(e,t,i){return this.getHSL(qo),this.setHSL(qo.h+e,qo.s+t,qo.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(qo),e.getHSL(Om);const i=xf(qo.h,Om.h,t),o=xf(qo.s,Om.s,t),h=xf(qo.l,Om.l,t);return this.setHSL(i,o,h),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,o=this.b,h=e.elements;return this.r=h[0]*t+h[3]*i+h[6]*o,this.g=h[1]*t+h[4]*i+h[7]*o,this.b=h[2]*t+h[5]*i+h[8]*o,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Cr=new si;si.NAMES=sA;let Kz=0;class p_ extends Ac{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Kz++}),this.uuid=Rh(),this.name="",this.type="Material",this.blending=lh,this.side=xl,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=kv,this.blendDst=Fv,this.blendEquation=sc,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new si(0,0,0),this.blendAlpha=0,this.depthFunc=Bg,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=ZS,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=yu,this.stencilZFail=yu,this.stencilZPass=yu,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const o=this[t];if(o===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}o&&o.isColor?o.set(i):o&&o.isVector3&&i&&i.isVector3?o.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==lh&&(i.blending=this.blending),this.side!==xl&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==kv&&(i.blendSrc=this.blendSrc),this.blendDst!==Fv&&(i.blendDst=this.blendDst),this.blendEquation!==sc&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==Bg&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==ZS&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==yu&&(i.stencilFail=this.stencilFail),this.stencilZFail!==yu&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==yu&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function o(h){const f=[];for(const c in h){const v=h[c];delete v.metadata,f.push(v)}return f}if(t){const h=o(e.textures),f=o(e.images);h.length>0&&(i.textures=h),f.length>0&&(i.images=f)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const o=t.length;i=new Array(o);for(let h=0;h!==o;++h)i[h]=t[h].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class aA extends p_{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new si(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new fo,this.combine=H2,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const ji=new $e,Bm=new Pn;class Ta{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=YS,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=al,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Uz("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let o=0,h=this.itemSize;o<h;o++)this.array[e+o]=t.array[i+o];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Bm.fromBufferAttribute(this,t),Bm.applyMatrix3(e),this.setXY(t,Bm.x,Bm.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)ji.fromBufferAttribute(this,t),ji.applyMatrix3(e),this.setXYZ(t,ji.x,ji.y,ji.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)ji.fromBufferAttribute(this,t),ji.applyMatrix4(e),this.setXYZ(t,ji.x,ji.y,ji.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)ji.fromBufferAttribute(this,t),ji.applyNormalMatrix(e),this.setXYZ(t,ji.x,ji.y,ji.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)ji.fromBufferAttribute(this,t),ji.transformDirection(e),this.setXYZ(t,ji.x,ji.y,ji.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=Fu(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=Br(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Fu(t,this.array)),t}setX(e,t){return this.normalized&&(t=Br(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Fu(t,this.array)),t}setY(e,t){return this.normalized&&(t=Br(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Fu(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Br(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Fu(t,this.array)),t}setW(e,t){return this.normalized&&(t=Br(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=Br(t,this.array),i=Br(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,o){return e*=this.itemSize,this.normalized&&(t=Br(t,this.array),i=Br(i,this.array),o=Br(o,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this}setXYZW(e,t,i,o,h){return e*=this.itemSize,this.normalized&&(t=Br(t,this.array),i=Br(i,this.array),o=Br(o,this.array),h=Br(h,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=o,this.array[e+3]=h,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==YS&&(e.usage=this.usage),e}}class oA extends Ta{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class lA extends Ta{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Ea extends Ta{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Jz=0;const Ps=new Yi,S0=new ys,Cu=new $e,fs=new tp,tf=new tp,ir=new $e;class Al extends Ac{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Jz++}),this.uuid=Rh(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(eA(e)?lA:oA)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const h=new Dn().getNormalMatrix(e);i.applyNormalMatrix(h),i.needsUpdate=!0}const o=this.attributes.tangent;return o!==void 0&&(o.transformDirection(e),o.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ps.makeRotationFromQuaternion(e),this.applyMatrix4(Ps),this}rotateX(e){return Ps.makeRotationX(e),this.applyMatrix4(Ps),this}rotateY(e){return Ps.makeRotationY(e),this.applyMatrix4(Ps),this}rotateZ(e){return Ps.makeRotationZ(e),this.applyMatrix4(Ps),this}translate(e,t,i){return Ps.makeTranslation(e,t,i),this.applyMatrix4(Ps),this}scale(e,t,i){return Ps.makeScale(e,t,i),this.applyMatrix4(Ps),this}lookAt(e){return S0.lookAt(e),S0.updateMatrix(),this.applyMatrix4(S0.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Cu).negate(),this.translate(Cu.x,Cu.y,Cu.z),this}setFromPoints(e){const t=[];for(let i=0,o=e.length;i<o;i++){const h=e[i];t.push(h.x,h.y,h.z||0)}return this.setAttribute("position",new Ea(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new tp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new $e(-1/0,-1/0,-1/0),new $e(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,o=t.length;i<o;i++){const h=t[i];fs.setFromBufferAttribute(h),this.morphTargetsRelative?(ir.addVectors(this.boundingBox.min,fs.min),this.boundingBox.expandByPoint(ir),ir.addVectors(this.boundingBox.max,fs.max),this.boundingBox.expandByPoint(ir)):(this.boundingBox.expandByPoint(fs.min),this.boundingBox.expandByPoint(fs.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Zx);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new $e,1/0);return}if(e){const i=this.boundingSphere.center;if(fs.setFromBufferAttribute(e),t)for(let h=0,f=t.length;h<f;h++){const c=t[h];tf.setFromBufferAttribute(c),this.morphTargetsRelative?(ir.addVectors(fs.min,tf.min),fs.expandByPoint(ir),ir.addVectors(fs.max,tf.max),fs.expandByPoint(ir)):(fs.expandByPoint(tf.min),fs.expandByPoint(tf.max))}fs.getCenter(i);let o=0;for(let h=0,f=e.count;h<f;h++)ir.fromBufferAttribute(e,h),o=Math.max(o,i.distanceToSquared(ir));if(t)for(let h=0,f=t.length;h<f;h++){const c=t[h],v=this.morphTargetsRelative;for(let w=0,S=c.count;w<S;w++)ir.fromBufferAttribute(c,w),v&&(Cu.fromBufferAttribute(e,w),ir.add(Cu)),o=Math.max(o,i.distanceToSquared(ir))}this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,o=t.normal,h=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Ta(new Float32Array(4*i.count),4));const f=this.getAttribute("tangent"),c=[],v=[];for(let be=0;be<i.count;be++)c[be]=new $e,v[be]=new $e;const w=new $e,S=new $e,E=new $e,M=new Pn,L=new Pn,U=new Pn,B=new $e,z=new $e;function R(be,ae,K){w.fromBufferAttribute(i,be),S.fromBufferAttribute(i,ae),E.fromBufferAttribute(i,K),M.fromBufferAttribute(h,be),L.fromBufferAttribute(h,ae),U.fromBufferAttribute(h,K),S.sub(w),E.sub(w),L.sub(M),U.sub(M);const Pe=1/(L.x*U.y-U.x*L.y);isFinite(Pe)&&(B.copy(S).multiplyScalar(U.y).addScaledVector(E,-L.y).multiplyScalar(Pe),z.copy(E).multiplyScalar(L.x).addScaledVector(S,-U.x).multiplyScalar(Pe),c[be].add(B),c[ae].add(B),c[K].add(B),v[be].add(z),v[ae].add(z),v[K].add(z))}let G=this.groups;G.length===0&&(G=[{start:0,count:e.count}]);for(let be=0,ae=G.length;be<ae;++be){const K=G[be],Pe=K.start,ke=K.count;for(let Te=Pe,je=Pe+ke;Te<je;Te+=3)R(e.getX(Te+0),e.getX(Te+1),e.getX(Te+2))}const V=new $e,ee=new $e,fe=new $e,Z=new $e;function te(be){fe.fromBufferAttribute(o,be),Z.copy(fe);const ae=c[be];V.copy(ae),V.sub(fe.multiplyScalar(fe.dot(ae))).normalize(),ee.crossVectors(Z,ae);const Pe=ee.dot(v[be])<0?-1:1;f.setXYZW(be,V.x,V.y,V.z,Pe)}for(let be=0,ae=G.length;be<ae;++be){const K=G[be],Pe=K.start,ke=K.count;for(let Te=Pe,je=Pe+ke;Te<je;Te+=3)te(e.getX(Te+0)),te(e.getX(Te+1)),te(e.getX(Te+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new Ta(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let M=0,L=i.count;M<L;M++)i.setXYZ(M,0,0,0);const o=new $e,h=new $e,f=new $e,c=new $e,v=new $e,w=new $e,S=new $e,E=new $e;if(e)for(let M=0,L=e.count;M<L;M+=3){const U=e.getX(M+0),B=e.getX(M+1),z=e.getX(M+2);o.fromBufferAttribute(t,U),h.fromBufferAttribute(t,B),f.fromBufferAttribute(t,z),S.subVectors(f,h),E.subVectors(o,h),S.cross(E),c.fromBufferAttribute(i,U),v.fromBufferAttribute(i,B),w.fromBufferAttribute(i,z),c.add(S),v.add(S),w.add(S),i.setXYZ(U,c.x,c.y,c.z),i.setXYZ(B,v.x,v.y,v.z),i.setXYZ(z,w.x,w.y,w.z)}else for(let M=0,L=t.count;M<L;M+=3)o.fromBufferAttribute(t,M+0),h.fromBufferAttribute(t,M+1),f.fromBufferAttribute(t,M+2),S.subVectors(f,h),E.subVectors(o,h),S.cross(E),i.setXYZ(M+0,S.x,S.y,S.z),i.setXYZ(M+1,S.x,S.y,S.z),i.setXYZ(M+2,S.x,S.y,S.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)ir.fromBufferAttribute(e,t),ir.normalize(),e.setXYZ(t,ir.x,ir.y,ir.z)}toNonIndexed(){function e(c,v){const w=c.array,S=c.itemSize,E=c.normalized,M=new w.constructor(v.length*S);let L=0,U=0;for(let B=0,z=v.length;B<z;B++){c.isInterleavedBufferAttribute?L=v[B]*c.data.stride+c.offset:L=v[B]*S;for(let R=0;R<S;R++)M[U++]=w[L++]}return new Ta(M,S,E)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new Al,i=this.index.array,o=this.attributes;for(const c in o){const v=o[c],w=e(v,i);t.setAttribute(c,w)}const h=this.morphAttributes;for(const c in h){const v=[],w=h[c];for(let S=0,E=w.length;S<E;S++){const M=w[S],L=e(M,i);v.push(L)}t.morphAttributes[c]=v}t.morphTargetsRelative=this.morphTargetsRelative;const f=this.groups;for(let c=0,v=f.length;c<v;c++){const w=f[c];t.addGroup(w.start,w.count,w.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const v=this.parameters;for(const w in v)v[w]!==void 0&&(e[w]=v[w]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const v in i){const w=i[v];e.data.attributes[v]=w.toJSON(e.data)}const o={};let h=!1;for(const v in this.morphAttributes){const w=this.morphAttributes[v],S=[];for(let E=0,M=w.length;E<M;E++){const L=w[E];S.push(L.toJSON(e.data))}S.length>0&&(o[v]=S,h=!0)}h&&(e.data.morphAttributes=o,e.data.morphTargetsRelative=this.morphTargetsRelative);const f=this.groups;f.length>0&&(e.data.groups=JSON.parse(JSON.stringify(f)));const c=this.boundingSphere;return c!==null&&(e.data.boundingSphere={center:c.center.toArray(),radius:c.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const o=e.attributes;for(const w in o){const S=o[w];this.setAttribute(w,S.clone(t))}const h=e.morphAttributes;for(const w in h){const S=[],E=h[w];for(let M=0,L=E.length;M<L;M++)S.push(E[M].clone(t));this.morphAttributes[w]=S}this.morphTargetsRelative=e.morphTargetsRelative;const f=e.groups;for(let w=0,S=f.length;w<S;w++){const E=f[w];this.addGroup(E.start,E.count,E.materialIndex)}const c=e.boundingBox;c!==null&&(this.boundingBox=c.clone());const v=e.boundingSphere;return v!==null&&(this.boundingSphere=v.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const hM=new Yi,Kl=new iA,Vm=new Zx,dM=new $e,Pu=new $e,Ru=new $e,Iu=new $e,M0=new $e,Gm=new $e,Hm=new Pn,jm=new Pn,Wm=new Pn,fM=new $e,pM=new $e,mM=new $e,$m=new $e,Xm=new $e;class gs extends ys{constructor(e=new Al,t=new aA){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const o=t[i[0]];if(o!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let h=0,f=o.length;h<f;h++){const c=o[h].name||String(h);this.morphTargetInfluences.push(0),this.morphTargetDictionary[c]=h}}}}getVertexPosition(e,t){const i=this.geometry,o=i.attributes.position,h=i.morphAttributes.position,f=i.morphTargetsRelative;t.fromBufferAttribute(o,e);const c=this.morphTargetInfluences;if(h&&c){Gm.set(0,0,0);for(let v=0,w=h.length;v<w;v++){const S=c[v],E=h[v];S!==0&&(M0.fromBufferAttribute(E,e),f?Gm.addScaledVector(M0,S):Gm.addScaledVector(M0.sub(t),S))}t.add(Gm)}return t}raycast(e,t){const i=this.geometry,o=this.material,h=this.matrixWorld;o!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Vm.copy(i.boundingSphere),Vm.applyMatrix4(h),Kl.copy(e.ray).recast(e.near),!(Vm.containsPoint(Kl.origin)===!1&&(Kl.intersectSphere(Vm,dM)===null||Kl.origin.distanceToSquared(dM)>(e.far-e.near)**2))&&(hM.copy(h).invert(),Kl.copy(e.ray).applyMatrix4(hM),!(i.boundingBox!==null&&Kl.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,Kl)))}_computeIntersections(e,t,i){let o;const h=this.geometry,f=this.material,c=h.index,v=h.attributes.position,w=h.attributes.uv,S=h.attributes.uv1,E=h.attributes.normal,M=h.groups,L=h.drawRange;if(c!==null)if(Array.isArray(f))for(let U=0,B=M.length;U<B;U++){const z=M[U],R=f[z.materialIndex],G=Math.max(z.start,L.start),V=Math.min(c.count,Math.min(z.start+z.count,L.start+L.count));for(let ee=G,fe=V;ee<fe;ee+=3){const Z=c.getX(ee),te=c.getX(ee+1),be=c.getX(ee+2);o=qm(this,R,e,i,w,S,E,Z,te,be),o&&(o.faceIndex=Math.floor(ee/3),o.face.materialIndex=z.materialIndex,t.push(o))}}else{const U=Math.max(0,L.start),B=Math.min(c.count,L.start+L.count);for(let z=U,R=B;z<R;z+=3){const G=c.getX(z),V=c.getX(z+1),ee=c.getX(z+2);o=qm(this,f,e,i,w,S,E,G,V,ee),o&&(o.faceIndex=Math.floor(z/3),t.push(o))}}else if(v!==void 0)if(Array.isArray(f))for(let U=0,B=M.length;U<B;U++){const z=M[U],R=f[z.materialIndex],G=Math.max(z.start,L.start),V=Math.min(v.count,Math.min(z.start+z.count,L.start+L.count));for(let ee=G,fe=V;ee<fe;ee+=3){const Z=ee,te=ee+1,be=ee+2;o=qm(this,R,e,i,w,S,E,Z,te,be),o&&(o.faceIndex=Math.floor(ee/3),o.face.materialIndex=z.materialIndex,t.push(o))}}else{const U=Math.max(0,L.start),B=Math.min(v.count,L.start+L.count);for(let z=U,R=B;z<R;z+=3){const G=z,V=z+1,ee=z+2;o=qm(this,f,e,i,w,S,E,G,V,ee),o&&(o.faceIndex=Math.floor(z/3),t.push(o))}}}}function Qz(n,e,t,i,o,h,f,c){let v;if(e.side===jr?v=i.intersectTriangle(f,h,o,!0,c):v=i.intersectTriangle(o,h,f,e.side===xl,c),v===null)return null;Xm.copy(c),Xm.applyMatrix4(n.matrixWorld);const w=t.ray.origin.distanceTo(Xm);return w<t.near||w>t.far?null:{distance:w,point:Xm.clone(),object:n}}function qm(n,e,t,i,o,h,f,c,v,w){n.getVertexPosition(c,Pu),n.getVertexPosition(v,Ru),n.getVertexPosition(w,Iu);const S=Qz(n,e,t,i,Pu,Ru,Iu,$m);if(S){o&&(Hm.fromBufferAttribute(o,c),jm.fromBufferAttribute(o,v),Wm.fromBufferAttribute(o,w),S.uv=ba.getInterpolation($m,Pu,Ru,Iu,Hm,jm,Wm,new Pn)),h&&(Hm.fromBufferAttribute(h,c),jm.fromBufferAttribute(h,v),Wm.fromBufferAttribute(h,w),S.uv1=ba.getInterpolation($m,Pu,Ru,Iu,Hm,jm,Wm,new Pn)),f&&(fM.fromBufferAttribute(f,c),pM.fromBufferAttribute(f,v),mM.fromBufferAttribute(f,w),S.normal=ba.getInterpolation($m,Pu,Ru,Iu,fM,pM,mM,new $e),S.normal.dot(i.direction)>0&&S.normal.multiplyScalar(-1));const E={a:c,b:v,c:w,normal:new $e,materialIndex:0};ba.getNormal(Pu,Ru,Iu,E.normal),S.face=E}return S}class np extends Al{constructor(e=1,t=1,i=1,o=1,h=1,f=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:o,heightSegments:h,depthSegments:f};const c=this;o=Math.floor(o),h=Math.floor(h),f=Math.floor(f);const v=[],w=[],S=[],E=[];let M=0,L=0;U("z","y","x",-1,-1,i,t,e,f,h,0),U("z","y","x",1,-1,i,t,-e,f,h,1),U("x","z","y",1,1,e,i,t,o,f,2),U("x","z","y",1,-1,e,i,-t,o,f,3),U("x","y","z",1,-1,e,t,i,o,h,4),U("x","y","z",-1,-1,e,t,-i,o,h,5),this.setIndex(v),this.setAttribute("position",new Ea(w,3)),this.setAttribute("normal",new Ea(S,3)),this.setAttribute("uv",new Ea(E,2));function U(B,z,R,G,V,ee,fe,Z,te,be,ae){const K=ee/te,Pe=fe/be,ke=ee/2,Te=fe/2,je=Z/2,it=te+1,ut=be+1;let st=0,Ce=0;const Ke=new $e;for(let Ye=0;Ye<ut;Ye++){const pt=Ye*Pe-Te;for(let kt=0;kt<it;kt++){const _n=kt*K-ke;Ke[B]=_n*G,Ke[z]=pt*V,Ke[R]=je,w.push(Ke.x,Ke.y,Ke.z),Ke[B]=0,Ke[z]=0,Ke[R]=Z>0?1:-1,S.push(Ke.x,Ke.y,Ke.z),E.push(kt/te),E.push(1-Ye/be),st+=1}}for(let Ye=0;Ye<be;Ye++)for(let pt=0;pt<te;pt++){const kt=M+pt+it*Ye,_n=M+pt+it*(Ye+1),Ze=M+(pt+1)+it*(Ye+1),_t=M+(pt+1)+it*Ye;v.push(kt,_n,_t),v.push(_n,Ze,_t),Ce+=6}c.addGroup(L,Ce,ae),L+=Ce,M+=st}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new np(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Th(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const o=n[t][i];o&&(o.isColor||o.isMatrix3||o.isMatrix4||o.isVector2||o.isVector3||o.isVector4||o.isTexture||o.isQuaternion)?o.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=o.clone():Array.isArray(o)?e[t][i]=o.slice():e[t][i]=o}}return e}function Vr(n){const e={};for(let t=0;t<n.length;t++){const i=Th(n[t]);for(const o in i)e[o]=i[o]}return e}function ek(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function cA(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:ri.workingColorSpace}const tk={clone:Th,merge:Vr};var nk=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,ik=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ns extends p_{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=nk,this.fragmentShader=ik,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Th(e.uniforms),this.uniformsGroups=ek(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const o in this.uniforms){const f=this.uniforms[o].value;f&&f.isTexture?t.uniforms[o]={type:"t",value:f.toJSON(e).uuid}:f&&f.isColor?t.uniforms[o]={type:"c",value:f.getHex()}:f&&f.isVector2?t.uniforms[o]={type:"v2",value:f.toArray()}:f&&f.isVector3?t.uniforms[o]={type:"v3",value:f.toArray()}:f&&f.isVector4?t.uniforms[o]={type:"v4",value:f.toArray()}:f&&f.isMatrix3?t.uniforms[o]={type:"m3",value:f.toArray()}:f&&f.isMatrix4?t.uniforms[o]={type:"m4",value:f.toArray()}:t.uniforms[o]={value:f}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const o in this.extensions)this.extensions[o]===!0&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class uA extends ys{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Yi,this.projectionMatrix=new Yi,this.projectionMatrixInverse=new Yi,this.coordinateSystem=ro}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Zo=new $e,gM=new Pn,_M=new Pn;class Ds extends uA{constructor(e=50,t=1,i=.1,o=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=o,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Vf*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(vf*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Vf*2*Math.atan(Math.tan(vf*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){Zo.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Zo.x,Zo.y).multiplyScalar(-e/Zo.z),Zo.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(Zo.x,Zo.y).multiplyScalar(-e/Zo.z)}getViewSize(e,t){return this.getViewBounds(e,gM,_M),t.subVectors(_M,gM)}setViewOffset(e,t,i,o,h,f){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=h,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(vf*.5*this.fov)/this.zoom,i=2*t,o=this.aspect*i,h=-.5*o;const f=this.view;if(this.view!==null&&this.view.enabled){const v=f.fullWidth,w=f.fullHeight;h+=f.offsetX*o/v,t-=f.offsetY*i/w,o*=f.width/v,i*=f.height/w}const c=this.filmOffset;c!==0&&(h+=e*c/this.getFilmWidth()),this.projectionMatrix.makePerspective(h,h+o,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const Lu=-90,Du=1;class rk extends ys{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const o=new Ds(Lu,Du,e,t);o.layers=this.layers,this.add(o);const h=new Ds(Lu,Du,e,t);h.layers=this.layers,this.add(h);const f=new Ds(Lu,Du,e,t);f.layers=this.layers,this.add(f);const c=new Ds(Lu,Du,e,t);c.layers=this.layers,this.add(c);const v=new Ds(Lu,Du,e,t);v.layers=this.layers,this.add(v);const w=new Ds(Lu,Du,e,t);w.layers=this.layers,this.add(w)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,o,h,f,c,v]=t;for(const w of t)this.remove(w);if(e===ro)i.up.set(0,1,0),i.lookAt(1,0,0),o.up.set(0,1,0),o.lookAt(-1,0,0),h.up.set(0,0,-1),h.lookAt(0,1,0),f.up.set(0,0,1),f.lookAt(0,-1,0),c.up.set(0,1,0),c.lookAt(0,0,1),v.up.set(0,1,0),v.lookAt(0,0,-1);else if(e===Wg)i.up.set(0,-1,0),i.lookAt(-1,0,0),o.up.set(0,-1,0),o.lookAt(1,0,0),h.up.set(0,0,1),h.lookAt(0,1,0),f.up.set(0,0,-1),f.lookAt(0,-1,0),c.up.set(0,-1,0),c.lookAt(0,0,1),v.up.set(0,-1,0),v.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const w of t)this.add(w),w.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:o}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[h,f,c,v,w,S]=this.children,E=e.getRenderTarget(),M=e.getActiveCubeFace(),L=e.getActiveMipmapLevel(),U=e.xr.enabled;e.xr.enabled=!1;const B=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,o),e.render(t,h),e.setRenderTarget(i,1,o),e.render(t,f),e.setRenderTarget(i,2,o),e.render(t,c),e.setRenderTarget(i,3,o),e.render(t,v),e.setRenderTarget(i,4,o),e.render(t,w),i.texture.generateMipmaps=B,e.setRenderTarget(i,5,o),e.render(t,S),e.setRenderTarget(E,M,L),e.xr.enabled=U,i.texture.needsPMREMUpdate=!0}}class hA extends Wr{constructor(e,t,i,o,h,f,c,v,w,S){e=e!==void 0?e:[],t=t!==void 0?t:wh,super(e,t,i,o,h,f,c,v,w,S),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class sk extends wc{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];this.texture=new hA(o,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:ia}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},o=new np(5,5,5),h=new Ns({name:"CubemapFromEquirect",uniforms:Th(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:jr,blending:ml});h.uniforms.tEquirect.value=t;const f=new gs(o,h),c=t.minFilter;return t.minFilter===fc&&(t.minFilter=ia),new rk(1,10,this).update(e,f),t.minFilter=c,f.geometry.dispose(),f.material.dispose(),this}clear(e,t,i,o){const h=e.getRenderTarget();for(let f=0;f<6;f++)e.setRenderTarget(this,f),e.clear(t,i,o);e.setRenderTarget(h)}}const T0=new $e,ak=new $e,ok=new Dn;class el{constructor(e=new $e(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,o){return this.normal.set(e,t,i),this.constant=o,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const o=T0.subVectors(i,t).cross(ak.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(o,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(T0),o=this.normal.dot(i);if(o===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const h=-(e.start.dot(this.normal)+this.constant)/o;return h<0||h>1?null:t.copy(e.start).addScaledVector(i,h)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||ok.getNormalMatrix(e),o=this.coplanarPoint(T0).applyMatrix4(e),h=this.normal.applyMatrix3(i).normalize();return this.constant=-o.dot(h),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Jl=new Zx,Zm=new $e;class dA{constructor(e=new el,t=new el,i=new el,o=new el,h=new el,f=new el){this.planes=[e,t,i,o,h,f]}set(e,t,i,o,h,f){const c=this.planes;return c[0].copy(e),c[1].copy(t),c[2].copy(i),c[3].copy(o),c[4].copy(h),c[5].copy(f),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ro){const i=this.planes,o=e.elements,h=o[0],f=o[1],c=o[2],v=o[3],w=o[4],S=o[5],E=o[6],M=o[7],L=o[8],U=o[9],B=o[10],z=o[11],R=o[12],G=o[13],V=o[14],ee=o[15];if(i[0].setComponents(v-h,M-w,z-L,ee-R).normalize(),i[1].setComponents(v+h,M+w,z+L,ee+R).normalize(),i[2].setComponents(v+f,M+S,z+U,ee+G).normalize(),i[3].setComponents(v-f,M-S,z-U,ee-G).normalize(),i[4].setComponents(v-c,M-E,z-B,ee-V).normalize(),t===ro)i[5].setComponents(v+c,M+E,z+B,ee+V).normalize();else if(t===Wg)i[5].setComponents(c,E,B,V).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Jl.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Jl.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Jl)}intersectsSprite(e){return Jl.center.set(0,0,0),Jl.radius=.7071067811865476,Jl.applyMatrix4(e.matrixWorld),this.intersectsSphere(Jl)}intersectsSphere(e){const t=this.planes,i=e.center,o=-e.radius;for(let h=0;h<6;h++)if(t[h].distanceToPoint(i)<o)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const o=t[i];if(Zm.x=o.normal.x>0?e.max.x:e.min.x,Zm.y=o.normal.y>0?e.max.y:e.min.y,Zm.z=o.normal.z>0?e.max.z:e.min.z,o.distanceToPoint(Zm)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function fA(){let n=null,e=!1,t=null,i=null;function o(h,f){t(h,f),i=n.requestAnimationFrame(o)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(o),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(h){t=h},setContext:function(h){n=h}}}function lk(n){const e=new WeakMap;function t(c,v){const w=c.array,S=c.usage,E=w.byteLength,M=n.createBuffer();n.bindBuffer(v,M),n.bufferData(v,w,S),c.onUploadCallback();let L;if(w instanceof Float32Array)L=n.FLOAT;else if(w instanceof Uint16Array)c.isFloat16BufferAttribute?L=n.HALF_FLOAT:L=n.UNSIGNED_SHORT;else if(w instanceof Int16Array)L=n.SHORT;else if(w instanceof Uint32Array)L=n.UNSIGNED_INT;else if(w instanceof Int32Array)L=n.INT;else if(w instanceof Int8Array)L=n.BYTE;else if(w instanceof Uint8Array)L=n.UNSIGNED_BYTE;else if(w instanceof Uint8ClampedArray)L=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+w);return{buffer:M,type:L,bytesPerElement:w.BYTES_PER_ELEMENT,version:c.version,size:E}}function i(c,v,w){const S=v.array,E=v._updateRange,M=v.updateRanges;if(n.bindBuffer(w,c),E.count===-1&&M.length===0&&n.bufferSubData(w,0,S),M.length!==0){for(let L=0,U=M.length;L<U;L++){const B=M[L];n.bufferSubData(w,B.start*S.BYTES_PER_ELEMENT,S,B.start,B.count)}v.clearUpdateRanges()}E.count!==-1&&(n.bufferSubData(w,E.offset*S.BYTES_PER_ELEMENT,S,E.offset,E.count),E.count=-1),v.onUploadCallback()}function o(c){return c.isInterleavedBufferAttribute&&(c=c.data),e.get(c)}function h(c){c.isInterleavedBufferAttribute&&(c=c.data);const v=e.get(c);v&&(n.deleteBuffer(v.buffer),e.delete(c))}function f(c,v){if(c.isGLBufferAttribute){const S=e.get(c);(!S||S.version<c.version)&&e.set(c,{buffer:c.buffer,type:c.type,bytesPerElement:c.elementSize,version:c.version});return}c.isInterleavedBufferAttribute&&(c=c.data);const w=e.get(c);if(w===void 0)e.set(c,t(c,v));else if(w.version<c.version){if(w.size!==c.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(w.buffer,c,v),w.version=c.version}}return{get:o,remove:h,update:f}}class m_ extends Al{constructor(e=1,t=1,i=1,o=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:o};const h=e/2,f=t/2,c=Math.floor(i),v=Math.floor(o),w=c+1,S=v+1,E=e/c,M=t/v,L=[],U=[],B=[],z=[];for(let R=0;R<S;R++){const G=R*M-f;for(let V=0;V<w;V++){const ee=V*E-h;U.push(ee,-G,0),B.push(0,0,1),z.push(V/c),z.push(1-R/v)}}for(let R=0;R<v;R++)for(let G=0;G<c;G++){const V=G+w*R,ee=G+w*(R+1),fe=G+1+w*(R+1),Z=G+1+w*R;L.push(V,ee,Z),L.push(ee,fe,Z)}this.setIndex(L),this.setAttribute("position",new Ea(U,3)),this.setAttribute("normal",new Ea(B,3)),this.setAttribute("uv",new Ea(z,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new m_(e.width,e.height,e.widthSegments,e.heightSegments)}}var ck=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,uk=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,hk=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,dk=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,fk=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,pk=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,mk=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,gk=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,_k=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,yk=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,vk=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,xk=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bk=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,wk=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,Sk=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,Mk=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,Tk=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,Ek=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,Ak=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,Ck=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,Pk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,Rk=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,Ik=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,Lk=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,Dk=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,zk=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,kk=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,Fk=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,Uk=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,Nk=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,Ok="gl_FragColor = linearToOutputTexel( gl_FragColor );",Bk=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,Vk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,Gk=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,Hk=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,jk=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,Wk=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,$k=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,Xk=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,qk=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,Zk=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,Yk=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,Kk=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,Jk=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,Qk=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,eF=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,tF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,nF=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,iF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,rF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,sF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,aF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,oF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,lF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,cF=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,uF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,hF=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,dF=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,fF=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,pF=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,mF=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,gF=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,_F=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,yF=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,vF=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,xF=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,bF=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,wF=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,SF=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,MF=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,TF=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,EF=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,AF=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,CF=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,PF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,RF=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,IF=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,LF=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,DF=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,zF=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,kF=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,FF=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,UF=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,NF=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,OF=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,BF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,VF=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,GF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,HF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,jF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,WF=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,$F=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,XF=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,qF=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,ZF=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,YF=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,KF=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,JF=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,QF=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,eU=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tU=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,nU=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, newPeak * vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,iU=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,rU=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,sU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,aU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,oU=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,lU=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const cU=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,uU=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,hU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,dU=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,fU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,pU=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,mU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,gU=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,_U=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,yU=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,vU=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,xU=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,bU=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wU=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,SU=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,MU=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,TU=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,EU=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,AU=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,CU=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,PU=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,RU=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,IU=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,LU=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,DU=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,zU=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kU=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,FU=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,UU=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,NU=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,OU=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,BU=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,VU=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,GU=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Ln={alphahash_fragment:ck,alphahash_pars_fragment:uk,alphamap_fragment:hk,alphamap_pars_fragment:dk,alphatest_fragment:fk,alphatest_pars_fragment:pk,aomap_fragment:mk,aomap_pars_fragment:gk,batching_pars_vertex:_k,batching_vertex:yk,begin_vertex:vk,beginnormal_vertex:xk,bsdfs:bk,iridescence_fragment:wk,bumpmap_pars_fragment:Sk,clipping_planes_fragment:Mk,clipping_planes_pars_fragment:Tk,clipping_planes_pars_vertex:Ek,clipping_planes_vertex:Ak,color_fragment:Ck,color_pars_fragment:Pk,color_pars_vertex:Rk,color_vertex:Ik,common:Lk,cube_uv_reflection_fragment:Dk,defaultnormal_vertex:zk,displacementmap_pars_vertex:kk,displacementmap_vertex:Fk,emissivemap_fragment:Uk,emissivemap_pars_fragment:Nk,colorspace_fragment:Ok,colorspace_pars_fragment:Bk,envmap_fragment:Vk,envmap_common_pars_fragment:Gk,envmap_pars_fragment:Hk,envmap_pars_vertex:jk,envmap_physical_pars_fragment:nF,envmap_vertex:Wk,fog_vertex:$k,fog_pars_vertex:Xk,fog_fragment:qk,fog_pars_fragment:Zk,gradientmap_pars_fragment:Yk,lightmap_fragment:Kk,lightmap_pars_fragment:Jk,lights_lambert_fragment:Qk,lights_lambert_pars_fragment:eF,lights_pars_begin:tF,lights_toon_fragment:iF,lights_toon_pars_fragment:rF,lights_phong_fragment:sF,lights_phong_pars_fragment:aF,lights_physical_fragment:oF,lights_physical_pars_fragment:lF,lights_fragment_begin:cF,lights_fragment_maps:uF,lights_fragment_end:hF,logdepthbuf_fragment:dF,logdepthbuf_pars_fragment:fF,logdepthbuf_pars_vertex:pF,logdepthbuf_vertex:mF,map_fragment:gF,map_pars_fragment:_F,map_particle_fragment:yF,map_particle_pars_fragment:vF,metalnessmap_fragment:xF,metalnessmap_pars_fragment:bF,morphinstance_vertex:wF,morphcolor_vertex:SF,morphnormal_vertex:MF,morphtarget_pars_vertex:TF,morphtarget_vertex:EF,normal_fragment_begin:AF,normal_fragment_maps:CF,normal_pars_fragment:PF,normal_pars_vertex:RF,normal_vertex:IF,normalmap_pars_fragment:LF,clearcoat_normal_fragment_begin:DF,clearcoat_normal_fragment_maps:zF,clearcoat_pars_fragment:kF,iridescence_pars_fragment:FF,opaque_fragment:UF,packing:NF,premultiplied_alpha_fragment:OF,project_vertex:BF,dithering_fragment:VF,dithering_pars_fragment:GF,roughnessmap_fragment:HF,roughnessmap_pars_fragment:jF,shadowmap_pars_fragment:WF,shadowmap_pars_vertex:$F,shadowmap_vertex:XF,shadowmask_pars_fragment:qF,skinbase_vertex:ZF,skinning_pars_vertex:YF,skinning_vertex:KF,skinnormal_vertex:JF,specularmap_fragment:QF,specularmap_pars_fragment:eU,tonemapping_fragment:tU,tonemapping_pars_fragment:nU,transmission_fragment:iU,transmission_pars_fragment:rU,uv_pars_fragment:sU,uv_pars_vertex:aU,uv_vertex:oU,worldpos_vertex:lU,background_vert:cU,background_frag:uU,backgroundCube_vert:hU,backgroundCube_frag:dU,cube_vert:fU,cube_frag:pU,depth_vert:mU,depth_frag:gU,distanceRGBA_vert:_U,distanceRGBA_frag:yU,equirect_vert:vU,equirect_frag:xU,linedashed_vert:bU,linedashed_frag:wU,meshbasic_vert:SU,meshbasic_frag:MU,meshlambert_vert:TU,meshlambert_frag:EU,meshmatcap_vert:AU,meshmatcap_frag:CU,meshnormal_vert:PU,meshnormal_frag:RU,meshphong_vert:IU,meshphong_frag:LU,meshphysical_vert:DU,meshphysical_frag:zU,meshtoon_vert:kU,meshtoon_frag:FU,points_vert:UU,points_frag:NU,shadow_vert:OU,shadow_frag:BU,sprite_vert:VU,sprite_frag:GU},Zt={common:{diffuse:{value:new si(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Dn},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Dn}},envmap:{envMap:{value:null},envMapRotation:{value:new Dn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Dn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Dn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Dn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Dn},normalScale:{value:new Pn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Dn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Dn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Dn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Dn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new si(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new si(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0},uvTransform:{value:new Dn}},sprite:{diffuse:{value:new si(16777215)},opacity:{value:1},center:{value:new Pn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Dn},alphaMap:{value:null},alphaMapTransform:{value:new Dn},alphaTest:{value:0}}},va={basic:{uniforms:Vr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.fog]),vertexShader:Ln.meshbasic_vert,fragmentShader:Ln.meshbasic_frag},lambert:{uniforms:Vr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.fog,Zt.lights,{emissive:{value:new si(0)}}]),vertexShader:Ln.meshlambert_vert,fragmentShader:Ln.meshlambert_frag},phong:{uniforms:Vr([Zt.common,Zt.specularmap,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.fog,Zt.lights,{emissive:{value:new si(0)},specular:{value:new si(1118481)},shininess:{value:30}}]),vertexShader:Ln.meshphong_vert,fragmentShader:Ln.meshphong_frag},standard:{uniforms:Vr([Zt.common,Zt.envmap,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.roughnessmap,Zt.metalnessmap,Zt.fog,Zt.lights,{emissive:{value:new si(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Ln.meshphysical_vert,fragmentShader:Ln.meshphysical_frag},toon:{uniforms:Vr([Zt.common,Zt.aomap,Zt.lightmap,Zt.emissivemap,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.gradientmap,Zt.fog,Zt.lights,{emissive:{value:new si(0)}}]),vertexShader:Ln.meshtoon_vert,fragmentShader:Ln.meshtoon_frag},matcap:{uniforms:Vr([Zt.common,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,Zt.fog,{matcap:{value:null}}]),vertexShader:Ln.meshmatcap_vert,fragmentShader:Ln.meshmatcap_frag},points:{uniforms:Vr([Zt.points,Zt.fog]),vertexShader:Ln.points_vert,fragmentShader:Ln.points_frag},dashed:{uniforms:Vr([Zt.common,Zt.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Ln.linedashed_vert,fragmentShader:Ln.linedashed_frag},depth:{uniforms:Vr([Zt.common,Zt.displacementmap]),vertexShader:Ln.depth_vert,fragmentShader:Ln.depth_frag},normal:{uniforms:Vr([Zt.common,Zt.bumpmap,Zt.normalmap,Zt.displacementmap,{opacity:{value:1}}]),vertexShader:Ln.meshnormal_vert,fragmentShader:Ln.meshnormal_frag},sprite:{uniforms:Vr([Zt.sprite,Zt.fog]),vertexShader:Ln.sprite_vert,fragmentShader:Ln.sprite_frag},background:{uniforms:{uvTransform:{value:new Dn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Ln.background_vert,fragmentShader:Ln.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Dn}},vertexShader:Ln.backgroundCube_vert,fragmentShader:Ln.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Ln.cube_vert,fragmentShader:Ln.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Ln.equirect_vert,fragmentShader:Ln.equirect_frag},distanceRGBA:{uniforms:Vr([Zt.common,Zt.displacementmap,{referencePosition:{value:new $e},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Ln.distanceRGBA_vert,fragmentShader:Ln.distanceRGBA_frag},shadow:{uniforms:Vr([Zt.lights,Zt.fog,{color:{value:new si(0)},opacity:{value:1}}]),vertexShader:Ln.shadow_vert,fragmentShader:Ln.shadow_frag}};va.physical={uniforms:Vr([va.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Dn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Dn},clearcoatNormalScale:{value:new Pn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Dn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Dn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Dn},sheen:{value:0},sheenColor:{value:new si(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Dn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Dn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Dn},transmissionSamplerSize:{value:new Pn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Dn},attenuationDistance:{value:0},attenuationColor:{value:new si(0)},specularColor:{value:new si(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Dn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Dn},anisotropyVector:{value:new Pn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Dn}}]),vertexShader:Ln.meshphysical_vert,fragmentShader:Ln.meshphysical_frag};const Ym={r:0,b:0,g:0},Ql=new fo,HU=new Yi;function jU(n,e,t,i,o,h,f){const c=new si(0);let v=h===!0?0:1,w,S,E=null,M=0,L=null;function U(z,R){let G=!1,V=R.isScene===!0?R.background:null;V&&V.isTexture&&(V=(R.backgroundBlurriness>0?t:e).get(V)),V===null?B(c,v):V&&V.isColor&&(B(V,1),G=!0);const ee=n.xr.getEnvironmentBlendMode();ee==="additive"?i.buffers.color.setClear(0,0,0,1,f):ee==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,f),(n.autoClear||G)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),V&&(V.isCubeTexture||V.mapping===d_)?(S===void 0&&(S=new gs(new np(1,1,1),new Ns({name:"BackgroundCubeMaterial",uniforms:Th(va.backgroundCube.uniforms),vertexShader:va.backgroundCube.vertexShader,fragmentShader:va.backgroundCube.fragmentShader,side:jr,depthTest:!1,depthWrite:!1,fog:!1})),S.geometry.deleteAttribute("normal"),S.geometry.deleteAttribute("uv"),S.onBeforeRender=function(fe,Z,te){this.matrixWorld.copyPosition(te.matrixWorld)},Object.defineProperty(S.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),o.update(S)),Ql.copy(R.backgroundRotation),Ql.x*=-1,Ql.y*=-1,Ql.z*=-1,V.isCubeTexture&&V.isRenderTargetTexture===!1&&(Ql.y*=-1,Ql.z*=-1),S.material.uniforms.envMap.value=V,S.material.uniforms.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,S.material.uniforms.backgroundBlurriness.value=R.backgroundBlurriness,S.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,S.material.uniforms.backgroundRotation.value.setFromMatrix4(HU.makeRotationFromEuler(Ql)),S.material.toneMapped=ri.getTransfer(V.colorSpace)!==gi,(E!==V||M!==V.version||L!==n.toneMapping)&&(S.material.needsUpdate=!0,E=V,M=V.version,L=n.toneMapping),S.layers.enableAll(),z.unshift(S,S.geometry,S.material,0,0,null)):V&&V.isTexture&&(w===void 0&&(w=new gs(new m_(2,2),new Ns({name:"BackgroundMaterial",uniforms:Th(va.background.uniforms),vertexShader:va.background.vertexShader,fragmentShader:va.background.fragmentShader,side:xl,depthTest:!1,depthWrite:!1,fog:!1})),w.geometry.deleteAttribute("normal"),Object.defineProperty(w.material,"map",{get:function(){return this.uniforms.t2D.value}}),o.update(w)),w.material.uniforms.t2D.value=V,w.material.uniforms.backgroundIntensity.value=R.backgroundIntensity,w.material.toneMapped=ri.getTransfer(V.colorSpace)!==gi,V.matrixAutoUpdate===!0&&V.updateMatrix(),w.material.uniforms.uvTransform.value.copy(V.matrix),(E!==V||M!==V.version||L!==n.toneMapping)&&(w.material.needsUpdate=!0,E=V,M=V.version,L=n.toneMapping),w.layers.enableAll(),z.unshift(w,w.geometry,w.material,0,0,null))}function B(z,R){z.getRGB(Ym,cA(n)),i.buffers.color.setClear(Ym.r,Ym.g,Ym.b,R,f)}return{getClearColor:function(){return c},setClearColor:function(z,R=1){c.set(z),v=R,B(c,v)},getClearAlpha:function(){return v},setClearAlpha:function(z){v=z,B(c,v)},render:U}}function WU(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},o=M(null);let h=o,f=!1;function c(K,Pe,ke,Te,je){let it=!1;const ut=E(Te,ke,Pe);h!==ut&&(h=ut,w(h.object)),it=L(K,Te,ke,je),it&&U(K,Te,ke,je),je!==null&&e.update(je,n.ELEMENT_ARRAY_BUFFER),(it||f)&&(f=!1,ee(K,Pe,ke,Te),je!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(je).buffer))}function v(){return n.createVertexArray()}function w(K){return n.bindVertexArray(K)}function S(K){return n.deleteVertexArray(K)}function E(K,Pe,ke){const Te=ke.wireframe===!0;let je=i[K.id];je===void 0&&(je={},i[K.id]=je);let it=je[Pe.id];it===void 0&&(it={},je[Pe.id]=it);let ut=it[Te];return ut===void 0&&(ut=M(v()),it[Te]=ut),ut}function M(K){const Pe=[],ke=[],Te=[];for(let je=0;je<t;je++)Pe[je]=0,ke[je]=0,Te[je]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Pe,enabledAttributes:ke,attributeDivisors:Te,object:K,attributes:{},index:null}}function L(K,Pe,ke,Te){const je=h.attributes,it=Pe.attributes;let ut=0;const st=ke.getAttributes();for(const Ce in st)if(st[Ce].location>=0){const Ye=je[Ce];let pt=it[Ce];if(pt===void 0&&(Ce==="instanceMatrix"&&K.instanceMatrix&&(pt=K.instanceMatrix),Ce==="instanceColor"&&K.instanceColor&&(pt=K.instanceColor)),Ye===void 0||Ye.attribute!==pt||pt&&Ye.data!==pt.data)return!0;ut++}return h.attributesNum!==ut||h.index!==Te}function U(K,Pe,ke,Te){const je={},it=Pe.attributes;let ut=0;const st=ke.getAttributes();for(const Ce in st)if(st[Ce].location>=0){let Ye=it[Ce];Ye===void 0&&(Ce==="instanceMatrix"&&K.instanceMatrix&&(Ye=K.instanceMatrix),Ce==="instanceColor"&&K.instanceColor&&(Ye=K.instanceColor));const pt={};pt.attribute=Ye,Ye&&Ye.data&&(pt.data=Ye.data),je[Ce]=pt,ut++}h.attributes=je,h.attributesNum=ut,h.index=Te}function B(){const K=h.newAttributes;for(let Pe=0,ke=K.length;Pe<ke;Pe++)K[Pe]=0}function z(K){R(K,0)}function R(K,Pe){const ke=h.newAttributes,Te=h.enabledAttributes,je=h.attributeDivisors;ke[K]=1,Te[K]===0&&(n.enableVertexAttribArray(K),Te[K]=1),je[K]!==Pe&&(n.vertexAttribDivisor(K,Pe),je[K]=Pe)}function G(){const K=h.newAttributes,Pe=h.enabledAttributes;for(let ke=0,Te=Pe.length;ke<Te;ke++)Pe[ke]!==K[ke]&&(n.disableVertexAttribArray(ke),Pe[ke]=0)}function V(K,Pe,ke,Te,je,it,ut){ut===!0?n.vertexAttribIPointer(K,Pe,ke,je,it):n.vertexAttribPointer(K,Pe,ke,Te,je,it)}function ee(K,Pe,ke,Te){B();const je=Te.attributes,it=ke.getAttributes(),ut=Pe.defaultAttributeValues;for(const st in it){const Ce=it[st];if(Ce.location>=0){let Ke=je[st];if(Ke===void 0&&(st==="instanceMatrix"&&K.instanceMatrix&&(Ke=K.instanceMatrix),st==="instanceColor"&&K.instanceColor&&(Ke=K.instanceColor)),Ke!==void 0){const Ye=Ke.normalized,pt=Ke.itemSize,kt=e.get(Ke);if(kt===void 0)continue;const _n=kt.buffer,Ze=kt.type,_t=kt.bytesPerElement,Ct=Ze===n.INT||Ze===n.UNSIGNED_INT||Ke.gpuType===$2;if(Ke.isInterleavedBufferAttribute){const St=Ke.data,un=St.stride,mn=Ke.offset;if(St.isInstancedInterleavedBuffer){for(let yn=0;yn<Ce.locationSize;yn++)R(Ce.location+yn,St.meshPerAttribute);K.isInstancedMesh!==!0&&Te._maxInstanceCount===void 0&&(Te._maxInstanceCount=St.meshPerAttribute*St.count)}else for(let yn=0;yn<Ce.locationSize;yn++)z(Ce.location+yn);n.bindBuffer(n.ARRAY_BUFFER,_n);for(let yn=0;yn<Ce.locationSize;yn++)V(Ce.location+yn,pt/Ce.locationSize,Ze,Ye,un*_t,(mn+pt/Ce.locationSize*yn)*_t,Ct)}else{if(Ke.isInstancedBufferAttribute){for(let St=0;St<Ce.locationSize;St++)R(Ce.location+St,Ke.meshPerAttribute);K.isInstancedMesh!==!0&&Te._maxInstanceCount===void 0&&(Te._maxInstanceCount=Ke.meshPerAttribute*Ke.count)}else for(let St=0;St<Ce.locationSize;St++)z(Ce.location+St);n.bindBuffer(n.ARRAY_BUFFER,_n);for(let St=0;St<Ce.locationSize;St++)V(Ce.location+St,pt/Ce.locationSize,Ze,Ye,pt*_t,pt/Ce.locationSize*St*_t,Ct)}}else if(ut!==void 0){const Ye=ut[st];if(Ye!==void 0)switch(Ye.length){case 2:n.vertexAttrib2fv(Ce.location,Ye);break;case 3:n.vertexAttrib3fv(Ce.location,Ye);break;case 4:n.vertexAttrib4fv(Ce.location,Ye);break;default:n.vertexAttrib1fv(Ce.location,Ye)}}}}G()}function fe(){be();for(const K in i){const Pe=i[K];for(const ke in Pe){const Te=Pe[ke];for(const je in Te)S(Te[je].object),delete Te[je];delete Pe[ke]}delete i[K]}}function Z(K){if(i[K.id]===void 0)return;const Pe=i[K.id];for(const ke in Pe){const Te=Pe[ke];for(const je in Te)S(Te[je].object),delete Te[je];delete Pe[ke]}delete i[K.id]}function te(K){for(const Pe in i){const ke=i[Pe];if(ke[K.id]===void 0)continue;const Te=ke[K.id];for(const je in Te)S(Te[je].object),delete Te[je];delete ke[K.id]}}function be(){ae(),f=!0,h!==o&&(h=o,w(h.object))}function ae(){o.geometry=null,o.program=null,o.wireframe=!1}return{setup:c,reset:be,resetDefaultState:ae,dispose:fe,releaseStatesOfGeometry:Z,releaseStatesOfProgram:te,initAttributes:B,enableAttribute:z,disableUnusedAttributes:G}}function $U(n,e,t){let i;function o(v){i=v}function h(v,w){n.drawArrays(i,v,w),t.update(w,i,1)}function f(v,w,S){S!==0&&(n.drawArraysInstanced(i,v,w,S),t.update(w,i,S))}function c(v,w,S){if(S===0)return;const E=e.get("WEBGL_multi_draw");if(E===null)for(let M=0;M<S;M++)this.render(v[M],w[M]);else{E.multiDrawArraysWEBGL(i,v,0,w,0,S);let M=0;for(let L=0;L<S;L++)M+=w[L];t.update(M,i,1)}}this.setMode=o,this.render=h,this.renderInstances=f,this.renderMultiDraw=c}function XU(n,e,t){let i;function o(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const V=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(V.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function h(V){if(V==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";V="mediump"}return V==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let f=t.precision!==void 0?t.precision:"highp";const c=h(f);c!==f&&(console.warn("THREE.WebGLRenderer:",f,"not supported, using",c,"instead."),f=c);const v=t.logarithmicDepthBuffer===!0,w=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),S=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),E=n.getParameter(n.MAX_TEXTURE_SIZE),M=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),L=n.getParameter(n.MAX_VERTEX_ATTRIBS),U=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),B=n.getParameter(n.MAX_VARYING_VECTORS),z=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),R=S>0,G=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:o,getMaxPrecision:h,precision:f,logarithmicDepthBuffer:v,maxTextures:w,maxVertexTextures:S,maxTextureSize:E,maxCubemapSize:M,maxAttributes:L,maxVertexUniforms:U,maxVaryings:B,maxFragmentUniforms:z,vertexTextures:R,maxSamples:G}}function qU(n){const e=this;let t=null,i=0,o=!1,h=!1;const f=new el,c=new Dn,v={value:null,needsUpdate:!1};this.uniform=v,this.numPlanes=0,this.numIntersection=0,this.init=function(E,M){const L=E.length!==0||M||i!==0||o;return o=M,i=E.length,L},this.beginShadows=function(){h=!0,S(null)},this.endShadows=function(){h=!1},this.setGlobalState=function(E,M){t=S(E,M,0)},this.setState=function(E,M,L){const U=E.clippingPlanes,B=E.clipIntersection,z=E.clipShadows,R=n.get(E);if(!o||U===null||U.length===0||h&&!z)h?S(null):w();else{const G=h?0:i,V=G*4;let ee=R.clippingState||null;v.value=ee,ee=S(U,M,V,L);for(let fe=0;fe!==V;++fe)ee[fe]=t[fe];R.clippingState=ee,this.numIntersection=B?this.numPlanes:0,this.numPlanes+=G}};function w(){v.value!==t&&(v.value=t,v.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function S(E,M,L,U){const B=E!==null?E.length:0;let z=null;if(B!==0){if(z=v.value,U!==!0||z===null){const R=L+B*4,G=M.matrixWorldInverse;c.getNormalMatrix(G),(z===null||z.length<R)&&(z=new Float32Array(R));for(let V=0,ee=L;V!==B;++V,ee+=4)f.copy(E[V]).applyMatrix4(G,c),f.normal.toArray(z,ee),z[ee+3]=f.constant}v.value=z,v.needsUpdate=!0}return e.numPlanes=B,e.numIntersection=0,z}}function ZU(n){let e=new WeakMap;function t(f,c){return c===Uv?f.mapping=wh:c===Nv&&(f.mapping=Sh),f}function i(f){if(f&&f.isTexture){const c=f.mapping;if(c===Uv||c===Nv)if(e.has(f)){const v=e.get(f).texture;return t(v,f.mapping)}else{const v=f.image;if(v&&v.height>0){const w=new sk(v.height);return w.fromEquirectangularTexture(n,f),e.set(f,w),f.addEventListener("dispose",o),t(w.texture,f.mapping)}else return null}}return f}function o(f){const c=f.target;c.removeEventListener("dispose",o);const v=e.get(c);v!==void 0&&(e.delete(c),v.dispose())}function h(){e=new WeakMap}return{get:i,dispose:h}}class YU extends uA{constructor(e=-1,t=1,i=1,o=-1,h=.1,f=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=o,this.near=h,this.far=f,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,o,h,f){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=o,this.view.width=h,this.view.height=f,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,o=(this.top+this.bottom)/2;let h=i-e,f=i+e,c=o+t,v=o-t;if(this.view!==null&&this.view.enabled){const w=(this.right-this.left)/this.view.fullWidth/this.zoom,S=(this.top-this.bottom)/this.view.fullHeight/this.zoom;h+=w*this.view.offsetX,f=h+w*this.view.width,c-=S*this.view.offsetY,v=c-S*this.view.height}this.projectionMatrix.makeOrthographic(h,f,c,v,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Qu=4,yM=[.125,.215,.35,.446,.526,.582],ac=20,E0=new YU,vM=new si;let A0=null,C0=0,P0=0,R0=!1;const rc=(1+Math.sqrt(5))/2,zu=1/rc,xM=[new $e(1,1,1),new $e(-1,1,1),new $e(1,1,-1),new $e(-1,1,-1),new $e(0,rc,zu),new $e(0,rc,-zu),new $e(zu,0,rc),new $e(-zu,0,rc),new $e(rc,zu,0),new $e(-rc,zu,0)];class bM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,o=100){A0=this._renderer.getRenderTarget(),C0=this._renderer.getActiveCubeFace(),P0=this._renderer.getActiveMipmapLevel(),R0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const h=this._allocateTargets();return h.depthBuffer=!0,this._sceneToCubeUV(e,i,o,h),t>0&&this._blur(h,0,0,t),this._applyPMREM(h),this._cleanup(h),h}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=MM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=SM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(A0,C0,P0),this._renderer.xr.enabled=R0,e.scissorTest=!1,Km(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===wh||e.mapping===Sh?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),A0=this._renderer.getRenderTarget(),C0=this._renderer.getActiveCubeFace(),P0=this._renderer.getActiveMipmapLevel(),R0=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:ia,minFilter:ia,generateMipmaps:!1,type:Vg,format:wa,colorSpace:El,depthBuffer:!1},o=wM(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=wM(e,t,i);const{_lodMax:h}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=KU(h)),this._blurMaterial=JU(h,e,t)}return o}_compileMaterial(e){const t=new gs(this._lodPlanes[0],e);this._renderer.compile(t,E0)}_sceneToCubeUV(e,t,i,o){const c=new Ds(90,1,t,i),v=[1,-1,1,1,1,1],w=[1,1,1,-1,-1,-1],S=this._renderer,E=S.autoClear,M=S.toneMapping;S.getClearColor(vM),S.toneMapping=gl,S.autoClear=!1;const L=new aA({name:"PMREM.Background",side:jr,depthWrite:!1,depthTest:!1}),U=new gs(new np,L);let B=!1;const z=e.background;z?z.isColor&&(L.color.copy(z),e.background=null,B=!0):(L.color.copy(vM),B=!0);for(let R=0;R<6;R++){const G=R%3;G===0?(c.up.set(0,v[R],0),c.lookAt(w[R],0,0)):G===1?(c.up.set(0,0,v[R]),c.lookAt(0,w[R],0)):(c.up.set(0,v[R],0),c.lookAt(0,0,w[R]));const V=this._cubeSize;Km(o,G*V,R>2?V:0,V,V),S.setRenderTarget(o),B&&S.render(U,c),S.render(e,c)}U.geometry.dispose(),U.material.dispose(),S.toneMapping=M,S.autoClear=E,e.background=z}_textureToCubeUV(e,t){const i=this._renderer,o=e.mapping===wh||e.mapping===Sh;o?(this._cubemapMaterial===null&&(this._cubemapMaterial=MM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=SM());const h=o?this._cubemapMaterial:this._equirectMaterial,f=new gs(this._lodPlanes[0],h),c=h.uniforms;c.envMap.value=e;const v=this._cubeSize;Km(t,0,0,3*v,2*v),i.setRenderTarget(t),i.render(f,E0)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let o=1;o<this._lodPlanes.length;o++){const h=Math.sqrt(this._sigmas[o]*this._sigmas[o]-this._sigmas[o-1]*this._sigmas[o-1]),f=xM[(o-1)%xM.length];this._blur(e,o-1,o,h,f)}t.autoClear=i}_blur(e,t,i,o,h){const f=this._pingPongRenderTarget;this._halfBlur(e,f,t,i,o,"latitudinal",h),this._halfBlur(f,e,i,i,o,"longitudinal",h)}_halfBlur(e,t,i,o,h,f,c){const v=this._renderer,w=this._blurMaterial;f!=="latitudinal"&&f!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const S=3,E=new gs(this._lodPlanes[o],w),M=w.uniforms,L=this._sizeLods[i]-1,U=isFinite(h)?Math.PI/(2*L):2*Math.PI/(2*ac-1),B=h/U,z=isFinite(h)?1+Math.floor(S*B):ac;z>ac&&console.warn(`sigmaRadians, ${h}, is too large and will clip, as it requested ${z} samples when the maximum is set to ${ac}`);const R=[];let G=0;for(let te=0;te<ac;++te){const be=te/B,ae=Math.exp(-be*be/2);R.push(ae),te===0?G+=ae:te<z&&(G+=2*ae)}for(let te=0;te<R.length;te++)R[te]=R[te]/G;M.envMap.value=e.texture,M.samples.value=z,M.weights.value=R,M.latitudinal.value=f==="latitudinal",c&&(M.poleAxis.value=c);const{_lodMax:V}=this;M.dTheta.value=U,M.mipInt.value=V-i;const ee=this._sizeLods[o],fe=3*ee*(o>V-Qu?o-V+Qu:0),Z=4*(this._cubeSize-ee);Km(t,fe,Z,3*ee,2*ee),v.setRenderTarget(t),v.render(E,E0)}}function KU(n){const e=[],t=[],i=[];let o=n;const h=n-Qu+1+yM.length;for(let f=0;f<h;f++){const c=Math.pow(2,o);t.push(c);let v=1/c;f>n-Qu?v=yM[f-n+Qu-1]:f===0&&(v=0),i.push(v);const w=1/(c-2),S=-w,E=1+w,M=[S,S,E,S,E,E,S,S,E,E,S,E],L=6,U=6,B=3,z=2,R=1,G=new Float32Array(B*U*L),V=new Float32Array(z*U*L),ee=new Float32Array(R*U*L);for(let Z=0;Z<L;Z++){const te=Z%3*2/3-1,be=Z>2?0:-1,ae=[te,be,0,te+2/3,be,0,te+2/3,be+1,0,te,be,0,te+2/3,be+1,0,te,be+1,0];G.set(ae,B*U*Z),V.set(M,z*U*Z);const K=[Z,Z,Z,Z,Z,Z];ee.set(K,R*U*Z)}const fe=new Al;fe.setAttribute("position",new Ta(G,B)),fe.setAttribute("uv",new Ta(V,z)),fe.setAttribute("faceIndex",new Ta(ee,R)),e.push(fe),o>Qu&&o--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function wM(n,e,t){const i=new wc(n,e,t);return i.texture.mapping=d_,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Km(n,e,t,i,o){n.viewport.set(e,t,i,o),n.scissor.set(e,t,i,o)}function JU(n,e,t){const i=new Float32Array(ac),o=new $e(0,1,0);return new Ns({name:"SphericalGaussianBlur",defines:{n:ac,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:o}},vertexShader:Yx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:ml,depthTest:!1,depthWrite:!1})}function SM(){return new Ns({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:Yx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:ml,depthTest:!1,depthWrite:!1})}function MM(){return new Ns({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:Yx(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:ml,depthTest:!1,depthWrite:!1})}function Yx(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function QU(n){let e=new WeakMap,t=null;function i(c){if(c&&c.isTexture){const v=c.mapping,w=v===Uv||v===Nv,S=v===wh||v===Sh;if(w||S){let E=e.get(c);const M=E!==void 0?E.texture.pmremVersion:0;if(c.isRenderTargetTexture&&c.pmremVersion!==M)return t===null&&(t=new bM(n)),E=w?t.fromEquirectangular(c,E):t.fromCubemap(c,E),E.texture.pmremVersion=c.pmremVersion,e.set(c,E),E.texture;if(E!==void 0)return E.texture;{const L=c.image;return w&&L&&L.height>0||S&&L&&o(L)?(t===null&&(t=new bM(n)),E=w?t.fromEquirectangular(c):t.fromCubemap(c),E.texture.pmremVersion=c.pmremVersion,e.set(c,E),c.addEventListener("dispose",h),E.texture):null}}}return c}function o(c){let v=0;const w=6;for(let S=0;S<w;S++)c[S]!==void 0&&v++;return v===w}function h(c){const v=c.target;v.removeEventListener("dispose",h);const w=e.get(v);w!==void 0&&(e.delete(v),w.dispose())}function f(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:f}}function e4(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let o;switch(i){case"WEBGL_depth_texture":o=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":o=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":o=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":o=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:o=n.getExtension(i)}return e[i]=o,o}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const o=t(i);return o===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),o}}}function t4(n,e,t,i){const o={},h=new WeakMap;function f(E){const M=E.target;M.index!==null&&e.remove(M.index);for(const U in M.attributes)e.remove(M.attributes[U]);for(const U in M.morphAttributes){const B=M.morphAttributes[U];for(let z=0,R=B.length;z<R;z++)e.remove(B[z])}M.removeEventListener("dispose",f),delete o[M.id];const L=h.get(M);L&&(e.remove(L),h.delete(M)),i.releaseStatesOfGeometry(M),M.isInstancedBufferGeometry===!0&&delete M._maxInstanceCount,t.memory.geometries--}function c(E,M){return o[M.id]===!0||(M.addEventListener("dispose",f),o[M.id]=!0,t.memory.geometries++),M}function v(E){const M=E.attributes;for(const U in M)e.update(M[U],n.ARRAY_BUFFER);const L=E.morphAttributes;for(const U in L){const B=L[U];for(let z=0,R=B.length;z<R;z++)e.update(B[z],n.ARRAY_BUFFER)}}function w(E){const M=[],L=E.index,U=E.attributes.position;let B=0;if(L!==null){const G=L.array;B=L.version;for(let V=0,ee=G.length;V<ee;V+=3){const fe=G[V+0],Z=G[V+1],te=G[V+2];M.push(fe,Z,Z,te,te,fe)}}else if(U!==void 0){const G=U.array;B=U.version;for(let V=0,ee=G.length/3-1;V<ee;V+=3){const fe=V+0,Z=V+1,te=V+2;M.push(fe,Z,Z,te,te,fe)}}else return;const z=new(eA(M)?lA:oA)(M,1);z.version=B;const R=h.get(E);R&&e.remove(R),h.set(E,z)}function S(E){const M=h.get(E);if(M){const L=E.index;L!==null&&M.version<L.version&&w(E)}else w(E);return h.get(E)}return{get:c,update:v,getWireframeAttribute:S}}function n4(n,e,t){let i;function o(E){i=E}let h,f;function c(E){h=E.type,f=E.bytesPerElement}function v(E,M){n.drawElements(i,M,h,E*f),t.update(M,i,1)}function w(E,M,L){L!==0&&(n.drawElementsInstanced(i,M,h,E*f,L),t.update(M,i,L))}function S(E,M,L){if(L===0)return;const U=e.get("WEBGL_multi_draw");if(U===null)for(let B=0;B<L;B++)this.render(E[B]/f,M[B]);else{U.multiDrawElementsWEBGL(i,M,0,h,E,0,L);let B=0;for(let z=0;z<L;z++)B+=M[z];t.update(B,i,1)}}this.setMode=o,this.setIndex=c,this.render=v,this.renderInstances=w,this.renderMultiDraw=S}function i4(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(h,f,c){switch(t.calls++,f){case n.TRIANGLES:t.triangles+=c*(h/3);break;case n.LINES:t.lines+=c*(h/2);break;case n.LINE_STRIP:t.lines+=c*(h-1);break;case n.LINE_LOOP:t.lines+=c*h;break;case n.POINTS:t.points+=c*h;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",f);break}}function o(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:o,update:i}}function r4(n,e,t){const i=new WeakMap,o=new dr;function h(f,c,v){const w=f.morphTargetInfluences,S=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,E=S!==void 0?S.length:0;let M=i.get(c);if(M===void 0||M.count!==E){let K=function(){be.dispose(),i.delete(c),c.removeEventListener("dispose",K)};var L=K;M!==void 0&&M.texture.dispose();const U=c.morphAttributes.position!==void 0,B=c.morphAttributes.normal!==void 0,z=c.morphAttributes.color!==void 0,R=c.morphAttributes.position||[],G=c.morphAttributes.normal||[],V=c.morphAttributes.color||[];let ee=0;U===!0&&(ee=1),B===!0&&(ee=2),z===!0&&(ee=3);let fe=c.attributes.position.count*ee,Z=1;fe>e.maxTextureSize&&(Z=Math.ceil(fe/e.maxTextureSize),fe=e.maxTextureSize);const te=new Float32Array(fe*Z*4*E),be=new nA(te,fe,Z,E);be.type=al,be.needsUpdate=!0;const ae=ee*4;for(let Pe=0;Pe<E;Pe++){const ke=R[Pe],Te=G[Pe],je=V[Pe],it=fe*Z*4*Pe;for(let ut=0;ut<ke.count;ut++){const st=ut*ae;U===!0&&(o.fromBufferAttribute(ke,ut),te[it+st+0]=o.x,te[it+st+1]=o.y,te[it+st+2]=o.z,te[it+st+3]=0),B===!0&&(o.fromBufferAttribute(Te,ut),te[it+st+4]=o.x,te[it+st+5]=o.y,te[it+st+6]=o.z,te[it+st+7]=0),z===!0&&(o.fromBufferAttribute(je,ut),te[it+st+8]=o.x,te[it+st+9]=o.y,te[it+st+10]=o.z,te[it+st+11]=je.itemSize===4?o.w:1)}}M={count:E,texture:be,size:new Pn(fe,Z)},i.set(c,M),c.addEventListener("dispose",K)}if(f.isInstancedMesh===!0&&f.morphTexture!==null)v.getUniforms().setValue(n,"morphTexture",f.morphTexture,t);else{let U=0;for(let z=0;z<w.length;z++)U+=w[z];const B=c.morphTargetsRelative?1:1-U;v.getUniforms().setValue(n,"morphTargetBaseInfluence",B),v.getUniforms().setValue(n,"morphTargetInfluences",w)}v.getUniforms().setValue(n,"morphTargetsTexture",M.texture,t),v.getUniforms().setValue(n,"morphTargetsTextureSize",M.size)}return{update:h}}function s4(n,e,t,i){let o=new WeakMap;function h(v){const w=i.render.frame,S=v.geometry,E=e.get(v,S);if(o.get(E)!==w&&(e.update(E),o.set(E,w)),v.isInstancedMesh&&(v.hasEventListener("dispose",c)===!1&&v.addEventListener("dispose",c),o.get(v)!==w&&(t.update(v.instanceMatrix,n.ARRAY_BUFFER),v.instanceColor!==null&&t.update(v.instanceColor,n.ARRAY_BUFFER),o.set(v,w))),v.isSkinnedMesh){const M=v.skeleton;o.get(M)!==w&&(M.update(),o.set(M,w))}return E}function f(){o=new WeakMap}function c(v){const w=v.target;w.removeEventListener("dispose",c),t.remove(w.instanceMatrix),w.instanceColor!==null&&t.remove(w.instanceColor)}return{update:h,dispose:f}}class pA extends Wr{constructor(e,t,i,o,h,f,c,v,w,S){if(S=S!==void 0?S:ch,S!==ch&&S!==Bf)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&S===ch&&(i=Mh),i===void 0&&S===Bf&&(i=ep),super(null,o,h,f,c,v,S,i,w),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=c!==void 0?c:Us,this.minFilter=v!==void 0?v:Us,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const mA=new Wr,gA=new pA(1,1);gA.compareFunction=Q2;const _A=new nA,yA=new Hz,vA=new hA,TM=[],EM=[],AM=new Float32Array(16),CM=new Float32Array(9),PM=new Float32Array(4);function Ih(n,e,t){const i=n[0];if(i<=0||i>0)return n;const o=e*t;let h=TM[o];if(h===void 0&&(h=new Float32Array(o),TM[o]=h),e!==0){i.toArray(h,0);for(let f=1,c=0;f!==e;++f)c+=t,n[f].toArray(h,c)}return h}function Ki(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Ji(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function g_(n,e){let t=EM[e];t===void 0&&(t=new Int32Array(e),EM[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function a4(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function o4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ki(t,e))return;n.uniform2fv(this.addr,e),Ji(t,e)}}function l4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ki(t,e))return;n.uniform3fv(this.addr,e),Ji(t,e)}}function c4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ki(t,e))return;n.uniform4fv(this.addr,e),Ji(t,e)}}function u4(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ki(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ji(t,e)}else{if(Ki(t,i))return;PM.set(i),n.uniformMatrix2fv(this.addr,!1,PM),Ji(t,i)}}function h4(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ki(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ji(t,e)}else{if(Ki(t,i))return;CM.set(i),n.uniformMatrix3fv(this.addr,!1,CM),Ji(t,i)}}function d4(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Ki(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ji(t,e)}else{if(Ki(t,i))return;AM.set(i),n.uniformMatrix4fv(this.addr,!1,AM),Ji(t,i)}}function f4(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function p4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ki(t,e))return;n.uniform2iv(this.addr,e),Ji(t,e)}}function m4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ki(t,e))return;n.uniform3iv(this.addr,e),Ji(t,e)}}function g4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ki(t,e))return;n.uniform4iv(this.addr,e),Ji(t,e)}}function _4(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function y4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ki(t,e))return;n.uniform2uiv(this.addr,e),Ji(t,e)}}function v4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ki(t,e))return;n.uniform3uiv(this.addr,e),Ji(t,e)}}function x4(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ki(t,e))return;n.uniform4uiv(this.addr,e),Ji(t,e)}}function b4(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o);const h=this.type===n.SAMPLER_2D_SHADOW?gA:mA;t.setTexture2D(e||h,o)}function w4(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture3D(e||yA,o)}function S4(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTextureCube(e||vA,o)}function M4(n,e,t){const i=this.cache,o=t.allocateTextureUnit();i[0]!==o&&(n.uniform1i(this.addr,o),i[0]=o),t.setTexture2DArray(e||_A,o)}function T4(n){switch(n){case 5126:return a4;case 35664:return o4;case 35665:return l4;case 35666:return c4;case 35674:return u4;case 35675:return h4;case 35676:return d4;case 5124:case 35670:return f4;case 35667:case 35671:return p4;case 35668:case 35672:return m4;case 35669:case 35673:return g4;case 5125:return _4;case 36294:return y4;case 36295:return v4;case 36296:return x4;case 35678:case 36198:case 36298:case 36306:case 35682:return b4;case 35679:case 36299:case 36307:return w4;case 35680:case 36300:case 36308:case 36293:return S4;case 36289:case 36303:case 36311:case 36292:return M4}}function E4(n,e){n.uniform1fv(this.addr,e)}function A4(n,e){const t=Ih(e,this.size,2);n.uniform2fv(this.addr,t)}function C4(n,e){const t=Ih(e,this.size,3);n.uniform3fv(this.addr,t)}function P4(n,e){const t=Ih(e,this.size,4);n.uniform4fv(this.addr,t)}function R4(n,e){const t=Ih(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function I4(n,e){const t=Ih(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function L4(n,e){const t=Ih(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function D4(n,e){n.uniform1iv(this.addr,e)}function z4(n,e){n.uniform2iv(this.addr,e)}function k4(n,e){n.uniform3iv(this.addr,e)}function F4(n,e){n.uniform4iv(this.addr,e)}function U4(n,e){n.uniform1uiv(this.addr,e)}function N4(n,e){n.uniform2uiv(this.addr,e)}function O4(n,e){n.uniform3uiv(this.addr,e)}function B4(n,e){n.uniform4uiv(this.addr,e)}function V4(n,e,t){const i=this.cache,o=e.length,h=g_(t,o);Ki(i,h)||(n.uniform1iv(this.addr,h),Ji(i,h));for(let f=0;f!==o;++f)t.setTexture2D(e[f]||mA,h[f])}function G4(n,e,t){const i=this.cache,o=e.length,h=g_(t,o);Ki(i,h)||(n.uniform1iv(this.addr,h),Ji(i,h));for(let f=0;f!==o;++f)t.setTexture3D(e[f]||yA,h[f])}function H4(n,e,t){const i=this.cache,o=e.length,h=g_(t,o);Ki(i,h)||(n.uniform1iv(this.addr,h),Ji(i,h));for(let f=0;f!==o;++f)t.setTextureCube(e[f]||vA,h[f])}function j4(n,e,t){const i=this.cache,o=e.length,h=g_(t,o);Ki(i,h)||(n.uniform1iv(this.addr,h),Ji(i,h));for(let f=0;f!==o;++f)t.setTexture2DArray(e[f]||_A,h[f])}function W4(n){switch(n){case 5126:return E4;case 35664:return A4;case 35665:return C4;case 35666:return P4;case 35674:return R4;case 35675:return I4;case 35676:return L4;case 5124:case 35670:return D4;case 35667:case 35671:return z4;case 35668:case 35672:return k4;case 35669:case 35673:return F4;case 5125:return U4;case 36294:return N4;case 36295:return O4;case 36296:return B4;case 35678:case 36198:case 36298:case 36306:case 35682:return V4;case 35679:case 36299:case 36307:return G4;case 35680:case 36300:case 36308:case 36293:return H4;case 36289:case 36303:case 36311:case 36292:return j4}}class $4{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=T4(t.type)}}class X4{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=W4(t.type)}}class q4{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const o=this.seq;for(let h=0,f=o.length;h!==f;++h){const c=o[h];c.setValue(e,t[c.id],i)}}}const I0=/(\w+)(\])?(\[|\.)?/g;function RM(n,e){n.seq.push(e),n.map[e.id]=e}function Z4(n,e,t){const i=n.name,o=i.length;for(I0.lastIndex=0;;){const h=I0.exec(i),f=I0.lastIndex;let c=h[1];const v=h[2]==="]",w=h[3];if(v&&(c=c|0),w===void 0||w==="["&&f+2===o){RM(t,w===void 0?new $4(c,n,e):new X4(c,n,e));break}else{let E=t.map[c];E===void 0&&(E=new q4(c),RM(t,E)),t=E}}}class fg{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let o=0;o<i;++o){const h=e.getActiveUniform(t,o),f=e.getUniformLocation(t,h.name);Z4(h,f,this)}}setValue(e,t,i,o){const h=this.map[t];h!==void 0&&h.setValue(e,i,o)}setOptional(e,t,i){const o=t[i];o!==void 0&&this.setValue(e,i,o)}static upload(e,t,i,o){for(let h=0,f=t.length;h!==f;++h){const c=t[h],v=i[c.id];v.needsUpdate!==!1&&c.setValue(e,v.value,o)}}static seqWithValue(e,t){const i=[];for(let o=0,h=e.length;o!==h;++o){const f=e[o];f.id in t&&i.push(f)}return i}}function IM(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const Y4=37297;let K4=0;function J4(n,e){const t=n.split(`
`),i=[],o=Math.max(e-6,0),h=Math.min(e+6,t.length);for(let f=o;f<h;f++){const c=f+1;i.push(`${c===e?">":" "} ${c}: ${t[f]}`)}return i.join(`
`)}function Q4(n){const e=ri.getPrimaries(ri.workingColorSpace),t=ri.getPrimaries(n);let i;switch(e===t?i="":e===jg&&t===Hg?i="LinearDisplayP3ToLinearSRGB":e===Hg&&t===jg&&(i="LinearSRGBToLinearDisplayP3"),n){case El:case f_:return[i,"LinearTransferOETF"];case ya:case Xx:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function LM(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),o=n.getShaderInfoLog(e).trim();if(i&&o==="")return"";const h=/ERROR: 0:(\d+)/.exec(o);if(h){const f=parseInt(h[1]);return t.toUpperCase()+`

`+o+`

`+J4(n.getShaderSource(e),f)}else return o}function eN(n,e){const t=Q4(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function tN(n,e){let t;switch(e){case j3:t="Linear";break;case W3:t="Reinhard";break;case $3:t="OptimizedCineon";break;case X3:t="ACESFilmic";break;case Z3:t="AgX";break;case Y3:t="Neutral";break;case q3:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function nN(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(of).join(`
`)}function iN(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function rN(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let o=0;o<i;o++){const h=n.getActiveAttrib(e,o),f=h.name;let c=1;h.type===n.FLOAT_MAT2&&(c=2),h.type===n.FLOAT_MAT3&&(c=3),h.type===n.FLOAT_MAT4&&(c=4),t[f]={type:h.type,location:n.getAttribLocation(e,f),locationSize:c}}return t}function of(n){return n!==""}function DM(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function zM(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const sN=/^[ \t]*#include +<([\w\d./]+)>/gm;function Vv(n){return n.replace(sN,oN)}const aN=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function oN(n,e){let t=Ln[e];if(t===void 0){const i=aN.get(e);if(i!==void 0)t=Ln[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return Vv(t)}const lN=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kM(n){return n.replace(lN,cN)}function cN(n,e,t,i){let o="";for(let h=parseInt(e);h<parseInt(t);h++)o+=i.replace(/\[\s*i\s*\]/g,"[ "+h+" ]").replace(/UNROLLED_LOOP_INDEX/g,h);return o}function FM(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function uN(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===G2?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===g3?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===Ka&&(e="SHADOWMAP_TYPE_VSM"),e}function hN(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case wh:case Sh:e="ENVMAP_TYPE_CUBE";break;case d_:e="ENVMAP_TYPE_CUBE_UV";break}return e}function dN(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Sh:e="ENVMAP_MODE_REFRACTION";break}return e}function fN(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case H2:e="ENVMAP_BLENDING_MULTIPLY";break;case G3:e="ENVMAP_BLENDING_MIX";break;case H3:e="ENVMAP_BLENDING_ADD";break}return e}function pN(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function mN(n,e,t,i){const o=n.getContext(),h=t.defines;let f=t.vertexShader,c=t.fragmentShader;const v=uN(t),w=hN(t),S=dN(t),E=fN(t),M=pN(t),L=nN(t),U=iN(h),B=o.createProgram();let z,R,G=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(z=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U].filter(of).join(`
`),z.length>0&&(z+=`
`),R=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U].filter(of).join(`
`),R.length>0&&(R+=`
`)):(z=[FM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+S:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(of).join(`
`),R=[FM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,U,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+w:"",t.envMap?"#define "+S:"",t.envMap?"#define "+E:"",M?"#define CUBEUV_TEXEL_WIDTH "+M.texelWidth:"",M?"#define CUBEUV_TEXEL_HEIGHT "+M.texelHeight:"",M?"#define CUBEUV_MAX_MIP "+M.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+v:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==gl?"#define TONE_MAPPING":"",t.toneMapping!==gl?Ln.tonemapping_pars_fragment:"",t.toneMapping!==gl?tN("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Ln.colorspace_pars_fragment,eN("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(of).join(`
`)),f=Vv(f),f=DM(f,t),f=zM(f,t),c=Vv(c),c=DM(c,t),c=zM(c,t),f=kM(f),c=kM(c),t.isRawShaderMaterial!==!0&&(G=`#version 300 es
`,z=[L,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+z,R=["#define varying in",t.glslVersion===KS?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===KS?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+R);const V=G+z+f,ee=G+R+c,fe=IM(o,o.VERTEX_SHADER,V),Z=IM(o,o.FRAGMENT_SHADER,ee);o.attachShader(B,fe),o.attachShader(B,Z),t.index0AttributeName!==void 0?o.bindAttribLocation(B,0,t.index0AttributeName):t.morphTargets===!0&&o.bindAttribLocation(B,0,"position"),o.linkProgram(B);function te(Pe){if(n.debug.checkShaderErrors){const ke=o.getProgramInfoLog(B).trim(),Te=o.getShaderInfoLog(fe).trim(),je=o.getShaderInfoLog(Z).trim();let it=!0,ut=!0;if(o.getProgramParameter(B,o.LINK_STATUS)===!1)if(it=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(o,B,fe,Z);else{const st=LM(o,fe,"vertex"),Ce=LM(o,Z,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(B,o.VALIDATE_STATUS)+`

Material Name: `+Pe.name+`
Material Type: `+Pe.type+`

Program Info Log: `+ke+`
`+st+`
`+Ce)}else ke!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ke):(Te===""||je==="")&&(ut=!1);ut&&(Pe.diagnostics={runnable:it,programLog:ke,vertexShader:{log:Te,prefix:z},fragmentShader:{log:je,prefix:R}})}o.deleteShader(fe),o.deleteShader(Z),be=new fg(o,B),ae=rN(o,B)}let be;this.getUniforms=function(){return be===void 0&&te(this),be};let ae;this.getAttributes=function(){return ae===void 0&&te(this),ae};let K=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return K===!1&&(K=o.getProgramParameter(B,Y4)),K},this.destroy=function(){i.releaseStatesOfProgram(this),o.deleteProgram(B),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=K4++,this.cacheKey=e,this.usedTimes=1,this.program=B,this.vertexShader=fe,this.fragmentShader=Z,this}let gN=0;class _N{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,o=this._getShaderStage(t),h=this._getShaderStage(i),f=this._getShaderCacheForMaterial(e);return f.has(o)===!1&&(f.add(o),o.usedTimes++),f.has(h)===!1&&(f.add(h),h.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new yN(e),t.set(e,i)),i}}class yN{constructor(e){this.id=gN++,this.code=e,this.usedTimes=0}}function vN(n,e,t,i,o,h,f){const c=new rA,v=new _N,w=new Set,S=[],E=o.logarithmicDepthBuffer,M=o.vertexTextures;let L=o.precision;const U={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function B(ae){return w.add(ae),ae===0?"uv":`uv${ae}`}function z(ae,K,Pe,ke,Te){const je=ke.fog,it=Te.geometry,ut=ae.isMeshStandardMaterial?ke.environment:null,st=(ae.isMeshStandardMaterial?t:e).get(ae.envMap||ut),Ce=st&&st.mapping===d_?st.image.height:null,Ke=U[ae.type];ae.precision!==null&&(L=o.getMaxPrecision(ae.precision),L!==ae.precision&&console.warn("THREE.WebGLProgram.getParameters:",ae.precision,"not supported, using",L,"instead."));const Ye=it.morphAttributes.position||it.morphAttributes.normal||it.morphAttributes.color,pt=Ye!==void 0?Ye.length:0;let kt=0;it.morphAttributes.position!==void 0&&(kt=1),it.morphAttributes.normal!==void 0&&(kt=2),it.morphAttributes.color!==void 0&&(kt=3);let _n,Ze,_t,Ct;if(Ke){const Y=va[Ke];_n=Y.vertexShader,Ze=Y.fragmentShader}else _n=ae.vertexShader,Ze=ae.fragmentShader,v.update(ae),_t=v.getVertexShaderID(ae),Ct=v.getFragmentShaderID(ae);const St=n.getRenderTarget(),un=Te.isInstancedMesh===!0,mn=Te.isBatchedMesh===!0,yn=!!ae.map,Fe=!!ae.matcap,dn=!!st,an=!!ae.aoMap,Vn=!!ae.lightMap,Wt=!!ae.bumpMap,En=!!ae.normalMap,J=!!ae.displacementMap,re=!!ae.emissiveMap,Je=!!ae.metalnessMap,Xe=!!ae.roughnessMap,at=ae.anisotropy>0,ft=ae.clearcoat>0,nn=ae.iridescence>0,mt=ae.sheen>0,Kt=ae.transmission>0,rn=at&&!!ae.anisotropyMap,Tt=ft&&!!ae.clearcoatMap,$t=ft&&!!ae.clearcoatNormalMap,qe=ft&&!!ae.clearcoatRoughnessMap,Gt=nn&&!!ae.iridescenceMap,Nt=nn&&!!ae.iridescenceThicknessMap,bn=mt&&!!ae.sheenColorMap,wn=mt&&!!ae.sheenRoughnessMap,nt=!!ae.specularMap,Rt=!!ae.specularColorMap,Lt=!!ae.specularIntensityMap,Ot=Kt&&!!ae.transmissionMap,$=Kt&&!!ae.thicknessMap,Le=!!ae.gradientMap,rt=!!ae.alphaMap,wt=ae.alphaTest>0,se=!!ae.alphaHash,k=!!ae.extensions;let F=gl;ae.toneMapped&&(St===null||St.isXRRenderTarget===!0)&&(F=n.toneMapping);const j={shaderID:Ke,shaderType:ae.type,shaderName:ae.name,vertexShader:_n,fragmentShader:Ze,defines:ae.defines,customVertexShaderID:_t,customFragmentShaderID:Ct,isRawShaderMaterial:ae.isRawShaderMaterial===!0,glslVersion:ae.glslVersion,precision:L,batching:mn,instancing:un,instancingColor:un&&Te.instanceColor!==null,instancingMorph:un&&Te.morphTexture!==null,supportsVertexTextures:M,outputColorSpace:St===null?n.outputColorSpace:St.isXRRenderTarget===!0?St.texture.colorSpace:El,alphaToCoverage:!!ae.alphaToCoverage,map:yn,matcap:Fe,envMap:dn,envMapMode:dn&&st.mapping,envMapCubeUVHeight:Ce,aoMap:an,lightMap:Vn,bumpMap:Wt,normalMap:En,displacementMap:M&&J,emissiveMap:re,normalMapObjectSpace:En&&ae.normalMapType===hz,normalMapTangentSpace:En&&ae.normalMapType===uz,metalnessMap:Je,roughnessMap:Xe,anisotropy:at,anisotropyMap:rn,clearcoat:ft,clearcoatMap:Tt,clearcoatNormalMap:$t,clearcoatRoughnessMap:qe,iridescence:nn,iridescenceMap:Gt,iridescenceThicknessMap:Nt,sheen:mt,sheenColorMap:bn,sheenRoughnessMap:wn,specularMap:nt,specularColorMap:Rt,specularIntensityMap:Lt,transmission:Kt,transmissionMap:Ot,thicknessMap:$,gradientMap:Le,opaque:ae.transparent===!1&&ae.blending===lh&&ae.alphaToCoverage===!1,alphaMap:rt,alphaTest:wt,alphaHash:se,combine:ae.combine,mapUv:yn&&B(ae.map.channel),aoMapUv:an&&B(ae.aoMap.channel),lightMapUv:Vn&&B(ae.lightMap.channel),bumpMapUv:Wt&&B(ae.bumpMap.channel),normalMapUv:En&&B(ae.normalMap.channel),displacementMapUv:J&&B(ae.displacementMap.channel),emissiveMapUv:re&&B(ae.emissiveMap.channel),metalnessMapUv:Je&&B(ae.metalnessMap.channel),roughnessMapUv:Xe&&B(ae.roughnessMap.channel),anisotropyMapUv:rn&&B(ae.anisotropyMap.channel),clearcoatMapUv:Tt&&B(ae.clearcoatMap.channel),clearcoatNormalMapUv:$t&&B(ae.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:qe&&B(ae.clearcoatRoughnessMap.channel),iridescenceMapUv:Gt&&B(ae.iridescenceMap.channel),iridescenceThicknessMapUv:Nt&&B(ae.iridescenceThicknessMap.channel),sheenColorMapUv:bn&&B(ae.sheenColorMap.channel),sheenRoughnessMapUv:wn&&B(ae.sheenRoughnessMap.channel),specularMapUv:nt&&B(ae.specularMap.channel),specularColorMapUv:Rt&&B(ae.specularColorMap.channel),specularIntensityMapUv:Lt&&B(ae.specularIntensityMap.channel),transmissionMapUv:Ot&&B(ae.transmissionMap.channel),thicknessMapUv:$&&B(ae.thicknessMap.channel),alphaMapUv:rt&&B(ae.alphaMap.channel),vertexTangents:!!it.attributes.tangent&&(En||at),vertexColors:ae.vertexColors,vertexAlphas:ae.vertexColors===!0&&!!it.attributes.color&&it.attributes.color.itemSize===4,pointsUvs:Te.isPoints===!0&&!!it.attributes.uv&&(yn||rt),fog:!!je,useFog:ae.fog===!0,fogExp2:!!je&&je.isFogExp2,flatShading:ae.flatShading===!0,sizeAttenuation:ae.sizeAttenuation===!0,logarithmicDepthBuffer:E,skinning:Te.isSkinnedMesh===!0,morphTargets:it.morphAttributes.position!==void 0,morphNormals:it.morphAttributes.normal!==void 0,morphColors:it.morphAttributes.color!==void 0,morphTargetsCount:pt,morphTextureStride:kt,numDirLights:K.directional.length,numPointLights:K.point.length,numSpotLights:K.spot.length,numSpotLightMaps:K.spotLightMap.length,numRectAreaLights:K.rectArea.length,numHemiLights:K.hemi.length,numDirLightShadows:K.directionalShadowMap.length,numPointLightShadows:K.pointShadowMap.length,numSpotLightShadows:K.spotShadowMap.length,numSpotLightShadowsWithMaps:K.numSpotLightShadowsWithMaps,numLightProbes:K.numLightProbes,numClippingPlanes:f.numPlanes,numClipIntersection:f.numIntersection,dithering:ae.dithering,shadowMapEnabled:n.shadowMap.enabled&&Pe.length>0,shadowMapType:n.shadowMap.type,toneMapping:F,useLegacyLights:n._useLegacyLights,decodeVideoTexture:yn&&ae.map.isVideoTexture===!0&&ri.getTransfer(ae.map.colorSpace)===gi,premultipliedAlpha:ae.premultipliedAlpha,doubleSided:ae.side===to,flipSided:ae.side===jr,useDepthPacking:ae.depthPacking>=0,depthPacking:ae.depthPacking||0,index0AttributeName:ae.index0AttributeName,extensionClipCullDistance:k&&ae.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:k&&ae.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:ae.customProgramCacheKey()};return j.vertexUv1s=w.has(1),j.vertexUv2s=w.has(2),j.vertexUv3s=w.has(3),w.clear(),j}function R(ae){const K=[];if(ae.shaderID?K.push(ae.shaderID):(K.push(ae.customVertexShaderID),K.push(ae.customFragmentShaderID)),ae.defines!==void 0)for(const Pe in ae.defines)K.push(Pe),K.push(ae.defines[Pe]);return ae.isRawShaderMaterial===!1&&(G(K,ae),V(K,ae),K.push(n.outputColorSpace)),K.push(ae.customProgramCacheKey),K.join()}function G(ae,K){ae.push(K.precision),ae.push(K.outputColorSpace),ae.push(K.envMapMode),ae.push(K.envMapCubeUVHeight),ae.push(K.mapUv),ae.push(K.alphaMapUv),ae.push(K.lightMapUv),ae.push(K.aoMapUv),ae.push(K.bumpMapUv),ae.push(K.normalMapUv),ae.push(K.displacementMapUv),ae.push(K.emissiveMapUv),ae.push(K.metalnessMapUv),ae.push(K.roughnessMapUv),ae.push(K.anisotropyMapUv),ae.push(K.clearcoatMapUv),ae.push(K.clearcoatNormalMapUv),ae.push(K.clearcoatRoughnessMapUv),ae.push(K.iridescenceMapUv),ae.push(K.iridescenceThicknessMapUv),ae.push(K.sheenColorMapUv),ae.push(K.sheenRoughnessMapUv),ae.push(K.specularMapUv),ae.push(K.specularColorMapUv),ae.push(K.specularIntensityMapUv),ae.push(K.transmissionMapUv),ae.push(K.thicknessMapUv),ae.push(K.combine),ae.push(K.fogExp2),ae.push(K.sizeAttenuation),ae.push(K.morphTargetsCount),ae.push(K.morphAttributeCount),ae.push(K.numDirLights),ae.push(K.numPointLights),ae.push(K.numSpotLights),ae.push(K.numSpotLightMaps),ae.push(K.numHemiLights),ae.push(K.numRectAreaLights),ae.push(K.numDirLightShadows),ae.push(K.numPointLightShadows),ae.push(K.numSpotLightShadows),ae.push(K.numSpotLightShadowsWithMaps),ae.push(K.numLightProbes),ae.push(K.shadowMapType),ae.push(K.toneMapping),ae.push(K.numClippingPlanes),ae.push(K.numClipIntersection),ae.push(K.depthPacking)}function V(ae,K){c.disableAll(),K.supportsVertexTextures&&c.enable(0),K.instancing&&c.enable(1),K.instancingColor&&c.enable(2),K.instancingMorph&&c.enable(3),K.matcap&&c.enable(4),K.envMap&&c.enable(5),K.normalMapObjectSpace&&c.enable(6),K.normalMapTangentSpace&&c.enable(7),K.clearcoat&&c.enable(8),K.iridescence&&c.enable(9),K.alphaTest&&c.enable(10),K.vertexColors&&c.enable(11),K.vertexAlphas&&c.enable(12),K.vertexUv1s&&c.enable(13),K.vertexUv2s&&c.enable(14),K.vertexUv3s&&c.enable(15),K.vertexTangents&&c.enable(16),K.anisotropy&&c.enable(17),K.alphaHash&&c.enable(18),K.batching&&c.enable(19),ae.push(c.mask),c.disableAll(),K.fog&&c.enable(0),K.useFog&&c.enable(1),K.flatShading&&c.enable(2),K.logarithmicDepthBuffer&&c.enable(3),K.skinning&&c.enable(4),K.morphTargets&&c.enable(5),K.morphNormals&&c.enable(6),K.morphColors&&c.enable(7),K.premultipliedAlpha&&c.enable(8),K.shadowMapEnabled&&c.enable(9),K.useLegacyLights&&c.enable(10),K.doubleSided&&c.enable(11),K.flipSided&&c.enable(12),K.useDepthPacking&&c.enable(13),K.dithering&&c.enable(14),K.transmission&&c.enable(15),K.sheen&&c.enable(16),K.opaque&&c.enable(17),K.pointsUvs&&c.enable(18),K.decodeVideoTexture&&c.enable(19),K.alphaToCoverage&&c.enable(20),ae.push(c.mask)}function ee(ae){const K=U[ae.type];let Pe;if(K){const ke=va[K];Pe=tk.clone(ke.uniforms)}else Pe=ae.uniforms;return Pe}function fe(ae,K){let Pe;for(let ke=0,Te=S.length;ke<Te;ke++){const je=S[ke];if(je.cacheKey===K){Pe=je,++Pe.usedTimes;break}}return Pe===void 0&&(Pe=new mN(n,K,ae,h),S.push(Pe)),Pe}function Z(ae){if(--ae.usedTimes===0){const K=S.indexOf(ae);S[K]=S[S.length-1],S.pop(),ae.destroy()}}function te(ae){v.remove(ae)}function be(){v.dispose()}return{getParameters:z,getProgramCacheKey:R,getUniforms:ee,acquireProgram:fe,releaseProgram:Z,releaseShaderCache:te,programs:S,dispose:be}}function xN(){let n=new WeakMap;function e(h){let f=n.get(h);return f===void 0&&(f={},n.set(h,f)),f}function t(h){n.delete(h)}function i(h,f,c){n.get(h)[f]=c}function o(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:o}}function bN(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function UM(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function NM(){const n=[];let e=0;const t=[],i=[],o=[];function h(){e=0,t.length=0,i.length=0,o.length=0}function f(E,M,L,U,B,z){let R=n[e];return R===void 0?(R={id:E.id,object:E,geometry:M,material:L,groupOrder:U,renderOrder:E.renderOrder,z:B,group:z},n[e]=R):(R.id=E.id,R.object=E,R.geometry=M,R.material=L,R.groupOrder=U,R.renderOrder=E.renderOrder,R.z=B,R.group=z),e++,R}function c(E,M,L,U,B,z){const R=f(E,M,L,U,B,z);L.transmission>0?i.push(R):L.transparent===!0?o.push(R):t.push(R)}function v(E,M,L,U,B,z){const R=f(E,M,L,U,B,z);L.transmission>0?i.unshift(R):L.transparent===!0?o.unshift(R):t.unshift(R)}function w(E,M){t.length>1&&t.sort(E||bN),i.length>1&&i.sort(M||UM),o.length>1&&o.sort(M||UM)}function S(){for(let E=e,M=n.length;E<M;E++){const L=n[E];if(L.id===null)break;L.id=null,L.object=null,L.geometry=null,L.material=null,L.group=null}}return{opaque:t,transmissive:i,transparent:o,init:h,push:c,unshift:v,finish:S,sort:w}}function wN(){let n=new WeakMap;function e(i,o){const h=n.get(i);let f;return h===void 0?(f=new NM,n.set(i,[f])):o>=h.length?(f=new NM,h.push(f)):f=h[o],f}function t(){n=new WeakMap}return{get:e,dispose:t}}function SN(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new $e,color:new si};break;case"SpotLight":t={position:new $e,direction:new $e,color:new si,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new $e,color:new si,distance:0,decay:0};break;case"HemisphereLight":t={direction:new $e,skyColor:new si,groundColor:new si};break;case"RectAreaLight":t={color:new si,position:new $e,halfWidth:new $e,halfHeight:new $e};break}return n[e.id]=t,t}}}function MN(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pn};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pn};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Pn,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let TN=0;function EN(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function AN(n){const e=new SN,t=MN(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let w=0;w<9;w++)i.probe.push(new $e);const o=new $e,h=new Yi,f=new Yi;function c(w,S){let E=0,M=0,L=0;for(let Pe=0;Pe<9;Pe++)i.probe[Pe].set(0,0,0);let U=0,B=0,z=0,R=0,G=0,V=0,ee=0,fe=0,Z=0,te=0,be=0;w.sort(EN);const ae=S===!0?Math.PI:1;for(let Pe=0,ke=w.length;Pe<ke;Pe++){const Te=w[Pe],je=Te.color,it=Te.intensity,ut=Te.distance,st=Te.shadow&&Te.shadow.map?Te.shadow.map.texture:null;if(Te.isAmbientLight)E+=je.r*it*ae,M+=je.g*it*ae,L+=je.b*it*ae;else if(Te.isLightProbe){for(let Ce=0;Ce<9;Ce++)i.probe[Ce].addScaledVector(Te.sh.coefficients[Ce],it);be++}else if(Te.isDirectionalLight){const Ce=e.get(Te);if(Ce.color.copy(Te.color).multiplyScalar(Te.intensity*ae),Te.castShadow){const Ke=Te.shadow,Ye=t.get(Te);Ye.shadowBias=Ke.bias,Ye.shadowNormalBias=Ke.normalBias,Ye.shadowRadius=Ke.radius,Ye.shadowMapSize=Ke.mapSize,i.directionalShadow[U]=Ye,i.directionalShadowMap[U]=st,i.directionalShadowMatrix[U]=Te.shadow.matrix,V++}i.directional[U]=Ce,U++}else if(Te.isSpotLight){const Ce=e.get(Te);Ce.position.setFromMatrixPosition(Te.matrixWorld),Ce.color.copy(je).multiplyScalar(it*ae),Ce.distance=ut,Ce.coneCos=Math.cos(Te.angle),Ce.penumbraCos=Math.cos(Te.angle*(1-Te.penumbra)),Ce.decay=Te.decay,i.spot[z]=Ce;const Ke=Te.shadow;if(Te.map&&(i.spotLightMap[Z]=Te.map,Z++,Ke.updateMatrices(Te),Te.castShadow&&te++),i.spotLightMatrix[z]=Ke.matrix,Te.castShadow){const Ye=t.get(Te);Ye.shadowBias=Ke.bias,Ye.shadowNormalBias=Ke.normalBias,Ye.shadowRadius=Ke.radius,Ye.shadowMapSize=Ke.mapSize,i.spotShadow[z]=Ye,i.spotShadowMap[z]=st,fe++}z++}else if(Te.isRectAreaLight){const Ce=e.get(Te);Ce.color.copy(je).multiplyScalar(it),Ce.halfWidth.set(Te.width*.5,0,0),Ce.halfHeight.set(0,Te.height*.5,0),i.rectArea[R]=Ce,R++}else if(Te.isPointLight){const Ce=e.get(Te);if(Ce.color.copy(Te.color).multiplyScalar(Te.intensity*ae),Ce.distance=Te.distance,Ce.decay=Te.decay,Te.castShadow){const Ke=Te.shadow,Ye=t.get(Te);Ye.shadowBias=Ke.bias,Ye.shadowNormalBias=Ke.normalBias,Ye.shadowRadius=Ke.radius,Ye.shadowMapSize=Ke.mapSize,Ye.shadowCameraNear=Ke.camera.near,Ye.shadowCameraFar=Ke.camera.far,i.pointShadow[B]=Ye,i.pointShadowMap[B]=st,i.pointShadowMatrix[B]=Te.shadow.matrix,ee++}i.point[B]=Ce,B++}else if(Te.isHemisphereLight){const Ce=e.get(Te);Ce.skyColor.copy(Te.color).multiplyScalar(it*ae),Ce.groundColor.copy(Te.groundColor).multiplyScalar(it*ae),i.hemi[G]=Ce,G++}}R>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=Zt.LTC_FLOAT_1,i.rectAreaLTC2=Zt.LTC_FLOAT_2):(i.rectAreaLTC1=Zt.LTC_HALF_1,i.rectAreaLTC2=Zt.LTC_HALF_2)),i.ambient[0]=E,i.ambient[1]=M,i.ambient[2]=L;const K=i.hash;(K.directionalLength!==U||K.pointLength!==B||K.spotLength!==z||K.rectAreaLength!==R||K.hemiLength!==G||K.numDirectionalShadows!==V||K.numPointShadows!==ee||K.numSpotShadows!==fe||K.numSpotMaps!==Z||K.numLightProbes!==be)&&(i.directional.length=U,i.spot.length=z,i.rectArea.length=R,i.point.length=B,i.hemi.length=G,i.directionalShadow.length=V,i.directionalShadowMap.length=V,i.pointShadow.length=ee,i.pointShadowMap.length=ee,i.spotShadow.length=fe,i.spotShadowMap.length=fe,i.directionalShadowMatrix.length=V,i.pointShadowMatrix.length=ee,i.spotLightMatrix.length=fe+Z-te,i.spotLightMap.length=Z,i.numSpotLightShadowsWithMaps=te,i.numLightProbes=be,K.directionalLength=U,K.pointLength=B,K.spotLength=z,K.rectAreaLength=R,K.hemiLength=G,K.numDirectionalShadows=V,K.numPointShadows=ee,K.numSpotShadows=fe,K.numSpotMaps=Z,K.numLightProbes=be,i.version=TN++)}function v(w,S){let E=0,M=0,L=0,U=0,B=0;const z=S.matrixWorldInverse;for(let R=0,G=w.length;R<G;R++){const V=w[R];if(V.isDirectionalLight){const ee=i.directional[E];ee.direction.setFromMatrixPosition(V.matrixWorld),o.setFromMatrixPosition(V.target.matrixWorld),ee.direction.sub(o),ee.direction.transformDirection(z),E++}else if(V.isSpotLight){const ee=i.spot[L];ee.position.setFromMatrixPosition(V.matrixWorld),ee.position.applyMatrix4(z),ee.direction.setFromMatrixPosition(V.matrixWorld),o.setFromMatrixPosition(V.target.matrixWorld),ee.direction.sub(o),ee.direction.transformDirection(z),L++}else if(V.isRectAreaLight){const ee=i.rectArea[U];ee.position.setFromMatrixPosition(V.matrixWorld),ee.position.applyMatrix4(z),f.identity(),h.copy(V.matrixWorld),h.premultiply(z),f.extractRotation(h),ee.halfWidth.set(V.width*.5,0,0),ee.halfHeight.set(0,V.height*.5,0),ee.halfWidth.applyMatrix4(f),ee.halfHeight.applyMatrix4(f),U++}else if(V.isPointLight){const ee=i.point[M];ee.position.setFromMatrixPosition(V.matrixWorld),ee.position.applyMatrix4(z),M++}else if(V.isHemisphereLight){const ee=i.hemi[B];ee.direction.setFromMatrixPosition(V.matrixWorld),ee.direction.transformDirection(z),B++}}}return{setup:c,setupView:v,state:i}}function OM(n){const e=new AN(n),t=[],i=[];function o(){t.length=0,i.length=0}function h(S){t.push(S)}function f(S){i.push(S)}function c(S){e.setup(t,S)}function v(S){e.setupView(t,S)}return{init:o,state:{lightsArray:t,shadowsArray:i,lights:e,transmissionRenderTarget:null},setupLights:c,setupLightsView:v,pushLight:h,pushShadow:f}}function CN(n){let e=new WeakMap;function t(o,h=0){const f=e.get(o);let c;return f===void 0?(c=new OM(n),e.set(o,[c])):h>=f.length?(c=new OM(n),f.push(c)):c=f[h],c}function i(){e=new WeakMap}return{get:t,dispose:i}}class PN extends p_{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=lz,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class RN extends p_{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const IN=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,LN=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function DN(n,e,t){let i=new dA;const o=new Pn,h=new Pn,f=new dr,c=new PN({depthPacking:cz}),v=new RN,w={},S=t.maxTextureSize,E={[xl]:jr,[jr]:xl,[to]:to},M=new Ns({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Pn},radius:{value:4}},vertexShader:IN,fragmentShader:LN}),L=M.clone();L.defines.HORIZONTAL_PASS=1;const U=new Al;U.setAttribute("position",new Ta(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const B=new gs(U,M),z=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=G2;let R=this.type;this.render=function(Z,te,be){if(z.enabled===!1||z.autoUpdate===!1&&z.needsUpdate===!1||Z.length===0)return;const ae=n.getRenderTarget(),K=n.getActiveCubeFace(),Pe=n.getActiveMipmapLevel(),ke=n.state;ke.setBlending(ml),ke.buffers.color.setClear(1,1,1,1),ke.buffers.depth.setTest(!0),ke.setScissorTest(!1);const Te=R!==Ka&&this.type===Ka,je=R===Ka&&this.type!==Ka;for(let it=0,ut=Z.length;it<ut;it++){const st=Z[it],Ce=st.shadow;if(Ce===void 0){console.warn("THREE.WebGLShadowMap:",st,"has no shadow.");continue}if(Ce.autoUpdate===!1&&Ce.needsUpdate===!1)continue;o.copy(Ce.mapSize);const Ke=Ce.getFrameExtents();if(o.multiply(Ke),h.copy(Ce.mapSize),(o.x>S||o.y>S)&&(o.x>S&&(h.x=Math.floor(S/Ke.x),o.x=h.x*Ke.x,Ce.mapSize.x=h.x),o.y>S&&(h.y=Math.floor(S/Ke.y),o.y=h.y*Ke.y,Ce.mapSize.y=h.y)),Ce.map===null||Te===!0||je===!0){const pt=this.type!==Ka?{minFilter:Us,magFilter:Us}:{};Ce.map!==null&&Ce.map.dispose(),Ce.map=new wc(o.x,o.y,pt),Ce.map.texture.name=st.name+".shadowMap",Ce.camera.updateProjectionMatrix()}n.setRenderTarget(Ce.map),n.clear();const Ye=Ce.getViewportCount();for(let pt=0;pt<Ye;pt++){const kt=Ce.getViewport(pt);f.set(h.x*kt.x,h.y*kt.y,h.x*kt.z,h.y*kt.w),ke.viewport(f),Ce.updateMatrices(st,pt),i=Ce.getFrustum(),ee(te,be,Ce.camera,st,this.type)}Ce.isPointLightShadow!==!0&&this.type===Ka&&G(Ce,be),Ce.needsUpdate=!1}R=this.type,z.needsUpdate=!1,n.setRenderTarget(ae,K,Pe)};function G(Z,te){const be=e.update(B);M.defines.VSM_SAMPLES!==Z.blurSamples&&(M.defines.VSM_SAMPLES=Z.blurSamples,L.defines.VSM_SAMPLES=Z.blurSamples,M.needsUpdate=!0,L.needsUpdate=!0),Z.mapPass===null&&(Z.mapPass=new wc(o.x,o.y)),M.uniforms.shadow_pass.value=Z.map.texture,M.uniforms.resolution.value=Z.mapSize,M.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.mapPass),n.clear(),n.renderBufferDirect(te,null,be,M,B,null),L.uniforms.shadow_pass.value=Z.mapPass.texture,L.uniforms.resolution.value=Z.mapSize,L.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.map),n.clear(),n.renderBufferDirect(te,null,be,L,B,null)}function V(Z,te,be,ae){let K=null;const Pe=be.isPointLight===!0?Z.customDistanceMaterial:Z.customDepthMaterial;if(Pe!==void 0)K=Pe;else if(K=be.isPointLight===!0?v:c,n.localClippingEnabled&&te.clipShadows===!0&&Array.isArray(te.clippingPlanes)&&te.clippingPlanes.length!==0||te.displacementMap&&te.displacementScale!==0||te.alphaMap&&te.alphaTest>0||te.map&&te.alphaTest>0){const ke=K.uuid,Te=te.uuid;let je=w[ke];je===void 0&&(je={},w[ke]=je);let it=je[Te];it===void 0&&(it=K.clone(),je[Te]=it,te.addEventListener("dispose",fe)),K=it}if(K.visible=te.visible,K.wireframe=te.wireframe,ae===Ka?K.side=te.shadowSide!==null?te.shadowSide:te.side:K.side=te.shadowSide!==null?te.shadowSide:E[te.side],K.alphaMap=te.alphaMap,K.alphaTest=te.alphaTest,K.map=te.map,K.clipShadows=te.clipShadows,K.clippingPlanes=te.clippingPlanes,K.clipIntersection=te.clipIntersection,K.displacementMap=te.displacementMap,K.displacementScale=te.displacementScale,K.displacementBias=te.displacementBias,K.wireframeLinewidth=te.wireframeLinewidth,K.linewidth=te.linewidth,be.isPointLight===!0&&K.isMeshDistanceMaterial===!0){const ke=n.properties.get(K);ke.light=be}return K}function ee(Z,te,be,ae,K){if(Z.visible===!1)return;if(Z.layers.test(te.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&K===Ka)&&(!Z.frustumCulled||i.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(be.matrixWorldInverse,Z.matrixWorld);const Te=e.update(Z),je=Z.material;if(Array.isArray(je)){const it=Te.groups;for(let ut=0,st=it.length;ut<st;ut++){const Ce=it[ut],Ke=je[Ce.materialIndex];if(Ke&&Ke.visible){const Ye=V(Z,Ke,ae,K);Z.onBeforeShadow(n,Z,te,be,Te,Ye,Ce),n.renderBufferDirect(be,null,Te,Ye,Z,Ce),Z.onAfterShadow(n,Z,te,be,Te,Ye,Ce)}}}else if(je.visible){const it=V(Z,je,ae,K);Z.onBeforeShadow(n,Z,te,be,Te,it,null),n.renderBufferDirect(be,null,Te,it,Z,null),Z.onAfterShadow(n,Z,te,be,Te,it,null)}}const ke=Z.children;for(let Te=0,je=ke.length;Te<je;Te++)ee(ke[Te],te,be,ae,K)}function fe(Z){Z.target.removeEventListener("dispose",fe);for(const be in w){const ae=w[be],K=Z.target.uuid;K in ae&&(ae[K].dispose(),delete ae[K])}}}function zN(n){function e(){let $=!1;const Le=new dr;let rt=null;const wt=new dr(0,0,0,0);return{setMask:function(se){rt!==se&&!$&&(n.colorMask(se,se,se,se),rt=se)},setLocked:function(se){$=se},setClear:function(se,k,F,j,Y){Y===!0&&(se*=j,k*=j,F*=j),Le.set(se,k,F,j),wt.equals(Le)===!1&&(n.clearColor(se,k,F,j),wt.copy(Le))},reset:function(){$=!1,rt=null,wt.set(-1,0,0,0)}}}function t(){let $=!1,Le=null,rt=null,wt=null;return{setTest:function(se){se?Ct(n.DEPTH_TEST):St(n.DEPTH_TEST)},setMask:function(se){Le!==se&&!$&&(n.depthMask(se),Le=se)},setFunc:function(se){if(rt!==se){switch(se){case k3:n.depthFunc(n.NEVER);break;case F3:n.depthFunc(n.ALWAYS);break;case U3:n.depthFunc(n.LESS);break;case Bg:n.depthFunc(n.LEQUAL);break;case N3:n.depthFunc(n.EQUAL);break;case O3:n.depthFunc(n.GEQUAL);break;case B3:n.depthFunc(n.GREATER);break;case V3:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}rt=se}},setLocked:function(se){$=se},setClear:function(se){wt!==se&&(n.clearDepth(se),wt=se)},reset:function(){$=!1,Le=null,rt=null,wt=null}}}function i(){let $=!1,Le=null,rt=null,wt=null,se=null,k=null,F=null,j=null,Y=null;return{setTest:function(ue){$||(ue?Ct(n.STENCIL_TEST):St(n.STENCIL_TEST))},setMask:function(ue){Le!==ue&&!$&&(n.stencilMask(ue),Le=ue)},setFunc:function(ue,ye,xe){(rt!==ue||wt!==ye||se!==xe)&&(n.stencilFunc(ue,ye,xe),rt=ue,wt=ye,se=xe)},setOp:function(ue,ye,xe){(k!==ue||F!==ye||j!==xe)&&(n.stencilOp(ue,ye,xe),k=ue,F=ye,j=xe)},setLocked:function(ue){$=ue},setClear:function(ue){Y!==ue&&(n.clearStencil(ue),Y=ue)},reset:function(){$=!1,Le=null,rt=null,wt=null,se=null,k=null,F=null,j=null,Y=null}}}const o=new e,h=new t,f=new i,c=new WeakMap,v=new WeakMap;let w={},S={},E=new WeakMap,M=[],L=null,U=!1,B=null,z=null,R=null,G=null,V=null,ee=null,fe=null,Z=new si(0,0,0),te=0,be=!1,ae=null,K=null,Pe=null,ke=null,Te=null;const je=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let it=!1,ut=0;const st=n.getParameter(n.VERSION);st.indexOf("WebGL")!==-1?(ut=parseFloat(/^WebGL (\d)/.exec(st)[1]),it=ut>=1):st.indexOf("OpenGL ES")!==-1&&(ut=parseFloat(/^OpenGL ES (\d)/.exec(st)[1]),it=ut>=2);let Ce=null,Ke={};const Ye=n.getParameter(n.SCISSOR_BOX),pt=n.getParameter(n.VIEWPORT),kt=new dr().fromArray(Ye),_n=new dr().fromArray(pt);function Ze($,Le,rt,wt){const se=new Uint8Array(4),k=n.createTexture();n.bindTexture($,k),n.texParameteri($,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri($,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let F=0;F<rt;F++)$===n.TEXTURE_3D||$===n.TEXTURE_2D_ARRAY?n.texImage3D(Le,0,n.RGBA,1,1,wt,0,n.RGBA,n.UNSIGNED_BYTE,se):n.texImage2D(Le+F,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,se);return k}const _t={};_t[n.TEXTURE_2D]=Ze(n.TEXTURE_2D,n.TEXTURE_2D,1),_t[n.TEXTURE_CUBE_MAP]=Ze(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),_t[n.TEXTURE_2D_ARRAY]=Ze(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),_t[n.TEXTURE_3D]=Ze(n.TEXTURE_3D,n.TEXTURE_3D,1,1),o.setClear(0,0,0,1),h.setClear(1),f.setClear(0),Ct(n.DEPTH_TEST),h.setFunc(Bg),Wt(!1),En(xS),Ct(n.CULL_FACE),an(ml);function Ct($){w[$]!==!0&&(n.enable($),w[$]=!0)}function St($){w[$]!==!1&&(n.disable($),w[$]=!1)}function un($,Le){return S[$]!==Le?(n.bindFramebuffer($,Le),S[$]=Le,$===n.DRAW_FRAMEBUFFER&&(S[n.FRAMEBUFFER]=Le),$===n.FRAMEBUFFER&&(S[n.DRAW_FRAMEBUFFER]=Le),!0):!1}function mn($,Le){let rt=M,wt=!1;if($){rt=E.get(Le),rt===void 0&&(rt=[],E.set(Le,rt));const se=$.textures;if(rt.length!==se.length||rt[0]!==n.COLOR_ATTACHMENT0){for(let k=0,F=se.length;k<F;k++)rt[k]=n.COLOR_ATTACHMENT0+k;rt.length=se.length,wt=!0}}else rt[0]!==n.BACK&&(rt[0]=n.BACK,wt=!0);wt&&n.drawBuffers(rt)}function yn($){return L!==$?(n.useProgram($),L=$,!0):!1}const Fe={[sc]:n.FUNC_ADD,[y3]:n.FUNC_SUBTRACT,[v3]:n.FUNC_REVERSE_SUBTRACT};Fe[x3]=n.MIN,Fe[b3]=n.MAX;const dn={[w3]:n.ZERO,[S3]:n.ONE,[M3]:n.SRC_COLOR,[kv]:n.SRC_ALPHA,[R3]:n.SRC_ALPHA_SATURATE,[C3]:n.DST_COLOR,[E3]:n.DST_ALPHA,[T3]:n.ONE_MINUS_SRC_COLOR,[Fv]:n.ONE_MINUS_SRC_ALPHA,[P3]:n.ONE_MINUS_DST_COLOR,[A3]:n.ONE_MINUS_DST_ALPHA,[I3]:n.CONSTANT_COLOR,[L3]:n.ONE_MINUS_CONSTANT_COLOR,[D3]:n.CONSTANT_ALPHA,[z3]:n.ONE_MINUS_CONSTANT_ALPHA};function an($,Le,rt,wt,se,k,F,j,Y,ue){if($===ml){U===!0&&(St(n.BLEND),U=!1);return}if(U===!1&&(Ct(n.BLEND),U=!0),$!==_3){if($!==B||ue!==be){if((z!==sc||V!==sc)&&(n.blendEquation(n.FUNC_ADD),z=sc,V=sc),ue)switch($){case lh:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bS:n.blendFunc(n.ONE,n.ONE);break;case wS:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case SS:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}else switch($){case lh:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case bS:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case wS:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case SS:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",$);break}R=null,G=null,ee=null,fe=null,Z.set(0,0,0),te=0,B=$,be=ue}return}se=se||Le,k=k||rt,F=F||wt,(Le!==z||se!==V)&&(n.blendEquationSeparate(Fe[Le],Fe[se]),z=Le,V=se),(rt!==R||wt!==G||k!==ee||F!==fe)&&(n.blendFuncSeparate(dn[rt],dn[wt],dn[k],dn[F]),R=rt,G=wt,ee=k,fe=F),(j.equals(Z)===!1||Y!==te)&&(n.blendColor(j.r,j.g,j.b,Y),Z.copy(j),te=Y),B=$,be=!1}function Vn($,Le){$.side===to?St(n.CULL_FACE):Ct(n.CULL_FACE);let rt=$.side===jr;Le&&(rt=!rt),Wt(rt),$.blending===lh&&$.transparent===!1?an(ml):an($.blending,$.blendEquation,$.blendSrc,$.blendDst,$.blendEquationAlpha,$.blendSrcAlpha,$.blendDstAlpha,$.blendColor,$.blendAlpha,$.premultipliedAlpha),h.setFunc($.depthFunc),h.setTest($.depthTest),h.setMask($.depthWrite),o.setMask($.colorWrite);const wt=$.stencilWrite;f.setTest(wt),wt&&(f.setMask($.stencilWriteMask),f.setFunc($.stencilFunc,$.stencilRef,$.stencilFuncMask),f.setOp($.stencilFail,$.stencilZFail,$.stencilZPass)),re($.polygonOffset,$.polygonOffsetFactor,$.polygonOffsetUnits),$.alphaToCoverage===!0?Ct(n.SAMPLE_ALPHA_TO_COVERAGE):St(n.SAMPLE_ALPHA_TO_COVERAGE)}function Wt($){ae!==$&&($?n.frontFace(n.CW):n.frontFace(n.CCW),ae=$)}function En($){$!==p3?(Ct(n.CULL_FACE),$!==K&&($===xS?n.cullFace(n.BACK):$===m3?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):St(n.CULL_FACE),K=$}function J($){$!==Pe&&(it&&n.lineWidth($),Pe=$)}function re($,Le,rt){$?(Ct(n.POLYGON_OFFSET_FILL),(ke!==Le||Te!==rt)&&(n.polygonOffset(Le,rt),ke=Le,Te=rt)):St(n.POLYGON_OFFSET_FILL)}function Je($){$?Ct(n.SCISSOR_TEST):St(n.SCISSOR_TEST)}function Xe($){$===void 0&&($=n.TEXTURE0+je-1),Ce!==$&&(n.activeTexture($),Ce=$)}function at($,Le,rt){rt===void 0&&(Ce===null?rt=n.TEXTURE0+je-1:rt=Ce);let wt=Ke[rt];wt===void 0&&(wt={type:void 0,texture:void 0},Ke[rt]=wt),(wt.type!==$||wt.texture!==Le)&&(Ce!==rt&&(n.activeTexture(rt),Ce=rt),n.bindTexture($,Le||_t[$]),wt.type=$,wt.texture=Le)}function ft(){const $=Ke[Ce];$!==void 0&&$.type!==void 0&&(n.bindTexture($.type,null),$.type=void 0,$.texture=void 0)}function nn(){try{n.compressedTexImage2D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function mt(){try{n.compressedTexImage3D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Kt(){try{n.texSubImage2D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function rn(){try{n.texSubImage3D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Tt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function $t(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function qe(){try{n.texStorage2D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Gt(){try{n.texStorage3D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function Nt(){try{n.texImage2D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function bn(){try{n.texImage3D.apply(n,arguments)}catch($){console.error("THREE.WebGLState:",$)}}function wn($){kt.equals($)===!1&&(n.scissor($.x,$.y,$.z,$.w),kt.copy($))}function nt($){_n.equals($)===!1&&(n.viewport($.x,$.y,$.z,$.w),_n.copy($))}function Rt($,Le){let rt=v.get(Le);rt===void 0&&(rt=new WeakMap,v.set(Le,rt));let wt=rt.get($);wt===void 0&&(wt=n.getUniformBlockIndex(Le,$.name),rt.set($,wt))}function Lt($,Le){const wt=v.get(Le).get($);c.get(Le)!==wt&&(n.uniformBlockBinding(Le,wt,$.__bindingPointIndex),c.set(Le,wt))}function Ot(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),w={},Ce=null,Ke={},S={},E=new WeakMap,M=[],L=null,U=!1,B=null,z=null,R=null,G=null,V=null,ee=null,fe=null,Z=new si(0,0,0),te=0,be=!1,ae=null,K=null,Pe=null,ke=null,Te=null,kt.set(0,0,n.canvas.width,n.canvas.height),_n.set(0,0,n.canvas.width,n.canvas.height),o.reset(),h.reset(),f.reset()}return{buffers:{color:o,depth:h,stencil:f},enable:Ct,disable:St,bindFramebuffer:un,drawBuffers:mn,useProgram:yn,setBlending:an,setMaterial:Vn,setFlipSided:Wt,setCullFace:En,setLineWidth:J,setPolygonOffset:re,setScissorTest:Je,activeTexture:Xe,bindTexture:at,unbindTexture:ft,compressedTexImage2D:nn,compressedTexImage3D:mt,texImage2D:Nt,texImage3D:bn,updateUBOMapping:Rt,uniformBlockBinding:Lt,texStorage2D:qe,texStorage3D:Gt,texSubImage2D:Kt,texSubImage3D:rn,compressedTexSubImage2D:Tt,compressedTexSubImage3D:$t,scissor:wn,viewport:nt,reset:Ot}}function kN(n,e,t,i,o,h,f){const c=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,v=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),w=new Pn,S=new WeakMap;let E;const M=new WeakMap;let L=!1;try{L=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function U(J,re){return L?new OffscreenCanvas(J,re):Gf("canvas")}function B(J,re,Je){let Xe=1;const at=En(J);if((at.width>Je||at.height>Je)&&(Xe=Je/Math.max(at.width,at.height)),Xe<1)if(typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&J instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&J instanceof ImageBitmap||typeof VideoFrame<"u"&&J instanceof VideoFrame){const ft=Math.floor(Xe*at.width),nn=Math.floor(Xe*at.height);E===void 0&&(E=U(ft,nn));const mt=re?U(ft,nn):E;return mt.width=ft,mt.height=nn,mt.getContext("2d").drawImage(J,0,0,ft,nn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+at.width+"x"+at.height+") to ("+ft+"x"+nn+")."),mt}else return"data"in J&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+at.width+"x"+at.height+")."),J;return J}function z(J){return J.generateMipmaps&&J.minFilter!==Us&&J.minFilter!==ia}function R(J){n.generateMipmap(J)}function G(J,re,Je,Xe,at=!1){if(J!==null){if(n[J]!==void 0)return n[J];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+J+"'")}let ft=re;if(re===n.RED&&(Je===n.FLOAT&&(ft=n.R32F),Je===n.HALF_FLOAT&&(ft=n.R16F),Je===n.UNSIGNED_BYTE&&(ft=n.R8)),re===n.RED_INTEGER&&(Je===n.UNSIGNED_BYTE&&(ft=n.R8UI),Je===n.UNSIGNED_SHORT&&(ft=n.R16UI),Je===n.UNSIGNED_INT&&(ft=n.R32UI),Je===n.BYTE&&(ft=n.R8I),Je===n.SHORT&&(ft=n.R16I),Je===n.INT&&(ft=n.R32I)),re===n.RG&&(Je===n.FLOAT&&(ft=n.RG32F),Je===n.HALF_FLOAT&&(ft=n.RG16F),Je===n.UNSIGNED_BYTE&&(ft=n.RG8)),re===n.RG_INTEGER&&(Je===n.UNSIGNED_BYTE&&(ft=n.RG8UI),Je===n.UNSIGNED_SHORT&&(ft=n.RG16UI),Je===n.UNSIGNED_INT&&(ft=n.RG32UI),Je===n.BYTE&&(ft=n.RG8I),Je===n.SHORT&&(ft=n.RG16I),Je===n.INT&&(ft=n.RG32I)),re===n.RGB&&Je===n.UNSIGNED_INT_5_9_9_9_REV&&(ft=n.RGB9_E5),re===n.RGBA){const nn=at?Gg:ri.getTransfer(Xe);Je===n.FLOAT&&(ft=n.RGBA32F),Je===n.HALF_FLOAT&&(ft=n.RGBA16F),Je===n.UNSIGNED_BYTE&&(ft=nn===gi?n.SRGB8_ALPHA8:n.RGBA8),Je===n.UNSIGNED_SHORT_4_4_4_4&&(ft=n.RGBA4),Je===n.UNSIGNED_SHORT_5_5_5_1&&(ft=n.RGB5_A1)}return(ft===n.R16F||ft===n.R32F||ft===n.RG16F||ft===n.RG32F||ft===n.RGBA16F||ft===n.RGBA32F)&&e.get("EXT_color_buffer_float"),ft}function V(J,re){return z(J)===!0||J.isFramebufferTexture&&J.minFilter!==Us&&J.minFilter!==ia?Math.log2(Math.max(re.width,re.height))+1:J.mipmaps!==void 0&&J.mipmaps.length>0?J.mipmaps.length:J.isCompressedTexture&&Array.isArray(J.image)?re.mipmaps.length:1}function ee(J){const re=J.target;re.removeEventListener("dispose",ee),Z(re),re.isVideoTexture&&S.delete(re)}function fe(J){const re=J.target;re.removeEventListener("dispose",fe),be(re)}function Z(J){const re=i.get(J);if(re.__webglInit===void 0)return;const Je=J.source,Xe=M.get(Je);if(Xe){const at=Xe[re.__cacheKey];at.usedTimes--,at.usedTimes===0&&te(J),Object.keys(Xe).length===0&&M.delete(Je)}i.remove(J)}function te(J){const re=i.get(J);n.deleteTexture(re.__webglTexture);const Je=J.source,Xe=M.get(Je);delete Xe[re.__cacheKey],f.memory.textures--}function be(J){const re=i.get(J);if(J.depthTexture&&J.depthTexture.dispose(),J.isWebGLCubeRenderTarget)for(let Xe=0;Xe<6;Xe++){if(Array.isArray(re.__webglFramebuffer[Xe]))for(let at=0;at<re.__webglFramebuffer[Xe].length;at++)n.deleteFramebuffer(re.__webglFramebuffer[Xe][at]);else n.deleteFramebuffer(re.__webglFramebuffer[Xe]);re.__webglDepthbuffer&&n.deleteRenderbuffer(re.__webglDepthbuffer[Xe])}else{if(Array.isArray(re.__webglFramebuffer))for(let Xe=0;Xe<re.__webglFramebuffer.length;Xe++)n.deleteFramebuffer(re.__webglFramebuffer[Xe]);else n.deleteFramebuffer(re.__webglFramebuffer);if(re.__webglDepthbuffer&&n.deleteRenderbuffer(re.__webglDepthbuffer),re.__webglMultisampledFramebuffer&&n.deleteFramebuffer(re.__webglMultisampledFramebuffer),re.__webglColorRenderbuffer)for(let Xe=0;Xe<re.__webglColorRenderbuffer.length;Xe++)re.__webglColorRenderbuffer[Xe]&&n.deleteRenderbuffer(re.__webglColorRenderbuffer[Xe]);re.__webglDepthRenderbuffer&&n.deleteRenderbuffer(re.__webglDepthRenderbuffer)}const Je=J.textures;for(let Xe=0,at=Je.length;Xe<at;Xe++){const ft=i.get(Je[Xe]);ft.__webglTexture&&(n.deleteTexture(ft.__webglTexture),f.memory.textures--),i.remove(Je[Xe])}i.remove(J)}let ae=0;function K(){ae=0}function Pe(){const J=ae;return J>=o.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+J+" texture units while this GPU supports only "+o.maxTextures),ae+=1,J}function ke(J){const re=[];return re.push(J.wrapS),re.push(J.wrapT),re.push(J.wrapR||0),re.push(J.magFilter),re.push(J.minFilter),re.push(J.anisotropy),re.push(J.internalFormat),re.push(J.format),re.push(J.type),re.push(J.generateMipmaps),re.push(J.premultiplyAlpha),re.push(J.flipY),re.push(J.unpackAlignment),re.push(J.colorSpace),re.join()}function Te(J,re){const Je=i.get(J);if(J.isVideoTexture&&Vn(J),J.isRenderTargetTexture===!1&&J.version>0&&Je.__version!==J.version){const Xe=J.image;if(Xe===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Xe.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{kt(Je,J,re);return}}t.bindTexture(n.TEXTURE_2D,Je.__webglTexture,n.TEXTURE0+re)}function je(J,re){const Je=i.get(J);if(J.version>0&&Je.__version!==J.version){kt(Je,J,re);return}t.bindTexture(n.TEXTURE_2D_ARRAY,Je.__webglTexture,n.TEXTURE0+re)}function it(J,re){const Je=i.get(J);if(J.version>0&&Je.__version!==J.version){kt(Je,J,re);return}t.bindTexture(n.TEXTURE_3D,Je.__webglTexture,n.TEXTURE0+re)}function ut(J,re){const Je=i.get(J);if(J.version>0&&Je.__version!==J.version){_n(Je,J,re);return}t.bindTexture(n.TEXTURE_CUBE_MAP,Je.__webglTexture,n.TEXTURE0+re)}const st={[Ov]:n.REPEAT,[dc]:n.CLAMP_TO_EDGE,[Bv]:n.MIRRORED_REPEAT},Ce={[Us]:n.NEAREST,[K3]:n.NEAREST_MIPMAP_NEAREST,[Rm]:n.NEAREST_MIPMAP_LINEAR,[ia]:n.LINEAR,[n0]:n.LINEAR_MIPMAP_NEAREST,[fc]:n.LINEAR_MIPMAP_LINEAR},Ke={[dz]:n.NEVER,[yz]:n.ALWAYS,[fz]:n.LESS,[Q2]:n.LEQUAL,[pz]:n.EQUAL,[_z]:n.GEQUAL,[mz]:n.GREATER,[gz]:n.NOTEQUAL};function Ye(J,re){if(re.type===al&&e.has("OES_texture_float_linear")===!1&&(re.magFilter===ia||re.magFilter===n0||re.magFilter===Rm||re.magFilter===fc||re.minFilter===ia||re.minFilter===n0||re.minFilter===Rm||re.minFilter===fc)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(J,n.TEXTURE_WRAP_S,st[re.wrapS]),n.texParameteri(J,n.TEXTURE_WRAP_T,st[re.wrapT]),(J===n.TEXTURE_3D||J===n.TEXTURE_2D_ARRAY)&&n.texParameteri(J,n.TEXTURE_WRAP_R,st[re.wrapR]),n.texParameteri(J,n.TEXTURE_MAG_FILTER,Ce[re.magFilter]),n.texParameteri(J,n.TEXTURE_MIN_FILTER,Ce[re.minFilter]),re.compareFunction&&(n.texParameteri(J,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(J,n.TEXTURE_COMPARE_FUNC,Ke[re.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(re.magFilter===Us||re.minFilter!==Rm&&re.minFilter!==fc||re.type===al&&e.has("OES_texture_float_linear")===!1)return;if(re.anisotropy>1||i.get(re).__currentAnisotropy){const Je=e.get("EXT_texture_filter_anisotropic");n.texParameterf(J,Je.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(re.anisotropy,o.getMaxAnisotropy())),i.get(re).__currentAnisotropy=re.anisotropy}}}function pt(J,re){let Je=!1;J.__webglInit===void 0&&(J.__webglInit=!0,re.addEventListener("dispose",ee));const Xe=re.source;let at=M.get(Xe);at===void 0&&(at={},M.set(Xe,at));const ft=ke(re);if(ft!==J.__cacheKey){at[ft]===void 0&&(at[ft]={texture:n.createTexture(),usedTimes:0},f.memory.textures++,Je=!0),at[ft].usedTimes++;const nn=at[J.__cacheKey];nn!==void 0&&(at[J.__cacheKey].usedTimes--,nn.usedTimes===0&&te(re)),J.__cacheKey=ft,J.__webglTexture=at[ft].texture}return Je}function kt(J,re,Je){let Xe=n.TEXTURE_2D;(re.isDataArrayTexture||re.isCompressedArrayTexture)&&(Xe=n.TEXTURE_2D_ARRAY),re.isData3DTexture&&(Xe=n.TEXTURE_3D);const at=pt(J,re),ft=re.source;t.bindTexture(Xe,J.__webglTexture,n.TEXTURE0+Je);const nn=i.get(ft);if(ft.version!==nn.__version||at===!0){t.activeTexture(n.TEXTURE0+Je);const mt=ri.getPrimaries(ri.workingColorSpace),Kt=re.colorSpace===il?null:ri.getPrimaries(re.colorSpace),rn=re.colorSpace===il||mt===Kt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,re.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,re.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,rn);let Tt=B(re.image,!1,o.maxTextureSize);Tt=Wt(re,Tt);const $t=h.convert(re.format,re.colorSpace),qe=h.convert(re.type);let Gt=G(re.internalFormat,$t,qe,re.colorSpace,re.isVideoTexture);Ye(Xe,re);let Nt;const bn=re.mipmaps,wn=re.isVideoTexture!==!0&&Gt!==J2,nt=nn.__version===void 0||at===!0,Rt=ft.dataReady,Lt=V(re,Tt);if(re.isDepthTexture)Gt=n.DEPTH_COMPONENT16,re.type===al?Gt=n.DEPTH_COMPONENT32F:re.type===Mh?Gt=n.DEPTH_COMPONENT24:re.type===ep&&(Gt=n.DEPTH24_STENCIL8),nt&&(wn?t.texStorage2D(n.TEXTURE_2D,1,Gt,Tt.width,Tt.height):t.texImage2D(n.TEXTURE_2D,0,Gt,Tt.width,Tt.height,0,$t,qe,null));else if(re.isDataTexture)if(bn.length>0){wn&&nt&&t.texStorage2D(n.TEXTURE_2D,Lt,Gt,bn[0].width,bn[0].height);for(let Ot=0,$=bn.length;Ot<$;Ot++)Nt=bn[Ot],wn?Rt&&t.texSubImage2D(n.TEXTURE_2D,Ot,0,0,Nt.width,Nt.height,$t,qe,Nt.data):t.texImage2D(n.TEXTURE_2D,Ot,Gt,Nt.width,Nt.height,0,$t,qe,Nt.data);re.generateMipmaps=!1}else wn?(nt&&t.texStorage2D(n.TEXTURE_2D,Lt,Gt,Tt.width,Tt.height),Rt&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Tt.width,Tt.height,$t,qe,Tt.data)):t.texImage2D(n.TEXTURE_2D,0,Gt,Tt.width,Tt.height,0,$t,qe,Tt.data);else if(re.isCompressedTexture)if(re.isCompressedArrayTexture){wn&&nt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,Gt,bn[0].width,bn[0].height,Tt.depth);for(let Ot=0,$=bn.length;Ot<$;Ot++)Nt=bn[Ot],re.format!==wa?$t!==null?wn?Rt&&t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Ot,0,0,0,Nt.width,Nt.height,Tt.depth,$t,Nt.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Ot,Gt,Nt.width,Nt.height,Tt.depth,0,Nt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):wn?Rt&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Ot,0,0,0,Nt.width,Nt.height,Tt.depth,$t,qe,Nt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Ot,Gt,Nt.width,Nt.height,Tt.depth,0,$t,qe,Nt.data)}else{wn&&nt&&t.texStorage2D(n.TEXTURE_2D,Lt,Gt,bn[0].width,bn[0].height);for(let Ot=0,$=bn.length;Ot<$;Ot++)Nt=bn[Ot],re.format!==wa?$t!==null?wn?Rt&&t.compressedTexSubImage2D(n.TEXTURE_2D,Ot,0,0,Nt.width,Nt.height,$t,Nt.data):t.compressedTexImage2D(n.TEXTURE_2D,Ot,Gt,Nt.width,Nt.height,0,Nt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):wn?Rt&&t.texSubImage2D(n.TEXTURE_2D,Ot,0,0,Nt.width,Nt.height,$t,qe,Nt.data):t.texImage2D(n.TEXTURE_2D,Ot,Gt,Nt.width,Nt.height,0,$t,qe,Nt.data)}else if(re.isDataArrayTexture)wn?(nt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,Lt,Gt,Tt.width,Tt.height,Tt.depth),Rt&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Tt.width,Tt.height,Tt.depth,$t,qe,Tt.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,Gt,Tt.width,Tt.height,Tt.depth,0,$t,qe,Tt.data);else if(re.isData3DTexture)wn?(nt&&t.texStorage3D(n.TEXTURE_3D,Lt,Gt,Tt.width,Tt.height,Tt.depth),Rt&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Tt.width,Tt.height,Tt.depth,$t,qe,Tt.data)):t.texImage3D(n.TEXTURE_3D,0,Gt,Tt.width,Tt.height,Tt.depth,0,$t,qe,Tt.data);else if(re.isFramebufferTexture){if(nt)if(wn)t.texStorage2D(n.TEXTURE_2D,Lt,Gt,Tt.width,Tt.height);else{let Ot=Tt.width,$=Tt.height;for(let Le=0;Le<Lt;Le++)t.texImage2D(n.TEXTURE_2D,Le,Gt,Ot,$,0,$t,qe,null),Ot>>=1,$>>=1}}else if(bn.length>0){if(wn&&nt){const Ot=En(bn[0]);t.texStorage2D(n.TEXTURE_2D,Lt,Gt,Ot.width,Ot.height)}for(let Ot=0,$=bn.length;Ot<$;Ot++)Nt=bn[Ot],wn?Rt&&t.texSubImage2D(n.TEXTURE_2D,Ot,0,0,$t,qe,Nt):t.texImage2D(n.TEXTURE_2D,Ot,Gt,$t,qe,Nt);re.generateMipmaps=!1}else if(wn){if(nt){const Ot=En(Tt);t.texStorage2D(n.TEXTURE_2D,Lt,Gt,Ot.width,Ot.height)}Rt&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,$t,qe,Tt)}else t.texImage2D(n.TEXTURE_2D,0,Gt,$t,qe,Tt);z(re)&&R(Xe),nn.__version=ft.version,re.onUpdate&&re.onUpdate(re)}J.__version=re.version}function _n(J,re,Je){if(re.image.length!==6)return;const Xe=pt(J,re),at=re.source;t.bindTexture(n.TEXTURE_CUBE_MAP,J.__webglTexture,n.TEXTURE0+Je);const ft=i.get(at);if(at.version!==ft.__version||Xe===!0){t.activeTexture(n.TEXTURE0+Je);const nn=ri.getPrimaries(ri.workingColorSpace),mt=re.colorSpace===il?null:ri.getPrimaries(re.colorSpace),Kt=re.colorSpace===il||nn===mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,re.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,re.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,re.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,Kt);const rn=re.isCompressedTexture||re.image[0].isCompressedTexture,Tt=re.image[0]&&re.image[0].isDataTexture,$t=[];for(let $=0;$<6;$++)!rn&&!Tt?$t[$]=B(re.image[$],!0,o.maxCubemapSize):$t[$]=Tt?re.image[$].image:re.image[$],$t[$]=Wt(re,$t[$]);const qe=$t[0],Gt=h.convert(re.format,re.colorSpace),Nt=h.convert(re.type),bn=G(re.internalFormat,Gt,Nt,re.colorSpace),wn=re.isVideoTexture!==!0,nt=ft.__version===void 0||Xe===!0,Rt=at.dataReady;let Lt=V(re,qe);Ye(n.TEXTURE_CUBE_MAP,re);let Ot;if(rn){wn&&nt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,bn,qe.width,qe.height);for(let $=0;$<6;$++){Ot=$t[$].mipmaps;for(let Le=0;Le<Ot.length;Le++){const rt=Ot[Le];re.format!==wa?Gt!==null?wn?Rt&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le,0,0,rt.width,rt.height,Gt,rt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le,bn,rt.width,rt.height,0,rt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):wn?Rt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le,0,0,rt.width,rt.height,Gt,Nt,rt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le,bn,rt.width,rt.height,0,Gt,Nt,rt.data)}}}else{if(Ot=re.mipmaps,wn&&nt){Ot.length>0&&Lt++;const $=En($t[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,Lt,bn,$.width,$.height)}for(let $=0;$<6;$++)if(Tt){wn?Rt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,0,0,0,$t[$].width,$t[$].height,Gt,Nt,$t[$].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,0,bn,$t[$].width,$t[$].height,0,Gt,Nt,$t[$].data);for(let Le=0;Le<Ot.length;Le++){const wt=Ot[Le].image[$].image;wn?Rt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le+1,0,0,wt.width,wt.height,Gt,Nt,wt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le+1,bn,wt.width,wt.height,0,Gt,Nt,wt.data)}}else{wn?Rt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,0,0,0,Gt,Nt,$t[$]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,0,bn,Gt,Nt,$t[$]);for(let Le=0;Le<Ot.length;Le++){const rt=Ot[Le];wn?Rt&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le+1,0,0,Gt,Nt,rt.image[$]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+$,Le+1,bn,Gt,Nt,rt.image[$])}}}z(re)&&R(n.TEXTURE_CUBE_MAP),ft.__version=at.version,re.onUpdate&&re.onUpdate(re)}J.__version=re.version}function Ze(J,re,Je,Xe,at,ft){const nn=h.convert(Je.format,Je.colorSpace),mt=h.convert(Je.type),Kt=G(Je.internalFormat,nn,mt,Je.colorSpace);if(!i.get(re).__hasExternalTextures){const Tt=Math.max(1,re.width>>ft),$t=Math.max(1,re.height>>ft);at===n.TEXTURE_3D||at===n.TEXTURE_2D_ARRAY?t.texImage3D(at,ft,Kt,Tt,$t,re.depth,0,nn,mt,null):t.texImage2D(at,ft,Kt,Tt,$t,0,nn,mt,null)}t.bindFramebuffer(n.FRAMEBUFFER,J),an(re)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,Xe,at,i.get(Je).__webglTexture,0,dn(re)):(at===n.TEXTURE_2D||at>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&at<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,Xe,at,i.get(Je).__webglTexture,ft),t.bindFramebuffer(n.FRAMEBUFFER,null)}function _t(J,re,Je){if(n.bindRenderbuffer(n.RENDERBUFFER,J),re.depthBuffer&&!re.stencilBuffer){let Xe=n.DEPTH_COMPONENT24;if(Je||an(re)){const at=re.depthTexture;at&&at.isDepthTexture&&(at.type===al?Xe=n.DEPTH_COMPONENT32F:at.type===Mh&&(Xe=n.DEPTH_COMPONENT24));const ft=dn(re);an(re)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,ft,Xe,re.width,re.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,ft,Xe,re.width,re.height)}else n.renderbufferStorage(n.RENDERBUFFER,Xe,re.width,re.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,J)}else if(re.depthBuffer&&re.stencilBuffer){const Xe=dn(re);Je&&an(re)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,Xe,n.DEPTH24_STENCIL8,re.width,re.height):an(re)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,Xe,n.DEPTH24_STENCIL8,re.width,re.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,re.width,re.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,J)}else{const Xe=re.textures;for(let at=0;at<Xe.length;at++){const ft=Xe[at],nn=h.convert(ft.format,ft.colorSpace),mt=h.convert(ft.type),Kt=G(ft.internalFormat,nn,mt,ft.colorSpace),rn=dn(re);Je&&an(re)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,rn,Kt,re.width,re.height):an(re)?c.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,rn,Kt,re.width,re.height):n.renderbufferStorage(n.RENDERBUFFER,Kt,re.width,re.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ct(J,re){if(re&&re.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,J),!(re.depthTexture&&re.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(re.depthTexture).__webglTexture||re.depthTexture.image.width!==re.width||re.depthTexture.image.height!==re.height)&&(re.depthTexture.image.width=re.width,re.depthTexture.image.height=re.height,re.depthTexture.needsUpdate=!0),Te(re.depthTexture,0);const Xe=i.get(re.depthTexture).__webglTexture,at=dn(re);if(re.depthTexture.format===ch)an(re)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Xe,0,at):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,Xe,0);else if(re.depthTexture.format===Bf)an(re)?c.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Xe,0,at):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,Xe,0);else throw new Error("Unknown depthTexture format")}function St(J){const re=i.get(J),Je=J.isWebGLCubeRenderTarget===!0;if(J.depthTexture&&!re.__autoAllocateDepthBuffer){if(Je)throw new Error("target.depthTexture not supported in Cube render targets");Ct(re.__webglFramebuffer,J)}else if(Je){re.__webglDepthbuffer=[];for(let Xe=0;Xe<6;Xe++)t.bindFramebuffer(n.FRAMEBUFFER,re.__webglFramebuffer[Xe]),re.__webglDepthbuffer[Xe]=n.createRenderbuffer(),_t(re.__webglDepthbuffer[Xe],J,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,re.__webglFramebuffer),re.__webglDepthbuffer=n.createRenderbuffer(),_t(re.__webglDepthbuffer,J,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function un(J,re,Je){const Xe=i.get(J);re!==void 0&&Ze(Xe.__webglFramebuffer,J,J.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),Je!==void 0&&St(J)}function mn(J){const re=J.texture,Je=i.get(J),Xe=i.get(re);J.addEventListener("dispose",fe);const at=J.textures,ft=J.isWebGLCubeRenderTarget===!0,nn=at.length>1;if(nn||(Xe.__webglTexture===void 0&&(Xe.__webglTexture=n.createTexture()),Xe.__version=re.version,f.memory.textures++),ft){Je.__webglFramebuffer=[];for(let mt=0;mt<6;mt++)if(re.mipmaps&&re.mipmaps.length>0){Je.__webglFramebuffer[mt]=[];for(let Kt=0;Kt<re.mipmaps.length;Kt++)Je.__webglFramebuffer[mt][Kt]=n.createFramebuffer()}else Je.__webglFramebuffer[mt]=n.createFramebuffer()}else{if(re.mipmaps&&re.mipmaps.length>0){Je.__webglFramebuffer=[];for(let mt=0;mt<re.mipmaps.length;mt++)Je.__webglFramebuffer[mt]=n.createFramebuffer()}else Je.__webglFramebuffer=n.createFramebuffer();if(nn)for(let mt=0,Kt=at.length;mt<Kt;mt++){const rn=i.get(at[mt]);rn.__webglTexture===void 0&&(rn.__webglTexture=n.createTexture(),f.memory.textures++)}if(J.samples>0&&an(J)===!1){Je.__webglMultisampledFramebuffer=n.createFramebuffer(),Je.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,Je.__webglMultisampledFramebuffer);for(let mt=0;mt<at.length;mt++){const Kt=at[mt];Je.__webglColorRenderbuffer[mt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,Je.__webglColorRenderbuffer[mt]);const rn=h.convert(Kt.format,Kt.colorSpace),Tt=h.convert(Kt.type),$t=G(Kt.internalFormat,rn,Tt,Kt.colorSpace,J.isXRRenderTarget===!0),qe=dn(J);n.renderbufferStorageMultisample(n.RENDERBUFFER,qe,$t,J.width,J.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+mt,n.RENDERBUFFER,Je.__webglColorRenderbuffer[mt])}n.bindRenderbuffer(n.RENDERBUFFER,null),J.depthBuffer&&(Je.__webglDepthRenderbuffer=n.createRenderbuffer(),_t(Je.__webglDepthRenderbuffer,J,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(ft){t.bindTexture(n.TEXTURE_CUBE_MAP,Xe.__webglTexture),Ye(n.TEXTURE_CUBE_MAP,re);for(let mt=0;mt<6;mt++)if(re.mipmaps&&re.mipmaps.length>0)for(let Kt=0;Kt<re.mipmaps.length;Kt++)Ze(Je.__webglFramebuffer[mt][Kt],J,re,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+mt,Kt);else Ze(Je.__webglFramebuffer[mt],J,re,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+mt,0);z(re)&&R(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(nn){for(let mt=0,Kt=at.length;mt<Kt;mt++){const rn=at[mt],Tt=i.get(rn);t.bindTexture(n.TEXTURE_2D,Tt.__webglTexture),Ye(n.TEXTURE_2D,rn),Ze(Je.__webglFramebuffer,J,rn,n.COLOR_ATTACHMENT0+mt,n.TEXTURE_2D,0),z(rn)&&R(n.TEXTURE_2D)}t.unbindTexture()}else{let mt=n.TEXTURE_2D;if((J.isWebGL3DRenderTarget||J.isWebGLArrayRenderTarget)&&(mt=J.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(mt,Xe.__webglTexture),Ye(mt,re),re.mipmaps&&re.mipmaps.length>0)for(let Kt=0;Kt<re.mipmaps.length;Kt++)Ze(Je.__webglFramebuffer[Kt],J,re,n.COLOR_ATTACHMENT0,mt,Kt);else Ze(Je.__webglFramebuffer,J,re,n.COLOR_ATTACHMENT0,mt,0);z(re)&&R(mt),t.unbindTexture()}J.depthBuffer&&St(J)}function yn(J){const re=J.textures;for(let Je=0,Xe=re.length;Je<Xe;Je++){const at=re[Je];if(z(at)){const ft=J.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,nn=i.get(at).__webglTexture;t.bindTexture(ft,nn),R(ft),t.unbindTexture()}}}function Fe(J){if(J.samples>0&&an(J)===!1){const re=J.textures,Je=J.width,Xe=J.height;let at=n.COLOR_BUFFER_BIT;const ft=[],nn=J.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,mt=i.get(J),Kt=re.length>1;if(Kt)for(let rn=0;rn<re.length;rn++)t.bindFramebuffer(n.FRAMEBUFFER,mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rn,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+rn,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,mt.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,mt.__webglFramebuffer);for(let rn=0;rn<re.length;rn++){ft.push(n.COLOR_ATTACHMENT0+rn),J.depthBuffer&&ft.push(nn);const Tt=mt.__ignoreDepthValues!==void 0?mt.__ignoreDepthValues:!1;if(Tt===!1&&(J.depthBuffer&&(at|=n.DEPTH_BUFFER_BIT),J.stencilBuffer&&mt.__isTransmissionRenderTarget!==!0&&(at|=n.STENCIL_BUFFER_BIT)),Kt&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,mt.__webglColorRenderbuffer[rn]),Tt===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[nn]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[nn])),Kt){const $t=i.get(re[rn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,$t,0)}n.blitFramebuffer(0,0,Je,Xe,0,0,Je,Xe,at,n.NEAREST),v&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,ft)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),Kt)for(let rn=0;rn<re.length;rn++){t.bindFramebuffer(n.FRAMEBUFFER,mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+rn,n.RENDERBUFFER,mt.__webglColorRenderbuffer[rn]);const Tt=i.get(re[rn]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+rn,n.TEXTURE_2D,Tt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,mt.__webglMultisampledFramebuffer)}}function dn(J){return Math.min(o.maxSamples,J.samples)}function an(J){const re=i.get(J);return J.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&re.__useRenderToTexture!==!1}function Vn(J){const re=f.render.frame;S.get(J)!==re&&(S.set(J,re),J.update())}function Wt(J,re){const Je=J.colorSpace,Xe=J.format,at=J.type;return J.isCompressedTexture===!0||J.isVideoTexture===!0||Je!==El&&Je!==il&&(ri.getTransfer(Je)===gi?(Xe!==wa||at!==_l)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",Je)),re}function En(J){return typeof HTMLImageElement<"u"&&J instanceof HTMLImageElement?(w.width=J.naturalWidth||J.width,w.height=J.naturalHeight||J.height):typeof VideoFrame<"u"&&J instanceof VideoFrame?(w.width=J.displayWidth,w.height=J.displayHeight):(w.width=J.width,w.height=J.height),w}this.allocateTextureUnit=Pe,this.resetTextureUnits=K,this.setTexture2D=Te,this.setTexture2DArray=je,this.setTexture3D=it,this.setTextureCube=ut,this.rebindTextures=un,this.setupRenderTarget=mn,this.updateRenderTargetMipmap=yn,this.updateMultisampleRenderTarget=Fe,this.setupDepthRenderbuffer=St,this.setupFrameBufferTexture=Ze,this.useMultisampledRTT=an}function FN(n,e){function t(i,o=il){let h;const f=ri.getTransfer(o);if(i===_l)return n.UNSIGNED_BYTE;if(i===X2)return n.UNSIGNED_SHORT_4_4_4_4;if(i===q2)return n.UNSIGNED_SHORT_5_5_5_1;if(i===ez)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===J3)return n.BYTE;if(i===Q3)return n.SHORT;if(i===W2)return n.UNSIGNED_SHORT;if(i===$2)return n.INT;if(i===Mh)return n.UNSIGNED_INT;if(i===al)return n.FLOAT;if(i===Vg)return n.HALF_FLOAT;if(i===tz)return n.ALPHA;if(i===nz)return n.RGB;if(i===wa)return n.RGBA;if(i===iz)return n.LUMINANCE;if(i===rz)return n.LUMINANCE_ALPHA;if(i===ch)return n.DEPTH_COMPONENT;if(i===Bf)return n.DEPTH_STENCIL;if(i===sz)return n.RED;if(i===Z2)return n.RED_INTEGER;if(i===az)return n.RG;if(i===Y2)return n.RG_INTEGER;if(i===K2)return n.RGBA_INTEGER;if(i===i0||i===r0||i===s0||i===a0)if(f===gi)if(h=e.get("WEBGL_compressed_texture_s3tc_srgb"),h!==null){if(i===i0)return h.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===r0)return h.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===s0)return h.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===a0)return h.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(h=e.get("WEBGL_compressed_texture_s3tc"),h!==null){if(i===i0)return h.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===r0)return h.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===s0)return h.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===a0)return h.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===MS||i===TS||i===ES||i===AS)if(h=e.get("WEBGL_compressed_texture_pvrtc"),h!==null){if(i===MS)return h.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===TS)return h.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===ES)return h.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===AS)return h.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===J2)return h=e.get("WEBGL_compressed_texture_etc1"),h!==null?h.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===CS||i===PS)if(h=e.get("WEBGL_compressed_texture_etc"),h!==null){if(i===CS)return f===gi?h.COMPRESSED_SRGB8_ETC2:h.COMPRESSED_RGB8_ETC2;if(i===PS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:h.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===RS||i===IS||i===LS||i===DS||i===zS||i===kS||i===FS||i===US||i===NS||i===OS||i===BS||i===VS||i===GS||i===HS)if(h=e.get("WEBGL_compressed_texture_astc"),h!==null){if(i===RS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:h.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===IS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:h.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===LS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:h.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===DS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:h.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===zS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:h.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===kS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:h.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===FS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:h.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===US)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:h.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===NS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:h.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===OS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:h.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===BS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:h.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===VS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:h.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===GS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:h.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===HS)return f===gi?h.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:h.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===o0||i===jS||i===WS)if(h=e.get("EXT_texture_compression_bptc"),h!==null){if(i===o0)return f===gi?h.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:h.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===jS)return h.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===WS)return h.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===oz||i===$S||i===XS||i===qS)if(h=e.get("EXT_texture_compression_rgtc"),h!==null){if(i===o0)return h.COMPRESSED_RED_RGTC1_EXT;if(i===$S)return h.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===XS)return h.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===qS)return h.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===ep?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class UN extends Ds{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class lf extends ys{constructor(){super(),this.isGroup=!0,this.type="Group"}}const NN={type:"move"};class L0{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new lf,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new lf,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new $e,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new $e),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new lf,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new $e,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new $e),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let o=null,h=null,f=null;const c=this._targetRay,v=this._grip,w=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(w&&e.hand){f=!0;for(const B of e.hand.values()){const z=t.getJointPose(B,i),R=this._getHandJoint(w,B);z!==null&&(R.matrix.fromArray(z.transform.matrix),R.matrix.decompose(R.position,R.rotation,R.scale),R.matrixWorldNeedsUpdate=!0,R.jointRadius=z.radius),R.visible=z!==null}const S=w.joints["index-finger-tip"],E=w.joints["thumb-tip"],M=S.position.distanceTo(E.position),L=.02,U=.005;w.inputState.pinching&&M>L+U?(w.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!w.inputState.pinching&&M<=L-U&&(w.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else v!==null&&e.gripSpace&&(h=t.getPose(e.gripSpace,i),h!==null&&(v.matrix.fromArray(h.transform.matrix),v.matrix.decompose(v.position,v.rotation,v.scale),v.matrixWorldNeedsUpdate=!0,h.linearVelocity?(v.hasLinearVelocity=!0,v.linearVelocity.copy(h.linearVelocity)):v.hasLinearVelocity=!1,h.angularVelocity?(v.hasAngularVelocity=!0,v.angularVelocity.copy(h.angularVelocity)):v.hasAngularVelocity=!1));c!==null&&(o=t.getPose(e.targetRaySpace,i),o===null&&h!==null&&(o=h),o!==null&&(c.matrix.fromArray(o.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,o.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(o.linearVelocity)):c.hasLinearVelocity=!1,o.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(o.angularVelocity)):c.hasAngularVelocity=!1,this.dispatchEvent(NN)))}return c!==null&&(c.visible=o!==null),v!==null&&(v.visible=h!==null),w!==null&&(w.visible=f!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new lf;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const ON=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,BN=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class VN{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const o=new Wr,h=e.properties.get(o);h.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=o}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,o=new Ns({vertexShader:ON,fragmentShader:BN,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new gs(new m_(20,20),o)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class GN extends Ac{constructor(e,t){super();const i=this;let o=null,h=1,f=null,c="local-floor",v=1,w=null,S=null,E=null,M=null,L=null,U=null;const B=new VN,z=t.getContextAttributes();let R=null,G=null;const V=[],ee=[],fe=new Pn;let Z=null;const te=new Ds;te.layers.enable(1),te.viewport=new dr;const be=new Ds;be.layers.enable(2),be.viewport=new dr;const ae=[te,be],K=new UN;K.layers.enable(1),K.layers.enable(2);let Pe=null,ke=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(Ze){let _t=V[Ze];return _t===void 0&&(_t=new L0,V[Ze]=_t),_t.getTargetRaySpace()},this.getControllerGrip=function(Ze){let _t=V[Ze];return _t===void 0&&(_t=new L0,V[Ze]=_t),_t.getGripSpace()},this.getHand=function(Ze){let _t=V[Ze];return _t===void 0&&(_t=new L0,V[Ze]=_t),_t.getHandSpace()};function Te(Ze){const _t=ee.indexOf(Ze.inputSource);if(_t===-1)return;const Ct=V[_t];Ct!==void 0&&(Ct.update(Ze.inputSource,Ze.frame,w||f),Ct.dispatchEvent({type:Ze.type,data:Ze.inputSource}))}function je(){o.removeEventListener("select",Te),o.removeEventListener("selectstart",Te),o.removeEventListener("selectend",Te),o.removeEventListener("squeeze",Te),o.removeEventListener("squeezestart",Te),o.removeEventListener("squeezeend",Te),o.removeEventListener("end",je),o.removeEventListener("inputsourceschange",it);for(let Ze=0;Ze<V.length;Ze++){const _t=ee[Ze];_t!==null&&(ee[Ze]=null,V[Ze].disconnect(_t))}Pe=null,ke=null,B.reset(),e.setRenderTarget(R),L=null,M=null,E=null,o=null,G=null,_n.stop(),i.isPresenting=!1,e.setPixelRatio(Z),e.setSize(fe.width,fe.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(Ze){h=Ze,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(Ze){c=Ze,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return w||f},this.setReferenceSpace=function(Ze){w=Ze},this.getBaseLayer=function(){return M!==null?M:L},this.getBinding=function(){return E},this.getFrame=function(){return U},this.getSession=function(){return o},this.setSession=async function(Ze){if(o=Ze,o!==null){if(R=e.getRenderTarget(),o.addEventListener("select",Te),o.addEventListener("selectstart",Te),o.addEventListener("selectend",Te),o.addEventListener("squeeze",Te),o.addEventListener("squeezestart",Te),o.addEventListener("squeezeend",Te),o.addEventListener("end",je),o.addEventListener("inputsourceschange",it),z.xrCompatible!==!0&&await t.makeXRCompatible(),Z=e.getPixelRatio(),e.getSize(fe),o.renderState.layers===void 0){const _t={antialias:z.antialias,alpha:!0,depth:z.depth,stencil:z.stencil,framebufferScaleFactor:h};L=new XRWebGLLayer(o,t,_t),o.updateRenderState({baseLayer:L}),e.setPixelRatio(1),e.setSize(L.framebufferWidth,L.framebufferHeight,!1),G=new wc(L.framebufferWidth,L.framebufferHeight,{format:wa,type:_l,colorSpace:e.outputColorSpace,stencilBuffer:z.stencil})}else{let _t=null,Ct=null,St=null;z.depth&&(St=z.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,_t=z.stencil?Bf:ch,Ct=z.stencil?ep:Mh);const un={colorFormat:t.RGBA8,depthFormat:St,scaleFactor:h};E=new XRWebGLBinding(o,t),M=E.createProjectionLayer(un),o.updateRenderState({layers:[M]}),e.setPixelRatio(1),e.setSize(M.textureWidth,M.textureHeight,!1),G=new wc(M.textureWidth,M.textureHeight,{format:wa,type:_l,depthTexture:new pA(M.textureWidth,M.textureHeight,Ct,void 0,void 0,void 0,void 0,void 0,void 0,_t),stencilBuffer:z.stencil,colorSpace:e.outputColorSpace,samples:z.antialias?4:0});const mn=e.properties.get(G);mn.__ignoreDepthValues=M.ignoreDepthValues}G.isXRRenderTarget=!0,this.setFoveation(v),w=null,f=await o.requestReferenceSpace(c),_n.setContext(o),_n.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(o!==null)return o.environmentBlendMode};function it(Ze){for(let _t=0;_t<Ze.removed.length;_t++){const Ct=Ze.removed[_t],St=ee.indexOf(Ct);St>=0&&(ee[St]=null,V[St].disconnect(Ct))}for(let _t=0;_t<Ze.added.length;_t++){const Ct=Ze.added[_t];let St=ee.indexOf(Ct);if(St===-1){for(let mn=0;mn<V.length;mn++)if(mn>=ee.length){ee.push(Ct),St=mn;break}else if(ee[mn]===null){ee[mn]=Ct,St=mn;break}if(St===-1)break}const un=V[St];un&&un.connect(Ct)}}const ut=new $e,st=new $e;function Ce(Ze,_t,Ct){ut.setFromMatrixPosition(_t.matrixWorld),st.setFromMatrixPosition(Ct.matrixWorld);const St=ut.distanceTo(st),un=_t.projectionMatrix.elements,mn=Ct.projectionMatrix.elements,yn=un[14]/(un[10]-1),Fe=un[14]/(un[10]+1),dn=(un[9]+1)/un[5],an=(un[9]-1)/un[5],Vn=(un[8]-1)/un[0],Wt=(mn[8]+1)/mn[0],En=yn*Vn,J=yn*Wt,re=St/(-Vn+Wt),Je=re*-Vn;_t.matrixWorld.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.translateX(Je),Ze.translateZ(re),Ze.matrixWorld.compose(Ze.position,Ze.quaternion,Ze.scale),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert();const Xe=yn+re,at=Fe+re,ft=En-Je,nn=J+(St-Je),mt=dn*Fe/at*Xe,Kt=an*Fe/at*Xe;Ze.projectionMatrix.makePerspective(ft,nn,mt,Kt,Xe,at),Ze.projectionMatrixInverse.copy(Ze.projectionMatrix).invert()}function Ke(Ze,_t){_t===null?Ze.matrixWorld.copy(Ze.matrix):Ze.matrixWorld.multiplyMatrices(_t.matrixWorld,Ze.matrix),Ze.matrixWorldInverse.copy(Ze.matrixWorld).invert()}this.updateCamera=function(Ze){if(o===null)return;B.texture!==null&&(Ze.near=B.depthNear,Ze.far=B.depthFar),K.near=be.near=te.near=Ze.near,K.far=be.far=te.far=Ze.far,(Pe!==K.near||ke!==K.far)&&(o.updateRenderState({depthNear:K.near,depthFar:K.far}),Pe=K.near,ke=K.far,te.near=Pe,te.far=ke,be.near=Pe,be.far=ke,te.updateProjectionMatrix(),be.updateProjectionMatrix(),Ze.updateProjectionMatrix());const _t=Ze.parent,Ct=K.cameras;Ke(K,_t);for(let St=0;St<Ct.length;St++)Ke(Ct[St],_t);Ct.length===2?Ce(K,te,be):K.projectionMatrix.copy(te.projectionMatrix),Ye(Ze,K,_t)};function Ye(Ze,_t,Ct){Ct===null?Ze.matrix.copy(_t.matrixWorld):(Ze.matrix.copy(Ct.matrixWorld),Ze.matrix.invert(),Ze.matrix.multiply(_t.matrixWorld)),Ze.matrix.decompose(Ze.position,Ze.quaternion,Ze.scale),Ze.updateMatrixWorld(!0),Ze.projectionMatrix.copy(_t.projectionMatrix),Ze.projectionMatrixInverse.copy(_t.projectionMatrixInverse),Ze.isPerspectiveCamera&&(Ze.fov=Vf*2*Math.atan(1/Ze.projectionMatrix.elements[5]),Ze.zoom=1)}this.getCamera=function(){return K},this.getFoveation=function(){if(!(M===null&&L===null))return v},this.setFoveation=function(Ze){v=Ze,M!==null&&(M.fixedFoveation=Ze),L!==null&&L.fixedFoveation!==void 0&&(L.fixedFoveation=Ze)},this.hasDepthSensing=function(){return B.texture!==null};let pt=null;function kt(Ze,_t){if(S=_t.getViewerPose(w||f),U=_t,S!==null){const Ct=S.views;L!==null&&(e.setRenderTargetFramebuffer(G,L.framebuffer),e.setRenderTarget(G));let St=!1;Ct.length!==K.cameras.length&&(K.cameras.length=0,St=!0);for(let mn=0;mn<Ct.length;mn++){const yn=Ct[mn];let Fe=null;if(L!==null)Fe=L.getViewport(yn);else{const an=E.getViewSubImage(M,yn);Fe=an.viewport,mn===0&&(e.setRenderTargetTextures(G,an.colorTexture,M.ignoreDepthValues?void 0:an.depthStencilTexture),e.setRenderTarget(G))}let dn=ae[mn];dn===void 0&&(dn=new Ds,dn.layers.enable(mn),dn.viewport=new dr,ae[mn]=dn),dn.matrix.fromArray(yn.transform.matrix),dn.matrix.decompose(dn.position,dn.quaternion,dn.scale),dn.projectionMatrix.fromArray(yn.projectionMatrix),dn.projectionMatrixInverse.copy(dn.projectionMatrix).invert(),dn.viewport.set(Fe.x,Fe.y,Fe.width,Fe.height),mn===0&&(K.matrix.copy(dn.matrix),K.matrix.decompose(K.position,K.quaternion,K.scale)),St===!0&&K.cameras.push(dn)}const un=o.enabledFeatures;if(un&&un.includes("depth-sensing")){const mn=E.getDepthInformation(Ct[0]);mn&&mn.isValid&&mn.texture&&B.init(e,mn,o.renderState)}}for(let Ct=0;Ct<V.length;Ct++){const St=ee[Ct],un=V[Ct];St!==null&&un!==void 0&&un.update(St,_t,w||f)}B.render(e,K),pt&&pt(Ze,_t),_t.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:_t}),U=null}const _n=new fA;_n.setAnimationLoop(kt),this.setAnimationLoop=function(Ze){pt=Ze},this.dispose=function(){}}}const ec=new fo,HN=new Yi;function jN(n,e){function t(z,R){z.matrixAutoUpdate===!0&&z.updateMatrix(),R.value.copy(z.matrix)}function i(z,R){R.color.getRGB(z.fogColor.value,cA(n)),R.isFog?(z.fogNear.value=R.near,z.fogFar.value=R.far):R.isFogExp2&&(z.fogDensity.value=R.density)}function o(z,R,G,V,ee){R.isMeshBasicMaterial||R.isMeshLambertMaterial?h(z,R):R.isMeshToonMaterial?(h(z,R),E(z,R)):R.isMeshPhongMaterial?(h(z,R),S(z,R)):R.isMeshStandardMaterial?(h(z,R),M(z,R),R.isMeshPhysicalMaterial&&L(z,R,ee)):R.isMeshMatcapMaterial?(h(z,R),U(z,R)):R.isMeshDepthMaterial?h(z,R):R.isMeshDistanceMaterial?(h(z,R),B(z,R)):R.isMeshNormalMaterial?h(z,R):R.isLineBasicMaterial?(f(z,R),R.isLineDashedMaterial&&c(z,R)):R.isPointsMaterial?v(z,R,G,V):R.isSpriteMaterial?w(z,R):R.isShadowMaterial?(z.color.value.copy(R.color),z.opacity.value=R.opacity):R.isShaderMaterial&&(R.uniformsNeedUpdate=!1)}function h(z,R){z.opacity.value=R.opacity,R.color&&z.diffuse.value.copy(R.color),R.emissive&&z.emissive.value.copy(R.emissive).multiplyScalar(R.emissiveIntensity),R.map&&(z.map.value=R.map,t(R.map,z.mapTransform)),R.alphaMap&&(z.alphaMap.value=R.alphaMap,t(R.alphaMap,z.alphaMapTransform)),R.bumpMap&&(z.bumpMap.value=R.bumpMap,t(R.bumpMap,z.bumpMapTransform),z.bumpScale.value=R.bumpScale,R.side===jr&&(z.bumpScale.value*=-1)),R.normalMap&&(z.normalMap.value=R.normalMap,t(R.normalMap,z.normalMapTransform),z.normalScale.value.copy(R.normalScale),R.side===jr&&z.normalScale.value.negate()),R.displacementMap&&(z.displacementMap.value=R.displacementMap,t(R.displacementMap,z.displacementMapTransform),z.displacementScale.value=R.displacementScale,z.displacementBias.value=R.displacementBias),R.emissiveMap&&(z.emissiveMap.value=R.emissiveMap,t(R.emissiveMap,z.emissiveMapTransform)),R.specularMap&&(z.specularMap.value=R.specularMap,t(R.specularMap,z.specularMapTransform)),R.alphaTest>0&&(z.alphaTest.value=R.alphaTest);const G=e.get(R),V=G.envMap,ee=G.envMapRotation;if(V&&(z.envMap.value=V,ec.copy(ee),ec.x*=-1,ec.y*=-1,ec.z*=-1,V.isCubeTexture&&V.isRenderTargetTexture===!1&&(ec.y*=-1,ec.z*=-1),z.envMapRotation.value.setFromMatrix4(HN.makeRotationFromEuler(ec)),z.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,z.reflectivity.value=R.reflectivity,z.ior.value=R.ior,z.refractionRatio.value=R.refractionRatio),R.lightMap){z.lightMap.value=R.lightMap;const fe=n._useLegacyLights===!0?Math.PI:1;z.lightMapIntensity.value=R.lightMapIntensity*fe,t(R.lightMap,z.lightMapTransform)}R.aoMap&&(z.aoMap.value=R.aoMap,z.aoMapIntensity.value=R.aoMapIntensity,t(R.aoMap,z.aoMapTransform))}function f(z,R){z.diffuse.value.copy(R.color),z.opacity.value=R.opacity,R.map&&(z.map.value=R.map,t(R.map,z.mapTransform))}function c(z,R){z.dashSize.value=R.dashSize,z.totalSize.value=R.dashSize+R.gapSize,z.scale.value=R.scale}function v(z,R,G,V){z.diffuse.value.copy(R.color),z.opacity.value=R.opacity,z.size.value=R.size*G,z.scale.value=V*.5,R.map&&(z.map.value=R.map,t(R.map,z.uvTransform)),R.alphaMap&&(z.alphaMap.value=R.alphaMap,t(R.alphaMap,z.alphaMapTransform)),R.alphaTest>0&&(z.alphaTest.value=R.alphaTest)}function w(z,R){z.diffuse.value.copy(R.color),z.opacity.value=R.opacity,z.rotation.value=R.rotation,R.map&&(z.map.value=R.map,t(R.map,z.mapTransform)),R.alphaMap&&(z.alphaMap.value=R.alphaMap,t(R.alphaMap,z.alphaMapTransform)),R.alphaTest>0&&(z.alphaTest.value=R.alphaTest)}function S(z,R){z.specular.value.copy(R.specular),z.shininess.value=Math.max(R.shininess,1e-4)}function E(z,R){R.gradientMap&&(z.gradientMap.value=R.gradientMap)}function M(z,R){z.metalness.value=R.metalness,R.metalnessMap&&(z.metalnessMap.value=R.metalnessMap,t(R.metalnessMap,z.metalnessMapTransform)),z.roughness.value=R.roughness,R.roughnessMap&&(z.roughnessMap.value=R.roughnessMap,t(R.roughnessMap,z.roughnessMapTransform)),R.envMap&&(z.envMapIntensity.value=R.envMapIntensity)}function L(z,R,G){z.ior.value=R.ior,R.sheen>0&&(z.sheenColor.value.copy(R.sheenColor).multiplyScalar(R.sheen),z.sheenRoughness.value=R.sheenRoughness,R.sheenColorMap&&(z.sheenColorMap.value=R.sheenColorMap,t(R.sheenColorMap,z.sheenColorMapTransform)),R.sheenRoughnessMap&&(z.sheenRoughnessMap.value=R.sheenRoughnessMap,t(R.sheenRoughnessMap,z.sheenRoughnessMapTransform))),R.clearcoat>0&&(z.clearcoat.value=R.clearcoat,z.clearcoatRoughness.value=R.clearcoatRoughness,R.clearcoatMap&&(z.clearcoatMap.value=R.clearcoatMap,t(R.clearcoatMap,z.clearcoatMapTransform)),R.clearcoatRoughnessMap&&(z.clearcoatRoughnessMap.value=R.clearcoatRoughnessMap,t(R.clearcoatRoughnessMap,z.clearcoatRoughnessMapTransform)),R.clearcoatNormalMap&&(z.clearcoatNormalMap.value=R.clearcoatNormalMap,t(R.clearcoatNormalMap,z.clearcoatNormalMapTransform),z.clearcoatNormalScale.value.copy(R.clearcoatNormalScale),R.side===jr&&z.clearcoatNormalScale.value.negate())),R.iridescence>0&&(z.iridescence.value=R.iridescence,z.iridescenceIOR.value=R.iridescenceIOR,z.iridescenceThicknessMinimum.value=R.iridescenceThicknessRange[0],z.iridescenceThicknessMaximum.value=R.iridescenceThicknessRange[1],R.iridescenceMap&&(z.iridescenceMap.value=R.iridescenceMap,t(R.iridescenceMap,z.iridescenceMapTransform)),R.iridescenceThicknessMap&&(z.iridescenceThicknessMap.value=R.iridescenceThicknessMap,t(R.iridescenceThicknessMap,z.iridescenceThicknessMapTransform))),R.transmission>0&&(z.transmission.value=R.transmission,z.transmissionSamplerMap.value=G.texture,z.transmissionSamplerSize.value.set(G.width,G.height),R.transmissionMap&&(z.transmissionMap.value=R.transmissionMap,t(R.transmissionMap,z.transmissionMapTransform)),z.thickness.value=R.thickness,R.thicknessMap&&(z.thicknessMap.value=R.thicknessMap,t(R.thicknessMap,z.thicknessMapTransform)),z.attenuationDistance.value=R.attenuationDistance,z.attenuationColor.value.copy(R.attenuationColor)),R.anisotropy>0&&(z.anisotropyVector.value.set(R.anisotropy*Math.cos(R.anisotropyRotation),R.anisotropy*Math.sin(R.anisotropyRotation)),R.anisotropyMap&&(z.anisotropyMap.value=R.anisotropyMap,t(R.anisotropyMap,z.anisotropyMapTransform))),z.specularIntensity.value=R.specularIntensity,z.specularColor.value.copy(R.specularColor),R.specularColorMap&&(z.specularColorMap.value=R.specularColorMap,t(R.specularColorMap,z.specularColorMapTransform)),R.specularIntensityMap&&(z.specularIntensityMap.value=R.specularIntensityMap,t(R.specularIntensityMap,z.specularIntensityMapTransform))}function U(z,R){R.matcap&&(z.matcap.value=R.matcap)}function B(z,R){const G=e.get(R).light;z.referencePosition.value.setFromMatrixPosition(G.matrixWorld),z.nearDistance.value=G.shadow.camera.near,z.farDistance.value=G.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:o}}function WN(n,e,t,i){let o={},h={},f=[];const c=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function v(G,V){const ee=V.program;i.uniformBlockBinding(G,ee)}function w(G,V){let ee=o[G.id];ee===void 0&&(U(G),ee=S(G),o[G.id]=ee,G.addEventListener("dispose",z));const fe=V.program;i.updateUBOMapping(G,fe);const Z=e.render.frame;h[G.id]!==Z&&(M(G),h[G.id]=Z)}function S(G){const V=E();G.__bindingPointIndex=V;const ee=n.createBuffer(),fe=G.__size,Z=G.usage;return n.bindBuffer(n.UNIFORM_BUFFER,ee),n.bufferData(n.UNIFORM_BUFFER,fe,Z),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,V,ee),ee}function E(){for(let G=0;G<c;G++)if(f.indexOf(G)===-1)return f.push(G),G;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function M(G){const V=o[G.id],ee=G.uniforms,fe=G.__cache;n.bindBuffer(n.UNIFORM_BUFFER,V);for(let Z=0,te=ee.length;Z<te;Z++){const be=Array.isArray(ee[Z])?ee[Z]:[ee[Z]];for(let ae=0,K=be.length;ae<K;ae++){const Pe=be[ae];if(L(Pe,Z,ae,fe)===!0){const ke=Pe.__offset,Te=Array.isArray(Pe.value)?Pe.value:[Pe.value];let je=0;for(let it=0;it<Te.length;it++){const ut=Te[it],st=B(ut);typeof ut=="number"||typeof ut=="boolean"?(Pe.__data[0]=ut,n.bufferSubData(n.UNIFORM_BUFFER,ke+je,Pe.__data)):ut.isMatrix3?(Pe.__data[0]=ut.elements[0],Pe.__data[1]=ut.elements[1],Pe.__data[2]=ut.elements[2],Pe.__data[3]=0,Pe.__data[4]=ut.elements[3],Pe.__data[5]=ut.elements[4],Pe.__data[6]=ut.elements[5],Pe.__data[7]=0,Pe.__data[8]=ut.elements[6],Pe.__data[9]=ut.elements[7],Pe.__data[10]=ut.elements[8],Pe.__data[11]=0):(ut.toArray(Pe.__data,je),je+=st.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,ke,Pe.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function L(G,V,ee,fe){const Z=G.value,te=V+"_"+ee;if(fe[te]===void 0)return typeof Z=="number"||typeof Z=="boolean"?fe[te]=Z:fe[te]=Z.clone(),!0;{const be=fe[te];if(typeof Z=="number"||typeof Z=="boolean"){if(be!==Z)return fe[te]=Z,!0}else if(be.equals(Z)===!1)return be.copy(Z),!0}return!1}function U(G){const V=G.uniforms;let ee=0;const fe=16;for(let te=0,be=V.length;te<be;te++){const ae=Array.isArray(V[te])?V[te]:[V[te]];for(let K=0,Pe=ae.length;K<Pe;K++){const ke=ae[K],Te=Array.isArray(ke.value)?ke.value:[ke.value];for(let je=0,it=Te.length;je<it;je++){const ut=Te[je],st=B(ut),Ce=ee%fe;Ce!==0&&fe-Ce<st.boundary&&(ee+=fe-Ce),ke.__data=new Float32Array(st.storage/Float32Array.BYTES_PER_ELEMENT),ke.__offset=ee,ee+=st.storage}}}const Z=ee%fe;return Z>0&&(ee+=fe-Z),G.__size=ee,G.__cache={},this}function B(G){const V={boundary:0,storage:0};return typeof G=="number"||typeof G=="boolean"?(V.boundary=4,V.storage=4):G.isVector2?(V.boundary=8,V.storage=8):G.isVector3||G.isColor?(V.boundary=16,V.storage=12):G.isVector4?(V.boundary=16,V.storage=16):G.isMatrix3?(V.boundary=48,V.storage=48):G.isMatrix4?(V.boundary=64,V.storage=64):G.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",G),V}function z(G){const V=G.target;V.removeEventListener("dispose",z);const ee=f.indexOf(V.__bindingPointIndex);f.splice(ee,1),n.deleteBuffer(o[V.id]),delete o[V.id],delete h[V.id]}function R(){for(const G in o)n.deleteBuffer(o[G]);f=[],o={},h={}}return{bind:v,update:w,dispose:R}}class $N{constructor(e={}){const{canvas:t=Fz(),context:i=null,depth:o=!0,stencil:h=!1,alpha:f=!1,antialias:c=!1,premultipliedAlpha:v=!0,preserveDrawingBuffer:w=!1,powerPreference:S="default",failIfMajorPerformanceCaveat:E=!1}=e;this.isWebGLRenderer=!0;let M;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");M=i.getContextAttributes().alpha}else M=f;const L=new Uint32Array(4),U=new Int32Array(4);let B=null,z=null;const R=[],G=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=ya,this._useLegacyLights=!1,this.toneMapping=gl,this.toneMappingExposure=1;const V=this;let ee=!1,fe=0,Z=0,te=null,be=-1,ae=null;const K=new dr,Pe=new dr;let ke=null;const Te=new si(0);let je=0,it=t.width,ut=t.height,st=1,Ce=null,Ke=null;const Ye=new dr(0,0,it,ut),pt=new dr(0,0,it,ut);let kt=!1;const _n=new dA;let Ze=!1,_t=!1;const Ct=new Yi,St=new Pn,un=new $e,mn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function yn(){return te===null?st:1}let Fe=i;function dn(oe,Ee){const Ue=t.getContext(oe,Ee);return Ue!==null?Ue:null}try{const oe={alpha:!0,depth:o,stencil:h,antialias:c,premultipliedAlpha:v,preserveDrawingBuffer:w,powerPreference:S,failIfMajorPerformanceCaveat:E};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${$x}`),t.addEventListener("webglcontextlost",Le,!1),t.addEventListener("webglcontextrestored",rt,!1),t.addEventListener("webglcontextcreationerror",wt,!1),Fe===null){const Ee="webgl2";if(Fe=dn(Ee,oe),Fe===null)throw dn(Ee)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(oe){throw console.error("THREE.WebGLRenderer: "+oe.message),oe}let an,Vn,Wt,En,J,re,Je,Xe,at,ft,nn,mt,Kt,rn,Tt,$t,qe,Gt,Nt,bn,wn,nt,Rt,Lt;function Ot(){an=new e4(Fe),an.init(),Vn=new XU(Fe,an,e),nt=new FN(Fe,an),Wt=new zN(Fe),En=new i4(Fe),J=new xN,re=new kN(Fe,an,Wt,J,Vn,nt,En),Je=new ZU(V),Xe=new QU(V),at=new lk(Fe),Rt=new WU(Fe,at),ft=new t4(Fe,at,En,Rt),nn=new s4(Fe,ft,at,En),Nt=new r4(Fe,Vn,re),$t=new qU(J),mt=new vN(V,Je,Xe,an,Vn,Rt,$t),Kt=new jN(V,J),rn=new wN,Tt=new CN(an),Gt=new jU(V,Je,Xe,Wt,nn,M,v),qe=new DN(V,nn,Vn),Lt=new WN(Fe,En,Vn,Wt),bn=new $U(Fe,an,En),wn=new n4(Fe,an,En),En.programs=mt.programs,V.capabilities=Vn,V.extensions=an,V.properties=J,V.renderLists=rn,V.shadowMap=qe,V.state=Wt,V.info=En}Ot();const $=new GN(V,Fe);this.xr=$,this.getContext=function(){return Fe},this.getContextAttributes=function(){return Fe.getContextAttributes()},this.forceContextLoss=function(){const oe=an.get("WEBGL_lose_context");oe&&oe.loseContext()},this.forceContextRestore=function(){const oe=an.get("WEBGL_lose_context");oe&&oe.restoreContext()},this.getPixelRatio=function(){return st},this.setPixelRatio=function(oe){oe!==void 0&&(st=oe,this.setSize(it,ut,!1))},this.getSize=function(oe){return oe.set(it,ut)},this.setSize=function(oe,Ee,Ue=!0){if($.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}it=oe,ut=Ee,t.width=Math.floor(oe*st),t.height=Math.floor(Ee*st),Ue===!0&&(t.style.width=oe+"px",t.style.height=Ee+"px"),this.setViewport(0,0,oe,Ee)},this.getDrawingBufferSize=function(oe){return oe.set(it*st,ut*st).floor()},this.setDrawingBufferSize=function(oe,Ee,Ue){it=oe,ut=Ee,st=Ue,t.width=Math.floor(oe*Ue),t.height=Math.floor(Ee*Ue),this.setViewport(0,0,oe,Ee)},this.getCurrentViewport=function(oe){return oe.copy(K)},this.getViewport=function(oe){return oe.copy(Ye)},this.setViewport=function(oe,Ee,Ue,Be){oe.isVector4?Ye.set(oe.x,oe.y,oe.z,oe.w):Ye.set(oe,Ee,Ue,Be),Wt.viewport(K.copy(Ye).multiplyScalar(st).round())},this.getScissor=function(oe){return oe.copy(pt)},this.setScissor=function(oe,Ee,Ue,Be){oe.isVector4?pt.set(oe.x,oe.y,oe.z,oe.w):pt.set(oe,Ee,Ue,Be),Wt.scissor(Pe.copy(pt).multiplyScalar(st).round())},this.getScissorTest=function(){return kt},this.setScissorTest=function(oe){Wt.setScissorTest(kt=oe)},this.setOpaqueSort=function(oe){Ce=oe},this.setTransparentSort=function(oe){Ke=oe},this.getClearColor=function(oe){return oe.copy(Gt.getClearColor())},this.setClearColor=function(){Gt.setClearColor.apply(Gt,arguments)},this.getClearAlpha=function(){return Gt.getClearAlpha()},this.setClearAlpha=function(){Gt.setClearAlpha.apply(Gt,arguments)},this.clear=function(oe=!0,Ee=!0,Ue=!0){let Be=0;if(oe){let Ve=!1;if(te!==null){const vt=te.texture.format;Ve=vt===K2||vt===Y2||vt===Z2}if(Ve){const vt=te.texture.type,jt=vt===_l||vt===Mh||vt===W2||vt===ep||vt===X2||vt===q2,bt=Gt.getClearColor(),Bt=Gt.getClearAlpha(),ln=bt.r,Ft=bt.g,vn=bt.b;jt?(L[0]=ln,L[1]=Ft,L[2]=vn,L[3]=Bt,Fe.clearBufferuiv(Fe.COLOR,0,L)):(U[0]=ln,U[1]=Ft,U[2]=vn,U[3]=Bt,Fe.clearBufferiv(Fe.COLOR,0,U))}else Be|=Fe.COLOR_BUFFER_BIT}Ee&&(Be|=Fe.DEPTH_BUFFER_BIT),Ue&&(Be|=Fe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),Fe.clear(Be)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Le,!1),t.removeEventListener("webglcontextrestored",rt,!1),t.removeEventListener("webglcontextcreationerror",wt,!1),rn.dispose(),Tt.dispose(),J.dispose(),Je.dispose(),Xe.dispose(),nn.dispose(),Rt.dispose(),Lt.dispose(),mt.dispose(),$.dispose(),$.removeEventListener("sessionstart",ye),$.removeEventListener("sessionend",xe),he.stop()};function Le(oe){oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),ee=!0}function rt(){console.log("THREE.WebGLRenderer: Context Restored."),ee=!1;const oe=En.autoReset,Ee=qe.enabled,Ue=qe.autoUpdate,Be=qe.needsUpdate,Ve=qe.type;Ot(),En.autoReset=oe,qe.enabled=Ee,qe.autoUpdate=Ue,qe.needsUpdate=Be,qe.type=Ve}function wt(oe){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",oe.statusMessage)}function se(oe){const Ee=oe.target;Ee.removeEventListener("dispose",se),k(Ee)}function k(oe){F(oe),J.remove(oe)}function F(oe){const Ee=J.get(oe).programs;Ee!==void 0&&(Ee.forEach(function(Ue){mt.releaseProgram(Ue)}),oe.isShaderMaterial&&mt.releaseShaderCache(oe))}this.renderBufferDirect=function(oe,Ee,Ue,Be,Ve,vt){Ee===null&&(Ee=mn);const jt=Ve.isMesh&&Ve.matrixWorld.determinant()<0,bt=on(oe,Ee,Ue,Be,Ve);Wt.setMaterial(Be,jt);let Bt=Ue.index,ln=1;if(Be.wireframe===!0){if(Bt=ft.getWireframeAttribute(Ue),Bt===void 0)return;ln=2}const Ft=Ue.drawRange,vn=Ue.attributes.position;let ai=Ft.start*ln,Yn=(Ft.start+Ft.count)*ln;vt!==null&&(ai=Math.max(ai,vt.start*ln),Yn=Math.min(Yn,(vt.start+vt.count)*ln)),Bt!==null?(ai=Math.max(ai,0),Yn=Math.min(Yn,Bt.count)):vn!=null&&(ai=Math.max(ai,0),Yn=Math.min(Yn,vn.count));const jn=Yn-ai;if(jn<0||jn===1/0)return;Rt.setup(Ve,Be,bt,Ue,Bt);let qr,An=bn;if(Bt!==null&&(qr=at.get(Bt),An=wn,An.setIndex(qr)),Ve.isMesh)Be.wireframe===!0?(Wt.setLineWidth(Be.wireframeLinewidth*yn()),An.setMode(Fe.LINES)):An.setMode(Fe.TRIANGLES);else if(Ve.isLine){let fn=Be.linewidth;fn===void 0&&(fn=1),Wt.setLineWidth(fn*yn()),Ve.isLineSegments?An.setMode(Fe.LINES):Ve.isLineLoop?An.setMode(Fe.LINE_LOOP):An.setMode(Fe.LINE_STRIP)}else Ve.isPoints?An.setMode(Fe.POINTS):Ve.isSprite&&An.setMode(Fe.TRIANGLES);if(Ve.isBatchedMesh)An.renderMultiDraw(Ve._multiDrawStarts,Ve._multiDrawCounts,Ve._multiDrawCount);else if(Ve.isInstancedMesh)An.renderInstances(ai,jn,Ve.count);else if(Ue.isInstancedBufferGeometry){const fn=Ue._maxInstanceCount!==void 0?Ue._maxInstanceCount:1/0,go=Math.min(Ue.instanceCount,fn);An.renderInstances(ai,jn,go)}else An.render(ai,jn)};function j(oe,Ee,Ue){oe.transparent===!0&&oe.side===to&&oe.forceSinglePass===!1?(oe.side=jr,oe.needsUpdate=!0,Ht(oe,Ee,Ue),oe.side=xl,oe.needsUpdate=!0,Ht(oe,Ee,Ue),oe.side=to):Ht(oe,Ee,Ue)}this.compile=function(oe,Ee,Ue=null){Ue===null&&(Ue=oe),z=Tt.get(Ue),z.init(),G.push(z),Ue.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Ee.layers)&&(z.pushLight(Ve),Ve.castShadow&&z.pushShadow(Ve))}),oe!==Ue&&oe.traverseVisible(function(Ve){Ve.isLight&&Ve.layers.test(Ee.layers)&&(z.pushLight(Ve),Ve.castShadow&&z.pushShadow(Ve))}),z.setupLights(V._useLegacyLights);const Be=new Set;return oe.traverse(function(Ve){const vt=Ve.material;if(vt)if(Array.isArray(vt))for(let jt=0;jt<vt.length;jt++){const bt=vt[jt];j(bt,Ue,Ve),Be.add(bt)}else j(vt,Ue,Ve),Be.add(vt)}),G.pop(),z=null,Be},this.compileAsync=function(oe,Ee,Ue=null){const Be=this.compile(oe,Ee,Ue);return new Promise(Ve=>{function vt(){if(Be.forEach(function(jt){J.get(jt).currentProgram.isReady()&&Be.delete(jt)}),Be.size===0){Ve(oe);return}setTimeout(vt,10)}an.get("KHR_parallel_shader_compile")!==null?vt():setTimeout(vt,10)})};let Y=null;function ue(oe){Y&&Y(oe)}function ye(){he.stop()}function xe(){he.start()}const he=new fA;he.setAnimationLoop(ue),typeof self<"u"&&he.setContext(self),this.setAnimationLoop=function(oe){Y=oe,$.setAnimationLoop(oe),oe===null?he.stop():he.start()},$.addEventListener("sessionstart",ye),$.addEventListener("sessionend",xe),this.render=function(oe,Ee){if(Ee!==void 0&&Ee.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(ee===!0)return;oe.matrixWorldAutoUpdate===!0&&oe.updateMatrixWorld(),Ee.parent===null&&Ee.matrixWorldAutoUpdate===!0&&Ee.updateMatrixWorld(),$.enabled===!0&&$.isPresenting===!0&&($.cameraAutoUpdate===!0&&$.updateCamera(Ee),Ee=$.getCamera()),oe.isScene===!0&&oe.onBeforeRender(V,oe,Ee,te),z=Tt.get(oe,G.length),z.init(),G.push(z),Ct.multiplyMatrices(Ee.projectionMatrix,Ee.matrixWorldInverse),_n.setFromProjectionMatrix(Ct),_t=this.localClippingEnabled,Ze=$t.init(this.clippingPlanes,_t),B=rn.get(oe,R.length),B.init(),R.push(B),Se(oe,Ee,0,V.sortObjects),B.finish(),V.sortObjects===!0&&B.sort(Ce,Ke),this.info.render.frame++,Ze===!0&&$t.beginShadows();const Ue=z.state.shadowsArray;if(qe.render(Ue,oe,Ee),Ze===!0&&$t.endShadows(),this.info.autoReset===!0&&this.info.reset(),($.enabled===!1||$.isPresenting===!1||$.hasDepthSensing()===!1)&&Gt.render(B,oe),z.setupLights(V._useLegacyLights),Ee.isArrayCamera){const Be=Ee.cameras;for(let Ve=0,vt=Be.length;Ve<vt;Ve++){const jt=Be[Ve];Ne(B,oe,jt,jt.viewport)}}else Ne(B,oe,Ee);te!==null&&(re.updateMultisampleRenderTarget(te),re.updateRenderTargetMipmap(te)),oe.isScene===!0&&oe.onAfterRender(V,oe,Ee),Rt.resetDefaultState(),be=-1,ae=null,G.pop(),G.length>0?z=G[G.length-1]:z=null,R.pop(),R.length>0?B=R[R.length-1]:B=null};function Se(oe,Ee,Ue,Be){if(oe.visible===!1)return;if(oe.layers.test(Ee.layers)){if(oe.isGroup)Ue=oe.renderOrder;else if(oe.isLOD)oe.autoUpdate===!0&&oe.update(Ee);else if(oe.isLight)z.pushLight(oe),oe.castShadow&&z.pushShadow(oe);else if(oe.isSprite){if(!oe.frustumCulled||_n.intersectsSprite(oe)){Be&&un.setFromMatrixPosition(oe.matrixWorld).applyMatrix4(Ct);const jt=nn.update(oe),bt=oe.material;bt.visible&&B.push(oe,jt,bt,Ue,un.z,null)}}else if((oe.isMesh||oe.isLine||oe.isPoints)&&(!oe.frustumCulled||_n.intersectsObject(oe))){const jt=nn.update(oe),bt=oe.material;if(Be&&(oe.boundingSphere!==void 0?(oe.boundingSphere===null&&oe.computeBoundingSphere(),un.copy(oe.boundingSphere.center)):(jt.boundingSphere===null&&jt.computeBoundingSphere(),un.copy(jt.boundingSphere.center)),un.applyMatrix4(oe.matrixWorld).applyMatrix4(Ct)),Array.isArray(bt)){const Bt=jt.groups;for(let ln=0,Ft=Bt.length;ln<Ft;ln++){const vn=Bt[ln],ai=bt[vn.materialIndex];ai&&ai.visible&&B.push(oe,jt,ai,Ue,un.z,vn)}}else bt.visible&&B.push(oe,jt,bt,Ue,un.z,null)}}const vt=oe.children;for(let jt=0,bt=vt.length;jt<bt;jt++)Se(vt[jt],Ee,Ue,Be)}function Ne(oe,Ee,Ue,Be){const Ve=oe.opaque,vt=oe.transmissive,jt=oe.transparent;z.setupLightsView(Ue),Ze===!0&&$t.setGlobalState(V.clippingPlanes,Ue),vt.length>0&&Ge(Ve,vt,Ee,Ue),Be&&Wt.viewport(K.copy(Be)),Ve.length>0&&ze(Ve,Ee,Ue),vt.length>0&&ze(vt,Ee,Ue),jt.length>0&&ze(jt,Ee,Ue),Wt.buffers.depth.setTest(!0),Wt.buffers.depth.setMask(!0),Wt.buffers.color.setMask(!0),Wt.setPolygonOffset(!1)}function Ge(oe,Ee,Ue,Be){if((Ue.isScene===!0?Ue.overrideMaterial:null)!==null)return;if(z.state.transmissionRenderTarget===null){z.state.transmissionRenderTarget=new wc(1,1,{generateMipmaps:!0,type:an.has("EXT_color_buffer_half_float")||an.has("EXT_color_buffer_float")?Vg:_l,minFilter:fc,samples:4,stencilBuffer:h});const ln=J.get(z.state.transmissionRenderTarget);ln.__isTransmissionRenderTarget=!0}const vt=z.state.transmissionRenderTarget;V.getDrawingBufferSize(St),vt.setSize(St.x,St.y);const jt=V.getRenderTarget();V.setRenderTarget(vt),V.getClearColor(Te),je=V.getClearAlpha(),je<1&&V.setClearColor(16777215,.5),V.clear();const bt=V.toneMapping;V.toneMapping=gl,ze(oe,Ue,Be),re.updateMultisampleRenderTarget(vt),re.updateRenderTargetMipmap(vt);let Bt=!1;for(let ln=0,Ft=Ee.length;ln<Ft;ln++){const vn=Ee[ln],ai=vn.object,Yn=vn.geometry,jn=vn.material,qr=vn.group;if(jn.side===to&&ai.layers.test(Be.layers)){const An=jn.side;jn.side=jr,jn.needsUpdate=!0,yt(ai,Ue,Be,Yn,jn,qr),jn.side=An,jn.needsUpdate=!0,Bt=!0}}Bt===!0&&(re.updateMultisampleRenderTarget(vt),re.updateRenderTargetMipmap(vt)),V.setRenderTarget(jt),V.setClearColor(Te,je),V.toneMapping=bt}function ze(oe,Ee,Ue){const Be=Ee.isScene===!0?Ee.overrideMaterial:null;for(let Ve=0,vt=oe.length;Ve<vt;Ve++){const jt=oe[Ve],bt=jt.object,Bt=jt.geometry,ln=Be===null?jt.material:Be,Ft=jt.group;bt.layers.test(Ue.layers)&&yt(bt,Ee,Ue,Bt,ln,Ft)}}function yt(oe,Ee,Ue,Be,Ve,vt){oe.onBeforeRender(V,Ee,Ue,Be,Ve,vt),oe.modelViewMatrix.multiplyMatrices(Ue.matrixWorldInverse,oe.matrixWorld),oe.normalMatrix.getNormalMatrix(oe.modelViewMatrix),Ve.onBeforeRender(V,Ee,Ue,Be,oe,vt),Ve.transparent===!0&&Ve.side===to&&Ve.forceSinglePass===!1?(Ve.side=jr,Ve.needsUpdate=!0,V.renderBufferDirect(Ue,Ee,Be,Ve,oe,vt),Ve.side=xl,Ve.needsUpdate=!0,V.renderBufferDirect(Ue,Ee,Be,Ve,oe,vt),Ve.side=to):V.renderBufferDirect(Ue,Ee,Be,Ve,oe,vt),oe.onAfterRender(V,Ee,Ue,Be,Ve,vt)}function Ht(oe,Ee,Ue){Ee.isScene!==!0&&(Ee=mn);const Be=J.get(oe),Ve=z.state.lights,vt=z.state.shadowsArray,jt=Ve.state.version,bt=mt.getParameters(oe,Ve.state,vt,Ee,Ue),Bt=mt.getProgramCacheKey(bt);let ln=Be.programs;Be.environment=oe.isMeshStandardMaterial?Ee.environment:null,Be.fog=Ee.fog,Be.envMap=(oe.isMeshStandardMaterial?Xe:Je).get(oe.envMap||Be.environment),Be.envMapRotation=Be.environment!==null&&oe.envMap===null?Ee.environmentRotation:oe.envMapRotation,ln===void 0&&(oe.addEventListener("dispose",se),ln=new Map,Be.programs=ln);let Ft=ln.get(Bt);if(Ft!==void 0){if(Be.currentProgram===Ft&&Be.lightsStateVersion===jt)return sn(oe,bt),Ft}else bt.uniforms=mt.getUniforms(oe),oe.onBuild(Ue,bt,V),oe.onBeforeCompile(bt,V),Ft=mt.acquireProgram(bt,Bt),ln.set(Bt,Ft),Be.uniforms=bt.uniforms;const vn=Be.uniforms;return(!oe.isShaderMaterial&&!oe.isRawShaderMaterial||oe.clipping===!0)&&(vn.clippingPlanes=$t.uniform),sn(oe,bt),Be.needsLights=zn(oe),Be.lightsStateVersion=jt,Be.needsLights&&(vn.ambientLightColor.value=Ve.state.ambient,vn.lightProbe.value=Ve.state.probe,vn.directionalLights.value=Ve.state.directional,vn.directionalLightShadows.value=Ve.state.directionalShadow,vn.spotLights.value=Ve.state.spot,vn.spotLightShadows.value=Ve.state.spotShadow,vn.rectAreaLights.value=Ve.state.rectArea,vn.ltc_1.value=Ve.state.rectAreaLTC1,vn.ltc_2.value=Ve.state.rectAreaLTC2,vn.pointLights.value=Ve.state.point,vn.pointLightShadows.value=Ve.state.pointShadow,vn.hemisphereLights.value=Ve.state.hemi,vn.directionalShadowMap.value=Ve.state.directionalShadowMap,vn.directionalShadowMatrix.value=Ve.state.directionalShadowMatrix,vn.spotShadowMap.value=Ve.state.spotShadowMap,vn.spotLightMatrix.value=Ve.state.spotLightMatrix,vn.spotLightMap.value=Ve.state.spotLightMap,vn.pointShadowMap.value=Ve.state.pointShadowMap,vn.pointShadowMatrix.value=Ve.state.pointShadowMatrix),Be.currentProgram=Ft,Be.uniformsList=null,Ft}function qt(oe){if(oe.uniformsList===null){const Ee=oe.currentProgram.getUniforms();oe.uniformsList=fg.seqWithValue(Ee.seq,oe.uniforms)}return oe.uniformsList}function sn(oe,Ee){const Ue=J.get(oe);Ue.outputColorSpace=Ee.outputColorSpace,Ue.batching=Ee.batching,Ue.instancing=Ee.instancing,Ue.instancingColor=Ee.instancingColor,Ue.instancingMorph=Ee.instancingMorph,Ue.skinning=Ee.skinning,Ue.morphTargets=Ee.morphTargets,Ue.morphNormals=Ee.morphNormals,Ue.morphColors=Ee.morphColors,Ue.morphTargetsCount=Ee.morphTargetsCount,Ue.numClippingPlanes=Ee.numClippingPlanes,Ue.numIntersection=Ee.numClipIntersection,Ue.vertexAlphas=Ee.vertexAlphas,Ue.vertexTangents=Ee.vertexTangents,Ue.toneMapping=Ee.toneMapping}function on(oe,Ee,Ue,Be,Ve){Ee.isScene!==!0&&(Ee=mn),re.resetTextureUnits();const vt=Ee.fog,jt=Be.isMeshStandardMaterial?Ee.environment:null,bt=te===null?V.outputColorSpace:te.isXRRenderTarget===!0?te.texture.colorSpace:El,Bt=(Be.isMeshStandardMaterial?Xe:Je).get(Be.envMap||jt),ln=Be.vertexColors===!0&&!!Ue.attributes.color&&Ue.attributes.color.itemSize===4,Ft=!!Ue.attributes.tangent&&(!!Be.normalMap||Be.anisotropy>0),vn=!!Ue.morphAttributes.position,ai=!!Ue.morphAttributes.normal,Yn=!!Ue.morphAttributes.color;let jn=gl;Be.toneMapped&&(te===null||te.isXRRenderTarget===!0)&&(jn=V.toneMapping);const qr=Ue.morphAttributes.position||Ue.morphAttributes.normal||Ue.morphAttributes.color,An=qr!==void 0?qr.length:0,fn=J.get(Be),go=z.state.lights;if(Ze===!0&&(_t===!0||oe!==ae)){const di=oe===ae&&Be.id===be;$t.setState(Be,oe,di)}let Gn=!1;Be.version===fn.__version?(fn.needsLights&&fn.lightsStateVersion!==go.state.version||fn.outputColorSpace!==bt||Ve.isBatchedMesh&&fn.batching===!1||!Ve.isBatchedMesh&&fn.batching===!0||Ve.isInstancedMesh&&fn.instancing===!1||!Ve.isInstancedMesh&&fn.instancing===!0||Ve.isSkinnedMesh&&fn.skinning===!1||!Ve.isSkinnedMesh&&fn.skinning===!0||Ve.isInstancedMesh&&fn.instancingColor===!0&&Ve.instanceColor===null||Ve.isInstancedMesh&&fn.instancingColor===!1&&Ve.instanceColor!==null||Ve.isInstancedMesh&&fn.instancingMorph===!0&&Ve.morphTexture===null||Ve.isInstancedMesh&&fn.instancingMorph===!1&&Ve.morphTexture!==null||fn.envMap!==Bt||Be.fog===!0&&fn.fog!==vt||fn.numClippingPlanes!==void 0&&(fn.numClippingPlanes!==$t.numPlanes||fn.numIntersection!==$t.numIntersection)||fn.vertexAlphas!==ln||fn.vertexTangents!==Ft||fn.morphTargets!==vn||fn.morphNormals!==ai||fn.morphColors!==Yn||fn.toneMapping!==jn||fn.morphTargetsCount!==An)&&(Gn=!0):(Gn=!0,fn.__version=Be.version);let Xn=fn.currentProgram;Gn===!0&&(Xn=Ht(Be,Ee,Ve));let oa=!1,Lr=!1,ei=!1;const ci=Xn.getUniforms(),Ai=fn.uniforms;if(Wt.useProgram(Xn.program)&&(oa=!0,Lr=!0,ei=!0),Be.id!==be&&(be=Be.id,Lr=!0),oa||ae!==oe){ci.setValue(Fe,"projectionMatrix",oe.projectionMatrix),ci.setValue(Fe,"viewMatrix",oe.matrixWorldInverse);const di=ci.map.cameraPosition;di!==void 0&&di.setValue(Fe,un.setFromMatrixPosition(oe.matrixWorld)),Vn.logarithmicDepthBuffer&&ci.setValue(Fe,"logDepthBufFC",2/(Math.log(oe.far+1)/Math.LN2)),(Be.isMeshPhongMaterial||Be.isMeshToonMaterial||Be.isMeshLambertMaterial||Be.isMeshBasicMaterial||Be.isMeshStandardMaterial||Be.isShaderMaterial)&&ci.setValue(Fe,"isOrthographic",oe.isOrthographicCamera===!0),ae!==oe&&(ae=oe,Lr=!0,ei=!0)}if(Ve.isSkinnedMesh){ci.setOptional(Fe,Ve,"bindMatrix"),ci.setOptional(Fe,Ve,"bindMatrixInverse");const di=Ve.skeleton;di&&(di.boneTexture===null&&di.computeBoneTexture(),ci.setValue(Fe,"boneTexture",di.boneTexture,re))}Ve.isBatchedMesh&&(ci.setOptional(Fe,Ve,"batchingTexture"),ci.setValue(Fe,"batchingTexture",Ve._matricesTexture,re));const la=Ue.morphAttributes;if((la.position!==void 0||la.normal!==void 0||la.color!==void 0)&&Nt.update(Ve,Ue,Xn),(Lr||fn.receiveShadow!==Ve.receiveShadow)&&(fn.receiveShadow=Ve.receiveShadow,ci.setValue(Fe,"receiveShadow",Ve.receiveShadow)),Be.isMeshGouraudMaterial&&Be.envMap!==null&&(Ai.envMap.value=Bt,Ai.flipEnvMap.value=Bt.isCubeTexture&&Bt.isRenderTargetTexture===!1?-1:1),Be.isMeshStandardMaterial&&Be.envMap===null&&Ee.environment!==null&&(Ai.envMapIntensity.value=Ee.environmentIntensity),Lr&&(ci.setValue(Fe,"toneMappingExposure",V.toneMappingExposure),fn.needsLights&&Hn(Ai,ei),vt&&Be.fog===!0&&Kt.refreshFogUniforms(Ai,vt),Kt.refreshMaterialUniforms(Ai,Be,st,ut,z.state.transmissionRenderTarget),fg.upload(Fe,qt(fn),Ai,re)),Be.isShaderMaterial&&Be.uniformsNeedUpdate===!0&&(fg.upload(Fe,qt(fn),Ai,re),Be.uniformsNeedUpdate=!1),Be.isSpriteMaterial&&ci.setValue(Fe,"center",Ve.center),ci.setValue(Fe,"modelViewMatrix",Ve.modelViewMatrix),ci.setValue(Fe,"normalMatrix",Ve.normalMatrix),ci.setValue(Fe,"modelMatrix",Ve.matrixWorld),Be.isShaderMaterial||Be.isRawShaderMaterial){const di=Be.uniformsGroups;for(let Aa=0,ca=di.length;Aa<ca;Aa++){const Un=di[Aa];Lt.update(Un,Xn),Lt.bind(Un,Xn)}}return Xn}function Hn(oe,Ee){oe.ambientLightColor.needsUpdate=Ee,oe.lightProbe.needsUpdate=Ee,oe.directionalLights.needsUpdate=Ee,oe.directionalLightShadows.needsUpdate=Ee,oe.pointLights.needsUpdate=Ee,oe.pointLightShadows.needsUpdate=Ee,oe.spotLights.needsUpdate=Ee,oe.spotLightShadows.needsUpdate=Ee,oe.rectAreaLights.needsUpdate=Ee,oe.hemisphereLights.needsUpdate=Ee}function zn(oe){return oe.isMeshLambertMaterial||oe.isMeshToonMaterial||oe.isMeshPhongMaterial||oe.isMeshStandardMaterial||oe.isShadowMaterial||oe.isShaderMaterial&&oe.lights===!0}this.getActiveCubeFace=function(){return fe},this.getActiveMipmapLevel=function(){return Z},this.getRenderTarget=function(){return te},this.setRenderTargetTextures=function(oe,Ee,Ue){J.get(oe.texture).__webglTexture=Ee,J.get(oe.depthTexture).__webglTexture=Ue;const Be=J.get(oe);Be.__hasExternalTextures=!0,Be.__autoAllocateDepthBuffer=Ue===void 0,Be.__autoAllocateDepthBuffer||an.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Be.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(oe,Ee){const Ue=J.get(oe);Ue.__webglFramebuffer=Ee,Ue.__useDefaultFramebuffer=Ee===void 0},this.setRenderTarget=function(oe,Ee=0,Ue=0){te=oe,fe=Ee,Z=Ue;let Be=!0,Ve=null,vt=!1,jt=!1;if(oe){const Bt=J.get(oe);Bt.__useDefaultFramebuffer!==void 0?(Wt.bindFramebuffer(Fe.FRAMEBUFFER,null),Be=!1):Bt.__webglFramebuffer===void 0?re.setupRenderTarget(oe):Bt.__hasExternalTextures&&re.rebindTextures(oe,J.get(oe.texture).__webglTexture,J.get(oe.depthTexture).__webglTexture);const ln=oe.texture;(ln.isData3DTexture||ln.isDataArrayTexture||ln.isCompressedArrayTexture)&&(jt=!0);const Ft=J.get(oe).__webglFramebuffer;oe.isWebGLCubeRenderTarget?(Array.isArray(Ft[Ee])?Ve=Ft[Ee][Ue]:Ve=Ft[Ee],vt=!0):oe.samples>0&&re.useMultisampledRTT(oe)===!1?Ve=J.get(oe).__webglMultisampledFramebuffer:Array.isArray(Ft)?Ve=Ft[Ue]:Ve=Ft,K.copy(oe.viewport),Pe.copy(oe.scissor),ke=oe.scissorTest}else K.copy(Ye).multiplyScalar(st).floor(),Pe.copy(pt).multiplyScalar(st).floor(),ke=kt;if(Wt.bindFramebuffer(Fe.FRAMEBUFFER,Ve)&&Be&&Wt.drawBuffers(oe,Ve),Wt.viewport(K),Wt.scissor(Pe),Wt.setScissorTest(ke),vt){const Bt=J.get(oe.texture);Fe.framebufferTexture2D(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Fe.TEXTURE_CUBE_MAP_POSITIVE_X+Ee,Bt.__webglTexture,Ue)}else if(jt){const Bt=J.get(oe.texture),ln=Ee||0;Fe.framebufferTextureLayer(Fe.FRAMEBUFFER,Fe.COLOR_ATTACHMENT0,Bt.__webglTexture,Ue||0,ln)}be=-1},this.readRenderTargetPixels=function(oe,Ee,Ue,Be,Ve,vt,jt){if(!(oe&&oe.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let bt=J.get(oe).__webglFramebuffer;if(oe.isWebGLCubeRenderTarget&&jt!==void 0&&(bt=bt[jt]),bt){Wt.bindFramebuffer(Fe.FRAMEBUFFER,bt);try{const Bt=oe.texture,ln=Bt.format,Ft=Bt.type;if(ln!==wa&&nt.convert(ln)!==Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const vn=Ft===Vg&&(an.has("EXT_color_buffer_half_float")||an.has("EXT_color_buffer_float"));if(Ft!==_l&&nt.convert(Ft)!==Fe.getParameter(Fe.IMPLEMENTATION_COLOR_READ_TYPE)&&Ft!==al&&!vn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ee>=0&&Ee<=oe.width-Be&&Ue>=0&&Ue<=oe.height-Ve&&Fe.readPixels(Ee,Ue,Be,Ve,nt.convert(ln),nt.convert(Ft),vt)}finally{const Bt=te!==null?J.get(te).__webglFramebuffer:null;Wt.bindFramebuffer(Fe.FRAMEBUFFER,Bt)}}},this.copyFramebufferToTexture=function(oe,Ee,Ue=0){const Be=Math.pow(2,-Ue),Ve=Math.floor(Ee.image.width*Be),vt=Math.floor(Ee.image.height*Be);re.setTexture2D(Ee,0),Fe.copyTexSubImage2D(Fe.TEXTURE_2D,Ue,0,0,oe.x,oe.y,Ve,vt),Wt.unbindTexture()},this.copyTextureToTexture=function(oe,Ee,Ue,Be=0){const Ve=Ee.image.width,vt=Ee.image.height,jt=nt.convert(Ue.format),bt=nt.convert(Ue.type);re.setTexture2D(Ue,0),Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,Ue.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ue.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,Ue.unpackAlignment),Ee.isDataTexture?Fe.texSubImage2D(Fe.TEXTURE_2D,Be,oe.x,oe.y,Ve,vt,jt,bt,Ee.image.data):Ee.isCompressedTexture?Fe.compressedTexSubImage2D(Fe.TEXTURE_2D,Be,oe.x,oe.y,Ee.mipmaps[0].width,Ee.mipmaps[0].height,jt,Ee.mipmaps[0].data):Fe.texSubImage2D(Fe.TEXTURE_2D,Be,oe.x,oe.y,jt,bt,Ee.image),Be===0&&Ue.generateMipmaps&&Fe.generateMipmap(Fe.TEXTURE_2D),Wt.unbindTexture()},this.copyTextureToTexture3D=function(oe,Ee,Ue,Be,Ve=0){const vt=Math.round(oe.max.x-oe.min.x),jt=Math.round(oe.max.y-oe.min.y),bt=oe.max.z-oe.min.z+1,Bt=nt.convert(Be.format),ln=nt.convert(Be.type);let Ft;if(Be.isData3DTexture)re.setTexture3D(Be,0),Ft=Fe.TEXTURE_3D;else if(Be.isDataArrayTexture||Be.isCompressedArrayTexture)re.setTexture2DArray(Be,0),Ft=Fe.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}Fe.pixelStorei(Fe.UNPACK_FLIP_Y_WEBGL,Be.flipY),Fe.pixelStorei(Fe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Be.premultiplyAlpha),Fe.pixelStorei(Fe.UNPACK_ALIGNMENT,Be.unpackAlignment);const vn=Fe.getParameter(Fe.UNPACK_ROW_LENGTH),ai=Fe.getParameter(Fe.UNPACK_IMAGE_HEIGHT),Yn=Fe.getParameter(Fe.UNPACK_SKIP_PIXELS),jn=Fe.getParameter(Fe.UNPACK_SKIP_ROWS),qr=Fe.getParameter(Fe.UNPACK_SKIP_IMAGES),An=Ue.isCompressedTexture?Ue.mipmaps[Ve]:Ue.image;Fe.pixelStorei(Fe.UNPACK_ROW_LENGTH,An.width),Fe.pixelStorei(Fe.UNPACK_IMAGE_HEIGHT,An.height),Fe.pixelStorei(Fe.UNPACK_SKIP_PIXELS,oe.min.x),Fe.pixelStorei(Fe.UNPACK_SKIP_ROWS,oe.min.y),Fe.pixelStorei(Fe.UNPACK_SKIP_IMAGES,oe.min.z),Ue.isDataTexture||Ue.isData3DTexture?Fe.texSubImage3D(Ft,Ve,Ee.x,Ee.y,Ee.z,vt,jt,bt,Bt,ln,An.data):Be.isCompressedArrayTexture?Fe.compressedTexSubImage3D(Ft,Ve,Ee.x,Ee.y,Ee.z,vt,jt,bt,Bt,An.data):Fe.texSubImage3D(Ft,Ve,Ee.x,Ee.y,Ee.z,vt,jt,bt,Bt,ln,An),Fe.pixelStorei(Fe.UNPACK_ROW_LENGTH,vn),Fe.pixelStorei(Fe.UNPACK_IMAGE_HEIGHT,ai),Fe.pixelStorei(Fe.UNPACK_SKIP_PIXELS,Yn),Fe.pixelStorei(Fe.UNPACK_SKIP_ROWS,jn),Fe.pixelStorei(Fe.UNPACK_SKIP_IMAGES,qr),Ve===0&&Be.generateMipmaps&&Fe.generateMipmap(Ft),Wt.unbindTexture()},this.initTexture=function(oe){oe.isCubeTexture?re.setTextureCube(oe,0):oe.isData3DTexture?re.setTexture3D(oe,0):oe.isDataArrayTexture||oe.isCompressedArrayTexture?re.setTexture2DArray(oe,0):re.setTexture2D(oe,0),Wt.unbindTexture()},this.resetState=function(){fe=0,Z=0,te=null,Wt.reset(),Rt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ro}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===Xx?"display-p3":"srgb",t.unpackColorSpace=ri.workingColorSpace===f_?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class XN extends ys{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new fo,this.environmentIntensity=1,this.environmentRotation=new fo,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class eh extends Al{constructor(e=1,t=32,i=16,o=0,h=Math.PI*2,f=0,c=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:o,phiLength:h,thetaStart:f,thetaLength:c},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const v=Math.min(f+c,Math.PI);let w=0;const S=[],E=new $e,M=new $e,L=[],U=[],B=[],z=[];for(let R=0;R<=i;R++){const G=[],V=R/i;let ee=0;R===0&&f===0?ee=.5/t:R===i&&v===Math.PI&&(ee=-.5/t);for(let fe=0;fe<=t;fe++){const Z=fe/t;E.x=-e*Math.cos(o+Z*h)*Math.sin(f+V*c),E.y=e*Math.cos(f+V*c),E.z=e*Math.sin(o+Z*h)*Math.sin(f+V*c),U.push(E.x,E.y,E.z),M.copy(E).normalize(),B.push(M.x,M.y,M.z),z.push(Z+ee,1-V),G.push(w++)}S.push(G)}for(let R=0;R<i;R++)for(let G=0;G<t;G++){const V=S[R][G+1],ee=S[R][G],fe=S[R+1][G],Z=S[R+1][G+1];(R!==0||f>0)&&L.push(V,ee,Z),(R!==i-1||v<Math.PI)&&L.push(ee,fe,Z)}this.setIndex(L),this.setAttribute("position",new Ea(U,3)),this.setAttribute("normal",new Ea(B,3)),this.setAttribute("uv",new Ea(z,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new eh(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const BM={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class qN{constructor(e,t,i){const o=this;let h=!1,f=0,c=0,v;const w=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(S){c++,h===!1&&o.onStart!==void 0&&o.onStart(S,f,c),h=!0},this.itemEnd=function(S){f++,o.onProgress!==void 0&&o.onProgress(S,f,c),f===c&&(h=!1,o.onLoad!==void 0&&o.onLoad())},this.itemError=function(S){o.onError!==void 0&&o.onError(S)},this.resolveURL=function(S){return v?v(S):S},this.setURLModifier=function(S){return v=S,this},this.addHandler=function(S,E){return w.push(S,E),this},this.removeHandler=function(S){const E=w.indexOf(S);return E!==-1&&w.splice(E,2),this},this.getHandler=function(S){for(let E=0,M=w.length;E<M;E+=2){const L=w[E],U=w[E+1];if(L.global&&(L.lastIndex=0),L.test(S))return U}return null}}}const ZN=new qN;class Kx{constructor(e){this.manager=e!==void 0?e:ZN,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(o,h){i.load(e,o,t,h)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Kx.DEFAULT_MATERIAL_NAME="__DEFAULT";class YN extends Kx{constructor(e){super(e)}load(e,t,i,o){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const h=this,f=BM.get(e);if(f!==void 0)return h.manager.itemStart(e),setTimeout(function(){t&&t(f),h.manager.itemEnd(e)},0),f;const c=Gf("img");function v(){S(),BM.add(e,this),t&&t(this),h.manager.itemEnd(e)}function w(E){S(),o&&o(E),h.manager.itemError(e),h.manager.itemEnd(e)}function S(){c.removeEventListener("load",v,!1),c.removeEventListener("error",w,!1)}return c.addEventListener("load",v,!1),c.addEventListener("error",w,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(c.crossOrigin=this.crossOrigin),h.manager.itemStart(e),c.src=e,c}}class KN extends Kx{constructor(e){super(e)}load(e,t,i,o){const h=new Wr,f=new YN(this.manager);return f.setCrossOrigin(this.crossOrigin),f.setPath(this.path),f.load(e,function(c){h.image=c,h.needsUpdate=!0,t!==void 0&&t(h)},i,o),h}}class VM{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(Rr(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:$x}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=$x);const GM={type:"change"},D0={type:"start"},HM={type:"end"},Jm=new iA,jM=new el,JN=Math.cos(70*kz.DEG2RAD);class QN extends Ac{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new $e,this.cursor=new $e,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:gu.ROTATE,MIDDLE:gu.DOLLY,RIGHT:gu.PAN},this.touches={ONE:_u.ROTATE,TWO:_u.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return c.phi},this.getAzimuthalAngle=function(){return c.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function($){$.addEventListener("keydown",$t),this._domElementKeyEvents=$},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",$t),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(GM),i.update(),h=o.NONE},this.update=function(){const $=new $e,Le=new Sc().setFromUnitVectors(e.up,new $e(0,1,0)),rt=Le.clone().invert(),wt=new $e,se=new Sc,k=new $e,F=2*Math.PI;return function(Y=null){const ue=i.object.position;$.copy(ue).sub(i.target),$.applyQuaternion(Le),c.setFromVector3($),i.autoRotate&&h===o.NONE&&ke(K(Y)),i.enableDamping?(c.theta+=v.theta*i.dampingFactor,c.phi+=v.phi*i.dampingFactor):(c.theta+=v.theta,c.phi+=v.phi);let ye=i.minAzimuthAngle,xe=i.maxAzimuthAngle;isFinite(ye)&&isFinite(xe)&&(ye<-Math.PI?ye+=F:ye>Math.PI&&(ye-=F),xe<-Math.PI?xe+=F:xe>Math.PI&&(xe-=F),ye<=xe?c.theta=Math.max(ye,Math.min(xe,c.theta)):c.theta=c.theta>(ye+xe)/2?Math.max(ye,c.theta):Math.min(xe,c.theta)),c.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,c.phi)),c.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(S,i.dampingFactor):i.target.add(S),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let he=!1;if(i.zoomToCursor&&Z||i.object.isOrthographicCamera)c.radius=Ye(c.radius);else{const Se=c.radius;c.radius=Ye(c.radius*w),he=Se!=c.radius}if($.setFromSpherical(c),$.applyQuaternion(rt),ue.copy(i.target).add($),i.object.lookAt(i.target),i.enableDamping===!0?(v.theta*=1-i.dampingFactor,v.phi*=1-i.dampingFactor,S.multiplyScalar(1-i.dampingFactor)):(v.set(0,0,0),S.set(0,0,0)),i.zoomToCursor&&Z){let Se=null;if(i.object.isPerspectiveCamera){const Ne=$.length();Se=Ye(Ne*w);const Ge=Ne-Se;i.object.position.addScaledVector(ee,Ge),i.object.updateMatrixWorld(),he=!!Ge}else if(i.object.isOrthographicCamera){const Ne=new $e(fe.x,fe.y,0);Ne.unproject(i.object);const Ge=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/w)),i.object.updateProjectionMatrix(),he=Ge!==i.object.zoom;const ze=new $e(fe.x,fe.y,0);ze.unproject(i.object),i.object.position.sub(ze).add(Ne),i.object.updateMatrixWorld(),Se=$.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Se!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Se).add(i.object.position):(Jm.origin.copy(i.object.position),Jm.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Jm.direction))<JN?e.lookAt(i.target):(jM.setFromNormalAndCoplanarPoint(i.object.up,i.target),Jm.intersectPlane(jM,i.target))))}else if(i.object.isOrthographicCamera){const Se=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/w)),Se!==i.object.zoom&&(i.object.updateProjectionMatrix(),he=!0)}return w=1,Z=!1,he||wt.distanceToSquared(i.object.position)>f||8*(1-se.dot(i.object.quaternion))>f||k.distanceToSquared(i.target)>f?(i.dispatchEvent(GM),wt.copy(i.object.position),se.copy(i.object.quaternion),k.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Nt),i.domElement.removeEventListener("pointerdown",Je),i.domElement.removeEventListener("pointercancel",at),i.domElement.removeEventListener("wheel",mt),i.domElement.removeEventListener("pointermove",Xe),i.domElement.removeEventListener("pointerup",at),i.domElement.getRootNode().removeEventListener("keydown",rn,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",$t),i._domElementKeyEvents=null)};const i=this,o={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let h=o.NONE;const f=1e-6,c=new VM,v=new VM;let w=1;const S=new $e,E=new Pn,M=new Pn,L=new Pn,U=new Pn,B=new Pn,z=new Pn,R=new Pn,G=new Pn,V=new Pn,ee=new $e,fe=new Pn;let Z=!1;const te=[],be={};let ae=!1;function K($){return $!==null?2*Math.PI/60*i.autoRotateSpeed*$:2*Math.PI/60/60*i.autoRotateSpeed}function Pe($){const Le=Math.abs($*.01);return Math.pow(.95,i.zoomSpeed*Le)}function ke($){v.theta-=$}function Te($){v.phi-=$}const je=function(){const $=new $e;return function(rt,wt){$.setFromMatrixColumn(wt,0),$.multiplyScalar(-rt),S.add($)}}(),it=function(){const $=new $e;return function(rt,wt){i.screenSpacePanning===!0?$.setFromMatrixColumn(wt,1):($.setFromMatrixColumn(wt,0),$.crossVectors(i.object.up,$)),$.multiplyScalar(rt),S.add($)}}(),ut=function(){const $=new $e;return function(rt,wt){const se=i.domElement;if(i.object.isPerspectiveCamera){const k=i.object.position;$.copy(k).sub(i.target);let F=$.length();F*=Math.tan(i.object.fov/2*Math.PI/180),je(2*rt*F/se.clientHeight,i.object.matrix),it(2*wt*F/se.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(je(rt*(i.object.right-i.object.left)/i.object.zoom/se.clientWidth,i.object.matrix),it(wt*(i.object.top-i.object.bottom)/i.object.zoom/se.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function st($){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?w/=$:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Ce($){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?w*=$:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Ke($,Le){if(!i.zoomToCursor)return;Z=!0;const rt=i.domElement.getBoundingClientRect(),wt=$-rt.left,se=Le-rt.top,k=rt.width,F=rt.height;fe.x=wt/k*2-1,fe.y=-(se/F)*2+1,ee.set(fe.x,fe.y,1).unproject(i.object).sub(i.object.position).normalize()}function Ye($){return Math.max(i.minDistance,Math.min(i.maxDistance,$))}function pt($){E.set($.clientX,$.clientY)}function kt($){Ke($.clientX,$.clientX),R.set($.clientX,$.clientY)}function _n($){U.set($.clientX,$.clientY)}function Ze($){M.set($.clientX,$.clientY),L.subVectors(M,E).multiplyScalar(i.rotateSpeed);const Le=i.domElement;ke(2*Math.PI*L.x/Le.clientHeight),Te(2*Math.PI*L.y/Le.clientHeight),E.copy(M),i.update()}function _t($){G.set($.clientX,$.clientY),V.subVectors(G,R),V.y>0?st(Pe(V.y)):V.y<0&&Ce(Pe(V.y)),R.copy(G),i.update()}function Ct($){B.set($.clientX,$.clientY),z.subVectors(B,U).multiplyScalar(i.panSpeed),ut(z.x,z.y),U.copy(B),i.update()}function St($){Ke($.clientX,$.clientY),$.deltaY<0?Ce(Pe($.deltaY)):$.deltaY>0&&st(Pe($.deltaY)),i.update()}function un($){let Le=!1;switch($.code){case i.keys.UP:$.ctrlKey||$.metaKey||$.shiftKey?Te(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ut(0,i.keyPanSpeed),Le=!0;break;case i.keys.BOTTOM:$.ctrlKey||$.metaKey||$.shiftKey?Te(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ut(0,-i.keyPanSpeed),Le=!0;break;case i.keys.LEFT:$.ctrlKey||$.metaKey||$.shiftKey?ke(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ut(i.keyPanSpeed,0),Le=!0;break;case i.keys.RIGHT:$.ctrlKey||$.metaKey||$.shiftKey?ke(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ut(-i.keyPanSpeed,0),Le=!0;break}Le&&($.preventDefault(),i.update())}function mn($){if(te.length===1)E.set($.pageX,$.pageY);else{const Le=Lt($),rt=.5*($.pageX+Le.x),wt=.5*($.pageY+Le.y);E.set(rt,wt)}}function yn($){if(te.length===1)U.set($.pageX,$.pageY);else{const Le=Lt($),rt=.5*($.pageX+Le.x),wt=.5*($.pageY+Le.y);U.set(rt,wt)}}function Fe($){const Le=Lt($),rt=$.pageX-Le.x,wt=$.pageY-Le.y,se=Math.sqrt(rt*rt+wt*wt);R.set(0,se)}function dn($){i.enableZoom&&Fe($),i.enablePan&&yn($)}function an($){i.enableZoom&&Fe($),i.enableRotate&&mn($)}function Vn($){if(te.length==1)M.set($.pageX,$.pageY);else{const rt=Lt($),wt=.5*($.pageX+rt.x),se=.5*($.pageY+rt.y);M.set(wt,se)}L.subVectors(M,E).multiplyScalar(i.rotateSpeed);const Le=i.domElement;ke(2*Math.PI*L.x/Le.clientHeight),Te(2*Math.PI*L.y/Le.clientHeight),E.copy(M)}function Wt($){if(te.length===1)B.set($.pageX,$.pageY);else{const Le=Lt($),rt=.5*($.pageX+Le.x),wt=.5*($.pageY+Le.y);B.set(rt,wt)}z.subVectors(B,U).multiplyScalar(i.panSpeed),ut(z.x,z.y),U.copy(B)}function En($){const Le=Lt($),rt=$.pageX-Le.x,wt=$.pageY-Le.y,se=Math.sqrt(rt*rt+wt*wt);G.set(0,se),V.set(0,Math.pow(G.y/R.y,i.zoomSpeed)),st(V.y),R.copy(G);const k=($.pageX+Le.x)*.5,F=($.pageY+Le.y)*.5;Ke(k,F)}function J($){i.enableZoom&&En($),i.enablePan&&Wt($)}function re($){i.enableZoom&&En($),i.enableRotate&&Vn($)}function Je($){i.enabled!==!1&&(te.length===0&&(i.domElement.setPointerCapture($.pointerId),i.domElement.addEventListener("pointermove",Xe),i.domElement.addEventListener("pointerup",at)),!nt($)&&(bn($),$.pointerType==="touch"?qe($):ft($)))}function Xe($){i.enabled!==!1&&($.pointerType==="touch"?Gt($):nn($))}function at($){switch(wn($),te.length){case 0:i.domElement.releasePointerCapture($.pointerId),i.domElement.removeEventListener("pointermove",Xe),i.domElement.removeEventListener("pointerup",at),i.dispatchEvent(HM),h=o.NONE;break;case 1:const Le=te[0],rt=be[Le];qe({pointerId:Le,pageX:rt.x,pageY:rt.y});break}}function ft($){let Le;switch($.button){case 0:Le=i.mouseButtons.LEFT;break;case 1:Le=i.mouseButtons.MIDDLE;break;case 2:Le=i.mouseButtons.RIGHT;break;default:Le=-1}switch(Le){case gu.DOLLY:if(i.enableZoom===!1)return;kt($),h=o.DOLLY;break;case gu.ROTATE:if($.ctrlKey||$.metaKey||$.shiftKey){if(i.enablePan===!1)return;_n($),h=o.PAN}else{if(i.enableRotate===!1)return;pt($),h=o.ROTATE}break;case gu.PAN:if($.ctrlKey||$.metaKey||$.shiftKey){if(i.enableRotate===!1)return;pt($),h=o.ROTATE}else{if(i.enablePan===!1)return;_n($),h=o.PAN}break;default:h=o.NONE}h!==o.NONE&&i.dispatchEvent(D0)}function nn($){switch(h){case o.ROTATE:if(i.enableRotate===!1)return;Ze($);break;case o.DOLLY:if(i.enableZoom===!1)return;_t($);break;case o.PAN:if(i.enablePan===!1)return;Ct($);break}}function mt($){i.enabled===!1||i.enableZoom===!1||h!==o.NONE||($.preventDefault(),i.dispatchEvent(D0),St(Kt($)),i.dispatchEvent(HM))}function Kt($){const Le=$.deltaMode,rt={clientX:$.clientX,clientY:$.clientY,deltaY:$.deltaY};switch(Le){case 1:rt.deltaY*=16;break;case 2:rt.deltaY*=100;break}return $.ctrlKey&&!ae&&(rt.deltaY*=10),rt}function rn($){$.key==="Control"&&(ae=!0,i.domElement.getRootNode().addEventListener("keyup",Tt,{passive:!0,capture:!0}))}function Tt($){$.key==="Control"&&(ae=!1,i.domElement.getRootNode().removeEventListener("keyup",Tt,{passive:!0,capture:!0}))}function $t($){i.enabled===!1||i.enablePan===!1||un($)}function qe($){switch(Rt($),te.length){case 1:switch(i.touches.ONE){case _u.ROTATE:if(i.enableRotate===!1)return;mn($),h=o.TOUCH_ROTATE;break;case _u.PAN:if(i.enablePan===!1)return;yn($),h=o.TOUCH_PAN;break;default:h=o.NONE}break;case 2:switch(i.touches.TWO){case _u.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;dn($),h=o.TOUCH_DOLLY_PAN;break;case _u.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;an($),h=o.TOUCH_DOLLY_ROTATE;break;default:h=o.NONE}break;default:h=o.NONE}h!==o.NONE&&i.dispatchEvent(D0)}function Gt($){switch(Rt($),h){case o.TOUCH_ROTATE:if(i.enableRotate===!1)return;Vn($),i.update();break;case o.TOUCH_PAN:if(i.enablePan===!1)return;Wt($),i.update();break;case o.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;J($),i.update();break;case o.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;re($),i.update();break;default:h=o.NONE}}function Nt($){i.enabled!==!1&&$.preventDefault()}function bn($){te.push($.pointerId)}function wn($){delete be[$.pointerId];for(let Le=0;Le<te.length;Le++)if(te[Le]==$.pointerId){te.splice(Le,1);return}}function nt($){for(let Le=0;Le<te.length;Le++)if(te[Le]==$.pointerId)return!0;return!1}function Rt($){let Le=be[$.pointerId];Le===void 0&&(Le=new Pn,be[$.pointerId]=Le),Le.set($.pageX,$.pageY)}function Lt($){const Le=$.pointerId===te[0]?te[1]:te[0];return be[Le]}i.domElement.addEventListener("contextmenu",Nt),i.domElement.addEventListener("pointerdown",Je),i.domElement.addEventListener("pointercancel",at),i.domElement.addEventListener("wheel",mt,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",rn,{passive:!0,capture:!0}),this.update()}}const eO=`uniform float radius;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vPosWorld;
varying vec3 vLightPos;


void main() {
    vec3 sun = vLightPos;
    vec3 normal = normalize(vNormal);
    vec3 posToSun = normalize(sun - vPos);
    float diffuseLightness = dot(posToSun, normal) + 0.6;

    float distanceFromCenter = sqrt(vPosWorld.x * vPosWorld.x + vPosWorld.y * vPosWorld.y) / radius;

    float alpha = 1.0;
    float taperStart = 0.9;
    if (distanceFromCenter > taperStart) {
        float decline = 1.0 / (1.0 - taperStart);
        float offset = distanceFromCenter - taperStart;
        alpha = 1.0 - offset * offset * decline * decline;
    }

    gl_FragColor = vec4(0.6, 0.7, 0.8, alpha - 0.2);
    gl_FragColor.w *= diffuseLightness;
}`,tO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
varying vec3 vPosWorld;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vPosWorld = (modelMatrix * vec4(position, 1)).xyz;  // world-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}
`,nO=`varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
uniform sampler2D cloudTex;


void main() {
    vec3 lightPos = vLightPos;
    vec3 lightDir = normalize(lightPos - vPos);
    float lightness = dot(lightDir, vNormal);
    vec4 cloudColor = texture(cloudTex, vUv);
    gl_FragColor = cloudColor;
    gl_FragColor.xyz *= lightness;
}
`,iO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`,rO=`uniform sampler2D dayTexture;
uniform sampler2D nightTexture;
uniform sampler2D displacementMap;
uniform sampler2D normalMap;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vLightPos;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    // texture data
    vec3 normalColor = texture(normalMap, vUv).xyz;
    vec3 landColor = texture(dayTexture, vUv).xyz;
    vec3 nightColor = texture(nightTexture, vUv).xyz;

    // derived data
    vec3 sun = vLightPos;
    vec3 normal = normalize(vNormal + normalColor);
    vec3 posToSun = normalize(sun - vPos);
    float diffuseLightness = dot(posToSun, normal) + 0.6;

    // mixing
    landColor = brighten(landColor, diffuseLightness);
    nightColor = brighten(nightColor, 1.0 - diffuseLightness);
    vec3 outColor = mix(nightColor, landColor, diffuseLightness);

    gl_FragColor = vec4(outColor, 1.0);
}`,sO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
uniform sampler2D displacementMap;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 heightColor = texture(displacementMap, uv);
  vec3 displacedPosition = position * (1.0 + 0.1 * heightColor.x);
  vec4 newPosCamSpace = modelViewMatrix * vec4(displacedPosition, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}`,aO=`varying vec2 vUv;           // texture-space
varying vec3 vNormal;       // cam-space
varying vec3 vPos;          // cam-space
varying vec3 vLightPos;     // cam-space
uniform float time;
uniform sampler2D landDistance;
uniform sampler2D heightMap;
uniform sampler2D groundTexture;
uniform sampler2D waterNormal1;
uniform sampler2D waterNormal2;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    float landHeight = 0.5;

    // texture data
    float distFromShore = texture(landDistance, vUv).x;
    vec3 groundColor    = texture(groundTexture, vUv).xyz;
    float height        = texture(heightMap, vUv).x;
    vec3 normal1        = texture(waterNormal1, 2.0 * vUv + vec2(0.01, -0.01) * time).xyz;
    vec3 normal2        = texture(waterNormal2, 4.0 * vUv + vec2(-0.01, 0.01) * time).xyz;

    // derived values
    vec3 normal = normalize(vNormal +  0.1 * normal1 + 0.2 * normal2);
    vec3 pos = vPos;
    vec3 sun = vLightPos;
    vec3 pos2cam = vec3(0) - pos;
    vec3 pos2sun = sun - pos;
    float nScale = dot(normal, pos2sun);
    vec3 sunReflected = 2.0 * nScale * normal - sun;
    vec3 pos2reflection = sunReflected - pos;

    // 1. diffuse
    float sunNormalAlignment = dot(normalize(pos2sun), normal);
    float diffuseLightness = sunNormalAlignment;
    
    // 2. specular
    float m = 0.15;
    float pi = 3.14159265359;
    float specAngle = acos(dot(normalize(pos2cam), normalize(pos2reflection)));
    float specularLightness = exp(-(specAngle / m) * (specAngle / m));
    
    // 3. surf
    float surf = 0.0;
    float maxDistFromShore = 0.2;
    if (distFromShore < maxDistFromShore && height < landHeight) {
        surf = sin(distFromShore * 400.0 + time * 5.0) * (1.0 - distFromShore / maxDistFromShore);
    } 

    // 4. combine
    vec3 outColor = groundColor * 0.5                // night color
                  + groundColor * diffuseLightness   // diffuse sunlit color
                  + vec3(surf)  * 0.2                // surf
                  + vec3(1.0)   * specularLightness; // specular

    gl_FragColor = vec4(outColor, 1.0);

    // if (height >= landHeight) {
    //     gl_FragColor = vec4(0);
    // }
}`,oO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`;async function lO(n){const e=new KN,t={},i=[];for(const[o,h]of Object.entries(n)){const f=e.loadAsync(h).then(c=>t[o]=c);i.push(f)}return await Promise.all(i),t}class cO{constructor(e,t){tt(this,"water");tt(this,"sky");tt(this,"earth");tt(this,"renderer");tt(this,"camera");tt(this,"scene");tt(this,"controls");const{stars:i,earthDay:o,earthNight:h,earthNormal:f,earthHeight:c,landDistance:v,waterNormal1:w,waterNormal2:S,clouds:E}=t,M=100,L=new $N({canvas:e,antialias:!0,failIfMajorPerformanceCaveat:!0}),U=new XN;U.background=i;const B=new Ds(50,e.clientWidth/e.clientHeight,.1*M,3*M);B.position.set(0,0,-3*M),B.lookAt(U.position);const z=new $e(1e3,0,0),R=new QN(B,e),G=new lf;G.position.set(0,0,0),U.add(G);const V=new gs(new eh(M,500,250),new Ns({vertexShader:sO,fragmentShader:rO,uniforms:{lightPos:{value:z},dayTexture:{value:o},nightTexture:{value:h},normalMap:{value:f},displacementMap:{value:c}}}));G.add(V);const ee=new gs(new eh(M+5,200,100),new Ns({vertexShader:oO,fragmentShader:aO,uniforms:{lightPos:{value:z},time:{value:0},groundTexture:{value:o},heightMap:{value:c},landDistance:{value:v},waterNormal1:{value:w},waterNormal2:{value:S}}}));G.add(ee);const fe=new gs(new eh(M+7),new Ns({vertexShader:iO,fragmentShader:nO,uniforms:{lightPos:{value:z},cloudTex:{value:E}},transparent:!0}));G.add(fe);const Z=M+8,te=new gs(new eh(Z),new Ns({fragmentShader:eO,vertexShader:tO,uniforms:{radius:{value:Z},lightPos:{value:z}},transparent:!0,side:jr}));G.add(te),this.water=ee,this.sky=fe,this.earth=G,this.renderer=L,this.camera=B,this.scene=U,this.controls=R}step(e){this.water.material.uniforms.time.value=e.time,this.sky.rotateY(.001),this.earth.rotateY(.001),this.renderer.render(this.scene,this.camera),this.controls.update()}destroy(e){const t=i=>{console.log("dispose material!"),i.dispose();for(const o of Object.keys(i)){const h=i[o];h&&typeof h=="object"&&"minFilter"in h&&(console.log("dispose texture!"),h.dispose())}};this.renderer.dispose(),this.scene.traverse(i=>{if(i.isMesh)if(i.geometry.dispose(),i.material.isMaterial)t(i.material);else for(const o of i.material)t(o)})}}class uO{constructor(){tt(this,"destroyed",!1);tt(this,"loop");tt(this,"rp")}async init(e){e.width=e.clientWidth,e.height=e.clientHeight;const{earthDay:t,earthNight:i,earthHeight:o,earthNormal:h,landDistance:f,waterNormal1:c,waterNormal2:v,clouds:w,stars:S}=await lO({earthDay:"/earth.jpg",earthNight:"/earth_night.jpg",earthHeight:"/earth_height.jpg",earthNormal:"/earth_normal.jpg",landDistance:"/land_distance.jpg",waterNormal1:"/water-normal2.jpg",waterNormal2:"/water-normal3.jpg",clouds:"/earth_clouds.png",stars:"/stars.jpg"});if(c.wrapS=Ju,c.wrapT=Ju,v.wrapS=Ju,v.wrapT=Ju,this.destroyed)return;const E=new cO(e,{earthDay:t,earthNight:i,earthHeight:o,earthNormal:h,landDistance:f,waterNormal1:c,waterNormal2:v,clouds:w,stars:S});this.loop=new Ec(30,M=>{E.step({time:M/1e3})}),this.rp=E}startLoop(){var e;(e=this.loop)==null||e.startLoop()}destroy(){var e,t;(e=this.loop)==null||e.stopLoop(),(t=this.rp)==null||t.destroy(!0),this.destroyed=!0}}function hO(){const n=ct.useRef(null);return ct.useEffect(()=>{const e=new uO;return n.current&&e.init(n.current).then(()=>e.startLoop()),()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}function dO(n){const e=ct.Children.toArray(n.children),t=Math.floor(Math.random()*e.length);return e[t]}function WM(n){return ge.jsx("div",{className:"hoverBox",onClick:e=>{n.clickAction&&n.clickAction(e)},style:{cursor:n.clickAction?"pointer":"default"},children:n.children})}function fO(n){const e=ct.useRef(null);return ct.useEffect(()=>{const t=o=>{for(const h of o)h.isIntersecting&&h.target.classList.add("viewed")},i=new IntersectionObserver(t,{rootMargin:"-10%"});return e.current&&i.observe(e.current),()=>{e.current&&i.unobserve(e.current),i.disconnect}},[e.current]),ge.jsx("div",{ref:e,className:"animatedBlock","data-animationtype":n.direction,children:n.children})}function $M(n){const e=ct.Children.count(n.children);function t(i){return i<=0?"fromLeft":i>=e-1?"fromRight":"fromBottom"}return ge.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap"},children:n.children&&ct.Children.map(n.children,(i,o)=>ge.jsx("div",{style:{flex:"1 0 50%"},children:ge.jsx(fO,{direction:t(o),children:i},o)}))})}const XM=I2(()=>[128,0,0,255],512,512);class pO{constructor(e,t){tt(this,"gs");tt(this,"ripplesG1");tt(this,"refractionG1");tt(this,"ripplesG2");tt(this,"refractionG2");tt(this,"bgTex");tt(this,"i",0);const i=e.getContext("webgl2"),o=new Ph(i,{}),h=Kf(0,0,2,2),f=new Fs(i,{data:new Float32Array(h.flat()),changesOften:!1}),c=new Og(i,{data:XM,t:"ubyte4",interpolate:"linear",edges:"clamp"}),v=new Og(i,{data:XM,t:"ubyte4",interpolate:"linear",edges:"clamp"});let w;if(t.bgImg)w=new $i(i,{image:t.bgImg});else if(t.bgVideo)w=new tS(i,{video:t.bgVideo});else throw Error("Must provide either bgImg or bgVideo");const S=new Di(o,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
            gl_Position = vec4(pos.xy, 0, 1);
            uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          in vec2 uv;
          uniform sampler2D pvpNormTex;
          uniform vec2 size;
          uniform vec3 userXYh;
          out vec4 fragColor;
  
          float minVal = -1.0;
          float maxVal =  1.0;
          float tex2val(float t) {
            return t * (maxVal - minVal) + minVal;
          }
          float val2tex(float v) {
            return (v - minVal) / (maxVal - minVal);
          }
  
          void main() {
  
            float delta = 1.4;
    
            float dx = 0.5 * 1.0 / size.x;
            float dy = 0.5 * 1.0 / size.y;
    
            vec4 pvpNorm = texture(pvpNormTex, uv);
            float pressure = tex2val(pvpNorm.x);
            float pVel = tex2val(pvpNorm.y);
    
            vec4 pvpNormPX = texture(pvpNormTex, uv + vec2(dx, 0.0));
            float p_right = tex2val(pvpNormPX.x);
    
            vec4 pvpNormMX = texture(pvpNormTex, uv + vec2(-dx, 0.0));
            float p_left = tex2val(pvpNormMX.x);
    
            vec4 pvpNormPY = texture(pvpNormTex, uv + vec2(0.0, dy));
            float p_up = tex2val(pvpNormPY.x);
    
            vec4 pvpNormMY = texture(pvpNormTex, uv + vec2(0.0, -dy));
            float p_down = tex2val(pvpNormMY.x);
  
            // Change values so the screen boundaries aren't fixed.
            if (gl_FragCoord.x == 0.5) p_left = p_right;
            if (gl_FragCoord.x == size.x - 0.5) p_right = p_left;
            if (gl_FragCoord.y == 0.5) p_down = p_up;
            if (gl_FragCoord.y == size.y - 0.5) p_up = p_down;
        
            // Apply horizontal wave function
            pVel += delta * (-2.0 * pressure + p_right + p_left) / 4.0;
            // Apply vertical wave function (these could just as easily have been one line)
            pVel += delta * (-2.0 * pressure + p_up + p_down) / 4.0;
            
            // Change pressure by pressure velocity
            pressure += delta * pVel;
            
            // "Spring" motion. This makes the waves look more like water waves and less like sound waves.
            pVel -= 0.005 * delta * pressure;
            
            // Velocity damping so things eventually calm down
            pVel *= 1.0 - 0.002 * delta;
            
            // Pressure damping to prevent it from building up forever.
            pressure *= 0.99;
            
            //x = pressure. y = pressure velocity. Z and W = X and Y gradient
            fragColor.xyzw = vec4(
              val2tex(pressure), 
              val2tex(pVel), 
              (p_right - p_left) / 2.0, 
              (p_up - p_down) / 2.0
            );
  
            if (userXYh.z > 0.0) {
              float dist = distance(userXYh.xy, uv);
              if (dist < 0.05) {
                fragColor.x += val2tex(1.0 - dist);
              }
            }
          }`},inputs:{attributes:{pos:{buffer:f,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{size:{type:"vec2",value:[c.width,c.height]},userXYh:{type:"vec3",value:[0,0,0]}},textures:{pvpNormTex:c}},outputs:{frameBuffer:{textures:[v]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:h.length,viewport:[0,0,c.width,c.height]}}),E=new Di(o,{...S.config,inputs:{...S.config.inputs,textures:{pvpNormTex:v}},outputs:{frameBuffer:{textures:[c]}}}),M=new Di(o,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision mediump float;
          in vec2 uv;
          uniform sampler2D pvpNormTex;
          uniform sampler2D bgTex;
          out vec4 fragColor;
          void main() {
            vec4 data = texture(pvpNormTex, uv);
            
            // Color = texture
            fragColor = texture(bgTex, vec2(uv.x, 1.0 - uv.y) + 0.2 * data.zw);
            
            // Sunlight glint
            vec3 normal = normalize(vec3(-data.z, 0.2, -data.w));
            fragColor += vec4(1) * pow(max(0.0, dot(normal, normalize(vec3(-3, 10, 3)))), 60.0);
  
  
            // Brightness = water height
            // fragColor.xyz = vec3(data.x + 1.0) / 2.0;
            // fragColor.xyz = vec3(data.x);
          }`},inputs:{attributes:{pos:{buffer:f,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{pvpNormTex:v,bgTex:w}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:h.length,viewport:[0,0,e.width,e.height]}}),L=new Di(o,{...M.config,inputs:{...M.config.inputs,textures:{...M.config.inputs.textures,pvpNormTex:v}}});this.gs=o,this.ripplesG1=S,this.ripplesG2=E,this.refractionG1=M,this.refractionG2=L,this.bgTex=w}step(e){const{userX:t,userY:i,userH:o}=e;this.bgTex&&this.bgTex instanceof tS&&this.gs.updateVideoTexture(this.bgTex),this.i%2===0?(this.ripplesG1.updateUniform("userXYh",[t,i,o]),this.ripplesG1.draw(),this.refractionG1.draw()):(this.ripplesG2.updateUniform("userXYh",[t,i,o]),this.ripplesG2.draw(),this.refractionG2.draw()),this.i+=1}destroy(e=!1){var t,i,o,h;(t=this.ripplesG1)==null||t.destroy(e),(i=this.ripplesG2)==null||i.destroy(e),(o=this.refractionG1)==null||o.destroy(e),(h=this.refractionG2)==null||h.destroy(e)}}class mO{constructor(){tt(this,"userX",.5);tt(this,"userY",.5);tt(this,"userH",0);tt(this,"canvas");tt(this,"looper");tt(this,"re");tt(this,"destroyed",!1);tt(this,"onMouseMove",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.userX=(e.clientX-t.left)/this.canvas.clientWidth,this.userY=1-(e.clientY-t.top)/this.canvas.clientHeight,this.userH=1})}async init(e,t){if(e===this.canvas)return;const i=await $i.loadImage(t);this.destroyed||(this.canvas=e,this.re=new pO(e,{bgImg:i}),this.looper=new Ec(30,()=>{var o;(o=this.re)==null||o.step({userX:this.userX,userY:this.userY,userH:this.userH}),this.userX=-10,this.userY=-10,this.userH=0}),e.addEventListener("mousemove",this.onMouseMove))}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,i;(e=this.looper)==null||e.stopLoop(),(t=this.canvas)==null||t.removeEventListener("mousemove",this.onMouseMove),(i=this.re)==null||i.destroy(!0),this.re=void 0,this.canvas=void 0,this.destroyed=!0}}function qM(n){const e=ct.useRef(null);return ct.useEffect(()=>{const t=new mO;if(e.current){const i=e.current;i.width=i.clientWidth,i.height=i.clientHeight,t.init(i,n.imageUrl).then(()=>{i.width>300?t.startLoop():t.loop()})}return()=>{t.destroy()}},[e.current]),ge.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",borderRadius:"1rem"}})}function gO(){const n=Gx();return ge.jsxs(ge.Fragment,{children:[ge.jsx("div",{style:{margin:"3rem"},children:ge.jsx("h1",{children:"Visualization gallery"})}),ge.jsx("div",{style:{marginTop:"3rem"},children:ge.jsx(WM,{clickAction:()=>n("/swe"),children:ge.jsxs($M,{children:[ge.jsxs("div",{style:{margin:"2rem"},children:[ge.jsx("h4",{children:"Fluid simulations"}),ge.jsx("p",{children:"See how we use scientifically accurate fluid simulations to build immersive landscapes."})]}),ge.jsx("div",{style:{aspectRatio:"2/1.5"},children:ge.jsx(qM,{imageUrl:"/swe_bg.jpg"})})]})})}),ge.jsx("div",{style:{marginTop:"3rem"},children:ge.jsx(WM,{clickAction:()=>n("/wind"),children:ge.jsxs($M,{children:[ge.jsx("div",{style:{aspectRatio:"2/1.5"},children:ge.jsx(qM,{imageUrl:"/windsim.png"})}),ge.jsxs("div",{style:{margin:"2rem"},children:[ge.jsx("h4",{children:"Wind visualizations"}),ge.jsx("p",{children:"Integrate our dynamic wind visualizations into your maps."})]})]})})})]})}function _O(){return ge.jsx(Jf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(u_,{title:"Code and Colors",subtitle:"Scientific data visualizations",heroBackground:ge.jsxs(dO,{children:[ge.jsx(hO,{}),ge.jsx($D,{})]})})}),footerContent:ge.jsx(D2,{}),children:ge.jsx(gO,{})})}function yO(){const[n,e]=ct.useState("burger-bar unclicked"),[t,i]=ct.useState("menu hidden"),[o,h]=ct.useState(!1),f=()=>{o?(e("burger-bar unclicked"),i("menu hidden")):(e("burger-bar clicked"),i("menu visible")),h(!o)};return ge.jsxs("div",{style:{width:"100%"},children:[ge.jsx("nav",{children:ge.jsxs("div",{className:"burger-menu",onClick:f,children:[ge.jsx("div",{className:n}),ge.jsx("div",{className:n}),ge.jsx("div",{className:n})]})}),ge.jsxs("div",{className:t,children:[ge.jsx(Ku,{height:"3rem"}),ge.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[ge.jsx(Tm,{className:({isActive:c})=>c?"navLink active":"navLink",to:"/",onClick:f,children:"Home"}),ge.jsx(Tm,{className:({isActive:c})=>c?"navLink active":"navLink",to:"/contact",onClick:f,children:"Contact"}),ge.jsx(Tm,{className:({isActive:c})=>c?"navLink active":"navLink",to:"/swe",onClick:f,children:"SWE"}),ge.jsx(Tm,{className:({isActive:c})=>c?"navLink active":"navLink",to:"/wind",onClick:f,children:"Wind"})]})]})]})}function vO(){return ge.jsxs("div",{style:{width:"100%",position:"relative",overflowX:"hidden"},children:[ge.jsx("div",{style:{position:"fixed",width:"100%",zIndex:2},children:ge.jsx(yO,{})}),ge.jsx(qL,{})]})}function xO(){return ge.jsx(Jf,{hero:ge.jsx(u_,{heroBackground:ge.jsx("img",{}),title:"Imprint",subtitle:""}),children:ge.jsxs("div",{className:"impressum",children:[ge.jsx("h1",{children:"Impressum"}),ge.jsx("p",{children:"Angaben gemäß § 5 TMG"}),ge.jsxs("p",{children:["Max Muster ",ge.jsx("br",{}),"Musterweg",ge.jsx("br",{}),"12345 Musterstadt ",ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Vertreten durch: "}),ge.jsx("br",{}),"Michael Langbein",ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Kontakt:"})," ",ge.jsx("br",{}),"Telefon: 01234-789456",ge.jsx("br",{}),"Fax: 1234-56789",ge.jsx("br",{}),"E-Mail: ",ge.jsx("a",{href:"mailto:max@muster.de",children:"max@muster.de"}),ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Registereintrag: "}),ge.jsx("br",{}),"Eintragung im Registergericht: Musterstadt",ge.jsx("br",{}),"Registernummer: 12345",ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Umsatzsteuer-ID: "})," ",ge.jsx("br",{}),"Umsatzsteuer-Identifikationsnummer gemäß §27a Umsatzsteuergesetz: Musterustid.",ge.jsx("br",{}),ge.jsx("br",{}),ge.jsx("strong",{children:"Wirtschafts-ID: "}),ge.jsx("br",{}),"Musterwirtschaftsid",ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Aufsichtsbehörde:"}),ge.jsx("br",{}),"Musteraufsicht Musterstadt",ge.jsx("br",{})]}),ge.jsxs("p",{children:[ge.jsx("strong",{children:"Haftungsausschluss: "}),ge.jsx("br",{}),ge.jsx("br",{}),ge.jsx("strong",{children:"Haftung für Inhalte"}),ge.jsx("br",{}),ge.jsx("br",{}),"Die Inhalte unserer Seiten wurden mit größter Sorgfalt erstellt. Für die Richtigkeit, Vollständigkeit und Aktualität der Inhalte können wir jedoch keine Gewähr übernehmen. Als Diensteanbieter sind wir gemäß § 7 Abs.1 TMG für eigene Inhalte auf diesen Seiten nach den allgemeinen Gesetzen verantwortlich. Nach §§ 8 bis 10 TMG sind wir als Diensteanbieter jedoch nicht verpflichtet, übermittelte oder gespeicherte fremde Informationen zu überwachen oder nach Umständen zu forschen, die auf eine rechtswidrige Tätigkeit hinweisen. Verpflichtungen zur Entfernung oder Sperrung der Nutzung von Informationen nach den allgemeinen Gesetzen bleiben hiervon unberührt. Eine diesbezügliche Haftung ist jedoch erst ab dem Zeitpunkt der Kenntnis einer konkreten Rechtsverletzung möglich. Bei Bekanntwerden von entsprechenden Rechtsverletzungen werden wir diese Inhalte umgehend entfernen.",ge.jsx("br",{}),ge.jsx("br",{}),ge.jsx("strong",{children:"Haftung für Links"}),ge.jsx("br",{}),ge.jsx("br",{}),"Unser Angebot enthält Links zu externen Webseiten Dritter, auf deren Inhalte wir keinen Einfluss haben. Deshalb können wir für diese fremden Inhalte auch keine Gewähr übernehmen. Für die Inhalte der verlinkten Seiten ist stets der jeweilige Anbieter oder Betreiber der Seiten verantwortlich. Die verlinkten Seiten wurden zum Zeitpunkt der Verlinkung auf mögliche Rechtsverstöße überprüft. Rechtswidrige Inhalte waren zum Zeitpunkt der Verlinkung nicht erkennbar. Eine permanente inhaltliche Kontrolle der verlinkten Seiten ist jedoch ohne konkrete Anhaltspunkte einer Rechtsverletzung nicht zumutbar. Bei Bekanntwerden von Rechtsverletzungen werden wir derartige Links umgehend entfernen.",ge.jsx("br",{}),ge.jsx("br",{}),ge.jsx("strong",{children:"Datenschutz"}),ge.jsx("br",{}),ge.jsx("br",{}),"Die Nutzung unserer Webseite ist in der Regel ohne Angabe personenbezogener Daten möglich. Soweit auf unseren Seiten personenbezogene Daten (beispielsweise Name, Anschrift oder eMail-Adressen) erhoben werden, erfolgt dies, soweit möglich, stets auf freiwilliger Basis. Diese Daten werden ohne Ihre ausdrückliche Zustimmung nicht an Dritte weitergegeben. ",ge.jsx("br",{}),"Wir weisen darauf hin, dass die Datenübertragung im Internet (z.B. bei der Kommunikation per E-Mail) Sicherheitslücken aufweisen kann. Ein lückenloser Schutz der Daten vor dem Zugriff durch Dritte ist nicht möglich. ",ge.jsx("br",{}),"Der Nutzung von im Rahmen der Impressumspflicht veröffentlichten Kontaktdaten durch Dritte zur Übersendung von nicht ausdrücklich angeforderter Werbung und Informationsmaterialien wird hiermit ausdrücklich widersprochen. Die Betreiber der Seiten behalten sich ausdrücklich rechtliche Schritte im Falle der unverlangten Zusendung von Werbeinformationen, etwa durch Spam-Mails, vor.",ge.jsx("br",{})]}),ge.jsx("br",{}),"Website Impressum erstellt durch ",ge.jsx("a",{href:"https://www.impressum-generator.de",children:"impressum-generator.de"})," von der"," ",ge.jsx("a",{href:"https://www.kanzlei-hasselbach.de/",rel:"nofollow",children:"Kanzlei Hasselbach"})]})})}let bO=class{constructor(e){tt(this,"smudgeGraph1");tt(this,"smudgeGraph2");tt(this,"outGraph1");tt(this,"outGraph2");tt(this,"i",0);const t=e.getContext("webgl2"),i=new Ph(t,{colorBufferFloat:!1}),o=Kf(0,0,2,2),h=new Fs(t,{data:new Float32Array(o.flat()),changesOften:!1}),f=new zs(t,{width:e.width,height:e.height,type:"ubyte4",interpolate:"linear",edges:"clamp"}),c=new zs(t,{width:e.width,height:e.height,type:"ubyte4",interpolate:"linear",edges:"clamp"}),v=new Di(i,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos + 1.0) / 2.0;
            }
        `,fragmentSource:`#version 300 es
            precision mediump float;
            in vec2 uv;
            uniform sampler2D previousTex;
            uniform vec3 mousePos;
            uniform vec2 resolution;
            uniform vec4 currentColor;
            out vec4 fragColor;

            float proximity(vec2 a, vec2 b, float maxDist) {
                float dist = distance(a, b);
                float incl = - 1.0 / maxDist;
                float y = 1.0 + incl * dist;
                float ym = max(y, 0.0);
                return ym;
            }

            float rand(vec2 n) {
                return fract(
                    sin(
                    dot(n, vec2(12.9898, 4.1414))
                    ) * 43758.5453
                );
            }

            float noise(vec2 p) {
                vec2 ip = floor(p);
                vec2 u = fract(p);
                u = u * u * (3.0 - 2.0 * u);
                float res = mix(
                    mix(
                    rand(ip), 
                    rand(ip + vec2(1.0, 0.0)), 
                    u.x
                    ), 
                    mix(
                    rand(ip + vec2(0.0, 1.0)), 
                    rand(ip + vec2(1.0, 1.0)), 
                    u.x
                    ), 
                    u.y
                );
                return res * res;
            }

            float fbm(vec2 x, int numOctaves) {
                float v = 0.0;
                float a = 0.5;
                vec2 shift = vec2(100);

                mat2 rot = mat2(cos(0.5), sin(0.5), -sin(0.5), cos(0.5));
                for (int i = 0; i < numOctaves; ++i) {
                    v += a * noise(x);
                    x = rot * x * 2.0 + shift;
                    a *= 0.5;
                }

                return v;
            }

            vec4 combine(vec4 cola, vec4 colb) {
                return vec4(
                    max(cola.x, colb.x),
                    max(cola.y, colb.y),
                    max(cola.z, colb.z),
                    max(cola.w, colb.w)
                );
            }

            void main() {
                float spreadReach = 0.0125;
                float fadeSpeed = 0.04;
                float paintSize = 0.05;
                
                vec2 st = gl_FragCoord.xy/resolution.xy;
                float n = fbm(st * 10.0, 4);
                float m = fbm(st * 15.0, 4);

                float prox = 0.0;
                if (mousePos.z > 0.0) {
                  prox = proximity(uv, mousePos.xy, paintSize);
                }
                
                vec4 prev       = texture(previousTex, uv);
                vec4 prevRight  = texture(previousTex, uv + vec2(-n, 0.0) * spreadReach);
                vec4 prevLeft   = texture(previousTex, uv + vec2( n, 0.0) * spreadReach);
                vec4 prevTop    = texture(previousTex, uv + vec2(0.0, -m) * spreadReach);
                vec4 prevBottom = texture(previousTex, uv + vec2(0.0,  m) * spreadReach);

                vec4 background = vec4(0, 0, 0, 0);

                vec4 smudged = prev;
                smudged = combine(smudged, prevRight);
                smudged = combine(smudged, prevLeft);
                smudged = combine(smudged, prevTop);
                smudged = combine(smudged, prevBottom);
                smudged = smudged * (1.0 - fadeSpeed);

                vec4 drawing = currentColor * prox;

                fragColor = combine(background, combine(drawing,smudged));
            }
            `},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{previousTex:f},uniforms:{currentColor:{type:"vec4",value:[1,0,0,1]},resolution:{type:"vec2",value:[e.width,e.height]},mousePos:{type:"vec3",value:[.5,.5,0]}}},outputs:{frameBuffer:{textures:[c]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:o.length,viewport:[0,0,e.width,e.height]}}),w=new Di(i,{...v.config,inputs:{...v.config.inputs,textures:{previousTex:c}},outputs:{...v.config.outputs,frameBuffer:{textures:[f]}}}),S=new Di(i,{program:{vertexSource:`#version 300 es
        in vec2 pos;
        out vec2 uv;
        void main() {
          gl_Position = vec4(pos, 0, 1);
          uv = (pos.xy + 1.0) / 2.0;
        }`,fragmentSource:`#version 300 es
        precision mediump float;
        in vec2 uv;
        uniform sampler2D outTex;
        out vec4 fragColor;
        void main() {
          fragColor = texture(outTex, uv);
        }`},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{outTex:c},uniforms:{}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:o.length,viewport:[0,0,e.width,e.height]}}),E=new Di(i,{...S.config,inputs:{...S.config.inputs,textures:{outTex:f}}});this.smudgeGraph1=v,this.smudgeGraph2=w,this.outGraph1=S,this.outGraph2=E}step(e){const{mouseX:t,mouseY:i,pressed:o}=e;if(this.i%2===0){const h=this.i%360/360,f=rS(h,.5,.5).map(c=>c/255);this.smudgeGraph1.updateUniform("currentColor",[...f,1]),this.smudgeGraph1.updateUniform("mousePos",[t,i,o?1:0]),this.smudgeGraph1.draw(),this.outGraph1.draw()}else{const h=this.i%360/360,f=rS(h,.5,.5).map(c=>c/255);this.smudgeGraph2.updateUniform("currentColor",[...f,1]),this.smudgeGraph2.updateUniform("mousePos",[t,i]),this.smudgeGraph2.draw(),this.outGraph2.draw()}this.i+=1}destroy(e){var t,i,o,h;(t=this.smudgeGraph1)==null||t.destroy(e),(i=this.smudgeGraph2)==null||i.destroy(e),(o=this.outGraph1)==null||o.destroy(e),(h=this.outGraph2)==null||h.destroy(e)}};class wO{constructor(){tt(this,"canvas");tt(this,"looper");tt(this,"wca");tt(this,"mouseX",0);tt(this,"mouseY",0);tt(this,"pressed",!1);tt(this,"onMouseMove",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.mouseX=(e.clientX-t.left)/this.canvas.clientWidth,this.mouseY=1-(e.clientY-t.top)/this.canvas.clientHeight,this.pressed=!0})}init(e){this.canvas=e,this.wca=new bO(e),this.looper=new Ec(30,()=>{var t;(t=this.wca)==null||t.step({mouseX:this.mouseX,mouseY:this.mouseY,pressed:this.pressed}),this.pressed=!1}),e.addEventListener("mousemove",this.onMouseMove)}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){var e,t;this.stopLoop(),(e=this.canvas)==null||e.removeEventListener("mousemove",this.onMouseMove),(t=this.wca)==null||t.destroy(!0),this.wca=void 0,this.canvas=void 0}}function SO(n){const e=ct.useRef(null);return ct.useEffect(()=>{const t=new wO;if(e.current){const i=e.current;if(i.clientHeight<=0)return;i.width=i.clientWidth,i.height=i.clientHeight,t.init(i),t.startLoop()}return()=>t.destroy()},[e.current]),ge.jsxs("div",{style:{position:"relative",width:"100%",height:"100%"},children:[ge.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0}}),ge.jsx("div",{children:n.children})]})}function MO(){return ge.jsxs(Jf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"8rem",background:"linear-gradient(180deg, var(--primary4) 0%, var(--primary3) 100%)"},children:ge.jsx(u_,{heroBackground:ge.jsx(SO,{}),title:"Resources",subtitle:"Software and media used in creating this site"})}),children:[ge.jsx("h1",{children:"Software"}),ge.jsxs("ul",{children:[ge.jsx("li",{children:"maplibre-gl"}),ge.jsx("li",{children:"react"}),ge.jsx("li",{children:"react-dom"}),ge.jsx("li",{children:"react-router-dom"}),ge.jsx("li",{children:"@types/react"}),ge.jsx("li",{children:"@types/react-dom"}),ge.jsx("li",{children:"@typescript-eslint/eslint-plugin"}),ge.jsx("li",{children:"@typescript-eslint/parser"}),ge.jsx("li",{children:"@vitejs/plugin-react"}),ge.jsx("li",{children:"eslint"}),ge.jsx("li",{children:"eslint-plugin-react"}),ge.jsx("li",{children:"eslint-plugin-react-hooks"}),ge.jsx("li",{children:"eslint-plugin-react-refresh"}),ge.jsx("li",{children:"typescript"})]}),ge.jsx("h1",{children:"Media"}),ge.jsx("ul",{children:ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/de-de/foto/weisse-windmuhle-unter-blauem-und-weissem-himmel-tagsuber-112846/",children:"Foto von musicFactory lehmannsound von Pexels"})})})]})}function TO(n,e,t,i){const o=n-t/2,h=n+t/2,f=e+i/2,c=e-i/2;return[[o,f],[o,c],[h,c],[o,f],[h,c],[h,f]]}class EO{constructor(e,t,i,o,h,f,c=[1,1,1,1]){tt(this,"differentialGraph");tt(this,"summarizeGraph");tt(this,"dataTexture1");tt(this,"dataTexture2");tt(this,"k0Texture");tt(this,"k1Texture");tt(this,"k2Texture");tt(this,"k3Texture");tt(this,"k4Texture");tt(this,"gs");tt(this,"debugGraph");tt(this,"i",0);const v=e.gl,w={};for(const be of h)w[be.name]={type:be.type,value:be.value};const S={};for(const be of f)S[be.name]=be.value;const E=TO(0,0,2,2),M=new Fs(v,{data:new Float32Array(E.flat()),changesOften:!1}),L=new Og(v,{data:i,t:"float4",edges:"clamp",interpolate:"none"}),U=new Og(v,{data:i,t:"float4",edges:"clamp",interpolate:"none"}),B=L.width,z=L.height,R=new zs(v,{width:B,height:z,type:"float4",edges:"clamp",interpolate:"none"}),G=new zs(v,{width:B,height:z,type:"float4",edges:"clamp",interpolate:"none"}),V=new zs(v,{width:B,height:z,type:"float4",edges:"clamp",interpolate:"none"}),ee=new zs(v,{width:B,height:z,type:"float4",edges:"clamp",interpolate:"none"}),fe=new zs(v,{width:B,height:z,type:"float4",edges:"clamp",interpolate:"none"}),Z=new Di(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          uniform vec2 textureSize;
          uniform sampler2D dataTexture;
          uniform sampler2D kTexture;
          uniform float kFactor;
          uniform float dt;
          ${h.map(be=>`uniform ${be.type} ${be.name}; 
`)}
          ${f.map(be=>`uniform sampler2D ${be.name}; 
`)}
          in vec2 uv;
          out vec4 fragColor;
  
          void main() {
  
              vec2 deltaX = vec2(1.0 / textureSize.x, 0.0);
              vec2 deltaY = vec2(0.0, 1.0 / textureSize.y);
              vec4 data    = texture(dataTexture, uv          ) + dt * kFactor * texture(kTexture, uv          );
              vec4 data_px = texture(dataTexture, uv + deltaX ) + dt * kFactor * texture(kTexture, uv + deltaX );
              vec4 data_mx = texture(dataTexture, uv - deltaX ) + dt * kFactor * texture(kTexture, uv - deltaX );
              vec4 data_py = texture(dataTexture, uv + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaY );
              vec4 data_my = texture(dataTexture, uv - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaY );
  
              //-----------------------------------------------------------
              // Insert here shader code that takes "data", "data_px", ...
              // and fills "fragColor" with df/dt
              ${t}
              //-----------------------------------------------------------
  
          }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{...S,dataTexture:L,kTexture:R},uniforms:{...w,textureSize:{type:"vec2",value:[B,z]},kFactor:{type:"float",value:[0]},dt:{type:"float",value:[o]}}},outputs:{frameBuffer:{textures:[G]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:E.length,viewport:[0,0,B,z]}}),te=new Di(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          in vec2 uv;
          uniform sampler2D dataTexture;
          uniform sampler2D k1Texture;
          uniform sampler2D k2Texture;
          uniform sampler2D k3Texture;
          uniform sampler2D k4Texture;
          uniform float dt;
          uniform vec4 dampingFactor;
          out vec4 fragColor;
  
          void main() {
              vec4 data = texture(dataTexture, uv);
              vec4 k1   = texture(k1Texture,   uv);
              vec4 k2   = texture(k2Texture,   uv);
              vec4 k3   = texture(k3Texture,   uv);
              vec4 k4   = texture(k4Texture,   uv);
  
              vec4 weightedAverage = data + dt * (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0;
              weightedAverage *= dampingFactor;
  
              fragColor = weightedAverage;
          }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{dt:{type:"float",value:[o]},dampingFactor:{type:"vec4",value:c}},textures:{dataTexture:L,k1Texture:G,k2Texture:V,k3Texture:ee,k4Texture:fe}},outputs:{frameBuffer:{textures:[U]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:E.length,viewport:[0,0,B,z]}});this.debugGraph=new Di(e,{program:{vertexSource:`#version 300 es
              in vec2 pos;
              out vec2 uv;
              void main() {
                  gl_Position = vec4(pos.xy, 0, 1);
                  uv = (pos + 1.0) / 2.0;
              }`,fragmentSource:`#version 300 es
              precision highp float;
              in vec2 uv;
              uniform sampler2D drawTexture;
              out vec4 fragColor;
              void main() {
                  vec4 tex = texture(drawTexture, uv);
                  float h = (tex.x - 0.5) * 2.0;
                  fragColor = vec4(tex.x, tex.x, tex.x, 1.0);
              }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{drawTexture:U}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:E.length,viewport:[0,0,B,z]}}),this.gs=e,this.differentialGraph=Z,this.summarizeGraph=te,this.dataTexture1=L,this.dataTexture2=U,this.k0Texture=R,this.k1Texture=G,this.k2Texture=V,this.k3Texture=ee,this.k4Texture=fe}loop(e){const t=this.differentialGraph,i=this.summarizeGraph;let o=this.dataTexture1,h=this.dataTexture2;if(this.i%2!==0&&(o=this.dataTexture2,h=this.dataTexture1),e)for(const f of e)t.updateUniform(f.name,f.value);return t.updateUniform("kFactor",[0]),t.updateTexture("dataTexture",o),t.updateTexture("kTexture",this.k0Texture),t.updateFramebuffer({textures:[this.k1Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k1Texture),t.updateFramebuffer({textures:[this.k2Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k2Texture),t.updateFramebuffer({textures:[this.k3Texture]}),t.draw(),t.updateUniform("kFactor",[1]),t.updateTexture("kTexture",this.k3Texture),t.updateFramebuffer({textures:[this.k4Texture]}),t.draw(),i.updateTexture("dataTexture",o),i.updateFramebuffer({textures:[h]}),i.draw(),this.i+=1,h}destroy(e=!1){this.debugGraph.destroy(e),this.summarizeGraph.destroy(e),this.differentialGraph.destroy(e)}}let AO=class{constructor(e,t){tt(this,"rk");tt(this,"displayGraph");const i=e.getContext("webgl2"),o=.002,h=1024,f=1024;e.width=e.clientWidth,e.height=e.clientHeight;const c=I2(()=>[0,0,0,1],h,f),v=Kf(0,0,2,2),w=new Fs(i,{data:new Float32Array(v.flat()),changesOften:!1}),S=new $i(i,{image:t.bgImg}),E=new $i(i,{image:t.hImg}),M=new Ph(i,{}),L=`

      // assuming a 10 x 10 m^2 field
      float dx = deltaX.x * 10.0;
      float dy = deltaY.y * 10.0;

      float h = data.x;
      float u = data.y;
      float v = data.z;
      float hPX = data_px.x;
      float uPX = data_px.y;
      float vPX = data_px.z;
      float hMX = data_mx.x;
      float uMX = data_mx.y;
      float vMX = data_mx.z;
      float hPY = data_py.x;
      float uPY = data_py.y;
      float vPY = data_py.z;
      float hMY = data_my.x;
      float uMY = data_my.y;
      float vMY = data_my.z;

      vec2 uvTex = vec2(uv.x, 1.0 - uv.y);
      float H = texture(hTex, uvTex).x * 5.0; // 10.0;
      float f = 0.001;   // coriolis coefficient
      float b = 0.003;   // viscous drag
      float g = 9.831;   // fall acceleration

      float dudx = (uPX - uMX) / (2.0 * dx);
      float dvdy = (vPY - vMY) / (2.0 * dy);
      float dhdx = (hPX - hMX) / (2.0 * dx);
      float dhdy = (hPY - hMY) / (2.0 * dy);

      // user-interaction
      if (mousePos.w > 0.5) {
        float d = distance(mousePos.xy, uv);
        if (d < 0.01) {
          dhdx += mousePos.z;
          dhdy += mousePos.z;
        }
      }

      // edge conditions
      float x = gl_FragCoord.x;
      if (x < 2.0 || x > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dudx = 0.0;
        dhdx = 0.0; 
      }
      float y = gl_FragCoord.y;
      if (y < 2.0 || y > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dvdy = 0.0;
        dhdy = 0.0;
      }

      float dhdt =      - H * ( dudx + dvdy );
      float dudt = ( + f*v - b*u - g * dhdx );
      float dvdt = ( - f*u - b*v - g * dhdy );

      if (H < 0.1) {
        dhdt = 0.0;
        dudt = 0.0;
        dvdt = 0.0;
      }

      fragColor = vec4(dhdt, dudt, dvdt, 1.0);
  `,U=new EO(M,L,c,o,[{name:"mousePos",type:"vec4",value:[0,0,0,0]}],[{name:"hTex",value:E}],[.995,.995,.995,1]),B=U.loop(),z=new Di(M,{program:{vertexSource:`#version 300 es
        in vec2 pos;
        out vec2 uv;
        void main() {
            gl_Position = vec4(pos.xy, 0, 1);
            uv = (pos + 1.0) / 2.0;
        }`,fragmentSource:`#version 300 es
        precision highp float;
        in vec2 uv;
        uniform sampler2D tex;
        uniform sampler2D bgTex;
        out vec4 fragColor;
        void main() {
            vec4 tex = texture(tex, uv);
            vec2 uvBg = vec2(uv.x, 1.0 - uv.y);
            uvBg += vec2(tex.x, tex.x) * 0.05;
            vec4 bg = texture(bgTex, uvBg);
            fragColor = bg;
            // fragColor = vec4(tex.x, 0, 0, 1);
            // fragColor = vec4(uvBg.xy, 0, 1);
        }`},inputs:{attributes:{pos:{buffer:w,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{tex:B,bgTex:S}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:v.length,viewport:[0,0,e.width,e.height]}});this.rk=U,this.displayGraph=z}step(e){const{userX:t,userY:i,userStrength:o,userMoving:h}=e,f=this.rk.loop([{name:"mousePos",type:"vec4",value:[t,i,o,h]}]);this.displayGraph.updateTexture("tex",f),this.displayGraph.draw()}destroy(e){this.rk.destroy(e),this.displayGraph.destroy(e)}};const CO=({backgroundImage:n,logo:e,title:t,subtitle:i})=>ge.jsx("div",{className:"hero",style:{backgroundImage:`url(${n})`},children:ge.jsxs("div",{className:"hero-content",children:[e&&ge.jsx("div",{className:"hero-logo",children:e}),ge.jsxs("div",{className:"hero-text-content",children:[ge.jsx("h1",{className:"hero-title",children:t}),ge.jsx("h3",{className:"hero-subtitle",children:i})]})]})});function xA(n){return ge.jsx(Jf,{hero:ge.jsx(CO,{backgroundImage:n.bgImg,title:n.title,subtitle:n.subTitle}),logo:n.logo,footerContent:ge.jsx(D2,{}),children:n.children})}class PO{constructor(){tt(this,"looper");tt(this,"swe");tt(this,"canvas");tt(this,"mouseListener",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.userX=(e.clientX-t.left)/this.canvas.clientWidth,this.userY=1-(e.clientY-t.top)/this.canvas.clientHeight,this.userMoving=1});tt(this,"userX",0);tt(this,"userY",0);tt(this,"userMoving",0);tt(this,"destroyed",!1)}async init(e){this.canvas=e,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight;const t=await $i.loadImage("/swe_bg.jpg"),i=await $i.loadImage("/swe_h2.jpg");this.destroyed||(this.swe=new AO(e,{bgImg:t,hImg:i}),this.looper=new Ec(30,()=>{var o;(o=this.swe)==null||o.step({userX:this.userX,userY:this.userY,userMoving:this.userMoving,userStrength:1e3}),this.userMoving=0}),this.canvas.addEventListener("mousemove",this.mouseListener),this.startLoop())}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){var e,t;this.stopLoop(),this.mouseListener&&((e=this.canvas)==null||e.removeEventListener("mousemove",this.mouseListener)),(t=this.swe)==null||t.destroy(!0),this.swe=void 0,this.canvas=void 0,this.destroyed=!0}}function RO(){const n=ct.useRef(null);return ct.useEffect(()=>{const e=new PO;return n.current&&e.init(n.current),()=>e.destroy()},[n.current]),ge.jsxs(xA,{bgImg:"/swe_bg.jpg",title:"Wave simulations",subTitle:"using the shallow water equations",logo:ge.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 5 4",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"squiggle",d:`M 0 0 
              C 0.5 0 0.5 0.5 1.0 0.5 
              S       1.5 0.0 2.0 0.0
              S       2.5 0.5 3.0 0.5
              S       3.5 0.0 4.0 0.0`,stroke:"black",strokeWidth:"0.2",strokeLinejoin:"round",fill:"none"})}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"1.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"2.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"3.0"})]}),children:[ge.jsxs("p",{style:{margin:"2rem"},children:["Water-surface-movement can be simulated accurately with the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Shallow_water_equations",target:"_blank",children:"shallow water equations"}),". To augment the numerical stability of that simulation, approximation methods like"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"Runge-Kutta"})," ","can be used."]}),ge.jsxs("p",{style:{margin:"2rem"},children:["The image below contains an implementation of this method. ",ge.jsx("b",{children:"Move your mouse over the water"})," to make waves!"]}),ge.jsx("canvas",{ref:n,style:{width:"100%",aspectRatio:"3/2"}}),ge.jsx("p",{style:{margin:"2rem"},children:"This method can be adjusted to be included in maps, 3d-scenes etc."})]})}var ZM=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function IO(){var n=new ZM(16);return ZM!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function LO(n,e){var t=e[0],i=e[1],o=e[2],h=e[3],f=e[4],c=e[5],v=e[6],w=e[7],S=e[8],E=e[9],M=e[10],L=e[11],U=e[12],B=e[13],z=e[14],R=e[15],G=t*c-i*f,V=t*v-o*f,ee=t*w-h*f,fe=i*v-o*c,Z=i*w-h*c,te=o*w-h*v,be=S*B-E*U,ae=S*z-M*U,K=S*R-L*U,Pe=E*z-M*B,ke=E*R-L*B,Te=M*R-L*z,je=G*Te-V*ke+ee*Pe+fe*K-Z*ae+te*be;return je?(je=1/je,n[0]=(c*Te-v*ke+w*Pe)*je,n[1]=(o*ke-i*Te-h*Pe)*je,n[2]=(B*te-z*Z+R*fe)*je,n[3]=(M*Z-E*te-L*fe)*je,n[4]=(v*K-f*Te-w*ae)*je,n[5]=(t*Te-o*K+h*ae)*je,n[6]=(z*ee-U*te-R*V)*je,n[7]=(S*te-M*ee+L*V)*je,n[8]=(f*ke-c*K+w*be)*je,n[9]=(i*K-t*ke-h*be)*je,n[10]=(U*Z-B*ee+R*G)*je,n[11]=(E*ee-S*Z-L*G)*je,n[12]=(c*ae-f*Pe-v*be)*je,n[13]=(t*Pe-i*ae+o*be)*je,n[14]=(B*V-U*fe-z*G)*je,n[15]=(S*fe-E*V+M*G)*je,n):null}var bA={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(n,e){(function(t,i){n.exports=i()})(mP,function(){var t={},i={};function o(f,c,v){if(i[f]=v,f==="index"){var w="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",S={};return i.shared(S),i.index(t,S),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([w],{type:"text/javascript"}))),t}}o("shared",["exports"],function(f){function c(a,r,l,d){return new(l||(l=Promise))(function(g,x){function b(D){try{P(d.next(D))}catch(O){x(O)}}function T(D){try{P(d.throw(D))}catch(O){x(O)}}function P(D){var O;D.done?g(D.value):(O=D.value,O instanceof l?O:new l(function(H){H(O)})).then(b,T)}P((d=d.apply(a,r||[])).next())})}function v(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}typeof SuppressedError=="function"&&SuppressedError;var w=S;function S(a,r){this.x=a,this.y=r}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(a){return this.clone()._add(a)},sub:function(a){return this.clone()._sub(a)},multByPoint:function(a){return this.clone()._multByPoint(a)},divByPoint:function(a){return this.clone()._divByPoint(a)},mult:function(a){return this.clone()._mult(a)},div:function(a){return this.clone()._div(a)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,r){return this.clone()._rotateAround(a,r)},matMult:function(a){return this.clone()._matMult(a)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(a){return this.x===a.x&&this.y===a.y},dist:function(a){return Math.sqrt(this.distSqr(a))},distSqr:function(a){var r=a.x-this.x,l=a.y-this.y;return r*r+l*l},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith:function(a){return this.angleWithSep(a.x,a.y)},angleWithSep:function(a,r){return Math.atan2(this.x*r-this.y*a,this.x*a+this.y*r)},_matMult:function(a){var r=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=r,this},_add:function(a){return this.x+=a.x,this.y+=a.y,this},_sub:function(a){return this.x-=a.x,this.y-=a.y,this},_mult:function(a){return this.x*=a,this.y*=a,this},_div:function(a){return this.x/=a,this.y/=a,this},_multByPoint:function(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint:function(a){return this.x/=a.x,this.y/=a.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var a=this.y;return this.y=this.x,this.x=-a,this},_rotate:function(a){var r=Math.cos(a),l=Math.sin(a),d=l*this.x+r*this.y;return this.x=r*this.x-l*this.y,this.y=d,this},_rotateAround:function(a,r){var l=Math.cos(a),d=Math.sin(a),g=r.y+d*(this.x-r.x)+l*(this.y-r.y);return this.x=r.x+l*(this.x-r.x)-d*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(a){return a instanceof S?a:Array.isArray(a)?new S(a[0],a[1]):a};var E=v(w),M=L;function L(a,r,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=l,this.p2y=d}L.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var g=this.sampleCurveX(l)-a;if(Math.abs(g)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=g/x}var b=0,T=1;for(l=a,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-a)<r));d++)a>g?b=l:T=l,l=.5*(T-b)+b;return l},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};var U=v(M);let B,z;function R(){return B==null&&(B=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),B}function G(){if(z==null&&(z=!1,R())){const r=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(r){for(let d=0;d<5*5;d++){const g=4*d;r.fillStyle=`rgb(${g},${g+1},${g+2})`,r.fillRect(d%5,Math.floor(d/5),1,1)}const l=r.getImageData(0,0,5,5).data;for(let d=0;d<5*5*4;d++)if(d%4!=3&&l[d]!==d){z=!0;break}}}return z||!1}function V(a,r,l,d){const g=new U(a,r,l,d);return function(x){return g.solve(x)}}const ee=V(.25,.1,.25,1);function fe(a,r,l){return Math.min(l,Math.max(r,a))}function Z(a,r,l){const d=l-r,g=((a-r)%d+d)%d+r;return g===r?l:g}function te(a,...r){for(const l of r)for(const d in l)a[d]=l[d];return a}let be=1;function ae(a,r,l){const d={};for(const g in a)d[g]=r.call(l||this,a[g],g,a);return d}function K(a,r,l){const d={};for(const g in a)r.call(l||this,a[g],g,a)&&(d[g]=a[g]);return d}function Pe(a){return Array.isArray(a)?a.map(Pe):typeof a=="object"&&a?ae(a,Pe):a}const ke={};function Te(a){ke[a]||(typeof console<"u"&&console.warn(a),ke[a]=!0)}function je(a,r,l){return(l.y-a.y)*(r.x-a.x)>(r.y-a.y)*(l.x-a.x)}function it(a){let r=0;for(let l,d,g=0,x=a.length,b=x-1;g<x;b=g++)l=a[g],d=a[b],r+=(d.x-l.x)*(l.y+d.y);return r}function ut(a){return typeof WorkerGlobalScope<"u"&&a!==void 0&&a instanceof WorkerGlobalScope}let st=null;function Ce(a){return typeof ImageBitmap<"u"&&a instanceof ImageBitmap}const Ke="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Ye(a,r,l,d,g){return c(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const x=new VideoFrame(a,{timestamp:0});try{const b=x==null?void 0:x.format;if(!b||!b.startsWith("BGR")&&!b.startsWith("RGB"))throw new Error(`Unrecognized format ${b}`);const T=b.startsWith("BGR"),P=new Uint8ClampedArray(d*g*4);if(yield x.copyTo(P,function(D,O,H,q,Q){const ie=4*Math.max(-O,0),ce=(Math.max(0,H)-H)*q*4+ie,me=4*q,we=Math.max(0,O),De=Math.max(0,H);return{rect:{x:we,y:De,width:Math.min(D.width,O+q)-we,height:Math.min(D.height,H+Q)-De},layout:[{offset:ce,stride:me}]}}(a,r,l,d,g)),T)for(let D=0;D<P.length;D+=4){const O=P[D];P[D]=P[D+2],P[D+2]=O}return P}finally{x.close()}})}let pt,kt;const _n="AbortError";function Ze(){return new Error(_n)}const _t={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ct(a){return _t.REGISTERED_PROTOCOLS[a.substring(0,a.indexOf("://"))]}const St="global-dispatcher";class un extends Error{constructor(r,l,d,g){super(`AJAXError: ${l} (${r}): ${d}`),this.status=r,this.statusText=l,this.url=d,this.body=g}}const mn=()=>ut(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,yn=function(a,r){if(/:\/\//.test(a.url)&&!/^https?:|^file:/.test(a.url)){const d=Ct(a.url);if(d)return d(a,r);if(ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:a,targetMapId:St},r)}if(!(/^file:/.test(l=a.url)||/^file:/.test(mn())&&!/^\w+:/.test(l))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(d,g){return c(this,void 0,void 0,function*(){const x=new Request(d.url,{method:d.method||"GET",body:d.body,credentials:d.credentials,headers:d.headers,cache:d.cache,referrer:mn(),signal:g.signal});d.type==="json"&&x.headers.set("Accept","application/json");const b=yield fetch(x);if(!b.ok){const D=yield b.blob();throw new un(b.status,b.statusText,d.url,D)}let T;T=d.type==="arrayBuffer"||d.type==="image"?b.arrayBuffer():d.type==="json"?b.json():b.text();const P=yield T;if(g.signal.aborted)throw Ze();return{data:P,cacheControl:b.headers.get("Cache-Control"),expires:b.headers.get("Expires")}})}(a,r);if(ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:a,mustQueue:!0,targetMapId:St},r)}var l;return function(d,g){return new Promise((x,b)=>{const T=new XMLHttpRequest;T.open(d.method||"GET",d.url,!0),d.type!=="arrayBuffer"&&d.type!=="image"||(T.responseType="arraybuffer");for(const P in d.headers)T.setRequestHeader(P,d.headers[P]);d.type==="json"&&(T.responseType="text",T.setRequestHeader("Accept","application/json")),T.withCredentials=d.credentials==="include",T.onerror=()=>{b(new Error(T.statusText))},T.onload=()=>{if(!g.signal.aborted)if((T.status>=200&&T.status<300||T.status===0)&&T.response!==null){let P=T.response;if(d.type==="json")try{P=JSON.parse(T.response)}catch(D){return void b(D)}x({data:P,cacheControl:T.getResponseHeader("Cache-Control"),expires:T.getResponseHeader("Expires")})}else{const P=new Blob([T.response],{type:T.getResponseHeader("Content-Type")});b(new un(T.status,T.statusText,d.url,P))}},g.signal.addEventListener("abort",()=>{T.abort(),b(Ze())}),T.send(d.body)})}(a,r)};function Fe(a){if(!a||a.indexOf("://")<=0||a.indexOf("data:image/")===0||a.indexOf("blob:")===0)return!0;const r=new URL(a),l=window.location;return r.protocol===l.protocol&&r.host===l.host}function dn(a,r,l){l[a]&&l[a].indexOf(r)!==-1||(l[a]=l[a]||[],l[a].push(r))}function an(a,r,l){if(l&&l[a]){const d=l[a].indexOf(r);d!==-1&&l[a].splice(d,1)}}class Vn{constructor(r,l={}){te(this,l),this.type=r}}class Wt extends Vn{constructor(r,l={}){super("error",te({error:r},l))}}class En{on(r,l){return this._listeners=this._listeners||{},dn(r,l,this._listeners),this}off(r,l){return an(r,l,this._listeners),an(r,l,this._oneTimeListeners),this}once(r,l){return l?(this._oneTimeListeners=this._oneTimeListeners||{},dn(r,l,this._oneTimeListeners),this):new Promise(d=>this.once(r,d))}fire(r,l){typeof r=="string"&&(r=new Vn(r,l||{}));const d=r.type;if(this.listens(d)){r.target=this;const g=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const T of g)T.call(this,r);const x=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const T of x)an(d,T,this._oneTimeListeners),T.call(this,r);const b=this._eventedParent;b&&(te(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(r))}else r instanceof Wt&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,l){return this._eventedParent=r,this._eventedParentData=l,this}}var J={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const re=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Je(a,r){const l={};for(const d in a)d!=="ref"&&(l[d]=a[d]);return re.forEach(d=>{d in r&&(l[d]=r[d])}),l}function Xe(a,r){if(Array.isArray(a)){if(!Array.isArray(r)||a.length!==r.length)return!1;for(let l=0;l<a.length;l++)if(!Xe(a[l],r[l]))return!1;return!0}if(typeof a=="object"&&a!==null&&r!==null){if(typeof r!="object"||Object.keys(a).length!==Object.keys(r).length)return!1;for(const l in a)if(!Xe(a[l],r[l]))return!1;return!0}return a===r}function at(a,r){a.push(r)}function ft(a,r,l){at(l,{command:"addSource",args:[a,r[a]]})}function nn(a,r,l){at(r,{command:"removeSource",args:[a]}),l[a]=!0}function mt(a,r,l,d){nn(a,l,d),ft(a,r,l)}function Kt(a,r,l){let d;for(d in a[l])if(Object.prototype.hasOwnProperty.call(a[l],d)&&d!=="data"&&!Xe(a[l][d],r[l][d]))return!1;for(d in r[l])if(Object.prototype.hasOwnProperty.call(r[l],d)&&d!=="data"&&!Xe(a[l][d],r[l][d]))return!1;return!0}function rn(a,r,l,d,g,x){a=a||{},r=r||{};for(const b in a)Object.prototype.hasOwnProperty.call(a,b)&&(Xe(a[b],r[b])||l.push({command:x,args:[d,b,r[b],g]}));for(const b in r)Object.prototype.hasOwnProperty.call(r,b)&&!Object.prototype.hasOwnProperty.call(a,b)&&(Xe(a[b],r[b])||l.push({command:x,args:[d,b,r[b],g]}))}function Tt(a){return a.id}function $t(a,r){return a[r.id]=r,a}class qe{constructor(r,l,d,g){this.message=(r?`${r}: `:"")+d,g&&(this.identifier=g),l!=null&&l.__line__&&(this.line=l.__line__)}}function Gt(a,...r){for(const l of r)for(const d in l)a[d]=l[d];return a}class Nt extends Error{constructor(r,l){super(l),this.message=l,this.key=r}}class bn{constructor(r,l=[]){this.parent=r,this.bindings={};for(const[d,g]of l)this.bindings[d]=g}concat(r){return new bn(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const wn={kind:"null"},nt={kind:"number"},Rt={kind:"string"},Lt={kind:"boolean"},Ot={kind:"color"},$={kind:"object"},Le={kind:"value"},rt={kind:"collator"},wt={kind:"formatted"},se={kind:"padding"},k={kind:"resolvedImage"},F={kind:"variableAnchorOffsetCollection"};function j(a,r){return{kind:"array",itemType:a,N:r}}function Y(a){if(a.kind==="array"){const r=Y(a.itemType);return typeof a.N=="number"?`array<${r}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${r}>`}return a.kind}const ue=[wn,nt,Rt,Lt,Ot,wt,$,j(Le),se,k,F];function ye(a,r){if(r.kind==="error")return null;if(a.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!ye(a.itemType,r.itemType))&&(typeof a.N!="number"||a.N===r.N))return null}else{if(a.kind===r.kind)return null;if(a.kind==="value"){for(const l of ue)if(!ye(l,r))return null}}return`Expected ${Y(a)} but found ${Y(r)} instead.`}function xe(a,r){return r.some(l=>l.kind===a.kind)}function he(a,r){return r.some(l=>l==="null"?a===null:l==="array"?Array.isArray(a):l==="object"?a&&!Array.isArray(a)&&typeof a=="object":l===typeof a)}function Se(a,r){return a.kind==="array"&&r.kind==="array"?a.itemType.kind===r.itemType.kind&&typeof a.N=="number":a.kind===r.kind}const Ne=.96422,Ge=.82521,ze=4/29,yt=6/29,Ht=3*yt*yt,qt=yt*yt*yt,sn=Math.PI/180,on=180/Math.PI;function Hn(a){return(a%=360)<0&&(a+=360),a}function zn([a,r,l,d]){let g,x;const b=Ee((.2225045*(a=oe(a))+.7168786*(r=oe(r))+.0606169*(l=oe(l)))/1);a===r&&r===l?g=x=b:(g=Ee((.4360747*a+.3850649*r+.1430804*l)/Ne),x=Ee((.0139322*a+.0971045*r+.7141733*l)/Ge));const T=116*b-16;return[T<0?0:T,500*(g-b),200*(b-x),d]}function oe(a){return a<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function Ee(a){return a>qt?Math.pow(a,1/3):a/Ht+ze}function Ue([a,r,l,d]){let g=(a+16)/116,x=isNaN(r)?g:g+r/500,b=isNaN(l)?g:g-l/200;return g=1*Ve(g),x=Ne*Ve(x),b=Ge*Ve(b),[Be(3.1338561*x-1.6168667*g-.4906146*b),Be(-.9787684*x+1.9161415*g+.033454*b),Be(.0719453*x-.2289914*g+1.4052427*b),d]}function Be(a){return(a=a<=.00304?12.92*a:1.055*Math.pow(a,1/2.4)-.055)<0?0:a>1?1:a}function Ve(a){return a>yt?a*a*a:Ht*(a-ze)}function vt(a){return parseInt(a.padEnd(2,a),16)/255}function jt(a,r){return bt(r?a/100:a,0,1)}function bt(a,r,l){return Math.min(Math.max(r,a),l)}function Bt(a){return!a.some(Number.isNaN)}const ln={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ft{constructor(r,l,d,g=1,x=!0){this.r=r,this.g=l,this.b=d,this.a=g,x||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[r,l,d,g]))}static parse(r){if(r instanceof Ft)return r;if(typeof r!="string")return;const l=function(d){if((d=d.toLowerCase().trim())==="transparent")return[0,0,0,0];const g=ln[d];if(g){const[b,T,P]=g;return[b/255,T/255,P/255,1]}if(d.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(d)){const b=d.length<6?1:2;let T=1;return[vt(d.slice(T,T+=b)),vt(d.slice(T,T+=b)),vt(d.slice(T,T+=b)),vt(d.slice(T,T+b)||"ff")]}if(d.startsWith("rgb")){const b=d.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[T,P,D,O,H,q,Q,ie,ce,me,we,De]=b,Me=[O||" ",Q||" ",me].join("");if(Me==="  "||Me==="  /"||Me===",,"||Me===",,,"){const Re=[D,q,ce].join(""),et=Re==="%%%"?100:Re===""?255:0;if(et){const ot=[bt(+P/et,0,1),bt(+H/et,0,1),bt(+ie/et,0,1),we?jt(+we,De):1];if(Bt(ot))return ot}}return}}const x=d.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(x){const[b,T,P,D,O,H,q,Q,ie]=x,ce=[P||" ",O||" ",q].join("");if(ce==="  "||ce==="  /"||ce===",,"||ce===",,,"){const me=[+T,bt(+D,0,100),bt(+H,0,100),Q?jt(+Q,ie):1];if(Bt(me))return function([we,De,Me,Re]){function et(ot){const Dt=(ot+we/30)%12,Yt=De*Math.min(Me,1-Me);return Me-Yt*Math.max(-1,Math.min(Dt-3,9-Dt,1))}return we=Hn(we),De/=100,Me/=100,[et(0),et(8),et(4),Re]}(me)}}}(r);return l?new Ft(...l,!1):void 0}get rgb(){const{r,g:l,b:d,a:g}=this,x=g||1/0;return this.overwriteGetter("rgb",[r/x,l/x,d/x,g])}get hcl(){return this.overwriteGetter("hcl",function(r){const[l,d,g,x]=zn(r),b=Math.sqrt(d*d+g*g);return[Math.round(1e4*b)?Hn(Math.atan2(g,d)*on):NaN,b,l,x]}(this.rgb))}get lab(){return this.overwriteGetter("lab",zn(this.rgb))}overwriteGetter(r,l){return Object.defineProperty(this,r,{value:l}),l}toString(){const[r,l,d,g]=this.rgb;return`rgba(${[r,l,d].map(x=>Math.round(255*x)).join(",")},${g})`}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class vn{constructor(r,l,d){this.sensitivity=r?l?"variant":"case":l?"accent":"base",this.locale=d,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,l){return this.collator.compare(r,l)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ai{constructor(r,l,d,g,x){this.text=r,this.image=l,this.scale=d,this.fontStack=g,this.textColor=x}}class Yn{constructor(r){this.sections=r}static fromString(r){return new Yn([new ai(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof Yn?r:Yn.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class jn{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof jn)return r;if(typeof r=="number")return new jn([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const l of r)if(typeof l!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new jn(r)}}toString(){return JSON.stringify(this.values)}}const qr=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class An{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof An)return r;if(Array.isArray(r)&&!(r.length<1)&&r.length%2==0){for(let l=0;l<r.length;l+=2){const d=r[l],g=r[l+1];if(typeof d!="string"||!qr.has(d)||!Array.isArray(g)||g.length!==2||typeof g[0]!="number"||typeof g[1]!="number")return}return new An(r)}}toString(){return JSON.stringify(this.values)}}class fn{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new fn({name:r,available:!1}):null}}function go(a,r,l,d){return typeof a=="number"&&a>=0&&a<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof l=="number"&&l>=0&&l<=255?d===void 0||typeof d=="number"&&d>=0&&d<=1?null:`Invalid rgba value [${[a,r,l,d].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof d=="number"?[a,r,l,d]:[a,r,l]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Gn(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof Ft||a instanceof vn||a instanceof Yn||a instanceof jn||a instanceof An||a instanceof fn)return!0;if(Array.isArray(a)){for(const r of a)if(!Gn(r))return!1;return!0}if(typeof a=="object"){for(const r in a)if(!Gn(a[r]))return!1;return!0}return!1}function Xn(a){if(a===null)return wn;if(typeof a=="string")return Rt;if(typeof a=="boolean")return Lt;if(typeof a=="number")return nt;if(a instanceof Ft)return Ot;if(a instanceof vn)return rt;if(a instanceof Yn)return wt;if(a instanceof jn)return se;if(a instanceof An)return F;if(a instanceof fn)return k;if(Array.isArray(a)){const r=a.length;let l;for(const d of a){const g=Xn(d);if(l){if(l===g)continue;l=Le;break}l=g}return j(l||Le,r)}return $}function oa(a){const r=typeof a;return a===null?"":r==="string"||r==="number"||r==="boolean"?String(a):a instanceof Ft||a instanceof Yn||a instanceof jn||a instanceof An||a instanceof fn?a.toString():JSON.stringify(a)}class Lr{constructor(r,l){this.type=r,this.value=l}static parse(r,l){if(r.length!==2)return l.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Gn(r[1]))return l.error("invalid value");const d=r[1];let g=Xn(d);const x=l.expectedType;return g.kind!=="array"||g.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(g=x),new Lr(g,d)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class ei{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const ci={string:Rt,number:nt,boolean:Lt,object:$};class Ai{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");let d,g=1;const x=r[0];if(x==="array"){let T,P;if(r.length>2){const D=r[1];if(typeof D!="string"||!(D in ci)||D==="object")return l.error('The item type argument of "array" must be one of string, number, boolean',1);T=ci[D],g++}else T=Le;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return l.error('The length argument to "array" must be a positive integer literal',2);P=r[2],g++}d=j(T,P)}else{if(!ci[x])throw new Error(`Types doesn't contain name = ${x}`);d=ci[x]}const b=[];for(;g<r.length;g++){const T=l.parse(r[g],g,Le);if(!T)return null;b.push(T)}return new Ai(d,b)}evaluate(r){for(let l=0;l<this.args.length;l++){const d=this.args[l].evaluate(r);if(!ye(this.type,Xn(d)))return d;if(l===this.args.length-1)throw new ei(`Expected value to be of type ${Y(this.type)}, but found ${Y(Xn(d))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const la={"to-boolean":Lt,"to-color":Ot,"to-number":nt,"to-string":Rt};class di{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const d=r[0];if(!la[d])throw new Error(`Can't parse ${d} as it is not part of the known types`);if((d==="to-boolean"||d==="to-string")&&r.length!==2)return l.error("Expected one argument.");const g=la[d],x=[];for(let b=1;b<r.length;b++){const T=l.parse(r[b],b,Le);if(!T)return null;x.push(T)}return new di(g,x)}evaluate(r){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(r);case"color":{let l,d;for(const g of this.args){if(l=g.evaluate(r),d=null,l instanceof Ft)return l;if(typeof l=="string"){const x=r.parseColor(l);if(x)return x}else if(Array.isArray(l)&&(d=l.length<3||l.length>4?`Invalid rbga value ${JSON.stringify(l)}: expected an array containing either three or four numeric values.`:go(l[0],l[1],l[2],l[3]),!d))return new Ft(l[0]/255,l[1]/255,l[2]/255,l[3])}throw new ei(d||`Could not parse color from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"padding":{let l;for(const d of this.args){l=d.evaluate(r);const g=jn.parse(l);if(g)return g}throw new ei(`Could not parse padding from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"variableAnchorOffsetCollection":{let l;for(const d of this.args){l=d.evaluate(r);const g=An.parse(l);if(g)return g}throw new ei(`Could not parse variableAnchorOffsetCollection from value '${typeof l=="string"?l:JSON.stringify(l)}'`)}case"number":{let l=null;for(const d of this.args){if(l=d.evaluate(r),l===null)return 0;const g=Number(l);if(!isNaN(g))return g}throw new ei(`Could not convert ${JSON.stringify(l)} to number.`)}case"formatted":return Yn.fromString(oa(this.args[0].evaluate(r)));case"resolvedImage":return fn.fromString(oa(this.args[0].evaluate(r)));default:return oa(this.args[0].evaluate(r))}}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Aa=["Unknown","Point","LineString","Polygon"];class ca{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Aa[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let l=this._parseColorCache[r];return l||(l=this._parseColorCache[r]=Ft.parse(r)),l}}class Un{constructor(r,l,d=[],g,x=new bn,b=[]){this.registry=r,this.path=d,this.key=d.map(T=>`[${T}]`).join(""),this.scope=x,this.errors=b,this.expectedType=g,this._isConstant=l}parse(r,l,d,g,x={}){return l?this.concat(l,d,g)._parse(r,x):this._parse(r,x)}_parse(r,l){function d(g,x,b){return b==="assert"?new Ai(x,[g]):b==="coerce"?new di(x,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const x=this.registry[g];if(x){let b=x.parse(r,this);if(!b)return null;if(this.expectedType){const T=this.expectedType,P=b.type;if(T.kind!=="string"&&T.kind!=="number"&&T.kind!=="boolean"&&T.kind!=="object"&&T.kind!=="array"||P.kind!=="value")if(T.kind!=="color"&&T.kind!=="formatted"&&T.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string")if(T.kind!=="padding"||P.kind!=="value"&&P.kind!=="number"&&P.kind!=="array")if(T.kind!=="variableAnchorOffsetCollection"||P.kind!=="value"&&P.kind!=="array"){if(this.checkSubtype(T,P))return null}else b=d(b,T,l.typeAnnotation||"coerce");else b=d(b,T,l.typeAnnotation||"coerce");else b=d(b,T,l.typeAnnotation||"coerce");else b=d(b,T,l.typeAnnotation||"assert")}if(!(b instanceof Lr)&&b.type.kind!=="resolvedImage"&&this._isConstant(b)){const T=new ca;try{b=new Lr(b.type,b.evaluate(T))}catch(P){return this.error(P.message),null}}return b}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,l,d){const g=typeof r=="number"?this.path.concat(r):this.path,x=d?this.scope.concat(d):this.scope;return new Un(this.registry,this._isConstant,g,l||null,x,this.errors)}error(r,...l){const d=`${this.key}${l.map(g=>`[${g}]`).join("")}`;this.errors.push(new Nt(d,r))}checkSubtype(r,l){const d=ye(r,l);return d&&this.error(d),d}}class Cc{constructor(r,l,d){this.type=rt,this.locale=d,this.caseSensitive=r,this.diacriticSensitive=l}static parse(r,l){if(r.length!==2)return l.error("Expected one argument.");const d=r[1];if(typeof d!="object"||Array.isArray(d))return l.error("Collator options argument must be an object.");const g=l.parse(d["case-sensitive"]!==void 0&&d["case-sensitive"],1,Lt);if(!g)return null;const x=l.parse(d["diacritic-sensitive"]!==void 0&&d["diacritic-sensitive"],1,Lt);if(!x)return null;let b=null;return d.locale&&(b=l.parse(d.locale,1,Rt),!b)?null:new Cc(g,x,b)}evaluate(r){return new vn(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const ws=8192;function Lh(a,r){a[0]=Math.min(a[0],r[0]),a[1]=Math.min(a[1],r[1]),a[2]=Math.max(a[2],r[0]),a[3]=Math.max(a[3],r[1])}function Cl(a,r){return!(a[0]<=r[0]||a[2]>=r[2]||a[1]<=r[1]||a[3]>=r[3])}function ip(a,r){const l=(180+a[0])/360,d=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(l*g*ws),Math.round(d*g*ws)]}function __(a,r,l){const d=a[0]-r[0],g=a[1]-r[1],x=a[0]-l[0],b=a[1]-l[1];return d*b-x*g==0&&d*x<=0&&g*b<=0}function Pc(a,r){let l=!1;for(let b=0,T=r.length;b<T;b++){const P=r[b];for(let D=0,O=P.length;D<O-1;D++){if(__(a,P[D],P[D+1]))return!1;(g=P[D])[1]>(d=a)[1]!=(x=P[D+1])[1]>d[1]&&d[0]<(x[0]-g[0])*(d[1]-g[1])/(x[1]-g[1])+g[0]&&(l=!l)}}var d,g,x;return l}function rp(a,r){for(let l=0;l<r.length;l++)if(Pc(a,r[l]))return!0;return!1}function sp(a,r,l,d){const g=d[0]-l[0],x=d[1]-l[1],b=(a[0]-l[0])*x-g*(a[1]-l[1]),T=(r[0]-l[0])*x-g*(r[1]-l[1]);return b>0&&T<0||b<0&&T>0}function y_(a,r,l){for(const D of l)for(let O=0;O<D.length-1;++O)if((T=[(b=D[O+1])[0]-(x=D[O])[0],b[1]-x[1]])[0]*(P=[(g=r)[0]-(d=a)[0],g[1]-d[1]])[1]-T[1]*P[0]!=0&&sp(d,g,x,b)&&sp(x,b,d,g))return!0;var d,g,x,b,T,P;return!1}function ap(a,r){for(let l=0;l<a.length;++l)if(!Pc(a[l],r))return!1;for(let l=0;l<a.length-1;++l)if(y_(a[l],a[l+1],r))return!1;return!0}function v_(a,r){for(let l=0;l<r.length;l++)if(ap(a,r[l]))return!0;return!1}function Rc(a,r,l){const d=[];for(let g=0;g<a.length;g++){const x=[];for(let b=0;b<a[g].length;b++){const T=ip(a[g][b],l);Lh(r,T),x.push(T)}d.push(x)}return d}function Dh(a,r,l){const d=[];for(let g=0;g<a.length;g++){const x=Rc(a[g],r,l);d.push(x)}return d}function op(a,r,l,d){if(a[0]<l[0]||a[0]>l[2]){const g=.5*d;let x=a[0]-l[0]>g?-d:l[0]-a[0]>g?d:0;x===0&&(x=a[0]-l[2]>g?-d:l[2]-a[0]>g?d:0),a[0]+=x}Lh(r,a)}function lp(a,r,l,d){const g=Math.pow(2,d.z)*ws,x=[d.x*ws,d.y*ws],b=[];for(const T of a)for(const P of T){const D=[P.x+x[0],P.y+x[1]];op(D,r,l,g),b.push(D)}return b}function Ic(a,r,l,d){const g=Math.pow(2,d.z)*ws,x=[d.x*ws,d.y*ws],b=[];for(const P of a){const D=[];for(const O of P){const H=[O.x+x[0],O.y+x[1]];Lh(r,H),D.push(H)}b.push(D)}if(r[2]-r[0]<=g/2){(T=r)[0]=T[1]=1/0,T[2]=T[3]=-1/0;for(const P of b)for(const D of P)op(D,r,l,g)}var T;return b}class Ca{constructor(r,l){this.type=Lt,this.geojson=r,this.geometries=l}static parse(r,l){if(r.length!==2)return l.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Gn(r[1])){const d=r[1];if(d.type==="FeatureCollection"){const g=[];for(const x of d.features){const{type:b,coordinates:T}=x.geometry;b==="Polygon"&&g.push(T),b==="MultiPolygon"&&g.push(...T)}if(g.length)return new Ca(d,{type:"MultiPolygon",coordinates:g})}else if(d.type==="Feature"){const g=d.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ca(d,d.geometry)}else if(d.type==="Polygon"||d.type==="MultiPolygon")return new Ca(d,d)}return l.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(d.type==="Polygon"){const T=Rc(d.coordinates,x,b),P=lp(l.geometry(),g,x,b);if(!Cl(g,x))return!1;for(const D of P)if(!Pc(D,T))return!1}if(d.type==="MultiPolygon"){const T=Dh(d.coordinates,x,b),P=lp(l.geometry(),g,x,b);if(!Cl(g,x))return!1;for(const D of P)if(!rp(D,T))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(l,d){const g=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],b=l.canonicalID();if(d.type==="Polygon"){const T=Rc(d.coordinates,x,b),P=Ic(l.geometry(),g,x,b);if(!Cl(g,x))return!1;for(const D of P)if(!ap(D,T))return!1}if(d.type==="MultiPolygon"){const T=Dh(d.coordinates,x,b),P=Ic(l.geometry(),g,x,b);if(!Cl(g,x))return!1;for(const D of P)if(!v_(D,T))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Lc{constructor(r,l){this.type=l.type,this.name=r,this.boundExpression=l}static parse(r,l){if(r.length!==2||typeof r[1]!="string")return l.error("'var' expression requires exactly one string literal argument.");const d=r[1];return l.scope.has(d)?new Lc(d,l.scope.get(d)):l.error(`Unknown variable "${d}". Make sure "${d}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class Zr{constructor(r,l,d,g){this.name=r,this.type=l,this._evaluate=d,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,l){const d=r[0],g=Zr.definitions[d];if(!g)return l.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0);const x=Array.isArray(g)?g[0]:g.type,b=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,T=b.filter(([D])=>!Array.isArray(D)||D.length===r.length-1);let P=null;for(const[D,O]of T){P=new Un(l.registry,Pl,l.path,null,l.scope);const H=[];let q=!1;for(let Q=1;Q<r.length;Q++){const ie=r[Q],ce=Array.isArray(D)?D[Q-1]:D.type,me=P.parse(ie,1+H.length,ce);if(!me){q=!0;break}H.push(me)}if(!q)if(Array.isArray(D)&&D.length!==H.length)P.error(`Expected ${D.length} arguments, but found ${H.length} instead.`);else{for(let Q=0;Q<H.length;Q++){const ie=Array.isArray(D)?D[Q]:D.type,ce=H[Q];P.concat(Q+1).checkSubtype(ie,ce.type)}if(P.errors.length===0)return new Zr(d,x,O,H)}}if(T.length===1)l.errors.push(...P.errors);else{const D=(T.length?T:b).map(([H])=>{return q=H,Array.isArray(q)?`(${q.map(Y).join(", ")})`:`(${Y(q.type)}...)`;var q}).join(" | "),O=[];for(let H=1;H<r.length;H++){const q=l.parse(r[H],1+O.length);if(!q)return null;O.push(Y(q.type))}l.error(`Expected arguments of type ${D}, but found (${O.join(", ")}) instead.`)}return null}static register(r,l){Zr.definitions=l;for(const d in l)r[d]=Zr}}function Pl(a){if(a instanceof Lc)return Pl(a.boundExpression);if(a instanceof Zr&&a.name==="error"||a instanceof Cc||a instanceof Ca)return!1;const r=a instanceof di||a instanceof Ai;let l=!0;return a.eachChild(d=>{l=r?l&&Pl(d):l&&d instanceof Lr}),!!l&&Rl(a)&&Dc(a,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Rl(a){if(a instanceof Zr&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof Ca)return!1;let r=!0;return a.eachChild(l=>{r&&!Rl(l)&&(r=!1)}),r}function Il(a){if(a instanceof Zr&&a.name==="feature-state")return!1;let r=!0;return a.eachChild(l=>{r&&!Il(l)&&(r=!1)}),r}function Dc(a,r){if(a instanceof Zr&&r.indexOf(a.name)>=0)return!1;let l=!0;return a.eachChild(d=>{l&&!Dc(d,r)&&(l=!1)}),l}function Ll(a,r){const l=a.length-1;let d,g,x=0,b=l,T=0;for(;x<=b;)if(T=Math.floor((x+b)/2),d=a[T],g=a[T+1],d<=r){if(T===l||r<g)return T;x=T+1}else{if(!(d>r))throw new ei("Input is not a number.");b=T-1}return 0}class _o{constructor(r,l,d){this.type=r,this.input=l,this.labels=[],this.outputs=[];for(const[g,x]of d)this.labels.push(g),this.outputs.push(x)}static parse(r,l){if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");const d=l.parse(r[1],1,nt);if(!d)return null;const g=[];let x=null;l.expectedType&&l.expectedType.kind!=="value"&&(x=l.expectedType);for(let b=1;b<r.length;b+=2){const T=b===1?-1/0:r[b],P=r[b+1],D=b,O=b+1;if(typeof T!="number")return l.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(g.length&&g[g.length-1][0]>=T)return l.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const H=l.parse(P,O,x);if(!H)return null;x=x||H.type,g.push([T,H])}return new _o(x,d,g)}evaluate(r){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=l[0])return d[0].evaluate(r);const x=l.length;return g>=l[x-1]?d[x-1].evaluate(r):d[Ll(l,g)].evaluate(r)}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function x_(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var b_=cp;function cp(a,r,l,d){this.cx=3*a,this.bx=3*(l-a)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(d-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=a,this.p1y=r,this.p2x=l,this.p2y=d}cp.prototype={sampleCurveX:function(a){return((this.ax*a+this.bx)*a+this.cx)*a},sampleCurveY:function(a){return((this.ay*a+this.by)*a+this.cy)*a},sampleCurveDerivativeX:function(a){return(3*this.ax*a+2*this.bx)*a+this.cx},solveCurveX:function(a,r){if(r===void 0&&(r=1e-6),a<0)return 0;if(a>1)return 1;for(var l=a,d=0;d<8;d++){var g=this.sampleCurveX(l)-a;if(Math.abs(g)<r)return l;var x=this.sampleCurveDerivativeX(l);if(Math.abs(x)<1e-6)break;l-=g/x}var b=0,T=1;for(l=a,d=0;d<20&&(g=this.sampleCurveX(l),!(Math.abs(g-a)<r));d++)a>g?b=l:T=l,l=.5*(T-b)+b;return l},solve:function(a,r){return this.sampleCurveY(this.solveCurveX(a,r))}};var w_=x_(b_);function Pa(a,r,l){return a+l*(r-a)}function zc(a,r,l){return a.map((d,g)=>Pa(d,r[g],l))}const Dr={number:Pa,color:function(a,r,l,d="rgb"){switch(d){case"rgb":{const[g,x,b,T]=zc(a.rgb,r.rgb,l);return new Ft(g,x,b,T,!1)}case"hcl":{const[g,x,b,T]=a.hcl,[P,D,O,H]=r.hcl;let q,Q;if(isNaN(g)||isNaN(P))isNaN(g)?isNaN(P)?q=NaN:(q=P,b!==1&&b!==0||(Q=D)):(q=g,O!==1&&O!==0||(Q=x));else{let De=P-g;P>g&&De>180?De-=360:P<g&&g-P>180&&(De+=360),q=g+l*De}const[ie,ce,me,we]=function([De,Me,Re,et]){return De=isNaN(De)?0:De*sn,Ue([Re,Math.cos(De)*Me,Math.sin(De)*Me,et])}([q,Q??Pa(x,D,l),Pa(b,O,l),Pa(T,H,l)]);return new Ft(ie,ce,me,we,!1)}case"lab":{const[g,x,b,T]=Ue(zc(a.lab,r.lab,l));return new Ft(g,x,b,T,!1)}}},array:zc,padding:function(a,r,l){return new jn(zc(a.values,r.values,l))},variableAnchorOffsetCollection:function(a,r,l){const d=a.values,g=r.values;if(d.length!==g.length)throw new ei(`Cannot interpolate values of different length. from: ${a.toString()}, to: ${r.toString()}`);const x=[];for(let b=0;b<d.length;b+=2){if(d[b]!==g[b])throw new ei(`Cannot interpolate values containing mismatched anchors. from[${b}]: ${d[b]}, to[${b}]: ${g[b]}`);x.push(d[b]);const[T,P]=d[b+1],[D,O]=g[b+1];x.push([Pa(T,D,l),Pa(P,O,l)])}return new An(x)}};class ar{constructor(r,l,d,g,x){this.type=r,this.operator=l,this.interpolation=d,this.input=g,this.labels=[],this.outputs=[];for(const[b,T]of x)this.labels.push(b),this.outputs.push(T)}static interpolationFactor(r,l,d,g){let x=0;if(r.name==="exponential")x=yo(l,r.base,d,g);else if(r.name==="linear")x=yo(l,1,d,g);else if(r.name==="cubic-bezier"){const b=r.controlPoints;x=new w_(b[0],b[1],b[2],b[3]).solve(yo(l,1,d,g))}return x}static parse(r,l){let[d,g,x,...b]=r;if(!Array.isArray(g)||g.length===0)return l.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const D=g[1];if(typeof D!="number")return l.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:D}}else{if(g[0]!=="cubic-bezier")return l.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const D=g.slice(1);if(D.length!==4||D.some(O=>typeof O!="number"||O<0||O>1))return l.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:D}}}if(r.length-1<4)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return l.error("Expected an even number of arguments.");if(x=l.parse(x,2,nt),!x)return null;const T=[];let P=null;d==="interpolate-hcl"||d==="interpolate-lab"?P=Ot:l.expectedType&&l.expectedType.kind!=="value"&&(P=l.expectedType);for(let D=0;D<b.length;D+=2){const O=b[D],H=b[D+1],q=D+3,Q=D+4;if(typeof O!="number")return l.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',q);if(T.length&&T[T.length-1][0]>=O)return l.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',q);const ie=l.parse(H,Q,P);if(!ie)return null;P=P||ie.type,T.push([O,ie])}return Se(P,nt)||Se(P,Ot)||Se(P,se)||Se(P,F)||Se(P,j(nt))?new ar(P,d,g,x,T):l.error(`Type ${Y(P)} is not interpolatable.`)}evaluate(r){const l=this.labels,d=this.outputs;if(l.length===1)return d[0].evaluate(r);const g=this.input.evaluate(r);if(g<=l[0])return d[0].evaluate(r);const x=l.length;if(g>=l[x-1])return d[x-1].evaluate(r);const b=Ll(l,g),T=ar.interpolationFactor(this.interpolation,g,l[b],l[b+1]),P=d[b].evaluate(r),D=d[b+1].evaluate(r);switch(this.operator){case"interpolate":return Dr[this.type.kind](P,D,T);case"interpolate-hcl":return Dr.color(P,D,T,"hcl");case"interpolate-lab":return Dr.color(P,D,T,"lab")}}eachChild(r){r(this.input);for(const l of this.outputs)r(l)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function yo(a,r,l,d){const g=d-l,x=a-l;return g===0?0:r===1?x/g:(Math.pow(r,x)-1)/(Math.pow(r,g)-1)}class Nn{constructor(r,l){this.type=r,this.args=l}static parse(r,l){if(r.length<2)return l.error("Expectected at least one argument.");let d=null;const g=l.expectedType;g&&g.kind!=="value"&&(d=g);const x=[];for(const T of r.slice(1)){const P=l.parse(T,1+x.length,d,void 0,{typeAnnotation:"omit"});if(!P)return null;d=d||P.type,x.push(P)}if(!d)throw new Error("No output type");const b=g&&x.some(T=>ye(g,T.type));return new Nn(b?Le:d,x)}evaluate(r){let l,d=null,g=0;for(const x of this.args)if(g++,d=x.evaluate(r),d&&d instanceof fn&&!d.available&&(l||(l=d.name),d=null,g===this.args.length&&(d=l)),d!==null)break;return d}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class kc{constructor(r,l){this.type=l.type,this.bindings=[].concat(r),this.result=l}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const l of this.bindings)r(l[1]);r(this.result)}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const d=[];for(let x=1;x<r.length-1;x+=2){const b=r[x];if(typeof b!="string")return l.error(`Expected string, but found ${typeof b} instead.`,x);if(/[^a-zA-Z0-9_]/.test(b))return l.error("Variable names must contain only alphanumeric characters or '_'.",x);const T=l.parse(r[x+1],x+1);if(!T)return null;d.push([b,T])}const g=l.parse(r[r.length-1],r.length-1,l.expectedType,d);return g?new kc(d,g):null}outputDefined(){return this.result.outputDefined()}}class zh{constructor(r,l,d){this.type=r,this.index=l,this.input=d}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,nt),g=l.parse(r[2],2,j(l.expectedType||Le));return d&&g?new zh(g.type.itemType,d,g):null}evaluate(r){const l=this.index.evaluate(r),d=this.input.evaluate(r);if(l<0)throw new ei(`Array index out of bounds: ${l} < 0.`);if(l>=d.length)throw new ei(`Array index out of bounds: ${l} > ${d.length-1}.`);if(l!==Math.floor(l))throw new ei(`Array index must be an integer, but found ${l} instead.`);return d[l]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class kh{constructor(r,l){this.type=Lt,this.needle=r,this.haystack=l}static parse(r,l){if(r.length!==3)return l.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,Le),g=l.parse(r[2],2,Le);return d&&g?xe(d.type,[Lt,Rt,nt,wn,Le])?new kh(d,g):l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(d.type)} instead`):null}evaluate(r){const l=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!d)return!1;if(!he(l,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Xn(l))} instead.`);if(!he(d,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Y(Xn(d))} instead.`);return d.indexOf(l)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class Fc{constructor(r,l,d){this.type=nt,this.needle=r,this.haystack=l,this.fromIndex=d}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,Le),g=l.parse(r[2],2,Le);if(!d||!g)return null;if(!xe(d.type,[Lt,Rt,nt,wn,Le]))return l.error(`Expected first argument to be of type boolean, string, number or null, but found ${Y(d.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,nt);return x?new Fc(d,g,x):null}return new Fc(d,g)}evaluate(r){const l=this.needle.evaluate(r),d=this.haystack.evaluate(r);if(!he(l,["boolean","string","number","null"]))throw new ei(`Expected first argument to be of type boolean, string, number or null, but found ${Y(Xn(l))} instead.`);if(!he(d,["string","array"]))throw new ei(`Expected second argument to be of type array or string, but found ${Y(Xn(d))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return d.indexOf(l,g)}return d.indexOf(l)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Fh{constructor(r,l,d,g,x,b){this.inputType=r,this.type=l,this.input=d,this.cases=g,this.outputs=x,this.otherwise=b}static parse(r,l){if(r.length<5)return l.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return l.error("Expected an even number of arguments.");let d,g;l.expectedType&&l.expectedType.kind!=="value"&&(g=l.expectedType);const x={},b=[];for(let D=2;D<r.length-1;D+=2){let O=r[D];const H=r[D+1];Array.isArray(O)||(O=[O]);const q=l.concat(D);if(O.length===0)return q.error("Expected at least one branch label.");for(const ie of O){if(typeof ie!="number"&&typeof ie!="string")return q.error("Branch labels must be numbers or strings.");if(typeof ie=="number"&&Math.abs(ie)>Number.MAX_SAFE_INTEGER)return q.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof ie=="number"&&Math.floor(ie)!==ie)return q.error("Numeric branch labels must be integer values.");if(d){if(q.checkSubtype(d,Xn(ie)))return null}else d=Xn(ie);if(x[String(ie)]!==void 0)return q.error("Branch labels must be unique.");x[String(ie)]=b.length}const Q=l.parse(H,D,g);if(!Q)return null;g=g||Q.type,b.push(Q)}const T=l.parse(r[1],1,Le);if(!T)return null;const P=l.parse(r[r.length-1],r.length-1,g);return P?T.type.kind!=="value"&&l.concat(1).checkSubtype(d,T.type)?null:new Fh(d,g,T,x,b,P):null}evaluate(r){const l=this.input.evaluate(r);return(Xn(l)===this.inputType&&this.outputs[this.cases[l]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Uh{constructor(r,l,d){this.type=r,this.branches=l,this.otherwise=d}static parse(r,l){if(r.length<4)return l.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return l.error("Expected an odd number of arguments.");let d;l.expectedType&&l.expectedType.kind!=="value"&&(d=l.expectedType);const g=[];for(let b=1;b<r.length-1;b+=2){const T=l.parse(r[b],b,Lt);if(!T)return null;const P=l.parse(r[b+1],b+1,d);if(!P)return null;g.push([T,P]),d=d||P.type}const x=l.parse(r[r.length-1],r.length-1,d);if(!x)return null;if(!d)throw new Error("Can't infer output type");return new Uh(d,g,x)}evaluate(r){for(const[l,d]of this.branches)if(l.evaluate(r))return d.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[l,d]of this.branches)r(l),r(d);r(this.otherwise)}outputDefined(){return this.branches.every(([r,l])=>l.outputDefined())&&this.otherwise.outputDefined()}}class Uc{constructor(r,l,d,g){this.type=r,this.input=l,this.beginIndex=d,this.endIndex=g}static parse(r,l){if(r.length<=2||r.length>=5)return l.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const d=l.parse(r[1],1,Le),g=l.parse(r[2],2,nt);if(!d||!g)return null;if(!xe(d.type,[j(Le),Rt,Le]))return l.error(`Expected first argument to be of type array or string, but found ${Y(d.type)} instead`);if(r.length===4){const x=l.parse(r[3],3,nt);return x?new Uc(d.type,d,g,x):null}return new Uc(d.type,d,g)}evaluate(r){const l=this.input.evaluate(r),d=this.beginIndex.evaluate(r);if(!he(l,["string","array"]))throw new ei(`Expected first argument to be of type array or string, but found ${Y(Xn(l))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return l.slice(d,g)}return l.slice(d)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function up(a,r){return a==="=="||a==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function hp(a,r,l,d){return d.compare(r,l)===0}function vo(a,r,l){const d=a!=="=="&&a!=="!=";return class wA{constructor(x,b,T){this.type=Lt,this.lhs=x,this.rhs=b,this.collator=T,this.hasUntypedArgument=x.type.kind==="value"||b.type.kind==="value"}static parse(x,b){if(x.length!==3&&x.length!==4)return b.error("Expected two or three arguments.");const T=x[0];let P=b.parse(x[1],1,Le);if(!P)return null;if(!up(T,P.type))return b.concat(1).error(`"${T}" comparisons are not supported for type '${Y(P.type)}'.`);let D=b.parse(x[2],2,Le);if(!D)return null;if(!up(T,D.type))return b.concat(2).error(`"${T}" comparisons are not supported for type '${Y(D.type)}'.`);if(P.type.kind!==D.type.kind&&P.type.kind!=="value"&&D.type.kind!=="value")return b.error(`Cannot compare types '${Y(P.type)}' and '${Y(D.type)}'.`);d&&(P.type.kind==="value"&&D.type.kind!=="value"?P=new Ai(D.type,[P]):P.type.kind!=="value"&&D.type.kind==="value"&&(D=new Ai(P.type,[D])));let O=null;if(x.length===4){if(P.type.kind!=="string"&&D.type.kind!=="string"&&P.type.kind!=="value"&&D.type.kind!=="value")return b.error("Cannot use collator to compare non-string types.");if(O=b.parse(x[3],3,rt),!O)return null}return new wA(P,D,O)}evaluate(x){const b=this.lhs.evaluate(x),T=this.rhs.evaluate(x);if(d&&this.hasUntypedArgument){const P=Xn(b),D=Xn(T);if(P.kind!==D.kind||P.kind!=="string"&&P.kind!=="number")throw new ei(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${P.kind}, ${D.kind}) instead.`)}if(this.collator&&!d&&this.hasUntypedArgument){const P=Xn(b),D=Xn(T);if(P.kind!=="string"||D.kind!=="string")return r(x,b,T)}return this.collator?l(x,b,T,this.collator.evaluate(x)):r(x,b,T)}eachChild(x){x(this.lhs),x(this.rhs),this.collator&&x(this.collator)}outputDefined(){return!0}}}const S_=vo("==",function(a,r,l){return r===l},hp),M_=vo("!=",function(a,r,l){return r!==l},function(a,r,l,d){return!hp(0,r,l,d)}),T_=vo("<",function(a,r,l){return r<l},function(a,r,l,d){return d.compare(r,l)<0}),E_=vo(">",function(a,r,l){return r>l},function(a,r,l,d){return d.compare(r,l)>0}),A_=vo("<=",function(a,r,l){return r<=l},function(a,r,l,d){return d.compare(r,l)<=0}),C_=vo(">=",function(a,r,l){return r>=l},function(a,r,l,d){return d.compare(r,l)>=0});class Nh{constructor(r,l,d,g,x){this.type=Rt,this.number=r,this.locale=l,this.currency=d,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(r,l){if(r.length!==3)return l.error("Expected two arguments.");const d=l.parse(r[1],1,nt);if(!d)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return l.error("NumberFormat options argument must be an object.");let x=null;if(g.locale&&(x=l.parse(g.locale,1,Rt),!x))return null;let b=null;if(g.currency&&(b=l.parse(g.currency,1,Rt),!b))return null;let T=null;if(g["min-fraction-digits"]&&(T=l.parse(g["min-fraction-digits"],1,nt),!T))return null;let P=null;return g["max-fraction-digits"]&&(P=l.parse(g["max-fraction-digits"],1,nt),!P)?null:new Nh(d,x,b,T,P)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class Nc{constructor(r){this.type=wt,this.sections=r}static parse(r,l){if(r.length<2)return l.error("Expected at least one argument.");const d=r[1];if(!Array.isArray(d)&&typeof d=="object")return l.error("First argument must be an image or text section.");const g=[];let x=!1;for(let b=1;b<=r.length-1;++b){const T=r[b];if(x&&typeof T=="object"&&!Array.isArray(T)){x=!1;let P=null;if(T["font-scale"]&&(P=l.parse(T["font-scale"],1,nt),!P))return null;let D=null;if(T["text-font"]&&(D=l.parse(T["text-font"],1,j(Rt)),!D))return null;let O=null;if(T["text-color"]&&(O=l.parse(T["text-color"],1,Ot),!O))return null;const H=g[g.length-1];H.scale=P,H.font=D,H.textColor=O}else{const P=l.parse(r[b],1,Le);if(!P)return null;const D=P.type.kind;if(D!=="string"&&D!=="value"&&D!=="null"&&D!=="resolvedImage")return l.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,g.push({content:P,scale:null,font:null,textColor:null})}}return new Nc(g)}evaluate(r){return new Yn(this.sections.map(l=>{const d=l.content.evaluate(r);return Xn(d)===k?new ai("",d,null,null,null):new ai(oa(d),null,l.scale?l.scale.evaluate(r):null,l.font?l.font.evaluate(r).join(","):null,l.textColor?l.textColor.evaluate(r):null)}))}eachChild(r){for(const l of this.sections)r(l.content),l.scale&&r(l.scale),l.font&&r(l.font),l.textColor&&r(l.textColor)}outputDefined(){return!1}}class Oh{constructor(r){this.type=k,this.input=r}static parse(r,l){if(r.length!==2)return l.error("Expected two arguments.");const d=l.parse(r[1],1,Rt);return d?new Oh(d):l.error("No image name provided.")}evaluate(r){const l=this.input.evaluate(r),d=fn.fromString(l);return d&&r.availableImages&&(d.available=r.availableImages.indexOf(l)>-1),d}eachChild(r){r(this.input)}outputDefined(){return!1}}class Bh{constructor(r){this.type=nt,this.input=r}static parse(r,l){if(r.length!==2)return l.error(`Expected 1 argument, but found ${r.length-1} instead.`);const d=l.parse(r[1],1);return d?d.type.kind!=="array"&&d.type.kind!=="string"&&d.type.kind!=="value"?l.error(`Expected argument of type string or array, but found ${Y(d.type)} instead.`):new Bh(d):null}evaluate(r){const l=this.input.evaluate(r);if(typeof l=="string"||Array.isArray(l))return l.length;throw new ei(`Expected value to be of type string or array, but found ${Y(Xn(l))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const xo={"==":S_,"!=":M_,">":E_,"<":T_,">=":C_,"<=":A_,array:Ai,at:zh,boolean:Ai,case:Uh,coalesce:Nn,collator:Cc,format:Nc,image:Oh,in:kh,"index-of":Fc,interpolate:ar,"interpolate-hcl":ar,"interpolate-lab":ar,length:Bh,let:kc,literal:Lr,match:Fh,number:Ai,"number-format":Nh,object:Ai,slice:Uc,step:_o,string:Ai,"to-boolean":di,"to-color":di,"to-number":di,"to-string":di,var:Lc,within:Ca};function dp(a,[r,l,d,g]){r=r.evaluate(a),l=l.evaluate(a),d=d.evaluate(a);const x=g?g.evaluate(a):1,b=go(r,l,d,x);if(b)throw new ei(b);return new Ft(r/255,l/255,d/255,x,!1)}function fp(a,r){return a in r}function Vh(a,r){const l=r[a];return l===void 0?null:l}function Ra(a){return{type:a}}function pp(a){return{result:"success",value:a}}function bo(a){return{result:"error",value:a}}function wo(a){return a["property-type"]==="data-driven"||a["property-type"]==="cross-faded-data-driven"}function mp(a){return!!a.expression&&a.expression.parameters.indexOf("zoom")>-1}function Gh(a){return!!a.expression&&a.expression.interpolated}function On(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}function So(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function P_(a){return a}function gp(a,r){const l=r.type==="color",d=a.stops&&typeof a.stops[0][0]=="object",g=d||!(d||a.property!==void 0),x=a.type||(Gh(r)?"exponential":"interval");if(l||r.type==="padding"){const O=l?Ft.parse:jn.parse;(a=Gt({},a)).stops&&(a.stops=a.stops.map(H=>[H[0],O(H[1])])),a.default=O(a.default?a.default:r.default)}if(a.colorSpace&&(b=a.colorSpace)!=="rgb"&&b!=="hcl"&&b!=="lab")throw new Error(`Unknown color space: "${a.colorSpace}"`);var b;let T,P,D;if(x==="exponential")T=_p;else if(x==="interval")T=bi;else if(x==="categorical"){T=R_,P=Object.create(null);for(const O of a.stops)P[O[0]]=O[1];D=typeof a.stops[0][0]}else{if(x!=="identity")throw new Error(`Unknown function type "${x}"`);T=kn}if(d){const O={},H=[];for(let ie=0;ie<a.stops.length;ie++){const ce=a.stops[ie],me=ce[0].zoom;O[me]===void 0&&(O[me]={zoom:me,type:a.type,property:a.property,default:a.default,stops:[]},H.push(me)),O[me].stops.push([ce[0].value,ce[1]])}const q=[];for(const ie of H)q.push([O[ie].zoom,gp(O[ie],r)]);const Q={name:"linear"};return{kind:"composite",interpolationType:Q,interpolationFactor:ar.interpolationFactor.bind(void 0,Q),zoomStops:q.map(ie=>ie[0]),evaluate:({zoom:ie},ce)=>_p({stops:q,base:a.base},r,ie).evaluate(ie,ce)}}if(g){const O=x==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:O,interpolationFactor:ar.interpolationFactor.bind(void 0,O),zoomStops:a.stops.map(H=>H[0]),evaluate:({zoom:H})=>T(a,r,H,P,D)}}return{kind:"source",evaluate(O,H){const q=H&&H.properties?H.properties[a.property]:void 0;return q===void 0?Dl(a.default,r.default):T(a,r,q,P,D)}}}function Dl(a,r,l){return a!==void 0?a:r!==void 0?r:l!==void 0?l:void 0}function R_(a,r,l,d,g){return Dl(typeof l===g?d[l]:void 0,a.default,r.default)}function bi(a,r,l){if(On(l)!=="number")return Dl(a.default,r.default);const d=a.stops.length;if(d===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[d-1][0])return a.stops[d-1][1];const g=Ll(a.stops.map(x=>x[0]),l);return a.stops[g][1]}function _p(a,r,l){const d=a.base!==void 0?a.base:1;if(On(l)!=="number")return Dl(a.default,r.default);const g=a.stops.length;if(g===1||l<=a.stops[0][0])return a.stops[0][1];if(l>=a.stops[g-1][0])return a.stops[g-1][1];const x=Ll(a.stops.map(O=>O[0]),l),b=function(O,H,q,Q){const ie=Q-q,ce=O-q;return ie===0?0:H===1?ce/ie:(Math.pow(H,ce)-1)/(Math.pow(H,ie)-1)}(l,d,a.stops[x][0],a.stops[x+1][0]),T=a.stops[x][1],P=a.stops[x+1][1],D=Dr[r.type]||P_;return typeof T.evaluate=="function"?{evaluate(...O){const H=T.evaluate.apply(void 0,O),q=P.evaluate.apply(void 0,O);if(H!==void 0&&q!==void 0)return D(H,q,b,a.colorSpace)}}:D(T,P,b,a.colorSpace)}function kn(a,r,l){switch(r.type){case"color":l=Ft.parse(l);break;case"formatted":l=Yn.fromString(l.toString());break;case"resolvedImage":l=fn.fromString(l.toString());break;case"padding":l=jn.parse(l);break;default:On(l)===r.type||r.type==="enum"&&r.values[l]||(l=void 0)}return Dl(l,a.default,r.default)}Zr.register(xo,{error:[{kind:"error"},[Rt],(a,[r])=>{throw new ei(r.evaluate(a))}],typeof:[Rt,[Le],(a,[r])=>Y(Xn(r.evaluate(a)))],"to-rgba":[j(nt,4),[Ot],(a,[r])=>{const[l,d,g,x]=r.evaluate(a).rgb;return[255*l,255*d,255*g,x]}],rgb:[Ot,[nt,nt,nt],dp],rgba:[Ot,[nt,nt,nt,nt],dp],has:{type:Lt,overloads:[[[Rt],(a,[r])=>fp(r.evaluate(a),a.properties())],[[Rt,$],(a,[r,l])=>fp(r.evaluate(a),l.evaluate(a))]]},get:{type:Le,overloads:[[[Rt],(a,[r])=>Vh(r.evaluate(a),a.properties())],[[Rt,$],(a,[r,l])=>Vh(r.evaluate(a),l.evaluate(a))]]},"feature-state":[Le,[Rt],(a,[r])=>Vh(r.evaluate(a),a.featureState||{})],properties:[$,[],a=>a.properties()],"geometry-type":[Rt,[],a=>a.geometryType()],id:[Le,[],a=>a.id()],zoom:[nt,[],a=>a.globals.zoom],"heatmap-density":[nt,[],a=>a.globals.heatmapDensity||0],"line-progress":[nt,[],a=>a.globals.lineProgress||0],accumulated:[Le,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[nt,Ra(nt),(a,r)=>{let l=0;for(const d of r)l+=d.evaluate(a);return l}],"*":[nt,Ra(nt),(a,r)=>{let l=1;for(const d of r)l*=d.evaluate(a);return l}],"-":{type:nt,overloads:[[[nt,nt],(a,[r,l])=>r.evaluate(a)-l.evaluate(a)],[[nt],(a,[r])=>-r.evaluate(a)]]},"/":[nt,[nt,nt],(a,[r,l])=>r.evaluate(a)/l.evaluate(a)],"%":[nt,[nt,nt],(a,[r,l])=>r.evaluate(a)%l.evaluate(a)],ln2:[nt,[],()=>Math.LN2],pi:[nt,[],()=>Math.PI],e:[nt,[],()=>Math.E],"^":[nt,[nt,nt],(a,[r,l])=>Math.pow(r.evaluate(a),l.evaluate(a))],sqrt:[nt,[nt],(a,[r])=>Math.sqrt(r.evaluate(a))],log10:[nt,[nt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN10],ln:[nt,[nt],(a,[r])=>Math.log(r.evaluate(a))],log2:[nt,[nt],(a,[r])=>Math.log(r.evaluate(a))/Math.LN2],sin:[nt,[nt],(a,[r])=>Math.sin(r.evaluate(a))],cos:[nt,[nt],(a,[r])=>Math.cos(r.evaluate(a))],tan:[nt,[nt],(a,[r])=>Math.tan(r.evaluate(a))],asin:[nt,[nt],(a,[r])=>Math.asin(r.evaluate(a))],acos:[nt,[nt],(a,[r])=>Math.acos(r.evaluate(a))],atan:[nt,[nt],(a,[r])=>Math.atan(r.evaluate(a))],min:[nt,Ra(nt),(a,r)=>Math.min(...r.map(l=>l.evaluate(a)))],max:[nt,Ra(nt),(a,r)=>Math.max(...r.map(l=>l.evaluate(a)))],abs:[nt,[nt],(a,[r])=>Math.abs(r.evaluate(a))],round:[nt,[nt],(a,[r])=>{const l=r.evaluate(a);return l<0?-Math.round(-l):Math.round(l)}],floor:[nt,[nt],(a,[r])=>Math.floor(r.evaluate(a))],ceil:[nt,[nt],(a,[r])=>Math.ceil(r.evaluate(a))],"filter-==":[Lt,[Rt,Le],(a,[r,l])=>a.properties()[r.value]===l.value],"filter-id-==":[Lt,[Le],(a,[r])=>a.id()===r.value],"filter-type-==":[Lt,[Rt],(a,[r])=>a.geometryType()===r.value],"filter-<":[Lt,[Rt,Le],(a,[r,l])=>{const d=a.properties()[r.value],g=l.value;return typeof d==typeof g&&d<g}],"filter-id-<":[Lt,[Le],(a,[r])=>{const l=a.id(),d=r.value;return typeof l==typeof d&&l<d}],"filter->":[Lt,[Rt,Le],(a,[r,l])=>{const d=a.properties()[r.value],g=l.value;return typeof d==typeof g&&d>g}],"filter-id->":[Lt,[Le],(a,[r])=>{const l=a.id(),d=r.value;return typeof l==typeof d&&l>d}],"filter-<=":[Lt,[Rt,Le],(a,[r,l])=>{const d=a.properties()[r.value],g=l.value;return typeof d==typeof g&&d<=g}],"filter-id-<=":[Lt,[Le],(a,[r])=>{const l=a.id(),d=r.value;return typeof l==typeof d&&l<=d}],"filter->=":[Lt,[Rt,Le],(a,[r,l])=>{const d=a.properties()[r.value],g=l.value;return typeof d==typeof g&&d>=g}],"filter-id->=":[Lt,[Le],(a,[r])=>{const l=a.id(),d=r.value;return typeof l==typeof d&&l>=d}],"filter-has":[Lt,[Le],(a,[r])=>r.value in a.properties()],"filter-has-id":[Lt,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Lt,[j(Rt)],(a,[r])=>r.value.indexOf(a.geometryType())>=0],"filter-id-in":[Lt,[j(Le)],(a,[r])=>r.value.indexOf(a.id())>=0],"filter-in-small":[Lt,[Rt,j(Le)],(a,[r,l])=>l.value.indexOf(a.properties()[r.value])>=0],"filter-in-large":[Lt,[Rt,j(Le)],(a,[r,l])=>function(d,g,x,b){for(;x<=b;){const T=x+b>>1;if(g[T]===d)return!0;g[T]>d?b=T-1:x=T+1}return!1}(a.properties()[r.value],l.value,0,l.value.length-1)],all:{type:Lt,overloads:[[[Lt,Lt],(a,[r,l])=>r.evaluate(a)&&l.evaluate(a)],[Ra(Lt),(a,r)=>{for(const l of r)if(!l.evaluate(a))return!1;return!0}]]},any:{type:Lt,overloads:[[[Lt,Lt],(a,[r,l])=>r.evaluate(a)||l.evaluate(a)],[Ra(Lt),(a,r)=>{for(const l of r)if(l.evaluate(a))return!0;return!1}]]},"!":[Lt,[Lt],(a,[r])=>!r.evaluate(a)],"is-supported-script":[Lt,[Rt],(a,[r])=>{const l=a.globals&&a.globals.isSupportedScript;return!l||l(r.evaluate(a))}],upcase:[Rt,[Rt],(a,[r])=>r.evaluate(a).toUpperCase()],downcase:[Rt,[Rt],(a,[r])=>r.evaluate(a).toLowerCase()],concat:[Rt,Ra(Le),(a,r)=>r.map(l=>oa(l.evaluate(a))).join("")],"resolved-locale":[Rt,[rt],(a,[r])=>r.evaluate(a).resolvedLocale()]});class zl{constructor(r,l){var d;this.expression=r,this._warningHistory={},this._evaluator=new ca,this._defaultValue=l?(d=l).type==="color"&&So(d.default)?new Ft(0,0,0,0):d.type==="color"?Ft.parse(d.default)||null:d.type==="padding"?jn.parse(d.default)||null:d.type==="variableAnchorOffsetCollection"?An.parse(d.default)||null:d.default===void 0?null:d.default:null,this._enumValues=l&&l.type==="enum"?l.values:null}evaluateWithoutErrorHandling(r,l,d,g,x,b){return this._evaluator.globals=r,this._evaluator.feature=l,this._evaluator.featureState=d,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b,this.expression.evaluate(this._evaluator)}evaluate(r,l,d,g,x,b){this._evaluator.globals=r,this._evaluator.feature=l||null,this._evaluator.featureState=d||null,this._evaluator.canonical=g,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=b||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new ei(`Expected value to be one of ${Object.keys(this._enumValues).map(P=>JSON.stringify(P)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(T.message)),this._defaultValue}}}function Kn(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in xo}function qn(a,r){const l=new Un(xo,Pl,[],r?function(g){const x={color:Ot,string:Rt,number:nt,enum:Rt,boolean:Lt,formatted:wt,padding:se,resolvedImage:k,variableAnchorOffsetCollection:F};return g.type==="array"?j(x[g.value]||Le,g.length):x[g.type]}(r):void 0),d=l.parse(a,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return d?pp(new zl(d,r)):bo(l.errors)}class Mo{constructor(r,l){this.kind=r,this._styleExpression=l,this.isStateDependent=r!=="constant"&&!Il(l.expression)}evaluateWithoutErrorHandling(r,l,d,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,d,g,x,b)}evaluate(r,l,d,g,x,b){return this._styleExpression.evaluate(r,l,d,g,x,b)}}class Oc{constructor(r,l,d,g){this.kind=r,this.zoomStops=d,this._styleExpression=l,this.isStateDependent=r!=="camera"&&!Il(l.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,l,d,g,x,b){return this._styleExpression.evaluateWithoutErrorHandling(r,l,d,g,x,b)}evaluate(r,l,d,g,x,b){return this._styleExpression.evaluate(r,l,d,g,x,b)}interpolationFactor(r,l,d){return this.interpolationType?ar.interpolationFactor(this.interpolationType,r,l,d):0}}function yp(a,r){const l=qn(a,r);if(l.result==="error")return l;const d=l.value.expression,g=Rl(d);if(!g&&!wo(r))return bo([new Nt("","data expressions not supported")]);const x=Dc(d,["zoom"]);if(!x&&!mp(r))return bo([new Nt("","zoom expressions not supported")]);const b=Vc(d);return b||x?b instanceof Nt?bo([b]):b instanceof ar&&!Gh(r)?bo([new Nt("",'"interpolate" expressions cannot be used with this property')]):pp(b?new Oc(g?"camera":"composite",l.value,b.labels,b instanceof ar?b.interpolation:void 0):new Mo(g?"constant":"source",l.value)):bo([new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Bc{constructor(r,l){this._parameters=r,this._specification=l,Gt(this,gp(this._parameters,this._specification))}static deserialize(r){return new Bc(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Vc(a){let r=null;if(a instanceof kc)r=Vc(a.result);else if(a instanceof Nn){for(const l of a.args)if(r=Vc(l),r)break}else(a instanceof _o||a instanceof ar)&&a.input instanceof Zr&&a.input.name==="zoom"&&(r=a);return r instanceof Nt||a.eachChild(l=>{const d=Vc(l);d instanceof Nt?r=d:!r&&d?r=new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&d&&r!==d&&(r=new Nt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Hh(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const r of a.slice(1))if(!Hh(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const vp={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Gc(a){if(a==null)return{filter:()=>!0,needGeometry:!1};Hh(a)||(a=To(a));const r=qn(a,vp);if(r.result==="error")throw new Error(r.value.map(l=>`${l.key}: ${l.message}`).join(", "));return{filter:(l,d,g)=>r.value.evaluate(l,d,{},g),needGeometry:jh(a)}}function xp(a,r){return a<r?-1:a>r?1:0}function jh(a){if(!Array.isArray(a))return!1;if(a[0]==="within")return!0;for(let r=1;r<a.length;r++)if(jh(a[r]))return!0;return!1}function To(a){if(!a)return!0;const r=a[0];return a.length<=1?r!=="any":r==="=="?Wh(a[1],a[2],"=="):r==="!="?Hc(Wh(a[1],a[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Wh(a[1],a[2],r):r==="any"?(l=a.slice(1),["any"].concat(l.map(To))):r==="all"?["all"].concat(a.slice(1).map(To)):r==="none"?["all"].concat(a.slice(1).map(To).map(Hc)):r==="in"?bp(a[1],a.slice(2)):r==="!in"?Hc(bp(a[1],a.slice(2))):r==="has"?wp(a[1]):r==="!has"?Hc(wp(a[1])):r!=="within"||a;var l}function Wh(a,r,l){switch(a){case"$type":return[`filter-type-${l}`,r];case"$id":return[`filter-id-${l}`,r];default:return[`filter-${l}`,a,r]}}function bp(a,r){if(r.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(l=>typeof l!=typeof r[0])?["filter-in-large",a,["literal",r.sort(xp)]]:["filter-in-small",a,["literal",r]]}}function wp(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Hc(a){return["!",a]}function $h(a){const r=typeof a;if(r==="number"||r==="boolean"||r==="string"||a==null)return JSON.stringify(a);if(Array.isArray(a)){let g="[";for(const x of a)g+=`${$h(x)},`;return`${g}]`}const l=Object.keys(a).sort();let d="{";for(let g=0;g<l.length;g++)d+=`${JSON.stringify(l[g])}:${$h(a[l[g]])},`;return`${d}}`}function I_(a){let r="";for(const l of re)r+=`/${$h(a[l])}`;return r}function Sp(a){const r=a.value;return r?[new qe(a.key,r,"constants have been deprecated as of v8")]:[]}function yi(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function ua(a){if(Array.isArray(a))return a.map(ua);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const r={};for(const l in a)r[l]=ua(a[l]);return r}return yi(a)}function zr(a){const r=a.key,l=a.value,d=a.valueSpec||{},g=a.objectElementValidators||{},x=a.style,b=a.styleSpec,T=a.validateSpec;let P=[];const D=On(l);if(D!=="object")return[new qe(r,l,`object expected, ${D} found`)];for(const O in l){const H=O.split(".")[0],q=d[H]||d["*"];let Q;if(g[H])Q=g[H];else if(d[H])Q=T;else if(g["*"])Q=g["*"];else{if(!d["*"]){P.push(new qe(r,l[O],`unknown property "${O}"`));continue}Q=T}P=P.concat(Q({key:(r&&`${r}.`)+O,value:l[O],valueSpec:q,style:x,styleSpec:b,object:l,objectKey:O,validateSpec:T},l))}for(const O in d)g[O]||d[O].required&&d[O].default===void 0&&l[O]===void 0&&P.push(new qe(r,l,`missing required property "${O}"`));return P}function Eo(a){const r=a.value,l=a.valueSpec,d=a.style,g=a.styleSpec,x=a.key,b=a.arrayElementValidator||a.validateSpec;if(On(r)!=="array")return[new qe(x,r,`array expected, ${On(r)} found`)];if(l.length&&r.length!==l.length)return[new qe(x,r,`array length ${l.length} expected, length ${r.length} found`)];if(l["min-length"]&&r.length<l["min-length"])return[new qe(x,r,`array length at least ${l["min-length"]} expected, length ${r.length} found`)];let T={type:l.value,values:l.values};g.$version<7&&(T.function=l.function),On(l.value)==="object"&&(T=l.value);let P=[];for(let D=0;D<r.length;D++)P=P.concat(b({array:r,arrayIndex:D,value:r[D],valueSpec:T,validateSpec:a.validateSpec,style:d,styleSpec:g,key:`${x}[${D}]`}));return P}function Xh(a){const r=a.key,l=a.value,d=a.valueSpec;let g=On(l);return g==="number"&&l!=l&&(g="NaN"),g!=="number"?[new qe(r,l,`number expected, ${g} found`)]:"minimum"in d&&l<d.minimum?[new qe(r,l,`${l} is less than the minimum value ${d.minimum}`)]:"maximum"in d&&l>d.maximum?[new qe(r,l,`${l} is greater than the maximum value ${d.maximum}`)]:[]}function qh(a){const r=a.valueSpec,l=yi(a.value.type);let d,g,x,b={};const T=l!=="categorical"&&a.value.property===void 0,P=!T,D=On(a.value.stops)==="array"&&On(a.value.stops[0])==="array"&&On(a.value.stops[0][0])==="object",O=zr({key:a.key,value:a.value,valueSpec:a.styleSpec.function,validateSpec:a.validateSpec,style:a.style,styleSpec:a.styleSpec,objectElementValidators:{stops:function(Q){if(l==="identity")return[new qe(Q.key,Q.value,'identity function may not have a "stops" property')];let ie=[];const ce=Q.value;return ie=ie.concat(Eo({key:Q.key,value:ce,valueSpec:Q.valueSpec,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,arrayElementValidator:H})),On(ce)==="array"&&ce.length===0&&ie.push(new qe(Q.key,ce,"array must have at least one stop")),ie},default:function(Q){return Q.validateSpec({key:Q.key,value:Q.value,valueSpec:r,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec})}}});return l==="identity"&&T&&O.push(new qe(a.key,a.value,'missing required property "property"')),l==="identity"||a.value.stops||O.push(new qe(a.key,a.value,'missing required property "stops"')),l==="exponential"&&a.valueSpec.expression&&!Gh(a.valueSpec)&&O.push(new qe(a.key,a.value,"exponential functions not supported")),a.styleSpec.$version>=8&&(P&&!wo(a.valueSpec)?O.push(new qe(a.key,a.value,"property functions not supported")):T&&!mp(a.valueSpec)&&O.push(new qe(a.key,a.value,"zoom functions not supported"))),l!=="categorical"&&!D||a.value.property!==void 0||O.push(new qe(a.key,a.value,'"property" property is required')),O;function H(Q){let ie=[];const ce=Q.value,me=Q.key;if(On(ce)!=="array")return[new qe(me,ce,`array expected, ${On(ce)} found`)];if(ce.length!==2)return[new qe(me,ce,`array length 2 expected, length ${ce.length} found`)];if(D){if(On(ce[0])!=="object")return[new qe(me,ce,`object expected, ${On(ce[0])} found`)];if(ce[0].zoom===void 0)return[new qe(me,ce,"object stop key must have zoom")];if(ce[0].value===void 0)return[new qe(me,ce,"object stop key must have value")];if(x&&x>yi(ce[0].zoom))return[new qe(me,ce[0].zoom,"stop zoom values must appear in ascending order")];yi(ce[0].zoom)!==x&&(x=yi(ce[0].zoom),g=void 0,b={}),ie=ie.concat(zr({key:`${me}[0]`,value:ce[0],valueSpec:{zoom:{}},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec,objectElementValidators:{zoom:Xh,value:q}}))}else ie=ie.concat(q({key:`${me}[0]`,value:ce[0],valueSpec:{},validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec},ce));return Kn(ua(ce[1]))?ie.concat([new qe(`${me}[1]`,ce[1],"expressions are not allowed in function stops.")]):ie.concat(Q.validateSpec({key:`${me}[1]`,value:ce[1],valueSpec:r,validateSpec:Q.validateSpec,style:Q.style,styleSpec:Q.styleSpec}))}function q(Q,ie){const ce=On(Q.value),me=yi(Q.value),we=Q.value!==null?Q.value:ie;if(d){if(ce!==d)return[new qe(Q.key,we,`${ce} stop domain type must match previous stop domain type ${d}`)]}else d=ce;if(ce!=="number"&&ce!=="string"&&ce!=="boolean")return[new qe(Q.key,we,"stop domain value must be a number, string, or boolean")];if(ce!=="number"&&l!=="categorical"){let De=`number expected, ${ce} found`;return wo(r)&&l===void 0&&(De+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new qe(Q.key,we,De)]}return l!=="categorical"||ce!=="number"||isFinite(me)&&Math.floor(me)===me?l!=="categorical"&&ce==="number"&&g!==void 0&&me<g?[new qe(Q.key,we,"stop domain values must appear in ascending order")]:(g=me,l==="categorical"&&me in b?[new qe(Q.key,we,"stop domain values must be unique")]:(b[me]=!0,[])):[new qe(Q.key,we,`integer expected, found ${me}`)]}}function Ao(a){const r=(a.expressionContext==="property"?yp:qn)(ua(a.value),a.valueSpec);if(r.result==="error")return r.value.map(d=>new qe(`${a.key}${d.key}`,a.value,d.message));const l=r.value.expression||r.value._styleExpression.expression;if(a.expressionContext==="property"&&a.propertyKey==="text-font"&&!l.outputDefined())return[new qe(a.key,a.value,`Invalid data expression for "${a.propertyKey}". Output values must be contained as literals within the expression.`)];if(a.expressionContext==="property"&&a.propertyType==="layout"&&!Il(l))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with layout properties.')];if(a.expressionContext==="filter"&&!Il(l))return[new qe(a.key,a.value,'"feature-state" data expressions are not supported with filters.')];if(a.expressionContext&&a.expressionContext.indexOf("cluster")===0){if(!Dc(l,["zoom","feature-state"]))return[new qe(a.key,a.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(a.expressionContext==="cluster-initial"&&!Rl(l))return[new qe(a.key,a.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ia(a){const r=a.key,l=a.value,d=a.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(yi(l))===-1&&g.push(new qe(r,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(yi(l))===-1&&g.push(new qe(r,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Co(a){return Hh(ua(a.value))?Ao(Gt({},a,{expressionContext:"filter",valueSpec:{value:"boolean"}})):kl(a)}function kl(a){const r=a.value,l=a.key;if(On(r)!=="array")return[new qe(l,r,`array expected, ${On(r)} found`)];const d=a.styleSpec;let g,x=[];if(r.length<1)return[new qe(l,r,"filter array must have at least 1 element")];switch(x=x.concat(Ia({key:`${l}[0]`,value:r[0],valueSpec:d.filter_operator,style:a.style,styleSpec:a.styleSpec})),yi(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&yi(r[1])==="$type"&&x.push(new qe(l,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&x.push(new qe(l,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=On(r[1]),g!=="string"&&x.push(new qe(`${l}[1]`,r[1],`string expected, ${g} found`)));for(let b=2;b<r.length;b++)g=On(r[b]),yi(r[1])==="$type"?x=x.concat(Ia({key:`${l}[${b}]`,value:r[b],valueSpec:d.geometry_type,style:a.style,styleSpec:a.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&x.push(new qe(`${l}[${b}]`,r[b],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let b=1;b<r.length;b++)x=x.concat(kl({key:`${l}[${b}]`,value:r[b],style:a.style,styleSpec:a.styleSpec}));break;case"has":case"!has":g=On(r[1]),r.length!==2?x.push(new qe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&x.push(new qe(`${l}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=On(r[1]),r.length!==2?x.push(new qe(l,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&x.push(new qe(`${l}[1]`,r[1],`object expected, ${g} found`))}return x}function Zh(a,r){const l=a.key,d=a.validateSpec,g=a.style,x=a.styleSpec,b=a.value,T=a.objectKey,P=x[`${r}_${a.layerType}`];if(!P)return[];const D=T.match(/^(.*)-transition$/);if(r==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return d({key:l,value:b,valueSpec:x.transition,style:g,styleSpec:x});const O=a.valueSpec||P[T];if(!O)return[new qe(l,b,`unknown property "${T}"`)];let H;if(On(b)==="string"&&wo(O)&&!O.tokens&&(H=/^{([^}]+)}$/.exec(b)))return[new qe(l,b,`"${T}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(H[1])} }\`.`)];const q=[];return a.layerType==="symbol"&&(T==="text-field"&&g&&!g.glyphs&&q.push(new qe(l,b,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&So(ua(b))&&yi(b.type)==="identity"&&q.push(new qe(l,b,'"text-font" does not support identity functions'))),q.concat(d({key:a.key,value:b,valueSpec:O,style:g,styleSpec:x,expressionContext:"property",propertyType:r,propertyKey:T}))}function jc(a){return Zh(a,"paint")}function Yh(a){return Zh(a,"layout")}function Kh(a){let r=[];const l=a.value,d=a.key,g=a.style,x=a.styleSpec;l.type||l.ref||r.push(new qe(d,l,'either "type" or "ref" is required'));let b=yi(l.type);const T=yi(l.ref);if(l.id){const P=yi(l.id);for(let D=0;D<a.arrayIndex;D++){const O=g.layers[D];yi(O.id)===P&&r.push(new qe(d,l.id,`duplicate layer id "${l.id}", previously used at line ${O.id.__line__}`))}}if("ref"in l){let P;["type","source","source-layer","filter","layout"].forEach(D=>{D in l&&r.push(new qe(d,l[D],`"${D}" is prohibited for ref layers`))}),g.layers.forEach(D=>{yi(D.id)===T&&(P=D)}),P?P.ref?r.push(new qe(d,l.ref,"ref cannot reference another ref layer")):b=yi(P.type):r.push(new qe(d,l.ref,`ref layer "${T}" not found`))}else if(b!=="background")if(l.source){const P=g.sources&&g.sources[l.source],D=P&&yi(P.type);P?D==="vector"&&b==="raster"?r.push(new qe(d,l.source,`layer "${l.id}" requires a raster source`)):D!=="raster-dem"&&b==="hillshade"?r.push(new qe(d,l.source,`layer "${l.id}" requires a raster-dem source`)):D==="raster"&&b!=="raster"?r.push(new qe(d,l.source,`layer "${l.id}" requires a vector source`)):D!=="vector"||l["source-layer"]?D==="raster-dem"&&b!=="hillshade"?r.push(new qe(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):b!=="line"||!l.paint||!l.paint["line-gradient"]||D==="geojson"&&P.lineMetrics||r.push(new qe(d,l,`layer "${l.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new qe(d,l,`layer "${l.id}" must specify a "source-layer"`)):r.push(new qe(d,l.source,`source "${l.source}" not found`))}else r.push(new qe(d,l,'missing required property "source"'));return r=r.concat(zr({key:d,value:l,valueSpec:x.layer,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,objectElementValidators:{"*":()=>[],type:()=>a.validateSpec({key:`${d}.type`,value:l.type,valueSpec:x.layer.type,style:a.style,styleSpec:a.styleSpec,validateSpec:a.validateSpec,object:l,objectKey:"type"}),filter:Co,layout:P=>zr({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>Yh(Gt({layerType:b},D))}}),paint:P=>zr({layer:l,key:P.key,value:P.value,style:P.style,styleSpec:P.styleSpec,validateSpec:P.validateSpec,objectElementValidators:{"*":D=>jc(Gt({layerType:b},D))}})}})),r}function Ss(a){const r=a.value,l=a.key,d=On(r);return d!=="string"?[new qe(l,r,`string expected, ${d} found`)]:[]}const Mp={promoteId:function({key:a,value:r}){if(On(r)==="string")return Ss({key:a,value:r});{const l=[];for(const d in r)l.push(...Ss({key:`${a}.${d}`,value:r[d]}));return l}}};function Tp(a){const r=a.value,l=a.key,d=a.styleSpec,g=a.style,x=a.validateSpec;if(!r.type)return[new qe(l,r,'"type" is required')];const b=yi(r.type);let T;switch(b){case"vector":case"raster":return T=zr({key:l,value:r,valueSpec:d[`source_${b.replace("-","_")}`],style:a.style,styleSpec:d,objectElementValidators:Mp,validateSpec:x}),T;case"raster-dem":return T=function(P){var D;const O=(D=P.sourceName)!==null&&D!==void 0?D:"",H=P.value,q=P.styleSpec,Q=q.source_raster_dem,ie=P.style;let ce=[];const me=On(H);if(H===void 0)return ce;if(me!=="object")return ce.push(new qe("source_raster_dem",H,`object expected, ${me} found`)),ce;const we=yi(H.encoding)==="custom",De=["redFactor","greenFactor","blueFactor","baseShift"],Me=P.value.encoding?`"${P.value.encoding}"`:"Default";for(const Re in H)!we&&De.includes(Re)?ce.push(new qe(Re,H[Re],`In "${O}": "${Re}" is only valid when "encoding" is set to "custom". ${Me} encoding found`)):Q[Re]?ce=ce.concat(P.validateSpec({key:Re,value:H[Re],valueSpec:Q[Re],validateSpec:P.validateSpec,style:ie,styleSpec:q})):ce.push(new qe(Re,H[Re],`unknown property "${Re}"`));return ce}({sourceName:l,value:r,style:a.style,styleSpec:d,validateSpec:x}),T;case"geojson":if(T=zr({key:l,value:r,valueSpec:d.source_geojson,style:g,styleSpec:d,validateSpec:x,objectElementValidators:Mp}),r.cluster)for(const P in r.clusterProperties){const[D,O]=r.clusterProperties[P],H=typeof D=="string"?[D,["accumulated"],["get",P]]:D;T.push(...Ao({key:`${l}.${P}.map`,value:O,validateSpec:x,expressionContext:"cluster-map"})),T.push(...Ao({key:`${l}.${P}.reduce`,value:H,validateSpec:x,expressionContext:"cluster-reduce"}))}return T;case"video":return zr({key:l,value:r,valueSpec:d.source_video,style:g,validateSpec:x,styleSpec:d});case"image":return zr({key:l,value:r,valueSpec:d.source_image,style:g,validateSpec:x,styleSpec:d});case"canvas":return[new qe(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ia({key:`${l}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:x,styleSpec:d})}}function Ep(a){const r=a.value,l=a.styleSpec,d=l.light,g=a.style;let x=[];const b=On(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new qe("light",r,`object expected, ${b} found`)]),x;for(const T in r){const P=T.match(/^(.*)-transition$/);x=x.concat(P&&d[P[1]]&&d[P[1]].transition?a.validateSpec({key:T,value:r[T],valueSpec:l.transition,validateSpec:a.validateSpec,style:g,styleSpec:l}):d[T]?a.validateSpec({key:T,value:r[T],valueSpec:d[T],validateSpec:a.validateSpec,style:g,styleSpec:l}):[new qe(T,r[T],`unknown property "${T}"`)])}return x}function Ap(a){const r=a.value,l=a.styleSpec,d=l.sky,g=a.style,x=On(r);if(r===void 0)return[];if(x!=="object")return[new qe("sky",r,`object expected, ${x} found`)];let b=[];for(const T in r)b=b.concat(d[T]?Gi({key:T,value:r[T],valueSpec:d[T],style:g,styleSpec:l}):[new qe(T,r[T],`unknown property "${T}"`)]);return b}function Cp(a){const r=a.value,l=a.styleSpec,d=l.terrain,g=a.style;let x=[];const b=On(r);if(r===void 0)return x;if(b!=="object")return x=x.concat([new qe("terrain",r,`object expected, ${b} found`)]),x;for(const T in r)x=x.concat(d[T]?a.validateSpec({key:T,value:r[T],valueSpec:d[T],validateSpec:a.validateSpec,style:g,styleSpec:l}):[new qe(T,r[T],`unknown property "${T}"`)]);return x}function Fl(a){let r=[];const l=a.value,d=a.key;if(Array.isArray(l)){const g=[],x=[];for(const b in l)l[b].id&&g.includes(l[b].id)&&r.push(new qe(d,l,`all the sprites' ids must be unique, but ${l[b].id} is duplicated`)),g.push(l[b].id),l[b].url&&x.includes(l[b].url)&&r.push(new qe(d,l,`all the sprites' URLs must be unique, but ${l[b].url} is duplicated`)),x.push(l[b].url),r=r.concat(zr({key:`${d}[${b}]`,value:l[b],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:a.validateSpec}));return r}return Ss({key:d,value:l})}const Ul={"*":()=>[],array:Eo,boolean:function(a){const r=a.value,l=a.key,d=On(r);return d!=="boolean"?[new qe(l,r,`boolean expected, ${d} found`)]:[]},number:Xh,color:function(a){const r=a.key,l=a.value,d=On(l);return d!=="string"?[new qe(r,l,`color expected, ${d} found`)]:Ft.parse(String(l))?[]:[new qe(r,l,`color expected, "${l}" found`)]},constants:Sp,enum:Ia,filter:Co,function:qh,layer:Kh,object:zr,source:Tp,light:Ep,sky:Ap,terrain:Cp,string:Ss,formatted:function(a){return Ss(a).length===0?[]:Ao(a)},resolvedImage:function(a){return Ss(a).length===0?[]:Ao(a)},padding:function(a){const r=a.key,l=a.value;if(On(l)==="array"){if(l.length<1||l.length>4)return[new qe(r,l,`padding requires 1 to 4 values; ${l.length} values found`)];const d={type:"number"};let g=[];for(let x=0;x<l.length;x++)g=g.concat(a.validateSpec({key:`${r}[${x}]`,value:l[x],validateSpec:a.validateSpec,valueSpec:d}));return g}return Xh({key:r,value:l,valueSpec:{}})},variableAnchorOffsetCollection:function(a){const r=a.key,l=a.value,d=On(l),g=a.styleSpec;if(d!=="array"||l.length<1||l.length%2!=0)return[new qe(r,l,"variableAnchorOffsetCollection requires a non-empty array of even length")];let x=[];for(let b=0;b<l.length;b+=2)x=x.concat(Ia({key:`${r}[${b}]`,value:l[b],valueSpec:g.layout_symbol["text-anchor"]})),x=x.concat(Eo({key:`${r}[${b+1}]`,value:l[b+1],valueSpec:{length:2,value:"number"},validateSpec:a.validateSpec,style:a.style,styleSpec:g}));return x},sprite:Fl};function Gi(a){const r=a.value,l=a.valueSpec,d=a.styleSpec;return a.validateSpec=Gi,l.expression&&So(yi(r))?qh(a):l.expression&&Kn(ua(r))?Ao(a):l.type&&Ul[l.type]?Ul[l.type](a):zr(Gt({},a,{valueSpec:l.type?d[l.type]:l}))}function Po(a){const r=a.value,l=a.key,d=Ss(a);return d.length||(r.indexOf("{fontstack}")===-1&&d.push(new qe(l,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&d.push(new qe(l,r,'"glyphs" url must include a "{range}" token'))),d}function Yr(a,r=J){let l=[];return l=l.concat(Gi({key:"",value:a,valueSpec:r.$root,styleSpec:r,style:a,validateSpec:Gi,objectElementValidators:{glyphs:Po,"*":()=>[]}})),a.constants&&(l=l.concat(Sp({key:"constants",value:a.constants,style:a,styleSpec:r,validateSpec:Gi}))),Pp(l)}function Ms(a){return function(r){return a({...r,validateSpec:Gi})}}function Pp(a){return[].concat(a).sort((r,l)=>r.line-l.line)}function gr(a){return function(...r){return Pp(a.apply(this,r))}}Yr.source=gr(Ms(Tp)),Yr.sprite=gr(Ms(Fl)),Yr.glyphs=gr(Ms(Po)),Yr.light=gr(Ms(Ep)),Yr.sky=gr(Ms(Ap)),Yr.terrain=gr(Ms(Cp)),Yr.layer=gr(Ms(Kh)),Yr.filter=gr(Ms(Co)),Yr.paintProperty=gr(Ms(jc)),Yr.layoutProperty=gr(Ms(Yh));const Ro=Yr,Jh=Ro.light,L_=Ro.paintProperty,Qh=Ro.layoutProperty;function Rp(a,r){let l=!1;if(r&&r.length)for(const d of r)a.fire(new Wt(new Error(d.message))),l=!0;return l}class Gs{constructor(r,l,d){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const b=new Int32Array(this.arrayBuffer);r=b[0],this.d=(l=b[1])+2*(d=b[2]);for(let P=0;P<this.d*this.d;P++){const D=b[3+P],O=b[3+P+1];g.push(D===O?null:b.subarray(D,O))}const T=b[3+g.length+1];this.keys=b.subarray(b[3+g.length],T),this.bboxes=b.subarray(T),this.insert=this._insertReadonly}else{this.d=l+2*d;for(let b=0;b<this.d*this.d;b++)g.push([]);this.keys=[],this.bboxes=[]}this.n=l,this.extent=r,this.padding=d,this.scale=l/r,this.uid=0;const x=d/l*r;this.min=-x,this.max=r+x}insert(r,l,d,g,x){this._forEachCell(l,d,g,x,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(x)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,l,d,g,x,b){this.cells[x].push(b)}query(r,l,d,g,x){const b=this.min,T=this.max;if(r<=b&&l<=b&&T<=d&&T<=g&&!x)return Array.prototype.slice.call(this.keys);{const P=[];return this._forEachCell(r,l,d,g,this._queryCell,P,{},x),P}}_queryCell(r,l,d,g,x,b,T,P){const D=this.cells[x];if(D!==null){const O=this.keys,H=this.bboxes;for(let q=0;q<D.length;q++){const Q=D[q];if(T[Q]===void 0){const ie=4*Q;(P?P(H[ie+0],H[ie+1],H[ie+2],H[ie+3]):r<=H[ie+2]&&l<=H[ie+3]&&d>=H[ie+0]&&g>=H[ie+1])?(T[Q]=!0,b.push(O[Q])):T[Q]=!1}}}}_forEachCell(r,l,d,g,x,b,T,P){const D=this._convertToCellCoord(r),O=this._convertToCellCoord(l),H=this._convertToCellCoord(d),q=this._convertToCellCoord(g);for(let Q=D;Q<=H;Q++)for(let ie=O;ie<=q;ie++){const ce=this.d*ie+Q;if((!P||P(this._convertFromCellCoord(Q),this._convertFromCellCoord(ie),this._convertFromCellCoord(Q+1),this._convertFromCellCoord(ie+1)))&&x.call(this,r,l,d,g,ce,b,T,P))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,l=3+this.cells.length+1+1;let d=0;for(let b=0;b<this.cells.length;b++)d+=this.cells[b].length;const g=new Int32Array(l+d+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let x=l;for(let b=0;b<r.length;b++){const T=r[b];g[3+b]=x,g.set(T,x),x+=T.length}return g[3+r.length]=x,g.set(this.keys,x),x+=this.keys.length,g[3+r.length+1]=x,g.set(this.bboxes,x),x+=this.bboxes.length,g.buffer}static serialize(r,l){const d=r.toArrayBuffer();return l&&l.push(d),{buffer:d}}static deserialize(r){return new Gs(r.buffer)}}const ha={};function Vt(a,r,l={}){if(ha[a])throw new Error(`${a} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:a,writeable:!1}),ha[a]={klass:r,omit:l.omit||[],shallow:l.shallow||[]}}Vt("Object",Object),Vt("TransferableGridIndex",Gs),Vt("Color",Ft),Vt("Error",Error),Vt("AJAXError",un),Vt("ResolvedImage",fn),Vt("StylePropertyFunction",Bc),Vt("StyleExpression",zl,{omit:["_evaluator"]}),Vt("ZoomDependentExpression",Oc),Vt("ZoomConstantExpression",Mo),Vt("CompoundExpression",Zr,{omit:["_evaluate"]});for(const a in xo)xo[a]._classRegistryKey||Vt(`Expression_${a}`,xo[a]);function ed(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function La(a,r){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error)return a;if(ed(a)||Ce(a))return r&&r.push(a),a;if(ArrayBuffer.isView(a)){const l=a;return r&&r.push(l.buffer),l}if(a instanceof ImageData)return r&&r.push(a.data.buffer),a;if(Array.isArray(a)){const l=[];for(const d of a)l.push(La(d,r));return l}if(typeof a=="object"){const l=a.constructor,d=l._classRegistryKey;if(!d)throw new Error(`can't serialize object of unregistered class ${l.name}`);if(!ha[d])throw new Error(`${d} is not registered.`);const g=l.serialize?l.serialize(a,r):{};if(l.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const x in a){if(!a.hasOwnProperty(x)||ha[d].omit.indexOf(x)>=0)continue;const b=a[x];g[x]=ha[d].shallow.indexOf(x)>=0?b:La(b,r)}a instanceof Error&&(g.message=a.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return d!=="Object"&&(g.$name=d),g}throw new Error("can't serialize object of type "+typeof a)}function Io(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||a instanceof Blob||a instanceof Error||ed(a)||Ce(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Io);if(typeof a=="object"){const r=a.$name||"Object";if(!ha[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:l}=ha[r];if(!l)throw new Error(`can't deserialize unregistered class ${r}`);if(l.deserialize)return l.deserialize(a);const d=Object.create(l.prototype);for(const g of Object.keys(a)){if(g==="$name")continue;const x=a[g];d[g]=ha[r].shallow.indexOf(g)>=0?x:Io(x)}return d}throw new Error("can't deserialize object of type "+typeof a)}class td{constructor(){this.first=!0}update(r,l){const d=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=d,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=d,!0):(this.lastFloorZoom>d?(this.lastIntegerZoom=d+1,this.lastIntegerZoomTime=l):this.lastFloorZoom<d&&(this.lastIntegerZoom=d,this.lastIntegerZoomTime=l),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=d,!0))}}const zt={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519};function Nl(a){for(const r of a)if($c(r.charCodeAt(0)))return!0;return!1}function Wc(a){for(const r of a)if(!Ip(r.charCodeAt(0)))return!1;return!0}function Ip(a){return!(zt.Arabic(a)||zt["Arabic Supplement"](a)||zt["Arabic Extended-A"](a)||zt["Arabic Presentation Forms-A"](a)||zt["Arabic Presentation Forms-B"](a))}function $c(a){return!(a!==746&&a!==747&&(a<4352||!(zt["Bopomofo Extended"](a)||zt.Bopomofo(a)||zt["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||zt["CJK Compatibility Ideographs"](a)||zt["CJK Compatibility"](a)||zt["CJK Radicals Supplement"](a)||zt["CJK Strokes"](a)||!(!zt["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||zt["CJK Unified Ideographs Extension A"](a)||zt["CJK Unified Ideographs"](a)||zt["Enclosed CJK Letters and Months"](a)||zt["Hangul Compatibility Jamo"](a)||zt["Hangul Jamo Extended-A"](a)||zt["Hangul Jamo Extended-B"](a)||zt["Hangul Jamo"](a)||zt["Hangul Syllables"](a)||zt.Hiragana(a)||zt["Ideographic Description Characters"](a)||zt.Kanbun(a)||zt["Kangxi Radicals"](a)||zt["Katakana Phonetic Extensions"](a)||zt.Katakana(a)&&a!==12540||!(!zt["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!zt["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||zt["Unified Canadian Aboriginal Syllabics"](a)||zt["Unified Canadian Aboriginal Syllabics Extended"](a)||zt["Vertical Forms"](a)||zt["Yijing Hexagram Symbols"](a)||zt["Yi Syllables"](a)||zt["Yi Radicals"](a))))}function nd(a){return!($c(a)||function(r){return!!(zt["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||zt["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||zt["Letterlike Symbols"](r)||zt["Number Forms"](r)||zt["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||zt["Control Pictures"](r)&&r!==9251||zt["Optical Character Recognition"](r)||zt["Enclosed Alphanumerics"](r)||zt["Geometric Shapes"](r)||zt["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||zt["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||zt["CJK Symbols and Punctuation"](r)||zt.Katakana(r)||zt["Private Use Area"](r)||zt["CJK Compatibility Forms"](r)||zt["Small Form Variants"](r)||zt["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(a))}function id(a){return a>=1424&&a<=2303||zt["Arabic Presentation Forms-A"](a)||zt["Arabic Presentation Forms-B"](a)}function rd(a,r){return!(!r&&id(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||zt.Khmer(a))}function Lp(a){for(const r of a)if(id(r.charCodeAt(0)))return!0;return!1}const Da=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(a){this.pluginStatus=a.pluginStatus,this.pluginURL=a.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(a){this.applyArabicShaping=a.applyArabicShaping,this.processBidirectionalText=a.processBidirectionalText,this.processStyledBidirectionalText=a.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ti{constructor(r,l){this.zoom=r,l?(this.now=l.now,this.fadeDuration=l.fadeDuration,this.zoomHistory=l.zoomHistory,this.transition=l.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new td,this.transition={})}isSupportedScript(r){return function(l,d){for(const g of l)if(!rd(g.charCodeAt(0),d))return!1;return!0}(r,Da.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,l=r-Math.floor(r),d=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:l+(1-l)*d}:{fromScale:.5,toScale:1,t:1-(1-d)*l}}}class Xc{constructor(r,l){this.property=r,this.value=l,this.expression=function(d,g){if(So(d))return new Bc(d,g);if(Kn(d)){const x=yp(d,g);if(x.result==="error")throw new Error(x.value.map(b=>`${b.key}: ${b.message}`).join(", "));return x.value}{let x=d;return g.type==="color"&&typeof d=="string"?x=Ft.parse(d):g.type!=="padding"||typeof d!="number"&&!Array.isArray(d)?g.type==="variableAnchorOffsetCollection"&&Array.isArray(d)&&(x=An.parse(d)):x=jn.parse(d),{kind:"constant",evaluate:()=>x}}}(l===void 0?r.specification.default:l,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,l,d){return this.property.possiblyEvaluate(this,r,l,d)}}class qc{constructor(r){this.property=r,this.value=new Xc(r,void 0)}transitioned(r,l){return new ad(this.property,this.value,l,te({},r.transition,this.transition),r.now)}untransitioned(){return new ad(this.property,this.value,null,{},0)}}class sd{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Pe(this._values[r].value.value)}setValue(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new qc(this._values[r].property)),this._values[r].value=new Xc(this._values[r].property,l===null?void 0:Pe(l))}getTransition(r){return Pe(this._values[r].transition)}setTransition(r,l){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new qc(this._values[r].property)),this._values[r].transition=Pe(l)||void 0}serialize(){const r={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(r[l]=d);const g=this.getTransition(l);g!==void 0&&(r[`${l}-transition`]=g)}return r}transitioned(r,l){const d=new Dp(this._properties);for(const g of Object.keys(this._values))d._values[g]=this._values[g].transitioned(r,l._values[g]);return d}untransitioned(){const r=new Dp(this._properties);for(const l of Object.keys(this._values))r._values[l]=this._values[l].untransitioned();return r}}class ad{constructor(r,l,d,g,x){this.property=r,this.value=l,this.begin=x+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=d)}possiblyEvaluate(r,l,d){const g=r.now||0,x=this.value.possiblyEvaluate(r,l,d),b=this.prior;if(b){if(g>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(g<this.begin)return b.possiblyEvaluate(r,l,d);{const T=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(b.possiblyEvaluate(r,l,d),x,function(P){if(P<=0)return 0;if(P>=1)return 1;const D=P*P,O=D*P;return 4*(P<.5?O:3*(P-D)+O-.75)}(T))}}return x}}class Dp{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,l,d){const g=new Ol(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(r,l,d);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class D_{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}hasValue(r){return this._values[r].value!==void 0}getValue(r){return Pe(this._values[r].value)}setValue(r,l){this._values[r]=new Xc(this._values[r].property,l===null?void 0:Pe(l))}serialize(){const r={};for(const l of Object.keys(this._values)){const d=this.getValue(l);d!==void 0&&(r[l]=d)}return r}possiblyEvaluate(r,l,d){const g=new Ol(this._properties);for(const x of Object.keys(this._values))g._values[x]=this._values[x].possiblyEvaluate(r,l,d);return g}}class is{constructor(r,l,d){this.property=r,this.value=l,this.parameters=d}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,l,d,g){return this.property.evaluate(this.value,this.parameters,r,l,d,g)}}class Ol{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Qt{constructor(r){this.specification=r}possiblyEvaluate(r,l){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(l)}interpolate(r,l,d){const g=Dr[this.specification.type];return g?g(r,l,d):r}}class cn{constructor(r,l){this.specification=r,this.overrides=l}possiblyEvaluate(r,l,d,g){return new is(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(l,null,{},d,g)}:r.expression,l)}interpolate(r,l,d){if(r.value.kind!=="constant"||l.value.kind!=="constant")return r;if(r.value.value===void 0||l.value.value===void 0)return new is(this,{kind:"constant",value:void 0},r.parameters);const g=Dr[this.specification.type];if(g){const x=g(r.value.value,l.value.value,d);return new is(this,{kind:"constant",value:x},r.parameters)}return r}evaluate(r,l,d,g,x,b){return r.kind==="constant"?r.value:r.evaluate(l,d,g,x,b)}}class za extends cn{possiblyEvaluate(r,l,d,g){if(r.value===void 0)return new is(this,{kind:"constant",value:void 0},l);if(r.expression.kind==="constant"){const x=r.expression.evaluate(l,null,{},d,g),b=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,T=this._calculate(b,b,b,l);return new is(this,{kind:"constant",value:T},l)}if(r.expression.kind==="camera"){const x=this._calculate(r.expression.evaluate({zoom:l.zoom-1}),r.expression.evaluate({zoom:l.zoom}),r.expression.evaluate({zoom:l.zoom+1}),l);return new is(this,{kind:"constant",value:x},l)}return new is(this,r.expression,l)}evaluate(r,l,d,g,x,b){if(r.kind==="source"){const T=r.evaluate(l,d,g,x,b);return this._calculate(T,T,T,l)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(l.zoom)-1},d,g),r.evaluate({zoom:Math.floor(l.zoom)},d,g),r.evaluate({zoom:Math.floor(l.zoom)+1},d,g),l):r.value}_calculate(r,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:d,to:l}}interpolate(r){return r}}class od{constructor(r){this.specification=r}possiblyEvaluate(r,l,d,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const x=r.expression.evaluate(l,null,{},d,g);return this._calculate(x,x,x,l)}return this._calculate(r.expression.evaluate(new ti(Math.floor(l.zoom-1),l)),r.expression.evaluate(new ti(Math.floor(l.zoom),l)),r.expression.evaluate(new ti(Math.floor(l.zoom+1),l)),l)}}_calculate(r,l,d,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:l}:{from:d,to:l}}interpolate(r){return r}}class Bl{constructor(r){this.specification=r}possiblyEvaluate(r,l,d,g){return!!r.expression.evaluate(l,null,{},d,g)}interpolate(){return!1}}class _r{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const l in r){const d=r[l];d.specification.overridable&&this.overridableProperties.push(l);const g=this.defaultPropertyValues[l]=new Xc(d,void 0),x=this.defaultTransitionablePropertyValues[l]=new qc(d);this.defaultTransitioningPropertyValues[l]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=g.possiblyEvaluate({})}}}Vt("DataDrivenProperty",cn),Vt("DataConstantProperty",Qt),Vt("CrossFadedDataDrivenProperty",za),Vt("CrossFadedProperty",od),Vt("ColorRampProperty",Bl);const zp="-transition";class rs extends En{constructor(r,l){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),l.layout&&(this._unevaluatedLayout=new D_(l.layout)),l.paint)){this._transitionablePaint=new sd(l.paint);for(const d in r.paint)this.setPaintProperty(d,r.paint[d],{validate:!1});for(const d in r.layout)this.setLayoutProperty(d,r.layout[d],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ol(l.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,l,d={}){l!=null&&this._validate(Qh,`layers.${this.id}.layout.${r}`,r,l,d)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,l):this.visibility=l)}getPaintProperty(r){return r.endsWith(zp)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,l,d={}){if(l!=null&&this._validate(L_,`layers.${this.id}.paint.${r}`,r,l,d))return!1;if(r.endsWith(zp))return this._transitionablePaint.setTransition(r.slice(0,-11),l||void 0),!1;{const g=this._transitionablePaint._values[r],x=g.property.specification["property-type"]==="cross-faded-data-driven",b=g.value.isDataDriven(),T=g.value;this._transitionablePaint.setValue(r,l),this._handleSpecialPaintPropertyUpdate(r);const P=this._transitionablePaint._values[r].value;return P.isDataDriven()||b||x||this._handleOverridablePaintPropertyUpdate(r,T,P)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,l,d){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,l){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,l)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,l)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),K(r,(l,d)=>!(l===void 0||d==="layout"&&!Object.keys(l).length||d==="paint"&&!Object.keys(l).length))}_validate(r,l,d,g,x={}){return(!x||x.validate!==!1)&&Rp(this,r.call(Ro,{key:l,layerType:this.type,objectKey:d,value:g,styleSpec:J,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const l=this.paint.get(r);if(l instanceof is&&wo(l.property.specification)&&(l.value.kind==="source"||l.value.kind==="composite")&&l.value.isStateDependent)return!0}return!1}}const kp={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Lo{constructor(r,l){this._structArray=r,this._pos1=l*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,l){return r._trim(),l&&(r.isTransferred=!0,l.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const l=Object.create(this.prototype);return l.arrayBuffer=r.arrayBuffer,l.length=r.length,l.capacity=r.arrayBuffer.byteLength/l.bytesPerElement,l._refreshViews(),l}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const l=this.uint8;this._refreshViews(),l&&this.uint8.set(l)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function wi(a,r=1){let l=0,d=0;return{members:a.map(g=>{const x=kp[g.type].BYTES_PER_ELEMENT,b=l=Fp(l,Math.max(r,x)),T=g.components||1;return d=Math.max(d,x),l+=x*T,{name:g.name,type:g.type,components:T,offset:b}}),size:Fp(l,Math.max(d,r)),alignment:r}}function Fp(a,r){return Math.ceil(a/r)*r}class Vl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const g=2*r;return this.int16[g+0]=l,this.int16[g+1]=d,r}}Vl.prototype.bytesPerElement=4,Vt("StructArrayLayout2i4",Vl);class Zc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,d)}emplace(r,l,d,g){const x=3*r;return this.int16[x+0]=l,this.int16[x+1]=d,this.int16[x+2]=g,r}}Zc.prototype.bytesPerElement=6,Vt("StructArrayLayout3i6",Zc);class da extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,d,g)}emplace(r,l,d,g,x){const b=4*r;return this.int16[b+0]=l,this.int16[b+1]=d,this.int16[b+2]=g,this.int16[b+3]=x,r}}da.prototype.bytesPerElement=8,Vt("StructArrayLayout4i8",da);class ld extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,d,g,x,b)}emplace(r,l,d,g,x,b,T){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=x,this.int16[P+4]=b,this.int16[P+5]=T,r}}ld.prototype.bytesPerElement=12,Vt("StructArrayLayout2i4i12",ld);class cd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,d,g,x,b)}emplace(r,l,d,g,x,b,T){const P=4*r,D=8*r;return this.int16[P+0]=l,this.int16[P+1]=d,this.uint8[D+4]=g,this.uint8[D+5]=x,this.uint8[D+6]=b,this.uint8[D+7]=T,r}}cd.prototype.bytesPerElement=8,Vt("StructArrayLayout2i4ub8",cd);class Gl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const g=2*r;return this.float32[g+0]=l,this.float32[g+1]=d,r}}Gl.prototype.bytesPerElement=8,Vt("StructArrayLayout2f8",Gl);class ud extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b,T,P,D,O){const H=this.length;return this.resize(H+1),this.emplace(H,r,l,d,g,x,b,T,P,D,O)}emplace(r,l,d,g,x,b,T,P,D,O,H){const q=10*r;return this.uint16[q+0]=l,this.uint16[q+1]=d,this.uint16[q+2]=g,this.uint16[q+3]=x,this.uint16[q+4]=b,this.uint16[q+5]=T,this.uint16[q+6]=P,this.uint16[q+7]=D,this.uint16[q+8]=O,this.uint16[q+9]=H,r}}ud.prototype.bytesPerElement=20,Vt("StructArrayLayout10ui20",ud);class Yc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b,T,P,D,O,H,q){const Q=this.length;return this.resize(Q+1),this.emplace(Q,r,l,d,g,x,b,T,P,D,O,H,q)}emplace(r,l,d,g,x,b,T,P,D,O,H,q,Q){const ie=12*r;return this.int16[ie+0]=l,this.int16[ie+1]=d,this.int16[ie+2]=g,this.int16[ie+3]=x,this.uint16[ie+4]=b,this.uint16[ie+5]=T,this.uint16[ie+6]=P,this.uint16[ie+7]=D,this.int16[ie+8]=O,this.int16[ie+9]=H,this.int16[ie+10]=q,this.int16[ie+11]=Q,r}}Yc.prototype.bytesPerElement=24,Vt("StructArrayLayout4i4ui4i24",Yc);class hd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,d)}emplace(r,l,d,g){const x=3*r;return this.float32[x+0]=l,this.float32[x+1]=d,this.float32[x+2]=g,r}}hd.prototype.bytesPerElement=12,Vt("StructArrayLayout3f12",hd);class dd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint32[1*r+0]=l,r}}dd.prototype.bytesPerElement=4,Vt("StructArrayLayout1ul4",dd);class Hs extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b,T,P,D){const O=this.length;return this.resize(O+1),this.emplace(O,r,l,d,g,x,b,T,P,D)}emplace(r,l,d,g,x,b,T,P,D,O){const H=10*r,q=5*r;return this.int16[H+0]=l,this.int16[H+1]=d,this.int16[H+2]=g,this.int16[H+3]=x,this.int16[H+4]=b,this.int16[H+5]=T,this.uint32[q+3]=P,this.uint16[H+8]=D,this.uint16[H+9]=O,r}}Hs.prototype.bytesPerElement=20,Vt("StructArrayLayout6i1ul2ui20",Hs);class Kc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b){const T=this.length;return this.resize(T+1),this.emplace(T,r,l,d,g,x,b)}emplace(r,l,d,g,x,b,T){const P=6*r;return this.int16[P+0]=l,this.int16[P+1]=d,this.int16[P+2]=g,this.int16[P+3]=x,this.int16[P+4]=b,this.int16[P+5]=T,r}}Kc.prototype.bytesPerElement=12,Vt("StructArrayLayout2i2i2i12",Kc);class Hl extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,r,l,d,g,x)}emplace(r,l,d,g,x,b){const T=4*r,P=8*r;return this.float32[T+0]=l,this.float32[T+1]=d,this.float32[T+2]=g,this.int16[P+6]=x,this.int16[P+7]=b,r}}Hl.prototype.bytesPerElement=16,Vt("StructArrayLayout2f1f2i16",Hl);class Jc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,d,g)}emplace(r,l,d,g,x){const b=12*r,T=3*r;return this.uint8[b+0]=l,this.uint8[b+1]=d,this.float32[T+1]=g,this.float32[T+2]=x,r}}Jc.prototype.bytesPerElement=12,Vt("StructArrayLayout2ub2f12",Jc);class Do extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,d)}emplace(r,l,d,g){const x=3*r;return this.uint16[x+0]=l,this.uint16[x+1]=d,this.uint16[x+2]=g,r}}Do.prototype.bytesPerElement=6,Vt("StructArrayLayout3ui6",Do);class fd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we){const De=this.length;return this.resize(De+1),this.emplace(De,r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we)}emplace(r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we,De){const Me=24*r,Re=12*r,et=48*r;return this.int16[Me+0]=l,this.int16[Me+1]=d,this.uint16[Me+2]=g,this.uint16[Me+3]=x,this.uint32[Re+2]=b,this.uint32[Re+3]=T,this.uint32[Re+4]=P,this.uint16[Me+10]=D,this.uint16[Me+11]=O,this.uint16[Me+12]=H,this.float32[Re+7]=q,this.float32[Re+8]=Q,this.uint8[et+36]=ie,this.uint8[et+37]=ce,this.uint8[et+38]=me,this.uint32[Re+10]=we,this.int16[Me+22]=De,r}}fd.prototype.bytesPerElement=48,Vt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",fd);class zo extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we,De,Me,Re,et,ot,Dt,Yt,It,Pt,xt,Xt){const At=this.length;return this.resize(At+1),this.emplace(At,r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we,De,Me,Re,et,ot,Dt,Yt,It,Pt,xt,Xt)}emplace(r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce,me,we,De,Me,Re,et,ot,Dt,Yt,It,Pt,xt,Xt,At){const gt=32*r,tn=16*r;return this.int16[gt+0]=l,this.int16[gt+1]=d,this.int16[gt+2]=g,this.int16[gt+3]=x,this.int16[gt+4]=b,this.int16[gt+5]=T,this.int16[gt+6]=P,this.int16[gt+7]=D,this.uint16[gt+8]=O,this.uint16[gt+9]=H,this.uint16[gt+10]=q,this.uint16[gt+11]=Q,this.uint16[gt+12]=ie,this.uint16[gt+13]=ce,this.uint16[gt+14]=me,this.uint16[gt+15]=we,this.uint16[gt+16]=De,this.uint16[gt+17]=Me,this.uint16[gt+18]=Re,this.uint16[gt+19]=et,this.uint16[gt+20]=ot,this.uint16[gt+21]=Dt,this.uint16[gt+22]=Yt,this.uint32[tn+12]=It,this.float32[tn+13]=Pt,this.float32[tn+14]=xt,this.uint16[gt+30]=Xt,this.uint16[gt+31]=At,r}}zo.prototype.bytesPerElement=64,Vt("StructArrayLayout8i15ui1ul2f2ui64",zo);class fa extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.float32[1*r+0]=l,r}}fa.prototype.bytesPerElement=4,Vt("StructArrayLayout1f4",fa);class pd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,d)}emplace(r,l,d,g){const x=3*r;return this.uint16[6*r+0]=l,this.float32[x+1]=d,this.float32[x+2]=g,r}}pd.prototype.bytesPerElement=12,Vt("StructArrayLayout1ui2f12",pd);class Qc extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l,d){const g=this.length;return this.resize(g+1),this.emplace(g,r,l,d)}emplace(r,l,d,g){const x=4*r;return this.uint32[2*r+0]=l,this.uint16[x+2]=d,this.uint16[x+3]=g,r}}Qc.prototype.bytesPerElement=8,Vt("StructArrayLayout1ul2ui8",Qc);class ka extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,l){const d=this.length;return this.resize(d+1),this.emplace(d,r,l)}emplace(r,l,d){const g=2*r;return this.uint16[g+0]=l,this.uint16[g+1]=d,r}}ka.prototype.bytesPerElement=4,Vt("StructArrayLayout2ui4",ka);class md extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const l=this.length;return this.resize(l+1),this.emplace(l,r)}emplace(r,l){return this.uint16[1*r+0]=l,r}}md.prototype.bytesPerElement=2,Vt("StructArrayLayout1ui2",md);class gd extends fi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,l,d,g){const x=this.length;return this.resize(x+1),this.emplace(x,r,l,d,g)}emplace(r,l,d,g,x){const b=4*r;return this.float32[b+0]=l,this.float32[b+1]=d,this.float32[b+2]=g,this.float32[b+3]=x,r}}gd.prototype.bytesPerElement=16,Vt("StructArrayLayout4f16",gd);class _d extends Lo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new E(this.anchorPointX,this.anchorPointY)}}_d.prototype.size=20;class Up extends Hs{get(r){return new _d(this,r)}}Vt("CollisionBoxArray",Up);class _ extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class s extends fd{get(r){return new _(this,r)}}Vt("PlacedSymbolArray",s);class u extends Lo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}u.prototype.size=64;class p extends zo{get(r){return new u(this,r)}}Vt("SymbolInstanceArray",p);class m extends fa{getoffsetX(r){return this.float32[1*r+0]}}Vt("GlyphOffsetArray",m);class y extends Zc{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}Vt("SymbolLineVertexArray",y);class A extends Lo{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class C extends pd{get(r){return new A(this,r)}}Vt("TextAnchorOffsetArray",C);class I extends Lo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}I.prototype.size=8;class N extends Qc{get(r){return new I(this,r)}}Vt("FeatureIndexArray",N);class W extends Vl{}class X extends Vl{}class ne extends Vl{}class pe extends ld{}class de extends cd{}class _e extends Gl{}class le extends ud{}class Ae extends Yc{}class Oe extends hd{}class ve extends dd{}class Ie extends Kc{}class He extends Jc{}class We extends Do{}class Qe extends ka{}const dt=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:lt}=dt;class ht{constructor(r=[]){this.segments=r}prepareSegment(r,l,d,g){let x=this.segments[this.segments.length-1];return r>ht.MAX_VERTEX_ARRAY_LENGTH&&Te(`Max vertices per segment is ${ht.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!x||x.vertexLength+r>ht.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==g)&&(x={vertexOffset:l.length,primitiveOffset:d.length,vertexLength:0,primitiveLength:0},g!==void 0&&(x.sortKey=g),this.segments.push(x)),x}get(){return this.segments}destroy(){for(const r of this.segments)for(const l in r.vaos)r.vaos[l].destroy()}static simpleSegment(r,l,d,g){return new ht([{vertexOffset:r,primitiveOffset:l,vertexLength:d,primitiveLength:g,vaos:{},sortKey:0}])}}function Ut(a,r){return 256*(a=fe(Math.floor(a),0,255))+fe(Math.floor(r),0,255)}ht.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Vt("SegmentVector",ht);const gn=wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Et={exports:{}},hn={exports:{}};hn.exports=function(a,r){var l,d,g,x,b,T,P,D;for(d=a.length-(l=3&a.length),g=r,b=3432918353,T=461845907,D=0;D<d;)P=255&a.charCodeAt(D)|(255&a.charCodeAt(++D))<<8|(255&a.charCodeAt(++D))<<16|(255&a.charCodeAt(++D))<<24,++D,g=27492+(65535&(x=5*(65535&(g=(g^=P=(65535&(P=(P=(65535&P)*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(P=0,l){case 3:P^=(255&a.charCodeAt(D+2))<<16;case 2:P^=(255&a.charCodeAt(D+1))<<8;case 1:g^=P=(65535&(P=(P=(65535&(P^=255&a.charCodeAt(D)))*b+(((P>>>16)*b&65535)<<16)&4294967295)<<15|P>>>17))*T+(((P>>>16)*T&65535)<<16)&4294967295}return g^=a.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var xn=hn.exports,Rn={exports:{}};Rn.exports=function(a,r){for(var l,d=a.length,g=r^d,x=0;d>=4;)l=1540483477*(65535&(l=255&a.charCodeAt(x)|(255&a.charCodeAt(++x))<<8|(255&a.charCodeAt(++x))<<16|(255&a.charCodeAt(++x))<<24))+((1540483477*(l>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),d-=4,++x;switch(d){case 3:g^=(255&a.charCodeAt(x+2))<<16;case 2:g^=(255&a.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&a.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var pn=xn,Sn=Rn.exports;Et.exports=pn,Et.exports.murmur3=pn,Et.exports.murmur2=Sn;var Mn=v(Et.exports);class ui{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,l,d,g){this.ids.push(Zn(r)),this.positions.push(l,d,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const l=Zn(r);let d=0,g=this.ids.length-1;for(;d<g;){const b=d+g>>1;this.ids[b]>=l?g=b:d=b+1}const x=[];for(;this.ids[d]===l;)x.push({index:this.positions[3*d],start:this.positions[3*d+1],end:this.positions[3*d+2]}),d++;return x}static serialize(r,l){const d=new Float64Array(r.ids),g=new Uint32Array(r.positions);return yr(d,g,0,d.length-1),l&&l.push(d.buffer,g.buffer),{ids:d,positions:g}}static deserialize(r){const l=new ui;return l.ids=r.ids,l.positions=r.positions,l.indexed=!0,l}}function Zn(a){const r=+a;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:Mn(String(a))}function yr(a,r,l,d){for(;l<d;){const g=a[l+d>>1];let x=l-1,b=d+1;for(;;){do x++;while(a[x]<g);do b--;while(a[b]>g);if(x>=b)break;Ci(a,x,b),Ci(r,3*x,3*b),Ci(r,3*x+1,3*b+1),Ci(r,3*x+2,3*b+2)}b-l<d-b?(yr(a,r,l,b),l=b+1):(yr(a,r,b+1,d),d=b)}}function Ci(a,r,l){const d=a[r];a[r]=a[l],a[l]=d}Vt("FeaturePositionMap",ui);class Jn{constructor(r,l){this.gl=r.gl,this.location=l}}class Qi extends Jn{constructor(r,l){super(r,l),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class ss extends Jn{constructor(r,l){super(r,l),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Ts extends Jn{constructor(r,l){super(r,l),this.current=Ft.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Fa=new Float32Array(16);function Ua(a){return[Ut(255*a.r,255*a.g),Ut(255*a.b,255*a.a)]}class Es{constructor(r,l,d){this.value=r,this.uniformNames=l.map(g=>`u_${g}`),this.type=d}setUniform(r,l,d){r.set(d.constantOr(this.value))}getBinding(r,l,d){return this.type==="color"?new Ts(r,l):new Qi(r,l)}}class as{constructor(r,l){this.uniformNames=l.map(d=>`u_${d}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,l){this.pixelRatioFrom=l.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=l.tlbr,this.patternTo=r.tlbr}setUniform(r,l,d,g){const x=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&r.set(x)}getBinding(r,l,d){return d.substr(0,9)==="u_pattern"?new ss(r,l):new Qi(r,l)}}class pi{constructor(r,l,d,g){this.expression=r,this.type=d,this.maxValue=0,this.paintVertexAttributes=l.map(x=>({name:`a_${x}`,type:"Float32",components:d==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,l,d,g,x){const b=this.paintVertexArray.length,T=this.expression.evaluate(new ti(0),l,{},g,[],x);this.paintVertexArray.resize(r),this._setPaintValue(b,r,T)}updatePaintArray(r,l,d,g){const x=this.expression.evaluate({zoom:0},d,g);this._setPaintValue(r,l,x)}_setPaintValue(r,l,d){if(this.type==="color"){const g=Ua(d);for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=r;g<l;g++)this.paintVertexArray.emplace(g,d);this.maxValue=Math.max(this.maxValue,Math.abs(d))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ni{constructor(r,l,d,g,x,b){this.expression=r,this.uniformNames=l.map(T=>`u_${T}_t`),this.type=d,this.useIntegerZoom=g,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=l.map(T=>({name:`a_${T}`,type:"Float32",components:d==="color"?4:2,offset:0})),this.paintVertexArray=new b}populatePaintArray(r,l,d,g,x){const b=this.expression.evaluate(new ti(this.zoom),l,{},g,[],x),T=this.expression.evaluate(new ti(this.zoom+1),l,{},g,[],x),P=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(P,r,b,T)}updatePaintArray(r,l,d,g){const x=this.expression.evaluate({zoom:this.zoom},d,g),b=this.expression.evaluate({zoom:this.zoom+1},d,g);this._setPaintValue(r,l,x,b)}_setPaintValue(r,l,d,g){if(this.type==="color"){const x=Ua(d),b=Ua(g);for(let T=r;T<l;T++)this.paintVertexArray.emplace(T,x[0],x[1],b[0],b[1])}else{for(let x=r;x<l;x++)this.paintVertexArray.emplace(x,d,g);this.maxValue=Math.max(this.maxValue,Math.abs(d),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,l){const d=this.useIntegerZoom?Math.floor(l.zoom):l.zoom,g=fe(this.expression.interpolationFactor(d,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,l,d){return new Qi(r,l)}}class vi{constructor(r,l,d,g,x,b){this.expression=r,this.type=l,this.useIntegerZoom=d,this.zoom=g,this.layerId=b,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x}populatePaintArray(r,l,d){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,l.patterns&&l.patterns[this.layerId],d)}updatePaintArray(r,l,d,g,x){this._setPaintValues(r,l,d.patterns&&d.patterns[this.layerId],x)}_setPaintValues(r,l,d,g){if(!g||!d)return;const{min:x,mid:b,max:T}=d,P=g[x],D=g[b],O=g[T];if(P&&D&&O)for(let H=r;H<l;H++)this.zoomInPaintVertexArray.emplace(H,D.tl[0],D.tl[1],D.br[0],D.br[1],P.tl[0],P.tl[1],P.br[0],P.br[1],D.pixelRatio,P.pixelRatio),this.zoomOutPaintVertexArray.emplace(H,D.tl[0],D.tl[1],D.br[0],D.br[1],O.tl[0],O.tl[1],O.br[0],O.br[1],D.pixelRatio,O.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,gn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,gn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ko{constructor(r,l,d){this.binders={},this._buffers=[];const g=[];for(const x in r.paint._values){if(!d(x))continue;const b=r.paint.get(x);if(!(b instanceof is&&wo(b.property.specification)))continue;const T=Hi(x,r.type),P=b.value,D=b.property.specification.type,O=b.property.useIntegerZoom,H=b.property.specification["property-type"],q=H==="cross-faded"||H==="cross-faded-data-driven";if(P.kind==="constant")this.binders[x]=q?new as(P.value,T):new Es(P.value,T,D),g.push(`/u_${x}`);else if(P.kind==="source"||q){const Q=kr(x,D,"source");this.binders[x]=q?new vi(P,D,O,l,Q,r.id):new pi(P,T,D,Q),g.push(`/a_${x}`)}else{const Q=kr(x,D,"composite");this.binders[x]=new ni(P,T,D,O,l,Q),g.push(`/z_${x}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const l=this.binders[r];return l instanceof pi||l instanceof ni?l.maxValue:0}populatePaintArrays(r,l,d,g,x){for(const b in this.binders){const T=this.binders[b];(T instanceof pi||T instanceof ni||T instanceof vi)&&T.populatePaintArray(r,l,d,g,x)}}setConstantPatternPositions(r,l){for(const d in this.binders){const g=this.binders[d];g instanceof as&&g.setConstantPatternPositions(r,l)}}updatePaintArrays(r,l,d,g,x){let b=!1;for(const T in r){const P=l.getPositions(T);for(const D of P){const O=d.feature(D.index);for(const H in this.binders){const q=this.binders[H];if((q instanceof pi||q instanceof ni||q instanceof vi)&&q.expression.isStateDependent===!0){const Q=g.paint.get(H);q.expression=Q.value,q.updatePaintArray(D.start,D.end,O,r[T],x),b=!0}}}}return b}defines(){const r=[];for(const l in this.binders){const d=this.binders[l];(d instanceof Es||d instanceof as)&&r.push(...d.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof pi||d instanceof ni)for(let g=0;g<d.paintVertexAttributes.length;g++)r.push(d.paintVertexAttributes[g].name);else if(d instanceof vi)for(let g=0;g<gn.members.length;g++)r.push(gn.members[g].name)}return r}getBinderUniforms(){const r=[];for(const l in this.binders){const d=this.binders[l];if(d instanceof Es||d instanceof as||d instanceof ni)for(const g of d.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,l){const d=[];for(const g in this.binders){const x=this.binders[g];if(x instanceof Es||x instanceof as||x instanceof ni){for(const b of x.uniformNames)if(l[b]){const T=x.getBinding(r,l[b],b);d.push({name:b,property:g,binding:T})}}}return d}setUniforms(r,l,d,g){for(const{name:x,property:b,binding:T}of l)this.binders[b].setUniform(T,g,d.get(b),x)}updatePaintBuffers(r){this._buffers=[];for(const l in this.binders){const d=this.binders[l];if(r&&d instanceof vi){const g=r.fromScale===2?d.zoomInPaintVertexBuffer:d.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(d instanceof pi||d instanceof ni)&&d.paintVertexBuffer&&this._buffers.push(d.paintVertexBuffer)}}upload(r){for(const l in this.binders){const d=this.binders[l];(d instanceof pi||d instanceof ni||d instanceof vi)&&d.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const l=this.binders[r];(l instanceof pi||l instanceof ni||l instanceof vi)&&l.destroy()}}}class oi{constructor(r,l,d=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new ko(g,l,d);this.needsUpload=!1,this._featureMap=new ui,this._bufferOffset=0}populatePaintArrays(r,l,d,g,x,b){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(r,l,g,x,b);l.id!==void 0&&this._featureMap.add(l.id,d,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,l,d,g){for(const x of d)this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(r,this._featureMap,l,x,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const l in this.programConfigurations)this.programConfigurations[l].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Hi(a,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[a]||[a.replace(`${r}-`,"").replace(/-/g,"_")]}function kr(a,r,l){const d={color:{source:Gl,composite:gd},number:{source:fa,composite:Gl}},g=function(x){return{"line-pattern":{source:le,composite:le},"fill-pattern":{source:le,composite:le},"fill-extrusion-pattern":{source:le,composite:le}}[x]}(a);return g&&g[l]||d[r][l]}Vt("ConstantBinder",Es),Vt("CrossFadedConstantBinder",as),Vt("SourceExpressionBinder",pi),Vt("CrossFadedCompositeBinder",vi),Vt("CompositeExpressionBinder",ni),Vt("ProgramConfiguration",ko,{omit:["_buffers"]}),Vt("ProgramConfigurationSet",oi);const Cn=8192,yd=Math.pow(2,14)-1,Np=-yd-1;function Na(a){const r=Cn/a.extent,l=a.loadGeometry();for(let d=0;d<l.length;d++){const g=l[d];for(let x=0;x<g.length;x++){const b=g[x],T=Math.round(b.x*r),P=Math.round(b.y*r);b.x=fe(T,Np,yd),b.y=fe(P,Np,yd),(T<b.x||T>b.x+1||P<b.y||P>b.y+1)&&Te("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return l}function Oa(a,r){return{type:a.type,id:a.id,properties:a.properties,geometry:r?Na(a):[]}}function eu(a,r,l,d,g){a.emplaceBack(2*r+(d+1)/2,2*l+(g+1)/2)}class vd{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new X,this.indexArray=new We,this.segments=new ht,this.programConfigurations=new oi(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d){const g=this.layers[0],x=[];let b=null,T=!1;g.type==="circle"&&(b=g.layout.get("circle-sort-key"),T=!b.isConstant());for(const{feature:P,id:D,index:O,sourceLayerIndex:H}of r){const q=this.layers[0]._featureFilter.needGeometry,Q=Oa(P,q);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),Q,d))continue;const ie=T?b.evaluate(Q,{},d):void 0,ce={id:D,properties:P.properties,type:P.type,sourceLayerIndex:H,index:O,geometry:q?Q.geometry:Na(P),patterns:{},sortKey:ie};x.push(ce)}T&&x.sort((P,D)=>P.sortKey-D.sortKey);for(const P of x){const{geometry:D,index:O,sourceLayerIndex:H}=P,q=r[O].feature;this.addFeature(P,D,O,d),l.featureIndex.insert(q,D,O,H,this.index)}}update(r,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,lt),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,l,d,g){for(const x of l)for(const b of x){const T=b.x,P=b.y;if(T<0||T>=Cn||P<0||P>=Cn)continue;const D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),O=D.vertexLength;eu(this.layoutVertexArray,T,P,-1,-1),eu(this.layoutVertexArray,T,P,1,-1),eu(this.layoutVertexArray,T,P,1,1),eu(this.layoutVertexArray,T,P,-1,1),this.indexArray.emplaceBack(O,O+1,O+2),this.indexArray.emplaceBack(O,O+3,O+2),D.vertexLength+=4,D.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,{},g)}}function Ba(a,r){for(let l=0;l<a.length;l++)if(tu(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(tu(a,r[l]))return!0;return!!jl(a,r)}function Op(a,r,l){return!!tu(a,r)||!!Wl(r,a,l)}function xd(a,r){if(a.length===1)return Qx(r,a[0]);for(let l=0;l<r.length;l++){const d=r[l];for(let g=0;g<d.length;g++)if(tu(a,d[g]))return!0}for(let l=0;l<a.length;l++)if(Qx(r,a[l]))return!0;for(let l=0;l<r.length;l++)if(jl(a,r[l]))return!0;return!1}function Bp(a,r,l){if(a.length>1){if(jl(a,r))return!0;for(let d=0;d<r.length;d++)if(Wl(r[d],a,l))return!0}for(let d=0;d<a.length;d++)if(Wl(a[d],r,l))return!0;return!1}function jl(a,r){if(a.length===0||r.length===0)return!1;for(let l=0;l<a.length-1;l++){const d=a[l],g=a[l+1];for(let x=0;x<r.length-1;x++)if(Vp(d,g,r[x],r[x+1]))return!0}return!1}function Vp(a,r,l,d){return je(a,l,d)!==je(r,l,d)&&je(a,r,l)!==je(a,r,d)}function Wl(a,r,l){const d=l*l;if(r.length===1)return a.distSqr(r[0])<d;for(let g=1;g<r.length;g++)if(Jx(a,r[g-1],r[g])<d)return!0;return!1}function Jx(a,r,l){const d=r.distSqr(l);if(d===0)return a.distSqr(r);const g=((a.x-r.x)*(l.x-r.x)+(a.y-r.y)*(l.y-r.y))/d;return a.distSqr(g<0?r:g>1?l:l.sub(r)._mult(g)._add(r))}function Qx(a,r){let l,d,g,x=!1;for(let b=0;b<a.length;b++){l=a[b];for(let T=0,P=l.length-1;T<l.length;P=T++)d=l[T],g=l[P],d.y>r.y!=g.y>r.y&&r.x<(g.x-d.x)*(r.y-d.y)/(g.y-d.y)+d.x&&(x=!x)}return x}function tu(a,r){let l=!1;for(let d=0,g=a.length-1;d<a.length;g=d++){const x=a[d],b=a[g];x.y>r.y!=b.y>r.y&&r.x<(b.x-x.x)*(r.y-x.y)/(b.y-x.y)+x.x&&(l=!l)}return l}function SA(a,r,l){const d=l[0],g=l[2];if(a.x<d.x&&r.x<d.x||a.x>g.x&&r.x>g.x||a.y<d.y&&r.y<d.y||a.y>g.y&&r.y>g.y)return!1;const x=je(a,r,l[0]);return x!==je(a,r,l[1])||x!==je(a,r,l[2])||x!==je(a,r,l[3])}function bd(a,r,l){const d=r.paint.get(a).value;return d.kind==="constant"?d.value:l.programConfigurations.get(r.id).getMaxValue(a)}function Gp(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function Hp(a,r,l,d,g){if(!r[0]&&!r[1])return a;const x=E.convert(r)._mult(g);l==="viewport"&&x._rotate(-d);const b=[];for(let T=0;T<a.length;T++)b.push(a[T].sub(x));return b}let e1,t1;Vt("CircleBucket",vd,{omit:["layers"]});var MA={get paint(){return t1=t1||new _r({"circle-radius":new cn(J.paint_circle["circle-radius"]),"circle-color":new cn(J.paint_circle["circle-color"]),"circle-blur":new cn(J.paint_circle["circle-blur"]),"circle-opacity":new cn(J.paint_circle["circle-opacity"]),"circle-translate":new Qt(J.paint_circle["circle-translate"]),"circle-translate-anchor":new Qt(J.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Qt(J.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Qt(J.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new cn(J.paint_circle["circle-stroke-width"]),"circle-stroke-color":new cn(J.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new cn(J.paint_circle["circle-stroke-opacity"])})},get layout(){return e1=e1||new _r({"circle-sort-key":new cn(J.layout_circle["circle-sort-key"])})}},vr=1e-6,nu=typeof Float32Array<"u"?Float32Array:Array;function z_(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function n1(a,r,l){var d=r[0],g=r[1],x=r[2],b=r[3],T=r[4],P=r[5],D=r[6],O=r[7],H=r[8],q=r[9],Q=r[10],ie=r[11],ce=r[12],me=r[13],we=r[14],De=r[15],Me=l[0],Re=l[1],et=l[2],ot=l[3];return a[0]=Me*d+Re*T+et*H+ot*ce,a[1]=Me*g+Re*P+et*q+ot*me,a[2]=Me*x+Re*D+et*Q+ot*we,a[3]=Me*b+Re*O+et*ie+ot*De,a[4]=(Me=l[4])*d+(Re=l[5])*T+(et=l[6])*H+(ot=l[7])*ce,a[5]=Me*g+Re*P+et*q+ot*me,a[6]=Me*x+Re*D+et*Q+ot*we,a[7]=Me*b+Re*O+et*ie+ot*De,a[8]=(Me=l[8])*d+(Re=l[9])*T+(et=l[10])*H+(ot=l[11])*ce,a[9]=Me*g+Re*P+et*q+ot*me,a[10]=Me*x+Re*D+et*Q+ot*we,a[11]=Me*b+Re*O+et*ie+ot*De,a[12]=(Me=l[12])*d+(Re=l[13])*T+(et=l[14])*H+(ot=l[15])*ce,a[13]=Me*g+Re*P+et*q+ot*me,a[14]=Me*x+Re*D+et*Q+ot*we,a[15]=Me*b+Re*O+et*ie+ot*De,a}Math.hypot||(Math.hypot=function(){for(var a=0,r=arguments.length;r--;)a+=arguments[r]*arguments[r];return Math.sqrt(a)});var wd,TA=n1;function jp(a,r,l){var d=r[0],g=r[1],x=r[2],b=r[3];return a[0]=l[0]*d+l[4]*g+l[8]*x+l[12]*b,a[1]=l[1]*d+l[5]*g+l[9]*x+l[13]*b,a[2]=l[2]*d+l[6]*g+l[10]*x+l[14]*b,a[3]=l[3]*d+l[7]*g+l[11]*x+l[15]*b,a}wd=new nu(4),nu!=Float32Array&&(wd[0]=0,wd[1]=0,wd[2]=0,wd[3]=0);class EA extends rs{constructor(r){super(r,MA)}createBucket(r){return new vd(r)}queryRadius(r){const l=r;return bd("circle-radius",this,l)+bd("circle-stroke-width",this,l)+Gp(this.paint.get("circle-translate"))}queryIntersectsFeature(r,l,d,g,x,b,T,P){const D=Hp(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),b.angle,T),O=this.paint.get("circle-radius").evaluate(l,d)+this.paint.get("circle-stroke-width").evaluate(l,d),H=this.paint.get("circle-pitch-alignment")==="map",q=H?D:function(ie,ce){return ie.map(me=>i1(me,ce))}(D,P),Q=H?O*T:O;for(const ie of g)for(const ce of ie){const me=H?ce:i1(ce,P);let we=Q;const De=jp([],[ce.x,ce.y,0,1],P);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?we*=De[3]/b.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(we*=b.cameraToCenterDistance/De[3]),Op(q,me,we))return!0}return!1}}function i1(a,r){const l=jp([],[a.x,a.y,0,1],r);return new E(l[0]/l[3],l[1]/l[3])}class r1 extends vd{}let s1;Vt("HeatmapBucket",r1,{omit:["layers"]});var AA={get paint(){return s1=s1||new _r({"heatmap-radius":new cn(J.paint_heatmap["heatmap-radius"]),"heatmap-weight":new cn(J.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Qt(J.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bl(J.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Qt(J.paint_heatmap["heatmap-opacity"])})}};function k_(a,{width:r,height:l},d,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*l*d)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*l*d}`)}else g=new Uint8Array(r*l*d);return a.width=r,a.height=l,a.data=g,a}function a1(a,{width:r,height:l},d){if(r===a.width&&l===a.height)return;const g=k_({},{width:r,height:l},d);F_(a,g,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,r),height:Math.min(a.height,l)},d),a.width=r,a.height=l,a.data=g.data}function F_(a,r,l,d,g,x){if(g.width===0||g.height===0)return r;if(g.width>a.width||g.height>a.height||l.x>a.width-g.width||l.y>a.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||d.x>r.width-g.width||d.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const b=a.data,T=r.data;if(b===T)throw new Error("srcData equals dstData, so image is already copied");for(let P=0;P<g.height;P++){const D=((l.y+P)*a.width+l.x)*x,O=((d.y+P)*r.width+d.x)*x;for(let H=0;H<g.width*x;H++)T[O+H]=b[D+H]}return r}class Sd{constructor(r,l){k_(this,r,1,l)}resize(r){a1(this,r,1)}clone(){return new Sd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,d,g,x){F_(r,l,d,g,x,1)}}class os{constructor(r,l){k_(this,r,4,l)}resize(r){a1(this,r,4)}replace(r,l){l?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new os({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,l,d,g,x){F_(r,l,d,g,x,4)}}function o1(a){const r={},l=a.resolution||256,d=a.clips?a.clips.length:1,g=a.image||new os({width:l,height:d});if(Math.log(l)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${l}`);const x=(b,T,P)=>{r[a.evaluationKey]=P;const D=a.expression.evaluate(r);g.data[b+T+0]=Math.floor(255*D.r/D.a),g.data[b+T+1]=Math.floor(255*D.g/D.a),g.data[b+T+2]=Math.floor(255*D.b/D.a),g.data[b+T+3]=Math.floor(255*D.a)};if(a.clips)for(let b=0,T=0;b<d;++b,T+=4*l)for(let P=0,D=0;P<l;P++,D+=4){const O=P/(l-1),{start:H,end:q}=a.clips[b];x(T,D,H*(1-O)+q*O)}else for(let b=0,T=0;b<l;b++,T+=4)x(0,T,b/(l-1));return g}Vt("AlphaImage",Sd),Vt("RGBAImage",os);class CA extends rs{createBucket(r){return new r1(r)}constructor(r){super(r,AA),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=o1({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let l1;var PA={get paint(){return l1=l1||new _r({"hillshade-illumination-direction":new Qt(J.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Qt(J.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Qt(J.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Qt(J.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Qt(J.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Qt(J.paint_hillshade["hillshade-accent-color"])})}};class RA extends rs{constructor(r){super(r,PA)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const IA=wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:LA}=IA;var U_={exports:{}};function Wp(a,r,l){l=l||2;var d,g,x,b,T,P,D,O=r&&r.length,H=O?r[0]*l:a.length,q=c1(a,0,H,l,!0),Q=[];if(!q||q.next===q.prev)return Q;if(O&&(q=function(ce,me,we,De){var Me,Re,et,ot=[];for(Me=0,Re=me.length;Me<Re;Me++)(et=c1(ce,me[Me]*De,Me<Re-1?me[Me+1]*De:ce.length,De,!1))===et.next&&(et.steiner=!0),ot.push(BA(et));for(ot.sort(UA),Me=0;Me<ot.length;Me++)we=NA(ot[Me],we);return we}(a,r,q,l)),a.length>80*l){d=x=a[0],g=b=a[1];for(var ie=l;ie<H;ie+=l)(T=a[ie])<d&&(d=T),(P=a[ie+1])<g&&(g=P),T>x&&(x=T),P>b&&(b=P);D=(D=Math.max(x-d,b-g))!==0?32767/D:0}return Md(q,Q,l,d,g,D,0),Q}function c1(a,r,l,d,g){var x,b;if(g===B_(a,r,l,d)>0)for(x=r;x<l;x+=d)b=d1(x,a[x],a[x+1],b);else for(x=l-d;x>=r;x-=d)b=d1(x,a[x],a[x+1],b);return b&&$p(b,b.next)&&(Ed(b),b=b.next),b}function $l(a,r){if(!a)return a;r||(r=a);var l,d=a;do if(l=!1,d.steiner||!$p(d,d.next)&&Si(d.prev,d,d.next)!==0)d=d.next;else{if(Ed(d),(d=r=d.prev)===d.next)break;l=!0}while(l||d!==r);return r}function Md(a,r,l,d,g,x,b){if(a){!b&&x&&function(O,H,q,Q){var ie=O;do ie.z===0&&(ie.z=N_(ie.x,ie.y,H,q,Q)),ie.prevZ=ie.prev,ie.nextZ=ie.next,ie=ie.next;while(ie!==O);ie.prevZ.nextZ=null,ie.prevZ=null,function(ce){var me,we,De,Me,Re,et,ot,Dt,Yt=1;do{for(we=ce,ce=null,Re=null,et=0;we;){for(et++,De=we,ot=0,me=0;me<Yt&&(ot++,De=De.nextZ);me++);for(Dt=Yt;ot>0||Dt>0&&De;)ot!==0&&(Dt===0||!De||we.z<=De.z)?(Me=we,we=we.nextZ,ot--):(Me=De,De=De.nextZ,Dt--),Re?Re.nextZ=Me:ce=Me,Me.prevZ=Re,Re=Me;we=De}Re.nextZ=null,Yt*=2}while(et>1)}(ie)}(a,d,g,x);for(var T,P,D=a;a.prev!==a.next;)if(T=a.prev,P=a.next,x?zA(a,d,g,x):DA(a))r.push(T.i/l|0),r.push(a.i/l|0),r.push(P.i/l|0),Ed(a),a=P.next,D=P.next;else if((a=P)===D){b?b===1?Md(a=kA($l(a),r,l),r,l,d,g,x,2):b===2&&FA(a,r,l,d,g,x):Md($l(a),r,l,d,g,x,1);break}}}function DA(a){var r=a.prev,l=a,d=a.next;if(Si(r,l,d)>=0)return!1;for(var g=r.x,x=l.x,b=d.x,T=r.y,P=l.y,D=d.y,O=g<x?g<b?g:b:x<b?x:b,H=T<P?T<D?T:D:P<D?P:D,q=g>x?g>b?g:b:x>b?x:b,Q=T>P?T>D?T:D:P>D?P:D,ie=d.next;ie!==r;){if(ie.x>=O&&ie.x<=q&&ie.y>=H&&ie.y<=Q&&iu(g,T,x,P,b,D,ie.x,ie.y)&&Si(ie.prev,ie,ie.next)>=0)return!1;ie=ie.next}return!0}function zA(a,r,l,d){var g=a.prev,x=a,b=a.next;if(Si(g,x,b)>=0)return!1;for(var T=g.x,P=x.x,D=b.x,O=g.y,H=x.y,q=b.y,Q=T<P?T<D?T:D:P<D?P:D,ie=O<H?O<q?O:q:H<q?H:q,ce=T>P?T>D?T:D:P>D?P:D,me=O>H?O>q?O:q:H>q?H:q,we=N_(Q,ie,r,l,d),De=N_(ce,me,r,l,d),Me=a.prevZ,Re=a.nextZ;Me&&Me.z>=we&&Re&&Re.z<=De;){if(Me.x>=Q&&Me.x<=ce&&Me.y>=ie&&Me.y<=me&&Me!==g&&Me!==b&&iu(T,O,P,H,D,q,Me.x,Me.y)&&Si(Me.prev,Me,Me.next)>=0||(Me=Me.prevZ,Re.x>=Q&&Re.x<=ce&&Re.y>=ie&&Re.y<=me&&Re!==g&&Re!==b&&iu(T,O,P,H,D,q,Re.x,Re.y)&&Si(Re.prev,Re,Re.next)>=0))return!1;Re=Re.nextZ}for(;Me&&Me.z>=we;){if(Me.x>=Q&&Me.x<=ce&&Me.y>=ie&&Me.y<=me&&Me!==g&&Me!==b&&iu(T,O,P,H,D,q,Me.x,Me.y)&&Si(Me.prev,Me,Me.next)>=0)return!1;Me=Me.prevZ}for(;Re&&Re.z<=De;){if(Re.x>=Q&&Re.x<=ce&&Re.y>=ie&&Re.y<=me&&Re!==g&&Re!==b&&iu(T,O,P,H,D,q,Re.x,Re.y)&&Si(Re.prev,Re,Re.next)>=0)return!1;Re=Re.nextZ}return!0}function kA(a,r,l){var d=a;do{var g=d.prev,x=d.next.next;!$p(g,x)&&u1(g,d,d.next,x)&&Td(g,x)&&Td(x,g)&&(r.push(g.i/l|0),r.push(d.i/l|0),r.push(x.i/l|0),Ed(d),Ed(d.next),d=a=x),d=d.next}while(d!==a);return $l(d)}function FA(a,r,l,d,g,x){var b=a;do{for(var T=b.next.next;T!==b.prev;){if(b.i!==T.i&&VA(b,T)){var P=h1(b,T);return b=$l(b,b.next),P=$l(P,P.next),Md(b,r,l,d,g,x,0),void Md(P,r,l,d,g,x,0)}T=T.next}b=b.next}while(b!==a)}function UA(a,r){return a.x-r.x}function NA(a,r){var l=function(g,x){var b,T=x,P=g.x,D=g.y,O=-1/0;do{if(D<=T.y&&D>=T.next.y&&T.next.y!==T.y){var H=T.x+(D-T.y)*(T.next.x-T.x)/(T.next.y-T.y);if(H<=P&&H>O&&(O=H,b=T.x<T.next.x?T:T.next,H===P))return b}T=T.next}while(T!==x);if(!b)return null;var q,Q=b,ie=b.x,ce=b.y,me=1/0;T=b;do P>=T.x&&T.x>=ie&&P!==T.x&&iu(D<ce?P:O,D,ie,ce,D<ce?O:P,D,T.x,T.y)&&(q=Math.abs(D-T.y)/(P-T.x),Td(T,g)&&(q<me||q===me&&(T.x>b.x||T.x===b.x&&OA(b,T)))&&(b=T,me=q)),T=T.next;while(T!==Q);return b}(a,r);if(!l)return r;var d=h1(l,a);return $l(d,d.next),$l(l,l.next)}function OA(a,r){return Si(a.prev,a,r.prev)<0&&Si(r.next,a,a.next)<0}function N_(a,r,l,d,g){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-l)*g|0)|a<<8))|a<<4))|a<<2))|a<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-d)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function BA(a){var r=a,l=a;do(r.x<l.x||r.x===l.x&&r.y<l.y)&&(l=r),r=r.next;while(r!==a);return l}function iu(a,r,l,d,g,x,b,T){return(g-b)*(r-T)>=(a-b)*(x-T)&&(a-b)*(d-T)>=(l-b)*(r-T)&&(l-b)*(x-T)>=(g-b)*(d-T)}function VA(a,r){return a.next.i!==r.i&&a.prev.i!==r.i&&!function(l,d){var g=l;do{if(g.i!==l.i&&g.next.i!==l.i&&g.i!==d.i&&g.next.i!==d.i&&u1(g,g.next,l,d))return!0;g=g.next}while(g!==l);return!1}(a,r)&&(Td(a,r)&&Td(r,a)&&function(l,d){var g=l,x=!1,b=(l.x+d.x)/2,T=(l.y+d.y)/2;do g.y>T!=g.next.y>T&&g.next.y!==g.y&&b<(g.next.x-g.x)*(T-g.y)/(g.next.y-g.y)+g.x&&(x=!x),g=g.next;while(g!==l);return x}(a,r)&&(Si(a.prev,a,r.prev)||Si(a,r.prev,r))||$p(a,r)&&Si(a.prev,a,a.next)>0&&Si(r.prev,r,r.next)>0)}function Si(a,r,l){return(r.y-a.y)*(l.x-r.x)-(r.x-a.x)*(l.y-r.y)}function $p(a,r){return a.x===r.x&&a.y===r.y}function u1(a,r,l,d){var g=qp(Si(a,r,l)),x=qp(Si(a,r,d)),b=qp(Si(l,d,a)),T=qp(Si(l,d,r));return g!==x&&b!==T||!(g!==0||!Xp(a,l,r))||!(x!==0||!Xp(a,d,r))||!(b!==0||!Xp(l,a,d))||!(T!==0||!Xp(l,r,d))}function Xp(a,r,l){return r.x<=Math.max(a.x,l.x)&&r.x>=Math.min(a.x,l.x)&&r.y<=Math.max(a.y,l.y)&&r.y>=Math.min(a.y,l.y)}function qp(a){return a>0?1:a<0?-1:0}function Td(a,r){return Si(a.prev,a,a.next)<0?Si(a,r,a.next)>=0&&Si(a,a.prev,r)>=0:Si(a,r,a.prev)<0||Si(a,a.next,r)<0}function h1(a,r){var l=new O_(a.i,a.x,a.y),d=new O_(r.i,r.x,r.y),g=a.next,x=r.prev;return a.next=r,r.prev=a,l.next=g,g.prev=l,d.next=l,l.prev=d,x.next=d,d.prev=x,d}function d1(a,r,l,d){var g=new O_(a,r,l);return d?(g.next=d.next,g.prev=d,d.next.prev=g,d.next=g):(g.prev=g,g.next=g),g}function Ed(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function O_(a,r,l){this.i=a,this.x=r,this.y=l,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function B_(a,r,l,d){for(var g=0,x=r,b=l-d;x<l;x+=d)g+=(a[b]-a[x])*(a[x+1]+a[b+1]),b=x;return g}U_.exports=Wp,U_.exports.default=Wp,Wp.deviation=function(a,r,l,d){var g=r&&r.length,x=Math.abs(B_(a,0,g?r[0]*l:a.length,l));if(g)for(var b=0,T=r.length;b<T;b++)x-=Math.abs(B_(a,r[b]*l,b<T-1?r[b+1]*l:a.length,l));var P=0;for(b=0;b<d.length;b+=3){var D=d[b]*l,O=d[b+1]*l,H=d[b+2]*l;P+=Math.abs((a[D]-a[H])*(a[O+1]-a[D+1])-(a[D]-a[O])*(a[H+1]-a[D+1]))}return x===0&&P===0?0:Math.abs((P-x)/x)},Wp.flatten=function(a){for(var r=a[0][0].length,l={vertices:[],holes:[],dimensions:r},d=0,g=0;g<a.length;g++){for(var x=0;x<a[g].length;x++)for(var b=0;b<r;b++)l.vertices.push(a[g][x][b]);g>0&&l.holes.push(d+=a[g-1].length)}return l};var f1=v(U_.exports);function GA(a,r,l,d,g){p1(a,r,l||0,d||a.length-1,g||HA)}function p1(a,r,l,d,g){for(;d>l;){if(d-l>600){var x=d-l+1,b=r-l+1,T=Math.log(x),P=.5*Math.exp(2*T/3),D=.5*Math.sqrt(T*P*(x-P)/x)*(b-x/2<0?-1:1);p1(a,r,Math.max(l,Math.floor(r-b*P/x+D)),Math.min(d,Math.floor(r+(x-b)*P/x+D)),g)}var O=a[r],H=l,q=d;for(Ad(a,l,r),g(a[d],O)>0&&Ad(a,l,d);H<q;){for(Ad(a,H,q),H++,q--;g(a[H],O)<0;)H++;for(;g(a[q],O)>0;)q--}g(a[l],O)===0?Ad(a,l,q):Ad(a,++q,d),q<=r&&(l=q+1),r<=q&&(d=q-1)}}function Ad(a,r,l){var d=a[r];a[r]=a[l],a[l]=d}function HA(a,r){return a<r?-1:a>r?1:0}function V_(a,r){const l=a.length;if(l<=1)return[a];const d=[];let g,x;for(let b=0;b<l;b++){const T=it(a[b]);T!==0&&(a[b].area=Math.abs(T),x===void 0&&(x=T<0),x===T<0?(g&&d.push(g),g=[a[b]]):g.push(a[b]))}if(g&&d.push(g),r>1)for(let b=0;b<d.length;b++)d[b].length<=r||(GA(d[b],r,1,d[b].length-1,jA),d[b]=d[b].slice(0,r));return d}function jA(a,r){return r.area-a.area}function G_(a,r,l){const d=l.patternDependencies;let g=!1;for(const x of r){const b=x.paint.get(`${a}-pattern`);b.isConstant()||(g=!0);const T=b.constantOr(null);T&&(g=!0,d[T.to]=!0,d[T.from]=!0)}return g}function H_(a,r,l,d,g){const x=g.patternDependencies;for(const b of r){const T=b.paint.get(`${a}-pattern`).value;if(T.kind!=="constant"){let P=T.evaluate({zoom:d-1},l,{},g.availableImages),D=T.evaluate({zoom:d},l,{},g.availableImages),O=T.evaluate({zoom:d+1},l,{},g.availableImages);P=P&&P.name?P.name:P,D=D&&D.name?D.name:D,O=O&&O.name?O.name:O,x[P]=!0,x[D]=!0,x[O]=!0,l.patterns[b.id]={min:P,mid:D,max:O}}}return l}class j_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new ne,this.indexArray=new We,this.indexArray2=new Qe,this.programConfigurations=new oi(r.layers,r.zoom),this.segments=new ht,this.segments2=new ht,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d){this.hasPattern=G_("fill",this.layers,l);const g=this.layers[0].layout.get("fill-sort-key"),x=!g.isConstant(),b=[];for(const{feature:T,id:P,index:D,sourceLayerIndex:O}of r){const H=this.layers[0]._featureFilter.needGeometry,q=Oa(T,H);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),q,d))continue;const Q=x?g.evaluate(q,{},d,l.availableImages):void 0,ie={id:P,properties:T.properties,type:T.type,sourceLayerIndex:O,index:D,geometry:H?q.geometry:Na(T),patterns:{},sortKey:Q};b.push(ie)}x&&b.sort((T,P)=>T.sortKey-P.sortKey);for(const T of b){const{geometry:P,index:D,sourceLayerIndex:O}=T;if(this.hasPattern){const H=H_("fill",this.layers,T,this.zoom,l);this.patternFeatures.push(H)}else this.addFeature(T,P,D,d,{});l.featureIndex.insert(r[D].feature,P,D,O,this.index)}}update(r,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d)}addFeatures(r,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,LA),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,l,d,g,x){for(const b of V_(l,500)){let T=0;for(const Q of b)T+=Q.length;const P=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),D=P.vertexLength,O=[],H=[];for(const Q of b){if(Q.length===0)continue;Q!==b[0]&&H.push(O.length/2);const ie=this.segments2.prepareSegment(Q.length,this.layoutVertexArray,this.indexArray2),ce=ie.vertexLength;this.layoutVertexArray.emplaceBack(Q[0].x,Q[0].y),this.indexArray2.emplaceBack(ce+Q.length-1,ce),O.push(Q[0].x),O.push(Q[0].y);for(let me=1;me<Q.length;me++)this.layoutVertexArray.emplaceBack(Q[me].x,Q[me].y),this.indexArray2.emplaceBack(ce+me-1,ce+me),O.push(Q[me].x),O.push(Q[me].y);ie.vertexLength+=Q.length,ie.primitiveLength+=Q.length}const q=f1(O,H);for(let Q=0;Q<q.length;Q+=3)this.indexArray.emplaceBack(D+q[Q],D+q[Q+1],D+q[Q+2]);P.vertexLength+=T,P.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,x,g)}}let m1,g1;Vt("FillBucket",j_,{omit:["layers","patternFeatures"]});var WA={get paint(){return g1=g1||new _r({"fill-antialias":new Qt(J.paint_fill["fill-antialias"]),"fill-opacity":new cn(J.paint_fill["fill-opacity"]),"fill-color":new cn(J.paint_fill["fill-color"]),"fill-outline-color":new cn(J.paint_fill["fill-outline-color"]),"fill-translate":new Qt(J.paint_fill["fill-translate"]),"fill-translate-anchor":new Qt(J.paint_fill["fill-translate-anchor"]),"fill-pattern":new za(J.paint_fill["fill-pattern"])})},get layout(){return m1=m1||new _r({"fill-sort-key":new cn(J.layout_fill["fill-sort-key"])})}};class $A extends rs{constructor(r){super(r,WA)}recalculate(r,l){super.recalculate(r,l);const d=this.paint._values["fill-outline-color"];d.value.kind==="constant"&&d.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new j_(r)}queryRadius(){return Gp(this.paint.get("fill-translate"))}queryIntersectsFeature(r,l,d,g,x,b,T){return xd(Hp(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),b.angle,T),g)}isTileClipped(){return!0}}const XA=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),qA=wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:ZA}=XA;var Fo={},YA=w,_1=ru;function ru(a,r,l,d,g){this.properties={},this.extent=l,this.type=0,this._pbf=a,this._geometry=-1,this._keys=d,this._values=g,a.readFields(KA,this,r)}function KA(a,r,l){a==1?r.id=l.readVarint():a==2?function(d,g){for(var x=d.readVarint()+d.pos;d.pos<x;){var b=g._keys[d.readVarint()],T=g._values[d.readVarint()];g.properties[b]=T}}(l,r):a==3?r.type=l.readVarint():a==4&&(r._geometry=l.pos)}function JA(a){for(var r,l,d=0,g=0,x=a.length,b=x-1;g<x;b=g++)d+=((l=a[b]).x-(r=a[g]).x)*(r.y+l.y);return d}ru.types=["Unknown","Point","LineString","Polygon"],ru.prototype.loadGeometry=function(){var a=this._pbf;a.pos=this._geometry;for(var r,l=a.readVarint()+a.pos,d=1,g=0,x=0,b=0,T=[];a.pos<l;){if(g<=0){var P=a.readVarint();d=7&P,g=P>>3}if(g--,d===1||d===2)x+=a.readSVarint(),b+=a.readSVarint(),d===1&&(r&&T.push(r),r=[]),r.push(new YA(x,b));else{if(d!==7)throw new Error("unknown command "+d);r&&r.push(r[0].clone())}}return r&&T.push(r),T},ru.prototype.bbox=function(){var a=this._pbf;a.pos=this._geometry;for(var r=a.readVarint()+a.pos,l=1,d=0,g=0,x=0,b=1/0,T=-1/0,P=1/0,D=-1/0;a.pos<r;){if(d<=0){var O=a.readVarint();l=7&O,d=O>>3}if(d--,l===1||l===2)(g+=a.readSVarint())<b&&(b=g),g>T&&(T=g),(x+=a.readSVarint())<P&&(P=x),x>D&&(D=x);else if(l!==7)throw new Error("unknown command "+l)}return[b,P,T,D]},ru.prototype.toGeoJSON=function(a,r,l){var d,g,x=this.extent*Math.pow(2,l),b=this.extent*a,T=this.extent*r,P=this.loadGeometry(),D=ru.types[this.type];function O(Q){for(var ie=0;ie<Q.length;ie++){var ce=Q[ie];Q[ie]=[360*(ce.x+b)/x-180,360/Math.PI*Math.atan(Math.exp((180-360*(ce.y+T)/x)*Math.PI/180))-90]}}switch(this.type){case 1:var H=[];for(d=0;d<P.length;d++)H[d]=P[d][0];O(P=H);break;case 2:for(d=0;d<P.length;d++)O(P[d]);break;case 3:for(P=function(Q){var ie=Q.length;if(ie<=1)return[Q];for(var ce,me,we=[],De=0;De<ie;De++){var Me=JA(Q[De]);Me!==0&&(me===void 0&&(me=Me<0),me===Me<0?(ce&&we.push(ce),ce=[Q[De]]):ce.push(Q[De]))}return ce&&we.push(ce),we}(P),d=0;d<P.length;d++)for(g=0;g<P[d].length;g++)O(P[d][g])}P.length===1?P=P[0]:D="Multi"+D;var q={type:"Feature",geometry:{type:D,coordinates:P},properties:this.properties};return"id"in this&&(q.id=this.id),q};var QA=_1,y1=v1;function v1(a,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=a,this._keys=[],this._values=[],this._features=[],a.readFields(eC,this,r),this.length=this._features.length}function eC(a,r,l){a===15?r.version=l.readVarint():a===1?r.name=l.readString():a===5?r.extent=l.readVarint():a===2?r._features.push(l.pos):a===3?r._keys.push(l.readString()):a===4&&r._values.push(function(d){for(var g=null,x=d.readVarint()+d.pos;d.pos<x;){var b=d.readVarint()>>3;g=b===1?d.readString():b===2?d.readFloat():b===3?d.readDouble():b===4?d.readVarint64():b===5?d.readVarint():b===6?d.readSVarint():b===7?d.readBoolean():null}return g}(l))}v1.prototype.feature=function(a){if(a<0||a>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[a];var r=this._pbf.readVarint()+this._pbf.pos;return new QA(this._pbf,r,this.extent,this._keys,this._values)};var tC=y1;function nC(a,r,l){if(a===3){var d=new tC(l,l.readVarint()+l.pos);d.length&&(r[d.name]=d)}}Fo.VectorTile=function(a,r){this.layers=a.readFields(nC,{},r)},Fo.VectorTileFeature=_1,Fo.VectorTileLayer=y1;const iC=Fo.VectorTileFeature.types,W_=Math.pow(2,13);function Cd(a,r,l,d,g,x,b,T){a.emplaceBack(r,l,2*Math.floor(d*W_)+b,g*W_*2,x*W_*2,Math.round(T))}class $_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new pe,this.centroidVertexArray=new W,this.indexArray=new We,this.programConfigurations=new oi(r.layers,r.zoom),this.segments=new ht,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d){this.features=[],this.hasPattern=G_("fill-extrusion",this.layers,l);for(const{feature:g,id:x,index:b,sourceLayerIndex:T}of r){const P=this.layers[0]._featureFilter.needGeometry,D=Oa(g,P);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),D,d))continue;const O={id:x,sourceLayerIndex:T,index:b,geometry:P?D.geometry:Na(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(H_("fill-extrusion",this.layers,O,this.zoom,l)):this.addFeature(O,O.geometry,b,d,{}),l.featureIndex.insert(g,O.geometry,b,T,this.index,!0)}}addFeatures(r,l,d){for(const g of this.features){const{geometry:x}=g;this.addFeature(g,x,g.index,l,d)}}update(r,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,ZA),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,qA.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,l,d,g,x){const b={x:0,y:0,vertexCount:0};for(const T of V_(l,500)){let P=0;for(const ie of T)P+=ie.length;let D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const ie of T){if(ie.length===0||sC(ie))continue;let ce=0;for(let me=0;me<ie.length;me++){const we=ie[me];if(me>=1){const De=ie[me-1];if(!rC(we,De)){D.vertexLength+4>ht.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Me=we.sub(De)._perp()._unit(),Re=De.dist(we);ce+Re>32768&&(ce=0),Cd(this.layoutVertexArray,we.x,we.y,Me.x,Me.y,0,0,ce),Cd(this.layoutVertexArray,we.x,we.y,Me.x,Me.y,0,1,ce),b.x+=2*we.x,b.y+=2*we.y,b.vertexCount+=2,ce+=Re,Cd(this.layoutVertexArray,De.x,De.y,Me.x,Me.y,0,0,ce),Cd(this.layoutVertexArray,De.x,De.y,Me.x,Me.y,0,1,ce),b.x+=2*De.x,b.y+=2*De.y,b.vertexCount+=2;const et=D.vertexLength;this.indexArray.emplaceBack(et,et+2,et+1),this.indexArray.emplaceBack(et+1,et+2,et+3),D.vertexLength+=4,D.primitiveLength+=2}}}}if(D.vertexLength+P>ht.MAX_VERTEX_ARRAY_LENGTH&&(D=this.segments.prepareSegment(P,this.layoutVertexArray,this.indexArray)),iC[r.type]!=="Polygon")continue;const O=[],H=[],q=D.vertexLength;for(const ie of T)if(ie.length!==0){ie!==T[0]&&H.push(O.length/2);for(let ce=0;ce<ie.length;ce++){const me=ie[ce];Cd(this.layoutVertexArray,me.x,me.y,0,0,1,1,0),b.x+=me.x,b.y+=me.y,b.vertexCount+=1,O.push(me.x),O.push(me.y)}}const Q=f1(O,H);for(let ie=0;ie<Q.length;ie+=3)this.indexArray.emplaceBack(q+Q[ie],q+Q[ie+2],q+Q[ie+1]);D.primitiveLength+=Q.length/3,D.vertexLength+=P}for(let T=0;T<b.vertexCount;T++)this.centroidVertexArray.emplaceBack(Math.floor(b.x/b.vertexCount),Math.floor(b.y/b.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,x,g)}}function rC(a,r){return a.x===r.x&&(a.x<0||a.x>Cn)||a.y===r.y&&(a.y<0||a.y>Cn)}function sC(a){return a.every(r=>r.x<0)||a.every(r=>r.x>Cn)||a.every(r=>r.y<0)||a.every(r=>r.y>Cn)}let x1;Vt("FillExtrusionBucket",$_,{omit:["layers","features"]});var aC={get paint(){return x1=x1||new _r({"fill-extrusion-opacity":new Qt(J["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new cn(J["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Qt(J["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Qt(J["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new za(J["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new cn(J["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new cn(J["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Qt(J["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class oC extends rs{constructor(r){super(r,aC)}createBucket(r){return new $_(r)}queryRadius(){return Gp(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,l,d,g,x,b,T,P){const D=Hp(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),b.angle,T),O=this.paint.get("fill-extrusion-height").evaluate(l,d),H=this.paint.get("fill-extrusion-base").evaluate(l,d),q=function(ie,ce,me,we){const De=[];for(const Me of ie){const Re=[Me.x,Me.y,0,1];jp(Re,Re,ce),De.push(new E(Re[0]/Re[3],Re[1]/Re[3]))}return De}(D,P),Q=function(ie,ce,me,we){const De=[],Me=[],Re=we[8]*ce,et=we[9]*ce,ot=we[10]*ce,Dt=we[11]*ce,Yt=we[8]*me,It=we[9]*me,Pt=we[10]*me,xt=we[11]*me;for(const Xt of ie){const At=[],gt=[];for(const tn of Xt){const Jt=tn.x,Tn=tn.y,ii=we[0]*Jt+we[4]*Tn+we[12],li=we[1]*Jt+we[5]*Tn+we[13],ki=we[2]*Jt+we[6]*Tn+we[14],Kr=we[3]*Jt+we[7]*Tn+we[15],xr=ki+ot,Pi=Kr+Dt,Xi=ii+Yt,tr=li+It,br=ki+Pt,wr=Kr+xt,Fi=new E((ii+Re)/Pi,(li+et)/Pi);Fi.z=xr/Pi,At.push(Fi);const Ui=new E(Xi/wr,tr/wr);Ui.z=br/wr,gt.push(Ui)}De.push(At),Me.push(gt)}return[De,Me]}(g,H,O,P);return function(ie,ce,me){let we=1/0;xd(me,ce)&&(we=b1(me,ce[0]));for(let De=0;De<ce.length;De++){const Me=ce[De],Re=ie[De];for(let et=0;et<Me.length-1;et++){const ot=Me[et],Dt=[ot,Me[et+1],Re[et+1],Re[et],ot];Ba(me,Dt)&&(we=Math.min(we,b1(me,Dt)))}}return we!==1/0&&we}(Q[0],Q[1],q)}}function Pd(a,r){return a.x*r.x+a.y*r.y}function b1(a,r){if(a.length===1){let l=0;const d=r[l++];let g;for(;!g||d.equals(g);)if(g=r[l++],!g)return 1/0;for(;l<r.length;l++){const x=r[l],b=a[0],T=g.sub(d),P=x.sub(d),D=b.sub(d),O=Pd(T,T),H=Pd(T,P),q=Pd(P,P),Q=Pd(D,T),ie=Pd(D,P),ce=O*q-H*H,me=(q*Q-H*ie)/ce,we=(O*ie-H*Q)/ce,De=d.z*(1-me-we)+g.z*me+x.z*we;if(isFinite(De))return De}return 1/0}{let l=1/0;for(const d of r)l=Math.min(l,d.z);return l}}const lC=wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:cC}=lC,uC=wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:hC}=uC,dC=Fo.VectorTileFeature.types,fC=Math.cos(Math.PI/180*37.5),w1=Math.pow(2,14)/.5;class X_{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(l=>l.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(l=>{this.gradients[l.id]={}}),this.layoutVertexArray=new de,this.layoutVertexArray2=new _e,this.indexArray=new We,this.programConfigurations=new oi(r.layers,r.zoom),this.segments=new ht,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id)}populate(r,l,d){this.hasPattern=G_("line",this.layers,l);const g=this.layers[0].layout.get("line-sort-key"),x=!g.isConstant(),b=[];for(const{feature:T,id:P,index:D,sourceLayerIndex:O}of r){const H=this.layers[0]._featureFilter.needGeometry,q=Oa(T,H);if(!this.layers[0]._featureFilter.filter(new ti(this.zoom),q,d))continue;const Q=x?g.evaluate(q,{},d):void 0,ie={id:P,properties:T.properties,type:T.type,sourceLayerIndex:O,index:D,geometry:H?q.geometry:Na(T),patterns:{},sortKey:Q};b.push(ie)}x&&b.sort((T,P)=>T.sortKey-P.sortKey);for(const T of b){const{geometry:P,index:D,sourceLayerIndex:O}=T;if(this.hasPattern){const H=H_("line",this.layers,T,this.zoom,l);this.patternFeatures.push(H)}else this.addFeature(T,P,D,d,{});l.featureIndex.insert(r[D].feature,P,D,O,this.index)}}update(r,l,d){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,l,this.stateDependentLayers,d)}addFeatures(r,l,d){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,l,d)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,hC)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,cC),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,l,d,g,x){const b=this.layers[0].layout,T=b.get("line-join").evaluate(r,{}),P=b.get("line-cap"),D=b.get("line-miter-limit"),O=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const H of l)this.addLine(H,r,T,P,D,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,d,x,g)}addLine(r,l,d,g,x,b){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let we=0;we<r.length-1;we++)this.totalDistance+=r[we].dist(r[we+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const T=dC[l.type]==="Polygon";let P=r.length;for(;P>=2&&r[P-1].equals(r[P-2]);)P--;let D=0;for(;D<P-1&&r[D].equals(r[D+1]);)D++;if(P<(T?3:2))return;d==="bevel"&&(x=1.05);const O=this.overscaling<=16?15*Cn/(512*this.overscaling):0,H=this.segments.prepareSegment(10*P,this.layoutVertexArray,this.indexArray);let q,Q,ie,ce,me;this.e1=this.e2=-1,T&&(q=r[P-2],me=r[D].sub(q)._unit()._perp());for(let we=D;we<P;we++){if(ie=we===P-1?T?r[D+1]:void 0:r[we+1],ie&&r[we].equals(ie))continue;me&&(ce=me),q&&(Q=q),q=r[we],me=ie?ie.sub(q)._unit()._perp():ce,ce=ce||me;let De=ce.add(me);De.x===0&&De.y===0||De._unit();const Me=ce.x*me.x+ce.y*me.y,Re=De.x*me.x+De.y*me.y,et=Re!==0?1/Re:1/0,ot=2*Math.sqrt(2-2*Re),Dt=Re<fC&&Q&&ie,Yt=ce.x*me.y-ce.y*me.x>0;if(Dt&&we>D){const xt=q.dist(Q);if(xt>2*O){const Xt=q.sub(q.sub(Q)._mult(O/xt)._round());this.updateDistance(Q,Xt),this.addCurrentVertex(Xt,ce,0,0,H),Q=Xt}}const It=Q&&ie;let Pt=It?d:T?"butt":g;if(It&&Pt==="round"&&(et<b?Pt="miter":et<=2&&(Pt="fakeround")),Pt==="miter"&&et>x&&(Pt="bevel"),Pt==="bevel"&&(et>2&&(Pt="flipbevel"),et<x&&(Pt="miter")),Q&&this.updateDistance(Q,q),Pt==="miter")De._mult(et),this.addCurrentVertex(q,De,0,0,H);else if(Pt==="flipbevel"){if(et>100)De=me.mult(-1);else{const xt=et*ce.add(me).mag()/ce.sub(me).mag();De._perp()._mult(xt*(Yt?-1:1))}this.addCurrentVertex(q,De,0,0,H),this.addCurrentVertex(q,De.mult(-1),0,0,H)}else if(Pt==="bevel"||Pt==="fakeround"){const xt=-Math.sqrt(et*et-1),Xt=Yt?xt:0,At=Yt?0:xt;if(Q&&this.addCurrentVertex(q,ce,Xt,At,H),Pt==="fakeround"){const gt=Math.round(180*ot/Math.PI/20);for(let tn=1;tn<gt;tn++){let Jt=tn/gt;if(Jt!==.5){const ii=Jt-.5;Jt+=Jt*ii*(Jt-1)*((1.0904+Me*(Me*(3.55645-1.43519*Me)-3.2452))*ii*ii+(.848013+Me*(.215638*Me-1.06021)))}const Tn=me.sub(ce)._mult(Jt)._add(ce)._unit()._mult(Yt?-1:1);this.addHalfVertex(q,Tn.x,Tn.y,!1,Yt,0,H)}}ie&&this.addCurrentVertex(q,me,-Xt,-At,H)}else if(Pt==="butt")this.addCurrentVertex(q,De,0,0,H);else if(Pt==="square"){const xt=Q?1:-1;this.addCurrentVertex(q,De,xt,xt,H)}else Pt==="round"&&(Q&&(this.addCurrentVertex(q,ce,0,0,H),this.addCurrentVertex(q,ce,1,1,H,!0)),ie&&(this.addCurrentVertex(q,me,-1,-1,H,!0),this.addCurrentVertex(q,me,0,0,H)));if(Dt&&we<P-1){const xt=q.dist(ie);if(xt>2*O){const Xt=q.add(ie.sub(q)._mult(O/xt)._round());this.updateDistance(q,Xt),this.addCurrentVertex(Xt,me,0,0,H),q=Xt}}}}addCurrentVertex(r,l,d,g,x,b=!1){const T=l.y*g-l.x,P=-l.y-l.x*g;this.addHalfVertex(r,l.x+l.y*d,l.y-l.x*d,b,!1,d,x),this.addHalfVertex(r,T,P,b,!0,-g,x),this.distance>w1/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,l,d,g,x,b))}addHalfVertex({x:r,y:l},d,g,x,b,T,P){const D=.5*(this.lineClips?this.scaledDistance*(w1-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(x?1:0),(l<<1)+(b?1:0),Math.round(63*d)+128,Math.round(63*g)+128,1+(T===0?0:T<0?-1:1)|(63&D)<<2,D>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const O=P.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,O),P.primitiveLength++),b?this.e2=O:this.e1=O}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,l){this.distance+=r.dist(l),this.updateScaledDistance()}}let S1,M1;Vt("LineBucket",X_,{omit:["layers","patternFeatures"]});var T1={get paint(){return M1=M1||new _r({"line-opacity":new cn(J.paint_line["line-opacity"]),"line-color":new cn(J.paint_line["line-color"]),"line-translate":new Qt(J.paint_line["line-translate"]),"line-translate-anchor":new Qt(J.paint_line["line-translate-anchor"]),"line-width":new cn(J.paint_line["line-width"]),"line-gap-width":new cn(J.paint_line["line-gap-width"]),"line-offset":new cn(J.paint_line["line-offset"]),"line-blur":new cn(J.paint_line["line-blur"]),"line-dasharray":new od(J.paint_line["line-dasharray"]),"line-pattern":new za(J.paint_line["line-pattern"]),"line-gradient":new Bl(J.paint_line["line-gradient"])})},get layout(){return S1=S1||new _r({"line-cap":new Qt(J.layout_line["line-cap"]),"line-join":new cn(J.layout_line["line-join"]),"line-miter-limit":new Qt(J.layout_line["line-miter-limit"]),"line-round-limit":new Qt(J.layout_line["line-round-limit"]),"line-sort-key":new cn(J.layout_line["line-sort-key"])})}};class pC extends cn{possiblyEvaluate(r,l){return l=new ti(Math.floor(l.zoom),{now:l.now,fadeDuration:l.fadeDuration,zoomHistory:l.zoomHistory,transition:l.transition}),super.possiblyEvaluate(r,l)}evaluate(r,l,d,g){return l=te({},l,{zoom:Math.floor(l.zoom)}),super.evaluate(r,l,d,g)}}let Zp;class mC extends rs{constructor(r){super(r,T1),this.gradientVersion=0,Zp||(Zp=new pC(T1.paint.properties["line-width"].specification),Zp.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(r){if(r==="line-gradient"){const l=this.gradientExpression();this.stepInterpolant=!!function(d){return d._styleExpression!==void 0}(l)&&l._styleExpression.expression instanceof _o,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,l){super.recalculate(r,l),this.paint._values["line-floorwidth"]=Zp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new X_(r)}queryRadius(r){const l=r,d=E1(bd("line-width",this,l),bd("line-gap-width",this,l)),g=bd("line-offset",this,l);return d/2+Math.abs(g)+Gp(this.paint.get("line-translate"))}queryIntersectsFeature(r,l,d,g,x,b,T){const P=Hp(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),b.angle,T),D=T/2*E1(this.paint.get("line-width").evaluate(l,d),this.paint.get("line-gap-width").evaluate(l,d)),O=this.paint.get("line-offset").evaluate(l,d);return O&&(g=function(H,q){const Q=[];for(let ie=0;ie<H.length;ie++){const ce=H[ie],me=[];for(let we=0;we<ce.length;we++){const De=ce[we-1],Me=ce[we],Re=ce[we+1],et=we===0?new E(0,0):Me.sub(De)._unit()._perp(),ot=we===ce.length-1?new E(0,0):Re.sub(Me)._unit()._perp(),Dt=et._add(ot)._unit(),Yt=Dt.x*ot.x+Dt.y*ot.y;Yt!==0&&Dt._mult(1/Yt),me.push(Dt._mult(q)._add(Me))}Q.push(me)}return Q}(g,O*T)),function(H,q,Q){for(let ie=0;ie<q.length;ie++){const ce=q[ie];if(H.length>=3){for(let me=0;me<ce.length;me++)if(tu(H,ce[me]))return!0}if(Bp(H,ce,Q))return!0}return!1}(P,g,D)}isTileClipped(){return!0}}function E1(a,r){return r>0?r+2*a:a}const gC=wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),_C=wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const yC=wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const A1=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),vC=wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function xC(a,r,l){return a.sections.forEach(d=>{d.text=function(g,x,b){const T=x.layout.get("text-transform").evaluate(b,{});return T==="uppercase"?g=g.toLocaleUpperCase():T==="lowercase"&&(g=g.toLocaleLowerCase()),Da.applyArabicShaping&&(g=Da.applyArabicShaping(g)),g}(d.text,r,l)}),a}wi([{name:"triangle",components:3,type:"Uint16"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),wi([{type:"Float32",name:"offsetX"}]),wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Rd={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var zi=24,C1=$n,P1=function(a,r,l,d,g){var x,b,T=8*g-d-1,P=(1<<T)-1,D=P>>1,O=-7,H=l?g-1:0,q=l?-1:1,Q=a[r+H];for(H+=q,x=Q&(1<<-O)-1,Q>>=-O,O+=T;O>0;x=256*x+a[r+H],H+=q,O-=8);for(b=x&(1<<-O)-1,x>>=-O,O+=d;O>0;b=256*b+a[r+H],H+=q,O-=8);if(x===0)x=1-D;else{if(x===P)return b?NaN:1/0*(Q?-1:1);b+=Math.pow(2,d),x-=D}return(Q?-1:1)*b*Math.pow(2,x-d)},R1=function(a,r,l,d,g,x){var b,T,P,D=8*x-g-1,O=(1<<D)-1,H=O>>1,q=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,Q=d?0:x-1,ie=d?1:-1,ce=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(T=isNaN(r)?1:0,b=O):(b=Math.floor(Math.log(r)/Math.LN2),r*(P=Math.pow(2,-b))<1&&(b--,P*=2),(r+=b+H>=1?q/P:q*Math.pow(2,1-H))*P>=2&&(b++,P/=2),b+H>=O?(T=0,b=O):b+H>=1?(T=(r*P-1)*Math.pow(2,g),b+=H):(T=r*Math.pow(2,H-1)*Math.pow(2,g),b=0));g>=8;a[l+Q]=255&T,Q+=ie,T/=256,g-=8);for(b=b<<g|T,D+=g;D>0;a[l+Q]=255&b,Q+=ie,b/=256,D-=8);a[l+Q-ie]|=128*ce};function $n(a){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(a)?a:new Uint8Array(a||0),this.pos=0,this.type=0,this.length=this.buf.length}$n.Varint=0,$n.Fixed64=1,$n.Bytes=2,$n.Fixed32=5;var q_=4294967296,I1=1/q_,L1=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Va(a){return a.type===$n.Bytes?a.readVarint()+a.pos:a.pos+1}function su(a,r,l){return l?4294967296*r+(a>>>0):4294967296*(r>>>0)+(a>>>0)}function D1(a,r,l){var d=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));l.realloc(d);for(var g=l.pos-1;g>=a;g--)l.buf[g+d]=l.buf[g]}function bC(a,r){for(var l=0;l<a.length;l++)r.writeVarint(a[l])}function wC(a,r){for(var l=0;l<a.length;l++)r.writeSVarint(a[l])}function SC(a,r){for(var l=0;l<a.length;l++)r.writeFloat(a[l])}function MC(a,r){for(var l=0;l<a.length;l++)r.writeDouble(a[l])}function TC(a,r){for(var l=0;l<a.length;l++)r.writeBoolean(a[l])}function EC(a,r){for(var l=0;l<a.length;l++)r.writeFixed32(a[l])}function AC(a,r){for(var l=0;l<a.length;l++)r.writeSFixed32(a[l])}function CC(a,r){for(var l=0;l<a.length;l++)r.writeFixed64(a[l])}function PC(a,r){for(var l=0;l<a.length;l++)r.writeSFixed64(a[l])}function Yp(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+16777216*a[r+3]}function au(a,r,l){a[l]=r,a[l+1]=r>>>8,a[l+2]=r>>>16,a[l+3]=r>>>24}function z1(a,r){return(a[r]|a[r+1]<<8|a[r+2]<<16)+(a[r+3]<<24)}$n.prototype={destroy:function(){this.buf=null},readFields:function(a,r,l){for(l=l||this.length;this.pos<l;){var d=this.readVarint(),g=d>>3,x=this.pos;this.type=7&d,a(g,r,this),this.pos===x&&this.skip(d)}return r},readMessage:function(a,r){return this.readFields(a,r,this.readVarint()+this.pos)},readFixed32:function(){var a=Yp(this.buf,this.pos);return this.pos+=4,a},readSFixed32:function(){var a=z1(this.buf,this.pos);return this.pos+=4,a},readFixed64:function(){var a=Yp(this.buf,this.pos)+Yp(this.buf,this.pos+4)*q_;return this.pos+=8,a},readSFixed64:function(){var a=Yp(this.buf,this.pos)+z1(this.buf,this.pos+4)*q_;return this.pos+=8,a},readFloat:function(){var a=P1(this.buf,this.pos,!0,23,4);return this.pos+=4,a},readDouble:function(){var a=P1(this.buf,this.pos,!0,52,8);return this.pos+=8,a},readVarint:function(a){var r,l,d=this.buf;return r=127&(l=d[this.pos++]),l<128?r:(r|=(127&(l=d[this.pos++]))<<7,l<128?r:(r|=(127&(l=d[this.pos++]))<<14,l<128?r:(r|=(127&(l=d[this.pos++]))<<21,l<128?r:function(g,x,b){var T,P,D=b.buf;if(T=(112&(P=D[b.pos++]))>>4,P<128||(T|=(127&(P=D[b.pos++]))<<3,P<128)||(T|=(127&(P=D[b.pos++]))<<10,P<128)||(T|=(127&(P=D[b.pos++]))<<17,P<128)||(T|=(127&(P=D[b.pos++]))<<24,P<128)||(T|=(1&(P=D[b.pos++]))<<31,P<128))return su(g,T,x);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(l=d[this.pos]))<<28,a,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var a=this.readVarint();return a%2==1?(a+1)/-2:a/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var a=this.readVarint()+this.pos,r=this.pos;return this.pos=a,a-r>=12&&L1?function(l,d,g){return L1.decode(l.subarray(d,g))}(this.buf,r,a):function(l,d,g){for(var x="",b=d;b<g;){var T,P,D,O=l[b],H=null,q=O>239?4:O>223?3:O>191?2:1;if(b+q>g)break;q===1?O<128&&(H=O):q===2?(192&(T=l[b+1]))==128&&(H=(31&O)<<6|63&T)<=127&&(H=null):q===3?(P=l[b+2],(192&(T=l[b+1]))==128&&(192&P)==128&&((H=(15&O)<<12|(63&T)<<6|63&P)<=2047||H>=55296&&H<=57343)&&(H=null)):q===4&&(P=l[b+2],D=l[b+3],(192&(T=l[b+1]))==128&&(192&P)==128&&(192&D)==128&&((H=(15&O)<<18|(63&T)<<12|(63&P)<<6|63&D)<=65535||H>=1114112)&&(H=null)),H===null?(H=65533,q=1):H>65535&&(H-=65536,x+=String.fromCharCode(H>>>10&1023|55296),H=56320|1023&H),x+=String.fromCharCode(H),b+=q}return x}(this.buf,r,a)},readBytes:function(){var a=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,a);return this.pos=a,r},readPackedVarint:function(a,r){if(this.type!==$n.Bytes)return a.push(this.readVarint(r));var l=Va(this);for(a=a||[];this.pos<l;)a.push(this.readVarint(r));return a},readPackedSVarint:function(a){if(this.type!==$n.Bytes)return a.push(this.readSVarint());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readSVarint());return a},readPackedBoolean:function(a){if(this.type!==$n.Bytes)return a.push(this.readBoolean());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readBoolean());return a},readPackedFloat:function(a){if(this.type!==$n.Bytes)return a.push(this.readFloat());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readFloat());return a},readPackedDouble:function(a){if(this.type!==$n.Bytes)return a.push(this.readDouble());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readDouble());return a},readPackedFixed32:function(a){if(this.type!==$n.Bytes)return a.push(this.readFixed32());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readFixed32());return a},readPackedSFixed32:function(a){if(this.type!==$n.Bytes)return a.push(this.readSFixed32());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed32());return a},readPackedFixed64:function(a){if(this.type!==$n.Bytes)return a.push(this.readFixed64());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readFixed64());return a},readPackedSFixed64:function(a){if(this.type!==$n.Bytes)return a.push(this.readSFixed64());var r=Va(this);for(a=a||[];this.pos<r;)a.push(this.readSFixed64());return a},skip:function(a){var r=7&a;if(r===$n.Varint)for(;this.buf[this.pos++]>127;);else if(r===$n.Bytes)this.pos=this.readVarint()+this.pos;else if(r===$n.Fixed32)this.pos+=4;else{if(r!==$n.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(a,r){this.writeVarint(a<<3|r)},realloc:function(a){for(var r=this.length||16;r<this.pos+a;)r*=2;if(r!==this.length){var l=new Uint8Array(r);l.set(this.buf),this.buf=l,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(a){this.realloc(4),au(this.buf,a,this.pos),this.pos+=4},writeSFixed32:function(a){this.realloc(4),au(this.buf,a,this.pos),this.pos+=4},writeFixed64:function(a){this.realloc(8),au(this.buf,-1&a,this.pos),au(this.buf,Math.floor(a*I1),this.pos+4),this.pos+=8},writeSFixed64:function(a){this.realloc(8),au(this.buf,-1&a,this.pos),au(this.buf,Math.floor(a*I1),this.pos+4),this.pos+=8},writeVarint:function(a){(a=+a||0)>268435455||a<0?function(r,l){var d,g;if(r>=0?(d=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(d=~(-r%4294967296))?d=d+1|0:(d=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");l.realloc(10),function(x,b,T){T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,x>>>=7,T.buf[T.pos++]=127&x|128,T.buf[T.pos]=127&(x>>>=7)}(d,0,l),function(x,b){var T=(7&x)<<4;b.buf[b.pos++]|=T|((x>>>=3)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x|((x>>>=7)?128:0),x&&(b.buf[b.pos++]=127&x)))))}(g,l)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))},writeSVarint:function(a){this.writeVarint(a<0?2*-a-1:2*a)},writeBoolean:function(a){this.writeVarint(!!a)},writeString:function(a){a=String(a),this.realloc(4*a.length),this.pos++;var r=this.pos;this.pos=function(d,g,x){for(var b,T,P=0;P<g.length;P++){if((b=g.charCodeAt(P))>55295&&b<57344){if(!T){b>56319||P+1===g.length?(d[x++]=239,d[x++]=191,d[x++]=189):T=b;continue}if(b<56320){d[x++]=239,d[x++]=191,d[x++]=189,T=b;continue}b=T-55296<<10|b-56320|65536,T=null}else T&&(d[x++]=239,d[x++]=191,d[x++]=189,T=null);b<128?d[x++]=b:(b<2048?d[x++]=b>>6|192:(b<65536?d[x++]=b>>12|224:(d[x++]=b>>18|240,d[x++]=b>>12&63|128),d[x++]=b>>6&63|128),d[x++]=63&b|128)}return x}(this.buf,a,this.pos);var l=this.pos-r;l>=128&&D1(r,l,this),this.pos=r-1,this.writeVarint(l),this.pos+=l},writeFloat:function(a){this.realloc(4),R1(this.buf,a,this.pos,!0,23,4),this.pos+=4},writeDouble:function(a){this.realloc(8),R1(this.buf,a,this.pos,!0,52,8),this.pos+=8},writeBytes:function(a){var r=a.length;this.writeVarint(r),this.realloc(r);for(var l=0;l<r;l++)this.buf[this.pos++]=a[l]},writeRawMessage:function(a,r){this.pos++;var l=this.pos;a(r,this);var d=this.pos-l;d>=128&&D1(l,d,this),this.pos=l-1,this.writeVarint(d),this.pos+=d},writeMessage:function(a,r,l){this.writeTag(a,$n.Bytes),this.writeRawMessage(r,l)},writePackedVarint:function(a,r){r.length&&this.writeMessage(a,bC,r)},writePackedSVarint:function(a,r){r.length&&this.writeMessage(a,wC,r)},writePackedBoolean:function(a,r){r.length&&this.writeMessage(a,TC,r)},writePackedFloat:function(a,r){r.length&&this.writeMessage(a,SC,r)},writePackedDouble:function(a,r){r.length&&this.writeMessage(a,MC,r)},writePackedFixed32:function(a,r){r.length&&this.writeMessage(a,EC,r)},writePackedSFixed32:function(a,r){r.length&&this.writeMessage(a,AC,r)},writePackedFixed64:function(a,r){r.length&&this.writeMessage(a,CC,r)},writePackedSFixed64:function(a,r){r.length&&this.writeMessage(a,PC,r)},writeBytesField:function(a,r){this.writeTag(a,$n.Bytes),this.writeBytes(r)},writeFixed32Field:function(a,r){this.writeTag(a,$n.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(a,r){this.writeTag(a,$n.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(a,r){this.writeTag(a,$n.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(a,r){this.writeTag(a,$n.Fixed64),this.writeSFixed64(r)},writeVarintField:function(a,r){this.writeTag(a,$n.Varint),this.writeVarint(r)},writeSVarintField:function(a,r){this.writeTag(a,$n.Varint),this.writeSVarint(r)},writeStringField:function(a,r){this.writeTag(a,$n.Bytes),this.writeString(r)},writeFloatField:function(a,r){this.writeTag(a,$n.Fixed32),this.writeFloat(r)},writeDoubleField:function(a,r){this.writeTag(a,$n.Fixed64),this.writeDouble(r)},writeBooleanField:function(a,r){this.writeVarintField(a,!!r)}};var Z_=v(C1);const Y_=3;function RC(a,r,l){a===1&&l.readMessage(IC,r)}function IC(a,r,l){if(a===3){const{id:d,bitmap:g,width:x,height:b,left:T,top:P,advance:D}=l.readMessage(LC,{});r.push({id:d,bitmap:new Sd({width:x+2*Y_,height:b+2*Y_},g),metrics:{width:x,height:b,left:T,top:P,advance:D}})}}function LC(a,r,l){a===1?r.id=l.readVarint():a===2?r.bitmap=l.readBytes():a===3?r.width=l.readVarint():a===4?r.height=l.readVarint():a===5?r.left=l.readSVarint():a===6?r.top=l.readSVarint():a===7&&(r.advance=l.readVarint())}const k1=Y_;function F1(a){let r=0,l=0;for(const b of a)r+=b.w*b.h,l=Math.max(l,b.w);a.sort((b,T)=>T.h-b.h);const d=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),l),h:1/0}];let g=0,x=0;for(const b of a)for(let T=d.length-1;T>=0;T--){const P=d[T];if(!(b.w>P.w||b.h>P.h)){if(b.x=P.x,b.y=P.y,x=Math.max(x,b.y+b.h),g=Math.max(g,b.x+b.w),b.w===P.w&&b.h===P.h){const D=d.pop();T<d.length&&(d[T]=D)}else b.h===P.h?(P.x+=b.w,P.w-=b.w):b.w===P.w?(P.y+=b.h,P.h-=b.h):(d.push({x:P.x+b.w,y:P.y,w:P.w-b.w,h:b.h}),P.y+=b.h,P.h-=b.h);break}}return{w:g,h:x,fill:r/(g*x)||0}}const Fr=1;class K_{constructor(r,{pixelRatio:l,version:d,stretchX:g,stretchY:x,content:b}){this.paddedRect=r,this.pixelRatio=l,this.stretchX=g,this.stretchY=x,this.content=b,this.version=d}get tl(){return[this.paddedRect.x+Fr,this.paddedRect.y+Fr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Fr,this.paddedRect.y+this.paddedRect.h-Fr]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*Fr)/this.pixelRatio,(this.paddedRect.h-2*Fr)/this.pixelRatio]}}class U1{constructor(r,l){const d={},g={};this.haveRenderCallbacks=[];const x=[];this.addImages(r,d,x),this.addImages(l,g,x);const{w:b,h:T}=F1(x),P=new os({width:b||1,height:T||1});for(const D in r){const O=r[D],H=d[D].paddedRect;os.copy(O.data,P,{x:0,y:0},{x:H.x+Fr,y:H.y+Fr},O.data)}for(const D in l){const O=l[D],H=g[D].paddedRect,q=H.x+Fr,Q=H.y+Fr,ie=O.data.width,ce=O.data.height;os.copy(O.data,P,{x:0,y:0},{x:q,y:Q},O.data),os.copy(O.data,P,{x:0,y:ce-1},{x:q,y:Q-1},{width:ie,height:1}),os.copy(O.data,P,{x:0,y:0},{x:q,y:Q+ce},{width:ie,height:1}),os.copy(O.data,P,{x:ie-1,y:0},{x:q-1,y:Q},{width:1,height:ce}),os.copy(O.data,P,{x:0,y:0},{x:q+ie,y:Q},{width:1,height:ce})}this.image=P,this.iconPositions=d,this.patternPositions=g}addImages(r,l,d){for(const g in r){const x=r[g],b={x:0,y:0,w:x.data.width+2*Fr,h:x.data.height+2*Fr};d.push(b),l[g]=new K_(b,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,l){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const d in r.updatedImages)this.patchUpdatedImage(this.iconPositions[d],r.getImage(d),l),this.patchUpdatedImage(this.patternPositions[d],r.getImage(d),l)}patchUpdatedImage(r,l,d){if(!r||!l||r.version===l.version)return;r.version=l.version;const[g,x]=r.tl;d.update(l.data,void 0,{x:g,y:x})}}var Uo;Vt("ImagePosition",K_),Vt("ImageAtlas",U1),f.ah=void 0,(Uo=f.ah||(f.ah={}))[Uo.none=0]="none",Uo[Uo.horizontal=1]="horizontal",Uo[Uo.vertical=2]="vertical",Uo[Uo.horizontalOnly=3]="horizontalOnly";const Id=-17;class Ld{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,l){const d=new Ld;return d.scale=r||1,d.fontStack=l,d}static forImage(r){const l=new Ld;return l.imageName=r,l}}class ou{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,l){const d=new ou;for(let g=0;g<r.sections.length;g++){const x=r.sections[g];x.image?d.addImageSection(x):d.addTextSection(x,l)}return d}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let l="";for(let d=0;d<r.length;d++){const g=r.charCodeAt(d+1)||null,x=r.charCodeAt(d-1)||null;l+=g&&nd(g)&&!Rd[r[d+1]]||x&&nd(x)&&!Rd[r[d-1]]||!Rd[r[d]]?r[d]:Rd[r[d]]}return l}(this.text)}trim(){let r=0;for(let d=0;d<this.text.length&&Jp[this.text.charCodeAt(d)];d++)r++;let l=this.text.length;for(let d=this.text.length-1;d>=0&&d>=r&&Jp[this.text.charCodeAt(d)];d--)l--;this.text=this.text.substring(r,l),this.sectionIndex=this.sectionIndex.slice(r,l)}substring(r,l){const d=new ou;return d.text=this.text.substring(r,l),d.sectionIndex=this.sectionIndex.slice(r,l),d.sections=this.sections,d}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,l)=>Math.max(r,this.sections[l].scale),0)}addTextSection(r,l){this.text+=r.text,this.sections.push(Ld.forText(r.scale,r.fontStack||l));const d=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(d)}addImageSection(r){const l=r.image?r.image.name:"";if(l.length===0)return void Te("Can't add FormattedSection with an empty image.");const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCharCode(d),this.sections.push(Ld.forImage(l)),this.sectionIndex.push(this.sections.length-1)):Te("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Kp(a,r,l,d,g,x,b,T,P,D,O,H,q,Q,ie,ce){const me=ou.fromFeature(a,g);let we;H===f.ah.vertical&&me.verticalizePunctuation();const{processBidirectionalText:De,processStyledBidirectionalText:Me}=Da;if(De&&me.sections.length===1){we=[];const ot=De(me.toString(),J_(me,D,x,r,d,Q,ie));for(const Dt of ot){const Yt=new ou;Yt.text=Dt,Yt.sections=me.sections;for(let It=0;It<Dt.length;It++)Yt.sectionIndex.push(0);we.push(Yt)}}else if(Me){we=[];const ot=Me(me.text,me.sectionIndex,J_(me,D,x,r,d,Q,ie));for(const Dt of ot){const Yt=new ou;Yt.text=Dt[0],Yt.sectionIndex=Dt[1],Yt.sections=me.sections,we.push(Yt)}}else we=function(ot,Dt){const Yt=[],It=ot.text;let Pt=0;for(const xt of Dt)Yt.push(ot.substring(Pt,xt)),Pt=xt;return Pt<It.length&&Yt.push(ot.substring(Pt,It.length)),Yt}(me,J_(me,D,x,r,d,Q,ie));const Re=[],et={positionedLines:Re,text:me.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:H,iconsInText:!1,verticalizable:!1};return function(ot,Dt,Yt,It,Pt,xt,Xt,At,gt,tn,Jt,Tn){let ii=0,li=Id,ki=0,Kr=0;const xr=At==="right"?1:At==="left"?0:.5;let Pi=0;for(const Fi of Pt){Fi.trim();const Ui=Fi.getMaxScale(),or=(Ui-1)*zi,Sr={positionedGlyphs:[],lineOffset:0};ot.positionedLines[Pi]=Sr;const lr=Sr.positionedGlyphs;let Ur=0;if(!Fi.length()){li+=xt,++Pi;continue}for(let Ni=0;Ni<Fi.length();Ni++){const In=Fi.getSection(Ni),cr=Fi.getSectionIndex(Ni),nr=Fi.getCharCode(Ni);let Oi=0,As=null,js=null,Ws=null,Ga=zi;const Cs=!(gt===f.ah.horizontal||!Jt&&!$c(nr)||Jt&&(Jp[nr]||(Xi=nr,zt.Arabic(Xi)||zt["Arabic Supplement"](Xi)||zt["Arabic Extended-A"](Xi)||zt["Arabic Presentation Forms-A"](Xi)||zt["Arabic Presentation Forms-B"](Xi))));if(In.imageName){const cs=It[In.imageName];if(!cs)continue;Ws=In.imageName,ot.iconsInText=ot.iconsInText||!0,js=cs.paddedRect;const Or=cs.displaySize;In.scale=In.scale*zi/Tn,As={width:Or[0],height:Or[1],left:Fr,top:-k1,advance:Cs?Or[1]:Or[0]},Oi=or+(zi-Or[1]*In.scale),Ga=As.advance;const Ha=Cs?Or[0]*In.scale-zi*Ui:Or[1]*In.scale-zi*Ui;Ha>0&&Ha>Ur&&(Ur=Ha)}else{const cs=Yt[In.fontStack],Or=cs&&cs[nr];if(Or&&Or.rect)js=Or.rect,As=Or.metrics;else{const Ha=Dt[In.fontStack],Ud=Ha&&Ha[nr];if(!Ud)continue;As=Ud.metrics}Oi=(Ui-In.scale)*zi}Cs?(ot.verticalizable=!0,lr.push({glyph:nr,imageName:Ws,x:ii,y:li+Oi,vertical:Cs,scale:In.scale,fontStack:In.fontStack,sectionIndex:cr,metrics:As,rect:js}),ii+=Ga*In.scale+tn):(lr.push({glyph:nr,imageName:Ws,x:ii,y:li+Oi,vertical:Cs,scale:In.scale,fontStack:In.fontStack,sectionIndex:cr,metrics:As,rect:js}),ii+=As.advance*In.scale+tn)}lr.length!==0&&(ki=Math.max(ii-tn,ki),kC(lr,0,lr.length-1,xr,Ur)),ii=0;const Nr=xt*Ui+Ur;Sr.lineOffset=Math.max(Ur,or),li+=Nr,Kr=Math.max(Nr,Kr),++Pi}var Xi;const tr=li-Id,{horizontalAlign:br,verticalAlign:wr}=Q_(Xt);(function(Fi,Ui,or,Sr,lr,Ur,Nr,Ni,In){const cr=(Ui-or)*lr;let nr=0;nr=Ur!==Nr?-Ni*Sr-Id:(-Sr*In+.5)*Nr;for(const Oi of Fi)for(const As of Oi.positionedGlyphs)As.x+=cr,As.y+=nr})(ot.positionedLines,xr,br,wr,ki,Kr,xt,tr,Pt.length),ot.top+=-wr*tr,ot.bottom=ot.top+tr,ot.left+=-br*ki,ot.right=ot.left+ki}(et,r,l,d,we,b,T,P,H,D,q,ce),!function(ot){for(const Dt of ot)if(Dt.positionedGlyphs.length!==0)return!1;return!0}(Re)&&et}const Jp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},DC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function N1(a,r,l,d,g,x){if(r.imageName){const b=d[r.imageName];return b?b.displaySize[0]*r.scale*zi/x+g:0}{const b=l[r.fontStack],T=b&&b[a];return T?T.metrics.advance*r.scale+g:0}}function O1(a,r,l,d){const g=Math.pow(a-r,2);return d?a<r?g/2:2*g:g+Math.abs(l)*l}function zC(a,r,l){let d=0;return a===10&&(d-=1e4),l&&(d+=150),a!==40&&a!==65288||(d+=50),r!==41&&r!==65289||(d+=50),d}function B1(a,r,l,d,g,x){let b=null,T=O1(r,l,g,x);for(const P of d){const D=O1(r-P.x,l,g,x)+P.badness;D<=T&&(b=P,T=D)}return{index:a,x:r,priorBreak:b,badness:T}}function V1(a){return a?V1(a.priorBreak).concat(a.index):[]}function J_(a,r,l,d,g,x,b){if(x!=="point")return[];if(!a)return[];const T=[],P=function(q,Q,ie,ce,me,we){let De=0;for(let Me=0;Me<q.length();Me++){const Re=q.getSection(Me);De+=N1(q.getCharCode(Me),Re,ce,me,Q,we)}return De/Math.max(1,Math.ceil(De/ie))}(a,r,l,d,g,b),D=a.text.indexOf("​")>=0;let O=0;for(let q=0;q<a.length();q++){const Q=a.getSection(q),ie=a.getCharCode(q);if(Jp[ie]||(O+=N1(ie,Q,d,g,r,b)),q<a.length()-1){const ce=!((H=ie)<11904||!(zt["Bopomofo Extended"](H)||zt.Bopomofo(H)||zt["CJK Compatibility Forms"](H)||zt["CJK Compatibility Ideographs"](H)||zt["CJK Compatibility"](H)||zt["CJK Radicals Supplement"](H)||zt["CJK Strokes"](H)||zt["CJK Symbols and Punctuation"](H)||zt["CJK Unified Ideographs Extension A"](H)||zt["CJK Unified Ideographs"](H)||zt["Enclosed CJK Letters and Months"](H)||zt["Halfwidth and Fullwidth Forms"](H)||zt.Hiragana(H)||zt["Ideographic Description Characters"](H)||zt["Kangxi Radicals"](H)||zt["Katakana Phonetic Extensions"](H)||zt.Katakana(H)||zt["Vertical Forms"](H)||zt["Yi Radicals"](H)||zt["Yi Syllables"](H)));(DC[ie]||ce||Q.imageName)&&T.push(B1(q+1,O,P,T,zC(ie,a.getCharCode(q+1),ce&&D),!1))}}var H;return V1(B1(a.length(),O,P,T,0,!0))}function Q_(a){let r=.5,l=.5;switch(a){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":l=1;break;case"top":case"top-right":case"top-left":l=0}return{horizontalAlign:r,verticalAlign:l}}function kC(a,r,l,d,g){if(!d&&!g)return;const x=a[l],b=(a[l].x+x.metrics.advance*x.scale)*d;for(let T=r;T<=l;T++)a[T].x-=b,a[T].y+=g}function FC(a,r,l){const{horizontalAlign:d,verticalAlign:g}=Q_(l),x=r[0]-a.displaySize[0]*d,b=r[1]-a.displaySize[1]*g;return{image:a,top:b,bottom:b+a.displaySize[1],left:x,right:x+a.displaySize[0]}}function G1(a,r,l,d,g,x){const b=a.image;let T;if(b.content){const me=b.content,we=b.pixelRatio||1;T=[me[0]/we,me[1]/we,b.displaySize[0]-me[2]/we,b.displaySize[1]-me[3]/we]}const P=r.left*x,D=r.right*x;let O,H,q,Q;l==="width"||l==="both"?(Q=g[0]+P-d[3],H=g[0]+D+d[1]):(Q=g[0]+(P+D-b.displaySize[0])/2,H=Q+b.displaySize[0]);const ie=r.top*x,ce=r.bottom*x;return l==="height"||l==="both"?(O=g[1]+ie-d[0],q=g[1]+ce+d[2]):(O=g[1]+(ie+ce-b.displaySize[1])/2,q=O+b.displaySize[1]),{image:b,top:O,right:H,bottom:q,left:Q,collisionPadding:T}}const Dd=255,pa=128,No=Dd*pa;function H1(a,r){const{expression:l}=r;if(l.kind==="constant")return{kind:"constant",layoutSize:l.evaluate(new ti(a+1))};if(l.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:g}=l;let x=0;for(;x<d.length&&d[x]<=a;)x++;x=Math.max(0,x-1);let b=x;for(;b<d.length&&d[b]<a+1;)b++;b=Math.min(d.length-1,b);const T=d[x],P=d[b];return l.kind==="composite"?{kind:"composite",minZoom:T,maxZoom:P,interpolationType:g}:{kind:"camera",minZoom:T,maxZoom:P,minSize:l.evaluate(new ti(T)),maxSize:l.evaluate(new ti(P)),interpolationType:g}}}function ey(a,r,l){let d="never";const g=a.get(r);return g?d=g:a.get(l)&&(d="always"),d}const UC=Fo.VectorTileFeature.types,NC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Qp(a,r,l,d,g,x,b,T,P,D,O,H,q){const Q=T?Math.min(No,Math.round(T[0])):0,ie=T?Math.min(No,Math.round(T[1])):0;a.emplaceBack(r,l,Math.round(32*d),Math.round(32*g),x,b,(Q<<1)+(P?1:0),ie,16*D,16*O,256*H,256*q)}function ty(a,r,l){a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l),a.emplaceBack(r.x,r.y,l)}function OC(a){for(const r of a.sections)if(Lp(r.text))return!0;return!1}class ny{constructor(r){this.layoutVertexArray=new Ae,this.indexArray=new We,this.programConfigurations=r,this.segments=new ht,this.dynamicLayoutVertexArray=new Oe,this.opacityVertexArray=new ve,this.hasVisibleVertices=!1,this.placedSymbolArray=new s}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,l,d,g){this.isEmpty()||(d&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,gC.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,l),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,_C.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,NC,!0),this.opacityVertexBuffer.itemSize=1),(d||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Vt("SymbolBuffers",ny);class iy{constructor(r,l,d){this.layoutVertexArray=new r,this.layoutAttributes=l,this.indexArray=new d,this.segments=new ht,this.collisionVertexArray=new He}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,yC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Vt("CollisionBuffers",iy);class lu{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(b=>b.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=z_([]),this.placementViewportMatrix=z_([]);const l=this.layers[0]._unevaluatedLayout._values;this.textSizeData=H1(this.zoom,l["text-size"]),this.iconSizeData=H1(this.zoom,l["icon-size"]);const d=this.layers[0].layout,g=d.get("symbol-sort-key"),x=d.get("symbol-z-order");this.canOverlap=ey(d,"text-overlap","text-allow-overlap")!=="never"||ey(d,"icon-overlap","icon-allow-overlap")!=="never"||d.get("text-ignore-placement")||d.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,d.get("symbol-placement")==="point"&&(this.writingModes=d.get("text-writing-mode").map(b=>f.ah[b])),this.stateDependentLayerIds=this.layers.filter(b=>b.isStateDependent()).map(b=>b.id),this.sourceID=r.sourceID}createArrays(){this.text=new ny(new oi(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new ny(new oi(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new m,this.lineVertexArray=new y,this.symbolInstances=new p,this.textAnchorOffsets=new C}calculateGlyphDependencies(r,l,d,g,x){for(let b=0;b<r.length;b++)if(l[r.charCodeAt(b)]=!0,(d||g)&&x){const T=Rd[r.charAt(b)];T&&(l[T.charCodeAt(0)]=!0)}}populate(r,l,d){const g=this.layers[0],x=g.layout,b=x.get("text-font"),T=x.get("text-field"),P=x.get("icon-image"),D=(T.value.kind!=="constant"||T.value.value instanceof Yn&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),O=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,H=x.get("symbol-sort-key");if(this.features=[],!D&&!O)return;const q=l.iconDependencies,Q=l.glyphDependencies,ie=l.availableImages,ce=new ti(this.zoom);for(const{feature:me,id:we,index:De,sourceLayerIndex:Me}of r){const Re=g._featureFilter.needGeometry,et=Oa(me,Re);if(!g._featureFilter.filter(ce,et,d))continue;let ot,Dt;if(Re||(et.geometry=Na(me)),D){const It=g.getValueAndResolveTokens("text-field",et,d,ie),Pt=Yn.factory(It),xt=this.hasRTLText=this.hasRTLText||OC(Pt);(!xt||Da.getRTLTextPluginStatus()==="unavailable"||xt&&Da.isParsed())&&(ot=xC(Pt,g,et))}if(O){const It=g.getValueAndResolveTokens("icon-image",et,d,ie);Dt=It instanceof fn?It:fn.fromString(It)}if(!ot&&!Dt)continue;const Yt=this.sortFeaturesByKey?H.evaluate(et,{},d):void 0;if(this.features.push({id:we,text:ot,icon:Dt,index:De,sourceLayerIndex:Me,geometry:et.geometry,properties:me.properties,type:UC[me.type],sortKey:Yt}),Dt&&(q[Dt.name]=!0),ot){const It=b.evaluate(et,{},d).join(","),Pt=x.get("text-rotation-alignment")!=="viewport"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(f.ah.vertical)>=0;for(const xt of ot.sections)if(xt.image)q[xt.image.name]=!0;else{const Xt=Nl(ot.toString()),At=xt.fontStack||It,gt=Q[At]=Q[At]||{};this.calculateGlyphDependencies(xt.text,gt,Pt,this.allowVerticalPlacement,Xt)}}}x.get("symbol-placement")==="line"&&(this.features=function(me){const we={},De={},Me=[];let Re=0;function et(It){Me.push(me[It]),Re++}function ot(It,Pt,xt){const Xt=De[It];return delete De[It],De[Pt]=Xt,Me[Xt].geometry[0].pop(),Me[Xt].geometry[0]=Me[Xt].geometry[0].concat(xt[0]),Xt}function Dt(It,Pt,xt){const Xt=we[Pt];return delete we[Pt],we[It]=Xt,Me[Xt].geometry[0].shift(),Me[Xt].geometry[0]=xt[0].concat(Me[Xt].geometry[0]),Xt}function Yt(It,Pt,xt){const Xt=xt?Pt[0][Pt[0].length-1]:Pt[0][0];return`${It}:${Xt.x}:${Xt.y}`}for(let It=0;It<me.length;It++){const Pt=me[It],xt=Pt.geometry,Xt=Pt.text?Pt.text.toString():null;if(!Xt){et(It);continue}const At=Yt(Xt,xt),gt=Yt(Xt,xt,!0);if(At in De&&gt in we&&De[At]!==we[gt]){const tn=Dt(At,gt,xt),Jt=ot(At,gt,Me[tn].geometry);delete we[At],delete De[gt],De[Yt(Xt,Me[Jt].geometry,!0)]=Jt,Me[tn].geometry=null}else At in De?ot(At,gt,xt):gt in we?Dt(At,gt,xt):(et(It),we[At]=Re-1,De[gt]=Re-1)}return Me.filter(It=>It.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((me,we)=>me.sortKey-we.sortKey)}update(r,l,d){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,l,this.layers,d),this.icon.programConfigurations.updatePaintArrays(r,l,this.layers,d))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,l){const d=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(l[r.segment+1]),x=r.dist(l[r.segment]);const b={};for(let T=r.segment+1;T<l.length;T++)b[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:g},T<l.length-1&&(g+=l[T+1].dist(l[T]));for(let T=r.segment||0;T>=0;T--)b[T]={x:l[T].x,y:l[T].y,tileUnitDistanceFromAnchor:x},T>0&&(x+=l[T-1].dist(l[T]));for(let T=0;T<l.length;T++){const P=b[T];this.lineVertexArray.emplaceBack(P.x,P.y,P.tileUnitDistanceFromAnchor)}}return{lineStartIndex:d,lineLength:this.lineVertexArray.length-d}}addSymbols(r,l,d,g,x,b,T,P,D,O,H,q){const Q=r.indexArray,ie=r.layoutVertexArray,ce=r.segments.prepareSegment(4*l.length,ie,Q,this.canOverlap?b.sortKey:void 0),me=this.glyphOffsetArray.length,we=ce.vertexLength,De=this.allowVerticalPlacement&&T===f.ah.vertical?Math.PI/2:0,Me=b.text&&b.text.sections;for(let Re=0;Re<l.length;Re++){const{tl:et,tr:ot,bl:Dt,br:Yt,tex:It,pixelOffsetTL:Pt,pixelOffsetBR:xt,minFontScaleX:Xt,minFontScaleY:At,glyphOffset:gt,isSDF:tn,sectionIndex:Jt}=l[Re],Tn=ce.vertexLength,ii=gt[1];Qp(ie,P.x,P.y,et.x,ii+et.y,It.x,It.y,d,tn,Pt.x,Pt.y,Xt,At),Qp(ie,P.x,P.y,ot.x,ii+ot.y,It.x+It.w,It.y,d,tn,xt.x,Pt.y,Xt,At),Qp(ie,P.x,P.y,Dt.x,ii+Dt.y,It.x,It.y+It.h,d,tn,Pt.x,xt.y,Xt,At),Qp(ie,P.x,P.y,Yt.x,ii+Yt.y,It.x+It.w,It.y+It.h,d,tn,xt.x,xt.y,Xt,At),ty(r.dynamicLayoutVertexArray,P,De),Q.emplaceBack(Tn,Tn+1,Tn+2),Q.emplaceBack(Tn+1,Tn+2,Tn+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(gt[0]),Re!==l.length-1&&Jt===l[Re+1].sectionIndex||r.programConfigurations.populatePaintArrays(ie.length,b,b.index,{},q,Me&&Me[Jt])}r.placedSymbolArray.emplaceBack(P.x,P.y,me,this.glyphOffsetArray.length-me,we,D,O,P.segment,d?d[0]:0,d?d[1]:0,g[0],g[1],T,0,!1,0,H)}_addCollisionDebugVertex(r,l,d,g,x,b){return l.emplaceBack(0,0),r.emplaceBack(d.x,d.y,g,x,Math.round(b.x),Math.round(b.y))}addCollisionDebugVertices(r,l,d,g,x,b,T){const P=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),D=P.vertexLength,O=x.layoutVertexArray,H=x.collisionVertexArray,q=T.anchorX,Q=T.anchorY;this._addCollisionDebugVertex(O,H,b,q,Q,new E(r,l)),this._addCollisionDebugVertex(O,H,b,q,Q,new E(d,l)),this._addCollisionDebugVertex(O,H,b,q,Q,new E(d,g)),this._addCollisionDebugVertex(O,H,b,q,Q,new E(r,g)),P.vertexLength+=4;const ie=x.indexArray;ie.emplaceBack(D,D+1),ie.emplaceBack(D+1,D+2),ie.emplaceBack(D+2,D+3),ie.emplaceBack(D+3,D),P.primitiveLength+=4}addDebugCollisionBoxes(r,l,d,g){for(let x=r;x<l;x++){const b=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(b.x1,b.y1,b.x2,b.y2,g?this.textCollisionBox:this.iconCollisionBox,b.anchorPoint,d)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new iy(Ie,A1.members,Qe),this.iconCollisionBox=new iy(Ie,A1.members,Qe);for(let r=0;r<this.symbolInstances.length;r++){const l=this.symbolInstances.get(r);this.addDebugCollisionBoxes(l.textBoxStartIndex,l.textBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l,!0),this.addDebugCollisionBoxes(l.iconBoxStartIndex,l.iconBoxEndIndex,l,!1),this.addDebugCollisionBoxes(l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l,!1)}}_deserializeCollisionBoxesForSymbol(r,l,d,g,x,b,T,P,D){const O={};for(let H=l;H<d;H++){const q=r.get(H);O.textBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.textFeatureIndex=q.featureIndex;break}for(let H=g;H<x;H++){const q=r.get(H);O.verticalTextBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.verticalTextFeatureIndex=q.featureIndex;break}for(let H=b;H<T;H++){const q=r.get(H);O.iconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.iconFeatureIndex=q.featureIndex;break}for(let H=P;H<D;H++){const q=r.get(H);O.verticalIconBox={x1:q.x1,y1:q.y1,x2:q.x2,y2:q.y2,anchorPointX:q.anchorPointX,anchorPointY:q.anchorPointY},O.verticalIconFeatureIndex=q.featureIndex;break}return O}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let l=0;l<this.symbolInstances.length;l++){const d=this.symbolInstances.get(l);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,d.textBoxStartIndex,d.textBoxEndIndex,d.verticalTextBoxStartIndex,d.verticalTextBoxEndIndex,d.iconBoxStartIndex,d.iconBoxEndIndex,d.verticalIconBoxStartIndex,d.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,l){const d=r.placedSymbolArray.get(l),g=d.vertexStartIndex+4*d.numGlyphs;for(let x=d.vertexStartIndex;x<g;x+=4)r.indexArray.emplaceBack(x,x+1,x+2),r.indexArray.emplaceBack(x+1,x+2,x+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const l=Math.sin(r),d=Math.cos(r),g=[],x=[],b=[];for(let T=0;T<this.symbolInstances.length;++T){b.push(T);const P=this.symbolInstances.get(T);g.push(0|Math.round(l*P.anchorX+d*P.anchorY)),x.push(P.featureIndex)}return b.sort((T,P)=>g[T]-g[P]||x[P]-x[T]),b}addToSortKeyRanges(r,l){const d=this.sortKeyRanges[this.sortKeyRanges.length-1];d&&d.sortKey===l?d.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:l,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const l of this.symbolInstanceIndexes){const d=this.symbolInstances.get(l);this.featureSortOrder.push(d.featureIndex),[d.rightJustifiedTextSymbolIndex,d.centerJustifiedTextSymbolIndex,d.leftJustifiedTextSymbolIndex].forEach((g,x,b)=>{g>=0&&b.indexOf(g)===x&&this.addIndicesForPlacedSymbol(this.text,g)}),d.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,d.verticalPlacedTextSymbolIndex),d.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.placedIconSymbolIndex),d.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,d.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let j1,W1;Vt("SymbolBucket",lu,{omit:["layers","collisionBoxArray","features","compareText"]}),lu.MAX_GLYPHS=65535,lu.addDynamicAttributes=ty;var ry={get paint(){return W1=W1||new _r({"icon-opacity":new cn(J.paint_symbol["icon-opacity"]),"icon-color":new cn(J.paint_symbol["icon-color"]),"icon-halo-color":new cn(J.paint_symbol["icon-halo-color"]),"icon-halo-width":new cn(J.paint_symbol["icon-halo-width"]),"icon-halo-blur":new cn(J.paint_symbol["icon-halo-blur"]),"icon-translate":new Qt(J.paint_symbol["icon-translate"]),"icon-translate-anchor":new Qt(J.paint_symbol["icon-translate-anchor"]),"text-opacity":new cn(J.paint_symbol["text-opacity"]),"text-color":new cn(J.paint_symbol["text-color"],{runtimeType:Ot,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new cn(J.paint_symbol["text-halo-color"]),"text-halo-width":new cn(J.paint_symbol["text-halo-width"]),"text-halo-blur":new cn(J.paint_symbol["text-halo-blur"]),"text-translate":new Qt(J.paint_symbol["text-translate"]),"text-translate-anchor":new Qt(J.paint_symbol["text-translate-anchor"])})},get layout(){return j1=j1||new _r({"symbol-placement":new Qt(J.layout_symbol["symbol-placement"]),"symbol-spacing":new Qt(J.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Qt(J.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new cn(J.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Qt(J.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Qt(J.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Qt(J.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Qt(J.layout_symbol["icon-ignore-placement"]),"icon-optional":new Qt(J.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Qt(J.layout_symbol["icon-rotation-alignment"]),"icon-size":new cn(J.layout_symbol["icon-size"]),"icon-text-fit":new Qt(J.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Qt(J.layout_symbol["icon-text-fit-padding"]),"icon-image":new cn(J.layout_symbol["icon-image"]),"icon-rotate":new cn(J.layout_symbol["icon-rotate"]),"icon-padding":new cn(J.layout_symbol["icon-padding"]),"icon-keep-upright":new Qt(J.layout_symbol["icon-keep-upright"]),"icon-offset":new cn(J.layout_symbol["icon-offset"]),"icon-anchor":new cn(J.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Qt(J.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Qt(J.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Qt(J.layout_symbol["text-rotation-alignment"]),"text-field":new cn(J.layout_symbol["text-field"]),"text-font":new cn(J.layout_symbol["text-font"]),"text-size":new cn(J.layout_symbol["text-size"]),"text-max-width":new cn(J.layout_symbol["text-max-width"]),"text-line-height":new Qt(J.layout_symbol["text-line-height"]),"text-letter-spacing":new cn(J.layout_symbol["text-letter-spacing"]),"text-justify":new cn(J.layout_symbol["text-justify"]),"text-radial-offset":new cn(J.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Qt(J.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new cn(J.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new cn(J.layout_symbol["text-anchor"]),"text-max-angle":new Qt(J.layout_symbol["text-max-angle"]),"text-writing-mode":new Qt(J.layout_symbol["text-writing-mode"]),"text-rotate":new cn(J.layout_symbol["text-rotate"]),"text-padding":new Qt(J.layout_symbol["text-padding"]),"text-keep-upright":new Qt(J.layout_symbol["text-keep-upright"]),"text-transform":new cn(J.layout_symbol["text-transform"]),"text-offset":new cn(J.layout_symbol["text-offset"]),"text-allow-overlap":new Qt(J.layout_symbol["text-allow-overlap"]),"text-overlap":new Qt(J.layout_symbol["text-overlap"]),"text-ignore-placement":new Qt(J.layout_symbol["text-ignore-placement"]),"text-optional":new Qt(J.layout_symbol["text-optional"])})}};class $1{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:wn,this.defaultValue=r}evaluate(r){if(r.formattedSection){const l=this.defaultValue.property.overrides;if(l&&l.hasOverride(r.formattedSection))return l.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Vt("FormatSectionOverride",$1,{omit:["defaultValue"]});class em extends rs{constructor(r){super(r,ry)}recalculate(r,l){if(super.recalculate(r,l),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const d=this.layout.get("text-writing-mode");if(d){const g=[];for(const x of d)g.indexOf(x)<0&&g.push(x);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,l,d,g){const x=this.layout.get(r).evaluate(l,{},d,g),b=this._unevaluatedLayout._values[r];return b.isDataDriven()||Kn(b.value)||!x?x:function(T,P){return P.replace(/{([^{}]+)}/g,(D,O)=>T&&O in T?String(T[O]):"")}(l.properties,x)}createBucket(r){return new lu(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of ry.paint.overridableProperties){if(!em.hasPaintOverride(this.layout,r))continue;const l=this.paint.get(r),d=new $1(l),g=new zl(d,l.property.specification);let x=null;x=l.value.kind==="constant"||l.value.kind==="source"?new Mo("source",g):new Oc("composite",g,l.value.zoomStops),this.paint._values[r]=new is(l.property,x,l.parameters)}}_handleOverridablePaintPropertyUpdate(r,l,d){return!(!this.layout||l.isDataDriven()||d.isDataDriven())&&em.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,l){const d=r.get("text-field"),g=ry.paint.properties[l];let x=!1;const b=T=>{for(const P of T)if(g.overrides&&g.overrides.hasOverride(P))return void(x=!0)};if(d.value.kind==="constant"&&d.value.value instanceof Yn)b(d.value.value.sections);else if(d.value.kind==="source"){const T=D=>{x||(D instanceof Lr&&Xn(D.value)===wt?b(D.value.sections):D instanceof Nc?b(D.sections):D.eachChild(T))},P=d.value;P._styleExpression&&T(P._styleExpression.expression)}return x}}let X1;var BC={get paint(){return X1=X1||new _r({"background-color":new Qt(J.paint_background["background-color"]),"background-pattern":new od(J.paint_background["background-pattern"]),"background-opacity":new Qt(J.paint_background["background-opacity"])})}};class VC extends rs{constructor(r){super(r,BC)}}let q1;var GC={get paint(){return q1=q1||new _r({"raster-opacity":new Qt(J.paint_raster["raster-opacity"]),"raster-hue-rotate":new Qt(J.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Qt(J.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Qt(J.paint_raster["raster-brightness-max"]),"raster-saturation":new Qt(J.paint_raster["raster-saturation"]),"raster-contrast":new Qt(J.paint_raster["raster-contrast"]),"raster-resampling":new Qt(J.paint_raster["raster-resampling"]),"raster-fade-duration":new Qt(J.paint_raster["raster-fade-duration"])})}};class HC extends rs{constructor(r){super(r,GC)}}class jC extends rs{constructor(r){super(r,{}),this.onAdd=l=>{this.implementation.onAdd&&this.implementation.onAdd(l,l.painter.context.gl)},this.onRemove=l=>{this.implementation.onRemove&&this.implementation.onRemove(l,l.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class WC{constructor(r){this._methodToThrottle=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const sy=63710088e-1;class Oo{constructor(r,l){if(isNaN(r)||isNaN(l))throw new Error(`Invalid LngLat object: (${r}, ${l})`);if(this.lng=+r,this.lat=+l,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Oo(Z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const l=Math.PI/180,d=this.lat*l,g=r.lat*l,x=Math.sin(d)*Math.sin(g)+Math.cos(d)*Math.cos(g)*Math.cos((r.lng-this.lng)*l);return sy*Math.acos(Math.min(x,1))}static convert(r){if(r instanceof Oo)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Oo(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Oo(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Z1=2*Math.PI*sy;function Y1(a){return Z1*Math.cos(a*Math.PI/180)}function K1(a){return(180+a)/360}function J1(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function Q1(a,r){return a/Y1(r)}function ay(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}class tm{constructor(r,l,d=0){this.x=+r,this.y=+l,this.z=+d}static fromLngLat(r,l=0){const d=Oo.convert(r);return new tm(K1(d.lng),J1(d.lat),Q1(l,d.lat))}toLngLat(){return new Oo(360*this.x-180,ay(this.y))}toAltitude(){return this.z*Y1(ay(this.y))}meterInMercatorCoordinateUnits(){return 1/Z1*(r=ay(this.y),1/Math.cos(r*Math.PI/180));var r}}function eb(a,r,l){var d=2*Math.PI*6378137/256/Math.pow(2,l);return[a*d-2*Math.PI*6378137/2,r*d-2*Math.PI*6378137/2]}class oy{constructor(r,l,d){if(r<0||r>25||d<0||d>=Math.pow(2,r)||l<0||l>=Math.pow(2,r))throw new Error(`x=${l}, y=${d}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=l,this.y=d,this.key=zd(0,r,r,l,d)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,l,d){const g=(b=this.y,T=this.z,P=eb(256*(x=this.x),256*(b=Math.pow(2,T)-b-1),T),D=eb(256*(x+1),256*(b+1),T),P[0]+","+P[1]+","+D[0]+","+D[1]);var x,b,T,P,D;const O=function(H,q,Q){let ie,ce="";for(let me=H;me>0;me--)ie=1<<me-1,ce+=(q&ie?1:0)+(Q&ie?2:0);return ce}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(d==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,l>1?"@2x":"").replace(/{quadkey}/g,O).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const l=this.z-r.z;return l>0&&r.x===this.x>>l&&r.y===this.y>>l}getTilePoint(r){const l=Math.pow(2,this.z);return new E((r.x*l-this.x)*Cn,(r.y*l-this.y)*Cn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class tb{constructor(r,l){this.wrap=r,this.canonical=l,this.key=zd(r,l.z,l.z,l.x,l.y)}}class ls{constructor(r,l,d,g,x){if(r<d)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${d}`);this.overscaledZ=r,this.wrap=l,this.canonical=new oy(d,+g,+x),this.key=zd(l,r,d,g,x)}clone(){return new ls(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const l=this.canonical.z-r;return r>this.canonical.z?new ls(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ls(r,this.wrap,r,this.canonical.x>>l,this.canonical.y>>l)}calculateScaledKey(r,l){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const d=this.canonical.z-r;return r>this.canonical.z?zd(this.wrap*+l,r,this.canonical.z,this.canonical.x,this.canonical.y):zd(this.wrap*+l,r,r,this.canonical.x>>d,this.canonical.y>>d)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const l=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>l&&r.canonical.y===this.canonical.y>>l}children(r){if(this.overscaledZ>=r)return[new ls(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const l=this.canonical.z+1,d=2*this.canonical.x,g=2*this.canonical.y;return[new ls(l,this.wrap,l,d,g),new ls(l,this.wrap,l,d+1,g),new ls(l,this.wrap,l,d,g+1),new ls(l,this.wrap,l,d+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new ls(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new ls(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new tb(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new tm(r.x-this.wrap,r.y))}}function zd(a,r,l,d,g){(a*=2)<0&&(a=-1*a-1);const x=1<<l;return(x*x*a+x*g+d).toString(36)+l.toString(36)+r.toString(36)}Vt("CanonicalTileID",oy),Vt("OverscaledTileID",ls,{omit:["posMatrix"]});class nb{constructor(r,l,d,g=1,x=1,b=1,T=0){if(this.uid=r,l.height!==l.width)throw new RangeError("DEM tiles must be square");if(d&&!["mapbox","terrarium","custom"].includes(d))return void Te(`"${d}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=l.height;const P=this.dim=l.height-2;switch(this.data=new Uint32Array(l.data.buffer),d){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=g,this.greenFactor=x,this.blueFactor=b,this.baseShift=T;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let D=0;D<P;D++)this.data[this._idx(-1,D)]=this.data[this._idx(0,D)],this.data[this._idx(P,D)]=this.data[this._idx(P-1,D)],this.data[this._idx(D,-1)]=this.data[this._idx(D,0)],this.data[this._idx(D,P)]=this.data[this._idx(D,P-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(P,-1)]=this.data[this._idx(P-1,0)],this.data[this._idx(-1,P)]=this.data[this._idx(0,P-1)],this.data[this._idx(P,P)]=this.data[this._idx(P-1,P-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let D=0;D<P;D++)for(let O=0;O<P;O++){const H=this.get(D,O);H>this.max&&(this.max=H),H<this.min&&(this.min=H)}}get(r,l){const d=new Uint8Array(this.data.buffer),g=4*this._idx(r,l);return this.unpack(d[g],d[g+1],d[g+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(r,l){if(r<-1||r>=this.dim+1||l<-1||l>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(l+1)*this.stride+(r+1)}unpack(r,l,d){return r*this.redFactor+l*this.greenFactor+d*this.blueFactor-this.baseShift}getPixels(){return new os({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,l,d){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=l*this.dim,x=l*this.dim+this.dim,b=d*this.dim,T=d*this.dim+this.dim;switch(l){case-1:g=x-1;break;case 1:x=g+1}switch(d){case-1:b=T-1;break;case 1:T=b+1}const P=-l*this.dim,D=-d*this.dim;for(let O=b;O<T;O++)for(let H=g;H<x;H++)this.data[this._idx(H,O)]=r.data[this._idx(H+P,O+D)]}}Vt("DEMData",nb);class ib{constructor(r){this._stringToNumber={},this._numberToString=[];for(let l=0;l<r.length;l++){const d=r[l];this._stringToNumber[d]=l,this._numberToString[l]=d}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class rb{constructor(r,l,d,g,x){this.type="Feature",this._vectorTileFeature=r,r._z=l,r._x=d,r._y=g,this.properties=r.properties,this.id=x}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const l in this)l!=="_geometry"&&l!=="_vectorTileFeature"&&(r[l]=this[l]);return r}}class sb{constructor(r,l){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new Gs(Cn,16,0),this.grid3D=new Gs(Cn,16,0),this.featureIndexArray=new N,this.promoteId=l}insert(r,l,d,g,x,b){const T=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(d,g,x);const P=b?this.grid3D:this.grid;for(let D=0;D<l.length;D++){const O=l[D],H=[1/0,1/0,-1/0,-1/0];for(let q=0;q<O.length;q++){const Q=O[q];H[0]=Math.min(H[0],Q.x),H[1]=Math.min(H[1],Q.y),H[2]=Math.max(H[2],Q.x),H[3]=Math.max(H[3],Q.y)}H[0]<Cn&&H[1]<Cn&&H[2]>=0&&H[3]>=0&&P.insert(T,H[0],H[1],H[2],H[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Fo.VectorTile(new Z_(this.rawTileData)).layers,this.sourceLayerCoder=new ib(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,l,d,g){this.loadVTLayers();const x=r.params||{},b=Cn/r.tileSize/r.scale,T=Gc(x.filter),P=r.queryGeometry,D=r.queryPadding*b,O=ob(P),H=this.grid.query(O.minX-D,O.minY-D,O.maxX+D,O.maxY+D),q=ob(r.cameraQueryGeometry),Q=this.grid3D.query(q.minX-D,q.minY-D,q.maxX+D,q.maxY+D,(me,we,De,Me)=>function(Re,et,ot,Dt,Yt){for(const Pt of Re)if(et<=Pt.x&&ot<=Pt.y&&Dt>=Pt.x&&Yt>=Pt.y)return!0;const It=[new E(et,ot),new E(et,Yt),new E(Dt,Yt),new E(Dt,ot)];if(Re.length>2){for(const Pt of It)if(tu(Re,Pt))return!0}for(let Pt=0;Pt<Re.length-1;Pt++)if(SA(Re[Pt],Re[Pt+1],It))return!0;return!1}(r.cameraQueryGeometry,me-D,we-D,De+D,Me+D));for(const me of Q)H.push(me);H.sort($C);const ie={};let ce;for(let me=0;me<H.length;me++){const we=H[me];if(we===ce)continue;ce=we;const De=this.featureIndexArray.get(we);let Me=null;this.loadMatchingFeature(ie,De.bucketIndex,De.sourceLayerIndex,De.featureIndex,T,x.layers,x.availableImages,l,d,g,(Re,et,ot)=>(Me||(Me=Na(Re)),et.queryIntersectsFeature(P,Re,ot,Me,this.z,r.transform,b,r.pixelPosMatrix)))}return ie}loadMatchingFeature(r,l,d,g,x,b,T,P,D,O,H){const q=this.bucketLayerIDs[l];if(b&&!function(me,we){for(let De=0;De<me.length;De++)if(we.indexOf(me[De])>=0)return!0;return!1}(b,q))return;const Q=this.sourceLayerCoder.decode(d),ie=this.vtLayers[Q].feature(g);if(x.needGeometry){const me=Oa(ie,!0);if(!x.filter(new ti(this.tileID.overscaledZ),me,this.tileID.canonical))return}else if(!x.filter(new ti(this.tileID.overscaledZ),ie))return;const ce=this.getId(ie,Q);for(let me=0;me<q.length;me++){const we=q[me];if(b&&b.indexOf(we)<0)continue;const De=P[we];if(!De)continue;let Me={};ce&&O&&(Me=O.getState(De.sourceLayer||"_geojsonTileLayer",ce));const Re=te({},D[we]);Re.paint=ab(Re.paint,De.paint,ie,Me,T),Re.layout=ab(Re.layout,De.layout,ie,Me,T);const et=!H||H(ie,De,Me);if(!et)continue;const ot=new rb(ie,this.z,this.x,this.y,ce);ot.layer=Re;let Dt=r[we];Dt===void 0&&(Dt=r[we]=[]),Dt.push({featureIndex:g,feature:ot,intersectionZ:et})}}lookupSymbolFeatures(r,l,d,g,x,b,T,P){const D={};this.loadVTLayers();const O=Gc(x);for(const H of r)this.loadMatchingFeature(D,d,g,H,O,b,T,P,l);return D}hasLayer(r){for(const l of this.bucketLayerIDs)for(const d of l)if(r===d)return!0;return!1}getId(r,l){let d=r.id;return this.promoteId&&(d=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[l]],typeof d=="boolean"&&(d=Number(d))),d}}function ab(a,r,l,d,g){return ae(a,(x,b)=>{const T=r instanceof Ol?r.get(b):null;return T&&T.evaluate?T.evaluate(l,d,g):T})}function ob(a){let r=1/0,l=1/0,d=-1/0,g=-1/0;for(const x of a)r=Math.min(r,x.x),l=Math.min(l,x.y),d=Math.max(d,x.x),g=Math.max(g,x.y);return{minX:r,minY:l,maxX:d,maxY:g}}function $C(a,r){return r-a}function lb(a,r,l,d,g){const x=[];for(let b=0;b<a.length;b++){const T=a[b];let P;for(let D=0;D<T.length-1;D++){let O=T[D],H=T[D+1];O.x<r&&H.x<r||(O.x<r?O=new E(r,O.y+(r-O.x)/(H.x-O.x)*(H.y-O.y))._round():H.x<r&&(H=new E(r,O.y+(r-O.x)/(H.x-O.x)*(H.y-O.y))._round()),O.y<l&&H.y<l||(O.y<l?O=new E(O.x+(l-O.y)/(H.y-O.y)*(H.x-O.x),l)._round():H.y<l&&(H=new E(O.x+(l-O.y)/(H.y-O.y)*(H.x-O.x),l)._round()),O.x>=d&&H.x>=d||(O.x>=d?O=new E(d,O.y+(d-O.x)/(H.x-O.x)*(H.y-O.y))._round():H.x>=d&&(H=new E(d,O.y+(d-O.x)/(H.x-O.x)*(H.y-O.y))._round()),O.y>=g&&H.y>=g||(O.y>=g?O=new E(O.x+(g-O.y)/(H.y-O.y)*(H.x-O.x),g)._round():H.y>=g&&(H=new E(O.x+(g-O.y)/(H.y-O.y)*(H.x-O.x),g)._round()),P&&O.equals(P[P.length-1])||(P=[O],x.push(P)),P.push(H)))))}}return x}Vt("FeatureIndex",sb,{omit:["rawTileData","sourceLayerCoder"]});class Bo extends E{constructor(r,l,d,g){super(r,l),this.angle=d,g!==void 0&&(this.segment=g)}clone(){return new Bo(this.x,this.y,this.angle,this.segment)}}function cb(a,r,l,d,g){if(r.segment===void 0||l===0)return!0;let x=r,b=r.segment+1,T=0;for(;T>-l/2;){if(b--,b<0)return!1;T-=a[b].dist(x),x=a[b]}T+=a[b].dist(a[b+1]),b++;const P=[];let D=0;for(;T<l/2;){const O=a[b],H=a[b+1];if(!H)return!1;let q=a[b-1].angleTo(O)-O.angleTo(H);for(q=Math.abs((q+3*Math.PI)%(2*Math.PI)-Math.PI),P.push({distance:T,angleDelta:q}),D+=q;T-P[0].distance>d;)D-=P.shift().angleDelta;if(D>g)return!1;b++,T+=O.dist(H)}return!0}function ub(a){let r=0;for(let l=0;l<a.length-1;l++)r+=a[l].dist(a[l+1]);return r}function hb(a,r,l){return a?.6*r*l:0}function db(a,r){return Math.max(a?a.right-a.left:0,r?r.right-r.left:0)}function XC(a,r,l,d,g,x){const b=hb(l,g,x),T=db(l,d)*x;let P=0;const D=ub(a)/2;for(let O=0;O<a.length-1;O++){const H=a[O],q=a[O+1],Q=H.dist(q);if(P+Q>D){const ie=(D-P)/Q,ce=Dr.number(H.x,q.x,ie),me=Dr.number(H.y,q.y,ie),we=new Bo(ce,me,q.angleTo(H),O);return we._round(),!b||cb(a,we,T,b,r)?we:void 0}P+=Q}}function qC(a,r,l,d,g,x,b,T,P){const D=hb(d,x,b),O=db(d,g),H=O*b,q=a[0].x===0||a[0].x===P||a[0].y===0||a[0].y===P;return r-H<r/4&&(r=H+r/4),fb(a,q?r/2*T%r:(O/2+2*x)*b*T%r,r,D,l,H,q,!1,P)}function fb(a,r,l,d,g,x,b,T,P){const D=x/2,O=ub(a);let H=0,q=r-l,Q=[];for(let ie=0;ie<a.length-1;ie++){const ce=a[ie],me=a[ie+1],we=ce.dist(me),De=me.angleTo(ce);for(;q+l<H+we;){q+=l;const Me=(q-H)/we,Re=Dr.number(ce.x,me.x,Me),et=Dr.number(ce.y,me.y,Me);if(Re>=0&&Re<P&&et>=0&&et<P&&q-D>=0&&q+D<=O){const ot=new Bo(Re,et,De,ie);ot._round(),d&&!cb(a,ot,x,d,g)||Q.push(ot)}}H+=we}return T||Q.length||b||(Q=fb(a,H/2,l,d,g,x,b,!0,P)),Q}Vt("Anchor",Bo);const cu=Fr;function pb(a,r,l,d){const g=[],x=a.image,b=x.pixelRatio,T=x.paddedRect.w-2*cu,P=x.paddedRect.h-2*cu,D=a.right-a.left,O=a.bottom-a.top,H=x.stretchX||[[0,T]],q=x.stretchY||[[0,P]],Q=(xt,Xt)=>xt+Xt[1]-Xt[0],ie=H.reduce(Q,0),ce=q.reduce(Q,0),me=T-ie,we=P-ce;let De=0,Me=ie,Re=0,et=ce,ot=0,Dt=me,Yt=0,It=we;if(x.content&&d){const xt=x.content;De=nm(H,0,xt[0]),Re=nm(q,0,xt[1]),Me=nm(H,xt[0],xt[2]),et=nm(q,xt[1],xt[3]),ot=xt[0]-De,Yt=xt[1]-Re,Dt=xt[2]-xt[0]-Me,It=xt[3]-xt[1]-et}const Pt=(xt,Xt,At,gt)=>{const tn=im(xt.stretch-De,Me,D,a.left),Jt=rm(xt.fixed-ot,Dt,xt.stretch,ie),Tn=im(Xt.stretch-Re,et,O,a.top),ii=rm(Xt.fixed-Yt,It,Xt.stretch,ce),li=im(At.stretch-De,Me,D,a.left),ki=rm(At.fixed-ot,Dt,At.stretch,ie),Kr=im(gt.stretch-Re,et,O,a.top),xr=rm(gt.fixed-Yt,It,gt.stretch,ce),Pi=new E(tn,Tn),Xi=new E(li,Tn),tr=new E(li,Kr),br=new E(tn,Kr),wr=new E(Jt/b,ii/b),Fi=new E(ki/b,xr/b),Ui=r*Math.PI/180;if(Ui){const lr=Math.sin(Ui),Ur=Math.cos(Ui),Nr=[Ur,-lr,lr,Ur];Pi._matMult(Nr),Xi._matMult(Nr),br._matMult(Nr),tr._matMult(Nr)}const or=xt.stretch+xt.fixed,Sr=Xt.stretch+Xt.fixed;return{tl:Pi,tr:Xi,bl:br,br:tr,tex:{x:x.paddedRect.x+cu+or,y:x.paddedRect.y+cu+Sr,w:At.stretch+At.fixed-or,h:gt.stretch+gt.fixed-Sr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:wr,pixelOffsetBR:Fi,minFontScaleX:Dt/b/D,minFontScaleY:It/b/O,isSDF:l}};if(d&&(x.stretchX||x.stretchY)){const xt=mb(H,me,ie),Xt=mb(q,we,ce);for(let At=0;At<xt.length-1;At++){const gt=xt[At],tn=xt[At+1];for(let Jt=0;Jt<Xt.length-1;Jt++)g.push(Pt(gt,Xt[Jt],tn,Xt[Jt+1]))}}else g.push(Pt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:T+1},{fixed:0,stretch:P+1}));return g}function nm(a,r,l){let d=0;for(const g of a)d+=Math.max(r,Math.min(l,g[1]))-Math.max(r,Math.min(l,g[0]));return d}function mb(a,r,l){const d=[{fixed:-cu,stretch:0}];for(const[g,x]of a){const b=d[d.length-1];d.push({fixed:g-b.stretch,stretch:b.stretch}),d.push({fixed:g-b.stretch,stretch:b.stretch+(x-g)})}return d.push({fixed:r+cu,stretch:l}),d}function im(a,r,l,d){return a/r*l+d}function rm(a,r,l,d){return a-r*l/d}class sm{constructor(r,l,d,g,x,b,T,P,D,O){if(this.boxStartIndex=r.length,D){let H=b.top,q=b.bottom;const Q=b.collisionPadding;Q&&(H-=Q[1],q+=Q[3]);let ie=q-H;ie>0&&(ie=Math.max(10,ie),this.circleDiameter=ie)}else{let H=b.top*T-P[0],q=b.bottom*T+P[2],Q=b.left*T-P[3],ie=b.right*T+P[1];const ce=b.collisionPadding;if(ce&&(Q-=ce[0]*T,H-=ce[1]*T,ie+=ce[2]*T,q+=ce[3]*T),O){const me=new E(Q,H),we=new E(ie,H),De=new E(Q,q),Me=new E(ie,q),Re=O*Math.PI/180;me._rotate(Re),we._rotate(Re),De._rotate(Re),Me._rotate(Re),Q=Math.min(me.x,we.x,De.x,Me.x),ie=Math.max(me.x,we.x,De.x,Me.x),H=Math.min(me.y,we.y,De.y,Me.y),q=Math.max(me.y,we.y,De.y,Me.y)}r.emplaceBack(l.x,l.y,Q,H,ie,q,d,g,x)}this.boxEndIndex=r.length}}class ZC{constructor(r=[],l=YC){if(this.data=r,this.length=this.data.length,this.compare=l,this.length>0)for(let d=(this.length>>1)-1;d>=0;d--)this._down(d)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],l=this.data.pop();return this.length--,this.length>0&&(this.data[0]=l,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:l,compare:d}=this,g=l[r];for(;r>0;){const x=r-1>>1,b=l[x];if(d(g,b)>=0)break;l[r]=b,r=x}l[r]=g}_down(r){const{data:l,compare:d}=this,g=this.length>>1,x=l[r];for(;r<g;){let b=1+(r<<1),T=l[b];const P=b+1;if(P<this.length&&d(l[P],T)<0&&(b=P,T=l[P]),d(T,x)>=0)break;l[r]=T,r=b}l[r]=x}}function YC(a,r){return a<r?-1:a>r?1:0}function KC(a,r=1,l=!1){let d=1/0,g=1/0,x=-1/0,b=-1/0;const T=a[0];for(let Q=0;Q<T.length;Q++){const ie=T[Q];(!Q||ie.x<d)&&(d=ie.x),(!Q||ie.y<g)&&(g=ie.y),(!Q||ie.x>x)&&(x=ie.x),(!Q||ie.y>b)&&(b=ie.y)}const P=Math.min(x-d,b-g);let D=P/2;const O=new ZC([],JC);if(P===0)return new E(d,g);for(let Q=d;Q<x;Q+=P)for(let ie=g;ie<b;ie+=P)O.push(new uu(Q+D,ie+D,D,a));let H=function(Q){let ie=0,ce=0,me=0;const we=Q[0];for(let De=0,Me=we.length,Re=Me-1;De<Me;Re=De++){const et=we[De],ot=we[Re],Dt=et.x*ot.y-ot.x*et.y;ce+=(et.x+ot.x)*Dt,me+=(et.y+ot.y)*Dt,ie+=3*Dt}return new uu(ce/ie,me/ie,0,Q)}(a),q=O.length;for(;O.length;){const Q=O.pop();(Q.d>H.d||!H.d)&&(H=Q,l&&console.log("found best %d after %d probes",Math.round(1e4*Q.d)/1e4,q)),Q.max-H.d<=r||(D=Q.h/2,O.push(new uu(Q.p.x-D,Q.p.y-D,D,a)),O.push(new uu(Q.p.x+D,Q.p.y-D,D,a)),O.push(new uu(Q.p.x-D,Q.p.y+D,D,a)),O.push(new uu(Q.p.x+D,Q.p.y+D,D,a)),q+=4)}return l&&(console.log(`num probes: ${q}`),console.log(`best distance: ${H.d}`)),H.p}function JC(a,r){return r.max-a.max}function uu(a,r,l,d){this.p=new E(a,r),this.h=l,this.d=function(g,x){let b=!1,T=1/0;for(let P=0;P<x.length;P++){const D=x[P];for(let O=0,H=D.length,q=H-1;O<H;q=O++){const Q=D[O],ie=D[q];Q.y>g.y!=ie.y>g.y&&g.x<(ie.x-Q.x)*(g.y-Q.y)/(ie.y-Q.y)+Q.x&&(b=!b),T=Math.min(T,Jx(g,Q,ie))}}return(b?1:-1)*Math.sqrt(T)}(this.p,d),this.max=this.d+this.h*Math.SQRT2}var er;f.ap=void 0,(er=f.ap||(f.ap={}))[er.center=1]="center",er[er.left=2]="left",er[er.right=3]="right",er[er.top=4]="top",er[er.bottom=5]="bottom",er[er["top-left"]=6]="top-left",er[er["top-right"]=7]="top-right",er[er["bottom-left"]=8]="bottom-left",er[er["bottom-right"]=9]="bottom-right";const Vo=7,ly=Number.POSITIVE_INFINITY;function gb(a,r){return r[1]!==ly?function(l,d,g){let x=0,b=0;switch(d=Math.abs(d),g=Math.abs(g),l){case"top-right":case"top-left":case"top":b=g-Vo;break;case"bottom-right":case"bottom-left":case"bottom":b=-g+Vo}switch(l){case"top-right":case"bottom-right":case"right":x=-d;break;case"top-left":case"bottom-left":case"left":x=d}return[x,b]}(a,r[0],r[1]):function(l,d){let g=0,x=0;d<0&&(d=0);const b=d/Math.SQRT2;switch(l){case"top-right":case"top-left":x=b-Vo;break;case"bottom-right":case"bottom-left":x=-b+Vo;break;case"bottom":x=-d+Vo;break;case"top":x=d-Vo}switch(l){case"top-right":case"bottom-right":g=-b;break;case"top-left":case"bottom-left":g=b;break;case"left":g=d;break;case"right":g=-d}return[g,x]}(a,r[0])}function _b(a,r,l){var d;const g=a.layout,x=(d=g.get("text-variable-anchor-offset"))===null||d===void 0?void 0:d.evaluate(r,{},l);if(x){const T=x.values,P=[];for(let D=0;D<T.length;D+=2){const O=P[D]=T[D],H=T[D+1].map(q=>q*zi);O.startsWith("top")?H[1]-=Vo:O.startsWith("bottom")&&(H[1]+=Vo),P[D+1]=H}return new An(P)}const b=g.get("text-variable-anchor");if(b){let T;T=a._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[g.get("text-radial-offset").evaluate(r,{},l)*zi,ly]:g.get("text-offset").evaluate(r,{},l).map(D=>D*zi);const P=[];for(const D of b)P.push(D,gb(D,T));return new An(P)}return null}function cy(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function QC(a,r,l,d,g,x,b,T,P,D,O){let H=x.textMaxSize.evaluate(r,{});H===void 0&&(H=b);const q=a.layers[0].layout,Q=q.get("icon-offset").evaluate(r,{},O),ie=vb(l.horizontal),ce=b/24,me=a.tilePixelRatio*ce,we=a.tilePixelRatio*H/24,De=a.tilePixelRatio*T,Me=a.tilePixelRatio*q.get("symbol-spacing"),Re=q.get("text-padding")*a.tilePixelRatio,et=function(gt,tn,Jt,Tn=1){const ii=gt.get("icon-padding").evaluate(tn,{},Jt),li=ii&&ii.values;return[li[0]*Tn,li[1]*Tn,li[2]*Tn,li[3]*Tn]}(q,r,O,a.tilePixelRatio),ot=q.get("text-max-angle")/180*Math.PI,Dt=q.get("text-rotation-alignment")!=="viewport"&&q.get("symbol-placement")!=="point",Yt=q.get("icon-rotation-alignment")==="map"&&q.get("symbol-placement")!=="point",It=q.get("symbol-placement"),Pt=Me/2,xt=q.get("icon-text-fit");let Xt;d&&xt!=="none"&&(a.allowVerticalPlacement&&l.vertical&&(Xt=G1(d,l.vertical,xt,q.get("icon-text-fit-padding"),Q,ce)),ie&&(d=G1(d,ie,xt,q.get("icon-text-fit-padding"),Q,ce)));const At=(gt,tn)=>{tn.x<0||tn.x>=Cn||tn.y<0||tn.y>=Cn||function(Jt,Tn,ii,li,ki,Kr,xr,Pi,Xi,tr,br,wr,Fi,Ui,or,Sr,lr,Ur,Nr,Ni,In,cr,nr,Oi,As){const js=Jt.addToLineVertexArray(Tn,ii);let Ws,Ga,Cs,cs,Or=0,Ha=0,Ud=0,Sb=0,_y=-1,yy=-1;const ja={};let Mb=Mn("");if(Jt.allowVerticalPlacement&&li.vertical){const ur=Pi.layout.get("text-rotate").evaluate(In,{},Oi)+90;Cs=new sm(Xi,Tn,tr,br,wr,li.vertical,Fi,Ui,or,ur),xr&&(cs=new sm(Xi,Tn,tr,br,wr,xr,lr,Ur,or,ur))}if(ki){const ur=Pi.layout.get("icon-rotate").evaluate(In,{}),us=Pi.layout.get("icon-text-fit")!=="none",Xl=pb(ki,ur,nr,us),Xs=xr?pb(xr,ur,nr,us):void 0;Ga=new sm(Xi,Tn,tr,br,wr,ki,lr,Ur,!1,ur),Or=4*Xl.length;const ql=Jt.iconSizeData;let ma=null;ql.kind==="source"?(ma=[pa*Pi.layout.get("icon-size").evaluate(In,{})],ma[0]>No&&Te(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)):ql.kind==="composite"&&(ma=[pa*cr.compositeIconSizes[0].evaluate(In,{},Oi),pa*cr.compositeIconSizes[1].evaluate(In,{},Oi)],(ma[0]>No||ma[1]>No)&&Te(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${Dd}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Xl,ma,Ni,Nr,In,f.ah.none,Tn,js.lineStartIndex,js.lineLength,-1,Oi),_y=Jt.icon.placedSymbolArray.length-1,Xs&&(Ha=4*Xs.length,Jt.addSymbols(Jt.icon,Xs,ma,Ni,Nr,In,f.ah.vertical,Tn,js.lineStartIndex,js.lineLength,-1,Oi),yy=Jt.icon.placedSymbolArray.length-1)}const Tb=Object.keys(li.horizontal);for(const ur of Tb){const us=li.horizontal[ur];if(!Ws){Mb=Mn(us.text);const Xs=Pi.layout.get("text-rotate").evaluate(In,{},Oi);Ws=new sm(Xi,Tn,tr,br,wr,us,Fi,Ui,or,Xs)}const Xl=us.positionedLines.length===1;if(Ud+=yb(Jt,Tn,us,Kr,Pi,or,In,Sr,js,li.vertical?f.ah.horizontal:f.ah.horizontalOnly,Xl?Tb:[ur],ja,_y,cr,Oi),Xl)break}li.vertical&&(Sb+=yb(Jt,Tn,li.vertical,Kr,Pi,or,In,Sr,js,f.ah.vertical,["vertical"],ja,yy,cr,Oi));const nP=Ws?Ws.boxStartIndex:Jt.collisionBoxArray.length,iP=Ws?Ws.boxEndIndex:Jt.collisionBoxArray.length,rP=Cs?Cs.boxStartIndex:Jt.collisionBoxArray.length,sP=Cs?Cs.boxEndIndex:Jt.collisionBoxArray.length,aP=Ga?Ga.boxStartIndex:Jt.collisionBoxArray.length,oP=Ga?Ga.boxEndIndex:Jt.collisionBoxArray.length,lP=cs?cs.boxStartIndex:Jt.collisionBoxArray.length,cP=cs?cs.boxEndIndex:Jt.collisionBoxArray.length;let $s=-1;const om=(ur,us)=>ur&&ur.circleDiameter?Math.max(ur.circleDiameter,us):us;$s=om(Ws,$s),$s=om(Cs,$s),$s=om(Ga,$s),$s=om(cs,$s);const Eb=$s>-1?1:0;Eb&&($s*=As/zi),Jt.glyphOffsetArray.length>=lu.MAX_GLYPHS&&Te("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),In.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,In.sortKey);const uP=_b(Pi,In,Oi),[hP,dP]=function(ur,us){const Xl=ur.length,Xs=us==null?void 0:us.values;if((Xs==null?void 0:Xs.length)>0)for(let ql=0;ql<Xs.length;ql+=2){const ma=Xs[ql+1];ur.emplaceBack(f.ap[Xs[ql]],ma[0],ma[1])}return[Xl,ur.length]}(Jt.textAnchorOffsets,uP);Jt.symbolInstances.emplaceBack(Tn.x,Tn.y,ja.right>=0?ja.right:-1,ja.center>=0?ja.center:-1,ja.left>=0?ja.left:-1,ja.vertical||-1,_y,yy,Mb,nP,iP,rP,sP,aP,oP,lP,cP,tr,Ud,Sb,Or,Ha,Eb,0,Fi,$s,hP,dP)}(a,tn,gt,l,d,g,Xt,a.layers[0],a.collisionBoxArray,r.index,r.sourceLayerIndex,a.index,me,[Re,Re,Re,Re],Dt,P,De,et,Yt,Q,r,x,D,O,b)};if(It==="line")for(const gt of lb(r.geometry,0,0,Cn,Cn)){const tn=qC(gt,Me,ot,l.vertical||ie,d,24,we,a.overscaling,Cn);for(const Jt of tn)ie&&eP(a,ie.text,Pt,Jt)||At(gt,Jt)}else if(It==="line-center"){for(const gt of r.geometry)if(gt.length>1){const tn=XC(gt,ot,l.vertical||ie,d,24,we);tn&&At(gt,tn)}}else if(r.type==="Polygon")for(const gt of V_(r.geometry,0)){const tn=KC(gt,16);At(gt[0],new Bo(tn.x,tn.y,0))}else if(r.type==="LineString")for(const gt of r.geometry)At(gt,new Bo(gt[0].x,gt[0].y,0));else if(r.type==="Point")for(const gt of r.geometry)for(const tn of gt)At([tn],new Bo(tn.x,tn.y,0))}function yb(a,r,l,d,g,x,b,T,P,D,O,H,q,Q,ie){const ce=function(De,Me,Re,et,ot,Dt,Yt,It){const Pt=et.layout.get("text-rotate").evaluate(Dt,{})*Math.PI/180,xt=[];for(const Xt of Me.positionedLines)for(const At of Xt.positionedGlyphs){if(!At.rect)continue;const gt=At.rect||{};let tn=k1+1,Jt=!0,Tn=1,ii=0;const li=(ot||It)&&At.vertical,ki=At.metrics.advance*At.scale/2;if(It&&Me.verticalizable&&(ii=Xt.lineOffset/2-(At.imageName?-(zi-At.metrics.width*At.scale)/2:(At.scale-1)*zi)),At.imageName){const Ni=Yt[At.imageName];Jt=Ni.sdf,Tn=Ni.pixelRatio,tn=Fr/Tn}const Kr=ot?[At.x+ki,At.y]:[0,0];let xr=ot?[0,0]:[At.x+ki+Re[0],At.y+Re[1]-ii],Pi=[0,0];li&&(Pi=xr,xr=[0,0]);const Xi=At.metrics.isDoubleResolution?2:1,tr=(At.metrics.left-tn)*At.scale-ki+xr[0],br=(-At.metrics.top-tn)*At.scale+xr[1],wr=tr+gt.w/Xi*At.scale/Tn,Fi=br+gt.h/Xi*At.scale/Tn,Ui=new E(tr,br),or=new E(wr,br),Sr=new E(tr,Fi),lr=new E(wr,Fi);if(li){const Ni=new E(-ki,ki-Id),In=-Math.PI/2,cr=zi/2-ki,nr=new E(5-Id-cr,-(At.imageName?cr:0)),Oi=new E(...Pi);Ui._rotateAround(In,Ni)._add(nr)._add(Oi),or._rotateAround(In,Ni)._add(nr)._add(Oi),Sr._rotateAround(In,Ni)._add(nr)._add(Oi),lr._rotateAround(In,Ni)._add(nr)._add(Oi)}if(Pt){const Ni=Math.sin(Pt),In=Math.cos(Pt),cr=[In,-Ni,Ni,In];Ui._matMult(cr),or._matMult(cr),Sr._matMult(cr),lr._matMult(cr)}const Ur=new E(0,0),Nr=new E(0,0);xt.push({tl:Ui,tr:or,bl:Sr,br:lr,tex:gt,writingMode:Me.writingMode,glyphOffset:Kr,sectionIndex:At.sectionIndex,isSDF:Jt,pixelOffsetTL:Ur,pixelOffsetBR:Nr,minFontScaleX:0,minFontScaleY:0})}return xt}(0,l,T,g,x,b,d,a.allowVerticalPlacement),me=a.textSizeData;let we=null;me.kind==="source"?(we=[pa*g.layout.get("text-size").evaluate(b,{})],we[0]>No&&Te(`${a.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)):me.kind==="composite"&&(we=[pa*Q.compositeTextSizes[0].evaluate(b,{},ie),pa*Q.compositeTextSizes[1].evaluate(b,{},ie)],(we[0]>No||we[1]>No)&&Te(`${a.layerIds[0]}: Value for "text-size" is >= ${Dd}. Reduce your "text-size".`)),a.addSymbols(a.text,ce,we,T,x,b,D,r,P.lineStartIndex,P.lineLength,q,ie);for(const De of O)H[De]=a.text.placedSymbolArray.length-1;return 4*ce.length}function vb(a){for(const r in a)return a[r];return null}function eP(a,r,l,d){const g=a.compareText;if(r in g){const x=g[r];for(let b=x.length-1;b>=0;b--)if(d.dist(x[b])<l)return!0}else g[r]=[];return g[r].push(d),!1}const xb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class uy{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[l,d]=new Uint8Array(r,0,2);if(l!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=d>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const x=xb[15&d];if(!x)throw new Error("Unrecognized array type.");const[b]=new Uint16Array(r,2,1),[T]=new Uint32Array(r,4,1);return new uy(T,b,x,r)}constructor(r,l=64,d=Float64Array,g){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+l,2),65535),this.ArrayType=d,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const x=xb.indexOf(this.ArrayType),b=2*r*this.ArrayType.BYTES_PER_ELEMENT,T=r*this.IndexArrayType.BYTES_PER_ELEMENT,P=(8-T%8)%8;if(x<0)throw new Error(`Unexpected typed array class: ${d}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+P,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+b+T+P),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+T+P,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+x]),new Uint16Array(this.data,2,1)[0]=l,new Uint32Array(this.data,4,1)[0]=r)}add(r,l){const d=this._pos>>1;return this.ids[d]=d,this.coords[this._pos++]=r,this.coords[this._pos++]=l,d}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return hy(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,l,d,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:x,coords:b,nodeSize:T}=this,P=[0,x.length-1,0],D=[];for(;P.length;){const O=P.pop()||0,H=P.pop()||0,q=P.pop()||0;if(H-q<=T){for(let me=q;me<=H;me++){const we=b[2*me],De=b[2*me+1];we>=r&&we<=d&&De>=l&&De<=g&&D.push(x[me])}continue}const Q=q+H>>1,ie=b[2*Q],ce=b[2*Q+1];ie>=r&&ie<=d&&ce>=l&&ce<=g&&D.push(x[Q]),(O===0?r<=ie:l<=ce)&&(P.push(q),P.push(Q-1),P.push(1-O)),(O===0?d>=ie:g>=ce)&&(P.push(Q+1),P.push(H),P.push(1-O))}return D}within(r,l,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,T=[0,g.length-1,0],P=[],D=d*d;for(;T.length;){const O=T.pop()||0,H=T.pop()||0,q=T.pop()||0;if(H-q<=b){for(let me=q;me<=H;me++)wb(x[2*me],x[2*me+1],r,l)<=D&&P.push(g[me]);continue}const Q=q+H>>1,ie=x[2*Q],ce=x[2*Q+1];wb(ie,ce,r,l)<=D&&P.push(g[Q]),(O===0?r-d<=ie:l-d<=ce)&&(T.push(q),T.push(Q-1),T.push(1-O)),(O===0?r+d>=ie:l+d>=ce)&&(T.push(Q+1),T.push(H),T.push(1-O))}return P}}function hy(a,r,l,d,g,x){if(g-d<=l)return;const b=d+g>>1;bb(a,r,b,d,g,x),hy(a,r,l,d,b-1,1-x),hy(a,r,l,b+1,g,1-x)}function bb(a,r,l,d,g,x){for(;g>d;){if(g-d>600){const D=g-d+1,O=l-d+1,H=Math.log(D),q=.5*Math.exp(2*H/3),Q=.5*Math.sqrt(H*q*(D-q)/D)*(O-D/2<0?-1:1);bb(a,r,l,Math.max(d,Math.floor(l-O*q/D+Q)),Math.min(g,Math.floor(l+(D-O)*q/D+Q)),x)}const b=r[2*l+x];let T=d,P=g;for(kd(a,r,d,l),r[2*g+x]>b&&kd(a,r,d,g);T<P;){for(kd(a,r,T,P),T++,P--;r[2*T+x]<b;)T++;for(;r[2*P+x]>b;)P--}r[2*d+x]===b?kd(a,r,d,P):(P++,kd(a,r,P,g)),P<=l&&(d=P+1),l<=P&&(g=P-1)}}function kd(a,r,l,d){dy(a,l,d),dy(r,2*l,2*d),dy(r,2*l+1,2*d+1)}function dy(a,r,l){const d=a[r];a[r]=a[l],a[l]=d}function wb(a,r,l,d){const g=a-l,x=r-d;return g*g+x*x}var fy;f.bd=void 0,(fy=f.bd||(f.bd={})).create="create",fy.load="load",fy.fullLoad="fullLoad";let am=null,Fd=[];const py=1e3/60,my="loadTime",gy="fullLoadTime",tP={mark(a){performance.mark(a)},frame(a){const r=a;am!=null&&Fd.push(r-am),am=r},clearMetrics(){am=null,Fd=[],performance.clearMeasures(my),performance.clearMeasures(gy);for(const a in f.bd)performance.clearMarks(f.bd[a])},getPerformanceMetrics(){performance.measure(my,f.bd.create,f.bd.load),performance.measure(gy,f.bd.create,f.bd.fullLoad);const a=performance.getEntriesByName(my)[0].duration,r=performance.getEntriesByName(gy)[0].duration,l=Fd.length,d=1/(Fd.reduce((x,b)=>x+b,0)/l/1e3),g=Fd.filter(x=>x>py).reduce((x,b)=>x+(b-py)/py,0);return{loadTime:a,fullLoadTime:r,fps:d,percentDroppedFrames:g/(l+g)*100,totalFrames:l}}};f.$=ht,f.A=nu,f.B=function(a){if(st==null){const r=a.navigator?a.navigator.userAgent:null;st=!!a.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return st},f.C=class{constructor(a,r){this.target=a,this.mapId=r,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new WC(()=>this.process()),this.subscription=function(l,d,g,x){return l.addEventListener(d,g,!1),{unsubscribe:()=>{l.removeEventListener(d,g,!1)}}}(this.target,"message",l=>this.receive(l)),this.globalScope=ut(self)?a:window}registerMessageHandler(a,r){this.messageHandlers[a]=r}sendAsync(a,r){return new Promise((l,d)=>{const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[g]={resolve:l,reject:d},r&&r.signal.addEventListener("abort",()=>{delete this.resolveRejects[g];const T={id:g,type:"<cancel>",origin:location.origin,targetMapId:a.targetMapId,sourceMapId:this.mapId};this.target.postMessage(T)},{once:!0});const x=[],b=Object.assign(Object.assign({},a),{id:g,sourceMapId:this.mapId,origin:location.origin,data:La(a.data,x)});this.target.postMessage(b,{transfer:x})})}receive(a){const r=a.data,l=r.id;if(!(r.origin!=="file://"&&location.origin!=="file://"&&r.origin!==location.origin||r.targetMapId&&this.mapId!==r.targetMapId)){if(r.type==="<cancel>"){delete this.tasks[l];const d=this.abortControllers[l];return delete this.abortControllers[l],void(d&&d.abort())}if(ut(self)||r.mustQueue)return this.tasks[l]=r,this.taskQueue.push(l),void this.invoker.trigger();this.processTask(l,r)}}process(){if(this.taskQueue.length===0)return;const a=this.taskQueue.shift(),r=this.tasks[a];delete this.tasks[a],this.taskQueue.length>0&&this.invoker.trigger(),r&&this.processTask(a,r)}processTask(a,r){return c(this,void 0,void 0,function*(){if(r.type==="<response>"){const g=this.resolveRejects[a];return delete this.resolveRejects[a],g?void(r.error?g.reject(Io(r.error)):g.resolve(Io(r.data))):void 0}if(!this.messageHandlers[r.type])return void this.completeTask(a,new Error(`Could not find a registered handler for ${r.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const l=Io(r.data),d=new AbortController;this.abortControllers[a]=d;try{const g=yield this.messageHandlers[r.type](r.sourceMapId,l,d);this.completeTask(a,null,g)}catch(g){this.completeTask(a,g)}})}completeTask(a,r,l){const d=[];delete this.abortControllers[a];const g={id:a,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:r?La(r):null,data:La(l,d)};this.target.postMessage(g,{transfer:d})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},f.D=Qt,f.E=En,f.F=function(){var a=new nu(16);return nu!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a},f.G=St,f.H=function(a,r,l){var d,g,x,b,T,P,D,O,H,q,Q,ie,ce=l[0],me=l[1],we=l[2];return r===a?(a[12]=r[0]*ce+r[4]*me+r[8]*we+r[12],a[13]=r[1]*ce+r[5]*me+r[9]*we+r[13],a[14]=r[2]*ce+r[6]*me+r[10]*we+r[14],a[15]=r[3]*ce+r[7]*me+r[11]*we+r[15]):(g=r[1],x=r[2],b=r[3],T=r[4],P=r[5],D=r[6],O=r[7],H=r[8],q=r[9],Q=r[10],ie=r[11],a[0]=d=r[0],a[1]=g,a[2]=x,a[3]=b,a[4]=T,a[5]=P,a[6]=D,a[7]=O,a[8]=H,a[9]=q,a[10]=Q,a[11]=ie,a[12]=d*ce+T*me+H*we+r[12],a[13]=g*ce+P*me+q*we+r[13],a[14]=x*ce+D*me+Q*we+r[14],a[15]=b*ce+O*me+ie*we+r[15]),a},f.I=K_,f.J=function(a,r,l){var d=l[0],g=l[1],x=l[2];return a[0]=r[0]*d,a[1]=r[1]*d,a[2]=r[2]*d,a[3]=r[3]*d,a[4]=r[4]*g,a[5]=r[5]*g,a[6]=r[6]*g,a[7]=r[7]*g,a[8]=r[8]*x,a[9]=r[9]*x,a[10]=r[10]*x,a[11]=r[11]*x,a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},f.K=n1,f.L=function(a,r){const l={};for(let d=0;d<r.length;d++){const g=r[d];g in a&&(l[g]=a[g])}return l},f.M=Oo,f.N=K1,f.O=J1,f.P=E,f.Q=ls,f.R=os,f.S=R,f.T=sd,f.U=G,f.V=Ye,f.W=Cn,f.X=wi,f.Y=tm,f.Z=class extends da{},f._=c,f.a=_t,f.a$=function(a,r,l){return a[0]=r[0]*l[0],a[1]=r[1]*l[1],a[2]=r[2]*l[2],a[3]=r[3]*l[3],a},f.a0=oy,f.a1=qe,f.a2=a=>{const r=window.document.createElement("video");return r.muted=!0,new Promise(l=>{r.onloadstart=()=>{l(r)};for(const d of a){const g=window.document.createElement("source");Fe(d)||(r.crossOrigin="Anonymous"),g.src=d,r.appendChild(g)}})},f.a3=function(){return be++},f.a4=Up,f.a5=lu,f.a6=Gc,f.a7=Oa,f.a8=ti,f.a9=rb,f.aA=Pe,f.aB=function(a,r){if(!a)return[{command:"setStyle",args:[r]}];let l=[];try{if(!Xe(a.version,r.version))return[{command:"setStyle",args:[r]}];Xe(a.center,r.center)||l.push({command:"setCenter",args:[r.center]}),Xe(a.zoom,r.zoom)||l.push({command:"setZoom",args:[r.zoom]}),Xe(a.bearing,r.bearing)||l.push({command:"setBearing",args:[r.bearing]}),Xe(a.pitch,r.pitch)||l.push({command:"setPitch",args:[r.pitch]}),Xe(a.sprite,r.sprite)||l.push({command:"setSprite",args:[r.sprite]}),Xe(a.glyphs,r.glyphs)||l.push({command:"setGlyphs",args:[r.glyphs]}),Xe(a.transition,r.transition)||l.push({command:"setTransition",args:[r.transition]}),Xe(a.light,r.light)||l.push({command:"setLight",args:[r.light]}),Xe(a.terrain,r.terrain)||l.push({command:"setTerrain",args:[r.terrain]}),Xe(a.sky,r.sky)||l.push({command:"setSky",args:[r.sky]});const d={},g=[];(function(b,T,P,D){let O;for(O in T=T||{},b=b||{})Object.prototype.hasOwnProperty.call(b,O)&&(Object.prototype.hasOwnProperty.call(T,O)||nn(O,P,D));for(O in T)Object.prototype.hasOwnProperty.call(T,O)&&(Object.prototype.hasOwnProperty.call(b,O)?Xe(b[O],T[O])||(b[O].type==="geojson"&&T[O].type==="geojson"&&Kt(b,T,O)?at(P,{command:"setGeoJSONSourceData",args:[O,T[O].data]}):mt(O,T,P,D)):ft(O,T,P))})(a.sources,r.sources,g,d);const x=[];a.layers&&a.layers.forEach(b=>{"source"in b&&d[b.source]?l.push({command:"removeLayer",args:[b.id]}):x.push(b)}),l=l.concat(g),function(b,T,P){T=T||[];const D=(b=b||[]).map(Tt),O=T.map(Tt),H=b.reduce($t,{}),q=T.reduce($t,{}),Q=D.slice(),ie=Object.create(null);let ce,me,we,De,Me;for(let Re=0,et=0;Re<D.length;Re++)ce=D[Re],Object.prototype.hasOwnProperty.call(q,ce)?et++:(at(P,{command:"removeLayer",args:[ce]}),Q.splice(Q.indexOf(ce,et),1));for(let Re=0,et=0;Re<O.length;Re++)ce=O[O.length-1-Re],Q[Q.length-1-Re]!==ce&&(Object.prototype.hasOwnProperty.call(H,ce)?(at(P,{command:"removeLayer",args:[ce]}),Q.splice(Q.lastIndexOf(ce,Q.length-et),1)):et++,De=Q[Q.length-Re],at(P,{command:"addLayer",args:[q[ce],De]}),Q.splice(Q.length-Re,0,ce),ie[ce]=!0);for(let Re=0;Re<O.length;Re++)if(ce=O[Re],me=H[ce],we=q[ce],!ie[ce]&&!Xe(me,we))if(Xe(me.source,we.source)&&Xe(me["source-layer"],we["source-layer"])&&Xe(me.type,we.type)){for(Me in rn(me.layout,we.layout,P,ce,null,"setLayoutProperty"),rn(me.paint,we.paint,P,ce,null,"setPaintProperty"),Xe(me.filter,we.filter)||at(P,{command:"setFilter",args:[ce,we.filter]}),Xe(me.minzoom,we.minzoom)&&Xe(me.maxzoom,we.maxzoom)||at(P,{command:"setLayerZoomRange",args:[ce,we.minzoom,we.maxzoom]}),me)Object.prototype.hasOwnProperty.call(me,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?rn(me[Me],we[Me],P,ce,Me.slice(6),"setPaintProperty"):Xe(me[Me],we[Me])||at(P,{command:"setLayerProperty",args:[ce,Me,we[Me]]}));for(Me in we)Object.prototype.hasOwnProperty.call(we,Me)&&!Object.prototype.hasOwnProperty.call(me,Me)&&Me!=="layout"&&Me!=="paint"&&Me!=="filter"&&Me!=="metadata"&&Me!=="minzoom"&&Me!=="maxzoom"&&(Me.indexOf("paint.")===0?rn(me[Me],we[Me],P,ce,Me.slice(6),"setPaintProperty"):Xe(me[Me],we[Me])||at(P,{command:"setLayerProperty",args:[ce,Me,we[Me]]}))}else at(P,{command:"removeLayer",args:[ce]}),De=Q[Q.lastIndexOf(ce)+1],at(P,{command:"addLayer",args:[we,De]})}(x,r.layers,l)}catch(d){console.warn("Unable to compute style diff:",d),l=[{command:"setStyle",args:[r]}]}return l},f.aC=function(a){const r=[],l=a.id;return l===void 0&&r.push({message:`layers.${l}: missing required property "id"`}),a.render===void 0&&r.push({message:`layers.${l}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&r.push({message:`layers.${l}: property "renderingMode" must be either "2d" or "3d"`}),r},f.aD=function a(r,l){if(Array.isArray(r)){if(!Array.isArray(l)||r.length!==l.length)return!1;for(let d=0;d<r.length;d++)if(!a(r[d],l[d]))return!1;return!0}if(typeof r=="object"&&r!==null&&l!==null){if(typeof l!="object"||Object.keys(r).length!==Object.keys(l).length)return!1;for(const d in r)if(!a(r[d],l[d]))return!1;return!0}return r===l},f.aE=ae,f.aF=K,f.aG=class extends Jn{constructor(a,r){super(a,r),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}},f.aH=Qi,f.aI=class extends Jn{constructor(a,r){super(a,r),this.current=Fa}set(a){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let r=1;r<16;r++)if(a[r]!==this.current[r]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}},f.aJ=ss,f.aK=class extends Jn{constructor(a,r){super(a,r),this.current=[0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2]))}},f.aL=class extends Jn{constructor(a,r){super(a,r),this.current=[0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1]))}},f.aM=Ts,f.aN=function(a,r,l,d,g,x,b){var T=1/(r-l),P=1/(d-g),D=1/(x-b);return a[0]=-2*T,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*P,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*D,a[11]=0,a[12]=(r+l)*T,a[13]=(g+d)*P,a[14]=(b+x)*D,a[15]=1,a},f.aO=Ft,f.aP=TA,f.aQ=class extends Hl{},f.aR=vC,f.aS=class extends Do{},f.aT=function(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))},f.aU=o1,f.aV=W,f.aW=class extends md{},f.aX=We,f.aY=function(a,r){return a[0]===r[0]&&a[1]===r[1]&&a[2]===r[2]&&a[3]===r[3]&&a[4]===r[4]&&a[5]===r[5]&&a[6]===r[6]&&a[7]===r[7]&&a[8]===r[8]&&a[9]===r[9]&&a[10]===r[10]&&a[11]===r[11]&&a[12]===r[12]&&a[13]===r[13]&&a[14]===r[14]&&a[15]===r[15]},f.aZ=function(a,r){var l=a[0],d=a[1],g=a[2],x=a[3],b=a[4],T=a[5],P=a[6],D=a[7],O=a[8],H=a[9],q=a[10],Q=a[11],ie=a[12],ce=a[13],me=a[14],we=a[15],De=r[0],Me=r[1],Re=r[2],et=r[3],ot=r[4],Dt=r[5],Yt=r[6],It=r[7],Pt=r[8],xt=r[9],Xt=r[10],At=r[11],gt=r[12],tn=r[13],Jt=r[14],Tn=r[15];return Math.abs(l-De)<=vr*Math.max(1,Math.abs(l),Math.abs(De))&&Math.abs(d-Me)<=vr*Math.max(1,Math.abs(d),Math.abs(Me))&&Math.abs(g-Re)<=vr*Math.max(1,Math.abs(g),Math.abs(Re))&&Math.abs(x-et)<=vr*Math.max(1,Math.abs(x),Math.abs(et))&&Math.abs(b-ot)<=vr*Math.max(1,Math.abs(b),Math.abs(ot))&&Math.abs(T-Dt)<=vr*Math.max(1,Math.abs(T),Math.abs(Dt))&&Math.abs(P-Yt)<=vr*Math.max(1,Math.abs(P),Math.abs(Yt))&&Math.abs(D-It)<=vr*Math.max(1,Math.abs(D),Math.abs(It))&&Math.abs(O-Pt)<=vr*Math.max(1,Math.abs(O),Math.abs(Pt))&&Math.abs(H-xt)<=vr*Math.max(1,Math.abs(H),Math.abs(xt))&&Math.abs(q-Xt)<=vr*Math.max(1,Math.abs(q),Math.abs(Xt))&&Math.abs(Q-At)<=vr*Math.max(1,Math.abs(Q),Math.abs(At))&&Math.abs(ie-gt)<=vr*Math.max(1,Math.abs(ie),Math.abs(gt))&&Math.abs(ce-tn)<=vr*Math.max(1,Math.abs(ce),Math.abs(tn))&&Math.abs(me-Jt)<=vr*Math.max(1,Math.abs(me),Math.abs(Jt))&&Math.abs(we-Tn)<=vr*Math.max(1,Math.abs(we),Math.abs(Tn))},f.a_=function(a,r){return a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[4]=r[4],a[5]=r[5],a[6]=r[6],a[7]=r[7],a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15],a},f.aa=function(a){const r={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(l,d,g,x)=>{const b=g||x;return r[d]=!b||b.toLowerCase(),""}),r["max-age"]){const l=parseInt(r["max-age"],10);isNaN(l)?delete r["max-age"]:r["max-age"]=l}return r},f.ab=function(a,r){const l=[];for(const d in a)d in r||l.push(d);return l},f.ac=fe,f.ad=function(a,r,l){var d=Math.sin(l),g=Math.cos(l),x=r[0],b=r[1],T=r[2],P=r[3],D=r[4],O=r[5],H=r[6],q=r[7];return r!==a&&(a[8]=r[8],a[9]=r[9],a[10]=r[10],a[11]=r[11],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[0]=x*g+D*d,a[1]=b*g+O*d,a[2]=T*g+H*d,a[3]=P*g+q*d,a[4]=D*g-x*d,a[5]=O*g-b*d,a[6]=H*g-T*d,a[7]=q*g-P*d,a},f.ae=function(a){var r=new nu(16);return r[0]=a[0],r[1]=a[1],r[2]=a[2],r[3]=a[3],r[4]=a[4],r[5]=a[5],r[6]=a[6],r[7]=a[7],r[8]=a[8],r[9]=a[9],r[10]=a[10],r[11]=a[11],r[12]=a[12],r[13]=a[13],r[14]=a[14],r[15]=a[15],r},f.af=jp,f.ag=function(a,r){let l=0,d=0;if(a.kind==="constant")d=a.layoutSize;else if(a.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=a,T=g?fe(ar.interpolationFactor(g,r,x,b),0,1):0;a.kind==="camera"?d=Dr.number(a.minSize,a.maxSize,T):l=T}return{uSizeT:l,uSize:d}},f.ai=function(a,{uSize:r,uSizeT:l},{lowerSize:d,upperSize:g}){return a.kind==="source"?d/pa:a.kind==="composite"?Dr.number(d/pa,g/pa,l):r},f.aj=ty,f.ak=function(a,r,l,d){const g=r.y-a.y,x=r.x-a.x,b=d.y-l.y,T=d.x-l.x,P=b*x-T*g;if(P===0)return null;const D=(T*(a.y-l.y)-b*(a.x-l.x))/P;return new E(a.x+D*x,a.y+D*g)},f.al=lb,f.am=Ba,f.an=z_,f.ao=zi,f.aq=ey,f.ar=function(a,r){var l=r[0],d=r[1],g=r[2],x=r[3],b=r[4],T=r[5],P=r[6],D=r[7],O=r[8],H=r[9],q=r[10],Q=r[11],ie=r[12],ce=r[13],me=r[14],we=r[15],De=l*T-d*b,Me=l*P-g*b,Re=l*D-x*b,et=d*P-g*T,ot=d*D-x*T,Dt=g*D-x*P,Yt=O*ce-H*ie,It=O*me-q*ie,Pt=O*we-Q*ie,xt=H*me-q*ce,Xt=H*we-Q*ce,At=q*we-Q*me,gt=De*At-Me*Xt+Re*xt+et*Pt-ot*It+Dt*Yt;return gt?(a[0]=(T*At-P*Xt+D*xt)*(gt=1/gt),a[1]=(g*Xt-d*At-x*xt)*gt,a[2]=(ce*Dt-me*ot+we*et)*gt,a[3]=(q*ot-H*Dt-Q*et)*gt,a[4]=(P*Pt-b*At-D*It)*gt,a[5]=(l*At-g*Pt+x*It)*gt,a[6]=(me*Re-ie*Dt-we*Me)*gt,a[7]=(O*Dt-q*Re+Q*Me)*gt,a[8]=(b*Xt-T*Pt+D*Yt)*gt,a[9]=(d*Pt-l*Xt-x*Yt)*gt,a[10]=(ie*ot-ce*Re+we*De)*gt,a[11]=(H*Re-O*ot-Q*De)*gt,a[12]=(T*It-b*xt-P*Yt)*gt,a[13]=(l*xt-d*It+g*Yt)*gt,a[14]=(ce*Me-ie*et-me*De)*gt,a[15]=(O*et-H*Me+q*De)*gt,a):null},f.as=cy,f.at=Q_,f.au=uy,f.av=function(){const a={},r=J.$version;for(const l in J.$root){const d=J.$root[l];if(d.required){let g=null;g=l==="version"?r:d.type==="array"?[]:{},g!=null&&(a[l]=g)}}return a},f.aw=td,f.ax=mn,f.ay=function(a){a=a.slice();const r=Object.create(null);for(let l=0;l<a.length;l++)r[a[l].id]=a[l];for(let l=0;l<a.length;l++)"ref"in a[l]&&(a[l]=Je(a[l],r[a[l].ref]));return a},f.az=function(a){if(a.type==="custom")return new jC(a);switch(a.type){case"background":return new VC(a);case"circle":return new EA(a);case"fill":return new $A(a);case"fill-extrusion":return new oC(a);case"heatmap":return new CA(a);case"hillshade":return new RA(a);case"line":return new mC(a);case"raster":return new HC(a);case"symbol":return new em(a)}},f.b=Ce,f.b0=function(a,r){return a[0]*r[0]+a[1]*r[1]+a[2]*r[2]+a[3]*r[3]},f.b1=Z,f.b2=tb,f.b3=Q1,f.b4=function(a,r,l,d,g){var x,b=1/Math.tan(r/2);return a[0]=b/l,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=b,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,g!=null&&g!==1/0?(a[10]=(g+d)*(x=1/(d-g)),a[14]=2*g*d*x):(a[10]=-1,a[14]=-2*d),a},f.b5=function(a,r,l){var d=Math.sin(l),g=Math.cos(l),x=r[4],b=r[5],T=r[6],P=r[7],D=r[8],O=r[9],H=r[10],q=r[11];return r!==a&&(a[0]=r[0],a[1]=r[1],a[2]=r[2],a[3]=r[3],a[12]=r[12],a[13]=r[13],a[14]=r[14],a[15]=r[15]),a[4]=x*g+D*d,a[5]=b*g+O*d,a[6]=T*g+H*d,a[7]=P*g+q*d,a[8]=D*g-x*d,a[9]=O*g-b*d,a[10]=H*g-T*d,a[11]=q*g-P*d,a},f.b6=V,f.b7=ee,f.b8=function(a){return a*Math.PI/180},f.b9=function(a,r){return a[0]=r[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=r[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=r[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a},f.bA=Da,f.ba=class extends Zc{},f.bb=sy,f.bc=tP,f.be=un,f.bf=function(a,r){_t.REGISTERED_PROTOCOLS[a]=r},f.bg=function(a){delete _t.REGISTERED_PROTOCOLS[a]},f.bh=function(a,r){const l={};for(let g=0;g<a.length;g++){const x=r&&r[a[g].id]||I_(a[g]);r&&(r[a[g].id]=x);let b=l[x];b||(b=l[x]=[]),b.push(a[g])}const d=[];for(const g in l)d.push(l[g]);return d},f.bi=Vt,f.bj=ib,f.bk=sb,f.bl=U1,f.bm=function(a){a.bucket.createArrays(),a.bucket.tilePixelRatio=Cn/(512*a.bucket.overscaling),a.bucket.compareText={},a.bucket.iconsNeedLinear=!1;const r=a.bucket.layers[0],l=r.layout,d=r._unevaluatedLayout._values,g={layoutIconSize:d["icon-size"].possiblyEvaluate(new ti(a.bucket.zoom+1),a.canonical),layoutTextSize:d["text-size"].possiblyEvaluate(new ti(a.bucket.zoom+1),a.canonical),textMaxSize:d["text-size"].possiblyEvaluate(new ti(18))};if(a.bucket.textSizeData.kind==="composite"){const{minZoom:D,maxZoom:O}=a.bucket.textSizeData;g.compositeTextSizes=[d["text-size"].possiblyEvaluate(new ti(D),a.canonical),d["text-size"].possiblyEvaluate(new ti(O),a.canonical)]}if(a.bucket.iconSizeData.kind==="composite"){const{minZoom:D,maxZoom:O}=a.bucket.iconSizeData;g.compositeIconSizes=[d["icon-size"].possiblyEvaluate(new ti(D),a.canonical),d["icon-size"].possiblyEvaluate(new ti(O),a.canonical)]}const x=l.get("text-line-height")*zi,b=l.get("text-rotation-alignment")!=="viewport"&&l.get("symbol-placement")!=="point",T=l.get("text-keep-upright"),P=l.get("text-size");for(const D of a.bucket.features){const O=l.get("text-font").evaluate(D,{},a.canonical).join(","),H=P.evaluate(D,{},a.canonical),q=g.layoutTextSize.evaluate(D,{},a.canonical),Q=g.layoutIconSize.evaluate(D,{},a.canonical),ie={horizontal:{},vertical:void 0},ce=D.text;let me,we=[0,0];if(ce){const Re=ce.toString(),et=l.get("text-letter-spacing").evaluate(D,{},a.canonical)*zi,ot=Wc(Re)?et:0,Dt=l.get("text-anchor").evaluate(D,{},a.canonical),Yt=_b(r,D,a.canonical);if(!Yt){const At=l.get("text-radial-offset").evaluate(D,{},a.canonical);we=At?gb(Dt,[At*zi,ly]):l.get("text-offset").evaluate(D,{},a.canonical).map(gt=>gt*zi)}let It=b?"center":l.get("text-justify").evaluate(D,{},a.canonical);const Pt=l.get("symbol-placement"),xt=Pt==="point"?l.get("text-max-width").evaluate(D,{},a.canonical)*zi:0,Xt=()=>{a.bucket.allowVerticalPlacement&&Nl(Re)&&(ie.vertical=Kp(ce,a.glyphMap,a.glyphPositions,a.imagePositions,O,xt,x,Dt,"left",ot,we,f.ah.vertical,!0,Pt,q,H))};if(!b&&Yt){const At=new Set;if(It==="auto")for(let tn=0;tn<Yt.values.length;tn+=2)At.add(cy(Yt.values[tn]));else At.add(It);let gt=!1;for(const tn of At)if(!ie.horizontal[tn])if(gt)ie.horizontal[tn]=ie.horizontal[0];else{const Jt=Kp(ce,a.glyphMap,a.glyphPositions,a.imagePositions,O,xt,x,"center",tn,ot,we,f.ah.horizontal,!1,Pt,q,H);Jt&&(ie.horizontal[tn]=Jt,gt=Jt.positionedLines.length===1)}Xt()}else{It==="auto"&&(It=cy(Dt));const At=Kp(ce,a.glyphMap,a.glyphPositions,a.imagePositions,O,xt,x,Dt,It,ot,we,f.ah.horizontal,!1,Pt,q,H);At&&(ie.horizontal[It]=At),Xt(),Nl(Re)&&b&&T&&(ie.vertical=Kp(ce,a.glyphMap,a.glyphPositions,a.imagePositions,O,xt,x,Dt,It,ot,we,f.ah.vertical,!1,Pt,q,H))}}let De=!1;if(D.icon&&D.icon.name){const Re=a.imageMap[D.icon.name];Re&&(me=FC(a.imagePositions[D.icon.name],l.get("icon-offset").evaluate(D,{},a.canonical),l.get("icon-anchor").evaluate(D,{},a.canonical)),De=!!Re.sdf,a.bucket.sdfIcons===void 0?a.bucket.sdfIcons=De:a.bucket.sdfIcons!==De&&Te("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Re.pixelRatio!==a.bucket.pixelRatio||l.get("icon-rotate").constantOr(1)!==0)&&(a.bucket.iconsNeedLinear=!0))}const Me=vb(ie.horizontal)||ie.vertical;a.bucket.iconsInText=!!Me&&Me.iconsInText,(Me||me)&&QC(a.bucket,D,ie,me,a.imageMap,g,q,Q,we,De,a.canonical)}a.showCollisionBoxes&&a.bucket.generateCollisionDebugBuffers()},f.bn=X_,f.bo=j_,f.bp=$_,f.bq=Fo,f.br=Z_,f.bs=class{constructor(a){this._marks={start:[a.url,"start"].join("#"),end:[a.url,"end"].join("#"),measure:a.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let a=performance.getEntriesByName(this._marks.measure);return a.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),a=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),a}},f.bt=function(a,r,l,d,g){return c(this,void 0,void 0,function*(){if(G())try{return yield Ye(a,r,l,d,g)}catch{}return function(x,b,T,P,D){const O=x.width,H=x.height;pt&&kt||(pt=new OffscreenCanvas(O,H),kt=pt.getContext("2d",{willReadFrequently:!0})),pt.width=O,pt.height=H,kt.drawImage(x,0,0,O,H);const q=kt.getImageData(b,T,P,D);return kt.clearRect(0,0,O,H),q.data}(a,r,l,d,g)})},f.bu=nb,f.bv=v,f.bw=w,f.bx=C1,f.by=qn,f.bz=function(a){return a.message===_n},f.c=Ze,f.d=a=>c(void 0,void 0,void 0,function*(){if(a.byteLength===0)return createImageBitmap(new ImageData(1,1));const r=new Blob([new Uint8Array(a)],{type:"image/png"});try{return createImageBitmap(r)}catch(l){throw new Error(`Could not load image because of ${l.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),f.e=te,f.f=a=>new Promise((r,l)=>{const d=new Image;d.onload=()=>{r(d),URL.revokeObjectURL(d.src),d.onload=null,window.requestAnimationFrame(()=>{d.src=Ke})},d.onerror=()=>l(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const g=new Blob([new Uint8Array(a)],{type:"image/png"});d.src=a.byteLength?URL.createObjectURL(g):Ke}),f.g=Ct,f.h=(a,r)=>yn(te(a,{type:"json"}),r),f.i=ut,f.j=Wt,f.k=Vn,f.l=(a,r)=>yn(te(a,{type:"arrayBuffer"}),r),f.m=yn,f.n=function(a){return new Z_(a).readFields(RC,[])},f.o=Sd,f.p=F1,f.q=_r,f.r=Jh,f.s=Fe,f.t=Rp,f.u=zt,f.v=J,f.w=Te,f.x=Ro,f.y=function([a,r,l]){return r+=90,r*=Math.PI/180,l*=Math.PI/180,{x:a*Math.cos(r)*Math.sin(l),y:a*Math.sin(r)*Math.sin(l),z:a*Math.cos(l)}},f.z=Dr}),o("worker",["./shared"],function(f){class c{constructor(k){this.keyCache={},k&&this.replace(k)}replace(k){this._layerConfigs={},this._layers={},this.update(k,[])}update(k,F){for(const Y of k){this._layerConfigs[Y.id]=Y;const ue=this._layers[Y.id]=f.az(Y);ue._featureFilter=f.a6(ue.filter),this.keyCache[Y.id]&&delete this.keyCache[Y.id]}for(const Y of F)delete this.keyCache[Y],delete this._layerConfigs[Y],delete this._layers[Y];this.familiesBySource={};const j=f.bh(Object.values(this._layerConfigs),this.keyCache);for(const Y of j){const ue=Y.map(Ge=>this._layers[Ge.id]),ye=ue[0];if(ye.visibility==="none")continue;const xe=ye.source||"";let he=this.familiesBySource[xe];he||(he=this.familiesBySource[xe]={});const Se=ye.sourceLayer||"_geojsonTileLayer";let Ne=he[Se];Ne||(Ne=he[Se]=[]),Ne.push(ue)}}}class v{constructor(k){const F={},j=[];for(const xe in k){const he=k[xe],Se=F[xe]={};for(const Ne in he){const Ge=he[+Ne];if(!Ge||Ge.bitmap.width===0||Ge.bitmap.height===0)continue;const ze={x:0,y:0,w:Ge.bitmap.width+2,h:Ge.bitmap.height+2};j.push(ze),Se[Ne]={rect:ze,metrics:Ge.metrics}}}const{w:Y,h:ue}=f.p(j),ye=new f.o({width:Y||1,height:ue||1});for(const xe in k){const he=k[xe];for(const Se in he){const Ne=he[+Se];if(!Ne||Ne.bitmap.width===0||Ne.bitmap.height===0)continue;const Ge=F[xe][Se].rect;f.o.copy(Ne.bitmap,ye,{x:0,y:0},{x:Ge.x+1,y:Ge.y+1},Ne.bitmap)}}this.image=ye,this.positions=F}}f.bi("GlyphAtlas",v);class w{constructor(k){this.tileID=new f.Q(k.tileID.overscaledZ,k.tileID.wrap,k.tileID.canonical.z,k.tileID.canonical.x,k.tileID.canonical.y),this.uid=k.uid,this.zoom=k.zoom,this.pixelRatio=k.pixelRatio,this.tileSize=k.tileSize,this.source=k.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=k.showCollisionBoxes,this.collectResourceTiming=!!k.collectResourceTiming,this.returnDependencies=!!k.returnDependencies,this.promoteId=k.promoteId,this.inFlightDependencies=[]}parse(k,F,j,Y){return f._(this,void 0,void 0,function*(){this.status="parsing",this.data=k,this.collisionBoxArray=new f.a4;const ue=new f.bj(Object.keys(k.layers).sort()),ye=new f.bk(this.tileID,this.promoteId);ye.bucketLayerIDs=[];const xe={},he={featureIndex:ye,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},Se=F.familiesBySource[this.source];for(const Ee in Se){const Ue=k.layers[Ee];if(!Ue)continue;Ue.version===1&&f.w(`Vector tile source "${this.source}" layer "${Ee}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Be=ue.encode(Ee),Ve=[];for(let vt=0;vt<Ue.length;vt++){const jt=Ue.feature(vt),bt=ye.getId(jt,Ee);Ve.push({feature:jt,id:bt,index:vt,sourceLayerIndex:Be})}for(const vt of Se[Ee]){const jt=vt[0];jt.source!==this.source&&f.w(`layer.source = ${jt.source} does not equal this.source = ${this.source}`),jt.minzoom&&this.zoom<Math.floor(jt.minzoom)||jt.maxzoom&&this.zoom>=jt.maxzoom||jt.visibility!=="none"&&(S(vt,this.zoom,j),(xe[jt.id]=jt.createBucket({index:ye.bucketLayerIDs.length,layers:vt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Be,sourceID:this.source})).populate(Ve,he,this.tileID.canonical),ye.bucketLayerIDs.push(vt.map(bt=>bt.id)))}}const Ne=f.aE(he.glyphDependencies,Ee=>Object.keys(Ee).map(Number));this.inFlightDependencies.forEach(Ee=>Ee==null?void 0:Ee.abort()),this.inFlightDependencies=[];let Ge=Promise.resolve({});if(Object.keys(Ne).length){const Ee=new AbortController;this.inFlightDependencies.push(Ee),Ge=Y.sendAsync({type:"getGlyphs",data:{stacks:Ne,source:this.source,tileID:this.tileID,type:"glyphs"}},Ee)}const ze=Object.keys(he.iconDependencies);let yt=Promise.resolve({});if(ze.length){const Ee=new AbortController;this.inFlightDependencies.push(Ee),yt=Y.sendAsync({type:"getImages",data:{icons:ze,source:this.source,tileID:this.tileID,type:"icons"}},Ee)}const Ht=Object.keys(he.patternDependencies);let qt=Promise.resolve({});if(Ht.length){const Ee=new AbortController;this.inFlightDependencies.push(Ee),qt=Y.sendAsync({type:"getImages",data:{icons:Ht,source:this.source,tileID:this.tileID,type:"patterns"}},Ee)}const[sn,on,Hn]=yield Promise.all([Ge,yt,qt]),zn=new v(sn),oe=new f.bl(on,Hn);for(const Ee in xe){const Ue=xe[Ee];Ue instanceof f.a5?(S(Ue.layers,this.zoom,j),f.bm({bucket:Ue,glyphMap:sn,glyphPositions:zn.positions,imageMap:on,imagePositions:oe.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Ue.hasPattern&&(Ue instanceof f.bn||Ue instanceof f.bo||Ue instanceof f.bp)&&(S(Ue.layers,this.zoom,j),Ue.addFeatures(he,this.tileID.canonical,oe.patternPositions))}return this.status="done",{buckets:Object.values(xe).filter(Ee=>!Ee.isEmpty()),featureIndex:ye,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:zn.image,imageAtlas:oe,glyphMap:this.returnDependencies?sn:null,iconMap:this.returnDependencies?on:null,glyphPositions:this.returnDependencies?zn.positions:null}})}}function S(se,k,F){const j=new f.a8(k);for(const Y of se)Y.recalculate(j,F)}class E{constructor(k,F,j){this.actor=k,this.layerIndex=F,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(k,F){return f._(this,void 0,void 0,function*(){const j=yield f.l(k.request,F);try{return{vectorTile:new f.bq.VectorTile(new f.br(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(Y){const ue=new Uint8Array(j.data);let ye=`Unable to parse the tile at ${k.request.url}, `;throw ye+=ue[0]===31&&ue[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${Y.messge}`,new Error(ye)}})}loadTile(k){return f._(this,void 0,void 0,function*(){const F=k.uid,j=!!(k&&k.request&&k.request.collectResourceTiming)&&new f.bs(k.request),Y=new w(k);this.loading[F]=Y;const ue=new AbortController;Y.abort=ue;try{const ye=yield this.loadVectorTile(k,ue);if(delete this.loading[F],!ye)return null;const xe=ye.rawData,he={};ye.expires&&(he.expires=ye.expires),ye.cacheControl&&(he.cacheControl=ye.cacheControl);const Se={};if(j){const Ge=j.finish();Ge&&(Se.resourceTiming=JSON.parse(JSON.stringify(Ge)))}Y.vectorTile=ye.vectorTile;const Ne=Y.parse(ye.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[F]=Y,this.fetching[F]={rawTileData:xe,cacheControl:he,resourceTiming:Se};try{const Ge=yield Ne;return f.e({rawTileData:xe.slice(0)},Ge,he,Se)}finally{delete this.fetching[F]}}catch(ye){throw delete this.loading[F],Y.status="done",this.loaded[F]=Y,ye}})}reloadTile(k){return f._(this,void 0,void 0,function*(){const F=k.uid;if(!this.loaded||!this.loaded[F])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[F];if(j.showCollisionBoxes=k.showCollisionBoxes,j.status==="parsing"){const Y=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let ue;if(this.fetching[F]){const{rawTileData:ye,cacheControl:xe,resourceTiming:he}=this.fetching[F];delete this.fetching[F],ue=f.e({rawTileData:ye.slice(0)},Y,xe,he)}else ue=Y;return ue}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(k){return f._(this,void 0,void 0,function*(){const F=this.loading,j=k.uid;F&&F[j]&&F[j].abort&&(F[j].abort.abort(),delete F[j])})}removeTile(k){return f._(this,void 0,void 0,function*(){this.loaded&&this.loaded[k.uid]&&delete this.loaded[k.uid]})}}class M{constructor(){this.loaded={}}loadTile(k){return f._(this,void 0,void 0,function*(){const{uid:F,encoding:j,rawImageData:Y,redFactor:ue,greenFactor:ye,blueFactor:xe,baseShift:he}=k,Se=Y.width+2,Ne=Y.height+2,Ge=f.b(Y)?new f.R({width:Se,height:Ne},yield f.bt(Y,-1,-1,Se,Ne)):Y,ze=new f.bu(F,Ge,j,ue,ye,xe,he);return this.loaded=this.loaded||{},this.loaded[F]=ze,ze})}removeTile(k){const F=this.loaded,j=k.uid;F&&F[j]&&delete F[j]}}function L(se,k){if(se.length!==0){U(se[0],k);for(var F=1;F<se.length;F++)U(se[F],!k)}}function U(se,k){for(var F=0,j=0,Y=0,ue=se.length,ye=ue-1;Y<ue;ye=Y++){var xe=(se[Y][0]-se[ye][0])*(se[ye][1]+se[Y][1]),he=F+xe;j+=Math.abs(F)>=Math.abs(xe)?F-he+xe:xe-he+F,F=he}F+j>=0!=!!k&&se.reverse()}var B=f.bv(function se(k,F){var j,Y=k&&k.type;if(Y==="FeatureCollection")for(j=0;j<k.features.length;j++)se(k.features[j],F);else if(Y==="GeometryCollection")for(j=0;j<k.geometries.length;j++)se(k.geometries[j],F);else if(Y==="Feature")se(k.geometry,F);else if(Y==="Polygon")L(k.coordinates,F);else if(Y==="MultiPolygon")for(j=0;j<k.coordinates.length;j++)L(k.coordinates[j],F);return k});const z=f.bq.VectorTileFeature.prototype.toGeoJSON;var R={exports:{}},G=f.bw,V=f.bq.VectorTileFeature,ee=fe;function fe(se,k){this.options=k||{},this.features=se,this.length=se.length}function Z(se,k){this.id=typeof se.id=="number"?se.id:void 0,this.type=se.type,this.rawGeometry=se.type===1?[se.geometry]:se.geometry,this.properties=se.tags,this.extent=k||4096}fe.prototype.feature=function(se){return new Z(this.features[se],this.options.extent)},Z.prototype.loadGeometry=function(){var se=this.rawGeometry;this.geometry=[];for(var k=0;k<se.length;k++){for(var F=se[k],j=[],Y=0;Y<F.length;Y++)j.push(new G(F[Y][0],F[Y][1]));this.geometry.push(j)}return this.geometry},Z.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var se=this.geometry,k=1/0,F=-1/0,j=1/0,Y=-1/0,ue=0;ue<se.length;ue++)for(var ye=se[ue],xe=0;xe<ye.length;xe++){var he=ye[xe];k=Math.min(k,he.x),F=Math.max(F,he.x),j=Math.min(j,he.y),Y=Math.max(Y,he.y)}return[k,j,F,Y]},Z.prototype.toGeoJSON=V.prototype.toGeoJSON;var te=f.bx,be=ee;function ae(se){var k=new te;return function(F,j){for(var Y in F.layers)j.writeMessage(3,K,F.layers[Y])}(se,k),k.finish()}function K(se,k){var F;k.writeVarintField(15,se.version||1),k.writeStringField(1,se.name||""),k.writeVarintField(5,se.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(F=0;F<se.length;F++)j.feature=se.feature(F),k.writeMessage(2,Pe,j);var Y=j.keys;for(F=0;F<Y.length;F++)k.writeStringField(3,Y[F]);var ue=j.values;for(F=0;F<ue.length;F++)k.writeMessage(4,ut,ue[F])}function Pe(se,k){var F=se.feature;F.id!==void 0&&k.writeVarintField(1,F.id),k.writeMessage(2,ke,se),k.writeVarintField(3,F.type),k.writeMessage(4,it,F)}function ke(se,k){var F=se.feature,j=se.keys,Y=se.values,ue=se.keycache,ye=se.valuecache;for(var xe in F.properties){var he=F.properties[xe],Se=ue[xe];if(he!==null){Se===void 0&&(j.push(xe),ue[xe]=Se=j.length-1),k.writeVarint(Se);var Ne=typeof he;Ne!=="string"&&Ne!=="boolean"&&Ne!=="number"&&(he=JSON.stringify(he));var Ge=Ne+":"+he,ze=ye[Ge];ze===void 0&&(Y.push(he),ye[Ge]=ze=Y.length-1),k.writeVarint(ze)}}}function Te(se,k){return(k<<3)+(7&se)}function je(se){return se<<1^se>>31}function it(se,k){for(var F=se.loadGeometry(),j=se.type,Y=0,ue=0,ye=F.length,xe=0;xe<ye;xe++){var he=F[xe],Se=1;j===1&&(Se=he.length),k.writeVarint(Te(1,Se));for(var Ne=j===3?he.length-1:he.length,Ge=0;Ge<Ne;Ge++){Ge===1&&j!==1&&k.writeVarint(Te(2,Ne-1));var ze=he[Ge].x-Y,yt=he[Ge].y-ue;k.writeVarint(je(ze)),k.writeVarint(je(yt)),Y+=ze,ue+=yt}j===3&&k.writeVarint(Te(7,1))}}function ut(se,k){var F=typeof se;F==="string"?k.writeStringField(1,se):F==="boolean"?k.writeBooleanField(7,se):F==="number"&&(se%1!=0?k.writeDoubleField(3,se):se<0?k.writeSVarintField(6,se):k.writeVarintField(5,se))}R.exports=ae,R.exports.fromVectorTileJs=ae,R.exports.fromGeojsonVt=function(se,k){k=k||{};var F={};for(var j in se)F[j]=new be(se[j].features,k),F[j].name=j,F[j].version=k.version,F[j].extent=k.extent;return ae({layers:F})},R.exports.GeoJSONWrapper=be;var st=f.bv(R.exports);const Ce={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:se=>se},Ke=Math.fround||(Ye=new Float32Array(1),se=>(Ye[0]=+se,Ye[0]));var Ye;const pt=3,kt=5,_n=6;class Ze{constructor(k){this.options=Object.assign(Object.create(Ce),k),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(k){const{log:F,minZoom:j,maxZoom:Y}=this.options;F&&console.time("total time");const ue=`prepare ${k.length} points`;F&&console.time(ue),this.points=k;const ye=[];for(let he=0;he<k.length;he++){const Se=k[he];if(!Se.geometry)continue;const[Ne,Ge]=Se.geometry.coordinates,ze=Ke(St(Ne)),yt=Ke(un(Ge));ye.push(ze,yt,1/0,he,-1,1),this.options.reduce&&ye.push(0)}let xe=this.trees[Y+1]=this._createTree(ye);F&&console.timeEnd(ue);for(let he=Y;he>=j;he--){const Se=+Date.now();xe=this.trees[he]=this._createTree(this._cluster(xe,he)),F&&console.log("z%d: %d clusters in %dms",he,xe.numItems,+Date.now()-Se)}return F&&console.timeEnd("total time"),this}getClusters(k,F){let j=((k[0]+180)%360+360)%360-180;const Y=Math.max(-90,Math.min(90,k[1]));let ue=k[2]===180?180:((k[2]+180)%360+360)%360-180;const ye=Math.max(-90,Math.min(90,k[3]));if(k[2]-k[0]>=360)j=-180,ue=180;else if(j>ue){const Ge=this.getClusters([j,Y,180,ye],F),ze=this.getClusters([-180,Y,ue,ye],F);return Ge.concat(ze)}const xe=this.trees[this._limitZoom(F)],he=xe.range(St(j),un(ye),St(ue),un(Y)),Se=xe.data,Ne=[];for(const Ge of he){const ze=this.stride*Ge;Ne.push(Se[ze+kt]>1?_t(Se,ze,this.clusterProps):this.points[Se[ze+pt]])}return Ne}getChildren(k){const F=this._getOriginId(k),j=this._getOriginZoom(k),Y="No cluster with the specified id.",ue=this.trees[j];if(!ue)throw new Error(Y);const ye=ue.data;if(F*this.stride>=ye.length)throw new Error(Y);const xe=this.options.radius/(this.options.extent*Math.pow(2,j-1)),he=ue.within(ye[F*this.stride],ye[F*this.stride+1],xe),Se=[];for(const Ne of he){const Ge=Ne*this.stride;ye[Ge+4]===k&&Se.push(ye[Ge+kt]>1?_t(ye,Ge,this.clusterProps):this.points[ye[Ge+pt]])}if(Se.length===0)throw new Error(Y);return Se}getLeaves(k,F,j){const Y=[];return this._appendLeaves(Y,k,F=F||10,j=j||0,0),Y}getTile(k,F,j){const Y=this.trees[this._limitZoom(k)],ue=Math.pow(2,k),{extent:ye,radius:xe}=this.options,he=xe/ye,Se=(j-he)/ue,Ne=(j+1+he)/ue,Ge={features:[]};return this._addTileFeatures(Y.range((F-he)/ue,Se,(F+1+he)/ue,Ne),Y.data,F,j,ue,Ge),F===0&&this._addTileFeatures(Y.range(1-he/ue,Se,1,Ne),Y.data,ue,j,ue,Ge),F===ue-1&&this._addTileFeatures(Y.range(0,Se,he/ue,Ne),Y.data,-1,j,ue,Ge),Ge.features.length?Ge:null}getClusterExpansionZoom(k){let F=this._getOriginZoom(k)-1;for(;F<=this.options.maxZoom;){const j=this.getChildren(k);if(F++,j.length!==1)break;k=j[0].properties.cluster_id}return F}_appendLeaves(k,F,j,Y,ue){const ye=this.getChildren(F);for(const xe of ye){const he=xe.properties;if(he&&he.cluster?ue+he.point_count<=Y?ue+=he.point_count:ue=this._appendLeaves(k,he.cluster_id,j,Y,ue):ue<Y?ue++:k.push(xe),k.length===j)break}return ue}_createTree(k){const F=new f.au(k.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<k.length;j+=this.stride)F.add(k[j],k[j+1]);return F.finish(),F.data=k,F}_addTileFeatures(k,F,j,Y,ue,ye){for(const xe of k){const he=xe*this.stride,Se=F[he+kt]>1;let Ne,Ge,ze;if(Se)Ne=Ct(F,he,this.clusterProps),Ge=F[he],ze=F[he+1];else{const qt=this.points[F[he+pt]];Ne=qt.properties;const[sn,on]=qt.geometry.coordinates;Ge=St(sn),ze=un(on)}const yt={type:1,geometry:[[Math.round(this.options.extent*(Ge*ue-j)),Math.round(this.options.extent*(ze*ue-Y))]],tags:Ne};let Ht;Ht=Se||this.options.generateId?F[he+pt]:this.points[F[he+pt]].id,Ht!==void 0&&(yt.id=Ht),ye.features.push(yt)}}_limitZoom(k){return Math.max(this.options.minZoom,Math.min(Math.floor(+k),this.options.maxZoom+1))}_cluster(k,F){const{radius:j,extent:Y,reduce:ue,minPoints:ye}=this.options,xe=j/(Y*Math.pow(2,F)),he=k.data,Se=[],Ne=this.stride;for(let Ge=0;Ge<he.length;Ge+=Ne){if(he[Ge+2]<=F)continue;he[Ge+2]=F;const ze=he[Ge],yt=he[Ge+1],Ht=k.within(he[Ge],he[Ge+1],xe),qt=he[Ge+kt];let sn=qt;for(const on of Ht){const Hn=on*Ne;he[Hn+2]>F&&(sn+=he[Hn+kt])}if(sn>qt&&sn>=ye){let on,Hn=ze*qt,zn=yt*qt,oe=-1;const Ee=((Ge/Ne|0)<<5)+(F+1)+this.points.length;for(const Ue of Ht){const Be=Ue*Ne;if(he[Be+2]<=F)continue;he[Be+2]=F;const Ve=he[Be+kt];Hn+=he[Be]*Ve,zn+=he[Be+1]*Ve,he[Be+4]=Ee,ue&&(on||(on=this._map(he,Ge,!0),oe=this.clusterProps.length,this.clusterProps.push(on)),ue(on,this._map(he,Be)))}he[Ge+4]=Ee,Se.push(Hn/sn,zn/sn,1/0,Ee,-1,sn),ue&&Se.push(oe)}else{for(let on=0;on<Ne;on++)Se.push(he[Ge+on]);if(sn>1)for(const on of Ht){const Hn=on*Ne;if(!(he[Hn+2]<=F)){he[Hn+2]=F;for(let zn=0;zn<Ne;zn++)Se.push(he[Hn+zn])}}}}return Se}_getOriginId(k){return k-this.points.length>>5}_getOriginZoom(k){return(k-this.points.length)%32}_map(k,F,j){if(k[F+kt]>1){const ye=this.clusterProps[k[F+_n]];return j?Object.assign({},ye):ye}const Y=this.points[k[F+pt]].properties,ue=this.options.map(Y);return j&&ue===Y?Object.assign({},ue):ue}}function _t(se,k,F){return{type:"Feature",id:se[k+pt],properties:Ct(se,k,F),geometry:{type:"Point",coordinates:[(j=se[k],360*(j-.5)),mn(se[k+1])]}};var j}function Ct(se,k,F){const j=se[k+kt],Y=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,ue=se[k+_n],ye=ue===-1?{}:Object.assign({},F[ue]);return Object.assign(ye,{cluster:!0,cluster_id:se[k+pt],point_count:j,point_count_abbreviated:Y})}function St(se){return se/360+.5}function un(se){const k=Math.sin(se*Math.PI/180),F=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return F<0?0:F>1?1:F}function mn(se){const k=(180-360*se)*Math.PI/180;return 360*Math.atan(Math.exp(k))/Math.PI-90}function yn(se,k,F,j){for(var Y,ue=j,ye=F-k>>1,xe=F-k,he=se[k],Se=se[k+1],Ne=se[F],Ge=se[F+1],ze=k+3;ze<F;ze+=3){var yt=Fe(se[ze],se[ze+1],he,Se,Ne,Ge);if(yt>ue)Y=ze,ue=yt;else if(yt===ue){var Ht=Math.abs(ze-ye);Ht<xe&&(Y=ze,xe=Ht)}}ue>j&&(Y-k>3&&yn(se,k,Y,j),se[Y+2]=ue,F-Y>3&&yn(se,Y,F,j))}function Fe(se,k,F,j,Y,ue){var ye=Y-F,xe=ue-j;if(ye!==0||xe!==0){var he=((se-F)*ye+(k-j)*xe)/(ye*ye+xe*xe);he>1?(F=Y,j=ue):he>0&&(F+=ye*he,j+=xe*he)}return(ye=se-F)*ye+(xe=k-j)*xe}function dn(se,k,F,j){var Y={id:se===void 0?null:se,type:k,geometry:F,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ue){var ye=ue.geometry,xe=ue.type;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")an(ue,ye);else if(xe==="Polygon"||xe==="MultiLineString")for(var he=0;he<ye.length;he++)an(ue,ye[he]);else if(xe==="MultiPolygon")for(he=0;he<ye.length;he++)for(var Se=0;Se<ye[he].length;Se++)an(ue,ye[he][Se])}(Y),Y}function an(se,k){for(var F=0;F<k.length;F+=3)se.minX=Math.min(se.minX,k[F]),se.minY=Math.min(se.minY,k[F+1]),se.maxX=Math.max(se.maxX,k[F]),se.maxY=Math.max(se.maxY,k[F+1])}function Vn(se,k,F,j){if(k.geometry){var Y=k.geometry.coordinates,ue=k.geometry.type,ye=Math.pow(F.tolerance/((1<<F.maxZoom)*F.extent),2),xe=[],he=k.id;if(F.promoteId?he=k.properties[F.promoteId]:F.generateId&&(he=j||0),ue==="Point")Wt(Y,xe);else if(ue==="MultiPoint")for(var Se=0;Se<Y.length;Se++)Wt(Y[Se],xe);else if(ue==="LineString")En(Y,xe,ye,!1);else if(ue==="MultiLineString"){if(F.lineMetrics){for(Se=0;Se<Y.length;Se++)En(Y[Se],xe=[],ye,!1),se.push(dn(he,"LineString",xe,k.properties));return}J(Y,xe,ye,!1)}else if(ue==="Polygon")J(Y,xe,ye,!0);else{if(ue!=="MultiPolygon"){if(ue==="GeometryCollection"){for(Se=0;Se<k.geometry.geometries.length;Se++)Vn(se,{id:he,geometry:k.geometry.geometries[Se],properties:k.properties},F,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Se=0;Se<Y.length;Se++){var Ne=[];J(Y[Se],Ne,ye,!0),xe.push(Ne)}}se.push(dn(he,ue,xe,k.properties))}}function Wt(se,k){k.push(re(se[0])),k.push(Je(se[1])),k.push(0)}function En(se,k,F,j){for(var Y,ue,ye=0,xe=0;xe<se.length;xe++){var he=re(se[xe][0]),Se=Je(se[xe][1]);k.push(he),k.push(Se),k.push(0),xe>0&&(ye+=j?(Y*Se-he*ue)/2:Math.sqrt(Math.pow(he-Y,2)+Math.pow(Se-ue,2))),Y=he,ue=Se}var Ne=k.length-3;k[2]=1,yn(k,0,Ne,F),k[Ne+2]=1,k.size=Math.abs(ye),k.start=0,k.end=k.size}function J(se,k,F,j){for(var Y=0;Y<se.length;Y++){var ue=[];En(se[Y],ue,F,j),k.push(ue)}}function re(se){return se/360+.5}function Je(se){var k=Math.sin(se*Math.PI/180),F=.5-.25*Math.log((1+k)/(1-k))/Math.PI;return F<0?0:F>1?1:F}function Xe(se,k,F,j,Y,ue,ye,xe){if(j/=k,ue>=(F/=k)&&ye<j)return se;if(ye<F||ue>=j)return null;for(var he=[],Se=0;Se<se.length;Se++){var Ne=se[Se],Ge=Ne.geometry,ze=Ne.type,yt=Y===0?Ne.minX:Ne.minY,Ht=Y===0?Ne.maxX:Ne.maxY;if(yt>=F&&Ht<j)he.push(Ne);else if(!(Ht<F||yt>=j)){var qt=[];if(ze==="Point"||ze==="MultiPoint")at(Ge,qt,F,j,Y);else if(ze==="LineString")ft(Ge,qt,F,j,Y,!1,xe.lineMetrics);else if(ze==="MultiLineString")mt(Ge,qt,F,j,Y,!1);else if(ze==="Polygon")mt(Ge,qt,F,j,Y,!0);else if(ze==="MultiPolygon")for(var sn=0;sn<Ge.length;sn++){var on=[];mt(Ge[sn],on,F,j,Y,!0),on.length&&qt.push(on)}if(qt.length){if(xe.lineMetrics&&ze==="LineString"){for(sn=0;sn<qt.length;sn++)he.push(dn(Ne.id,ze,qt[sn],Ne.tags));continue}ze!=="LineString"&&ze!=="MultiLineString"||(qt.length===1?(ze="LineString",qt=qt[0]):ze="MultiLineString"),ze!=="Point"&&ze!=="MultiPoint"||(ze=qt.length===3?"Point":"MultiPoint"),he.push(dn(Ne.id,ze,qt,Ne.tags))}}}return he.length?he:null}function at(se,k,F,j,Y){for(var ue=0;ue<se.length;ue+=3){var ye=se[ue+Y];ye>=F&&ye<=j&&(k.push(se[ue]),k.push(se[ue+1]),k.push(se[ue+2]))}}function ft(se,k,F,j,Y,ue,ye){for(var xe,he,Se=nn(se),Ne=Y===0?rn:Tt,Ge=se.start,ze=0;ze<se.length-3;ze+=3){var yt=se[ze],Ht=se[ze+1],qt=se[ze+2],sn=se[ze+3],on=se[ze+4],Hn=Y===0?yt:Ht,zn=Y===0?sn:on,oe=!1;ye&&(xe=Math.sqrt(Math.pow(yt-sn,2)+Math.pow(Ht-on,2))),Hn<F?zn>F&&(he=Ne(Se,yt,Ht,sn,on,F),ye&&(Se.start=Ge+xe*he)):Hn>j?zn<j&&(he=Ne(Se,yt,Ht,sn,on,j),ye&&(Se.start=Ge+xe*he)):Kt(Se,yt,Ht,qt),zn<F&&Hn>=F&&(he=Ne(Se,yt,Ht,sn,on,F),oe=!0),zn>j&&Hn<=j&&(he=Ne(Se,yt,Ht,sn,on,j),oe=!0),!ue&&oe&&(ye&&(Se.end=Ge+xe*he),k.push(Se),Se=nn(se)),ye&&(Ge+=xe)}var Ee=se.length-3;yt=se[Ee],Ht=se[Ee+1],qt=se[Ee+2],(Hn=Y===0?yt:Ht)>=F&&Hn<=j&&Kt(Se,yt,Ht,qt),Ee=Se.length-3,ue&&Ee>=3&&(Se[Ee]!==Se[0]||Se[Ee+1]!==Se[1])&&Kt(Se,Se[0],Se[1],Se[2]),Se.length&&k.push(Se)}function nn(se){var k=[];return k.size=se.size,k.start=se.start,k.end=se.end,k}function mt(se,k,F,j,Y,ue){for(var ye=0;ye<se.length;ye++)ft(se[ye],k,F,j,Y,ue,!1)}function Kt(se,k,F,j){se.push(k),se.push(F),se.push(j)}function rn(se,k,F,j,Y,ue){var ye=(ue-k)/(j-k);return se.push(ue),se.push(F+(Y-F)*ye),se.push(1),ye}function Tt(se,k,F,j,Y,ue){var ye=(ue-F)/(Y-F);return se.push(k+(j-k)*ye),se.push(ue),se.push(1),ye}function $t(se,k){for(var F=[],j=0;j<se.length;j++){var Y,ue=se[j],ye=ue.type;if(ye==="Point"||ye==="MultiPoint"||ye==="LineString")Y=qe(ue.geometry,k);else if(ye==="MultiLineString"||ye==="Polygon"){Y=[];for(var xe=0;xe<ue.geometry.length;xe++)Y.push(qe(ue.geometry[xe],k))}else if(ye==="MultiPolygon")for(Y=[],xe=0;xe<ue.geometry.length;xe++){for(var he=[],Se=0;Se<ue.geometry[xe].length;Se++)he.push(qe(ue.geometry[xe][Se],k));Y.push(he)}F.push(dn(ue.id,ye,Y,ue.tags))}return F}function qe(se,k){var F=[];F.size=se.size,se.start!==void 0&&(F.start=se.start,F.end=se.end);for(var j=0;j<se.length;j+=3)F.push(se[j]+k,se[j+1],se[j+2]);return F}function Gt(se,k){if(se.transformed)return se;var F,j,Y,ue=1<<se.z,ye=se.x,xe=se.y;for(F=0;F<se.features.length;F++){var he=se.features[F],Se=he.geometry,Ne=he.type;if(he.geometry=[],Ne===1)for(j=0;j<Se.length;j+=2)he.geometry.push(Nt(Se[j],Se[j+1],k,ue,ye,xe));else for(j=0;j<Se.length;j++){var Ge=[];for(Y=0;Y<Se[j].length;Y+=2)Ge.push(Nt(Se[j][Y],Se[j][Y+1],k,ue,ye,xe));he.geometry.push(Ge)}}return se.transformed=!0,se}function Nt(se,k,F,j,Y,ue){return[Math.round(F*(se*j-Y)),Math.round(F*(k*j-ue))]}function bn(se,k,F,j,Y){for(var ue=k===Y.maxZoom?0:Y.tolerance/((1<<k)*Y.extent),ye={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:F,y:j,z:k,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},xe=0;xe<se.length;xe++){ye.numFeatures++,wn(ye,se[xe],ue,Y);var he=se[xe].minX,Se=se[xe].minY,Ne=se[xe].maxX,Ge=se[xe].maxY;he<ye.minX&&(ye.minX=he),Se<ye.minY&&(ye.minY=Se),Ne>ye.maxX&&(ye.maxX=Ne),Ge>ye.maxY&&(ye.maxY=Ge)}return ye}function wn(se,k,F,j){var Y=k.geometry,ue=k.type,ye=[];if(ue==="Point"||ue==="MultiPoint")for(var xe=0;xe<Y.length;xe+=3)ye.push(Y[xe]),ye.push(Y[xe+1]),se.numPoints++,se.numSimplified++;else if(ue==="LineString")nt(ye,Y,se,F,!1,!1);else if(ue==="MultiLineString"||ue==="Polygon")for(xe=0;xe<Y.length;xe++)nt(ye,Y[xe],se,F,ue==="Polygon",xe===0);else if(ue==="MultiPolygon")for(var he=0;he<Y.length;he++){var Se=Y[he];for(xe=0;xe<Se.length;xe++)nt(ye,Se[xe],se,F,!0,xe===0)}if(ye.length){var Ne=k.tags||null;if(ue==="LineString"&&j.lineMetrics){for(var Ge in Ne={},k.tags)Ne[Ge]=k.tags[Ge];Ne.mapbox_clip_start=Y.start/Y.size,Ne.mapbox_clip_end=Y.end/Y.size}var ze={geometry:ye,type:ue==="Polygon"||ue==="MultiPolygon"?3:ue==="LineString"||ue==="MultiLineString"?2:1,tags:Ne};k.id!==null&&(ze.id=k.id),se.features.push(ze)}}function nt(se,k,F,j,Y,ue){var ye=j*j;if(j>0&&k.size<(Y?ye:j))F.numPoints+=k.length/3;else{for(var xe=[],he=0;he<k.length;he+=3)(j===0||k[he+2]>ye)&&(F.numSimplified++,xe.push(k[he]),xe.push(k[he+1])),F.numPoints++;Y&&function(Se,Ne){for(var Ge=0,ze=0,yt=Se.length,Ht=yt-2;ze<yt;Ht=ze,ze+=2)Ge+=(Se[ze]-Se[Ht])*(Se[ze+1]+Se[Ht+1]);if(Ge>0===Ne)for(ze=0,yt=Se.length;ze<yt/2;ze+=2){var qt=Se[ze],sn=Se[ze+1];Se[ze]=Se[yt-2-ze],Se[ze+1]=Se[yt-1-ze],Se[yt-2-ze]=qt,Se[yt-1-ze]=sn}}(xe,ue),se.push(xe)}}function Rt(se,k){var F=(k=this.options=function(Y,ue){for(var ye in ue)Y[ye]=ue[ye];return Y}(Object.create(this.options),k)).debug;if(F&&console.time("preprocess data"),k.maxZoom<0||k.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(k.promoteId&&k.generateId)throw new Error("promoteId and generateId cannot be used together.");var j=function(Y,ue){var ye=[];if(Y.type==="FeatureCollection")for(var xe=0;xe<Y.features.length;xe++)Vn(ye,Y.features[xe],ue,xe);else Vn(ye,Y.type==="Feature"?Y:{geometry:Y},ue);return ye}(se,k);this.tiles={},this.tileCoords=[],F&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",k.indexMaxZoom,k.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),j=function(Y,ue){var ye=ue.buffer/ue.extent,xe=Y,he=Xe(Y,1,-1-ye,ye,0,-1,2,ue),Se=Xe(Y,1,1-ye,2+ye,0,-1,2,ue);return(he||Se)&&(xe=Xe(Y,1,-ye,1+ye,0,-1,2,ue)||[],he&&(xe=$t(he,1).concat(xe)),Se&&(xe=xe.concat($t(Se,-1)))),xe}(j,k),j.length&&this.splitTile(j,0,0,0),F&&(j.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Lt(se,k,F){return 32*((1<<se)*F+k)+se}function Ot(se,k){return k?se.properties[k]:se.id}function $(se,k){if(se==null)return!0;if(se.type==="Feature")return Ot(se,k)!=null;if(se.type==="FeatureCollection"){const F=new Set;for(const j of se.features){const Y=Ot(j,k);if(Y==null||F.has(Y))return!1;F.add(Y)}return!0}return!1}function Le(se,k){const F=new Map;if(se!=null)if(se.type==="Feature")F.set(Ot(se,k),se);else for(const j of se.features)F.set(Ot(j,k),j);return F}Rt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Rt.prototype.splitTile=function(se,k,F,j,Y,ue,ye){for(var xe=[se,k,F,j],he=this.options,Se=he.debug;xe.length;){j=xe.pop(),F=xe.pop(),k=xe.pop(),se=xe.pop();var Ne=1<<k,Ge=Lt(k,F,j),ze=this.tiles[Ge];if(!ze&&(Se>1&&console.time("creation"),ze=this.tiles[Ge]=bn(se,k,F,j,he),this.tileCoords.push({z:k,x:F,y:j}),Se)){Se>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",k,F,j,ze.numFeatures,ze.numPoints,ze.numSimplified),console.timeEnd("creation"));var yt="z"+k;this.stats[yt]=(this.stats[yt]||0)+1,this.total++}if(ze.source=se,Y){if(k===he.maxZoom||k===Y)continue;var Ht=1<<Y-k;if(F!==Math.floor(ue/Ht)||j!==Math.floor(ye/Ht))continue}else if(k===he.indexMaxZoom||ze.numPoints<=he.indexMaxPoints)continue;if(ze.source=null,se.length!==0){Se>1&&console.time("clipping");var qt,sn,on,Hn,zn,oe,Ee=.5*he.buffer/he.extent,Ue=.5-Ee,Be=.5+Ee,Ve=1+Ee;qt=sn=on=Hn=null,zn=Xe(se,Ne,F-Ee,F+Be,0,ze.minX,ze.maxX,he),oe=Xe(se,Ne,F+Ue,F+Ve,0,ze.minX,ze.maxX,he),se=null,zn&&(qt=Xe(zn,Ne,j-Ee,j+Be,1,ze.minY,ze.maxY,he),sn=Xe(zn,Ne,j+Ue,j+Ve,1,ze.minY,ze.maxY,he),zn=null),oe&&(on=Xe(oe,Ne,j-Ee,j+Be,1,ze.minY,ze.maxY,he),Hn=Xe(oe,Ne,j+Ue,j+Ve,1,ze.minY,ze.maxY,he),oe=null),Se>1&&console.timeEnd("clipping"),xe.push(qt||[],k+1,2*F,2*j),xe.push(sn||[],k+1,2*F,2*j+1),xe.push(on||[],k+1,2*F+1,2*j),xe.push(Hn||[],k+1,2*F+1,2*j+1)}}},Rt.prototype.getTile=function(se,k,F){var j=this.options,Y=j.extent,ue=j.debug;if(se<0||se>24)return null;var ye=1<<se,xe=Lt(se,k=(k%ye+ye)%ye,F);if(this.tiles[xe])return Gt(this.tiles[xe],Y);ue>1&&console.log("drilling down to z%d-%d-%d",se,k,F);for(var he,Se=se,Ne=k,Ge=F;!he&&Se>0;)Se--,Ne=Math.floor(Ne/2),Ge=Math.floor(Ge/2),he=this.tiles[Lt(Se,Ne,Ge)];return he&&he.source?(ue>1&&console.log("found parent tile z%d-%d-%d",Se,Ne,Ge),ue>1&&console.time("drilling down"),this.splitTile(he.source,Se,Ne,Ge,se,k,F),ue>1&&console.timeEnd("drilling down"),this.tiles[xe]?Gt(this.tiles[xe],Y):null):null};class rt extends E{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(k,F){return f._(this,void 0,void 0,function*(){const j=k.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const Y=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!Y)return null;const ue=new class{constructor(xe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=f.W,this.length=xe.length,this._features=xe}feature(xe){return new class{constructor(he){this._feature=he,this.extent=f.W,this.type=he.type,this.properties=he.tags,"id"in he&&!isNaN(he.id)&&(this.id=parseInt(he.id,10))}loadGeometry(){if(this._feature.type===1){const he=[];for(const Se of this._feature.geometry)he.push([new f.P(Se[0],Se[1])]);return he}{const he=[];for(const Se of this._feature.geometry){const Ne=[];for(const Ge of Se)Ne.push(new f.P(Ge[0],Ge[1]));he.push(Ne)}return he}}toGeoJSON(he,Se,Ne){return z.call(this,he,Se,Ne)}}(this._features[xe])}}(Y.features);let ye=st(ue);return ye.byteOffset===0&&ye.byteLength===ye.buffer.byteLength||(ye=new Uint8Array(ye)),{vectorTile:ue,rawData:ye.buffer}})}loadData(k){return f._(this,void 0,void 0,function*(){var F;(F=this._pendingRequest)===null||F===void 0||F.abort();const j=!!(k&&k.request&&k.request.collectResourceTiming)&&new f.bs(k.request);this._pendingRequest=new AbortController;try{let Y=yield this.loadGeoJSON(k,this._pendingRequest);if(delete this._pendingRequest,typeof Y!="object")throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`);if(B(Y,!0),k.filter){const ye=f.by(k.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(ye.result==="error")throw new Error(ye.value.map(he=>`${he.key}: ${he.message}`).join(", "));Y={type:"FeatureCollection",features:Y.features.filter(he=>ye.value.evaluate({zoom:0},he))}}this._geoJSONIndex=k.cluster?new Ze(function({superclusterOptions:ye,clusterProperties:xe}){if(!xe||!ye)return ye;const he={},Se={},Ne={accumulated:null,zoom:0},Ge={properties:null},ze=Object.keys(xe);for(const yt of ze){const[Ht,qt]=xe[yt],sn=f.by(qt),on=f.by(typeof Ht=="string"?[Ht,["accumulated"],["get",yt]]:Ht);he[yt]=sn.value,Se[yt]=on.value}return ye.map=yt=>{Ge.properties=yt;const Ht={};for(const qt of ze)Ht[qt]=he[qt].evaluate(Ne,Ge);return Ht},ye.reduce=(yt,Ht)=>{Ge.properties=Ht;for(const qt of ze)Ne.accumulated=yt[qt],yt[qt]=Se[qt].evaluate(Ne,Ge)},ye}(k)).load(Y.features):function(ye,xe){return new Rt(ye,xe)}(Y,k.geojsonVtOptions),this.loaded={};const ue={};if(j){const ye=j.finish();ye&&(ue.resourceTiming={},ue.resourceTiming[k.source]=JSON.parse(JSON.stringify(ye)))}return ue}catch(Y){if(delete this._pendingRequest,f.bz(Y))return{abandoned:!0};throw Y}})}reloadTile(k){const F=this.loaded;return F&&F[k.uid]?super.reloadTile(k):this.loadTile(k)}loadGeoJSON(k,F){return f._(this,void 0,void 0,function*(){const{promoteId:j}=k;if(k.request){const Y=yield f.h(k.request,F);return this._dataUpdateable=$(Y.data,j)?Le(Y.data,j):void 0,Y.data}if(typeof k.data=="string")try{const Y=JSON.parse(k.data);return this._dataUpdateable=$(Y,j)?Le(Y,j):void 0,Y}catch{throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`)}if(!k.dataDiff)throw new Error(`Input data given to '${k.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${k.source}`);return function(Y,ue,ye){var xe,he,Se,Ne;if(ue.removeAll&&Y.clear(),ue.remove)for(const Ge of ue.remove)Y.delete(Ge);if(ue.add)for(const Ge of ue.add){const ze=Ot(Ge,ye);ze!=null&&Y.set(ze,Ge)}if(ue.update)for(const Ge of ue.update){let ze=Y.get(Ge.id);if(ze==null)continue;const yt=!Ge.removeAllProperties&&(((xe=Ge.removeProperties)===null||xe===void 0?void 0:xe.length)>0||((he=Ge.addOrUpdateProperties)===null||he===void 0?void 0:he.length)>0);if((Ge.newGeometry||Ge.removeAllProperties||yt)&&(ze=Object.assign({},ze),Y.set(Ge.id,ze),yt&&(ze.properties=Object.assign({},ze.properties))),Ge.newGeometry&&(ze.geometry=Ge.newGeometry),Ge.removeAllProperties)ze.properties={};else if(((Se=Ge.removeProperties)===null||Se===void 0?void 0:Se.length)>0)for(const Ht of Ge.removeProperties)Object.prototype.hasOwnProperty.call(ze.properties,Ht)&&delete ze.properties[Ht];if(((Ne=Ge.addOrUpdateProperties)===null||Ne===void 0?void 0:Ne.length)>0)for(const{key:Ht,value:qt}of Ge.addOrUpdateProperties)ze.properties[Ht]=qt}}(this._dataUpdateable,k.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(k){return f._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(k){return this._geoJSONIndex.getClusterExpansionZoom(k.clusterId)}getClusterChildren(k){return this._geoJSONIndex.getChildren(k.clusterId)}getClusterLeaves(k){return this._geoJSONIndex.getLeaves(k.clusterId,k.limit,k.offset)}}class wt{constructor(k){this.self=k,this.actor=new f.C(k),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(F,j)=>{if(this.externalWorkerSourceTypes[F])throw new Error(`Worker source with name "${F}" already registered.`);this.externalWorkerSourceTypes[F]=j},this.self.addProtocol=f.bf,this.self.removeProtocol=f.bg,this.self.registerRTLTextPlugin=F=>{if(f.bA.isParsed())throw new Error("RTL text plugin already registered.");f.bA.setMethods(F)},this.actor.registerMessageHandler("loadDEMTile",(F,j)=>this._getDEMWorkerSource(F,j.source).loadTile(j)),this.actor.registerMessageHandler("removeDEMTile",(F,j)=>f._(this,void 0,void 0,function*(){this._getDEMWorkerSource(F,j.source).removeTile(j)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(F,j)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(F,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("getClusterChildren",(F,j)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(F,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("getClusterLeaves",(F,j)=>f._(this,void 0,void 0,function*(){return this._getWorkerSource(F,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("loadData",(F,j)=>this._getWorkerSource(F,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("loadTile",(F,j)=>this._getWorkerSource(F,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("reloadTile",(F,j)=>this._getWorkerSource(F,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("abortTile",(F,j)=>this._getWorkerSource(F,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("removeTile",(F,j)=>this._getWorkerSource(F,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("removeSource",(F,j)=>f._(this,void 0,void 0,function*(){if(!this.workerSources[F]||!this.workerSources[F][j.type]||!this.workerSources[F][j.type][j.source])return;const Y=this.workerSources[F][j.type][j.source];delete this.workerSources[F][j.type][j.source],Y.removeSource!==void 0&&Y.removeSource(j)})),this.actor.registerMessageHandler("removeMap",F=>f._(this,void 0,void 0,function*(){delete this.layerIndexes[F],delete this.availableImages[F],delete this.workerSources[F],delete this.demWorkerSources[F]})),this.actor.registerMessageHandler("setReferrer",(F,j)=>f._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("syncRTLPluginState",(F,j)=>this._syncRTLPluginState(F,j)),this.actor.registerMessageHandler("importScript",(F,j)=>f._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("setImages",(F,j)=>this._setImages(F,j)),this.actor.registerMessageHandler("updateLayers",(F,j)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(F).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("setLayers",(F,j)=>f._(this,void 0,void 0,function*(){this._getLayerIndex(F).replace(j)}))}_setImages(k,F){return f._(this,void 0,void 0,function*(){this.availableImages[k]=F;for(const j in this.workerSources[k]){const Y=this.workerSources[k][j];for(const ue in Y)Y[ue].availableImages=F}})}_syncRTLPluginState(k,F){return f._(this,void 0,void 0,function*(){if(f.bA.isParsed())return f.bA.getState();if(F.pluginStatus!=="loading")return f.bA.setState(F),F;const j=F.pluginURL;if(this.self.importScripts(j),f.bA.isParsed()){const Y={pluginStatus:"loaded",pluginURL:j};return f.bA.setState(Y),Y}throw f.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(k){let F=this.availableImages[k];return F||(F=[]),F}_getLayerIndex(k){let F=this.layerIndexes[k];return F||(F=this.layerIndexes[k]=new c),F}_getWorkerSource(k,F,j){if(this.workerSources[k]||(this.workerSources[k]={}),this.workerSources[k][F]||(this.workerSources[k][F]={}),!this.workerSources[k][F][j]){const Y={sendAsync:(ue,ye)=>(ue.targetMapId=k,this.actor.sendAsync(ue,ye))};switch(F){case"vector":this.workerSources[k][F][j]=new E(Y,this._getLayerIndex(k),this._getAvailableImages(k));break;case"geojson":this.workerSources[k][F][j]=new rt(Y,this._getLayerIndex(k),this._getAvailableImages(k));break;default:this.workerSources[k][F][j]=new this.externalWorkerSourceTypes[F](Y,this._getLayerIndex(k),this._getAvailableImages(k))}}return this.workerSources[k][F][j]}_getDEMWorkerSource(k,F){return this.demWorkerSources[k]||(this.demWorkerSources[k]={}),this.demWorkerSources[k][F]||(this.demWorkerSources[k][F]=new M),this.demWorkerSources[k][F]}}return f.i(self)&&(self.worker=new wt(self)),wt}),o("index",["exports","./shared"],function(f,c){var v="4.1.2";let w,S;const E={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise((s,u)=>{const p=requestAnimationFrame(s);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),u(c.c())})}),getImageData(_,s=0){return this.getImageCanvasContext(_).getImageData(-s,-s,_.width+2*s,_.height+2*s)},getImageCanvasContext(_){const s=window.document.createElement("canvas"),u=s.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return s.width=_.width,s.height=_.height,u.drawImage(_,0,0,_.width,_.height),u},resolveURL:_=>(w||(w=document.createElement("a")),w.href=_,w.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class M{static testProp(s){if(!M.docStyle)return s[0];for(let u=0;u<s.length;u++)if(s[u]in M.docStyle)return s[u];return s[0]}static create(s,u,p){const m=window.document.createElement(s);return u!==void 0&&(m.className=u),p&&p.appendChild(m),m}static createNS(s,u){return window.document.createElementNS(s,u)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(s,u){s.style[M.transformProp]=u}static addEventListener(s,u,p,m={}){s.addEventListener(u,p,"passive"in m?m:m.capture)}static removeEventListener(s,u,p,m={}){s.removeEventListener(u,p,"passive"in m?m:m.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static getScale(s){const u=s.getBoundingClientRect();return{x:u.width/s.offsetWidth||1,y:u.height/s.offsetHeight||1,boundingClientRect:u}}static getPoint(s,u,p){const m=u.boundingClientRect;return new c.P((p.clientX-m.left)/u.x-s.clientLeft,(p.clientY-m.top)/u.y-s.clientTop)}static mousePos(s,u){const p=M.getScale(s);return M.getPoint(s,p,u)}static touchPos(s,u){const p=[],m=M.getScale(s);for(let y=0;y<u.length;y++)p.push(M.getPoint(s,m,u[y]));return p}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const L={supported:!1,testSupport:function(_){!z&&B&&(R?G(_):U=_)}};let U,B,z=!1,R=!1;function G(_){const s=_.createTexture();_.bindTexture(_.TEXTURE_2D,s);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,B),_.isContextLost())return;L.supported=!0}catch{}_.deleteTexture(s),z=!0}var V,ee;typeof document<"u"&&(B=document.createElement("img"),B.onload=function(){U&&G(U),U=null,R=!0},B.onerror=function(){z=!0,U=null},B.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let s,u,p,m;_.resetRequestQueue=()=>{s=[],u=0,p=0,m={}},_.addThrottleControl=I=>{const N=p++;return m[N]=I,N},_.removeThrottleControl=I=>{delete m[I],A()},_.getImage=(I,N,W=!0)=>new Promise((X,ne)=>{L.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),c.e(I,{type:"image"}),s.push({abortController:N,requestParameters:I,supportImageRefresh:W,state:"queued",onError:pe=>{ne(pe)},onSuccess:pe=>{X(pe)}}),A()});const y=I=>c._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:N,supportImageRefresh:W,onError:X,onSuccess:ne,abortController:pe}=I,de=W===!1&&!c.i(self)&&!c.g(N.url)&&(!N.headers||Object.keys(N.headers).reduce((Ae,Oe)=>Ae&&Oe==="accept",!0));u++;const _e=de?C(N,pe):c.m(N,pe);try{const Ae=yield _e;delete I.abortController,I.state="completed",Ae.data instanceof HTMLImageElement||c.b(Ae.data)?ne(Ae):Ae.data&&ne({data:yield(le=Ae.data,typeof createImageBitmap=="function"?c.d(le):c.f(le)),cacheControl:Ae.cacheControl,expires:Ae.expires})}catch(Ae){delete I.abortController,X(Ae)}finally{u--,A()}var le}),A=()=>{const I=(()=>{for(const N of Object.keys(m))if(m[N]())return!0;return!1})()?c.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:c.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let N=u;N<I&&s.length>0;N++){const W=s.shift();W.abortController.signal.aborted?N--:y(W)}},C=(I,N)=>new Promise((W,X)=>{const ne=new Image,pe=I.url,de=I.credentials;de&&de==="include"?ne.crossOrigin="use-credentials":(de&&de==="same-origin"||!c.s(pe))&&(ne.crossOrigin="anonymous"),N.signal.addEventListener("abort",()=>{ne.src="",X(c.c())}),ne.fetchPriority="high",ne.onload=()=>{ne.onerror=ne.onload=null,W({data:ne})},ne.onerror=()=>{ne.onerror=ne.onload=null,N.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},ne.src=pe})}(V||(V={})),V.resetRequestQueue(),function(_){_.Glyphs="Glyphs",_.Image="Image",_.Source="Source",_.SpriteImage="SpriteImage",_.SpriteJSON="SpriteJSON",_.Style="Style",_.Tile="Tile",_.Unknown="Unknown"}(ee||(ee={}));class fe{constructor(s){this._transformRequestFn=s}transformRequest(s,u){return this._transformRequestFn&&this._transformRequestFn(s,u)||{url:s}}normalizeSpriteURL(s,u,p){const m=function(y){const A=y.match(Z);if(!A)throw new Error(`Unable to parse URL "${y}"`);return{protocol:A[1],authority:A[2],path:A[3]||"/",params:A[4]?A[4].split("&"):[]}}(s);return m.path+=`${u}${p}`,function(y){const A=y.params.length?`?${y.params.join("&")}`:"";return`${y.protocol}://${y.authority}${y.path}${A}`}(m)}setTransformRequest(s){this._transformRequestFn=s}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function te(_){var s=new c.A(3);return s[0]=_[0],s[1]=_[1],s[2]=_[2],s}var be,ae=function(_,s,u){return _[0]=s[0]-u[0],_[1]=s[1]-u[1],_[2]=s[2]-u[2],_};be=new c.A(3),c.A!=Float32Array&&(be[0]=0,be[1]=0,be[2]=0);var K=function(_){var s=_[0],u=_[1];return s*s+u*u};function Pe(_){const s=[];if(typeof _=="string")s.push({id:"default",url:_});else if(_&&_.length>0){const u=[];for(const{id:p,url:m}of _){const y=`${p}${m}`;u.indexOf(y)===-1&&(u.push(y),s.push({id:p,url:m}))}}return s}(function(){var _=new c.A(2);c.A!=Float32Array&&(_[0]=0,_[1]=0)})();class ke{constructor(s,u,p,m){this.context=s,this.format=p,this.texture=s.gl.createTexture(),this.update(u,m)}update(s,u,p){const{width:m,height:y}=s,A=!(this.size&&this.size[0]===m&&this.size[1]===y||p),{context:C}=this,{gl:I}=C;if(this.useMipmap=!!(u&&u.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!u||u.premultiply!==!1)),A)this.size=[m,y],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||c.b(s)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,s):I.texImage2D(I.TEXTURE_2D,0,this.format,m,y,0,this.format,I.UNSIGNED_BYTE,s.data);else{const{x:N,y:W}=p||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||c.b(s)?I.texSubImage2D(I.TEXTURE_2D,0,N,W,I.RGBA,I.UNSIGNED_BYTE,s):I.texSubImage2D(I.TEXTURE_2D,0,N,W,m,y,I.RGBA,I.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(s,u,p){const{context:m}=this,{gl:y}=m;y.bindTexture(y.TEXTURE_2D,this.texture),p!==y.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=y.LINEAR),s!==this.filter&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MAG_FILTER,s),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_MIN_FILTER,p||s),this.filter=s),u!==this.wrap&&(y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_S,u),y.texParameteri(y.TEXTURE_2D,y.TEXTURE_WRAP_T,u),this.wrap=u)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Te(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class je extends c.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:u,promiseResolve:p}of this.requestors)p(this._getImagesForIds(u));this.requestors=[]}}getImage(s){const u=this.images[s];if(u&&!u.data&&u.spriteData){const p=u.spriteData;u.data=new c.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),u.spriteData=null}return u}addImage(s,u){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,u)&&(this.images[s]=u)}_validate(s,u){let p=!0;const m=u.data||u.spriteData;return this._validateStretch(u.stretchX,m&&m.width)||(this.fire(new c.j(new Error(`Image "${s}" has invalid "stretchX" value`))),p=!1),this._validateStretch(u.stretchY,m&&m.height)||(this.fire(new c.j(new Error(`Image "${s}" has invalid "stretchY" value`))),p=!1),this._validateContent(u.content,u)||(this.fire(new c.j(new Error(`Image "${s}" has invalid "content" value`))),p=!1),p}_validateStretch(s,u){if(!s)return!0;let p=0;for(const m of s){if(m[0]<p||m[1]<m[0]||u<m[1])return!1;p=m[1]}return!0}_validateContent(s,u){if(!s)return!0;if(s.length!==4)return!1;const p=u.spriteData,m=p&&p.width||u.data.width,y=p&&p.height||u.data.height;return!(s[0]<0||m<s[0]||s[1]<0||y<s[1]||s[2]<0||m<s[2]||s[3]<0||y<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,u,p=!0){const m=this.getImage(s);if(p&&(m.data.width!==u.data.width||m.data.height!==u.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${u.data.width}x${u.data.height}).`);u.version=m.version+1,this.images[s]=u,this.updatedImages[s]=!0}removeImage(s){const u=this.images[s];delete this.images[s],delete this.patterns[s],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((u,p)=>{let m=!0;if(!this.isLoaded())for(const y of s)this.images[y]||(m=!1);this.isLoaded()||m?u(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:u})})}_getImagesForIds(s){const u={};for(const p of s){let m=this.getImage(p);m||(this.fire(new c.k("styleimagemissing",{id:p})),m=this.getImage(p)),m?u[p]={data:m.data.clone(),pixelRatio:m.pixelRatio,sdf:m.sdf,version:m.version,stretchX:m.stretchX,stretchY:m.stretchY,content:m.content,hasRenderCallback:!!(m.userImage&&m.userImage.render)}:c.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return u}getPixelSize(){const{width:s,height:u}=this.atlasImage;return{width:s,height:u}}getPattern(s){const u=this.patterns[s],p=this.getImage(s);if(!p)return null;if(u&&u.position.version===p.version)return u.position;if(u)u.position.version=p.version;else{const m={w:p.data.width+2,h:p.data.height+2,x:0,y:0},y=new c.I(m,p);this.patterns[s]={bin:m,position:y}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const u=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ke(s,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const y in this.patterns)s.push(this.patterns[y].bin);const{w:u,h:p}=c.p(s),m=this.atlasImage;m.resize({width:u||1,height:p||1});for(const y in this.patterns){const{bin:A}=this.patterns[y],C=A.x+1,I=A.y+1,N=this.getImage(y).data,W=N.width,X=N.height;c.R.copy(N,m,{x:0,y:0},{x:C,y:I},{width:W,height:X}),c.R.copy(N,m,{x:0,y:X-1},{x:C,y:I-1},{width:W,height:1}),c.R.copy(N,m,{x:0,y:0},{x:C,y:I+X},{width:W,height:1}),c.R.copy(N,m,{x:W-1,y:0},{x:C-1,y:I},{width:1,height:X}),c.R.copy(N,m,{x:0,y:0},{x:C+W,y:I},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const u of s){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const p=this.getImage(u);p||c.w(`Image with ID: "${u}" was not found`),Te(p)&&this.updateImage(u,p)}}}const it=1e20;function ut(_,s,u,p,m,y,A,C,I){for(let N=s;N<s+p;N++)st(_,u*y+N,y,m,A,C,I);for(let N=u;N<u+m;N++)st(_,N*y+s,1,p,A,C,I)}function st(_,s,u,p,m,y,A){y[0]=0,A[0]=-it,A[1]=it,m[0]=_[s];for(let C=1,I=0,N=0;C<p;C++){m[C]=_[s+C*u];const W=C*C;do{const X=y[I];N=(m[C]-m[X]+W-X*X)/(C-X)/2}while(N<=A[I]&&--I>-1);I++,y[I]=C,A[I]=N,A[I+1]=it}for(let C=0,I=0;C<p;C++){for(;A[I+1]<C;)I++;const N=y[I],W=C-N;_[s+C*u]=m[N]+W*W}}class Ce{constructor(s,u){this.requestManager=s,this.localIdeographFontFamily=u,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return c._(this,void 0,void 0,function*(){const u=[];for(const y in s)for(const A of s[y])u.push(this._getAndCacheGlyphsPromise(y,A));const p=yield Promise.all(u),m={};for(const{stack:y,id:A,glyph:C}of p)m[y]||(m[y]={}),m[y][A]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return m})}_getAndCacheGlyphsPromise(s,u){return c._(this,void 0,void 0,function*(){let p=this.entries[s];p||(p=this.entries[s]={glyphs:{},requests:{},ranges:{}});let m=p.glyphs[u];if(m!==void 0)return{stack:s,id:u,glyph:m};if(m=this._tinySDF(p,s,u),m)return p.glyphs[u]=m,{stack:s,id:u,glyph:m};const y=Math.floor(u/256);if(256*y>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[y])return{stack:s,id:u,glyph:m};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[y]){const C=Ce.loadGlyphRange(s,y,this.url,this.requestManager);p.requests[y]=C}const A=yield p.requests[y];for(const C in A)this._doesCharSupportLocalGlyph(+C)||(p.glyphs[+C]=A[+C]);return p.ranges[y]=!0,{stack:s,id:u,glyph:A[u]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(c.u["CJK Unified Ideographs"](s)||c.u["Hangul Syllables"](s)||c.u.Hiragana(s)||c.u.Katakana(s))}_tinySDF(s,u,p){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(p))return;let y=s.tinySDF;if(!y){let C="400";/bold/i.test(u)?C="900":/medium/i.test(u)?C="500":/light/i.test(u)&&(C="200"),y=s.tinySDF=new Ce.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:m,fontWeight:C})}const A=y.draw(String.fromCharCode(p));return{id:p,bitmap:new c.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}Ce.loadGlyphRange=function(_,s,u,p){return c._(this,void 0,void 0,function*(){const m=256*s,y=m+255,A=p.transformRequest(u.replace("{fontstack}",_).replace("{range}",`${m}-${y}`),ee.Glyphs),C=yield c.l(A,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${s}, ${m}-${y}`);const I={};for(const N of c.n(C.data))I[N.id]=N;return I})},Ce.TinySDF=class{constructor({fontSize:_=24,buffer:s=3,radius:u=8,cutoff:p=.25,fontFamily:m="sans-serif",fontWeight:y="normal",fontStyle:A="normal"}={}){this.buffer=s,this.cutoff=p,this.radius=u;const C=this.size=_+4*s,I=this._createCanvas(C),N=this.ctx=I.getContext("2d",{willReadFrequently:!0});N.font=`${A} ${y} ${_}px ${m}`,N.textBaseline="alphabetic",N.textAlign="left",N.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(_){const s=document.createElement("canvas");return s.width=s.height=_,s}draw(_){const{width:s,actualBoundingBoxAscent:u,actualBoundingBoxDescent:p,actualBoundingBoxLeft:m,actualBoundingBoxRight:y}=this.ctx.measureText(_),A=Math.ceil(u),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(y-m))),I=Math.min(this.size-this.buffer,A+Math.ceil(p)),N=C+2*this.buffer,W=I+2*this.buffer,X=Math.max(N*W,0),ne=new Uint8ClampedArray(X),pe={data:ne,width:N,height:W,glyphWidth:C,glyphHeight:I,glyphTop:A,glyphLeft:0,glyphAdvance:s};if(C===0||I===0)return pe;const{ctx:de,buffer:_e,gridInner:le,gridOuter:Ae}=this;de.clearRect(_e,_e,C,I),de.fillText(_,_e,_e+A);const Oe=de.getImageData(_e,_e,C,I);Ae.fill(it,0,X),le.fill(0,0,X);for(let ve=0;ve<I;ve++)for(let Ie=0;Ie<C;Ie++){const He=Oe.data[4*(ve*C+Ie)+3]/255;if(He===0)continue;const We=(ve+_e)*N+Ie+_e;if(He===1)Ae[We]=0,le[We]=it;else{const Qe=.5-He;Ae[We]=Qe>0?Qe*Qe:0,le[We]=Qe<0?Qe*Qe:0}}ut(Ae,0,0,N,W,N,this.f,this.v,this.z),ut(le,_e,_e,C,I,N,this.f,this.v,this.z);for(let ve=0;ve<X;ve++){const Ie=Math.sqrt(Ae[ve])-Math.sqrt(le[ve]);ne[ve]=Math.round(255-255*(Ie/this.radius+this.cutoff))}return pe}};class Ke{constructor(){this.specification=c.v.light.position}possiblyEvaluate(s,u){return c.y(s.expression.evaluate(u))}interpolate(s,u,p){return{x:c.z.number(s.x,u.x,p),y:c.z.number(s.y,u.y,p),z:c.z.number(s.z,u.z,p)}}}let Ye;class pt extends c.E{constructor(s){super(),Ye=Ye||new c.q({anchor:new c.D(c.v.light.anchor),position:new Ke,color:new c.D(c.v.light.color),intensity:new c.D(c.v.light.intensity)}),this._transitionable=new c.T(Ye),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,u={}){if(!this._validate(c.r,s,u))for(const p in s){const m=s[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),m):this._transitionable.setValue(p,m)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,u,p){return(!p||p.validate!==!1)&&c.t(this,s.call(c.x,{value:u,style:{glyphs:!0,sprite:!0},styleSpec:c.v}))}}class kt{constructor(s,u){this.width=s,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,u){const p=s.join(",")+String(u);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(s,u)),this.dashEntry[p]}getDashRanges(s,u,p){const m=[];let y=s.length%2==1?-s[s.length-1]*p:0,A=s[0]*p,C=!0;m.push({left:y,right:A,isDash:C,zeroLength:s[0]===0});let I=s[0];for(let N=1;N<s.length;N++){C=!C;const W=s[N];y=I*p,I+=W,A=I*p,m.push({left:y,right:A,isDash:C,zeroLength:W===0})}return m}addRoundDash(s,u,p){const m=u/2;for(let y=-p;y<=p;y++){const A=this.width*(this.nextRow+p+y);let C=0,I=s[C];for(let N=0;N<this.width;N++){N/I.right>1&&(I=s[++C]);const W=Math.abs(N-I.left),X=Math.abs(N-I.right),ne=Math.min(W,X);let pe;const de=y/p*(m+1);if(I.isDash){const _e=m-Math.abs(de);pe=Math.sqrt(ne*ne+_e*_e)}else pe=m-Math.sqrt(ne*ne+de*de);this.data[A+N]=Math.max(0,Math.min(255,pe+128))}}}addRegularDash(s){for(let C=s.length-1;C>=0;--C){const I=s[C],N=s[C+1];I.zeroLength?s.splice(C,1):N&&N.isDash===I.isDash&&(N.left=I.left,s.splice(C,1))}const u=s[0],p=s[s.length-1];u.isDash===p.isDash&&(u.left=p.left-this.width,p.right=u.right+this.width);const m=this.width*this.nextRow;let y=0,A=s[y];for(let C=0;C<this.width;C++){C/A.right>1&&(A=s[++y]);const I=Math.abs(C-A.left),N=Math.abs(C-A.right),W=Math.min(I,N);this.data[m+C]=Math.max(0,Math.min(255,(A.isDash?W:-W)+128))}}addDash(s,u){const p=u?7:0,m=2*p+1;if(this.nextRow+m>this.height)return c.w("LineAtlas out of space"),null;let y=0;for(let C=0;C<s.length;C++)y+=s[C];if(y!==0){const C=this.width/y,I=this.getDashRanges(s,this.width,C);u?this.addRoundDash(I,C,p):this.addRegularDash(I)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:y};return this.nextRow+=m,this.dirty=!0,A}bind(s){const u=s.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))}}const _n="maplibre_preloaded_worker_pool";class Ze{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<Ze.workerCount;)this.workers.push(new Worker(c.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_n]}numActive(){return Object.keys(this.active).length}}const _t=Math.floor(E.hardwareConcurrency/2);let Ct,St;function un(){return Ct||(Ct=new Ze),Ct}Ze.workerCount=c.B(globalThis)?Math.max(Math.min(_t,3),1):1;class mn{constructor(s,u){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=u;const p=this.workerPool.acquire(u);for(let m=0;m<p.length;m++){const y=new c.C(p[m],u);y.name=`Worker ${m}`,this.actors.push(y)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,u){const p=[];for(const m of this.actors)p.push(m.sendAsync({type:s,data:u}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(u=>{u.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,u){for(const p of this.actors)p.registerMessageHandler(s,u)}}function yn(){return St||(St=new mn(un(),c.G),St.registerMessageHandler("getResource",(_,s,u)=>c.m(s,u))),St}function Fe(_,s){const u=c.F();return c.H(u,u,[1,1,0]),c.J(u,u,[.5*_.width,.5*_.height,1]),c.K(u,u,_.calculatePosMatrix(s.toUnwrapped()))}function dn(_,s,u,p,m,y){const A=function(X,ne,pe){if(X)for(const de of X){const _e=ne[de];if(_e&&_e.source===pe&&_e.type==="fill-extrusion")return!0}else for(const de in ne){const _e=ne[de];if(_e.source===pe&&_e.type==="fill-extrusion")return!0}return!1}(m&&m.layers,s,_.id),C=y.maxPitchScaleFactor(),I=_.tilesIn(p,C,A);I.sort(an);const N=[];for(const X of I)N.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(s,u,_._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,m,y,C,Fe(_.transform,X.tileID))});const W=function(X){const ne={},pe={};for(const de of X){const _e=de.queryResults,le=de.wrappedTileID,Ae=pe[le]=pe[le]||{};for(const Oe in _e){const ve=_e[Oe],Ie=Ae[Oe]=Ae[Oe]||{},He=ne[Oe]=ne[Oe]||[];for(const We of ve)Ie[We.featureIndex]||(Ie[We.featureIndex]=!0,He.push(We))}}return ne}(N);for(const X in W)W[X].forEach(ne=>{const pe=ne.feature,de=_.getFeatureState(pe.layer["source-layer"],pe.id);pe.source=pe.layer.source,pe.layer["source-layer"]&&(pe.sourceLayer=pe.layer["source-layer"]),pe.state=de});return W}function an(_,s){const u=_.tileID,p=s.tileID;return u.overscaledZ-p.overscaledZ||u.canonical.y-p.canonical.y||u.wrap-p.wrap||u.canonical.x-p.canonical.x}function Vn(_,s,u){return c._(this,void 0,void 0,function*(){let p=_;if(_.url?p=(yield c.h(s.transformRequest(_.url,ee.Source),u)).data:yield E.frameAsync(u),!p)return null;const m=c.L(c.e(p,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(m.vectorLayerIds=p.vector_layers.map(y=>y.id)),m})}class Wt{constructor(s,u){s&&(u?this.setSouthWest(s).setNorthEast(u):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof c.M?new c.M(s.lng,s.lat):c.M.convert(s),this}setSouthWest(s){return this._sw=s instanceof c.M?new c.M(s.lng,s.lat):c.M.convert(s),this}extend(s){const u=this._sw,p=this._ne;let m,y;if(s instanceof c.M)m=s,y=s;else{if(!(s instanceof Wt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Wt.convert(s)):this.extend(c.M.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(c.M.convert(s)):this;if(m=s._sw,y=s._ne,!m||!y)return this}return u||p?(u.lng=Math.min(m.lng,u.lng),u.lat=Math.min(m.lat,u.lat),p.lng=Math.max(y.lng,p.lng),p.lat=Math.max(y.lat,p.lat)):(this._sw=new c.M(m.lng,m.lat),this._ne=new c.M(y.lng,y.lat)),this}getCenter(){return new c.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new c.M(this.getWest(),this.getNorth())}getSouthEast(){return new c.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:u,lat:p}=c.M.convert(s);let m=this._sw.lng<=u&&u<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=u&&u>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&m}static convert(s){return s instanceof Wt?s:s&&new Wt(s)}static fromLngLat(s,u=0){const p=360*u/40075017,m=p/Math.cos(Math.PI/180*s.lat);return new Wt(new c.M(s.lng-m,s.lat-p),new c.M(s.lng+m,s.lat+p))}}class En{constructor(s,u,p){this.bounds=Wt.convert(this.validateBounds(s)),this.minzoom=u||0,this.maxzoom=p||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const u=Math.pow(2,s.z),p=Math.floor(c.N(this.bounds.getWest())*u),m=Math.floor(c.O(this.bounds.getNorth())*u),y=Math.ceil(c.N(this.bounds.getEast())*u),A=Math.ceil(c.O(this.bounds.getSouth())*u);return s.x>=p&&s.x<y&&s.y>=m&&s.y<A}}class J extends c.E{constructor(s,u,p,m){if(super(),this.id=s,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.e(this,c.L(u,["url","scheme","tileSize","promoteId"])),this._options=c.e({type:"vector"},u),this._collectResourceTiming=u.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Vn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(c.e(this,s),s.bounds&&(this.tileBounds=new En(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new c.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return c.e({},this._options)}loadTile(s){return c._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(u,ee.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let m="reloadTile";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((y,A)=>{s.reloadPromise={resolve:y,reject:A}})}else s.actor=this.dispatcher.getActor(),m="loadTile";s.abortController=new AbortController;try{const y=yield s.actor.sendAsync({type:m,data:p},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,y)}catch(y){if(delete s.abortController,s.aborted)return;if(y&&y.status!==404)throw y;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,u){if(u&&u.resourceTiming&&(s.resourceTiming=u.resourceTiming),u&&this.map._refreshExpiredTiles&&s.setExpiryData(u),s.loadVectorData(u,this.map.painter),s.reloadPromise){const p=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(p.resolve).catch(p.reject)}}abortTile(s){return c._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"abortTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return c._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class re extends c.E{constructor(s,u,p,m){super(),this.id=s,this.dispatcher=p,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.e({type:"raster"},u),c.e(this,c.L(u,["url","scheme","tileSize"]))}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Vn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(c.e(this,s),s.bounds&&(this.tileBounds=new En(s.bounds,this.minzoom,this.maxzoom)),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new c.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return c.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return c._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(u,ee.Tile),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&s.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const m=this.map.painter.context,y=m.gl,A=p.data;s.texture=this.map.painter.getTileTexture(A.width),s.texture?s.texture.update(A,{useMipmap:!0}):(s.texture=new ke(m,A,y.RGBA,{useMipmap:!0}),s.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE,y.LINEAR_MIPMAP_NEAREST),m.extTextureFilterAnisotropic&&y.texParameterf(y.TEXTURE_2D,m.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,m.extTextureFilterAnisotropicMax)),s.state="loaded"}}catch(p){if(delete s.abortController,s.aborted)s.state="unloaded";else if(p)throw s.state="errored",p}})}abortTile(s){return c._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return c._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class Je extends re{constructor(s,u,p,m){super(s,u,p,m),this.type="raster-dem",this.maxzoom=22,this._options=c.e({type:"raster-dem"},u),this.encoding=u.encoding||"mapbox",this.redFactor=u.redFactor,this.greenFactor=u.greenFactor,this.blueFactor=u.blueFactor,this.baseShift=u.baseShift}loadTile(s){return c._(this,void 0,void 0,function*(){const u=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(u,ee.Tile);s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const m=yield V.getImage(p,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){const y=m.data;this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const A=c.b(y)&&c.S()?y:yield this.readImageNow(y),C={type:this.type,uid:s.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const I=yield s.actor.sendAsync({type:"loadDEMTile",data:C});s.dem=I,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}})}readImageNow(s){return c._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&c.U()){const u=s.width+2,p=s.height+2;try{return new c.R({width:u,height:p},yield c.V(s,-1,-1,u,p))}catch{}}return E.getImageData(s,1)})}_getNeighboringTiles(s){const u=s.canonical,p=Math.pow(2,u.z),m=(u.x-1+p)%p,y=u.x===0?s.wrap-1:s.wrap,A=(u.x+1+p)%p,C=u.x+1===p?s.wrap+1:s.wrap,I={};return I[new c.Q(s.overscaledZ,y,u.z,m,u.y).key]={backfilled:!1},I[new c.Q(s.overscaledZ,C,u.z,A,u.y).key]={backfilled:!1},u.y>0&&(I[new c.Q(s.overscaledZ,y,u.z,m,u.y-1).key]={backfilled:!1},I[new c.Q(s.overscaledZ,s.wrap,u.z,u.x,u.y-1).key]={backfilled:!1},I[new c.Q(s.overscaledZ,C,u.z,A,u.y-1).key]={backfilled:!1}),u.y+1<p&&(I[new c.Q(s.overscaledZ,y,u.z,m,u.y+1).key]={backfilled:!1},I[new c.Q(s.overscaledZ,s.wrap,u.z,u.x,u.y+1).key]={backfilled:!1},I[new c.Q(s.overscaledZ,C,u.z,A,u.y+1).key]={backfilled:!1}),I}unloadTile(s){return c._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class Xe extends c.E{constructor(s,u,p,m){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(m),this._data=u.data,this._options=c.e({},u),this._collectResourceTiming=u.collectResourceTiming,u.maxzoom!==void 0&&(this.maxzoom=u.maxzoom),u.type&&(this.type=u.type),u.attribution&&(this.attribution=u.attribution),this.promoteId=u.promoteId;const y=c.W/this.tileSize;this.workerOptions=c.e({source:this.id,cluster:u.cluster||!1,geojsonVtOptions:{buffer:(u.buffer!==void 0?u.buffer:128)*y,tolerance:(u.tolerance!==void 0?u.tolerance:.375)*y,extent:c.W,maxZoom:this.maxzoom,lineMetrics:u.lineMetrics||!1,generateId:u.generateId||!1},superclusterOptions:{maxZoom:u.clusterMaxZoom!==void 0?u.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,u.clusterMinPoints||2),extent:c.W,radius:(u.clusterRadius||50)*y,log:!1,generateId:u.generateId||!1},clusterProperties:u.clusterProperties,filter:u.filter},u.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return c._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,u,p){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:s,limit:u,offset:p}})}_updateWorkerData(s){return c._(this,void 0,void 0,function*(){const u=c.e({type:this.type},this.workerOptions);s?u.dataDiff=s:typeof this._data=="string"?(u.request=this.map._requestManager.transformRequest(E.resolveURL(this._data),ee.Source),u.request.collectResourceTiming=this._collectResourceTiming):u.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new c.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"loadData",data:u});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new c.k("dataabort",{dataType:"source"}));let m=null;p.resourceTiming&&p.resourceTiming[this.id]&&(m=p.resourceTiming[this.id].slice(0));const y={dataType:"source"};this._collectResourceTiming&&m&&m.length>0&&c.e(y,{resourceTiming:m}),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"metadata"}))),this.fire(new c.k("data",Object.assign(Object.assign({},y),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new c.k("dataabort",{dataType:"source"}));this.fire(new c.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(s){return c._(this,void 0,void 0,function*(){const u=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const p={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const m=yield this.actor.sendAsync({type:u,data:p},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(m,this.map.painter,u==="reloadTile")})}abortTile(s){return c._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return c._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return c.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var at=c.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class ft extends c.E{constructor(s,u,p,m){super(),this.id=s,this.dispatcher=p,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=u}load(s){return c._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new c.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const u=yield V.getImage(this.map._requestManager.transformRequest(this.url,ee.Image),this._request);this._request=null,this._loaded=!0,u&&u.data&&(this.image=u.data,s&&(this.coordinates=s),this._finishLoading())}catch(u){this._request=null,this.fire(new c.j(u))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const u=s.map(c.Y.fromLngLat);this.tileID=function(m){let y=1/0,A=1/0,C=-1/0,I=-1/0;for(const ne of m)y=Math.min(y,ne.x),A=Math.min(A,ne.y),C=Math.max(C,ne.x),I=Math.max(I,ne.y);const N=Math.max(C-y,I-A),W=Math.max(0,Math.floor(-Math.log(N)/Math.LN2)),X=Math.pow(2,W);return new c.a0(W,Math.floor((y+C)/2*X),Math.floor((A+I)/2*X))}(u),this.minzoom=this.maxzoom=this.tileID.z;const p=u.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new c.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,c.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,c.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,c.W,c.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new c.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,at.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ke(s,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return c._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class nn extends ft{constructor(s,u,p,m){super(s,u,p,m),this.roundZoom=!0,this.type="video",this.options=u}load(){return c._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const u of s.urls)this.urls.push(this.map._requestManager.transformRequest(u,ee.Source).url);try{const u=yield c.a2(this.urls);if(this._loaded=!0,!u)return;this.video=u,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(u){this.fire(new c.j(u))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const u=this.video.seekable;s<u.start(0)||s>u.end(0)?this.fire(new c.j(new c.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${u.start(0)} and ${u.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,u=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,at.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.texSubImage2D(u.TEXTURE_2D,0,0,0,u.RGBA,u.UNSIGNED_BYTE,this.video)):(this.texture=new ke(s,this.video,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE));let p=!1;for(const m in this.tiles){const y=this.tiles[m];y.state!=="loaded"&&(y.state="loaded",y.texture=this.texture,p=!0)}p&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class mt extends ft{constructor(s,u,p,m){super(s,u,p,m),u.coordinates?Array.isArray(u.coordinates)&&u.coordinates.length===4&&!u.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(A=>typeof A!="number"))||this.fire(new c.j(new c.a1(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.j(new c.a1(`sources.${s}`,null,'missing required property "coordinates"'))),u.animate&&typeof u.animate!="boolean"&&this.fire(new c.j(new c.a1(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),u.canvas?typeof u.canvas=="string"||u.canvas instanceof HTMLCanvasElement||this.fire(new c.j(new c.a1(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.j(new c.a1(`sources.${s}`,null,'missing required property "canvas"'))),this.options=u,this.animate=u.animate===void 0||u.animate}load(){return c._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const u=this.map.painter.context,p=u.gl;this.boundsBuffer||(this.boundsBuffer=u.createVertexBuffer(this._boundsArray,at.members)),this.boundsSegments||(this.boundsSegments=c.$.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ke(u,this.canvas,p.RGBA,{premultiply:!0});let m=!1;for(const y in this.tiles){const A=this.tiles[y];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,m=!0)}m&&this.fire(new c.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const Kt={},rn=_=>{switch(_){case"geojson":return Xe;case"image":return ft;case"raster":return re;case"raster-dem":return Je;case"vector":return J;case"video":return nn;case"canvas":return mt}return Kt[_]},Tt="RTLPluginLoaded";class $t extends c.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=yn()}_syncState(s){return this.status=s,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s,pluginURL:this.url}).catch(u=>{throw this.status="error",u})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return c._(this,arguments,void 0,function*(u,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=E.resolveURL(u),!this.url)throw new Error(`requested url ${u} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return c._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new c.k(Tt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let qe=null;function Gt(){return qe||(qe=new $t),qe}class Nt{constructor(s,u){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=c.a3(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const u=s+this.timeAdded;u<this.fadeEndTime||(this.fadeEndTime=u)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,u,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(m,y){const A={};if(!y)return A;for(const C of m){const I=C.layerIds.map(N=>y.getLayer(N)).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(N=>I.filter(W=>W.id===N)[0]));for(const N of I)A[N.id]=C}}return A}(s.buckets,u.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const y=this.buckets[m];if(y instanceof c.a5){if(this.hasSymbolBuckets=!0,!p)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const y=this.buckets[m];if(y instanceof c.a5&&y.hasRTLText){this.hasRTLText=!0,Gt().lazyLoad();break}}this.queryPadding=0;for(const m in this.buckets){const y=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(m).queryRadius(y))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new c.a4}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const p in this.buckets){const m=this.buckets[p];m.uploadPending()&&m.upload(s)}const u=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ke(s,this.imageAtlas.image,u.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ke(s,this.glyphAtlasImage,u.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,u,p,m,y,A,C,I,N,W){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:y,scale:A,tileSize:this.tileSize,pixelPosMatrix:W,transform:I,params:C,queryPadding:this.queryPadding*N},s,u,p):{}}querySourceFeatures(s,u){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const m=p.loadVTLayers(),y=u&&u.sourceLayer?u.sourceLayer:"",A=m._geojsonTileLayer||m[y];if(!A)return;const C=c.a6(u&&u.filter),{z:I,x:N,y:W}=this.tileID.canonical,X={z:I,x:N,y:W};for(let ne=0;ne<A.length;ne++){const pe=A.feature(ne);if(C.needGeometry){const le=c.a7(pe,!0);if(!C.filter(new c.a8(this.tileID.overscaledZ),le,this.tileID.canonical))continue}else if(!C.filter(new c.a8(this.tileID.overscaledZ),pe))continue;const de=p.getId(pe,y),_e=new c.a9(pe,I,N,W,de);_e.tile=X,s.push(_e)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const u=this.expirationTime;if(s.cacheControl){const p=c.aa(s.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const p=Date.now();let m=!1;if(this.expirationTime>p)m=!1;else if(u)if(this.expirationTime<u)m=!0;else{const y=this.expirationTime-u;y?this.expirationTime=p+Math.max(y,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,u){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!u.style.hasLayer(m))continue;const y=this.buckets[m],A=y.layers[0].sourceLayer||"_geojsonTileLayer",C=p[A],I=s[A];if(!C||!I||Object.keys(I).length===0)continue;y.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const N=u&&u.style&&u.style.getLayer(m);N&&(this.queryPadding=Math.max(this.queryPadding,N.queryRadius(y)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<E.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=E.now()+s}setDependencies(s,u){const p={};for(const m of u)p[m]=!0;this.dependencies[s]=p}hasDependency(s,u){for(const p of s){const m=this.dependencies[p];if(m){for(const y of u)if(m[y])return!0}}return!1}}class bn{constructor(s,u){this.max=s,this.onRemove=u,this.reset()}reset(){for(const s in this.data)for(const u of this.data[s])u.timeout&&clearTimeout(u.timeout),this.onRemove(u.value);return this.data={},this.order=[],this}add(s,u,p){const m=s.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const y={value:u,timeout:void 0};if(p!==void 0&&(y.timeout=setTimeout(()=>{this.remove(s,y)},p)),this.data[m].push(y),this.order.push(m),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const u=this.data[s].shift();return u.timeout&&clearTimeout(u.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),u.value}getByKey(s){const u=this.data[s];return u?u[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,u){if(!this.has(s))return this;const p=s.wrapped().key,m=u===void 0?0:this.data[p].indexOf(u),y=this.data[p][m];return this.data[p].splice(m,1),y.timeout&&clearTimeout(y.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(y.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this}filter(s){const u=[];for(const p in this.data)for(const m of this.data[p])s(m.value)||u.push(m);for(const p of u)this.remove(p.value.tileID,p)}}class wn{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,u,p){const m=String(u);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][m]=this.stateChanges[s][m]||{},c.e(this.stateChanges[s][m],p),this.deletedStates[s]===null){this.deletedStates[s]={};for(const y in this.state[s])y!==m&&(this.deletedStates[s][y]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][m]===null){this.deletedStates[s][m]={};for(const y in this.state[s][m])p[y]||(this.deletedStates[s][m][y]=null)}else for(const y in p)this.deletedStates[s]&&this.deletedStates[s][m]&&this.deletedStates[s][m][y]===null&&delete this.deletedStates[s][m][y]}removeFeatureState(s,u,p){if(this.deletedStates[s]===null)return;const m=String(u);if(this.deletedStates[s]=this.deletedStates[s]||{},p&&u!==void 0)this.deletedStates[s][m]!==null&&(this.deletedStates[s][m]=this.deletedStates[s][m]||{},this.deletedStates[s][m][p]=null);else if(u!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][m])for(p in this.deletedStates[s][m]={},this.stateChanges[s][m])this.deletedStates[s][m][p]=null;else this.deletedStates[s][m]=null;else this.deletedStates[s]=null}getState(s,u){const p=String(u),m=c.e({},(this.state[s]||{})[p],(this.stateChanges[s]||{})[p]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const y=this.deletedStates[s][u];if(y===null)return{};for(const A in y)delete m[A]}return m}initializeTileState(s,u){s.setFeatureState(this.state,u)}coalesceChanges(s,u){const p={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const y={};for(const A in this.stateChanges[m])this.state[m][A]||(this.state[m][A]={}),c.e(this.state[m][A],this.stateChanges[m][A]),y[A]=this.state[m][A];p[m]=y}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const y={};if(this.deletedStates[m]===null)for(const A in this.state[m])y[A]={},this.state[m][A]={};else for(const A in this.deletedStates[m]){if(this.deletedStates[m][A]===null)this.state[m][A]={};else for(const C of Object.keys(this.deletedStates[m][A]))delete this.state[m][A][C];y[A]=this.state[m][A]}p[m]=p[m]||{},c.e(p[m],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const m in s)s[m].setFeatureState(p,u)}}class nt extends c.E{constructor(s,u,p){super(),this.id=s,this.dispatcher=p,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((m,y,A,C)=>{const I=new(rn(y.type))(m,y,A,C);if(I.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${I.id}`);return I})(s,u,p,this),this._tiles={},this._cache=new bn(0,m=>this._unloadTile(m)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new wn,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const u=this._tiles[s];if(u.state!=="loaded"&&u.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,u,p){return c._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,u,p)}catch(m){s.state="errored",m.status!==404?this._source.fire(new c.j(m,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new c.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const u in this._tiles){const p=this._tiles[u];p.upload(s),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Rt).map(s=>s.key)}getRenderableIds(s){const u=[];for(const p in this._tiles)this._isIdRenderable(p,s)&&u.push(this._tiles[p]);return s?u.sort((p,m)=>{const y=p.tileID,A=m.tileID,C=new c.P(y.canonical.x,y.canonical.y)._rotate(this.transform.angle),I=new c.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return y.overscaledZ-A.overscaledZ||I.y-C.y||I.x-C.x}).map(p=>p.tileID.key):u.map(p=>p.tileID).sort(Rt).map(p=>p.key)}hasRenderableParent(s){const u=this.findLoadedParent(s,0);return!!u&&this._isIdRenderable(u.tileID.key)}_isIdRenderable(s,u){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(u||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,u){return c._(this,void 0,void 0,function*(){const p=this._tiles[s];p&&(p.state!=="loading"&&(p.state=u),yield this._loadTile(p,s,u))})}_tileLoaded(s,u,p){s.timeAdded=E.now(),p==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(u,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new c.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const u=this.getRenderableIds();for(let m=0;m<u.length;m++){const y=u[m];if(s.neighboringTiles&&s.neighboringTiles[y]){const A=this.getTileByID(y);p(s,A),p(A,s)}}function p(m,y){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let A=y.tileID.canonical.x-m.tileID.canonical.x;const C=y.tileID.canonical.y-m.tileID.canonical.y,I=Math.pow(2,m.tileID.canonical.z),N=y.tileID.key;A===0&&C===0||Math.abs(C)>1||(Math.abs(A)>1&&(Math.abs(A+I)===1?A+=I:Math.abs(A-I)===1&&(A-=I)),y.dem&&m.dem&&(m.dem.backfillBorder(y.dem,A,C),m.neighboringTiles&&m.neighboringTiles[N]&&(m.neighboringTiles[N].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,u,p,m){for(const y in this._tiles){let A=this._tiles[y];if(m[y]||!A.hasData()||A.tileID.overscaledZ<=u||A.tileID.overscaledZ>p)continue;let C=A.tileID;for(;A&&A.tileID.overscaledZ>u+1;){const N=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[N.key],A&&A.hasData()&&(C=N)}let I=C;for(;I.overscaledZ>u;)if(I=I.scaledTo(I.overscaledZ-1),s[I.key]){m[C.key]=C;break}}}findLoadedParent(s,u){if(s.key in this._loadedParentTiles){const p=this._loadedParentTiles[s.key];return p&&p.tileID.overscaledZ>=u?p:null}for(let p=s.overscaledZ-1;p>=u;p--){const m=s.scaledTo(p),y=this._getLoadedTile(m);if(y)return y}}_getLoadedTile(s){const u=this._tiles[s.key];return u&&u.hasData()?u:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const u=Math.ceil(s.width/this._source.tileSize)+1,p=Math.ceil(s.height/this._source.tileSize)+1,m=Math.floor(u*p*(this._maxTileCacheZoomLevels===null?c.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),y=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(y)}handleWrapJump(s){const u=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,u){const p={};for(const m in this._tiles){const y=this._tiles[m];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+u),p[y.tileID.key]=y}this._tiles=p;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(s,u){if(this.transform=s,this.terrain=u,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(W=>new c.Q(W.canonical.z,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y)):(p=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:u}),this._source.hasTile&&(p=p.filter(W=>this._source.hasTile(W)))):p=[];const m=s.coveringZoomLevel(this._source),y=Math.max(m-nt.maxOverzooming,this._source.minzoom),A=Math.max(m+nt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const W={};for(const X of p)if(X.canonical.z>this._source.minzoom){const ne=X.scaledTo(X.canonical.z-1);W[ne.key]=ne;const pe=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));W[pe.key]=pe}p=p.concat(Object.values(W))}const C=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new c.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(p,m);if(Lt(this._source.type)){const W={},X={},ne=Object.keys(I),pe=E.now();for(const de of ne){const _e=I[de],le=this._tiles[de];if(!le||le.fadeEndTime!==0&&le.fadeEndTime<=pe)continue;const Ae=this.findLoadedParent(_e,y);Ae&&(this._addTile(Ae.tileID),W[Ae.tileID.key]=Ae.tileID),X[de]=_e}this._retainLoadedChildren(X,m,A,I);for(const de in W)I[de]||(this._coveredTiles[de]=!0,I[de]=W[de]);if(u){const de={},_e={};for(const le of p)this._tiles[le.key].hasData()?de[le.key]=le:_e[le.key]=le;for(const le in _e){const Ae=_e[le].children(this._source.maxzoom);this._tiles[Ae[0].key]&&this._tiles[Ae[1].key]&&this._tiles[Ae[2].key]&&this._tiles[Ae[3].key]&&(de[Ae[0].key]=I[Ae[0].key]=Ae[0],de[Ae[1].key]=I[Ae[1].key]=Ae[1],de[Ae[2].key]=I[Ae[2].key]=Ae[2],de[Ae[3].key]=I[Ae[3].key]=Ae[3],delete _e[le])}for(const le in _e){const Ae=this.findLoadedParent(_e[le],this._source.minzoom);if(Ae){de[Ae.tileID.key]=I[Ae.tileID.key]=Ae.tileID;for(const Oe in de)de[Oe].isChildOf(Ae.tileID)&&delete de[Oe]}}for(const le in this._tiles)de[le]||(this._coveredTiles[le]=!0)}}for(const W in I)this._tiles[W].clearFadeHold();const N=c.ab(this._tiles,I);for(const W of N){const X=this._tiles[W];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(W)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,u){const p={},m={},y=Math.max(u-nt.maxOverzooming,this._source.minzoom),A=Math.max(u+nt.maxUnderzooming,this._source.minzoom),C={};for(const I of s){const N=this._addTile(I);p[I.key]=I,N.hasData()||u<this._source.maxzoom&&(C[I.key]=I)}this._retainLoadedChildren(C,u,A,p);for(const I of s){let N=this._tiles[I.key];if(N.hasData())continue;if(u+1>this._source.maxzoom){const X=I.children(this._source.maxzoom)[0],ne=this.getTile(X);if(ne&&ne.hasData()){p[X.key]=X;continue}}else{const X=I.children(this._source.maxzoom);if(p[X[0].key]&&p[X[1].key]&&p[X[2].key]&&p[X[3].key])continue}let W=N.wasRequested();for(let X=I.overscaledZ-1;X>=y;--X){const ne=I.scaledTo(X);if(m[ne.key])break;if(m[ne.key]=!0,N=this.getTile(ne),!N&&W&&(N=this._addTile(ne)),N){const pe=N.hasData();if((W||pe)&&(p[ne.key]=ne),W=N.wasRequested(),pe)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const u=[];let p,m=this._tiles[s].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){p=this._loadedParentTiles[m.key];break}u.push(m.key);const y=m.scaledTo(m.overscaledZ-1);if(p=this._getLoadedTile(y),p)break;m=y}for(const y of u)this._loadedParentTiles[y]=p}}_addTile(s){let u=this._tiles[s.key];if(u)return u;u=this._cache.getAndRemove(s),u&&(this._setTileReloadTimer(s.key,u),u.tileID=s,this._state.initializeTileState(u,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,u)));const p=u;return u||(u=new Nt(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(u,s.key,u.state)),u.uses++,this._tiles[s.key]=u,p||this._source.fire(new c.k("dataloading",{tile:u,coord:u.tileID,dataType:"source"})),u}_setTileReloadTimer(s,u){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const p=u.getExpiryTimeout();p&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},p))}_removeTile(s){const u=this._tiles[s];u&&(u.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),u.uses>0||(u.hasData()&&u.state!=="reloading"?this._cache.add(u.tileID,u,u.getExpiryTimeout()):(u.aborted=!0,this._abortTile(u),this._unloadTile(u))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,u,p){const m=[],y=this.transform;if(!y)return m;const A=p?y.getCameraQueryGeometry(s):s,C=s.map(de=>y.pointCoordinate(de,this.terrain)),I=A.map(de=>y.pointCoordinate(de,this.terrain)),N=this.getIds();let W=1/0,X=1/0,ne=-1/0,pe=-1/0;for(const de of I)W=Math.min(W,de.x),X=Math.min(X,de.y),ne=Math.max(ne,de.x),pe=Math.max(pe,de.y);for(let de=0;de<N.length;de++){const _e=this._tiles[N[de]];if(_e.holdingForFade())continue;const le=_e.tileID,Ae=Math.pow(2,y.zoom-_e.tileID.overscaledZ),Oe=u*_e.queryPadding*c.W/_e.tileSize/Ae,ve=[le.getTilePoint(new c.Y(W,X)),le.getTilePoint(new c.Y(ne,pe))];if(ve[0].x-Oe<c.W&&ve[0].y-Oe<c.W&&ve[1].x+Oe>=0&&ve[1].y+Oe>=0){const Ie=C.map(We=>le.getTilePoint(We)),He=I.map(We=>le.getTilePoint(We));m.push({tile:_e,tileID:le,queryGeometry:Ie,cameraQueryGeometry:He,scale:Ae})}}return m}getVisibleCoordinates(s){const u=this.getRenderableIds(s).map(p=>this._tiles[p].tileID);for(const p of u)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return u}hasTransition(){if(this._source.hasTransition())return!0;if(Lt(this._source.type)){const s=E.now();for(const u in this._tiles)if(this._tiles[u].fadeEndTime>=s)return!0}return!1}setFeatureState(s,u,p){this._state.updateState(s=s||"_geojsonTileLayer",u,p)}removeFeatureState(s,u,p){this._state.removeFeatureState(s=s||"_geojsonTileLayer",u,p)}getFeatureState(s,u){return this._state.getState(s=s||"_geojsonTileLayer",u)}setDependencies(s,u,p){const m=this._tiles[s];m&&m.setDependencies(u,p)}reloadTilesForDependencies(s,u){for(const p in this._tiles)this._tiles[p].hasDependency(s,u)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(s,u))}}function Rt(_,s){const u=Math.abs(2*_.wrap)-+(_.wrap<0),p=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||p-u||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function Lt(_){return _==="raster"||_==="image"||_==="video"}nt.maxOverzooming=10,nt.maxUnderzooming=3;class Ot{constructor(s,u){this.reset(s,u)}reset(s,u){this.points=s||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=c.ac(s,0,1);let u=1,p=this._distances[u];const m=s*this.paddedLength+this.padding;for(;p<m&&u<this._distances.length;)p=this._distances[++u];const y=u-1,A=this._distances[y],C=p-A,I=C>0?(m-A)/C:0;return this.points[y].mult(1-I).add(this.points[u].mult(I))}}function $(_,s){let u=!0;return _==="always"||_!=="never"&&s!=="never"||(u=!1),u}class Le{constructor(s,u,p){const m=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(s/p),this.yCellCount=Math.ceil(u/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)m.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=u,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,u,p,m,y){this._forEachCell(u,p,m,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(u),this.bboxes.push(p),this.bboxes.push(m),this.bboxes.push(y)}insertCircle(s,u,p,m){this._forEachCell(u-m,p-m,u+m,p+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(u),this.circles.push(p),this.circles.push(m)}_insertBoxCell(s,u,p,m,y,A){this.boxCells[y].push(A)}_insertCircleCell(s,u,p,m,y,A){this.circleCells[y].push(A)}_query(s,u,p,m,y,A,C){if(p<0||s>this.width||m<0||u>this.height)return[];const I=[];if(s<=0&&u<=0&&this.width<=p&&this.height<=m){if(y)return[{key:null,x1:s,y1:u,x2:p,y2:m}];for(let N=0;N<this.boxKeys.length;N++)I.push({key:this.boxKeys[N],x1:this.bboxes[4*N],y1:this.bboxes[4*N+1],x2:this.bboxes[4*N+2],y2:this.bboxes[4*N+3]});for(let N=0;N<this.circleKeys.length;N++){const W=this.circles[3*N],X=this.circles[3*N+1],ne=this.circles[3*N+2];I.push({key:this.circleKeys[N],x1:W-ne,y1:X-ne,x2:W+ne,y2:X+ne})}}else this._forEachCell(s,u,p,m,this._queryCell,I,{hitTest:y,overlapMode:A,seenUids:{box:{},circle:{}}},C);return I}query(s,u,p,m){return this._query(s,u,p,m,!1,null)}hitTest(s,u,p,m,y,A){return this._query(s,u,p,m,!0,y,A).length>0}hitTestCircle(s,u,p,m,y){const A=s-p,C=s+p,I=u-p,N=u+p;if(C<0||A>this.width||N<0||I>this.height)return!1;const W=[];return this._forEachCell(A,I,C,N,this._queryCellCircle,W,{hitTest:!0,overlapMode:m,circle:{x:s,y:u,radius:p},seenUids:{box:{},circle:{}}},y),W.length>0}_queryCell(s,u,p,m,y,A,C,I){const{seenUids:N,hitTest:W,overlapMode:X}=C,ne=this.boxCells[y];if(ne!==null){const de=this.bboxes;for(const _e of ne)if(!N.box[_e]){N.box[_e]=!0;const le=4*_e,Ae=this.boxKeys[_e];if(s<=de[le+2]&&u<=de[le+3]&&p>=de[le+0]&&m>=de[le+1]&&(!I||I(Ae))&&(!W||!$(X,Ae.overlapMode))&&(A.push({key:Ae,x1:de[le],y1:de[le+1],x2:de[le+2],y2:de[le+3]}),W))return!0}}const pe=this.circleCells[y];if(pe!==null){const de=this.circles;for(const _e of pe)if(!N.circle[_e]){N.circle[_e]=!0;const le=3*_e,Ae=this.circleKeys[_e];if(this._circleAndRectCollide(de[le],de[le+1],de[le+2],s,u,p,m)&&(!I||I(Ae))&&(!W||!$(X,Ae.overlapMode))){const Oe=de[le],ve=de[le+1],Ie=de[le+2];if(A.push({key:Ae,x1:Oe-Ie,y1:ve-Ie,x2:Oe+Ie,y2:ve+Ie}),W)return!0}}}return!1}_queryCellCircle(s,u,p,m,y,A,C,I){const{circle:N,seenUids:W,overlapMode:X}=C,ne=this.boxCells[y];if(ne!==null){const de=this.bboxes;for(const _e of ne)if(!W.box[_e]){W.box[_e]=!0;const le=4*_e,Ae=this.boxKeys[_e];if(this._circleAndRectCollide(N.x,N.y,N.radius,de[le+0],de[le+1],de[le+2],de[le+3])&&(!I||I(Ae))&&!$(X,Ae.overlapMode))return A.push(!0),!0}}const pe=this.circleCells[y];if(pe!==null){const de=this.circles;for(const _e of pe)if(!W.circle[_e]){W.circle[_e]=!0;const le=3*_e,Ae=this.circleKeys[_e];if(this._circlesCollide(de[le],de[le+1],de[le+2],N.x,N.y,N.radius)&&(!I||I(Ae))&&!$(X,Ae.overlapMode))return A.push(!0),!0}}}_forEachCell(s,u,p,m,y,A,C,I){const N=this._convertToXCellCoord(s),W=this._convertToYCellCoord(u),X=this._convertToXCellCoord(p),ne=this._convertToYCellCoord(m);for(let pe=N;pe<=X;pe++)for(let de=W;de<=ne;de++)if(y.call(this,s,u,p,m,this.xCellCount*de+pe,A,C,I))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,u,p,m,y,A){const C=m-s,I=y-u,N=p+A;return N*N>C*C+I*I}_circleAndRectCollide(s,u,p,m,y,A,C){const I=(A-m)/2,N=Math.abs(s-(m+I));if(N>I+p)return!1;const W=(C-y)/2,X=Math.abs(u-(y+W));if(X>W+p)return!1;if(N<=I||X<=W)return!0;const ne=N-I,pe=X-W;return ne*ne+pe*pe<=p*p}}function rt(_,s,u,p,m){const y=c.F();return s?(c.J(y,y,[1/m,1/m,1]),u||c.ad(y,y,p.angle)):c.K(y,p.labelPlaneMatrix,_),y}function wt(_,s,u,p,m){if(s){const y=c.ae(_);return c.J(y,y,[m,m,1]),u||c.ad(y,y,-p.angle),y}return p.glCoordMatrix}function se(_,s,u){let p;u?(p=[_.x,_.y,u(_.x,_.y),1],c.af(p,p,s)):(p=[_.x,_.y,0,1],Ht(p,p,s));const m=p[3];return{point:new c.P(p[0]/m,p[1]/m),signedDistanceFromCamera:m}}function k(_,s){return .5+_/s*.5}function F(_,s){const u=_[0]/_[3],p=_[1]/_[3];return u>=-s[0]&&u<=s[0]&&p>=-s[1]&&p<=s[1]}function j(_,s,u,p,m,y,A,C,I,N){const W=p?_.textSizeData:_.iconSizeData,X=c.ag(W,u.transform.zoom),ne=[256/u.width*2+1,256/u.height*2+1],pe=p?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;pe.clear();const de=_.lineVertexArray,_e=p?_.text.placedSymbolArray:_.icon.placedSymbolArray,le=u.transform.width/u.transform.height;let Ae=!1;for(let Oe=0;Oe<_e.length;Oe++){const ve=_e.get(Oe);if(ve.hidden||ve.writingMode===c.ah.vertical&&!Ae){yt(ve.numGlyphs,pe);continue}let Ie;if(Ae=!1,N?(Ie=[ve.anchorX,ve.anchorY,N(ve.anchorX,ve.anchorY),1],c.af(Ie,Ie,s)):(Ie=[ve.anchorX,ve.anchorY,0,1],Ht(Ie,Ie,s)),!F(Ie,ne)){yt(ve.numGlyphs,pe);continue}const He=k(u.transform.cameraToCenterDistance,Ie[3]),We=c.ai(W,X,ve),Qe=A?We/He:We*He,dt=new c.P(ve.anchorX,ve.anchorY),lt=se(dt,m,N).point,ht={projections:{},offsets:{}},Ut=ye(ve,Qe,!1,C,s,m,y,_.glyphOffsetArray,de,pe,lt,dt,ht,le,I,N);Ae=Ut.useVertical,(Ut.notEnoughRoom||Ae||Ut.needsFlipping&&ye(ve,Qe,!0,C,s,m,y,_.glyphOffsetArray,de,pe,lt,dt,ht,le,I,N).notEnoughRoom)&&yt(ve.numGlyphs,pe)}p?_.text.dynamicLayoutVertexBuffer.updateData(pe):_.icon.dynamicLayoutVertexBuffer.updateData(pe)}function Y(_,s,u,p,m,y,A,C,I,N,W,X,ne){const pe=C.glyphStartIndex+C.numGlyphs,de=C.lineStartIndex,_e=C.lineStartIndex+C.lineLength,le=s.getoffsetX(C.glyphStartIndex),Ae=s.getoffsetX(pe-1),Oe=Ge(_*le,u,p,m,y,A,C.segment,de,_e,I,N,W,X,ne);if(!Oe)return null;const ve=Ge(_*Ae,u,p,m,y,A,C.segment,de,_e,I,N,W,X,ne);return ve?{first:Oe,last:ve}:null}function ue(_,s,u,p){return _===c.ah.horizontal&&Math.abs(u.y-s.y)>Math.abs(u.x-s.x)*p?{useVertical:!0}:(_===c.ah.vertical?s.y<u.y:s.x>u.x)?{needsFlipping:!0}:null}function ye(_,s,u,p,m,y,A,C,I,N,W,X,ne,pe,de,_e){const le=s/24,Ae=_.lineOffsetX*le,Oe=_.lineOffsetY*le;let ve;if(_.numGlyphs>1){const Ie=_.glyphStartIndex+_.numGlyphs,He=_.lineStartIndex,We=_.lineStartIndex+_.lineLength,Qe=Y(le,C,Ae,Oe,u,W,X,_,I,y,ne,de,_e);if(!Qe)return{notEnoughRoom:!0};const dt=se(Qe.first.point,A,_e).point,lt=se(Qe.last.point,A,_e).point;if(p&&!u){const ht=ue(_.writingMode,dt,lt,pe);if(ht)return ht}ve=[Qe.first];for(let ht=_.glyphStartIndex+1;ht<Ie-1;ht++)ve.push(Ge(le*C.getoffsetX(ht),Ae,Oe,u,W,X,_.segment,He,We,I,y,ne,de,_e));ve.push(Qe.last)}else{if(p&&!u){const He=se(X,m,_e).point,We=_.lineStartIndex+_.segment+1,Qe=new c.P(I.getx(We),I.gety(We)),dt=se(Qe,m,_e),lt=dt.signedDistanceFromCamera>0?dt.point:xe(X,Qe,He,1,m,_e),ht=ue(_.writingMode,He,lt,pe);if(ht)return ht}const Ie=Ge(le*C.getoffsetX(_.glyphStartIndex),Ae,Oe,u,W,X,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,I,y,ne,de,_e);if(!Ie)return{notEnoughRoom:!0};ve=[Ie]}for(const Ie of ve)c.aj(N,Ie.point,Ie.angle);return{}}function xe(_,s,u,p,m,y){const A=se(_.add(_.sub(s)._unit()),m,y).point,C=u.sub(A);return u.add(C._mult(p/C.mag()))}function he(_,s){const{projectionCache:u,lineVertexArray:p,labelPlaneMatrix:m,tileAnchorPoint:y,distanceFromAnchor:A,getElevation:C,previousVertex:I,direction:N,absOffsetX:W}=s;if(u.projections[_])return u.projections[_];const X=new c.P(p.getx(_),p.gety(_)),ne=se(X,m,C);if(ne.signedDistanceFromCamera>0)return u.projections[_]=ne.point,ne.point;const pe=_-N;return xe(A===0?y:new c.P(p.getx(pe),p.gety(pe)),X,I,W-A+1,m,C)}function Se(_,s,u){return _._unit()._perp()._mult(s*u)}function Ne(_,s,u,p,m,y,A,C){const{projectionCache:I,direction:N}=C;if(I.offsets[_])return I.offsets[_];const W=u.add(s);if(_+N<p||_+N>=m)return I.offsets[_]=W,W;const X=he(_+N,C),ne=Se(X.sub(u),A,N),pe=u.add(ne),de=X.add(ne);return I.offsets[_]=c.ak(y,W,pe,de)||W,I.offsets[_]}function Ge(_,s,u,p,m,y,A,C,I,N,W,X,ne,pe){const de=p?_-s:_+s;let _e=de>0?1:-1,le=0;p&&(_e*=-1,le=Math.PI),_e<0&&(le+=Math.PI);let Ae,Oe,ve=_e>0?C+A:C+A+1,Ie=m,He=m,We=0,Qe=0;const dt=Math.abs(de),lt=[];let ht;for(;We+Qe<=dt;){if(ve+=_e,ve<C||ve>=I)return null;We+=Qe,He=Ie,Oe=Ae;const Et={projectionCache:X,lineVertexArray:N,labelPlaneMatrix:W,tileAnchorPoint:y,distanceFromAnchor:We,getElevation:pe,previousVertex:He,direction:_e,absOffsetX:dt};if(Ie=he(ve,Et),u===0)lt.push(He),ht=Ie.sub(He);else{let hn;const xn=Ie.sub(He);hn=xn.mag()===0?Se(he(ve+_e,Et).sub(Ie),u,_e):Se(xn,u,_e),Oe||(Oe=He.add(hn)),Ae=Ne(ve,hn,Ie,C,I,Oe,u,Et),lt.push(Oe),ht=Ae.sub(Oe)}Qe=ht.mag()}const Ut=ht._mult((dt-We)/Qe)._add(Oe||He),gn=le+Math.atan2(Ie.y-He.y,Ie.x-He.x);return lt.push(Ut),{point:Ut,angle:ne?gn:0,path:lt}}const ze=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function yt(_,s){for(let u=0;u<_;u++){const p=s.length;s.resize(p+4),s.float32.set(ze,3*p)}}function Ht(_,s,u){const p=s[0],m=s[1];return _[0]=u[0]*p+u[4]*m+u[12],_[1]=u[1]*p+u[5]*m+u[13],_[3]=u[3]*p+u[7]*m+u[15],_}const qt=100;class sn{constructor(s,u=new Le(s.width+200,s.height+200,25),p=new Le(s.width+200,s.height+200,25)){this.transform=s,this.grid=u,this.ignoredGrid=p,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+qt,this.screenBottomBoundary=s.height+qt,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,u,p,m,y,A){const C=this.projectAndGetPerspectiveRatio(m,s.anchorPointX,s.anchorPointY,A),I=p*C.perspectiveRatio,N=s.x1*I+C.point.x,W=s.y1*I+C.point.y,X=s.x2*I+C.point.x,ne=s.y2*I+C.point.y;return!this.isInsideGrid(N,W,X,ne)||u!=="always"&&this.grid.hitTest(N,W,X,ne,u,y)||C.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[N,W,X,ne],offscreen:this.isOffscreen(N,W,X,ne)}}placeCollisionCircles(s,u,p,m,y,A,C,I,N,W,X,ne,pe,de){const _e=[],le=new c.P(u.anchorX,u.anchorY),Ae=se(le,A,de),Oe=k(this.transform.cameraToCenterDistance,Ae.signedDistanceFromCamera),ve=(W?y/Oe:y*Oe)/c.ao,Ie=se(le,C,de).point,He=Y(ve,m,u.lineOffsetX*ve,u.lineOffsetY*ve,!1,Ie,le,u,p,C,{projections:{},offsets:{}},!1,de);let We=!1,Qe=!1,dt=!0;if(He){const lt=.5*ne*Oe+pe,ht=new c.P(-100,-100),Ut=new c.P(this.screenRightBoundary,this.screenBottomBoundary),gn=new Ot,Et=He.first,hn=He.last;let xn=[];for(let Sn=Et.path.length-1;Sn>=1;Sn--)xn.push(Et.path[Sn]);for(let Sn=1;Sn<hn.path.length;Sn++)xn.push(hn.path[Sn]);const Rn=2.5*lt;if(I){const Sn=xn.map(Mn=>se(Mn,I,de));xn=Sn.some(Mn=>Mn.signedDistanceFromCamera<=0)?[]:Sn.map(Mn=>Mn.point)}let pn=[];if(xn.length>0){const Sn=xn[0].clone(),Mn=xn[0].clone();for(let ui=1;ui<xn.length;ui++)Sn.x=Math.min(Sn.x,xn[ui].x),Sn.y=Math.min(Sn.y,xn[ui].y),Mn.x=Math.max(Mn.x,xn[ui].x),Mn.y=Math.max(Mn.y,xn[ui].y);pn=Sn.x>=ht.x&&Mn.x<=Ut.x&&Sn.y>=ht.y&&Mn.y<=Ut.y?[xn]:Mn.x<ht.x||Sn.x>Ut.x||Mn.y<ht.y||Sn.y>Ut.y?[]:c.al([xn],ht.x,ht.y,Ut.x,Ut.y)}for(const Sn of pn){gn.reset(Sn,.25*lt);let Mn=0;Mn=gn.length<=.5*lt?1:Math.ceil(gn.paddedLength/Rn)+1;for(let ui=0;ui<Mn;ui++){const Zn=ui/Math.max(Mn-1,1),yr=gn.lerp(Zn),Ci=yr.x+qt,Jn=yr.y+qt;_e.push(Ci,Jn,lt,0);const Qi=Ci-lt,ss=Jn-lt,Ts=Ci+lt,Fa=Jn+lt;if(dt=dt&&this.isOffscreen(Qi,ss,Ts,Fa),Qe=Qe||this.isInsideGrid(Qi,ss,Ts,Fa),s!=="always"&&this.grid.hitTestCircle(Ci,Jn,lt,s,X)&&(We=!0,!N))return{circles:[],offscreen:!1,collisionDetected:We}}}}return{circles:!N&&We||!Qe||Oe<this.perspectiveRatioCutoff?[]:_e,offscreen:dt,collisionDetected:We}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const u=[];let p=1/0,m=1/0,y=-1/0,A=-1/0;for(const W of s){const X=new c.P(W.x+qt,W.y+qt);p=Math.min(p,X.x),m=Math.min(m,X.y),y=Math.max(y,X.x),A=Math.max(A,X.y),u.push(X)}const C=this.grid.query(p,m,y,A).concat(this.ignoredGrid.query(p,m,y,A)),I={},N={};for(const W of C){const X=W.key;if(I[X.bucketInstanceId]===void 0&&(I[X.bucketInstanceId]={}),I[X.bucketInstanceId][X.featureIndex])continue;const ne=[new c.P(W.x1,W.y1),new c.P(W.x2,W.y1),new c.P(W.x2,W.y2),new c.P(W.x1,W.y2)];c.am(u,ne)&&(I[X.bucketInstanceId][X.featureIndex]=!0,N[X.bucketInstanceId]===void 0&&(N[X.bucketInstanceId]=[]),N[X.bucketInstanceId].push(X.featureIndex))}return N}insertCollisionBox(s,u,p,m,y,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:y,collisionGroupID:A,overlapMode:u},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,u,p,m,y,A){const C=p?this.ignoredGrid:this.grid,I={bucketInstanceId:m,featureIndex:y,collisionGroupID:A,overlapMode:u};for(let N=0;N<s.length;N+=4)C.insertCircle(I,s[N],s[N+1],s[N+2])}projectAndGetPerspectiveRatio(s,u,p,m){let y;return m?(y=[u,p,m(u,p),1],c.af(y,y,s)):(y=[u,p,0,1],Ht(y,y,s)),{point:new c.P((y[0]/y[3]+1)/2*this.transform.width+qt,(-y[1]/y[3]+1)/2*this.transform.height+qt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/y[3]*.5}}isOffscreen(s,u,p,m){return p<qt||s>=this.screenRightBoundary||m<qt||u>this.screenBottomBoundary}isInsideGrid(s,u,p,m){return p>=0&&s<this.gridRightBoundary&&m>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const s=c.an([]);return c.H(s,s,[-100,-100,0]),s}}function on(_,s,u){return s*(c.W/(_.tileSize*Math.pow(2,u-_.tileID.overscaledZ)))}class Hn{constructor(s,u,p,m){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?u:-u))):m&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class zn{constructor(s,u,p,m,y){this.text=new Hn(s?s.text:null,u,p,y),this.icon=new Hn(s?s.icon:null,u,m,y)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class oe{constructor(s,u,p){this.text=s,this.icon=u,this.skipFade=p}}class Ee{constructor(){this.invProjMatrix=c.F(),this.viewportMatrix=c.F(),this.circles=[]}}class Ue{constructor(s,u,p,m,y){this.bucketInstanceId=s,this.featureIndex=u,this.sourceLayerIndex=p,this.bucketIndex=m,this.tileID=y}}class Be{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const u=++this.maxGroupID;this.collisionGroups[s]={ID:u,predicate:p=>p.collisionGroupID===u}}return this.collisionGroups[s]}}function Ve(_,s,u,p,m){const{horizontalAlign:y,verticalAlign:A}=c.at(_);return new c.P(-(y-.5)*s+p[0]*m,-(A-.5)*u+p[1]*m)}function vt(_,s,u,p,m,y){const{x1:A,x2:C,y1:I,y2:N,anchorPointX:W,anchorPointY:X}=_,ne=new c.P(s,u);return p&&ne._rotate(m?y:-y),{x1:A+ne.x,y1:I+ne.y,x2:C+ne.x,y2:N+ne.y,anchorPointX:W,anchorPointY:X}}class jt{constructor(s,u,p,m,y){this.transform=s.clone(),this.terrain=u,this.collisionIndex=new sn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Be(m),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,u,p,m){const y=p.getBucket(u),A=p.latestFeatureIndex;if(!y||!A||u.id!==y.layerIds[0])return;const C=p.collisionBoxArray,I=y.layers[0].layout,N=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),W=p.tileSize/c.W,X=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ne=I.get("text-pitch-alignment")==="map",pe=I.get("text-rotation-alignment")==="map",de=on(p,1,this.transform.zoom),_e=rt(X,ne,pe,this.transform,de);let le=null;if(ne){const Oe=wt(X,ne,pe,this.transform,de);le=c.K([],this.transform.labelPlaneMatrix,Oe)}this.retainedQueryData[y.bucketInstanceId]=new Ue(y.bucketInstanceId,A,y.sourceLayerIndex,y.index,p.tileID);const Ae={bucket:y,layout:I,posMatrix:X,textLabelPlaneMatrix:_e,labelToScreenMatrix:le,scale:N,textPixelRatio:W,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:c.ag(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(m)for(const Oe of y.sortKeyRanges){const{sortKey:ve,symbolInstanceStart:Ie,symbolInstanceEnd:He}=Oe;s.push({sortKey:ve,symbolInstanceStart:Ie,symbolInstanceEnd:He,parameters:Ae})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:Ae})}attemptAnchorPlacement(s,u,p,m,y,A,C,I,N,W,X,ne,pe,de,_e,le){const Ae=c.ap[s.textAnchor],Oe=[s.textOffset0,s.textOffset1],ve=Ve(Ae,p,m,Oe,y),Ie=this.collisionIndex.placeCollisionBox(vt(u,ve.x,ve.y,A,C,this.transform.angle),X,I,N,W.predicate,le);if((!_e||this.collisionIndex.placeCollisionBox(vt(_e,ve.x,ve.y,A,C,this.transform.angle),X,I,N,W.predicate,le).box.length!==0)&&Ie.box.length>0){let He;if(this.prevPlacement&&this.prevPlacement.variableOffsets[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID]&&this.prevPlacement.placements[ne.crossTileID].text&&(He=this.prevPlacement.variableOffsets[ne.crossTileID].anchor),ne.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[ne.crossTileID]={textOffset:Oe,width:p,height:m,anchor:Ae,textBoxScale:y,prevAnchor:He},this.markUsedJustification(pe,Ae,ne,de),pe.allowVerticalPlacement&&(this.markUsedOrientation(pe,de,ne),this.placedOrientations[ne.crossTileID]=de),{shift:ve,placedGlyphBoxes:Ie}}}placeLayerBucketPart(s,u,p){const{bucket:m,layout:y,posMatrix:A,textLabelPlaneMatrix:C,labelToScreenMatrix:I,textPixelRatio:N,holdingForFade:W,collisionBoxArray:X,partiallyEvaluatedTextSize:ne,collisionGroup:pe}=s.parameters,de=y.get("text-optional"),_e=y.get("icon-optional"),le=c.aq(y,"text-overlap","text-allow-overlap"),Ae=le==="always",Oe=c.aq(y,"icon-overlap","icon-allow-overlap"),ve=Oe==="always",Ie=y.get("text-rotation-alignment")==="map",He=y.get("text-pitch-alignment")==="map",We=y.get("icon-text-fit")!=="none",Qe=y.get("symbol-z-order")==="viewport-y",dt=Ae&&(ve||!m.hasIconData()||_e),lt=ve&&(Ae||!m.hasTextData()||de);!m.collisionArrays&&X&&m.deserializeCollisionBoxes(X);const ht=this.retainedQueryData[m.bucketInstanceId].tileID,Ut=this.terrain?(Et,hn)=>this.terrain.getElevation(ht,Et,hn):null,gn=(Et,hn)=>{var xn,Rn;if(u[Et.crossTileID])return;if(W)return void(this.placements[Et.crossTileID]=new oe(!1,!1,!1));let pn=!1,Sn=!1,Mn=!0,ui=null,Zn={box:null,offscreen:null},yr={box:null,offscreen:null},Ci=null,Jn=null,Qi=null,ss=0,Ts=0,Fa=0;hn.textFeatureIndex?ss=hn.textFeatureIndex:Et.useRuntimeCollisionCircles&&(ss=Et.featureIndex),hn.verticalTextFeatureIndex&&(Ts=hn.verticalTextFeatureIndex);const Ua=hn.textBox;if(Ua){const pi=oi=>{let Hi=c.ah.horizontal;if(m.allowVerticalPlacement&&!oi&&this.prevPlacement){const kr=this.prevPlacement.placedOrientations[Et.crossTileID];kr&&(this.placedOrientations[Et.crossTileID]=kr,Hi=kr,this.markUsedOrientation(m,Hi,Et))}return Hi},ni=(oi,Hi)=>{if(m.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&hn.verticalTextBox){for(const kr of m.writingModes)if(kr===c.ah.vertical?(Zn=Hi(),yr=Zn):Zn=oi(),Zn&&Zn.box&&Zn.box.length)break}else Zn=oi()},vi=Et.textAnchorOffsetStartIndex,ko=Et.textAnchorOffsetEndIndex;if(ko===vi){const oi=(Hi,kr)=>{const Cn=this.collisionIndex.placeCollisionBox(Hi,le,N,A,pe.predicate,Ut);return Cn&&Cn.box&&Cn.box.length&&(this.markUsedOrientation(m,kr,Et),this.placedOrientations[Et.crossTileID]=kr),Cn};ni(()=>oi(Ua,c.ah.horizontal),()=>{const Hi=hn.verticalTextBox;return m.allowVerticalPlacement&&Et.numVerticalGlyphVertices>0&&Hi?oi(Hi,c.ah.vertical):{box:null,offscreen:null}}),pi(Zn&&Zn.box&&Zn.box.length)}else{let oi=c.ap[(Rn=(xn=this.prevPlacement)===null||xn===void 0?void 0:xn.variableOffsets[Et.crossTileID])===null||Rn===void 0?void 0:Rn.anchor];const Hi=(Cn,yd,Np)=>{const Na=Cn.x2-Cn.x1,Oa=Cn.y2-Cn.y1,eu=Et.textBoxScale,vd=We&&Oe==="never"?yd:null;let Ba={box:[],offscreen:!1},Op=le==="never"?1:2,xd="never";oi&&Op++;for(let Bp=0;Bp<Op;Bp++){for(let jl=vi;jl<ko;jl++){const Vp=m.textAnchorOffsets.get(jl);if(oi&&Vp.textAnchor!==oi)continue;const Wl=this.attemptAnchorPlacement(Vp,Cn,Na,Oa,eu,Ie,He,N,A,pe,xd,Et,m,Np,vd,Ut);if(Wl&&(Ba=Wl.placedGlyphBoxes,Ba&&Ba.box&&Ba.box.length))return pn=!0,ui=Wl.shift,Ba}oi?oi=null:xd=le}return Ba};ni(()=>Hi(Ua,hn.iconBox,c.ah.horizontal),()=>{const Cn=hn.verticalTextBox;return m.allowVerticalPlacement&&!(Zn&&Zn.box&&Zn.box.length)&&Et.numVerticalGlyphVertices>0&&Cn?Hi(Cn,hn.verticalIconBox,c.ah.vertical):{box:null,offscreen:null}}),Zn&&(pn=Zn.box,Mn=Zn.offscreen);const kr=pi(Zn&&Zn.box);if(!pn&&this.prevPlacement){const Cn=this.prevPlacement.variableOffsets[Et.crossTileID];Cn&&(this.variableOffsets[Et.crossTileID]=Cn,this.markUsedJustification(m,Cn.anchor,Et,kr))}}}if(Ci=Zn,pn=Ci&&Ci.box&&Ci.box.length>0,Mn=Ci&&Ci.offscreen,Et.useRuntimeCollisionCircles){const pi=m.text.placedSymbolArray.get(Et.centerJustifiedTextSymbolIndex),ni=c.ai(m.textSizeData,ne,pi),vi=y.get("text-padding");Jn=this.collisionIndex.placeCollisionCircles(le,pi,m.lineVertexArray,m.glyphOffsetArray,ni,A,C,I,p,He,pe.predicate,Et.collisionCircleDiameter,vi,Ut),Jn.circles.length&&Jn.collisionDetected&&!p&&c.w("Collisions detected, but collision boxes are not shown"),pn=Ae||Jn.circles.length>0&&!Jn.collisionDetected,Mn=Mn&&Jn.offscreen}if(hn.iconFeatureIndex&&(Fa=hn.iconFeatureIndex),hn.iconBox){const pi=ni=>{const vi=We&&ui?vt(ni,ui.x,ui.y,Ie,He,this.transform.angle):ni;return this.collisionIndex.placeCollisionBox(vi,Oe,N,A,pe.predicate,Ut)};yr&&yr.box&&yr.box.length&&hn.verticalIconBox?(Qi=pi(hn.verticalIconBox),Sn=Qi.box.length>0):(Qi=pi(hn.iconBox),Sn=Qi.box.length>0),Mn=Mn&&Qi.offscreen}const Es=de||Et.numHorizontalGlyphVertices===0&&Et.numVerticalGlyphVertices===0,as=_e||Et.numIconVertices===0;if(Es||as?as?Es||(Sn=Sn&&pn):pn=Sn&&pn:Sn=pn=Sn&&pn,pn&&Ci&&Ci.box&&this.collisionIndex.insertCollisionBox(Ci.box,le,y.get("text-ignore-placement"),m.bucketInstanceId,yr&&yr.box&&Ts?Ts:ss,pe.ID),Sn&&Qi&&this.collisionIndex.insertCollisionBox(Qi.box,Oe,y.get("icon-ignore-placement"),m.bucketInstanceId,Fa,pe.ID),Jn&&(pn&&this.collisionIndex.insertCollisionCircles(Jn.circles,le,y.get("text-ignore-placement"),m.bucketInstanceId,ss,pe.ID),p)){const pi=m.bucketInstanceId;let ni=this.collisionCircleArrays[pi];ni===void 0&&(ni=this.collisionCircleArrays[pi]=new Ee);for(let vi=0;vi<Jn.circles.length;vi+=4)ni.circles.push(Jn.circles[vi+0]),ni.circles.push(Jn.circles[vi+1]),ni.circles.push(Jn.circles[vi+2]),ni.circles.push(Jn.collisionDetected?1:0)}if(Et.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Et.crossTileID]=new oe(pn||dt,Sn||lt,Mn||m.justReloaded),u[Et.crossTileID]=!0};if(Qe){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Et=m.getSortedSymbolIndexes(this.transform.angle);for(let hn=Et.length-1;hn>=0;--hn){const xn=Et[hn];gn(m.symbolInstances.get(xn),m.collisionArrays[xn])}}else for(let Et=s.symbolInstanceStart;Et<s.symbolInstanceEnd;Et++)gn(m.symbolInstances.get(Et),m.collisionArrays[Et]);if(p&&m.bucketInstanceId in this.collisionCircleArrays){const Et=this.collisionCircleArrays[m.bucketInstanceId];c.ar(Et.invProjMatrix,A),Et.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(s,u,p,m){let y;y=m===c.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[c.as(u)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const C of A)C>=0&&(s.text.placedSymbolArray.get(C).crossTileID=y>=0&&C!==y?0:p.crossTileID)}markUsedOrientation(s,u,p){const m=u===c.ah.horizontal||u===c.ah.horizontalOnly?u:0,y=u===c.ah.vertical?u:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const C of A)s.text.placedSymbolArray.get(C).placedOrientation=m;p.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=y)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let p=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const m=u?u.symbolFadeChange(s):1,y=u?u.opacities:{},A=u?u.variableOffsets:{},C=u?u.placedOrientations:{};for(const I in this.placements){const N=this.placements[I],W=y[I];W?(this.opacities[I]=new zn(W,m,N.text,N.icon),p=p||N.text!==W.text.placed||N.icon!==W.icon.placed):(this.opacities[I]=new zn(null,m,N.text,N.icon,N.skipFade),p=p||N.text||N.icon)}for(const I in y){const N=y[I];if(!this.opacities[I]){const W=new zn(N,m,!1,!1);W.isHidden()||(this.opacities[I]=W,p=p||N.text.placed||N.icon.placed)}}for(const I in A)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=A[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);if(u&&u.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:s)}updateLayerOpacities(s,u){const p={};for(const m of u){const y=m.getBucket(s);y&&m.latestFeatureIndex&&s.id===y.layerIds[0]&&this.updateBucketOpacities(y,p,m.collisionBoxArray)}}updateBucketOpacities(s,u,p){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const m=s.layers[0],y=m.layout,A=new zn(null,0,!1,!1,!0),C=y.get("text-allow-overlap"),I=y.get("icon-allow-overlap"),N=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),W=y.get("text-rotation-alignment")==="map",X=y.get("text-pitch-alignment")==="map",ne=y.get("icon-text-fit")!=="none",pe=new zn(null,0,C&&(I||!s.hasIconData()||y.get("icon-optional")),I&&(C||!s.hasTextData()||y.get("text-optional")),!0);!s.collisionArrays&&p&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(p);const de=(_e,le,Ae)=>{for(let Oe=0;Oe<le/4;Oe++)_e.opacityVertexArray.emplaceBack(Ae);_e.hasVisibleVertices=_e.hasVisibleVertices||Ae!==An};for(let _e=0;_e<s.symbolInstances.length;_e++){const le=s.symbolInstances.get(_e),{numHorizontalGlyphVertices:Ae,numVerticalGlyphVertices:Oe,crossTileID:ve}=le;let Ie=this.opacities[ve];u[ve]?Ie=A:Ie||(Ie=pe,this.opacities[ve]=Ie),u[ve]=!0;const He=le.numIconVertices>0,We=this.placedOrientations[le.crossTileID],Qe=We===c.ah.vertical,dt=We===c.ah.horizontal||We===c.ah.horizontalOnly;if(Ae>0||Oe>0){const lt=qr(Ie.text);de(s.text,Ae,Qe?An:lt),de(s.text,Oe,dt?An:lt);const ht=Ie.text.isHidden();[le.rightJustifiedTextSymbolIndex,le.centerJustifiedTextSymbolIndex,le.leftJustifiedTextSymbolIndex].forEach(Et=>{Et>=0&&(s.text.placedSymbolArray.get(Et).hidden=ht||Qe?1:0)}),le.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(le.verticalPlacedTextSymbolIndex).hidden=ht||dt?1:0);const Ut=this.variableOffsets[le.crossTileID];Ut&&this.markUsedJustification(s,Ut.anchor,le,We);const gn=this.placedOrientations[le.crossTileID];gn&&(this.markUsedJustification(s,"left",le,gn),this.markUsedOrientation(s,gn,le))}if(He){const lt=qr(Ie.icon),ht=!(ne&&le.verticalPlacedIconSymbolIndex&&Qe);le.placedIconSymbolIndex>=0&&(de(s.icon,le.numIconVertices,ht?lt:An),s.icon.placedSymbolArray.get(le.placedIconSymbolIndex).hidden=Ie.icon.isHidden()),le.verticalPlacedIconSymbolIndex>=0&&(de(s.icon,le.numVerticalIconVertices,ht?An:lt),s.icon.placedSymbolArray.get(le.verticalPlacedIconSymbolIndex).hidden=Ie.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const lt=s.collisionArrays[_e];if(lt){let ht=new c.P(0,0);if(lt.textBox||lt.verticalTextBox){let gn=!0;if(N){const Et=this.variableOffsets[ve];Et?(ht=Ve(Et.anchor,Et.width,Et.height,Et.textOffset,Et.textBoxScale),W&&ht._rotate(X?this.transform.angle:-this.transform.angle)):gn=!1}lt.textBox&&bt(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!gn||Qe,ht.x,ht.y),lt.verticalTextBox&&bt(s.textCollisionBox.collisionVertexArray,Ie.text.placed,!gn||dt,ht.x,ht.y)}const Ut=!!(!dt&&lt.verticalIconBox);lt.iconBox&&bt(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,Ut,ne?ht.x:0,ne?ht.y:0),lt.verticalIconBox&&bt(s.iconCollisionBox.collisionVertexArray,Ie.icon.placed,!Ut,ne?ht.x:0,ne?ht.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=_e.invProjMatrix,s.placementViewportMatrix=_e.viewportMatrix,s.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,u){const p=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*p>s}setStale(){this.stale=!0}}function bt(_,s,u,p,m){_.emplaceBack(s?1:0,u?1:0,p||0,m||0),_.emplaceBack(s?1:0,u?1:0,p||0,m||0),_.emplaceBack(s?1:0,u?1:0,p||0,m||0),_.emplaceBack(s?1:0,u?1:0,p||0,m||0)}const Bt=Math.pow(2,25),ln=Math.pow(2,24),Ft=Math.pow(2,17),vn=Math.pow(2,16),ai=Math.pow(2,9),Yn=Math.pow(2,8),jn=Math.pow(2,1);function qr(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,u=Math.floor(127*_.opacity);return u*Bt+s*ln+u*Ft+s*vn+u*ai+s*Yn+u*jn+s}const An=0;class fn{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,u,p,m,y){const A=this._bucketParts;for(;this._currentTileIndex<s.length;)if(u.getBucketParts(A,m,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<A.length;)if(u.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,y())return!0;return!1}}class go{constructor(s,u,p,m,y,A,C,I){this.placement=new jt(s,u,A,C,I),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(s,u,p){const m=E.now(),y=()=>!this._forceFullPlacement&&E.now()-m>2;for(;this._currentPlacementIndex>=0;){const A=u[s[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=C)&&(!A.maxzoom||A.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new fn(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const Gn=512/c.W/2;class Xn{constructor(s,u,p){this.tileID=s,this.bucketInstanceId=p,this._symbolsByKey={};const m=new Map;for(let y=0;y<u.length;y++){const A=u.get(y),C=A.key,I=m.get(C);I?I.push(A):m.set(C,[A])}for(const[y,A]of m){const C={positions:A.map(I=>({x:Math.floor(I.anchorX*Gn),y:Math.floor(I.anchorY*Gn)})),crossTileIDs:A.map(I=>I.crossTileID)};if(C.positions.length>128){const I=new c.au(C.positions.length,16,Uint16Array);for(const{x:N,y:W}of C.positions)I.add(N,W);I.finish(),delete C.positions,C.index=I}this._symbolsByKey[y]=C}}getScaledCoordinates(s,u){const{x:p,y:m,z:y}=this.tileID.canonical,{x:A,y:C,z:I}=u.canonical,N=Gn/Math.pow(2,I-y),W=(C*c.W+s.anchorY)*N,X=m*c.W*Gn;return{x:Math.floor((A*c.W+s.anchorX)*N-p*c.W*Gn),y:Math.floor(W-X)}}findMatches(s,u,p){const m=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let y=0;y<s.length;y++){const A=s.get(y);if(A.crossTileID)continue;const C=this._symbolsByKey[A.key];if(!C)continue;const I=this.getScaledCoordinates(A,u);if(C.index){const N=C.index.range(I.x-m,I.y-m,I.x+m,I.y+m).sort();for(const W of N){const X=C.crossTileIDs[W];if(!p[X]){p[X]=!0,A.crossTileID=X;break}}}else if(C.positions)for(let N=0;N<C.positions.length;N++){const W=C.positions[N],X=C.crossTileIDs[N];if(Math.abs(W.x-I.x)<=m&&Math.abs(W.y-I.y)<=m&&!p[X]){p[X]=!0,A.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class oa{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Lr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const u=Math.round((s-this.lng)/360);if(u!==0)for(const p in this.indexes){const m=this.indexes[p],y={};for(const A in m){const C=m[A];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+u),y[C.tileID.key]=C}this.indexes[p]=y}this.lng=s}addBucket(s,u,p){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let y=0;y<u.symbolInstances.length;y++)u.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const m=this.usedCrossTileIDs[s.overscaledZ];for(const y in this.indexes){const A=this.indexes[y];if(Number(y)>s.overscaledZ)for(const C in A){const I=A[C];I.tileID.isChildOf(s)&&I.findMatches(u.symbolInstances,s,m)}else{const C=A[s.scaledTo(Number(y)).key];C&&C.findMatches(u.symbolInstances,s,m)}}for(let y=0;y<u.symbolInstances.length;y++){const A=u.symbolInstances.get(y);A.crossTileID||(A.crossTileID=p.generate(),m[A.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new Xn(s,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(s,u){for(const p of u.getCrossTileIDsLists())for(const m of p)delete this.usedCrossTileIDs[s][m]}removeStaleBuckets(s){let u=!1;for(const p in this.indexes){const m=this.indexes[p];for(const y in m)s[m[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,m[y]),delete m[y],u=!0)}return u}}class ei{constructor(){this.layerIndexes={},this.crossTileIDs=new oa,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,u,p){let m=this.layerIndexes[s.id];m===void 0&&(m=this.layerIndexes[s.id]=new Lr);let y=!1;const A={};m.handleWrapJump(p);for(const C of u){const I=C.getBucket(s);I&&s.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(C.tileID,I,this.crossTileIDs)&&(y=!0),A[I.bucketInstanceId]=!0)}return m.removeStaleBuckets(A)&&(y=!0),y}pruneUnusedLayers(s){const u={};s.forEach(p=>{u[p]=!0});for(const p in this.layerIndexes)u[p]||delete this.layerIndexes[p]}}const ci=(_,s)=>c.t(_,s&&s.filter(u=>u.identifier!=="source.canvas")),Ai=c.av();class la extends c.E{constructor(s,u={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const m=this.sourceCaches[p].getSource().type;m!=="vector"&&m!=="geojson"||this.sourceCaches[p].reload()}},this.map=s,this.dispatcher=new mn(un(),s._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(p,m)=>this.getGlyphs(p,m)),this.dispatcher.registerMessageHandler("getImages",(p,m)=>this.getImages(p,m)),this.imageManager=new je,this.imageManager.setEventedParent(this),this.glyphManager=new Ce(s._requestManager,u.localIdeographFontFamily),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new ei,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new c.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.ax()),Gt().on(Tt,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const m=this.sourceCaches[p.sourceId];if(!m)return;const y=m.getSource();if(y&&y.vectorLayerIds)for(const A in this._layers){const C=this._layers[A];C.source===y.id&&this._validateLayer(C)}})}loadURL(s,u={},p){this.fire(new c.k("dataloading",{dataType:"style"})),u.validate=typeof u.validate!="boolean"||u.validate;const m=this.map._requestManager.transformRequest(s,ee.Style);this._loadStyleRequest=new AbortController,c.h(m,this._loadStyleRequest).then(y=>{this._loadStyleRequest=null,this._load(y.data,u,p)}).catch(y=>{this._loadStyleRequest=null,y&&this.fire(new c.j(y))})}loadJSON(s,u={},p){this.fire(new c.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,u.validate=u.validate!==!1,this._load(s,u,p)}).catch(()=>{})}loadEmpty(){this.fire(new c.k("dataloading",{dataType:"style"})),this._load(Ai,{validate:!1})}_load(s,u,p){var m;const y=u.transformStyle?u.transformStyle(p,s):s;if(!u.validate||!ci(this,c.x(y))){this._loaded=!0,this.stylesheet=y;for(const A in y.sources)this.addSource(A,y.sources[A],{validate:!1});y.sprite?this._loadSprite(y.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(y.glyphs),this._createLayers(),this.light=new pt(this.stylesheet.light),this.map.setTerrain((m=this.stylesheet.terrain)!==null&&m!==void 0?m:null),this.fire(new c.k("data",{dataType:"style"})),this.fire(new c.k("style.load"))}}_createLayers(){const s=c.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(u=>u.id),this._layers={},this._serializedLayers=null;for(const u of s){const p=c.az(u);p.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=p}}_loadSprite(s,u=!1,p=void 0){let m;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(y,A,C,I){return c._(this,void 0,void 0,function*(){const N=Pe(y),W=C>1?"@2x":"",X={},ne={};for(const{id:pe,url:de}of N){const _e=A.transformRequest(A.normalizeSpriteURL(de,W,".json"),ee.SpriteJSON);X[pe]=c.h(_e,I);const le=A.transformRequest(A.normalizeSpriteURL(de,W,".png"),ee.SpriteImage);ne[pe]=V.getImage(le,I)}return yield Promise.all([...Object.values(X),...Object.values(ne)]),function(pe,de){return c._(this,void 0,void 0,function*(){const _e={};for(const le in pe){_e[le]={};const Ae=E.getImageCanvasContext((yield de[le]).data),Oe=(yield pe[le]).data;for(const ve in Oe){const{width:Ie,height:He,x:We,y:Qe,sdf:dt,pixelRatio:lt,stretchX:ht,stretchY:Ut,content:gn}=Oe[ve];_e[le][ve]={data:null,pixelRatio:lt,sdf:dt,stretchX:ht,stretchY:Ut,content:gn,spriteData:{width:Ie,height:He,x:We,y:Qe,context:Ae}}}}return _e})}(X,ne)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(y=>{if(this._spriteRequest=null,y)for(const A in y){this._spritesImagesIds[A]=[];const C=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(I=>!(I in y)):[];for(const I of C)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in y[A]){const N=A==="default"?I:`${A}:${I}`;this._spritesImagesIds[A].push(N),N in this.imageManager.images?this.imageManager.updateImage(N,y[A][I],!1):this.imageManager.addImage(N,y[A][I]),u&&(this._changedImages[N]=!0)}}}).catch(y=>{this._spriteRequest=null,m=y,this.fire(new c.j(m))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),u&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"})),p&&p(m)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}_validateLayer(s){const u=this.sourceCaches[s.source];if(!u)return;const p=s.sourceLayer;if(!p)return;const m=u.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(p)===-1)&&this.fire(new c.j(new Error(`Source layer "${p}" does not exist on source "${m.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const u=this._serializedAllLayers();if(!s||s.length===0)return Object.values(u);const p=[];for(const m of s)u[m]&&p.push(u[m]);return p}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const u=Object.keys(this._layers);for(const p of u){const m=this._layers[p];m.type!=="custom"&&(s[p]=m.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const u=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),y=Object.keys(this._removedLayers);(m.length||y.length)&&this._updateWorkerLayers(m,y);for(const A in this._updatedSources){const C=this._updatedSources[A];if(C==="reload")this._reloadSource(A);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const p={};for(const m in this.sourceCaches){const y=this.sourceCaches[m];p[m]=y.used,y.used=!1}for(const m of this._order){const y=this._layers[m];y.recalculate(s,this._availableImages),!y.isHidden(s.zoom)&&y.source&&(this.sourceCaches[y.source].used=!0)}for(const m in p){const y=this.sourceCaches[m];p[m]!==y.used&&y.fire(new c.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(s),this.z=s.zoom,u&&this.fire(new c.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const u in this.sourceCaches)this.sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,u={}){var p;this._checkLoaded();const m=this.serialize();if(s=u.transformStyle?u.transformStyle(m,s):s,((p=u.validate)===null||p===void 0||p)&&ci(this,c.x(s)))return!1;(s=c.aA(s)).layers=c.ay(s.layers);const y=c.aB(m,s),A=this._getOperationsToPerform(y);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const C of A.operations)C();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const u=[],p=[];for(const m of s)switch(m.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":u.push(()=>this.addLayer.apply(this,m.args));break;case"removeLayer":u.push(()=>this.removeLayer.apply(this,m.args));break;case"setPaintProperty":u.push(()=>this.setPaintProperty.apply(this,m.args));break;case"setLayoutProperty":u.push(()=>this.setLayoutProperty.apply(this,m.args));break;case"setFilter":u.push(()=>this.setFilter.apply(this,m.args));break;case"addSource":u.push(()=>this.addSource.apply(this,m.args));break;case"removeSource":u.push(()=>this.removeSource.apply(this,m.args));break;case"setLayerZoomRange":u.push(()=>this.setLayerZoomRange.apply(this,m.args));break;case"setLight":u.push(()=>this.setLight.apply(this,m.args));break;case"setGeoJSONSourceData":u.push(()=>this.setGeoJSONSourceData.apply(this,m.args));break;case"setGlyphs":u.push(()=>this.setGlyphs.apply(this,m.args));break;case"setSprite":u.push(()=>this.setSprite.apply(this,m.args));break;case"setTerrain":u.push(()=>this.map.setTerrain.apply(this,m.args));break;case"setTransition":u.push(()=>{});break;default:p.push(m.command)}return{operations:u,unimplemented:p}}addImage(s,u){if(this.getImage(s))return this.fire(new c.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,u),this._afterImageUpdated(s)}updateImage(s,u){this.imageManager.updateImage(s,u)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new c.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,u,p={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(c.x.source,`sources.${s}`,u,null,p))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const m=this.sourceCaches[s]=new nt(s,u,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:s})),m.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===s)return this.fire(new c.j(new Error(`Source "${s}" cannot be removed while layer "${p}" is using it.`)));const u=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],u.fire(new c.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),u.setEventedParent(null),u.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,u){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const p=this.sourceCaches[s].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(u),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,u,p={}){this._checkLoaded();const m=s.id;if(this.getLayer(m))return void this.fire(new c.j(new Error(`Layer "${m}" already exists on this map.`)));let y;if(s.type==="custom"){if(ci(this,c.aC(s)))return;y=c.az(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(m,s.source),s=c.aA(s),s=c.e(s,{source:m})),this._validate(c.x.layer,`layers.${m}`,s,{arrayIndex:-1},p))return;y=c.az(s),this._validateLayer(y),y.setEventedParent(this,{layer:{id:m}})}const A=u?this._order.indexOf(u):this._order.length;if(u&&A===-1)this.fire(new c.j(new Error(`Cannot add layer "${m}" before non-existing layer "${u}".`)));else{if(this._order.splice(A,0,m),this._layerOrderChanged=!0,this._layers[m]=y,this._removedLayers[m]&&y.source&&y.type!=="custom"){const C=this._removedLayers[m];delete this._removedLayers[m],C.type!==y.type?this._updatedSources[y.source]="clear":(this._updatedSources[y.source]="reload",this.sourceCaches[y.source].pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map)}}moveLayer(s,u){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new c.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===u)return;const p=this._order.indexOf(s);this._order.splice(p,1);const m=u?this._order.indexOf(u):this._order.length;u&&m===-1?this.fire(new c.j(new Error(`Cannot move layer "${s}" before non-existing layer "${u}".`))):(this._order.splice(m,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const u=this._layers[s];if(!u)return void this.fire(new c.j(new Error(`Cannot remove non-existing layer "${s}".`)));u.setEventedParent(null);const p=this._order.indexOf(s);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=u,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],u.onRemove&&u.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,u,p){this._checkLoaded();const m=this.getLayer(s);m?m.minzoom===u&&m.maxzoom===p||(u!=null&&(m.minzoom=u),p!=null&&(m.maxzoom=p),this._updateLayer(m)):this.fire(new c.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,u,p={}){this._checkLoaded();const m=this.getLayer(s);if(m){if(!c.aD(m.filter,u))return u==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(c.x.filter,`layers.${m.id}.filter`,u,null,p)||(m.filter=c.aA(u),this._updateLayer(m)))}else this.fire(new c.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return c.aA(this.getLayer(s).filter)}setLayoutProperty(s,u,p,m={}){this._checkLoaded();const y=this.getLayer(s);y?c.aD(y.getLayoutProperty(u),p)||(y.setLayoutProperty(u,p,m),this._updateLayer(y)):this.fire(new c.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,u){const p=this.getLayer(s);if(p)return p.getLayoutProperty(u);this.fire(new c.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,u,p,m={}){this._checkLoaded();const y=this.getLayer(s);y?c.aD(y.getPaintProperty(u),p)||(y.setPaintProperty(u,p,m)&&this._updateLayer(y),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new c.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,u){return this.getLayer(s).getPaintProperty(u)}setFeatureState(s,u){this._checkLoaded();const p=s.source,m=s.sourceLayer,y=this.sourceCaches[p];if(y===void 0)return void this.fire(new c.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=y.getSource().type;A==="geojson"&&m?this.fire(new c.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||m?(s.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),y.setFeatureState(m,s.id,u)):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,u){this._checkLoaded();const p=s.source,m=this.sourceCaches[p];if(m===void 0)return void this.fire(new c.j(new Error(`The source '${p}' does not exist in the map's style.`)));const y=m.getSource().type,A=y==="vector"?s.sourceLayer:void 0;y!=="vector"||A?u&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new c.j(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(A,s.id,u):this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const u=s.source,p=s.sourceLayer,m=this.sourceCaches[u];if(m!==void 0)return m.getSource().type!=="vector"||p?(s.id===void 0&&this.fire(new c.j(new Error("The feature id parameter must be provided."))),m.getFeatureState(p,s.id)):void this.fire(new c.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new c.j(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return c.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=c.aE(this.sourceCaches,y=>y.serialize()),u=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,m=this.stylesheet;return c.aF({version:m.version,name:m.name,metadata:m.metadata,light:m.light,center:m.center,zoom:m.zoom,bearing:m.bearing,pitch:m.pitch,sprite:m.sprite,glyphs:m.glyphs,transition:m.transition,sources:s,layers:u,terrain:p},y=>y!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const u=A=>this._layers[A].type==="fill-extrusion",p={},m=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(u(C)){p[C]=A;for(const I of s){const N=I[C];if(N)for(const W of N)m.push(W)}}}m.sort((A,C)=>C.intersectionZ-A.intersectionZ);const y=[];for(let A=this._order.length-1;A>=0;A--){const C=this._order[A];if(u(C))for(let I=m.length-1;I>=0;I--){const N=m[I].feature;if(p[N.layer.id]<A)break;y.push(N),m.pop()}else for(const I of s){const N=I[C];if(N)for(const W of N)y.push(W.feature)}}return y}queryRenderedFeatures(s,u,p){u&&u.filter&&this._validate(c.x.filter,"queryRenderedFeatures.filter",u.filter,null,u);const m={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new c.j(new Error("parameters.layers must be an Array."))),[];for(const C of u.layers){const I=this._layers[C];if(!I)return this.fire(new c.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];m[I.source]=!0}}const y=[];u.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const C in this.sourceCaches)u.layers&&!m[C]||y.push(dn(this.sourceCaches[C],this._layers,A,s,u,p));return this.placement&&y.push(function(C,I,N,W,X,ne,pe){const de={},_e=ne.queryRenderedSymbols(W),le=[];for(const Ae of Object.keys(_e).map(Number))le.push(pe[Ae]);le.sort(an);for(const Ae of le){const Oe=Ae.featureIndex.lookupSymbolFeatures(_e[Ae.bucketInstanceId],I,Ae.bucketIndex,Ae.sourceLayerIndex,X.filter,X.layers,X.availableImages,C);for(const ve in Oe){const Ie=de[ve]=de[ve]||[],He=Oe[ve];He.sort((We,Qe)=>{const dt=Ae.featureSortOrder;if(dt){const lt=dt.indexOf(We.featureIndex);return dt.indexOf(Qe.featureIndex)-lt}return Qe.featureIndex-We.featureIndex});for(const We of He)Ie.push(We)}}for(const Ae in de)de[Ae].forEach(Oe=>{const ve=Oe.feature,Ie=N[C[Ae].source].getFeatureState(ve.layer["source-layer"],ve.id);ve.source=ve.layer.source,ve.layer["source-layer"]&&(ve.sourceLayer=ve.layer["source-layer"]),ve.state=Ie});return de}(this._layers,A,this.sourceCaches,s,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(y)}querySourceFeatures(s,u){u&&u.filter&&this._validate(c.x.filter,"querySourceFeatures.filter",u.filter,null,u);const p=this.sourceCaches[s];return p?function(m,y){const A=m.getRenderableIds().map(N=>m.getTileByID(N)),C=[],I={};for(let N=0;N<A.length;N++){const W=A[N],X=W.tileID.canonical.key;I[X]||(I[X]=!0,W.querySourceFeatures(C,y))}return C}(p,u):[]}getLight(){return this.light.getLight()}setLight(s,u={}){this._checkLoaded();const p=this.light.getLight();let m=!1;for(const A in s)if(!c.aD(s[A],p[A])){m=!0;break}if(!m)return;const y={now:E.now(),transition:c.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,u),this.light.updateTransitions(y)}_validate(s,u,p,m,y={}){return(!y||y.validate!==!1)&&ci(this,s.call(c.x,c.e({key:u,style:this.serialize(),value:p,styleSpec:c.v},m)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),Gt().off(Tt,this._rtlPluginLoaded);for(const u in this._layers)this._layers[u].setEventedParent(null);for(const u in this.sourceCaches){const p=this.sourceCaches[u];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const u in this.sourceCaches)this.sourceCaches[u].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,u,p,m,y=!1){let A=!1,C=!1;const I={};for(const N of this._order){const W=this._layers[N];if(W.type!=="symbol")continue;if(!I[W.source]){const ne=this.sourceCaches[W.source];I[W.source]=ne.getRenderableIds(!0).map(pe=>ne.getTileByID(pe)).sort((pe,de)=>de.tileID.overscaledZ-pe.tileID.overscaledZ||(pe.tileID.isLessThan(de.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer(W,I[W.source],s.center.lng);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((y=y||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(E.now(),s.zoom))&&(this.pauseablePlacement=new go(s,this.map.terrain,this._order,y,u,p,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(E.now()),C=!0),A&&this.pauseablePlacement.placement.setStale()),C||A)for(const N of this._order){const W=this._layers[N];W.type==="symbol"&&this.placement.updateLayerOpacities(W,I[W.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(E.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,u){return c._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(u.icons);this._updateTilesForChangedImages();const m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,u.icons),p})}getGlyphs(s,u){return c._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(u.stacks),m=this.sourceCaches[u.source];return m&&m.setDependencies(u.tileID.key,u.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,u={}){this._checkLoaded(),s&&this._validate(c.x.glyphs,"glyphs",s,null,u)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,u,p={},m){this._checkLoaded();const y=[{id:s,url:u}],A=[...Pe(this.stylesheet.sprite),...y];this._validate(c.x.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(y,!0,m))}removeSprite(s){this._checkLoaded();const u=Pe(this.stylesheet.sprite);if(u.find(p=>p.id===s)){if(this._spritesImagesIds[s])for(const p of this._spritesImagesIds[s])this.imageManager.removeImage(p),this._changedImages[p]=!0;u.splice(u.findIndex(p=>p.id===s),1),this.stylesheet.sprite=u.length>0?u:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.k("data",{dataType:"style"}))}else this.fire(new c.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Pe(this.stylesheet.sprite)}setSprite(s,u={},p){this._checkLoaded(),s&&this._validate(c.x.sprite,"sprite",s,null,u)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,p):(this._unloadSprite(),p&&p(null)))}}var di=c.X([{name:"a_pos",type:"Int16",components:2}]),Aa="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const ca={prelude:Un(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Un(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Un(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Un(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Un("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Un(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Un(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Un("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Un("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Un("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Un(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Un(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Un(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Un(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Un(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Un(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Un(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Un(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Un(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Un(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Un(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Un(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Un(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Un("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Aa),terrainDepth:Un("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Aa),terrainCoords:Un("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Aa)};function Un(_,s){const u=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=s.match(/attribute ([\w]+) ([\w]+)/g),m=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),y=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=y?y.concat(m):m,C={};return{fragmentSource:_=_.replace(u,(I,N,W,X,ne)=>(C[ne]=!0,N==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
varying ${W} ${X} ${ne};
#else
uniform ${W} ${X} u_${ne};
#endif
`:`
#ifdef HAS_UNIFORM_u_${ne}
    ${W} ${X} ${ne} = u_${ne};
#endif
`)),vertexSource:s=s.replace(u,(I,N,W,X,ne)=>{const pe=X==="float"?"vec2":"vec4",de=ne.match(/color/)?"color":pe;return C[ne]?N==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${W} ${pe} a_${ne};
varying ${W} ${X} ${ne};
#else
uniform ${W} ${X} u_${ne};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = a_${ne};
#else
    ${W} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${W} ${X} ${ne} = u_${ne};
#endif
`:N==="define"?`
#ifndef HAS_UNIFORM_u_${ne}
uniform lowp float u_${ne}_t;
attribute ${W} ${pe} a_${ne};
#else
uniform ${W} ${X} u_${ne};
#endif
`:de==="vec4"?`
#ifndef HAS_UNIFORM_u_${ne}
    ${W} ${X} ${ne} = a_${ne};
#else
    ${W} ${X} ${ne} = u_${ne};
#endif
`:`
#ifndef HAS_UNIFORM_u_${ne}
    ${W} ${X} ${ne} = unpack_mix_${de}(a_${ne}, u_${ne}_t);
#else
    ${W} ${X} ${ne} = u_${ne};
#endif
`}),staticAttributes:p,staticUniforms:A}}class Cc{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,u,p,m,y,A,C,I,N){this.context=s;let W=this.boundPaintVertexBuffers.length!==m.length;for(let X=0;!W&&X<m.length;X++)this.boundPaintVertexBuffers[X]!==m[X]&&(W=!0);!this.vao||this.boundProgram!==u||this.boundLayoutVertexBuffer!==p||W||this.boundIndexBuffer!==y||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==N?this.freshBind(u,p,m,y,A,C,I,N):(s.bindVertexArray.set(this.vao),C&&C.bind(),y&&y.dynamicDraw&&y.bind(),I&&I.bind(),N&&N.bind())}freshBind(s,u,p,m,y,A,C,I){const N=s.numAttributes,W=this.context,X=W.gl;this.vao&&this.destroy(),this.vao=W.createVertexArray(),W.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=m,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=I,u.enableAttributes(X,s);for(const ne of p)ne.enableAttributes(X,s);A&&A.enableAttributes(X,s),C&&C.enableAttributes(X,s),I&&I.enableAttributes(X,s),u.bind(),u.setVertexAttribPointers(X,s,y);for(const ne of p)ne.bind(),ne.setVertexAttribPointers(X,s,y);A&&(A.bind(),A.setVertexAttribPointers(X,s,y)),m&&m.bind(),C&&(C.bind(),C.setVertexAttribPointers(X,s,y)),I&&(I.bind(),I.setVertexAttribPointers(X,s,y)),W.currentNumAttributes=N}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ws(_){const s=[];for(let u=0;u<_.length;u++){if(_[u]===null)continue;const p=_[u].split(" ");s.push(p.pop())}return s}class Lh{constructor(s,u,p,m,y,A){const C=s.gl;this.program=C.createProgram();const I=ws(u.staticAttributes),N=p?p.getBinderAttributes():[],W=I.concat(N),X=ca.prelude.staticUniforms?ws(ca.prelude.staticUniforms):[],ne=u.staticUniforms?ws(u.staticUniforms):[],pe=p?p.getBinderUniforms():[],de=X.concat(ne).concat(pe),_e=[];for(const We of de)_e.indexOf(We)<0&&_e.push(We);const le=p?p.defines():[];y&&le.push("#define OVERDRAW_INSPECTOR;"),A&&le.push("#define TERRAIN3D;");const Ae=le.concat(ca.prelude.fragmentSource,u.fragmentSource).join(`
`),Oe=le.concat(ca.prelude.vertexSource,u.vertexSource).join(`
`),ve=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ve,Ae),C.compileShader(ve),!C.getShaderParameter(ve,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(ve)}`);C.attachShader(this.program,ve);const Ie=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Ie,Oe),C.compileShader(Ie),!C.getShaderParameter(Ie,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(Ie)}`);C.attachShader(this.program,Ie),this.attributes={};const He={};this.numAttributes=W.length;for(let We=0;We<this.numAttributes;We++)W[We]&&(C.bindAttribLocation(this.program,We,W[We]),this.attributes[W[We]]=We);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(Ie),C.deleteShader(ve);for(let We=0;We<_e.length;We++){const Qe=_e[We];if(Qe&&!He[Qe]){const dt=C.getUniformLocation(this.program,Qe);dt&&(He[Qe]=dt)}}this.fixedUniforms=m(s,He),this.terrainUniforms=((We,Qe)=>({u_depth:new c.aG(We,Qe.u_depth),u_terrain:new c.aG(We,Qe.u_terrain),u_terrain_dim:new c.aH(We,Qe.u_terrain_dim),u_terrain_matrix:new c.aI(We,Qe.u_terrain_matrix),u_terrain_unpack:new c.aJ(We,Qe.u_terrain_unpack),u_terrain_exaggeration:new c.aH(We,Qe.u_terrain_exaggeration)}))(s,He),this.binderUniforms=p?p.getUniforms(s,He):[]}draw(s,u,p,m,y,A,C,I,N,W,X,ne,pe,de,_e,le,Ae,Oe){const ve=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(p),s.setStencilMode(m),s.setColorMode(y),s.setCullFace(A),I){s.activeTexture.set(ve.TEXTURE2),ve.bindTexture(ve.TEXTURE_2D,I.depthTexture),s.activeTexture.set(ve.TEXTURE3),ve.bindTexture(ve.TEXTURE_2D,I.texture);for(const He in this.terrainUniforms)this.terrainUniforms[He].set(I[He])}for(const He in this.fixedUniforms)this.fixedUniforms[He].set(C[He]);_e&&_e.setUniforms(s,this.binderUniforms,pe,{zoom:de});let Ie=0;switch(u){case ve.LINES:Ie=2;break;case ve.TRIANGLES:Ie=3;break;case ve.LINE_STRIP:Ie=1}for(const He of ne.get()){const We=He.vaos||(He.vaos={});(We[N]||(We[N]=new Cc)).bind(s,this,W,_e?_e.getPaintVertexBuffers():[],X,He.vertexOffset,le,Ae,Oe),ve.drawElements(u,He.primitiveLength*Ie,ve.UNSIGNED_SHORT,He.primitiveOffset*Ie*2)}}}function Cl(_,s,u){const p=1/on(u,1,s.transform.tileZoom),m=Math.pow(2,u.tileID.overscaledZ),y=u.tileSize*Math.pow(2,s.transform.tileZoom)/m,A=y*(u.tileID.canonical.x+u.tileID.wrap*m),C=y*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[p,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[A>>16,C>>16],u_pixel_coord_lower:[65535&A,65535&C]}}const ip=(_,s,u,p)=>{const m=s.style.light,y=m.properties.get("position"),A=[y.x,y.y,y.z],C=function(){var N=new c.A(9);return c.A!=Float32Array&&(N[1]=0,N[2]=0,N[3]=0,N[5]=0,N[6]=0,N[7]=0),N[0]=1,N[4]=1,N[8]=1,N}();m.properties.get("anchor")==="viewport"&&function(N,W){var X=Math.sin(W),ne=Math.cos(W);N[0]=ne,N[1]=X,N[2]=0,N[3]=-X,N[4]=ne,N[5]=0,N[6]=0,N[7]=0,N[8]=1}(C,-s.transform.angle),function(N,W,X){var ne=W[0],pe=W[1],de=W[2];N[0]=ne*X[0]+pe*X[3]+de*X[6],N[1]=ne*X[1]+pe*X[4]+de*X[7],N[2]=ne*X[2]+pe*X[5]+de*X[8]}(A,A,C);const I=m.properties.get("color");return{u_matrix:_,u_lightpos:A,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+u,u_opacity:p}},__=(_,s,u,p,m,y,A)=>c.e(ip(_,s,u,p),Cl(y,s,A),{u_height_factor:-Math.pow(2,m.overscaledZ)/A.tileSize/8}),Pc=_=>({u_matrix:_}),rp=(_,s,u,p)=>c.e(Pc(_),Cl(u,s,p)),sp=(_,s)=>({u_matrix:_,u_world:s}),y_=(_,s,u,p,m)=>c.e(rp(_,s,u,p),{u_world:m}),ap=(_,s,u,p)=>{const m=_.transform;let y,A;if(p.paint.get("circle-pitch-alignment")==="map"){const C=on(u,1,m.zoom);y=!0,A=[C,C]}else y=!1,A=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(s.posMatrix,u,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:A}},v_=(_,s,u)=>{const p=on(u,1,s.zoom),m=Math.pow(2,s.zoom-u.tileID.overscaledZ),y=u.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[s.pixelsToGLUnits[0]/(p*m),s.pixelsToGLUnits[1]/(p*m)],u_overscale_factor:y}},Rc=(_,s,u=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:u}),Dh=_=>({u_matrix:_}),op=(_,s,u,p)=>({u_matrix:_,u_extrude_scale:on(s,1,u),u_intensity:p});function lp(_,s){const u=Math.pow(2,s.canonical.z),p=s.canonical.y;return[new c.Y(0,p/u).toLngLat().lat,new c.Y(0,(p+1)/u).toLngLat().lat]}const Ic=(_,s,u,p)=>{const m=_.transform;return{u_matrix:Rl(_,s,u,p),u_ratio:1/on(s,1,m.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Ca=(_,s,u,p,m)=>c.e(Ic(_,s,u,m),{u_image:0,u_image_height:p}),Lc=(_,s,u,p,m)=>{const y=_.transform,A=Pl(s,y);return{u_matrix:Rl(_,s,u,m),u_texsize:s.imageAtlasTexture.size,u_ratio:1/on(s,1,y.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Zr=(_,s,u,p,m,y)=>{const A=_.lineAtlas,C=Pl(s,_.transform),I=u.layout.get("line-cap")==="round",N=A.getDash(p.from,I),W=A.getDash(p.to,I),X=N.width*m.fromScale,ne=W.width*m.toScale;return c.e(Ic(_,s,u,y),{u_patternscale_a:[C/X,-N.height/2],u_patternscale_b:[C/ne,-W.height/2],u_sdfgamma:A.width/(256*Math.min(X,ne)*_.pixelRatio)/2,u_image:0,u_tex_y_a:N.y,u_tex_y_b:W.y,u_mix:m.t})};function Pl(_,s){return 1/on(_,1,s.tileZoom)}function Rl(_,s,u,p){return _.translatePosMatrix(p?p.posMatrix:s.tileID.posMatrix,s,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}const Il=(_,s,u,p,m)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:u,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(A=m.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(y=m.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Dc(m.paint.get("raster-hue-rotate"))};var y,A};function Dc(_){_*=Math.PI/180;const s=Math.sin(_),u=Math.cos(_);return[(2*u+1)/3,(-Math.sqrt(3)*s-u+1)/3,(Math.sqrt(3)*s-u+1)/3]}const Ll=(_,s,u,p,m,y,A,C,I,N)=>{const W=m.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:W.cameraToCenterDistance,u_pitch:W.pitch/360*2*Math.PI,u_rotate_symbol:+u,u_aspect_ratio:W.width/W.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:A,u_coord_matrix:C,u_is_text:+I,u_pitch_with_map:+p,u_texsize:N,u_texture:0}},_o=(_,s,u,p,m,y,A,C,I,N,W)=>{const X=m.transform;return c.e(Ll(_,s,u,p,m,y,A,C,I,N),{u_gamma_scale:p?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+W})},x_=(_,s,u,p,m,y,A,C,I,N)=>c.e(_o(_,s,u,p,m,y,A,C,!0,I,!0),{u_texsize_icon:N,u_texture_icon:1}),b_=(_,s,u)=>({u_matrix:_,u_opacity:s,u_color:u}),cp=(_,s,u,p,m,y)=>c.e(function(A,C,I,N){const W=I.imageManager.getPattern(A.from.toString()),X=I.imageManager.getPattern(A.to.toString()),{width:ne,height:pe}=I.imageManager.getPixelSize(),de=Math.pow(2,N.tileID.overscaledZ),_e=N.tileSize*Math.pow(2,I.transform.tileZoom)/de,le=_e*(N.tileID.canonical.x+N.tileID.wrap*de),Ae=_e*N.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:W.tl,u_pattern_br_a:W.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[ne,pe],u_mix:C.t,u_pattern_size_a:W.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/on(N,1,I.transform.tileZoom),u_pixel_coord_upper:[le>>16,Ae>>16],u_pixel_coord_lower:[65535&le,65535&Ae]}}(p,y,u,m),{u_matrix:_,u_opacity:s}),w_={fillExtrusion:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_lightpos:new c.aK(_,s.u_lightpos),u_lightintensity:new c.aH(_,s.u_lightintensity),u_lightcolor:new c.aK(_,s.u_lightcolor),u_vertical_gradient:new c.aH(_,s.u_vertical_gradient),u_opacity:new c.aH(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_lightpos:new c.aK(_,s.u_lightpos),u_lightintensity:new c.aH(_,s.u_lightintensity),u_lightcolor:new c.aK(_,s.u_lightcolor),u_vertical_gradient:new c.aH(_,s.u_vertical_gradient),u_height_factor:new c.aH(_,s.u_height_factor),u_image:new c.aG(_,s.u_image),u_texsize:new c.aL(_,s.u_texsize),u_pixel_coord_upper:new c.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(_,s.u_pixel_coord_lower),u_scale:new c.aK(_,s.u_scale),u_fade:new c.aH(_,s.u_fade),u_opacity:new c.aH(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_image:new c.aG(_,s.u_image),u_texsize:new c.aL(_,s.u_texsize),u_pixel_coord_upper:new c.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(_,s.u_pixel_coord_lower),u_scale:new c.aK(_,s.u_scale),u_fade:new c.aH(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_world:new c.aL(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_world:new c.aL(_,s.u_world),u_image:new c.aG(_,s.u_image),u_texsize:new c.aL(_,s.u_texsize),u_pixel_coord_upper:new c.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(_,s.u_pixel_coord_lower),u_scale:new c.aK(_,s.u_scale),u_fade:new c.aH(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_scale_with_map:new c.aG(_,s.u_scale_with_map),u_pitch_with_map:new c.aG(_,s.u_pitch_with_map),u_extrude_scale:new c.aL(_,s.u_extrude_scale),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_matrix:new c.aI(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_pixels_to_tile_units:new c.aH(_,s.u_pixels_to_tile_units),u_extrude_scale:new c.aL(_,s.u_extrude_scale),u_overscale_factor:new c.aH(_,s.u_overscale_factor)}),collisionCircle:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_inv_matrix:new c.aI(_,s.u_inv_matrix),u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_viewport_size:new c.aL(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new c.aM(_,s.u_color),u_matrix:new c.aI(_,s.u_matrix),u_overlay:new c.aG(_,s.u_overlay),u_overlay_scale:new c.aH(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new c.aH(_,s.u_extrude_scale),u_intensity:new c.aH(_,s.u_intensity),u_matrix:new c.aI(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_world:new c.aL(_,s.u_world),u_image:new c.aG(_,s.u_image),u_color_ramp:new c.aG(_,s.u_color_ramp),u_opacity:new c.aH(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_image:new c.aG(_,s.u_image),u_latrange:new c.aL(_,s.u_latrange),u_light:new c.aL(_,s.u_light),u_shadow:new c.aM(_,s.u_shadow),u_highlight:new c.aM(_,s.u_highlight),u_accent:new c.aM(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_image:new c.aG(_,s.u_image),u_dimension:new c.aL(_,s.u_dimension),u_zoom:new c.aH(_,s.u_zoom),u_unpack:new c.aJ(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_ratio:new c.aH(_,s.u_ratio),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new c.aL(_,s.u_units_to_pixels)}),lineGradient:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_ratio:new c.aH(_,s.u_ratio),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new c.aL(_,s.u_units_to_pixels),u_image:new c.aG(_,s.u_image),u_image_height:new c.aH(_,s.u_image_height)}),linePattern:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_texsize:new c.aL(_,s.u_texsize),u_ratio:new c.aH(_,s.u_ratio),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_image:new c.aG(_,s.u_image),u_units_to_pixels:new c.aL(_,s.u_units_to_pixels),u_scale:new c.aK(_,s.u_scale),u_fade:new c.aH(_,s.u_fade)}),lineSDF:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_ratio:new c.aH(_,s.u_ratio),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new c.aL(_,s.u_units_to_pixels),u_patternscale_a:new c.aL(_,s.u_patternscale_a),u_patternscale_b:new c.aL(_,s.u_patternscale_b),u_sdfgamma:new c.aH(_,s.u_sdfgamma),u_image:new c.aG(_,s.u_image),u_tex_y_a:new c.aH(_,s.u_tex_y_a),u_tex_y_b:new c.aH(_,s.u_tex_y_b),u_mix:new c.aH(_,s.u_mix)}),raster:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_tl_parent:new c.aL(_,s.u_tl_parent),u_scale_parent:new c.aH(_,s.u_scale_parent),u_buffer_scale:new c.aH(_,s.u_buffer_scale),u_fade_t:new c.aH(_,s.u_fade_t),u_opacity:new c.aH(_,s.u_opacity),u_image0:new c.aG(_,s.u_image0),u_image1:new c.aG(_,s.u_image1),u_brightness_low:new c.aH(_,s.u_brightness_low),u_brightness_high:new c.aH(_,s.u_brightness_high),u_saturation_factor:new c.aH(_,s.u_saturation_factor),u_contrast_factor:new c.aH(_,s.u_contrast_factor),u_spin_weights:new c.aK(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new c.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(_,s.u_is_size_feature_constant),u_size_t:new c.aH(_,s.u_size_t),u_size:new c.aH(_,s.u_size),u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_pitch:new c.aH(_,s.u_pitch),u_rotate_symbol:new c.aG(_,s.u_rotate_symbol),u_aspect_ratio:new c.aH(_,s.u_aspect_ratio),u_fade_change:new c.aH(_,s.u_fade_change),u_matrix:new c.aI(_,s.u_matrix),u_label_plane_matrix:new c.aI(_,s.u_label_plane_matrix),u_coord_matrix:new c.aI(_,s.u_coord_matrix),u_is_text:new c.aG(_,s.u_is_text),u_pitch_with_map:new c.aG(_,s.u_pitch_with_map),u_texsize:new c.aL(_,s.u_texsize),u_texture:new c.aG(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new c.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(_,s.u_is_size_feature_constant),u_size_t:new c.aH(_,s.u_size_t),u_size:new c.aH(_,s.u_size),u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_pitch:new c.aH(_,s.u_pitch),u_rotate_symbol:new c.aG(_,s.u_rotate_symbol),u_aspect_ratio:new c.aH(_,s.u_aspect_ratio),u_fade_change:new c.aH(_,s.u_fade_change),u_matrix:new c.aI(_,s.u_matrix),u_label_plane_matrix:new c.aI(_,s.u_label_plane_matrix),u_coord_matrix:new c.aI(_,s.u_coord_matrix),u_is_text:new c.aG(_,s.u_is_text),u_pitch_with_map:new c.aG(_,s.u_pitch_with_map),u_texsize:new c.aL(_,s.u_texsize),u_texture:new c.aG(_,s.u_texture),u_gamma_scale:new c.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_is_halo:new c.aG(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new c.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new c.aG(_,s.u_is_size_feature_constant),u_size_t:new c.aH(_,s.u_size_t),u_size:new c.aH(_,s.u_size),u_camera_to_center_distance:new c.aH(_,s.u_camera_to_center_distance),u_pitch:new c.aH(_,s.u_pitch),u_rotate_symbol:new c.aG(_,s.u_rotate_symbol),u_aspect_ratio:new c.aH(_,s.u_aspect_ratio),u_fade_change:new c.aH(_,s.u_fade_change),u_matrix:new c.aI(_,s.u_matrix),u_label_plane_matrix:new c.aI(_,s.u_label_plane_matrix),u_coord_matrix:new c.aI(_,s.u_coord_matrix),u_is_text:new c.aG(_,s.u_is_text),u_pitch_with_map:new c.aG(_,s.u_pitch_with_map),u_texsize:new c.aL(_,s.u_texsize),u_texsize_icon:new c.aL(_,s.u_texsize_icon),u_texture:new c.aG(_,s.u_texture),u_texture_icon:new c.aG(_,s.u_texture_icon),u_gamma_scale:new c.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new c.aH(_,s.u_device_pixel_ratio),u_is_halo:new c.aG(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_opacity:new c.aH(_,s.u_opacity),u_color:new c.aM(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_opacity:new c.aH(_,s.u_opacity),u_image:new c.aG(_,s.u_image),u_pattern_tl_a:new c.aL(_,s.u_pattern_tl_a),u_pattern_br_a:new c.aL(_,s.u_pattern_br_a),u_pattern_tl_b:new c.aL(_,s.u_pattern_tl_b),u_pattern_br_b:new c.aL(_,s.u_pattern_br_b),u_texsize:new c.aL(_,s.u_texsize),u_mix:new c.aH(_,s.u_mix),u_pattern_size_a:new c.aL(_,s.u_pattern_size_a),u_pattern_size_b:new c.aL(_,s.u_pattern_size_b),u_scale_a:new c.aH(_,s.u_scale_a),u_scale_b:new c.aH(_,s.u_scale_b),u_pixel_coord_upper:new c.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new c.aL(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new c.aH(_,s.u_tile_units_to_pixels)}),terrain:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_texture:new c.aG(_,s.u_texture),u_ele_delta:new c.aH(_,s.u_ele_delta)}),terrainDepth:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_ele_delta:new c.aH(_,s.u_ele_delta)}),terrainCoords:(_,s)=>({u_matrix:new c.aI(_,s.u_matrix),u_texture:new c.aG(_,s.u_texture),u_terrain_coords_id:new c.aH(_,s.u_terrain_coords_id),u_ele_delta:new c.aH(_,s.u_ele_delta)})};class Pa{constructor(s,u,p){this.context=s;const m=s.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const u=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const zc={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Dr{constructor(s,u,p,m){this.length=u.length,this.attributes=p,this.itemSize=u.bytesPerElement,this.dynamicDraw=m,this.context=s;const y=s.gl;this.buffer=y.createBuffer(),s.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,u){for(let p=0;p<this.attributes.length;p++){const m=u.attributes[this.attributes[p].name];m!==void 0&&s.enableVertexAttribArray(m)}}setVertexAttribPointers(s,u,p){for(let m=0;m<this.attributes.length;m++){const y=this.attributes[m],A=u.attributes[y.name];A!==void 0&&s.vertexAttribPointer(A,y.components,s[zc[y.type]],!1,this.itemSize,y.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ar=new WeakMap;function yo(_){var s;if(ar.has(_))return ar.get(_);{const u=(s=_.getParameter(_.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return ar.set(_,u),u}}class Nn{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class kc extends Nn{getDefault(){return c.aO.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class zh extends Nn{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class kh extends Nn{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class Fc extends Nn{getDefault(){return[!0,!0,!0,!0]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Fh extends Nn{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class Uh extends Nn{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class Uc extends Nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const u=this.current;(s.func!==u.func||s.ref!==u.ref||s.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class up extends Nn{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class hp extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=s,this.dirty=!1}}class vo extends Nn{getDefault(){return[0,1]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class S_ extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=s,this.dirty=!1}}class M_ extends Nn{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class T_ extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.BLEND):u.disable(u.BLEND),this.current=s,this.dirty=!1}}class E_ extends Nn{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class A_ extends Nn{getDefault(){return c.aO.transparent}set(s){const u=this.current;(s.r!==u.r||s.g!==u.g||s.b!==u.b||s.a!==u.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class C_ extends Nn{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Nh extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;s?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=s,this.dirty=!1}}class Nc extends Nn{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class Oh extends Nn{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Bh extends Nn{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class xo extends Nn{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class dp extends Nn{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const u=this.current;(s[0]!==u[0]||s[1]!==u[1]||s[2]!==u[2]||s[3]!==u[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class fp extends Nn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Vh extends Nn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Ra extends Nn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class pp extends Nn{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class bo extends Nn{getDefault(){return null}set(s){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class wo extends Nn{getDefault(){return null}set(s){var u;if(s===this.current&&!this.dirty)return;const p=this.gl;yo(p)?p.bindVertexArray(s):(u=p.getExtension("OES_vertex_array_object"))===null||u===void 0||u.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class mp extends Nn{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Gh extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class On extends Nn{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class So extends Nn{constructor(s,u){super(s),this.context=s,this.parent=u}getDefault(){return null}}class P_ extends So{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class gp extends So{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Dl extends So{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,u.DEPTH_STENCIL_ATTACHMENT,u.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class R_{constructor(s,u,p,m,y){this.context=s,this.width=u,this.height=p;const A=s.gl,C=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new P_(s,C),m)this.depthAttachment=y?new Dl(s,C):new gp(s,C);else if(y)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,u=this.colorAttachment.get();if(u&&s.deleteTexture(u),this.depthAttachment){const p=this.depthAttachment.get();p&&s.deleteRenderbuffer(p)}s.deleteFramebuffer(this.framebuffer)}}class bi{constructor(s,u,p){this.blendFunction=s,this.blendColor=u,this.mask=p}}bi.Replace=[1,0],bi.disabled=new bi(bi.Replace,c.aO.transparent,[!1,!1,!1,!1]),bi.unblended=new bi(bi.Replace,c.aO.transparent,[!0,!0,!0,!0]),bi.alphaBlended=new bi([1,771],c.aO.transparent,[!0,!0,!0,!0]);class _p{constructor(s){var u,p;if(this.gl=s,this.clearColor=new kc(this),this.clearDepth=new zh(this),this.clearStencil=new kh(this),this.colorMask=new Fc(this),this.depthMask=new Fh(this),this.stencilMask=new Uh(this),this.stencilFunc=new Uc(this),this.stencilOp=new up(this),this.stencilTest=new hp(this),this.depthRange=new vo(this),this.depthTest=new S_(this),this.depthFunc=new M_(this),this.blend=new T_(this),this.blendFunc=new E_(this),this.blendColor=new A_(this),this.blendEquation=new C_(this),this.cullFace=new Nh(this),this.cullFaceSide=new Nc(this),this.frontFace=new Oh(this),this.program=new Bh(this),this.activeTexture=new xo(this),this.viewport=new dp(this),this.bindFramebuffer=new fp(this),this.bindRenderbuffer=new Vh(this),this.bindTexture=new Ra(this),this.bindVertexBuffer=new pp(this),this.bindElementBuffer=new bo(this),this.bindVertexArray=new wo(this),this.pixelStoreUnpack=new mp(this),this.pixelStoreUnpackPremultiplyAlpha=new Gh(this),this.pixelStoreUnpackFlipY=new On(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),yo(s)){this.HALF_FLOAT=s.HALF_FLOAT;const m=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(u=s.RGBA16F)!==null&&u!==void 0?u:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(p=s.RGB16F)!==null&&p!==void 0?p:m==null?void 0:m.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const m=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,u){return new Pa(this,s,u)}createVertexBuffer(s,u,p){return new Dr(this,s,u,p)}createRenderbuffer(s,u,p){const m=this.gl,y=m.createRenderbuffer();return this.bindRenderbuffer.set(y),m.renderbufferStorage(m.RENDERBUFFER,s,u,p),this.bindRenderbuffer.set(null),y}createFramebuffer(s,u,p,m){return new R_(this,s,u,p,m)}clear({color:s,depth:u,stencil:p}){const m=this.gl;let y=0;s&&(y|=m.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),u!==void 0&&(y|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),p!==void 0&&(y|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),m.clear(y)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){c.aD(s.blendFunction,bi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return yo(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var u;return yo(this.gl)?this.gl.deleteVertexArray(s):(u=this.gl.getExtension("OES_vertex_array_object"))===null||u===void 0?void 0:u.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class kn{constructor(s,u,p){this.func=s,this.mask=u,this.range=p}}kn.ReadOnly=!1,kn.ReadWrite=!0,kn.disabled=new kn(519,kn.ReadOnly,[0,1]);const zl=7680;class Kn{constructor(s,u,p,m,y,A){this.test=s,this.ref=u,this.mask=p,this.fail=m,this.depthFail=y,this.pass=A}}Kn.disabled=new Kn({func:519,mask:0},0,0,zl,zl,zl);class qn{constructor(s,u,p){this.enable=s,this.mode=u,this.frontFace=p}}let Mo;function Oc(_,s,u,p,m,y,A){const C=_.context,I=C.gl,N=_.useProgram("collisionBox"),W=[];let X=0,ne=0;for(let ve=0;ve<p.length;ve++){const Ie=p[ve],He=s.getTile(Ie),We=He.getBucket(u);if(!We)continue;let Qe=Ie.posMatrix;m[0]===0&&m[1]===0||(Qe=_.translatePosMatrix(Ie.posMatrix,He,m,y));const dt=A?We.textCollisionBox:We.iconCollisionBox,lt=We.collisionCircleArray;if(lt.length>0){const ht=c.F(),Ut=Qe;c.aP(ht,We.placementInvProjMatrix,_.transform.glCoordMatrix),c.aP(ht,ht,We.placementViewportMatrix),W.push({circleArray:lt,circleOffset:ne,transform:Ut,invTransform:ht,coord:Ie}),X+=lt.length/4,ne=X}dt&&N.draw(C,I.LINES,kn.disabled,Kn.disabled,_.colorModeForRenderPass(),qn.disabled,v_(Qe,_.transform,He),_.style.map.terrain&&_.style.map.terrain.getTerrainData(Ie),u.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,_.transform.zoom,null,null,dt.collisionVertexBuffer)}if(!A||!W.length)return;const pe=_.useProgram("collisionCircle"),de=new c.aQ;de.resize(4*X),de._trim();let _e=0;for(const ve of W)for(let Ie=0;Ie<ve.circleArray.length/4;Ie++){const He=4*Ie,We=ve.circleArray[He+0],Qe=ve.circleArray[He+1],dt=ve.circleArray[He+2],lt=ve.circleArray[He+3];de.emplace(_e++,We,Qe,dt,lt,0),de.emplace(_e++,We,Qe,dt,lt,1),de.emplace(_e++,We,Qe,dt,lt,2),de.emplace(_e++,We,Qe,dt,lt,3)}(!Mo||Mo.length<2*X)&&(Mo=function(ve){const Ie=2*ve,He=new c.aS;He.resize(Ie),He._trim();for(let We=0;We<Ie;We++){const Qe=6*We;He.uint16[Qe+0]=4*We+0,He.uint16[Qe+1]=4*We+1,He.uint16[Qe+2]=4*We+2,He.uint16[Qe+3]=4*We+2,He.uint16[Qe+4]=4*We+3,He.uint16[Qe+5]=4*We+0}return He}(X));const le=C.createIndexBuffer(Mo,!0),Ae=C.createVertexBuffer(de,c.aR.members,!0);for(const ve of W){const Ie={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(Oe=_.transform).cameraToCenterDistance,u_viewport_size:[Oe.width,Oe.height]};pe.draw(C,I.TRIANGLES,kn.disabled,Kn.disabled,_.colorModeForRenderPass(),qn.disabled,Ie,_.style.map.terrain&&_.style.map.terrain.getTerrainData(ve.coord),u.id,Ae,le,c.$.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,_.transform.zoom,null,null,null)}var Oe;Ae.destroy(),le.destroy()}qn.disabled=new qn(!1,1029,2305),qn.backCCW=new qn(!0,1029,2305);const yp=c.an(new Float32Array(16));function Bc(_,s,u,p,m,y){const{horizontalAlign:A,verticalAlign:C}=c.at(_);return new c.P((-(A-.5)*s/m+p[0])*y,(-(C-.5)*u/m+p[1])*y)}function Vc(_,s,u,p,m,y,A,C,I,N,W){const X=_.text.placedSymbolArray,ne=_.text.dynamicLayoutVertexArray,pe=_.icon.dynamicLayoutVertexArray,de={};ne.clear();for(let _e=0;_e<X.length;_e++){const le=X.get(_e),Ae=le.hidden||!le.crossTileID||_.allowVerticalPlacement&&!le.placedOrientation?null:p[le.crossTileID];if(Ae){const Oe=new c.P(le.anchorX,le.anchorY),ve=se(Oe,u?A:y,W),Ie=k(m.cameraToCenterDistance,ve.signedDistanceFromCamera);let He=c.ai(_.textSizeData,I,le)*Ie/c.ao;u&&(He*=_.tilePixelRatio/C);const{width:We,height:Qe,anchor:dt,textOffset:lt,textBoxScale:ht}=Ae,Ut=Bc(dt,We,Qe,lt,ht,He),gn=u?se(Oe.add(Ut),y,W).point:ve.point.add(s?Ut.rotate(-m.angle):Ut),Et=_.allowVerticalPlacement&&le.placedOrientation===c.ah.vertical?Math.PI/2:0;for(let hn=0;hn<le.numGlyphs;hn++)c.aj(ne,gn,Et);N&&le.associatedIconIndex>=0&&(de[le.associatedIconIndex]={shiftedAnchor:gn,angle:Et})}else yt(le.numGlyphs,ne)}if(N){pe.clear();const _e=_.icon.placedSymbolArray;for(let le=0;le<_e.length;le++){const Ae=_e.get(le);if(Ae.hidden)yt(Ae.numGlyphs,pe);else{const Oe=de[le];if(Oe)for(let ve=0;ve<Ae.numGlyphs;ve++)c.aj(pe,Oe.shiftedAnchor,Oe.angle);else yt(Ae.numGlyphs,pe)}}_.icon.dynamicLayoutVertexBuffer.updateData(pe)}_.text.dynamicLayoutVertexBuffer.updateData(ne)}function Hh(_,s,u){return u.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function vp(_,s,u,p,m,y,A,C,I,N,W,X){const ne=_.context,pe=ne.gl,de=_.transform,_e=C==="map",le=I==="map",Ae=C!=="viewport"&&u.layout.get("symbol-placement")!=="point",Oe=_e&&!le&&!Ae,ve=!u.layout.get("symbol-sort-key").isConstant();let Ie=!1;const He=_.depthModeForSublayer(0,kn.ReadOnly),We=u._unevaluatedLayout.hasValue("text-variable-anchor")||u._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Qe=[];for(const dt of p){const lt=s.getTile(dt),ht=lt.getBucket(u);if(!ht)continue;const Ut=m?ht.text:ht.icon;if(!Ut||!Ut.segments.get().length||!Ut.hasVisibleVertices)continue;const gn=Ut.programConfigurations.get(u.id),Et=m||ht.sdfIcons,hn=m?ht.textSizeData:ht.iconSizeData,xn=le||de.pitch!==0,Rn=_.useProgram(Hh(Et,m,ht),gn),pn=c.ag(hn,de.zoom),Sn=_.style.map.terrain&&_.style.map.terrain.getTerrainData(dt);let Mn,ui,Zn,yr,Ci=[0,0],Jn=null;if(m)ui=lt.glyphAtlasTexture,Zn=pe.LINEAR,Mn=lt.glyphAtlasTexture.size,ht.iconsInText&&(Ci=lt.imageAtlasTexture.size,Jn=lt.imageAtlasTexture,yr=xn||_.options.rotating||_.options.zooming||hn.kind==="composite"||hn.kind==="camera"?pe.LINEAR:pe.NEAREST);else{const oi=u.layout.get("icon-size").constantOr(0)!==1||ht.iconsNeedLinear;ui=lt.imageAtlasTexture,Zn=Et||_.options.rotating||_.options.zooming||oi||xn?pe.LINEAR:pe.NEAREST,Mn=lt.imageAtlasTexture.size}const Qi=on(lt,1,_.transform.zoom),ss=rt(dt.posMatrix,le,_e,_.transform,Qi),Ts=wt(dt.posMatrix,le,_e,_.transform,Qi),Fa=We&&ht.hasTextData(),Ua=u.layout.get("icon-text-fit")!=="none"&&Fa&&ht.hasIconData();if(Ae){const oi=_.style.map.terrain?(kr,Cn)=>_.style.map.terrain.getElevation(dt,kr,Cn):null,Hi=u.layout.get("text-rotation-alignment")==="map";j(ht,dt.posMatrix,_,m,ss,Ts,le,N,Hi,oi)}const Es=_.translatePosMatrix(dt.posMatrix,lt,y,A),as=Ae||m&&We||Ua?yp:ss,pi=_.translatePosMatrix(Ts,lt,y,A,!0),ni=Et&&u.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let vi;vi=Et?ht.iconsInText?x_(hn.kind,pn,Oe,le,_,Es,as,pi,Mn,Ci):_o(hn.kind,pn,Oe,le,_,Es,as,pi,m,Mn,!0):Ll(hn.kind,pn,Oe,le,_,Es,as,pi,m,Mn);const ko={program:Rn,buffers:Ut,uniformValues:vi,atlasTexture:ui,atlasTextureIcon:Jn,atlasInterpolation:Zn,atlasInterpolationIcon:yr,isSDF:Et,hasHalo:ni};if(ve&&ht.canOverlap){Ie=!0;const oi=Ut.segments.get();for(const Hi of oi)Qe.push({segments:new c.$([Hi]),sortKey:Hi.sortKey,state:ko,terrainData:Sn})}else Qe.push({segments:Ut.segments,sortKey:0,state:ko,terrainData:Sn})}Ie&&Qe.sort((dt,lt)=>dt.sortKey-lt.sortKey);for(const dt of Qe){const lt=dt.state;if(ne.activeTexture.set(pe.TEXTURE0),lt.atlasTexture.bind(lt.atlasInterpolation,pe.CLAMP_TO_EDGE),lt.atlasTextureIcon&&(ne.activeTexture.set(pe.TEXTURE1),lt.atlasTextureIcon&&lt.atlasTextureIcon.bind(lt.atlasInterpolationIcon,pe.CLAMP_TO_EDGE)),lt.isSDF){const ht=lt.uniformValues;lt.hasHalo&&(ht.u_is_halo=1,Gc(lt.buffers,dt.segments,u,_,lt.program,He,W,X,ht,dt.terrainData)),ht.u_is_halo=0}Gc(lt.buffers,dt.segments,u,_,lt.program,He,W,X,lt.uniformValues,dt.terrainData)}}function Gc(_,s,u,p,m,y,A,C,I,N){const W=p.context;m.draw(W,W.gl.TRIANGLES,y,A,C,qn.disabled,I,N,u.id,_.layoutVertexBuffer,_.indexBuffer,s,u.paint,p.transform.zoom,_.programConfigurations.get(u.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function xp(_,s,u,p,m){if(!u||!p||!p.imageAtlas)return;const y=p.imageAtlas.patternPositions;let A=y[u.to.toString()],C=y[u.from.toString()];if(!A&&C&&(A=C),!C&&A&&(C=A),!A||!C){const I=m.getPaintProperty(s);A=y[I],C=y[I]}A&&C&&_.setConstantPatternPositions(A,C)}function jh(_,s,u,p,m,y,A){const C=_.context.gl,I="fill-pattern",N=u.paint.get(I),W=N&&N.constantOr(1),X=u.getCrossfadeParameters();let ne,pe,de,_e,le;A?(pe=W&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",ne=C.LINES):(pe=W?"fillPattern":"fill",ne=C.TRIANGLES);const Ae=N.constantOr(null);for(const Oe of p){const ve=s.getTile(Oe);if(W&&!ve.patternsLoaded())continue;const Ie=ve.getBucket(u);if(!Ie)continue;const He=Ie.programConfigurations.get(u.id),We=_.useProgram(pe,He),Qe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe);W&&(_.context.activeTexture.set(C.TEXTURE0),ve.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),He.updatePaintBuffers(X)),xp(He,I,Ae,ve,u);const dt=Qe?Oe:null,lt=_.translatePosMatrix(dt?dt.posMatrix:Oe.posMatrix,ve,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(A){_e=Ie.indexBuffer2,le=Ie.segments2;const ht=[C.drawingBufferWidth,C.drawingBufferHeight];de=pe==="fillOutlinePattern"&&W?y_(lt,_,X,ve,ht):sp(lt,ht)}else _e=Ie.indexBuffer,le=Ie.segments,de=W?rp(lt,_,X,ve):Pc(lt);We.draw(_.context,ne,m,_.stencilModeForClipping(Oe),y,qn.disabled,de,Qe,u.id,Ie.layoutVertexBuffer,_e,le,u.paint,_.transform.zoom,He)}}function To(_,s,u,p,m,y,A){const C=_.context,I=C.gl,N="fill-extrusion-pattern",W=u.paint.get(N),X=W.constantOr(1),ne=u.getCrossfadeParameters(),pe=u.paint.get("fill-extrusion-opacity"),de=W.constantOr(null);for(const _e of p){const le=s.getTile(_e),Ae=le.getBucket(u);if(!Ae)continue;const Oe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(_e),ve=Ae.programConfigurations.get(u.id),Ie=_.useProgram(X?"fillExtrusionPattern":"fillExtrusion",ve);X&&(_.context.activeTexture.set(I.TEXTURE0),le.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),ve.updatePaintBuffers(ne)),xp(ve,N,de,le,u);const He=_.translatePosMatrix(_e.posMatrix,le,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),We=u.paint.get("fill-extrusion-vertical-gradient"),Qe=X?__(He,_,We,pe,_e,ne,le):ip(He,_,We,pe);Ie.draw(C,C.gl.TRIANGLES,m,y,A,qn.backCCW,Qe,Oe,u.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,u.paint,_.transform.zoom,ve,_.style.map.terrain&&Ae.centroidVertexBuffer)}}function Wh(_,s,u,p,m,y,A){const C=_.context,I=C.gl,N=u.fbo;if(!N)return;const W=_.useProgram("hillshade"),X=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,N.colorAttachment.get()),W.draw(C,I.TRIANGLES,m,y,A,qn.disabled,((ne,pe,de,_e)=>{const le=de.paint.get("hillshade-shadow-color"),Ae=de.paint.get("hillshade-highlight-color"),Oe=de.paint.get("hillshade-accent-color");let ve=de.paint.get("hillshade-illumination-direction")*(Math.PI/180);de.paint.get("hillshade-illumination-anchor")==="viewport"&&(ve-=ne.transform.angle);const Ie=!ne.options.moving;return{u_matrix:_e?_e.posMatrix:ne.transform.calculatePosMatrix(pe.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:lp(0,pe.tileID),u_light:[de.paint.get("hillshade-exaggeration"),ve],u_shadow:le,u_highlight:Ae,u_accent:Oe}})(_,u,p,X?s:null),X,p.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function bp(_,s,u,p,m,y){const A=_.context,C=A.gl,I=s.dem;if(I&&I.data){const N=I.dim,W=I.stride,X=I.getPixels();if(A.activeTexture.set(C.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(W),s.demTexture){const pe=s.demTexture;pe.update(X,{premultiply:!1}),pe.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else s.demTexture=new ke(A,X,C.RGBA,{premultiply:!1}),s.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);A.activeTexture.set(C.TEXTURE0);let ne=s.fbo;if(!ne){const pe=new ke(A,{width:N,height:N,data:null},C.RGBA);pe.bind(C.LINEAR,C.CLAMP_TO_EDGE),ne=s.fbo=A.createFramebuffer(N,N,!0,!1),ne.colorAttachment.set(pe.texture)}A.bindFramebuffer.set(ne.framebuffer),A.viewport.set([0,0,N,N]),_.useProgram("hillshadePrepare").draw(A,C.TRIANGLES,p,m,y,qn.disabled,((pe,de)=>{const _e=de.stride,le=c.F();return c.aN(le,0,c.W,-c.W,0,0,1),c.H(le,le,[0,-c.W,0]),{u_matrix:le,u_image:1,u_dimension:[_e,_e],u_zoom:pe.overscaledZ,u_unpack:de.getUnpackVector()}})(s.tileID,I),null,u.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function wp(_,s,u,p,m,y){const A=p.paint.get("raster-fade-duration");if(!y&&A>0){const C=E.now(),I=(C-_.timeAdded)/A,N=s?(C-s.timeAdded)/A:-1,W=u.getSource(),X=m.coveringZoomLevel({tileSize:W.tileSize,roundZoom:W.roundZoom}),ne=!s||Math.abs(s.tileID.overscaledZ-X)>Math.abs(_.tileID.overscaledZ-X),pe=ne&&_.refreshedUponExpiration?1:c.ac(ne?I:1-N,0,1);return _.refreshedUponExpiration&&I>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-pe}:{opacity:pe,mix:0}}return{opacity:1,mix:0}}const Hc=new c.aO(1,0,0,1),$h=new c.aO(0,1,0,1),I_=new c.aO(0,0,1,1),Sp=new c.aO(1,0,1,1),yi=new c.aO(0,1,1,1);function ua(_,s,u,p){Eo(_,0,s+u/2,_.transform.width,u,p)}function zr(_,s,u,p){Eo(_,s-u/2,0,u,_.transform.height,p)}function Eo(_,s,u,p,m,y){const A=_.context,C=A.gl;C.enable(C.SCISSOR_TEST),C.scissor(s*_.pixelRatio,u*_.pixelRatio,p*_.pixelRatio,m*_.pixelRatio),A.clear({color:y}),C.disable(C.SCISSOR_TEST)}function Xh(_,s,u){const p=_.context,m=p.gl,y=u.posMatrix,A=_.useProgram("debug"),C=kn.disabled,I=Kn.disabled,N=_.colorModeForRenderPass(),W="$debug",X=_.style.map.terrain&&_.style.map.terrain.getTerrainData(u);p.activeTexture.set(m.TEXTURE0);const ne=s.getTileByID(u.key).latestRawTileData,pe=Math.floor((ne&&ne.byteLength||0)/1024),de=s.getTile(u).tileSize,_e=512/Math.min(de,512)*(u.overscaledZ/_.transform.zoom)*.5;let le=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(le+=` => ${u.overscaledZ}`),function(Ae,Oe){Ae.initDebugOverlayCanvas();const ve=Ae.debugOverlayCanvas,Ie=Ae.context.gl,He=Ae.debugOverlayCanvas.getContext("2d");He.clearRect(0,0,ve.width,ve.height),He.shadowColor="white",He.shadowBlur=2,He.lineWidth=1.5,He.strokeStyle="white",He.textBaseline="top",He.font="bold 36px Open Sans, sans-serif",He.fillText(Oe,5,5),He.strokeText(Oe,5,5),Ae.debugOverlayTexture.update(ve),Ae.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(_,`${le} ${pe}kB`),A.draw(p,m.TRIANGLES,C,I,bi.alphaBlended,qn.disabled,Rc(y,c.aO.transparent,_e),null,W,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),A.draw(p,m.LINE_STRIP,C,I,N,qn.disabled,Rc(y,c.aO.red),X,W,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function qh(_,s,u){const p=_.context,m=p.gl,y=_.colorModeForRenderPass(),A=new kn(m.LEQUAL,kn.ReadWrite,_.depthRangeFor3D),C=_.useProgram("terrain"),I=s.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,_.width,_.height]);for(const N of u){const W=_.renderToTexture.getTexture(N),X=s.getTerrainData(N.tileID);p.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,W.texture);const ne={u_matrix:_.transform.calculatePosMatrix(N.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(_.transform.zoom)};C.draw(p,m.TRIANGLES,A,Kn.disabled,y,qn.backCCW,ne,X,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Ao{constructor(s,u){this.context=new _p(s),this.transform=u,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:c.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=nt.maxUnderzooming+nt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ei}resize(s,u,p){if(this.width=Math.floor(s*p),this.height=Math.floor(u*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const s=this.context,u=new c.aV;u.emplaceBack(0,0),u.emplaceBack(c.W,0),u.emplaceBack(0,c.W),u.emplaceBack(c.W,c.W),this.tileExtentBuffer=s.createVertexBuffer(u,di.members),this.tileExtentSegments=c.$.simpleSegment(0,0,4,2);const p=new c.aV;p.emplaceBack(0,0),p.emplaceBack(c.W,0),p.emplaceBack(0,c.W),p.emplaceBack(c.W,c.W),this.debugBuffer=s.createVertexBuffer(p,di.members),this.debugSegments=c.$.simpleSegment(0,0,4,5);const m=new c.Z;m.emplaceBack(0,0,0,0),m.emplaceBack(c.W,0,c.W,0),m.emplaceBack(0,c.W,0,c.W),m.emplaceBack(c.W,c.W,c.W,c.W),this.rasterBoundsBuffer=s.createVertexBuffer(m,at.members),this.rasterBoundsSegments=c.$.simpleSegment(0,0,4,2);const y=new c.aV;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(y,di.members),this.viewportSegments=c.$.simpleSegment(0,0,4,2);const A=new c.aW;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(A);const C=new c.aX;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(C);const I=this.context.gl;this.stencilClearMode=new Kn({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const s=this.context,u=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=c.F();c.aN(p,0,this.width,this.height,0,0,1),c.J(p,p,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,u.TRIANGLES,kn.disabled,this.stencilClearMode,bi.disabled,qn.disabled,Dh(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,u){if(this.currentStencilSource===s.source||!s.isTileClipped()||!u||!u.length)return;this.currentStencilSource=s.source;const p=this.context,m=p.gl;this.nextStencilID+u.length>256&&this.clearStencil(),p.setColorMode(bi.disabled),p.setDepthMode(kn.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of u){const C=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);y.draw(p,m.TRIANGLES,kn.disabled,new Kn({func:m.ALWAYS,mask:0},C,255,m.KEEP,m.KEEP,m.REPLACE),bi.disabled,qn.disabled,Dh(A.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,u=this.context.gl;return new Kn({func:u.NOTEQUAL,mask:255},s,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(s){const u=this.context.gl;return new Kn({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(s){const u=this.context.gl,p=s.sort((A,C)=>C.overscaledZ-A.overscaledZ),m=p[p.length-1].overscaledZ,y=p[0].overscaledZ-m+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const A={};for(let C=0;C<y;C++)A[C+m]=new Kn({func:u.GEQUAL,mask:255},C+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=y,[A,p]}return[{[m]:Kn.disabled},p]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new bi([s.CONSTANT_COLOR,s.ONE],new c.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?bi.unblended:bi.alphaBlended}depthModeForSublayer(s,u,p){if(!this.opaquePassEnabledForLayer())return kn.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new kn(p||this.context.gl.LEQUAL,u,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,u){this.style=s,this.options=u,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(E.now()),this.imageManager.beginFrame();const p=this.style._order,m=this.style.sourceCaches,y={},A={},C={};for(const I in m){const N=m[I];N.used&&N.prepare(this.context),y[I]=N.getVisibleCoordinates(),A[I]=y[I].slice().reverse(),C[I]=N.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<p.length;I++)if(this.style._layers[p[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of p){const N=this.style._layers[I];if(!N.hasOffscreenPass()||N.isHidden(this.transform.zoom))continue;const W=A[N.source];(N.type==="custom"||W.length)&&this.renderLayer(this,m[N.source],N,W)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?c.aO.black:c.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[p[this.currentLayer]],N=m[I.source],W=y[I.source];this._renderTileClippingMasks(I,W),this.renderLayer(this,N,I,W)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const I=this.style._layers[p[this.currentLayer]],N=m[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const W=(I.type==="symbol"?C:A)[I.source];this._renderTileClippingMasks(I,y[I.source]),this.renderLayer(this,N,I,W)}if(this.options.showTileBoundaries){const I=function(N,W){let X=null;const ne=Object.values(N._layers).flatMap(le=>le.source&&!le.isHidden(W)?[N.sourceCaches[le.source]]:[]),pe=ne.filter(le=>le.getSource().type==="vector"),de=ne.filter(le=>le.getSource().type!=="vector"),_e=le=>{(!X||X.getSource().maxzoom<le.getSource().maxzoom)&&(X=le)};return pe.forEach(le=>_e(le)),X||de.forEach(le=>_e(le)),X}(this.style,this.transform.zoom);I&&function(N,W,X){for(let ne=0;ne<X.length;ne++)Xh(N,W,X[ne])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const N=I.transform.padding;ua(I,I.transform.height-(N.top||0),3,Hc),ua(I,N.bottom||0,3,$h),zr(I,N.left||0,3,I_),zr(I,I.transform.width-(N.right||0),3,Sp);const W=I.transform.centerPoint;(function(X,ne,pe,de){Eo(X,ne-1,pe-10,2,20,de),Eo(X,ne-10,pe-1,20,2,de)})(I,W.x,I.transform.height-W.y,yi)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const u=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let m=this.terrainFacilitator.dirty;m||(m=s?!c.aY(u,p):!c.aZ(u,p)),m||(m=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),m&&(c.a_(u,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(y,A){const C=y.context,I=C.gl,N=bi.unblended,W=new kn(I.LEQUAL,kn.ReadWrite,[0,1]),X=A.getTerrainMesh(),ne=A.sourceCache.getRenderableTiles(),pe=y.useProgram("terrainDepth");C.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:c.aO.transparent,depth:1});for(const de of ne){const _e=A.getTerrainData(de.tileID),le={u_matrix:y.transform.calculatePosMatrix(de.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(y.transform.zoom)};pe.draw(C,I.TRIANGLES,W,Kn.disabled,N,qn.backCCW,le,_e,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain),function(y,A){const C=y.context,I=C.gl,N=bi.unblended,W=new kn(I.LEQUAL,kn.ReadWrite,[0,1]),X=A.getTerrainMesh(),ne=A.getCoordsTexture(),pe=A.sourceCache.getRenderableTiles(),de=y.useProgram("terrainCoords");C.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,y.width/devicePixelRatio,y.height/devicePixelRatio]),C.clear({color:c.aO.transparent,depth:1}),A.coordsIndex=[];for(const _e of pe){const le=A.getTerrainData(_e.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,ne.texture);const Ae={u_matrix:y.transform.calculatePosMatrix(_e.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(y.transform.zoom)};de.draw(C,I.TRIANGLES,W,Kn.disabled,N,qn.backCCW,Ae,le,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),A.coordsIndex.push(_e.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,y.width,y.height])}(this,this.style.map.terrain))}renderLayer(s,u,p,m){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(m||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(y,A,C,I,N){if(y.renderPass!=="translucent")return;const W=Kn.disabled,X=y.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(ne,pe,de,_e,le,Ae,Oe){const ve=pe.transform,Ie=le==="map",He=Ae==="map";for(const We of ne){const Qe=_e.getTile(We),dt=Qe.getBucket(de);if(!dt||!dt.text||!dt.text.segments.get().length)continue;const lt=c.ag(dt.textSizeData,ve.zoom),ht=on(Qe,1,pe.transform.zoom),Ut=rt(We.posMatrix,He,Ie,pe.transform,ht),gn=de.layout.get("icon-text-fit")!=="none"&&dt.hasIconData();if(lt){const Et=Math.pow(2,ve.zoom-Qe.tileID.overscaledZ);Vc(dt,Ie,He,Oe,ve,Ut,We.posMatrix,Et,lt,gn,pe.style.map.terrain?(hn,xn)=>pe.style.map.terrain.getElevation(We,hn,xn):null)}}}(I,y,C,A,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),N),C.paint.get("icon-opacity").constantOr(1)!==0&&vp(y,A,C,I,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),W,X),C.paint.get("text-opacity").constantOr(1)!==0&&vp(y,A,C,I,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),W,X),A.map.showCollisionBoxes&&(Oc(y,A,C,I,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),!0),Oc(y,A,C,I,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),!1))})(s,u,p,m,this.style.placement.variableOffsets);break;case"circle":(function(y,A,C,I){if(y.renderPass!=="translucent")return;const N=C.paint.get("circle-opacity"),W=C.paint.get("circle-stroke-width"),X=C.paint.get("circle-stroke-opacity"),ne=!C.layout.get("circle-sort-key").isConstant();if(N.constantOr(1)===0&&(W.constantOr(1)===0||X.constantOr(1)===0))return;const pe=y.context,de=pe.gl,_e=y.depthModeForSublayer(0,kn.ReadOnly),le=Kn.disabled,Ae=y.colorModeForRenderPass(),Oe=[];for(let ve=0;ve<I.length;ve++){const Ie=I[ve],He=A.getTile(Ie),We=He.getBucket(C);if(!We)continue;const Qe=We.programConfigurations.get(C.id),dt=y.useProgram("circle",Qe),lt=We.layoutVertexBuffer,ht=We.indexBuffer,Ut=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Ie),gn={programConfiguration:Qe,program:dt,layoutVertexBuffer:lt,indexBuffer:ht,uniformValues:ap(y,Ie,He,C),terrainData:Ut};if(ne){const Et=We.segments.get();for(const hn of Et)Oe.push({segments:new c.$([hn]),sortKey:hn.sortKey,state:gn})}else Oe.push({segments:We.segments,sortKey:0,state:gn})}ne&&Oe.sort((ve,Ie)=>ve.sortKey-Ie.sortKey);for(const ve of Oe){const{programConfiguration:Ie,program:He,layoutVertexBuffer:We,indexBuffer:Qe,uniformValues:dt,terrainData:lt}=ve.state;He.draw(pe,de.TRIANGLES,_e,le,Ae,qn.disabled,dt,lt,C.id,We,Qe,ve.segments,C.paint,y.transform.zoom,Ie)}})(s,u,p,m);break;case"heatmap":(function(y,A,C,I){if(C.paint.get("heatmap-opacity")!==0)if(y.renderPass==="offscreen"){const N=y.context,W=N.gl,X=Kn.disabled,ne=new bi([W.ONE,W.ONE],c.aO.transparent,[!0,!0,!0,!0]);(function(pe,de,_e){const le=pe.gl;pe.activeTexture.set(le.TEXTURE1),pe.viewport.set([0,0,de.width/4,de.height/4]);let Ae=_e.heatmapFbo;if(Ae)le.bindTexture(le.TEXTURE_2D,Ae.colorAttachment.get()),pe.bindFramebuffer.set(Ae.framebuffer);else{const Oe=le.createTexture();le.bindTexture(le.TEXTURE_2D,Oe),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_S,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_WRAP_T,le.CLAMP_TO_EDGE),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MIN_FILTER,le.LINEAR),le.texParameteri(le.TEXTURE_2D,le.TEXTURE_MAG_FILTER,le.LINEAR),Ae=_e.heatmapFbo=pe.createFramebuffer(de.width/4,de.height/4,!1,!1),function(ve,Ie,He,We){var Qe,dt;const lt=ve.gl,ht=(Qe=ve.HALF_FLOAT)!==null&&Qe!==void 0?Qe:lt.UNSIGNED_BYTE,Ut=(dt=ve.RGBA16F)!==null&&dt!==void 0?dt:lt.RGBA;lt.texImage2D(lt.TEXTURE_2D,0,Ut,Ie.width/4,Ie.height/4,0,lt.RGBA,ht,null),We.colorAttachment.set(He)}(pe,de,Oe,Ae)}})(N,y,C),N.clear({color:c.aO.transparent});for(let pe=0;pe<I.length;pe++){const de=I[pe];if(A.hasRenderableParent(de))continue;const _e=A.getTile(de),le=_e.getBucket(C);if(!le)continue;const Ae=le.programConfigurations.get(C.id),Oe=y.useProgram("heatmap",Ae),{zoom:ve}=y.transform;Oe.draw(N,W.TRIANGLES,kn.disabled,X,ne,qn.disabled,op(de.posMatrix,_e,ve,C.paint.get("heatmap-intensity")),null,C.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,C.paint,y.transform.zoom,Ae)}N.viewport.set([0,0,y.width,y.height])}else y.renderPass==="translucent"&&(y.context.setColorMode(y.colorModeForRenderPass()),function(N,W){const X=N.context,ne=X.gl,pe=W.heatmapFbo;if(!pe)return;X.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_2D,pe.colorAttachment.get()),X.activeTexture.set(ne.TEXTURE1);let de=W.colorRampTexture;de||(de=W.colorRampTexture=new ke(X,W.colorRamp,ne.RGBA)),de.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),N.useProgram("heatmapTexture").draw(X,ne.TRIANGLES,kn.disabled,Kn.disabled,N.colorModeForRenderPass(),qn.disabled,((_e,le,Ae,Oe)=>{const ve=c.F();c.aN(ve,0,_e.width,_e.height,0,0,1);const Ie=_e.context.gl;return{u_matrix:ve,u_world:[Ie.drawingBufferWidth,Ie.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:le.paint.get("heatmap-opacity")}})(N,W),null,W.id,N.viewportBuffer,N.quadTriangleIndexBuffer,N.viewportSegments,W.paint,N.transform.zoom)}(y,C))})(s,u,p,m);break;case"line":(function(y,A,C,I){if(y.renderPass!=="translucent")return;const N=C.paint.get("line-opacity"),W=C.paint.get("line-width");if(N.constantOr(1)===0||W.constantOr(1)===0)return;const X=y.depthModeForSublayer(0,kn.ReadOnly),ne=y.colorModeForRenderPass(),pe=C.paint.get("line-dasharray"),de=C.paint.get("line-pattern"),_e=de.constantOr(1),le=C.paint.get("line-gradient"),Ae=C.getCrossfadeParameters(),Oe=_e?"linePattern":pe?"lineSDF":le?"lineGradient":"line",ve=y.context,Ie=ve.gl;let He=!0;for(const We of I){const Qe=A.getTile(We);if(_e&&!Qe.patternsLoaded())continue;const dt=Qe.getBucket(C);if(!dt)continue;const lt=dt.programConfigurations.get(C.id),ht=y.context.program.get(),Ut=y.useProgram(Oe,lt),gn=He||Ut.program!==ht,Et=y.style.map.terrain&&y.style.map.terrain.getTerrainData(We),hn=de.constantOr(null);if(hn&&Qe.imageAtlas){const pn=Qe.imageAtlas,Sn=pn.patternPositions[hn.to.toString()],Mn=pn.patternPositions[hn.from.toString()];Sn&&Mn&&lt.setConstantPatternPositions(Sn,Mn)}const xn=Et?We:null,Rn=_e?Lc(y,Qe,C,Ae,xn):pe?Zr(y,Qe,C,pe,Ae,xn):le?Ca(y,Qe,C,dt.lineClipsArray.length,xn):Ic(y,Qe,C,xn);if(_e)ve.activeTexture.set(Ie.TEXTURE0),Qe.imageAtlasTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE),lt.updatePaintBuffers(Ae);else if(pe&&(gn||y.lineAtlas.dirty))ve.activeTexture.set(Ie.TEXTURE0),y.lineAtlas.bind(ve);else if(le){const pn=dt.gradients[C.id];let Sn=pn.texture;if(C.gradientVersion!==pn.version){let Mn=256;if(C.stepInterpolant){const ui=A.getSource().maxzoom,Zn=We.canonical.z===ui?Math.ceil(1<<y.transform.maxZoom-We.canonical.z):1;Mn=c.ac(c.aT(dt.maxLineLength/c.W*1024*Zn),256,ve.maxTextureSize)}pn.gradient=c.aU({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:Mn,image:pn.gradient||void 0,clips:dt.lineClipsArray}),pn.texture?pn.texture.update(pn.gradient):pn.texture=new ke(ve,pn.gradient,Ie.RGBA),pn.version=C.gradientVersion,Sn=pn.texture}ve.activeTexture.set(Ie.TEXTURE0),Sn.bind(C.stepInterpolant?Ie.NEAREST:Ie.LINEAR,Ie.CLAMP_TO_EDGE)}Ut.draw(ve,Ie.TRIANGLES,X,y.stencilModeForClipping(We),ne,qn.disabled,Rn,Et,C.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,C.paint,y.transform.zoom,lt,dt.layoutVertexBuffer2),He=!1}})(s,u,p,m);break;case"fill":(function(y,A,C,I){const N=C.paint.get("fill-color"),W=C.paint.get("fill-opacity");if(W.constantOr(1)===0)return;const X=y.colorModeForRenderPass(),ne=C.paint.get("fill-pattern"),pe=y.opaquePassEnabledForLayer()&&!ne.constantOr(1)&&N.constantOr(c.aO.transparent).a===1&&W.constantOr(0)===1?"opaque":"translucent";if(y.renderPass===pe){const de=y.depthModeForSublayer(1,y.renderPass==="opaque"?kn.ReadWrite:kn.ReadOnly);jh(y,A,C,I,de,X,!1)}if(y.renderPass==="translucent"&&C.paint.get("fill-antialias")){const de=y.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,kn.ReadOnly);jh(y,A,C,I,de,X,!0)}})(s,u,p,m);break;case"fill-extrusion":(function(y,A,C,I){const N=C.paint.get("fill-extrusion-opacity");if(N!==0&&y.renderPass==="translucent"){const W=new kn(y.context.gl.LEQUAL,kn.ReadWrite,y.depthRangeFor3D);if(N!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))To(y,A,C,I,W,Kn.disabled,bi.disabled),To(y,A,C,I,W,y.stencilModeFor3D(),y.colorModeForRenderPass());else{const X=y.colorModeForRenderPass();To(y,A,C,I,W,Kn.disabled,X)}}})(s,u,p,m);break;case"hillshade":(function(y,A,C,I){if(y.renderPass!=="offscreen"&&y.renderPass!=="translucent")return;const N=y.context,W=y.depthModeForSublayer(0,kn.ReadOnly),X=y.colorModeForRenderPass(),[ne,pe]=y.renderPass==="translucent"?y.stencilConfigForOverlap(I):[{},I];for(const de of pe){const _e=A.getTile(de);_e.needsHillshadePrepare!==void 0&&_e.needsHillshadePrepare&&y.renderPass==="offscreen"?bp(y,_e,C,W,Kn.disabled,X):y.renderPass==="translucent"&&Wh(y,de,_e,C,W,ne[de.overscaledZ],X)}N.viewport.set([0,0,y.width,y.height])})(s,u,p,m);break;case"raster":(function(y,A,C,I){if(y.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!I.length)return;const N=y.context,W=N.gl,X=A.getSource(),ne=y.useProgram("raster"),pe=y.colorModeForRenderPass(),[de,_e]=X instanceof ft?[{},I]:y.stencilConfigForOverlap(I),le=_e[_e.length-1].overscaledZ,Ae=!y.options.moving;for(const Oe of _e){const ve=y.depthModeForSublayer(Oe.overscaledZ-le,C.paint.get("raster-opacity")===1?kn.ReadWrite:kn.ReadOnly,W.LESS),Ie=A.getTile(Oe);Ie.registerFadeDuration(C.paint.get("raster-fade-duration"));const He=A.findLoadedParent(Oe,0),We=wp(Ie,He,A,C,y.transform,y.style.map.terrain);let Qe,dt;const lt=C.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR;N.activeTexture.set(W.TEXTURE0),Ie.texture.bind(lt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),N.activeTexture.set(W.TEXTURE1),He?(He.texture.bind(lt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST),Qe=Math.pow(2,He.tileID.overscaledZ-Ie.tileID.overscaledZ),dt=[Ie.tileID.canonical.x*Qe%1,Ie.tileID.canonical.y*Qe%1]):Ie.texture.bind(lt,W.CLAMP_TO_EDGE,W.LINEAR_MIPMAP_NEAREST);const ht=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Oe),Ut=ht?Oe:null,gn=Ut?Ut.posMatrix:y.transform.calculatePosMatrix(Oe.toUnwrapped(),Ae),Et=Il(gn,dt||[0,0],Qe||1,We,C);X instanceof ft?ne.draw(N,W.TRIANGLES,ve,Kn.disabled,pe,qn.disabled,Et,ht,C.id,X.boundsBuffer,y.quadTriangleIndexBuffer,X.boundsSegments):ne.draw(N,W.TRIANGLES,ve,de[Oe.overscaledZ],pe,qn.disabled,Et,ht,C.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}})(s,u,p,m);break;case"background":(function(y,A,C,I){const N=C.paint.get("background-color"),W=C.paint.get("background-opacity");if(W===0)return;const X=y.context,ne=X.gl,pe=y.transform,de=pe.tileSize,_e=C.paint.get("background-pattern");if(y.isPatternMissing(_e))return;const le=!_e&&N.a===1&&W===1&&y.opaquePassEnabledForLayer()?"opaque":"translucent";if(y.renderPass!==le)return;const Ae=Kn.disabled,Oe=y.depthModeForSublayer(0,le==="opaque"?kn.ReadWrite:kn.ReadOnly),ve=y.colorModeForRenderPass(),Ie=y.useProgram(_e?"backgroundPattern":"background"),He=I||pe.coveringTiles({tileSize:de,terrain:y.style.map.terrain});_e&&(X.activeTexture.set(ne.TEXTURE0),y.imageManager.bind(y.context));const We=C.getCrossfadeParameters();for(const Qe of He){const dt=I?Qe.posMatrix:y.transform.calculatePosMatrix(Qe.toUnwrapped()),lt=_e?cp(dt,W,y,_e,{tileID:Qe,tileSize:de},We):b_(dt,W,N),ht=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Qe);Ie.draw(X,ne.TRIANGLES,Oe,Ae,ve,qn.disabled,lt,ht,C.id,y.tileExtentBuffer,y.quadTriangleIndexBuffer,y.tileExtentSegments)}})(s,0,p,m);break;case"custom":(function(y,A,C){const I=y.context,N=C.implementation;if(y.renderPass==="offscreen"){const W=N.prerender;W&&(y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),W.call(N,I.gl,y.transform.customLayerMatrix()),I.setDirty(),y.setBaseState())}else if(y.renderPass==="translucent"){y.setCustomLayerDefaults(),I.setColorMode(y.colorModeForRenderPass()),I.setStencilMode(Kn.disabled);const W=N.renderingMode==="3d"?new kn(y.context.gl.LEQUAL,kn.ReadWrite,y.depthRangeFor3D):y.depthModeForSublayer(0,kn.ReadOnly);I.setDepthMode(W),N.render(I.gl,y.transform.customLayerMatrix()),I.setDirty(),y.setBaseState(),I.bindFramebuffer.set(null)}})(s,0,p)}}translatePosMatrix(s,u,p,m,y){if(!p[0]&&!p[1])return s;const A=y?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(A){const N=Math.sin(A),W=Math.cos(A);p=[p[0]*W-p[1]*N,p[0]*N+p[1]*W]}const C=[y?p[0]:on(u,p[0],this.transform.zoom),y?p[1]:on(u,p[1],this.transform.zoom),0],I=new Float32Array(16);return c.H(I,s,C),I}saveTileTexture(s){const u=this._tileTextures[s.size[0]];u?u.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const u=this._tileTextures[s];return u&&u.length>0?u.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const u=this.imageManager.getPattern(s.from.toString()),p=this.imageManager.getPattern(s.to.toString());return!u||!p}useProgram(s,u){this.cache=this.cache||{};const p=s+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new Lh(this.context,ca[s],u,w_[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ke(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:u}=this.context.gl;return this.width!==s||this.height!==u}}class Ia{constructor(s,u){this.points=s,this.planes=u}static fromInvProjectionMatrix(s,u,p){const m=Math.pow(2,p),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const I=1/(C=c.af([],C,s))[3]/u*m;return c.a$(C,C,[I,I,1/C[3],I])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const I=function(ne,pe){var de=pe[0],_e=pe[1],le=pe[2],Ae=de*de+_e*_e+le*le;return Ae>0&&(Ae=1/Math.sqrt(Ae)),ne[0]=pe[0]*Ae,ne[1]=pe[1]*Ae,ne[2]=pe[2]*Ae,ne}([],function(ne,pe,de){var _e=pe[0],le=pe[1],Ae=pe[2],Oe=de[0],ve=de[1],Ie=de[2];return ne[0]=le*Ie-Ae*ve,ne[1]=Ae*Oe-_e*Ie,ne[2]=_e*ve-le*Oe,ne}([],ae([],y[C[0]],y[C[1]]),ae([],y[C[2]],y[C[1]]))),N=-((W=I)[0]*(X=y[C[1]])[0]+W[1]*X[1]+W[2]*X[2]);var W,X;return I.concat(N)});return new Ia(y,A)}}class Co{constructor(s,u){this.min=s,this.max=u,this.center=function(p,m,y){return p[0]=.5*m[0],p[1]=.5*m[1],p[2]=.5*m[2],p}([],function(p,m,y){return p[0]=m[0]+y[0],p[1]=m[1]+y[1],p[2]=m[2]+y[2],p}([],this.min,this.max))}quadrant(s){const u=[s%2==0,s<2],p=te(this.min),m=te(this.max);for(let y=0;y<u.length;y++)p[y]=u[y]?this.min[y]:this.center[y],m[y]=u[y]?this.center[y]:this.max[y];return m[2]=this.max[2],new Co(p,m)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const u=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let m=0;m<s.planes.length;m++){const y=s.planes[m];let A=0;for(let C=0;C<u.length;C++)c.b0(y,u[C])>=0&&A++;if(A===0)return 0;A!==u.length&&(p=!1)}if(p)return 2;for(let m=0;m<3;m++){let y=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let C=0;C<s.points.length;C++){const I=s.points[C][m]-this.min[m];y=Math.min(y,I),A=Math.max(A,I)}if(A<0||y>this.max[m]-this.min[m])return 0}return 1}}class kl{constructor(s=0,u=0,p=0,m=0){if(isNaN(s)||s<0||isNaN(u)||u<0||isNaN(p)||p<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=u,this.left=p,this.right=m}interpolate(s,u,p){return u.top!=null&&s.top!=null&&(this.top=c.z.number(s.top,u.top,p)),u.bottom!=null&&s.bottom!=null&&(this.bottom=c.z.number(s.bottom,u.bottom,p)),u.left!=null&&s.left!=null&&(this.left=c.z.number(s.left,u.left,p)),u.right!=null&&s.right!=null&&(this.right=c.z.number(s.right,u.right,p)),this}getCenter(s,u){const p=c.ac((this.left+s-this.right)/2,0,s),m=c.ac((this.top+u-this.bottom)/2,0,u);return new c.P(p,m)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new kl(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Zh=85.051129;class jc{constructor(s,u,p,m,y){this.tileSize=512,this._renderWorldCopies=y===void 0||!!y,this._minZoom=s||0,this._maxZoom=u||22,this._minPitch=p??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new c.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new kl,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new jc(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const u=-c.b1(s,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=function(){var p=new c.A(4);return c.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,m,y){var A=m[0],C=m[1],I=m[2],N=m[3],W=Math.sin(y),X=Math.cos(y);p[0]=A*X+I*W,p[1]=C*X+N*W,p[2]=A*-W+I*X,p[3]=C*-W+N*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const u=c.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const u=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.tileZoom=Math.max(0,Math.floor(u)),this.scale=this.zoomScale(u),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,u,p){this._unmodified=!1,this._edgeInsets.interpolate(s,u,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const u=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(s){const u=[new c.b2(0,s)];if(this._renderWorldCopies){const p=this.pointCoordinate(new c.P(0,0)),m=this.pointCoordinate(new c.P(this.width,0)),y=this.pointCoordinate(new c.P(this.width,this.height)),A=this.pointCoordinate(new c.P(0,this.height)),C=Math.floor(Math.min(p.x,m.x,y.x,A.x)),I=Math.floor(Math.max(p.x,m.x,y.x,A.x)),N=1;for(let W=C-N;W<=I+N;W++)W!==0&&u.push(new c.b2(W,s))}return u}coveringTiles(s){var u,p;let m=this.coveringZoomLevel(s);const y=m;if(s.minzoom!==void 0&&m<s.minzoom)return[];s.maxzoom!==void 0&&m>s.maxzoom&&(m=s.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),C=c.Y.fromLngLat(this.center),I=Math.pow(2,m),N=[I*A.x,I*A.y,0],W=[I*C.x,I*C.y,0],X=Ia.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let ne=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(ne=m);const pe=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,de=ve=>({aabb:new Co([ve*I,0,0],[(ve+1)*I,I,0]),zoom:0,x:0,y:0,wrap:ve,fullyVisible:!1}),_e=[],le=[],Ae=m,Oe=s.reparseOverscaled?y:m;if(this._renderWorldCopies)for(let ve=1;ve<=3;ve++)_e.push(de(-ve)),_e.push(de(ve));for(_e.push(de(0));_e.length>0;){const ve=_e.pop(),Ie=ve.x,He=ve.y;let We=ve.fullyVisible;if(!We){const Ut=ve.aabb.intersects(X);if(Ut===0)continue;We=Ut===2}const Qe=s.terrain?N:W,dt=ve.aabb.distanceX(Qe),lt=ve.aabb.distanceY(Qe),ht=Math.max(Math.abs(dt),Math.abs(lt));if(ve.zoom===Ae||ht>pe+(1<<Ae-ve.zoom)-2&&ve.zoom>=ne){const Ut=Ae-ve.zoom,gn=N[0]-.5-(Ie<<Ut),Et=N[1]-.5-(He<<Ut);le.push({tileID:new c.Q(ve.zoom===Ae?Oe:ve.zoom,ve.wrap,ve.zoom,Ie,He),distanceSq:K([W[0]-.5-Ie,W[1]-.5-He]),tileDistanceToCamera:Math.sqrt(gn*gn+Et*Et)})}else for(let Ut=0;Ut<4;Ut++){const gn=(Ie<<1)+Ut%2,Et=(He<<1)+(Ut>>1),hn=ve.zoom+1;let xn=ve.aabb.quadrant(Ut);if(s.terrain){const Rn=new c.Q(hn,ve.wrap,hn,gn,Et),pn=s.terrain.getMinMaxElevation(Rn),Sn=(u=pn.minElevation)!==null&&u!==void 0?u:this.elevation,Mn=(p=pn.maxElevation)!==null&&p!==void 0?p:this.elevation;xn=new Co([xn.min[0],xn.min[1],Sn],[xn.max[0],xn.max[1],Mn])}_e.push({aabb:xn,zoom:hn,x:gn,y:Et,wrap:ve.wrap,fullyVisible:We})}}return le.sort((ve,Ie)=>ve.distanceSq-Ie.distanceSq).map(ve=>ve.tileID)}resize(s,u){this.width=s,this.height=u,this.pixelsToGLUnits=[2/s,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const u=c.ac(s.lat,-85.051129,Zh);return new c.P(c.N(s.lng)*this.worldSize,c.O(u)*this.worldSize)}unproject(s){return new c.Y(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const u=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,m=this.pointLocation(this.centerPoint,s),y=s.getElevationForLngLatZoom(m,this.tileZoom);if(!(this.elevation-y))return;const A=p+u-y,C=Math.cos(this._pitch)*this.cameraToCenterDistance/A/c.b3(1,m.lat),I=this.scaleZoom(C/this.tileSize);this._elevation=y,this._center=m,this.zoom=I}setLocationAtPoint(s,u){const p=this.pointCoordinate(u),m=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(s),A=new c.Y(y.x-(p.x-m.x),y.y-(p.y-m.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,u){return u?this.coordinatePoint(this.locationCoordinate(s),u.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,u){return this.coordinateLocation(this.pointCoordinate(s,u))}locationCoordinate(s){return c.Y.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,u){if(u){const ne=u.pointCoordinate(s);if(ne!=null)return ne}const p=[s.x,s.y,0,1],m=[s.x,s.y,1,1];c.af(p,p,this.pixelMatrixInverse),c.af(m,m,this.pixelMatrixInverse);const y=p[3],A=m[3],C=p[1]/y,I=m[1]/A,N=p[2]/y,W=m[2]/A,X=N===W?0:(0-N)/(W-N);return new c.Y(c.z.number(p[0]/y,m[0]/A,X)/this.worldSize,c.z.number(C,I,X)/this.worldSize)}coordinatePoint(s,u=0,p=this.pixelMatrix){const m=[s.x*this.worldSize,s.y*this.worldSize,u,1];return c.af(m,m,p),new c.P(m[0]/m[3],m[1]/m[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Wt().extend(this.pointLocation(new c.P(0,s))).extend(this.pointLocation(new c.P(this.width,s))).extend(this.pointLocation(new c.P(this.width,this.height))).extend(this.pointLocation(new c.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Wt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Zh])}calculatePosMatrix(s,u=!1){const p=s.key,m=u?this._alignedPosMatrixCache:this._posMatrixCache;if(m[p])return m[p];const y=s.canonical,A=this.worldSize/this.zoomScale(y.z),C=y.x+Math.pow(2,y.z)*s.wrap,I=c.an(new Float64Array(16));return c.H(I,I,[C*A,y.y*A,0]),c.J(I,I,[A/c.W,A/c.W,1]),c.K(I,u?this.alignedProjMatrix:this.projMatrix,I),m[p]=new Float32Array(I),m[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,u){u=c.ac(+u,this.minZoom,this.maxZoom);const p={center:new c.M(s.lng,s.lat),zoom:u};let m=this.lngRange;if(!this._renderWorldCopies&&m===null){const ve=179.9999999999;m=[-ve,ve]}const y=this.tileSize*this.zoomScale(p.zoom);let A=0,C=y,I=0,N=y,W=0,X=0;const{x:ne,y:pe}=this.size;if(this.latRange){const ve=this.latRange;A=c.O(ve[1])*y,C=c.O(ve[0])*y,C-A<pe&&(W=pe/(C-A))}m&&(I=c.b1(c.N(m[0])*y,0,y),N=c.b1(c.N(m[1])*y,0,y),N<I&&(N+=y),N-I<ne&&(X=ne/(N-I)));const{x:de,y:_e}=this.project.call({worldSize:y},s);let le,Ae;const Oe=Math.max(X||0,W||0);if(Oe){const ve=new c.P(X?(N+I)/2:de,W?(C+A)/2:_e);return p.center=this.unproject.call({worldSize:y},ve).wrap(),p.zoom+=this.scaleZoom(Oe),p}if(this.latRange){const ve=pe/2;_e-ve<A&&(Ae=A+ve),_e+ve>C&&(Ae=C-ve)}if(m){const ve=(I+N)/2;let Ie=de;this._renderWorldCopies&&(Ie=c.b1(de,ve-y/2,ve+y/2));const He=ne/2;Ie-He<I&&(le=I+He),Ie+He>N&&(le=N-He)}if(le!==void 0||Ae!==void 0){const ve=new c.P(le??de,Ae??_e);p.center=this.unproject.call({worldSize:y},ve).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:u,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=u,this.zoom=p,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,u=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=c.b3(1,this.center.lat)*this.worldSize;let m=c.an(new Float64Array(16));c.J(m,m,[this.width/2,-this.height/2,1]),c.H(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=c.an(new Float64Array(16)),c.J(m,m,[1,-1,1]),c.H(m,m,[-1,-1,0]),c.J(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m;const y=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),C=y-A*this._pixelPerMeter/Math.cos(this._pitch),I=A<0?C:y,N=Math.PI/2+this._pitch,W=this._fov*(.5+s.y/this.height),X=Math.sin(W)*I/Math.sin(c.ac(Math.PI-N-W,.01,Math.PI-.01)),ne=this.getHorizon(),pe=2*Math.atan(ne/this.cameraToCenterDistance)*(.5+s.y/(2*ne)),de=Math.sin(pe)*I/Math.sin(c.ac(Math.PI-N-pe,.01,Math.PI-.01)),_e=Math.min(X,de),le=1.01*(Math.cos(Math.PI/2-this._pitch)*_e+I),Ae=this.height/50;m=new Float64Array(16),c.b4(m,this._fov,this.width/this.height,Ae,le),m[8]=2*-s.x/this.width,m[9]=2*s.y/this.height,c.J(m,m,[1,-1,1]),c.H(m,m,[0,0,-this.cameraToCenterDistance]),c.b5(m,m,this._pitch),c.ad(m,m,this.angle),c.H(m,m,[-u,-p,0]),this.mercatorMatrix=c.J([],m,[this.worldSize,this.worldSize,this.worldSize]),c.J(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=c.K(new Float64Array(16),this.labelPlaneMatrix,m),c.H(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=c.ar([],m),this.pixelMatrix3D=c.K(new Float64Array(16),this.labelPlaneMatrix,m);const Oe=this.width%2/2,ve=this.height%2/2,Ie=Math.cos(this.angle),He=Math.sin(this.angle),We=u-Math.round(u)+Ie*Oe+He*ve,Qe=p-Math.round(p)+Ie*ve+He*Oe,dt=new Float64Array(m);if(c.H(dt,dt,[We>.5?We-1:We,Qe>.5?Qe-1:Qe,0]),this.alignedProjMatrix=dt,m=c.ar(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new c.P(0,0)),u=[s.x*this.worldSize,s.y*this.worldSize,0,1];return c.af(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.P(0,s))}getCameraQueryGeometry(s){const u=this.getCameraPoint();if(s.length===1)return[s[0],u];{let p=u.x,m=u.y,y=u.x,A=u.y;for(const C of s)p=Math.min(p,C.x),m=Math.min(m,C.y),y=Math.max(y,C.x),A=Math.max(A,C.y);return[new c.P(p,m),new c.P(y,m),new c.P(y,A),new c.P(p,A),new c.P(p,m)]}}lngLatToCameraDepth(s,u){const p=this.locationCoordinate(s),m=[p.x*this.worldSize,p.y*this.worldSize,u,1];return c.af(m,m,this.projMatrix),m[2]/m[3]}}function Yh(_,s){let u,p=!1,m=null,y=null;const A=()=>{m=null,p&&(_.apply(y,u),m=setTimeout(A,s),p=!1)};return(...C)=>(p=!0,y=this,u=C,m||A(),m)}class Kh{constructor(s){this._getCurrentHash=()=>{const u=window.location.hash.replace("#","");if(this._hashName){let p;return u.split("&").map(m=>m.split("=")).forEach(m=>{m[0]===this._hashName&&(p=m)}),(p&&p[1]||"").split("/")}return u.split("/")},this._onHashChange=()=>{const u=this._getCurrentHash();if(u.length>=3&&!u.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(u[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:p,pitch:+(u[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const u=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,u)}catch{}},this._updateHash=Yh(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const u=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,m=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,m),A=Math.round(u.lng*y)/y,C=Math.round(u.lat*y)/y,I=this._map.getBearing(),N=this._map.getPitch();let W="";if(W+=s?`/${A}/${C}/${p}`:`${p}/${C}/${A}`,(I||N)&&(W+="/"+Math.round(10*I)/10),N&&(W+=`/${Math.round(N)}`),this._hashName){const X=this._hashName;let ne=!1;const pe=window.location.hash.slice(1).split("&").map(de=>{const _e=de.split("=")[0];return _e===X?(ne=!0,`${_e}=${W}`):de}).filter(de=>de);return ne||pe.push(`${X}=${W}`),`#${pe.join("&")}`}return`#${W}`}}const Ss={linearity:.3,easing:c.b6(0,0,.3,1)},Mp=c.e({deceleration:2500,maxSpeed:1400},Ss),Tp=c.e({deceleration:20,maxSpeed:1400},Ss),Ep=c.e({deceleration:1e3,maxSpeed:360},Ss),Ap=c.e({deceleration:1e3,maxSpeed:90},Ss);class Cp{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:E.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,u=E.now();for(;s.length>0&&u-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new c.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(u.pan.mag()){const y=Ul(u.pan.mag(),p,c.e({},Mp,s||{}));m.offset=u.pan.mult(y.amount/u.pan.mag()),m.center=this._map.transform.center,Fl(m,y)}if(u.zoom){const y=Ul(u.zoom,p,Tp);m.zoom=this._map.transform.zoom+y.amount,Fl(m,y)}if(u.bearing){const y=Ul(u.bearing,p,Ep);m.bearing=this._map.transform.bearing+c.ac(y.amount,-179,179),Fl(m,y)}if(u.pitch){const y=Ul(u.pitch,p,Ap);m.pitch=this._map.transform.pitch+y.amount,Fl(m,y)}if(m.zoom||m.bearing){const y=u.pinchAround===void 0?u.around:u.pinchAround;m.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),c.e(m,{noMoveStart:!0})}}function Fl(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function Ul(_,s,u){const{maxSpeed:p,linearity:m,deceleration:y}=u,A=c.ac(_*m/(s/1e3),-p,p),C=Math.abs(A)/(y*m);return{easing:u.easing,duration:1e3*C,amount:A*(C/2)}}class Gi extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,p,m={}){const y=M.mousePos(u.getCanvas(),p),A=u.unproject(y);super(s,c.e({point:y,lngLat:A,originalEvent:p},m)),this._defaultPrevented=!1,this.target=u}}class Po extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,p){const m=s==="touchend"?p.changedTouches:p.touches,y=M.touchPos(u.getCanvasContainer(),m),A=y.map(I=>u.unproject(I)),C=y.reduce((I,N,W,X)=>I.add(N.div(X.length)),new c.P(0,0));super(s,{points:y,point:C,lngLats:A,lngLat:u.unproject(C),originalEvent:p}),this._defaultPrevented=!1}}class Yr extends c.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,u,p){super(s,{originalEvent:p}),this._defaultPrevented=!1}}class Ms{constructor(s,u){this._map=s,this._clickTolerance=u.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Yr(s.type,this._map,s))}mousedown(s,u){return this._mousedownPos=u,this._firePreventable(new Gi(s.type,this._map,s))}mouseup(s){this._map.fire(new Gi(s.type,this._map,s))}click(s,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Gi(s.type,this._map,s))}dblclick(s){return this._firePreventable(new Gi(s.type,this._map,s))}mouseover(s){this._map.fire(new Gi(s.type,this._map,s))}mouseout(s){this._map.fire(new Gi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Po(s.type,this._map,s))}touchmove(s){this._map.fire(new Po(s.type,this._map,s))}touchend(s){this._map.fire(new Po(s.type,this._map,s))}touchcancel(s){this._map.fire(new Po(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pp{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new Gi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new Gi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class gr{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(c.P.convert(s),this._map.terrain)}}class Ro{constructor(s,u){this._map=s,this._tr=new gr(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,u){this.isEnabled()&&s.shiftKey&&s.button===0&&(M.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(s,u){if(!this._active)return;const p=u;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=p,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const y=Math.min(m.x,p.x),A=Math.max(m.x,p.x),C=Math.min(m.y,p.y),I=Math.max(m.y,p.y);M.setTransform(this._box,`translate(${y}px,${C}px)`),this._box.style.width=A-y+"px",this._box.style.height=I-C+"px"}mouseupWindow(s,u){if(!this._active||s.button!==0)return;const p=this._startPos,m=u;if(this.reset(),M.suppressClick(),p.x!==m.x||p.y!==m.y)return this._map.fire(new c.k("boxzoomend",{originalEvent:s})),{cameraAnimation:y=>y.fitScreenCoordinates(p,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,u){return this._map.fire(new c.k(s,{originalEvent:u}))}}function Jh(_,s){if(_.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${s.length}`);const u={};for(let p=0;p<_.length;p++)u[_[p].identifier]=s[p];return u}class L_{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,u,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),p.length===this.numTouches&&(this.centroid=function(m){const y=new c.P(0,0);for(const A of m)y._add(A);return y.div(m.length)}(u),this.touches=Jh(p,u)))}touchmove(s,u,p){if(this.aborted||!this.centroid)return;const m=Jh(p,u);for(const y in this.touches){const A=m[y];(!A||A.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(s,u,p){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Qh{constructor(s){this.singleTap=new L_(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,u,p){this.singleTap.touchstart(s,u,p)}touchmove(s,u,p){this.singleTap.touchmove(s,u,p)}touchend(s,u,p){const m=this.singleTap.touchend(s,u,p);if(m){const y=s.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(m)<30;if(y&&A||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class Rp{constructor(s){this._tr=new gr(s),this._zoomIn=new Qh({numTouches:1,numTaps:2}),this._zoomOut=new Qh({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,u,p){this._zoomIn.touchstart(s,u,p),this._zoomOut.touchstart(s,u,p)}touchmove(s,u,p){this._zoomIn.touchmove(s,u,p),this._zoomOut.touchmove(s,u,p)}touchend(s,u,p){const m=this._zoomIn.touchend(s,u,p),y=this._zoomOut.touchend(s,u,p),A=this._tr;return m?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(m)},{originalEvent:s})}):y?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(y)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Gs{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const u=this._moveFunction(...s);if(u.bearingDelta||u.pitchDelta||u.around||u.panDelta)return this._active=!0,u}dragStart(s,u){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=u.length?u[0]:u,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,u){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const m=u.length?u[0]:u;return!this._moved&&m.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(p,m))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&M.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const ha={0:1,2:2};class Vt{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const u=M.mouseButton(s);this._eventButton=u}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(u,p){const m=ha[p];return u.buttons===void 0||(u.buttons&m)!==m}(s,this._eventButton)}isValidEndEvent(s){return M.mouseButton(s)===this._eventButton}}class ed{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const La=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(s){s.preventDefault()}},Io=({enable:_,clickTolerance:s,bearingDegreesPerPixelMoved:u=.8})=>{const p=new Vt({checkCorrectEvent:m=>M.mouseButton(m)===0&&m.ctrlKey||M.mouseButton(m)===2});return new Gs({clickTolerance:s,move:(m,y)=>({bearingDelta:(y.x-m.x)*u}),moveStateManager:p,enable:_,assignEvents:La})},td=({enable:_,clickTolerance:s,pitchDegreesPerPixelMoved:u=-.5})=>{const p=new Vt({checkCorrectEvent:m=>M.mouseButton(m)===0&&m.ctrlKey||M.mouseButton(m)===2});return new Gs({clickTolerance:s,move:(m,y)=>({pitchDelta:(y.y-m.y)*u}),moveStateManager:p,enable:_,assignEvents:La})};class zt{constructor(s,u){this._clickTolerance=s.clickTolerance||1,this._map=u,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new c.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,u,p){return this._calculateTransform(s,u,p)}touchmove(s,u,p){if(this._active&&!(p.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,u,p)}touchend(s,u,p){this._calculateTransform(s,u,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,u,p){p.length>0&&(this._active=!0);const m=Jh(p,u),y=new c.P(0,0),A=new c.P(0,0);let C=0;for(const N in m){const W=m[N],X=this._touches[N];X&&(y._add(W),A._add(W.sub(X)),C++,m[N]=W)}if(this._touches=m,C<this.minTouchs()||!A.mag())return;const I=A.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(C),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Nl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,u,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([u[0],u[1]]))}touchmove(s,u,p){if(!this._firstTwoTouches)return;s.preventDefault();const[m,y]=this._firstTwoTouches,A=Wc(p,u,m),C=Wc(p,u,y);if(!A||!C)return;const I=this._aroundCenter?null:A.add(C).div(2);return this._move([A,C],I,s)}touchend(s,u,p){if(!this._firstTwoTouches)return;const[m,y]=this._firstTwoTouches,A=Wc(p,u,m),C=Wc(p,u,y);A&&C||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Wc(_,s,u){for(let p=0;p<_.length;p++)if(_[p].identifier===u)return s[p]}function Ip(_,s){return Math.log(_/s)/Math.LN2}class $c extends Nl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,u){const p=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Ip(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Ip(this._distance,p),pinchAround:u}}}function nd(_,s){return 180*_.angleWith(s)/Math.PI}class id extends Nl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,u,p){const m=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:nd(this._vector,m),pinchAround:u}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const u=25/(Math.PI*this._minDiameter)*360,p=nd(s,this._startVector);return Math.abs(p)<u}}function rd(_){return Math.abs(_.y)>Math.abs(_.x)}class Lp extends Nl{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,u,p){super.touchstart(s,u,p),this._currentTouchCount=p.length}_start(s){this._lastPoints=s,rd(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,u,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const m=s[0].sub(this._lastPoints[0]),y=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,y,p.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(m.y+y.y)/2*-.5}):void 0}gestureBeginsVertically(s,u,p){if(this._valid!==void 0)return this._valid;const m=s.mag()>=2,y=u.mag()>=2;if(!m&&!y)return;if(!m||!y)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=s.y>0==u.y>0;return rd(s)&&rd(u)&&A}}const Da={panStep:100,bearingStep:15,pitchStep:10};class ti{constructor(s){this._tr=new gr(s);const u=Da;this._panStep=u.panStep,this._bearingStep=u.bearingStep,this._pitchStep=u.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let u=0,p=0,m=0,y=0,A=0;switch(s.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:s.shiftKey?p=-1:(s.preventDefault(),y=-1);break;case 39:s.shiftKey?p=1:(s.preventDefault(),y=1);break;case 38:s.shiftKey?m=1:(s.preventDefault(),A=-1);break;case 40:s.shiftKey?m=-1:(s.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,m=0),{cameraAnimation:C=>{const I=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:Xc,zoom:u?Math.round(I.zoom)+u*(s.shiftKey?2:1):I.zoom,bearing:I.bearing+p*this._bearingStep,pitch:I.pitch+m*this._pitchStep,offset:[-y*this._panStep,-A*this._panStep],center:I.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Xc(_){return _*(2-_)}const qc=4.000244140625;class sd{constructor(s,u){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=s,this._tr=new gr(s),this._triggerRenderFrame=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!s[this._map.cooperativeGestures._bypassKey])return;let u=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const p=E.now(),m=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,u!==0&&u%qc==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(m*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),s.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=s,this._delta-=u,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=M.mousePos(this._map.getCanvas(),s),p=this._tr;this._around=u.y>p.transform.height/2-p.transform.getHorizon()?c.M.convert(this._aroundCenter?p.center:p.unproject(u)):c.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const C=this._type==="wheel"&&Math.abs(this._delta)>qc?this._wheelZoomRate:this._defaultZoomRate;let I=2/(1+Math.exp(-Math.abs(this._delta*C)));this._delta<0&&I!==0&&(I=1/I);const N=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(N*I))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const u=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,p=this._startZoom,m=this._easing;let y,A=!1;if(this._type==="wheel"&&p&&m){const C=Math.min((E.now()-this._lastWheelEventTime)/200,1),I=m(C);y=c.z.number(p,u,I),C<1?this._frameId||(this._frameId=!0):A=!0}else y=u,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:y-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let u=c.b7;if(this._prevEase){const p=this._prevEase,m=(E.now()-p.start)/p.duration,y=p.easing(m+.01)-p.easing(m),A=.27/Math.sqrt(y*y+1e-4)*.01,C=Math.sqrt(.0729-A*A);u=c.b6(A,C,.25,1)}return this._prevEase={start:E.now(),duration:s,easing:u},u}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class ad{constructor(s,u){this._clickZoom=s,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Dp{constructor(s){this._tr=new gr(s),this.reset()}reset(){this._active=!1}dblclick(s,u){return s.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(u)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class D_{constructor(){this._tap=new Qh({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,u,p){if(!this._swipePoint)if(this._tapTime){const m=u[0],y=s.timeStamp-this._tapTime<500,A=this._tapPoint.dist(m)<30;y&&A?p.length>0&&(this._swipePoint=m,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(s,u,p)}touchmove(s,u,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const m=u[0],y=m.y-this._swipePoint.y;return this._swipePoint=m,s.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(s,u,p)}touchend(s,u,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const m=this._tap.touchend(s,u,p);m&&(this._tapTime=s.timeStamp,this._tapPoint=m)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class is{constructor(s,u,p){this._el=s,this._mousePan=u,this._touchPan=p}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Ol{constructor(s,u,p){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=u,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Qt{constructor(s,u,p,m){this._el=s,this._touchZoom=u,this._touchRotate=p,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class cn{constructor(s,u){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=u,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=M.create("div","maplibregl-cooperative-gesture-screen",s);let u=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(u=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),m=document.createElement("div");m.className="maplibregl-desktop-message",m.textContent=u,this._container.appendChild(m);const y=document.createElement("div");y.className="maplibregl-mobile-message",y.textContent=p,this._container.appendChild(y),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(M.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const za=_=>_.zoom||_.drag||_.pitch||_.rotate;class od extends c.k{}function Bl(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class _r{constructor(s,u){this.handleWindowEvent=m=>{this.handleEvent(m,`${m.type}Window`)},this.handleEvent=(m,y)=>{if(m.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=m.type==="renderFrame"?void 0:m,C={needsRenderFrame:!1},I={},N={},W=m.touches,X=W?this._getMapTouches(W):void 0,ne=X?M.touchPos(this._map.getCanvas(),X):M.mousePos(this._map.getCanvas(),m);for(const{handlerName:_e,handler:le,allowed:Ae}of this._handlers){if(!le.isEnabled())continue;let Oe;this._blockedByActive(N,Ae,_e)?le.reset():le[y||m.type]&&(Oe=le[y||m.type](m,ne,X),this.mergeHandlerResult(C,I,Oe,_e,A),Oe&&Oe.needsRenderFrame&&this._triggerRenderFrame()),(Oe||le.isActive())&&(N[_e]=le)}const pe={};for(const _e in this._previousActiveHandlers)N[_e]||(pe[_e]=A);this._previousActiveHandlers=N,(Object.keys(pe).length||Bl(C))&&(this._changes.push([C,I,pe]),this._triggerRenderFrame()),(Object.keys(N).length||Bl(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:de}=C;de&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],de(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cp(s),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,y,A]of this._listeners)M.addEventListener(m,y,m===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[s,u,p]of this._listeners)M.removeEventListener(s,u,s===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(s){const u=this._map,p=u.getCanvasContainer();this._add("mapEvent",new Ms(u,s));const m=u.boxZoom=new Ro(u,s);this._add("boxZoom",m),s.interactive&&s.boxZoom&&m.enable();const y=u.cooperativeGestures=new cn(u,s.cooperativeGestures);this._add("cooperativeGestures",y),s.cooperativeGestures&&y.enable();const A=new Rp(u),C=new Dp(u);u.doubleClickZoom=new ad(C,A),this._add("tapZoom",A),this._add("clickZoom",C),s.interactive&&s.doubleClickZoom&&u.doubleClickZoom.enable();const I=new D_;this._add("tapDragZoom",I);const N=u.touchPitch=new Lp(u);this._add("touchPitch",N),s.interactive&&s.touchPitch&&u.touchPitch.enable(s.touchPitch);const W=Io(s),X=td(s);u.dragRotate=new Ol(s,W,X),this._add("mouseRotate",W,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]),s.interactive&&s.dragRotate&&u.dragRotate.enable();const ne=(({enable:Oe,clickTolerance:ve})=>{const Ie=new Vt({checkCorrectEvent:He=>M.mouseButton(He)===0&&!He.ctrlKey});return new Gs({clickTolerance:ve,move:(He,We)=>({around:We,panDelta:We.sub(He)}),activateOnStart:!0,moveStateManager:Ie,enable:Oe,assignEvents:La})})(s),pe=new zt(s,u);u.dragPan=new is(p,ne,pe),this._add("mousePan",ne),this._add("touchPan",pe,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&u.dragPan.enable(s.dragPan);const de=new id,_e=new $c;u.touchZoomRotate=new Qt(p,_e,de,I),this._add("touchRotate",de,["touchPan","touchZoom"]),this._add("touchZoom",_e,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&u.touchZoomRotate.enable(s.touchZoomRotate);const le=u.scrollZoom=new sd(u,()=>this._triggerRenderFrame());this._add("scrollZoom",le,["mousePan"]),s.interactive&&s.scrollZoom&&u.scrollZoom.enable(s.scrollZoom);const Ae=u.keyboard=new ti(u);this._add("keyboard",Ae),s.interactive&&s.keyboard&&u.keyboard.enable(),this._add("blockableMapEvent",new Pp(u))}_add(s,u,p){this._handlers.push({handlerName:s,handler:u,allowed:p}),this._handlersById[s]=u}stop(s){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!za(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,u,p){for(const m in s)if(m!==p&&(!u||u.indexOf(m)<0))return!0;return!1}_getMapTouches(s){const u=[];for(const p of s)this._el.contains(p.target)&&u.push(p);return u}mergeHandlerResult(s,u,p,m,y){if(!p)return;c.e(s,p);const A={handlerName:m,originalEvent:p.originalEvent||y};p.zoomDelta!==void 0&&(u.zoom=A),p.panDelta!==void 0&&(u.drag=A),p.pitchDelta!==void 0&&(u.pitch=A),p.bearingDelta!==void 0&&(u.rotate=A)}_applyChanges(){const s={},u={},p={};for(const[m,y,A]of this._changes)m.panDelta&&(s.panDelta=(s.panDelta||new c.P(0,0))._add(m.panDelta)),m.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(s.around=m.around),m.pinchAround!==void 0&&(s.pinchAround=m.pinchAround),m.noInertia&&(s.noInertia=m.noInertia),c.e(u,y),c.e(p,A);this._updateMapTransform(s,u,p),this._changes=[]}_updateMapTransform(s,u,p){const m=this._map,y=m._getTransformForUpdate(),A=m.terrain;if(!(Bl(s)||A&&this._terrainMovement))return this._fireEvents(u,p,!0);let{panDelta:C,zoomDelta:I,bearingDelta:N,pitchDelta:W,around:X,pinchAround:ne}=s;ne!==void 0&&(X=ne),m._stop(!0),X=X||m.transform.centerPoint;const pe=y.pointLocation(C?X.sub(C):X);N&&(y.bearing+=N),W&&(y.pitch+=W),I&&(y.zoom+=I),A?this._terrainMovement||!u.drag&&!u.zoom?u.drag&&this._terrainMovement?y.center=y.pointLocation(y.centerPoint.sub(C)):y.setLocationAtPoint(pe,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,y.setLocationAtPoint(pe,X),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,y.recalculateZoom(m.terrain)})):y.setLocationAtPoint(pe,X),m._applyUpdatedTransform(y),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(u,p,!0)}_fireEvents(s,u,p){const m=za(this._eventsInProgress),y=za(s),A={};for(const W in s){const{originalEvent:X}=s[W];this._eventsInProgress[W]||(A[`${W}start`]=X),this._eventsInProgress[W]=s[W]}!m&&y&&this._fireEvent("movestart",y.originalEvent);for(const W in A)this._fireEvent(W,A[W]);y&&this._fireEvent("move",y.originalEvent);for(const W in s){const{originalEvent:X}=s[W];this._fireEvent(W,X)}const C={};let I;for(const W in this._eventsInProgress){const{handlerName:X,originalEvent:ne}=this._eventsInProgress[W];this._handlersById[X].isActive()||(delete this._eventsInProgress[W],I=u[X]||ne,C[`${W}end`]=I)}for(const W in C)this._fireEvent(W,C[W]);const N=za(this._eventsInProgress);if(p&&(m||y)&&!N){this._updatingCamera=!0;const W=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=ne=>ne!==0&&-this._bearingSnap<ne&&ne<this._bearingSnap;!W||!W.essential&&E.prefersReducedMotion?(this._map.fire(new c.k("moveend",{originalEvent:I})),X(this._map.getBearing())&&this._map.resetNorth()):(X(W.bearing||this._map.getBearing())&&(W.bearing=0),W.freezeElevation=!0,this._map.easeTo(W,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(s,u){this._map.fire(new c.k(s,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new od("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class zp extends c.E{constructor(s,u){super(),this._renderFrameCallback=()=>{const p=Math.min((E.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=u.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new c.M(this.transform.center.lng,this.transform.center.lat)}setCenter(s,u){return this.jumpTo({center:s},u)}panBy(s,u,p){return s=c.P.convert(s).mult(-1),this.panTo(this.transform.center,c.e({offset:s},u),p)}panTo(s,u,p){return this.easeTo(c.e({center:s},u),p)}getZoom(){return this.transform.zoom}setZoom(s,u){return this.jumpTo({zoom:s},u),this}zoomTo(s,u,p){return this.easeTo(c.e({zoom:s},u),p)}zoomIn(s,u){return this.zoomTo(this.getZoom()+1,s,u),this}zoomOut(s,u){return this.zoomTo(this.getZoom()-1,s,u),this}getBearing(){return this.transform.bearing}setBearing(s,u){return this.jumpTo({bearing:s},u),this}getPadding(){return this.transform.padding}setPadding(s,u){return this.jumpTo({padding:s},u),this}rotateTo(s,u,p){return this.easeTo(c.e({bearing:s},u),p)}resetNorth(s,u){return this.rotateTo(0,c.e({duration:1e3},s),u),this}resetNorthPitch(s,u){return this.easeTo(c.e({bearing:0,pitch:0,duration:1e3},s),u),this}snapToNorth(s,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,u):this}getPitch(){return this.transform.pitch}setPitch(s,u){return this.jumpTo({pitch:s},u),this}cameraForBounds(s,u){s=Wt.convert(s);const p=u&&u.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),p,u)}_cameraForBoxAndBearing(s,u,p,m){const y={top:0,bottom:0,right:0,left:0};if(typeof(m=c.e({padding:y,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Ut=m.padding;m.padding={top:Ut,bottom:Ut,right:Ut,left:Ut}}m.padding=c.e(y,m.padding);const A=this.transform,C=A.padding,I=new Wt(s,u),N=A.project(I.getNorthWest()),W=A.project(I.getNorthEast()),X=A.project(I.getSouthEast()),ne=A.project(I.getSouthWest()),pe=c.b8(-p),de=N.rotate(pe),_e=W.rotate(pe),le=X.rotate(pe),Ae=ne.rotate(pe),Oe=new c.P(Math.max(de.x,_e.x,Ae.x,le.x),Math.max(de.y,_e.y,Ae.y,le.y)),ve=new c.P(Math.min(de.x,_e.x,Ae.x,le.x),Math.min(de.y,_e.y,Ae.y,le.y)),Ie=Oe.sub(ve),He=(A.width-(C.left+C.right+m.padding.left+m.padding.right))/Ie.x,We=(A.height-(C.top+C.bottom+m.padding.top+m.padding.bottom))/Ie.y;if(We<0||He<0)return void c.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const Qe=Math.min(A.scaleZoom(A.scale*Math.min(He,We)),m.maxZoom),dt=c.P.convert(m.offset),lt=new c.P((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(c.b8(p)),ht=dt.add(lt).mult(A.scale/A.zoomScale(Qe));return{center:A.unproject(N.add(X).div(2).sub(ht)),zoom:Qe,bearing:p}}fitBounds(s,u,p){return this._fitInternal(this.cameraForBounds(s,u),u,p)}fitScreenCoordinates(s,u,p,m,y){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(c.P.convert(s)),this.transform.pointLocation(c.P.convert(u)),p,m),m,y)}_fitInternal(s,u,p){return s?(delete(u=c.e(s,u)).padding,u.linear?this.easeTo(u,p):this.flyTo(u,p)):this}jumpTo(s,u){this.stop();const p=this._getTransformForUpdate();let m=!1,y=!1,A=!1;return"zoom"in s&&p.zoom!==+s.zoom&&(m=!0,p.zoom=+s.zoom),s.center!==void 0&&(p.center=c.M.convert(s.center)),"bearing"in s&&p.bearing!==+s.bearing&&(y=!0,p.bearing=+s.bearing),"pitch"in s&&p.pitch!==+s.pitch&&(A=!0,p.pitch=+s.pitch),s.padding==null||p.isPaddingEqual(s.padding)||(p.padding=s.padding),this._applyUpdatedTransform(p),this.fire(new c.k("movestart",u)).fire(new c.k("move",u)),m&&this.fire(new c.k("zoomstart",u)).fire(new c.k("zoom",u)).fire(new c.k("zoomend",u)),y&&this.fire(new c.k("rotatestart",u)).fire(new c.k("rotate",u)).fire(new c.k("rotateend",u)),A&&this.fire(new c.k("pitchstart",u)).fire(new c.k("pitch",u)).fire(new c.k("pitchend",u)),this.fire(new c.k("moveend",u))}calculateCameraOptionsFromTo(s,u,p,m=0){const y=c.Y.fromLngLat(s,u),A=c.Y.fromLngLat(p,m),C=A.x-y.x,I=A.y-y.y,N=A.z-y.z,W=Math.hypot(C,I,N);if(W===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(C,I),ne=this.transform.scaleZoom(this.transform.cameraToCenterDistance/W/this.transform.tileSize),pe=180*Math.atan2(C,-I)/Math.PI;let de=180*Math.acos(X/W)/Math.PI;return de=N<0?90-de:90+de,{center:A.toLngLat(),zoom:ne,pitch:de,bearing:pe}}easeTo(s,u){var p;this._stop(!1,s.easeId),((s=c.e({offset:[0,0],duration:500,easing:c.b7},s)).animate===!1||!s.essential&&E.prefersReducedMotion)&&(s.duration=0);const m=this._getTransformForUpdate(),y=this.getZoom(),A=this.getBearing(),C=this.getPitch(),I=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,A):A,W="pitch"in s?+s.pitch:C,X="padding"in s?s.padding:m.padding,ne=c.P.convert(s.offset);let pe=m.centerPoint.add(ne);const de=m.pointLocation(pe),{center:_e,zoom:le}=m.getConstrained(c.M.convert(s.center||de),(p=s.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(_e);const Ae=m.project(de),Oe=m.project(_e).sub(Ae),ve=m.zoomScale(le-y);let Ie,He;s.around&&(Ie=c.M.convert(s.around),He=m.locationPoint(Ie));const We={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||le!==y,this._rotating=this._rotating||A!==N,this._pitching=this._pitching||W!==C,this._padding=!m.isPaddingEqual(X),this._easeId=s.easeId,this._prepareEase(u,s.noMoveStart,We),this.terrain&&this._prepareElevation(_e),this._ease(Qe=>{if(this._zooming&&(m.zoom=c.z.number(y,le,Qe)),this._rotating&&(m.bearing=c.z.number(A,N,Qe)),this._pitching&&(m.pitch=c.z.number(C,W,Qe)),this._padding&&(m.interpolatePadding(I,X,Qe),pe=m.centerPoint.add(ne)),this.terrain&&!s.freezeElevation&&this._updateElevation(Qe),Ie)m.setLocationAtPoint(Ie,He);else{const dt=m.zoomScale(m.zoom-y),lt=le>y?Math.min(2,ve):Math.max(.5,ve),ht=Math.pow(lt,1-Qe),Ut=m.unproject(Ae.add(Oe.mult(Qe*ht)).mult(dt));m.setLocationAtPoint(m.renderWorldCopies?Ut.wrap():Ut,pe)}this._applyUpdatedTransform(m),this._fireMoveEvents(u)},Qe=>{this.terrain&&this._finalizeElevation(),this._afterEase(u,Qe)},s),this}_prepareEase(s,u,p={}){this._moving=!0,u||p.moving||this.fire(new c.k("movestart",s)),this._zooming&&!p.zooming&&this.fire(new c.k("zoomstart",s)),this._rotating&&!p.rotating&&this.fire(new c.k("rotatestart",s)),this._pitching&&!p.pitching&&this.fire(new c.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const u=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&u!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(p-(u-(p*s+this._elevationStart))/(1-s)),this._elevationTarget=u}this.transform.elevation=c.z.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const u=s.clone(),{center:p,zoom:m,pitch:y,bearing:A,elevation:C}=this.transformCameraUpdate(u);p&&(u.center=p),m!==void 0&&(u.zoom=m),y!==void 0&&(u.pitch=y),A!==void 0&&(u.bearing=A),C!==void 0&&(u.elevation=C),this.transform.apply(u)}_fireMoveEvents(s){this.fire(new c.k("move",s)),this._zooming&&this.fire(new c.k("zoom",s)),this._rotating&&this.fire(new c.k("rotate",s)),this._pitching&&this.fire(new c.k("pitch",s))}_afterEase(s,u){if(this._easeId&&u&&this._easeId===u)return;delete this._easeId;const p=this._zooming,m=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.k("zoomend",s)),m&&this.fire(new c.k("rotateend",s)),y&&this.fire(new c.k("pitchend",s)),this.fire(new c.k("moveend",s))}flyTo(s,u){var p;if(!s.essential&&E.prefersReducedMotion){const Rn=c.L(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rn,u)}this.stop(),s=c.e({offset:[0,0],speed:1.2,curve:1.42,easing:c.b7},s);const m=this._getTransformForUpdate(),y=this.getZoom(),A=this.getBearing(),C=this.getPitch(),I=this.getPadding(),N="bearing"in s?this._normalizeBearing(s.bearing,A):A,W="pitch"in s?+s.pitch:C,X="padding"in s?s.padding:m.padding,ne=c.P.convert(s.offset);let pe=m.centerPoint.add(ne);const de=m.pointLocation(pe),{center:_e,zoom:le}=m.getConstrained(c.M.convert(s.center||de),(p=s.zoom)!==null&&p!==void 0?p:y);this._normalizeCenter(_e);const Ae=m.zoomScale(le-y),Oe=m.project(de),ve=m.project(_e).sub(Oe);let Ie=s.curve;const He=Math.max(m.width,m.height),We=He/Ae,Qe=ve.mag();if("minZoom"in s){const Rn=c.ac(Math.min(s.minZoom,y,le),m.minZoom,m.maxZoom),pn=He/m.zoomScale(Rn-y);Ie=Math.sqrt(pn/Qe*2)}const dt=Ie*Ie;function lt(Rn){const pn=(We*We-He*He+(Rn?-1:1)*dt*dt*Qe*Qe)/(2*(Rn?We:He)*dt*Qe);return Math.log(Math.sqrt(pn*pn+1)-pn)}function ht(Rn){return(Math.exp(Rn)-Math.exp(-Rn))/2}function Ut(Rn){return(Math.exp(Rn)+Math.exp(-Rn))/2}const gn=lt(!1);let Et=function(Rn){return Ut(gn)/Ut(gn+Ie*Rn)},hn=function(Rn){return He*((Ut(gn)*(ht(pn=gn+Ie*Rn)/Ut(pn))-ht(gn))/dt)/Qe;var pn},xn=(lt(!0)-gn)/Ie;if(Math.abs(Qe)<1e-6||!isFinite(xn)){if(Math.abs(He-We)<1e-6)return this.easeTo(s,u);const Rn=We<He?-1:1;xn=Math.abs(Math.log(We/He))/Ie,hn=function(){return 0},Et=function(pn){return Math.exp(Rn*Ie*pn)}}return s.duration="duration"in s?+s.duration:1e3*xn/("screenSpeed"in s?+s.screenSpeed/Ie:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=A!==N,this._pitching=W!==C,this._padding=!m.isPaddingEqual(X),this._prepareEase(u,!1),this.terrain&&this._prepareElevation(_e),this._ease(Rn=>{const pn=Rn*xn,Sn=1/Et(pn);m.zoom=Rn===1?le:y+m.scaleZoom(Sn),this._rotating&&(m.bearing=c.z.number(A,N,Rn)),this._pitching&&(m.pitch=c.z.number(C,W,Rn)),this._padding&&(m.interpolatePadding(I,X,Rn),pe=m.centerPoint.add(ne)),this.terrain&&!s.freezeElevation&&this._updateElevation(Rn);const Mn=Rn===1?_e:m.unproject(Oe.add(ve.mult(hn(pn))).mult(Sn));m.setLocationAtPoint(m.renderWorldCopies?Mn.wrap():Mn,pe),this._applyUpdatedTransform(m),this._fireMoveEvents(u)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(u)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,u)}if(!s){const p=this.handlers;p&&p.stop(!1)}return this}_ease(s,u,p){p.animate===!1||p.duration===0?(s(1),u()):(this._easeStart=E.now(),this._easeOptions=p,this._onEaseFrame=s,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,u){s=c.b1(s,-180,180);const p=Math.abs(s-u);return Math.abs(s-360-u)<p&&(s-=360),Math.abs(s+360-u)<p&&(s+=360),s}_normalizeCenter(s){const u=this.transform;if(!u.renderWorldCopies||u.lngRange)return;const p=s.lng-u.center.lng;s.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(c.M.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const rs={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class kp{constructor(s=rs){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=u=>{!u||u.sourceDataType!=="metadata"&&u.sourceDataType!=="visibility"&&u.dataType!=="style"&&u.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,u){const p=this._map._getUIString(`AttributionControl.${u}`);s.title=p,s.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const u=this._map.style.sourceCaches;for(const m in u){const y=u[m];if(y.used||y.usedForTerrain){const A=y.getSource();A.attribution&&s.indexOf(A.attribution)<0&&s.push(A.attribution)}}s=s.filter(m=>String(m).trim()),s.sort((m,y)=>m.length-y.length),s=s.filter((m,y)=>{for(let A=y+1;A<s.length;A++)if(s[A].indexOf(m)>=0)return!1;return!0});const p=s.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,s.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Lo{constructor(s={}){this._updateCompact=()=>{const u=this._container.children;if(u.length){const p=u[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const u=M.create("a","maplibregl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://maplibre.org/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class fi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const u=++this._id;return this._queue.push({callback:s,id:u,cancelled:!1}),u}remove(s){const u=this._currentlyRunning,p=u?this._queue.concat(u):this._queue;for(const m of p)if(m.id===s)return void(m.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const u=this._currentlyRunning=this._queue;this._queue=[];for(const p of u)if(!p.cancelled&&(p.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var wi=c.X([{name:"a_pos3d",type:"Int16",components:3}]);class Fp extends c.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,u){this.sourceCache.update(s,u),this._renderableTilesKeys=[];const p={};for(const m of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:u}))p[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),c.aN(m.posMatrix,0,c.W,0,c.W,0,1),this._tiles[m.key]=new Nt(m,this.tileSize));for(const m in this._tiles)p[m]||delete this._tiles[m]}freeRtt(s){for(const u in this._tiles){const p=this._tiles[u];(!s||p.tileID.equals(s)||p.tileID.isChildOf(s)||s.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const u={};for(const p of this._renderableTilesKeys){const m=this._tiles[p].tileID;if(m.canonical.equals(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16),c.aN(y.posMatrix,0,c.W,0,c.W,0,1),u[p]=y}else if(m.canonical.isChildOf(s.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const A=m.canonical.z-s.canonical.z,C=m.canonical.x-(m.canonical.x>>A<<A),I=m.canonical.y-(m.canonical.y>>A<<A),N=c.W>>A;c.aN(y.posMatrix,0,N,0,N,0,1),c.H(y.posMatrix,y.posMatrix,[-C*N,-I*N,0]),u[p]=y}else if(s.canonical.isChildOf(m.canonical)){const y=s.clone();y.posMatrix=new Float64Array(16);const A=s.canonical.z-m.canonical.z,C=s.canonical.x-(s.canonical.x>>A<<A),I=s.canonical.y-(s.canonical.y>>A<<A),N=c.W>>A;c.aN(y.posMatrix,0,c.W,0,c.W,0,1),c.H(y.posMatrix,y.posMatrix,[C*N,I*N,0]),c.J(y.posMatrix,y.posMatrix,[1/2**A,1/2**A,0]),u[p]=y}}return u}getSourceTile(s,u){const p=this.sourceCache._source;let m=s.overscaledZ-this.deltaZoom;if(m>p.maxzoom&&(m=p.maxzoom),m<p.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(m).key);let y=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!y||!y.dem)&&u)for(;m>=p.minzoom&&(!y||!y.dem);)y=this.sourceCache.getTileByID(s.scaledTo(m--).key);return y}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(u=>u.timeAdded>=s)}}class Vl{constructor(s,u,p){this.painter=s,this.sourceCache=new Fp(u),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,u,p,m=c.W){var y;if(!(u>=0&&u<m&&p>=0&&p<m))return 0;const A=this.getTerrainData(s),C=(y=A.tile)===null||y===void 0?void 0:y.dem;if(!C)return 0;const I=function(de,_e,le){var Ae=_e[0],Oe=_e[1];return de[0]=le[0]*Ae+le[4]*Oe+le[12],de[1]=le[1]*Ae+le[5]*Oe+le[13],de}([],[u/m*c.W,p/m*c.W],A.u_terrain_matrix),N=[I[0]*C.dim,I[1]*C.dim],W=Math.floor(N[0]),X=Math.floor(N[1]),ne=N[0]-W,pe=N[1]-X;return C.get(W,X)*(1-ne)*(1-pe)+C.get(W+1,X)*ne*(1-pe)+C.get(W,X+1)*(1-ne)*pe+C.get(W+1,X+1)*ne*pe}getElevationForLngLatZoom(s,u){const{tileID:p,mercatorX:m,mercatorY:y}=this._getOverscaledTileIDFromLngLatZoom(s,u);return this.getElevation(p,m%c.W,y%c.W,c.W)}getElevation(s,u,p,m=c.W){return this.getDEMElevation(s,u,p,m)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const m=this.painter.context,y=new c.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ke(m,y,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ke(m,new c.R({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=c.an([])}const u=this.sourceCache.getSourceTile(s,!0);if(u&&u.dem&&(!u.demTexture||u.needsTerrainPrepare)){const m=this.painter.context;u.demTexture=this.painter.getTileTexture(u.dem.stride),u.demTexture?u.demTexture.update(u.dem.getPixels(),{premultiply:!1}):u.demTexture=new ke(m,u.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),u.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),u.needsTerrainPrepare=!1}const p=u&&u+u.tileID.key+s.key;if(p&&!this._demMatrixCache[p]){const m=this.sourceCache.sourceCache._source.maxzoom;let y=s.canonical.z-u.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=m?y=s.canonical.z-m:c.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=s.canonical.x-(s.canonical.x>>y<<y),C=s.canonical.y-(s.canonical.y>>y<<y),I=c.b9(new Float64Array(16),[1/(c.W<<y),1/(c.W<<y),0]);c.H(I,I,[A*c.W,C*c.W,0]),this._demMatrixCache[s.key]={matrix:I,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:u&&u.dem&&u.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:u&&u.dem&&u.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(u&&u.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:u}}getFramebuffer(s){const u=this.painter,p=u.width/devicePixelRatio,m=u.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ke(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ke(u.context,{width:p,height:m,data:null},u.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(u.context.gl.NEAREST,u.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=u.context.createFramebuffer(p,m,!0,!1),this._fbo.depthAttachment.set(u.context.createRenderbuffer(u.context.gl.DEPTH_COMPONENT16,p,m))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const u=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let y=0,A=0;y<this._coordsTextureSize;y++)for(let C=0;C<this._coordsTextureSize;C++,A+=4)u[A+0]=255&C,u[A+1]=255&y,u[A+2]=C>>8<<4|y>>8,u[A+3]=0;const p=new c.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(u.buffer)),m=new ke(s,p,s.gl.RGBA,{premultiply:!1});return m.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const u=new Uint8Array(4),p=this.painter.context,m=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null);const y=u[0]+(u[2]>>4<<8),A=u[1]+((15&u[2])<<8),C=this.coordsIndex[255-u[3]],I=C&&this.sourceCache.getTileByID(C);if(!I)return null;const N=this._coordsTextureSize,W=(1<<I.tileID.canonical.z)*N;return new c.Y((I.tileID.canonical.x*N+y)/W+I.tileID.wrap,(I.tileID.canonical.y*N+A)/W,this.getElevation(I.tileID,y,A,N))}depthAtPoint(s){const u=new Uint8Array(4),p=this.painter.context,m=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),m.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,u),p.bindFramebuffer.set(null),(u[0]/16777216+u[1]/65536+u[2]/256+u[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,u=new c.ba,p=new c.aX,m=this.meshSize,y=c.W/m,A=m*m;for(let X=0;X<=m;X++)for(let ne=0;ne<=m;ne++)u.emplaceBack(ne*y,X*y,0);for(let X=0;X<A;X+=m+1)for(let ne=0;ne<m;ne++)p.emplaceBack(ne+X,m+ne+X+1,m+ne+X+2),p.emplaceBack(ne+X,m+ne+X+2,ne+X+1);const C=u.length,I=C+2*(m+1);for(const X of[0,1])for(let ne=0;ne<=m;ne++)for(const pe of[0,1])u.emplaceBack(ne*y,X*c.W,pe);for(let X=0;X<2*m;X+=2)p.emplaceBack(I+X,I+X+1,I+X+3),p.emplaceBack(I+X,I+X+3,I+X+2),p.emplaceBack(C+X,C+X+3,C+X+1),p.emplaceBack(C+X,C+X+2,C+X+3);const N=u.length,W=N+2*(m+1);for(const X of[0,1])for(let ne=0;ne<=m;ne++)for(const pe of[0,1])u.emplaceBack(X*c.W,ne*y,pe);for(let X=0;X<2*m;X+=2)p.emplaceBack(N+X,N+X+1,N+X+3),p.emplaceBack(N+X,N+X+3,N+X+2),p.emplaceBack(W+X,W+X+3,W+X+1),p.emplaceBack(W+X,W+X+2,W+X+3);return this._mesh={indexBuffer:s.createIndexBuffer(p),vertexBuffer:s.createVertexBuffer(u,wi.members),segments:c.$.simpleSegment(0,0,u.length,p.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*c.bb/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,u){var p;const{tileID:m}=this._getOverscaledTileIDFromLngLatZoom(s,u);return(p=this.getMinMaxElevation(m).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(s){const u=this.getTerrainData(s).tile,p={minElevation:null,maxElevation:null};return u&&u.dem&&(p.minElevation=u.dem.min*this.exaggeration,p.maxElevation=u.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(s,u){const p=c.Y.fromLngLat(s.wrap()),m=(1<<u)*c.W,y=p.x*m,A=p.y*m,C=Math.floor(y/c.W),I=Math.floor(A/c.W);return{tileID:new c.Q(u,0,u,C,I),mercatorX:y,mercatorY:A}}}class Zc{constructor(s,u,p){this._context=s,this._size=u,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const u=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new ke(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),u.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),u.colorAttachment.set(p.texture),{id:s,fbo:u,texture:p,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(u=>s.id!==u),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const u of this._recentlyUsed)if(!this._objects[u].inUse)return this._objects[u];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const da={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ld{constructor(s,u){this.painter=s,this.terrain=u,this.pool=new Zc(s.context,30,u.sourceCache.tileSize*u.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,u){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(p=>!s._layers[p].isHidden(u)),this._coordsDescendingInv={};for(const p in s.sourceCaches){this._coordsDescendingInv[p]={};const m=s.sourceCaches[p].getVisibleCoordinates();for(const y of m){const A=this.terrain.sourceCache.getTerrainCoords(y);for(const C in A)this._coordsDescendingInv[p][C]||(this._coordsDescendingInv[p][C]=[]),this._coordsDescendingInv[p][C].push(A[C])}}this._coordsDescendingInvStr={};for(const p of s._order){const m=s._layers[p],y=m.source;if(da[m.type]&&!this._coordsDescendingInvStr[y]){this._coordsDescendingInvStr[y]={};for(const A in this._coordsDescendingInv[y])this._coordsDescendingInvStr[y][A]=this._coordsDescendingInv[y][A].map(C=>C.key).sort().join()}}for(const p of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const y=this._coordsDescendingInvStr[m][p.tileID.key];y&&y!==p.rttCoords[m]&&(p.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const u=s.type,p=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(da[u]&&(this._prevType&&da[this._prevType]||this._stacks.push([]),this._prevType=u,this._stacks[this._stacks.length-1].push(s.id),!m))return!0;if(da[this._prevType]||da[u]&&m){this._prevType=u;const y=this._stacks.length-1,A=this._stacks[y]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(qh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[y]){const N=this.pool.getObjectForId(C.rtt[y].id);if(N.stamp===C.rtt[y].stamp){this.pool.useObject(N);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),C.rtt[y]={id:I.id,stamp:I.stamp},p.context.bindFramebuffer.set(I.fbo.framebuffer),p.context.clear({color:c.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let N=0;N<A.length;N++){const W=p.style._layers[A[N]],X=W.source?this._coordsDescendingInv[W.source][C.tileID.key]:[C.tileID];p.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),p._renderTileClippingMasks(W,X),p.renderLayer(p,p.style.sourceCaches[W.source],W,X),W.source&&(C.rttCoords[W.source]=this._coordsDescendingInvStr[W.source][C.tileID.key])}}return qh(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),da[u]}return!1}}const cd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Gl=v,ud={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:rs,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:c.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},Yc=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},hd={showCompass:!0,showZoom:!0,visualizePitch:!1};class dd{constructor(s,u,p=!1){this.mousedown=A=>{this.startMouse(c.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),M.mousePos(this.element,A)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,M.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const m=s.dragRotate._mouseRotate.getClickTolerance(),y=s.dragRotate._mousePitch.getClickTolerance();this.element=u,this.mouseRotate=Io({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:C,bearingDegreesPerPixelMoved:I=.8})=>{const N=new ed;return new Gs({clickTolerance:C,move:(W,X)=>({bearingDelta:(X.x-W.x)*I}),moveStateManager:N,enable:A,assignEvents:Yc})})({clickTolerance:m,enable:!0}),this.map=s,p&&(this.mousePitch=td({clickTolerance:y,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:C,pitchDegreesPerPixelMoved:I=-.5})=>{const N=new ed;return new Gs({clickTolerance:C,move:(W,X)=>({pitchDelta:(X.y-W.y)*I}),moveStateManager:N,enable:A,assignEvents:Yc})})({clickTolerance:y,enable:!0})),M.addEventListener(u,"mousedown",this.mousedown),M.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(u,"touchcancel",this.reset)}startMouse(s,u){this.mouseRotate.dragStart(s,u),this.mousePitch&&this.mousePitch.dragStart(s,u),M.disableDrag()}startTouch(s,u){this.touchRotate.dragStart(s,u),this.touchPitch&&this.touchPitch.dragStart(s,u),M.disableDrag()}moveMouse(s,u){const p=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(s,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.mousePitch){const{pitchDelta:y}=this.mousePitch.dragMove(s,u)||{};y&&p.setPitch(p.getPitch()+y)}}moveTouch(s,u){const p=this.map,{bearingDelta:m}=this.touchRotate.dragMove(s,u)||{};if(m&&p.setBearing(p.getBearing()+m),this.touchPitch){const{pitchDelta:y}=this.touchPitch.dragMove(s,u)||{};y&&p.setPitch(p.getPitch()+y)}}off(){const s=this.element;M.removeEventListener(s,"mousedown",this.mousedown),M.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let Hs;function Kc(_,s,u){const p=new c.M(_.lng,_.lat);if(_=new c.M(_.lng,_.lat),s){const m=new c.M(_.lng-360,_.lat),y=new c.M(_.lng+360,_.lat),A=u.locationPoint(_).distSqr(s);u.locationPoint(m).distSqr(s)<A?_=m:u.locationPoint(y).distSqr(s)<A&&(_=y)}for(;Math.abs(_.lng-u.center.lng)>180;){const m=u.locationPoint(_);if(m.x>=0&&m.y>=0&&m.x<=u.width&&m.y<=u.height)break;_.lng>u.center.lng?_.lng-=360:_.lng+=360}return _.lng!==p.lng&&u.locationPoint(_).y>u.height/2-u.getHorizon()?_:p}const Hl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Jc(_,s,u){const p=_.classList;for(const m in Hl)p.remove(`maplibregl-${u}-anchor-${m}`);p.add(`maplibregl-${u}-anchor-${s}`)}class Do extends c.E{constructor(s){if(super(),this._onKeyPress=u=>{const p=u.code,m=u.charCode||u.keyCode;p!=="Space"&&p!=="Enter"&&m!==32&&m!==13||this.togglePopup()},this._onMapClick=u=>{const p=u.originalEvent.target,m=this._element;this._popup&&(p===m||m.contains(p))&&this.togglePopup()},this._update=u=>{var p;if(!this._map)return;const m=this._map.loaded()&&!this._map.isMoving();((u==null?void 0:u.type)==="terrain"||(u==null?void 0:u.type)==="render"&&!m)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Kc(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let y="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?y=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(y=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),u&&u.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${Hl[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${y}`),E.frameAsync(new AbortController).then(()=>{this._updateOpacity(u&&u.type==="moveend")}).catch(()=>{})},this._onMove=u=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=u.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=u.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new c.k("dragstart"))),this.fire(new c.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new c.k("dragend")),this._state="inactive"},this._addDragHandler=u=>{this._element.contains(u.originalEvent.target)&&(u.preventDefault(),this._positionDelta=u.point.sub(this._pos).add(this._offset),this._pointerdownPos=u.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=c.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const u=M.createNS("http://www.w3.org/2000/svg","svg"),p=41,m=27;u.setAttributeNS(null,"display","block"),u.setAttributeNS(null,"height",`${p}px`),u.setAttributeNS(null,"width",`${m}px`),u.setAttributeNS(null,"viewBox",`0 0 ${m} ${p}`);const y=M.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"stroke","none"),y.setAttributeNS(null,"stroke-width","1"),y.setAttributeNS(null,"fill","none"),y.setAttributeNS(null,"fill-rule","evenodd");const A=M.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const C=M.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Ae of I){const Oe=M.createNS("http://www.w3.org/2000/svg","ellipse");Oe.setAttributeNS(null,"opacity","0.04"),Oe.setAttributeNS(null,"cx","10.5"),Oe.setAttributeNS(null,"cy","5.80029008"),Oe.setAttributeNS(null,"rx",Ae.rx),Oe.setAttributeNS(null,"ry",Ae.ry),C.appendChild(Oe)}const N=M.createNS("http://www.w3.org/2000/svg","g");N.setAttributeNS(null,"fill",this._color);const W=M.createNS("http://www.w3.org/2000/svg","path");W.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),N.appendChild(W);const X=M.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const ne=M.createNS("http://www.w3.org/2000/svg","path");ne.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(ne);const pe=M.createNS("http://www.w3.org/2000/svg","g");pe.setAttributeNS(null,"transform","translate(6.0, 7.0)"),pe.setAttributeNS(null,"fill","#FFFFFF");const de=M.createNS("http://www.w3.org/2000/svg","g");de.setAttributeNS(null,"transform","translate(8.0, 8.0)");const _e=M.createNS("http://www.w3.org/2000/svg","circle");_e.setAttributeNS(null,"fill","#000000"),_e.setAttributeNS(null,"opacity","0.25"),_e.setAttributeNS(null,"cx","5.5"),_e.setAttributeNS(null,"cy","5.5"),_e.setAttributeNS(null,"r","5.4999962");const le=M.createNS("http://www.w3.org/2000/svg","circle");le.setAttributeNS(null,"fill","#FFFFFF"),le.setAttributeNS(null,"cx","5.5"),le.setAttributeNS(null,"cy","5.5"),le.setAttributeNS(null,"r","5.4999962"),de.appendChild(_e),de.appendChild(le),A.appendChild(C),A.appendChild(N),A.appendChild(X),A.appendChild(pe),A.appendChild(de),u.appendChild(A),u.setAttributeNS(null,"height",p*this._scale+"px"),u.setAttributeNS(null,"width",m*this._scale+"px"),this._element.appendChild(u),this._offset=c.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()}),Jc(this._element,this._anchor,"marker"),s&&s.className)for(const u of s.className.split(" "))this._element.classList.add(u);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=c.M.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const m=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var u,p;if(!(!((u=this._map)===null||u===void 0)&&u.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const m=this._map,y=m.terrain.depthAtPoint(this._pos),A=m.terrain.getElevationForLngLatZoom(this._lngLat,m.transform.tileZoom);if(m.transform.lngLatToCameraDepth(this._lngLat,A)-y<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/m.transform._pixelPerMeter,I=Math.sin(m.getPitch()*Math.PI/180)*C,N=m.terrain.depthAtPoint(new c.P(this._pos.x,this._pos.y-this._offset.y)),W=m.transform.lngLatToCameraDepth(this._lngLat,A+I)-N>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&W&&this._popup.remove(),this._element.style.opacity=W?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=c.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,u){return s===void 0&&u===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),u!==void 0&&(this._opacityWhenCovered=u),this._map&&this._updateOpacity(!0),this}}const fd={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let zo=0,fa=!1;const pd={maxWidth:100,unit:"metric"};function Qc(_,s,u){const p=u&&u.maxWidth||100,m=_._container.clientHeight/2,y=_.unproject([0,m]),A=_.unproject([p,m]),C=y.distanceTo(A);if(u&&u.unit==="imperial"){const I=3.2808*C;I>5280?ka(s,p,I/5280,_._getUIString("ScaleControl.Miles")):ka(s,p,I,_._getUIString("ScaleControl.Feet"))}else u&&u.unit==="nautical"?ka(s,p,C/1852,_._getUIString("ScaleControl.NauticalMiles")):C>=1e3?ka(s,p,C/1e3,_._getUIString("ScaleControl.Kilometers")):ka(s,p,C,_._getUIString("ScaleControl.Meters"))}function ka(_,s,u,p){const m=function(y){const A=Math.pow(10,`${Math.floor(y)}`.length-1);let C=y/A;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const N=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*N)/N}(C),A*C}(u);_.style.width=s*(m/u)+"px",_.innerHTML=`${m}&nbsp;${p}`}const md={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},gd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function _d(_){if(_){if(typeof _=="number"){const s=Math.round(Math.abs(_)/Math.SQRT2);return{center:new c.P(0,0),top:new c.P(0,_),"top-left":new c.P(s,s),"top-right":new c.P(-s,s),bottom:new c.P(0,-_),"bottom-left":new c.P(s,-s),"bottom-right":new c.P(-s,-s),left:new c.P(_,0),right:new c.P(-_,0)}}if(_ instanceof c.P||Array.isArray(_)){const s=c.P.convert(_);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:c.P.convert(_.center||[0,0]),top:c.P.convert(_.top||[0,0]),"top-left":c.P.convert(_["top-left"]||[0,0]),"top-right":c.P.convert(_["top-right"]||[0,0]),bottom:c.P.convert(_.bottom||[0,0]),"bottom-left":c.P.convert(_["bottom-left"]||[0,0]),"bottom-right":c.P.convert(_["bottom-right"]||[0,0]),left:c.P.convert(_.left||[0,0]),right:c.P.convert(_.right||[0,0])}}return _d(new c.P(0,0))}const Up=v;f.AJAXError=c.be,f.Evented=c.E,f.LngLat=c.M,f.MercatorCoordinate=c.Y,f.Point=c.P,f.addProtocol=c.bf,f.config=c.a,f.removeProtocol=c.bg,f.AttributionControl=kp,f.BoxZoomHandler=Ro,f.CanvasSource=mt,f.CooperativeGesturesHandler=cn,f.DoubleClickZoomHandler=ad,f.DragPanHandler=is,f.DragRotateHandler=Ol,f.EdgeInsets=kl,f.FullscreenControl=class extends c.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var s;let u=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=u==null?void 0:u.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)u=u.shadowRoot.fullscreenElement;u===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:c.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new c.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new c.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},f.GeoJSONSource=Xe,f.GeolocateControl=class extends c.E{constructor(_){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new c.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new c.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const u=new c.M(s.coords.longitude,s.coords.latitude),p=s.coords.accuracy,m=this._map.getBearing(),y=c.e({bearing:m},this.options.fitBoundsOptions),A=Wt.fromLngLat(u,p);this._map.fitBounds(A,y,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const u=new c.M(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(u).addTo(this._map),this._userLocationDotMarker.setLngLat(u).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&fa)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new c.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",u=>u.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){c.w("Geolocation support is not available so the GeolocateControl will be disabled.");const u=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}else{const u=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=u,this._geolocateButton.setAttribute("aria-label",u)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Do({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Do({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",u=>{u.geolocateSource||this._watchState!=="ACTIVE_LOCK"||u.originalEvent&&u.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new c.k("trackuserlocationend")))})}},this.options=c.e({},fd,_)}onAdd(_){return this._map=_,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return c._(this,arguments,void 0,function*(s=!1){if(Hs!==void 0&&!s)return Hs;if(window.navigator.permissions===void 0)return Hs=!!window.navigator.geolocation,Hs;try{Hs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Hs=!!window.navigator.geolocation}return Hs})}().then(s=>this._setupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,zo=0,fa=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),u=_.coords;return s&&(u.longitude<s.getWest()||u.longitude>s.getEast()||u.latitude<s.getSouth()||u.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),s=_.getSouthEast(),u=_.getNorthEast(),p=s.distanceTo(u),m=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}trigger(){if(!this._setup)return c.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":zo--,fa=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new c.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),zo++,zo>1?(_={maximumAge:6e5,timeout:0},fa=!0):(_=this.options.positionOptions,fa=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},f.Hash=Kh,f.ImageSource=ft,f.KeyboardHandler=ti,f.LngLatBounds=Wt,f.LogoControl=Lo,f.Map=class extends zp{constructor(_){if(c.bc.mark(c.bd.create),(_=c.e({},ud,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new jc(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new c.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new c.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new fi,this._controls=[],this._mapId=c.a3(),this._locale=c.e({},cd,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new fe(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const u=Yh(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{s?u(p):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new _r(this,_),this._hash=_.hash&&new Kh(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,c.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new kp(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Lo,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new c.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new c.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new c.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new c.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=_.onAdd(this);this._controls.push(_);const p=this._controlPositions[s];return s.indexOf("bottom")!==-1?p.insertBefore(u,p.firstChild):p.appendChild(u),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new c.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,s,u,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(u,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,s,u,p)}resize(_){var s;const u=this._containerDimensions(),p=u[0],m=u[1],y=this._getClampedPixelRatio(p,m);if(this._resizeCanvas(p,m,y),this.painter.resize(p,m,y),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const I=this._getClampedPixelRatio(p,m);this._resizeCanvas(p,m,I),this.painter.resize(p,m,I)}this.transform.resize(p,m),(s=this._requestedCameraState)===null||s===void 0||s.resize(p,m);const A=!this._moving;return A&&(this.stop(),this.fire(new c.k("movestart",_)).fire(new c.k("move",_))),this.fire(new c.k("resize",_)),A&&this.fire(new c.k("moveend",_)),this}_getClampedPixelRatio(_,s){const{0:u,1:p}=this._maxCanvasSize,m=this.getPixelRatio(),y=_*m,A=s*m;return Math.min(y>u?u/y:1,A>p?p/A:1)*m}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Wt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(c.M.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(c.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,s,u){if(_==="mouseenter"||_==="mouseover"){let p=!1;return{layer:s,listener:u,delegates:{mousemove:y=>{const A=this.getLayer(s)?this.queryRenderedFeatures(y.point,{layers:[s]}):[];A.length?p||(p=!0,u.call(this,new Gi(_,this,y.originalEvent,{features:A}))):p=!1},mouseout:()=>{p=!1}}}}if(_==="mouseleave"||_==="mouseout"){let p=!1;return{layer:s,listener:u,delegates:{mousemove:A=>{(this.getLayer(s)?this.queryRenderedFeatures(A.point,{layers:[s]}):[]).length?p=!0:p&&(p=!1,u.call(this,new Gi(_,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,u.call(this,new Gi(_,this,A.originalEvent)))}}}}{const p=m=>{const y=this.getLayer(s)?this.queryRenderedFeatures(m.point,{layers:[s]}):[];y.length&&(m.features=y,u.call(this,m),delete m.features)};return{layer:s,listener:u,delegates:{[_]:p}}}}on(_,s,u){if(u===void 0)return super.on(_,s);const p=this._createDelegatedListener(_,s,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(p);for(const m in p.delegates)this.on(m,p.delegates[m]);return this}once(_,s,u){if(u===void 0)return super.once(_,s);const p=this._createDelegatedListener(_,s,u);for(const m in p.delegates)this.once(m,p.delegates[m]);return this}off(_,s,u){return u===void 0?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(p=>{const m=this._delegatedListeners[_];for(let y=0;y<m.length;y++){const A=m[y];if(A.layer===s&&A.listener===u){for(const C in A.delegates)this.off(C,A.delegates[C]);return m.splice(y,1),this}}})(),this)}queryRenderedFeatures(_,s){if(!this.style)return[];let u;const p=_ instanceof c.P||Array.isArray(_),m=p?_:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(p?{}:_)||{},m instanceof c.P||typeof m[0]=="number")u=[c.P.convert(m)];else{const y=c.P.convert(m[0]),A=c.P.convert(m[1]);u=[y,new c.P(A.x,y.y),A,new c.P(y.x,A.y),y]}return this.style.queryRenderedFeatures(u,s,this.transform)}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}setStyle(_,s){return(s=c.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(_,s))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,s));const u=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new la(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,s,u):this.style.loadJSON(_,s,u),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new la(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if(typeof _=="string"){const u=this._requestManager.transformRequest(_,ee.Style);c.h(u,new AbortController).then(p=>{this._updateDiff(p.data,s)}).catch(p=>{p&&this.fire(new c.j(p))})}else typeof _=="object"&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_,s)&&this._update(!0)}catch(u){c.w(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():c.w("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style.sourceCaches[_];if(s!==void 0)return s.loaded();this.fire(new c.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const s=this.style.sourceCaches[_.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&s.reload();for(const u in this.style._layers){const p=this.style._layers[u];p.type==="hillshade"&&p.source===_.source&&c.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Vl(this.painter,s,_),this.painter.renderToTexture=new ld(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=u=>{u.dataType==="style"?this.terrain.sourceCache.freeRtt():u.dataType==="source"&&u.tile&&(u.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(u.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new c.k("terrain",{terrain:_})),this}getTerrain(){var _,s;return(s=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const s in _){const u=_[s]._tiles;for(const p in u){const m=u[p];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,u={}){const{pixelRatio:p=1,sdf:m=!1,stretchX:y,stretchY:A,content:C}=u;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||c.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:I,height:N,data:W}=s,X=s;return this.style.addImage(_,{data:new c.R({width:I,height:N},new Uint8Array(W)),pixelRatio:p,stretchX:y,stretchY:A,content:C,sdf:m,version:0,userImage:X}),X.onAdd&&X.onAdd(this,_),this}}{const{width:I,height:N,data:W}=E.getImageData(s);this.style.addImage(_,{data:new c.R({width:I,height:N},W),pixelRatio:p,stretchX:y,stretchY:A,content:C,sdf:m,version:0})}}updateImage(_,s){const u=this.style.getImage(_);if(!u)return this.fire(new c.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=s instanceof HTMLImageElement||c.b(s)?E.getImageData(s):s,{width:m,height:y,data:A}=p;if(m===void 0||y===void 0)return this.fire(new c.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==u.data.width||y!==u.data.height)return this.fire(new c.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(s instanceof HTMLImageElement||c.b(s));return u.data.replace(A,C),this.style.updateImage(_,u),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new c.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return V.getImage(this._requestManager.transformRequest(_,ee.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,s,u){return this.style.setLayerZoomRange(_,s,u),this._update(!0)}setFilter(_,s,u={}){return this.style.setFilter(_,s,u),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,u,p={}){return this.style.setPaintProperty(_,s,u,p),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,u,p={}){return this.style.setLayoutProperty(_,s,u,p),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setGlyphs(_,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,s,u={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,s,u,p=>{p||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,s,u=>{u||this._update(!0)}),this}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.clientWidth||400,s=this._container.clientHeight||300),[_,s]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const s=this._canvasContainer=M.create("div","maplibregl-canvas-container",_);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const u=this._containerDimensions(),p=this._getClampedPixelRatio(u[0],u[1]);this._resizeCanvas(u[0],u[1],p);const m=this._controlContainer=M.create("div","maplibregl-control-container",_),y=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{y[A]=M.create("div",`maplibregl-ctrl-${A} `,m)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s,u){this._canvas.width=Math.floor(u*_),this._canvas.height=Math.floor(u*s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{s={requestedAttributes:_},p&&(s.statusMessage=p.statusMessage,s.type=p.type)},{once:!0});const u=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!u){const p="Failed to initialize WebGL";throw s?(s.message=p,new Error(JSON.stringify(s))):new Error(p)}this.painter=new Ao(u,this.transform),L.testSupport(u)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let u=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=E.now();this.style.zoomHistory.update(m,y);const A=new c.a8(m,{now:y,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=A.crossFadingFactor();C===1&&C===this._crossFadingFactor||(u=!0,this._crossFadingFactor=C),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new c.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,c.bc.mark(c.bd.load),this.fire(new c.k("load"))),this.style&&(this.style.hasTransitions()||u)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new c.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,c.bc.mark(c.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const u of this._controls)u.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),c.bc.clearMetrics(),this._removed=!0,this.fire(new c.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,E.frameAsync(this._frameRequest).then(_=>{c.bc.frame(_),this._frameRequest=null,this._render(_)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return Gl}getCameraTargetElevation(){return this.transform.elevation}},f.MapMouseEvent=Gi,f.MapTouchEvent=Po,f.MapWheelEvent=Yr,f.Marker=Do,f.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const s=this._map.getZoom(),u=s===this._map.getMaxZoom(),p=s===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,u)=>{const p=this._map._getUIString(`NavigationControl.${u}`);s.title=p,s.setAttribute("aria-label",p)},this.options=c.e({},hd,_),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new dd(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const u=M.create("button",_,this._container);return u.type="button",u.addEventListener("click",s),u}},f.Popup=class extends c.E{constructor(_){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new c.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var u;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Kc(this._lngLat,this._flatPos,this._map.transform):(u=this._lngLat)===null||u===void 0?void 0:u.wrap(),this._trackPointer&&!s)return;const p=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let m=this.options.anchor;const y=_d(this.options.offset);if(!m){const C=this._container.offsetWidth,I=this._container.offsetHeight;let N;N=p.y+y.bottom.y<I?["top"]:p.y>this._map.transform.height-I?["bottom"]:[],p.x<C/2?N.push("left"):p.x>this._map.transform.width-C/2&&N.push("right"),m=N.length===0?"bottom":N.join("-")}let A=p.add(y[m]);this.options.subpixelPositioning||(A=A.round()),M.setTransform(this._container,`${Hl[m]} translate(${A.x}px,${A.y}px)`),Jc(this._container,m,"popup")},this._onClose=()=>{this.remove()},this.options=c.e(Object.create(md),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new c.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=c.M.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),u=document.createElement("body");let p;for(u.innerHTML=_;p=u.firstChild,p;)s.appendChild(p);return this.setDOMContent(s)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(gd);_&&_.focus()}},f.RasterDEMTileSource=Je,f.RasterTileSource=re,f.ScaleControl=class{constructor(_){this._onMove=()=>{Qc(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Qc(this._map,this._container,this.options)},this.options=c.e({},pd,_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},f.ScrollZoomHandler=sd,f.Style=la,f.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},f.TwoFingersTouchPitchHandler=Lp,f.TwoFingersTouchRotateHandler=id,f.TwoFingersTouchZoomHandler=$c,f.TwoFingersTouchZoomRotateHandler=Qt,f.VectorTileSource=J,f.VideoSource=nn,f.addSourceType=(_,s)=>c._(void 0,void 0,void 0,function*(){if(rn(_))throw new Error(`A source type called "${_}" already exists.`);((u,p)=>{Kt[u]=p})(_,s)}),f.clearPrewarmedResources=function(){const _=Ct;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(_n),Ct=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},f.getMaxParallelImageRequests=function(){return c.a.MAX_PARALLEL_IMAGE_REQUESTS},f.getRTLTextPluginStatus=function(){return Gt().getRTLTextPluginStatus()},f.getVersion=function(){return Up},f.getWorkerCount=function(){return Ze.workerCount},f.getWorkerUrl=function(){return c.a.WORKER_URL},f.importScriptInWorkers=function(_){return yn().broadcast("importScript",_)},f.prewarm=function(){un().acquire(_n)},f.setMaxParallelImageRequests=function(_){c.a.MAX_PARALLEL_IMAGE_REQUESTS=_},f.setRTLTextPlugin=function(_,s){return Gt().setRTLTextPlugin(_,s)},f.setWorkerCount=function(_){Ze.workerCount=_},f.setWorkerUrl=function(_){c.a.WORKER_URL=_}});var h=t;return h})})(bA);var tc=bA.exports;function DO(n,e){const t=[];for(let i=0;i<n;i++)t.push(e(i));return t}let zO=class{constructor(e,t){tt(this,"canvas");tt(this,"gl");tt(this,"windGraph1");tt(this,"windGraph2");tt(this,"smudgeGraph1");tt(this,"smudgeGraph2");tt(this,"outGraph1");tt(this,"outGraph2");tt(this,"i",0);e.width=e.clientWidth,e.height=e.clientHeight;let i=e.getContext("webgl2");const o=new Ph(i,{allowAlpha:!0}),h=e.width,f=e.height,c=2e3,v=DO(c,je=>[Math.random(),Math.random(),Math.random()]),w=new Fs(i,{data:new Float32Array(v.flat()),changesOften:!0}),S=structuredClone(v),E=new Fs(i,{data:new Float32Array(S.flat()),changesOften:!0}),M=[[1,1,0,1],[1,-1,0,1],[-1,1,0,1],[-1,1,0,1],[1,-1,0,1],[-1,-1,0,1]],L=new Fs(i,{data:new Float32Array(M.flat()),changesOften:!1}),[U,B,z,R]=[t.tlMerc.x,t.tlMerc.y,t.brMerc.x,t.brMerc.y],G=[[z,R,0,1],[z,B,0,1],[U,R,0,1],[U,R,0,1],[z,B,0,1],[U,B,0,1]],V=new Fs(i,{data:new Float32Array(G.flat()),changesOften:!1}),ee=new zs(i,{width:h,height:f,type:"ubyte4",interpolate:"linear",edges:"clamp"}),fe=new zs(i,{width:h,height:f,type:"ubyte4",interpolate:"linear",edges:"clamp"}),Z=new zs(i,{width:h,height:f,type:"ubyte4",interpolate:"linear",edges:"clamp"}),te=new $i(i,{image:t.speedImage}),be=new Di(o,{program:{vertexSource:`#version 300 es
                      in vec3 particles;              // [mercator.x, mercator.y, lifetime]
                      out vec3 particlesNew;          // [mercator.x, mercator.y, lifetime]
                      uniform mat4 projMatrix;        // mercator to clip-space
                      uniform mat4 projMatrixInv;     // clip-space to mercator
                      uniform sampler2D speedTexture;
                      uniform float time;
                      uniform float zoom;
                      uniform vec4 bbox;
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }
        
                      float rand(vec2 co) {
                        return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
                      }
        
                      float zClipFromInverse(float xClip, float yClip) {
                        mat4 M = projMatrixInv;
                        return (- M[0][2] * xClip - M[1][2] * yClip - M[3][2]) / M[2][2];
                      }
        
                      // Or more generally, if zMerc !== 0:
                      float zClipFromInverseWithHeight(float xClip, float yClip, float zMerc) {
                        mat4 M = projMatrixInv;
                        float a = M[0][2] * xClip + M[1][2] * yClip + M[3][2]; 
                        float b = zMerc * ( M[0][3] * xClip + M[1][3] * yClip + M[3][3] );
                        float c = zMerc * M[2][3] - M[2][2];
                        return (a - b) / c;
                      }
        
                      void main() {
                          vec2 positionMerc = particles.xy;
                          float lifeTime = particles.z - 0.005;
                          
                          if (lifeTime < 0.0) {
                            float clipX = (rand(particles.xy) * 2.0 - 1.0) * 1.05;
                            float clipY = (rand(particles.yx) * 2.0 - 1.0) * 1.05;
                            float clipZ = zClipFromInverse(clipX, clipY);
                            vec4 randPointClip = vec4(clipX, clipY, clipZ, 1.0);
        
                            vec4 randPointMerc = projMatrixInv * randPointClip;
                            positionMerc.xy = randPointMerc.xy / randPointMerc.w;
                            lifeTime = 1.0;
                          }
        
                          gl_PointSize = 2.0;
                          vec4 speedMerc =  2.0 * texture(speedTexture, merc2uv(positionMerc.xy)) - 1.0;
                          vec4 updatedPositionMerc = vec4(positionMerc.xy, 0, 1) + 0.1 * speedMerc / (50.0 * zoom * zoom * zoom);
                          gl_Position = projMatrix * updatedPositionMerc;
                          particlesNew = vec3(updatedPositionMerc.xy, lifeTime);
                          // gl_Position = vec4(updatedPositionMerc.xy, 0, 1); <-- nothing
                          // gl_Position = vec4(positionMerc.xy, 0, 1); <-- something drawn before matrix is available, but fading.
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      out vec4 fragColor;
                      void main() {
                          fragColor = vec4(1, 0, 0, 1);
                      }
                  `},inputs:{attributes:{particles:{buffer:w,config:{type:"vec3",normalize:!1,nrInstances:0}}},textures:{speedTexture:te},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},projMatrixInv:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},time:{type:"float",value:[0]},zoom:{type:"float",value:[0]},bbox:{type:"vec4",value:[U,B,z,R]}}},outputs:{transformFeedback:{data:{particlesNew:E},runFragmentShader:!0},frameBuffer:{textures:[ee]}},settings:{drawingMode:"points",instanced:!1,nrVertices:c,viewport:[0,0,h,f]}}),ae=new Di(o,{...be.config,program:be.program,inputs:{...be.config.inputs,attributes:{particles:{buffer:E,config:{type:"vec3",normalize:!1,nrInstances:0}}}},outputs:{...be.config.outputs,transformFeedback:{data:{particlesNew:w},runFragmentShader:!0}}}),K=new Di(o,{program:{vertexSource:`#version 300 es
                in vec4 tposition;
                void main() {
                  gl_Position = vec4(tposition.x, tposition.y, 0, 1);
                }
              `,fragmentSource:`#version 300 es
                precision highp float;
                uniform sampler2D particlesTexture;
                uniform sampler2D smudgeTextureLast;
                uniform vec2 texSize;
                uniform bool isMoving;
                out vec4 fragColor;
                void main() {
                  vec2 uv = vec2(
                      gl_FragCoord.x / texSize.x, 
                      gl_FragCoord.y / texSize.y
                  );
                  vec4 lastColor = texture(smudgeTextureLast, uv);
                  lastColor *= 0.95;
                  vec4 particleColor = texture(particlesTexture, uv);
                  fragColor = particleColor + lastColor;
                  if (isMoving) fragColor = vec4(0,0,0,0);
                }
              `},inputs:{attributes:{tposition:{buffer:L,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{particlesTexture:ee,smudgeTextureLast:fe},uniforms:{isMoving:{type:"bool",value:[0]},texSize:{type:"vec2",value:[h,f]}}},outputs:{frameBuffer:{textures:[Z]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,h,f]}}),Pe=new Di(o,{...K.config,program:K.program,inputs:{...K.config.inputs,textures:{particlesTexture:ee,smudgeTextureLast:Z}},outputs:{...K.config.outputs,frameBuffer:{textures:[fe]}}}),ke=new Di(o,{program:{vertexSource:`#version 300 es
                      in vec4 bboxPosMerc;
                      uniform mat4 projMatrix;
                      out vec2 positionMerc;
                      void main() {
                          gl_Position = projMatrix * vec4(bboxPosMerc.xy, 0, 1);  
                          positionMerc = bboxPosMerc.xy;
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      uniform sampler2D smudgedTexture;
                      uniform sampler2D speedTexture;
                      uniform vec4 bbox;
                      uniform vec2 texSize;
                      in vec2 positionMerc;
                      out highp vec4 fragColor;
        
                      vec2 currentClipUv() {
                        float u = gl_FragCoord.x / texSize.x;
                        float v = gl_FragCoord.y / texSize.y;
                        return vec2(u, v);
                      }
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }

                      vec3 colorRamp1 = vec3(0.07890625, 0.25546875, 0.4);
                      vec3 colorRamp2 = vec3(0.36015625, 0.2984375,  0.56015625);
                      vec3 colorRamp3 = vec3(0.653125,   0.18125,    0.29453125);

                      vec3 colorScale(float h) {
                        if (h < 0.5) {
                          float deg = 2.0 * h;
                          return mix(colorRamp1, colorRamp2, deg);
                        }
                        else {
                          float deg = (h - 0.5) * 2.0;
                          return mix(colorRamp2, colorRamp3, deg);
                        }
                      }
        
                      void main() {
                          vec2 uvSmudge = currentClipUv();
                          vec4 currentSmudge = texture(smudgedTexture, uvSmudge);
                          float p = currentSmudge.x;
                          vec3 particleColor = vec3(p);
                          
                          vec2 uvSpeed = merc2uv(positionMerc);
                          vec4 currentSpeed = texture(speedTexture, uvSpeed);
                          float magSpeed = length(currentSpeed) / 1.732; // 1.732: sqrt(1+1+1)
                          vec3 speedColor = colorScale(magSpeed);

                          fragColor = vec4(
                            max(particleColor.x, speedColor.x),
                            max(particleColor.y, speedColor.y),
                            max(particleColor.z, speedColor.z),
                            max(p, 0.3)
                          );

                          // if (p > 0.1) {
                          //   fragColor = vec4(particleColor.xyz, 1.0);
                          // } else {
                          //   fragColor = vec4(speedColor.xyz, 0.6);
                          // }
                          // fragColor = max(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0)
                          // );
                          // fragColor = mix(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0),
                          //   p
                          // );
                          // fragColor = max(vec4(currentSmudge.x), vec4(magSpeed, 1.0 - magSpeed, 1.0 - magSpeed, 0.4));
                          // fragColor = vec4(currentSmudge.x) + vec4(0.1, 0.1, 0.1, 0.4);
                          // fragColor = vec4(currentSmudge.x) + currentSpeed;
                      }
              `},inputs:{attributes:{bboxPosMerc:{buffer:V,config:{type:"vec4",normalize:!1,nrInstances:0}}},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},bbox:{type:"vec4",value:[U,B,z,R]},texSize:{type:"vec2",value:[h,f]}},textures:{smudgedTexture:Z,speedTexture:te}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:G.length,viewport:[0,0,h,f]}}),Te=new Di(o,{...ke.config,program:ke.program,inputs:{...ke.config.inputs,textures:{smudgedTexture:fe,speedTexture:te}}});this.canvas=e,this.gl=i,this.windGraph1=be,this.windGraph2=ae,this.smudgeGraph1=K,this.smudgeGraph2=Pe,this.outGraph1=ke,this.outGraph2=Te}step(e){this.i%2===0?(this.windGraph1.updateUniform("projMatrix",e.matrix),this.windGraph1.updateUniform("projMatrixInv",e.invMatrix),this.windGraph1.updateUniform("time",[new Date().getTime()]),this.windGraph1.updateUniform("zoom",[e.zoom]),this.smudgeGraph1.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph1.updateUniform("projMatrix",e.matrix),this.outGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph1.draw([0,0,0,1]),this.smudgeGraph1.draw([0,0,0,1]),this.outGraph1.draw()):(this.windGraph2.updateUniform("projMatrix",e.matrix),this.windGraph2.updateUniform("projMatrixInv",e.invMatrix),this.windGraph2.updateUniform("time",[new Date().getTime()]),this.windGraph2.updateUniform("zoom",[e.zoom]),this.smudgeGraph2.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph2.updateUniform("projMatrix",e.matrix),this.outGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph2.draw([0,0,0,1]),this.smudgeGraph2.draw([0,0,0,1]),this.outGraph2.draw()),this.i+=1}destroy(e){var t,i,o,h,f,c;(t=this.windGraph1)==null||t.destroy(e),(i=this.windGraph2)==null||i.destroy(e),(o=this.smudgeGraph1)==null||o.destroy(e),(h=this.smudgeGraph2)==null||h.destroy(e),(f=this.outGraph1)==null||f.destroy(e),(c=this.outGraph2)==null||c.destroy(e)}};const kO=8,FO="Dark Matter DLR",UO={"mapbox:autocomposite":!1,"mapbox:groups":{"101da9f13b64a08fa4b6ac1168e89e5f":{collapsed:!1,name:"Places"},a14c9607bc7954ba1df7205bf660433f:{name:"Boundaries"},b6371a3f2f5a9932464fa3867530a2e5:{collapsed:!1,name:"Transportation"}},"mapbox:type":"template","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t","openmaptiles:version":"3.x","maputnik:renderer":"mlgljs"},NO={openmaptiles:{type:"vector",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"],minZoom:0,maxZoom:14}},OO="https://openmaptiles.github.io/dark-matter-gl-style/sprite",BO="https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf",VO=[{id:"background",type:"background",paint:{"background-color":"rgb(12,12,12)"}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-antialias":!1,"fill-color":"rgb(27 ,27 ,29)"}},{id:"landcover_ice_shelf",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","ice_shelf"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(12,12,12)","fill-opacity":.7}},{id:"landcover_glacier",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","glacier"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 1%, 2%)","fill-opacity":{base:1,stops:[[0,1],[8,.5]]}}},{id:"landuse_residential",type:"fill",source:"openmaptiles","source-layer":"landuse",maxzoom:9,filter:["all",["==","$type","Polygon"],["==","class","residential"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 2%, 5%)","fill-opacity":.4}},{id:"landcover_wood",type:"fill",source:"openmaptiles","source-layer":"landcover",minzoom:10,filter:["all",["==","$type","Polygon"],["==","class","wood"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)","fill-opacity":{base:.3,stops:[[8,0],[10,.8],[13,.4]]},"fill-pattern":"wood-pattern","fill-translate":[0,0]}},{id:"landuse_park",type:"fill",source:"openmaptiles","source-layer":"landuse",filter:["all",["==","$type","Polygon"],["==","class","park"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)"}},{id:"waterway",type:"line",source:"openmaptiles","source-layer":"waterway",filter:["==","$type","LineString"],layout:{visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)"}},{id:"water_name",type:"symbol",source:"openmaptiles","source-layer":"water_name",filter:["==","$type","LineString"],layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Condensed Italic"],"text-rotation-alignment":"map","text-size":12},paint:{"text-color":"hsla(0, 0%, 0%, 0.7)","text-halo-color":"hsl(0, 0%, 27%)"}},{id:"building",type:"fill",source:"openmaptiles","source-layer":"building",minzoom:12,filter:["==","$type","Polygon"],paint:{"fill-antialias":!0,"fill-color":"rgb(10,10,10)","fill-outline-color":"rgb(27 ,27 ,29)"}},{id:"aeroway-taxiway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":1,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"aeroway-runway-casing",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-opacity":1,"line-width":{base:1.5,stops:[[11,5],[17,55]]}}},{id:"aeroway-area",type:"fill",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],layout:{visibility:"visible"},paint:{"fill-color":"#000","fill-opacity":1}},{id:"aeroway-runway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#000","line-opacity":1,"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"road_area_pier",type:"fill",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","Polygon"],["==","class","pier"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"rgb(12,12,12)"}},{id:"road_pier",type:"line",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["in","class","pier"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(12,12,12)","line-width":{base:1.2,stops:[[15,1],[17,4]]}}},{id:"highway_path",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["==","class","path"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)","line-dasharray":[1.5,1.5],"line-opacity":.9,"line-width":{base:1.2,stops:[[13,1],[20,10]]}}},{id:"highway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:8,filter:["all",["==","$type","LineString"],["in","class","minor","service","track"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":.9,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"highway_major_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[12,0],"line-width":{base:1.3,stops:[[10,3],[20,23]]}}},{id:"highway_major_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"hsl(0, 0%, 7%)","line-width":{base:1.3,stops:[[10,2],[20,20]]}}},{id:"highway_major_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,maxzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#2a2a2a","line-width":{stops:[[6,0],[8,2]]}}},{id:"highway_motorway_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[2,0],"line-opacity":1,"line-width":{base:1.4,stops:[[5.8,0],[6,3],[20,40]]}}},{id:"highway_motorway_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":{base:1,stops:[[5.8,"hsla(0, 0%, 85%, 0.53)"],[6,"#000"]]},"line-width":{base:1.4,stops:[[4,2],[6,1.3],[20,30]]}}},{id:"road_oneway",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":0,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"road_oneway_opposite",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",-1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":180,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"highway_motorway_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",maxzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-width":{base:1.4,stops:[[4,2],[6,1.3]]}}},{id:"railway_transit",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_transit_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_minor_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":{base:1.3,stops:[[16,3],[20,7]]}}},{id:"railway_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":{base:1.3,stops:[[16,2],[20,6]]}}},{id:"highway_name_other",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["!=","class","motorway"],["==","$type","LineString"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{name:latin} {name:nonlatin}","text-font":["Roboto Regular"],"text-max-angle":30,"text-pitch-alignment":"viewport","text-rotation-alignment":"map","text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgba(80, 78, 78, 1)","text-halo-blur":0,"text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":1,"text-translate":[0,0]}},{id:"highway_name_motorway",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{ref}","text-font":["Roboto Light"],"text-pitch-alignment":"viewport","text-rotation-alignment":"viewport","text-size":10,visibility:"visible"},paint:{"text-color":"hsl(0, 0%, 37%)","text-translate":[0,2]}},{id:"boundary_state",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",filter:["==","admin_level",4],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-blur":.4,"line-color":"hsl(0, 0%, 21%)","line-dasharray":[2,2],"line-opacity":1,"line-width":{base:1.3,stops:[[3,1],[22,15]]}}},{id:"boundary_country_z0-4",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",maxzoom:5,filter:["all",["==","admin_level",2],["!has","claimed_by"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"boundary_country_z5-",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",minzoom:5,filter:["==","admin_level",2],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"place_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["in","class","hamlet","isolated_dwelling","neighbourhood"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_suburb",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","suburb"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_village",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","village"]],layout:{"icon-size":.4,"text-anchor":"left","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_town",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","town"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","city"],[">","rank",3]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city_large",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["<=","rank",3],["==","class","city"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":14,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_state",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["==","class","state"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_country_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Condensed Italic"],"text-size":{base:1,stops:[[0,9],[1,11]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_minor",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],[">=","rank",2],["has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1,stops:[[0,10],[6,12]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_major",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:6,filter:["all",["==","$type","Point"],["<=","rank",1],["==","class","country"],["has","iso_a2"]],layout:{"text-anchor":"center","text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1.4,stops:[[0,10],[3,12],[4,14]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}}],GO="dark-matter",HO={version:kO,name:FO,metadata:UO,sources:NO,sprite:OO,glyphs:BO,layers:VO,id:GO};class jO{constructor(){tt(this,"container");tt(this,"overlay");tt(this,"looper");tt(this,"ws");tt(this,"map");tt(this,"destroyed",!1);tt(this,"zoom",1);tt(this,"movingTimeout");tt(this,"isMoving",!1);tt(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);tt(this,"invMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}async init(e,t){t.width=t.clientWidth,t.height=t.clientHeight,this.container=e,this.overlay=t;const i=52.99489512738211,o=55.20539216798002,h=6.787129861958135,f=12.989942944851833;this.map=new tc.Map({container:e,style:HO,center:new tc.LngLat((f-h)/2+h,(o-i)/2+i),maxZoom:11,minZoom:6,maxBounds:new tc.LngLatBounds(new tc.LngLat(h-1,i-1),new tc.LngLat(f+1,o+1)),zoom:8,bearing:15,pitch:30});const c=new tc.LngLat(h,o),v=new tc.LngLat(f,i),w=this.map.transform.locationCoordinate(c),S=this.map.transform.locationCoordinate(v),E=await $i.loadImage("/wind_map.jpg");this.ws=new zO(t,{tlMerc:w,brMerc:S,speedImage:E}),this.looper=new Ec(30,()=>{var M;(M=this.ws)==null||M.step({zoom:this.zoom,isMoving:this.isMoving,matrix:this.matrix,invMatrix:this.invMatrix})}),this.map.addLayer({id:"windSim",type:"custom",render:(M,L)=>{this.matrix=Array.from(L),this.invMatrix=Array.from(LO(IO(),L)),this.map&&(this.zoom=this.map.getZoom()),this.isMoving=!0,this.movingTimeout&&(clearTimeout(this.movingTimeout),this.movingTimeout=void 0),this.movingTimeout=setTimeout(()=>this.isMoving=!1,100)}}),this.startLoop()}startLoop(){var e;!this.container||!this.overlay||(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){this.stopLoop(),this.ws&&this.ws.destroy(!0),this.map&&this.map.remove(),this.overlay=void 0,this.container=void 0,this.destroyed=!0}}function WO(){const n=ct.useRef(null),e=ct.useRef(null);return ct.useEffect(()=>{const t=new jO;return n.current&&e.current&&t.init(n.current,e.current),()=>t.destroy()},[n.current,e.current]),ge.jsx("div",{ref:n,style:{width:"100%",height:"100%"},children:ge.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",position:"absolute",zIndex:1,top:0,left:0,pointerEvents:"none"}})})}function $O(){return ge.jsxs(xA,{bgImg:"/turbine_img.jpg",title:"Wind visualization",subTitle:"Scaling to thousands of points",logo:ge.jsxs("svg",{id:"fullBuilding",width:"100%",height:"100%",viewBox:"0 0 100 200",children:[ge.jsx("rect",{x:"47.5",y:"70",width:"5",height:"100",fill:"black"}),ge.jsx("rect",{x:"45",y:"70",width:"10",height:"8",fill:"black"}),ge.jsxs("svg",{id:"fullRotor",x:"0",y:"20",width:"100",height:"100",viewBox:"0 0 100 100",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"blade",d:"M 0,50 C 9,40, 0,30, 0,0 Z",fill:"black"})}),ge.jsxs("g",{transform:"rotate(10 50 50)",children:[ge.jsx("svg",{x:"45",y:"45",width:"10",height:"10",viewBox:"0 0 100 100",children:ge.jsx("g",{transform:"rotate(15 50 50)",children:ge.jsx("path",{d:"M 50 0 L 93.3 75 L 6.7 75 Z",fill:"black"})})}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:""}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(120 50 50)"}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(240 50 50)"}),ge.jsx("circle",{cx:"50",cy:"50",r:"2.5",fill:"black"})]})]})]}),children:[ge.jsx("p",{style:{margin:"2rem"},children:"Using particles is a highly readable and intuitive way of displaying wind speed and development. Such a visualization has the highest impact only with many hundreds or thousands of individual particles - which is not realistically possible on standard CPUs."}),ge.jsx("p",{style:{margin:"2rem"},children:"Here we've build custom glsl-shaders to simulate thousands of particles at a time. This way, your main site remains responsive, while the heavy lifting has been outsourced to the GPU."}),ge.jsx("div",{style:{width:"100%",aspectRatio:"3/2"},children:ge.jsx(WO,{})}),ge.jsx("p",{style:{margin:"2rem"},children:"The above example has been written for use in maplibre, but can be adjusted for other mapping libraries such as openlayers."})]})}const XO=nD([{path:"/",element:ge.jsx(vO,{}),errorElement:ge.jsx(HD,{}),children:[{path:"/",element:ge.jsx(_O,{})},{path:"/contact",element:ge.jsx(GD,{})},{path:"/swe",element:ge.jsx(RO,{})},{path:"/wind",element:ge.jsx($O,{})},{path:"/imprint",element:ge.jsx(xO,{})},{path:"/resources",element:ge.jsx(MO,{})}]}]);z0.createRoot(document.getElementById("root")).render(ge.jsx(oT.StrictMode,{children:ge.jsx(uD,{router:XO})}));
