var VC=Object.defineProperty;var HC=(t,e,n)=>e in t?VC(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var ht=(t,e,n)=>(HC(t,typeof e!="symbol"?e+"":e,n),n);function iT(t,e){for(var n=0;n<e.length;n++){const r=e[n];if(typeof r!="string"&&!Array.isArray(r)){for(const s in r)if(s!=="default"&&!(s in t)){const c=Object.getOwnPropertyDescriptor(r,s);c&&Object.defineProperty(t,s,c.get?c:{enumerable:!0,get:()=>r[s]})}}}return Object.freeze(Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const h of c.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function n(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(s){if(s.ep)return;s.ep=!0;const c=n(s);fetch(s.href,c)}})();var GC=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function aT(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var sT={exports:{}},iv={},oT={exports:{}},ir={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ep=Symbol.for("react.element"),jC=Symbol.for("react.portal"),WC=Symbol.for("react.fragment"),qC=Symbol.for("react.strict_mode"),$C=Symbol.for("react.profiler"),XC=Symbol.for("react.provider"),ZC=Symbol.for("react.context"),YC=Symbol.for("react.forward_ref"),KC=Symbol.for("react.suspense"),JC=Symbol.for("react.memo"),QC=Symbol.for("react.lazy"),Y4=Symbol.iterator;function eP(t){return t===null||typeof t!="object"?null:(t=Y4&&t[Y4]||t["@@iterator"],typeof t=="function"?t:null)}var lT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},cT=Object.assign,uT={};function jd(t,e,n){this.props=t,this.context=e,this.refs=uT,this.updater=n||lT}jd.prototype.isReactComponent={};jd.prototype.setState=function(t,e){if(typeof t!="object"&&typeof t!="function"&&t!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,t,e,"setState")};jd.prototype.forceUpdate=function(t){this.updater.enqueueForceUpdate(this,t,"forceUpdate")};function hT(){}hT.prototype=jd.prototype;function B2(t,e,n){this.props=t,this.context=e,this.refs=uT,this.updater=n||lT}var O2=B2.prototype=new hT;O2.constructor=B2;cT(O2,jd.prototype);O2.isPureReactComponent=!0;var K4=Array.isArray,dT=Object.prototype.hasOwnProperty,U2={current:null},fT={key:!0,ref:!0,__self:!0,__source:!0};function pT(t,e,n){var r,s={},c=null,h=null;if(e!=null)for(r in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(c=""+e.key),e)dT.call(e,r)&&!fT.hasOwnProperty(r)&&(s[r]=e[r]);var l=arguments.length-2;if(l===1)s.children=n;else if(1<l){for(var m=Array(l),_=0;_<l;_++)m[_]=arguments[_+2];s.children=m}if(t&&t.defaultProps)for(r in l=t.defaultProps,l)s[r]===void 0&&(s[r]=l[r]);return{$$typeof:Ep,type:t,key:c,ref:h,props:s,_owner:U2.current}}function tP(t,e){return{$$typeof:Ep,type:t.type,key:e,ref:t.ref,props:t.props,_owner:t._owner}}function V2(t){return typeof t=="object"&&t!==null&&t.$$typeof===Ep}function nP(t){var e={"=":"=0",":":"=2"};return"$"+t.replace(/[=:]/g,function(n){return e[n]})}var J4=/\/+/g;function Hy(t,e){return typeof t=="object"&&t!==null&&t.key!=null?nP(""+t.key):e.toString(36)}function qg(t,e,n,r,s){var c=typeof t;(c==="undefined"||c==="boolean")&&(t=null);var h=!1;if(t===null)h=!0;else switch(c){case"string":case"number":h=!0;break;case"object":switch(t.$$typeof){case Ep:case jC:h=!0}}if(h)return h=t,s=s(h),t=r===""?"."+Hy(h,0):r,K4(s)?(n="",t!=null&&(n=t.replace(J4,"$&/")+"/"),qg(s,e,n,"",function(_){return _})):s!=null&&(V2(s)&&(s=tP(s,n+(!s.key||h&&h.key===s.key?"":(""+s.key).replace(J4,"$&/")+"/")+t)),e.push(s)),1;if(h=0,r=r===""?".":r+":",K4(t))for(var l=0;l<t.length;l++){c=t[l];var m=r+Hy(c,l);h+=qg(c,e,n,m,s)}else if(m=eP(t),typeof m=="function")for(t=m.call(t),l=0;!(c=t.next()).done;)c=c.value,m=r+Hy(c,l++),h+=qg(c,e,n,m,s);else if(c==="object")throw e=String(t),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function $m(t,e,n){if(t==null)return t;var r=[],s=0;return qg(t,r,"","",function(c){return e.call(n,c,s++)}),r}function rP(t){if(t._status===-1){var e=t._result;e=e(),e.then(function(n){(t._status===0||t._status===-1)&&(t._status=1,t._result=n)},function(n){(t._status===0||t._status===-1)&&(t._status=2,t._result=n)}),t._status===-1&&(t._status=0,t._result=e)}if(t._status===1)return t._result.default;throw t._result}var ba={current:null},$g={transition:null},iP={ReactCurrentDispatcher:ba,ReactCurrentBatchConfig:$g,ReactCurrentOwner:U2};ir.Children={map:$m,forEach:function(t,e,n){$m(t,function(){e.apply(this,arguments)},n)},count:function(t){var e=0;return $m(t,function(){e++}),e},toArray:function(t){return $m(t,function(e){return e})||[]},only:function(t){if(!V2(t))throw Error("React.Children.only expected to receive a single React element child.");return t}};ir.Component=jd;ir.Fragment=WC;ir.Profiler=$C;ir.PureComponent=B2;ir.StrictMode=qC;ir.Suspense=KC;ir.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=iP;ir.cloneElement=function(t,e,n){if(t==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+t+".");var r=cT({},t.props),s=t.key,c=t.ref,h=t._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,h=U2.current),e.key!==void 0&&(s=""+e.key),t.type&&t.type.defaultProps)var l=t.type.defaultProps;for(m in e)dT.call(e,m)&&!fT.hasOwnProperty(m)&&(r[m]=e[m]===void 0&&l!==void 0?l[m]:e[m])}var m=arguments.length-2;if(m===1)r.children=n;else if(1<m){l=Array(m);for(var _=0;_<m;_++)l[_]=arguments[_+2];r.children=l}return{$$typeof:Ep,type:t.type,key:s,ref:c,props:r,_owner:h}};ir.createContext=function(t){return t={$$typeof:ZC,_currentValue:t,_currentValue2:t,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},t.Provider={$$typeof:XC,_context:t},t.Consumer=t};ir.createElement=pT;ir.createFactory=function(t){var e=pT.bind(null,t);return e.type=t,e};ir.createRef=function(){return{current:null}};ir.forwardRef=function(t){return{$$typeof:YC,render:t}};ir.isValidElement=V2;ir.lazy=function(t){return{$$typeof:QC,_payload:{_status:-1,_result:t},_init:rP}};ir.memo=function(t,e){return{$$typeof:JC,type:t,compare:e===void 0?null:e}};ir.startTransition=function(t){var e=$g.transition;$g.transition={};try{t()}finally{$g.transition=e}};ir.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};ir.useCallback=function(t,e){return ba.current.useCallback(t,e)};ir.useContext=function(t){return ba.current.useContext(t)};ir.useDebugValue=function(){};ir.useDeferredValue=function(t){return ba.current.useDeferredValue(t)};ir.useEffect=function(t,e){return ba.current.useEffect(t,e)};ir.useId=function(){return ba.current.useId()};ir.useImperativeHandle=function(t,e,n){return ba.current.useImperativeHandle(t,e,n)};ir.useInsertionEffect=function(t,e){return ba.current.useInsertionEffect(t,e)};ir.useLayoutEffect=function(t,e){return ba.current.useLayoutEffect(t,e)};ir.useMemo=function(t,e){return ba.current.useMemo(t,e)};ir.useReducer=function(t,e,n){return ba.current.useReducer(t,e,n)};ir.useRef=function(t){return ba.current.useRef(t)};ir.useState=function(t){return ba.current.useState(t)};ir.useSyncExternalStore=function(t,e,n){return ba.current.useSyncExternalStore(t,e,n)};ir.useTransition=function(){return ba.current.useTransition()};ir.version="18.2.0";oT.exports=ir;var pt=oT.exports;const mT=aT(pt),aP=iT({__proto__:null,default:mT},[pt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sP=pt,oP=Symbol.for("react.element"),lP=Symbol.for("react.fragment"),cP=Object.prototype.hasOwnProperty,uP=sP.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hP={key:!0,ref:!0,__self:!0,__source:!0};function gT(t,e,n){var r,s={},c=null,h=null;n!==void 0&&(c=""+n),e.key!==void 0&&(c=""+e.key),e.ref!==void 0&&(h=e.ref);for(r in e)cP.call(e,r)&&!hP.hasOwnProperty(r)&&(s[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps,e)s[r]===void 0&&(s[r]=e[r]);return{$$typeof:oP,type:t,key:c,ref:h,props:s,_owner:uP.current}}iv.Fragment=lP;iv.jsx=gT;iv.jsxs=gT;sT.exports=iv;var me=sT.exports,fx={},vT={exports:{}},rs={},yT={exports:{}},_T={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(t){function e(ke,at){var ot=ke.length;ke.push(at);e:for(;0<ot;){var _t=ot-1>>>1,kt=ke[_t];if(0<s(kt,at))ke[_t]=at,ke[ot]=kt,ot=_t;else break e}}function n(ke){return ke.length===0?null:ke[0]}function r(ke){if(ke.length===0)return null;var at=ke[0],ot=ke.pop();if(ot!==at){ke[0]=ot;e:for(var _t=0,kt=ke.length,Cn=kt>>>1;_t<Cn;){var it=2*(_t+1)-1,Mt=ke[it],Ft=it+1,At=ke[Ft];if(0>s(Mt,ot))Ft<kt&&0>s(At,Mt)?(ke[_t]=At,ke[Ft]=ot,_t=Ft):(ke[_t]=Mt,ke[it]=ot,_t=it);else if(Ft<kt&&0>s(At,ot))ke[_t]=At,ke[Ft]=ot,_t=Ft;else break e}}return at}function s(ke,at){var ot=ke.sortIndex-at.sortIndex;return ot!==0?ot:ke.id-at.id}if(typeof performance=="object"&&typeof performance.now=="function"){var c=performance;t.unstable_now=function(){return c.now()}}else{var h=Date,l=h.now();t.unstable_now=function(){return h.now()-l}}var m=[],_=[],S=1,T=null,M=3,I=!1,N=!1,B=!1,k=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function V(ke){for(var at=n(_);at!==null;){if(at.callback===null)r(_);else if(at.startTime<=ke)r(_),at.sortIndex=at.expirationTime,e(m,at);else break;at=n(_)}}function Y(ke){if(B=!1,V(ke),!N)if(n(m)!==null)N=!0,gt(he);else{var at=n(_);at!==null&&ft(Y,at.startTime-ke)}}function he(ke,at){N=!1,B&&(B=!1,C(xe),xe=-1),I=!0;var ot=M;try{for(V(at),T=n(m);T!==null&&(!(T.expirationTime>at)||ke&&!Te());){var _t=T.callback;if(typeof _t=="function"){T.callback=null,M=T.priorityLevel;var kt=_t(T.expirationTime<=at);at=t.unstable_now(),typeof kt=="function"?T.callback=kt:T===n(m)&&r(m),V(at)}else r(m);T=n(m)}if(T!==null)var Cn=!0;else{var it=n(_);it!==null&&ft(Y,it.startTime-at),Cn=!1}return Cn}finally{T=null,M=ot,I=!1}}var Z=!1,ne=null,xe=-1,ie=5,J=-1;function Te(){return!(t.unstable_now()-J<ie)}function Be(){if(ne!==null){var ke=t.unstable_now();J=ke;var at=!0;try{at=ne(!0,ke)}finally{at?Re():(Z=!1,ne=null)}}else Z=!1}var Re;if(typeof U=="function")Re=function(){U(Be)};else if(typeof MessageChannel<"u"){var We=new MessageChannel,ct=We.port2;We.port1.onmessage=Be,Re=function(){ct.postMessage(null)}}else Re=function(){k(Be,0)};function gt(ke){ne=ke,Z||(Z=!0,Re())}function ft(ke,at){xe=k(function(){ke(t.unstable_now())},at)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(ke){ke.callback=null},t.unstable_continueExecution=function(){N||I||(N=!0,gt(he))},t.unstable_forceFrameRate=function(ke){0>ke||125<ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ie=0<ke?Math.floor(1e3/ke):5},t.unstable_getCurrentPriorityLevel=function(){return M},t.unstable_getFirstCallbackNode=function(){return n(m)},t.unstable_next=function(ke){switch(M){case 1:case 2:case 3:var at=3;break;default:at=M}var ot=M;M=at;try{return ke()}finally{M=ot}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(ke,at){switch(ke){case 1:case 2:case 3:case 4:case 5:break;default:ke=3}var ot=M;M=ke;try{return at()}finally{M=ot}},t.unstable_scheduleCallback=function(ke,at,ot){var _t=t.unstable_now();switch(typeof ot=="object"&&ot!==null?(ot=ot.delay,ot=typeof ot=="number"&&0<ot?_t+ot:_t):ot=_t,ke){case 1:var kt=-1;break;case 2:kt=250;break;case 5:kt=1073741823;break;case 4:kt=1e4;break;default:kt=5e3}return kt=ot+kt,ke={id:S++,callback:at,priorityLevel:ke,startTime:ot,expirationTime:kt,sortIndex:-1},ot>_t?(ke.sortIndex=ot,e(_,ke),n(m)===null&&ke===n(_)&&(B?(C(xe),xe=-1):B=!0,ft(Y,ot-_t))):(ke.sortIndex=kt,e(m,ke),N||I||(N=!0,gt(he))),ke},t.unstable_shouldYield=Te,t.unstable_wrapCallback=function(ke){var at=M;return function(){var ot=M;M=at;try{return ke.apply(this,arguments)}finally{M=ot}}}})(_T);yT.exports=_T;var dP=yT.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xT=pt,ts=dP;function zt(t){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+t,n=1;n<arguments.length;n++)e+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+t+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var bT=new Set,Y0={};function ju(t,e){Cd(t,e),Cd(t+"Capture",e)}function Cd(t,e){for(Y0[t]=e,t=0;t<e.length;t++)bT.add(e[t])}var cl=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),px=Object.prototype.hasOwnProperty,fP=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Q4={},e3={};function pP(t){return px.call(e3,t)?!0:px.call(Q4,t)?!1:fP.test(t)?e3[t]=!0:(Q4[t]=!0,!1)}function mP(t,e,n,r){if(n!==null&&n.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:n!==null?!n.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function gP(t,e,n,r){if(e===null||typeof e>"u"||mP(t,e,n,r))return!0;if(r)return!1;if(n!==null)switch(n.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wa(t,e,n,r,s,c,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=t,this.type=e,this.sanitizeURL=c,this.removeEmptyString=h}var ji={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){ji[t]=new wa(t,0,!1,t,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var e=t[0];ji[e]=new wa(e,1,!1,t[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(t){ji[t]=new wa(t,2,!1,t.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){ji[t]=new wa(t,2,!1,t,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){ji[t]=new wa(t,3,!1,t.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(t){ji[t]=new wa(t,3,!0,t,null,!1,!1)});["capture","download"].forEach(function(t){ji[t]=new wa(t,4,!1,t,null,!1,!1)});["cols","rows","size","span"].forEach(function(t){ji[t]=new wa(t,6,!1,t,null,!1,!1)});["rowSpan","start"].forEach(function(t){ji[t]=new wa(t,5,!1,t.toLowerCase(),null,!1,!1)});var H2=/[\-:]([a-z])/g;function G2(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var e=t.replace(H2,G2);ji[e]=new wa(e,1,!1,t,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var e=t.replace(H2,G2);ji[e]=new wa(e,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(t){var e=t.replace(H2,G2);ji[e]=new wa(e,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(t){ji[t]=new wa(t,1,!1,t.toLowerCase(),null,!1,!1)});ji.xlinkHref=new wa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(t){ji[t]=new wa(t,1,!1,t.toLowerCase(),null,!0,!0)});function j2(t,e,n,r){var s=ji.hasOwnProperty(e)?ji[e]:null;(s!==null?s.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gP(e,n,s,r)&&(n=null),r||s===null?pP(e)&&(n===null?t.removeAttribute(e):t.setAttribute(e,""+n)):s.mustUseProperty?t[s.propertyName]=n===null?s.type===3?!1:"":n:(e=s.attributeName,r=s.attributeNamespace,n===null?t.removeAttribute(e):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,r?t.setAttributeNS(r,e,n):t.setAttribute(e,n))))}var _l=xT.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Xm=Symbol.for("react.element"),ed=Symbol.for("react.portal"),td=Symbol.for("react.fragment"),W2=Symbol.for("react.strict_mode"),mx=Symbol.for("react.profiler"),wT=Symbol.for("react.provider"),ST=Symbol.for("react.context"),q2=Symbol.for("react.forward_ref"),gx=Symbol.for("react.suspense"),vx=Symbol.for("react.suspense_list"),$2=Symbol.for("react.memo"),rc=Symbol.for("react.lazy"),MT=Symbol.for("react.offscreen"),t3=Symbol.iterator;function o0(t){return t===null||typeof t!="object"?null:(t=t3&&t[t3]||t["@@iterator"],typeof t=="function"?t:null)}var Xr=Object.assign,Gy;function E0(t){if(Gy===void 0)try{throw Error()}catch(n){var e=n.stack.trim().match(/\n( *(at )?)/);Gy=e&&e[1]||""}return`
`+Gy+t}var jy=!1;function Wy(t,e){if(!t||jy)return"";jy=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(_){var r=_}Reflect.construct(t,[],e)}else{try{e.call()}catch(_){r=_}t.call(e.prototype)}else{try{throw Error()}catch(_){r=_}t()}}catch(_){if(_&&r&&typeof _.stack=="string"){for(var s=_.stack.split(`
`),c=r.stack.split(`
`),h=s.length-1,l=c.length-1;1<=h&&0<=l&&s[h]!==c[l];)l--;for(;1<=h&&0<=l;h--,l--)if(s[h]!==c[l]){if(h!==1||l!==1)do if(h--,l--,0>l||s[h]!==c[l]){var m=`
`+s[h].replace(" at new "," at ");return t.displayName&&m.includes("<anonymous>")&&(m=m.replace("<anonymous>",t.displayName)),m}while(1<=h&&0<=l);break}}}finally{jy=!1,Error.prepareStackTrace=n}return(t=t?t.displayName||t.name:"")?E0(t):""}function vP(t){switch(t.tag){case 5:return E0(t.type);case 16:return E0("Lazy");case 13:return E0("Suspense");case 19:return E0("SuspenseList");case 0:case 2:case 15:return t=Wy(t.type,!1),t;case 11:return t=Wy(t.type.render,!1),t;case 1:return t=Wy(t.type,!0),t;default:return""}}function yx(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case td:return"Fragment";case ed:return"Portal";case mx:return"Profiler";case W2:return"StrictMode";case gx:return"Suspense";case vx:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case ST:return(t.displayName||"Context")+".Consumer";case wT:return(t._context.displayName||"Context")+".Provider";case q2:var e=t.render;return t=t.displayName,t||(t=e.displayName||e.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case $2:return e=t.displayName||null,e!==null?e:yx(t.type)||"Memo";case rc:e=t._payload,t=t._init;try{return yx(t(e))}catch{}}return null}function yP(t){var e=t.type;switch(t.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=e.render,t=t.displayName||t.name||"",e.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return yx(e);case 8:return e===W2?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Sc(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function TT(t){var e=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _P(t){var e=TT(t)?"checked":"value",n=Object.getOwnPropertyDescriptor(t.constructor.prototype,e),r=""+t[e];if(!t.hasOwnProperty(e)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,c=n.set;return Object.defineProperty(t,e,{configurable:!0,get:function(){return s.call(this)},set:function(h){r=""+h,c.call(this,h)}}),Object.defineProperty(t,e,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(h){r=""+h},stopTracking:function(){t._valueTracker=null,delete t[e]}}}}function Zm(t){t._valueTracker||(t._valueTracker=_P(t))}function ET(t){if(!t)return!1;var e=t._valueTracker;if(!e)return!0;var n=e.getValue(),r="";return t&&(r=TT(t)?t.checked?"true":"false":t.value),t=r,t!==n?(e.setValue(t),!0):!1}function h1(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function _x(t,e){var n=e.checked;return Xr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??t._wrapperState.initialChecked})}function n3(t,e){var n=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;n=Sc(e.value!=null?e.value:n),t._wrapperState={initialChecked:r,initialValue:n,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function AT(t,e){e=e.checked,e!=null&&j2(t,"checked",e,!1)}function xx(t,e){AT(t,e);var n=Sc(e.value),r=e.type;if(n!=null)r==="number"?(n===0&&t.value===""||t.value!=n)&&(t.value=""+n):t.value!==""+n&&(t.value=""+n);else if(r==="submit"||r==="reset"){t.removeAttribute("value");return}e.hasOwnProperty("value")?bx(t,e.type,n):e.hasOwnProperty("defaultValue")&&bx(t,e.type,Sc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(t.defaultChecked=!!e.defaultChecked)}function r3(t,e,n){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+t._wrapperState.initialValue,n||e===t.value||(t.value=e),t.defaultValue=e}n=t.name,n!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,n!==""&&(t.name=n)}function bx(t,e,n){(e!=="number"||h1(t.ownerDocument)!==t)&&(n==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+n&&(t.defaultValue=""+n))}var A0=Array.isArray;function vd(t,e,n,r){if(t=t.options,e){e={};for(var s=0;s<n.length;s++)e["$"+n[s]]=!0;for(n=0;n<t.length;n++)s=e.hasOwnProperty("$"+t[n].value),t[n].selected!==s&&(t[n].selected=s),s&&r&&(t[n].defaultSelected=!0)}else{for(n=""+Sc(n),e=null,s=0;s<t.length;s++){if(t[s].value===n){t[s].selected=!0,r&&(t[s].defaultSelected=!0);return}e!==null||t[s].disabled||(e=t[s])}e!==null&&(e.selected=!0)}}function wx(t,e){if(e.dangerouslySetInnerHTML!=null)throw Error(zt(91));return Xr({},e,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function i3(t,e){var n=e.value;if(n==null){if(n=e.children,e=e.defaultValue,n!=null){if(e!=null)throw Error(zt(92));if(A0(n)){if(1<n.length)throw Error(zt(93));n=n[0]}e=n}e==null&&(e=""),n=e}t._wrapperState={initialValue:Sc(n)}}function CT(t,e){var n=Sc(e.value),r=Sc(e.defaultValue);n!=null&&(n=""+n,n!==t.value&&(t.value=n),e.defaultValue==null&&t.defaultValue!==n&&(t.defaultValue=n)),r!=null&&(t.defaultValue=""+r)}function a3(t){var e=t.textContent;e===t._wrapperState.initialValue&&e!==""&&e!==null&&(t.value=e)}function PT(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Sx(t,e){return t==null||t==="http://www.w3.org/1999/xhtml"?PT(e):t==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Ym,RT=function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,n,r,s){MSApp.execUnsafeLocalFunction(function(){return t(e,n,r,s)})}:t}(function(t,e){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=e;else{for(Ym=Ym||document.createElement("div"),Ym.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Ym.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;e.firstChild;)t.appendChild(e.firstChild)}});function K0(t,e){if(e){var n=t.firstChild;if(n&&n===t.lastChild&&n.nodeType===3){n.nodeValue=e;return}}t.textContent=e}var z0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xP=["Webkit","ms","Moz","O"];Object.keys(z0).forEach(function(t){xP.forEach(function(e){e=e+t.charAt(0).toUpperCase()+t.substring(1),z0[e]=z0[t]})});function IT(t,e,n){return e==null||typeof e=="boolean"||e===""?"":n||typeof e!="number"||e===0||z0.hasOwnProperty(t)&&z0[t]?(""+e).trim():e+"px"}function DT(t,e){t=t.style;for(var n in e)if(e.hasOwnProperty(n)){var r=n.indexOf("--")===0,s=IT(n,e[n],r);n==="float"&&(n="cssFloat"),r?t.setProperty(n,s):t[n]=s}}var bP=Xr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Mx(t,e){if(e){if(bP[t]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(zt(137,t));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(zt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(zt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(zt(62))}}function Tx(t,e){if(t.indexOf("-")===-1)return typeof e.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ex=null;function X2(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Ax=null,yd=null,_d=null;function s3(t){if(t=Pp(t)){if(typeof Ax!="function")throw Error(zt(280));var e=t.stateNode;e&&(e=cv(e),Ax(t.stateNode,t.type,e))}}function kT(t){yd?_d?_d.push(t):_d=[t]:yd=t}function LT(){if(yd){var t=yd,e=_d;if(_d=yd=null,s3(t),e)for(t=0;t<e.length;t++)s3(e[t])}}function zT(t,e){return t(e)}function FT(){}var qy=!1;function NT(t,e,n){if(qy)return t(e,n);qy=!0;try{return zT(t,e,n)}finally{qy=!1,(yd!==null||_d!==null)&&(FT(),LT())}}function J0(t,e){var n=t.stateNode;if(n===null)return null;var r=cv(n);if(r===null)return null;n=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(t=t.type,r=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!r;break e;default:t=!1}if(t)return null;if(n&&typeof n!="function")throw Error(zt(231,e,typeof n));return n}var Cx=!1;if(cl)try{var l0={};Object.defineProperty(l0,"passive",{get:function(){Cx=!0}}),window.addEventListener("test",l0,l0),window.removeEventListener("test",l0,l0)}catch{Cx=!1}function wP(t,e,n,r,s,c,h,l,m){var _=Array.prototype.slice.call(arguments,3);try{e.apply(n,_)}catch(S){this.onError(S)}}var F0=!1,d1=null,f1=!1,Px=null,SP={onError:function(t){F0=!0,d1=t}};function MP(t,e,n,r,s,c,h,l,m){F0=!1,d1=null,wP.apply(SP,arguments)}function TP(t,e,n,r,s,c,h,l,m){if(MP.apply(this,arguments),F0){if(F0){var _=d1;F0=!1,d1=null}else throw Error(zt(198));f1||(f1=!0,Px=_)}}function Wu(t){var e=t,n=t;if(t.alternate)for(;e.return;)e=e.return;else{t=e;do e=t,e.flags&4098&&(n=e.return),t=e.return;while(t)}return e.tag===3?n:null}function BT(t){if(t.tag===13){var e=t.memoizedState;if(e===null&&(t=t.alternate,t!==null&&(e=t.memoizedState)),e!==null)return e.dehydrated}return null}function o3(t){if(Wu(t)!==t)throw Error(zt(188))}function EP(t){var e=t.alternate;if(!e){if(e=Wu(t),e===null)throw Error(zt(188));return e!==t?null:t}for(var n=t,r=e;;){var s=n.return;if(s===null)break;var c=s.alternate;if(c===null){if(r=s.return,r!==null){n=r;continue}break}if(s.child===c.child){for(c=s.child;c;){if(c===n)return o3(s),t;if(c===r)return o3(s),e;c=c.sibling}throw Error(zt(188))}if(n.return!==r.return)n=s,r=c;else{for(var h=!1,l=s.child;l;){if(l===n){h=!0,n=s,r=c;break}if(l===r){h=!0,r=s,n=c;break}l=l.sibling}if(!h){for(l=c.child;l;){if(l===n){h=!0,n=c,r=s;break}if(l===r){h=!0,r=c,n=s;break}l=l.sibling}if(!h)throw Error(zt(189))}}if(n.alternate!==r)throw Error(zt(190))}if(n.tag!==3)throw Error(zt(188));return n.stateNode.current===n?t:e}function OT(t){return t=EP(t),t!==null?UT(t):null}function UT(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var e=UT(t);if(e!==null)return e;t=t.sibling}return null}var VT=ts.unstable_scheduleCallback,l3=ts.unstable_cancelCallback,AP=ts.unstable_shouldYield,CP=ts.unstable_requestPaint,ci=ts.unstable_now,PP=ts.unstable_getCurrentPriorityLevel,Z2=ts.unstable_ImmediatePriority,HT=ts.unstable_UserBlockingPriority,p1=ts.unstable_NormalPriority,RP=ts.unstable_LowPriority,GT=ts.unstable_IdlePriority,av=null,yo=null;function IP(t){if(yo&&typeof yo.onCommitFiberRoot=="function")try{yo.onCommitFiberRoot(av,t,void 0,(t.current.flags&128)===128)}catch{}}var Zs=Math.clz32?Math.clz32:LP,DP=Math.log,kP=Math.LN2;function LP(t){return t>>>=0,t===0?32:31-(DP(t)/kP|0)|0}var Km=64,Jm=4194304;function C0(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function m1(t,e){var n=t.pendingLanes;if(n===0)return 0;var r=0,s=t.suspendedLanes,c=t.pingedLanes,h=n&268435455;if(h!==0){var l=h&~s;l!==0?r=C0(l):(c&=h,c!==0&&(r=C0(c)))}else h=n&~s,h!==0?r=C0(h):c!==0&&(r=C0(c));if(r===0)return 0;if(e!==0&&e!==r&&!(e&s)&&(s=r&-r,c=e&-e,s>=c||s===16&&(c&4194240)!==0))return e;if(r&4&&(r|=n&16),e=t.entangledLanes,e!==0)for(t=t.entanglements,e&=r;0<e;)n=31-Zs(e),s=1<<n,r|=t[n],e&=~s;return r}function zP(t,e){switch(t){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FP(t,e){for(var n=t.suspendedLanes,r=t.pingedLanes,s=t.expirationTimes,c=t.pendingLanes;0<c;){var h=31-Zs(c),l=1<<h,m=s[h];m===-1?(!(l&n)||l&r)&&(s[h]=zP(l,e)):m<=e&&(t.expiredLanes|=l),c&=~l}}function Rx(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function jT(){var t=Km;return Km<<=1,!(Km&4194240)&&(Km=64),t}function $y(t){for(var e=[],n=0;31>n;n++)e.push(t);return e}function Ap(t,e,n){t.pendingLanes|=e,e!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,e=31-Zs(e),t[e]=n}function NP(t,e){var n=t.pendingLanes&~e;t.pendingLanes=e,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=e,t.mutableReadLanes&=e,t.entangledLanes&=e,e=t.entanglements;var r=t.eventTimes;for(t=t.expirationTimes;0<n;){var s=31-Zs(n),c=1<<s;e[s]=0,r[s]=-1,t[s]=-1,n&=~c}}function Y2(t,e){var n=t.entangledLanes|=e;for(t=t.entanglements;n;){var r=31-Zs(n),s=1<<r;s&e|t[r]&e&&(t[r]|=e),n&=~s}}var vr=0;function WT(t){return t&=-t,1<t?4<t?t&268435455?16:536870912:4:1}var qT,K2,$T,XT,ZT,Ix=!1,Qm=[],fc=null,pc=null,mc=null,Q0=new Map,ep=new Map,sc=[],BP="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function c3(t,e){switch(t){case"focusin":case"focusout":fc=null;break;case"dragenter":case"dragleave":pc=null;break;case"mouseover":case"mouseout":mc=null;break;case"pointerover":case"pointerout":Q0.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":ep.delete(e.pointerId)}}function c0(t,e,n,r,s,c){return t===null||t.nativeEvent!==c?(t={blockedOn:e,domEventName:n,eventSystemFlags:r,nativeEvent:c,targetContainers:[s]},e!==null&&(e=Pp(e),e!==null&&K2(e)),t):(t.eventSystemFlags|=r,e=t.targetContainers,s!==null&&e.indexOf(s)===-1&&e.push(s),t)}function OP(t,e,n,r,s){switch(e){case"focusin":return fc=c0(fc,t,e,n,r,s),!0;case"dragenter":return pc=c0(pc,t,e,n,r,s),!0;case"mouseover":return mc=c0(mc,t,e,n,r,s),!0;case"pointerover":var c=s.pointerId;return Q0.set(c,c0(Q0.get(c)||null,t,e,n,r,s)),!0;case"gotpointercapture":return c=s.pointerId,ep.set(c,c0(ep.get(c)||null,t,e,n,r,s)),!0}return!1}function YT(t){var e=bu(t.target);if(e!==null){var n=Wu(e);if(n!==null){if(e=n.tag,e===13){if(e=BT(n),e!==null){t.blockedOn=e,ZT(t.priority,function(){$T(n)});return}}else if(e===3&&n.stateNode.current.memoizedState.isDehydrated){t.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Xg(t){if(t.blockedOn!==null)return!1;for(var e=t.targetContainers;0<e.length;){var n=Dx(t.domEventName,t.eventSystemFlags,e[0],t.nativeEvent);if(n===null){n=t.nativeEvent;var r=new n.constructor(n.type,n);Ex=r,n.target.dispatchEvent(r),Ex=null}else return e=Pp(n),e!==null&&K2(e),t.blockedOn=n,!1;e.shift()}return!0}function u3(t,e,n){Xg(t)&&n.delete(e)}function UP(){Ix=!1,fc!==null&&Xg(fc)&&(fc=null),pc!==null&&Xg(pc)&&(pc=null),mc!==null&&Xg(mc)&&(mc=null),Q0.forEach(u3),ep.forEach(u3)}function u0(t,e){t.blockedOn===e&&(t.blockedOn=null,Ix||(Ix=!0,ts.unstable_scheduleCallback(ts.unstable_NormalPriority,UP)))}function tp(t){function e(s){return u0(s,t)}if(0<Qm.length){u0(Qm[0],t);for(var n=1;n<Qm.length;n++){var r=Qm[n];r.blockedOn===t&&(r.blockedOn=null)}}for(fc!==null&&u0(fc,t),pc!==null&&u0(pc,t),mc!==null&&u0(mc,t),Q0.forEach(e),ep.forEach(e),n=0;n<sc.length;n++)r=sc[n],r.blockedOn===t&&(r.blockedOn=null);for(;0<sc.length&&(n=sc[0],n.blockedOn===null);)YT(n),n.blockedOn===null&&sc.shift()}var xd=_l.ReactCurrentBatchConfig,g1=!0;function VP(t,e,n,r){var s=vr,c=xd.transition;xd.transition=null;try{vr=1,J2(t,e,n,r)}finally{vr=s,xd.transition=c}}function HP(t,e,n,r){var s=vr,c=xd.transition;xd.transition=null;try{vr=4,J2(t,e,n,r)}finally{vr=s,xd.transition=c}}function J2(t,e,n,r){if(g1){var s=Dx(t,e,n,r);if(s===null)r_(t,e,r,v1,n),c3(t,r);else if(OP(s,t,e,n,r))r.stopPropagation();else if(c3(t,r),e&4&&-1<BP.indexOf(t)){for(;s!==null;){var c=Pp(s);if(c!==null&&qT(c),c=Dx(t,e,n,r),c===null&&r_(t,e,r,v1,n),c===s)break;s=c}s!==null&&r.stopPropagation()}else r_(t,e,r,null,n)}}var v1=null;function Dx(t,e,n,r){if(v1=null,t=X2(r),t=bu(t),t!==null)if(e=Wu(t),e===null)t=null;else if(n=e.tag,n===13){if(t=BT(e),t!==null)return t;t=null}else if(n===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;t=null}else e!==t&&(t=null);return v1=t,null}function KT(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PP()){case Z2:return 1;case HT:return 4;case p1:case RP:return 16;case GT:return 536870912;default:return 16}default:return 16}}var cc=null,Q2=null,Zg=null;function JT(){if(Zg)return Zg;var t,e=Q2,n=e.length,r,s="value"in cc?cc.value:cc.textContent,c=s.length;for(t=0;t<n&&e[t]===s[t];t++);var h=n-t;for(r=1;r<=h&&e[n-r]===s[c-r];r++);return Zg=s.slice(t,1<r?1-r:void 0)}function Yg(t){var e=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&e===13&&(t=13)):t=e,t===10&&(t=13),32<=t||t===13?t:0}function eg(){return!0}function h3(){return!1}function is(t){function e(n,r,s,c,h){this._reactName=n,this._targetInst=s,this.type=r,this.nativeEvent=c,this.target=h,this.currentTarget=null;for(var l in t)t.hasOwnProperty(l)&&(n=t[l],this[l]=n?n(c):c[l]);return this.isDefaultPrevented=(c.defaultPrevented!=null?c.defaultPrevented:c.returnValue===!1)?eg:h3,this.isPropagationStopped=h3,this}return Xr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=eg)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=eg)},persist:function(){},isPersistent:eg}),e}var Wd={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},eb=is(Wd),Cp=Xr({},Wd,{view:0,detail:0}),GP=is(Cp),Xy,Zy,h0,sv=Xr({},Cp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:tb,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==h0&&(h0&&t.type==="mousemove"?(Xy=t.screenX-h0.screenX,Zy=t.screenY-h0.screenY):Zy=Xy=0,h0=t),Xy)},movementY:function(t){return"movementY"in t?t.movementY:Zy}}),d3=is(sv),jP=Xr({},sv,{dataTransfer:0}),WP=is(jP),qP=Xr({},Cp,{relatedTarget:0}),Yy=is(qP),$P=Xr({},Wd,{animationName:0,elapsedTime:0,pseudoElement:0}),XP=is($P),ZP=Xr({},Wd,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),YP=is(ZP),KP=Xr({},Wd,{data:0}),f3=is(KP),JP={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QP={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},eR={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function tR(t){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(t):(t=eR[t])?!!e[t]:!1}function tb(){return tR}var nR=Xr({},Cp,{key:function(t){if(t.key){var e=JP[t.key]||t.key;if(e!=="Unidentified")return e}return t.type==="keypress"?(t=Yg(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?QP[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:tb,charCode:function(t){return t.type==="keypress"?Yg(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Yg(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),rR=is(nR),iR=Xr({},sv,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),p3=is(iR),aR=Xr({},Cp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:tb}),sR=is(aR),oR=Xr({},Wd,{propertyName:0,elapsedTime:0,pseudoElement:0}),lR=is(oR),cR=Xr({},sv,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),uR=is(cR),hR=[9,13,27,32],nb=cl&&"CompositionEvent"in window,N0=null;cl&&"documentMode"in document&&(N0=document.documentMode);var dR=cl&&"TextEvent"in window&&!N0,QT=cl&&(!nb||N0&&8<N0&&11>=N0),m3=" ",g3=!1;function e6(t,e){switch(t){case"keyup":return hR.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function t6(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var nd=!1;function fR(t,e){switch(t){case"compositionend":return t6(e);case"keypress":return e.which!==32?null:(g3=!0,m3);case"textInput":return t=e.data,t===m3&&g3?null:t;default:return null}}function pR(t,e){if(nd)return t==="compositionend"||!nb&&e6(t,e)?(t=JT(),Zg=Q2=cc=null,nd=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return QT&&e.locale!=="ko"?null:e.data;default:return null}}var mR={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function v3(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e==="input"?!!mR[t.type]:e==="textarea"}function n6(t,e,n,r){kT(r),e=y1(e,"onChange"),0<e.length&&(n=new eb("onChange","change",null,n,r),t.push({event:n,listeners:e}))}var B0=null,np=null;function gR(t){f6(t,0)}function ov(t){var e=ad(t);if(ET(e))return t}function vR(t,e){if(t==="change")return e}var r6=!1;if(cl){var Ky;if(cl){var Jy="oninput"in document;if(!Jy){var y3=document.createElement("div");y3.setAttribute("oninput","return;"),Jy=typeof y3.oninput=="function"}Ky=Jy}else Ky=!1;r6=Ky&&(!document.documentMode||9<document.documentMode)}function _3(){B0&&(B0.detachEvent("onpropertychange",i6),np=B0=null)}function i6(t){if(t.propertyName==="value"&&ov(np)){var e=[];n6(e,np,t,X2(t)),NT(gR,e)}}function yR(t,e,n){t==="focusin"?(_3(),B0=e,np=n,B0.attachEvent("onpropertychange",i6)):t==="focusout"&&_3()}function _R(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return ov(np)}function xR(t,e){if(t==="click")return ov(e)}function bR(t,e){if(t==="input"||t==="change")return ov(e)}function wR(t,e){return t===e&&(t!==0||1/t===1/e)||t!==t&&e!==e}var Ks=typeof Object.is=="function"?Object.is:wR;function rp(t,e){if(Ks(t,e))return!0;if(typeof t!="object"||t===null||typeof e!="object"||e===null)return!1;var n=Object.keys(t),r=Object.keys(e);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var s=n[r];if(!px.call(e,s)||!Ks(t[s],e[s]))return!1}return!0}function x3(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function b3(t,e){var n=x3(t);t=0;for(var r;n;){if(n.nodeType===3){if(r=t+n.textContent.length,t<=e&&r>=e)return{node:n,offset:e-t};t=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=x3(n)}}function a6(t,e){return t&&e?t===e?!0:t&&t.nodeType===3?!1:e&&e.nodeType===3?a6(t,e.parentNode):"contains"in t?t.contains(e):t.compareDocumentPosition?!!(t.compareDocumentPosition(e)&16):!1:!1}function s6(){for(var t=window,e=h1();e instanceof t.HTMLIFrameElement;){try{var n=typeof e.contentWindow.location.href=="string"}catch{n=!1}if(n)t=e.contentWindow;else break;e=h1(t.document)}return e}function rb(t){var e=t&&t.nodeName&&t.nodeName.toLowerCase();return e&&(e==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||e==="textarea"||t.contentEditable==="true")}function SR(t){var e=s6(),n=t.focusedElem,r=t.selectionRange;if(e!==n&&n&&n.ownerDocument&&a6(n.ownerDocument.documentElement,n)){if(r!==null&&rb(n)){if(e=r.start,t=r.end,t===void 0&&(t=e),"selectionStart"in n)n.selectionStart=e,n.selectionEnd=Math.min(t,n.value.length);else if(t=(e=n.ownerDocument||document)&&e.defaultView||window,t.getSelection){t=t.getSelection();var s=n.textContent.length,c=Math.min(r.start,s);r=r.end===void 0?c:Math.min(r.end,s),!t.extend&&c>r&&(s=r,r=c,c=s),s=b3(n,c);var h=b3(n,r);s&&h&&(t.rangeCount!==1||t.anchorNode!==s.node||t.anchorOffset!==s.offset||t.focusNode!==h.node||t.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(s.node,s.offset),t.removeAllRanges(),c>r?(t.addRange(e),t.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),t.addRange(e)))}}for(e=[],t=n;t=t.parentNode;)t.nodeType===1&&e.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<e.length;n++)t=e[n],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var MR=cl&&"documentMode"in document&&11>=document.documentMode,rd=null,kx=null,O0=null,Lx=!1;function w3(t,e,n){var r=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;Lx||rd==null||rd!==h1(r)||(r=rd,"selectionStart"in r&&rb(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),O0&&rp(O0,r)||(O0=r,r=y1(kx,"onSelect"),0<r.length&&(e=new eb("onSelect","select",null,e,n),t.push({event:e,listeners:r}),e.target=rd)))}function tg(t,e){var n={};return n[t.toLowerCase()]=e.toLowerCase(),n["Webkit"+t]="webkit"+e,n["Moz"+t]="moz"+e,n}var id={animationend:tg("Animation","AnimationEnd"),animationiteration:tg("Animation","AnimationIteration"),animationstart:tg("Animation","AnimationStart"),transitionend:tg("Transition","TransitionEnd")},Qy={},o6={};cl&&(o6=document.createElement("div").style,"AnimationEvent"in window||(delete id.animationend.animation,delete id.animationiteration.animation,delete id.animationstart.animation),"TransitionEvent"in window||delete id.transitionend.transition);function lv(t){if(Qy[t])return Qy[t];if(!id[t])return t;var e=id[t],n;for(n in e)if(e.hasOwnProperty(n)&&n in o6)return Qy[t]=e[n];return t}var l6=lv("animationend"),c6=lv("animationiteration"),u6=lv("animationstart"),h6=lv("transitionend"),d6=new Map,S3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rc(t,e){d6.set(t,e),ju(e,[t])}for(var e_=0;e_<S3.length;e_++){var t_=S3[e_],TR=t_.toLowerCase(),ER=t_[0].toUpperCase()+t_.slice(1);Rc(TR,"on"+ER)}Rc(l6,"onAnimationEnd");Rc(c6,"onAnimationIteration");Rc(u6,"onAnimationStart");Rc("dblclick","onDoubleClick");Rc("focusin","onFocus");Rc("focusout","onBlur");Rc(h6,"onTransitionEnd");Cd("onMouseEnter",["mouseout","mouseover"]);Cd("onMouseLeave",["mouseout","mouseover"]);Cd("onPointerEnter",["pointerout","pointerover"]);Cd("onPointerLeave",["pointerout","pointerover"]);ju("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ju("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ju("onBeforeInput",["compositionend","keypress","textInput","paste"]);ju("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ju("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ju("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var P0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),AR=new Set("cancel close invalid load scroll toggle".split(" ").concat(P0));function M3(t,e,n){var r=t.type||"unknown-event";t.currentTarget=n,TP(r,e,void 0,t),t.currentTarget=null}function f6(t,e){e=(e&4)!==0;for(var n=0;n<t.length;n++){var r=t[n],s=r.event;r=r.listeners;e:{var c=void 0;if(e)for(var h=r.length-1;0<=h;h--){var l=r[h],m=l.instance,_=l.currentTarget;if(l=l.listener,m!==c&&s.isPropagationStopped())break e;M3(s,l,_),c=m}else for(h=0;h<r.length;h++){if(l=r[h],m=l.instance,_=l.currentTarget,l=l.listener,m!==c&&s.isPropagationStopped())break e;M3(s,l,_),c=m}}}if(f1)throw t=Px,f1=!1,Px=null,t}function Lr(t,e){var n=e[Ox];n===void 0&&(n=e[Ox]=new Set);var r=t+"__bubble";n.has(r)||(p6(e,t,2,!1),n.add(r))}function n_(t,e,n){var r=0;e&&(r|=4),p6(n,t,r,e)}var ng="_reactListening"+Math.random().toString(36).slice(2);function ip(t){if(!t[ng]){t[ng]=!0,bT.forEach(function(n){n!=="selectionchange"&&(AR.has(n)||n_(n,!1,t),n_(n,!0,t))});var e=t.nodeType===9?t:t.ownerDocument;e===null||e[ng]||(e[ng]=!0,n_("selectionchange",!1,e))}}function p6(t,e,n,r){switch(KT(e)){case 1:var s=VP;break;case 4:s=HP;break;default:s=J2}n=s.bind(null,e,n,t),s=void 0,!Cx||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(s=!0),r?s!==void 0?t.addEventListener(e,n,{capture:!0,passive:s}):t.addEventListener(e,n,!0):s!==void 0?t.addEventListener(e,n,{passive:s}):t.addEventListener(e,n,!1)}function r_(t,e,n,r,s){var c=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var h=r.tag;if(h===3||h===4){var l=r.stateNode.containerInfo;if(l===s||l.nodeType===8&&l.parentNode===s)break;if(h===4)for(h=r.return;h!==null;){var m=h.tag;if((m===3||m===4)&&(m=h.stateNode.containerInfo,m===s||m.nodeType===8&&m.parentNode===s))return;h=h.return}for(;l!==null;){if(h=bu(l),h===null)return;if(m=h.tag,m===5||m===6){r=c=h;continue e}l=l.parentNode}}r=r.return}NT(function(){var _=c,S=X2(n),T=[];e:{var M=d6.get(t);if(M!==void 0){var I=eb,N=t;switch(t){case"keypress":if(Yg(n)===0)break e;case"keydown":case"keyup":I=rR;break;case"focusin":N="focus",I=Yy;break;case"focusout":N="blur",I=Yy;break;case"beforeblur":case"afterblur":I=Yy;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":I=d3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":I=WP;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":I=sR;break;case l6:case c6:case u6:I=XP;break;case h6:I=lR;break;case"scroll":I=GP;break;case"wheel":I=uR;break;case"copy":case"cut":case"paste":I=YP;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":I=p3}var B=(e&4)!==0,k=!B&&t==="scroll",C=B?M!==null?M+"Capture":null:M;B=[];for(var U=_,V;U!==null;){V=U;var Y=V.stateNode;if(V.tag===5&&Y!==null&&(V=Y,C!==null&&(Y=J0(U,C),Y!=null&&B.push(ap(U,Y,V)))),k)break;U=U.return}0<B.length&&(M=new I(M,N,null,n,S),T.push({event:M,listeners:B}))}}if(!(e&7)){e:{if(M=t==="mouseover"||t==="pointerover",I=t==="mouseout"||t==="pointerout",M&&n!==Ex&&(N=n.relatedTarget||n.fromElement)&&(bu(N)||N[ul]))break e;if((I||M)&&(M=S.window===S?S:(M=S.ownerDocument)?M.defaultView||M.parentWindow:window,I?(N=n.relatedTarget||n.toElement,I=_,N=N?bu(N):null,N!==null&&(k=Wu(N),N!==k||N.tag!==5&&N.tag!==6)&&(N=null)):(I=null,N=_),I!==N)){if(B=d3,Y="onMouseLeave",C="onMouseEnter",U="mouse",(t==="pointerout"||t==="pointerover")&&(B=p3,Y="onPointerLeave",C="onPointerEnter",U="pointer"),k=I==null?M:ad(I),V=N==null?M:ad(N),M=new B(Y,U+"leave",I,n,S),M.target=k,M.relatedTarget=V,Y=null,bu(S)===_&&(B=new B(C,U+"enter",N,n,S),B.target=V,B.relatedTarget=k,Y=B),k=Y,I&&N)t:{for(B=I,C=N,U=0,V=B;V;V=Ih(V))U++;for(V=0,Y=C;Y;Y=Ih(Y))V++;for(;0<U-V;)B=Ih(B),U--;for(;0<V-U;)C=Ih(C),V--;for(;U--;){if(B===C||C!==null&&B===C.alternate)break t;B=Ih(B),C=Ih(C)}B=null}else B=null;I!==null&&T3(T,M,I,B,!1),N!==null&&k!==null&&T3(T,k,N,B,!0)}}e:{if(M=_?ad(_):window,I=M.nodeName&&M.nodeName.toLowerCase(),I==="select"||I==="input"&&M.type==="file")var he=vR;else if(v3(M))if(r6)he=bR;else{he=_R;var Z=yR}else(I=M.nodeName)&&I.toLowerCase()==="input"&&(M.type==="checkbox"||M.type==="radio")&&(he=xR);if(he&&(he=he(t,_))){n6(T,he,n,S);break e}Z&&Z(t,M,_),t==="focusout"&&(Z=M._wrapperState)&&Z.controlled&&M.type==="number"&&bx(M,"number",M.value)}switch(Z=_?ad(_):window,t){case"focusin":(v3(Z)||Z.contentEditable==="true")&&(rd=Z,kx=_,O0=null);break;case"focusout":O0=kx=rd=null;break;case"mousedown":Lx=!0;break;case"contextmenu":case"mouseup":case"dragend":Lx=!1,w3(T,n,S);break;case"selectionchange":if(MR)break;case"keydown":case"keyup":w3(T,n,S)}var ne;if(nb)e:{switch(t){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else nd?e6(t,n)&&(xe="onCompositionEnd"):t==="keydown"&&n.keyCode===229&&(xe="onCompositionStart");xe&&(QT&&n.locale!=="ko"&&(nd||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&nd&&(ne=JT()):(cc=S,Q2="value"in cc?cc.value:cc.textContent,nd=!0)),Z=y1(_,xe),0<Z.length&&(xe=new f3(xe,t,null,n,S),T.push({event:xe,listeners:Z}),ne?xe.data=ne:(ne=t6(n),ne!==null&&(xe.data=ne)))),(ne=dR?fR(t,n):pR(t,n))&&(_=y1(_,"onBeforeInput"),0<_.length&&(S=new f3("onBeforeInput","beforeinput",null,n,S),T.push({event:S,listeners:_}),S.data=ne))}f6(T,e)})}function ap(t,e,n){return{instance:t,listener:e,currentTarget:n}}function y1(t,e){for(var n=e+"Capture",r=[];t!==null;){var s=t,c=s.stateNode;s.tag===5&&c!==null&&(s=c,c=J0(t,n),c!=null&&r.unshift(ap(t,c,s)),c=J0(t,e),c!=null&&r.push(ap(t,c,s))),t=t.return}return r}function Ih(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function T3(t,e,n,r,s){for(var c=e._reactName,h=[];n!==null&&n!==r;){var l=n,m=l.alternate,_=l.stateNode;if(m!==null&&m===r)break;l.tag===5&&_!==null&&(l=_,s?(m=J0(n,c),m!=null&&h.unshift(ap(n,m,l))):s||(m=J0(n,c),m!=null&&h.push(ap(n,m,l)))),n=n.return}h.length!==0&&t.push({event:e,listeners:h})}var CR=/\r\n?/g,PR=/\u0000|\uFFFD/g;function E3(t){return(typeof t=="string"?t:""+t).replace(CR,`
`).replace(PR,"")}function rg(t,e,n){if(e=E3(e),E3(t)!==e&&n)throw Error(zt(425))}function _1(){}var zx=null,Fx=null;function Nx(t,e){return t==="textarea"||t==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var Bx=typeof setTimeout=="function"?setTimeout:void 0,RR=typeof clearTimeout=="function"?clearTimeout:void 0,A3=typeof Promise=="function"?Promise:void 0,IR=typeof queueMicrotask=="function"?queueMicrotask:typeof A3<"u"?function(t){return A3.resolve(null).then(t).catch(DR)}:Bx;function DR(t){setTimeout(function(){throw t})}function i_(t,e){var n=e,r=0;do{var s=n.nextSibling;if(t.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(r===0){t.removeChild(s),tp(e);return}r--}else n!=="$"&&n!=="$?"&&n!=="$!"||r++;n=s}while(n);tp(e)}function gc(t){for(;t!=null;t=t.nextSibling){var e=t.nodeType;if(e===1||e===3)break;if(e===8){if(e=t.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return t}function C3(t){t=t.previousSibling;for(var e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="$"||n==="$!"||n==="$?"){if(e===0)return t;e--}else n==="/$"&&e++}t=t.previousSibling}return null}var qd=Math.random().toString(36).slice(2),uo="__reactFiber$"+qd,sp="__reactProps$"+qd,ul="__reactContainer$"+qd,Ox="__reactEvents$"+qd,kR="__reactListeners$"+qd,LR="__reactHandles$"+qd;function bu(t){var e=t[uo];if(e)return e;for(var n=t.parentNode;n;){if(e=n[ul]||n[uo]){if(n=e.alternate,e.child!==null||n!==null&&n.child!==null)for(t=C3(t);t!==null;){if(n=t[uo])return n;t=C3(t)}return e}t=n,n=t.parentNode}return null}function Pp(t){return t=t[uo]||t[ul],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function ad(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(zt(33))}function cv(t){return t[sp]||null}var Ux=[],sd=-1;function Ic(t){return{current:t}}function Fr(t){0>sd||(t.current=Ux[sd],Ux[sd]=null,sd--)}function Cr(t,e){sd++,Ux[sd]=t.current,t.current=e}var Mc={},sa=Ic(Mc),Da=Ic(!1),ku=Mc;function Pd(t,e){var n=t.type.contextTypes;if(!n)return Mc;var r=t.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var s={},c;for(c in n)s[c]=e[c];return r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=e,t.__reactInternalMemoizedMaskedChildContext=s),s}function ka(t){return t=t.childContextTypes,t!=null}function x1(){Fr(Da),Fr(sa)}function P3(t,e,n){if(sa.current!==Mc)throw Error(zt(168));Cr(sa,e),Cr(Da,n)}function m6(t,e,n){var r=t.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return n;r=r.getChildContext();for(var s in r)if(!(s in e))throw Error(zt(108,yP(t)||"Unknown",s));return Xr({},n,r)}function b1(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Mc,ku=sa.current,Cr(sa,t),Cr(Da,Da.current),!0}function R3(t,e,n){var r=t.stateNode;if(!r)throw Error(zt(169));n?(t=m6(t,e,ku),r.__reactInternalMemoizedMergedChildContext=t,Fr(Da),Fr(sa),Cr(sa,t)):Fr(Da),Cr(Da,n)}var el=null,uv=!1,a_=!1;function g6(t){el===null?el=[t]:el.push(t)}function zR(t){uv=!0,g6(t)}function Dc(){if(!a_&&el!==null){a_=!0;var t=0,e=vr;try{var n=el;for(vr=1;t<n.length;t++){var r=n[t];do r=r(!0);while(r!==null)}el=null,uv=!1}catch(s){throw el!==null&&(el=el.slice(t+1)),VT(Z2,Dc),s}finally{vr=e,a_=!1}}return null}var od=[],ld=0,w1=null,S1=0,ms=[],gs=0,Lu=null,nl=1,rl="";function mu(t,e){od[ld++]=S1,od[ld++]=w1,w1=t,S1=e}function v6(t,e,n){ms[gs++]=nl,ms[gs++]=rl,ms[gs++]=Lu,Lu=t;var r=nl;t=rl;var s=32-Zs(r)-1;r&=~(1<<s),n+=1;var c=32-Zs(e)+s;if(30<c){var h=s-s%5;c=(r&(1<<h)-1).toString(32),r>>=h,s-=h,nl=1<<32-Zs(e)+s|n<<s|r,rl=c+t}else nl=1<<c|n<<s|r,rl=t}function ib(t){t.return!==null&&(mu(t,1),v6(t,1,0))}function ab(t){for(;t===w1;)w1=od[--ld],od[ld]=null,S1=od[--ld],od[ld]=null;for(;t===Lu;)Lu=ms[--gs],ms[gs]=null,rl=ms[--gs],ms[gs]=null,nl=ms[--gs],ms[gs]=null}var Qa=null,Ka=null,Or=!1,Ws=null;function y6(t,e){var n=_s(5,null,null,0);n.elementType="DELETED",n.stateNode=e,n.return=t,e=t.deletions,e===null?(t.deletions=[n],t.flags|=16):e.push(n)}function I3(t,e){switch(t.tag){case 5:var n=t.type;return e=e.nodeType!==1||n.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(t.stateNode=e,Qa=t,Ka=gc(e.firstChild),!0):!1;case 6:return e=t.pendingProps===""||e.nodeType!==3?null:e,e!==null?(t.stateNode=e,Qa=t,Ka=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(n=Lu!==null?{id:nl,overflow:rl}:null,t.memoizedState={dehydrated:e,treeContext:n,retryLane:1073741824},n=_s(18,null,null,0),n.stateNode=e,n.return=t,t.child=n,Qa=t,Ka=null,!0):!1;default:return!1}}function Vx(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Hx(t){if(Or){var e=Ka;if(e){var n=e;if(!I3(t,e)){if(Vx(t))throw Error(zt(418));e=gc(n.nextSibling);var r=Qa;e&&I3(t,e)?y6(r,n):(t.flags=t.flags&-4097|2,Or=!1,Qa=t)}}else{if(Vx(t))throw Error(zt(418));t.flags=t.flags&-4097|2,Or=!1,Qa=t}}}function D3(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Qa=t}function ig(t){if(t!==Qa)return!1;if(!Or)return D3(t),Or=!0,!1;var e;if((e=t.tag!==3)&&!(e=t.tag!==5)&&(e=t.type,e=e!=="head"&&e!=="body"&&!Nx(t.type,t.memoizedProps)),e&&(e=Ka)){if(Vx(t))throw _6(),Error(zt(418));for(;e;)y6(t,e),e=gc(e.nextSibling)}if(D3(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(zt(317));e:{for(t=t.nextSibling,e=0;t;){if(t.nodeType===8){var n=t.data;if(n==="/$"){if(e===0){Ka=gc(t.nextSibling);break e}e--}else n!=="$"&&n!=="$!"&&n!=="$?"||e++}t=t.nextSibling}Ka=null}}else Ka=Qa?gc(t.stateNode.nextSibling):null;return!0}function _6(){for(var t=Ka;t;)t=gc(t.nextSibling)}function Rd(){Ka=Qa=null,Or=!1}function sb(t){Ws===null?Ws=[t]:Ws.push(t)}var FR=_l.ReactCurrentBatchConfig;function Vs(t,e){if(t&&t.defaultProps){e=Xr({},e),t=t.defaultProps;for(var n in t)e[n]===void 0&&(e[n]=t[n]);return e}return e}var M1=Ic(null),T1=null,cd=null,ob=null;function lb(){ob=cd=T1=null}function cb(t){var e=M1.current;Fr(M1),t._currentValue=e}function Gx(t,e,n){for(;t!==null;){var r=t.alternate;if((t.childLanes&e)!==e?(t.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),t===n)break;t=t.return}}function bd(t,e){T1=t,ob=cd=null,t=t.dependencies,t!==null&&t.firstContext!==null&&(t.lanes&e&&(Ra=!0),t.firstContext=null)}function Ts(t){var e=t._currentValue;if(ob!==t)if(t={context:t,memoizedValue:e,next:null},cd===null){if(T1===null)throw Error(zt(308));cd=t,T1.dependencies={lanes:0,firstContext:t}}else cd=cd.next=t;return e}var wu=null;function ub(t){wu===null?wu=[t]:wu.push(t)}function x6(t,e,n,r){var s=e.interleaved;return s===null?(n.next=n,ub(e)):(n.next=s.next,s.next=n),e.interleaved=n,hl(t,r)}function hl(t,e){t.lanes|=e;var n=t.alternate;for(n!==null&&(n.lanes|=e),n=t,t=t.return;t!==null;)t.childLanes|=e,n=t.alternate,n!==null&&(n.childLanes|=e),n=t,t=t.return;return n.tag===3?n.stateNode:null}var ic=!1;function hb(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function b6(t,e){t=t.updateQueue,e.updateQueue===t&&(e.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function al(t,e){return{eventTime:t,lane:e,tag:0,payload:null,callback:null,next:null}}function vc(t,e,n){var r=t.updateQueue;if(r===null)return null;if(r=r.shared,lr&2){var s=r.pending;return s===null?e.next=e:(e.next=s.next,s.next=e),r.pending=e,hl(t,n)}return s=r.interleaved,s===null?(e.next=e,ub(r)):(e.next=s.next,s.next=e),r.interleaved=e,hl(t,n)}function Kg(t,e,n){if(e=e.updateQueue,e!==null&&(e=e.shared,(n&4194240)!==0)){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Y2(t,n)}}function k3(t,e){var n=t.updateQueue,r=t.alternate;if(r!==null&&(r=r.updateQueue,n===r)){var s=null,c=null;if(n=n.firstBaseUpdate,n!==null){do{var h={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};c===null?s=c=h:c=c.next=h,n=n.next}while(n!==null);c===null?s=c=e:c=c.next=e}else s=c=e;n={baseState:r.baseState,firstBaseUpdate:s,lastBaseUpdate:c,shared:r.shared,effects:r.effects},t.updateQueue=n;return}t=n.lastBaseUpdate,t===null?n.firstBaseUpdate=e:t.next=e,n.lastBaseUpdate=e}function E1(t,e,n,r){var s=t.updateQueue;ic=!1;var c=s.firstBaseUpdate,h=s.lastBaseUpdate,l=s.shared.pending;if(l!==null){s.shared.pending=null;var m=l,_=m.next;m.next=null,h===null?c=_:h.next=_,h=m;var S=t.alternate;S!==null&&(S=S.updateQueue,l=S.lastBaseUpdate,l!==h&&(l===null?S.firstBaseUpdate=_:l.next=_,S.lastBaseUpdate=m))}if(c!==null){var T=s.baseState;h=0,S=_=m=null,l=c;do{var M=l.lane,I=l.eventTime;if((r&M)===M){S!==null&&(S=S.next={eventTime:I,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var N=t,B=l;switch(M=e,I=n,B.tag){case 1:if(N=B.payload,typeof N=="function"){T=N.call(I,T,M);break e}T=N;break e;case 3:N.flags=N.flags&-65537|128;case 0:if(N=B.payload,M=typeof N=="function"?N.call(I,T,M):N,M==null)break e;T=Xr({},T,M);break e;case 2:ic=!0}}l.callback!==null&&l.lane!==0&&(t.flags|=64,M=s.effects,M===null?s.effects=[l]:M.push(l))}else I={eventTime:I,lane:M,tag:l.tag,payload:l.payload,callback:l.callback,next:null},S===null?(_=S=I,m=T):S=S.next=I,h|=M;if(l=l.next,l===null){if(l=s.shared.pending,l===null)break;M=l,l=M.next,M.next=null,s.lastBaseUpdate=M,s.shared.pending=null}}while(!0);if(S===null&&(m=T),s.baseState=m,s.firstBaseUpdate=_,s.lastBaseUpdate=S,e=s.shared.interleaved,e!==null){s=e;do h|=s.lane,s=s.next;while(s!==e)}else c===null&&(s.shared.lanes=0);Fu|=h,t.lanes=h,t.memoizedState=T}}function L3(t,e,n){if(t=e.effects,e.effects=null,t!==null)for(e=0;e<t.length;e++){var r=t[e],s=r.callback;if(s!==null){if(r.callback=null,r=n,typeof s!="function")throw Error(zt(191,s));s.call(r)}}}var w6=new xT.Component().refs;function jx(t,e,n,r){e=t.memoizedState,n=n(r,e),n=n==null?e:Xr({},e,n),t.memoizedState=n,t.lanes===0&&(t.updateQueue.baseState=n)}var hv={isMounted:function(t){return(t=t._reactInternals)?Wu(t)===t:!1},enqueueSetState:function(t,e,n){t=t._reactInternals;var r=_a(),s=_c(t),c=al(r,s);c.payload=e,n!=null&&(c.callback=n),e=vc(t,c,s),e!==null&&(Ys(e,t,s,r),Kg(e,t,s))},enqueueReplaceState:function(t,e,n){t=t._reactInternals;var r=_a(),s=_c(t),c=al(r,s);c.tag=1,c.payload=e,n!=null&&(c.callback=n),e=vc(t,c,s),e!==null&&(Ys(e,t,s,r),Kg(e,t,s))},enqueueForceUpdate:function(t,e){t=t._reactInternals;var n=_a(),r=_c(t),s=al(n,r);s.tag=2,e!=null&&(s.callback=e),e=vc(t,s,r),e!==null&&(Ys(e,t,r,n),Kg(e,t,r))}};function z3(t,e,n,r,s,c,h){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(r,c,h):e.prototype&&e.prototype.isPureReactComponent?!rp(n,r)||!rp(s,c):!0}function S6(t,e,n){var r=!1,s=Mc,c=e.contextType;return typeof c=="object"&&c!==null?c=Ts(c):(s=ka(e)?ku:sa.current,r=e.contextTypes,c=(r=r!=null)?Pd(t,s):Mc),e=new e(n,c),t.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=hv,t.stateNode=e,e._reactInternals=t,r&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=s,t.__reactInternalMemoizedMaskedChildContext=c),e}function F3(t,e,n,r){t=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(n,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(n,r),e.state!==t&&hv.enqueueReplaceState(e,e.state,null)}function Wx(t,e,n,r){var s=t.stateNode;s.props=n,s.state=t.memoizedState,s.refs=w6,hb(t);var c=e.contextType;typeof c=="object"&&c!==null?s.context=Ts(c):(c=ka(e)?ku:sa.current,s.context=Pd(t,c)),s.state=t.memoizedState,c=e.getDerivedStateFromProps,typeof c=="function"&&(jx(t,e,c,n),s.state=t.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(e=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),e!==s.state&&hv.enqueueReplaceState(s,s.state,null),E1(t,n,s,r),s.state=t.memoizedState),typeof s.componentDidMount=="function"&&(t.flags|=4194308)}function d0(t,e,n){if(t=n.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(zt(309));var r=n.stateNode}if(!r)throw Error(zt(147,t));var s=r,c=""+t;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===c?e.ref:(e=function(h){var l=s.refs;l===w6&&(l=s.refs={}),h===null?delete l[c]:l[c]=h},e._stringRef=c,e)}if(typeof t!="string")throw Error(zt(284));if(!n._owner)throw Error(zt(290,t))}return t}function ag(t,e){throw t=Object.prototype.toString.call(e),Error(zt(31,t==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":t))}function N3(t){var e=t._init;return e(t._payload)}function M6(t){function e(C,U){if(t){var V=C.deletions;V===null?(C.deletions=[U],C.flags|=16):V.push(U)}}function n(C,U){if(!t)return null;for(;U!==null;)e(C,U),U=U.sibling;return null}function r(C,U){for(C=new Map;U!==null;)U.key!==null?C.set(U.key,U):C.set(U.index,U),U=U.sibling;return C}function s(C,U){return C=xc(C,U),C.index=0,C.sibling=null,C}function c(C,U,V){return C.index=V,t?(V=C.alternate,V!==null?(V=V.index,V<U?(C.flags|=2,U):V):(C.flags|=2,U)):(C.flags|=1048576,U)}function h(C){return t&&C.alternate===null&&(C.flags|=2),C}function l(C,U,V,Y){return U===null||U.tag!==6?(U=d_(V,C.mode,Y),U.return=C,U):(U=s(U,V),U.return=C,U)}function m(C,U,V,Y){var he=V.type;return he===td?S(C,U,V.props.children,Y,V.key):U!==null&&(U.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===rc&&N3(he)===U.type)?(Y=s(U,V.props),Y.ref=d0(C,U,V),Y.return=C,Y):(Y=r1(V.type,V.key,V.props,null,C.mode,Y),Y.ref=d0(C,U,V),Y.return=C,Y)}function _(C,U,V,Y){return U===null||U.tag!==4||U.stateNode.containerInfo!==V.containerInfo||U.stateNode.implementation!==V.implementation?(U=f_(V,C.mode,Y),U.return=C,U):(U=s(U,V.children||[]),U.return=C,U)}function S(C,U,V,Y,he){return U===null||U.tag!==7?(U=Iu(V,C.mode,Y,he),U.return=C,U):(U=s(U,V),U.return=C,U)}function T(C,U,V){if(typeof U=="string"&&U!==""||typeof U=="number")return U=d_(""+U,C.mode,V),U.return=C,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case Xm:return V=r1(U.type,U.key,U.props,null,C.mode,V),V.ref=d0(C,null,U),V.return=C,V;case ed:return U=f_(U,C.mode,V),U.return=C,U;case rc:var Y=U._init;return T(C,Y(U._payload),V)}if(A0(U)||o0(U))return U=Iu(U,C.mode,V,null),U.return=C,U;ag(C,U)}return null}function M(C,U,V,Y){var he=U!==null?U.key:null;if(typeof V=="string"&&V!==""||typeof V=="number")return he!==null?null:l(C,U,""+V,Y);if(typeof V=="object"&&V!==null){switch(V.$$typeof){case Xm:return V.key===he?m(C,U,V,Y):null;case ed:return V.key===he?_(C,U,V,Y):null;case rc:return he=V._init,M(C,U,he(V._payload),Y)}if(A0(V)||o0(V))return he!==null?null:S(C,U,V,Y,null);ag(C,V)}return null}function I(C,U,V,Y,he){if(typeof Y=="string"&&Y!==""||typeof Y=="number")return C=C.get(V)||null,l(U,C,""+Y,he);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case Xm:return C=C.get(Y.key===null?V:Y.key)||null,m(U,C,Y,he);case ed:return C=C.get(Y.key===null?V:Y.key)||null,_(U,C,Y,he);case rc:var Z=Y._init;return I(C,U,V,Z(Y._payload),he)}if(A0(Y)||o0(Y))return C=C.get(V)||null,S(U,C,Y,he,null);ag(U,Y)}return null}function N(C,U,V,Y){for(var he=null,Z=null,ne=U,xe=U=0,ie=null;ne!==null&&xe<V.length;xe++){ne.index>xe?(ie=ne,ne=null):ie=ne.sibling;var J=M(C,ne,V[xe],Y);if(J===null){ne===null&&(ne=ie);break}t&&ne&&J.alternate===null&&e(C,ne),U=c(J,U,xe),Z===null?he=J:Z.sibling=J,Z=J,ne=ie}if(xe===V.length)return n(C,ne),Or&&mu(C,xe),he;if(ne===null){for(;xe<V.length;xe++)ne=T(C,V[xe],Y),ne!==null&&(U=c(ne,U,xe),Z===null?he=ne:Z.sibling=ne,Z=ne);return Or&&mu(C,xe),he}for(ne=r(C,ne);xe<V.length;xe++)ie=I(ne,C,xe,V[xe],Y),ie!==null&&(t&&ie.alternate!==null&&ne.delete(ie.key===null?xe:ie.key),U=c(ie,U,xe),Z===null?he=ie:Z.sibling=ie,Z=ie);return t&&ne.forEach(function(Te){return e(C,Te)}),Or&&mu(C,xe),he}function B(C,U,V,Y){var he=o0(V);if(typeof he!="function")throw Error(zt(150));if(V=he.call(V),V==null)throw Error(zt(151));for(var Z=he=null,ne=U,xe=U=0,ie=null,J=V.next();ne!==null&&!J.done;xe++,J=V.next()){ne.index>xe?(ie=ne,ne=null):ie=ne.sibling;var Te=M(C,ne,J.value,Y);if(Te===null){ne===null&&(ne=ie);break}t&&ne&&Te.alternate===null&&e(C,ne),U=c(Te,U,xe),Z===null?he=Te:Z.sibling=Te,Z=Te,ne=ie}if(J.done)return n(C,ne),Or&&mu(C,xe),he;if(ne===null){for(;!J.done;xe++,J=V.next())J=T(C,J.value,Y),J!==null&&(U=c(J,U,xe),Z===null?he=J:Z.sibling=J,Z=J);return Or&&mu(C,xe),he}for(ne=r(C,ne);!J.done;xe++,J=V.next())J=I(ne,C,xe,J.value,Y),J!==null&&(t&&J.alternate!==null&&ne.delete(J.key===null?xe:J.key),U=c(J,U,xe),Z===null?he=J:Z.sibling=J,Z=J);return t&&ne.forEach(function(Be){return e(C,Be)}),Or&&mu(C,xe),he}function k(C,U,V,Y){if(typeof V=="object"&&V!==null&&V.type===td&&V.key===null&&(V=V.props.children),typeof V=="object"&&V!==null){switch(V.$$typeof){case Xm:e:{for(var he=V.key,Z=U;Z!==null;){if(Z.key===he){if(he=V.type,he===td){if(Z.tag===7){n(C,Z.sibling),U=s(Z,V.props.children),U.return=C,C=U;break e}}else if(Z.elementType===he||typeof he=="object"&&he!==null&&he.$$typeof===rc&&N3(he)===Z.type){n(C,Z.sibling),U=s(Z,V.props),U.ref=d0(C,Z,V),U.return=C,C=U;break e}n(C,Z);break}else e(C,Z);Z=Z.sibling}V.type===td?(U=Iu(V.props.children,C.mode,Y,V.key),U.return=C,C=U):(Y=r1(V.type,V.key,V.props,null,C.mode,Y),Y.ref=d0(C,U,V),Y.return=C,C=Y)}return h(C);case ed:e:{for(Z=V.key;U!==null;){if(U.key===Z)if(U.tag===4&&U.stateNode.containerInfo===V.containerInfo&&U.stateNode.implementation===V.implementation){n(C,U.sibling),U=s(U,V.children||[]),U.return=C,C=U;break e}else{n(C,U);break}else e(C,U);U=U.sibling}U=f_(V,C.mode,Y),U.return=C,C=U}return h(C);case rc:return Z=V._init,k(C,U,Z(V._payload),Y)}if(A0(V))return N(C,U,V,Y);if(o0(V))return B(C,U,V,Y);ag(C,V)}return typeof V=="string"&&V!==""||typeof V=="number"?(V=""+V,U!==null&&U.tag===6?(n(C,U.sibling),U=s(U,V),U.return=C,C=U):(n(C,U),U=d_(V,C.mode,Y),U.return=C,C=U),h(C)):n(C,U)}return k}var Id=M6(!0),T6=M6(!1),Rp={},_o=Ic(Rp),op=Ic(Rp),lp=Ic(Rp);function Su(t){if(t===Rp)throw Error(zt(174));return t}function db(t,e){switch(Cr(lp,e),Cr(op,t),Cr(_o,Rp),t=e.nodeType,t){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Sx(null,"");break;default:t=t===8?e.parentNode:e,e=t.namespaceURI||null,t=t.tagName,e=Sx(e,t)}Fr(_o),Cr(_o,e)}function Dd(){Fr(_o),Fr(op),Fr(lp)}function E6(t){Su(lp.current);var e=Su(_o.current),n=Sx(e,t.type);e!==n&&(Cr(op,t),Cr(_o,n))}function fb(t){op.current===t&&(Fr(_o),Fr(op))}var Wr=Ic(0);function A1(t){for(var e=t;e!==null;){if(e.tag===13){var n=e.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var s_=[];function pb(){for(var t=0;t<s_.length;t++)s_[t]._workInProgressVersionPrimary=null;s_.length=0}var Jg=_l.ReactCurrentDispatcher,o_=_l.ReactCurrentBatchConfig,zu=0,$r=null,_i=null,Di=null,C1=!1,U0=!1,cp=0,NR=0;function ea(){throw Error(zt(321))}function mb(t,e){if(e===null)return!1;for(var n=0;n<e.length&&n<t.length;n++)if(!Ks(t[n],e[n]))return!1;return!0}function gb(t,e,n,r,s,c){if(zu=c,$r=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,Jg.current=t===null||t.memoizedState===null?VR:HR,t=n(r,s),U0){c=0;do{if(U0=!1,cp=0,25<=c)throw Error(zt(301));c+=1,Di=_i=null,e.updateQueue=null,Jg.current=GR,t=n(r,s)}while(U0)}if(Jg.current=P1,e=_i!==null&&_i.next!==null,zu=0,Di=_i=$r=null,C1=!1,e)throw Error(zt(300));return t}function vb(){var t=cp!==0;return cp=0,t}function so(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Di===null?$r.memoizedState=Di=t:Di=Di.next=t,Di}function Es(){if(_i===null){var t=$r.alternate;t=t!==null?t.memoizedState:null}else t=_i.next;var e=Di===null?$r.memoizedState:Di.next;if(e!==null)Di=e,_i=t;else{if(t===null)throw Error(zt(310));_i=t,t={memoizedState:_i.memoizedState,baseState:_i.baseState,baseQueue:_i.baseQueue,queue:_i.queue,next:null},Di===null?$r.memoizedState=Di=t:Di=Di.next=t}return Di}function up(t,e){return typeof e=="function"?e(t):e}function l_(t){var e=Es(),n=e.queue;if(n===null)throw Error(zt(311));n.lastRenderedReducer=t;var r=_i,s=r.baseQueue,c=n.pending;if(c!==null){if(s!==null){var h=s.next;s.next=c.next,c.next=h}r.baseQueue=s=c,n.pending=null}if(s!==null){c=s.next,r=r.baseState;var l=h=null,m=null,_=c;do{var S=_.lane;if((zu&S)===S)m!==null&&(m=m.next={lane:0,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null}),r=_.hasEagerState?_.eagerState:t(r,_.action);else{var T={lane:S,action:_.action,hasEagerState:_.hasEagerState,eagerState:_.eagerState,next:null};m===null?(l=m=T,h=r):m=m.next=T,$r.lanes|=S,Fu|=S}_=_.next}while(_!==null&&_!==c);m===null?h=r:m.next=l,Ks(r,e.memoizedState)||(Ra=!0),e.memoizedState=r,e.baseState=h,e.baseQueue=m,n.lastRenderedState=r}if(t=n.interleaved,t!==null){s=t;do c=s.lane,$r.lanes|=c,Fu|=c,s=s.next;while(s!==t)}else s===null&&(n.lanes=0);return[e.memoizedState,n.dispatch]}function c_(t){var e=Es(),n=e.queue;if(n===null)throw Error(zt(311));n.lastRenderedReducer=t;var r=n.dispatch,s=n.pending,c=e.memoizedState;if(s!==null){n.pending=null;var h=s=s.next;do c=t(c,h.action),h=h.next;while(h!==s);Ks(c,e.memoizedState)||(Ra=!0),e.memoizedState=c,e.baseQueue===null&&(e.baseState=c),n.lastRenderedState=c}return[c,r]}function A6(){}function C6(t,e){var n=$r,r=Es(),s=e(),c=!Ks(r.memoizedState,s);if(c&&(r.memoizedState=s,Ra=!0),r=r.queue,yb(I6.bind(null,n,r,t),[t]),r.getSnapshot!==e||c||Di!==null&&Di.memoizedState.tag&1){if(n.flags|=2048,hp(9,R6.bind(null,n,r,s,e),void 0,null),Li===null)throw Error(zt(349));zu&30||P6(n,e,s)}return s}function P6(t,e,n){t.flags|=16384,t={getSnapshot:e,value:n},e=$r.updateQueue,e===null?(e={lastEffect:null,stores:null},$r.updateQueue=e,e.stores=[t]):(n=e.stores,n===null?e.stores=[t]:n.push(t))}function R6(t,e,n,r){e.value=n,e.getSnapshot=r,D6(e)&&k6(t)}function I6(t,e,n){return n(function(){D6(e)&&k6(t)})}function D6(t){var e=t.getSnapshot;t=t.value;try{var n=e();return!Ks(t,n)}catch{return!0}}function k6(t){var e=hl(t,1);e!==null&&Ys(e,t,1,-1)}function B3(t){var e=so();return typeof t=="function"&&(t=t()),e.memoizedState=e.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:up,lastRenderedState:t},e.queue=t,t=t.dispatch=UR.bind(null,$r,t),[e.memoizedState,t]}function hp(t,e,n,r){return t={tag:t,create:e,destroy:n,deps:r,next:null},e=$r.updateQueue,e===null?(e={lastEffect:null,stores:null},$r.updateQueue=e,e.lastEffect=t.next=t):(n=e.lastEffect,n===null?e.lastEffect=t.next=t:(r=n.next,n.next=t,t.next=r,e.lastEffect=t)),t}function L6(){return Es().memoizedState}function Qg(t,e,n,r){var s=so();$r.flags|=t,s.memoizedState=hp(1|e,n,void 0,r===void 0?null:r)}function dv(t,e,n,r){var s=Es();r=r===void 0?null:r;var c=void 0;if(_i!==null){var h=_i.memoizedState;if(c=h.destroy,r!==null&&mb(r,h.deps)){s.memoizedState=hp(e,n,c,r);return}}$r.flags|=t,s.memoizedState=hp(1|e,n,c,r)}function O3(t,e){return Qg(8390656,8,t,e)}function yb(t,e){return dv(2048,8,t,e)}function z6(t,e){return dv(4,2,t,e)}function F6(t,e){return dv(4,4,t,e)}function N6(t,e){if(typeof e=="function")return t=t(),e(t),function(){e(null)};if(e!=null)return t=t(),e.current=t,function(){e.current=null}}function B6(t,e,n){return n=n!=null?n.concat([t]):null,dv(4,4,N6.bind(null,e,t),n)}function _b(){}function O6(t,e){var n=Es();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mb(e,r[1])?r[0]:(n.memoizedState=[t,e],t)}function U6(t,e){var n=Es();e=e===void 0?null:e;var r=n.memoizedState;return r!==null&&e!==null&&mb(e,r[1])?r[0]:(t=t(),n.memoizedState=[t,e],t)}function V6(t,e,n){return zu&21?(Ks(n,e)||(n=jT(),$r.lanes|=n,Fu|=n,t.baseState=!0),e):(t.baseState&&(t.baseState=!1,Ra=!0),t.memoizedState=n)}function BR(t,e){var n=vr;vr=n!==0&&4>n?n:4,t(!0);var r=o_.transition;o_.transition={};try{t(!1),e()}finally{vr=n,o_.transition=r}}function H6(){return Es().memoizedState}function OR(t,e,n){var r=_c(t);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},G6(t))j6(e,n);else if(n=x6(t,e,n,r),n!==null){var s=_a();Ys(n,t,r,s),W6(n,e,r)}}function UR(t,e,n){var r=_c(t),s={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(G6(t))j6(e,s);else{var c=t.alternate;if(t.lanes===0&&(c===null||c.lanes===0)&&(c=e.lastRenderedReducer,c!==null))try{var h=e.lastRenderedState,l=c(h,n);if(s.hasEagerState=!0,s.eagerState=l,Ks(l,h)){var m=e.interleaved;m===null?(s.next=s,ub(e)):(s.next=m.next,m.next=s),e.interleaved=s;return}}catch{}finally{}n=x6(t,e,s,r),n!==null&&(s=_a(),Ys(n,t,r,s),W6(n,e,r))}}function G6(t){var e=t.alternate;return t===$r||e!==null&&e===$r}function j6(t,e){U0=C1=!0;var n=t.pending;n===null?e.next=e:(e.next=n.next,n.next=e),t.pending=e}function W6(t,e,n){if(n&4194240){var r=e.lanes;r&=t.pendingLanes,n|=r,e.lanes=n,Y2(t,n)}}var P1={readContext:Ts,useCallback:ea,useContext:ea,useEffect:ea,useImperativeHandle:ea,useInsertionEffect:ea,useLayoutEffect:ea,useMemo:ea,useReducer:ea,useRef:ea,useState:ea,useDebugValue:ea,useDeferredValue:ea,useTransition:ea,useMutableSource:ea,useSyncExternalStore:ea,useId:ea,unstable_isNewReconciler:!1},VR={readContext:Ts,useCallback:function(t,e){return so().memoizedState=[t,e===void 0?null:e],t},useContext:Ts,useEffect:O3,useImperativeHandle:function(t,e,n){return n=n!=null?n.concat([t]):null,Qg(4194308,4,N6.bind(null,e,t),n)},useLayoutEffect:function(t,e){return Qg(4194308,4,t,e)},useInsertionEffect:function(t,e){return Qg(4,2,t,e)},useMemo:function(t,e){var n=so();return e=e===void 0?null:e,t=t(),n.memoizedState=[t,e],t},useReducer:function(t,e,n){var r=so();return e=n!==void 0?n(e):e,r.memoizedState=r.baseState=e,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:e},r.queue=t,t=t.dispatch=OR.bind(null,$r,t),[r.memoizedState,t]},useRef:function(t){var e=so();return t={current:t},e.memoizedState=t},useState:B3,useDebugValue:_b,useDeferredValue:function(t){return so().memoizedState=t},useTransition:function(){var t=B3(!1),e=t[0];return t=BR.bind(null,t[1]),so().memoizedState=t,[e,t]},useMutableSource:function(){},useSyncExternalStore:function(t,e,n){var r=$r,s=so();if(Or){if(n===void 0)throw Error(zt(407));n=n()}else{if(n=e(),Li===null)throw Error(zt(349));zu&30||P6(r,e,n)}s.memoizedState=n;var c={value:n,getSnapshot:e};return s.queue=c,O3(I6.bind(null,r,c,t),[t]),r.flags|=2048,hp(9,R6.bind(null,r,c,n,e),void 0,null),n},useId:function(){var t=so(),e=Li.identifierPrefix;if(Or){var n=rl,r=nl;n=(r&~(1<<32-Zs(r)-1)).toString(32)+n,e=":"+e+"R"+n,n=cp++,0<n&&(e+="H"+n.toString(32)),e+=":"}else n=NR++,e=":"+e+"r"+n.toString(32)+":";return t.memoizedState=e},unstable_isNewReconciler:!1},HR={readContext:Ts,useCallback:O6,useContext:Ts,useEffect:yb,useImperativeHandle:B6,useInsertionEffect:z6,useLayoutEffect:F6,useMemo:U6,useReducer:l_,useRef:L6,useState:function(){return l_(up)},useDebugValue:_b,useDeferredValue:function(t){var e=Es();return V6(e,_i.memoizedState,t)},useTransition:function(){var t=l_(up)[0],e=Es().memoizedState;return[t,e]},useMutableSource:A6,useSyncExternalStore:C6,useId:H6,unstable_isNewReconciler:!1},GR={readContext:Ts,useCallback:O6,useContext:Ts,useEffect:yb,useImperativeHandle:B6,useInsertionEffect:z6,useLayoutEffect:F6,useMemo:U6,useReducer:c_,useRef:L6,useState:function(){return c_(up)},useDebugValue:_b,useDeferredValue:function(t){var e=Es();return _i===null?e.memoizedState=t:V6(e,_i.memoizedState,t)},useTransition:function(){var t=c_(up)[0],e=Es().memoizedState;return[t,e]},useMutableSource:A6,useSyncExternalStore:C6,useId:H6,unstable_isNewReconciler:!1};function kd(t,e){try{var n="",r=e;do n+=vP(r),r=r.return;while(r);var s=n}catch(c){s=`
Error generating stack: `+c.message+`
`+c.stack}return{value:t,source:e,stack:s,digest:null}}function u_(t,e,n){return{value:t,source:null,stack:n??null,digest:e??null}}function qx(t,e){try{console.error(e.value)}catch(n){setTimeout(function(){throw n})}}var jR=typeof WeakMap=="function"?WeakMap:Map;function q6(t,e,n){n=al(-1,n),n.tag=3,n.payload={element:null};var r=e.value;return n.callback=function(){I1||(I1=!0,n2=r),qx(t,e)},n}function $6(t,e,n){n=al(-1,n),n.tag=3;var r=t.type.getDerivedStateFromError;if(typeof r=="function"){var s=e.value;n.payload=function(){return r(s)},n.callback=function(){qx(t,e)}}var c=t.stateNode;return c!==null&&typeof c.componentDidCatch=="function"&&(n.callback=function(){qx(t,e),typeof r!="function"&&(yc===null?yc=new Set([this]):yc.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),n}function U3(t,e,n){var r=t.pingCache;if(r===null){r=t.pingCache=new jR;var s=new Set;r.set(e,s)}else s=r.get(e),s===void 0&&(s=new Set,r.set(e,s));s.has(n)||(s.add(n),t=i9.bind(null,t,e,n),e.then(t,t))}function V3(t){do{var e;if((e=t.tag===13)&&(e=t.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return t;t=t.return}while(t!==null);return null}function H3(t,e,n,r,s){return t.mode&1?(t.flags|=65536,t.lanes=s,t):(t===e?t.flags|=65536:(t.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(e=al(-1,1),e.tag=2,vc(n,e,1))),n.lanes|=1),t)}var WR=_l.ReactCurrentOwner,Ra=!1;function va(t,e,n,r){e.child=t===null?T6(e,null,n,r):Id(e,t.child,n,r)}function G3(t,e,n,r,s){n=n.render;var c=e.ref;return bd(e,s),r=gb(t,e,n,r,c,s),n=vb(),t!==null&&!Ra?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,dl(t,e,s)):(Or&&n&&ib(e),e.flags|=1,va(t,e,r,s),e.child)}function j3(t,e,n,r,s){if(t===null){var c=n.type;return typeof c=="function"&&!Ab(c)&&c.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(e.tag=15,e.type=c,X6(t,e,c,r,s)):(t=r1(n.type,null,r,e,e.mode,s),t.ref=e.ref,t.return=e,e.child=t)}if(c=t.child,!(t.lanes&s)){var h=c.memoizedProps;if(n=n.compare,n=n!==null?n:rp,n(h,r)&&t.ref===e.ref)return dl(t,e,s)}return e.flags|=1,t=xc(c,r),t.ref=e.ref,t.return=e,e.child=t}function X6(t,e,n,r,s){if(t!==null){var c=t.memoizedProps;if(rp(c,r)&&t.ref===e.ref)if(Ra=!1,e.pendingProps=r=c,(t.lanes&s)!==0)t.flags&131072&&(Ra=!0);else return e.lanes=t.lanes,dl(t,e,s)}return $x(t,e,n,r,s)}function Z6(t,e,n){var r=e.pendingProps,s=r.children,c=t!==null?t.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Cr(hd,Za),Za|=n;else{if(!(n&1073741824))return t=c!==null?c.baseLanes|n:n,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:t,cachePool:null,transitions:null},e.updateQueue=null,Cr(hd,Za),Za|=t,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=c!==null?c.baseLanes:n,Cr(hd,Za),Za|=r}else c!==null?(r=c.baseLanes|n,e.memoizedState=null):r=n,Cr(hd,Za),Za|=r;return va(t,e,s,n),e.child}function Y6(t,e){var n=e.ref;(t===null&&n!==null||t!==null&&t.ref!==n)&&(e.flags|=512,e.flags|=2097152)}function $x(t,e,n,r,s){var c=ka(n)?ku:sa.current;return c=Pd(e,c),bd(e,s),n=gb(t,e,n,r,c,s),r=vb(),t!==null&&!Ra?(e.updateQueue=t.updateQueue,e.flags&=-2053,t.lanes&=~s,dl(t,e,s)):(Or&&r&&ib(e),e.flags|=1,va(t,e,n,s),e.child)}function W3(t,e,n,r,s){if(ka(n)){var c=!0;b1(e)}else c=!1;if(bd(e,s),e.stateNode===null)e1(t,e),S6(e,n,r),Wx(e,n,r,s),r=!0;else if(t===null){var h=e.stateNode,l=e.memoizedProps;h.props=l;var m=h.context,_=n.contextType;typeof _=="object"&&_!==null?_=Ts(_):(_=ka(n)?ku:sa.current,_=Pd(e,_));var S=n.getDerivedStateFromProps,T=typeof S=="function"||typeof h.getSnapshotBeforeUpdate=="function";T||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==r||m!==_)&&F3(e,h,r,_),ic=!1;var M=e.memoizedState;h.state=M,E1(e,r,h,s),m=e.memoizedState,l!==r||M!==m||Da.current||ic?(typeof S=="function"&&(jx(e,n,S,r),m=e.memoizedState),(l=ic||z3(e,n,l,r,M,m,_))?(T||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=m),h.props=r,h.state=m,h.context=_,r=l):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{h=e.stateNode,b6(t,e),l=e.memoizedProps,_=e.type===e.elementType?l:Vs(e.type,l),h.props=_,T=e.pendingProps,M=h.context,m=n.contextType,typeof m=="object"&&m!==null?m=Ts(m):(m=ka(n)?ku:sa.current,m=Pd(e,m));var I=n.getDerivedStateFromProps;(S=typeof I=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(l!==T||M!==m)&&F3(e,h,r,m),ic=!1,M=e.memoizedState,h.state=M,E1(e,r,h,s);var N=e.memoizedState;l!==T||M!==N||Da.current||ic?(typeof I=="function"&&(jx(e,n,I,r),N=e.memoizedState),(_=ic||z3(e,n,_,r,M,N,m)||!1)?(S||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(r,N,m),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(r,N,m)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&M===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&M===t.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=N),h.props=r,h.state=N,h.context=m,r=_):(typeof h.componentDidUpdate!="function"||l===t.memoizedProps&&M===t.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||l===t.memoizedProps&&M===t.memoizedState||(e.flags|=1024),r=!1)}return Xx(t,e,n,r,c,s)}function Xx(t,e,n,r,s,c){Y6(t,e);var h=(e.flags&128)!==0;if(!r&&!h)return s&&R3(e,n,!1),dl(t,e,c);r=e.stateNode,WR.current=e;var l=h&&typeof n.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,t!==null&&h?(e.child=Id(e,t.child,null,c),e.child=Id(e,null,l,c)):va(t,e,l,c),e.memoizedState=r.state,s&&R3(e,n,!0),e.child}function K6(t){var e=t.stateNode;e.pendingContext?P3(t,e.pendingContext,e.pendingContext!==e.context):e.context&&P3(t,e.context,!1),db(t,e.containerInfo)}function q3(t,e,n,r,s){return Rd(),sb(s),e.flags|=256,va(t,e,n,r),e.child}var Zx={dehydrated:null,treeContext:null,retryLane:0};function Yx(t){return{baseLanes:t,cachePool:null,transitions:null}}function J6(t,e,n){var r=e.pendingProps,s=Wr.current,c=!1,h=(e.flags&128)!==0,l;if((l=h)||(l=t!==null&&t.memoizedState===null?!1:(s&2)!==0),l?(c=!0,e.flags&=-129):(t===null||t.memoizedState!==null)&&(s|=1),Cr(Wr,s&1),t===null)return Hx(e),t=e.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?(e.mode&1?t.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=r.children,t=r.fallback,c?(r=e.mode,c=e.child,h={mode:"hidden",children:h},!(r&1)&&c!==null?(c.childLanes=0,c.pendingProps=h):c=mv(h,r,0,null),t=Iu(t,r,n,null),c.return=e,t.return=e,c.sibling=t,e.child=c,e.child.memoizedState=Yx(n),e.memoizedState=Zx,t):xb(e,h));if(s=t.memoizedState,s!==null&&(l=s.dehydrated,l!==null))return qR(t,e,h,r,l,s,n);if(c){c=r.fallback,h=e.mode,s=t.child,l=s.sibling;var m={mode:"hidden",children:r.children};return!(h&1)&&e.child!==s?(r=e.child,r.childLanes=0,r.pendingProps=m,e.deletions=null):(r=xc(s,m),r.subtreeFlags=s.subtreeFlags&14680064),l!==null?c=xc(l,c):(c=Iu(c,h,n,null),c.flags|=2),c.return=e,r.return=e,r.sibling=c,e.child=r,r=c,c=e.child,h=t.child.memoizedState,h=h===null?Yx(n):{baseLanes:h.baseLanes|n,cachePool:null,transitions:h.transitions},c.memoizedState=h,c.childLanes=t.childLanes&~n,e.memoizedState=Zx,r}return c=t.child,t=c.sibling,r=xc(c,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=n),r.return=e,r.sibling=null,t!==null&&(n=e.deletions,n===null?(e.deletions=[t],e.flags|=16):n.push(t)),e.child=r,e.memoizedState=null,r}function xb(t,e){return e=mv({mode:"visible",children:e},t.mode,0,null),e.return=t,t.child=e}function sg(t,e,n,r){return r!==null&&sb(r),Id(e,t.child,null,n),t=xb(e,e.pendingProps.children),t.flags|=2,e.memoizedState=null,t}function qR(t,e,n,r,s,c,h){if(n)return e.flags&256?(e.flags&=-257,r=u_(Error(zt(422))),sg(t,e,h,r)):e.memoizedState!==null?(e.child=t.child,e.flags|=128,null):(c=r.fallback,s=e.mode,r=mv({mode:"visible",children:r.children},s,0,null),c=Iu(c,s,h,null),c.flags|=2,r.return=e,c.return=e,r.sibling=c,e.child=r,e.mode&1&&Id(e,t.child,null,h),e.child.memoizedState=Yx(h),e.memoizedState=Zx,c);if(!(e.mode&1))return sg(t,e,h,null);if(s.data==="$!"){if(r=s.nextSibling&&s.nextSibling.dataset,r)var l=r.dgst;return r=l,c=Error(zt(419)),r=u_(c,r,void 0),sg(t,e,h,r)}if(l=(h&t.childLanes)!==0,Ra||l){if(r=Li,r!==null){switch(h&-h){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=s&(r.suspendedLanes|h)?0:s,s!==0&&s!==c.retryLane&&(c.retryLane=s,hl(t,s),Ys(r,t,s,-1))}return Eb(),r=u_(Error(zt(421))),sg(t,e,h,r)}return s.data==="$?"?(e.flags|=128,e.child=t.child,e=a9.bind(null,t),s._reactRetry=e,null):(t=c.treeContext,Ka=gc(s.nextSibling),Qa=e,Or=!0,Ws=null,t!==null&&(ms[gs++]=nl,ms[gs++]=rl,ms[gs++]=Lu,nl=t.id,rl=t.overflow,Lu=e),e=xb(e,r.children),e.flags|=4096,e)}function $3(t,e,n){t.lanes|=e;var r=t.alternate;r!==null&&(r.lanes|=e),Gx(t.return,e,n)}function h_(t,e,n,r,s){var c=t.memoizedState;c===null?t.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:s}:(c.isBackwards=e,c.rendering=null,c.renderingStartTime=0,c.last=r,c.tail=n,c.tailMode=s)}function Q6(t,e,n){var r=e.pendingProps,s=r.revealOrder,c=r.tail;if(va(t,e,r.children,n),r=Wr.current,r&2)r=r&1|2,e.flags|=128;else{if(t!==null&&t.flags&128)e:for(t=e.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&$3(t,n,e);else if(t.tag===19)$3(t,n,e);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;t.sibling===null;){if(t.return===null||t.return===e)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}r&=1}if(Cr(Wr,r),!(e.mode&1))e.memoizedState=null;else switch(s){case"forwards":for(n=e.child,s=null;n!==null;)t=n.alternate,t!==null&&A1(t)===null&&(s=n),n=n.sibling;n=s,n===null?(s=e.child,e.child=null):(s=n.sibling,n.sibling=null),h_(e,!1,s,n,c);break;case"backwards":for(n=null,s=e.child,e.child=null;s!==null;){if(t=s.alternate,t!==null&&A1(t)===null){e.child=s;break}t=s.sibling,s.sibling=n,n=s,s=t}h_(e,!0,n,null,c);break;case"together":h_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function e1(t,e){!(e.mode&1)&&t!==null&&(t.alternate=null,e.alternate=null,e.flags|=2)}function dl(t,e,n){if(t!==null&&(e.dependencies=t.dependencies),Fu|=e.lanes,!(n&e.childLanes))return null;if(t!==null&&e.child!==t.child)throw Error(zt(153));if(e.child!==null){for(t=e.child,n=xc(t,t.pendingProps),e.child=n,n.return=e;t.sibling!==null;)t=t.sibling,n=n.sibling=xc(t,t.pendingProps),n.return=e;n.sibling=null}return e.child}function $R(t,e,n){switch(e.tag){case 3:K6(e),Rd();break;case 5:E6(e);break;case 1:ka(e.type)&&b1(e);break;case 4:db(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,s=e.memoizedProps.value;Cr(M1,r._currentValue),r._currentValue=s;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Cr(Wr,Wr.current&1),e.flags|=128,null):n&e.child.childLanes?J6(t,e,n):(Cr(Wr,Wr.current&1),t=dl(t,e,n),t!==null?t.sibling:null);Cr(Wr,Wr.current&1);break;case 19:if(r=(n&e.childLanes)!==0,t.flags&128){if(r)return Q6(t,e,n);e.flags|=128}if(s=e.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),Cr(Wr,Wr.current),r)break;return null;case 22:case 23:return e.lanes=0,Z6(t,e,n)}return dl(t,e,n)}var eE,Kx,tE,nE;eE=function(t,e){for(var n=e.child;n!==null;){if(n.tag===5||n.tag===6)t.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break;for(;n.sibling===null;){if(n.return===null||n.return===e)return;n=n.return}n.sibling.return=n.return,n=n.sibling}};Kx=function(){};tE=function(t,e,n,r){var s=t.memoizedProps;if(s!==r){t=e.stateNode,Su(_o.current);var c=null;switch(n){case"input":s=_x(t,s),r=_x(t,r),c=[];break;case"select":s=Xr({},s,{value:void 0}),r=Xr({},r,{value:void 0}),c=[];break;case"textarea":s=wx(t,s),r=wx(t,r),c=[];break;default:typeof s.onClick!="function"&&typeof r.onClick=="function"&&(t.onclick=_1)}Mx(n,r);var h;n=null;for(_ in s)if(!r.hasOwnProperty(_)&&s.hasOwnProperty(_)&&s[_]!=null)if(_==="style"){var l=s[_];for(h in l)l.hasOwnProperty(h)&&(n||(n={}),n[h]="")}else _!=="dangerouslySetInnerHTML"&&_!=="children"&&_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(Y0.hasOwnProperty(_)?c||(c=[]):(c=c||[]).push(_,null));for(_ in r){var m=r[_];if(l=s!=null?s[_]:void 0,r.hasOwnProperty(_)&&m!==l&&(m!=null||l!=null))if(_==="style")if(l){for(h in l)!l.hasOwnProperty(h)||m&&m.hasOwnProperty(h)||(n||(n={}),n[h]="");for(h in m)m.hasOwnProperty(h)&&l[h]!==m[h]&&(n||(n={}),n[h]=m[h])}else n||(c||(c=[]),c.push(_,n)),n=m;else _==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,l=l?l.__html:void 0,m!=null&&l!==m&&(c=c||[]).push(_,m)):_==="children"?typeof m!="string"&&typeof m!="number"||(c=c||[]).push(_,""+m):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&(Y0.hasOwnProperty(_)?(m!=null&&_==="onScroll"&&Lr("scroll",t),c||l===m||(c=[])):(c=c||[]).push(_,m))}n&&(c=c||[]).push("style",n);var _=c;(e.updateQueue=_)&&(e.flags|=4)}};nE=function(t,e,n,r){n!==r&&(e.flags|=4)};function f0(t,e){if(!Or)switch(t.tailMode){case"hidden":e=t.tail;for(var n=null;e!==null;)e.alternate!==null&&(n=e),e=e.sibling;n===null?t.tail=null:n.sibling=null;break;case"collapsed":n=t.tail;for(var r=null;n!==null;)n.alternate!==null&&(r=n),n=n.sibling;r===null?e||t.tail===null?t.tail=null:t.tail.sibling=null:r.sibling=null}}function ta(t){var e=t.alternate!==null&&t.alternate.child===t.child,n=0,r=0;if(e)for(var s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags&14680064,r|=s.flags&14680064,s.return=t,s=s.sibling;else for(s=t.child;s!==null;)n|=s.lanes|s.childLanes,r|=s.subtreeFlags,r|=s.flags,s.return=t,s=s.sibling;return t.subtreeFlags|=r,t.childLanes=n,e}function XR(t,e,n){var r=e.pendingProps;switch(ab(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ta(e),null;case 1:return ka(e.type)&&x1(),ta(e),null;case 3:return r=e.stateNode,Dd(),Fr(Da),Fr(sa),pb(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(t===null||t.child===null)&&(ig(e)?e.flags|=4:t===null||t.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ws!==null&&(a2(Ws),Ws=null))),Kx(t,e),ta(e),null;case 5:fb(e);var s=Su(lp.current);if(n=e.type,t!==null&&e.stateNode!=null)tE(t,e,n,r,s),t.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(zt(166));return ta(e),null}if(t=Su(_o.current),ig(e)){r=e.stateNode,n=e.type;var c=e.memoizedProps;switch(r[uo]=e,r[sp]=c,t=(e.mode&1)!==0,n){case"dialog":Lr("cancel",r),Lr("close",r);break;case"iframe":case"object":case"embed":Lr("load",r);break;case"video":case"audio":for(s=0;s<P0.length;s++)Lr(P0[s],r);break;case"source":Lr("error",r);break;case"img":case"image":case"link":Lr("error",r),Lr("load",r);break;case"details":Lr("toggle",r);break;case"input":n3(r,c),Lr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!c.multiple},Lr("invalid",r);break;case"textarea":i3(r,c),Lr("invalid",r)}Mx(n,c),s=null;for(var h in c)if(c.hasOwnProperty(h)){var l=c[h];h==="children"?typeof l=="string"?r.textContent!==l&&(c.suppressHydrationWarning!==!0&&rg(r.textContent,l,t),s=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(c.suppressHydrationWarning!==!0&&rg(r.textContent,l,t),s=["children",""+l]):Y0.hasOwnProperty(h)&&l!=null&&h==="onScroll"&&Lr("scroll",r)}switch(n){case"input":Zm(r),r3(r,c,!0);break;case"textarea":Zm(r),a3(r);break;case"select":case"option":break;default:typeof c.onClick=="function"&&(r.onclick=_1)}r=s,e.updateQueue=r,r!==null&&(e.flags|=4)}else{h=s.nodeType===9?s:s.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=PT(n)),t==="http://www.w3.org/1999/xhtml"?n==="script"?(t=h.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof r.is=="string"?t=h.createElement(n,{is:r.is}):(t=h.createElement(n),n==="select"&&(h=t,r.multiple?h.multiple=!0:r.size&&(h.size=r.size))):t=h.createElementNS(t,n),t[uo]=e,t[sp]=r,eE(t,e,!1,!1),e.stateNode=t;e:{switch(h=Tx(n,r),n){case"dialog":Lr("cancel",t),Lr("close",t),s=r;break;case"iframe":case"object":case"embed":Lr("load",t),s=r;break;case"video":case"audio":for(s=0;s<P0.length;s++)Lr(P0[s],t);s=r;break;case"source":Lr("error",t),s=r;break;case"img":case"image":case"link":Lr("error",t),Lr("load",t),s=r;break;case"details":Lr("toggle",t),s=r;break;case"input":n3(t,r),s=_x(t,r),Lr("invalid",t);break;case"option":s=r;break;case"select":t._wrapperState={wasMultiple:!!r.multiple},s=Xr({},r,{value:void 0}),Lr("invalid",t);break;case"textarea":i3(t,r),s=wx(t,r),Lr("invalid",t);break;default:s=r}Mx(n,s),l=s;for(c in l)if(l.hasOwnProperty(c)){var m=l[c];c==="style"?DT(t,m):c==="dangerouslySetInnerHTML"?(m=m?m.__html:void 0,m!=null&&RT(t,m)):c==="children"?typeof m=="string"?(n!=="textarea"||m!=="")&&K0(t,m):typeof m=="number"&&K0(t,""+m):c!=="suppressContentEditableWarning"&&c!=="suppressHydrationWarning"&&c!=="autoFocus"&&(Y0.hasOwnProperty(c)?m!=null&&c==="onScroll"&&Lr("scroll",t):m!=null&&j2(t,c,m,h))}switch(n){case"input":Zm(t),r3(t,r,!1);break;case"textarea":Zm(t),a3(t);break;case"option":r.value!=null&&t.setAttribute("value",""+Sc(r.value));break;case"select":t.multiple=!!r.multiple,c=r.value,c!=null?vd(t,!!r.multiple,c,!1):r.defaultValue!=null&&vd(t,!!r.multiple,r.defaultValue,!0);break;default:typeof s.onClick=="function"&&(t.onclick=_1)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ta(e),null;case 6:if(t&&e.stateNode!=null)nE(t,e,t.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(zt(166));if(n=Su(lp.current),Su(_o.current),ig(e)){if(r=e.stateNode,n=e.memoizedProps,r[uo]=e,(c=r.nodeValue!==n)&&(t=Qa,t!==null))switch(t.tag){case 3:rg(r.nodeValue,n,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&rg(r.nodeValue,n,(t.mode&1)!==0)}c&&(e.flags|=4)}else r=(n.nodeType===9?n:n.ownerDocument).createTextNode(r),r[uo]=e,e.stateNode=r}return ta(e),null;case 13:if(Fr(Wr),r=e.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Or&&Ka!==null&&e.mode&1&&!(e.flags&128))_6(),Rd(),e.flags|=98560,c=!1;else if(c=ig(e),r!==null&&r.dehydrated!==null){if(t===null){if(!c)throw Error(zt(318));if(c=e.memoizedState,c=c!==null?c.dehydrated:null,!c)throw Error(zt(317));c[uo]=e}else Rd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ta(e),c=!1}else Ws!==null&&(a2(Ws),Ws=null),c=!0;if(!c)return e.flags&65536?e:null}return e.flags&128?(e.lanes=n,e):(r=r!==null,r!==(t!==null&&t.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(t===null||Wr.current&1?xi===0&&(xi=3):Eb())),e.updateQueue!==null&&(e.flags|=4),ta(e),null);case 4:return Dd(),Kx(t,e),t===null&&ip(e.stateNode.containerInfo),ta(e),null;case 10:return cb(e.type._context),ta(e),null;case 17:return ka(e.type)&&x1(),ta(e),null;case 19:if(Fr(Wr),c=e.memoizedState,c===null)return ta(e),null;if(r=(e.flags&128)!==0,h=c.rendering,h===null)if(r)f0(c,!1);else{if(xi!==0||t!==null&&t.flags&128)for(t=e.child;t!==null;){if(h=A1(t),h!==null){for(e.flags|=128,f0(c,!1),r=h.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=n,n=e.child;n!==null;)c=n,t=r,c.flags&=14680066,h=c.alternate,h===null?(c.childLanes=0,c.lanes=t,c.child=null,c.subtreeFlags=0,c.memoizedProps=null,c.memoizedState=null,c.updateQueue=null,c.dependencies=null,c.stateNode=null):(c.childLanes=h.childLanes,c.lanes=h.lanes,c.child=h.child,c.subtreeFlags=0,c.deletions=null,c.memoizedProps=h.memoizedProps,c.memoizedState=h.memoizedState,c.updateQueue=h.updateQueue,c.type=h.type,t=h.dependencies,c.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),n=n.sibling;return Cr(Wr,Wr.current&1|2),e.child}t=t.sibling}c.tail!==null&&ci()>Ld&&(e.flags|=128,r=!0,f0(c,!1),e.lanes=4194304)}else{if(!r)if(t=A1(h),t!==null){if(e.flags|=128,r=!0,n=t.updateQueue,n!==null&&(e.updateQueue=n,e.flags|=4),f0(c,!0),c.tail===null&&c.tailMode==="hidden"&&!h.alternate&&!Or)return ta(e),null}else 2*ci()-c.renderingStartTime>Ld&&n!==1073741824&&(e.flags|=128,r=!0,f0(c,!1),e.lanes=4194304);c.isBackwards?(h.sibling=e.child,e.child=h):(n=c.last,n!==null?n.sibling=h:e.child=h,c.last=h)}return c.tail!==null?(e=c.tail,c.rendering=e,c.tail=e.sibling,c.renderingStartTime=ci(),e.sibling=null,n=Wr.current,Cr(Wr,r?n&1|2:n&1),e):(ta(e),null);case 22:case 23:return Tb(),r=e.memoizedState!==null,t!==null&&t.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?Za&1073741824&&(ta(e),e.subtreeFlags&6&&(e.flags|=8192)):ta(e),null;case 24:return null;case 25:return null}throw Error(zt(156,e.tag))}function ZR(t,e){switch(ab(e),e.tag){case 1:return ka(e.type)&&x1(),t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 3:return Dd(),Fr(Da),Fr(sa),pb(),t=e.flags,t&65536&&!(t&128)?(e.flags=t&-65537|128,e):null;case 5:return fb(e),null;case 13:if(Fr(Wr),t=e.memoizedState,t!==null&&t.dehydrated!==null){if(e.alternate===null)throw Error(zt(340));Rd()}return t=e.flags,t&65536?(e.flags=t&-65537|128,e):null;case 19:return Fr(Wr),null;case 4:return Dd(),null;case 10:return cb(e.type._context),null;case 22:case 23:return Tb(),null;case 24:return null;default:return null}}var og=!1,ia=!1,YR=typeof WeakSet=="function"?WeakSet:Set,vn=null;function ud(t,e){var n=t.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(r){ei(t,e,r)}else n.current=null}function Jx(t,e,n){try{n()}catch(r){ei(t,e,r)}}var X3=!1;function KR(t,e){if(zx=g1,t=s6(),rb(t)){if("selectionStart"in t)var n={start:t.selectionStart,end:t.selectionEnd};else e:{n=(n=t.ownerDocument)&&n.defaultView||window;var r=n.getSelection&&n.getSelection();if(r&&r.rangeCount!==0){n=r.anchorNode;var s=r.anchorOffset,c=r.focusNode;r=r.focusOffset;try{n.nodeType,c.nodeType}catch{n=null;break e}var h=0,l=-1,m=-1,_=0,S=0,T=t,M=null;t:for(;;){for(var I;T!==n||s!==0&&T.nodeType!==3||(l=h+s),T!==c||r!==0&&T.nodeType!==3||(m=h+r),T.nodeType===3&&(h+=T.nodeValue.length),(I=T.firstChild)!==null;)M=T,T=I;for(;;){if(T===t)break t;if(M===n&&++_===s&&(l=h),M===c&&++S===r&&(m=h),(I=T.nextSibling)!==null)break;T=M,M=T.parentNode}T=I}n=l===-1||m===-1?null:{start:l,end:m}}else n=null}n=n||{start:0,end:0}}else n=null;for(Fx={focusedElem:t,selectionRange:n},g1=!1,vn=e;vn!==null;)if(e=vn,t=e.child,(e.subtreeFlags&1028)!==0&&t!==null)t.return=e,vn=t;else for(;vn!==null;){e=vn;try{var N=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(N!==null){var B=N.memoizedProps,k=N.memoizedState,C=e.stateNode,U=C.getSnapshotBeforeUpdate(e.elementType===e.type?B:Vs(e.type,B),k);C.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var V=e.stateNode.containerInfo;V.nodeType===1?V.textContent="":V.nodeType===9&&V.documentElement&&V.removeChild(V.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(zt(163))}}catch(Y){ei(e,e.return,Y)}if(t=e.sibling,t!==null){t.return=e.return,vn=t;break}vn=e.return}return N=X3,X3=!1,N}function V0(t,e,n){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var s=r=r.next;do{if((s.tag&t)===t){var c=s.destroy;s.destroy=void 0,c!==void 0&&Jx(e,n,c)}s=s.next}while(s!==r)}}function fv(t,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var n=e=e.next;do{if((n.tag&t)===t){var r=n.create;n.destroy=r()}n=n.next}while(n!==e)}}function Qx(t){var e=t.ref;if(e!==null){var n=t.stateNode;switch(t.tag){case 5:t=n;break;default:t=n}typeof e=="function"?e(t):e.current=t}}function rE(t){var e=t.alternate;e!==null&&(t.alternate=null,rE(e)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(e=t.stateNode,e!==null&&(delete e[uo],delete e[sp],delete e[Ox],delete e[kR],delete e[LR])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function iE(t){return t.tag===5||t.tag===3||t.tag===4}function Z3(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||iE(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function e2(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.nodeType===8?n.parentNode.insertBefore(t,e):n.insertBefore(t,e):(n.nodeType===8?(e=n.parentNode,e.insertBefore(t,n)):(e=n,e.appendChild(t)),n=n._reactRootContainer,n!=null||e.onclick!==null||(e.onclick=_1));else if(r!==4&&(t=t.child,t!==null))for(e2(t,e,n),t=t.sibling;t!==null;)e2(t,e,n),t=t.sibling}function t2(t,e,n){var r=t.tag;if(r===5||r===6)t=t.stateNode,e?n.insertBefore(t,e):n.appendChild(t);else if(r!==4&&(t=t.child,t!==null))for(t2(t,e,n),t=t.sibling;t!==null;)t2(t,e,n),t=t.sibling}var Vi=null,Hs=!1;function ql(t,e,n){for(n=n.child;n!==null;)aE(t,e,n),n=n.sibling}function aE(t,e,n){if(yo&&typeof yo.onCommitFiberUnmount=="function")try{yo.onCommitFiberUnmount(av,n)}catch{}switch(n.tag){case 5:ia||ud(n,e);case 6:var r=Vi,s=Hs;Vi=null,ql(t,e,n),Vi=r,Hs=s,Vi!==null&&(Hs?(t=Vi,n=n.stateNode,t.nodeType===8?t.parentNode.removeChild(n):t.removeChild(n)):Vi.removeChild(n.stateNode));break;case 18:Vi!==null&&(Hs?(t=Vi,n=n.stateNode,t.nodeType===8?i_(t.parentNode,n):t.nodeType===1&&i_(t,n),tp(t)):i_(Vi,n.stateNode));break;case 4:r=Vi,s=Hs,Vi=n.stateNode.containerInfo,Hs=!0,ql(t,e,n),Vi=r,Hs=s;break;case 0:case 11:case 14:case 15:if(!ia&&(r=n.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){s=r=r.next;do{var c=s,h=c.destroy;c=c.tag,h!==void 0&&(c&2||c&4)&&Jx(n,e,h),s=s.next}while(s!==r)}ql(t,e,n);break;case 1:if(!ia&&(ud(n,e),r=n.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(l){ei(n,e,l)}ql(t,e,n);break;case 21:ql(t,e,n);break;case 22:n.mode&1?(ia=(r=ia)||n.memoizedState!==null,ql(t,e,n),ia=r):ql(t,e,n);break;default:ql(t,e,n)}}function Y3(t){var e=t.updateQueue;if(e!==null){t.updateQueue=null;var n=t.stateNode;n===null&&(n=t.stateNode=new YR),e.forEach(function(r){var s=s9.bind(null,t,r);n.has(r)||(n.add(r),r.then(s,s))})}}function Fs(t,e){var n=e.deletions;if(n!==null)for(var r=0;r<n.length;r++){var s=n[r];try{var c=t,h=e,l=h;e:for(;l!==null;){switch(l.tag){case 5:Vi=l.stateNode,Hs=!1;break e;case 3:Vi=l.stateNode.containerInfo,Hs=!0;break e;case 4:Vi=l.stateNode.containerInfo,Hs=!0;break e}l=l.return}if(Vi===null)throw Error(zt(160));aE(c,h,s),Vi=null,Hs=!1;var m=s.alternate;m!==null&&(m.return=null),s.return=null}catch(_){ei(s,e,_)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)sE(e,t),e=e.sibling}function sE(t,e){var n=t.alternate,r=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(Fs(e,t),ao(t),r&4){try{V0(3,t,t.return),fv(3,t)}catch(B){ei(t,t.return,B)}try{V0(5,t,t.return)}catch(B){ei(t,t.return,B)}}break;case 1:Fs(e,t),ao(t),r&512&&n!==null&&ud(n,n.return);break;case 5:if(Fs(e,t),ao(t),r&512&&n!==null&&ud(n,n.return),t.flags&32){var s=t.stateNode;try{K0(s,"")}catch(B){ei(t,t.return,B)}}if(r&4&&(s=t.stateNode,s!=null)){var c=t.memoizedProps,h=n!==null?n.memoizedProps:c,l=t.type,m=t.updateQueue;if(t.updateQueue=null,m!==null)try{l==="input"&&c.type==="radio"&&c.name!=null&&AT(s,c),Tx(l,h);var _=Tx(l,c);for(h=0;h<m.length;h+=2){var S=m[h],T=m[h+1];S==="style"?DT(s,T):S==="dangerouslySetInnerHTML"?RT(s,T):S==="children"?K0(s,T):j2(s,S,T,_)}switch(l){case"input":xx(s,c);break;case"textarea":CT(s,c);break;case"select":var M=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!c.multiple;var I=c.value;I!=null?vd(s,!!c.multiple,I,!1):M!==!!c.multiple&&(c.defaultValue!=null?vd(s,!!c.multiple,c.defaultValue,!0):vd(s,!!c.multiple,c.multiple?[]:"",!1))}s[sp]=c}catch(B){ei(t,t.return,B)}}break;case 6:if(Fs(e,t),ao(t),r&4){if(t.stateNode===null)throw Error(zt(162));s=t.stateNode,c=t.memoizedProps;try{s.nodeValue=c}catch(B){ei(t,t.return,B)}}break;case 3:if(Fs(e,t),ao(t),r&4&&n!==null&&n.memoizedState.isDehydrated)try{tp(e.containerInfo)}catch(B){ei(t,t.return,B)}break;case 4:Fs(e,t),ao(t);break;case 13:Fs(e,t),ao(t),s=t.child,s.flags&8192&&(c=s.memoizedState!==null,s.stateNode.isHidden=c,!c||s.alternate!==null&&s.alternate.memoizedState!==null||(Sb=ci())),r&4&&Y3(t);break;case 22:if(S=n!==null&&n.memoizedState!==null,t.mode&1?(ia=(_=ia)||S,Fs(e,t),ia=_):Fs(e,t),ao(t),r&8192){if(_=t.memoizedState!==null,(t.stateNode.isHidden=_)&&!S&&t.mode&1)for(vn=t,S=t.child;S!==null;){for(T=vn=S;vn!==null;){switch(M=vn,I=M.child,M.tag){case 0:case 11:case 14:case 15:V0(4,M,M.return);break;case 1:ud(M,M.return);var N=M.stateNode;if(typeof N.componentWillUnmount=="function"){r=M,n=M.return;try{e=r,N.props=e.memoizedProps,N.state=e.memoizedState,N.componentWillUnmount()}catch(B){ei(r,n,B)}}break;case 5:ud(M,M.return);break;case 22:if(M.memoizedState!==null){J3(T);continue}}I!==null?(I.return=M,vn=I):J3(T)}S=S.sibling}e:for(S=null,T=t;;){if(T.tag===5){if(S===null){S=T;try{s=T.stateNode,_?(c=s.style,typeof c.setProperty=="function"?c.setProperty("display","none","important"):c.display="none"):(l=T.stateNode,m=T.memoizedProps.style,h=m!=null&&m.hasOwnProperty("display")?m.display:null,l.style.display=IT("display",h))}catch(B){ei(t,t.return,B)}}}else if(T.tag===6){if(S===null)try{T.stateNode.nodeValue=_?"":T.memoizedProps}catch(B){ei(t,t.return,B)}}else if((T.tag!==22&&T.tag!==23||T.memoizedState===null||T===t)&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===t)break e;for(;T.sibling===null;){if(T.return===null||T.return===t)break e;S===T&&(S=null),T=T.return}S===T&&(S=null),T.sibling.return=T.return,T=T.sibling}}break;case 19:Fs(e,t),ao(t),r&4&&Y3(t);break;case 21:break;default:Fs(e,t),ao(t)}}function ao(t){var e=t.flags;if(e&2){try{e:{for(var n=t.return;n!==null;){if(iE(n)){var r=n;break e}n=n.return}throw Error(zt(160))}switch(r.tag){case 5:var s=r.stateNode;r.flags&32&&(K0(s,""),r.flags&=-33);var c=Z3(t);t2(t,c,s);break;case 3:case 4:var h=r.stateNode.containerInfo,l=Z3(t);e2(t,l,h);break;default:throw Error(zt(161))}}catch(m){ei(t,t.return,m)}t.flags&=-3}e&4096&&(t.flags&=-4097)}function JR(t,e,n){vn=t,oE(t)}function oE(t,e,n){for(var r=(t.mode&1)!==0;vn!==null;){var s=vn,c=s.child;if(s.tag===22&&r){var h=s.memoizedState!==null||og;if(!h){var l=s.alternate,m=l!==null&&l.memoizedState!==null||ia;l=og;var _=ia;if(og=h,(ia=m)&&!_)for(vn=s;vn!==null;)h=vn,m=h.child,h.tag===22&&h.memoizedState!==null?Q3(s):m!==null?(m.return=h,vn=m):Q3(s);for(;c!==null;)vn=c,oE(c),c=c.sibling;vn=s,og=l,ia=_}K3(t)}else s.subtreeFlags&8772&&c!==null?(c.return=s,vn=c):K3(t)}}function K3(t){for(;vn!==null;){var e=vn;if(e.flags&8772){var n=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ia||fv(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ia)if(n===null)r.componentDidMount();else{var s=e.elementType===e.type?n.memoizedProps:Vs(e.type,n.memoizedProps);r.componentDidUpdate(s,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var c=e.updateQueue;c!==null&&L3(e,c,r);break;case 3:var h=e.updateQueue;if(h!==null){if(n=null,e.child!==null)switch(e.child.tag){case 5:n=e.child.stateNode;break;case 1:n=e.child.stateNode}L3(e,h,n)}break;case 5:var l=e.stateNode;if(n===null&&e.flags&4){n=l;var m=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":m.autoFocus&&n.focus();break;case"img":m.src&&(n.src=m.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var _=e.alternate;if(_!==null){var S=_.memoizedState;if(S!==null){var T=S.dehydrated;T!==null&&tp(T)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(zt(163))}ia||e.flags&512&&Qx(e)}catch(M){ei(e,e.return,M)}}if(e===t){vn=null;break}if(n=e.sibling,n!==null){n.return=e.return,vn=n;break}vn=e.return}}function J3(t){for(;vn!==null;){var e=vn;if(e===t){vn=null;break}var n=e.sibling;if(n!==null){n.return=e.return,vn=n;break}vn=e.return}}function Q3(t){for(;vn!==null;){var e=vn;try{switch(e.tag){case 0:case 11:case 15:var n=e.return;try{fv(4,e)}catch(m){ei(e,n,m)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var s=e.return;try{r.componentDidMount()}catch(m){ei(e,s,m)}}var c=e.return;try{Qx(e)}catch(m){ei(e,c,m)}break;case 5:var h=e.return;try{Qx(e)}catch(m){ei(e,h,m)}}}catch(m){ei(e,e.return,m)}if(e===t){vn=null;break}var l=e.sibling;if(l!==null){l.return=e.return,vn=l;break}vn=e.return}}var QR=Math.ceil,R1=_l.ReactCurrentDispatcher,bb=_l.ReactCurrentOwner,Ss=_l.ReactCurrentBatchConfig,lr=0,Li=null,mi=null,Gi=0,Za=0,hd=Ic(0),xi=0,dp=null,Fu=0,pv=0,wb=0,H0=null,Ca=null,Sb=0,Ld=1/0,Qo=null,I1=!1,n2=null,yc=null,lg=!1,uc=null,D1=0,G0=0,r2=null,t1=-1,n1=0;function _a(){return lr&6?ci():t1!==-1?t1:t1=ci()}function _c(t){return t.mode&1?lr&2&&Gi!==0?Gi&-Gi:FR.transition!==null?(n1===0&&(n1=jT()),n1):(t=vr,t!==0||(t=window.event,t=t===void 0?16:KT(t.type)),t):1}function Ys(t,e,n,r){if(50<G0)throw G0=0,r2=null,Error(zt(185));Ap(t,n,r),(!(lr&2)||t!==Li)&&(t===Li&&(!(lr&2)&&(pv|=n),xi===4&&oc(t,Gi)),La(t,r),n===1&&lr===0&&!(e.mode&1)&&(Ld=ci()+500,uv&&Dc()))}function La(t,e){var n=t.callbackNode;FP(t,e);var r=m1(t,t===Li?Gi:0);if(r===0)n!==null&&l3(n),t.callbackNode=null,t.callbackPriority=0;else if(e=r&-r,t.callbackPriority!==e){if(n!=null&&l3(n),e===1)t.tag===0?zR(eS.bind(null,t)):g6(eS.bind(null,t)),IR(function(){!(lr&6)&&Dc()}),n=null;else{switch(WT(r)){case 1:n=Z2;break;case 4:n=HT;break;case 16:n=p1;break;case 536870912:n=GT;break;default:n=p1}n=mE(n,lE.bind(null,t))}t.callbackPriority=e,t.callbackNode=n}}function lE(t,e){if(t1=-1,n1=0,lr&6)throw Error(zt(327));var n=t.callbackNode;if(wd()&&t.callbackNode!==n)return null;var r=m1(t,t===Li?Gi:0);if(r===0)return null;if(r&30||r&t.expiredLanes||e)e=k1(t,r);else{e=r;var s=lr;lr|=2;var c=uE();(Li!==t||Gi!==e)&&(Qo=null,Ld=ci()+500,Ru(t,e));do try{n9();break}catch(l){cE(t,l)}while(!0);lb(),R1.current=c,lr=s,mi!==null?e=0:(Li=null,Gi=0,e=xi)}if(e!==0){if(e===2&&(s=Rx(t),s!==0&&(r=s,e=i2(t,s))),e===1)throw n=dp,Ru(t,0),oc(t,r),La(t,ci()),n;if(e===6)oc(t,r);else{if(s=t.current.alternate,!(r&30)&&!e9(s)&&(e=k1(t,r),e===2&&(c=Rx(t),c!==0&&(r=c,e=i2(t,c))),e===1))throw n=dp,Ru(t,0),oc(t,r),La(t,ci()),n;switch(t.finishedWork=s,t.finishedLanes=r,e){case 0:case 1:throw Error(zt(345));case 2:gu(t,Ca,Qo);break;case 3:if(oc(t,r),(r&130023424)===r&&(e=Sb+500-ci(),10<e)){if(m1(t,0)!==0)break;if(s=t.suspendedLanes,(s&r)!==r){_a(),t.pingedLanes|=t.suspendedLanes&s;break}t.timeoutHandle=Bx(gu.bind(null,t,Ca,Qo),e);break}gu(t,Ca,Qo);break;case 4:if(oc(t,r),(r&4194240)===r)break;for(e=t.eventTimes,s=-1;0<r;){var h=31-Zs(r);c=1<<h,h=e[h],h>s&&(s=h),r&=~c}if(r=s,r=ci()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*QR(r/1960))-r,10<r){t.timeoutHandle=Bx(gu.bind(null,t,Ca,Qo),r);break}gu(t,Ca,Qo);break;case 5:gu(t,Ca,Qo);break;default:throw Error(zt(329))}}}return La(t,ci()),t.callbackNode===n?lE.bind(null,t):null}function i2(t,e){var n=H0;return t.current.memoizedState.isDehydrated&&(Ru(t,e).flags|=256),t=k1(t,e),t!==2&&(e=Ca,Ca=n,e!==null&&a2(e)),t}function a2(t){Ca===null?Ca=t:Ca.push.apply(Ca,t)}function e9(t){for(var e=t;;){if(e.flags&16384){var n=e.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var r=0;r<n.length;r++){var s=n[r],c=s.getSnapshot;s=s.value;try{if(!Ks(c(),s))return!1}catch{return!1}}}if(n=e.child,e.subtreeFlags&16384&&n!==null)n.return=e,e=n;else{if(e===t)break;for(;e.sibling===null;){if(e.return===null||e.return===t)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function oc(t,e){for(e&=~wb,e&=~pv,t.suspendedLanes|=e,t.pingedLanes&=~e,t=t.expirationTimes;0<e;){var n=31-Zs(e),r=1<<n;t[n]=-1,e&=~r}}function eS(t){if(lr&6)throw Error(zt(327));wd();var e=m1(t,0);if(!(e&1))return La(t,ci()),null;var n=k1(t,e);if(t.tag!==0&&n===2){var r=Rx(t);r!==0&&(e=r,n=i2(t,r))}if(n===1)throw n=dp,Ru(t,0),oc(t,e),La(t,ci()),n;if(n===6)throw Error(zt(345));return t.finishedWork=t.current.alternate,t.finishedLanes=e,gu(t,Ca,Qo),La(t,ci()),null}function Mb(t,e){var n=lr;lr|=1;try{return t(e)}finally{lr=n,lr===0&&(Ld=ci()+500,uv&&Dc())}}function Nu(t){uc!==null&&uc.tag===0&&!(lr&6)&&wd();var e=lr;lr|=1;var n=Ss.transition,r=vr;try{if(Ss.transition=null,vr=1,t)return t()}finally{vr=r,Ss.transition=n,lr=e,!(lr&6)&&Dc()}}function Tb(){Za=hd.current,Fr(hd)}function Ru(t,e){t.finishedWork=null,t.finishedLanes=0;var n=t.timeoutHandle;if(n!==-1&&(t.timeoutHandle=-1,RR(n)),mi!==null)for(n=mi.return;n!==null;){var r=n;switch(ab(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&x1();break;case 3:Dd(),Fr(Da),Fr(sa),pb();break;case 5:fb(r);break;case 4:Dd();break;case 13:Fr(Wr);break;case 19:Fr(Wr);break;case 10:cb(r.type._context);break;case 22:case 23:Tb()}n=n.return}if(Li=t,mi=t=xc(t.current,null),Gi=Za=e,xi=0,dp=null,wb=pv=Fu=0,Ca=H0=null,wu!==null){for(e=0;e<wu.length;e++)if(n=wu[e],r=n.interleaved,r!==null){n.interleaved=null;var s=r.next,c=n.pending;if(c!==null){var h=c.next;c.next=s,r.next=h}n.pending=r}wu=null}return t}function cE(t,e){do{var n=mi;try{if(lb(),Jg.current=P1,C1){for(var r=$r.memoizedState;r!==null;){var s=r.queue;s!==null&&(s.pending=null),r=r.next}C1=!1}if(zu=0,Di=_i=$r=null,U0=!1,cp=0,bb.current=null,n===null||n.return===null){xi=1,dp=e,mi=null;break}e:{var c=t,h=n.return,l=n,m=e;if(e=Gi,l.flags|=32768,m!==null&&typeof m=="object"&&typeof m.then=="function"){var _=m,S=l,T=S.tag;if(!(S.mode&1)&&(T===0||T===11||T===15)){var M=S.alternate;M?(S.updateQueue=M.updateQueue,S.memoizedState=M.memoizedState,S.lanes=M.lanes):(S.updateQueue=null,S.memoizedState=null)}var I=V3(h);if(I!==null){I.flags&=-257,H3(I,h,l,c,e),I.mode&1&&U3(c,_,e),e=I,m=_;var N=e.updateQueue;if(N===null){var B=new Set;B.add(m),e.updateQueue=B}else N.add(m);break e}else{if(!(e&1)){U3(c,_,e),Eb();break e}m=Error(zt(426))}}else if(Or&&l.mode&1){var k=V3(h);if(k!==null){!(k.flags&65536)&&(k.flags|=256),H3(k,h,l,c,e),sb(kd(m,l));break e}}c=m=kd(m,l),xi!==4&&(xi=2),H0===null?H0=[c]:H0.push(c),c=h;do{switch(c.tag){case 3:c.flags|=65536,e&=-e,c.lanes|=e;var C=q6(c,m,e);k3(c,C);break e;case 1:l=m;var U=c.type,V=c.stateNode;if(!(c.flags&128)&&(typeof U.getDerivedStateFromError=="function"||V!==null&&typeof V.componentDidCatch=="function"&&(yc===null||!yc.has(V)))){c.flags|=65536,e&=-e,c.lanes|=e;var Y=$6(c,l,e);k3(c,Y);break e}}c=c.return}while(c!==null)}dE(n)}catch(he){e=he,mi===n&&n!==null&&(mi=n=n.return);continue}break}while(!0)}function uE(){var t=R1.current;return R1.current=P1,t===null?P1:t}function Eb(){(xi===0||xi===3||xi===2)&&(xi=4),Li===null||!(Fu&268435455)&&!(pv&268435455)||oc(Li,Gi)}function k1(t,e){var n=lr;lr|=2;var r=uE();(Li!==t||Gi!==e)&&(Qo=null,Ru(t,e));do try{t9();break}catch(s){cE(t,s)}while(!0);if(lb(),lr=n,R1.current=r,mi!==null)throw Error(zt(261));return Li=null,Gi=0,xi}function t9(){for(;mi!==null;)hE(mi)}function n9(){for(;mi!==null&&!AP();)hE(mi)}function hE(t){var e=pE(t.alternate,t,Za);t.memoizedProps=t.pendingProps,e===null?dE(t):mi=e,bb.current=null}function dE(t){var e=t;do{var n=e.alternate;if(t=e.return,e.flags&32768){if(n=ZR(n,e),n!==null){n.flags&=32767,mi=n;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{xi=6,mi=null;return}}else if(n=XR(n,e,Za),n!==null){mi=n;return}if(e=e.sibling,e!==null){mi=e;return}mi=e=t}while(e!==null);xi===0&&(xi=5)}function gu(t,e,n){var r=vr,s=Ss.transition;try{Ss.transition=null,vr=1,r9(t,e,n,r)}finally{Ss.transition=s,vr=r}return null}function r9(t,e,n,r){do wd();while(uc!==null);if(lr&6)throw Error(zt(327));n=t.finishedWork;var s=t.finishedLanes;if(n===null)return null;if(t.finishedWork=null,t.finishedLanes=0,n===t.current)throw Error(zt(177));t.callbackNode=null,t.callbackPriority=0;var c=n.lanes|n.childLanes;if(NP(t,c),t===Li&&(mi=Li=null,Gi=0),!(n.subtreeFlags&2064)&&!(n.flags&2064)||lg||(lg=!0,mE(p1,function(){return wd(),null})),c=(n.flags&15990)!==0,n.subtreeFlags&15990||c){c=Ss.transition,Ss.transition=null;var h=vr;vr=1;var l=lr;lr|=4,bb.current=null,KR(t,n),sE(n,t),SR(Fx),g1=!!zx,Fx=zx=null,t.current=n,JR(n),CP(),lr=l,vr=h,Ss.transition=c}else t.current=n;if(lg&&(lg=!1,uc=t,D1=s),c=t.pendingLanes,c===0&&(yc=null),IP(n.stateNode),La(t,ci()),e!==null)for(r=t.onRecoverableError,n=0;n<e.length;n++)s=e[n],r(s.value,{componentStack:s.stack,digest:s.digest});if(I1)throw I1=!1,t=n2,n2=null,t;return D1&1&&t.tag!==0&&wd(),c=t.pendingLanes,c&1?t===r2?G0++:(G0=0,r2=t):G0=0,Dc(),null}function wd(){if(uc!==null){var t=WT(D1),e=Ss.transition,n=vr;try{if(Ss.transition=null,vr=16>t?16:t,uc===null)var r=!1;else{if(t=uc,uc=null,D1=0,lr&6)throw Error(zt(331));var s=lr;for(lr|=4,vn=t.current;vn!==null;){var c=vn,h=c.child;if(vn.flags&16){var l=c.deletions;if(l!==null){for(var m=0;m<l.length;m++){var _=l[m];for(vn=_;vn!==null;){var S=vn;switch(S.tag){case 0:case 11:case 15:V0(8,S,c)}var T=S.child;if(T!==null)T.return=S,vn=T;else for(;vn!==null;){S=vn;var M=S.sibling,I=S.return;if(rE(S),S===_){vn=null;break}if(M!==null){M.return=I,vn=M;break}vn=I}}}var N=c.alternate;if(N!==null){var B=N.child;if(B!==null){N.child=null;do{var k=B.sibling;B.sibling=null,B=k}while(B!==null)}}vn=c}}if(c.subtreeFlags&2064&&h!==null)h.return=c,vn=h;else e:for(;vn!==null;){if(c=vn,c.flags&2048)switch(c.tag){case 0:case 11:case 15:V0(9,c,c.return)}var C=c.sibling;if(C!==null){C.return=c.return,vn=C;break e}vn=c.return}}var U=t.current;for(vn=U;vn!==null;){h=vn;var V=h.child;if(h.subtreeFlags&2064&&V!==null)V.return=h,vn=V;else e:for(h=U;vn!==null;){if(l=vn,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:fv(9,l)}}catch(he){ei(l,l.return,he)}if(l===h){vn=null;break e}var Y=l.sibling;if(Y!==null){Y.return=l.return,vn=Y;break e}vn=l.return}}if(lr=s,Dc(),yo&&typeof yo.onPostCommitFiberRoot=="function")try{yo.onPostCommitFiberRoot(av,t)}catch{}r=!0}return r}finally{vr=n,Ss.transition=e}}return!1}function tS(t,e,n){e=kd(n,e),e=q6(t,e,1),t=vc(t,e,1),e=_a(),t!==null&&(Ap(t,1,e),La(t,e))}function ei(t,e,n){if(t.tag===3)tS(t,t,n);else for(;e!==null;){if(e.tag===3){tS(e,t,n);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(yc===null||!yc.has(r))){t=kd(n,t),t=$6(e,t,1),e=vc(e,t,1),t=_a(),e!==null&&(Ap(e,1,t),La(e,t));break}}e=e.return}}function i9(t,e,n){var r=t.pingCache;r!==null&&r.delete(e),e=_a(),t.pingedLanes|=t.suspendedLanes&n,Li===t&&(Gi&n)===n&&(xi===4||xi===3&&(Gi&130023424)===Gi&&500>ci()-Sb?Ru(t,0):wb|=n),La(t,e)}function fE(t,e){e===0&&(t.mode&1?(e=Jm,Jm<<=1,!(Jm&130023424)&&(Jm=4194304)):e=1);var n=_a();t=hl(t,e),t!==null&&(Ap(t,e,n),La(t,n))}function a9(t){var e=t.memoizedState,n=0;e!==null&&(n=e.retryLane),fE(t,n)}function s9(t,e){var n=0;switch(t.tag){case 13:var r=t.stateNode,s=t.memoizedState;s!==null&&(n=s.retryLane);break;case 19:r=t.stateNode;break;default:throw Error(zt(314))}r!==null&&r.delete(e),fE(t,n)}var pE;pE=function(t,e,n){if(t!==null)if(t.memoizedProps!==e.pendingProps||Da.current)Ra=!0;else{if(!(t.lanes&n)&&!(e.flags&128))return Ra=!1,$R(t,e,n);Ra=!!(t.flags&131072)}else Ra=!1,Or&&e.flags&1048576&&v6(e,S1,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;e1(t,e),t=e.pendingProps;var s=Pd(e,sa.current);bd(e,n),s=gb(null,e,r,t,s,n);var c=vb();return e.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ka(r)?(c=!0,b1(e)):c=!1,e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,hb(e),s.updater=hv,e.stateNode=s,s._reactInternals=e,Wx(e,r,t,n),e=Xx(null,e,r,!0,c,n)):(e.tag=0,Or&&c&&ib(e),va(null,e,s,n),e=e.child),e;case 16:r=e.elementType;e:{switch(e1(t,e),t=e.pendingProps,s=r._init,r=s(r._payload),e.type=r,s=e.tag=l9(r),t=Vs(r,t),s){case 0:e=$x(null,e,r,t,n);break e;case 1:e=W3(null,e,r,t,n);break e;case 11:e=G3(null,e,r,t,n);break e;case 14:e=j3(null,e,r,Vs(r.type,t),n);break e}throw Error(zt(306,r,""))}return e;case 0:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vs(r,s),$x(t,e,r,s,n);case 1:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vs(r,s),W3(t,e,r,s,n);case 3:e:{if(K6(e),t===null)throw Error(zt(387));r=e.pendingProps,c=e.memoizedState,s=c.element,b6(t,e),E1(e,r,null,n);var h=e.memoizedState;if(r=h.element,c.isDehydrated)if(c={element:r,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=c,e.memoizedState=c,e.flags&256){s=kd(Error(zt(423)),e),e=q3(t,e,r,n,s);break e}else if(r!==s){s=kd(Error(zt(424)),e),e=q3(t,e,r,n,s);break e}else for(Ka=gc(e.stateNode.containerInfo.firstChild),Qa=e,Or=!0,Ws=null,n=T6(e,null,r,n),e.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Rd(),r===s){e=dl(t,e,n);break e}va(t,e,r,n)}e=e.child}return e;case 5:return E6(e),t===null&&Hx(e),r=e.type,s=e.pendingProps,c=t!==null?t.memoizedProps:null,h=s.children,Nx(r,s)?h=null:c!==null&&Nx(r,c)&&(e.flags|=32),Y6(t,e),va(t,e,h,n),e.child;case 6:return t===null&&Hx(e),null;case 13:return J6(t,e,n);case 4:return db(e,e.stateNode.containerInfo),r=e.pendingProps,t===null?e.child=Id(e,null,r,n):va(t,e,r,n),e.child;case 11:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vs(r,s),G3(t,e,r,s,n);case 7:return va(t,e,e.pendingProps,n),e.child;case 8:return va(t,e,e.pendingProps.children,n),e.child;case 12:return va(t,e,e.pendingProps.children,n),e.child;case 10:e:{if(r=e.type._context,s=e.pendingProps,c=e.memoizedProps,h=s.value,Cr(M1,r._currentValue),r._currentValue=h,c!==null)if(Ks(c.value,h)){if(c.children===s.children&&!Da.current){e=dl(t,e,n);break e}}else for(c=e.child,c!==null&&(c.return=e);c!==null;){var l=c.dependencies;if(l!==null){h=c.child;for(var m=l.firstContext;m!==null;){if(m.context===r){if(c.tag===1){m=al(-1,n&-n),m.tag=2;var _=c.updateQueue;if(_!==null){_=_.shared;var S=_.pending;S===null?m.next=m:(m.next=S.next,S.next=m),_.pending=m}}c.lanes|=n,m=c.alternate,m!==null&&(m.lanes|=n),Gx(c.return,n,e),l.lanes|=n;break}m=m.next}}else if(c.tag===10)h=c.type===e.type?null:c.child;else if(c.tag===18){if(h=c.return,h===null)throw Error(zt(341));h.lanes|=n,l=h.alternate,l!==null&&(l.lanes|=n),Gx(h,n,e),h=c.sibling}else h=c.child;if(h!==null)h.return=c;else for(h=c;h!==null;){if(h===e){h=null;break}if(c=h.sibling,c!==null){c.return=h.return,h=c;break}h=h.return}c=h}va(t,e,s.children,n),e=e.child}return e;case 9:return s=e.type,r=e.pendingProps.children,bd(e,n),s=Ts(s),r=r(s),e.flags|=1,va(t,e,r,n),e.child;case 14:return r=e.type,s=Vs(r,e.pendingProps),s=Vs(r.type,s),j3(t,e,r,s,n);case 15:return X6(t,e,e.type,e.pendingProps,n);case 17:return r=e.type,s=e.pendingProps,s=e.elementType===r?s:Vs(r,s),e1(t,e),e.tag=1,ka(r)?(t=!0,b1(e)):t=!1,bd(e,n),S6(e,r,s),Wx(e,r,s,n),Xx(null,e,r,!0,t,n);case 19:return Q6(t,e,n);case 22:return Z6(t,e,n)}throw Error(zt(156,e.tag))};function mE(t,e){return VT(t,e)}function o9(t,e,n,r){this.tag=t,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(t,e,n,r){return new o9(t,e,n,r)}function Ab(t){return t=t.prototype,!(!t||!t.isReactComponent)}function l9(t){if(typeof t=="function")return Ab(t)?1:0;if(t!=null){if(t=t.$$typeof,t===q2)return 11;if(t===$2)return 14}return 2}function xc(t,e){var n=t.alternate;return n===null?(n=_s(t.tag,e,t.key,t.mode),n.elementType=t.elementType,n.type=t.type,n.stateNode=t.stateNode,n.alternate=t,t.alternate=n):(n.pendingProps=e,n.type=t.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=t.flags&14680064,n.childLanes=t.childLanes,n.lanes=t.lanes,n.child=t.child,n.memoizedProps=t.memoizedProps,n.memoizedState=t.memoizedState,n.updateQueue=t.updateQueue,e=t.dependencies,n.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},n.sibling=t.sibling,n.index=t.index,n.ref=t.ref,n}function r1(t,e,n,r,s,c){var h=2;if(r=t,typeof t=="function")Ab(t)&&(h=1);else if(typeof t=="string")h=5;else e:switch(t){case td:return Iu(n.children,s,c,e);case W2:h=8,s|=8;break;case mx:return t=_s(12,n,e,s|2),t.elementType=mx,t.lanes=c,t;case gx:return t=_s(13,n,e,s),t.elementType=gx,t.lanes=c,t;case vx:return t=_s(19,n,e,s),t.elementType=vx,t.lanes=c,t;case MT:return mv(n,s,c,e);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case wT:h=10;break e;case ST:h=9;break e;case q2:h=11;break e;case $2:h=14;break e;case rc:h=16,r=null;break e}throw Error(zt(130,t==null?t:typeof t,""))}return e=_s(h,n,e,s),e.elementType=t,e.type=r,e.lanes=c,e}function Iu(t,e,n,r){return t=_s(7,t,r,e),t.lanes=n,t}function mv(t,e,n,r){return t=_s(22,t,r,e),t.elementType=MT,t.lanes=n,t.stateNode={isHidden:!1},t}function d_(t,e,n){return t=_s(6,t,null,e),t.lanes=n,t}function f_(t,e,n){return e=_s(4,t.children!==null?t.children:[],t.key,e),e.lanes=n,e.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},e}function c9(t,e,n,r,s){this.tag=e,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=$y(0),this.expirationTimes=$y(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=$y(0),this.identifierPrefix=r,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Cb(t,e,n,r,s,c,h,l,m){return t=new c9(t,e,n,l,m),e===1?(e=1,c===!0&&(e|=8)):e=0,c=_s(3,null,null,e),t.current=c,c.stateNode=t,c.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},hb(c),t}function u9(t,e,n){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ed,key:r==null?null:""+r,children:t,containerInfo:e,implementation:n}}function gE(t){if(!t)return Mc;t=t._reactInternals;e:{if(Wu(t)!==t||t.tag!==1)throw Error(zt(170));var e=t;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ka(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(zt(171))}if(t.tag===1){var n=t.type;if(ka(n))return m6(t,n,e)}return e}function vE(t,e,n,r,s,c,h,l,m){return t=Cb(n,r,!0,t,s,c,h,l,m),t.context=gE(null),n=t.current,r=_a(),s=_c(n),c=al(r,s),c.callback=e??null,vc(n,c,s),t.current.lanes=s,Ap(t,s,r),La(t,r),t}function gv(t,e,n,r){var s=e.current,c=_a(),h=_c(s);return n=gE(n),e.context===null?e.context=n:e.pendingContext=n,e=al(c,h),e.payload={element:t},r=r===void 0?null:r,r!==null&&(e.callback=r),t=vc(s,e,h),t!==null&&(Ys(t,s,h,c),Kg(t,s,h)),h}function L1(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function nS(t,e){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var n=t.retryLane;t.retryLane=n!==0&&n<e?n:e}}function Pb(t,e){nS(t,e),(t=t.alternate)&&nS(t,e)}function h9(){return null}var yE=typeof reportError=="function"?reportError:function(t){console.error(t)};function Rb(t){this._internalRoot=t}vv.prototype.render=Rb.prototype.render=function(t){var e=this._internalRoot;if(e===null)throw Error(zt(409));gv(t,e,null,null)};vv.prototype.unmount=Rb.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var e=t.containerInfo;Nu(function(){gv(null,t,null,null)}),e[ul]=null}};function vv(t){this._internalRoot=t}vv.prototype.unstable_scheduleHydration=function(t){if(t){var e=XT();t={blockedOn:null,target:t,priority:e};for(var n=0;n<sc.length&&e!==0&&e<sc[n].priority;n++);sc.splice(n,0,t),n===0&&YT(t)}};function Ib(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function yv(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function rS(){}function d9(t,e,n,r,s){if(s){if(typeof r=="function"){var c=r;r=function(){var _=L1(h);c.call(_)}}var h=vE(e,r,t,0,null,!1,!1,"",rS);return t._reactRootContainer=h,t[ul]=h.current,ip(t.nodeType===8?t.parentNode:t),Nu(),h}for(;s=t.lastChild;)t.removeChild(s);if(typeof r=="function"){var l=r;r=function(){var _=L1(m);l.call(_)}}var m=Cb(t,0,!1,null,null,!1,!1,"",rS);return t._reactRootContainer=m,t[ul]=m.current,ip(t.nodeType===8?t.parentNode:t),Nu(function(){gv(e,m,n,r)}),m}function _v(t,e,n,r,s){var c=n._reactRootContainer;if(c){var h=c;if(typeof s=="function"){var l=s;s=function(){var m=L1(h);l.call(m)}}gv(e,h,t,s)}else h=d9(n,e,t,s,r);return L1(h)}qT=function(t){switch(t.tag){case 3:var e=t.stateNode;if(e.current.memoizedState.isDehydrated){var n=C0(e.pendingLanes);n!==0&&(Y2(e,n|1),La(e,ci()),!(lr&6)&&(Ld=ci()+500,Dc()))}break;case 13:Nu(function(){var r=hl(t,1);if(r!==null){var s=_a();Ys(r,t,1,s)}}),Pb(t,1)}};K2=function(t){if(t.tag===13){var e=hl(t,134217728);if(e!==null){var n=_a();Ys(e,t,134217728,n)}Pb(t,134217728)}};$T=function(t){if(t.tag===13){var e=_c(t),n=hl(t,e);if(n!==null){var r=_a();Ys(n,t,e,r)}Pb(t,e)}};XT=function(){return vr};ZT=function(t,e){var n=vr;try{return vr=t,e()}finally{vr=n}};Ax=function(t,e,n){switch(e){case"input":if(xx(t,n),e=n.name,n.type==="radio"&&e!=null){for(n=t;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<n.length;e++){var r=n[e];if(r!==t&&r.form===t.form){var s=cv(r);if(!s)throw Error(zt(90));ET(r),xx(r,s)}}}break;case"textarea":CT(t,n);break;case"select":e=n.value,e!=null&&vd(t,!!n.multiple,e,!1)}};zT=Mb;FT=Nu;var f9={usingClientEntryPoint:!1,Events:[Pp,ad,cv,kT,LT,Mb]},p0={findFiberByHostInstance:bu,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},p9={bundleType:p0.bundleType,version:p0.version,rendererPackageName:p0.rendererPackageName,rendererConfig:p0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:_l.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=OT(t),t===null?null:t.stateNode},findFiberByHostInstance:p0.findFiberByHostInstance||h9,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cg.isDisabled&&cg.supportsFiber)try{av=cg.inject(p9),yo=cg}catch{}}rs.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=f9;rs.createPortal=function(t,e){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ib(e))throw Error(zt(200));return u9(t,e,null,n)};rs.createRoot=function(t,e){if(!Ib(t))throw Error(zt(299));var n=!1,r="",s=yE;return e!=null&&(e.unstable_strictMode===!0&&(n=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(s=e.onRecoverableError)),e=Cb(t,1,!1,null,null,n,!1,r,s),t[ul]=e.current,ip(t.nodeType===8?t.parentNode:t),new Rb(e)};rs.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var e=t._reactInternals;if(e===void 0)throw typeof t.render=="function"?Error(zt(188)):(t=Object.keys(t).join(","),Error(zt(268,t)));return t=OT(e),t=t===null?null:t.stateNode,t};rs.flushSync=function(t){return Nu(t)};rs.hydrate=function(t,e,n){if(!yv(e))throw Error(zt(200));return _v(null,t,e,!0,n)};rs.hydrateRoot=function(t,e,n){if(!Ib(t))throw Error(zt(405));var r=n!=null&&n.hydratedSources||null,s=!1,c="",h=yE;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(c=n.identifierPrefix),n.onRecoverableError!==void 0&&(h=n.onRecoverableError)),e=vE(e,null,t,1,n??null,s,!1,c,h),t[ul]=e.current,ip(t),r)for(t=0;t<r.length;t++)n=r[t],s=n._getVersion,s=s(n._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[n,s]:e.mutableSourceEagerHydrationData.push(n,s);return new vv(e)};rs.render=function(t,e,n){if(!yv(e))throw Error(zt(200));return _v(null,t,e,!1,n)};rs.unmountComponentAtNode=function(t){if(!yv(t))throw Error(zt(40));return t._reactRootContainer?(Nu(function(){_v(null,null,t,!1,function(){t._reactRootContainer=null,t[ul]=null})}),!0):!1};rs.unstable_batchedUpdates=Mb;rs.unstable_renderSubtreeIntoContainer=function(t,e,n,r){if(!yv(n))throw Error(zt(200));if(t==null||t._reactInternals===void 0)throw Error(zt(38));return _v(t,e,n,!1,r)};rs.version="18.2.0-next-9e3b772b8-20220608";function _E(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(_E)}catch(t){console.error(t)}}_E(),vT.exports=rs;var Db=vT.exports;const m9=aT(Db),g9=iT({__proto__:null,default:m9},[Db]);var iS=Db;fx.createRoot=iS.createRoot,fx.hydrateRoot=iS.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ti(){return ti=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},ti.apply(this,arguments)}var li;(function(t){t.Pop="POP",t.Push="PUSH",t.Replace="REPLACE"})(li||(li={}));const aS="popstate";function v9(t){t===void 0&&(t={});function e(s,c){let{pathname:h="/",search:l="",hash:m=""}=So(s.location.hash.substr(1));return!h.startsWith("/")&&!h.startsWith(".")&&(h="/"+h),fp("",{pathname:h,search:l,hash:m},c.state&&c.state.usr||null,c.state&&c.state.key||"default")}function n(s,c){let h=s.document.querySelector("base"),l="";if(h&&h.getAttribute("href")){let m=s.location.href,_=m.indexOf("#");l=_===-1?m:m.slice(0,_)}return l+"#"+(typeof c=="string"?c:Ou(c))}function r(s,c){Bu(s.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(c)+")")}return _9(e,n,r,t)}function tr(t,e){if(t===!1||t===null||typeof t>"u")throw new Error(e)}function Bu(t,e){if(!t){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function y9(){return Math.random().toString(36).substr(2,8)}function sS(t,e){return{usr:t.state,key:t.key,idx:e}}function fp(t,e,n,r){return n===void 0&&(n=null),ti({pathname:typeof t=="string"?t:t.pathname,search:"",hash:""},typeof e=="string"?So(e):e,{state:n,key:e&&e.key||r||y9()})}function Ou(t){let{pathname:e="/",search:n="",hash:r=""}=t;return n&&n!=="?"&&(e+=n.charAt(0)==="?"?n:"?"+n),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function So(t){let e={};if(t){let n=t.indexOf("#");n>=0&&(e.hash=t.substr(n),t=t.substr(0,n));let r=t.indexOf("?");r>=0&&(e.search=t.substr(r),t=t.substr(0,r)),t&&(e.pathname=t)}return e}function _9(t,e,n,r){r===void 0&&(r={});let{window:s=document.defaultView,v5Compat:c=!1}=r,h=s.history,l=li.Pop,m=null,_=S();_==null&&(_=0,h.replaceState(ti({},h.state,{idx:_}),""));function S(){return(h.state||{idx:null}).idx}function T(){l=li.Pop;let k=S(),C=k==null?null:k-_;_=k,m&&m({action:l,location:B.location,delta:C})}function M(k,C){l=li.Push;let U=fp(B.location,k,C);n&&n(U,k),_=S()+1;let V=sS(U,_),Y=B.createHref(U);try{h.pushState(V,"",Y)}catch(he){if(he instanceof DOMException&&he.name==="DataCloneError")throw he;s.location.assign(Y)}c&&m&&m({action:l,location:B.location,delta:1})}function I(k,C){l=li.Replace;let U=fp(B.location,k,C);n&&n(U,k),_=S();let V=sS(U,_),Y=B.createHref(U);h.replaceState(V,"",Y),c&&m&&m({action:l,location:B.location,delta:0})}function N(k){let C=s.location.origin!=="null"?s.location.origin:s.location.href,U=typeof k=="string"?k:Ou(k);return U=U.replace(/ $/,"%20"),tr(C,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,C)}let B={get action(){return l},get location(){return t(s,h)},listen(k){if(m)throw new Error("A history only accepts one active listener");return s.addEventListener(aS,T),m=k,()=>{s.removeEventListener(aS,T),m=null}},createHref(k){return e(s,k)},createURL:N,encodeLocation(k){let C=N(k);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:M,replace:I,go(k){return h.go(k)}};return B}var Qr;(function(t){t.data="data",t.deferred="deferred",t.redirect="redirect",t.error="error"})(Qr||(Qr={}));const x9=new Set(["lazy","caseSensitive","path","id","index","children"]);function b9(t){return t.index===!0}function s2(t,e,n,r){return n===void 0&&(n=[]),r===void 0&&(r={}),t.map((s,c)=>{let h=[...n,c],l=typeof s.id=="string"?s.id:h.join("-");if(tr(s.index!==!0||!s.children,"Cannot specify children on an index route"),tr(!r[l],'Found a route id collision on id "'+l+`".  Route id's must be globally unique within Data Router usages`),b9(s)){let m=ti({},s,e(s),{id:l});return r[l]=m,m}else{let m=ti({},s,e(s),{id:l,children:void 0});return r[l]=m,s.children&&(m.children=s2(s.children,e,h,r)),m}})}function dd(t,e,n){n===void 0&&(n="/");let r=typeof e=="string"?So(e):e,s=fl(r.pathname||"/",n);if(s==null)return null;let c=xE(t);S9(c);let h=null;for(let l=0;h==null&&l<c.length;++l){let m=L9(s);h=D9(c[l],m)}return h}function w9(t,e){let{route:n,pathname:r,params:s}=t;return{id:n.id,pathname:r,params:s,data:e[n.id],handle:n.handle}}function xE(t,e,n,r){e===void 0&&(e=[]),n===void 0&&(n=[]),r===void 0&&(r="");let s=(c,h,l)=>{let m={relativePath:l===void 0?c.path||"":l,caseSensitive:c.caseSensitive===!0,childrenIndex:h,route:c};m.relativePath.startsWith("/")&&(tr(m.relativePath.startsWith(r),'Absolute route path "'+m.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),m.relativePath=m.relativePath.slice(r.length));let _=sl([r,m.relativePath]),S=n.concat(m);c.children&&c.children.length>0&&(tr(c.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+_+'".')),xE(c.children,e,S,_)),!(c.path==null&&!c.index)&&e.push({path:_,score:R9(_,c.index),routesMeta:S})};return t.forEach((c,h)=>{var l;if(c.path===""||!((l=c.path)!=null&&l.includes("?")))s(c,h);else for(let m of bE(c.path))s(c,h,m)}),e}function bE(t){let e=t.split("/");if(e.length===0)return[];let[n,...r]=e,s=n.endsWith("?"),c=n.replace(/\?$/,"");if(r.length===0)return s?[c,""]:[c];let h=bE(r.join("/")),l=[];return l.push(...h.map(m=>m===""?c:[c,m].join("/"))),s&&l.push(...h),l.map(m=>t.startsWith("/")&&m===""?"/":m)}function S9(t){t.sort((e,n)=>e.score!==n.score?n.score-e.score:I9(e.routesMeta.map(r=>r.childrenIndex),n.routesMeta.map(r=>r.childrenIndex)))}const M9=/^:[\w-]+$/,T9=3,E9=2,A9=1,C9=10,P9=-2,oS=t=>t==="*";function R9(t,e){let n=t.split("/"),r=n.length;return n.some(oS)&&(r+=P9),e&&(r+=E9),n.filter(s=>!oS(s)).reduce((s,c)=>s+(M9.test(c)?T9:c===""?A9:C9),r)}function I9(t,e){return t.length===e.length&&t.slice(0,-1).every((r,s)=>r===e[s])?t[t.length-1]-e[e.length-1]:0}function D9(t,e){let{routesMeta:n}=t,r={},s="/",c=[];for(let h=0;h<n.length;++h){let l=n[h],m=h===n.length-1,_=s==="/"?e:e.slice(s.length)||"/",S=o2({path:l.relativePath,caseSensitive:l.caseSensitive,end:m},_);if(!S)return null;Object.assign(r,S.params);let T=l.route;c.push({params:r,pathname:sl([s,S.pathname]),pathnameBase:N9(sl([s,S.pathnameBase])),route:T}),S.pathnameBase!=="/"&&(s=sl([s,S.pathnameBase]))}return c}function o2(t,e){typeof t=="string"&&(t={path:t,caseSensitive:!1,end:!0});let[n,r]=k9(t.path,t.caseSensitive,t.end),s=e.match(n);if(!s)return null;let c=s[0],h=c.replace(/(.)\/+$/,"$1"),l=s.slice(1);return{params:r.reduce((_,S,T)=>{let{paramName:M,isOptional:I}=S;if(M==="*"){let B=l[T]||"";h=c.slice(0,c.length-B.length).replace(/(.)\/+$/,"$1")}const N=l[T];return I&&!N?_[M]=void 0:_[M]=(N||"").replace(/%2F/g,"/"),_},{}),pathname:c,pathnameBase:h,pattern:t}}function k9(t,e,n){e===void 0&&(e=!1),n===void 0&&(n=!0),Bu(t==="*"||!t.endsWith("*")||t.endsWith("/*"),'Route path "'+t+'" will be treated as if it were '+('"'+t.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+t.replace(/\*$/,"/*")+'".'));let r=[],s="^"+t.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,l,m)=>(r.push({paramName:l,isOptional:m!=null}),m?"/?([^\\/]+)?":"/([^\\/]+)"));return t.endsWith("*")?(r.push({paramName:"*"}),s+=t==="*"||t==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):n?s+="\\/*$":t!==""&&t!=="/"&&(s+="(?:(?=\\/|$))"),[new RegExp(s,e?void 0:"i"),r]}function L9(t){try{return t.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Bu(!1,'The URL path "'+t+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),t}}function fl(t,e){if(e==="/")return t;if(!t.toLowerCase().startsWith(e.toLowerCase()))return null;let n=e.endsWith("/")?e.length-1:e.length,r=t.charAt(n);return r&&r!=="/"?null:t.slice(n)||"/"}function z9(t,e){e===void 0&&(e="/");let{pathname:n,search:r="",hash:s=""}=typeof t=="string"?So(t):t;return{pathname:n?n.startsWith("/")?n:F9(n,e):e,search:B9(r),hash:O9(s)}}function F9(t,e){let n=e.replace(/\/+$/,"").split("/");return t.split("/").forEach(s=>{s===".."?n.length>1&&n.pop():s!=="."&&n.push(s)}),n.length>1?n.join("/"):"/"}function p_(t,e,n,r){return"Cannot include a '"+t+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+n+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function wE(t){return t.filter((e,n)=>n===0||e.route.path&&e.route.path.length>0)}function kb(t,e){let n=wE(t);return e?n.map((r,s)=>s===t.length-1?r.pathname:r.pathnameBase):n.map(r=>r.pathnameBase)}function Lb(t,e,n,r){r===void 0&&(r=!1);let s;typeof t=="string"?s=So(t):(s=ti({},t),tr(!s.pathname||!s.pathname.includes("?"),p_("?","pathname","search",s)),tr(!s.pathname||!s.pathname.includes("#"),p_("#","pathname","hash",s)),tr(!s.search||!s.search.includes("#"),p_("#","search","hash",s)));let c=t===""||s.pathname==="",h=c?"/":s.pathname,l;if(h==null)l=n;else{let T=e.length-1;if(!r&&h.startsWith("..")){let M=h.split("/");for(;M[0]==="..";)M.shift(),T-=1;s.pathname=M.join("/")}l=T>=0?e[T]:"/"}let m=z9(s,l),_=h&&h!=="/"&&h.endsWith("/"),S=(c||h===".")&&n.endsWith("/");return!m.pathname.endsWith("/")&&(_||S)&&(m.pathname+="/"),m}const sl=t=>t.join("/").replace(/\/\/+/g,"/"),N9=t=>t.replace(/\/+$/,"").replace(/^\/*/,"/"),B9=t=>!t||t==="?"?"":t.startsWith("?")?t:"?"+t,O9=t=>!t||t==="#"?"":t.startsWith("#")?t:"#"+t;class zb{constructor(e,n,r,s){s===void 0&&(s=!1),this.status=e,this.statusText=n||"",this.internal=s,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function SE(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.internal=="boolean"&&"data"in t}const ME=["post","put","patch","delete"],U9=new Set(ME),V9=["get",...ME],H9=new Set(V9),G9=new Set([301,302,303,307,308]),j9=new Set([307,308]),m_={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},W9={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},m0={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},TE=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,q9=t=>({hasErrorBoundary:!!t.hasErrorBoundary}),EE="remix-router-transitions";function $9(t){const e=t.window?t.window:typeof window<"u"?window:void 0,n=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!n;tr(t.routes.length>0,"You must provide a non-empty routes array to createRouter");let s;if(t.mapRouteProperties)s=t.mapRouteProperties;else if(t.detectErrorBoundary){let F=t.detectErrorBoundary;s=O=>({hasErrorBoundary:F(O)})}else s=q9;let c={},h=s2(t.routes,s,void 0,c),l,m=t.basename||"/",_=ti({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},t.future),S=null,T=new Set,M=null,I=null,N=null,B=t.hydrationData!=null,k=dd(h,t.history.location,m),C=null;if(k==null){let F=ps(404,{pathname:t.history.location.pathname}),{matches:O,route:q}=mS(h);k=O,C={[q.id]:F}}let U,V=k.some(F=>F.route.lazy),Y=k.some(F=>F.route.loader);if(V)U=!1;else if(!Y)U=!0;else if(_.v7_partialHydration){let F=t.hydrationData?t.hydrationData.loaderData:null,O=t.hydrationData?t.hydrationData.errors:null,q=te=>te.route.loader?te.route.loader.hydrate===!0?!1:F&&F[te.route.id]!==void 0||O&&O[te.route.id]!==void 0:!0;if(O){let te=k.findIndex(pe=>O[pe.route.id]!==void 0);U=k.slice(0,te+1).every(q)}else U=k.every(q)}else U=t.hydrationData!=null;let he,Z={historyAction:t.history.action,location:t.history.location,matches:k,initialized:U,navigation:m_,restoreScrollPosition:t.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:t.hydrationData&&t.hydrationData.loaderData||{},actionData:t.hydrationData&&t.hydrationData.actionData||null,errors:t.hydrationData&&t.hydrationData.errors||C,fetchers:new Map,blockers:new Map},ne=li.Pop,xe=!1,ie,J=!1,Te=new Map,Be=null,Re=!1,We=!1,ct=[],gt=[],ft=new Map,ke=0,at=-1,ot=new Map,_t=new Set,kt=new Map,Cn=new Map,it=new Set,Mt=new Map,Ft=new Map,At=!1;function Sn(){if(S=t.history.listen(F=>{let{action:O,location:q,delta:te}=F;if(At){At=!1;return}Bu(Ft.size===0||te!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let pe=Zt({currentLocation:Z.location,nextLocation:q,historyAction:O});if(pe&&te!=null){At=!0,t.history.go(te*-1),Ut(pe,{state:"blocked",location:q,proceed(){Ut(pe,{state:"proceeding",proceed:void 0,reset:void 0,location:q}),t.history.go(te)},reset(){let we=new Map(Z.blockers);we.set(pe,m0),Nn({blockers:we})}});return}return un(O,q)}),n){iI(e,Te);let F=()=>aI(e,Te);e.addEventListener("pagehide",F),Be=()=>e.removeEventListener("pagehide",F)}return Z.initialized||un(li.Pop,Z.location,{initialHydration:!0}),he}function Dn(){S&&S(),Be&&Be(),T.clear(),ie&&ie.abort(),Z.fetchers.forEach((F,O)=>Ht(O)),Z.blockers.forEach((F,O)=>lt(O))}function qe(F){return T.add(F),()=>T.delete(F)}function Nn(F,O){O===void 0&&(O={}),Z=ti({},Z,F);let q=[],te=[];_.v7_fetcherPersist&&Z.fetchers.forEach((pe,we)=>{pe.state==="idle"&&(it.has(we)?te.push(we):q.push(we))}),[...T].forEach(pe=>pe(Z,{deletedFetchers:te,unstable_viewTransitionOpts:O.viewTransitionOpts,unstable_flushSync:O.flushSync===!0})),_.v7_fetcherPersist&&(q.forEach(pe=>Z.fetchers.delete(pe)),te.forEach(pe=>Ht(pe)))}function hn(F,O,q){var te,pe;let{flushSync:we}=q===void 0?{}:q,Se=Z.actionData!=null&&Z.navigation.formMethod!=null&&Gs(Z.navigation.formMethod)&&Z.navigation.state==="loading"&&((te=F.state)==null?void 0:te._isRedirect)!==!0,ge;O.actionData?Object.keys(O.actionData).length>0?ge=O.actionData:ge=null:Se?ge=Z.actionData:ge=null;let Pe=O.loaderData?pS(Z.loaderData,O.loaderData,O.matches||[],O.errors):Z.loaderData,Ye=Z.blockers;Ye.size>0&&(Ye=new Map(Ye),Ye.forEach((Pt,en)=>Ye.set(en,m0)));let Ke=xe===!0||Z.navigation.formMethod!=null&&Gs(Z.navigation.formMethod)&&((pe=F.state)==null?void 0:pe._isRedirect)!==!0;l&&(h=l,l=void 0),Re||ne===li.Pop||(ne===li.Push?t.history.push(F,F.state):ne===li.Replace&&t.history.replace(F,F.state));let Xe;if(ne===li.Pop){let Pt=Te.get(Z.location.pathname);Pt&&Pt.has(F.pathname)?Xe={currentLocation:Z.location,nextLocation:F}:Te.has(F.pathname)&&(Xe={currentLocation:F,nextLocation:Z.location})}else if(J){let Pt=Te.get(Z.location.pathname);Pt?Pt.add(F.pathname):(Pt=new Set([F.pathname]),Te.set(Z.location.pathname,Pt)),Xe={currentLocation:Z.location,nextLocation:F}}Nn(ti({},O,{actionData:ge,loaderData:Pe,historyAction:ne,location:F,initialized:!0,navigation:m_,revalidation:"idle",restoreScrollPosition:bt(F,O.matches||Z.matches),preventScrollReset:Ke,blockers:Ye}),{viewTransitionOpts:Xe,flushSync:we===!0}),ne=li.Pop,xe=!1,J=!1,Re=!1,We=!1,ct=[],gt=[]}async function Gn(F,O){if(typeof F=="number"){t.history.go(F);return}let q=l2(Z.location,Z.matches,m,_.v7_prependBasename,F,_.v7_relativeSplatPath,O==null?void 0:O.fromRouteId,O==null?void 0:O.relative),{path:te,submission:pe,error:we}=lS(_.v7_normalizeFormMethod,!1,q,O),Se=Z.location,ge=fp(Z.location,te,O&&O.state);ge=ti({},ge,t.history.encodeLocation(ge));let Pe=O&&O.replace!=null?O.replace:void 0,Ye=li.Push;Pe===!0?Ye=li.Replace:Pe===!1||pe!=null&&Gs(pe.formMethod)&&pe.formAction===Z.location.pathname+Z.location.search&&(Ye=li.Replace);let Ke=O&&"preventScrollReset"in O?O.preventScrollReset===!0:void 0,Xe=(O&&O.unstable_flushSync)===!0,Pt=Zt({currentLocation:Se,nextLocation:ge,historyAction:Ye});if(Pt){Ut(Pt,{state:"blocked",location:ge,proceed(){Ut(Pt,{state:"proceeding",proceed:void 0,reset:void 0,location:ge}),Gn(F,O)},reset(){let en=new Map(Z.blockers);en.set(Pt,m0),Nn({blockers:en})}});return}return await un(Ye,ge,{submission:pe,pendingError:we,preventScrollReset:Ke,replace:O&&O.replace,enableViewTransition:O&&O.unstable_viewTransition,flushSync:Xe})}function gn(){if(Tt(),Nn({revalidation:"loading"}),Z.navigation.state!=="submitting"){if(Z.navigation.state==="idle"){un(Z.historyAction,Z.location,{startUninterruptedRevalidation:!0});return}un(ne||Z.historyAction,Z.navigation.location,{overrideNavigation:Z.navigation})}}async function un(F,O,q){ie&&ie.abort(),ie=null,ne=F,Re=(q&&q.startUninterruptedRevalidation)===!0,Qe(Z.location,Z.matches),xe=(q&&q.preventScrollReset)===!0,J=(q&&q.enableViewTransition)===!0;let te=l||h,pe=q&&q.overrideNavigation,we=dd(te,O,m),Se=(q&&q.flushSync)===!0;if(!we){let en=ps(404,{pathname:O.pathname}),{matches:an,route:bn}=mS(te);yn(),hn(O,{matches:an,loaderData:{},errors:{[bn.id]:en}},{flushSync:Se});return}if(Z.initialized&&!We&&J9(Z.location,O)&&!(q&&q.submission&&Gs(q.submission.formMethod))){hn(O,{matches:we},{flushSync:Se});return}ie=new AbortController;let ge=v0(t.history,O,ie.signal,q&&q.submission),Pe,Ye;if(q&&q.pendingError)Ye={[j0(we).route.id]:q.pendingError};else if(q&&q.submission&&Gs(q.submission.formMethod)){let en=await Pn(ge,O,q.submission,we,{replace:q.replace,flushSync:Se});if(en.shortCircuited)return;Pe=en.pendingActionData,Ye=en.pendingActionError,pe=g_(O,q.submission),Se=!1,ge=new Request(ge.url,{signal:ge.signal})}let{shortCircuited:Ke,loaderData:Xe,errors:Pt}=await je(ge,O,we,pe,q&&q.submission,q&&q.fetcherSubmission,q&&q.replace,q&&q.initialHydration===!0,Se,Pe,Ye);Ke||(ie=null,hn(O,ti({matches:we},Pe?{actionData:Pe}:{},{loaderData:Xe,errors:Pt})))}async function Pn(F,O,q,te,pe){pe===void 0&&(pe={}),Tt();let we=nI(O,q);Nn({navigation:we},{flushSync:pe.flushSync===!0});let Se,ge=u2(te,O);if(!ge.route.action&&!ge.route.lazy)Se={type:Qr.error,error:ps(405,{method:F.method,pathname:O.pathname,routeId:ge.route.id})};else if(Se=await g0("action",F,ge,te,c,s,m,_.v7_relativeSplatPath),F.signal.aborted)return{shortCircuited:!0};if(Tu(Se)){let Pe;return pe&&pe.replace!=null?Pe=pe.replace:Pe=Se.location===Z.location.pathname+Z.location.search,await tt(Z,Se,{submission:q,replace:Pe}),{shortCircuited:!0}}if(fd(Se)){let Pe=j0(te,ge.route.id);return(pe&&pe.replace)!==!0&&(ne=li.Push),{pendingActionData:{},pendingActionError:{[Pe.route.id]:Se.error}}}if(Mu(Se))throw ps(400,{type:"defer-action"});return{pendingActionData:{[ge.route.id]:Se.data}}}async function je(F,O,q,te,pe,we,Se,ge,Pe,Ye,Ke){let Xe=te||g_(O,pe),Pt=pe||we||yS(Xe),en=l||h,[an,bn]=cS(t.history,Z,q,Pt,O,_.v7_partialHydration&&ge===!0,We,ct,gt,it,kt,_t,en,m,Ye,Ke);if(yn(It=>!(q&&q.some(tn=>tn.route.id===It))||an&&an.some(tn=>tn.route.id===It)),at=++ke,an.length===0&&bn.length===0){let It=Rn();return hn(O,ti({matches:q,loaderData:{},errors:Ke||null},Ye?{actionData:Ye}:{},It?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Pe}),{shortCircuited:!0}}if(!Re&&(!_.v7_partialHydration||!ge)){bn.forEach(tn=>{let En=Z.fetchers.get(tn.key),nn=y0(void 0,En?En.data:void 0);Z.fetchers.set(tn.key,nn)});let It=Ye||Z.actionData;Nn(ti({navigation:Xe},It?Object.keys(It).length===0?{actionData:null}:{actionData:It}:{},bn.length>0?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Pe})}bn.forEach(It=>{ft.has(It.key)&&He(It.key),It.controller&&ft.set(It.key,It.controller)});let Mn=()=>bn.forEach(It=>He(It.key));ie&&ie.signal.addEventListener("abort",Mn);let{results:sr,loaderResults:ue,fetcherResults:Ne}=await vt(Z.matches,q,an,bn,F);if(F.signal.aborted)return{shortCircuited:!0};ie&&ie.signal.removeEventListener("abort",Mn),bn.forEach(It=>ft.delete(It.key));let Ve=gS(sr);if(Ve){if(Ve.idx>=an.length){let It=bn[Ve.idx-an.length].key;_t.add(It)}return await tt(Z,Ve.result,{replace:Se}),{shortCircuited:!0}}let{loaderData:$e,errors:Ze}=fS(Z,q,an,ue,Ke,bn,Ne,Mt);Mt.forEach((It,tn)=>{It.subscribe(En=>{(En||It.done)&&Mt.delete(tn)})}),_.v7_partialHydration&&ge&&Z.errors&&Object.entries(Z.errors).filter(It=>{let[tn]=It;return!an.some(En=>En.route.id===tn)}).forEach(It=>{let[tn,En]=It;Ze=Object.assign(Ze||{},{[tn]:En})});let Lt=Rn(),Wt=xn(at),Kt=Lt||Wt||bn.length>0;return ti({loaderData:$e,errors:Ze},Kt?{fetchers:new Map(Z.fetchers)}:{})}function qn(F,O,q,te){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");ft.has(F)&&He(F);let pe=(te&&te.unstable_flushSync)===!0,we=l||h,Se=l2(Z.location,Z.matches,m,_.v7_prependBasename,q,_.v7_relativeSplatPath,O,te==null?void 0:te.relative),ge=dd(we,Se,m);if(!ge){pn(F,O,ps(404,{pathname:Se}),{flushSync:pe});return}let{path:Pe,submission:Ye,error:Ke}=lS(_.v7_normalizeFormMethod,!0,Se,te);if(Ke){pn(F,O,Ke,{flushSync:pe});return}let Xe=u2(ge,Pe);if(xe=(te&&te.preventScrollReset)===!0,Ye&&Gs(Ye.formMethod)){Ae(F,O,Pe,Xe,ge,pe,Ye);return}kt.set(F,{routeId:O,path:Pe}),se(F,O,Pe,Xe,ge,pe,Ye)}async function Ae(F,O,q,te,pe,we,Se){if(Tt(),kt.delete(F),!te.route.action&&!te.route.lazy){let tn=ps(405,{method:Se.formMethod,pathname:q,routeId:O});pn(F,O,tn,{flushSync:we});return}let ge=Z.fetchers.get(F);wt(F,rI(Se,ge),{flushSync:we});let Pe=new AbortController,Ye=v0(t.history,q,Pe.signal,Se);ft.set(F,Pe);let Ke=ke,Xe=await g0("action",Ye,te,pe,c,s,m,_.v7_relativeSplatPath);if(Ye.signal.aborted){ft.get(F)===Pe&&ft.delete(F);return}if(_.v7_fetcherPersist&&it.has(F)){if(Tu(Xe)||fd(Xe)){wt(F,tc(void 0));return}}else{if(Tu(Xe))if(ft.delete(F),at>Ke){wt(F,tc(void 0));return}else return _t.add(F),wt(F,y0(Se)),tt(Z,Xe,{fetcherSubmission:Se});if(fd(Xe)){pn(F,O,Xe.error);return}}if(Mu(Xe))throw ps(400,{type:"defer-action"});let Pt=Z.navigation.location||Z.location,en=v0(t.history,Pt,Pe.signal),an=l||h,bn=Z.navigation.state!=="idle"?dd(an,Z.navigation.location,m):Z.matches;tr(bn,"Didn't find any matches after fetcher action");let Mn=++ke;ot.set(F,Mn);let sr=y0(Se,Xe.data);Z.fetchers.set(F,sr);let[ue,Ne]=cS(t.history,Z,bn,Se,Pt,!1,We,ct,gt,it,kt,_t,an,m,{[te.route.id]:Xe.data},void 0);Ne.filter(tn=>tn.key!==F).forEach(tn=>{let En=tn.key,nn=Z.fetchers.get(En),yr=y0(void 0,nn?nn.data:void 0);Z.fetchers.set(En,yr),ft.has(En)&&He(En),tn.controller&&ft.set(En,tn.controller)}),Nn({fetchers:new Map(Z.fetchers)});let Ve=()=>Ne.forEach(tn=>He(tn.key));Pe.signal.addEventListener("abort",Ve);let{results:$e,loaderResults:Ze,fetcherResults:Lt}=await vt(Z.matches,bn,ue,Ne,en);if(Pe.signal.aborted)return;Pe.signal.removeEventListener("abort",Ve),ot.delete(F),ft.delete(F),Ne.forEach(tn=>ft.delete(tn.key));let Wt=gS($e);if(Wt){if(Wt.idx>=ue.length){let tn=Ne[Wt.idx-ue.length].key;_t.add(tn)}return tt(Z,Wt.result)}let{loaderData:Kt,errors:It}=fS(Z,Z.matches,ue,Ze,void 0,Ne,Lt,Mt);if(Z.fetchers.has(F)){let tn=tc(Xe.data);Z.fetchers.set(F,tn)}xn(Mn),Z.navigation.state==="loading"&&Mn>at?(tr(ne,"Expected pending action"),ie&&ie.abort(),hn(Z.navigation.location,{matches:bn,loaderData:Kt,errors:It,fetchers:new Map(Z.fetchers)})):(Nn({errors:It,loaderData:pS(Z.loaderData,Kt,bn,It),fetchers:new Map(Z.fetchers)}),We=!1)}async function se(F,O,q,te,pe,we,Se){let ge=Z.fetchers.get(F);wt(F,y0(Se,ge?ge.data:void 0),{flushSync:we});let Pe=new AbortController,Ye=v0(t.history,q,Pe.signal);ft.set(F,Pe);let Ke=ke,Xe=await g0("loader",Ye,te,pe,c,s,m,_.v7_relativeSplatPath);if(Mu(Xe)&&(Xe=await PE(Xe,Ye.signal,!0)||Xe),ft.get(F)===Pe&&ft.delete(F),!Ye.signal.aborted){if(it.has(F)){wt(F,tc(void 0));return}if(Tu(Xe))if(at>Ke){wt(F,tc(void 0));return}else{_t.add(F),await tt(Z,Xe);return}if(fd(Xe)){pn(F,O,Xe.error);return}tr(!Mu(Xe),"Unhandled fetcher deferred data"),wt(F,tc(Xe.data))}}async function tt(F,O,q){let{submission:te,fetcherSubmission:pe,replace:we}=q===void 0?{}:q;O.revalidate&&(We=!0);let Se=fp(F.location,O.location,{_isRedirect:!0});if(tr(Se,"Expected a location on the redirect navigation"),n){let Pt=!1;if(O.reloadDocument)Pt=!0;else if(TE.test(O.location)){const en=t.history.createURL(O.location);Pt=en.origin!==e.location.origin||fl(en.pathname,m)==null}if(Pt){we?e.location.replace(O.location):e.location.assign(O.location);return}}ie=null;let ge=we===!0?li.Replace:li.Push,{formMethod:Pe,formAction:Ye,formEncType:Ke}=F.navigation;!te&&!pe&&Pe&&Ye&&Ke&&(te=yS(F.navigation));let Xe=te||pe;if(j9.has(O.status)&&Xe&&Gs(Xe.formMethod))await un(ge,Se,{submission:ti({},Xe,{formAction:O.location}),preventScrollReset:xe});else{let Pt=g_(Se,te);await un(ge,Se,{overrideNavigation:Pt,fetcherSubmission:pe,preventScrollReset:xe})}}async function vt(F,O,q,te,pe){let we=await Promise.all([...q.map(Pe=>g0("loader",pe,Pe,O,c,s,m,_.v7_relativeSplatPath)),...te.map(Pe=>Pe.matches&&Pe.match&&Pe.controller?g0("loader",v0(t.history,Pe.path,Pe.controller.signal),Pe.match,Pe.matches,c,s,m,_.v7_relativeSplatPath):{type:Qr.error,error:ps(404,{pathname:Pe.path})})]),Se=we.slice(0,q.length),ge=we.slice(q.length);return await Promise.all([vS(F,q,Se,Se.map(()=>pe.signal),!1,Z.loaderData),vS(F,te.map(Pe=>Pe.match),ge,te.map(Pe=>Pe.controller?Pe.controller.signal:null),!0)]),{results:we,loaderResults:Se,fetcherResults:ge}}function Tt(){We=!0,ct.push(...yn()),kt.forEach((F,O)=>{ft.has(O)&&(gt.push(O),He(O))})}function wt(F,O,q){q===void 0&&(q={}),Z.fetchers.set(F,O),Nn({fetchers:new Map(Z.fetchers)},{flushSync:(q&&q.flushSync)===!0})}function pn(F,O,q,te){te===void 0&&(te={});let pe=j0(Z.matches,O);Ht(F),Nn({errors:{[pe.route.id]:q},fetchers:new Map(Z.fetchers)},{flushSync:(te&&te.flushSync)===!0})}function Gt(F){return _.v7_fetcherPersist&&(Cn.set(F,(Cn.get(F)||0)+1),it.has(F)&&it.delete(F)),Z.fetchers.get(F)||W9}function Ht(F){let O=Z.fetchers.get(F);ft.has(F)&&!(O&&O.state==="loading"&&ot.has(F))&&He(F),kt.delete(F),ot.delete(F),_t.delete(F),it.delete(F),Z.fetchers.delete(F)}function Ln(F){if(_.v7_fetcherPersist){let O=(Cn.get(F)||0)-1;O<=0?(Cn.delete(F),it.add(F)):Cn.set(F,O)}else Ht(F);Nn({fetchers:new Map(Z.fetchers)})}function He(F){let O=ft.get(F);tr(O,"Expected fetch controller: "+F),O.abort(),ft.delete(F)}function on(F){for(let O of F){let q=Gt(O),te=tc(q.data);Z.fetchers.set(O,te)}}function Rn(){let F=[],O=!1;for(let q of _t){let te=Z.fetchers.get(q);tr(te,"Expected fetcher: "+q),te.state==="loading"&&(_t.delete(q),F.push(q),O=!0)}return on(F),O}function xn(F){let O=[];for(let[q,te]of ot)if(te<F){let pe=Z.fetchers.get(q);tr(pe,"Expected fetcher: "+q),pe.state==="loading"&&(He(q),ot.delete(q),O.push(q))}return on(O),O.length>0}function Qt(F,O){let q=Z.blockers.get(F)||m0;return Ft.get(F)!==O&&Ft.set(F,O),q}function lt(F){Z.blockers.delete(F),Ft.delete(F)}function Ut(F,O){let q=Z.blockers.get(F)||m0;tr(q.state==="unblocked"&&O.state==="blocked"||q.state==="blocked"&&O.state==="blocked"||q.state==="blocked"&&O.state==="proceeding"||q.state==="blocked"&&O.state==="unblocked"||q.state==="proceeding"&&O.state==="unblocked","Invalid blocker state transition: "+q.state+" -> "+O.state);let te=new Map(Z.blockers);te.set(F,O),Nn({blockers:te})}function Zt(F){let{currentLocation:O,nextLocation:q,historyAction:te}=F;if(Ft.size===0)return;Ft.size>1&&Bu(!1,"A router only supports one blocker at a time");let pe=Array.from(Ft.entries()),[we,Se]=pe[pe.length-1],ge=Z.blockers.get(we);if(!(ge&&ge.state==="proceeding")&&Se({currentLocation:O,nextLocation:q,historyAction:te}))return we}function yn(F){let O=[];return Mt.forEach((q,te)=>{(!F||F(te))&&(q.cancel(),O.push(te),Mt.delete(te))}),O}function Q(F,O,q){if(M=F,N=O,I=q||null,!B&&Z.navigation===m_){B=!0;let te=bt(Z.location,Z.matches);te!=null&&Nn({restoreScrollPosition:te})}return()=>{M=null,N=null,I=null}}function ze(F,O){return I&&I(F,O.map(te=>w9(te,Z.loaderData)))||F.key}function Qe(F,O){if(M&&N){let q=ze(F,O);M[q]=N()}}function bt(F,O){if(M){let q=ze(F,O),te=M[q];if(typeof te=="number")return te}return null}function ae(F){c={},l=s2(F,s,void 0,c)}return he={get basename(){return m},get future(){return _},get state(){return Z},get routes(){return h},get window(){return e},initialize:Sn,subscribe:qe,enableScrollRestoration:Q,navigate:Gn,fetch:qn,revalidate:gn,createHref:F=>t.history.createHref(F),encodeLocation:F=>t.history.encodeLocation(F),getFetcher:Gt,deleteFetcher:Ln,dispose:Dn,getBlocker:Qt,deleteBlocker:lt,_internalFetchControllers:ft,_internalActiveDeferreds:Mt,_internalSetRoutes:ae},he}function X9(t){return t!=null&&("formData"in t&&t.formData!=null||"body"in t&&t.body!==void 0)}function l2(t,e,n,r,s,c,h,l){let m,_;if(h){m=[];for(let T of e)if(m.push(T),T.route.id===h){_=T;break}}else m=e,_=e[e.length-1];let S=Lb(s||".",kb(m,c),fl(t.pathname,n)||t.pathname,l==="path");return s==null&&(S.search=t.search,S.hash=t.hash),(s==null||s===""||s===".")&&_&&_.route.index&&!Fb(S.search)&&(S.search=S.search?S.search.replace(/^\?/,"?index&"):"?index"),r&&n!=="/"&&(S.pathname=S.pathname==="/"?n:sl([n,S.pathname])),Ou(S)}function lS(t,e,n,r){if(!r||!X9(r))return{path:n};if(r.formMethod&&!tI(r.formMethod))return{path:n,error:ps(405,{method:r.formMethod})};let s=()=>({path:n,error:ps(400,{type:"invalid-body"})}),c=r.formMethod||"get",h=t?c.toUpperCase():c.toLowerCase(),l=CE(n);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!Gs(h))return s();let M=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((I,N)=>{let[B,k]=N;return""+I+B+"="+k+`
`},""):String(r.body);return{path:n,submission:{formMethod:h,formAction:l,formEncType:r.formEncType,formData:void 0,json:void 0,text:M}}}else if(r.formEncType==="application/json"){if(!Gs(h))return s();try{let M=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:n,submission:{formMethod:h,formAction:l,formEncType:r.formEncType,formData:void 0,json:M,text:void 0}}}catch{return s()}}}tr(typeof FormData=="function","FormData is not available in this environment");let m,_;if(r.formData)m=c2(r.formData),_=r.formData;else if(r.body instanceof FormData)m=c2(r.body),_=r.body;else if(r.body instanceof URLSearchParams)m=r.body,_=dS(m);else if(r.body==null)m=new URLSearchParams,_=new FormData;else try{m=new URLSearchParams(r.body),_=dS(m)}catch{return s()}let S={formMethod:h,formAction:l,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:_,json:void 0,text:void 0};if(Gs(S.formMethod))return{path:n,submission:S};let T=So(n);return e&&T.search&&Fb(T.search)&&m.append("index",""),T.search="?"+m,{path:Ou(T),submission:S}}function Z9(t,e){let n=t;if(e){let r=t.findIndex(s=>s.route.id===e);r>=0&&(n=t.slice(0,r))}return n}function cS(t,e,n,r,s,c,h,l,m,_,S,T,M,I,N,B){let k=B?Object.values(B)[0]:N?Object.values(N)[0]:void 0,C=t.createURL(e.location),U=t.createURL(s),V=B?Object.keys(B)[0]:void 0,he=Z9(n,V).filter((ne,xe)=>{let{route:ie}=ne;if(ie.lazy)return!0;if(ie.loader==null)return!1;if(c)return ie.loader.hydrate?!0:e.loaderData[ie.id]===void 0&&(!e.errors||e.errors[ie.id]===void 0);if(Y9(e.loaderData,e.matches[xe],ne)||l.some(Be=>Be===ne.route.id))return!0;let J=e.matches[xe],Te=ne;return uS(ne,ti({currentUrl:C,currentParams:J.params,nextUrl:U,nextParams:Te.params},r,{actionResult:k,defaultShouldRevalidate:h||C.pathname+C.search===U.pathname+U.search||C.search!==U.search||AE(J,Te)}))}),Z=[];return S.forEach((ne,xe)=>{if(c||!n.some(Re=>Re.route.id===ne.routeId)||_.has(xe))return;let ie=dd(M,ne.path,I);if(!ie){Z.push({key:xe,routeId:ne.routeId,path:ne.path,matches:null,match:null,controller:null});return}let J=e.fetchers.get(xe),Te=u2(ie,ne.path),Be=!1;T.has(xe)?Be=!1:m.includes(xe)?Be=!0:J&&J.state!=="idle"&&J.data===void 0?Be=h:Be=uS(Te,ti({currentUrl:C,currentParams:e.matches[e.matches.length-1].params,nextUrl:U,nextParams:n[n.length-1].params},r,{actionResult:k,defaultShouldRevalidate:h})),Be&&Z.push({key:xe,routeId:ne.routeId,path:ne.path,matches:ie,match:Te,controller:new AbortController})}),[he,Z]}function Y9(t,e,n){let r=!e||n.route.id!==e.route.id,s=t[n.route.id]===void 0;return r||s}function AE(t,e){let n=t.route.path;return t.pathname!==e.pathname||n!=null&&n.endsWith("*")&&t.params["*"]!==e.params["*"]}function uS(t,e){if(t.route.shouldRevalidate){let n=t.route.shouldRevalidate(e);if(typeof n=="boolean")return n}return e.defaultShouldRevalidate}async function hS(t,e,n){if(!t.lazy)return;let r=await t.lazy();if(!t.lazy)return;let s=n[t.id];tr(s,"No route found in manifest");let c={};for(let h in r){let m=s[h]!==void 0&&h!=="hasErrorBoundary";Bu(!m,'Route "'+s.id+'" has a static property "'+h+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+h+'" will be ignored.')),!m&&!x9.has(h)&&(c[h]=r[h])}Object.assign(s,c),Object.assign(s,ti({},e(s),{lazy:void 0}))}async function g0(t,e,n,r,s,c,h,l,m){m===void 0&&(m={});let _,S,T,M=B=>{let k,C=new Promise((U,V)=>k=V);return T=()=>k(),e.signal.addEventListener("abort",T),Promise.race([B({request:e,params:n.params,context:m.requestContext}),C])};try{let B=n.route[t];if(n.route.lazy)if(B){let k,C=await Promise.all([M(B).catch(U=>{k=U}),hS(n.route,c,s)]);if(k)throw k;S=C[0]}else if(await hS(n.route,c,s),B=n.route[t],B)S=await M(B);else if(t==="action"){let k=new URL(e.url),C=k.pathname+k.search;throw ps(405,{method:e.method,pathname:C,routeId:n.route.id})}else return{type:Qr.data,data:void 0};else if(B)S=await M(B);else{let k=new URL(e.url),C=k.pathname+k.search;throw ps(404,{pathname:C})}tr(S!==void 0,"You defined "+(t==="action"?"an action":"a loader")+" for route "+('"'+n.route.id+"\" but didn't return anything from your `"+t+"` ")+"function. Please return a value or `null`.")}catch(B){_=Qr.error,S=B}finally{T&&e.signal.removeEventListener("abort",T)}if(eI(S)){let B=S.status;if(G9.has(B)){let C=S.headers.get("Location");if(tr(C,"Redirects returned/thrown from loaders/actions must have a Location header"),!TE.test(C))C=l2(new URL(e.url),r.slice(0,r.indexOf(n)+1),h,!0,C,l);else if(!m.isStaticRequest){let U=new URL(e.url),V=C.startsWith("//")?new URL(U.protocol+C):new URL(C),Y=fl(V.pathname,h)!=null;V.origin===U.origin&&Y&&(C=V.pathname+V.search+V.hash)}if(m.isStaticRequest)throw S.headers.set("Location",C),S;return{type:Qr.redirect,status:B,location:C,revalidate:S.headers.get("X-Remix-Revalidate")!==null,reloadDocument:S.headers.get("X-Remix-Reload-Document")!==null}}if(m.isRouteRequest)throw{type:_===Qr.error?Qr.error:Qr.data,response:S};let k;try{let C=S.headers.get("Content-Type");C&&/\bapplication\/json\b/.test(C)?S.body==null?k=null:k=await S.json():k=await S.text()}catch(C){return{type:Qr.error,error:C}}return _===Qr.error?{type:_,error:new zb(B,S.statusText,k),headers:S.headers}:{type:Qr.data,data:k,statusCode:S.status,headers:S.headers}}if(_===Qr.error)return{type:_,error:S};if(Q9(S)){var I,N;return{type:Qr.deferred,deferredData:S,statusCode:(I=S.init)==null?void 0:I.status,headers:((N=S.init)==null?void 0:N.headers)&&new Headers(S.init.headers)}}return{type:Qr.data,data:S}}function v0(t,e,n,r){let s=t.createURL(CE(e)).toString(),c={signal:n};if(r&&Gs(r.formMethod)){let{formMethod:h,formEncType:l}=r;c.method=h.toUpperCase(),l==="application/json"?(c.headers=new Headers({"Content-Type":l}),c.body=JSON.stringify(r.json)):l==="text/plain"?c.body=r.text:l==="application/x-www-form-urlencoded"&&r.formData?c.body=c2(r.formData):c.body=r.formData}return new Request(s,c)}function c2(t){let e=new URLSearchParams;for(let[n,r]of t.entries())e.append(n,typeof r=="string"?r:r.name);return e}function dS(t){let e=new FormData;for(let[n,r]of t.entries())e.append(n,r);return e}function K9(t,e,n,r,s){let c={},h=null,l,m=!1,_={};return n.forEach((S,T)=>{let M=e[T].route.id;if(tr(!Tu(S),"Cannot handle redirect results in processLoaderData"),fd(S)){let I=j0(t,M),N=S.error;r&&(N=Object.values(r)[0],r=void 0),h=h||{},h[I.route.id]==null&&(h[I.route.id]=N),c[M]=void 0,m||(m=!0,l=SE(S.error)?S.error.status:500),S.headers&&(_[M]=S.headers)}else Mu(S)?(s.set(M,S.deferredData),c[M]=S.deferredData.data):c[M]=S.data,S.statusCode!=null&&S.statusCode!==200&&!m&&(l=S.statusCode),S.headers&&(_[M]=S.headers)}),r&&(h=r,c[Object.keys(r)[0]]=void 0),{loaderData:c,errors:h,statusCode:l||200,loaderHeaders:_}}function fS(t,e,n,r,s,c,h,l){let{loaderData:m,errors:_}=K9(e,n,r,s,l);for(let S=0;S<c.length;S++){let{key:T,match:M,controller:I}=c[S];tr(h!==void 0&&h[S]!==void 0,"Did not find corresponding fetcher result");let N=h[S];if(!(I&&I.signal.aborted))if(fd(N)){let B=j0(t.matches,M==null?void 0:M.route.id);_&&_[B.route.id]||(_=ti({},_,{[B.route.id]:N.error})),t.fetchers.delete(T)}else if(Tu(N))tr(!1,"Unhandled fetcher revalidation redirect");else if(Mu(N))tr(!1,"Unhandled fetcher deferred data");else{let B=tc(N.data);t.fetchers.set(T,B)}}return{loaderData:m,errors:_}}function pS(t,e,n,r){let s=ti({},e);for(let c of n){let h=c.route.id;if(e.hasOwnProperty(h)?e[h]!==void 0&&(s[h]=e[h]):t[h]!==void 0&&c.route.loader&&(s[h]=t[h]),r&&r.hasOwnProperty(h))break}return s}function j0(t,e){return(e?t.slice(0,t.findIndex(r=>r.route.id===e)+1):[...t]).reverse().find(r=>r.route.hasErrorBoundary===!0)||t[0]}function mS(t){let e=t.length===1?t[0]:t.find(n=>n.index||!n.path||n.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function ps(t,e){let{pathname:n,routeId:r,method:s,type:c}=e===void 0?{}:e,h="Unknown Server Error",l="Unknown @remix-run/router error";return t===400?(h="Bad Request",s&&n&&r?l="You made a "+s+' request to "'+n+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":c==="defer-action"?l="defer() is not supported in actions":c==="invalid-body"&&(l="Unable to encode submission body")):t===403?(h="Forbidden",l='Route "'+r+'" does not match URL "'+n+'"'):t===404?(h="Not Found",l='No route matches URL "'+n+'"'):t===405&&(h="Method Not Allowed",s&&n&&r?l="You made a "+s.toUpperCase()+' request to "'+n+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":s&&(l='Invalid request method "'+s.toUpperCase()+'"')),new zb(t||500,h,new Error(l),!0)}function gS(t){for(let e=t.length-1;e>=0;e--){let n=t[e];if(Tu(n))return{result:n,idx:e}}}function CE(t){let e=typeof t=="string"?So(t):t;return Ou(ti({},e,{hash:""}))}function J9(t,e){return t.pathname!==e.pathname||t.search!==e.search?!1:t.hash===""?e.hash!=="":t.hash===e.hash?!0:e.hash!==""}function Mu(t){return t.type===Qr.deferred}function fd(t){return t.type===Qr.error}function Tu(t){return(t&&t.type)===Qr.redirect}function Q9(t){let e=t;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function eI(t){return t!=null&&typeof t.status=="number"&&typeof t.statusText=="string"&&typeof t.headers=="object"&&typeof t.body<"u"}function tI(t){return H9.has(t.toLowerCase())}function Gs(t){return U9.has(t.toLowerCase())}async function vS(t,e,n,r,s,c){for(let h=0;h<n.length;h++){let l=n[h],m=e[h];if(!m)continue;let _=t.find(T=>T.route.id===m.route.id),S=_!=null&&!AE(_,m)&&(c&&c[m.route.id])!==void 0;if(Mu(l)&&(s||S)){let T=r[h];tr(T,"Expected an AbortSignal for revalidating fetcher deferred result"),await PE(l,T,s).then(M=>{M&&(n[h]=M||n[h])})}}}async function PE(t,e,n){if(n===void 0&&(n=!1),!await t.deferredData.resolveData(e)){if(n)try{return{type:Qr.data,data:t.deferredData.unwrappedData}}catch(s){return{type:Qr.error,error:s}}return{type:Qr.data,data:t.deferredData.data}}}function Fb(t){return new URLSearchParams(t).getAll("index").some(e=>e==="")}function u2(t,e){let n=typeof e=="string"?So(e).search:e.search;if(t[t.length-1].route.index&&Fb(n||""))return t[t.length-1];let r=wE(t);return r[r.length-1]}function yS(t){let{formMethod:e,formAction:n,formEncType:r,text:s,formData:c,json:h}=t;if(!(!e||!n||!r)){if(s!=null)return{formMethod:e,formAction:n,formEncType:r,formData:void 0,json:void 0,text:s};if(c!=null)return{formMethod:e,formAction:n,formEncType:r,formData:c,json:void 0,text:void 0};if(h!==void 0)return{formMethod:e,formAction:n,formEncType:r,formData:void 0,json:h,text:void 0}}}function g_(t,e){return e?{state:"loading",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:t,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function nI(t,e){return{state:"submitting",location:t,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function y0(t,e){return t?{state:"loading",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function rI(t,e){return{state:"submitting",formMethod:t.formMethod,formAction:t.formAction,formEncType:t.formEncType,formData:t.formData,json:t.json,text:t.text,data:e?e.data:void 0}}function tc(t){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:t}}function iI(t,e){try{let n=t.sessionStorage.getItem(EE);if(n){let r=JSON.parse(n);for(let[s,c]of Object.entries(r||{}))c&&Array.isArray(c)&&e.set(s,new Set(c||[]))}}catch{}}function aI(t,e){if(e.size>0){let n={};for(let[r,s]of e)n[r]=[...s];try{t.sessionStorage.setItem(EE,JSON.stringify(n))}catch(r){Bu(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function pp(){return pp=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},pp.apply(this,arguments)}const Ip=pt.createContext(null),Nb=pt.createContext(null),kc=pt.createContext(null),xv=pt.createContext(null),Lc=pt.createContext({outlet:null,matches:[],isDataRoute:!1}),RE=pt.createContext(null);function sI(t,e){let{relative:n}=e===void 0?{}:e;Dp()||tr(!1);let{basename:r,navigator:s}=pt.useContext(kc),{hash:c,pathname:h,search:l}=bv(t,{relative:n}),m=h;return r!=="/"&&(m=h==="/"?r:sl([r,h])),s.createHref({pathname:m,search:l,hash:c})}function Dp(){return pt.useContext(xv)!=null}function $d(){return Dp()||tr(!1),pt.useContext(xv).location}function IE(t){pt.useContext(kc).static||pt.useLayoutEffect(t)}function Bb(){let{isDataRoute:t}=pt.useContext(Lc);return t?xI():oI()}function oI(){Dp()||tr(!1);let t=pt.useContext(Ip),{basename:e,future:n,navigator:r}=pt.useContext(kc),{matches:s}=pt.useContext(Lc),{pathname:c}=$d(),h=JSON.stringify(kb(s,n.v7_relativeSplatPath)),l=pt.useRef(!1);return IE(()=>{l.current=!0}),pt.useCallback(function(_,S){if(S===void 0&&(S={}),!l.current)return;if(typeof _=="number"){r.go(_);return}let T=Lb(_,JSON.parse(h),c,S.relative==="path");t==null&&e!=="/"&&(T.pathname=T.pathname==="/"?e:sl([e,T.pathname])),(S.replace?r.replace:r.push)(T,S.state,S)},[e,r,h,c,t])}const lI=pt.createContext(null);function cI(t){let e=pt.useContext(Lc).outlet;return e&&pt.createElement(lI.Provider,{value:t},e)}function bv(t,e){let{relative:n}=e===void 0?{}:e,{future:r}=pt.useContext(kc),{matches:s}=pt.useContext(Lc),{pathname:c}=$d(),h=JSON.stringify(kb(s,r.v7_relativeSplatPath));return pt.useMemo(()=>Lb(t,JSON.parse(h),c,n==="path"),[t,h,c,n])}function uI(t,e,n,r){Dp()||tr(!1);let{navigator:s}=pt.useContext(kc),{matches:c}=pt.useContext(Lc),h=c[c.length-1],l=h?h.params:{};h&&h.pathname;let m=h?h.pathnameBase:"/";h&&h.route;let _=$d(),S;if(e){var T;let k=typeof e=="string"?So(e):e;m==="/"||(T=k.pathname)!=null&&T.startsWith(m)||tr(!1),S=k}else S=_;let M=S.pathname||"/",I=M;if(m!=="/"){let k=m.replace(/^\//,"").split("/");I="/"+M.replace(/^\//,"").split("/").slice(k.length).join("/")}let N=dd(t,{pathname:I}),B=mI(N&&N.map(k=>Object.assign({},k,{params:Object.assign({},l,k.params),pathname:sl([m,s.encodeLocation?s.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?m:sl([m,s.encodeLocation?s.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),c,n,r);return e&&B?pt.createElement(xv.Provider,{value:{location:pp({pathname:"/",search:"",hash:"",state:null,key:"default"},S),navigationType:li.Pop}},B):B}function hI(){let t=_I(),e=SE(t)?t.status+" "+t.statusText:t instanceof Error?t.message:JSON.stringify(t),n=t instanceof Error?t.stack:null,s={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return pt.createElement(pt.Fragment,null,pt.createElement("h2",null,"Unexpected Application Error!"),pt.createElement("h3",{style:{fontStyle:"italic"}},e),n?pt.createElement("pre",{style:s},n):null,null)}const dI=pt.createElement(hI,null);class fI extends pt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,n){return n.location!==e.location||n.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:n.error,location:n.location,revalidation:e.revalidation||n.revalidation}}componentDidCatch(e,n){console.error("React Router caught the following error during render",e,n)}render(){return this.state.error!==void 0?pt.createElement(Lc.Provider,{value:this.props.routeContext},pt.createElement(RE.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pI(t){let{routeContext:e,match:n,children:r}=t,s=pt.useContext(Ip);return s&&s.static&&s.staticContext&&(n.route.errorElement||n.route.ErrorBoundary)&&(s.staticContext._deepestRenderedBoundaryId=n.route.id),pt.createElement(Lc.Provider,{value:e},r)}function mI(t,e,n,r){var s;if(e===void 0&&(e=[]),n===void 0&&(n=null),r===void 0&&(r=null),t==null){var c;if((c=n)!=null&&c.errors)t=n.matches;else return null}let h=t,l=(s=n)==null?void 0:s.errors;if(l!=null){let S=h.findIndex(T=>T.route.id&&(l==null?void 0:l[T.route.id]));S>=0||tr(!1),h=h.slice(0,Math.min(h.length,S+1))}let m=!1,_=-1;if(n&&r&&r.v7_partialHydration)for(let S=0;S<h.length;S++){let T=h[S];if((T.route.HydrateFallback||T.route.hydrateFallbackElement)&&(_=S),T.route.id){let{loaderData:M,errors:I}=n,N=T.route.loader&&M[T.route.id]===void 0&&(!I||I[T.route.id]===void 0);if(T.route.lazy||N){m=!0,_>=0?h=h.slice(0,_+1):h=[h[0]];break}}}return h.reduceRight((S,T,M)=>{let I,N=!1,B=null,k=null;n&&(I=l&&T.route.id?l[T.route.id]:void 0,B=T.route.errorElement||dI,m&&(_<0&&M===0?(bI("route-fallback",!1),N=!0,k=null):_===M&&(N=!0,k=T.route.hydrateFallbackElement||null)));let C=e.concat(h.slice(0,M+1)),U=()=>{let V;return I?V=B:N?V=k:T.route.Component?V=pt.createElement(T.route.Component,null):T.route.element?V=T.route.element:V=S,pt.createElement(pI,{match:T,routeContext:{outlet:S,matches:C,isDataRoute:n!=null},children:V})};return n&&(T.route.ErrorBoundary||T.route.errorElement||M===0)?pt.createElement(fI,{location:n.location,revalidation:n.revalidation,component:B,error:I,children:U(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):U()},null)}var DE=function(t){return t.UseBlocker="useBlocker",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t}(DE||{}),z1=function(t){return t.UseBlocker="useBlocker",t.UseLoaderData="useLoaderData",t.UseActionData="useActionData",t.UseRouteError="useRouteError",t.UseNavigation="useNavigation",t.UseRouteLoaderData="useRouteLoaderData",t.UseMatches="useMatches",t.UseRevalidator="useRevalidator",t.UseNavigateStable="useNavigate",t.UseRouteId="useRouteId",t}(z1||{});function gI(t){let e=pt.useContext(Ip);return e||tr(!1),e}function vI(t){let e=pt.useContext(Nb);return e||tr(!1),e}function yI(t){let e=pt.useContext(Lc);return e||tr(!1),e}function kE(t){let e=yI(),n=e.matches[e.matches.length-1];return n.route.id||tr(!1),n.route.id}function _I(){var t;let e=pt.useContext(RE),n=vI(z1.UseRouteError),r=kE(z1.UseRouteError);return e!==void 0?e:(t=n.errors)==null?void 0:t[r]}function xI(){let{router:t}=gI(DE.UseNavigateStable),e=kE(z1.UseNavigateStable),n=pt.useRef(!1);return IE(()=>{n.current=!0}),pt.useCallback(function(s,c){c===void 0&&(c={}),n.current&&(typeof s=="number"?t.navigate(s):t.navigate(s,pp({fromRouteId:e},c)))},[t,e])}const _S={};function bI(t,e,n){!e&&!_S[t]&&(_S[t]=!0)}function wI(t){return cI(t.context)}function SI(t){let{basename:e="/",children:n=null,location:r,navigationType:s=li.Pop,navigator:c,static:h=!1,future:l}=t;Dp()&&tr(!1);let m=e.replace(/^\/*/,"/"),_=pt.useMemo(()=>({basename:m,navigator:c,static:h,future:pp({v7_relativeSplatPath:!1},l)}),[m,l,c,h]);typeof r=="string"&&(r=So(r));let{pathname:S="/",search:T="",hash:M="",state:I=null,key:N="default"}=r,B=pt.useMemo(()=>{let k=fl(S,m);return k==null?null:{location:{pathname:k,search:T,hash:M,state:I,key:N},navigationType:s}},[m,S,T,M,I,N,s]);return B==null?null:pt.createElement(kc.Provider,{value:_},pt.createElement(xv.Provider,{children:n,value:B}))}new Promise(()=>{});function MI(t){let e={hasErrorBoundary:t.ErrorBoundary!=null||t.errorElement!=null};return t.Component&&Object.assign(e,{element:pt.createElement(t.Component),Component:void 0}),t.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:pt.createElement(t.HydrateFallback),HydrateFallback:void 0}),t.ErrorBoundary&&Object.assign(e,{errorElement:pt.createElement(t.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function zd(){return zd=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},zd.apply(this,arguments)}function LE(t,e){if(t==null)return{};var n={},r=Object.keys(t),s,c;for(c=0;c<r.length;c++)s=r[c],!(e.indexOf(s)>=0)&&(n[s]=t[s]);return n}function TI(t){return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}function EI(t,e){return t.button===0&&(!e||e==="_self")&&!TI(t)}const AI=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],CI=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],PI="6";try{window.__reactRouterVersion=PI}catch{}function RI(t,e){return $9({basename:e==null?void 0:e.basename,future:zd({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:v9({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||II(),routes:t,mapRouteProperties:MI,window:e==null?void 0:e.window}).initialize()}function II(){var t;let e=(t=window)==null?void 0:t.__staticRouterHydrationData;return e&&e.errors&&(e=zd({},e,{errors:DI(e.errors)})),e}function DI(t){if(!t)return null;let e=Object.entries(t),n={};for(let[r,s]of e)if(s&&s.__type==="RouteErrorResponse")n[r]=new zb(s.status,s.statusText,s.data,s.internal===!0);else if(s&&s.__type==="Error"){if(s.__subType){let c=window[s.__subType];if(typeof c=="function")try{let h=new c(s.message);h.stack="",n[r]=h}catch{}}if(n[r]==null){let c=new Error(s.message);c.stack="",n[r]=c}}else n[r]=s;return n}const zE=pt.createContext({isTransitioning:!1}),kI=pt.createContext(new Map),LI="startTransition",xS=aP[LI],zI="flushSync",bS=g9[zI];function FI(t){xS?xS(t):t()}function _0(t){bS?bS(t):t()}class NI{constructor(){this.status="pending",this.promise=new Promise((e,n)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",n(r))}})}}function BI(t){let{fallbackElement:e,router:n,future:r}=t,[s,c]=pt.useState(n.state),[h,l]=pt.useState(),[m,_]=pt.useState({isTransitioning:!1}),[S,T]=pt.useState(),[M,I]=pt.useState(),[N,B]=pt.useState(),k=pt.useRef(new Map),{v7_startTransition:C}=r||{},U=pt.useCallback(ne=>{C?FI(ne):ne()},[C]),V=pt.useCallback((ne,xe)=>{let{deletedFetchers:ie,unstable_flushSync:J,unstable_viewTransitionOpts:Te}=xe;ie.forEach(Re=>k.current.delete(Re)),ne.fetchers.forEach((Re,We)=>{Re.data!==void 0&&k.current.set(We,Re.data)});let Be=n.window==null||typeof n.window.document.startViewTransition!="function";if(!Te||Be){J?_0(()=>c(ne)):U(()=>c(ne));return}if(J){_0(()=>{M&&(S&&S.resolve(),M.skipTransition()),_({isTransitioning:!0,flushSync:!0,currentLocation:Te.currentLocation,nextLocation:Te.nextLocation})});let Re=n.window.document.startViewTransition(()=>{_0(()=>c(ne))});Re.finished.finally(()=>{_0(()=>{T(void 0),I(void 0),l(void 0),_({isTransitioning:!1})})}),_0(()=>I(Re));return}M?(S&&S.resolve(),M.skipTransition(),B({state:ne,currentLocation:Te.currentLocation,nextLocation:Te.nextLocation})):(l(ne),_({isTransitioning:!0,flushSync:!1,currentLocation:Te.currentLocation,nextLocation:Te.nextLocation}))},[n.window,M,S,k,U]);pt.useLayoutEffect(()=>n.subscribe(V),[n,V]),pt.useEffect(()=>{m.isTransitioning&&!m.flushSync&&T(new NI)},[m]),pt.useEffect(()=>{if(S&&h&&n.window){let ne=h,xe=S.promise,ie=n.window.document.startViewTransition(async()=>{U(()=>c(ne)),await xe});ie.finished.finally(()=>{T(void 0),I(void 0),l(void 0),_({isTransitioning:!1})}),I(ie)}},[U,h,S,n.window]),pt.useEffect(()=>{S&&h&&s.location.key===h.location.key&&S.resolve()},[S,M,s.location,h]),pt.useEffect(()=>{!m.isTransitioning&&N&&(l(N.state),_({isTransitioning:!0,flushSync:!1,currentLocation:N.currentLocation,nextLocation:N.nextLocation}),B(void 0))},[m.isTransitioning,N]),pt.useEffect(()=>{},[]);let Y=pt.useMemo(()=>({createHref:n.createHref,encodeLocation:n.encodeLocation,go:ne=>n.navigate(ne),push:(ne,xe,ie)=>n.navigate(ne,{state:xe,preventScrollReset:ie==null?void 0:ie.preventScrollReset}),replace:(ne,xe,ie)=>n.navigate(ne,{replace:!0,state:xe,preventScrollReset:ie==null?void 0:ie.preventScrollReset})}),[n]),he=n.basename||"/",Z=pt.useMemo(()=>({router:n,navigator:Y,static:!1,basename:he}),[n,Y,he]);return pt.createElement(pt.Fragment,null,pt.createElement(Ip.Provider,{value:Z},pt.createElement(Nb.Provider,{value:s},pt.createElement(kI.Provider,{value:k.current},pt.createElement(zE.Provider,{value:m},pt.createElement(SI,{basename:he,location:s.location,navigationType:s.historyAction,navigator:Y,future:{v7_relativeSplatPath:n.future.v7_relativeSplatPath}},s.initialized||n.future.v7_partialHydration?pt.createElement(OI,{routes:n.routes,future:n.future,state:s}):e))))),null)}function OI(t){let{routes:e,future:n,state:r}=t;return uI(e,void 0,r,n)}const UI=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",VI=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,F1=pt.forwardRef(function(e,n){let{onClick:r,relative:s,reloadDocument:c,replace:h,state:l,target:m,to:_,preventScrollReset:S,unstable_viewTransition:T}=e,M=LE(e,AI),{basename:I}=pt.useContext(kc),N,B=!1;if(typeof _=="string"&&VI.test(_)&&(N=_,UI))try{let V=new URL(window.location.href),Y=_.startsWith("//")?new URL(V.protocol+_):new URL(_),he=fl(Y.pathname,I);Y.origin===V.origin&&he!=null?_=he+Y.search+Y.hash:B=!0}catch{}let k=sI(_,{relative:s}),C=GI(_,{replace:h,state:l,target:m,preventScrollReset:S,relative:s,unstable_viewTransition:T});function U(V){r&&r(V),V.defaultPrevented||C(V)}return pt.createElement("a",zd({},M,{href:N||k,onClick:B||c?r:U,ref:n,target:m}))}),x0=pt.forwardRef(function(e,n){let{"aria-current":r="page",caseSensitive:s=!1,className:c="",end:h=!1,style:l,to:m,unstable_viewTransition:_,children:S}=e,T=LE(e,CI),M=bv(m,{relative:T.relative}),I=$d(),N=pt.useContext(Nb),{navigator:B,basename:k}=pt.useContext(kc),C=N!=null&&jI(M)&&_===!0,U=B.encodeLocation?B.encodeLocation(M).pathname:M.pathname,V=I.pathname,Y=N&&N.navigation&&N.navigation.location?N.navigation.location.pathname:null;s||(V=V.toLowerCase(),Y=Y?Y.toLowerCase():null,U=U.toLowerCase()),Y&&k&&(Y=fl(Y,k)||Y);const he=U!=="/"&&U.endsWith("/")?U.length-1:U.length;let Z=V===U||!h&&V.startsWith(U)&&V.charAt(he)==="/",ne=Y!=null&&(Y===U||!h&&Y.startsWith(U)&&Y.charAt(U.length)==="/"),xe={isActive:Z,isPending:ne,isTransitioning:C},ie=Z?r:void 0,J;typeof c=="function"?J=c(xe):J=[c,Z?"active":null,ne?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let Te=typeof l=="function"?l(xe):l;return pt.createElement(F1,zd({},T,{"aria-current":ie,className:J,ref:n,style:Te,to:m,unstable_viewTransition:_}),typeof S=="function"?S(xe):S)});var h2;(function(t){t.UseScrollRestoration="useScrollRestoration",t.UseSubmit="useSubmit",t.UseSubmitFetcher="useSubmitFetcher",t.UseFetcher="useFetcher",t.useViewTransitionState="useViewTransitionState"})(h2||(h2={}));var wS;(function(t){t.UseFetcher="useFetcher",t.UseFetchers="useFetchers",t.UseScrollRestoration="useScrollRestoration"})(wS||(wS={}));function HI(t){let e=pt.useContext(Ip);return e||tr(!1),e}function GI(t,e){let{target:n,replace:r,state:s,preventScrollReset:c,relative:h,unstable_viewTransition:l}=e===void 0?{}:e,m=Bb(),_=$d(),S=bv(t,{relative:h});return pt.useCallback(T=>{if(EI(T,n)){T.preventDefault();let M=r!==void 0?r:Ou(_)===Ou(S);m(t,{replace:M,state:s,preventScrollReset:c,relative:h,unstable_viewTransition:l})}},[_,m,S,r,s,n,t,c,h,l])}function jI(t,e){e===void 0&&(e={});let n=pt.useContext(zE);n==null&&tr(!1);let{basename:r}=HI(h2.useViewTransitionState),s=bv(t,{relative:e.relative});if(!n.isTransitioning)return!1;let c=fl(n.currentLocation.pathname,r)||n.currentLocation.pathname,h=fl(n.nextLocation.pathname,r)||n.nextLocation.pathname;return o2(s.pathname,h)!=null||o2(s.pathname,c)!=null}function FE(t){return me.jsx("div",{className:"body",children:t.children})}function wv(t){return me.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[me.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:t.heroBackground}),me.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",color:"var(--white)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",textAlign:"center"},children:[me.jsx("h1",{children:t.title}),me.jsx("h3",{children:t.subtitle})]})]})}const mp=7;function WI(t,e){switch(e){case t.FLOAT:return 4;case t.UNSIGNED_BYTE:return 1;case t.BYTE:case t.SHORT:case t.UNSIGNED_SHORT:default:throw new Error(`Unknown type ${e}`)}}class SS{constructor(e,n){ht(this,"program");this.gl=e,this.config=n;const r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,n.vertexSource),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));const s=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(s,n.fragmentSource),e.compileShader(s),!e.getShaderParameter(s,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(s));const c=e.createProgram();if(e.attachShader(c,r),e.attachShader(c,s),n.transformFeedbackVaryings&&e.transformFeedbackVaryings(c,n.transformFeedbackVaryings,e.SEPARATE_ATTRIBS),e.linkProgram(c),!e.getProgramParameter(c,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(c));e.detachShader(c,r),e.deleteShader(r),e.detachShader(c,s),e.deleteShader(s),this.program=c}getAttributeLocation(e){return this.gl.getAttribLocation(this.program,e)}getUniformLocation(e){return this.gl.getUniformLocation(this.program,e)}setUniformValue(e,n,r){const s=this.gl,c=this.getUniformLocation(e);switch(n){case"bool":s.uniform1i(c,r[0]);break;case"bvec2":s.uniform2i(c,r[0],r[1]);break;case"bvec3":s.uniform3i(c,r[0],r[1],r[2]);break;case"bvec4":s.uniform4i(c,r[0],r[1],r[2],r[3]);break;case"bool[]":s.uniform1iv(c,r);break;case"bvec2[]":s.uniform2iv(c,r);break;case"bvec3[]":s.uniform3iv(c,r);break;case"bvec4[]":s.uniform4iv(c,r);break;case"int":s.uniform1i(c,r[0]);break;case"ivec2":s.uniform2i(c,r[0],r[1]);break;case"ivec3":s.uniform3i(c,r[0],r[1],r[2]);break;case"ivec4":s.uniform4i(c,r[0],r[1],r[2],r[3]);break;case"int[]":s.uniform1iv(c,r);break;case"ivec2[]":s.uniform2iv(c,r);break;case"ivec3[]":s.uniform3iv(c,r);break;case"ivec4[]":s.uniform4iv(c,r);break;case"float":s.uniform1f(c,r[0]);break;case"vec2":s.uniform2f(c,r[0],r[1]);break;case"vec3":s.uniform3f(c,r[0],r[1],r[2]);break;case"vec4":s.uniform4f(c,r[0],r[1],r[2],r[3]);break;case"float[]":s.uniform1fv(c,r);break;case"vec2[]":s.uniform2fv(c,r);break;case"vec3[]":s.uniform3fv(c,r);break;case"vec4[]":s.uniform4fv(c,r);break;case"mat2":s.uniformMatrix2fv(c,!1,r);break;case"mat3":s.uniformMatrix3fv(c,!1,r);break;case"mat4":s.uniformMatrix4fv(c,!1,r);break;default:throw Error(`Type ${n} not implemented.`)}}destroy(){this.gl.deleteProgram(this.program)}}class mo{constructor(e,n){ht(this,"buffer");ht(this,"dataPointType");this.gl=e,this.config=n;const r=e.createBuffer();if(e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,n.data,n.changesOften?e.DYNAMIC_DRAW:e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.buffer=r,n.data.BYTES_PER_ELEMENT===4)this.dataPointType=e.FLOAT;else if(n.data.BYTES_PER_ELEMENT===2)this.dataPointType=e.UNSIGNED_SHORT;else if(n.data.BYTES_PER_ELEMENT===1)this.dataPointType=e.UNSIGNED_BYTE;else throw new Error("Buffer data may be Float32Array(gl.FLOAT), UInt16Array(gl.UNSIGNED_SHORT) or UInt8Array(gl.UNSIGNED_BYTE)")}updateData(e){const n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,this.buffer),n.bufferData(n.ARRAY_BUFFER,e,this.config.changesOften?n.DYNAMIC_DRAW:n.STATIC_DRAW),n.bindBuffer(n.ARRAY_BUFFER,null),this.config.data=e}destroy(){this.gl.deleteBuffer(this.buffer)}getBufferContent(){const e=this.gl,n=this.config.data.length;let r;if(this.config.data instanceof Float32Array&&(r=new Float32Array(n)),this.config.data instanceof Uint16Array&&(r=new Uint16Array(n)),this.config.data instanceof Uint8Array)r=new Uint8Array(n);else throw Error("This should not have happened: this buffer does not seem to have a numeric array as data.");return e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.buffer),e.getBufferSubData(e.TRANSFORM_FEEDBACK_BUFFER,0,r),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),r}}let gp=class{constructor(e,n,r,s,c,h,l,m,_,S){this.gl=e,this.textureType=n,this.texture=r,this.level=s,this.internalformat=c,this.format=h,this.type=l,this.width=m,this.height=_,this.border=S}static getTextureParas(e,n,r){switch(n){case"ubyte1":return{internalFormat:e.LUMINANCE,format:e.LUMINANCE,type:e.UNSIGNED_BYTE,binData:new Uint8Array(r),allowsInterpolation:!0,allowsRenderingTo:!0};case"ubyte4":return{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE,binData:new Uint8Array(r),allowsInterpolation:!0,allowsRenderingTo:!0};case"byte32":return{internalFormat:e.RGBA32I,format:e.RGBA_INTEGER,type:e.INT,binData:new Int32Array(r),allowsInterpolation:!1,allowsRenderingTo:!0};case"float1":return{internalFormat:e.R32F,format:e.RED,type:e.FLOAT,binData:new Float32Array(r),allowsInterpolation:!1,allowsRenderingTo:!1};case"float4":return{internalFormat:e.RGBA32F,format:e.RGBA,type:e.FLOAT,binData:new Float32Array(r),allowsInterpolation:!1,allowsRenderingTo:!1}}}destroy(){this.gl.deleteTexture(this.texture)}getCurrentPixels(e){const n=this.gl,r=this.format,s=this.type;let c;if(s===n.UNSIGNED_BYTE)c=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);else if(s===n.UNSIGNED_SHORT_5_6_5||s===n.UNSIGNED_SHORT_4_4_4_4||s===n.UNSIGNED_SHORT_5_5_5_1)c=new Uint16Array(n.drawingBufferWidth*n.drawingBufferHeight*4);else if(s===n.FLOAT)c=new Float32Array(n.drawingBufferWidth*n.drawingBufferHeight*4);else throw new Error(`Did not understand pixel data type ${s} for format ${r}`);if(n.bindFramebuffer(n.FRAMEBUFFER,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,this.texture,0),n.checkFramebufferStatus(n.FRAMEBUFFER)==n.FRAMEBUFFER_COMPLETE)return n.bindFramebuffer(n.FRAMEBUFFER,e),n.readPixels(0,0,this.width,this.height,r,s,c),n.bindFramebuffer(n.FRAMEBUFFER,null),c}};class ki extends gp{constructor(e,n){n.edges||(n.edges="clamp"),n.interpolate||(n.interpolate="none"),n.mipmaps||(n.mipmaps=!1);const r=e.createTexture();if(!r)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+mp),e.bindTexture(e.TEXTURE_2D,r);const s=0,c=e.RGBA,h=e.RGBA,l=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,s,c,h,l,n.image),n.mipmaps&&e.generateMipmap(e.TEXTURE_2D),n.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):n.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),n.interpolate==="linear"?(n.mipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):n.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,null);let m,_;n.image instanceof HTMLImageElement?(m=n.image.naturalWidth,_=n.image.naturalHeight):(m=n.image.width,_=n.image.height),super(e,"ubyte4",r,s,c,h,l,m,_,0),this.config=n}static async loadImage(e){const n=new Image;return n.src=e,await n.decode(),n}}class MS extends gp{constructor(e,n){n.edges||(n.edges="clamp"),n.interpolate||(n.interpolate="none");const{data:r,t:s}=n,c=e.createTexture();if(!c)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+mp),e.bindTexture(e.TEXTURE_2D,c);let h=0,l=0,m=0,_=[];Array.isArray(r)?(h=r.length,l=r[0].length,m=r[0][0].length,_=r.flat().flat()):(h=r.height,l=r.width,m=r.channels,_=Array.from(r.data));const S=0,T=0,M=gp.getTextureParas(e,s,_);if(m!==4&&e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,S,M.internalFormat,l,h,T,M.format,M.type,M.binData),n.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):n.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),n.interpolate==="linear"){if(!M.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else n.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,s,c,S,M.internalFormat,M.format,M.type,l,h,T),this.config=n}}class ho extends gp{constructor(e,n){const{width:r,height:s,type:c,edges:h,interpolate:l}=n;if(r<=0||s<=0)throw new Error("Width and height must be positive.");const m=e.createTexture();if(!m)throw new Error("No texture was created");const _=gp.getTextureParas(e,c,[]);if(e.activeTexture(e.TEXTURE0+mp),e.bindTexture(e.TEXTURE_2D,m),e.texImage2D(e.TEXTURE_2D,0,_.internalFormat,r,s,0,_.format,_.type,null),h==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):h==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),l==="linear"){if(!_.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else l==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,c,m,0,_.internalFormat,_.format,_.type,r,s,0),this.config=n}}class NE{constructor(e){ht(this,"attachedBuffers",{});ht(this,"indexBuffer");this.gl=e}attachBuffer(e,n){const r=this.gl,s=WI(r,e.dataPointType),c=n.location,h=n.nrInstances,l=n.normalize;switch(n.type){case"float":r.enableVertexAttribArray(c),r.vertexAttribPointer(c,1,e.dataPointType,l,1*s,0),h&&r.vertexAttribDivisor(c,h);break;case"vec2":r.enableVertexAttribArray(c),r.vertexAttribPointer(c,2,e.dataPointType,l,2*s,0),h&&r.vertexAttribDivisor(c,h);break;case"vec3":r.enableVertexAttribArray(c),r.vertexAttribPointer(c,3,e.dataPointType,l,3*s,0),h&&r.vertexAttribDivisor(c,h);break;case"vec4":r.enableVertexAttribArray(c),r.vertexAttribPointer(c,4,e.dataPointType,l,4*s,0),h&&r.vertexAttribDivisor(c,h);break;case"mat2":r.enableVertexAttribArray(c+0),r.vertexAttribPointer(c+0,2,e.dataPointType,l,4*s,0*2*s),h&&r.vertexAttribDivisor(c,h),r.enableVertexAttribArray(c+1),r.vertexAttribPointer(c+1,2,e.dataPointType,l,4*s,1*2*s),h&&r.vertexAttribDivisor(c+1,h);break;case"mat3":r.enableVertexAttribArray(c+0),r.vertexAttribPointer(c+0,3,e.dataPointType,l,9*s,0*3*s),h&&r.vertexAttribDivisor(c,h),r.enableVertexAttribArray(c+1),r.vertexAttribPointer(c+1,3,e.dataPointType,l,9*s,1*3*s),h&&r.vertexAttribDivisor(c+1,h),r.enableVertexAttribArray(c+2),r.vertexAttribPointer(c+2,3,e.dataPointType,l,9*s,2*3*s),h&&r.vertexAttribDivisor(c+2,h);break;case"mat4":r.enableVertexAttribArray(c+0),r.vertexAttribPointer(c+0,4,e.dataPointType,l,16*s,0*4*s),h&&r.vertexAttribDivisor(c,h),r.enableVertexAttribArray(c+1),r.vertexAttribPointer(c+1,4,e.dataPointType,l,16*s,1*4*s),h&&r.vertexAttribDivisor(c+1,h),r.enableVertexAttribArray(c+2),r.vertexAttribPointer(c+2,4,e.dataPointType,l,16*s,2*4*s),h&&r.vertexAttribDivisor(c+2,h),r.enableVertexAttribArray(c+3),r.vertexAttribPointer(c+3,4,e.dataPointType,l,16*s,3*4*s),h&&r.vertexAttribDivisor(c+3,h);break}this.attachedBuffers[n.location]={buffer:e,config:n}}detachBuffer(e){for(const[n,r]of Object.entries(this.attachedBuffers))r.buffer===e&&this.gl.disableVertexAttribArray(r.config.location)}attachIndexBuffer(e){const n=this.gl,r=n.createBuffer();n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,r),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e,n.STATIC_DRAW),this.indexBuffer=r}}class qI extends NE{constructor(n,r){super(n);ht(this,"vertexArray");this.config=r;const s=n.createVertexArray();this.vertexArray=s}destroy(n=!1){if(n){for(const[r,s]of Object.entries(this.attachedBuffers))this.detachBuffer(s.buffer),s.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}this.gl.deleteVertexArray(this.vertexArray)}}class $I extends NE{constructor(e,n){super(e),this.config=n}destroy(e=!1){if(e){for(const[n,r]of Object.entries(this.attachedBuffers))this.detachBuffer(r.buffer),r.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}}}class BE{constructor(e){ht(this,"boundBuffers",[]);this.gl=e}attachBuffer(e,n){const r=n??this.boundBuffers.length;this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,r,e.buffer)}detachBuffer(e){const n=this.boundBuffers.indexOf(e);this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,n,null)}}class XI extends BE{constructor(n,r){super(n);ht(this,"transformFeedback");this.config=r;const s=n.createTransformFeedback();this.transformFeedback=s}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(n=!1){if(n)for(const r of this.boundBuffers)this.detachBuffer(r),r.destroy();this.gl.deleteTransformFeedback(this.transformFeedback)}}class ZI extends BE{constructor(e,n){super(e),this.config=n}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(e=!1){if(e)for(const n of this.boundBuffers)this.detachBuffer(n),n.destroy()}}class TS{constructor(e,n){ht(this,"frameBuffer");ht(this,"boundTextures",[]);ht(this,"boundDepthRenderBuffer");this.gl=e,this.config=n;const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),this.frameBuffer=r}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawBuffers(this.getBufferNames())}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}attachTexture(e,n=0){const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+n,r.TEXTURE_2D,e.texture,0),this.boundTextures[n]=e}attachDepthRenderBuffer(e){const n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,e.renderBuffer),this.boundDepthRenderBuffer=e}getBufferNames(){const e=[];for(let n=0;n<this.boundTextures.length;n++)n===0&&e.push(this.gl.COLOR_ATTACHMENT0),n===1&&e.push(this.gl.COLOR_ATTACHMENT1),n===2&&e.push(this.gl.COLOR_ATTACHMENT2),n===3&&e.push(this.gl.COLOR_ATTACHMENT3),n===4&&e.push(this.gl.COLOR_ATTACHMENT4),n===5&&e.push(this.gl.COLOR_ATTACHMENT5),n===6&&e.push(this.gl.COLOR_ATTACHMENT6),n===7&&e.push(this.gl.COLOR_ATTACHMENT7);return e}destroy(e=!1){if(e){for(const n of this.boundTextures)n.destroy();this.boundDepthRenderBuffer&&this.boundDepthRenderBuffer.destroy()}this.gl.deleteFramebuffer(this.frameBuffer)}}class Sv{constructor(e,n){ht(this,"boundProgram");ht(this,"boundVertexArray");ht(this,"defaultVertexArray");ht(this,"boundBuffer");ht(this,"boundTextures",[]);ht(this,"boundFrameBuffer");ht(this,"boundTransformFeedback");ht(this,"defaultTransformFeedback");this.gl=e,this.config=n,n.viewport&&e.viewport(...n.viewport),n.depthTest&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)),n.cullFace&&e.enable(e.CULL_FACE),n.allowAlpha&&(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),(n.colorBufferFloat===void 0||n.colorBufferFloat===!0)&&(e.getExtension("EXT_color_buffer_float")||console.error(`Could not load extension "EXT_color_buffer_float". Won't be able to render to f32 textures!`)),this.defaultVertexArray=new $I(e,{}),this.boundVertexArray=this.defaultVertexArray,this.defaultTransformFeedback=new ZI(e,{}),this.boundTransformFeedback=this.defaultTransformFeedback}setViewPort(e){this.config.viewport=e,this.gl.viewport(...this.config.viewport)}bindProgram(e,n=!0){n&&e===this.boundProgram||(this.gl.useProgram(e.program),this.boundProgram=e)}bindVertexArray(e,n=!0){n&&e===this.boundVertexArray||(this.gl.bindVertexArray(e.vertexArray),this.boundVertexArray=e)}unbindVertexArray(){this.boundVertexArray!==this.defaultVertexArray&&(this.gl.bindVertexArray(null),this.boundVertexArray=this.defaultVertexArray)}bindBuffer(e){e!==this.boundBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.boundBuffer=e)}unbindBuffer(){this.boundBuffer!==void 0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.boundBuffer=void 0)}bindFramebuffer(e){this.boundFrameBuffer!==e&&(e.bind(),this.boundFrameBuffer=e,e.boundTextures.length>0&&this.setViewPort([0,0,e.boundTextures[0].width,e.boundTextures[0].height]))}unbindFramebuffer(){this.boundFrameBuffer!==void 0&&(this.boundFrameBuffer.unbind(),this.boundFrameBuffer=void 0,this.setViewPort([0,0,this.gl.canvas.width,this.gl.canvas.height]))}bindBufferToDefaultVertexArray(e,n){this.unbindVertexArray(),this.bindBuffer(e),this.defaultVertexArray.attachBuffer(e,n),this.unbindBuffer()}bindBufferToVertexArray(e,n,r){this.bindVertexArray(e),this.bindBuffer(n),e.attachBuffer(n,r),this.unbindBuffer()}bindIndexToVertexArray(e,n){this.bindVertexArray(e),e.attachIndexBuffer(n)}bindTextureToFramebuffer(e,n,r=0){this.bindFramebuffer(e),e.attachTexture(n,r),n.type===this.gl.FLOAT&&this.config.colorBufferFloat===!1&&console.warn(`You're trying to add a float-texture to a framebuffer.
        WebGL cannot render to float-textures - this won't work.
        https://registry.khronos.org/OpenGL/specs/es/3.0/es_spec_3.0.pdf#page=143&zoom=100,168,666`),e===this.boundFrameBuffer&&this.setViewPort([0,0,n.width,n.height])}bindDepthToFramebuffer(e,n){this.bindFramebuffer(e),e.attachDepthRenderBuffer(n)}getUniformLocation(e,n){return e.getUniformLocation(n)}setUniformValue(e,n,r,s){this.bindProgram(e),e.setUniformValue(n,r,s)}bindTextureToSlot(e,n){const r=this.gl,s=e.texture,c=n??this.boundTextures.length;if(c>r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${c}.`);return c===mp&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${mp}).
                            If after this call another texture is built, your shader will now use that new texture instead of this one!
                            Consider using another bind point.`),r.activeTexture(r.TEXTURE0+c),r.bindTexture(r.TEXTURE_2D,s),this.boundTextures[c]=e,c}bindTexUniformToSlot(e,n,r){this.bindProgram(e);const s=e.getUniformLocation(n);this.gl.uniform1i(s,r)}updateVideoTexture(e){for(let n=0;n<this.boundTextures.length;n++)this.boundTextures[n]===e&&e.update(n)}bindTextureToUniform(e,n,r,s){const c=this.bindTextureToSlot(r,s);this.bindTexUniformToSlot(e,n,c)}bindTransformFeedback(e){this.boundTransformFeedback!==e&&(this.boundTransformFeedback=e,e.bind())}unbindTransformFeedback(){this.boundTransformFeedback!==this.defaultTransformFeedback&&(this.boundTransformFeedback.unbind(),this.boundTransformFeedback,this.defaultTransformFeedback)}bindBufferToTransformFeedback(e,n,r){var s;this.bindTransformFeedback(e),(s=this.boundTransformFeedback)==null||s.attachBuffer(n,r)}clearScreen(e,n){n?this.bindFramebuffer(n):this.unbindFramebuffer(),this.gl.clearColor(...e),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}drawArrays(e,n,r,s){this.bindProgram(e),n?this.bindVertexArray(n):this.unbindVertexArray(),this.unbindFramebuffer();const c=nc(this.gl,r);this.gl.drawArrays(c,0,s)}drawArraysInstanced(e,n,r,s,c){this.bindProgram(e),n?this.bindVertexArray(n):this.unbindVertexArray();const h=nc(this.gl,r);this.gl.drawArraysInstanced(h,0,s,c)}drawArraysToFramebuffer(e,n,r,s,c){c?this.bindFramebuffer(c):this.unbindFramebuffer(),this.bindProgram(e),n?this.bindVertexArray(n):this.unbindVertexArray();const h=nc(this.gl,r);this.gl.drawArrays(h,0,s)}drawArraysInstancedToFramebuffer(e,n,r,s,c,h){h?this.bindFramebuffer(h):this.unbindFramebuffer(),this.bindProgram(e),n?this.bindVertexArray(n):this.unbindVertexArray();const l=nc(this.gl,r);this.gl.drawArraysInstanced(l,0,s,c)}drawArraysToTransformFeedback(e,n,r,s,c,h){const l=this.gl,m=nc(this.gl,r);this.bindProgram(e),h||l.enable(l.RASTERIZER_DISCARD),this.bindTransformFeedback(c),l.beginTransformFeedback(m),n?this.bindVertexArray(n):this.unbindVertexArray(),this.unbindFramebuffer(),this.gl.drawArrays(m,0,s),l.endTransformFeedback(),this.unbindTransformFeedback(),h||l.disable(l.RASTERIZER_DISCARD)}drawArraysToFramebufferAndTransformFeedback(e,n,r,s,c,h){const l=this.gl;h?this.bindFramebuffer(h):this.unbindFramebuffer();const m=nc(this.gl,r);this.bindProgram(e),this.bindTransformFeedback(c),l.beginTransformFeedback(m),n?this.bindVertexArray(n):this.unbindVertexArray(),this.gl.drawArrays(m,0,s),l.endTransformFeedback(),this.unbindTransformFeedback()}drawElements(e,n,r,s,c){if(this.bindProgram(e),this.bindVertexArray(n),!n.indexBuffer)throw new Error("VertexArray has no index buffer attached. Cannot draw elements");c?this.bindFramebuffer(c):this.unbindFramebuffer();let h=nc(this.gl,r);this.gl.drawElements(h,s,this.gl.UNSIGNED_SHORT,0)}destroy(e=!1){var n;this.boundTransformFeedback.destroy(e),this.boundFrameBuffer&&((n=this.boundFrameBuffer)==null||n.destroy(e));for(const r of this.boundTextures)r.destroy();this.boundBuffer&&this.boundBuffer.destroy(),this.boundVertexArray.destroy(e),this.boundProgram&&this.boundProgram.destroy()}}function nc(t,e){switch(e){case"triangles":return t.TRIANGLES;case"lines":return t.LINES;case"points":return t.POINTS}}function YI(t){var r;const e=t.program.vertexSource,n=t.program.fragmentSource;for(const[s,c]of Object.entries(t.inputs.attributes)){const h=`in ${c.config.type} ${s};`;!e.includes(h)&&!n.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[s,c]of Object.entries(t.inputs.uniforms)){const h=`uniform ${c.type} ${s};`;!e.includes(h)&&!n.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[s,c]of Object.entries(t.inputs.textures)){const h=`uniform sampler2D ${s};`;!e.includes(h)&&!n.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[s,c]of Object.entries(((r=t.outputs.transformFeedback)==null?void 0:r.data)??{})){const h=` ${s};`;e.includes(h)||console.error(`Vertex source doesn't contain the string ${h}`)}}class Pa{constructor(e,n){ht(this,"program");ht(this,"vao");ht(this,"fb");ht(this,"tf");ht(this,"unboundFramebuffer");var r;this.gs=e,this.config=n,n.program instanceof SS?this.program=n.program:(YI(n),this.program=new SS(e.gl,{...n.program,transformFeedbackVaryings:Object.keys(((r=n.outputs.transformFeedback)==null?void 0:r.data)??[])})),this.vao=new qI(e.gl,{});for(const[s,c]of Object.entries(n.inputs.attributes)){const h=this.program.getAttributeLocation(s);this.gs.bindBufferToVertexArray(this.vao,c.buffer,{...c.config,location:h})}if(n.inputs.index&&this.gs.bindIndexToVertexArray(this.vao,n.inputs.index),this.config.outputs.frameBuffer){const s=this.config.outputs.frameBuffer;this.fb=new TS(e.gl,{});let c=0;for(const h of s.textures)e.bindTextureToFramebuffer(this.fb,h,c),c+=1;s.depth&&e.bindDepthToFramebuffer(this.fb,s.depth),this.fb.bind()}if(this.config.outputs.transformFeedback){this.tf=new XI(e.gl,{});let s=0;for(const[c,h]of Object.entries(this.config.outputs.transformFeedback.data))e.bindBufferToTransformFeedback(this.tf,h,s),s+=1}}activate(){this.gs.bindProgram(this.program),this.gs.bindVertexArray(this.vao);let e=0;for(const[n,r]of Object.entries(this.config.inputs.textures))this.gs.bindTextureToSlot(r,e),this.gs.bindTexUniformToSlot(this.program,n,e),e+=1;for(const[n,r]of Object.entries(this.config.inputs.uniforms))this.gs.setUniformValue(this.program,n,r.type,r.value);this.fb?this.gs.bindFramebuffer(this.fb):this.gs.unbindFramebuffer(),this.tf?this.gs.bindTransformFeedback(this.tf):this.gs.unbindTransformFeedback(),this.gs.setViewPort(this.config.settings.viewport)}updateUniform(e,n){const r=this.config.inputs.uniforms[e].type;this.config.inputs.uniforms[e].value=n,this.gs.setUniformValue(this.program,e,r,n)}updateTexture(e,n){let r=0;for(const[s,c]of Object.entries(this.config.inputs.textures))if(s===e){this.gs.bindTextureToUniform(this.program,e,c,r);break}else r+=1;this.config.inputs.textures[e]=n}updateViewport(e){this.gs.setViewPort(e),this.config.settings.viewport=e}updateFramebuffer(e){if(this.config.outputs.frameBuffer=e,e===void 0)this.gs.unbindFramebuffer(),this.unboundFramebuffer=this.fb,this.fb=void 0;else{const n=e;this.fb||(this.fb=this.unboundFramebuffer),this.fb||(console.warn("having to create new fb - is this on purpose?"),this.fb=new TS(this.gs.gl,{}));let r=0;for(const s of n.textures)this.gs.bindTextureToFramebuffer(this.fb,s,r),r+=1;n.depth&&this.gs.bindDepthToFramebuffer(this.fb,n.depth)}}draw(e){var s,c;e&&this.gs.clearScreen(e,this.fb??void 0);const n=this.gs.gl,r=this.config.settings;this.activate(),this.tf&&(this.gs.gl.beginTransformFeedback(nc(n,r.drawingMode)),((s=this.config.outputs.transformFeedback)==null?void 0:s.runFragmentShader)===!1&&n.enable(n.RASTERIZER_DISCARD)),this.config.inputs.index?this.fb?this.gs.drawElements(this.program,this.vao,r.drawingMode,this.config.inputs.index.length,this.fb):this.gs.drawElements(this.program,this.vao,r.drawingMode,this.config.inputs.index.length):this.fb?r.instanced?this.gs.drawArraysInstancedToFramebuffer(this.program,this.vao,r.drawingMode,r.nrVertices,r.instanced,this.fb):this.gs.drawArraysToFramebuffer(this.program,this.vao,r.drawingMode,r.nrVertices,this.fb):r.instanced?this.gs.drawArraysInstanced(this.program,this.vao,r.drawingMode,r.nrVertices,r.instanced):this.gs.drawArrays(this.program,this.vao,r.drawingMode,r.nrVertices),this.tf&&(n.endTransformFeedback(),((c=this.config.outputs.transformFeedback)==null?void 0:c.runFragmentShader)===!1&&n.disable(n.RASTERIZER_DISCARD))}destroy(e=!1){this.tf&&this.tf.destroy(e),this.fb&&this.fb.destroy(e),this.vao.destroy(e),this.program.destroy()}}function KI(t,e){const n=[];for(let r=0;r<e;r++)n.push(t(r));return n}function JI(t,e,n){const r=[];for(let s=0;s<e;s++){const c=[];for(let h=0;h<n;h++)c.push(t(s,h));r.push(c)}return r}function Mv(t,e,n,r){const s=t-n/2,c=t+n/2,h=e+r/2,l=e-r/2;return[[s,h],[s,l],[c,l],[s,h],[c,l],[c,h]]}function ES(t,e,n=1,r=0){const s=t.gl.canvas,c=Mv(0,0,2,2),h=new mo(t.gl,{data:new Float32Array(c.flat()),changesOften:!1});return new Pa(t,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos + 1.0) / 2.0;
                uv.y = 1.0 - uv.y;
            }`,fragmentSource:`#version 300 es
            precision highp float;
            in vec2 uv;
            uniform float blur;
            uniform vec2 texSize;
            uniform sampler2D tex;
            out vec4 fragColor;
            void main() {
                vec4 color = texture(tex, uv);

                if (blur > 0.0) {
                  vec2 dX = blur * vec2(1.0 / texSize.x, 0);
                  vec2 dY = blur * vec2(0, 1.0 / texSize.y);
                  color *= 0.4;
                  color += 0.6 / 4.0 * texture(tex, uv + dX);
                  color += 0.6 / 4.0 * texture(tex, uv - dX);
                  color += 0.6 / 4.0 * texture(tex, uv + dY);
                  color += 0.6 / 4.0 * texture(tex, uv - dY);
                }

                fragColor = vec4(color.xyz, ${n});
            }`},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{texSize:{type:"vec2",value:[e.width,e.height]},blur:{type:"float",value:[r]}},textures:{tex:e}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:c.length,viewport:[0,0,s.width,s.height]}})}class kp{constructor(e,n){ht(this,"doesLoop",!1);ht(this,"lastRenderStart",+document.timeline.currentTime);this.loopTime=e,this.callback=n}setLoopTime(e){this.loopTime=e}getLoopTime(){return this.loopTime}loop(){const e=+document.timeline.currentTime;this.loopTime-(e-this.lastRenderStart)<0&&(this.lastRenderStart=e,this.callback(e)),this.doesLoop&&requestAnimationFrame(()=>this.loop())}startLoop(){this.doesLoop=!0,this.loop()}stopLoop(){this.doesLoop=!1}}class QI{constructor(e,n){ht(this,"movement1");ht(this,"movement2");ht(this,"pt1");ht(this,"pt2");ht(this,"i",0);const r=e.canvas,s=new Sv(e,{allowAlpha:!0}),c=n.nrParticles,h=new ki(e,{image:n.sdfImg,interpolate:"linear",edges:"clamp",mipmaps:!0}),l=KI(()=>[(Math.random()*2-1)*.8,(Math.random()*2-1)*.8,0,0],c),m=new mo(e,{data:new Float32Array(l.flat()),changesOften:!1}),_=new mo(e,{data:new Float32Array(l.flat()),changesOften:!1}),S=new ho(e,{width:r.width,height:r.height,type:"float4",interpolate:"none",edges:"clamp"}),T=new ho(e,{width:r.width,height:r.height,type:"float4",interpolate:"none",edges:"clamp"}),M=new Pa(s,{program:{vertexSource:`#version 300 es
            in vec4 offset;
            uniform vec3 pointerPos;
            uniform vec2 lastPosTexSize;
            uniform vec2 sdfTextureSize;
            uniform sampler2D lastPosTex;
            uniform sampler2D sdfTexture;
            out vec4 offsetNew;

            float particleSize = 10.0;
            vec2 dxdyPos() {
                return vec2(particleSize / lastPosTexSize.x, particleSize / lastPosTexSize.y);
            }
            vec2 dxdySdf() {
              return vec2(1.0 / sdfTextureSize.x, 1.0 / sdfTextureSize.y);
            }

            vec4 sampleQuadrant(vec2 uv, vec2 dPrimary, vec2 dSecondary, sampler2D tex, int level) {
                vec4 data = vec4(0);

                if (level > -2) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.0 * dSecondary);
                }
                if (level > -1) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.1 * dSecondary);
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary - 0.1 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.0 * dSecondary);
                }
                if (level > 0) {
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.3 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary - 0.3 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.0 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.5 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary - 0.5 * dSecondary);
                }
                if (level > 1) {
                  data += 1.00 * texture(tex, uv + 1.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary - 1.0 * dSecondary);
                }
                if (level > 2) {
                  data += 0.50 * texture(tex, uv + 2.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary - 1.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary + 2.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary - 2.0 * dSecondary);
                }
                if (level > 3) {
                  data += 0.25 * texture(tex, uv + 3.0 * dPrimary + 0.0 * dSecondary);
                }
                return data;
            }

            vec4 sampleRight(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(dx, 0.0);
                vec2 dSecondary = vec2(0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleLeft(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(-dx, 0.0);
                vec2 dSecondary = vec2( 0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleTop(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleBottom(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, -dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            void main() {

                vec2 pos = offset.xy;
                vec2 speed = offset.zw;
                vec2 uv = (pos + 1.0) / 2.0;

                vec2 uvSdf = vec2(uv.x, uv.y);
                float dxSdf = dxdySdf().x;
                float dySdf = dxdySdf().y;
                float dist    = texture(sdfTexture, uvSdf).x;
                float dist_px = sampleRight (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_mx = sampleLeft  (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_py = sampleTop   (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_my = sampleBottom(uvSdf, dxdySdf(), sdfTexture, 3).x;
    
                float dDistdx = (dist_px - dist_mx) / (2.0 * dxSdf);
                float dDistdy = (dist_py - dist_my) / (2.0 * dySdf);
                float sign = 1.0;
                // if (dist >= 0.7) {
                //   sign *= -1.0;
                // }
                vec2 textAttractionForce = sign * vec2(dDistdx, dDistdy);



                float dxPos = dxdyPos().x;
                float dyPos = dxdyPos().y;
                vec4 presenceRight  = sampleRight (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceLeft   = sampleLeft  (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceTop    = sampleTop   (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceBottom = sampleBottom(uv, dxdyPos(), lastPosTex, 4);
                float pr = presenceRight.x * presenceRight.w;
                float pl = presenceLeft.x * presenceLeft.w;
                float pt = presenceTop.x * presenceTop.w;
                float pb = presenceBottom.x * presenceBottom.w;
                float dpdx = (pr - pl) / (2.0 * dxPos);
                float dpdy = (pt - pb) / (2.0 * dyPos);
                vec2 particleRepulsionForce = -0.0001 * vec2(dpdx, dpdy);



                vec2 mouseRepulsionForce = vec2(0);
                if (pointerPos.z > 0.5) {
                  vec2 mousePos = pointerPos.xy;
                  vec2 mouseDir = mousePos - pos;
                  float mouseDist = length(mouseDir);
                  if (mouseDist < 0.7) {
                    float mouseProx = (0.7 - mouseDist) / 0.7;
                    mouseRepulsionForce = -1.0 * (mouseProx * mouseProx) * mouseDir;
                  }
                }

                

                vec2 newSpeed = 0.800 * speed 
                              + 0.800 * particleRepulsionForce 
                              + 0.005 * textAttractionForce
                              + 2.0 * mouseRepulsionForce;
                vec2 newPos = pos + 0.04 * newSpeed;


                if (newPos.x < -1.0) {
                  newPos.x = 1.0 - (-1.0 - newPos.x);
                }
                if (newPos.x > 1.0) {
                  newPos.x = -1.0 + (1.0 - newPos.x);
                }
                if (newPos.y < -1.0) {
                  newPos.y = 1.0 - (-1.0 - newPos.y);
                }
                if (newPos.y > 1.0) {
                  newPos.y = -1.0 + (1.0 - newPos.y);
                }

                gl_Position = vec4(newPos, 0, 1);
                gl_PointSize = particleSize;
                offsetNew = vec4(newPos, newSpeed);
            }`,fragmentSource:`#version 300 es
            precision highp float;
            out vec4 fragColor;
            void main() {
                fragColor = vec4(1, 1, 1, 0.8);
            }`},inputs:{attributes:{offset:{buffer:m,config:{normalize:!1,nrInstances:0,type:"vec4"}}},uniforms:{lastPosTexSize:{type:"vec2",value:[S.width,S.height]},sdfTextureSize:{type:"vec2",value:[h.width,h.height]},pointerPos:{type:"vec3",value:[0,0,0]}},textures:{sdfTexture:h,lastPosTex:S}},outputs:{transformFeedback:{data:{offsetNew:_},runFragmentShader:!0},frameBuffer:{textures:[T]}},settings:{drawingMode:"points",instanced:!1,nrVertices:c,viewport:[0,0,r.width,r.height]}}),I=new Pa(s,{...M.config,program:M.program,inputs:{...M.config.inputs,attributes:{...M.config.inputs.attributes,offset:{buffer:_,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{...M.config.inputs.textures,lastPosTex:T}},outputs:{...M.config.outputs,transformFeedback:{data:{offsetNew:m},runFragmentShader:!0},frameBuffer:{textures:[S]}}}),N=ES(s,T,n.opacity,n.blur),B=ES(s,S,n.opacity,n.blur);this.movement1=M,this.movement2=I,this.pt1=N,this.pt2=B}step(e){this.i%2===0?(this.movement1.updateUniform("pointerPos",e.pointerPos),this.movement1.draw([0,0,0,0]),this.pt1.draw()):(this.movement2.updateUniform("pointerPos",e.pointerPos),this.movement2.draw([0,0,0,0]),this.pt2.draw()),this.i++}destroy(e){this.pt2.destroy(e),this.pt1.destroy(e),this.movement2.destroy(e),this.movement1.destroy(e)}}class eD{constructor(){ht(this,"looper");ht(this,"p");ht(this,"canvas");ht(this,"destroyed",!1);ht(this,"pointerPos",[0,0,0]);ht(this,"onMouseMove",e=>{var c;if(!this.canvas)return;(c=this.looper)==null||c.setLoopTime(30);const n=this.canvas.getBoundingClientRect(),r=(e.clientX-n.left)/this.canvas.clientWidth,s=(e.clientY-n.top)/this.canvas.clientHeight;this.pointerPos[0]=(r-.5)*2,this.pointerPos[1]=(s-.5)*2,this.pointerPos[2]=1});ht(this,"timeout");ht(this,"onDevMove",e=>{var s;(s=this.looper)==null||s.setLoopTime(30);let n=0;e.gamma&&(n=e.gamma/90);let r=0;e.beta&&(r=e.beta/180),this.pointerPos[0]=n,this.pointerPos[1]=r,this.pointerPos[2]=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.pointerPos[2]=0,60)})}async init(e){const n=await ki.loadImage("/c_c_fat_sdf.jpg");if(this.destroyed)return;const r=e.getContext("webgl2");this.p=new QI(r,{sdfImg:n,nrParticles:Math.max(e.width*3,3e3),opacity:.1,blur:0}),this.looper=new kp(30,()=>{var s,c;(s=this.p)==null||s.step({pointerPos:this.pointerPos}),this.pointerPos[2]=0,(c=this.looper)==null||c.setLoopTime(this.looper.getLoopTime()+1)}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove)}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,n,r;(e=this.looper)==null||e.stopLoop(),(n=this.p)==null||n.destroy(!0),this.p=void 0,(r=this.canvas)==null||r.removeEventListener("mousemove",this.onMouseMove),this.canvas=void 0,this.destroyed=!0}}function tD(){const t=pt.useRef(null);return pt.useEffect(()=>{const e=new eD;if(t.current){const n=t.current;n.width=n.clientWidth,n.height=n.clientHeight,e.init(n).then(()=>e.startLoop())}return()=>e.destroy()},[t.current]),me.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(180deg, var(--white) 0%, var(--primary4) 100%)",position:"relative"},children:me.jsx("canvas",{ref:t,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"all"}})})}function pd(t){return me.jsx("div",{style:{height:t.height??"0",width:t.width??"0"}})}function nD(t){return me.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"100%",padding:"0.25rem",position:"relative",background:"var(--primary2)"},children:me.jsx("div",{style:{borderRadius:"100%",position:"absolute",width:"calc(100% - 2 * 0.25rem)",height:"calc(100% - 2 * 0.25rem)",overflow:"hidden",background:"var(--white)"},children:t.children})})}function rD(t){return me.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:me.jsx("path",{fill:t.fill,fillOpacity:"1",d:`M 0 0 
  L 1 0
  L 1 0.9 
  C 0.8 -1.1   0.2 1.0   0 0.9
  Z`})})}function iD(t){return me.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:me.jsx("path",{fill:t.fill,fillOpacity:"1",d:`
        M 0 0 
        C 0.3 1.8    0.5 0.5    1 0 
        L 1 1 
        L 0 1
        Z`})})}function aD(){return me.jsx("div",{style:{minHeight:"5rem"},children:me.jsxs("div",{style:{position:"relative",padding:"2rem",display:"flex",flexWrap:"wrap",flexDirection:"row",alignContent:"space-around",justifyContent:"space-around",width:"100%"},children:[me.jsx("div",{children:"Site made by codeandcolors"}),me.jsx("div",{children:me.jsx(F1,{to:"/imprint",children:"Imprint"})}),me.jsx("div",{children:me.jsx(F1,{to:"/resources",children:"Resources"})})]})})}function sD(t){if(t.hasAttribute("width"))return{x:+t.getAttribute("width"),y:+t.getAttribute("height")};if(t.getBBox){const e=t.getBBox();return{x:e.width,y:e.height}}else return console.warn("Could not determine dimensions of svg-element ",t),{x:0,y:0}}function AS(t){var r;if((r=t.viewBox)!=null&&r.baseVal){const s=t.viewBox.baseVal;return{x:s.x+s.width/2,y:s.y+s.height/2}}const e=OE(t),n=sD(t);return{x:e.x+n.x/2,y:e.y+n.y/2}}function OE(t){return{x:+t.getAttribute("x"),y:+t.getAttribute("y")}}function oD(t,e){return{x:t.x-e.x,y:t.y-e.y}}function lD(t,e){return{x:t.x+e.x,y:t.y+e.y}}function cD(t,e){return{x:t.x*e,y:t.y*e}}class uD{constructor(){ht(this,"svg");ht(this,"io");ht(this,"doesLoop",!1)}init(e){this.doesLoop=!0,this.io=new IntersectionObserver((n,r)=>{for(const s of n)if(s.intersectionRatio>.7){const c=s.target;this.doesLoop&&(this.implode(c),r.unobserve(s.target))}}),this.io.observe(e)}delete(){var e,n;this.svg&&((e=this.io)==null||e.unobserve(this.svg)),(n=this.io)==null||n.disconnect(),this.doesLoop=!1}implode(e){const n=AS(e),r=[],s=Array.from(e.childNodes).filter(l=>!["defs"].includes(l.tagName));if(s.length<=0)return;for(const l of s){const m=OE(l);let _=AS(l);_.x===0&&_.y===0&&(_=structuredClone(n)),r.push({childTL:m,childCenter:_}),this.implode(l)}let c=30;const h=l=>{l<0||(s.map((m,_)=>{const{childTL:S,childCenter:T}=r[_],M=oD(T,n),I=lD(S,cD(M,l/c));m.setAttribute("x",I.x+""),m.setAttribute("y",I.y+"")}),this.doesLoop&&setTimeout(()=>requestAnimationFrame(()=>h(l-1)),30))};h(c)}}function hD(t){const e=pt.useRef(null);return pt.useEffect(()=>{const n=new uD;if(e.current){const s=e.current.firstChild;n.init(s)}return()=>n.delete()},[e.current]),me.jsx("div",{ref:e,style:{width:"100%",height:"100%"},children:t.children})}let dD=class{constructor(){ht(this,"t");ht(this,"a");ht(this,"b");ht(this,"sa");ht(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const n=this.sa*Math.sin(this.a*this.t),r=this.sb*Math.sin(this.b*this.t),s=.5+n/2,c=.5+r/2;return{x:s,y:c}}};class fD{constructor(e=[]){ht(this,"balls",[]);ht(this,"paths",[]);ht(this,"dt",.02);ht(this,"loopHandle");ht(this,"j",0);this.circles=e;for(const n of this.circles)this.balls.push({pos:{x:+n.getAttribute("cx"),y:+n.getAttribute("cy")},r:+n.getAttribute("r")}),this.paths.push(new dD)}loop(){const e=this.circles,n=this.balls,r=this.paths,s=this.dt;for(let h=0;h<e.length;h++){const l=n[h],m=e[h],_=r[h],{x:S,y:T}=_.advance(s);l.pos.x=S,l.pos.y=T,m.setAttribute("cx",l.pos.x+""),m.setAttribute("cy",l.pos.y+""),m.setAttribute("r",l.r+"")}const c=setTimeout(()=>requestAnimationFrame(()=>this.loop()),100);this.loopHandle=c,this.j+=1}cancelLoop(){clearTimeout(this.loopHandle)}}function pD(t){const e=pt.useRef(null);return pt.useEffect(()=>{let n;if(e.current){const r=e.current.querySelectorAll("circle");n=new fD(Array.from(r)),n.loop()}return()=>n==null?void 0:n.cancelLoop()},[e.current]),me.jsxs("div",{style:{position:"relative",background:"var(--white)"},children:[me.jsxs("svg",{ref:e,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},viewBox:"0 0 1 1",preserveAspectRatio:"none",children:[me.jsx("defs",{children:me.jsx("filter",{id:"bbblurry-filter",children:me.jsx("feGaussianBlur",{stdDeviation:"0.008",in:"SourceGraphic",edgeMode:"none",result:"blur"})})}),me.jsxs("g",{filter:"url(#bbblurry-filter)",children:[me.jsx("rect",{x:"-100",y:"-100",width:"200",height:"200",fill:"none"}),me.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--primary4)",opacity:"0.3"}),me.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--secondary4)",opacity:"0.3"}),me.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--tertiary4)",opacity:"0.3"})]})]}),me.jsx("div",{style:{position:"relative"},children:t.children})]})}function Xd(t){return me.jsxs("div",{style:{position:"relative"},children:[t.hero,me.jsxs("div",{style:{zIndex:1,position:"relative",marginTop:"-5rem",marginBottom:"-5rem"},children:[t.logo&&me.jsx("div",{style:{zIndex:1,position:"absolute",width:"max(10%, 75px)",left:"max(5%, 1rem)",aspectRatio:"1/1"},children:me.jsx(nD,{children:me.jsx(hD,{children:t.logo})})}),me.jsx("div",{style:{width:"100%",height:"5.1rem"},children:me.jsx(iD,{fill:"var(--white)"})}),me.jsxs("div",{children:[me.jsx(pd,{height:"5rem"}),me.jsx(FE,{children:t.children}),me.jsx(pd,{height:"5rem"})]}),me.jsx("div",{style:{width:"100%",height:"5.1rem"},children:me.jsx(rD,{fill:"var(--white)"})})]}),me.jsxs("div",{style:{position:"relative"},children:[me.jsxs(pD,{children:[me.jsx(pd,{height:"5rem"}),t.footerContent,me.jsx(pd,{height:"5rem"}),me.jsx(aD,{})]}),me.jsx("div",{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"none",background:"linear-gradient(0deg, var(--primary2-transparent25) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 90%, var(--primary2-transparent25) 100%)",opacity:.5}})]})]})}function mD(){return me.jsxs(Xd,{hero:me.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:me.jsx(wv,{title:"",subtitle:"",heroBackground:me.jsx(tD,{})})}),logo:me.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",children:me.jsxs("svg",{x:"0.1",y:"0.25",width:"0.8",height:"0.5",viewBox:"0 0 1 1",children:[me.jsxs("defs",{children:[me.jsx("path",{id:"envelopA",d:"M 0 0 L 1 0 L 1 0.2 L 0.5 0.6 L 0 0.2 Z",fill:"black"}),me.jsx("path",{id:"envelopB",d:"M 0 0.2 L 0.5 0.6 L 1 0.2 L 1 1 L 0 1 Z",fill:"black"})]}),me.jsx("use",{href:"#envelopA",x:"0",y:"0.0"}),me.jsx("use",{href:"#envelopB",x:"0",y:"0.2"})]})}),footerContent:me.jsxs(FE,{children:[me.jsx("h2",{children:"See you soon!"}),me.jsx(pd,{height:"5rem"})]}),children:[me.jsx("h1",{children:"Contact us!"}),me.jsx("p",{children:"We'll be happy to answer all your requests."}),me.jsx("div",{className:"ctaContainer",children:me.jsx("a",{href:"mailto:michael.langbein@codeandcolors.net",children:me.jsx("button",{type:"button",className:"ctaButton",children:"Send Email"})})})]})}function gD(){return me.jsx("div",{children:me.jsx("h1",{children:"Error"})})}function Ob(){const t=Bb();return me.jsx("div",{className:"ctaContainer",children:me.jsxs("div",{className:"CTA",children:[me.jsx("div",{children:me.jsx("h2",{children:"Let's build something great together!"})}),me.jsx("button",{className:"ctaButton",onClick:()=>t("/contact"),children:"Contact us"})]})})}class vD{constructor(e,n){ht(this,"graph");const r=e.getContext("webgl2"),s=new Sv(r,{colorBufferFloat:!1,allowAlpha:!0}),c=Mv(0,0,2,2),h=new mo(r,{data:new Float32Array(c.flat()),changesOften:!1}),l=new ki(r,{image:n.heightImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),m=new ki(r,{image:n.rgbImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),_=new ki(r,{image:n.waterNormal1,interpolate:"linear",edges:"repeat",mipmaps:!0}),S=new ki(r,{image:n.waterNormal2,interpolate:"linear",edges:"repeat",mipmaps:!0}),T=new ki(r,{image:n.clouds,interpolate:"linear",edges:"mirror"}),M=new Pa(s,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos - 1.0) / 2.0;
                uv.x = 1.0 - uv.x;
            }
        `,fragmentSource:`#version 300 es
            precision mediump float;
            in vec2 uv;
            uniform sampler2D imageTex;
            uniform sampler2D heightTex;
            uniform sampler2D waterNormalTexture1;
            uniform sampler2D waterNormalTexture2;
            uniform sampler2D cloudTexture;
            uniform float mousex;
            uniform float mousey;
            uniform float time;
            uniform vec2 textureSize;
            out vec4 fragColor;

            vec4 lighten(vec4 baseColor, vec4 lightenWith, float degree) {
              vec4 distance = lightenWith - baseColor;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 darken(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x -= degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y -= degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z -= degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 glow(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            void main() {
                float waterLine = ${n.waterLine};
                float dx = 1.0 / textureSize.x;
                float dy = 1.0 / textureSize.y;

                // 0. data

                vec2 sunPos = normalize(vec2(mousex * 2.0 - 1.0, mousey * 2.0 - 1.0));
                vec2 water1point = uv * 3.0 + 0.02 * time * vec2(0.1, 0.2);
                vec2 water2point = uv * 3.0 + 0.02 * time * vec2(-0.3, 0.1);
                vec4 waterNorm1 = 2.0 * (texture(waterNormalTexture1,  water1point) - 0.5);
                vec4 waterNorm2 = 2.0 * (texture(waterNormalTexture2,  water2point) - 0.5);
                vec4 waterNorm = mix(waterNorm1, waterNorm2, 0.5);
                vec2 waterNormXY = waterNorm.rg;

                // 1. perspective

                vec4 landColor = vec4(0);
                float height = texture(heightTex, uv).x;
                if (height >= waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + height * ${n.strength} * mouse;
                  landColor = texture(imageTex, queryPoint);
                }

                // 2. water reflection

                vec4 reflectionColor = vec4(0);
                float waveHeight = waterNorm.z;
                float reflection = dot(waterNormXY, sunPos);
                reflection *= reflection;
                if (height < waterLine) {
                  float proxToCenter = 0.25 - length(uv - vec2(0.5));
                  reflectionColor = vec4(reflection);
                }

                // 3. surf

                vec4 surfColor = vec4(0);
                float distFromShore = waterLine - height;
                float surf = sin(distFromShore * 200.0 + time * 1.0);
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  surfColor = vec4(surf, surf, surf, 1);
                }


                // 4. water refraction

                vec4 refractionColor = vec4(0);
                if (height < waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + (height + surf + waveHeight * 0.5) * ${n.strength} * mouse;
                  refractionColor = texture(imageTex, queryPoint);
                }


                // 5. clouds

                vec2 cloudUv = uv * 0.2;
                vec2 cloudTimeOffset = vec2(-0.005 * time, 0);
                vec2 cloudHeightOffset = 0.005 * vec2(mousex, mousey);
                vec4 cloudColor = texture(cloudTexture, cloudUv + cloudTimeOffset + cloudHeightOffset);

                
                // 6. mixing

                vec4 baseColor = landColor + refractionColor;
                vec4 combinedColor = baseColor;
                if (height < waterLine) {
                  // combinedColor = mix(combinedColor, reflectionColor, reflection);
                  // combinedColor = lighten(combinedColor, vec4(1.0), reflection);
                  combinedColor = darken(combinedColor, vec4(0.0), reflection);
                  // combinedColor = lighten(combinedColor, surfColor, 1.0 - distFromShore / 0.1);
                }
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  combinedColor.xyz *= (1.0 + surf * 0.25);
                }
                // combinedColor = mix(combinedColor, vec4(0), cloudColor.w * cloudColor.w * 0.2);
                combinedColor = glow(combinedColor, vec4(0), cloudColor.w * cloudColor.w * cloudColor.w * 2.0);

                fragColor = combinedColor;
            }
        `},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{heightTex:l,imageTex:m,waterNormalTexture1:_,waterNormalTexture2:S,cloudTexture:T},uniforms:{mousex:{type:"float",value:[0]},mousey:{type:"float",value:[0]},time:{type:"float",value:[0]},textureSize:{type:"vec2",value:[m.width,m.height]}}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:c.length,viewport:[0,0,e.width,e.height]}});this.graph=M}step(e){this.graph.updateUniform("mousex",[e.mousex]),this.graph.updateUniform("mousey",[e.mousey]),this.graph.updateUniform("time",[e.time]),this.graph.draw()}destroy(e){var n;(n=this.graph)==null||n.destroy(e)}}class yD{constructor(){ht(this,"looper");ht(this,"islands");ht(this,"canvas");ht(this,"destroyed",!1);ht(this,"mousex",0);ht(this,"mousey",0);ht(this,"onMouseMove",e=>{if(!this.canvas)return;const n=e.clientX/this.canvas.clientWidth,r=1-e.clientY/this.canvas.clientHeight;this.mousex=n,this.mousey=r});ht(this,"onDevMove",e=>{let n=0;e.gamma&&(n=e.gamma/90);let r=0;e.beta&&(r=e.beta/180);const s=Math.max(-1,Math.min(n*3,1)),c=Math.max(-1,Math.min(r*3,1));this.mousex=(s+1)/2,this.mousey=(c+1)/2})}async init(e){const n=await ki.loadImage("/hawaii_depth.jpg"),r=await ki.loadImage("/hawaii_bg2.jpg"),s=await ki.loadImage("/water-normal.png"),c=await ki.loadImage("/water-normal2.png"),h=await ki.loadImage("/clouds.png");this.destroyed||(this.islands=new vD(e,{heightImage:n,rgbImage:r,strength:.004,waterLine:.83,waterNormal1:s,waterNormal2:c,clouds:h}),this.looper=new kp(30,l=>{var m;(m=this.islands)==null||m.step({mousex:this.mousex,mousey:this.mousey,time:l/1e3})}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove))}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,n,r;(e=this.looper)==null||e.stopLoop(),(n=this.islands)==null||n.destroy(!0),this.islands=void 0,(r=this.canvas)==null||r.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("deviceorientationabsolute",this.onDevMove),this.canvas=void 0,this.destroyed=!0}}function _D(){const t=pt.useRef(null);return pt.useEffect(()=>{const e=new yD;if(t.current){const n=t.current;n.width=n.clientWidth,n.height=n.clientHeight,n.width<600&&(n.width=n.clientWidth*devicePixelRatio,n.height=n.clientHeight*devicePixelRatio),e.init(n).then(()=>e.startLoop())}return()=>e.destroy()},[t.current]),me.jsx("canvas",{ref:t,style:{width:"100%",height:"100%"}})}function xD(t){const e=pt.useRef(null);return pt.useEffect(()=>{const n=s=>{for(const c of s)c.isIntersecting&&c.target.classList.add("viewed")},r=new IntersectionObserver(n,{rootMargin:"-10%"});return e.current&&r.observe(e.current),()=>{e.current&&r.unobserve(e.current),r.disconnect}},[e.current]),me.jsx("div",{ref:e,className:"animatedBlock","data-animationtype":t.direction,children:t.children})}function CS(t){const e=pt.Children.count(t.children);function n(r){return r<=0?"fromLeft":r>=e-1?"fromRight":"fromBottom"}return me.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap"},children:t.children&&pt.Children.map(t.children,(r,s)=>me.jsx("div",{style:{flex:"1 0 50%"},children:me.jsx(xD,{direction:n(s),children:r},s)}))})}function bD(t){var n,r;const e=pt.useRef(null);return t.playing?(n=e.current)==null||n.play():(r=e.current)==null||r.pause(),pt.useEffect(()=>{e.current&&(t.playing?e.current.play():e.current.pause())},[e.current]),me.jsx("video",{ref:e,src:t.videoUrl,poster:t.posterUrl,preload:"auto",loop:!0,autoPlay:t.playing,muted:!0,volume:0,style:{width:"100%",objectFit:"cover",transform:"scale(1.1)"}})}function v_(t){let e={margin:"2rem",padding:"1rem"};t.active&&(e={...e,boxShadow:"0px 5px 15px 5px rgba(0, 0, 0, 0.09)",borderRadius:"1rem"});const n=me.jsx("div",{style:{borderRadius:"1rem",overflow:"hidden",width:"100%"},children:me.jsx(bD,{playing:t.active,videoUrl:t.videoUrl,posterUrl:t.posterUrl})});return t.direction==="left"?me.jsx("div",{style:e,children:me.jsxs(CS,{children:[me.jsx("div",{style:{margin:"2rem 1rem 2rem 0"},children:t.children}),n]})}):me.jsx("div",{style:e,children:me.jsxs(CS,{children:[n,me.jsx("div",{style:{margin:"2rem 0 2rem 1rem"},children:t.children})]})})}let wD=class{constructor(e){ht(this,"io");this.callback=e}set(e){this.io=new IntersectionObserver((r,s)=>{r.forEach(c=>{if(c.isIntersecting){const h=c.target,l=parseInt(h.dataset.rownr);this.callback(l)}})},{rootMargin:"-50% 0px -50% 0px"}),Array.from(e.querySelectorAll(".mainContentRow")).map(r=>{var s;return(s=this.io)==null?void 0:s.observe(r)})}destroy(){var e;(e=this.io)==null||e.disconnect()}};function SD(){const t=pt.useRef(null);pt.useEffect(()=>{const s=new wD(c=>r(c));return t.current&&s.set(t.current),()=>s.destroy()},[t.current]);const e=Bb(),[n,r]=pt.useState(0);return me.jsxs("div",{ref:t,className:"mainContentContainer",children:[me.jsx("div",{style:{margin:"3rem"},children:me.jsx("h1",{children:"Visualization gallery"})}),me.jsx("div",{className:"mainContentRow","data-rownr":"1",onMouseEnter:()=>r(1),onMouseLeave:()=>r(0),onClick:()=>e("/swe"),children:me.jsxs(v_,{active:n===1,videoUrl:"/water_small.mp4",posterUrl:"/water_firstframe.jpg",direction:"right",children:[me.jsx("h4",{children:"Fluid simulations"}),me.jsx("p",{children:"See how we use scientifically accurate fluid simulations to build immersive landscapes."})]})}),me.jsx("div",{className:"mainContentRow","data-rownr":"2",onMouseEnter:()=>r(2),onMouseLeave:()=>r(0),onClick:()=>e("/wind"),children:me.jsxs(v_,{active:n===2,videoUrl:"/wind_small.mp4",posterUrl:"/wind_firstframe.png",direction:"left",children:[me.jsx("h4",{children:"Wind visualizations"}),me.jsx("p",{children:"Integrate our dynamic wind visualizations into your maps."})]})}),me.jsx("div",{className:"mainContentRow","data-rownr":"3",onMouseEnter:()=>r(3),onMouseLeave:()=>r(0),onClick:()=>e("/math"),children:me.jsxs(v_,{active:n===3,videoUrl:"/math_smaller.mp4",posterUrl:"/math_firstframe.png",direction:"right",children:[me.jsx("h4",{children:"Math visualizations"}),me.jsx("p",{children:"Explaining mathematics visually."})]})})]})}function MD(){return me.jsx(Xd,{hero:me.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:me.jsx(wv,{title:"Code and Colors",subtitle:"Scientific data visualizations",heroBackground:me.jsx(_D,{})})}),footerContent:me.jsx(Ob,{}),children:me.jsx(SD,{})})}function TD(){const[t,e]=pt.useState("burger-bar unclicked"),[n,r]=pt.useState("menu hidden"),[s,c]=pt.useState(!1),h=()=>{s?(e("burger-bar unclicked"),r("menu hidden")):(e("burger-bar clicked"),r("menu visible")),c(!s)};return me.jsxs("div",{style:{width:"100%"},children:[me.jsx("nav",{children:me.jsxs("div",{className:"burger-menu",onClick:h,children:[me.jsx("div",{className:t}),me.jsx("div",{className:t}),me.jsx("div",{className:t})]})}),me.jsxs("div",{className:n,children:[me.jsx(pd,{height:"3rem"}),me.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[me.jsx(x0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/",onClick:h,children:"Home"}),me.jsx(x0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/contact",onClick:h,children:"Contact"}),me.jsx(x0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/swe",onClick:h,children:"SWE"}),me.jsx(x0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/wind",onClick:h,children:"Wind"}),me.jsx(x0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/math",onClick:h,children:"Math"})]})]})]})}function ED(){const{pathname:t}=$d();return pt.useEffect(()=>{window.scrollTo(0,0)},[t]),null}function AD(){return me.jsxs("div",{style:{width:"100%",position:"relative"},children:[me.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:2},children:me.jsx(TD,{})}),me.jsx(ED,{}),me.jsx(wI,{})]})}const UE=({backgroundImage:t,logo:e,title:n,subtitle:r})=>me.jsx("div",{className:"hero",style:{backgroundImage:`url(${t})`},children:me.jsxs("div",{className:"hero-content",children:[e&&me.jsx("div",{className:"hero-logo",children:e}),me.jsxs("div",{className:"hero-text-content",children:[me.jsx("h1",{className:"hero-title",children:n}),me.jsx("h3",{className:"hero-subtitle",children:r})]})]})});function CD(){return me.jsx(Xd,{hero:me.jsx(UE,{backgroundImage:"/legal.jpg",title:"Imprint",subtitle:""}),children:me.jsxs("div",{className:"impressum",children:[me.jsx("h1",{children:"Legal Notice"}),me.jsxs("div",{className:"section",style:{marginBottom:"2rem"},children:[me.jsx("p",{children:"code and colors"}),me.jsx("p",{children:" Bahnhofstr. 1, 82205 Gilching "}),me.jsx("p",{children:"+49 152 6799543"}),me.jsx("p",{children:"michael.langbein [at] codeandcolors.net"}),me.jsx("p",{children:"Represented by: Michael Langbein"}),me.jsx("p",{children:"Responsible for Content: Michael Lanbgein"}),me.jsx("p",{children:"VAT ID: TBD"}),me.jsx("p",{children:"Regulatory Authority: TBD"}),me.jsx("p",{children:"Online Dispute Resolution: TBD"}),me.jsx("p",{children:"This Legal Notice complies with the German laws under § 5 TMG and § 55 RStV."})]}),me.jsx("h2",{children:"Liability for Content"}),me.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:me.jsx("p",{children:"The contents of our website have been created with the greatest possible care. However, we cannot guarantee the contents' accuracy, completeness, or topicality. According to Section 7, paragraph 1 of the TMG (Telemediengesetz - German Telemedia Act), we as service providers are liable for our content on these pages by general laws. However, according to Sections 8 to 10 of the TMG, we service providers are not obliged to monitor external information transmitted or stored or investigate circumstances pointing to illegal activity. Obligations to remove or block the use of information under general laws remain unaffected. However, a liability in this regard is only possible from the moment of knowledge of a specific infringement. Upon notification of such violations, we will remove the content immediately."})}),me.jsx("h2",{children:"Liability for Links"}),me.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:me.jsx("p",{children:"Our website contains links to external websites, over whose contents we have no control. Therefore, we cannot accept any liability for these external contents. The respective provider or operator of the websites is always responsible for the contents of the linked pages. The linked pages were checked for possible legal violations at the time of linking. Illegal contents were not identified at the time of linking. However, permanent monitoring of the contents of the linked pages is not reasonable without specific indications of a violation. Upon notification of violations, we will remove such links immediately."})}),me.jsx("h2",{children:"Copyright"}),me.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:me.jsx("p",{children:"The contents and works on these pages created by the site operator are subject to German copyright law. The duplication, processing, distribution, and any kind of utilization outside the limits of copyright require the written consent of the respective author or creator. Downloads and copies of these pages are only permitted for private, non-commercial use. In so far as the contents on this site were not created by the operator, the copyrights of third parties are respected. In particular, third-party content is marked as such. Should you become aware of a copyright infringement, please inform us accordingly. Upon notification of violations, we will remove such contents immediately."})}),me.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:me.jsx("p",{children:"Last Updated: May 03, 2024"})})]})})}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Ub="164",Dh={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},kh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},PD=0,PS=1,RD=2,VE=1,ID=2,Jo=3,Tc=0,za=1,fo=2,bc=0,Sd=1,RS=2,IS=3,DS=4,DD=5,_u=100,kD=101,LD=102,zD=103,FD=104,ND=200,BD=201,OD=202,UD=203,d2=204,f2=205,VD=206,HD=207,GD=208,jD=209,WD=210,qD=211,$D=212,XD=213,ZD=214,YD=0,KD=1,JD=2,N1=3,QD=4,ek=5,tk=6,nk=7,HE=0,rk=1,ik=2,wc=0,ak=1,sk=2,ok=3,lk=4,ck=5,uk=6,hk=7,GE=300,Fd=301,Nd=302,p2=303,m2=304,Tv=306,Eu=1e3,Au=1001,g2=1002,xs=1003,dk=1004,ug=1005,$s=1006,y_=1007,Cu=1008,Ec=1009,fk=1010,pk=1011,jE=1012,WE=1013,Bd=1014,hc=1015,Ev=1016,qE=1017,$E=1018,Lp=1020,mk=35902,gk=1021,vk=1022,go=1023,yk=1024,_k=1025,Md=1026,vp=1027,xk=1028,XE=1029,bk=1030,ZE=1031,YE=1033,__=33776,x_=33777,b_=33778,w_=33779,kS=35840,LS=35841,zS=35842,FS=35843,NS=36196,BS=37492,OS=37496,US=37808,VS=37809,HS=37810,GS=37811,jS=37812,WS=37813,qS=37814,$S=37815,XS=37816,ZS=37817,YS=37818,KS=37819,JS=37820,QS=37821,S_=36492,e5=36494,t5=36495,wk=36283,n5=36284,r5=36285,i5=36286,Sk=3200,Mk=3201,Tk=0,Ek=1,lc="",oo="srgb",zc="srgb-linear",Vb="display-p3",Av="display-p3-linear",B1="linear",zr="srgb",O1="rec709",U1="p3",Lh=7680,a5=519,Ak=512,Ck=513,Pk=514,KE=515,Rk=516,Ik=517,Dk=518,kk=519,s5=35044,o5="300 es",il=2e3,V1=2001;class qu{addEventListener(e,n){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(n)===-1&&r[e].push(n)}hasEventListener(e,n){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(n)!==-1}removeEventListener(e,n){if(this._listeners===void 0)return;const s=this._listeners[e];if(s!==void 0){const c=s.indexOf(n);c!==-1&&s.splice(c,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const s=r.slice(0);for(let c=0,h=s.length;c<h;c++)s[c].call(this,e);e.target=null}}}const na=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let l5=1234567;const W0=Math.PI/180,yp=180/Math.PI;function Zd(){const t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,n=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(na[t&255]+na[t>>8&255]+na[t>>16&255]+na[t>>24&255]+"-"+na[e&255]+na[e>>8&255]+"-"+na[e>>16&15|64]+na[e>>24&255]+"-"+na[n&63|128]+na[n>>8&255]+"-"+na[n>>16&255]+na[n>>24&255]+na[r&255]+na[r>>8&255]+na[r>>16&255]+na[r>>24&255]).toLowerCase()}function aa(t,e,n){return Math.max(e,Math.min(n,t))}function Hb(t,e){return(t%e+e)%e}function Lk(t,e,n,r,s){return r+(t-e)*(s-r)/(n-e)}function zk(t,e,n){return t!==e?(n-t)/(e-t):0}function q0(t,e,n){return(1-n)*t+n*e}function Fk(t,e,n,r){return q0(t,e,1-Math.exp(-n*r))}function Nk(t,e=1){return e-Math.abs(Hb(t,e*2)-e)}function Bk(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*(3-2*t))}function Ok(t,e,n){return t<=e?0:t>=n?1:(t=(t-e)/(n-e),t*t*t*(t*(t*6-15)+10))}function Uk(t,e){return t+Math.floor(Math.random()*(e-t+1))}function Vk(t,e){return t+Math.random()*(e-t)}function Hk(t){return t*(.5-Math.random())}function Gk(t){t!==void 0&&(l5=t);let e=l5+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function jk(t){return t*W0}function Wk(t){return t*yp}function qk(t){return(t&t-1)===0&&t!==0}function $k(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Xk(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Zk(t,e,n,r,s){const c=Math.cos,h=Math.sin,l=c(n/2),m=h(n/2),_=c((e+r)/2),S=h((e+r)/2),T=c((e-r)/2),M=h((e-r)/2),I=c((r-e)/2),N=h((r-e)/2);switch(s){case"XYX":t.set(l*S,m*T,m*M,l*_);break;case"YZY":t.set(m*M,l*S,m*T,l*_);break;case"ZXZ":t.set(m*T,m*M,l*S,l*_);break;case"XZX":t.set(l*S,m*N,m*I,l*_);break;case"YXY":t.set(m*I,l*S,m*N,l*_);break;case"ZYZ":t.set(m*N,m*I,l*S,l*_);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+s)}}function Qh(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return t/4294967295;case Uint16Array:return t/65535;case Uint8Array:return t/255;case Int32Array:return Math.max(t/2147483647,-1);case Int16Array:return Math.max(t/32767,-1);case Int8Array:return Math.max(t/127,-1);default:throw new Error("Invalid component type.")}}function ma(t,e){switch(e.constructor){case Float32Array:return t;case Uint32Array:return Math.round(t*4294967295);case Uint16Array:return Math.round(t*65535);case Uint8Array:return Math.round(t*255);case Int32Array:return Math.round(t*2147483647);case Int16Array:return Math.round(t*32767);case Int8Array:return Math.round(t*127);default:throw new Error("Invalid component type.")}}const Yk={DEG2RAD:W0,RAD2DEG:yp,generateUUID:Zd,clamp:aa,euclideanModulo:Hb,mapLinear:Lk,inverseLerp:zk,lerp:q0,damp:Fk,pingpong:Nk,smoothstep:Bk,smootherstep:Ok,randInt:Uk,randFloat:Vk,randFloatSpread:Hk,seededRandom:Gk,degToRad:jk,radToDeg:Wk,isPowerOfTwo:qk,ceilPowerOfTwo:$k,floorPowerOfTwo:Xk,setQuaternionFromProperEuler:Zk,normalize:ma,denormalize:Qh};class Yn{constructor(e=0,n=0){Yn.prototype.isVector2=!0,this.x=e,this.y=n}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,n){return this.x=e,this.y=n,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const n=this.x,r=this.y,s=e.elements;return this.x=s[0]*n+s[3]*r+s[6],this.y=s[1]*n+s[4]*r+s[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(aa(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y;return n*n+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this}rotateAround(e,n){const r=Math.cos(n),s=Math.sin(n),c=this.x-e.x,h=this.y-e.y;return this.x=c*r-h*s+e.x,this.y=c*s+h*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Qn{constructor(e,n,r,s,c,h,l,m,_){Qn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,n,r,s,c,h,l,m,_)}set(e,n,r,s,c,h,l,m,_){const S=this.elements;return S[0]=e,S[1]=s,S[2]=l,S[3]=n,S[4]=c,S[5]=m,S[6]=r,S[7]=h,S[8]=_,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],this}extractBasis(e,n,r){return e.setFromMatrix3Column(this,0),n.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const n=e.elements;return this.set(n[0],n[4],n[8],n[1],n[5],n[9],n[2],n[6],n[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,c=this.elements,h=r[0],l=r[3],m=r[6],_=r[1],S=r[4],T=r[7],M=r[2],I=r[5],N=r[8],B=s[0],k=s[3],C=s[6],U=s[1],V=s[4],Y=s[7],he=s[2],Z=s[5],ne=s[8];return c[0]=h*B+l*U+m*he,c[3]=h*k+l*V+m*Z,c[6]=h*C+l*Y+m*ne,c[1]=_*B+S*U+T*he,c[4]=_*k+S*V+T*Z,c[7]=_*C+S*Y+T*ne,c[2]=M*B+I*U+N*he,c[5]=M*k+I*V+N*Z,c[8]=M*C+I*Y+N*ne,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=e,n[4]*=e,n[7]*=e,n[2]*=e,n[5]*=e,n[8]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[1],s=e[2],c=e[3],h=e[4],l=e[5],m=e[6],_=e[7],S=e[8];return n*h*S-n*l*_-r*c*S+r*l*m+s*c*_-s*h*m}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],c=e[3],h=e[4],l=e[5],m=e[6],_=e[7],S=e[8],T=S*h-l*_,M=l*m-S*c,I=_*c-h*m,N=n*T+r*M+s*I;if(N===0)return this.set(0,0,0,0,0,0,0,0,0);const B=1/N;return e[0]=T*B,e[1]=(s*_-S*r)*B,e[2]=(l*r-s*h)*B,e[3]=M*B,e[4]=(S*n-s*m)*B,e[5]=(s*c-l*n)*B,e[6]=I*B,e[7]=(r*m-_*n)*B,e[8]=(h*n-r*c)*B,this}transpose(){let e;const n=this.elements;return e=n[1],n[1]=n[3],n[3]=e,e=n[2],n[2]=n[6],n[6]=e,e=n[5],n[5]=n[7],n[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const n=this.elements;return e[0]=n[0],e[1]=n[3],e[2]=n[6],e[3]=n[1],e[4]=n[4],e[5]=n[7],e[6]=n[2],e[7]=n[5],e[8]=n[8],this}setUvTransform(e,n,r,s,c,h,l){const m=Math.cos(c),_=Math.sin(c);return this.set(r*m,r*_,-r*(m*h+_*l)+h+e,-s*_,s*m,-s*(-_*h+m*l)+l+n,0,0,1),this}scale(e,n){return this.premultiply(M_.makeScale(e,n)),this}rotate(e){return this.premultiply(M_.makeRotation(-e)),this}translate(e,n){return this.premultiply(M_.makeTranslation(e,n)),this}makeTranslation(e,n){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,n,0,0,1),this}makeRotation(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,r,n,0,0,0,1),this}makeScale(e,n){return this.set(e,0,0,0,n,0,0,0,1),this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<9;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<9;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const M_=new Qn;function JE(t){for(let e=t.length-1;e>=0;--e)if(t[e]>=65535)return!0;return!1}function _p(t){return document.createElementNS("http://www.w3.org/1999/xhtml",t)}function Kk(){const t=_p("canvas");return t.style.display="block",t}const c5={};function Jk(t){t in c5||(c5[t]=!0,console.warn(t))}const u5=new Qn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),h5=new Qn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),hg={[zc]:{transfer:B1,primaries:O1,toReference:t=>t,fromReference:t=>t},[oo]:{transfer:zr,primaries:O1,toReference:t=>t.convertSRGBToLinear(),fromReference:t=>t.convertLinearToSRGB()},[Av]:{transfer:B1,primaries:U1,toReference:t=>t.applyMatrix3(h5),fromReference:t=>t.applyMatrix3(u5)},[Vb]:{transfer:zr,primaries:U1,toReference:t=>t.convertSRGBToLinear().applyMatrix3(h5),fromReference:t=>t.applyMatrix3(u5).convertLinearToSRGB()}},Qk=new Set([zc,Av]),wr={enabled:!0,_workingColorSpace:zc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(t){if(!Qk.has(t))throw new Error(`Unsupported working color space, "${t}".`);this._workingColorSpace=t},convert:function(t,e,n){if(this.enabled===!1||e===n||!e||!n)return t;const r=hg[e].toReference,s=hg[n].fromReference;return s(r(t))},fromWorkingColorSpace:function(t,e){return this.convert(t,this._workingColorSpace,e)},toWorkingColorSpace:function(t,e){return this.convert(t,e,this._workingColorSpace)},getPrimaries:function(t){return hg[t].primaries},getTransfer:function(t){return t===lc?B1:hg[t].transfer}};function Td(t){return t<.04045?t*.0773993808:Math.pow(t*.9478672986+.0521327014,2.4)}function T_(t){return t<.0031308?t*12.92:1.055*Math.pow(t,.41666)-.055}let zh;class eL{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{zh===void 0&&(zh=_p("canvas")),zh.width=e.width,zh.height=e.height;const r=zh.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),n=zh}return n.width>2048||n.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),n.toDataURL("image/jpeg",.6)):n.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const n=_p("canvas");n.width=e.width,n.height=e.height;const r=n.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const s=r.getImageData(0,0,e.width,e.height),c=s.data;for(let h=0;h<c.length;h++)c[h]=Td(c[h]/255)*255;return r.putImageData(s,0,0),n}else if(e.data){const n=e.data.slice(0);for(let r=0;r<n.length;r++)n instanceof Uint8Array||n instanceof Uint8ClampedArray?n[r]=Math.floor(Td(n[r]/255)*255):n[r]=Td(n[r]);return{data:n,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let tL=0;class QE{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:tL++}),this.uuid=Zd(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},s=this.data;if(s!==null){let c;if(Array.isArray(s)){c=[];for(let h=0,l=s.length;h<l;h++)s[h].isDataTexture?c.push(E_(s[h].image)):c.push(E_(s[h]))}else c=E_(s);r.url=c}return n||(e.images[this.uuid]=r),r}}function E_(t){return typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap?eL.getDataURL(t):t.data?{data:Array.from(t.data),width:t.width,height:t.height,type:t.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let nL=0;class xa extends qu{constructor(e=xa.DEFAULT_IMAGE,n=xa.DEFAULT_MAPPING,r=Au,s=Au,c=$s,h=Cu,l=go,m=Ec,_=xa.DEFAULT_ANISOTROPY,S=lc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:nL++}),this.uuid=Zd(),this.name="",this.source=new QE(e),this.mipmaps=[],this.mapping=n,this.channel=0,this.wrapS=r,this.wrapT=s,this.magFilter=c,this.minFilter=h,this.anisotropy=_,this.format=l,this.internalFormat=null,this.type=m,this.offset=new Yn(0,0),this.repeat=new Yn(1,1),this.center=new Yn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=S,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const n=e===void 0||typeof e=="string";if(!n&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),n||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==GE)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Eu:e.x=e.x-Math.floor(e.x);break;case Au:e.x=e.x<0?0:1;break;case g2:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Eu:e.y=e.y-Math.floor(e.y);break;case Au:e.y=e.y<0?0:1;break;case g2:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}xa.DEFAULT_IMAGE=null;xa.DEFAULT_MAPPING=GE;xa.DEFAULT_ANISOTROPY=1;class Hi{constructor(e=0,n=0,r=0,s=1){Hi.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=s}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,n,r,s){return this.x=e,this.y=n,this.z=r,this.w=s,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;case 3:this.w=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this.w=e.w+n.w,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this.w+=e.w*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this.w=e.w-n.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,c=this.w,h=e.elements;return this.x=h[0]*n+h[4]*r+h[8]*s+h[12]*c,this.y=h[1]*n+h[5]*r+h[9]*s+h[13]*c,this.z=h[2]*n+h[6]*r+h[10]*s+h[14]*c,this.w=h[3]*n+h[7]*r+h[11]*s+h[15]*c,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const n=Math.sqrt(1-e.w*e.w);return n<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/n,this.y=e.y/n,this.z=e.z/n),this}setAxisAngleFromRotationMatrix(e){let n,r,s,c;const m=e.elements,_=m[0],S=m[4],T=m[8],M=m[1],I=m[5],N=m[9],B=m[2],k=m[6],C=m[10];if(Math.abs(S-M)<.01&&Math.abs(T-B)<.01&&Math.abs(N-k)<.01){if(Math.abs(S+M)<.1&&Math.abs(T+B)<.1&&Math.abs(N+k)<.1&&Math.abs(_+I+C-3)<.1)return this.set(1,0,0,0),this;n=Math.PI;const V=(_+1)/2,Y=(I+1)/2,he=(C+1)/2,Z=(S+M)/4,ne=(T+B)/4,xe=(N+k)/4;return V>Y&&V>he?V<.01?(r=0,s=.707106781,c=.707106781):(r=Math.sqrt(V),s=Z/r,c=ne/r):Y>he?Y<.01?(r=.707106781,s=0,c=.707106781):(s=Math.sqrt(Y),r=Z/s,c=xe/s):he<.01?(r=.707106781,s=.707106781,c=0):(c=Math.sqrt(he),r=ne/c,s=xe/c),this.set(r,s,c,n),this}let U=Math.sqrt((k-N)*(k-N)+(T-B)*(T-B)+(M-S)*(M-S));return Math.abs(U)<.001&&(U=1),this.x=(k-N)/U,this.y=(T-B)/U,this.z=(M-S)/U,this.w=Math.acos((_+I+C-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this.w=Math.max(e.w,Math.min(n.w,this.w)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this.w=Math.max(e,Math.min(n,this.w)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this.w+=(e.w-this.w)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this.w=e.w+(n.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this.w=e[n+3],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e[n+3]=this.w,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this.w=e.getW(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class rL extends qu{constructor(e=1,n=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=n,this.depth=1,this.scissor=new Hi(0,0,e,n),this.scissorTest=!1,this.viewport=new Hi(0,0,e,n);const s={width:e,height:n,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:$s,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},r);const c=new xa(s,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);c.flipY=!1,c.generateMipmaps=r.generateMipmaps,c.internalFormat=r.internalFormat,this.textures=[];const h=r.count;for(let l=0;l<h;l++)this.textures[l]=c.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.resolveDepthBuffer=r.resolveDepthBuffer,this.resolveStencilBuffer=r.resolveStencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,n,r=1){if(this.width!==e||this.height!==n||this.depth!==r){this.width=e,this.height=n,this.depth=r;for(let s=0,c=this.textures.length;s<c;s++)this.textures[s].image.width=e,this.textures[s].image.height=n,this.textures[s].image.depth=r;this.dispose()}this.viewport.set(0,0,e,n),this.scissor.set(0,0,e,n)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,s=e.textures.length;r<s;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const n=Object.assign({},e.texture.image);return this.texture.source=new QE(n),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Uu extends rL{constructor(e=1,n=1,r={}){super(e,n,r),this.isWebGLRenderTarget=!0}}class eA extends xa{constructor(e=null,n=1,r=1,s=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:n,height:r,depth:s},this.magFilter=xs,this.minFilter=xs,this.wrapR=Au,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class iL extends xa{constructor(e=null,n=1,r=1,s=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:n,height:r,depth:s},this.magFilter=xs,this.minFilter=xs,this.wrapR=Au,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Vu{constructor(e=0,n=0,r=0,s=1){this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=s}static slerpFlat(e,n,r,s,c,h,l){let m=r[s+0],_=r[s+1],S=r[s+2],T=r[s+3];const M=c[h+0],I=c[h+1],N=c[h+2],B=c[h+3];if(l===0){e[n+0]=m,e[n+1]=_,e[n+2]=S,e[n+3]=T;return}if(l===1){e[n+0]=M,e[n+1]=I,e[n+2]=N,e[n+3]=B;return}if(T!==B||m!==M||_!==I||S!==N){let k=1-l;const C=m*M+_*I+S*N+T*B,U=C>=0?1:-1,V=1-C*C;if(V>Number.EPSILON){const he=Math.sqrt(V),Z=Math.atan2(he,C*U);k=Math.sin(k*Z)/he,l=Math.sin(l*Z)/he}const Y=l*U;if(m=m*k+M*Y,_=_*k+I*Y,S=S*k+N*Y,T=T*k+B*Y,k===1-l){const he=1/Math.sqrt(m*m+_*_+S*S+T*T);m*=he,_*=he,S*=he,T*=he}}e[n]=m,e[n+1]=_,e[n+2]=S,e[n+3]=T}static multiplyQuaternionsFlat(e,n,r,s,c,h){const l=r[s],m=r[s+1],_=r[s+2],S=r[s+3],T=c[h],M=c[h+1],I=c[h+2],N=c[h+3];return e[n]=l*N+S*T+m*I-_*M,e[n+1]=m*N+S*M+_*T-l*I,e[n+2]=_*N+S*I+l*M-m*T,e[n+3]=S*N-l*T-m*M-_*I,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,n,r,s){return this._x=e,this._y=n,this._z=r,this._w=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,n=!0){const r=e._x,s=e._y,c=e._z,h=e._order,l=Math.cos,m=Math.sin,_=l(r/2),S=l(s/2),T=l(c/2),M=m(r/2),I=m(s/2),N=m(c/2);switch(h){case"XYZ":this._x=M*S*T+_*I*N,this._y=_*I*T-M*S*N,this._z=_*S*N+M*I*T,this._w=_*S*T-M*I*N;break;case"YXZ":this._x=M*S*T+_*I*N,this._y=_*I*T-M*S*N,this._z=_*S*N-M*I*T,this._w=_*S*T+M*I*N;break;case"ZXY":this._x=M*S*T-_*I*N,this._y=_*I*T+M*S*N,this._z=_*S*N+M*I*T,this._w=_*S*T-M*I*N;break;case"ZYX":this._x=M*S*T-_*I*N,this._y=_*I*T+M*S*N,this._z=_*S*N-M*I*T,this._w=_*S*T+M*I*N;break;case"YZX":this._x=M*S*T+_*I*N,this._y=_*I*T+M*S*N,this._z=_*S*N-M*I*T,this._w=_*S*T-M*I*N;break;case"XZY":this._x=M*S*T-_*I*N,this._y=_*I*T-M*S*N,this._z=_*S*N+M*I*T,this._w=_*S*T+M*I*N;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return n===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,n){const r=n/2,s=Math.sin(r);return this._x=e.x*s,this._y=e.y*s,this._z=e.z*s,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const n=e.elements,r=n[0],s=n[4],c=n[8],h=n[1],l=n[5],m=n[9],_=n[2],S=n[6],T=n[10],M=r+l+T;if(M>0){const I=.5/Math.sqrt(M+1);this._w=.25/I,this._x=(S-m)*I,this._y=(c-_)*I,this._z=(h-s)*I}else if(r>l&&r>T){const I=2*Math.sqrt(1+r-l-T);this._w=(S-m)/I,this._x=.25*I,this._y=(s+h)/I,this._z=(c+_)/I}else if(l>T){const I=2*Math.sqrt(1+l-r-T);this._w=(c-_)/I,this._x=(s+h)/I,this._y=.25*I,this._z=(m+S)/I}else{const I=2*Math.sqrt(1+T-r-l);this._w=(h-s)/I,this._x=(c+_)/I,this._y=(m+S)/I,this._z=.25*I}return this._onChangeCallback(),this}setFromUnitVectors(e,n){let r=e.dot(n)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*n.z-e.z*n.y,this._y=e.z*n.x-e.x*n.z,this._z=e.x*n.y-e.y*n.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(aa(this.dot(e),-1,1)))}rotateTowards(e,n){const r=this.angleTo(e);if(r===0)return this;const s=Math.min(1,n/r);return this.slerp(e,s),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,n){const r=e._x,s=e._y,c=e._z,h=e._w,l=n._x,m=n._y,_=n._z,S=n._w;return this._x=r*S+h*l+s*_-c*m,this._y=s*S+h*m+c*l-r*_,this._z=c*S+h*_+r*m-s*l,this._w=h*S-r*l-s*m-c*_,this._onChangeCallback(),this}slerp(e,n){if(n===0)return this;if(n===1)return this.copy(e);const r=this._x,s=this._y,c=this._z,h=this._w;let l=h*e._w+r*e._x+s*e._y+c*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=h,this._x=r,this._y=s,this._z=c,this;const m=1-l*l;if(m<=Number.EPSILON){const I=1-n;return this._w=I*h+n*this._w,this._x=I*r+n*this._x,this._y=I*s+n*this._y,this._z=I*c+n*this._z,this.normalize(),this}const _=Math.sqrt(m),S=Math.atan2(_,l),T=Math.sin((1-n)*S)/_,M=Math.sin(n*S)/_;return this._w=h*T+this._w*M,this._x=r*T+this._x*M,this._y=s*T+this._y*M,this._z=c*T+this._z*M,this._onChangeCallback(),this}slerpQuaternions(e,n,r){return this.copy(e).slerp(n,r)}random(){const e=2*Math.PI*Math.random(),n=2*Math.PI*Math.random(),r=Math.random(),s=Math.sqrt(1-r),c=Math.sqrt(r);return this.set(s*Math.sin(e),s*Math.cos(e),c*Math.sin(n),c*Math.cos(n))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,n=0){return this._x=e[n],this._y=e[n+1],this._z=e[n+2],this._w=e[n+3],this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._w,e}fromBufferAttribute(e,n){return this._x=e.getX(n),this._y=e.getY(n),this._z=e.getZ(n),this._w=e.getW(n),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class st{constructor(e=0,n=0,r=0){st.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}set(e,n,r){return r===void 0&&(r=this.z),this.x=e,this.y=n,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,n){switch(e){case 0:this.x=n;break;case 1:this.y=n;break;case 2:this.z=n;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,n){return this.x=e.x+n.x,this.y=e.y+n.y,this.z=e.z+n.z,this}addScaledVector(e,n){return this.x+=e.x*n,this.y+=e.y*n,this.z+=e.z*n,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,n){return this.x=e.x-n.x,this.y=e.y-n.y,this.z=e.z-n.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,n){return this.x=e.x*n.x,this.y=e.y*n.y,this.z=e.z*n.z,this}applyEuler(e){return this.applyQuaternion(d5.setFromEuler(e))}applyAxisAngle(e,n){return this.applyQuaternion(d5.setFromAxisAngle(e,n))}applyMatrix3(e){const n=this.x,r=this.y,s=this.z,c=e.elements;return this.x=c[0]*n+c[3]*r+c[6]*s,this.y=c[1]*n+c[4]*r+c[7]*s,this.z=c[2]*n+c[5]*r+c[8]*s,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const n=this.x,r=this.y,s=this.z,c=e.elements,h=1/(c[3]*n+c[7]*r+c[11]*s+c[15]);return this.x=(c[0]*n+c[4]*r+c[8]*s+c[12])*h,this.y=(c[1]*n+c[5]*r+c[9]*s+c[13])*h,this.z=(c[2]*n+c[6]*r+c[10]*s+c[14])*h,this}applyQuaternion(e){const n=this.x,r=this.y,s=this.z,c=e.x,h=e.y,l=e.z,m=e.w,_=2*(h*s-l*r),S=2*(l*n-c*s),T=2*(c*r-h*n);return this.x=n+m*_+h*T-l*S,this.y=r+m*S+l*_-c*T,this.z=s+m*T+c*S-h*_,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const n=this.x,r=this.y,s=this.z,c=e.elements;return this.x=c[0]*n+c[4]*r+c[8]*s,this.y=c[1]*n+c[5]*r+c[9]*s,this.z=c[2]*n+c[6]*r+c[10]*s,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,n){return this.x=Math.max(e.x,Math.min(n.x,this.x)),this.y=Math.max(e.y,Math.min(n.y,this.y)),this.z=Math.max(e.z,Math.min(n.z,this.z)),this}clampScalar(e,n){return this.x=Math.max(e,Math.min(n,this.x)),this.y=Math.max(e,Math.min(n,this.y)),this.z=Math.max(e,Math.min(n,this.z)),this}clampLength(e,n){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(n,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,n){return this.x+=(e.x-this.x)*n,this.y+=(e.y-this.y)*n,this.z+=(e.z-this.z)*n,this}lerpVectors(e,n,r){return this.x=e.x+(n.x-e.x)*r,this.y=e.y+(n.y-e.y)*r,this.z=e.z+(n.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,n){const r=e.x,s=e.y,c=e.z,h=n.x,l=n.y,m=n.z;return this.x=s*m-c*l,this.y=c*h-r*m,this.z=r*l-s*h,this}projectOnVector(e){const n=e.lengthSq();if(n===0)return this.set(0,0,0);const r=e.dot(this)/n;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return A_.copy(this).projectOnVector(e),this.sub(A_)}reflect(e){return this.sub(A_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const n=Math.sqrt(this.lengthSq()*e.lengthSq());if(n===0)return Math.PI/2;const r=this.dot(e)/n;return Math.acos(aa(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const n=this.x-e.x,r=this.y-e.y,s=this.z-e.z;return n*n+r*r+s*s}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,n,r){const s=Math.sin(n)*e;return this.x=s*Math.sin(r),this.y=Math.cos(n)*e,this.z=s*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,n,r){return this.x=e*Math.sin(n),this.y=r,this.z=e*Math.cos(n),this}setFromMatrixPosition(e){const n=e.elements;return this.x=n[12],this.y=n[13],this.z=n[14],this}setFromMatrixScale(e){const n=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),s=this.setFromMatrixColumn(e,2).length();return this.x=n,this.y=r,this.z=s,this}setFromMatrixColumn(e,n){return this.fromArray(e.elements,n*4)}setFromMatrix3Column(e,n){return this.fromArray(e.elements,n*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,n=0){return this.x=e[n],this.y=e[n+1],this.z=e[n+2],this}toArray(e=[],n=0){return e[n]=this.x,e[n+1]=this.y,e[n+2]=this.z,e}fromBufferAttribute(e,n){return this.x=e.getX(n),this.y=e.getY(n),this.z=e.getZ(n),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,n=Math.random()*2-1,r=Math.sqrt(1-n*n);return this.x=r*Math.cos(e),this.y=n,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const A_=new st,d5=new Vu;class zp{constructor(e=new st(1/0,1/0,1/0),n=new st(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=n}set(e,n){return this.min.copy(e),this.max.copy(n),this}setFromArray(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n+=3)this.expandByPoint(Ns.fromArray(e,n));return this}setFromBufferAttribute(e){this.makeEmpty();for(let n=0,r=e.count;n<r;n++)this.expandByPoint(Ns.fromBufferAttribute(e,n));return this}setFromPoints(e){this.makeEmpty();for(let n=0,r=e.length;n<r;n++)this.expandByPoint(e[n]);return this}setFromCenterAndSize(e,n){const r=Ns.copy(n).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,n=!1){return this.makeEmpty(),this.expandByObject(e,n)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,n=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const c=r.getAttribute("position");if(n===!0&&c!==void 0&&e.isInstancedMesh!==!0)for(let h=0,l=c.count;h<l;h++)e.isMesh===!0?e.getVertexPosition(h,Ns):Ns.fromBufferAttribute(c,h),Ns.applyMatrix4(e.matrixWorld),this.expandByPoint(Ns);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),dg.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),dg.copy(r.boundingBox)),dg.applyMatrix4(e.matrixWorld),this.union(dg)}const s=e.children;for(let c=0,h=s.length;c<h;c++)this.expandByObject(s[c],n);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,n){return n.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ns),Ns.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let n,r;return e.normal.x>0?(n=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(n=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(n+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(n+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(n+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(n+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),n<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(b0),fg.subVectors(this.max,b0),Fh.subVectors(e.a,b0),Nh.subVectors(e.b,b0),Bh.subVectors(e.c,b0),$l.subVectors(Nh,Fh),Xl.subVectors(Bh,Nh),su.subVectors(Fh,Bh);let n=[0,-$l.z,$l.y,0,-Xl.z,Xl.y,0,-su.z,su.y,$l.z,0,-$l.x,Xl.z,0,-Xl.x,su.z,0,-su.x,-$l.y,$l.x,0,-Xl.y,Xl.x,0,-su.y,su.x,0];return!C_(n,Fh,Nh,Bh,fg)||(n=[1,0,0,0,1,0,0,0,1],!C_(n,Fh,Nh,Bh,fg))?!1:(pg.crossVectors($l,Xl),n=[pg.x,pg.y,pg.z],C_(n,Fh,Nh,Bh,fg))}clampPoint(e,n){return n.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ns).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ns).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Wo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Wo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Wo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Wo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Wo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Wo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Wo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Wo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Wo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Wo=[new st,new st,new st,new st,new st,new st,new st,new st],Ns=new st,dg=new zp,Fh=new st,Nh=new st,Bh=new st,$l=new st,Xl=new st,su=new st,b0=new st,fg=new st,pg=new st,ou=new st;function C_(t,e,n,r,s){for(let c=0,h=t.length-3;c<=h;c+=3){ou.fromArray(t,c);const l=s.x*Math.abs(ou.x)+s.y*Math.abs(ou.y)+s.z*Math.abs(ou.z),m=e.dot(ou),_=n.dot(ou),S=r.dot(ou);if(Math.max(-Math.max(m,_,S),Math.min(m,_,S))>l)return!1}return!0}const aL=new zp,w0=new st,P_=new st;class Gb{constructor(e=new st,n=-1){this.isSphere=!0,this.center=e,this.radius=n}set(e,n){return this.center.copy(e),this.radius=n,this}setFromPoints(e,n){const r=this.center;n!==void 0?r.copy(n):aL.setFromPoints(e).getCenter(r);let s=0;for(let c=0,h=e.length;c<h;c++)s=Math.max(s,r.distanceToSquared(e[c]));return this.radius=Math.sqrt(s),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const n=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=n*n}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,n){const r=this.center.distanceToSquared(e);return n.copy(e),r>this.radius*this.radius&&(n.sub(this.center).normalize(),n.multiplyScalar(this.radius).add(this.center)),n}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;w0.subVectors(e,this.center);const n=w0.lengthSq();if(n>this.radius*this.radius){const r=Math.sqrt(n),s=(r-this.radius)*.5;this.center.addScaledVector(w0,s/r),this.radius+=s}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(P_.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(w0.copy(e.center).add(P_)),this.expandByPoint(w0.copy(e.center).sub(P_))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const qo=new st,R_=new st,mg=new st,Zl=new st,I_=new st,gg=new st,D_=new st;class tA{constructor(e=new st,n=new st(0,0,-1)){this.origin=e,this.direction=n}set(e,n){return this.origin.copy(e),this.direction.copy(n),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,n){return n.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,qo)),this}closestPointToPoint(e,n){n.subVectors(e,this.origin);const r=n.dot(this.direction);return r<0?n.copy(this.origin):n.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const n=qo.subVectors(e,this.origin).dot(this.direction);return n<0?this.origin.distanceToSquared(e):(qo.copy(this.origin).addScaledVector(this.direction,n),qo.distanceToSquared(e))}distanceSqToSegment(e,n,r,s){R_.copy(e).add(n).multiplyScalar(.5),mg.copy(n).sub(e).normalize(),Zl.copy(this.origin).sub(R_);const c=e.distanceTo(n)*.5,h=-this.direction.dot(mg),l=Zl.dot(this.direction),m=-Zl.dot(mg),_=Zl.lengthSq(),S=Math.abs(1-h*h);let T,M,I,N;if(S>0)if(T=h*m-l,M=h*l-m,N=c*S,T>=0)if(M>=-N)if(M<=N){const B=1/S;T*=B,M*=B,I=T*(T+h*M+2*l)+M*(h*T+M+2*m)+_}else M=c,T=Math.max(0,-(h*M+l)),I=-T*T+M*(M+2*m)+_;else M=-c,T=Math.max(0,-(h*M+l)),I=-T*T+M*(M+2*m)+_;else M<=-N?(T=Math.max(0,-(-h*c+l)),M=T>0?-c:Math.min(Math.max(-c,-m),c),I=-T*T+M*(M+2*m)+_):M<=N?(T=0,M=Math.min(Math.max(-c,-m),c),I=M*(M+2*m)+_):(T=Math.max(0,-(h*c+l)),M=T>0?c:Math.min(Math.max(-c,-m),c),I=-T*T+M*(M+2*m)+_);else M=h>0?-c:c,T=Math.max(0,-(h*M+l)),I=-T*T+M*(M+2*m)+_;return r&&r.copy(this.origin).addScaledVector(this.direction,T),s&&s.copy(R_).addScaledVector(mg,M),I}intersectSphere(e,n){qo.subVectors(e.center,this.origin);const r=qo.dot(this.direction),s=qo.dot(qo)-r*r,c=e.radius*e.radius;if(s>c)return null;const h=Math.sqrt(c-s),l=r-h,m=r+h;return m<0?null:l<0?this.at(m,n):this.at(l,n)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const n=e.normal.dot(this.direction);if(n===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/n;return r>=0?r:null}intersectPlane(e,n){const r=this.distanceToPlane(e);return r===null?null:this.at(r,n)}intersectsPlane(e){const n=e.distanceToPoint(this.origin);return n===0||e.normal.dot(this.direction)*n<0}intersectBox(e,n){let r,s,c,h,l,m;const _=1/this.direction.x,S=1/this.direction.y,T=1/this.direction.z,M=this.origin;return _>=0?(r=(e.min.x-M.x)*_,s=(e.max.x-M.x)*_):(r=(e.max.x-M.x)*_,s=(e.min.x-M.x)*_),S>=0?(c=(e.min.y-M.y)*S,h=(e.max.y-M.y)*S):(c=(e.max.y-M.y)*S,h=(e.min.y-M.y)*S),r>h||c>s||((c>r||isNaN(r))&&(r=c),(h<s||isNaN(s))&&(s=h),T>=0?(l=(e.min.z-M.z)*T,m=(e.max.z-M.z)*T):(l=(e.max.z-M.z)*T,m=(e.min.z-M.z)*T),r>m||l>s)||((l>r||r!==r)&&(r=l),(m<s||s!==s)&&(s=m),s<0)?null:this.at(r>=0?r:s,n)}intersectsBox(e){return this.intersectBox(e,qo)!==null}intersectTriangle(e,n,r,s,c){I_.subVectors(n,e),gg.subVectors(r,e),D_.crossVectors(I_,gg);let h=this.direction.dot(D_),l;if(h>0){if(s)return null;l=1}else if(h<0)l=-1,h=-h;else return null;Zl.subVectors(this.origin,e);const m=l*this.direction.dot(gg.crossVectors(Zl,gg));if(m<0)return null;const _=l*this.direction.dot(I_.cross(Zl));if(_<0||m+_>h)return null;const S=-l*Zl.dot(D_);return S<0?null:this.at(S/h,c)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class bi{constructor(e,n,r,s,c,h,l,m,_,S,T,M,I,N,B,k){bi.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,n,r,s,c,h,l,m,_,S,T,M,I,N,B,k)}set(e,n,r,s,c,h,l,m,_,S,T,M,I,N,B,k){const C=this.elements;return C[0]=e,C[4]=n,C[8]=r,C[12]=s,C[1]=c,C[5]=h,C[9]=l,C[13]=m,C[2]=_,C[6]=S,C[10]=T,C[14]=M,C[3]=I,C[7]=N,C[11]=B,C[15]=k,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new bi().fromArray(this.elements)}copy(e){const n=this.elements,r=e.elements;return n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this}copyPosition(e){const n=this.elements,r=e.elements;return n[12]=r[12],n[13]=r[13],n[14]=r[14],this}setFromMatrix3(e){const n=e.elements;return this.set(n[0],n[3],n[6],0,n[1],n[4],n[7],0,n[2],n[5],n[8],0,0,0,0,1),this}extractBasis(e,n,r){return e.setFromMatrixColumn(this,0),n.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,n,r){return this.set(e.x,n.x,r.x,0,e.y,n.y,r.y,0,e.z,n.z,r.z,0,0,0,0,1),this}extractRotation(e){const n=this.elements,r=e.elements,s=1/Oh.setFromMatrixColumn(e,0).length(),c=1/Oh.setFromMatrixColumn(e,1).length(),h=1/Oh.setFromMatrixColumn(e,2).length();return n[0]=r[0]*s,n[1]=r[1]*s,n[2]=r[2]*s,n[3]=0,n[4]=r[4]*c,n[5]=r[5]*c,n[6]=r[6]*c,n[7]=0,n[8]=r[8]*h,n[9]=r[9]*h,n[10]=r[10]*h,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromEuler(e){const n=this.elements,r=e.x,s=e.y,c=e.z,h=Math.cos(r),l=Math.sin(r),m=Math.cos(s),_=Math.sin(s),S=Math.cos(c),T=Math.sin(c);if(e.order==="XYZ"){const M=h*S,I=h*T,N=l*S,B=l*T;n[0]=m*S,n[4]=-m*T,n[8]=_,n[1]=I+N*_,n[5]=M-B*_,n[9]=-l*m,n[2]=B-M*_,n[6]=N+I*_,n[10]=h*m}else if(e.order==="YXZ"){const M=m*S,I=m*T,N=_*S,B=_*T;n[0]=M+B*l,n[4]=N*l-I,n[8]=h*_,n[1]=h*T,n[5]=h*S,n[9]=-l,n[2]=I*l-N,n[6]=B+M*l,n[10]=h*m}else if(e.order==="ZXY"){const M=m*S,I=m*T,N=_*S,B=_*T;n[0]=M-B*l,n[4]=-h*T,n[8]=N+I*l,n[1]=I+N*l,n[5]=h*S,n[9]=B-M*l,n[2]=-h*_,n[6]=l,n[10]=h*m}else if(e.order==="ZYX"){const M=h*S,I=h*T,N=l*S,B=l*T;n[0]=m*S,n[4]=N*_-I,n[8]=M*_+B,n[1]=m*T,n[5]=B*_+M,n[9]=I*_-N,n[2]=-_,n[6]=l*m,n[10]=h*m}else if(e.order==="YZX"){const M=h*m,I=h*_,N=l*m,B=l*_;n[0]=m*S,n[4]=B-M*T,n[8]=N*T+I,n[1]=T,n[5]=h*S,n[9]=-l*S,n[2]=-_*S,n[6]=I*T+N,n[10]=M-B*T}else if(e.order==="XZY"){const M=h*m,I=h*_,N=l*m,B=l*_;n[0]=m*S,n[4]=-T,n[8]=_*S,n[1]=M*T+B,n[5]=h*S,n[9]=I*T-N,n[2]=N*T-I,n[6]=l*S,n[10]=B*T+M}return n[3]=0,n[7]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0,n[15]=1,this}makeRotationFromQuaternion(e){return this.compose(sL,e,oL)}lookAt(e,n,r){const s=this.elements;return $a.subVectors(e,n),$a.lengthSq()===0&&($a.z=1),$a.normalize(),Yl.crossVectors(r,$a),Yl.lengthSq()===0&&(Math.abs(r.z)===1?$a.x+=1e-4:$a.z+=1e-4,$a.normalize(),Yl.crossVectors(r,$a)),Yl.normalize(),vg.crossVectors($a,Yl),s[0]=Yl.x,s[4]=vg.x,s[8]=$a.x,s[1]=Yl.y,s[5]=vg.y,s[9]=$a.y,s[2]=Yl.z,s[6]=vg.z,s[10]=$a.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,n){const r=e.elements,s=n.elements,c=this.elements,h=r[0],l=r[4],m=r[8],_=r[12],S=r[1],T=r[5],M=r[9],I=r[13],N=r[2],B=r[6],k=r[10],C=r[14],U=r[3],V=r[7],Y=r[11],he=r[15],Z=s[0],ne=s[4],xe=s[8],ie=s[12],J=s[1],Te=s[5],Be=s[9],Re=s[13],We=s[2],ct=s[6],gt=s[10],ft=s[14],ke=s[3],at=s[7],ot=s[11],_t=s[15];return c[0]=h*Z+l*J+m*We+_*ke,c[4]=h*ne+l*Te+m*ct+_*at,c[8]=h*xe+l*Be+m*gt+_*ot,c[12]=h*ie+l*Re+m*ft+_*_t,c[1]=S*Z+T*J+M*We+I*ke,c[5]=S*ne+T*Te+M*ct+I*at,c[9]=S*xe+T*Be+M*gt+I*ot,c[13]=S*ie+T*Re+M*ft+I*_t,c[2]=N*Z+B*J+k*We+C*ke,c[6]=N*ne+B*Te+k*ct+C*at,c[10]=N*xe+B*Be+k*gt+C*ot,c[14]=N*ie+B*Re+k*ft+C*_t,c[3]=U*Z+V*J+Y*We+he*ke,c[7]=U*ne+V*Te+Y*ct+he*at,c[11]=U*xe+V*Be+Y*gt+he*ot,c[15]=U*ie+V*Re+Y*ft+he*_t,this}multiplyScalar(e){const n=this.elements;return n[0]*=e,n[4]*=e,n[8]*=e,n[12]*=e,n[1]*=e,n[5]*=e,n[9]*=e,n[13]*=e,n[2]*=e,n[6]*=e,n[10]*=e,n[14]*=e,n[3]*=e,n[7]*=e,n[11]*=e,n[15]*=e,this}determinant(){const e=this.elements,n=e[0],r=e[4],s=e[8],c=e[12],h=e[1],l=e[5],m=e[9],_=e[13],S=e[2],T=e[6],M=e[10],I=e[14],N=e[3],B=e[7],k=e[11],C=e[15];return N*(+c*m*T-s*_*T-c*l*M+r*_*M+s*l*I-r*m*I)+B*(+n*m*I-n*_*M+c*h*M-s*h*I+s*_*S-c*m*S)+k*(+n*_*T-n*l*I-c*h*T+r*h*I+c*l*S-r*_*S)+C*(-s*l*S-n*m*T+n*l*M+s*h*T-r*h*M+r*m*S)}transpose(){const e=this.elements;let n;return n=e[1],e[1]=e[4],e[4]=n,n=e[2],e[2]=e[8],e[8]=n,n=e[6],e[6]=e[9],e[9]=n,n=e[3],e[3]=e[12],e[12]=n,n=e[7],e[7]=e[13],e[13]=n,n=e[11],e[11]=e[14],e[14]=n,this}setPosition(e,n,r){const s=this.elements;return e.isVector3?(s[12]=e.x,s[13]=e.y,s[14]=e.z):(s[12]=e,s[13]=n,s[14]=r),this}invert(){const e=this.elements,n=e[0],r=e[1],s=e[2],c=e[3],h=e[4],l=e[5],m=e[6],_=e[7],S=e[8],T=e[9],M=e[10],I=e[11],N=e[12],B=e[13],k=e[14],C=e[15],U=T*k*_-B*M*_+B*m*I-l*k*I-T*m*C+l*M*C,V=N*M*_-S*k*_-N*m*I+h*k*I+S*m*C-h*M*C,Y=S*B*_-N*T*_+N*l*I-h*B*I-S*l*C+h*T*C,he=N*T*m-S*B*m-N*l*M+h*B*M+S*l*k-h*T*k,Z=n*U+r*V+s*Y+c*he;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ne=1/Z;return e[0]=U*ne,e[1]=(B*M*c-T*k*c-B*s*I+r*k*I+T*s*C-r*M*C)*ne,e[2]=(l*k*c-B*m*c+B*s*_-r*k*_-l*s*C+r*m*C)*ne,e[3]=(T*m*c-l*M*c-T*s*_+r*M*_+l*s*I-r*m*I)*ne,e[4]=V*ne,e[5]=(S*k*c-N*M*c+N*s*I-n*k*I-S*s*C+n*M*C)*ne,e[6]=(N*m*c-h*k*c-N*s*_+n*k*_+h*s*C-n*m*C)*ne,e[7]=(h*M*c-S*m*c+S*s*_-n*M*_-h*s*I+n*m*I)*ne,e[8]=Y*ne,e[9]=(N*T*c-S*B*c-N*r*I+n*B*I+S*r*C-n*T*C)*ne,e[10]=(h*B*c-N*l*c+N*r*_-n*B*_-h*r*C+n*l*C)*ne,e[11]=(S*l*c-h*T*c-S*r*_+n*T*_+h*r*I-n*l*I)*ne,e[12]=he*ne,e[13]=(S*B*s-N*T*s+N*r*M-n*B*M-S*r*k+n*T*k)*ne,e[14]=(N*l*s-h*B*s-N*r*m+n*B*m+h*r*k-n*l*k)*ne,e[15]=(h*T*s-S*l*s+S*r*m-n*T*m-h*r*M+n*l*M)*ne,this}scale(e){const n=this.elements,r=e.x,s=e.y,c=e.z;return n[0]*=r,n[4]*=s,n[8]*=c,n[1]*=r,n[5]*=s,n[9]*=c,n[2]*=r,n[6]*=s,n[10]*=c,n[3]*=r,n[7]*=s,n[11]*=c,this}getMaxScaleOnAxis(){const e=this.elements,n=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],s=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(n,r,s))}makeTranslation(e,n,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,n,0,0,1,r,0,0,0,1),this}makeRotationX(e){const n=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,n,-r,0,0,r,n,0,0,0,0,1),this}makeRotationY(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,0,r,0,0,1,0,0,-r,0,n,0,0,0,0,1),this}makeRotationZ(e){const n=Math.cos(e),r=Math.sin(e);return this.set(n,-r,0,0,r,n,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,n){const r=Math.cos(n),s=Math.sin(n),c=1-r,h=e.x,l=e.y,m=e.z,_=c*h,S=c*l;return this.set(_*h+r,_*l-s*m,_*m+s*l,0,_*l+s*m,S*l+r,S*m-s*h,0,_*m-s*l,S*m+s*h,c*m*m+r,0,0,0,0,1),this}makeScale(e,n,r){return this.set(e,0,0,0,0,n,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,n,r,s,c,h){return this.set(1,r,c,0,e,1,h,0,n,s,1,0,0,0,0,1),this}compose(e,n,r){const s=this.elements,c=n._x,h=n._y,l=n._z,m=n._w,_=c+c,S=h+h,T=l+l,M=c*_,I=c*S,N=c*T,B=h*S,k=h*T,C=l*T,U=m*_,V=m*S,Y=m*T,he=r.x,Z=r.y,ne=r.z;return s[0]=(1-(B+C))*he,s[1]=(I+Y)*he,s[2]=(N-V)*he,s[3]=0,s[4]=(I-Y)*Z,s[5]=(1-(M+C))*Z,s[6]=(k+U)*Z,s[7]=0,s[8]=(N+V)*ne,s[9]=(k-U)*ne,s[10]=(1-(M+B))*ne,s[11]=0,s[12]=e.x,s[13]=e.y,s[14]=e.z,s[15]=1,this}decompose(e,n,r){const s=this.elements;let c=Oh.set(s[0],s[1],s[2]).length();const h=Oh.set(s[4],s[5],s[6]).length(),l=Oh.set(s[8],s[9],s[10]).length();this.determinant()<0&&(c=-c),e.x=s[12],e.y=s[13],e.z=s[14],Bs.copy(this);const _=1/c,S=1/h,T=1/l;return Bs.elements[0]*=_,Bs.elements[1]*=_,Bs.elements[2]*=_,Bs.elements[4]*=S,Bs.elements[5]*=S,Bs.elements[6]*=S,Bs.elements[8]*=T,Bs.elements[9]*=T,Bs.elements[10]*=T,n.setFromRotationMatrix(Bs),r.x=c,r.y=h,r.z=l,this}makePerspective(e,n,r,s,c,h,l=il){const m=this.elements,_=2*c/(n-e),S=2*c/(r-s),T=(n+e)/(n-e),M=(r+s)/(r-s);let I,N;if(l===il)I=-(h+c)/(h-c),N=-2*h*c/(h-c);else if(l===V1)I=-h/(h-c),N=-h*c/(h-c);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return m[0]=_,m[4]=0,m[8]=T,m[12]=0,m[1]=0,m[5]=S,m[9]=M,m[13]=0,m[2]=0,m[6]=0,m[10]=I,m[14]=N,m[3]=0,m[7]=0,m[11]=-1,m[15]=0,this}makeOrthographic(e,n,r,s,c,h,l=il){const m=this.elements,_=1/(n-e),S=1/(r-s),T=1/(h-c),M=(n+e)*_,I=(r+s)*S;let N,B;if(l===il)N=(h+c)*T,B=-2*T;else if(l===V1)N=c*T,B=-1*T;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return m[0]=2*_,m[4]=0,m[8]=0,m[12]=-M,m[1]=0,m[5]=2*S,m[9]=0,m[13]=-I,m[2]=0,m[6]=0,m[10]=B,m[14]=-N,m[3]=0,m[7]=0,m[11]=0,m[15]=1,this}equals(e){const n=this.elements,r=e.elements;for(let s=0;s<16;s++)if(n[s]!==r[s])return!1;return!0}fromArray(e,n=0){for(let r=0;r<16;r++)this.elements[r]=e[r+n];return this}toArray(e=[],n=0){const r=this.elements;return e[n]=r[0],e[n+1]=r[1],e[n+2]=r[2],e[n+3]=r[3],e[n+4]=r[4],e[n+5]=r[5],e[n+6]=r[6],e[n+7]=r[7],e[n+8]=r[8],e[n+9]=r[9],e[n+10]=r[10],e[n+11]=r[11],e[n+12]=r[12],e[n+13]=r[13],e[n+14]=r[14],e[n+15]=r[15],e}}const Oh=new st,Bs=new bi,sL=new st(0,0,0),oL=new st(1,1,1),Yl=new st,vg=new st,$a=new st,f5=new bi,p5=new Vu;class pl{constructor(e=0,n=0,r=0,s=pl.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=s}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,n,r,s=this._order){return this._x=e,this._y=n,this._z=r,this._order=s,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,n=this._order,r=!0){const s=e.elements,c=s[0],h=s[4],l=s[8],m=s[1],_=s[5],S=s[9],T=s[2],M=s[6],I=s[10];switch(n){case"XYZ":this._y=Math.asin(aa(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-S,I),this._z=Math.atan2(-h,c)):(this._x=Math.atan2(M,_),this._z=0);break;case"YXZ":this._x=Math.asin(-aa(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(l,I),this._z=Math.atan2(m,_)):(this._y=Math.atan2(-T,c),this._z=0);break;case"ZXY":this._x=Math.asin(aa(M,-1,1)),Math.abs(M)<.9999999?(this._y=Math.atan2(-T,I),this._z=Math.atan2(-h,_)):(this._y=0,this._z=Math.atan2(m,c));break;case"ZYX":this._y=Math.asin(-aa(T,-1,1)),Math.abs(T)<.9999999?(this._x=Math.atan2(M,I),this._z=Math.atan2(m,c)):(this._x=0,this._z=Math.atan2(-h,_));break;case"YZX":this._z=Math.asin(aa(m,-1,1)),Math.abs(m)<.9999999?(this._x=Math.atan2(-S,_),this._y=Math.atan2(-T,c)):(this._x=0,this._y=Math.atan2(l,I));break;case"XZY":this._z=Math.asin(-aa(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(M,_),this._y=Math.atan2(l,c)):(this._x=Math.atan2(-S,I),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+n)}return this._order=n,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,n,r){return f5.makeRotationFromQuaternion(e),this.setFromRotationMatrix(f5,n,r)}setFromVector3(e,n=this._order){return this.set(e.x,e.y,e.z,n)}reorder(e){return p5.setFromEuler(this),this.setFromQuaternion(p5,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],n=0){return e[n]=this._x,e[n+1]=this._y,e[n+2]=this._z,e[n+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}pl.DEFAULT_ORDER="XYZ";class nA{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let lL=0;const m5=new st,Uh=new Vu,$o=new bi,yg=new st,S0=new st,cL=new st,uL=new Vu,g5=new st(1,0,0),v5=new st(0,1,0),y5=new st(0,0,1),_5={type:"added"},hL={type:"removed"},Vh={type:"childadded",child:null},k_={type:"childremoved",child:null};class es extends qu{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:lL++}),this.uuid=Zd(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=es.DEFAULT_UP.clone();const e=new st,n=new pl,r=new Vu,s=new st(1,1,1);function c(){r.setFromEuler(n,!1)}function h(){n.setFromQuaternion(r,void 0,!1)}n._onChange(c),r._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:n},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:s},modelViewMatrix:{value:new bi},normalMatrix:{value:new Qn}}),this.matrix=new bi,this.matrixWorld=new bi,this.matrixAutoUpdate=es.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=es.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new nA,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,n){this.quaternion.setFromAxisAngle(e,n)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,n){return Uh.setFromAxisAngle(e,n),this.quaternion.multiply(Uh),this}rotateOnWorldAxis(e,n){return Uh.setFromAxisAngle(e,n),this.quaternion.premultiply(Uh),this}rotateX(e){return this.rotateOnAxis(g5,e)}rotateY(e){return this.rotateOnAxis(v5,e)}rotateZ(e){return this.rotateOnAxis(y5,e)}translateOnAxis(e,n){return m5.copy(e).applyQuaternion(this.quaternion),this.position.add(m5.multiplyScalar(n)),this}translateX(e){return this.translateOnAxis(g5,e)}translateY(e){return this.translateOnAxis(v5,e)}translateZ(e){return this.translateOnAxis(y5,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4($o.copy(this.matrixWorld).invert())}lookAt(e,n,r){e.isVector3?yg.copy(e):yg.set(e,n,r);const s=this.parent;this.updateWorldMatrix(!0,!1),S0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?$o.lookAt(S0,yg,this.up):$o.lookAt(yg,S0,this.up),this.quaternion.setFromRotationMatrix($o),s&&($o.extractRotation(s.matrixWorld),Uh.setFromRotationMatrix($o),this.quaternion.premultiply(Uh.invert()))}add(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.add(arguments[n]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_5),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const n=this.children.indexOf(e);return n!==-1&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(hL),k_.child=e,this.dispatchEvent(k_),k_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),$o.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),$o.multiply(e.parent.matrixWorld)),e.applyMatrix4($o),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_5),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,n){if(this[e]===n)return this;for(let r=0,s=this.children.length;r<s;r++){const h=this.children[r].getObjectByProperty(e,n);if(h!==void 0)return h}}getObjectsByProperty(e,n,r=[]){this[e]===n&&r.push(this);const s=this.children;for(let c=0,h=s.length;c<h;c++)s[c].getObjectsByProperty(e,n,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(S0,e,cL),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(S0,uL,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const n=this.matrixWorld.elements;return e.set(n[8],n[9],n[10]).normalize()}raycast(){}traverse(e){e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const n=this.children;for(let r=0,s=n.length;r<s;r++)n[r].traverseVisible(e)}traverseAncestors(e){const n=this.parent;n!==null&&(e(n),n.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const n=this.children;for(let r=0,s=n.length;r<s;r++){const c=n[r];(c.matrixWorldAutoUpdate===!0||e===!0)&&c.updateMatrixWorld(e)}}updateWorldMatrix(e,n){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),n===!0){const s=this.children;for(let c=0,h=s.length;c<h;c++){const l=s[c];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const n=e===void 0||typeof e=="string",r={};n&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const s={};s.uuid=this.uuid,s.type=this.type,this.name!==""&&(s.name=this.name),this.castShadow===!0&&(s.castShadow=!0),this.receiveShadow===!0&&(s.receiveShadow=!0),this.visible===!1&&(s.visible=!1),this.frustumCulled===!1&&(s.frustumCulled=!1),this.renderOrder!==0&&(s.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(s.userData=this.userData),s.layers=this.layers.mask,s.matrix=this.matrix.toArray(),s.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(s.matrixAutoUpdate=!1),this.isInstancedMesh&&(s.type="InstancedMesh",s.count=this.count,s.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(s.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(s.type="BatchedMesh",s.perObjectFrustumCulled=this.perObjectFrustumCulled,s.sortObjects=this.sortObjects,s.drawRanges=this._drawRanges,s.reservedRanges=this._reservedRanges,s.visibility=this._visibility,s.active=this._active,s.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),s.maxGeometryCount=this._maxGeometryCount,s.maxVertexCount=this._maxVertexCount,s.maxIndexCount=this._maxIndexCount,s.geometryInitialized=this._geometryInitialized,s.geometryCount=this._geometryCount,s.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(s.boundingSphere={center:s.boundingSphere.center.toArray(),radius:s.boundingSphere.radius}),this.boundingBox!==null&&(s.boundingBox={min:s.boundingBox.min.toArray(),max:s.boundingBox.max.toArray()}));function c(l,m){return l[m.uuid]===void 0&&(l[m.uuid]=m.toJSON(e)),m.uuid}if(this.isScene)this.background&&(this.background.isColor?s.background=this.background.toJSON():this.background.isTexture&&(s.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(s.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){s.geometry=c(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const m=l.shapes;if(Array.isArray(m))for(let _=0,S=m.length;_<S;_++){const T=m[_];c(e.shapes,T)}else c(e.shapes,m)}}if(this.isSkinnedMesh&&(s.bindMode=this.bindMode,s.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(c(e.skeletons,this.skeleton),s.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let m=0,_=this.material.length;m<_;m++)l.push(c(e.materials,this.material[m]));s.material=l}else s.material=c(e.materials,this.material);if(this.children.length>0){s.children=[];for(let l=0;l<this.children.length;l++)s.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){s.animations=[];for(let l=0;l<this.animations.length;l++){const m=this.animations[l];s.animations.push(c(e.animations,m))}}if(n){const l=h(e.geometries),m=h(e.materials),_=h(e.textures),S=h(e.images),T=h(e.shapes),M=h(e.skeletons),I=h(e.animations),N=h(e.nodes);l.length>0&&(r.geometries=l),m.length>0&&(r.materials=m),_.length>0&&(r.textures=_),S.length>0&&(r.images=S),T.length>0&&(r.shapes=T),M.length>0&&(r.skeletons=M),I.length>0&&(r.animations=I),N.length>0&&(r.nodes=N)}return r.object=s,r;function h(l){const m=[];for(const _ in l){const S=l[_];delete S.metadata,m.push(S)}return m}}clone(e){return new this.constructor().copy(this,e)}copy(e,n=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),n===!0)for(let r=0;r<e.children.length;r++){const s=e.children[r];this.add(s.clone())}return this}}es.DEFAULT_UP=new st(0,1,0);es.DEFAULT_MATRIX_AUTO_UPDATE=!0;es.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Os=new st,Xo=new st,L_=new st,Zo=new st,Hh=new st,Gh=new st,x5=new st,z_=new st,F_=new st,N_=new st;class po{constructor(e=new st,n=new st,r=new st){this.a=e,this.b=n,this.c=r}static getNormal(e,n,r,s){s.subVectors(r,n),Os.subVectors(e,n),s.cross(Os);const c=s.lengthSq();return c>0?s.multiplyScalar(1/Math.sqrt(c)):s.set(0,0,0)}static getBarycoord(e,n,r,s,c){Os.subVectors(s,n),Xo.subVectors(r,n),L_.subVectors(e,n);const h=Os.dot(Os),l=Os.dot(Xo),m=Os.dot(L_),_=Xo.dot(Xo),S=Xo.dot(L_),T=h*_-l*l;if(T===0)return c.set(0,0,0),null;const M=1/T,I=(_*m-l*S)*M,N=(h*S-l*m)*M;return c.set(1-I-N,N,I)}static containsPoint(e,n,r,s){return this.getBarycoord(e,n,r,s,Zo)===null?!1:Zo.x>=0&&Zo.y>=0&&Zo.x+Zo.y<=1}static getInterpolation(e,n,r,s,c,h,l,m){return this.getBarycoord(e,n,r,s,Zo)===null?(m.x=0,m.y=0,"z"in m&&(m.z=0),"w"in m&&(m.w=0),null):(m.setScalar(0),m.addScaledVector(c,Zo.x),m.addScaledVector(h,Zo.y),m.addScaledVector(l,Zo.z),m)}static isFrontFacing(e,n,r,s){return Os.subVectors(r,n),Xo.subVectors(e,n),Os.cross(Xo).dot(s)<0}set(e,n,r){return this.a.copy(e),this.b.copy(n),this.c.copy(r),this}setFromPointsAndIndices(e,n,r,s){return this.a.copy(e[n]),this.b.copy(e[r]),this.c.copy(e[s]),this}setFromAttributeAndIndices(e,n,r,s){return this.a.fromBufferAttribute(e,n),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,s),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Os.subVectors(this.c,this.b),Xo.subVectors(this.a,this.b),Os.cross(Xo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return po.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,n){return po.getBarycoord(e,this.a,this.b,this.c,n)}getInterpolation(e,n,r,s,c){return po.getInterpolation(e,this.a,this.b,this.c,n,r,s,c)}containsPoint(e){return po.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return po.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,n){const r=this.a,s=this.b,c=this.c;let h,l;Hh.subVectors(s,r),Gh.subVectors(c,r),z_.subVectors(e,r);const m=Hh.dot(z_),_=Gh.dot(z_);if(m<=0&&_<=0)return n.copy(r);F_.subVectors(e,s);const S=Hh.dot(F_),T=Gh.dot(F_);if(S>=0&&T<=S)return n.copy(s);const M=m*T-S*_;if(M<=0&&m>=0&&S<=0)return h=m/(m-S),n.copy(r).addScaledVector(Hh,h);N_.subVectors(e,c);const I=Hh.dot(N_),N=Gh.dot(N_);if(N>=0&&I<=N)return n.copy(c);const B=I*_-m*N;if(B<=0&&_>=0&&N<=0)return l=_/(_-N),n.copy(r).addScaledVector(Gh,l);const k=S*N-I*T;if(k<=0&&T-S>=0&&I-N>=0)return x5.subVectors(c,s),l=(T-S)/(T-S+(I-N)),n.copy(s).addScaledVector(x5,l);const C=1/(k+B+M);return h=B*C,l=M*C,n.copy(r).addScaledVector(Hh,h).addScaledVector(Gh,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const rA={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Kl={h:0,s:0,l:0},_g={h:0,s:0,l:0};function B_(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*6*(2/3-n):t}let Sr=class{constructor(e,n,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,n,r)}set(e,n,r){if(n===void 0&&r===void 0){const s=e;s&&s.isColor?this.copy(s):typeof s=="number"?this.setHex(s):typeof s=="string"&&this.setStyle(s)}else this.setRGB(e,n,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,n=oo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,wr.toWorkingColorSpace(this,n),this}setRGB(e,n,r,s=wr.workingColorSpace){return this.r=e,this.g=n,this.b=r,wr.toWorkingColorSpace(this,s),this}setHSL(e,n,r,s=wr.workingColorSpace){if(e=Hb(e,1),n=aa(n,0,1),r=aa(r,0,1),n===0)this.r=this.g=this.b=r;else{const c=r<=.5?r*(1+n):r+n-r*n,h=2*r-c;this.r=B_(h,c,e+1/3),this.g=B_(h,c,e),this.b=B_(h,c,e-1/3)}return wr.toWorkingColorSpace(this,s),this}setStyle(e,n=oo){function r(c){c!==void 0&&parseFloat(c)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let s;if(s=/^(\w+)\(([^\)]*)\)/.exec(e)){let c;const h=s[1],l=s[2];switch(h){case"rgb":case"rgba":if(c=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(c[4]),this.setRGB(Math.min(255,parseInt(c[1],10))/255,Math.min(255,parseInt(c[2],10))/255,Math.min(255,parseInt(c[3],10))/255,n);if(c=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(c[4]),this.setRGB(Math.min(100,parseInt(c[1],10))/100,Math.min(100,parseInt(c[2],10))/100,Math.min(100,parseInt(c[3],10))/100,n);break;case"hsl":case"hsla":if(c=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(c[4]),this.setHSL(parseFloat(c[1])/360,parseFloat(c[2])/100,parseFloat(c[3])/100,n);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(s=/^\#([A-Fa-f\d]+)$/.exec(e)){const c=s[1],h=c.length;if(h===3)return this.setRGB(parseInt(c.charAt(0),16)/15,parseInt(c.charAt(1),16)/15,parseInt(c.charAt(2),16)/15,n);if(h===6)return this.setHex(parseInt(c,16),n);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,n);return this}setColorName(e,n=oo){const r=rA[e.toLowerCase()];return r!==void 0?this.setHex(r,n):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Td(e.r),this.g=Td(e.g),this.b=Td(e.b),this}copyLinearToSRGB(e){return this.r=T_(e.r),this.g=T_(e.g),this.b=T_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=oo){return wr.fromWorkingColorSpace(ra.copy(this),e),Math.round(aa(ra.r*255,0,255))*65536+Math.round(aa(ra.g*255,0,255))*256+Math.round(aa(ra.b*255,0,255))}getHexString(e=oo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,n=wr.workingColorSpace){wr.fromWorkingColorSpace(ra.copy(this),n);const r=ra.r,s=ra.g,c=ra.b,h=Math.max(r,s,c),l=Math.min(r,s,c);let m,_;const S=(l+h)/2;if(l===h)m=0,_=0;else{const T=h-l;switch(_=S<=.5?T/(h+l):T/(2-h-l),h){case r:m=(s-c)/T+(s<c?6:0);break;case s:m=(c-r)/T+2;break;case c:m=(r-s)/T+4;break}m/=6}return e.h=m,e.s=_,e.l=S,e}getRGB(e,n=wr.workingColorSpace){return wr.fromWorkingColorSpace(ra.copy(this),n),e.r=ra.r,e.g=ra.g,e.b=ra.b,e}getStyle(e=oo){wr.fromWorkingColorSpace(ra.copy(this),e);const n=ra.r,r=ra.g,s=ra.b;return e!==oo?`color(${e} ${n.toFixed(3)} ${r.toFixed(3)} ${s.toFixed(3)})`:`rgb(${Math.round(n*255)},${Math.round(r*255)},${Math.round(s*255)})`}offsetHSL(e,n,r){return this.getHSL(Kl),this.setHSL(Kl.h+e,Kl.s+n,Kl.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,n){return this.r=e.r+n.r,this.g=e.g+n.g,this.b=e.b+n.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,n){return this.r+=(e.r-this.r)*n,this.g+=(e.g-this.g)*n,this.b+=(e.b-this.b)*n,this}lerpColors(e,n,r){return this.r=e.r+(n.r-e.r)*r,this.g=e.g+(n.g-e.g)*r,this.b=e.b+(n.b-e.b)*r,this}lerpHSL(e,n){this.getHSL(Kl),e.getHSL(_g);const r=q0(Kl.h,_g.h,n),s=q0(Kl.s,_g.s,n),c=q0(Kl.l,_g.l,n);return this.setHSL(r,s,c),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const n=this.r,r=this.g,s=this.b,c=e.elements;return this.r=c[0]*n+c[3]*r+c[6]*s,this.g=c[1]*n+c[4]*r+c[7]*s,this.b=c[2]*n+c[5]*r+c[8]*s,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,n=0){return this.r=e[n],this.g=e[n+1],this.b=e[n+2],this}toArray(e=[],n=0){return e[n]=this.r,e[n+1]=this.g,e[n+2]=this.b,e}fromBufferAttribute(e,n){return this.r=e.getX(n),this.g=e.getY(n),this.b=e.getZ(n),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const ra=new Sr;Sr.NAMES=rA;let dL=0;class Cv extends qu{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dL++}),this.uuid=Zd(),this.name="",this.type="Material",this.blending=Sd,this.side=Tc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=d2,this.blendDst=f2,this.blendEquation=_u,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Sr(0,0,0),this.blendAlpha=0,this.depthFunc=N1,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=a5,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Lh,this.stencilZFail=Lh,this.stencilZPass=Lh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const n in e){const r=e[n];if(r===void 0){console.warn(`THREE.Material: parameter '${n}' has value of undefined.`);continue}const s=this[n];if(s===void 0){console.warn(`THREE.Material: '${n}' is not a property of THREE.${this.type}.`);continue}s&&s.isColor?s.set(r):s&&s.isVector3&&r&&r.isVector3?s.copy(r):this[n]=r}}toJSON(e){const n=e===void 0||typeof e=="string";n&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(r.dispersion=this.dispersion),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Sd&&(r.blending=this.blending),this.side!==Tc&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==d2&&(r.blendSrc=this.blendSrc),this.blendDst!==f2&&(r.blendDst=this.blendDst),this.blendEquation!==_u&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==N1&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==a5&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Lh&&(r.stencilFail=this.stencilFail),this.stencilZFail!==Lh&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==Lh&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function s(c){const h=[];for(const l in c){const m=c[l];delete m.metadata,h.push(m)}return h}if(n){const c=s(e.textures),h=s(e.images);c.length>0&&(r.textures=c),h.length>0&&(r.images=h)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const n=e.clippingPlanes;let r=null;if(n!==null){const s=n.length;r=new Array(s);for(let c=0;c!==s;++c)r[c]=n[c].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class iA extends Cv{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Sr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new pl,this.combine=HE,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const pi=new st,xg=new Yn;class xo{constructor(e,n,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=n,this.count=e!==void 0?e.length/n:0,this.normalized=r,this.usage=s5,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=hc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return Jk("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,n){this.updateRanges.push({start:e,count:n})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,n,r){e*=this.itemSize,r*=n.itemSize;for(let s=0,c=this.itemSize;s<c;s++)this.array[e+s]=n.array[r+s];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let n=0,r=this.count;n<r;n++)xg.fromBufferAttribute(this,n),xg.applyMatrix3(e),this.setXY(n,xg.x,xg.y);else if(this.itemSize===3)for(let n=0,r=this.count;n<r;n++)pi.fromBufferAttribute(this,n),pi.applyMatrix3(e),this.setXYZ(n,pi.x,pi.y,pi.z);return this}applyMatrix4(e){for(let n=0,r=this.count;n<r;n++)pi.fromBufferAttribute(this,n),pi.applyMatrix4(e),this.setXYZ(n,pi.x,pi.y,pi.z);return this}applyNormalMatrix(e){for(let n=0,r=this.count;n<r;n++)pi.fromBufferAttribute(this,n),pi.applyNormalMatrix(e),this.setXYZ(n,pi.x,pi.y,pi.z);return this}transformDirection(e){for(let n=0,r=this.count;n<r;n++)pi.fromBufferAttribute(this,n),pi.transformDirection(e),this.setXYZ(n,pi.x,pi.y,pi.z);return this}set(e,n=0){return this.array.set(e,n),this}getComponent(e,n){let r=this.array[e*this.itemSize+n];return this.normalized&&(r=Qh(r,this.array)),r}setComponent(e,n,r){return this.normalized&&(r=ma(r,this.array)),this.array[e*this.itemSize+n]=r,this}getX(e){let n=this.array[e*this.itemSize];return this.normalized&&(n=Qh(n,this.array)),n}setX(e,n){return this.normalized&&(n=ma(n,this.array)),this.array[e*this.itemSize]=n,this}getY(e){let n=this.array[e*this.itemSize+1];return this.normalized&&(n=Qh(n,this.array)),n}setY(e,n){return this.normalized&&(n=ma(n,this.array)),this.array[e*this.itemSize+1]=n,this}getZ(e){let n=this.array[e*this.itemSize+2];return this.normalized&&(n=Qh(n,this.array)),n}setZ(e,n){return this.normalized&&(n=ma(n,this.array)),this.array[e*this.itemSize+2]=n,this}getW(e){let n=this.array[e*this.itemSize+3];return this.normalized&&(n=Qh(n,this.array)),n}setW(e,n){return this.normalized&&(n=ma(n,this.array)),this.array[e*this.itemSize+3]=n,this}setXY(e,n,r){return e*=this.itemSize,this.normalized&&(n=ma(n,this.array),r=ma(r,this.array)),this.array[e+0]=n,this.array[e+1]=r,this}setXYZ(e,n,r,s){return e*=this.itemSize,this.normalized&&(n=ma(n,this.array),r=ma(r,this.array),s=ma(s,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this}setXYZW(e,n,r,s,c){return e*=this.itemSize,this.normalized&&(n=ma(n,this.array),r=ma(r,this.array),s=ma(s,this.array),c=ma(c,this.array)),this.array[e+0]=n,this.array[e+1]=r,this.array[e+2]=s,this.array[e+3]=c,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==s5&&(e.usage=this.usage),e}}class aA extends xo{constructor(e,n,r){super(new Uint16Array(e),n,r)}}class sA extends xo{constructor(e,n,r){super(new Uint32Array(e),n,r)}}class bo extends xo{constructor(e,n,r){super(new Float32Array(e),n,r)}}let fL=0;const fs=new bi,O_=new es,jh=new st,Xa=new zp,M0=new zp,Ii=new st;class Fc extends qu{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:fL++}),this.uuid=Zd(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(JE(e)?sA:aA)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,n){return this.attributes[e]=n,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,n,r=0){this.groups.push({start:e,count:n,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,n){this.drawRange.start=e,this.drawRange.count=n}applyMatrix4(e){const n=this.attributes.position;n!==void 0&&(n.applyMatrix4(e),n.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const c=new Qn().getNormalMatrix(e);r.applyNormalMatrix(c),r.needsUpdate=!0}const s=this.attributes.tangent;return s!==void 0&&(s.transformDirection(e),s.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return fs.makeRotationFromQuaternion(e),this.applyMatrix4(fs),this}rotateX(e){return fs.makeRotationX(e),this.applyMatrix4(fs),this}rotateY(e){return fs.makeRotationY(e),this.applyMatrix4(fs),this}rotateZ(e){return fs.makeRotationZ(e),this.applyMatrix4(fs),this}translate(e,n,r){return fs.makeTranslation(e,n,r),this.applyMatrix4(fs),this}scale(e,n,r){return fs.makeScale(e,n,r),this.applyMatrix4(fs),this}lookAt(e){return O_.lookAt(e),O_.updateMatrix(),this.applyMatrix4(O_.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(jh).negate(),this.translate(jh.x,jh.y,jh.z),this}setFromPoints(e){const n=[];for(let r=0,s=e.length;r<s;r++){const c=e[r];n.push(c.x,c.y,c.z||0)}return this.setAttribute("position",new bo(n,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new zp);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new st(-1/0,-1/0,-1/0),new st(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),n)for(let r=0,s=n.length;r<s;r++){const c=n[r];Xa.setFromBufferAttribute(c),this.morphTargetsRelative?(Ii.addVectors(this.boundingBox.min,Xa.min),this.boundingBox.expandByPoint(Ii),Ii.addVectors(this.boundingBox.max,Xa.max),this.boundingBox.expandByPoint(Ii)):(this.boundingBox.expandByPoint(Xa.min),this.boundingBox.expandByPoint(Xa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Gb);const e=this.attributes.position,n=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new st,1/0);return}if(e){const r=this.boundingSphere.center;if(Xa.setFromBufferAttribute(e),n)for(let c=0,h=n.length;c<h;c++){const l=n[c];M0.setFromBufferAttribute(l),this.morphTargetsRelative?(Ii.addVectors(Xa.min,M0.min),Xa.expandByPoint(Ii),Ii.addVectors(Xa.max,M0.max),Xa.expandByPoint(Ii)):(Xa.expandByPoint(M0.min),Xa.expandByPoint(M0.max))}Xa.getCenter(r);let s=0;for(let c=0,h=e.count;c<h;c++)Ii.fromBufferAttribute(e,c),s=Math.max(s,r.distanceToSquared(Ii));if(n)for(let c=0,h=n.length;c<h;c++){const l=n[c],m=this.morphTargetsRelative;for(let _=0,S=l.count;_<S;_++)Ii.fromBufferAttribute(l,_),m&&(jh.fromBufferAttribute(e,_),Ii.add(jh)),s=Math.max(s,r.distanceToSquared(Ii))}this.boundingSphere.radius=Math.sqrt(s),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,n=this.attributes;if(e===null||n.position===void 0||n.normal===void 0||n.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=n.position,s=n.normal,c=n.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new xo(new Float32Array(4*r.count),4));const h=this.getAttribute("tangent"),l=[],m=[];for(let xe=0;xe<r.count;xe++)l[xe]=new st,m[xe]=new st;const _=new st,S=new st,T=new st,M=new Yn,I=new Yn,N=new Yn,B=new st,k=new st;function C(xe,ie,J){_.fromBufferAttribute(r,xe),S.fromBufferAttribute(r,ie),T.fromBufferAttribute(r,J),M.fromBufferAttribute(c,xe),I.fromBufferAttribute(c,ie),N.fromBufferAttribute(c,J),S.sub(_),T.sub(_),I.sub(M),N.sub(M);const Te=1/(I.x*N.y-N.x*I.y);isFinite(Te)&&(B.copy(S).multiplyScalar(N.y).addScaledVector(T,-I.y).multiplyScalar(Te),k.copy(T).multiplyScalar(I.x).addScaledVector(S,-N.x).multiplyScalar(Te),l[xe].add(B),l[ie].add(B),l[J].add(B),m[xe].add(k),m[ie].add(k),m[J].add(k))}let U=this.groups;U.length===0&&(U=[{start:0,count:e.count}]);for(let xe=0,ie=U.length;xe<ie;++xe){const J=U[xe],Te=J.start,Be=J.count;for(let Re=Te,We=Te+Be;Re<We;Re+=3)C(e.getX(Re+0),e.getX(Re+1),e.getX(Re+2))}const V=new st,Y=new st,he=new st,Z=new st;function ne(xe){he.fromBufferAttribute(s,xe),Z.copy(he);const ie=l[xe];V.copy(ie),V.sub(he.multiplyScalar(he.dot(ie))).normalize(),Y.crossVectors(Z,ie);const Te=Y.dot(m[xe])<0?-1:1;h.setXYZW(xe,V.x,V.y,V.z,Te)}for(let xe=0,ie=U.length;xe<ie;++xe){const J=U[xe],Te=J.start,Be=J.count;for(let Re=Te,We=Te+Be;Re<We;Re+=3)ne(e.getX(Re+0)),ne(e.getX(Re+1)),ne(e.getX(Re+2))}}computeVertexNormals(){const e=this.index,n=this.getAttribute("position");if(n!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new xo(new Float32Array(n.count*3),3),this.setAttribute("normal",r);else for(let M=0,I=r.count;M<I;M++)r.setXYZ(M,0,0,0);const s=new st,c=new st,h=new st,l=new st,m=new st,_=new st,S=new st,T=new st;if(e)for(let M=0,I=e.count;M<I;M+=3){const N=e.getX(M+0),B=e.getX(M+1),k=e.getX(M+2);s.fromBufferAttribute(n,N),c.fromBufferAttribute(n,B),h.fromBufferAttribute(n,k),S.subVectors(h,c),T.subVectors(s,c),S.cross(T),l.fromBufferAttribute(r,N),m.fromBufferAttribute(r,B),_.fromBufferAttribute(r,k),l.add(S),m.add(S),_.add(S),r.setXYZ(N,l.x,l.y,l.z),r.setXYZ(B,m.x,m.y,m.z),r.setXYZ(k,_.x,_.y,_.z)}else for(let M=0,I=n.count;M<I;M+=3)s.fromBufferAttribute(n,M+0),c.fromBufferAttribute(n,M+1),h.fromBufferAttribute(n,M+2),S.subVectors(h,c),T.subVectors(s,c),S.cross(T),r.setXYZ(M+0,S.x,S.y,S.z),r.setXYZ(M+1,S.x,S.y,S.z),r.setXYZ(M+2,S.x,S.y,S.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let n=0,r=e.count;n<r;n++)Ii.fromBufferAttribute(e,n),Ii.normalize(),e.setXYZ(n,Ii.x,Ii.y,Ii.z)}toNonIndexed(){function e(l,m){const _=l.array,S=l.itemSize,T=l.normalized,M=new _.constructor(m.length*S);let I=0,N=0;for(let B=0,k=m.length;B<k;B++){l.isInterleavedBufferAttribute?I=m[B]*l.data.stride+l.offset:I=m[B]*S;for(let C=0;C<S;C++)M[N++]=_[I++]}return new xo(M,S,T)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const n=new Fc,r=this.index.array,s=this.attributes;for(const l in s){const m=s[l],_=e(m,r);n.setAttribute(l,_)}const c=this.morphAttributes;for(const l in c){const m=[],_=c[l];for(let S=0,T=_.length;S<T;S++){const M=_[S],I=e(M,r);m.push(I)}n.morphAttributes[l]=m}n.morphTargetsRelative=this.morphTargetsRelative;const h=this.groups;for(let l=0,m=h.length;l<m;l++){const _=h[l];n.addGroup(_.start,_.count,_.materialIndex)}return n}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const m=this.parameters;for(const _ in m)m[_]!==void 0&&(e[_]=m[_]);return e}e.data={attributes:{}};const n=this.index;n!==null&&(e.data.index={type:n.array.constructor.name,array:Array.prototype.slice.call(n.array)});const r=this.attributes;for(const m in r){const _=r[m];e.data.attributes[m]=_.toJSON(e.data)}const s={};let c=!1;for(const m in this.morphAttributes){const _=this.morphAttributes[m],S=[];for(let T=0,M=_.length;T<M;T++){const I=_[T];S.push(I.toJSON(e.data))}S.length>0&&(s[m]=S,c=!0)}c&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);const h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const n={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(n));const s=e.attributes;for(const _ in s){const S=s[_];this.setAttribute(_,S.clone(n))}const c=e.morphAttributes;for(const _ in c){const S=[],T=c[_];for(let M=0,I=T.length;M<I;M++)S.push(T[M].clone(n));this.morphAttributes[_]=S}this.morphTargetsRelative=e.morphTargetsRelative;const h=e.groups;for(let _=0,S=h.length;_<S;_++){const T=h[_];this.addGroup(T.start,T.count,T.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const m=e.boundingSphere;return m!==null&&(this.boundingSphere=m.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const b5=new bi,lu=new tA,bg=new Gb,w5=new st,Wh=new st,qh=new st,$h=new st,U_=new st,wg=new st,Sg=new Yn,Mg=new Yn,Tg=new Yn,S5=new st,M5=new st,T5=new st,Eg=new st,Ag=new st;class Ja extends es{constructor(e=new Fc,n=new iA){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=n,this.updateMorphTargets()}copy(e,n){return super.copy(e,n),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const n=this.geometry.morphAttributes,r=Object.keys(n);if(r.length>0){const s=n[r[0]];if(s!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let c=0,h=s.length;c<h;c++){const l=s[c].name||String(c);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=c}}}}getVertexPosition(e,n){const r=this.geometry,s=r.attributes.position,c=r.morphAttributes.position,h=r.morphTargetsRelative;n.fromBufferAttribute(s,e);const l=this.morphTargetInfluences;if(c&&l){wg.set(0,0,0);for(let m=0,_=c.length;m<_;m++){const S=l[m],T=c[m];S!==0&&(U_.fromBufferAttribute(T,e),h?wg.addScaledVector(U_,S):wg.addScaledVector(U_.sub(n),S))}n.add(wg)}return n}raycast(e,n){const r=this.geometry,s=this.material,c=this.matrixWorld;s!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),bg.copy(r.boundingSphere),bg.applyMatrix4(c),lu.copy(e.ray).recast(e.near),!(bg.containsPoint(lu.origin)===!1&&(lu.intersectSphere(bg,w5)===null||lu.origin.distanceToSquared(w5)>(e.far-e.near)**2))&&(b5.copy(c).invert(),lu.copy(e.ray).applyMatrix4(b5),!(r.boundingBox!==null&&lu.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,n,lu)))}_computeIntersections(e,n,r){let s;const c=this.geometry,h=this.material,l=c.index,m=c.attributes.position,_=c.attributes.uv,S=c.attributes.uv1,T=c.attributes.normal,M=c.groups,I=c.drawRange;if(l!==null)if(Array.isArray(h))for(let N=0,B=M.length;N<B;N++){const k=M[N],C=h[k.materialIndex],U=Math.max(k.start,I.start),V=Math.min(l.count,Math.min(k.start+k.count,I.start+I.count));for(let Y=U,he=V;Y<he;Y+=3){const Z=l.getX(Y),ne=l.getX(Y+1),xe=l.getX(Y+2);s=Cg(this,C,e,r,_,S,T,Z,ne,xe),s&&(s.faceIndex=Math.floor(Y/3),s.face.materialIndex=k.materialIndex,n.push(s))}}else{const N=Math.max(0,I.start),B=Math.min(l.count,I.start+I.count);for(let k=N,C=B;k<C;k+=3){const U=l.getX(k),V=l.getX(k+1),Y=l.getX(k+2);s=Cg(this,h,e,r,_,S,T,U,V,Y),s&&(s.faceIndex=Math.floor(k/3),n.push(s))}}else if(m!==void 0)if(Array.isArray(h))for(let N=0,B=M.length;N<B;N++){const k=M[N],C=h[k.materialIndex],U=Math.max(k.start,I.start),V=Math.min(m.count,Math.min(k.start+k.count,I.start+I.count));for(let Y=U,he=V;Y<he;Y+=3){const Z=Y,ne=Y+1,xe=Y+2;s=Cg(this,C,e,r,_,S,T,Z,ne,xe),s&&(s.faceIndex=Math.floor(Y/3),s.face.materialIndex=k.materialIndex,n.push(s))}}else{const N=Math.max(0,I.start),B=Math.min(m.count,I.start+I.count);for(let k=N,C=B;k<C;k+=3){const U=k,V=k+1,Y=k+2;s=Cg(this,h,e,r,_,S,T,U,V,Y),s&&(s.faceIndex=Math.floor(k/3),n.push(s))}}}}function pL(t,e,n,r,s,c,h,l){let m;if(e.side===za?m=r.intersectTriangle(h,c,s,!0,l):m=r.intersectTriangle(s,c,h,e.side===Tc,l),m===null)return null;Ag.copy(l),Ag.applyMatrix4(t.matrixWorld);const _=n.ray.origin.distanceTo(Ag);return _<n.near||_>n.far?null:{distance:_,point:Ag.clone(),object:t}}function Cg(t,e,n,r,s,c,h,l,m,_){t.getVertexPosition(l,Wh),t.getVertexPosition(m,qh),t.getVertexPosition(_,$h);const S=pL(t,e,n,r,Wh,qh,$h,Eg);if(S){s&&(Sg.fromBufferAttribute(s,l),Mg.fromBufferAttribute(s,m),Tg.fromBufferAttribute(s,_),S.uv=po.getInterpolation(Eg,Wh,qh,$h,Sg,Mg,Tg,new Yn)),c&&(Sg.fromBufferAttribute(c,l),Mg.fromBufferAttribute(c,m),Tg.fromBufferAttribute(c,_),S.uv1=po.getInterpolation(Eg,Wh,qh,$h,Sg,Mg,Tg,new Yn)),h&&(S5.fromBufferAttribute(h,l),M5.fromBufferAttribute(h,m),T5.fromBufferAttribute(h,_),S.normal=po.getInterpolation(Eg,Wh,qh,$h,S5,M5,T5,new st),S.normal.dot(r.direction)>0&&S.normal.multiplyScalar(-1));const T={a:l,b:m,c:_,normal:new st,materialIndex:0};po.getNormal(Wh,qh,$h,T.normal),S.face=T}return S}class Fp extends Fc{constructor(e=1,n=1,r=1,s=1,c=1,h=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:n,depth:r,widthSegments:s,heightSegments:c,depthSegments:h};const l=this;s=Math.floor(s),c=Math.floor(c),h=Math.floor(h);const m=[],_=[],S=[],T=[];let M=0,I=0;N("z","y","x",-1,-1,r,n,e,h,c,0),N("z","y","x",1,-1,r,n,-e,h,c,1),N("x","z","y",1,1,e,r,n,s,h,2),N("x","z","y",1,-1,e,r,-n,s,h,3),N("x","y","z",1,-1,e,n,r,s,c,4),N("x","y","z",-1,-1,e,n,-r,s,c,5),this.setIndex(m),this.setAttribute("position",new bo(_,3)),this.setAttribute("normal",new bo(S,3)),this.setAttribute("uv",new bo(T,2));function N(B,k,C,U,V,Y,he,Z,ne,xe,ie){const J=Y/ne,Te=he/xe,Be=Y/2,Re=he/2,We=Z/2,ct=ne+1,gt=xe+1;let ft=0,ke=0;const at=new st;for(let ot=0;ot<gt;ot++){const _t=ot*Te-Re;for(let kt=0;kt<ct;kt++){const Cn=kt*J-Be;at[B]=Cn*U,at[k]=_t*V,at[C]=We,_.push(at.x,at.y,at.z),at[B]=0,at[k]=0,at[C]=Z>0?1:-1,S.push(at.x,at.y,at.z),T.push(kt/ne),T.push(1-ot/xe),ft+=1}}for(let ot=0;ot<xe;ot++)for(let _t=0;_t<ne;_t++){const kt=M+_t+ct*ot,Cn=M+_t+ct*(ot+1),it=M+(_t+1)+ct*(ot+1),Mt=M+(_t+1)+ct*ot;m.push(kt,Cn,Mt),m.push(Cn,it,Mt),ke+=6}l.addGroup(I,ke,ie),I+=ke,M+=ft}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Fp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Od(t){const e={};for(const n in t){e[n]={};for(const r in t[n]){const s=t[n][r];s&&(s.isColor||s.isMatrix3||s.isMatrix4||s.isVector2||s.isVector3||s.isVector4||s.isTexture||s.isQuaternion)?s.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[n][r]=null):e[n][r]=s.clone():Array.isArray(s)?e[n][r]=s.slice():e[n][r]=s}}return e}function ga(t){const e={};for(let n=0;n<t.length;n++){const r=Od(t[n]);for(const s in r)e[s]=r[s]}return e}function mL(t){const e=[];for(let n=0;n<t.length;n++)e.push(t[n].clone());return e}function oA(t){const e=t.getRenderTarget();return e===null?t.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:wr.workingColorSpace}const gL={clone:Od,merge:ga};var vL=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,yL=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bs extends Cv{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=vL,this.fragmentShader=yL,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Od(e.uniforms),this.uniformsGroups=mL(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const n=super.toJSON(e);n.glslVersion=this.glslVersion,n.uniforms={};for(const s in this.uniforms){const h=this.uniforms[s].value;h&&h.isTexture?n.uniforms[s]={type:"t",value:h.toJSON(e).uuid}:h&&h.isColor?n.uniforms[s]={type:"c",value:h.getHex()}:h&&h.isVector2?n.uniforms[s]={type:"v2",value:h.toArray()}:h&&h.isVector3?n.uniforms[s]={type:"v3",value:h.toArray()}:h&&h.isVector4?n.uniforms[s]={type:"v4",value:h.toArray()}:h&&h.isMatrix3?n.uniforms[s]={type:"m3",value:h.toArray()}:h&&h.isMatrix4?n.uniforms[s]={type:"m4",value:h.toArray()}:n.uniforms[s]={value:h}}Object.keys(this.defines).length>0&&(n.defines=this.defines),n.vertexShader=this.vertexShader,n.fragmentShader=this.fragmentShader,n.lights=this.lights,n.clipping=this.clipping;const r={};for(const s in this.extensions)this.extensions[s]===!0&&(r[s]=!0);return Object.keys(r).length>0&&(n.extensions=r),n}}class lA extends es{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new bi,this.projectionMatrix=new bi,this.projectionMatrixInverse=new bi,this.coordinateSystem=il}copy(e,n){return super.copy(e,n),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,n){super.updateWorldMatrix(e,n),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Jl=new st,E5=new Yn,A5=new Yn;class vs extends lA{constructor(e=50,n=1,r=.1,s=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=s,this.focus=10,this.aspect=n,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const n=.5*this.getFilmHeight()/e;this.fov=yp*2*Math.atan(n),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(W0*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return yp*2*Math.atan(Math.tan(W0*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,n,r){Jl.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Jl.x,Jl.y).multiplyScalar(-e/Jl.z),Jl.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(Jl.x,Jl.y).multiplyScalar(-e/Jl.z)}getViewSize(e,n){return this.getViewBounds(e,E5,A5),n.subVectors(A5,E5)}setViewOffset(e,n,r,s,c,h){this.aspect=e/n,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=c,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let n=e*Math.tan(W0*.5*this.fov)/this.zoom,r=2*n,s=this.aspect*r,c=-.5*s;const h=this.view;if(this.view!==null&&this.view.enabled){const m=h.fullWidth,_=h.fullHeight;c+=h.offsetX*s/m,n-=h.offsetY*r/_,s*=h.width/m,r*=h.height/_}const l=this.filmOffset;l!==0&&(c+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(c,c+s,n,n-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.fov=this.fov,n.object.zoom=this.zoom,n.object.near=this.near,n.object.far=this.far,n.object.focus=this.focus,n.object.aspect=this.aspect,this.view!==null&&(n.object.view=Object.assign({},this.view)),n.object.filmGauge=this.filmGauge,n.object.filmOffset=this.filmOffset,n}}const Xh=-90,Zh=1;class _L extends es{constructor(e,n,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const s=new vs(Xh,Zh,e,n);s.layers=this.layers,this.add(s);const c=new vs(Xh,Zh,e,n);c.layers=this.layers,this.add(c);const h=new vs(Xh,Zh,e,n);h.layers=this.layers,this.add(h);const l=new vs(Xh,Zh,e,n);l.layers=this.layers,this.add(l);const m=new vs(Xh,Zh,e,n);m.layers=this.layers,this.add(m);const _=new vs(Xh,Zh,e,n);_.layers=this.layers,this.add(_)}updateCoordinateSystem(){const e=this.coordinateSystem,n=this.children.concat(),[r,s,c,h,l,m]=n;for(const _ of n)this.remove(_);if(e===il)r.up.set(0,1,0),r.lookAt(1,0,0),s.up.set(0,1,0),s.lookAt(-1,0,0),c.up.set(0,0,-1),c.lookAt(0,1,0),h.up.set(0,0,1),h.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),m.up.set(0,1,0),m.lookAt(0,0,-1);else if(e===V1)r.up.set(0,-1,0),r.lookAt(-1,0,0),s.up.set(0,-1,0),s.lookAt(1,0,0),c.up.set(0,0,1),c.lookAt(0,1,0),h.up.set(0,0,-1),h.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),m.up.set(0,-1,0),m.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const _ of n)this.add(_),_.updateMatrixWorld()}update(e,n){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:s}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[c,h,l,m,_,S]=this.children,T=e.getRenderTarget(),M=e.getActiveCubeFace(),I=e.getActiveMipmapLevel(),N=e.xr.enabled;e.xr.enabled=!1;const B=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,s),e.render(n,c),e.setRenderTarget(r,1,s),e.render(n,h),e.setRenderTarget(r,2,s),e.render(n,l),e.setRenderTarget(r,3,s),e.render(n,m),e.setRenderTarget(r,4,s),e.render(n,_),r.texture.generateMipmaps=B,e.setRenderTarget(r,5,s),e.render(n,S),e.setRenderTarget(T,M,I),e.xr.enabled=N,r.texture.needsPMREMUpdate=!0}}class cA extends xa{constructor(e,n,r,s,c,h,l,m,_,S){e=e!==void 0?e:[],n=n!==void 0?n:Fd,super(e,n,r,s,c,h,l,m,_,S),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class xL extends Uu{constructor(e=1,n={}){super(e,e,n),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},s=[r,r,r,r,r,r];this.texture=new cA(s,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=n.generateMipmaps!==void 0?n.generateMipmaps:!1,this.texture.minFilter=n.minFilter!==void 0?n.minFilter:$s}fromEquirectangularTexture(e,n){this.texture.type=n.type,this.texture.colorSpace=n.colorSpace,this.texture.generateMipmaps=n.generateMipmaps,this.texture.minFilter=n.minFilter,this.texture.magFilter=n.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},s=new Fp(5,5,5),c=new bs({name:"CubemapFromEquirect",uniforms:Od(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:za,blending:bc});c.uniforms.tEquirect.value=n;const h=new Ja(s,c),l=n.minFilter;return n.minFilter===Cu&&(n.minFilter=$s),new _L(1,10,this).update(e,h),n.minFilter=l,h.geometry.dispose(),h.material.dispose(),this}clear(e,n,r,s){const c=e.getRenderTarget();for(let h=0;h<6;h++)e.setRenderTarget(this,h),e.clear(n,r,s);e.setRenderTarget(c)}}const V_=new st,bL=new st,wL=new Qn;class ac{constructor(e=new st(1,0,0),n=0){this.isPlane=!0,this.normal=e,this.constant=n}set(e,n){return this.normal.copy(e),this.constant=n,this}setComponents(e,n,r,s){return this.normal.set(e,n,r),this.constant=s,this}setFromNormalAndCoplanarPoint(e,n){return this.normal.copy(e),this.constant=-n.dot(this.normal),this}setFromCoplanarPoints(e,n,r){const s=V_.subVectors(r,n).cross(bL.subVectors(e,n)).normalize();return this.setFromNormalAndCoplanarPoint(s,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,n){return n.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,n){const r=e.delta(V_),s=this.normal.dot(r);if(s===0)return this.distanceToPoint(e.start)===0?n.copy(e.start):null;const c=-(e.start.dot(this.normal)+this.constant)/s;return c<0||c>1?null:n.copy(e.start).addScaledVector(r,c)}intersectsLine(e){const n=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return n<0&&r>0||r<0&&n>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,n){const r=n||wL.getNormalMatrix(e),s=this.coplanarPoint(V_).applyMatrix4(e),c=this.normal.applyMatrix3(r).normalize();return this.constant=-s.dot(c),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const cu=new Gb,Pg=new st;class uA{constructor(e=new ac,n=new ac,r=new ac,s=new ac,c=new ac,h=new ac){this.planes=[e,n,r,s,c,h]}set(e,n,r,s,c,h){const l=this.planes;return l[0].copy(e),l[1].copy(n),l[2].copy(r),l[3].copy(s),l[4].copy(c),l[5].copy(h),this}copy(e){const n=this.planes;for(let r=0;r<6;r++)n[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,n=il){const r=this.planes,s=e.elements,c=s[0],h=s[1],l=s[2],m=s[3],_=s[4],S=s[5],T=s[6],M=s[7],I=s[8],N=s[9],B=s[10],k=s[11],C=s[12],U=s[13],V=s[14],Y=s[15];if(r[0].setComponents(m-c,M-_,k-I,Y-C).normalize(),r[1].setComponents(m+c,M+_,k+I,Y+C).normalize(),r[2].setComponents(m+h,M+S,k+N,Y+U).normalize(),r[3].setComponents(m-h,M-S,k-N,Y-U).normalize(),r[4].setComponents(m-l,M-T,k-B,Y-V).normalize(),n===il)r[5].setComponents(m+l,M+T,k+B,Y+V).normalize();else if(n===V1)r[5].setComponents(l,T,B,V).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+n);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),cu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const n=e.geometry;n.boundingSphere===null&&n.computeBoundingSphere(),cu.copy(n.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(cu)}intersectsSprite(e){return cu.center.set(0,0,0),cu.radius=.7071067811865476,cu.applyMatrix4(e.matrixWorld),this.intersectsSphere(cu)}intersectsSphere(e){const n=this.planes,r=e.center,s=-e.radius;for(let c=0;c<6;c++)if(n[c].distanceToPoint(r)<s)return!1;return!0}intersectsBox(e){const n=this.planes;for(let r=0;r<6;r++){const s=n[r];if(Pg.x=s.normal.x>0?e.max.x:e.min.x,Pg.y=s.normal.y>0?e.max.y:e.min.y,Pg.z=s.normal.z>0?e.max.z:e.min.z,s.distanceToPoint(Pg)<0)return!1}return!0}containsPoint(e){const n=this.planes;for(let r=0;r<6;r++)if(n[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function hA(){let t=null,e=!1,n=null,r=null;function s(c,h){n(c,h),r=t.requestAnimationFrame(s)}return{start:function(){e!==!0&&n!==null&&(r=t.requestAnimationFrame(s),e=!0)},stop:function(){t.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(c){n=c},setContext:function(c){t=c}}}function SL(t){const e=new WeakMap;function n(l,m){const _=l.array,S=l.usage,T=_.byteLength,M=t.createBuffer();t.bindBuffer(m,M),t.bufferData(m,_,S),l.onUploadCallback();let I;if(_ instanceof Float32Array)I=t.FLOAT;else if(_ instanceof Uint16Array)l.isFloat16BufferAttribute?I=t.HALF_FLOAT:I=t.UNSIGNED_SHORT;else if(_ instanceof Int16Array)I=t.SHORT;else if(_ instanceof Uint32Array)I=t.UNSIGNED_INT;else if(_ instanceof Int32Array)I=t.INT;else if(_ instanceof Int8Array)I=t.BYTE;else if(_ instanceof Uint8Array)I=t.UNSIGNED_BYTE;else if(_ instanceof Uint8ClampedArray)I=t.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+_);return{buffer:M,type:I,bytesPerElement:_.BYTES_PER_ELEMENT,version:l.version,size:T}}function r(l,m,_){const S=m.array,T=m._updateRange,M=m.updateRanges;if(t.bindBuffer(_,l),T.count===-1&&M.length===0&&t.bufferSubData(_,0,S),M.length!==0){for(let I=0,N=M.length;I<N;I++){const B=M[I];t.bufferSubData(_,B.start*S.BYTES_PER_ELEMENT,S,B.start,B.count)}m.clearUpdateRanges()}T.count!==-1&&(t.bufferSubData(_,T.offset*S.BYTES_PER_ELEMENT,S,T.offset,T.count),T.count=-1),m.onUploadCallback()}function s(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function c(l){l.isInterleavedBufferAttribute&&(l=l.data);const m=e.get(l);m&&(t.deleteBuffer(m.buffer),e.delete(l))}function h(l,m){if(l.isGLBufferAttribute){const S=e.get(l);(!S||S.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const _=e.get(l);if(_===void 0)e.set(l,n(l,m));else if(_.version<l.version){if(_.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(_.buffer,l,m),_.version=l.version}}return{get:s,remove:c,update:h}}class Np extends Fc{constructor(e=1,n=1,r=1,s=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:n,widthSegments:r,heightSegments:s};const c=e/2,h=n/2,l=Math.floor(r),m=Math.floor(s),_=l+1,S=m+1,T=e/l,M=n/m,I=[],N=[],B=[],k=[];for(let C=0;C<S;C++){const U=C*M-h;for(let V=0;V<_;V++){const Y=V*T-c;N.push(Y,-U,0),B.push(0,0,1),k.push(V/l),k.push(1-C/m)}}for(let C=0;C<m;C++)for(let U=0;U<l;U++){const V=U+_*C,Y=U+_*(C+1),he=U+1+_*(C+1),Z=U+1+_*C;I.push(V,Y,Z),I.push(Y,he,Z)}this.setIndex(I),this.setAttribute("position",new bo(N,3)),this.setAttribute("normal",new bo(B,3)),this.setAttribute("uv",new bo(k,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Np(e.width,e.height,e.widthSegments,e.heightSegments)}}var ML=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,TL=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,EL=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,AL=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,CL=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,PL=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,RL=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,IL=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,DL=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,kL=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,LL=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,zL=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,FL=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,NL=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,BL=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,OL=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,UL=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,VL=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,HL=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,GL=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,jL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,WL=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,qL=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,$L=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,XL=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,ZL=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,YL=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,KL=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,JL=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,QL=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,ez="gl_FragColor = linearToOutputTexel( gl_FragColor );",tz=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,nz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,rz=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,iz=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,az=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,sz=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,oz=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,lz=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,cz=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,uz=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,hz=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,dz=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,fz=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,pz=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,mz=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,gz=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,vz=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,yz=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,_z=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,xz=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,bz=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,wz=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,Sz=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,Mz=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,Tz=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,Ez=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,Az=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Cz=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,Pz=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,Rz=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,Iz=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,Dz=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,kz=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Lz=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,zz=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,Fz=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,Nz=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,Bz=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,Oz=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,Uz=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,Vz=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,Hz=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,Gz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,jz=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,Wz=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,qz=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,$z=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,Xz=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,Zz=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,Yz=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,Kz=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,Jz=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,Qz=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,eF=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,tF=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,nF=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,rF=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,iF=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,aF=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,sF=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,oF=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,lF=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,cF=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,uF=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,hF=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,dF=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,fF=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,pF=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,mF=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,gF=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,vF=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,yF=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
		
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
		
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		
		#else
		
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,_F=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,xF=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,bF=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,wF=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const SF=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,MF=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,EF=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,AF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,CF=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,PF=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,RF=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,IF=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,DF=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,kF=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,LF=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,zF=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,FF=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,NF=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,BF=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OF=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,UF=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,VF=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,HF=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,GF=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,jF=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,WF=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,qF=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,$F=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,XF=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,ZF=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,YF=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,KF=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,JF=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,QF=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,eN=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,tN=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nN=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Jn={alphahash_fragment:ML,alphahash_pars_fragment:TL,alphamap_fragment:EL,alphamap_pars_fragment:AL,alphatest_fragment:CL,alphatest_pars_fragment:PL,aomap_fragment:RL,aomap_pars_fragment:IL,batching_pars_vertex:DL,batching_vertex:kL,begin_vertex:LL,beginnormal_vertex:zL,bsdfs:FL,iridescence_fragment:NL,bumpmap_pars_fragment:BL,clipping_planes_fragment:OL,clipping_planes_pars_fragment:UL,clipping_planes_pars_vertex:VL,clipping_planes_vertex:HL,color_fragment:GL,color_pars_fragment:jL,color_pars_vertex:WL,color_vertex:qL,common:$L,cube_uv_reflection_fragment:XL,defaultnormal_vertex:ZL,displacementmap_pars_vertex:YL,displacementmap_vertex:KL,emissivemap_fragment:JL,emissivemap_pars_fragment:QL,colorspace_fragment:ez,colorspace_pars_fragment:tz,envmap_fragment:nz,envmap_common_pars_fragment:rz,envmap_pars_fragment:iz,envmap_pars_vertex:az,envmap_physical_pars_fragment:gz,envmap_vertex:sz,fog_vertex:oz,fog_pars_vertex:lz,fog_fragment:cz,fog_pars_fragment:uz,gradientmap_pars_fragment:hz,lightmap_pars_fragment:dz,lights_lambert_fragment:fz,lights_lambert_pars_fragment:pz,lights_pars_begin:mz,lights_toon_fragment:vz,lights_toon_pars_fragment:yz,lights_phong_fragment:_z,lights_phong_pars_fragment:xz,lights_physical_fragment:bz,lights_physical_pars_fragment:wz,lights_fragment_begin:Sz,lights_fragment_maps:Mz,lights_fragment_end:Tz,logdepthbuf_fragment:Ez,logdepthbuf_pars_fragment:Az,logdepthbuf_pars_vertex:Cz,logdepthbuf_vertex:Pz,map_fragment:Rz,map_pars_fragment:Iz,map_particle_fragment:Dz,map_particle_pars_fragment:kz,metalnessmap_fragment:Lz,metalnessmap_pars_fragment:zz,morphinstance_vertex:Fz,morphcolor_vertex:Nz,morphnormal_vertex:Bz,morphtarget_pars_vertex:Oz,morphtarget_vertex:Uz,normal_fragment_begin:Vz,normal_fragment_maps:Hz,normal_pars_fragment:Gz,normal_pars_vertex:jz,normal_vertex:Wz,normalmap_pars_fragment:qz,clearcoat_normal_fragment_begin:$z,clearcoat_normal_fragment_maps:Xz,clearcoat_pars_fragment:Zz,iridescence_pars_fragment:Yz,opaque_fragment:Kz,packing:Jz,premultiplied_alpha_fragment:Qz,project_vertex:eF,dithering_fragment:tF,dithering_pars_fragment:nF,roughnessmap_fragment:rF,roughnessmap_pars_fragment:iF,shadowmap_pars_fragment:aF,shadowmap_pars_vertex:sF,shadowmap_vertex:oF,shadowmask_pars_fragment:lF,skinbase_vertex:cF,skinning_pars_vertex:uF,skinning_vertex:hF,skinnormal_vertex:dF,specularmap_fragment:fF,specularmap_pars_fragment:pF,tonemapping_fragment:mF,tonemapping_pars_fragment:gF,transmission_fragment:vF,transmission_pars_fragment:yF,uv_pars_fragment:_F,uv_pars_vertex:xF,uv_vertex:bF,worldpos_vertex:wF,background_vert:SF,background_frag:MF,backgroundCube_vert:TF,backgroundCube_frag:EF,cube_vert:AF,cube_frag:CF,depth_vert:PF,depth_frag:RF,distanceRGBA_vert:IF,distanceRGBA_frag:DF,equirect_vert:kF,equirect_frag:LF,linedashed_vert:zF,linedashed_frag:FF,meshbasic_vert:NF,meshbasic_frag:BF,meshlambert_vert:OF,meshlambert_frag:UF,meshmatcap_vert:VF,meshmatcap_frag:HF,meshnormal_vert:GF,meshnormal_frag:jF,meshphong_vert:WF,meshphong_frag:qF,meshphysical_vert:$F,meshphysical_frag:XF,meshtoon_vert:ZF,meshtoon_frag:YF,points_vert:KF,points_frag:JF,shadow_vert:QF,shadow_frag:eN,sprite_vert:tN,sprite_frag:nN},sn={common:{diffuse:{value:new Sr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Qn},alphaMap:{value:null},alphaMapTransform:{value:new Qn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Qn}},envmap:{envMap:{value:null},envMapRotation:{value:new Qn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Qn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Qn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Qn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Qn},normalScale:{value:new Yn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Qn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Qn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Qn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Qn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Sr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Sr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Qn},alphaTest:{value:0},uvTransform:{value:new Qn}},sprite:{diffuse:{value:new Sr(16777215)},opacity:{value:1},center:{value:new Yn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Qn},alphaMap:{value:null},alphaMapTransform:{value:new Qn},alphaTest:{value:0}}},lo={basic:{uniforms:ga([sn.common,sn.specularmap,sn.envmap,sn.aomap,sn.lightmap,sn.fog]),vertexShader:Jn.meshbasic_vert,fragmentShader:Jn.meshbasic_frag},lambert:{uniforms:ga([sn.common,sn.specularmap,sn.envmap,sn.aomap,sn.lightmap,sn.emissivemap,sn.bumpmap,sn.normalmap,sn.displacementmap,sn.fog,sn.lights,{emissive:{value:new Sr(0)}}]),vertexShader:Jn.meshlambert_vert,fragmentShader:Jn.meshlambert_frag},phong:{uniforms:ga([sn.common,sn.specularmap,sn.envmap,sn.aomap,sn.lightmap,sn.emissivemap,sn.bumpmap,sn.normalmap,sn.displacementmap,sn.fog,sn.lights,{emissive:{value:new Sr(0)},specular:{value:new Sr(1118481)},shininess:{value:30}}]),vertexShader:Jn.meshphong_vert,fragmentShader:Jn.meshphong_frag},standard:{uniforms:ga([sn.common,sn.envmap,sn.aomap,sn.lightmap,sn.emissivemap,sn.bumpmap,sn.normalmap,sn.displacementmap,sn.roughnessmap,sn.metalnessmap,sn.fog,sn.lights,{emissive:{value:new Sr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag},toon:{uniforms:ga([sn.common,sn.aomap,sn.lightmap,sn.emissivemap,sn.bumpmap,sn.normalmap,sn.displacementmap,sn.gradientmap,sn.fog,sn.lights,{emissive:{value:new Sr(0)}}]),vertexShader:Jn.meshtoon_vert,fragmentShader:Jn.meshtoon_frag},matcap:{uniforms:ga([sn.common,sn.bumpmap,sn.normalmap,sn.displacementmap,sn.fog,{matcap:{value:null}}]),vertexShader:Jn.meshmatcap_vert,fragmentShader:Jn.meshmatcap_frag},points:{uniforms:ga([sn.points,sn.fog]),vertexShader:Jn.points_vert,fragmentShader:Jn.points_frag},dashed:{uniforms:ga([sn.common,sn.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Jn.linedashed_vert,fragmentShader:Jn.linedashed_frag},depth:{uniforms:ga([sn.common,sn.displacementmap]),vertexShader:Jn.depth_vert,fragmentShader:Jn.depth_frag},normal:{uniforms:ga([sn.common,sn.bumpmap,sn.normalmap,sn.displacementmap,{opacity:{value:1}}]),vertexShader:Jn.meshnormal_vert,fragmentShader:Jn.meshnormal_frag},sprite:{uniforms:ga([sn.sprite,sn.fog]),vertexShader:Jn.sprite_vert,fragmentShader:Jn.sprite_frag},background:{uniforms:{uvTransform:{value:new Qn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Jn.background_vert,fragmentShader:Jn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Qn}},vertexShader:Jn.backgroundCube_vert,fragmentShader:Jn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Jn.cube_vert,fragmentShader:Jn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Jn.equirect_vert,fragmentShader:Jn.equirect_frag},distanceRGBA:{uniforms:ga([sn.common,sn.displacementmap,{referencePosition:{value:new st},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Jn.distanceRGBA_vert,fragmentShader:Jn.distanceRGBA_frag},shadow:{uniforms:ga([sn.lights,sn.fog,{color:{value:new Sr(0)},opacity:{value:1}}]),vertexShader:Jn.shadow_vert,fragmentShader:Jn.shadow_frag}};lo.physical={uniforms:ga([lo.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Qn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Qn},clearcoatNormalScale:{value:new Yn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Qn},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Qn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Qn},sheen:{value:0},sheenColor:{value:new Sr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Qn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Qn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Qn},transmissionSamplerSize:{value:new Yn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Qn},attenuationDistance:{value:0},attenuationColor:{value:new Sr(0)},specularColor:{value:new Sr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Qn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Qn},anisotropyVector:{value:new Yn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Qn}}]),vertexShader:Jn.meshphysical_vert,fragmentShader:Jn.meshphysical_frag};const Rg={r:0,b:0,g:0},uu=new pl,rN=new bi;function iN(t,e,n,r,s,c,h){const l=new Sr(0);let m=c===!0?0:1,_,S,T=null,M=0,I=null;function N(U){let V=U.isScene===!0?U.background:null;return V&&V.isTexture&&(V=(U.backgroundBlurriness>0?n:e).get(V)),V}function B(U){let V=!1;const Y=N(U);Y===null?C(l,m):Y&&Y.isColor&&(C(Y,1),V=!0);const he=t.xr.getEnvironmentBlendMode();he==="additive"?r.buffers.color.setClear(0,0,0,1,h):he==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,h),(t.autoClear||V)&&t.clear(t.autoClearColor,t.autoClearDepth,t.autoClearStencil)}function k(U,V){const Y=N(V);Y&&(Y.isCubeTexture||Y.mapping===Tv)?(S===void 0&&(S=new Ja(new Fp(1,1,1),new bs({name:"BackgroundCubeMaterial",uniforms:Od(lo.backgroundCube.uniforms),vertexShader:lo.backgroundCube.vertexShader,fragmentShader:lo.backgroundCube.fragmentShader,side:za,depthTest:!1,depthWrite:!1,fog:!1})),S.geometry.deleteAttribute("normal"),S.geometry.deleteAttribute("uv"),S.onBeforeRender=function(he,Z,ne){this.matrixWorld.copyPosition(ne.matrixWorld)},Object.defineProperty(S.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),s.update(S)),uu.copy(V.backgroundRotation),uu.x*=-1,uu.y*=-1,uu.z*=-1,Y.isCubeTexture&&Y.isRenderTargetTexture===!1&&(uu.y*=-1,uu.z*=-1),S.material.uniforms.envMap.value=Y,S.material.uniforms.flipEnvMap.value=Y.isCubeTexture&&Y.isRenderTargetTexture===!1?-1:1,S.material.uniforms.backgroundBlurriness.value=V.backgroundBlurriness,S.material.uniforms.backgroundIntensity.value=V.backgroundIntensity,S.material.uniforms.backgroundRotation.value.setFromMatrix4(rN.makeRotationFromEuler(uu)),S.material.toneMapped=wr.getTransfer(Y.colorSpace)!==zr,(T!==Y||M!==Y.version||I!==t.toneMapping)&&(S.material.needsUpdate=!0,T=Y,M=Y.version,I=t.toneMapping),S.layers.enableAll(),U.unshift(S,S.geometry,S.material,0,0,null)):Y&&Y.isTexture&&(_===void 0&&(_=new Ja(new Np(2,2),new bs({name:"BackgroundMaterial",uniforms:Od(lo.background.uniforms),vertexShader:lo.background.vertexShader,fragmentShader:lo.background.fragmentShader,side:Tc,depthTest:!1,depthWrite:!1,fog:!1})),_.geometry.deleteAttribute("normal"),Object.defineProperty(_.material,"map",{get:function(){return this.uniforms.t2D.value}}),s.update(_)),_.material.uniforms.t2D.value=Y,_.material.uniforms.backgroundIntensity.value=V.backgroundIntensity,_.material.toneMapped=wr.getTransfer(Y.colorSpace)!==zr,Y.matrixAutoUpdate===!0&&Y.updateMatrix(),_.material.uniforms.uvTransform.value.copy(Y.matrix),(T!==Y||M!==Y.version||I!==t.toneMapping)&&(_.material.needsUpdate=!0,T=Y,M=Y.version,I=t.toneMapping),_.layers.enableAll(),U.unshift(_,_.geometry,_.material,0,0,null))}function C(U,V){U.getRGB(Rg,oA(t)),r.buffers.color.setClear(Rg.r,Rg.g,Rg.b,V,h)}return{getClearColor:function(){return l},setClearColor:function(U,V=1){l.set(U),m=V,C(l,m)},getClearAlpha:function(){return m},setClearAlpha:function(U){m=U,C(l,m)},render:B,addToRenderList:k}}function aN(t,e){const n=t.getParameter(t.MAX_VERTEX_ATTRIBS),r={},s=M(null);let c=s,h=!1;function l(J,Te,Be,Re,We){let ct=!1;const gt=T(Re,Be,Te);c!==gt&&(c=gt,_(c.object)),ct=I(J,Re,Be,We),ct&&N(J,Re,Be,We),We!==null&&e.update(We,t.ELEMENT_ARRAY_BUFFER),(ct||h)&&(h=!1,Y(J,Te,Be,Re),We!==null&&t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e.get(We).buffer))}function m(){return t.createVertexArray()}function _(J){return t.bindVertexArray(J)}function S(J){return t.deleteVertexArray(J)}function T(J,Te,Be){const Re=Be.wireframe===!0;let We=r[J.id];We===void 0&&(We={},r[J.id]=We);let ct=We[Te.id];ct===void 0&&(ct={},We[Te.id]=ct);let gt=ct[Re];return gt===void 0&&(gt=M(m()),ct[Re]=gt),gt}function M(J){const Te=[],Be=[],Re=[];for(let We=0;We<n;We++)Te[We]=0,Be[We]=0,Re[We]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Te,enabledAttributes:Be,attributeDivisors:Re,object:J,attributes:{},index:null}}function I(J,Te,Be,Re){const We=c.attributes,ct=Te.attributes;let gt=0;const ft=Be.getAttributes();for(const ke in ft)if(ft[ke].location>=0){const ot=We[ke];let _t=ct[ke];if(_t===void 0&&(ke==="instanceMatrix"&&J.instanceMatrix&&(_t=J.instanceMatrix),ke==="instanceColor"&&J.instanceColor&&(_t=J.instanceColor)),ot===void 0||ot.attribute!==_t||_t&&ot.data!==_t.data)return!0;gt++}return c.attributesNum!==gt||c.index!==Re}function N(J,Te,Be,Re){const We={},ct=Te.attributes;let gt=0;const ft=Be.getAttributes();for(const ke in ft)if(ft[ke].location>=0){let ot=ct[ke];ot===void 0&&(ke==="instanceMatrix"&&J.instanceMatrix&&(ot=J.instanceMatrix),ke==="instanceColor"&&J.instanceColor&&(ot=J.instanceColor));const _t={};_t.attribute=ot,ot&&ot.data&&(_t.data=ot.data),We[ke]=_t,gt++}c.attributes=We,c.attributesNum=gt,c.index=Re}function B(){const J=c.newAttributes;for(let Te=0,Be=J.length;Te<Be;Te++)J[Te]=0}function k(J){C(J,0)}function C(J,Te){const Be=c.newAttributes,Re=c.enabledAttributes,We=c.attributeDivisors;Be[J]=1,Re[J]===0&&(t.enableVertexAttribArray(J),Re[J]=1),We[J]!==Te&&(t.vertexAttribDivisor(J,Te),We[J]=Te)}function U(){const J=c.newAttributes,Te=c.enabledAttributes;for(let Be=0,Re=Te.length;Be<Re;Be++)Te[Be]!==J[Be]&&(t.disableVertexAttribArray(Be),Te[Be]=0)}function V(J,Te,Be,Re,We,ct,gt){gt===!0?t.vertexAttribIPointer(J,Te,Be,We,ct):t.vertexAttribPointer(J,Te,Be,Re,We,ct)}function Y(J,Te,Be,Re){B();const We=Re.attributes,ct=Be.getAttributes(),gt=Te.defaultAttributeValues;for(const ft in ct){const ke=ct[ft];if(ke.location>=0){let at=We[ft];if(at===void 0&&(ft==="instanceMatrix"&&J.instanceMatrix&&(at=J.instanceMatrix),ft==="instanceColor"&&J.instanceColor&&(at=J.instanceColor)),at!==void 0){const ot=at.normalized,_t=at.itemSize,kt=e.get(at);if(kt===void 0)continue;const Cn=kt.buffer,it=kt.type,Mt=kt.bytesPerElement,Ft=it===t.INT||it===t.UNSIGNED_INT||at.gpuType===WE;if(at.isInterleavedBufferAttribute){const At=at.data,Sn=At.stride,Dn=at.offset;if(At.isInstancedInterleavedBuffer){for(let qe=0;qe<ke.locationSize;qe++)C(ke.location+qe,At.meshPerAttribute);J.isInstancedMesh!==!0&&Re._maxInstanceCount===void 0&&(Re._maxInstanceCount=At.meshPerAttribute*At.count)}else for(let qe=0;qe<ke.locationSize;qe++)k(ke.location+qe);t.bindBuffer(t.ARRAY_BUFFER,Cn);for(let qe=0;qe<ke.locationSize;qe++)V(ke.location+qe,_t/ke.locationSize,it,ot,Sn*Mt,(Dn+_t/ke.locationSize*qe)*Mt,Ft)}else{if(at.isInstancedBufferAttribute){for(let At=0;At<ke.locationSize;At++)C(ke.location+At,at.meshPerAttribute);J.isInstancedMesh!==!0&&Re._maxInstanceCount===void 0&&(Re._maxInstanceCount=at.meshPerAttribute*at.count)}else for(let At=0;At<ke.locationSize;At++)k(ke.location+At);t.bindBuffer(t.ARRAY_BUFFER,Cn);for(let At=0;At<ke.locationSize;At++)V(ke.location+At,_t/ke.locationSize,it,ot,_t*Mt,_t/ke.locationSize*At*Mt,Ft)}}else if(gt!==void 0){const ot=gt[ft];if(ot!==void 0)switch(ot.length){case 2:t.vertexAttrib2fv(ke.location,ot);break;case 3:t.vertexAttrib3fv(ke.location,ot);break;case 4:t.vertexAttrib4fv(ke.location,ot);break;default:t.vertexAttrib1fv(ke.location,ot)}}}}U()}function he(){xe();for(const J in r){const Te=r[J];for(const Be in Te){const Re=Te[Be];for(const We in Re)S(Re[We].object),delete Re[We];delete Te[Be]}delete r[J]}}function Z(J){if(r[J.id]===void 0)return;const Te=r[J.id];for(const Be in Te){const Re=Te[Be];for(const We in Re)S(Re[We].object),delete Re[We];delete Te[Be]}delete r[J.id]}function ne(J){for(const Te in r){const Be=r[Te];if(Be[J.id]===void 0)continue;const Re=Be[J.id];for(const We in Re)S(Re[We].object),delete Re[We];delete Be[J.id]}}function xe(){ie(),h=!0,c!==s&&(c=s,_(c.object))}function ie(){s.geometry=null,s.program=null,s.wireframe=!1}return{setup:l,reset:xe,resetDefaultState:ie,dispose:he,releaseStatesOfGeometry:Z,releaseStatesOfProgram:ne,initAttributes:B,enableAttribute:k,disableUnusedAttributes:U}}function sN(t,e,n){let r;function s(_){r=_}function c(_,S){t.drawArrays(r,_,S),n.update(S,r,1)}function h(_,S,T){T!==0&&(t.drawArraysInstanced(r,_,S,T),n.update(S,r,T))}function l(_,S,T){if(T===0)return;const M=e.get("WEBGL_multi_draw");if(M===null)for(let I=0;I<T;I++)this.render(_[I],S[I]);else{M.multiDrawArraysWEBGL(r,_,0,S,0,T);let I=0;for(let N=0;N<T;N++)I+=S[N];n.update(I,r,1)}}function m(_,S,T,M){if(T===0)return;const I=e.get("WEBGL_multi_draw");if(I===null)for(let N=0;N<_.length;N++)h(_[N],S[N],M[N]);else{I.multiDrawArraysInstancedWEBGL(r,_,0,S,0,M,0,T);let N=0;for(let B=0;B<T;B++)N+=S[B];for(let B=0;B<M.length;B++)n.update(N,r,M[B])}}this.setMode=s,this.render=c,this.renderInstances=h,this.renderMultiDraw=l,this.renderMultiDrawInstances=m}function oN(t,e,n,r){let s;function c(){if(s!==void 0)return s;if(e.has("EXT_texture_filter_anisotropic")===!0){const Z=e.get("EXT_texture_filter_anisotropic");s=t.getParameter(Z.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else s=0;return s}function h(Z){return!(Z!==go&&r.convert(Z)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(Z){const ne=Z===Ev&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(Z!==Ec&&r.convert(Z)!==t.getParameter(t.IMPLEMENTATION_COLOR_READ_TYPE)&&Z!==hc&&!ne)}function m(Z){if(Z==="highp"){if(t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.HIGH_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT).precision>0)return"highp";Z="mediump"}return Z==="mediump"&&t.getShaderPrecisionFormat(t.VERTEX_SHADER,t.MEDIUM_FLOAT).precision>0&&t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let _=n.precision!==void 0?n.precision:"highp";const S=m(_);S!==_&&(console.warn("THREE.WebGLRenderer:",_,"not supported, using",S,"instead."),_=S);const T=n.logarithmicDepthBuffer===!0,M=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),I=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS),N=t.getParameter(t.MAX_TEXTURE_SIZE),B=t.getParameter(t.MAX_CUBE_MAP_TEXTURE_SIZE),k=t.getParameter(t.MAX_VERTEX_ATTRIBS),C=t.getParameter(t.MAX_VERTEX_UNIFORM_VECTORS),U=t.getParameter(t.MAX_VARYING_VECTORS),V=t.getParameter(t.MAX_FRAGMENT_UNIFORM_VECTORS),Y=I>0,he=t.getParameter(t.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:c,getMaxPrecision:m,textureFormatReadable:h,textureTypeReadable:l,precision:_,logarithmicDepthBuffer:T,maxTextures:M,maxVertexTextures:I,maxTextureSize:N,maxCubemapSize:B,maxAttributes:k,maxVertexUniforms:C,maxVaryings:U,maxFragmentUniforms:V,vertexTextures:Y,maxSamples:he}}function lN(t){const e=this;let n=null,r=0,s=!1,c=!1;const h=new ac,l=new Qn,m={value:null,needsUpdate:!1};this.uniform=m,this.numPlanes=0,this.numIntersection=0,this.init=function(T,M){const I=T.length!==0||M||r!==0||s;return s=M,r=T.length,I},this.beginShadows=function(){c=!0,S(null)},this.endShadows=function(){c=!1},this.setGlobalState=function(T,M){n=S(T,M,0)},this.setState=function(T,M,I){const N=T.clippingPlanes,B=T.clipIntersection,k=T.clipShadows,C=t.get(T);if(!s||N===null||N.length===0||c&&!k)c?S(null):_();else{const U=c?0:r,V=U*4;let Y=C.clippingState||null;m.value=Y,Y=S(N,M,V,I);for(let he=0;he!==V;++he)Y[he]=n[he];C.clippingState=Y,this.numIntersection=B?this.numPlanes:0,this.numPlanes+=U}};function _(){m.value!==n&&(m.value=n,m.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function S(T,M,I,N){const B=T!==null?T.length:0;let k=null;if(B!==0){if(k=m.value,N!==!0||k===null){const C=I+B*4,U=M.matrixWorldInverse;l.getNormalMatrix(U),(k===null||k.length<C)&&(k=new Float32Array(C));for(let V=0,Y=I;V!==B;++V,Y+=4)h.copy(T[V]).applyMatrix4(U,l),h.normal.toArray(k,Y),k[Y+3]=h.constant}m.value=k,m.needsUpdate=!0}return e.numPlanes=B,e.numIntersection=0,k}}function cN(t){let e=new WeakMap;function n(h,l){return l===p2?h.mapping=Fd:l===m2&&(h.mapping=Nd),h}function r(h){if(h&&h.isTexture){const l=h.mapping;if(l===p2||l===m2)if(e.has(h)){const m=e.get(h).texture;return n(m,h.mapping)}else{const m=h.image;if(m&&m.height>0){const _=new xL(m.height);return _.fromEquirectangularTexture(t,h),e.set(h,_),h.addEventListener("dispose",s),n(_.texture,h.mapping)}else return null}}return h}function s(h){const l=h.target;l.removeEventListener("dispose",s);const m=e.get(l);m!==void 0&&(e.delete(l),m.dispose())}function c(){e=new WeakMap}return{get:r,dispose:c}}class uN extends lA{constructor(e=-1,n=1,r=1,s=-1,c=.1,h=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=n,this.top=r,this.bottom=s,this.near=c,this.far=h,this.updateProjectionMatrix()}copy(e,n){return super.copy(e,n),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,n,r,s,c,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=n,this.view.offsetX=r,this.view.offsetY=s,this.view.width=c,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),n=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,s=(this.top+this.bottom)/2;let c=r-e,h=r+e,l=s+n,m=s-n;if(this.view!==null&&this.view.enabled){const _=(this.right-this.left)/this.view.fullWidth/this.zoom,S=(this.top-this.bottom)/this.view.fullHeight/this.zoom;c+=_*this.view.offsetX,h=c+_*this.view.width,l-=S*this.view.offsetY,m=l-S*this.view.height}this.projectionMatrix.makeOrthographic(c,h,l,m,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const n=super.toJSON(e);return n.object.zoom=this.zoom,n.object.left=this.left,n.object.right=this.right,n.object.top=this.top,n.object.bottom=this.bottom,n.object.near=this.near,n.object.far=this.far,this.view!==null&&(n.object.view=Object.assign({},this.view)),n}}const md=4,C5=[.125,.215,.35,.446,.526,.582],xu=20,H_=new uN,P5=new Sr;let G_=null,j_=0,W_=0,q_=!1;const vu=(1+Math.sqrt(5))/2,Yh=1/vu,R5=[new st(-vu,Yh,0),new st(vu,Yh,0),new st(-Yh,0,vu),new st(Yh,0,vu),new st(0,vu,-Yh),new st(0,vu,Yh),new st(-1,1,-1),new st(1,1,-1),new st(-1,1,1),new st(1,1,1)];class I5{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,n=0,r=.1,s=100){G_=this._renderer.getRenderTarget(),j_=this._renderer.getActiveCubeFace(),W_=this._renderer.getActiveMipmapLevel(),q_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,r,s,c),n>0&&this._blur(c,0,0,n),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,n=null){return this._fromTexture(e,n)}fromCubemap(e,n=null){return this._fromTexture(e,n)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=L5(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=k5(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(G_,j_,W_),this._renderer.xr.enabled=q_,e.scissorTest=!1,Ig(e,0,0,e.width,e.height)}_fromTexture(e,n){e.mapping===Fd||e.mapping===Nd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),G_=this._renderer.getRenderTarget(),j_=this._renderer.getActiveCubeFace(),W_=this._renderer.getActiveMipmapLevel(),q_=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=n||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),n=4*this._cubeSize,r={magFilter:$s,minFilter:$s,generateMipmaps:!1,type:Ev,format:go,colorSpace:zc,depthBuffer:!1},s=D5(e,n,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==n){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=D5(e,n,r);const{_lodMax:c}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=hN(c)),this._blurMaterial=dN(c,e,n)}return s}_compileMaterial(e){const n=new Ja(this._lodPlanes[0],e);this._renderer.compile(n,H_)}_sceneToCubeUV(e,n,r,s){const l=new vs(90,1,n,r),m=[1,-1,1,1,1,1],_=[1,1,1,-1,-1,-1],S=this._renderer,T=S.autoClear,M=S.toneMapping;S.getClearColor(P5),S.toneMapping=wc,S.autoClear=!1;const I=new iA({name:"PMREM.Background",side:za,depthWrite:!1,depthTest:!1}),N=new Ja(new Fp,I);let B=!1;const k=e.background;k?k.isColor&&(I.color.copy(k),e.background=null,B=!0):(I.color.copy(P5),B=!0);for(let C=0;C<6;C++){const U=C%3;U===0?(l.up.set(0,m[C],0),l.lookAt(_[C],0,0)):U===1?(l.up.set(0,0,m[C]),l.lookAt(0,_[C],0)):(l.up.set(0,m[C],0),l.lookAt(0,0,_[C]));const V=this._cubeSize;Ig(s,U*V,C>2?V:0,V,V),S.setRenderTarget(s),B&&S.render(N,l),S.render(e,l)}N.geometry.dispose(),N.material.dispose(),S.toneMapping=M,S.autoClear=T,e.background=k}_textureToCubeUV(e,n){const r=this._renderer,s=e.mapping===Fd||e.mapping===Nd;s?(this._cubemapMaterial===null&&(this._cubemapMaterial=L5()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=k5());const c=s?this._cubemapMaterial:this._equirectMaterial,h=new Ja(this._lodPlanes[0],c),l=c.uniforms;l.envMap.value=e;const m=this._cubeSize;Ig(n,0,0,3*m,2*m),r.setRenderTarget(n),r.render(h,H_)}_applyPMREM(e){const n=this._renderer,r=n.autoClear;n.autoClear=!1;const s=this._lodPlanes.length;for(let c=1;c<s;c++){const h=Math.sqrt(this._sigmas[c]*this._sigmas[c]-this._sigmas[c-1]*this._sigmas[c-1]),l=R5[(s-c-1)%R5.length];this._blur(e,c-1,c,h,l)}n.autoClear=r}_blur(e,n,r,s,c){const h=this._pingPongRenderTarget;this._halfBlur(e,h,n,r,s,"latitudinal",c),this._halfBlur(h,e,r,r,s,"longitudinal",c)}_halfBlur(e,n,r,s,c,h,l){const m=this._renderer,_=this._blurMaterial;h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const S=3,T=new Ja(this._lodPlanes[s],_),M=_.uniforms,I=this._sizeLods[r]-1,N=isFinite(c)?Math.PI/(2*I):2*Math.PI/(2*xu-1),B=c/N,k=isFinite(c)?1+Math.floor(S*B):xu;k>xu&&console.warn(`sigmaRadians, ${c}, is too large and will clip, as it requested ${k} samples when the maximum is set to ${xu}`);const C=[];let U=0;for(let ne=0;ne<xu;++ne){const xe=ne/B,ie=Math.exp(-xe*xe/2);C.push(ie),ne===0?U+=ie:ne<k&&(U+=2*ie)}for(let ne=0;ne<C.length;ne++)C[ne]=C[ne]/U;M.envMap.value=e.texture,M.samples.value=k,M.weights.value=C,M.latitudinal.value=h==="latitudinal",l&&(M.poleAxis.value=l);const{_lodMax:V}=this;M.dTheta.value=N,M.mipInt.value=V-r;const Y=this._sizeLods[s],he=3*Y*(s>V-md?s-V+md:0),Z=4*(this._cubeSize-Y);Ig(n,he,Z,3*Y,2*Y),m.setRenderTarget(n),m.render(T,H_)}}function hN(t){const e=[],n=[],r=[];let s=t;const c=t-md+1+C5.length;for(let h=0;h<c;h++){const l=Math.pow(2,s);n.push(l);let m=1/l;h>t-md?m=C5[h-t+md-1]:h===0&&(m=0),r.push(m);const _=1/(l-2),S=-_,T=1+_,M=[S,S,T,S,T,T,S,S,T,T,S,T],I=6,N=6,B=3,k=2,C=1,U=new Float32Array(B*N*I),V=new Float32Array(k*N*I),Y=new Float32Array(C*N*I);for(let Z=0;Z<I;Z++){const ne=Z%3*2/3-1,xe=Z>2?0:-1,ie=[ne,xe,0,ne+2/3,xe,0,ne+2/3,xe+1,0,ne,xe,0,ne+2/3,xe+1,0,ne,xe+1,0];U.set(ie,B*N*Z),V.set(M,k*N*Z);const J=[Z,Z,Z,Z,Z,Z];Y.set(J,C*N*Z)}const he=new Fc;he.setAttribute("position",new xo(U,B)),he.setAttribute("uv",new xo(V,k)),he.setAttribute("faceIndex",new xo(Y,C)),e.push(he),s>md&&s--}return{lodPlanes:e,sizeLods:n,sigmas:r}}function D5(t,e,n){const r=new Uu(t,e,n);return r.texture.mapping=Tv,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function Ig(t,e,n,r,s){t.viewport.set(e,n,r,s),t.scissor.set(e,n,r,s)}function dN(t,e,n){const r=new Float32Array(xu),s=new st(0,1,0);return new bs({name:"SphericalGaussianBlur",defines:{n:xu,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:`${t}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:s}},vertexShader:jb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:bc,depthTest:!1,depthWrite:!1})}function k5(){return new bs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:jb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:bc,depthTest:!1,depthWrite:!1})}function L5(){return new bs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:jb(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:bc,depthTest:!1,depthWrite:!1})}function jb(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function fN(t){let e=new WeakMap,n=null;function r(l){if(l&&l.isTexture){const m=l.mapping,_=m===p2||m===m2,S=m===Fd||m===Nd;if(_||S){let T=e.get(l);const M=T!==void 0?T.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==M)return n===null&&(n=new I5(t)),T=_?n.fromEquirectangular(l,T):n.fromCubemap(l,T),T.texture.pmremVersion=l.pmremVersion,e.set(l,T),T.texture;if(T!==void 0)return T.texture;{const I=l.image;return _&&I&&I.height>0||S&&I&&s(I)?(n===null&&(n=new I5(t)),T=_?n.fromEquirectangular(l):n.fromCubemap(l),T.texture.pmremVersion=l.pmremVersion,e.set(l,T),l.addEventListener("dispose",c),T.texture):null}}}return l}function s(l){let m=0;const _=6;for(let S=0;S<_;S++)l[S]!==void 0&&m++;return m===_}function c(l){const m=l.target;m.removeEventListener("dispose",c);const _=e.get(m);_!==void 0&&(e.delete(m),_.dispose())}function h(){e=new WeakMap,n!==null&&(n.dispose(),n=null)}return{get:r,dispose:h}}function pN(t){const e={};function n(r){if(e[r]!==void 0)return e[r];let s;switch(r){case"WEBGL_depth_texture":s=t.getExtension("WEBGL_depth_texture")||t.getExtension("MOZ_WEBGL_depth_texture")||t.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":s=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":s=t.getExtension("WEBGL_compressed_texture_s3tc")||t.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":s=t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:s=t.getExtension(r)}return e[r]=s,s}return{has:function(r){return n(r)!==null},init:function(){n("EXT_color_buffer_float"),n("WEBGL_clip_cull_distance"),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture"),n("WEBGL_render_shared_exponent")},get:function(r){const s=n(r);return s===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),s}}}function mN(t,e,n,r){const s={},c=new WeakMap;function h(T){const M=T.target;M.index!==null&&e.remove(M.index);for(const N in M.attributes)e.remove(M.attributes[N]);for(const N in M.morphAttributes){const B=M.morphAttributes[N];for(let k=0,C=B.length;k<C;k++)e.remove(B[k])}M.removeEventListener("dispose",h),delete s[M.id];const I=c.get(M);I&&(e.remove(I),c.delete(M)),r.releaseStatesOfGeometry(M),M.isInstancedBufferGeometry===!0&&delete M._maxInstanceCount,n.memory.geometries--}function l(T,M){return s[M.id]===!0||(M.addEventListener("dispose",h),s[M.id]=!0,n.memory.geometries++),M}function m(T){const M=T.attributes;for(const N in M)e.update(M[N],t.ARRAY_BUFFER);const I=T.morphAttributes;for(const N in I){const B=I[N];for(let k=0,C=B.length;k<C;k++)e.update(B[k],t.ARRAY_BUFFER)}}function _(T){const M=[],I=T.index,N=T.attributes.position;let B=0;if(I!==null){const U=I.array;B=I.version;for(let V=0,Y=U.length;V<Y;V+=3){const he=U[V+0],Z=U[V+1],ne=U[V+2];M.push(he,Z,Z,ne,ne,he)}}else if(N!==void 0){const U=N.array;B=N.version;for(let V=0,Y=U.length/3-1;V<Y;V+=3){const he=V+0,Z=V+1,ne=V+2;M.push(he,Z,Z,ne,ne,he)}}else return;const k=new(JE(M)?sA:aA)(M,1);k.version=B;const C=c.get(T);C&&e.remove(C),c.set(T,k)}function S(T){const M=c.get(T);if(M){const I=T.index;I!==null&&M.version<I.version&&_(T)}else _(T);return c.get(T)}return{get:l,update:m,getWireframeAttribute:S}}function gN(t,e,n){let r;function s(M){r=M}let c,h;function l(M){c=M.type,h=M.bytesPerElement}function m(M,I){t.drawElements(r,I,c,M*h),n.update(I,r,1)}function _(M,I,N){N!==0&&(t.drawElementsInstanced(r,I,c,M*h,N),n.update(I,r,N))}function S(M,I,N){if(N===0)return;const B=e.get("WEBGL_multi_draw");if(B===null)for(let k=0;k<N;k++)this.render(M[k]/h,I[k]);else{B.multiDrawElementsWEBGL(r,I,0,c,M,0,N);let k=0;for(let C=0;C<N;C++)k+=I[C];n.update(k,r,1)}}function T(M,I,N,B){if(N===0)return;const k=e.get("WEBGL_multi_draw");if(k===null)for(let C=0;C<M.length;C++)_(M[C]/h,I[C],B[C]);else{k.multiDrawElementsInstancedWEBGL(r,I,0,c,M,0,B,0,N);let C=0;for(let U=0;U<N;U++)C+=I[U];for(let U=0;U<B.length;U++)n.update(C,r,B[U])}}this.setMode=s,this.setIndex=l,this.render=m,this.renderInstances=_,this.renderMultiDraw=S,this.renderMultiDrawInstances=T}function vN(t){const e={geometries:0,textures:0},n={frame:0,calls:0,triangles:0,points:0,lines:0};function r(c,h,l){switch(n.calls++,h){case t.TRIANGLES:n.triangles+=l*(c/3);break;case t.LINES:n.lines+=l*(c/2);break;case t.LINE_STRIP:n.lines+=l*(c-1);break;case t.LINE_LOOP:n.lines+=l*c;break;case t.POINTS:n.points+=l*c;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h);break}}function s(){n.calls=0,n.triangles=0,n.points=0,n.lines=0}return{memory:e,render:n,programs:null,autoReset:!0,reset:s,update:r}}function yN(t,e,n){const r=new WeakMap,s=new Hi;function c(h,l,m){const _=h.morphTargetInfluences,S=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,T=S!==void 0?S.length:0;let M=r.get(l);if(M===void 0||M.count!==T){let J=function(){xe.dispose(),r.delete(l),l.removeEventListener("dispose",J)};var I=J;M!==void 0&&M.texture.dispose();const N=l.morphAttributes.position!==void 0,B=l.morphAttributes.normal!==void 0,k=l.morphAttributes.color!==void 0,C=l.morphAttributes.position||[],U=l.morphAttributes.normal||[],V=l.morphAttributes.color||[];let Y=0;N===!0&&(Y=1),B===!0&&(Y=2),k===!0&&(Y=3);let he=l.attributes.position.count*Y,Z=1;he>e.maxTextureSize&&(Z=Math.ceil(he/e.maxTextureSize),he=e.maxTextureSize);const ne=new Float32Array(he*Z*4*T),xe=new eA(ne,he,Z,T);xe.type=hc,xe.needsUpdate=!0;const ie=Y*4;for(let Te=0;Te<T;Te++){const Be=C[Te],Re=U[Te],We=V[Te],ct=he*Z*4*Te;for(let gt=0;gt<Be.count;gt++){const ft=gt*ie;N===!0&&(s.fromBufferAttribute(Be,gt),ne[ct+ft+0]=s.x,ne[ct+ft+1]=s.y,ne[ct+ft+2]=s.z,ne[ct+ft+3]=0),B===!0&&(s.fromBufferAttribute(Re,gt),ne[ct+ft+4]=s.x,ne[ct+ft+5]=s.y,ne[ct+ft+6]=s.z,ne[ct+ft+7]=0),k===!0&&(s.fromBufferAttribute(We,gt),ne[ct+ft+8]=s.x,ne[ct+ft+9]=s.y,ne[ct+ft+10]=s.z,ne[ct+ft+11]=We.itemSize===4?s.w:1)}}M={count:T,texture:xe,size:new Yn(he,Z)},r.set(l,M),l.addEventListener("dispose",J)}if(h.isInstancedMesh===!0&&h.morphTexture!==null)m.getUniforms().setValue(t,"morphTexture",h.morphTexture,n);else{let N=0;for(let k=0;k<_.length;k++)N+=_[k];const B=l.morphTargetsRelative?1:1-N;m.getUniforms().setValue(t,"morphTargetBaseInfluence",B),m.getUniforms().setValue(t,"morphTargetInfluences",_)}m.getUniforms().setValue(t,"morphTargetsTexture",M.texture,n),m.getUniforms().setValue(t,"morphTargetsTextureSize",M.size)}return{update:c}}function _N(t,e,n,r){let s=new WeakMap;function c(m){const _=r.render.frame,S=m.geometry,T=e.get(m,S);if(s.get(T)!==_&&(e.update(T),s.set(T,_)),m.isInstancedMesh&&(m.hasEventListener("dispose",l)===!1&&m.addEventListener("dispose",l),s.get(m)!==_&&(n.update(m.instanceMatrix,t.ARRAY_BUFFER),m.instanceColor!==null&&n.update(m.instanceColor,t.ARRAY_BUFFER),s.set(m,_))),m.isSkinnedMesh){const M=m.skeleton;s.get(M)!==_&&(M.update(),s.set(M,_))}return T}function h(){s=new WeakMap}function l(m){const _=m.target;_.removeEventListener("dispose",l),n.remove(_.instanceMatrix),_.instanceColor!==null&&n.remove(_.instanceColor)}return{update:c,dispose:h}}class dA extends xa{constructor(e,n,r,s,c,h,l,m,_,S){if(S=S!==void 0?S:Md,S!==Md&&S!==vp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&S===Md&&(r=Bd),r===void 0&&S===vp&&(r=Lp),super(null,s,c,h,l,m,S,r,_),this.isDepthTexture=!0,this.image={width:e,height:n},this.magFilter=l!==void 0?l:xs,this.minFilter=m!==void 0?m:xs,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const n=super.toJSON(e);return this.compareFunction!==null&&(n.compareFunction=this.compareFunction),n}}const fA=new xa,pA=new dA(1,1);pA.compareFunction=KE;const mA=new eA,gA=new iL,vA=new cA,z5=[],F5=[],N5=new Float32Array(16),B5=new Float32Array(9),O5=new Float32Array(4);function Yd(t,e,n){const r=t[0];if(r<=0||r>0)return t;const s=e*n;let c=z5[s];if(c===void 0&&(c=new Float32Array(s),z5[s]=c),e!==0){r.toArray(c,0);for(let h=1,l=0;h!==e;++h)l+=n,t[h].toArray(c,l)}return c}function wi(t,e){if(t.length!==e.length)return!1;for(let n=0,r=t.length;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Si(t,e){for(let n=0,r=e.length;n<r;n++)t[n]=e[n]}function Pv(t,e){let n=F5[e];n===void 0&&(n=new Int32Array(e),F5[e]=n);for(let r=0;r!==e;++r)n[r]=t.allocateTextureUnit();return n}function xN(t,e){const n=this.cache;n[0]!==e&&(t.uniform1f(this.addr,e),n[0]=e)}function bN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2f(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wi(n,e))return;t.uniform2fv(this.addr,e),Si(n,e)}}function wN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3f(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else if(e.r!==void 0)(n[0]!==e.r||n[1]!==e.g||n[2]!==e.b)&&(t.uniform3f(this.addr,e.r,e.g,e.b),n[0]=e.r,n[1]=e.g,n[2]=e.b);else{if(wi(n,e))return;t.uniform3fv(this.addr,e),Si(n,e)}}function SN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4f(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wi(n,e))return;t.uniform4fv(this.addr,e),Si(n,e)}}function MN(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(wi(n,e))return;t.uniformMatrix2fv(this.addr,!1,e),Si(n,e)}else{if(wi(n,r))return;O5.set(r),t.uniformMatrix2fv(this.addr,!1,O5),Si(n,r)}}function TN(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(wi(n,e))return;t.uniformMatrix3fv(this.addr,!1,e),Si(n,e)}else{if(wi(n,r))return;B5.set(r),t.uniformMatrix3fv(this.addr,!1,B5),Si(n,r)}}function EN(t,e){const n=this.cache,r=e.elements;if(r===void 0){if(wi(n,e))return;t.uniformMatrix4fv(this.addr,!1,e),Si(n,e)}else{if(wi(n,r))return;N5.set(r),t.uniformMatrix4fv(this.addr,!1,N5),Si(n,r)}}function AN(t,e){const n=this.cache;n[0]!==e&&(t.uniform1i(this.addr,e),n[0]=e)}function CN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2i(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wi(n,e))return;t.uniform2iv(this.addr,e),Si(n,e)}}function PN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3i(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(wi(n,e))return;t.uniform3iv(this.addr,e),Si(n,e)}}function RN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4i(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wi(n,e))return;t.uniform4iv(this.addr,e),Si(n,e)}}function IN(t,e){const n=this.cache;n[0]!==e&&(t.uniform1ui(this.addr,e),n[0]=e)}function DN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y)&&(t.uniform2ui(this.addr,e.x,e.y),n[0]=e.x,n[1]=e.y);else{if(wi(n,e))return;t.uniform2uiv(this.addr,e),Si(n,e)}}function kN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z)&&(t.uniform3ui(this.addr,e.x,e.y,e.z),n[0]=e.x,n[1]=e.y,n[2]=e.z);else{if(wi(n,e))return;t.uniform3uiv(this.addr,e),Si(n,e)}}function LN(t,e){const n=this.cache;if(e.x!==void 0)(n[0]!==e.x||n[1]!==e.y||n[2]!==e.z||n[3]!==e.w)&&(t.uniform4ui(this.addr,e.x,e.y,e.z,e.w),n[0]=e.x,n[1]=e.y,n[2]=e.z,n[3]=e.w);else{if(wi(n,e))return;t.uniform4uiv(this.addr,e),Si(n,e)}}function zN(t,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s);const c=this.type===t.SAMPLER_2D_SHADOW?pA:fA;n.setTexture2D(e||c,s)}function FN(t,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.setTexture3D(e||gA,s)}function NN(t,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.setTextureCube(e||vA,s)}function BN(t,e,n){const r=this.cache,s=n.allocateTextureUnit();r[0]!==s&&(t.uniform1i(this.addr,s),r[0]=s),n.setTexture2DArray(e||mA,s)}function ON(t){switch(t){case 5126:return xN;case 35664:return bN;case 35665:return wN;case 35666:return SN;case 35674:return MN;case 35675:return TN;case 35676:return EN;case 5124:case 35670:return AN;case 35667:case 35671:return CN;case 35668:case 35672:return PN;case 35669:case 35673:return RN;case 5125:return IN;case 36294:return DN;case 36295:return kN;case 36296:return LN;case 35678:case 36198:case 36298:case 36306:case 35682:return zN;case 35679:case 36299:case 36307:return FN;case 35680:case 36300:case 36308:case 36293:return NN;case 36289:case 36303:case 36311:case 36292:return BN}}function UN(t,e){t.uniform1fv(this.addr,e)}function VN(t,e){const n=Yd(e,this.size,2);t.uniform2fv(this.addr,n)}function HN(t,e){const n=Yd(e,this.size,3);t.uniform3fv(this.addr,n)}function GN(t,e){const n=Yd(e,this.size,4);t.uniform4fv(this.addr,n)}function jN(t,e){const n=Yd(e,this.size,4);t.uniformMatrix2fv(this.addr,!1,n)}function WN(t,e){const n=Yd(e,this.size,9);t.uniformMatrix3fv(this.addr,!1,n)}function qN(t,e){const n=Yd(e,this.size,16);t.uniformMatrix4fv(this.addr,!1,n)}function $N(t,e){t.uniform1iv(this.addr,e)}function XN(t,e){t.uniform2iv(this.addr,e)}function ZN(t,e){t.uniform3iv(this.addr,e)}function YN(t,e){t.uniform4iv(this.addr,e)}function KN(t,e){t.uniform1uiv(this.addr,e)}function JN(t,e){t.uniform2uiv(this.addr,e)}function QN(t,e){t.uniform3uiv(this.addr,e)}function eB(t,e){t.uniform4uiv(this.addr,e)}function tB(t,e,n){const r=this.cache,s=e.length,c=Pv(n,s);wi(r,c)||(t.uniform1iv(this.addr,c),Si(r,c));for(let h=0;h!==s;++h)n.setTexture2D(e[h]||fA,c[h])}function nB(t,e,n){const r=this.cache,s=e.length,c=Pv(n,s);wi(r,c)||(t.uniform1iv(this.addr,c),Si(r,c));for(let h=0;h!==s;++h)n.setTexture3D(e[h]||gA,c[h])}function rB(t,e,n){const r=this.cache,s=e.length,c=Pv(n,s);wi(r,c)||(t.uniform1iv(this.addr,c),Si(r,c));for(let h=0;h!==s;++h)n.setTextureCube(e[h]||vA,c[h])}function iB(t,e,n){const r=this.cache,s=e.length,c=Pv(n,s);wi(r,c)||(t.uniform1iv(this.addr,c),Si(r,c));for(let h=0;h!==s;++h)n.setTexture2DArray(e[h]||mA,c[h])}function aB(t){switch(t){case 5126:return UN;case 35664:return VN;case 35665:return HN;case 35666:return GN;case 35674:return jN;case 35675:return WN;case 35676:return qN;case 5124:case 35670:return $N;case 35667:case 35671:return XN;case 35668:case 35672:return ZN;case 35669:case 35673:return YN;case 5125:return KN;case 36294:return JN;case 36295:return QN;case 36296:return eB;case 35678:case 36198:case 36298:case 36306:case 35682:return tB;case 35679:case 36299:case 36307:return nB;case 35680:case 36300:case 36308:case 36293:return rB;case 36289:case 36303:case 36311:case 36292:return iB}}class sB{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.setValue=ON(n.type)}}class oB{constructor(e,n,r){this.id=e,this.addr=r,this.cache=[],this.type=n.type,this.size=n.size,this.setValue=aB(n.type)}}class lB{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,n,r){const s=this.seq;for(let c=0,h=s.length;c!==h;++c){const l=s[c];l.setValue(e,n[l.id],r)}}}const $_=/(\w+)(\])?(\[|\.)?/g;function U5(t,e){t.seq.push(e),t.map[e.id]=e}function cB(t,e,n){const r=t.name,s=r.length;for($_.lastIndex=0;;){const c=$_.exec(r),h=$_.lastIndex;let l=c[1];const m=c[2]==="]",_=c[3];if(m&&(l=l|0),_===void 0||_==="["&&h+2===s){U5(n,_===void 0?new sB(l,t,e):new oB(l,t,e));break}else{let T=n.map[l];T===void 0&&(T=new lB(l),U5(n,T)),n=T}}}class i1{constructor(e,n){this.seq=[],this.map={};const r=e.getProgramParameter(n,e.ACTIVE_UNIFORMS);for(let s=0;s<r;++s){const c=e.getActiveUniform(n,s),h=e.getUniformLocation(n,c.name);cB(c,h,this)}}setValue(e,n,r,s){const c=this.map[n];c!==void 0&&c.setValue(e,r,s)}setOptional(e,n,r){const s=n[r];s!==void 0&&this.setValue(e,r,s)}static upload(e,n,r,s){for(let c=0,h=n.length;c!==h;++c){const l=n[c],m=r[l.id];m.needsUpdate!==!1&&l.setValue(e,m.value,s)}}static seqWithValue(e,n){const r=[];for(let s=0,c=e.length;s!==c;++s){const h=e[s];h.id in n&&r.push(h)}return r}}function V5(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}const uB=37297;let hB=0;function dB(t,e){const n=t.split(`
`),r=[],s=Math.max(e-6,0),c=Math.min(e+6,n.length);for(let h=s;h<c;h++){const l=h+1;r.push(`${l===e?">":" "} ${l}: ${n[h]}`)}return r.join(`
`)}function fB(t){const e=wr.getPrimaries(wr.workingColorSpace),n=wr.getPrimaries(t);let r;switch(e===n?r="":e===U1&&n===O1?r="LinearDisplayP3ToLinearSRGB":e===O1&&n===U1&&(r="LinearSRGBToLinearDisplayP3"),t){case zc:case Av:return[r,"LinearTransferOETF"];case oo:case Vb:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",t),[r,"LinearTransferOETF"]}}function H5(t,e,n){const r=t.getShaderParameter(e,t.COMPILE_STATUS),s=t.getShaderInfoLog(e).trim();if(r&&s==="")return"";const c=/ERROR: 0:(\d+)/.exec(s);if(c){const h=parseInt(c[1]);return n.toUpperCase()+`

`+s+`

`+dB(t.getShaderSource(e),h)}else return s}function pB(t,e){const n=fB(e);return`vec4 ${t}( vec4 value ) { return ${n[0]}( ${n[1]}( value ) ); }`}function mB(t,e){let n;switch(e){case ak:n="Linear";break;case sk:n="Reinhard";break;case ok:n="OptimizedCineon";break;case lk:n="ACESFilmic";break;case uk:n="AgX";break;case hk:n="Neutral";break;case ck:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),n="Linear"}return"vec3 "+t+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function gB(t){return[t.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",t.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(R0).join(`
`)}function vB(t){const e=[];for(const n in t){const r=t[n];r!==!1&&e.push("#define "+n+" "+r)}return e.join(`
`)}function yB(t,e){const n={},r=t.getProgramParameter(e,t.ACTIVE_ATTRIBUTES);for(let s=0;s<r;s++){const c=t.getActiveAttrib(e,s),h=c.name;let l=1;c.type===t.FLOAT_MAT2&&(l=2),c.type===t.FLOAT_MAT3&&(l=3),c.type===t.FLOAT_MAT4&&(l=4),n[h]={type:c.type,location:t.getAttribLocation(e,h),locationSize:l}}return n}function R0(t){return t!==""}function G5(t,e){const n=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return t.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,n).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function j5(t,e){return t.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const _B=/^[ \t]*#include +<([\w\d./]+)>/gm;function v2(t){return t.replace(_B,bB)}const xB=new Map;function bB(t,e){let n=Jn[e];if(n===void 0){const r=xB.get(e);if(r!==void 0)n=Jn[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return v2(n)}const wB=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function W5(t){return t.replace(wB,SB)}function SB(t,e,n,r){let s="";for(let c=parseInt(e);c<parseInt(n);c++)s+=r.replace(/\[\s*i\s*\]/g,"[ "+c+" ]").replace(/UNROLLED_LOOP_INDEX/g,c);return s}function q5(t){let e=`precision ${t.precision} float;
	precision ${t.precision} int;
	precision ${t.precision} sampler2D;
	precision ${t.precision} samplerCube;
	precision ${t.precision} sampler3D;
	precision ${t.precision} sampler2DArray;
	precision ${t.precision} sampler2DShadow;
	precision ${t.precision} samplerCubeShadow;
	precision ${t.precision} sampler2DArrayShadow;
	precision ${t.precision} isampler2D;
	precision ${t.precision} isampler3D;
	precision ${t.precision} isamplerCube;
	precision ${t.precision} isampler2DArray;
	precision ${t.precision} usampler2D;
	precision ${t.precision} usampler3D;
	precision ${t.precision} usamplerCube;
	precision ${t.precision} usampler2DArray;
	`;return t.precision==="highp"?e+=`
#define HIGH_PRECISION`:t.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:t.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function MB(t){let e="SHADOWMAP_TYPE_BASIC";return t.shadowMapType===VE?e="SHADOWMAP_TYPE_PCF":t.shadowMapType===ID?e="SHADOWMAP_TYPE_PCF_SOFT":t.shadowMapType===Jo&&(e="SHADOWMAP_TYPE_VSM"),e}function TB(t){let e="ENVMAP_TYPE_CUBE";if(t.envMap)switch(t.envMapMode){case Fd:case Nd:e="ENVMAP_TYPE_CUBE";break;case Tv:e="ENVMAP_TYPE_CUBE_UV";break}return e}function EB(t){let e="ENVMAP_MODE_REFLECTION";if(t.envMap)switch(t.envMapMode){case Nd:e="ENVMAP_MODE_REFRACTION";break}return e}function AB(t){let e="ENVMAP_BLENDING_NONE";if(t.envMap)switch(t.combine){case HE:e="ENVMAP_BLENDING_MULTIPLY";break;case rk:e="ENVMAP_BLENDING_MIX";break;case ik:e="ENVMAP_BLENDING_ADD";break}return e}function CB(t){const e=t.envMapCubeUVHeight;if(e===null)return null;const n=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,n),7*16)),texelHeight:r,maxMip:n}}function PB(t,e,n,r){const s=t.getContext(),c=n.defines;let h=n.vertexShader,l=n.fragmentShader;const m=MB(n),_=TB(n),S=EB(n),T=AB(n),M=CB(n),I=gB(n),N=vB(c),B=s.createProgram();let k,C,U=n.glslVersion?"#version "+n.glslVersion+`
`:"";n.isRawShaderMaterial?(k=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N].filter(R0).join(`
`),k.length>0&&(k+=`
`),C=["#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N].filter(R0).join(`
`),C.length>0&&(C+=`
`)):(k=[q5(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N,n.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",n.batching?"#define USE_BATCHING":"",n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.instancingMorph?"#define USE_INSTANCING_MORPH":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+S:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.displacementMap?"#define USE_DISPLACEMENTMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.mapUv?"#define MAP_UV "+n.mapUv:"",n.alphaMapUv?"#define ALPHAMAP_UV "+n.alphaMapUv:"",n.lightMapUv?"#define LIGHTMAP_UV "+n.lightMapUv:"",n.aoMapUv?"#define AOMAP_UV "+n.aoMapUv:"",n.emissiveMapUv?"#define EMISSIVEMAP_UV "+n.emissiveMapUv:"",n.bumpMapUv?"#define BUMPMAP_UV "+n.bumpMapUv:"",n.normalMapUv?"#define NORMALMAP_UV "+n.normalMapUv:"",n.displacementMapUv?"#define DISPLACEMENTMAP_UV "+n.displacementMapUv:"",n.metalnessMapUv?"#define METALNESSMAP_UV "+n.metalnessMapUv:"",n.roughnessMapUv?"#define ROUGHNESSMAP_UV "+n.roughnessMapUv:"",n.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+n.anisotropyMapUv:"",n.clearcoatMapUv?"#define CLEARCOATMAP_UV "+n.clearcoatMapUv:"",n.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+n.clearcoatNormalMapUv:"",n.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+n.clearcoatRoughnessMapUv:"",n.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+n.iridescenceMapUv:"",n.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+n.iridescenceThicknessMapUv:"",n.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+n.sheenColorMapUv:"",n.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+n.sheenRoughnessMapUv:"",n.specularMapUv?"#define SPECULARMAP_UV "+n.specularMapUv:"",n.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+n.specularColorMapUv:"",n.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+n.specularIntensityMapUv:"",n.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+n.transmissionMapUv:"",n.thicknessMapUv?"#define THICKNESSMAP_UV "+n.thicknessMapUv:"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&n.flatShading===!1?"#define USE_MORPHNORMALS":"",n.morphColors?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(R0).join(`
`),C=[q5(n),"#define SHADER_TYPE "+n.shaderType,"#define SHADER_NAME "+n.shaderName,N,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+_:"",n.envMap?"#define "+S:"",n.envMap?"#define "+T:"",M?"#define CUBEUV_TEXEL_WIDTH "+M.texelWidth:"",M?"#define CUBEUV_TEXEL_HEIGHT "+M.texelHeight:"",M?"#define CUBEUV_MAX_MIP "+M.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",n.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.anisotropy?"#define USE_ANISOTROPY":"",n.anisotropyMap?"#define USE_ANISOTROPYMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.dispersion?"#define USE_DISPERSION":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",n.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.alphaHash?"#define USE_ALPHAHASH":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.vertexTangents&&n.flatShading===!1?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUv1s?"#define USE_UV1":"",n.vertexUv2s?"#define USE_UV2":"",n.vertexUv3s?"#define USE_UV3":"",n.pointsUvs?"#define USE_POINTS_UV":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+m:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.numLightProbes>0?"#define USE_LIGHT_PROBES":"",n.useLegacyLights?"#define LEGACY_LIGHTS":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==wc?"#define TONE_MAPPING":"",n.toneMapping!==wc?Jn.tonemapping_pars_fragment:"",n.toneMapping!==wc?mB("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",Jn.colorspace_pars_fragment,pB("linearToOutputTexel",n.outputColorSpace),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"",`
`].filter(R0).join(`
`)),h=v2(h),h=G5(h,n),h=j5(h,n),l=v2(l),l=G5(l,n),l=j5(l,n),h=W5(h),l=W5(l),n.isRawShaderMaterial!==!0&&(U=`#version 300 es
`,k=[I,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+k,C=["#define varying in",n.glslVersion===o5?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===o5?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+C);const V=U+k+h,Y=U+C+l,he=V5(s,s.VERTEX_SHADER,V),Z=V5(s,s.FRAGMENT_SHADER,Y);s.attachShader(B,he),s.attachShader(B,Z),n.index0AttributeName!==void 0?s.bindAttribLocation(B,0,n.index0AttributeName):n.morphTargets===!0&&s.bindAttribLocation(B,0,"position"),s.linkProgram(B);function ne(Te){if(t.debug.checkShaderErrors){const Be=s.getProgramInfoLog(B).trim(),Re=s.getShaderInfoLog(he).trim(),We=s.getShaderInfoLog(Z).trim();let ct=!0,gt=!0;if(s.getProgramParameter(B,s.LINK_STATUS)===!1)if(ct=!1,typeof t.debug.onShaderError=="function")t.debug.onShaderError(s,B,he,Z);else{const ft=H5(s,he,"vertex"),ke=H5(s,Z,"fragment");console.error("THREE.WebGLProgram: Shader Error "+s.getError()+" - VALIDATE_STATUS "+s.getProgramParameter(B,s.VALIDATE_STATUS)+`

Material Name: `+Te.name+`
Material Type: `+Te.type+`

Program Info Log: `+Be+`
`+ft+`
`+ke)}else Be!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Be):(Re===""||We==="")&&(gt=!1);gt&&(Te.diagnostics={runnable:ct,programLog:Be,vertexShader:{log:Re,prefix:k},fragmentShader:{log:We,prefix:C}})}s.deleteShader(he),s.deleteShader(Z),xe=new i1(s,B),ie=yB(s,B)}let xe;this.getUniforms=function(){return xe===void 0&&ne(this),xe};let ie;this.getAttributes=function(){return ie===void 0&&ne(this),ie};let J=n.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return J===!1&&(J=s.getProgramParameter(B,uB)),J},this.destroy=function(){r.releaseStatesOfProgram(this),s.deleteProgram(B),this.program=void 0},this.type=n.shaderType,this.name=n.shaderName,this.id=hB++,this.cacheKey=e,this.usedTimes=1,this.program=B,this.vertexShader=he,this.fragmentShader=Z,this}let RB=0;class IB{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const n=e.vertexShader,r=e.fragmentShader,s=this._getShaderStage(n),c=this._getShaderStage(r),h=this._getShaderCacheForMaterial(e);return h.has(s)===!1&&(h.add(s),s.usedTimes++),h.has(c)===!1&&(h.add(c),c.usedTimes++),this}remove(e){const n=this.materialCache.get(e);for(const r of n)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const n=this.materialCache;let r=n.get(e);return r===void 0&&(r=new Set,n.set(e,r)),r}_getShaderStage(e){const n=this.shaderCache;let r=n.get(e);return r===void 0&&(r=new DB(e),n.set(e,r)),r}}class DB{constructor(e){this.id=RB++,this.code=e,this.usedTimes=0}}function kB(t,e,n,r,s,c,h){const l=new nA,m=new IB,_=new Set,S=[],T=s.logarithmicDepthBuffer,M=s.vertexTextures;let I=s.precision;const N={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function B(ie){return _.add(ie),ie===0?"uv":`uv${ie}`}function k(ie,J,Te,Be,Re){const We=Be.fog,ct=Re.geometry,gt=ie.isMeshStandardMaterial?Be.environment:null,ft=(ie.isMeshStandardMaterial?n:e).get(ie.envMap||gt),ke=ft&&ft.mapping===Tv?ft.image.height:null,at=N[ie.type];ie.precision!==null&&(I=s.getMaxPrecision(ie.precision),I!==ie.precision&&console.warn("THREE.WebGLProgram.getParameters:",ie.precision,"not supported, using",I,"instead."));const ot=ct.morphAttributes.position||ct.morphAttributes.normal||ct.morphAttributes.color,_t=ot!==void 0?ot.length:0;let kt=0;ct.morphAttributes.position!==void 0&&(kt=1),ct.morphAttributes.normal!==void 0&&(kt=2),ct.morphAttributes.color!==void 0&&(kt=3);let Cn,it,Mt,Ft;if(at){const pe=lo[at];Cn=pe.vertexShader,it=pe.fragmentShader}else Cn=ie.vertexShader,it=ie.fragmentShader,m.update(ie),Mt=m.getVertexShaderID(ie),Ft=m.getFragmentShaderID(ie);const At=t.getRenderTarget(),Sn=Re.isInstancedMesh===!0,Dn=Re.isBatchedMesh===!0,qe=!!ie.map,Nn=!!ie.matcap,hn=!!ft,Gn=!!ie.aoMap,gn=!!ie.lightMap,un=!!ie.bumpMap,Pn=!!ie.normalMap,je=!!ie.displacementMap,qn=!!ie.emissiveMap,Ae=!!ie.metalnessMap,se=!!ie.roughnessMap,tt=ie.anisotropy>0,vt=ie.clearcoat>0,Tt=ie.dispersion>0,wt=ie.iridescence>0,pn=ie.sheen>0,Gt=ie.transmission>0,Ht=tt&&!!ie.anisotropyMap,Ln=vt&&!!ie.clearcoatMap,He=vt&&!!ie.clearcoatNormalMap,on=vt&&!!ie.clearcoatRoughnessMap,Rn=wt&&!!ie.iridescenceMap,xn=wt&&!!ie.iridescenceThicknessMap,Qt=pn&&!!ie.sheenColorMap,lt=pn&&!!ie.sheenRoughnessMap,Ut=!!ie.specularMap,Zt=!!ie.specularColorMap,yn=!!ie.specularIntensityMap,Q=Gt&&!!ie.transmissionMap,ze=Gt&&!!ie.thicknessMap,Qe=!!ie.gradientMap,bt=!!ie.alphaMap,ae=ie.alphaTest>0,F=!!ie.alphaHash,O=!!ie.extensions;let q=wc;ie.toneMapped&&(At===null||At.isXRRenderTarget===!0)&&(q=t.toneMapping);const te={shaderID:at,shaderType:ie.type,shaderName:ie.name,vertexShader:Cn,fragmentShader:it,defines:ie.defines,customVertexShaderID:Mt,customFragmentShaderID:Ft,isRawShaderMaterial:ie.isRawShaderMaterial===!0,glslVersion:ie.glslVersion,precision:I,batching:Dn,instancing:Sn,instancingColor:Sn&&Re.instanceColor!==null,instancingMorph:Sn&&Re.morphTexture!==null,supportsVertexTextures:M,outputColorSpace:At===null?t.outputColorSpace:At.isXRRenderTarget===!0?At.texture.colorSpace:zc,alphaToCoverage:!!ie.alphaToCoverage,map:qe,matcap:Nn,envMap:hn,envMapMode:hn&&ft.mapping,envMapCubeUVHeight:ke,aoMap:Gn,lightMap:gn,bumpMap:un,normalMap:Pn,displacementMap:M&&je,emissiveMap:qn,normalMapObjectSpace:Pn&&ie.normalMapType===Ek,normalMapTangentSpace:Pn&&ie.normalMapType===Tk,metalnessMap:Ae,roughnessMap:se,anisotropy:tt,anisotropyMap:Ht,clearcoat:vt,clearcoatMap:Ln,clearcoatNormalMap:He,clearcoatRoughnessMap:on,dispersion:Tt,iridescence:wt,iridescenceMap:Rn,iridescenceThicknessMap:xn,sheen:pn,sheenColorMap:Qt,sheenRoughnessMap:lt,specularMap:Ut,specularColorMap:Zt,specularIntensityMap:yn,transmission:Gt,transmissionMap:Q,thicknessMap:ze,gradientMap:Qe,opaque:ie.transparent===!1&&ie.blending===Sd&&ie.alphaToCoverage===!1,alphaMap:bt,alphaTest:ae,alphaHash:F,combine:ie.combine,mapUv:qe&&B(ie.map.channel),aoMapUv:Gn&&B(ie.aoMap.channel),lightMapUv:gn&&B(ie.lightMap.channel),bumpMapUv:un&&B(ie.bumpMap.channel),normalMapUv:Pn&&B(ie.normalMap.channel),displacementMapUv:je&&B(ie.displacementMap.channel),emissiveMapUv:qn&&B(ie.emissiveMap.channel),metalnessMapUv:Ae&&B(ie.metalnessMap.channel),roughnessMapUv:se&&B(ie.roughnessMap.channel),anisotropyMapUv:Ht&&B(ie.anisotropyMap.channel),clearcoatMapUv:Ln&&B(ie.clearcoatMap.channel),clearcoatNormalMapUv:He&&B(ie.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:on&&B(ie.clearcoatRoughnessMap.channel),iridescenceMapUv:Rn&&B(ie.iridescenceMap.channel),iridescenceThicknessMapUv:xn&&B(ie.iridescenceThicknessMap.channel),sheenColorMapUv:Qt&&B(ie.sheenColorMap.channel),sheenRoughnessMapUv:lt&&B(ie.sheenRoughnessMap.channel),specularMapUv:Ut&&B(ie.specularMap.channel),specularColorMapUv:Zt&&B(ie.specularColorMap.channel),specularIntensityMapUv:yn&&B(ie.specularIntensityMap.channel),transmissionMapUv:Q&&B(ie.transmissionMap.channel),thicknessMapUv:ze&&B(ie.thicknessMap.channel),alphaMapUv:bt&&B(ie.alphaMap.channel),vertexTangents:!!ct.attributes.tangent&&(Pn||tt),vertexColors:ie.vertexColors,vertexAlphas:ie.vertexColors===!0&&!!ct.attributes.color&&ct.attributes.color.itemSize===4,pointsUvs:Re.isPoints===!0&&!!ct.attributes.uv&&(qe||bt),fog:!!We,useFog:ie.fog===!0,fogExp2:!!We&&We.isFogExp2,flatShading:ie.flatShading===!0,sizeAttenuation:ie.sizeAttenuation===!0,logarithmicDepthBuffer:T,skinning:Re.isSkinnedMesh===!0,morphTargets:ct.morphAttributes.position!==void 0,morphNormals:ct.morphAttributes.normal!==void 0,morphColors:ct.morphAttributes.color!==void 0,morphTargetsCount:_t,morphTextureStride:kt,numDirLights:J.directional.length,numPointLights:J.point.length,numSpotLights:J.spot.length,numSpotLightMaps:J.spotLightMap.length,numRectAreaLights:J.rectArea.length,numHemiLights:J.hemi.length,numDirLightShadows:J.directionalShadowMap.length,numPointLightShadows:J.pointShadowMap.length,numSpotLightShadows:J.spotShadowMap.length,numSpotLightShadowsWithMaps:J.numSpotLightShadowsWithMaps,numLightProbes:J.numLightProbes,numClippingPlanes:h.numPlanes,numClipIntersection:h.numIntersection,dithering:ie.dithering,shadowMapEnabled:t.shadowMap.enabled&&Te.length>0,shadowMapType:t.shadowMap.type,toneMapping:q,useLegacyLights:t._useLegacyLights,decodeVideoTexture:qe&&ie.map.isVideoTexture===!0&&wr.getTransfer(ie.map.colorSpace)===zr,premultipliedAlpha:ie.premultipliedAlpha,doubleSided:ie.side===fo,flipSided:ie.side===za,useDepthPacking:ie.depthPacking>=0,depthPacking:ie.depthPacking||0,index0AttributeName:ie.index0AttributeName,extensionClipCullDistance:O&&ie.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:O&&ie.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:ie.customProgramCacheKey()};return te.vertexUv1s=_.has(1),te.vertexUv2s=_.has(2),te.vertexUv3s=_.has(3),_.clear(),te}function C(ie){const J=[];if(ie.shaderID?J.push(ie.shaderID):(J.push(ie.customVertexShaderID),J.push(ie.customFragmentShaderID)),ie.defines!==void 0)for(const Te in ie.defines)J.push(Te),J.push(ie.defines[Te]);return ie.isRawShaderMaterial===!1&&(U(J,ie),V(J,ie),J.push(t.outputColorSpace)),J.push(ie.customProgramCacheKey),J.join()}function U(ie,J){ie.push(J.precision),ie.push(J.outputColorSpace),ie.push(J.envMapMode),ie.push(J.envMapCubeUVHeight),ie.push(J.mapUv),ie.push(J.alphaMapUv),ie.push(J.lightMapUv),ie.push(J.aoMapUv),ie.push(J.bumpMapUv),ie.push(J.normalMapUv),ie.push(J.displacementMapUv),ie.push(J.emissiveMapUv),ie.push(J.metalnessMapUv),ie.push(J.roughnessMapUv),ie.push(J.anisotropyMapUv),ie.push(J.clearcoatMapUv),ie.push(J.clearcoatNormalMapUv),ie.push(J.clearcoatRoughnessMapUv),ie.push(J.iridescenceMapUv),ie.push(J.iridescenceThicknessMapUv),ie.push(J.sheenColorMapUv),ie.push(J.sheenRoughnessMapUv),ie.push(J.specularMapUv),ie.push(J.specularColorMapUv),ie.push(J.specularIntensityMapUv),ie.push(J.transmissionMapUv),ie.push(J.thicknessMapUv),ie.push(J.combine),ie.push(J.fogExp2),ie.push(J.sizeAttenuation),ie.push(J.morphTargetsCount),ie.push(J.morphAttributeCount),ie.push(J.numDirLights),ie.push(J.numPointLights),ie.push(J.numSpotLights),ie.push(J.numSpotLightMaps),ie.push(J.numHemiLights),ie.push(J.numRectAreaLights),ie.push(J.numDirLightShadows),ie.push(J.numPointLightShadows),ie.push(J.numSpotLightShadows),ie.push(J.numSpotLightShadowsWithMaps),ie.push(J.numLightProbes),ie.push(J.shadowMapType),ie.push(J.toneMapping),ie.push(J.numClippingPlanes),ie.push(J.numClipIntersection),ie.push(J.depthPacking)}function V(ie,J){l.disableAll(),J.supportsVertexTextures&&l.enable(0),J.instancing&&l.enable(1),J.instancingColor&&l.enable(2),J.instancingMorph&&l.enable(3),J.matcap&&l.enable(4),J.envMap&&l.enable(5),J.normalMapObjectSpace&&l.enable(6),J.normalMapTangentSpace&&l.enable(7),J.clearcoat&&l.enable(8),J.iridescence&&l.enable(9),J.alphaTest&&l.enable(10),J.vertexColors&&l.enable(11),J.vertexAlphas&&l.enable(12),J.vertexUv1s&&l.enable(13),J.vertexUv2s&&l.enable(14),J.vertexUv3s&&l.enable(15),J.vertexTangents&&l.enable(16),J.anisotropy&&l.enable(17),J.alphaHash&&l.enable(18),J.batching&&l.enable(19),J.dispersion&&l.enable(20),ie.push(l.mask),l.disableAll(),J.fog&&l.enable(0),J.useFog&&l.enable(1),J.flatShading&&l.enable(2),J.logarithmicDepthBuffer&&l.enable(3),J.skinning&&l.enable(4),J.morphTargets&&l.enable(5),J.morphNormals&&l.enable(6),J.morphColors&&l.enable(7),J.premultipliedAlpha&&l.enable(8),J.shadowMapEnabled&&l.enable(9),J.useLegacyLights&&l.enable(10),J.doubleSided&&l.enable(11),J.flipSided&&l.enable(12),J.useDepthPacking&&l.enable(13),J.dithering&&l.enable(14),J.transmission&&l.enable(15),J.sheen&&l.enable(16),J.opaque&&l.enable(17),J.pointsUvs&&l.enable(18),J.decodeVideoTexture&&l.enable(19),J.alphaToCoverage&&l.enable(20),ie.push(l.mask)}function Y(ie){const J=N[ie.type];let Te;if(J){const Be=lo[J];Te=gL.clone(Be.uniforms)}else Te=ie.uniforms;return Te}function he(ie,J){let Te;for(let Be=0,Re=S.length;Be<Re;Be++){const We=S[Be];if(We.cacheKey===J){Te=We,++Te.usedTimes;break}}return Te===void 0&&(Te=new PB(t,J,ie,c),S.push(Te)),Te}function Z(ie){if(--ie.usedTimes===0){const J=S.indexOf(ie);S[J]=S[S.length-1],S.pop(),ie.destroy()}}function ne(ie){m.remove(ie)}function xe(){m.dispose()}return{getParameters:k,getProgramCacheKey:C,getUniforms:Y,acquireProgram:he,releaseProgram:Z,releaseShaderCache:ne,programs:S,dispose:xe}}function LB(){let t=new WeakMap;function e(c){let h=t.get(c);return h===void 0&&(h={},t.set(c,h)),h}function n(c){t.delete(c)}function r(c,h,l){t.get(c)[h]=l}function s(){t=new WeakMap}return{get:e,remove:n,update:r,dispose:s}}function zB(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.material.id!==e.material.id?t.material.id-e.material.id:t.z!==e.z?t.z-e.z:t.id-e.id}function $5(t,e){return t.groupOrder!==e.groupOrder?t.groupOrder-e.groupOrder:t.renderOrder!==e.renderOrder?t.renderOrder-e.renderOrder:t.z!==e.z?e.z-t.z:t.id-e.id}function X5(){const t=[];let e=0;const n=[],r=[],s=[];function c(){e=0,n.length=0,r.length=0,s.length=0}function h(T,M,I,N,B,k){let C=t[e];return C===void 0?(C={id:T.id,object:T,geometry:M,material:I,groupOrder:N,renderOrder:T.renderOrder,z:B,group:k},t[e]=C):(C.id=T.id,C.object=T,C.geometry=M,C.material=I,C.groupOrder=N,C.renderOrder=T.renderOrder,C.z=B,C.group=k),e++,C}function l(T,M,I,N,B,k){const C=h(T,M,I,N,B,k);I.transmission>0?r.push(C):I.transparent===!0?s.push(C):n.push(C)}function m(T,M,I,N,B,k){const C=h(T,M,I,N,B,k);I.transmission>0?r.unshift(C):I.transparent===!0?s.unshift(C):n.unshift(C)}function _(T,M){n.length>1&&n.sort(T||zB),r.length>1&&r.sort(M||$5),s.length>1&&s.sort(M||$5)}function S(){for(let T=e,M=t.length;T<M;T++){const I=t[T];if(I.id===null)break;I.id=null,I.object=null,I.geometry=null,I.material=null,I.group=null}}return{opaque:n,transmissive:r,transparent:s,init:c,push:l,unshift:m,finish:S,sort:_}}function FB(){let t=new WeakMap;function e(r,s){const c=t.get(r);let h;return c===void 0?(h=new X5,t.set(r,[h])):s>=c.length?(h=new X5,c.push(h)):h=c[s],h}function n(){t=new WeakMap}return{get:e,dispose:n}}function NB(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={direction:new st,color:new Sr};break;case"SpotLight":n={position:new st,direction:new st,color:new Sr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new st,color:new Sr,distance:0,decay:0};break;case"HemisphereLight":n={direction:new st,skyColor:new Sr,groundColor:new Sr};break;case"RectAreaLight":n={color:new Sr,position:new st,halfWidth:new st,halfHeight:new st};break}return t[e.id]=n,n}}}function BB(){const t={};return{get:function(e){if(t[e.id]!==void 0)return t[e.id];let n;switch(e.type){case"DirectionalLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yn};break;case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yn};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Yn,shadowCameraNear:1,shadowCameraFar:1e3};break}return t[e.id]=n,n}}}let OB=0;function UB(t,e){return(e.castShadow?2:0)-(t.castShadow?2:0)+(e.map?1:0)-(t.map?1:0)}function VB(t){const e=new NB,n=BB(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let _=0;_<9;_++)r.probe.push(new st);const s=new st,c=new bi,h=new bi;function l(_,S){let T=0,M=0,I=0;for(let Te=0;Te<9;Te++)r.probe[Te].set(0,0,0);let N=0,B=0,k=0,C=0,U=0,V=0,Y=0,he=0,Z=0,ne=0,xe=0;_.sort(UB);const ie=S===!0?Math.PI:1;for(let Te=0,Be=_.length;Te<Be;Te++){const Re=_[Te],We=Re.color,ct=Re.intensity,gt=Re.distance,ft=Re.shadow&&Re.shadow.map?Re.shadow.map.texture:null;if(Re.isAmbientLight)T+=We.r*ct*ie,M+=We.g*ct*ie,I+=We.b*ct*ie;else if(Re.isLightProbe){for(let ke=0;ke<9;ke++)r.probe[ke].addScaledVector(Re.sh.coefficients[ke],ct);xe++}else if(Re.isDirectionalLight){const ke=e.get(Re);if(ke.color.copy(Re.color).multiplyScalar(Re.intensity*ie),Re.castShadow){const at=Re.shadow,ot=n.get(Re);ot.shadowBias=at.bias,ot.shadowNormalBias=at.normalBias,ot.shadowRadius=at.radius,ot.shadowMapSize=at.mapSize,r.directionalShadow[N]=ot,r.directionalShadowMap[N]=ft,r.directionalShadowMatrix[N]=Re.shadow.matrix,V++}r.directional[N]=ke,N++}else if(Re.isSpotLight){const ke=e.get(Re);ke.position.setFromMatrixPosition(Re.matrixWorld),ke.color.copy(We).multiplyScalar(ct*ie),ke.distance=gt,ke.coneCos=Math.cos(Re.angle),ke.penumbraCos=Math.cos(Re.angle*(1-Re.penumbra)),ke.decay=Re.decay,r.spot[k]=ke;const at=Re.shadow;if(Re.map&&(r.spotLightMap[Z]=Re.map,Z++,at.updateMatrices(Re),Re.castShadow&&ne++),r.spotLightMatrix[k]=at.matrix,Re.castShadow){const ot=n.get(Re);ot.shadowBias=at.bias,ot.shadowNormalBias=at.normalBias,ot.shadowRadius=at.radius,ot.shadowMapSize=at.mapSize,r.spotShadow[k]=ot,r.spotShadowMap[k]=ft,he++}k++}else if(Re.isRectAreaLight){const ke=e.get(Re);ke.color.copy(We).multiplyScalar(ct),ke.halfWidth.set(Re.width*.5,0,0),ke.halfHeight.set(0,Re.height*.5,0),r.rectArea[C]=ke,C++}else if(Re.isPointLight){const ke=e.get(Re);if(ke.color.copy(Re.color).multiplyScalar(Re.intensity*ie),ke.distance=Re.distance,ke.decay=Re.decay,Re.castShadow){const at=Re.shadow,ot=n.get(Re);ot.shadowBias=at.bias,ot.shadowNormalBias=at.normalBias,ot.shadowRadius=at.radius,ot.shadowMapSize=at.mapSize,ot.shadowCameraNear=at.camera.near,ot.shadowCameraFar=at.camera.far,r.pointShadow[B]=ot,r.pointShadowMap[B]=ft,r.pointShadowMatrix[B]=Re.shadow.matrix,Y++}r.point[B]=ke,B++}else if(Re.isHemisphereLight){const ke=e.get(Re);ke.skyColor.copy(Re.color).multiplyScalar(ct*ie),ke.groundColor.copy(Re.groundColor).multiplyScalar(ct*ie),r.hemi[U]=ke,U++}}C>0&&(t.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=sn.LTC_FLOAT_1,r.rectAreaLTC2=sn.LTC_FLOAT_2):(r.rectAreaLTC1=sn.LTC_HALF_1,r.rectAreaLTC2=sn.LTC_HALF_2)),r.ambient[0]=T,r.ambient[1]=M,r.ambient[2]=I;const J=r.hash;(J.directionalLength!==N||J.pointLength!==B||J.spotLength!==k||J.rectAreaLength!==C||J.hemiLength!==U||J.numDirectionalShadows!==V||J.numPointShadows!==Y||J.numSpotShadows!==he||J.numSpotMaps!==Z||J.numLightProbes!==xe)&&(r.directional.length=N,r.spot.length=k,r.rectArea.length=C,r.point.length=B,r.hemi.length=U,r.directionalShadow.length=V,r.directionalShadowMap.length=V,r.pointShadow.length=Y,r.pointShadowMap.length=Y,r.spotShadow.length=he,r.spotShadowMap.length=he,r.directionalShadowMatrix.length=V,r.pointShadowMatrix.length=Y,r.spotLightMatrix.length=he+Z-ne,r.spotLightMap.length=Z,r.numSpotLightShadowsWithMaps=ne,r.numLightProbes=xe,J.directionalLength=N,J.pointLength=B,J.spotLength=k,J.rectAreaLength=C,J.hemiLength=U,J.numDirectionalShadows=V,J.numPointShadows=Y,J.numSpotShadows=he,J.numSpotMaps=Z,J.numLightProbes=xe,r.version=OB++)}function m(_,S){let T=0,M=0,I=0,N=0,B=0;const k=S.matrixWorldInverse;for(let C=0,U=_.length;C<U;C++){const V=_[C];if(V.isDirectionalLight){const Y=r.directional[T];Y.direction.setFromMatrixPosition(V.matrixWorld),s.setFromMatrixPosition(V.target.matrixWorld),Y.direction.sub(s),Y.direction.transformDirection(k),T++}else if(V.isSpotLight){const Y=r.spot[I];Y.position.setFromMatrixPosition(V.matrixWorld),Y.position.applyMatrix4(k),Y.direction.setFromMatrixPosition(V.matrixWorld),s.setFromMatrixPosition(V.target.matrixWorld),Y.direction.sub(s),Y.direction.transformDirection(k),I++}else if(V.isRectAreaLight){const Y=r.rectArea[N];Y.position.setFromMatrixPosition(V.matrixWorld),Y.position.applyMatrix4(k),h.identity(),c.copy(V.matrixWorld),c.premultiply(k),h.extractRotation(c),Y.halfWidth.set(V.width*.5,0,0),Y.halfHeight.set(0,V.height*.5,0),Y.halfWidth.applyMatrix4(h),Y.halfHeight.applyMatrix4(h),N++}else if(V.isPointLight){const Y=r.point[M];Y.position.setFromMatrixPosition(V.matrixWorld),Y.position.applyMatrix4(k),M++}else if(V.isHemisphereLight){const Y=r.hemi[B];Y.direction.setFromMatrixPosition(V.matrixWorld),Y.direction.transformDirection(k),B++}}}return{setup:l,setupView:m,state:r}}function Z5(t){const e=new VB(t),n=[],r=[];function s(S){_.camera=S,n.length=0,r.length=0}function c(S){n.push(S)}function h(S){r.push(S)}function l(S){e.setup(n,S)}function m(S){e.setupView(n,S)}const _={lightsArray:n,shadowsArray:r,camera:null,lights:e,transmissionRenderTarget:{}};return{init:s,state:_,setupLights:l,setupLightsView:m,pushLight:c,pushShadow:h}}function HB(t){let e=new WeakMap;function n(s,c=0){const h=e.get(s);let l;return h===void 0?(l=new Z5(t),e.set(s,[l])):c>=h.length?(l=new Z5(t),h.push(l)):l=h[c],l}function r(){e=new WeakMap}return{get:n,dispose:r}}class GB extends Cv{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=Sk,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class jB extends Cv{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const WB=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,qB=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function $B(t,e,n){let r=new uA;const s=new Yn,c=new Yn,h=new Hi,l=new GB({depthPacking:Mk}),m=new jB,_={},S=n.maxTextureSize,T={[Tc]:za,[za]:Tc,[fo]:fo},M=new bs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Yn},radius:{value:4}},vertexShader:WB,fragmentShader:qB}),I=M.clone();I.defines.HORIZONTAL_PASS=1;const N=new Fc;N.setAttribute("position",new xo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const B=new Ja(N,M),k=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=VE;let C=this.type;this.render=function(Z,ne,xe){if(k.enabled===!1||k.autoUpdate===!1&&k.needsUpdate===!1||Z.length===0)return;const ie=t.getRenderTarget(),J=t.getActiveCubeFace(),Te=t.getActiveMipmapLevel(),Be=t.state;Be.setBlending(bc),Be.buffers.color.setClear(1,1,1,1),Be.buffers.depth.setTest(!0),Be.setScissorTest(!1);const Re=C!==Jo&&this.type===Jo,We=C===Jo&&this.type!==Jo;for(let ct=0,gt=Z.length;ct<gt;ct++){const ft=Z[ct],ke=ft.shadow;if(ke===void 0){console.warn("THREE.WebGLShadowMap:",ft,"has no shadow.");continue}if(ke.autoUpdate===!1&&ke.needsUpdate===!1)continue;s.copy(ke.mapSize);const at=ke.getFrameExtents();if(s.multiply(at),c.copy(ke.mapSize),(s.x>S||s.y>S)&&(s.x>S&&(c.x=Math.floor(S/at.x),s.x=c.x*at.x,ke.mapSize.x=c.x),s.y>S&&(c.y=Math.floor(S/at.y),s.y=c.y*at.y,ke.mapSize.y=c.y)),ke.map===null||Re===!0||We===!0){const _t=this.type!==Jo?{minFilter:xs,magFilter:xs}:{};ke.map!==null&&ke.map.dispose(),ke.map=new Uu(s.x,s.y,_t),ke.map.texture.name=ft.name+".shadowMap",ke.camera.updateProjectionMatrix()}t.setRenderTarget(ke.map),t.clear();const ot=ke.getViewportCount();for(let _t=0;_t<ot;_t++){const kt=ke.getViewport(_t);h.set(c.x*kt.x,c.y*kt.y,c.x*kt.z,c.y*kt.w),Be.viewport(h),ke.updateMatrices(ft,_t),r=ke.getFrustum(),Y(ne,xe,ke.camera,ft,this.type)}ke.isPointLightShadow!==!0&&this.type===Jo&&U(ke,xe),ke.needsUpdate=!1}C=this.type,k.needsUpdate=!1,t.setRenderTarget(ie,J,Te)};function U(Z,ne){const xe=e.update(B);M.defines.VSM_SAMPLES!==Z.blurSamples&&(M.defines.VSM_SAMPLES=Z.blurSamples,I.defines.VSM_SAMPLES=Z.blurSamples,M.needsUpdate=!0,I.needsUpdate=!0),Z.mapPass===null&&(Z.mapPass=new Uu(s.x,s.y)),M.uniforms.shadow_pass.value=Z.map.texture,M.uniforms.resolution.value=Z.mapSize,M.uniforms.radius.value=Z.radius,t.setRenderTarget(Z.mapPass),t.clear(),t.renderBufferDirect(ne,null,xe,M,B,null),I.uniforms.shadow_pass.value=Z.mapPass.texture,I.uniforms.resolution.value=Z.mapSize,I.uniforms.radius.value=Z.radius,t.setRenderTarget(Z.map),t.clear(),t.renderBufferDirect(ne,null,xe,I,B,null)}function V(Z,ne,xe,ie){let J=null;const Te=xe.isPointLight===!0?Z.customDistanceMaterial:Z.customDepthMaterial;if(Te!==void 0)J=Te;else if(J=xe.isPointLight===!0?m:l,t.localClippingEnabled&&ne.clipShadows===!0&&Array.isArray(ne.clippingPlanes)&&ne.clippingPlanes.length!==0||ne.displacementMap&&ne.displacementScale!==0||ne.alphaMap&&ne.alphaTest>0||ne.map&&ne.alphaTest>0){const Be=J.uuid,Re=ne.uuid;let We=_[Be];We===void 0&&(We={},_[Be]=We);let ct=We[Re];ct===void 0&&(ct=J.clone(),We[Re]=ct,ne.addEventListener("dispose",he)),J=ct}if(J.visible=ne.visible,J.wireframe=ne.wireframe,ie===Jo?J.side=ne.shadowSide!==null?ne.shadowSide:ne.side:J.side=ne.shadowSide!==null?ne.shadowSide:T[ne.side],J.alphaMap=ne.alphaMap,J.alphaTest=ne.alphaTest,J.map=ne.map,J.clipShadows=ne.clipShadows,J.clippingPlanes=ne.clippingPlanes,J.clipIntersection=ne.clipIntersection,J.displacementMap=ne.displacementMap,J.displacementScale=ne.displacementScale,J.displacementBias=ne.displacementBias,J.wireframeLinewidth=ne.wireframeLinewidth,J.linewidth=ne.linewidth,xe.isPointLight===!0&&J.isMeshDistanceMaterial===!0){const Be=t.properties.get(J);Be.light=xe}return J}function Y(Z,ne,xe,ie,J){if(Z.visible===!1)return;if(Z.layers.test(ne.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&J===Jo)&&(!Z.frustumCulled||r.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,Z.matrixWorld);const Re=e.update(Z),We=Z.material;if(Array.isArray(We)){const ct=Re.groups;for(let gt=0,ft=ct.length;gt<ft;gt++){const ke=ct[gt],at=We[ke.materialIndex];if(at&&at.visible){const ot=V(Z,at,ie,J);Z.onBeforeShadow(t,Z,ne,xe,Re,ot,ke),t.renderBufferDirect(xe,null,Re,ot,Z,ke),Z.onAfterShadow(t,Z,ne,xe,Re,ot,ke)}}}else if(We.visible){const ct=V(Z,We,ie,J);Z.onBeforeShadow(t,Z,ne,xe,Re,ct,null),t.renderBufferDirect(xe,null,Re,ct,Z,null),Z.onAfterShadow(t,Z,ne,xe,Re,ct,null)}}const Be=Z.children;for(let Re=0,We=Be.length;Re<We;Re++)Y(Be[Re],ne,xe,ie,J)}function he(Z){Z.target.removeEventListener("dispose",he);for(const xe in _){const ie=_[xe],J=Z.target.uuid;J in ie&&(ie[J].dispose(),delete ie[J])}}}function XB(t){function e(){let Q=!1;const ze=new Hi;let Qe=null;const bt=new Hi(0,0,0,0);return{setMask:function(ae){Qe!==ae&&!Q&&(t.colorMask(ae,ae,ae,ae),Qe=ae)},setLocked:function(ae){Q=ae},setClear:function(ae,F,O,q,te){te===!0&&(ae*=q,F*=q,O*=q),ze.set(ae,F,O,q),bt.equals(ze)===!1&&(t.clearColor(ae,F,O,q),bt.copy(ze))},reset:function(){Q=!1,Qe=null,bt.set(-1,0,0,0)}}}function n(){let Q=!1,ze=null,Qe=null,bt=null;return{setTest:function(ae){ae?Ft(t.DEPTH_TEST):At(t.DEPTH_TEST)},setMask:function(ae){ze!==ae&&!Q&&(t.depthMask(ae),ze=ae)},setFunc:function(ae){if(Qe!==ae){switch(ae){case YD:t.depthFunc(t.NEVER);break;case KD:t.depthFunc(t.ALWAYS);break;case JD:t.depthFunc(t.LESS);break;case N1:t.depthFunc(t.LEQUAL);break;case QD:t.depthFunc(t.EQUAL);break;case ek:t.depthFunc(t.GEQUAL);break;case tk:t.depthFunc(t.GREATER);break;case nk:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}Qe=ae}},setLocked:function(ae){Q=ae},setClear:function(ae){bt!==ae&&(t.clearDepth(ae),bt=ae)},reset:function(){Q=!1,ze=null,Qe=null,bt=null}}}function r(){let Q=!1,ze=null,Qe=null,bt=null,ae=null,F=null,O=null,q=null,te=null;return{setTest:function(pe){Q||(pe?Ft(t.STENCIL_TEST):At(t.STENCIL_TEST))},setMask:function(pe){ze!==pe&&!Q&&(t.stencilMask(pe),ze=pe)},setFunc:function(pe,we,Se){(Qe!==pe||bt!==we||ae!==Se)&&(t.stencilFunc(pe,we,Se),Qe=pe,bt=we,ae=Se)},setOp:function(pe,we,Se){(F!==pe||O!==we||q!==Se)&&(t.stencilOp(pe,we,Se),F=pe,O=we,q=Se)},setLocked:function(pe){Q=pe},setClear:function(pe){te!==pe&&(t.clearStencil(pe),te=pe)},reset:function(){Q=!1,ze=null,Qe=null,bt=null,ae=null,F=null,O=null,q=null,te=null}}}const s=new e,c=new n,h=new r,l=new WeakMap,m=new WeakMap;let _={},S={},T=new WeakMap,M=[],I=null,N=!1,B=null,k=null,C=null,U=null,V=null,Y=null,he=null,Z=new Sr(0,0,0),ne=0,xe=!1,ie=null,J=null,Te=null,Be=null,Re=null;const We=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ct=!1,gt=0;const ft=t.getParameter(t.VERSION);ft.indexOf("WebGL")!==-1?(gt=parseFloat(/^WebGL (\d)/.exec(ft)[1]),ct=gt>=1):ft.indexOf("OpenGL ES")!==-1&&(gt=parseFloat(/^OpenGL ES (\d)/.exec(ft)[1]),ct=gt>=2);let ke=null,at={};const ot=t.getParameter(t.SCISSOR_BOX),_t=t.getParameter(t.VIEWPORT),kt=new Hi().fromArray(ot),Cn=new Hi().fromArray(_t);function it(Q,ze,Qe,bt){const ae=new Uint8Array(4),F=t.createTexture();t.bindTexture(Q,F),t.texParameteri(Q,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(Q,t.TEXTURE_MAG_FILTER,t.NEAREST);for(let O=0;O<Qe;O++)Q===t.TEXTURE_3D||Q===t.TEXTURE_2D_ARRAY?t.texImage3D(ze,0,t.RGBA,1,1,bt,0,t.RGBA,t.UNSIGNED_BYTE,ae):t.texImage2D(ze+O,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,ae);return F}const Mt={};Mt[t.TEXTURE_2D]=it(t.TEXTURE_2D,t.TEXTURE_2D,1),Mt[t.TEXTURE_CUBE_MAP]=it(t.TEXTURE_CUBE_MAP,t.TEXTURE_CUBE_MAP_POSITIVE_X,6),Mt[t.TEXTURE_2D_ARRAY]=it(t.TEXTURE_2D_ARRAY,t.TEXTURE_2D_ARRAY,1,1),Mt[t.TEXTURE_3D]=it(t.TEXTURE_3D,t.TEXTURE_3D,1,1),s.setClear(0,0,0,1),c.setClear(1),h.setClear(0),Ft(t.DEPTH_TEST),c.setFunc(N1),un(!1),Pn(PS),Ft(t.CULL_FACE),Gn(bc);function Ft(Q){_[Q]!==!0&&(t.enable(Q),_[Q]=!0)}function At(Q){_[Q]!==!1&&(t.disable(Q),_[Q]=!1)}function Sn(Q,ze){return S[Q]!==ze?(t.bindFramebuffer(Q,ze),S[Q]=ze,Q===t.DRAW_FRAMEBUFFER&&(S[t.FRAMEBUFFER]=ze),Q===t.FRAMEBUFFER&&(S[t.DRAW_FRAMEBUFFER]=ze),!0):!1}function Dn(Q,ze){let Qe=M,bt=!1;if(Q){Qe=T.get(ze),Qe===void 0&&(Qe=[],T.set(ze,Qe));const ae=Q.textures;if(Qe.length!==ae.length||Qe[0]!==t.COLOR_ATTACHMENT0){for(let F=0,O=ae.length;F<O;F++)Qe[F]=t.COLOR_ATTACHMENT0+F;Qe.length=ae.length,bt=!0}}else Qe[0]!==t.BACK&&(Qe[0]=t.BACK,bt=!0);bt&&t.drawBuffers(Qe)}function qe(Q){return I!==Q?(t.useProgram(Q),I=Q,!0):!1}const Nn={[_u]:t.FUNC_ADD,[kD]:t.FUNC_SUBTRACT,[LD]:t.FUNC_REVERSE_SUBTRACT};Nn[zD]=t.MIN,Nn[FD]=t.MAX;const hn={[ND]:t.ZERO,[BD]:t.ONE,[OD]:t.SRC_COLOR,[d2]:t.SRC_ALPHA,[WD]:t.SRC_ALPHA_SATURATE,[GD]:t.DST_COLOR,[VD]:t.DST_ALPHA,[UD]:t.ONE_MINUS_SRC_COLOR,[f2]:t.ONE_MINUS_SRC_ALPHA,[jD]:t.ONE_MINUS_DST_COLOR,[HD]:t.ONE_MINUS_DST_ALPHA,[qD]:t.CONSTANT_COLOR,[$D]:t.ONE_MINUS_CONSTANT_COLOR,[XD]:t.CONSTANT_ALPHA,[ZD]:t.ONE_MINUS_CONSTANT_ALPHA};function Gn(Q,ze,Qe,bt,ae,F,O,q,te,pe){if(Q===bc){N===!0&&(At(t.BLEND),N=!1);return}if(N===!1&&(Ft(t.BLEND),N=!0),Q!==DD){if(Q!==B||pe!==xe){if((k!==_u||V!==_u)&&(t.blendEquation(t.FUNC_ADD),k=_u,V=_u),pe)switch(Q){case Sd:t.blendFuncSeparate(t.ONE,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case RS:t.blendFunc(t.ONE,t.ONE);break;case IS:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case DS:t.blendFuncSeparate(t.ZERO,t.SRC_COLOR,t.ZERO,t.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}else switch(Q){case Sd:t.blendFuncSeparate(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA);break;case RS:t.blendFunc(t.SRC_ALPHA,t.ONE);break;case IS:t.blendFuncSeparate(t.ZERO,t.ONE_MINUS_SRC_COLOR,t.ZERO,t.ONE);break;case DS:t.blendFunc(t.ZERO,t.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",Q);break}C=null,U=null,Y=null,he=null,Z.set(0,0,0),ne=0,B=Q,xe=pe}return}ae=ae||ze,F=F||Qe,O=O||bt,(ze!==k||ae!==V)&&(t.blendEquationSeparate(Nn[ze],Nn[ae]),k=ze,V=ae),(Qe!==C||bt!==U||F!==Y||O!==he)&&(t.blendFuncSeparate(hn[Qe],hn[bt],hn[F],hn[O]),C=Qe,U=bt,Y=F,he=O),(q.equals(Z)===!1||te!==ne)&&(t.blendColor(q.r,q.g,q.b,te),Z.copy(q),ne=te),B=Q,xe=!1}function gn(Q,ze){Q.side===fo?At(t.CULL_FACE):Ft(t.CULL_FACE);let Qe=Q.side===za;ze&&(Qe=!Qe),un(Qe),Q.blending===Sd&&Q.transparent===!1?Gn(bc):Gn(Q.blending,Q.blendEquation,Q.blendSrc,Q.blendDst,Q.blendEquationAlpha,Q.blendSrcAlpha,Q.blendDstAlpha,Q.blendColor,Q.blendAlpha,Q.premultipliedAlpha),c.setFunc(Q.depthFunc),c.setTest(Q.depthTest),c.setMask(Q.depthWrite),s.setMask(Q.colorWrite);const bt=Q.stencilWrite;h.setTest(bt),bt&&(h.setMask(Q.stencilWriteMask),h.setFunc(Q.stencilFunc,Q.stencilRef,Q.stencilFuncMask),h.setOp(Q.stencilFail,Q.stencilZFail,Q.stencilZPass)),qn(Q.polygonOffset,Q.polygonOffsetFactor,Q.polygonOffsetUnits),Q.alphaToCoverage===!0?Ft(t.SAMPLE_ALPHA_TO_COVERAGE):At(t.SAMPLE_ALPHA_TO_COVERAGE)}function un(Q){ie!==Q&&(Q?t.frontFace(t.CW):t.frontFace(t.CCW),ie=Q)}function Pn(Q){Q!==PD?(Ft(t.CULL_FACE),Q!==J&&(Q===PS?t.cullFace(t.BACK):Q===RD?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):At(t.CULL_FACE),J=Q}function je(Q){Q!==Te&&(ct&&t.lineWidth(Q),Te=Q)}function qn(Q,ze,Qe){Q?(Ft(t.POLYGON_OFFSET_FILL),(Be!==ze||Re!==Qe)&&(t.polygonOffset(ze,Qe),Be=ze,Re=Qe)):At(t.POLYGON_OFFSET_FILL)}function Ae(Q){Q?Ft(t.SCISSOR_TEST):At(t.SCISSOR_TEST)}function se(Q){Q===void 0&&(Q=t.TEXTURE0+We-1),ke!==Q&&(t.activeTexture(Q),ke=Q)}function tt(Q,ze,Qe){Qe===void 0&&(ke===null?Qe=t.TEXTURE0+We-1:Qe=ke);let bt=at[Qe];bt===void 0&&(bt={type:void 0,texture:void 0},at[Qe]=bt),(bt.type!==Q||bt.texture!==ze)&&(ke!==Qe&&(t.activeTexture(Qe),ke=Qe),t.bindTexture(Q,ze||Mt[Q]),bt.type=Q,bt.texture=ze)}function vt(){const Q=at[ke];Q!==void 0&&Q.type!==void 0&&(t.bindTexture(Q.type,null),Q.type=void 0,Q.texture=void 0)}function Tt(){try{t.compressedTexImage2D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function wt(){try{t.compressedTexImage3D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function pn(){try{t.texSubImage2D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Gt(){try{t.texSubImage3D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ht(){try{t.compressedTexSubImage2D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Ln(){try{t.compressedTexSubImage3D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function He(){try{t.texStorage2D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function on(){try{t.texStorage3D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Rn(){try{t.texImage2D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function xn(){try{t.texImage3D.apply(t,arguments)}catch(Q){console.error("THREE.WebGLState:",Q)}}function Qt(Q){kt.equals(Q)===!1&&(t.scissor(Q.x,Q.y,Q.z,Q.w),kt.copy(Q))}function lt(Q){Cn.equals(Q)===!1&&(t.viewport(Q.x,Q.y,Q.z,Q.w),Cn.copy(Q))}function Ut(Q,ze){let Qe=m.get(ze);Qe===void 0&&(Qe=new WeakMap,m.set(ze,Qe));let bt=Qe.get(Q);bt===void 0&&(bt=t.getUniformBlockIndex(ze,Q.name),Qe.set(Q,bt))}function Zt(Q,ze){const bt=m.get(ze).get(Q);l.get(ze)!==bt&&(t.uniformBlockBinding(ze,bt,Q.__bindingPointIndex),l.set(ze,bt))}function yn(){t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.POLYGON_OFFSET_FILL),t.disable(t.SCISSOR_TEST),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.blendColor(0,0,0,0),t.colorMask(!0,!0,!0,!0),t.clearColor(0,0,0,0),t.depthMask(!0),t.depthFunc(t.LESS),t.clearDepth(1),t.stencilMask(4294967295),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.clearStencil(0),t.cullFace(t.BACK),t.frontFace(t.CCW),t.polygonOffset(0,0),t.activeTexture(t.TEXTURE0),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.useProgram(null),t.lineWidth(1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.viewport(0,0,t.canvas.width,t.canvas.height),_={},ke=null,at={},S={},T=new WeakMap,M=[],I=null,N=!1,B=null,k=null,C=null,U=null,V=null,Y=null,he=null,Z=new Sr(0,0,0),ne=0,xe=!1,ie=null,J=null,Te=null,Be=null,Re=null,kt.set(0,0,t.canvas.width,t.canvas.height),Cn.set(0,0,t.canvas.width,t.canvas.height),s.reset(),c.reset(),h.reset()}return{buffers:{color:s,depth:c,stencil:h},enable:Ft,disable:At,bindFramebuffer:Sn,drawBuffers:Dn,useProgram:qe,setBlending:Gn,setMaterial:gn,setFlipSided:un,setCullFace:Pn,setLineWidth:je,setPolygonOffset:qn,setScissorTest:Ae,activeTexture:se,bindTexture:tt,unbindTexture:vt,compressedTexImage2D:Tt,compressedTexImage3D:wt,texImage2D:Rn,texImage3D:xn,updateUBOMapping:Ut,uniformBlockBinding:Zt,texStorage2D:He,texStorage3D:on,texSubImage2D:pn,texSubImage3D:Gt,compressedTexSubImage2D:Ht,compressedTexSubImage3D:Ln,scissor:Qt,viewport:lt,reset:yn}}function ZB(t,e,n,r,s,c,h){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,m=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),_=new Yn,S=new WeakMap;let T;const M=new WeakMap;let I=!1;try{I=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function N(Ae,se){return I?new OffscreenCanvas(Ae,se):_p("canvas")}function B(Ae,se,tt){let vt=1;const Tt=qn(Ae);if((Tt.width>tt||Tt.height>tt)&&(vt=tt/Math.max(Tt.width,Tt.height)),vt<1)if(typeof HTMLImageElement<"u"&&Ae instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ae instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ae instanceof ImageBitmap||typeof VideoFrame<"u"&&Ae instanceof VideoFrame){const wt=Math.floor(vt*Tt.width),pn=Math.floor(vt*Tt.height);T===void 0&&(T=N(wt,pn));const Gt=se?N(wt,pn):T;return Gt.width=wt,Gt.height=pn,Gt.getContext("2d").drawImage(Ae,0,0,wt,pn),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Tt.width+"x"+Tt.height+") to ("+wt+"x"+pn+")."),Gt}else return"data"in Ae&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Tt.width+"x"+Tt.height+")."),Ae;return Ae}function k(Ae){return Ae.generateMipmaps&&Ae.minFilter!==xs&&Ae.minFilter!==$s}function C(Ae){t.generateMipmap(Ae)}function U(Ae,se,tt,vt,Tt=!1){if(Ae!==null){if(t[Ae]!==void 0)return t[Ae];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ae+"'")}let wt=se;if(se===t.RED&&(tt===t.FLOAT&&(wt=t.R32F),tt===t.HALF_FLOAT&&(wt=t.R16F),tt===t.UNSIGNED_BYTE&&(wt=t.R8)),se===t.RED_INTEGER&&(tt===t.UNSIGNED_BYTE&&(wt=t.R8UI),tt===t.UNSIGNED_SHORT&&(wt=t.R16UI),tt===t.UNSIGNED_INT&&(wt=t.R32UI),tt===t.BYTE&&(wt=t.R8I),tt===t.SHORT&&(wt=t.R16I),tt===t.INT&&(wt=t.R32I)),se===t.RG&&(tt===t.FLOAT&&(wt=t.RG32F),tt===t.HALF_FLOAT&&(wt=t.RG16F),tt===t.UNSIGNED_BYTE&&(wt=t.RG8)),se===t.RG_INTEGER&&(tt===t.UNSIGNED_BYTE&&(wt=t.RG8UI),tt===t.UNSIGNED_SHORT&&(wt=t.RG16UI),tt===t.UNSIGNED_INT&&(wt=t.RG32UI),tt===t.BYTE&&(wt=t.RG8I),tt===t.SHORT&&(wt=t.RG16I),tt===t.INT&&(wt=t.RG32I)),se===t.RGB&&tt===t.UNSIGNED_INT_5_9_9_9_REV&&(wt=t.RGB9_E5),se===t.RGBA){const pn=Tt?B1:wr.getTransfer(vt);tt===t.FLOAT&&(wt=t.RGBA32F),tt===t.HALF_FLOAT&&(wt=t.RGBA16F),tt===t.UNSIGNED_BYTE&&(wt=pn===zr?t.SRGB8_ALPHA8:t.RGBA8),tt===t.UNSIGNED_SHORT_4_4_4_4&&(wt=t.RGBA4),tt===t.UNSIGNED_SHORT_5_5_5_1&&(wt=t.RGB5_A1)}return(wt===t.R16F||wt===t.R32F||wt===t.RG16F||wt===t.RG32F||wt===t.RGBA16F||wt===t.RGBA32F)&&e.get("EXT_color_buffer_float"),wt}function V(Ae,se){return k(Ae)===!0||Ae.isFramebufferTexture&&Ae.minFilter!==xs&&Ae.minFilter!==$s?Math.log2(Math.max(se.width,se.height))+1:Ae.mipmaps!==void 0&&Ae.mipmaps.length>0?Ae.mipmaps.length:Ae.isCompressedTexture&&Array.isArray(Ae.image)?se.mipmaps.length:1}function Y(Ae){const se=Ae.target;se.removeEventListener("dispose",Y),Z(se),se.isVideoTexture&&S.delete(se)}function he(Ae){const se=Ae.target;se.removeEventListener("dispose",he),xe(se)}function Z(Ae){const se=r.get(Ae);if(se.__webglInit===void 0)return;const tt=Ae.source,vt=M.get(tt);if(vt){const Tt=vt[se.__cacheKey];Tt.usedTimes--,Tt.usedTimes===0&&ne(Ae),Object.keys(vt).length===0&&M.delete(tt)}r.remove(Ae)}function ne(Ae){const se=r.get(Ae);t.deleteTexture(se.__webglTexture);const tt=Ae.source,vt=M.get(tt);delete vt[se.__cacheKey],h.memory.textures--}function xe(Ae){const se=r.get(Ae);if(Ae.depthTexture&&Ae.depthTexture.dispose(),Ae.isWebGLCubeRenderTarget)for(let vt=0;vt<6;vt++){if(Array.isArray(se.__webglFramebuffer[vt]))for(let Tt=0;Tt<se.__webglFramebuffer[vt].length;Tt++)t.deleteFramebuffer(se.__webglFramebuffer[vt][Tt]);else t.deleteFramebuffer(se.__webglFramebuffer[vt]);se.__webglDepthbuffer&&t.deleteRenderbuffer(se.__webglDepthbuffer[vt])}else{if(Array.isArray(se.__webglFramebuffer))for(let vt=0;vt<se.__webglFramebuffer.length;vt++)t.deleteFramebuffer(se.__webglFramebuffer[vt]);else t.deleteFramebuffer(se.__webglFramebuffer);if(se.__webglDepthbuffer&&t.deleteRenderbuffer(se.__webglDepthbuffer),se.__webglMultisampledFramebuffer&&t.deleteFramebuffer(se.__webglMultisampledFramebuffer),se.__webglColorRenderbuffer)for(let vt=0;vt<se.__webglColorRenderbuffer.length;vt++)se.__webglColorRenderbuffer[vt]&&t.deleteRenderbuffer(se.__webglColorRenderbuffer[vt]);se.__webglDepthRenderbuffer&&t.deleteRenderbuffer(se.__webglDepthRenderbuffer)}const tt=Ae.textures;for(let vt=0,Tt=tt.length;vt<Tt;vt++){const wt=r.get(tt[vt]);wt.__webglTexture&&(t.deleteTexture(wt.__webglTexture),h.memory.textures--),r.remove(tt[vt])}r.remove(Ae)}let ie=0;function J(){ie=0}function Te(){const Ae=ie;return Ae>=s.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+Ae+" texture units while this GPU supports only "+s.maxTextures),ie+=1,Ae}function Be(Ae){const se=[];return se.push(Ae.wrapS),se.push(Ae.wrapT),se.push(Ae.wrapR||0),se.push(Ae.magFilter),se.push(Ae.minFilter),se.push(Ae.anisotropy),se.push(Ae.internalFormat),se.push(Ae.format),se.push(Ae.type),se.push(Ae.generateMipmaps),se.push(Ae.premultiplyAlpha),se.push(Ae.flipY),se.push(Ae.unpackAlignment),se.push(Ae.colorSpace),se.join()}function Re(Ae,se){const tt=r.get(Ae);if(Ae.isVideoTexture&&Pn(Ae),Ae.isRenderTargetTexture===!1&&Ae.version>0&&tt.__version!==Ae.version){const vt=Ae.image;if(vt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(vt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{kt(tt,Ae,se);return}}n.bindTexture(t.TEXTURE_2D,tt.__webglTexture,t.TEXTURE0+se)}function We(Ae,se){const tt=r.get(Ae);if(Ae.version>0&&tt.__version!==Ae.version){kt(tt,Ae,se);return}n.bindTexture(t.TEXTURE_2D_ARRAY,tt.__webglTexture,t.TEXTURE0+se)}function ct(Ae,se){const tt=r.get(Ae);if(Ae.version>0&&tt.__version!==Ae.version){kt(tt,Ae,se);return}n.bindTexture(t.TEXTURE_3D,tt.__webglTexture,t.TEXTURE0+se)}function gt(Ae,se){const tt=r.get(Ae);if(Ae.version>0&&tt.__version!==Ae.version){Cn(tt,Ae,se);return}n.bindTexture(t.TEXTURE_CUBE_MAP,tt.__webglTexture,t.TEXTURE0+se)}const ft={[Eu]:t.REPEAT,[Au]:t.CLAMP_TO_EDGE,[g2]:t.MIRRORED_REPEAT},ke={[xs]:t.NEAREST,[dk]:t.NEAREST_MIPMAP_NEAREST,[ug]:t.NEAREST_MIPMAP_LINEAR,[$s]:t.LINEAR,[y_]:t.LINEAR_MIPMAP_NEAREST,[Cu]:t.LINEAR_MIPMAP_LINEAR},at={[Ak]:t.NEVER,[kk]:t.ALWAYS,[Ck]:t.LESS,[KE]:t.LEQUAL,[Pk]:t.EQUAL,[Dk]:t.GEQUAL,[Rk]:t.GREATER,[Ik]:t.NOTEQUAL};function ot(Ae,se){if(se.type===hc&&e.has("OES_texture_float_linear")===!1&&(se.magFilter===$s||se.magFilter===y_||se.magFilter===ug||se.magFilter===Cu||se.minFilter===$s||se.minFilter===y_||se.minFilter===ug||se.minFilter===Cu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),t.texParameteri(Ae,t.TEXTURE_WRAP_S,ft[se.wrapS]),t.texParameteri(Ae,t.TEXTURE_WRAP_T,ft[se.wrapT]),(Ae===t.TEXTURE_3D||Ae===t.TEXTURE_2D_ARRAY)&&t.texParameteri(Ae,t.TEXTURE_WRAP_R,ft[se.wrapR]),t.texParameteri(Ae,t.TEXTURE_MAG_FILTER,ke[se.magFilter]),t.texParameteri(Ae,t.TEXTURE_MIN_FILTER,ke[se.minFilter]),se.compareFunction&&(t.texParameteri(Ae,t.TEXTURE_COMPARE_MODE,t.COMPARE_REF_TO_TEXTURE),t.texParameteri(Ae,t.TEXTURE_COMPARE_FUNC,at[se.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(se.magFilter===xs||se.minFilter!==ug&&se.minFilter!==Cu||se.type===hc&&e.has("OES_texture_float_linear")===!1)return;if(se.anisotropy>1||r.get(se).__currentAnisotropy){const tt=e.get("EXT_texture_filter_anisotropic");t.texParameterf(Ae,tt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(se.anisotropy,s.getMaxAnisotropy())),r.get(se).__currentAnisotropy=se.anisotropy}}}function _t(Ae,se){let tt=!1;Ae.__webglInit===void 0&&(Ae.__webglInit=!0,se.addEventListener("dispose",Y));const vt=se.source;let Tt=M.get(vt);Tt===void 0&&(Tt={},M.set(vt,Tt));const wt=Be(se);if(wt!==Ae.__cacheKey){Tt[wt]===void 0&&(Tt[wt]={texture:t.createTexture(),usedTimes:0},h.memory.textures++,tt=!0),Tt[wt].usedTimes++;const pn=Tt[Ae.__cacheKey];pn!==void 0&&(Tt[Ae.__cacheKey].usedTimes--,pn.usedTimes===0&&ne(se)),Ae.__cacheKey=wt,Ae.__webglTexture=Tt[wt].texture}return tt}function kt(Ae,se,tt){let vt=t.TEXTURE_2D;(se.isDataArrayTexture||se.isCompressedArrayTexture)&&(vt=t.TEXTURE_2D_ARRAY),se.isData3DTexture&&(vt=t.TEXTURE_3D);const Tt=_t(Ae,se),wt=se.source;n.bindTexture(vt,Ae.__webglTexture,t.TEXTURE0+tt);const pn=r.get(wt);if(wt.version!==pn.__version||Tt===!0){n.activeTexture(t.TEXTURE0+tt);const Gt=wr.getPrimaries(wr.workingColorSpace),Ht=se.colorSpace===lc?null:wr.getPrimaries(se.colorSpace),Ln=se.colorSpace===lc||Gt===Ht?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,se.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,se.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ln);let He=B(se.image,!1,s.maxTextureSize);He=je(se,He);const on=c.convert(se.format,se.colorSpace),Rn=c.convert(se.type);let xn=U(se.internalFormat,on,Rn,se.colorSpace,se.isVideoTexture);ot(vt,se);let Qt;const lt=se.mipmaps,Ut=se.isVideoTexture!==!0,Zt=pn.__version===void 0||Tt===!0,yn=wt.dataReady,Q=V(se,He);if(se.isDepthTexture)xn=t.DEPTH_COMPONENT16,se.type===hc?xn=t.DEPTH_COMPONENT32F:se.type===Bd?xn=t.DEPTH_COMPONENT24:se.type===Lp&&(xn=t.DEPTH24_STENCIL8),Zt&&(Ut?n.texStorage2D(t.TEXTURE_2D,1,xn,He.width,He.height):n.texImage2D(t.TEXTURE_2D,0,xn,He.width,He.height,0,on,Rn,null));else if(se.isDataTexture)if(lt.length>0){Ut&&Zt&&n.texStorage2D(t.TEXTURE_2D,Q,xn,lt[0].width,lt[0].height);for(let ze=0,Qe=lt.length;ze<Qe;ze++)Qt=lt[ze],Ut?yn&&n.texSubImage2D(t.TEXTURE_2D,ze,0,0,Qt.width,Qt.height,on,Rn,Qt.data):n.texImage2D(t.TEXTURE_2D,ze,xn,Qt.width,Qt.height,0,on,Rn,Qt.data);se.generateMipmaps=!1}else Ut?(Zt&&n.texStorage2D(t.TEXTURE_2D,Q,xn,He.width,He.height),yn&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,He.width,He.height,on,Rn,He.data)):n.texImage2D(t.TEXTURE_2D,0,xn,He.width,He.height,0,on,Rn,He.data);else if(se.isCompressedTexture)if(se.isCompressedArrayTexture){Ut&&Zt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Q,xn,lt[0].width,lt[0].height,He.depth);for(let ze=0,Qe=lt.length;ze<Qe;ze++)Qt=lt[ze],se.format!==go?on!==null?Ut?yn&&n.compressedTexSubImage3D(t.TEXTURE_2D_ARRAY,ze,0,0,0,Qt.width,Qt.height,He.depth,on,Qt.data,0,0):n.compressedTexImage3D(t.TEXTURE_2D_ARRAY,ze,xn,Qt.width,Qt.height,He.depth,0,Qt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?yn&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,ze,0,0,0,Qt.width,Qt.height,He.depth,on,Rn,Qt.data):n.texImage3D(t.TEXTURE_2D_ARRAY,ze,xn,Qt.width,Qt.height,He.depth,0,on,Rn,Qt.data)}else{Ut&&Zt&&n.texStorage2D(t.TEXTURE_2D,Q,xn,lt[0].width,lt[0].height);for(let ze=0,Qe=lt.length;ze<Qe;ze++)Qt=lt[ze],se.format!==go?on!==null?Ut?yn&&n.compressedTexSubImage2D(t.TEXTURE_2D,ze,0,0,Qt.width,Qt.height,on,Qt.data):n.compressedTexImage2D(t.TEXTURE_2D,ze,xn,Qt.width,Qt.height,0,Qt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Ut?yn&&n.texSubImage2D(t.TEXTURE_2D,ze,0,0,Qt.width,Qt.height,on,Rn,Qt.data):n.texImage2D(t.TEXTURE_2D,ze,xn,Qt.width,Qt.height,0,on,Rn,Qt.data)}else if(se.isDataArrayTexture)Ut?(Zt&&n.texStorage3D(t.TEXTURE_2D_ARRAY,Q,xn,He.width,He.height,He.depth),yn&&n.texSubImage3D(t.TEXTURE_2D_ARRAY,0,0,0,0,He.width,He.height,He.depth,on,Rn,He.data)):n.texImage3D(t.TEXTURE_2D_ARRAY,0,xn,He.width,He.height,He.depth,0,on,Rn,He.data);else if(se.isData3DTexture)Ut?(Zt&&n.texStorage3D(t.TEXTURE_3D,Q,xn,He.width,He.height,He.depth),yn&&n.texSubImage3D(t.TEXTURE_3D,0,0,0,0,He.width,He.height,He.depth,on,Rn,He.data)):n.texImage3D(t.TEXTURE_3D,0,xn,He.width,He.height,He.depth,0,on,Rn,He.data);else if(se.isFramebufferTexture){if(Zt)if(Ut)n.texStorage2D(t.TEXTURE_2D,Q,xn,He.width,He.height);else{let ze=He.width,Qe=He.height;for(let bt=0;bt<Q;bt++)n.texImage2D(t.TEXTURE_2D,bt,xn,ze,Qe,0,on,Rn,null),ze>>=1,Qe>>=1}}else if(lt.length>0){if(Ut&&Zt){const ze=qn(lt[0]);n.texStorage2D(t.TEXTURE_2D,Q,xn,ze.width,ze.height)}for(let ze=0,Qe=lt.length;ze<Qe;ze++)Qt=lt[ze],Ut?yn&&n.texSubImage2D(t.TEXTURE_2D,ze,0,0,on,Rn,Qt):n.texImage2D(t.TEXTURE_2D,ze,xn,on,Rn,Qt);se.generateMipmaps=!1}else if(Ut){if(Zt){const ze=qn(He);n.texStorage2D(t.TEXTURE_2D,Q,xn,ze.width,ze.height)}yn&&n.texSubImage2D(t.TEXTURE_2D,0,0,0,on,Rn,He)}else n.texImage2D(t.TEXTURE_2D,0,xn,on,Rn,He);k(se)&&C(vt),pn.__version=wt.version,se.onUpdate&&se.onUpdate(se)}Ae.__version=se.version}function Cn(Ae,se,tt){if(se.image.length!==6)return;const vt=_t(Ae,se),Tt=se.source;n.bindTexture(t.TEXTURE_CUBE_MAP,Ae.__webglTexture,t.TEXTURE0+tt);const wt=r.get(Tt);if(Tt.version!==wt.__version||vt===!0){n.activeTexture(t.TEXTURE0+tt);const pn=wr.getPrimaries(wr.workingColorSpace),Gt=se.colorSpace===lc?null:wr.getPrimaries(se.colorSpace),Ht=se.colorSpace===lc||pn===Gt?t.NONE:t.BROWSER_DEFAULT_WEBGL;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,se.flipY),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,se.premultiplyAlpha),t.pixelStorei(t.UNPACK_ALIGNMENT,se.unpackAlignment),t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,Ht);const Ln=se.isCompressedTexture||se.image[0].isCompressedTexture,He=se.image[0]&&se.image[0].isDataTexture,on=[];for(let Qe=0;Qe<6;Qe++)!Ln&&!He?on[Qe]=B(se.image[Qe],!0,s.maxCubemapSize):on[Qe]=He?se.image[Qe].image:se.image[Qe],on[Qe]=je(se,on[Qe]);const Rn=on[0],xn=c.convert(se.format,se.colorSpace),Qt=c.convert(se.type),lt=U(se.internalFormat,xn,Qt,se.colorSpace),Ut=se.isVideoTexture!==!0,Zt=wt.__version===void 0||vt===!0,yn=Tt.dataReady;let Q=V(se,Rn);ot(t.TEXTURE_CUBE_MAP,se);let ze;if(Ln){Ut&&Zt&&n.texStorage2D(t.TEXTURE_CUBE_MAP,Q,lt,Rn.width,Rn.height);for(let Qe=0;Qe<6;Qe++){ze=on[Qe].mipmaps;for(let bt=0;bt<ze.length;bt++){const ae=ze[bt];se.format!==go?xn!==null?Ut?yn&&n.compressedTexSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt,0,0,ae.width,ae.height,xn,ae.data):n.compressedTexImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt,lt,ae.width,ae.height,0,ae.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Ut?yn&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt,0,0,ae.width,ae.height,xn,Qt,ae.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt,lt,ae.width,ae.height,0,xn,Qt,ae.data)}}}else{if(ze=se.mipmaps,Ut&&Zt){ze.length>0&&Q++;const Qe=qn(on[0]);n.texStorage2D(t.TEXTURE_CUBE_MAP,Q,lt,Qe.width,Qe.height)}for(let Qe=0;Qe<6;Qe++)if(He){Ut?yn&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,on[Qe].width,on[Qe].height,xn,Qt,on[Qe].data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,lt,on[Qe].width,on[Qe].height,0,xn,Qt,on[Qe].data);for(let bt=0;bt<ze.length;bt++){const F=ze[bt].image[Qe].image;Ut?yn&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt+1,0,0,F.width,F.height,xn,Qt,F.data):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt+1,lt,F.width,F.height,0,xn,Qt,F.data)}}else{Ut?yn&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,0,0,xn,Qt,on[Qe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,0,lt,xn,Qt,on[Qe]);for(let bt=0;bt<ze.length;bt++){const ae=ze[bt];Ut?yn&&n.texSubImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt+1,0,0,xn,Qt,ae.image[Qe]):n.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+Qe,bt+1,lt,xn,Qt,ae.image[Qe])}}}k(se)&&C(t.TEXTURE_CUBE_MAP),wt.__version=Tt.version,se.onUpdate&&se.onUpdate(se)}Ae.__version=se.version}function it(Ae,se,tt,vt,Tt,wt){const pn=c.convert(tt.format,tt.colorSpace),Gt=c.convert(tt.type),Ht=U(tt.internalFormat,pn,Gt,tt.colorSpace);if(!r.get(se).__hasExternalTextures){const He=Math.max(1,se.width>>wt),on=Math.max(1,se.height>>wt);Tt===t.TEXTURE_3D||Tt===t.TEXTURE_2D_ARRAY?n.texImage3D(Tt,wt,Ht,He,on,se.depth,0,pn,Gt,null):n.texImage2D(Tt,wt,Ht,He,on,0,pn,Gt,null)}n.bindFramebuffer(t.FRAMEBUFFER,Ae),un(se)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,vt,Tt,r.get(tt).__webglTexture,0,gn(se)):(Tt===t.TEXTURE_2D||Tt>=t.TEXTURE_CUBE_MAP_POSITIVE_X&&Tt<=t.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&t.framebufferTexture2D(t.FRAMEBUFFER,vt,Tt,r.get(tt).__webglTexture,wt),n.bindFramebuffer(t.FRAMEBUFFER,null)}function Mt(Ae,se,tt){if(t.bindRenderbuffer(t.RENDERBUFFER,Ae),se.depthBuffer&&!se.stencilBuffer){let vt=t.DEPTH_COMPONENT24;if(tt||un(se)){const Tt=se.depthTexture;Tt&&Tt.isDepthTexture&&(Tt.type===hc?vt=t.DEPTH_COMPONENT32F:Tt.type===Bd&&(vt=t.DEPTH_COMPONENT24));const wt=gn(se);un(se)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,wt,vt,se.width,se.height):t.renderbufferStorageMultisample(t.RENDERBUFFER,wt,vt,se.width,se.height)}else t.renderbufferStorage(t.RENDERBUFFER,vt,se.width,se.height);t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,Ae)}else if(se.depthBuffer&&se.stencilBuffer){const vt=gn(se);tt&&un(se)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,vt,t.DEPTH24_STENCIL8,se.width,se.height):un(se)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,vt,t.DEPTH24_STENCIL8,se.width,se.height):t.renderbufferStorage(t.RENDERBUFFER,t.DEPTH_STENCIL,se.width,se.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.RENDERBUFFER,Ae)}else{const vt=se.textures;for(let Tt=0;Tt<vt.length;Tt++){const wt=vt[Tt],pn=c.convert(wt.format,wt.colorSpace),Gt=c.convert(wt.type),Ht=U(wt.internalFormat,pn,Gt,wt.colorSpace),Ln=gn(se);tt&&un(se)===!1?t.renderbufferStorageMultisample(t.RENDERBUFFER,Ln,Ht,se.width,se.height):un(se)?l.renderbufferStorageMultisampleEXT(t.RENDERBUFFER,Ln,Ht,se.width,se.height):t.renderbufferStorage(t.RENDERBUFFER,Ht,se.width,se.height)}}t.bindRenderbuffer(t.RENDERBUFFER,null)}function Ft(Ae,se){if(se&&se.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(t.FRAMEBUFFER,Ae),!(se.depthTexture&&se.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(se.depthTexture).__webglTexture||se.depthTexture.image.width!==se.width||se.depthTexture.image.height!==se.height)&&(se.depthTexture.image.width=se.width,se.depthTexture.image.height=se.height,se.depthTexture.needsUpdate=!0),Re(se.depthTexture,0);const vt=r.get(se.depthTexture).__webglTexture,Tt=gn(se);if(se.depthTexture.format===Md)un(se)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,vt,0,Tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.TEXTURE_2D,vt,0);else if(se.depthTexture.format===vp)un(se)?l.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,vt,0,Tt):t.framebufferTexture2D(t.FRAMEBUFFER,t.DEPTH_STENCIL_ATTACHMENT,t.TEXTURE_2D,vt,0);else throw new Error("Unknown depthTexture format")}function At(Ae){const se=r.get(Ae),tt=Ae.isWebGLCubeRenderTarget===!0;if(Ae.depthTexture&&!se.__autoAllocateDepthBuffer){if(tt)throw new Error("target.depthTexture not supported in Cube render targets");Ft(se.__webglFramebuffer,Ae)}else if(tt){se.__webglDepthbuffer=[];for(let vt=0;vt<6;vt++)n.bindFramebuffer(t.FRAMEBUFFER,se.__webglFramebuffer[vt]),se.__webglDepthbuffer[vt]=t.createRenderbuffer(),Mt(se.__webglDepthbuffer[vt],Ae,!1)}else n.bindFramebuffer(t.FRAMEBUFFER,se.__webglFramebuffer),se.__webglDepthbuffer=t.createRenderbuffer(),Mt(se.__webglDepthbuffer,Ae,!1);n.bindFramebuffer(t.FRAMEBUFFER,null)}function Sn(Ae,se,tt){const vt=r.get(Ae);se!==void 0&&it(vt.__webglFramebuffer,Ae,Ae.texture,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,0),tt!==void 0&&At(Ae)}function Dn(Ae){const se=Ae.texture,tt=r.get(Ae),vt=r.get(se);Ae.addEventListener("dispose",he);const Tt=Ae.textures,wt=Ae.isWebGLCubeRenderTarget===!0,pn=Tt.length>1;if(pn||(vt.__webglTexture===void 0&&(vt.__webglTexture=t.createTexture()),vt.__version=se.version,h.memory.textures++),wt){tt.__webglFramebuffer=[];for(let Gt=0;Gt<6;Gt++)if(se.mipmaps&&se.mipmaps.length>0){tt.__webglFramebuffer[Gt]=[];for(let Ht=0;Ht<se.mipmaps.length;Ht++)tt.__webglFramebuffer[Gt][Ht]=t.createFramebuffer()}else tt.__webglFramebuffer[Gt]=t.createFramebuffer()}else{if(se.mipmaps&&se.mipmaps.length>0){tt.__webglFramebuffer=[];for(let Gt=0;Gt<se.mipmaps.length;Gt++)tt.__webglFramebuffer[Gt]=t.createFramebuffer()}else tt.__webglFramebuffer=t.createFramebuffer();if(pn)for(let Gt=0,Ht=Tt.length;Gt<Ht;Gt++){const Ln=r.get(Tt[Gt]);Ln.__webglTexture===void 0&&(Ln.__webglTexture=t.createTexture(),h.memory.textures++)}if(Ae.samples>0&&un(Ae)===!1){tt.__webglMultisampledFramebuffer=t.createFramebuffer(),tt.__webglColorRenderbuffer=[],n.bindFramebuffer(t.FRAMEBUFFER,tt.__webglMultisampledFramebuffer);for(let Gt=0;Gt<Tt.length;Gt++){const Ht=Tt[Gt];tt.__webglColorRenderbuffer[Gt]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,tt.__webglColorRenderbuffer[Gt]);const Ln=c.convert(Ht.format,Ht.colorSpace),He=c.convert(Ht.type),on=U(Ht.internalFormat,Ln,He,Ht.colorSpace,Ae.isXRRenderTarget===!0),Rn=gn(Ae);t.renderbufferStorageMultisample(t.RENDERBUFFER,Rn,on,Ae.width,Ae.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Gt,t.RENDERBUFFER,tt.__webglColorRenderbuffer[Gt])}t.bindRenderbuffer(t.RENDERBUFFER,null),Ae.depthBuffer&&(tt.__webglDepthRenderbuffer=t.createRenderbuffer(),Mt(tt.__webglDepthRenderbuffer,Ae,!0)),n.bindFramebuffer(t.FRAMEBUFFER,null)}}if(wt){n.bindTexture(t.TEXTURE_CUBE_MAP,vt.__webglTexture),ot(t.TEXTURE_CUBE_MAP,se);for(let Gt=0;Gt<6;Gt++)if(se.mipmaps&&se.mipmaps.length>0)for(let Ht=0;Ht<se.mipmaps.length;Ht++)it(tt.__webglFramebuffer[Gt][Ht],Ae,se,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Gt,Ht);else it(tt.__webglFramebuffer[Gt],Ae,se,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+Gt,0);k(se)&&C(t.TEXTURE_CUBE_MAP),n.unbindTexture()}else if(pn){for(let Gt=0,Ht=Tt.length;Gt<Ht;Gt++){const Ln=Tt[Gt],He=r.get(Ln);n.bindTexture(t.TEXTURE_2D,He.__webglTexture),ot(t.TEXTURE_2D,Ln),it(tt.__webglFramebuffer,Ae,Ln,t.COLOR_ATTACHMENT0+Gt,t.TEXTURE_2D,0),k(Ln)&&C(t.TEXTURE_2D)}n.unbindTexture()}else{let Gt=t.TEXTURE_2D;if((Ae.isWebGL3DRenderTarget||Ae.isWebGLArrayRenderTarget)&&(Gt=Ae.isWebGL3DRenderTarget?t.TEXTURE_3D:t.TEXTURE_2D_ARRAY),n.bindTexture(Gt,vt.__webglTexture),ot(Gt,se),se.mipmaps&&se.mipmaps.length>0)for(let Ht=0;Ht<se.mipmaps.length;Ht++)it(tt.__webglFramebuffer[Ht],Ae,se,t.COLOR_ATTACHMENT0,Gt,Ht);else it(tt.__webglFramebuffer,Ae,se,t.COLOR_ATTACHMENT0,Gt,0);k(se)&&C(Gt),n.unbindTexture()}Ae.depthBuffer&&At(Ae)}function qe(Ae){const se=Ae.textures;for(let tt=0,vt=se.length;tt<vt;tt++){const Tt=se[tt];if(k(Tt)){const wt=Ae.isWebGLCubeRenderTarget?t.TEXTURE_CUBE_MAP:t.TEXTURE_2D,pn=r.get(Tt).__webglTexture;n.bindTexture(wt,pn),C(wt),n.unbindTexture()}}}const Nn=[],hn=[];function Gn(Ae){if(Ae.samples>0){if(un(Ae)===!1){const se=Ae.textures,tt=Ae.width,vt=Ae.height;let Tt=t.COLOR_BUFFER_BIT;const wt=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT,pn=r.get(Ae),Gt=se.length>1;if(Gt)for(let Ht=0;Ht<se.length;Ht++)n.bindFramebuffer(t.FRAMEBUFFER,pn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ht,t.RENDERBUFFER,null),n.bindFramebuffer(t.FRAMEBUFFER,pn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ht,t.TEXTURE_2D,null,0);n.bindFramebuffer(t.READ_FRAMEBUFFER,pn.__webglMultisampledFramebuffer),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,pn.__webglFramebuffer);for(let Ht=0;Ht<se.length;Ht++){if(Ae.resolveDepthBuffer&&(Ae.depthBuffer&&(Tt|=t.DEPTH_BUFFER_BIT),Ae.stencilBuffer&&Ae.resolveStencilBuffer&&(Tt|=t.STENCIL_BUFFER_BIT)),Gt){t.framebufferRenderbuffer(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.RENDERBUFFER,pn.__webglColorRenderbuffer[Ht]);const Ln=r.get(se[Ht]).__webglTexture;t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,Ln,0)}t.blitFramebuffer(0,0,tt,vt,0,0,tt,vt,Tt,t.NEAREST),m===!0&&(Nn.length=0,hn.length=0,Nn.push(t.COLOR_ATTACHMENT0+Ht),Ae.depthBuffer&&Ae.resolveDepthBuffer===!1&&(Nn.push(wt),hn.push(wt),t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,hn)),t.invalidateFramebuffer(t.READ_FRAMEBUFFER,Nn))}if(n.bindFramebuffer(t.READ_FRAMEBUFFER,null),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),Gt)for(let Ht=0;Ht<se.length;Ht++){n.bindFramebuffer(t.FRAMEBUFFER,pn.__webglMultisampledFramebuffer),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ht,t.RENDERBUFFER,pn.__webglColorRenderbuffer[Ht]);const Ln=r.get(se[Ht]).__webglTexture;n.bindFramebuffer(t.FRAMEBUFFER,pn.__webglFramebuffer),t.framebufferTexture2D(t.DRAW_FRAMEBUFFER,t.COLOR_ATTACHMENT0+Ht,t.TEXTURE_2D,Ln,0)}n.bindFramebuffer(t.DRAW_FRAMEBUFFER,pn.__webglMultisampledFramebuffer)}else if(Ae.depthBuffer&&Ae.resolveDepthBuffer===!1&&m){const se=Ae.stencilBuffer?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;t.invalidateFramebuffer(t.DRAW_FRAMEBUFFER,[se])}}}function gn(Ae){return Math.min(s.maxSamples,Ae.samples)}function un(Ae){const se=r.get(Ae);return Ae.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&se.__useRenderToTexture!==!1}function Pn(Ae){const se=h.render.frame;S.get(Ae)!==se&&(S.set(Ae,se),Ae.update())}function je(Ae,se){const tt=Ae.colorSpace,vt=Ae.format,Tt=Ae.type;return Ae.isCompressedTexture===!0||Ae.isVideoTexture===!0||tt!==zc&&tt!==lc&&(wr.getTransfer(tt)===zr?(vt!==go||Tt!==Ec)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",tt)),se}function qn(Ae){return typeof HTMLImageElement<"u"&&Ae instanceof HTMLImageElement?(_.width=Ae.naturalWidth||Ae.width,_.height=Ae.naturalHeight||Ae.height):typeof VideoFrame<"u"&&Ae instanceof VideoFrame?(_.width=Ae.displayWidth,_.height=Ae.displayHeight):(_.width=Ae.width,_.height=Ae.height),_}this.allocateTextureUnit=Te,this.resetTextureUnits=J,this.setTexture2D=Re,this.setTexture2DArray=We,this.setTexture3D=ct,this.setTextureCube=gt,this.rebindTextures=Sn,this.setupRenderTarget=Dn,this.updateRenderTargetMipmap=qe,this.updateMultisampleRenderTarget=Gn,this.setupDepthRenderbuffer=At,this.setupFrameBufferTexture=it,this.useMultisampledRTT=un}function YB(t,e){function n(r,s=lc){let c;const h=wr.getTransfer(s);if(r===Ec)return t.UNSIGNED_BYTE;if(r===qE)return t.UNSIGNED_SHORT_4_4_4_4;if(r===$E)return t.UNSIGNED_SHORT_5_5_5_1;if(r===mk)return t.UNSIGNED_INT_5_9_9_9_REV;if(r===fk)return t.BYTE;if(r===pk)return t.SHORT;if(r===jE)return t.UNSIGNED_SHORT;if(r===WE)return t.INT;if(r===Bd)return t.UNSIGNED_INT;if(r===hc)return t.FLOAT;if(r===Ev)return t.HALF_FLOAT;if(r===gk)return t.ALPHA;if(r===vk)return t.RGB;if(r===go)return t.RGBA;if(r===yk)return t.LUMINANCE;if(r===_k)return t.LUMINANCE_ALPHA;if(r===Md)return t.DEPTH_COMPONENT;if(r===vp)return t.DEPTH_STENCIL;if(r===xk)return t.RED;if(r===XE)return t.RED_INTEGER;if(r===bk)return t.RG;if(r===ZE)return t.RG_INTEGER;if(r===YE)return t.RGBA_INTEGER;if(r===__||r===x_||r===b_||r===w_)if(h===zr)if(c=e.get("WEBGL_compressed_texture_s3tc_srgb"),c!==null){if(r===__)return c.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===x_)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===b_)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===w_)return c.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(c=e.get("WEBGL_compressed_texture_s3tc"),c!==null){if(r===__)return c.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===x_)return c.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===b_)return c.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===w_)return c.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===kS||r===LS||r===zS||r===FS)if(c=e.get("WEBGL_compressed_texture_pvrtc"),c!==null){if(r===kS)return c.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===LS)return c.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===zS)return c.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===FS)return c.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===NS||r===BS||r===OS)if(c=e.get("WEBGL_compressed_texture_etc"),c!==null){if(r===NS||r===BS)return h===zr?c.COMPRESSED_SRGB8_ETC2:c.COMPRESSED_RGB8_ETC2;if(r===OS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:c.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===US||r===VS||r===HS||r===GS||r===jS||r===WS||r===qS||r===$S||r===XS||r===ZS||r===YS||r===KS||r===JS||r===QS)if(c=e.get("WEBGL_compressed_texture_astc"),c!==null){if(r===US)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:c.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===VS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:c.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===HS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:c.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===GS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:c.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===jS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:c.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===WS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:c.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===qS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:c.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===$S)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:c.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===XS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:c.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===ZS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:c.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===YS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:c.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===KS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:c.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===JS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:c.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===QS)return h===zr?c.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:c.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===S_||r===e5||r===t5)if(c=e.get("EXT_texture_compression_bptc"),c!==null){if(r===S_)return h===zr?c.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:c.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===e5)return c.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===t5)return c.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===wk||r===n5||r===r5||r===i5)if(c=e.get("EXT_texture_compression_rgtc"),c!==null){if(r===S_)return c.COMPRESSED_RED_RGTC1_EXT;if(r===n5)return c.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===r5)return c.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===i5)return c.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===Lp?t.UNSIGNED_INT_24_8:t[r]!==void 0?t[r]:null}return{convert:n}}class KB extends vs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class I0 extends es{constructor(){super(),this.isGroup=!0,this.type="Group"}}const JB={type:"move"};class X_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new I0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new I0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new st,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new st),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new I0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new st,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new st),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const n=this._hand;if(n)for(const r of e.hand.values())this._getHandJoint(n,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,n,r){let s=null,c=null,h=null;const l=this._targetRay,m=this._grip,_=this._hand;if(e&&n.session.visibilityState!=="visible-blurred"){if(_&&e.hand){h=!0;for(const B of e.hand.values()){const k=n.getJointPose(B,r),C=this._getHandJoint(_,B);k!==null&&(C.matrix.fromArray(k.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,C.jointRadius=k.radius),C.visible=k!==null}const S=_.joints["index-finger-tip"],T=_.joints["thumb-tip"],M=S.position.distanceTo(T.position),I=.02,N=.005;_.inputState.pinching&&M>I+N?(_.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!_.inputState.pinching&&M<=I-N&&(_.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else m!==null&&e.gripSpace&&(c=n.getPose(e.gripSpace,r),c!==null&&(m.matrix.fromArray(c.transform.matrix),m.matrix.decompose(m.position,m.rotation,m.scale),m.matrixWorldNeedsUpdate=!0,c.linearVelocity?(m.hasLinearVelocity=!0,m.linearVelocity.copy(c.linearVelocity)):m.hasLinearVelocity=!1,c.angularVelocity?(m.hasAngularVelocity=!0,m.angularVelocity.copy(c.angularVelocity)):m.hasAngularVelocity=!1));l!==null&&(s=n.getPose(e.targetRaySpace,r),s===null&&c!==null&&(s=c),s!==null&&(l.matrix.fromArray(s.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,s.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(s.linearVelocity)):l.hasLinearVelocity=!1,s.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(s.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(JB)))}return l!==null&&(l.visible=s!==null),m!==null&&(m.visible=c!==null),_!==null&&(_.visible=h!==null),this}_getHandJoint(e,n){if(e.joints[n.jointName]===void 0){const r=new I0;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[n.jointName]=r,e.add(r)}return e.joints[n.jointName]}}const QB=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,eO=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class tO{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,n,r){if(this.texture===null){const s=new xa,c=e.properties.get(s);c.__webglTexture=n.texture,(n.depthNear!=r.depthNear||n.depthFar!=r.depthFar)&&(this.depthNear=n.depthNear,this.depthFar=n.depthFar),this.texture=s}}render(e,n){if(this.texture!==null){if(this.mesh===null){const r=n.cameras[0].viewport,s=new bs({vertexShader:QB,fragmentShader:eO,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new Ja(new Np(20,20),s)}e.render(this.mesh,n)}}reset(){this.texture=null,this.mesh=null}}class nO extends qu{constructor(e,n){super();const r=this;let s=null,c=1,h=null,l="local-floor",m=1,_=null,S=null,T=null,M=null,I=null,N=null;const B=new tO,k=n.getContextAttributes();let C=null,U=null;const V=[],Y=[],he=new Yn;let Z=null;const ne=new vs;ne.layers.enable(1),ne.viewport=new Hi;const xe=new vs;xe.layers.enable(2),xe.viewport=new Hi;const ie=[ne,xe],J=new KB;J.layers.enable(1),J.layers.enable(2);let Te=null,Be=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(it){let Mt=V[it];return Mt===void 0&&(Mt=new X_,V[it]=Mt),Mt.getTargetRaySpace()},this.getControllerGrip=function(it){let Mt=V[it];return Mt===void 0&&(Mt=new X_,V[it]=Mt),Mt.getGripSpace()},this.getHand=function(it){let Mt=V[it];return Mt===void 0&&(Mt=new X_,V[it]=Mt),Mt.getHandSpace()};function Re(it){const Mt=Y.indexOf(it.inputSource);if(Mt===-1)return;const Ft=V[Mt];Ft!==void 0&&(Ft.update(it.inputSource,it.frame,_||h),Ft.dispatchEvent({type:it.type,data:it.inputSource}))}function We(){s.removeEventListener("select",Re),s.removeEventListener("selectstart",Re),s.removeEventListener("selectend",Re),s.removeEventListener("squeeze",Re),s.removeEventListener("squeezestart",Re),s.removeEventListener("squeezeend",Re),s.removeEventListener("end",We),s.removeEventListener("inputsourceschange",ct);for(let it=0;it<V.length;it++){const Mt=Y[it];Mt!==null&&(Y[it]=null,V[it].disconnect(Mt))}Te=null,Be=null,B.reset(),e.setRenderTarget(C),I=null,M=null,T=null,s=null,U=null,Cn.stop(),r.isPresenting=!1,e.setPixelRatio(Z),e.setSize(he.width,he.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(it){c=it,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(it){l=it,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return _||h},this.setReferenceSpace=function(it){_=it},this.getBaseLayer=function(){return M!==null?M:I},this.getBinding=function(){return T},this.getFrame=function(){return N},this.getSession=function(){return s},this.setSession=async function(it){if(s=it,s!==null){if(C=e.getRenderTarget(),s.addEventListener("select",Re),s.addEventListener("selectstart",Re),s.addEventListener("selectend",Re),s.addEventListener("squeeze",Re),s.addEventListener("squeezestart",Re),s.addEventListener("squeezeend",Re),s.addEventListener("end",We),s.addEventListener("inputsourceschange",ct),k.xrCompatible!==!0&&await n.makeXRCompatible(),Z=e.getPixelRatio(),e.getSize(he),s.renderState.layers===void 0){const Mt={antialias:k.antialias,alpha:!0,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:c};I=new XRWebGLLayer(s,n,Mt),s.updateRenderState({baseLayer:I}),e.setPixelRatio(1),e.setSize(I.framebufferWidth,I.framebufferHeight,!1),U=new Uu(I.framebufferWidth,I.framebufferHeight,{format:go,type:Ec,colorSpace:e.outputColorSpace,stencilBuffer:k.stencil})}else{let Mt=null,Ft=null,At=null;k.depth&&(At=k.stencil?n.DEPTH24_STENCIL8:n.DEPTH_COMPONENT24,Mt=k.stencil?vp:Md,Ft=k.stencil?Lp:Bd);const Sn={colorFormat:n.RGBA8,depthFormat:At,scaleFactor:c};T=new XRWebGLBinding(s,n),M=T.createProjectionLayer(Sn),s.updateRenderState({layers:[M]}),e.setPixelRatio(1),e.setSize(M.textureWidth,M.textureHeight,!1),U=new Uu(M.textureWidth,M.textureHeight,{format:go,type:Ec,depthTexture:new dA(M.textureWidth,M.textureHeight,Ft,void 0,void 0,void 0,void 0,void 0,void 0,Mt),stencilBuffer:k.stencil,colorSpace:e.outputColorSpace,samples:k.antialias?4:0,resolveDepthBuffer:M.ignoreDepthValues===!1})}U.isXRRenderTarget=!0,this.setFoveation(m),_=null,h=await s.requestReferenceSpace(l),Cn.setContext(s),Cn.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(s!==null)return s.environmentBlendMode};function ct(it){for(let Mt=0;Mt<it.removed.length;Mt++){const Ft=it.removed[Mt],At=Y.indexOf(Ft);At>=0&&(Y[At]=null,V[At].disconnect(Ft))}for(let Mt=0;Mt<it.added.length;Mt++){const Ft=it.added[Mt];let At=Y.indexOf(Ft);if(At===-1){for(let Dn=0;Dn<V.length;Dn++)if(Dn>=Y.length){Y.push(Ft),At=Dn;break}else if(Y[Dn]===null){Y[Dn]=Ft,At=Dn;break}if(At===-1)break}const Sn=V[At];Sn&&Sn.connect(Ft)}}const gt=new st,ft=new st;function ke(it,Mt,Ft){gt.setFromMatrixPosition(Mt.matrixWorld),ft.setFromMatrixPosition(Ft.matrixWorld);const At=gt.distanceTo(ft),Sn=Mt.projectionMatrix.elements,Dn=Ft.projectionMatrix.elements,qe=Sn[14]/(Sn[10]-1),Nn=Sn[14]/(Sn[10]+1),hn=(Sn[9]+1)/Sn[5],Gn=(Sn[9]-1)/Sn[5],gn=(Sn[8]-1)/Sn[0],un=(Dn[8]+1)/Dn[0],Pn=qe*gn,je=qe*un,qn=At/(-gn+un),Ae=qn*-gn;Mt.matrixWorld.decompose(it.position,it.quaternion,it.scale),it.translateX(Ae),it.translateZ(qn),it.matrixWorld.compose(it.position,it.quaternion,it.scale),it.matrixWorldInverse.copy(it.matrixWorld).invert();const se=qe+qn,tt=Nn+qn,vt=Pn-Ae,Tt=je+(At-Ae),wt=hn*Nn/tt*se,pn=Gn*Nn/tt*se;it.projectionMatrix.makePerspective(vt,Tt,wt,pn,se,tt),it.projectionMatrixInverse.copy(it.projectionMatrix).invert()}function at(it,Mt){Mt===null?it.matrixWorld.copy(it.matrix):it.matrixWorld.multiplyMatrices(Mt.matrixWorld,it.matrix),it.matrixWorldInverse.copy(it.matrixWorld).invert()}this.updateCamera=function(it){if(s===null)return;B.texture!==null&&(it.near=B.depthNear,it.far=B.depthFar),J.near=xe.near=ne.near=it.near,J.far=xe.far=ne.far=it.far,(Te!==J.near||Be!==J.far)&&(s.updateRenderState({depthNear:J.near,depthFar:J.far}),Te=J.near,Be=J.far,ne.near=Te,ne.far=Be,xe.near=Te,xe.far=Be,ne.updateProjectionMatrix(),xe.updateProjectionMatrix(),it.updateProjectionMatrix());const Mt=it.parent,Ft=J.cameras;at(J,Mt);for(let At=0;At<Ft.length;At++)at(Ft[At],Mt);Ft.length===2?ke(J,ne,xe):J.projectionMatrix.copy(ne.projectionMatrix),ot(it,J,Mt)};function ot(it,Mt,Ft){Ft===null?it.matrix.copy(Mt.matrixWorld):(it.matrix.copy(Ft.matrixWorld),it.matrix.invert(),it.matrix.multiply(Mt.matrixWorld)),it.matrix.decompose(it.position,it.quaternion,it.scale),it.updateMatrixWorld(!0),it.projectionMatrix.copy(Mt.projectionMatrix),it.projectionMatrixInverse.copy(Mt.projectionMatrixInverse),it.isPerspectiveCamera&&(it.fov=yp*2*Math.atan(1/it.projectionMatrix.elements[5]),it.zoom=1)}this.getCamera=function(){return J},this.getFoveation=function(){if(!(M===null&&I===null))return m},this.setFoveation=function(it){m=it,M!==null&&(M.fixedFoveation=it),I!==null&&I.fixedFoveation!==void 0&&(I.fixedFoveation=it)},this.hasDepthSensing=function(){return B.texture!==null};let _t=null;function kt(it,Mt){if(S=Mt.getViewerPose(_||h),N=Mt,S!==null){const Ft=S.views;I!==null&&(e.setRenderTargetFramebuffer(U,I.framebuffer),e.setRenderTarget(U));let At=!1;Ft.length!==J.cameras.length&&(J.cameras.length=0,At=!0);for(let Dn=0;Dn<Ft.length;Dn++){const qe=Ft[Dn];let Nn=null;if(I!==null)Nn=I.getViewport(qe);else{const Gn=T.getViewSubImage(M,qe);Nn=Gn.viewport,Dn===0&&(e.setRenderTargetTextures(U,Gn.colorTexture,M.ignoreDepthValues?void 0:Gn.depthStencilTexture),e.setRenderTarget(U))}let hn=ie[Dn];hn===void 0&&(hn=new vs,hn.layers.enable(Dn),hn.viewport=new Hi,ie[Dn]=hn),hn.matrix.fromArray(qe.transform.matrix),hn.matrix.decompose(hn.position,hn.quaternion,hn.scale),hn.projectionMatrix.fromArray(qe.projectionMatrix),hn.projectionMatrixInverse.copy(hn.projectionMatrix).invert(),hn.viewport.set(Nn.x,Nn.y,Nn.width,Nn.height),Dn===0&&(J.matrix.copy(hn.matrix),J.matrix.decompose(J.position,J.quaternion,J.scale)),At===!0&&J.cameras.push(hn)}const Sn=s.enabledFeatures;if(Sn&&Sn.includes("depth-sensing")){const Dn=T.getDepthInformation(Ft[0]);Dn&&Dn.isValid&&Dn.texture&&B.init(e,Dn,s.renderState)}}for(let Ft=0;Ft<V.length;Ft++){const At=Y[Ft],Sn=V[Ft];At!==null&&Sn!==void 0&&Sn.update(At,Mt,_||h)}B.render(e,J),_t&&_t(it,Mt),Mt.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:Mt}),N=null}const Cn=new hA;Cn.setAnimationLoop(kt),this.setAnimationLoop=function(it){_t=it},this.dispose=function(){}}}const hu=new pl,rO=new bi;function iO(t,e){function n(k,C){k.matrixAutoUpdate===!0&&k.updateMatrix(),C.value.copy(k.matrix)}function r(k,C){C.color.getRGB(k.fogColor.value,oA(t)),C.isFog?(k.fogNear.value=C.near,k.fogFar.value=C.far):C.isFogExp2&&(k.fogDensity.value=C.density)}function s(k,C,U,V,Y){C.isMeshBasicMaterial||C.isMeshLambertMaterial?c(k,C):C.isMeshToonMaterial?(c(k,C),T(k,C)):C.isMeshPhongMaterial?(c(k,C),S(k,C)):C.isMeshStandardMaterial?(c(k,C),M(k,C),C.isMeshPhysicalMaterial&&I(k,C,Y)):C.isMeshMatcapMaterial?(c(k,C),N(k,C)):C.isMeshDepthMaterial?c(k,C):C.isMeshDistanceMaterial?(c(k,C),B(k,C)):C.isMeshNormalMaterial?c(k,C):C.isLineBasicMaterial?(h(k,C),C.isLineDashedMaterial&&l(k,C)):C.isPointsMaterial?m(k,C,U,V):C.isSpriteMaterial?_(k,C):C.isShadowMaterial?(k.color.value.copy(C.color),k.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function c(k,C){k.opacity.value=C.opacity,C.color&&k.diffuse.value.copy(C.color),C.emissive&&k.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(k.map.value=C.map,n(C.map,k.mapTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,n(C.alphaMap,k.alphaMapTransform)),C.bumpMap&&(k.bumpMap.value=C.bumpMap,n(C.bumpMap,k.bumpMapTransform),k.bumpScale.value=C.bumpScale,C.side===za&&(k.bumpScale.value*=-1)),C.normalMap&&(k.normalMap.value=C.normalMap,n(C.normalMap,k.normalMapTransform),k.normalScale.value.copy(C.normalScale),C.side===za&&k.normalScale.value.negate()),C.displacementMap&&(k.displacementMap.value=C.displacementMap,n(C.displacementMap,k.displacementMapTransform),k.displacementScale.value=C.displacementScale,k.displacementBias.value=C.displacementBias),C.emissiveMap&&(k.emissiveMap.value=C.emissiveMap,n(C.emissiveMap,k.emissiveMapTransform)),C.specularMap&&(k.specularMap.value=C.specularMap,n(C.specularMap,k.specularMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest);const U=e.get(C),V=U.envMap,Y=U.envMapRotation;if(V&&(k.envMap.value=V,hu.copy(Y),hu.x*=-1,hu.y*=-1,hu.z*=-1,V.isCubeTexture&&V.isRenderTargetTexture===!1&&(hu.y*=-1,hu.z*=-1),k.envMapRotation.value.setFromMatrix4(rO.makeRotationFromEuler(hu)),k.flipEnvMap.value=V.isCubeTexture&&V.isRenderTargetTexture===!1?-1:1,k.reflectivity.value=C.reflectivity,k.ior.value=C.ior,k.refractionRatio.value=C.refractionRatio),C.lightMap){k.lightMap.value=C.lightMap;const he=t._useLegacyLights===!0?Math.PI:1;k.lightMapIntensity.value=C.lightMapIntensity*he,n(C.lightMap,k.lightMapTransform)}C.aoMap&&(k.aoMap.value=C.aoMap,k.aoMapIntensity.value=C.aoMapIntensity,n(C.aoMap,k.aoMapTransform))}function h(k,C){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,C.map&&(k.map.value=C.map,n(C.map,k.mapTransform))}function l(k,C){k.dashSize.value=C.dashSize,k.totalSize.value=C.dashSize+C.gapSize,k.scale.value=C.scale}function m(k,C,U,V){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,k.size.value=C.size*U,k.scale.value=V*.5,C.map&&(k.map.value=C.map,n(C.map,k.uvTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,n(C.alphaMap,k.alphaMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest)}function _(k,C){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,k.rotation.value=C.rotation,C.map&&(k.map.value=C.map,n(C.map,k.mapTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,n(C.alphaMap,k.alphaMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest)}function S(k,C){k.specular.value.copy(C.specular),k.shininess.value=Math.max(C.shininess,1e-4)}function T(k,C){C.gradientMap&&(k.gradientMap.value=C.gradientMap)}function M(k,C){k.metalness.value=C.metalness,C.metalnessMap&&(k.metalnessMap.value=C.metalnessMap,n(C.metalnessMap,k.metalnessMapTransform)),k.roughness.value=C.roughness,C.roughnessMap&&(k.roughnessMap.value=C.roughnessMap,n(C.roughnessMap,k.roughnessMapTransform)),C.envMap&&(k.envMapIntensity.value=C.envMapIntensity)}function I(k,C,U){k.ior.value=C.ior,C.sheen>0&&(k.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),k.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(k.sheenColorMap.value=C.sheenColorMap,n(C.sheenColorMap,k.sheenColorMapTransform)),C.sheenRoughnessMap&&(k.sheenRoughnessMap.value=C.sheenRoughnessMap,n(C.sheenRoughnessMap,k.sheenRoughnessMapTransform))),C.clearcoat>0&&(k.clearcoat.value=C.clearcoat,k.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(k.clearcoatMap.value=C.clearcoatMap,n(C.clearcoatMap,k.clearcoatMapTransform)),C.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap,n(C.clearcoatRoughnessMap,k.clearcoatRoughnessMapTransform)),C.clearcoatNormalMap&&(k.clearcoatNormalMap.value=C.clearcoatNormalMap,n(C.clearcoatNormalMap,k.clearcoatNormalMapTransform),k.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),C.side===za&&k.clearcoatNormalScale.value.negate())),C.dispersion>0&&(k.dispersion.value=C.dispersion),C.iridescence>0&&(k.iridescence.value=C.iridescence,k.iridescenceIOR.value=C.iridescenceIOR,k.iridescenceThicknessMinimum.value=C.iridescenceThicknessRange[0],k.iridescenceThicknessMaximum.value=C.iridescenceThicknessRange[1],C.iridescenceMap&&(k.iridescenceMap.value=C.iridescenceMap,n(C.iridescenceMap,k.iridescenceMapTransform)),C.iridescenceThicknessMap&&(k.iridescenceThicknessMap.value=C.iridescenceThicknessMap,n(C.iridescenceThicknessMap,k.iridescenceThicknessMapTransform))),C.transmission>0&&(k.transmission.value=C.transmission,k.transmissionSamplerMap.value=U.texture,k.transmissionSamplerSize.value.set(U.width,U.height),C.transmissionMap&&(k.transmissionMap.value=C.transmissionMap,n(C.transmissionMap,k.transmissionMapTransform)),k.thickness.value=C.thickness,C.thicknessMap&&(k.thicknessMap.value=C.thicknessMap,n(C.thicknessMap,k.thicknessMapTransform)),k.attenuationDistance.value=C.attenuationDistance,k.attenuationColor.value.copy(C.attenuationColor)),C.anisotropy>0&&(k.anisotropyVector.value.set(C.anisotropy*Math.cos(C.anisotropyRotation),C.anisotropy*Math.sin(C.anisotropyRotation)),C.anisotropyMap&&(k.anisotropyMap.value=C.anisotropyMap,n(C.anisotropyMap,k.anisotropyMapTransform))),k.specularIntensity.value=C.specularIntensity,k.specularColor.value.copy(C.specularColor),C.specularColorMap&&(k.specularColorMap.value=C.specularColorMap,n(C.specularColorMap,k.specularColorMapTransform)),C.specularIntensityMap&&(k.specularIntensityMap.value=C.specularIntensityMap,n(C.specularIntensityMap,k.specularIntensityMapTransform))}function N(k,C){C.matcap&&(k.matcap.value=C.matcap)}function B(k,C){const U=e.get(C).light;k.referencePosition.value.setFromMatrixPosition(U.matrixWorld),k.nearDistance.value=U.shadow.camera.near,k.farDistance.value=U.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:s}}function aO(t,e,n,r){let s={},c={},h=[];const l=t.getParameter(t.MAX_UNIFORM_BUFFER_BINDINGS);function m(U,V){const Y=V.program;r.uniformBlockBinding(U,Y)}function _(U,V){let Y=s[U.id];Y===void 0&&(N(U),Y=S(U),s[U.id]=Y,U.addEventListener("dispose",k));const he=V.program;r.updateUBOMapping(U,he);const Z=e.render.frame;c[U.id]!==Z&&(M(U),c[U.id]=Z)}function S(U){const V=T();U.__bindingPointIndex=V;const Y=t.createBuffer(),he=U.__size,Z=U.usage;return t.bindBuffer(t.UNIFORM_BUFFER,Y),t.bufferData(t.UNIFORM_BUFFER,he,Z),t.bindBuffer(t.UNIFORM_BUFFER,null),t.bindBufferBase(t.UNIFORM_BUFFER,V,Y),Y}function T(){for(let U=0;U<l;U++)if(h.indexOf(U)===-1)return h.push(U),U;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function M(U){const V=s[U.id],Y=U.uniforms,he=U.__cache;t.bindBuffer(t.UNIFORM_BUFFER,V);for(let Z=0,ne=Y.length;Z<ne;Z++){const xe=Array.isArray(Y[Z])?Y[Z]:[Y[Z]];for(let ie=0,J=xe.length;ie<J;ie++){const Te=xe[ie];if(I(Te,Z,ie,he)===!0){const Be=Te.__offset,Re=Array.isArray(Te.value)?Te.value:[Te.value];let We=0;for(let ct=0;ct<Re.length;ct++){const gt=Re[ct],ft=B(gt);typeof gt=="number"||typeof gt=="boolean"?(Te.__data[0]=gt,t.bufferSubData(t.UNIFORM_BUFFER,Be+We,Te.__data)):gt.isMatrix3?(Te.__data[0]=gt.elements[0],Te.__data[1]=gt.elements[1],Te.__data[2]=gt.elements[2],Te.__data[3]=0,Te.__data[4]=gt.elements[3],Te.__data[5]=gt.elements[4],Te.__data[6]=gt.elements[5],Te.__data[7]=0,Te.__data[8]=gt.elements[6],Te.__data[9]=gt.elements[7],Te.__data[10]=gt.elements[8],Te.__data[11]=0):(gt.toArray(Te.__data,We),We+=ft.storage/Float32Array.BYTES_PER_ELEMENT)}t.bufferSubData(t.UNIFORM_BUFFER,Be,Te.__data)}}}t.bindBuffer(t.UNIFORM_BUFFER,null)}function I(U,V,Y,he){const Z=U.value,ne=V+"_"+Y;if(he[ne]===void 0)return typeof Z=="number"||typeof Z=="boolean"?he[ne]=Z:he[ne]=Z.clone(),!0;{const xe=he[ne];if(typeof Z=="number"||typeof Z=="boolean"){if(xe!==Z)return he[ne]=Z,!0}else if(xe.equals(Z)===!1)return xe.copy(Z),!0}return!1}function N(U){const V=U.uniforms;let Y=0;const he=16;for(let ne=0,xe=V.length;ne<xe;ne++){const ie=Array.isArray(V[ne])?V[ne]:[V[ne]];for(let J=0,Te=ie.length;J<Te;J++){const Be=ie[J],Re=Array.isArray(Be.value)?Be.value:[Be.value];for(let We=0,ct=Re.length;We<ct;We++){const gt=Re[We],ft=B(gt),ke=Y%he;ke!==0&&he-ke<ft.boundary&&(Y+=he-ke),Be.__data=new Float32Array(ft.storage/Float32Array.BYTES_PER_ELEMENT),Be.__offset=Y,Y+=ft.storage}}}const Z=Y%he;return Z>0&&(Y+=he-Z),U.__size=Y,U.__cache={},this}function B(U){const V={boundary:0,storage:0};return typeof U=="number"||typeof U=="boolean"?(V.boundary=4,V.storage=4):U.isVector2?(V.boundary=8,V.storage=8):U.isVector3||U.isColor?(V.boundary=16,V.storage=12):U.isVector4?(V.boundary=16,V.storage=16):U.isMatrix3?(V.boundary=48,V.storage=48):U.isMatrix4?(V.boundary=64,V.storage=64):U.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",U),V}function k(U){const V=U.target;V.removeEventListener("dispose",k);const Y=h.indexOf(V.__bindingPointIndex);h.splice(Y,1),t.deleteBuffer(s[V.id]),delete s[V.id],delete c[V.id]}function C(){for(const U in s)t.deleteBuffer(s[U]);h=[],s={},c={}}return{bind:m,update:_,dispose:C}}class sO{constructor(e={}){const{canvas:n=Kk(),context:r=null,depth:s=!0,stencil:c=!1,alpha:h=!1,antialias:l=!1,premultipliedAlpha:m=!0,preserveDrawingBuffer:_=!1,powerPreference:S="default",failIfMajorPerformanceCaveat:T=!1}=e;this.isWebGLRenderer=!0;let M;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");M=r.getContextAttributes().alpha}else M=h;const I=new Uint32Array(4),N=new Int32Array(4);let B=null,k=null;const C=[],U=[];this.domElement=n,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=oo,this._useLegacyLights=!1,this.toneMapping=wc,this.toneMappingExposure=1;const V=this;let Y=!1,he=0,Z=0,ne=null,xe=-1,ie=null;const J=new Hi,Te=new Hi;let Be=null;const Re=new Sr(0);let We=0,ct=n.width,gt=n.height,ft=1,ke=null,at=null;const ot=new Hi(0,0,ct,gt),_t=new Hi(0,0,ct,gt);let kt=!1;const Cn=new uA;let it=!1,Mt=!1;const Ft=new bi,At=new st,Sn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function Dn(){return ne===null?ft:1}let qe=r;function Nn(ue,Ne){return n.getContext(ue,Ne)}try{const ue={alpha:!0,depth:s,stencil:c,antialias:l,premultipliedAlpha:m,preserveDrawingBuffer:_,powerPreference:S,failIfMajorPerformanceCaveat:T};if("setAttribute"in n&&n.setAttribute("data-engine",`three.js r${Ub}`),n.addEventListener("webglcontextlost",Q,!1),n.addEventListener("webglcontextrestored",ze,!1),n.addEventListener("webglcontextcreationerror",Qe,!1),qe===null){const Ne="webgl2";if(qe=Nn(Ne,ue),qe===null)throw Nn(Ne)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(ue){throw console.error("THREE.WebGLRenderer: "+ue.message),ue}let hn,Gn,gn,un,Pn,je,qn,Ae,se,tt,vt,Tt,wt,pn,Gt,Ht,Ln,He,on,Rn,xn,Qt,lt,Ut;function Zt(){hn=new pN(qe),hn.init(),Qt=new YB(qe,hn),Gn=new oN(qe,hn,e,Qt),gn=new XB(qe),un=new vN(qe),Pn=new LB,je=new ZB(qe,hn,gn,Pn,Gn,Qt,un),qn=new cN(V),Ae=new fN(V),se=new SL(qe),lt=new aN(qe,se),tt=new mN(qe,se,un,lt),vt=new _N(qe,tt,se,un),on=new yN(qe,Gn,je),Ht=new lN(Pn),Tt=new kB(V,qn,Ae,hn,Gn,lt,Ht),wt=new iO(V,Pn),pn=new FB,Gt=new HB(hn),He=new iN(V,qn,Ae,gn,vt,M,m),Ln=new $B(V,vt,Gn),Ut=new aO(qe,un,Gn,gn),Rn=new sN(qe,hn,un),xn=new gN(qe,hn,un),un.programs=Tt.programs,V.capabilities=Gn,V.extensions=hn,V.properties=Pn,V.renderLists=pn,V.shadowMap=Ln,V.state=gn,V.info=un}Zt();const yn=new nO(V,qe);this.xr=yn,this.getContext=function(){return qe},this.getContextAttributes=function(){return qe.getContextAttributes()},this.forceContextLoss=function(){const ue=hn.get("WEBGL_lose_context");ue&&ue.loseContext()},this.forceContextRestore=function(){const ue=hn.get("WEBGL_lose_context");ue&&ue.restoreContext()},this.getPixelRatio=function(){return ft},this.setPixelRatio=function(ue){ue!==void 0&&(ft=ue,this.setSize(ct,gt,!1))},this.getSize=function(ue){return ue.set(ct,gt)},this.setSize=function(ue,Ne,Ve=!0){if(yn.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ct=ue,gt=Ne,n.width=Math.floor(ue*ft),n.height=Math.floor(Ne*ft),Ve===!0&&(n.style.width=ue+"px",n.style.height=Ne+"px"),this.setViewport(0,0,ue,Ne)},this.getDrawingBufferSize=function(ue){return ue.set(ct*ft,gt*ft).floor()},this.setDrawingBufferSize=function(ue,Ne,Ve){ct=ue,gt=Ne,ft=Ve,n.width=Math.floor(ue*Ve),n.height=Math.floor(Ne*Ve),this.setViewport(0,0,ue,Ne)},this.getCurrentViewport=function(ue){return ue.copy(J)},this.getViewport=function(ue){return ue.copy(ot)},this.setViewport=function(ue,Ne,Ve,$e){ue.isVector4?ot.set(ue.x,ue.y,ue.z,ue.w):ot.set(ue,Ne,Ve,$e),gn.viewport(J.copy(ot).multiplyScalar(ft).round())},this.getScissor=function(ue){return ue.copy(_t)},this.setScissor=function(ue,Ne,Ve,$e){ue.isVector4?_t.set(ue.x,ue.y,ue.z,ue.w):_t.set(ue,Ne,Ve,$e),gn.scissor(Te.copy(_t).multiplyScalar(ft).round())},this.getScissorTest=function(){return kt},this.setScissorTest=function(ue){gn.setScissorTest(kt=ue)},this.setOpaqueSort=function(ue){ke=ue},this.setTransparentSort=function(ue){at=ue},this.getClearColor=function(ue){return ue.copy(He.getClearColor())},this.setClearColor=function(){He.setClearColor.apply(He,arguments)},this.getClearAlpha=function(){return He.getClearAlpha()},this.setClearAlpha=function(){He.setClearAlpha.apply(He,arguments)},this.clear=function(ue=!0,Ne=!0,Ve=!0){let $e=0;if(ue){let Ze=!1;if(ne!==null){const Lt=ne.texture.format;Ze=Lt===YE||Lt===ZE||Lt===XE}if(Ze){const Lt=ne.texture.type,Wt=Lt===Ec||Lt===Bd||Lt===jE||Lt===Lp||Lt===qE||Lt===$E,Kt=He.getClearColor(),It=He.getClearAlpha(),tn=Kt.r,En=Kt.g,nn=Kt.b;Wt?(I[0]=tn,I[1]=En,I[2]=nn,I[3]=It,qe.clearBufferuiv(qe.COLOR,0,I)):(N[0]=tn,N[1]=En,N[2]=nn,N[3]=It,qe.clearBufferiv(qe.COLOR,0,N))}else $e|=qe.COLOR_BUFFER_BIT}Ne&&($e|=qe.DEPTH_BUFFER_BIT),Ve&&($e|=qe.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),qe.clear($e)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",Q,!1),n.removeEventListener("webglcontextrestored",ze,!1),n.removeEventListener("webglcontextcreationerror",Qe,!1),pn.dispose(),Gt.dispose(),Pn.dispose(),qn.dispose(),Ae.dispose(),vt.dispose(),lt.dispose(),Ut.dispose(),Tt.dispose(),yn.dispose(),yn.removeEventListener("sessionstart",pe),yn.removeEventListener("sessionend",we),Se.stop()};function Q(ue){ue.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),Y=!0}function ze(){console.log("THREE.WebGLRenderer: Context Restored."),Y=!1;const ue=un.autoReset,Ne=Ln.enabled,Ve=Ln.autoUpdate,$e=Ln.needsUpdate,Ze=Ln.type;Zt(),un.autoReset=ue,Ln.enabled=Ne,Ln.autoUpdate=Ve,Ln.needsUpdate=$e,Ln.type=Ze}function Qe(ue){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",ue.statusMessage)}function bt(ue){const Ne=ue.target;Ne.removeEventListener("dispose",bt),ae(Ne)}function ae(ue){F(ue),Pn.remove(ue)}function F(ue){const Ne=Pn.get(ue).programs;Ne!==void 0&&(Ne.forEach(function(Ve){Tt.releaseProgram(Ve)}),ue.isShaderMaterial&&Tt.releaseShaderCache(ue))}this.renderBufferDirect=function(ue,Ne,Ve,$e,Ze,Lt){Ne===null&&(Ne=Sn);const Wt=Ze.isMesh&&Ze.matrixWorld.determinant()<0,Kt=bn(ue,Ne,Ve,$e,Ze);gn.setMaterial($e,Wt);let It=Ve.index,tn=1;if($e.wireframe===!0){if(It=tt.getWireframeAttribute(Ve),It===void 0)return;tn=2}const En=Ve.drawRange,nn=Ve.attributes.position;let yr=En.start*tn,Zr=(En.start+En.count)*tn;Lt!==null&&(yr=Math.max(yr,Lt.start*tn),Zr=Math.min(Zr,(Lt.start+Lt.count)*tn)),It!==null?(yr=Math.max(yr,0),Zr=Math.min(Zr,It.count)):nn!=null&&(yr=Math.max(yr,0),Zr=Math.min(Zr,nn.count));const fr=Zr-yr;if(fr<0||fr===1/0)return;lt.setup(Ze,$e,Kt,Ve,It);let Rr,ar=Rn;if(It!==null&&(Rr=se.get(It),ar=xn,ar.setIndex(Rr)),Ze.isMesh)$e.wireframe===!0?(gn.setLineWidth($e.wireframeLinewidth*Dn()),ar.setMode(qe.LINES)):ar.setMode(qe.TRIANGLES);else if(Ze.isLine){let wn=$e.linewidth;wn===void 0&&(wn=1),gn.setLineWidth(wn*Dn()),Ze.isLineSegments?ar.setMode(qe.LINES):Ze.isLineLoop?ar.setMode(qe.LINE_LOOP):ar.setMode(qe.LINE_STRIP)}else Ze.isPoints?ar.setMode(qe.POINTS):Ze.isSprite&&ar.setMode(qe.TRIANGLES);if(Ze.isBatchedMesh)Ze._multiDrawInstances!==null?ar.renderMultiDrawInstances(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount,Ze._multiDrawInstances):ar.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else if(Ze.isInstancedMesh)ar.renderInstances(yr,fr,Ze.count);else if(Ve.isInstancedBufferGeometry){const wn=Ve._maxInstanceCount!==void 0?Ve._maxInstanceCount:1/0,hi=Math.min(Ve.instanceCount,wn);ar.renderInstances(yr,fr,hi)}else ar.render(yr,fr)};function O(ue,Ne,Ve){ue.transparent===!0&&ue.side===fo&&ue.forceSinglePass===!1?(ue.side=za,ue.needsUpdate=!0,Pt(ue,Ne,Ve),ue.side=Tc,ue.needsUpdate=!0,Pt(ue,Ne,Ve),ue.side=fo):Pt(ue,Ne,Ve)}this.compile=function(ue,Ne,Ve=null){Ve===null&&(Ve=ue),k=Gt.get(Ve),k.init(Ne),U.push(k),Ve.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Ne.layers)&&(k.pushLight(Ze),Ze.castShadow&&k.pushShadow(Ze))}),ue!==Ve&&ue.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Ne.layers)&&(k.pushLight(Ze),Ze.castShadow&&k.pushShadow(Ze))}),k.setupLights(V._useLegacyLights);const $e=new Set;return ue.traverse(function(Ze){const Lt=Ze.material;if(Lt)if(Array.isArray(Lt))for(let Wt=0;Wt<Lt.length;Wt++){const Kt=Lt[Wt];O(Kt,Ve,Ze),$e.add(Kt)}else O(Lt,Ve,Ze),$e.add(Lt)}),U.pop(),k=null,$e},this.compileAsync=function(ue,Ne,Ve=null){const $e=this.compile(ue,Ne,Ve);return new Promise(Ze=>{function Lt(){if($e.forEach(function(Wt){Pn.get(Wt).currentProgram.isReady()&&$e.delete(Wt)}),$e.size===0){Ze(ue);return}setTimeout(Lt,10)}hn.get("KHR_parallel_shader_compile")!==null?Lt():setTimeout(Lt,10)})};let q=null;function te(ue){q&&q(ue)}function pe(){Se.stop()}function we(){Se.start()}const Se=new hA;Se.setAnimationLoop(te),typeof self<"u"&&Se.setContext(self),this.setAnimationLoop=function(ue){q=ue,yn.setAnimationLoop(ue),ue===null?Se.stop():Se.start()},yn.addEventListener("sessionstart",pe),yn.addEventListener("sessionend",we),this.render=function(ue,Ne){if(Ne!==void 0&&Ne.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(Y===!0)return;ue.matrixWorldAutoUpdate===!0&&ue.updateMatrixWorld(),Ne.parent===null&&Ne.matrixWorldAutoUpdate===!0&&Ne.updateMatrixWorld(),yn.enabled===!0&&yn.isPresenting===!0&&(yn.cameraAutoUpdate===!0&&yn.updateCamera(Ne),Ne=yn.getCamera()),ue.isScene===!0&&ue.onBeforeRender(V,ue,Ne,ne),k=Gt.get(ue,U.length),k.init(Ne),U.push(k),Ft.multiplyMatrices(Ne.projectionMatrix,Ne.matrixWorldInverse),Cn.setFromProjectionMatrix(Ft),Mt=this.localClippingEnabled,it=Ht.init(this.clippingPlanes,Mt),B=pn.get(ue,C.length),B.init(),C.push(B),ge(ue,Ne,0,V.sortObjects),B.finish(),V.sortObjects===!0&&B.sort(ke,at);const Ve=yn.enabled===!1||yn.isPresenting===!1||yn.hasDepthSensing()===!1;Ve&&He.addToRenderList(B,ue),this.info.render.frame++,it===!0&&Ht.beginShadows();const $e=k.state.shadowsArray;Ln.render($e,ue,Ne),it===!0&&Ht.endShadows(),this.info.autoReset===!0&&this.info.reset();const Ze=B.opaque,Lt=B.transmissive;if(k.setupLights(V._useLegacyLights),Ne.isArrayCamera){const Wt=Ne.cameras;if(Lt.length>0)for(let Kt=0,It=Wt.length;Kt<It;Kt++){const tn=Wt[Kt];Ye(Ze,Lt,ue,tn)}Ve&&He.render(ue);for(let Kt=0,It=Wt.length;Kt<It;Kt++){const tn=Wt[Kt];Pe(B,ue,tn,tn.viewport)}}else Lt.length>0&&Ye(Ze,Lt,ue,Ne),Ve&&He.render(ue),Pe(B,ue,Ne);ne!==null&&(je.updateMultisampleRenderTarget(ne),je.updateRenderTargetMipmap(ne)),ue.isScene===!0&&ue.onAfterRender(V,ue,Ne),lt.resetDefaultState(),xe=-1,ie=null,U.pop(),U.length>0?(k=U[U.length-1],it===!0&&Ht.setGlobalState(V.clippingPlanes,k.state.camera)):k=null,C.pop(),C.length>0?B=C[C.length-1]:B=null};function ge(ue,Ne,Ve,$e){if(ue.visible===!1)return;if(ue.layers.test(Ne.layers)){if(ue.isGroup)Ve=ue.renderOrder;else if(ue.isLOD)ue.autoUpdate===!0&&ue.update(Ne);else if(ue.isLight)k.pushLight(ue),ue.castShadow&&k.pushShadow(ue);else if(ue.isSprite){if(!ue.frustumCulled||Cn.intersectsSprite(ue)){$e&&At.setFromMatrixPosition(ue.matrixWorld).applyMatrix4(Ft);const Wt=vt.update(ue),Kt=ue.material;Kt.visible&&B.push(ue,Wt,Kt,Ve,At.z,null)}}else if((ue.isMesh||ue.isLine||ue.isPoints)&&(!ue.frustumCulled||Cn.intersectsObject(ue))){const Wt=vt.update(ue),Kt=ue.material;if($e&&(ue.boundingSphere!==void 0?(ue.boundingSphere===null&&ue.computeBoundingSphere(),At.copy(ue.boundingSphere.center)):(Wt.boundingSphere===null&&Wt.computeBoundingSphere(),At.copy(Wt.boundingSphere.center)),At.applyMatrix4(ue.matrixWorld).applyMatrix4(Ft)),Array.isArray(Kt)){const It=Wt.groups;for(let tn=0,En=It.length;tn<En;tn++){const nn=It[tn],yr=Kt[nn.materialIndex];yr&&yr.visible&&B.push(ue,Wt,yr,Ve,At.z,nn)}}else Kt.visible&&B.push(ue,Wt,Kt,Ve,At.z,null)}}const Lt=ue.children;for(let Wt=0,Kt=Lt.length;Wt<Kt;Wt++)ge(Lt[Wt],Ne,Ve,$e)}function Pe(ue,Ne,Ve,$e){const Ze=ue.opaque,Lt=ue.transmissive,Wt=ue.transparent;k.setupLightsView(Ve),it===!0&&Ht.setGlobalState(V.clippingPlanes,Ve),$e&&gn.viewport(J.copy($e)),Ze.length>0&&Ke(Ze,Ne,Ve),Lt.length>0&&Ke(Lt,Ne,Ve),Wt.length>0&&Ke(Wt,Ne,Ve),gn.buffers.depth.setTest(!0),gn.buffers.depth.setMask(!0),gn.buffers.color.setMask(!0),gn.setPolygonOffset(!1)}function Ye(ue,Ne,Ve,$e){if((Ve.isScene===!0?Ve.overrideMaterial:null)!==null)return;k.state.transmissionRenderTarget[$e.id]===void 0&&(k.state.transmissionRenderTarget[$e.id]=new Uu(1,1,{generateMipmaps:!0,type:hn.has("EXT_color_buffer_half_float")||hn.has("EXT_color_buffer_float")?Ev:Ec,minFilter:Cu,samples:4,stencilBuffer:c,resolveDepthBuffer:!1,resolveStencilBuffer:!1}));const Lt=k.state.transmissionRenderTarget[$e.id],Wt=$e.viewport||J;Lt.setSize(Wt.z,Wt.w);const Kt=V.getRenderTarget();V.setRenderTarget(Lt),V.getClearColor(Re),We=V.getClearAlpha(),We<1&&V.setClearColor(16777215,.5),V.clear();const It=V.toneMapping;V.toneMapping=wc;const tn=$e.viewport;if($e.viewport!==void 0&&($e.viewport=void 0),k.setupLightsView($e),it===!0&&Ht.setGlobalState(V.clippingPlanes,$e),Ke(ue,Ve,$e),je.updateMultisampleRenderTarget(Lt),je.updateRenderTargetMipmap(Lt),hn.has("WEBGL_multisampled_render_to_texture")===!1){let En=!1;for(let nn=0,yr=Ne.length;nn<yr;nn++){const Zr=Ne[nn],fr=Zr.object,Rr=Zr.geometry,ar=Zr.material,wn=Zr.group;if(ar.side===fo&&fr.layers.test($e.layers)){const hi=ar.side;ar.side=za,ar.needsUpdate=!0,Xe(fr,Ve,$e,Rr,ar,wn),ar.side=hi,ar.needsUpdate=!0,En=!0}}En===!0&&(je.updateMultisampleRenderTarget(Lt),je.updateRenderTargetMipmap(Lt))}V.setRenderTarget(Kt),V.setClearColor(Re,We),tn!==void 0&&($e.viewport=tn),V.toneMapping=It}function Ke(ue,Ne,Ve){const $e=Ne.isScene===!0?Ne.overrideMaterial:null;for(let Ze=0,Lt=ue.length;Ze<Lt;Ze++){const Wt=ue[Ze],Kt=Wt.object,It=Wt.geometry,tn=$e===null?Wt.material:$e,En=Wt.group;Kt.layers.test(Ve.layers)&&Xe(Kt,Ne,Ve,It,tn,En)}}function Xe(ue,Ne,Ve,$e,Ze,Lt){ue.onBeforeRender(V,Ne,Ve,$e,Ze,Lt),ue.modelViewMatrix.multiplyMatrices(Ve.matrixWorldInverse,ue.matrixWorld),ue.normalMatrix.getNormalMatrix(ue.modelViewMatrix),Ze.onBeforeRender(V,Ne,Ve,$e,ue,Lt),Ze.transparent===!0&&Ze.side===fo&&Ze.forceSinglePass===!1?(Ze.side=za,Ze.needsUpdate=!0,V.renderBufferDirect(Ve,Ne,$e,Ze,ue,Lt),Ze.side=Tc,Ze.needsUpdate=!0,V.renderBufferDirect(Ve,Ne,$e,Ze,ue,Lt),Ze.side=fo):V.renderBufferDirect(Ve,Ne,$e,Ze,ue,Lt),ue.onAfterRender(V,Ne,Ve,$e,Ze,Lt)}function Pt(ue,Ne,Ve){Ne.isScene!==!0&&(Ne=Sn);const $e=Pn.get(ue),Ze=k.state.lights,Lt=k.state.shadowsArray,Wt=Ze.state.version,Kt=Tt.getParameters(ue,Ze.state,Lt,Ne,Ve),It=Tt.getProgramCacheKey(Kt);let tn=$e.programs;$e.environment=ue.isMeshStandardMaterial?Ne.environment:null,$e.fog=Ne.fog,$e.envMap=(ue.isMeshStandardMaterial?Ae:qn).get(ue.envMap||$e.environment),$e.envMapRotation=$e.environment!==null&&ue.envMap===null?Ne.environmentRotation:ue.envMapRotation,tn===void 0&&(ue.addEventListener("dispose",bt),tn=new Map,$e.programs=tn);let En=tn.get(It);if(En!==void 0){if($e.currentProgram===En&&$e.lightsStateVersion===Wt)return an(ue,Kt),En}else Kt.uniforms=Tt.getUniforms(ue),ue.onBuild(Ve,Kt,V),ue.onBeforeCompile(Kt,V),En=Tt.acquireProgram(Kt,It),tn.set(It,En),$e.uniforms=Kt.uniforms;const nn=$e.uniforms;return(!ue.isShaderMaterial&&!ue.isRawShaderMaterial||ue.clipping===!0)&&(nn.clippingPlanes=Ht.uniform),an(ue,Kt),$e.needsLights=sr(ue),$e.lightsStateVersion=Wt,$e.needsLights&&(nn.ambientLightColor.value=Ze.state.ambient,nn.lightProbe.value=Ze.state.probe,nn.directionalLights.value=Ze.state.directional,nn.directionalLightShadows.value=Ze.state.directionalShadow,nn.spotLights.value=Ze.state.spot,nn.spotLightShadows.value=Ze.state.spotShadow,nn.rectAreaLights.value=Ze.state.rectArea,nn.ltc_1.value=Ze.state.rectAreaLTC1,nn.ltc_2.value=Ze.state.rectAreaLTC2,nn.pointLights.value=Ze.state.point,nn.pointLightShadows.value=Ze.state.pointShadow,nn.hemisphereLights.value=Ze.state.hemi,nn.directionalShadowMap.value=Ze.state.directionalShadowMap,nn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,nn.spotShadowMap.value=Ze.state.spotShadowMap,nn.spotLightMatrix.value=Ze.state.spotLightMatrix,nn.spotLightMap.value=Ze.state.spotLightMap,nn.pointShadowMap.value=Ze.state.pointShadowMap,nn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),$e.currentProgram=En,$e.uniformsList=null,En}function en(ue){if(ue.uniformsList===null){const Ne=ue.currentProgram.getUniforms();ue.uniformsList=i1.seqWithValue(Ne.seq,ue.uniforms)}return ue.uniformsList}function an(ue,Ne){const Ve=Pn.get(ue);Ve.outputColorSpace=Ne.outputColorSpace,Ve.batching=Ne.batching,Ve.instancing=Ne.instancing,Ve.instancingColor=Ne.instancingColor,Ve.instancingMorph=Ne.instancingMorph,Ve.skinning=Ne.skinning,Ve.morphTargets=Ne.morphTargets,Ve.morphNormals=Ne.morphNormals,Ve.morphColors=Ne.morphColors,Ve.morphTargetsCount=Ne.morphTargetsCount,Ve.numClippingPlanes=Ne.numClippingPlanes,Ve.numIntersection=Ne.numClipIntersection,Ve.vertexAlphas=Ne.vertexAlphas,Ve.vertexTangents=Ne.vertexTangents,Ve.toneMapping=Ne.toneMapping}function bn(ue,Ne,Ve,$e,Ze){Ne.isScene!==!0&&(Ne=Sn),je.resetTextureUnits();const Lt=Ne.fog,Wt=$e.isMeshStandardMaterial?Ne.environment:null,Kt=ne===null?V.outputColorSpace:ne.isXRRenderTarget===!0?ne.texture.colorSpace:zc,It=($e.isMeshStandardMaterial?Ae:qn).get($e.envMap||Wt),tn=$e.vertexColors===!0&&!!Ve.attributes.color&&Ve.attributes.color.itemSize===4,En=!!Ve.attributes.tangent&&(!!$e.normalMap||$e.anisotropy>0),nn=!!Ve.morphAttributes.position,yr=!!Ve.morphAttributes.normal,Zr=!!Ve.morphAttributes.color;let fr=wc;$e.toneMapped&&(ne===null||ne.isXRRenderTarget===!0)&&(fr=V.toneMapping);const Rr=Ve.morphAttributes.position||Ve.morphAttributes.normal||Ve.morphAttributes.color,ar=Rr!==void 0?Rr.length:0,wn=Pn.get($e),hi=k.state.lights;if(it===!0&&(Mt===!0||ue!==ie)){const vi=ue===ie&&$e.id===xe;Ht.setState($e,ue,vi)}let pr=!1;$e.version===wn.__version?(wn.needsLights&&wn.lightsStateVersion!==hi.state.version||wn.outputColorSpace!==Kt||Ze.isBatchedMesh&&wn.batching===!1||!Ze.isBatchedMesh&&wn.batching===!0||Ze.isInstancedMesh&&wn.instancing===!1||!Ze.isInstancedMesh&&wn.instancing===!0||Ze.isSkinnedMesh&&wn.skinning===!1||!Ze.isSkinnedMesh&&wn.skinning===!0||Ze.isInstancedMesh&&wn.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&wn.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&wn.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&wn.instancingMorph===!1&&Ze.morphTexture!==null||wn.envMap!==It||$e.fog===!0&&wn.fog!==Lt||wn.numClippingPlanes!==void 0&&(wn.numClippingPlanes!==Ht.numPlanes||wn.numIntersection!==Ht.numIntersection)||wn.vertexAlphas!==tn||wn.vertexTangents!==En||wn.morphTargets!==nn||wn.morphNormals!==yr||wn.morphColors!==Zr||wn.toneMapping!==fr||wn.morphTargetsCount!==ar)&&(pr=!0):(pr=!0,wn.__version=$e.version);let Ti=wn.currentProgram;pr===!0&&(Ti=Pt($e,Ne,Ze));let Ir=!1,Na=!1,Ba=!1;const $n=Ti.getUniforms(),Ei=wn.uniforms;if(gn.useProgram(Ti.program)&&(Ir=!0,Na=!0,Ba=!0),$e.id!==xe&&(xe=$e.id,Na=!0),Ir||ie!==ue){$n.setValue(qe,"projectionMatrix",ue.projectionMatrix),$n.setValue(qe,"viewMatrix",ue.matrixWorldInverse);const vi=$n.map.cameraPosition;vi!==void 0&&vi.setValue(qe,At.setFromMatrixPosition(ue.matrixWorld)),Gn.logarithmicDepthBuffer&&$n.setValue(qe,"logDepthBufFC",2/(Math.log(ue.far+1)/Math.LN2)),($e.isMeshPhongMaterial||$e.isMeshToonMaterial||$e.isMeshLambertMaterial||$e.isMeshBasicMaterial||$e.isMeshStandardMaterial||$e.isShaderMaterial)&&$n.setValue(qe,"isOrthographic",ue.isOrthographicCamera===!0),ie!==ue&&(ie=ue,Na=!0,Ba=!0)}if(Ze.isSkinnedMesh){$n.setOptional(qe,Ze,"bindMatrix"),$n.setOptional(qe,Ze,"bindMatrixInverse");const vi=Ze.skeleton;vi&&(vi.boneTexture===null&&vi.computeBoneTexture(),$n.setValue(qe,"boneTexture",vi.boneTexture,je))}Ze.isBatchedMesh&&($n.setOptional(qe,Ze,"batchingTexture"),$n.setValue(qe,"batchingTexture",Ze._matricesTexture,je));const zi=Ve.morphAttributes;if((zi.position!==void 0||zi.normal!==void 0||zi.color!==void 0)&&on.update(Ze,Ve,Ti),(Na||wn.receiveShadow!==Ze.receiveShadow)&&(wn.receiveShadow=Ze.receiveShadow,$n.setValue(qe,"receiveShadow",Ze.receiveShadow)),$e.isMeshGouraudMaterial&&$e.envMap!==null&&(Ei.envMap.value=It,Ei.flipEnvMap.value=It.isCubeTexture&&It.isRenderTargetTexture===!1?-1:1),$e.isMeshStandardMaterial&&$e.envMap===null&&Ne.environment!==null&&(Ei.envMapIntensity.value=Ne.environmentIntensity),Na&&($n.setValue(qe,"toneMappingExposure",V.toneMappingExposure),wn.needsLights&&Mn(Ei,Ba),Lt&&$e.fog===!0&&wt.refreshFogUniforms(Ei,Lt),wt.refreshMaterialUniforms(Ei,$e,ft,gt,k.state.transmissionRenderTarget[ue.id]),i1.upload(qe,en(wn),Ei,je)),$e.isShaderMaterial&&$e.uniformsNeedUpdate===!0&&(i1.upload(qe,en(wn),Ei,je),$e.uniformsNeedUpdate=!1),$e.isSpriteMaterial&&$n.setValue(qe,"center",Ze.center),$n.setValue(qe,"modelViewMatrix",Ze.modelViewMatrix),$n.setValue(qe,"normalMatrix",Ze.normalMatrix),$n.setValue(qe,"modelMatrix",Ze.matrixWorld),$e.isShaderMaterial||$e.isRawShaderMaterial){const vi=$e.uniformsGroups;for(let Wi=0,Bc=vi.length;Wi<Bc;Wi++){const Ps=vi[Wi];Ut.update(Ps,Ti),Ut.bind(Ps,Ti)}}return Ti}function Mn(ue,Ne){ue.ambientLightColor.needsUpdate=Ne,ue.lightProbe.needsUpdate=Ne,ue.directionalLights.needsUpdate=Ne,ue.directionalLightShadows.needsUpdate=Ne,ue.pointLights.needsUpdate=Ne,ue.pointLightShadows.needsUpdate=Ne,ue.spotLights.needsUpdate=Ne,ue.spotLightShadows.needsUpdate=Ne,ue.rectAreaLights.needsUpdate=Ne,ue.hemisphereLights.needsUpdate=Ne}function sr(ue){return ue.isMeshLambertMaterial||ue.isMeshToonMaterial||ue.isMeshPhongMaterial||ue.isMeshStandardMaterial||ue.isShadowMaterial||ue.isShaderMaterial&&ue.lights===!0}this.getActiveCubeFace=function(){return he},this.getActiveMipmapLevel=function(){return Z},this.getRenderTarget=function(){return ne},this.setRenderTargetTextures=function(ue,Ne,Ve){Pn.get(ue.texture).__webglTexture=Ne,Pn.get(ue.depthTexture).__webglTexture=Ve;const $e=Pn.get(ue);$e.__hasExternalTextures=!0,$e.__autoAllocateDepthBuffer=Ve===void 0,$e.__autoAllocateDepthBuffer||hn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),$e.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(ue,Ne){const Ve=Pn.get(ue);Ve.__webglFramebuffer=Ne,Ve.__useDefaultFramebuffer=Ne===void 0},this.setRenderTarget=function(ue,Ne=0,Ve=0){ne=ue,he=Ne,Z=Ve;let $e=!0,Ze=null,Lt=!1,Wt=!1;if(ue){const It=Pn.get(ue);It.__useDefaultFramebuffer!==void 0?(gn.bindFramebuffer(qe.FRAMEBUFFER,null),$e=!1):It.__webglFramebuffer===void 0?je.setupRenderTarget(ue):It.__hasExternalTextures&&je.rebindTextures(ue,Pn.get(ue.texture).__webglTexture,Pn.get(ue.depthTexture).__webglTexture);const tn=ue.texture;(tn.isData3DTexture||tn.isDataArrayTexture||tn.isCompressedArrayTexture)&&(Wt=!0);const En=Pn.get(ue).__webglFramebuffer;ue.isWebGLCubeRenderTarget?(Array.isArray(En[Ne])?Ze=En[Ne][Ve]:Ze=En[Ne],Lt=!0):ue.samples>0&&je.useMultisampledRTT(ue)===!1?Ze=Pn.get(ue).__webglMultisampledFramebuffer:Array.isArray(En)?Ze=En[Ve]:Ze=En,J.copy(ue.viewport),Te.copy(ue.scissor),Be=ue.scissorTest}else J.copy(ot).multiplyScalar(ft).floor(),Te.copy(_t).multiplyScalar(ft).floor(),Be=kt;if(gn.bindFramebuffer(qe.FRAMEBUFFER,Ze)&&$e&&gn.drawBuffers(ue,Ze),gn.viewport(J),gn.scissor(Te),gn.setScissorTest(Be),Lt){const It=Pn.get(ue.texture);qe.framebufferTexture2D(qe.FRAMEBUFFER,qe.COLOR_ATTACHMENT0,qe.TEXTURE_CUBE_MAP_POSITIVE_X+Ne,It.__webglTexture,Ve)}else if(Wt){const It=Pn.get(ue.texture),tn=Ne||0;qe.framebufferTextureLayer(qe.FRAMEBUFFER,qe.COLOR_ATTACHMENT0,It.__webglTexture,Ve||0,tn)}xe=-1},this.readRenderTargetPixels=function(ue,Ne,Ve,$e,Ze,Lt,Wt){if(!(ue&&ue.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let Kt=Pn.get(ue).__webglFramebuffer;if(ue.isWebGLCubeRenderTarget&&Wt!==void 0&&(Kt=Kt[Wt]),Kt){gn.bindFramebuffer(qe.FRAMEBUFFER,Kt);try{const It=ue.texture,tn=It.format,En=It.type;if(!Gn.textureFormatReadable(tn)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Gn.textureTypeReadable(En)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Ne>=0&&Ne<=ue.width-$e&&Ve>=0&&Ve<=ue.height-Ze&&qe.readPixels(Ne,Ve,$e,Ze,Qt.convert(tn),Qt.convert(En),Lt)}finally{const It=ne!==null?Pn.get(ne).__webglFramebuffer:null;gn.bindFramebuffer(qe.FRAMEBUFFER,It)}}},this.copyFramebufferToTexture=function(ue,Ne,Ve=0){const $e=Math.pow(2,-Ve),Ze=Math.floor(Ne.image.width*$e),Lt=Math.floor(Ne.image.height*$e);je.setTexture2D(Ne,0),qe.copyTexSubImage2D(qe.TEXTURE_2D,Ve,0,0,ue.x,ue.y,Ze,Lt),gn.unbindTexture()},this.copyTextureToTexture=function(ue,Ne,Ve,$e=0){const Ze=Ne.image.width,Lt=Ne.image.height,Wt=Qt.convert(Ve.format),Kt=Qt.convert(Ve.type);je.setTexture2D(Ve,0),qe.pixelStorei(qe.UNPACK_FLIP_Y_WEBGL,Ve.flipY),qe.pixelStorei(qe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Ve.premultiplyAlpha),qe.pixelStorei(qe.UNPACK_ALIGNMENT,Ve.unpackAlignment),Ne.isDataTexture?qe.texSubImage2D(qe.TEXTURE_2D,$e,ue.x,ue.y,Ze,Lt,Wt,Kt,Ne.image.data):Ne.isCompressedTexture?qe.compressedTexSubImage2D(qe.TEXTURE_2D,$e,ue.x,ue.y,Ne.mipmaps[0].width,Ne.mipmaps[0].height,Wt,Ne.mipmaps[0].data):qe.texSubImage2D(qe.TEXTURE_2D,$e,ue.x,ue.y,Wt,Kt,Ne.image),$e===0&&Ve.generateMipmaps&&qe.generateMipmap(qe.TEXTURE_2D),gn.unbindTexture()},this.copyTextureToTexture3D=function(ue,Ne,Ve,$e,Ze=0){const Lt=ue.max.x-ue.min.x,Wt=ue.max.y-ue.min.y,Kt=ue.max.z-ue.min.z,It=Qt.convert($e.format),tn=Qt.convert($e.type);let En;if($e.isData3DTexture)je.setTexture3D($e,0),En=qe.TEXTURE_3D;else if($e.isDataArrayTexture||$e.isCompressedArrayTexture)je.setTexture2DArray($e,0),En=qe.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}qe.pixelStorei(qe.UNPACK_FLIP_Y_WEBGL,$e.flipY),qe.pixelStorei(qe.UNPACK_PREMULTIPLY_ALPHA_WEBGL,$e.premultiplyAlpha),qe.pixelStorei(qe.UNPACK_ALIGNMENT,$e.unpackAlignment);const nn=qe.getParameter(qe.UNPACK_ROW_LENGTH),yr=qe.getParameter(qe.UNPACK_IMAGE_HEIGHT),Zr=qe.getParameter(qe.UNPACK_SKIP_PIXELS),fr=qe.getParameter(qe.UNPACK_SKIP_ROWS),Rr=qe.getParameter(qe.UNPACK_SKIP_IMAGES),ar=Ve.isCompressedTexture?Ve.mipmaps[Ze]:Ve.image;qe.pixelStorei(qe.UNPACK_ROW_LENGTH,ar.width),qe.pixelStorei(qe.UNPACK_IMAGE_HEIGHT,ar.height),qe.pixelStorei(qe.UNPACK_SKIP_PIXELS,ue.min.x),qe.pixelStorei(qe.UNPACK_SKIP_ROWS,ue.min.y),qe.pixelStorei(qe.UNPACK_SKIP_IMAGES,ue.min.z),Ve.isDataTexture||Ve.isData3DTexture?qe.texSubImage3D(En,Ze,Ne.x,Ne.y,Ne.z,Lt,Wt,Kt,It,tn,ar.data):$e.isCompressedArrayTexture?qe.compressedTexSubImage3D(En,Ze,Ne.x,Ne.y,Ne.z,Lt,Wt,Kt,It,ar.data):qe.texSubImage3D(En,Ze,Ne.x,Ne.y,Ne.z,Lt,Wt,Kt,It,tn,ar),qe.pixelStorei(qe.UNPACK_ROW_LENGTH,nn),qe.pixelStorei(qe.UNPACK_IMAGE_HEIGHT,yr),qe.pixelStorei(qe.UNPACK_SKIP_PIXELS,Zr),qe.pixelStorei(qe.UNPACK_SKIP_ROWS,fr),qe.pixelStorei(qe.UNPACK_SKIP_IMAGES,Rr),Ze===0&&$e.generateMipmaps&&qe.generateMipmap(En),gn.unbindTexture()},this.initTexture=function(ue){ue.isCubeTexture?je.setTextureCube(ue,0):ue.isData3DTexture?je.setTexture3D(ue,0):ue.isDataArrayTexture||ue.isCompressedArrayTexture?je.setTexture2DArray(ue,0):je.setTexture2D(ue,0),gn.unbindTexture()},this.resetState=function(){he=0,Z=0,ne=null,gn.reset(),lt.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return il}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const n=this.getContext();n.drawingBufferColorSpace=e===Vb?"display-p3":"srgb",n.unpackColorSpace=wr.workingColorSpace===Av?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class oO extends es{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new pl,this.environmentIntensity=1,this.environmentRotation=new pl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,n){return super.copy(e,n),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const n=super.toJSON(e);return this.fog!==null&&(n.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(n.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(n.object.backgroundIntensity=this.backgroundIntensity),n.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(n.object.environmentIntensity=this.environmentIntensity),n.object.environmentRotation=this.environmentRotation.toArray(),n}}class $0 extends Fc{constructor(e=1,n=32,r=16,s=0,c=Math.PI*2,h=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:n,heightSegments:r,phiStart:s,phiLength:c,thetaStart:h,thetaLength:l},n=Math.max(3,Math.floor(n)),r=Math.max(2,Math.floor(r));const m=Math.min(h+l,Math.PI);let _=0;const S=[],T=new st,M=new st,I=[],N=[],B=[],k=[];for(let C=0;C<=r;C++){const U=[],V=C/r;let Y=0;C===0&&h===0?Y=.5/n:C===r&&m===Math.PI&&(Y=-.5/n);for(let he=0;he<=n;he++){const Z=he/n;T.x=-e*Math.cos(s+Z*c)*Math.sin(h+V*l),T.y=e*Math.cos(h+V*l),T.z=e*Math.sin(s+Z*c)*Math.sin(h+V*l),N.push(T.x,T.y,T.z),M.copy(T).normalize(),B.push(M.x,M.y,M.z),k.push(Z+Y,1-V),U.push(_++)}S.push(U)}for(let C=0;C<r;C++)for(let U=0;U<n;U++){const V=S[C][U+1],Y=S[C][U],he=S[C+1][U],Z=S[C+1][U+1];(C!==0||h>0)&&I.push(V,Y,Z),(C!==r-1||m<Math.PI)&&I.push(Y,he,Z)}this.setIndex(I),this.setAttribute("position",new bo(N,3)),this.setAttribute("normal",new bo(B,3)),this.setAttribute("uv",new bo(k,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new $0(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const Y5={enabled:!1,files:{},add:function(t,e){this.enabled!==!1&&(this.files[t]=e)},get:function(t){if(this.enabled!==!1)return this.files[t]},remove:function(t){delete this.files[t]},clear:function(){this.files={}}};class lO{constructor(e,n,r){const s=this;let c=!1,h=0,l=0,m;const _=[];this.onStart=void 0,this.onLoad=e,this.onProgress=n,this.onError=r,this.itemStart=function(S){l++,c===!1&&s.onStart!==void 0&&s.onStart(S,h,l),c=!0},this.itemEnd=function(S){h++,s.onProgress!==void 0&&s.onProgress(S,h,l),h===l&&(c=!1,s.onLoad!==void 0&&s.onLoad())},this.itemError=function(S){s.onError!==void 0&&s.onError(S)},this.resolveURL=function(S){return m?m(S):S},this.setURLModifier=function(S){return m=S,this},this.addHandler=function(S,T){return _.push(S,T),this},this.removeHandler=function(S){const T=_.indexOf(S);return T!==-1&&_.splice(T,2),this},this.getHandler=function(S){for(let T=0,M=_.length;T<M;T+=2){const I=_[T],N=_[T+1];if(I.global&&(I.lastIndex=0),I.test(S))return N}return null}}}const cO=new lO;class Wb{constructor(e){this.manager=e!==void 0?e:cO,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,n){const r=this;return new Promise(function(s,c){r.load(e,s,n,c)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Wb.DEFAULT_MATERIAL_NAME="__DEFAULT";class uO extends Wb{constructor(e){super(e)}load(e,n,r,s){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const c=this,h=Y5.get(e);if(h!==void 0)return c.manager.itemStart(e),setTimeout(function(){n&&n(h),c.manager.itemEnd(e)},0),h;const l=_p("img");function m(){S(),Y5.add(e,this),n&&n(this),c.manager.itemEnd(e)}function _(T){S(),s&&s(T),c.manager.itemError(e),c.manager.itemEnd(e)}function S(){l.removeEventListener("load",m,!1),l.removeEventListener("error",_,!1)}return l.addEventListener("load",m,!1),l.addEventListener("error",_,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),c.manager.itemStart(e),l.src=e,l}}class hO extends Wb{constructor(e){super(e)}load(e,n,r,s){const c=new xa,h=new uO(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(l){c.image=l,c.needsUpdate=!0,n!==void 0&&n(c)},r,s),c}}class K5{constructor(e=1,n=0,r=0){return this.radius=e,this.phi=n,this.theta=r,this}set(e,n,r){return this.radius=e,this.phi=n,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,n,r){return this.radius=Math.sqrt(e*e+n*n+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(aa(n/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Ub}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Ub);const J5={type:"change"},Z_={type:"start"},Q5={type:"end"},Dg=new tA,eM=new ac,dO=Math.cos(70*Yk.DEG2RAD);class fO extends qu{constructor(e,n){super(),this.object=e,this.domElement=n,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new st,this.cursor=new st,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Dh.ROTATE,MIDDLE:Dh.DOLLY,RIGHT:Dh.PAN},this.touches={ONE:kh.ROTATE,TWO:kh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(Q){Q.addEventListener("keydown",Ln),this._domElementKeyEvents=Q},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",Ln),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(J5),r.update(),c=s.NONE},this.update=function(){const Q=new st,ze=new Vu().setFromUnitVectors(e.up,new st(0,1,0)),Qe=ze.clone().invert(),bt=new st,ae=new Vu,F=new st,O=2*Math.PI;return function(te=null){const pe=r.object.position;Q.copy(pe).sub(r.target),Q.applyQuaternion(ze),l.setFromVector3(Q),r.autoRotate&&c===s.NONE&&Be(J(te)),r.enableDamping?(l.theta+=m.theta*r.dampingFactor,l.phi+=m.phi*r.dampingFactor):(l.theta+=m.theta,l.phi+=m.phi);let we=r.minAzimuthAngle,Se=r.maxAzimuthAngle;isFinite(we)&&isFinite(Se)&&(we<-Math.PI?we+=O:we>Math.PI&&(we-=O),Se<-Math.PI?Se+=O:Se>Math.PI&&(Se-=O),we<=Se?l.theta=Math.max(we,Math.min(Se,l.theta)):l.theta=l.theta>(we+Se)/2?Math.max(we,l.theta):Math.min(Se,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(S,r.dampingFactor):r.target.add(S),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let ge=!1;if(r.zoomToCursor&&Z||r.object.isOrthographicCamera)l.radius=ot(l.radius);else{const Pe=l.radius;l.radius=ot(l.radius*_),ge=Pe!=l.radius}if(Q.setFromSpherical(l),Q.applyQuaternion(Qe),pe.copy(r.target).add(Q),r.object.lookAt(r.target),r.enableDamping===!0?(m.theta*=1-r.dampingFactor,m.phi*=1-r.dampingFactor,S.multiplyScalar(1-r.dampingFactor)):(m.set(0,0,0),S.set(0,0,0)),r.zoomToCursor&&Z){let Pe=null;if(r.object.isPerspectiveCamera){const Ye=Q.length();Pe=ot(Ye*_);const Ke=Ye-Pe;r.object.position.addScaledVector(Y,Ke),r.object.updateMatrixWorld(),ge=!!Ke}else if(r.object.isOrthographicCamera){const Ye=new st(he.x,he.y,0);Ye.unproject(r.object);const Ke=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/_)),r.object.updateProjectionMatrix(),ge=Ke!==r.object.zoom;const Xe=new st(he.x,he.y,0);Xe.unproject(r.object),r.object.position.sub(Xe).add(Ye),r.object.updateMatrixWorld(),Pe=Q.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Pe!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Pe).add(r.object.position):(Dg.origin.copy(r.object.position),Dg.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(Dg.direction))<dO?e.lookAt(r.target):(eM.setFromNormalAndCoplanarPoint(r.object.up,r.target),Dg.intersectPlane(eM,r.target))))}else if(r.object.isOrthographicCamera){const Pe=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/_)),Pe!==r.object.zoom&&(r.object.updateProjectionMatrix(),ge=!0)}return _=1,Z=!1,ge||bt.distanceToSquared(r.object.position)>h||8*(1-ae.dot(r.object.quaternion))>h||F.distanceToSquared(r.target)>h?(r.dispatchEvent(J5),bt.copy(r.object.position),ae.copy(r.object.quaternion),F.copy(r.target),!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Rn),r.domElement.removeEventListener("pointerdown",Ae),r.domElement.removeEventListener("pointercancel",tt),r.domElement.removeEventListener("wheel",wt),r.domElement.removeEventListener("pointermove",se),r.domElement.removeEventListener("pointerup",tt),r.domElement.getRootNode().removeEventListener("keydown",Gt,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",Ln),r._domElementKeyEvents=null)};const r=this,s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let c=s.NONE;const h=1e-6,l=new K5,m=new K5;let _=1;const S=new st,T=new Yn,M=new Yn,I=new Yn,N=new Yn,B=new Yn,k=new Yn,C=new Yn,U=new Yn,V=new Yn,Y=new st,he=new Yn;let Z=!1;const ne=[],xe={};let ie=!1;function J(Q){return Q!==null?2*Math.PI/60*r.autoRotateSpeed*Q:2*Math.PI/60/60*r.autoRotateSpeed}function Te(Q){const ze=Math.abs(Q*.01);return Math.pow(.95,r.zoomSpeed*ze)}function Be(Q){m.theta-=Q}function Re(Q){m.phi-=Q}const We=function(){const Q=new st;return function(Qe,bt){Q.setFromMatrixColumn(bt,0),Q.multiplyScalar(-Qe),S.add(Q)}}(),ct=function(){const Q=new st;return function(Qe,bt){r.screenSpacePanning===!0?Q.setFromMatrixColumn(bt,1):(Q.setFromMatrixColumn(bt,0),Q.crossVectors(r.object.up,Q)),Q.multiplyScalar(Qe),S.add(Q)}}(),gt=function(){const Q=new st;return function(Qe,bt){const ae=r.domElement;if(r.object.isPerspectiveCamera){const F=r.object.position;Q.copy(F).sub(r.target);let O=Q.length();O*=Math.tan(r.object.fov/2*Math.PI/180),We(2*Qe*O/ae.clientHeight,r.object.matrix),ct(2*bt*O/ae.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(We(Qe*(r.object.right-r.object.left)/r.object.zoom/ae.clientWidth,r.object.matrix),ct(bt*(r.object.top-r.object.bottom)/r.object.zoom/ae.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function ft(Q){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?_/=Q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ke(Q){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?_*=Q:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function at(Q,ze){if(!r.zoomToCursor)return;Z=!0;const Qe=r.domElement.getBoundingClientRect(),bt=Q-Qe.left,ae=ze-Qe.top,F=Qe.width,O=Qe.height;he.x=bt/F*2-1,he.y=-(ae/O)*2+1,Y.set(he.x,he.y,1).unproject(r.object).sub(r.object.position).normalize()}function ot(Q){return Math.max(r.minDistance,Math.min(r.maxDistance,Q))}function _t(Q){T.set(Q.clientX,Q.clientY)}function kt(Q){at(Q.clientX,Q.clientX),C.set(Q.clientX,Q.clientY)}function Cn(Q){N.set(Q.clientX,Q.clientY)}function it(Q){M.set(Q.clientX,Q.clientY),I.subVectors(M,T).multiplyScalar(r.rotateSpeed);const ze=r.domElement;Be(2*Math.PI*I.x/ze.clientHeight),Re(2*Math.PI*I.y/ze.clientHeight),T.copy(M),r.update()}function Mt(Q){U.set(Q.clientX,Q.clientY),V.subVectors(U,C),V.y>0?ft(Te(V.y)):V.y<0&&ke(Te(V.y)),C.copy(U),r.update()}function Ft(Q){B.set(Q.clientX,Q.clientY),k.subVectors(B,N).multiplyScalar(r.panSpeed),gt(k.x,k.y),N.copy(B),r.update()}function At(Q){at(Q.clientX,Q.clientY),Q.deltaY<0?ke(Te(Q.deltaY)):Q.deltaY>0&&ft(Te(Q.deltaY)),r.update()}function Sn(Q){let ze=!1;switch(Q.code){case r.keys.UP:Q.ctrlKey||Q.metaKey||Q.shiftKey?Re(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):gt(0,r.keyPanSpeed),ze=!0;break;case r.keys.BOTTOM:Q.ctrlKey||Q.metaKey||Q.shiftKey?Re(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):gt(0,-r.keyPanSpeed),ze=!0;break;case r.keys.LEFT:Q.ctrlKey||Q.metaKey||Q.shiftKey?Be(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):gt(r.keyPanSpeed,0),ze=!0;break;case r.keys.RIGHT:Q.ctrlKey||Q.metaKey||Q.shiftKey?Be(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):gt(-r.keyPanSpeed,0),ze=!0;break}ze&&(Q.preventDefault(),r.update())}function Dn(Q){if(ne.length===1)T.set(Q.pageX,Q.pageY);else{const ze=Zt(Q),Qe=.5*(Q.pageX+ze.x),bt=.5*(Q.pageY+ze.y);T.set(Qe,bt)}}function qe(Q){if(ne.length===1)N.set(Q.pageX,Q.pageY);else{const ze=Zt(Q),Qe=.5*(Q.pageX+ze.x),bt=.5*(Q.pageY+ze.y);N.set(Qe,bt)}}function Nn(Q){const ze=Zt(Q),Qe=Q.pageX-ze.x,bt=Q.pageY-ze.y,ae=Math.sqrt(Qe*Qe+bt*bt);C.set(0,ae)}function hn(Q){r.enableZoom&&Nn(Q),r.enablePan&&qe(Q)}function Gn(Q){r.enableZoom&&Nn(Q),r.enableRotate&&Dn(Q)}function gn(Q){if(ne.length==1)M.set(Q.pageX,Q.pageY);else{const Qe=Zt(Q),bt=.5*(Q.pageX+Qe.x),ae=.5*(Q.pageY+Qe.y);M.set(bt,ae)}I.subVectors(M,T).multiplyScalar(r.rotateSpeed);const ze=r.domElement;Be(2*Math.PI*I.x/ze.clientHeight),Re(2*Math.PI*I.y/ze.clientHeight),T.copy(M)}function un(Q){if(ne.length===1)B.set(Q.pageX,Q.pageY);else{const ze=Zt(Q),Qe=.5*(Q.pageX+ze.x),bt=.5*(Q.pageY+ze.y);B.set(Qe,bt)}k.subVectors(B,N).multiplyScalar(r.panSpeed),gt(k.x,k.y),N.copy(B)}function Pn(Q){const ze=Zt(Q),Qe=Q.pageX-ze.x,bt=Q.pageY-ze.y,ae=Math.sqrt(Qe*Qe+bt*bt);U.set(0,ae),V.set(0,Math.pow(U.y/C.y,r.zoomSpeed)),ft(V.y),C.copy(U);const F=(Q.pageX+ze.x)*.5,O=(Q.pageY+ze.y)*.5;at(F,O)}function je(Q){r.enableZoom&&Pn(Q),r.enablePan&&un(Q)}function qn(Q){r.enableZoom&&Pn(Q),r.enableRotate&&gn(Q)}function Ae(Q){r.enabled!==!1&&(ne.length===0&&(r.domElement.setPointerCapture(Q.pointerId),r.domElement.addEventListener("pointermove",se),r.domElement.addEventListener("pointerup",tt)),!lt(Q)&&(xn(Q),Q.pointerType==="touch"?He(Q):vt(Q)))}function se(Q){r.enabled!==!1&&(Q.pointerType==="touch"?on(Q):Tt(Q))}function tt(Q){switch(Qt(Q),ne.length){case 0:r.domElement.releasePointerCapture(Q.pointerId),r.domElement.removeEventListener("pointermove",se),r.domElement.removeEventListener("pointerup",tt),r.dispatchEvent(Q5),c=s.NONE;break;case 1:const ze=ne[0],Qe=xe[ze];He({pointerId:ze,pageX:Qe.x,pageY:Qe.y});break}}function vt(Q){let ze;switch(Q.button){case 0:ze=r.mouseButtons.LEFT;break;case 1:ze=r.mouseButtons.MIDDLE;break;case 2:ze=r.mouseButtons.RIGHT;break;default:ze=-1}switch(ze){case Dh.DOLLY:if(r.enableZoom===!1)return;kt(Q),c=s.DOLLY;break;case Dh.ROTATE:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(r.enablePan===!1)return;Cn(Q),c=s.PAN}else{if(r.enableRotate===!1)return;_t(Q),c=s.ROTATE}break;case Dh.PAN:if(Q.ctrlKey||Q.metaKey||Q.shiftKey){if(r.enableRotate===!1)return;_t(Q),c=s.ROTATE}else{if(r.enablePan===!1)return;Cn(Q),c=s.PAN}break;default:c=s.NONE}c!==s.NONE&&r.dispatchEvent(Z_)}function Tt(Q){switch(c){case s.ROTATE:if(r.enableRotate===!1)return;it(Q);break;case s.DOLLY:if(r.enableZoom===!1)return;Mt(Q);break;case s.PAN:if(r.enablePan===!1)return;Ft(Q);break}}function wt(Q){r.enabled===!1||r.enableZoom===!1||c!==s.NONE||(Q.preventDefault(),r.dispatchEvent(Z_),At(pn(Q)),r.dispatchEvent(Q5))}function pn(Q){const ze=Q.deltaMode,Qe={clientX:Q.clientX,clientY:Q.clientY,deltaY:Q.deltaY};switch(ze){case 1:Qe.deltaY*=16;break;case 2:Qe.deltaY*=100;break}return Q.ctrlKey&&!ie&&(Qe.deltaY*=10),Qe}function Gt(Q){Q.key==="Control"&&(ie=!0,r.domElement.getRootNode().addEventListener("keyup",Ht,{passive:!0,capture:!0}))}function Ht(Q){Q.key==="Control"&&(ie=!1,r.domElement.getRootNode().removeEventListener("keyup",Ht,{passive:!0,capture:!0}))}function Ln(Q){r.enabled===!1||r.enablePan===!1||Sn(Q)}function He(Q){switch(Ut(Q),ne.length){case 1:switch(r.touches.ONE){case kh.ROTATE:if(r.enableRotate===!1)return;Dn(Q),c=s.TOUCH_ROTATE;break;case kh.PAN:if(r.enablePan===!1)return;qe(Q),c=s.TOUCH_PAN;break;default:c=s.NONE}break;case 2:switch(r.touches.TWO){case kh.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;hn(Q),c=s.TOUCH_DOLLY_PAN;break;case kh.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;Gn(Q),c=s.TOUCH_DOLLY_ROTATE;break;default:c=s.NONE}break;default:c=s.NONE}c!==s.NONE&&r.dispatchEvent(Z_)}function on(Q){switch(Ut(Q),c){case s.TOUCH_ROTATE:if(r.enableRotate===!1)return;gn(Q),r.update();break;case s.TOUCH_PAN:if(r.enablePan===!1)return;un(Q),r.update();break;case s.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;je(Q),r.update();break;case s.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;qn(Q),r.update();break;default:c=s.NONE}}function Rn(Q){r.enabled!==!1&&Q.preventDefault()}function xn(Q){ne.push(Q.pointerId)}function Qt(Q){delete xe[Q.pointerId];for(let ze=0;ze<ne.length;ze++)if(ne[ze]==Q.pointerId){ne.splice(ze,1);return}}function lt(Q){for(let ze=0;ze<ne.length;ze++)if(ne[ze]==Q.pointerId)return!0;return!1}function Ut(Q){let ze=xe[Q.pointerId];ze===void 0&&(ze=new Yn,xe[Q.pointerId]=ze),ze.set(Q.pageX,Q.pageY)}function Zt(Q){const ze=Q.pointerId===ne[0]?ne[1]:ne[0];return xe[ze]}r.domElement.addEventListener("contextmenu",Rn),r.domElement.addEventListener("pointerdown",Ae),r.domElement.addEventListener("pointercancel",tt),r.domElement.addEventListener("wheel",wt,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",Gt,{passive:!0,capture:!0}),this.update()}}const pO=`uniform float radius;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vPosWorld;
varying vec3 vLightPos;


void main() {
    vec3 sun = vLightPos;

    vec3 pos2sun = sun - vPos;
    float dist2sun = length(pos2sun) / (10.0 * radius);
    dist2sun *= dist2sun * dist2sun;
    float diffuseLightness = 1.0 - dist2sun - 0.2;

    float distanceFromCenter = length(vPosWorld - vec3(0)) / radius;

    float a = 0.0;
    float taperStart = 0.9;
    if (distanceFromCenter > taperStart) {
        float decline = 1.0 / (1.0 - taperStart);
        float offset = distanceFromCenter - taperStart;
        a = offset * decline;
    }
    float alpha = 1.0 - a;

    gl_FragColor = vec4(0.6, 0.7, 0.8, alpha - 0.2);
    gl_FragColor.w *= diffuseLightness;

    if (distanceFromCenter >= 1.0) {
        gl_FragColor = vec4(0);
    }
    // gl_FragColor = vec4(1. - a);
    // gl_FragColor = vec4(1);
    // gl_FragColor = vec4(1. - dist2sun);
}`,mO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
varying vec3 vPosWorld;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vPosWorld = (modelMatrix * vec4(position, 1)).xyz;  // world-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}
`,gO=`varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
uniform sampler2D cloudTex;


void main() {
    vec3 lightPos = vLightPos;
    vec3 lightDir = normalize(lightPos - vPos);
    float lightness = dot(lightDir, vNormal);
    vec4 cloudColor = texture(cloudTex, vUv);
    gl_FragColor = cloudColor;
    gl_FragColor.xyz *= lightness;
    // gl_FragColor.w = 1.0;
}
`,vO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`,yO=`uniform sampler2D dayTexture;
uniform sampler2D nightTexture;
uniform sampler2D displacementMap;
uniform sampler2D normalMap;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vLightPos;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    // texture data
    vec3 normalColor = texture(normalMap, vUv).xyz;
    vec3 landColor = texture(dayTexture, vUv).xyz;
    vec3 nightColor = texture(nightTexture, vUv).xyz;

    // derived data
    vec3 sun = vLightPos;
    vec3 normal = normalize(vNormal + normalColor);
    vec3 posToSun = normalize(sun - vPos);
    float diffuseLightness = dot(posToSun, normal) + 0.6;

    // mixing
    landColor = brighten(landColor, diffuseLightness);
    nightColor = brighten(nightColor, 1.0 - diffuseLightness);
    vec3 outColor = mix(nightColor, landColor, diffuseLightness);

    gl_FragColor = vec4(outColor, 1.0);
}`,_O=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
uniform sampler2D displacementMap;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 heightColor = texture(displacementMap, uv);
  vec3 displacedPosition = position * (1.0 + 0.1 * heightColor.x);
  vec4 newPosCamSpace = modelViewMatrix * vec4(displacedPosition, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}`,xO=`varying vec2 vUv;           // texture-space
varying vec3 vNormal;       // cam-space
varying vec3 vPos;          // cam-space
varying vec3 vLightPos;     // cam-space
uniform float time;
uniform sampler2D landDistance;
uniform sampler2D heightMap;
uniform sampler2D groundTexture;
uniform sampler2D waterNormal1;
uniform sampler2D waterNormal2;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    float landHeight = 0.5;

    // texture data
    float distFromShore = texture(landDistance, vUv).x;
    vec3 groundColor    = texture(groundTexture, vUv).xyz;
    float height        = texture(heightMap, vUv).x;
    vec3 normal1        = texture(waterNormal1, 2.0 * vUv + vec2(0.01, -0.01) * time).xyz;
    vec3 normal2        = texture(waterNormal2, 4.0 * vUv + vec2(-0.01, 0.01) * time).xyz;

    // derived values
    vec3 normal = normalize(vNormal +  0.1 * normal1 + 0.2 * normal2);
    vec3 pos = vPos;
    vec3 sun = vLightPos;
    vec3 pos2cam = vec3(0) - pos;
    vec3 pos2sun = sun - pos;
    float nScale = dot(normal, pos2sun);
    vec3 sunReflected = 2.0 * nScale * normal - sun;
    vec3 pos2reflection = sunReflected - pos;

    // 1. diffuse
    float sunNormalAlignment = dot(normalize(pos2sun), normal);
    float diffuseLightness = sunNormalAlignment;
    
    // 2. specular
    float m = 0.15;
    float pi = 3.14159265359;
    float specAngle = acos(dot(normalize(pos2cam), normalize(pos2reflection)));
    float specularLightness = exp(-(specAngle / m) * (specAngle / m));
    
    // 3. surf
    float surf = 0.0;
    float maxDistFromShore = 0.2;
    if (distFromShore < maxDistFromShore && height < landHeight) {
        surf = sin(distFromShore * 400.0 + time * 5.0) * (1.0 - distFromShore / maxDistFromShore);
    } 

    // 4. combine
    vec3 outColor = groundColor * 0.5                // night color
                  + groundColor * diffuseLightness   // diffuse sunlit color
                  + vec3(surf)  * 0.2                // surf
                  + vec3(1.0)   * specularLightness; // specular

    gl_FragColor = vec4(outColor, 1.0);

    // if (height >= landHeight) {
    //     gl_FragColor = vec4(0);
    // }
}`,bO=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`;async function wO(t){const e=new hO,n={},r=[];for(const[s,c]of Object.entries(t)){const h=e.loadAsync(c).then(l=>n[s]=l);r.push(h)}return await Promise.all(r),n}class SO{constructor(e,n){ht(this,"water");ht(this,"sky");ht(this,"earth");ht(this,"renderer");ht(this,"camera");ht(this,"scene");ht(this,"controls");ht(this,"atmosphere");const{stars:r,earthDay:s,earthNight:c,earthNormal:h,earthHeight:l,landDistance:m,waterNormal1:_,waterNormal2:S,clouds:T}=n,M=100,I=new sO({canvas:e,antialias:!0,failIfMajorPerformanceCaveat:!0}),N=new oO;N.background=r;const B=new vs(50,e.clientWidth/e.clientHeight,.1*M,6*M);B.position.set(0,0,-3*M),B.lookAt(N.position);const k=new st(1e3,0,0),C=new fO(B,e);C.enableZoom=!1;const U=new I0;U.position.set(0,0,0),N.add(U);const V=new Ja(new $0(M,500,250),new bs({vertexShader:_O,fragmentShader:yO,uniforms:{lightPos:{value:k},dayTexture:{value:s},nightTexture:{value:c},normalMap:{value:h},displacementMap:{value:l}}}));U.add(V);const Y=new Ja(new $0(M+5,200,100),new bs({vertexShader:bO,fragmentShader:xO,uniforms:{lightPos:{value:k},time:{value:0},groundTexture:{value:s},heightMap:{value:l},landDistance:{value:m},waterNormal1:{value:_},waterNormal2:{value:S}}}));U.add(Y);const he=new Ja(new $0(M+9),new bs({vertexShader:vO,fragmentShader:gO,uniforms:{lightPos:{value:k},cloudTex:{value:T}},transparent:!0,side:fo}));U.add(he),he.renderOrder=.5;const Z=30,ne=new Ja(new Np(2*(M+Z),2*(M+Z)),new bs({fragmentShader:pO,vertexShader:mO,uniforms:{radius:{value:M+Z},lightPos:{value:k}},transparent:!0}));N.add(ne),ne.renderOrder=.1,this.water=Y,this.sky=he,this.atmosphere=ne,this.earth=U,this.renderer=I,this.camera=B,this.scene=N,this.controls=C}step(e){this.water.material.uniforms.time.value=e.time,this.atmosphere.lookAt(this.camera.position),this.sky.rotateY(.001),this.earth.rotateY(.001),this.renderer.render(this.scene,this.camera),this.controls.update()}destroy(e){const n=r=>{r.dispose();for(const s of Object.keys(r)){const c=r[s];c&&typeof c=="object"&&"minFilter"in c&&c.dispose()}};this.renderer.dispose(),this.scene.traverse(r=>{if(r.isMesh)if(r.geometry.dispose(),r.material.isMaterial)n(r.material);else for(const s of r.material)n(s)})}}class MO{constructor(){ht(this,"destroyed",!1);ht(this,"loop");ht(this,"rp")}async init(e){e.width=e.clientWidth,e.height=e.clientHeight;const{earthDay:n,earthNight:r,earthHeight:s,earthNormal:c,landDistance:h,waterNormal1:l,waterNormal2:m,clouds:_,stars:S}=await wO({earthDay:"/earth.jpg",earthNight:"/earth_night.jpg",earthHeight:"/earth_height.jpg",earthNormal:"/earth_normal.jpg",landDistance:"/land_distance.jpg",waterNormal1:"/water-normal2.jpg",waterNormal2:"/water-normal3.jpg",clouds:"/earth_clouds.png",stars:"/stars.jpg"});if(l.wrapS=Eu,l.wrapT=Eu,m.wrapS=Eu,m.wrapT=Eu,this.destroyed)return;const T=new SO(e,{earthDay:n,earthNight:r,earthHeight:s,earthNormal:c,landDistance:h,waterNormal1:l,waterNormal2:m,clouds:_,stars:S});this.loop=new kp(30,M=>{T.step({time:M/1e3})}),this.rp=T}startLoop(){var e;(e=this.loop)==null||e.startLoop()}destroy(){var e,n;(e=this.loop)==null||e.stopLoop(),(n=this.rp)==null||n.destroy(!0),this.destroyed=!0}}function TO(){const t=pt.useRef(null);return pt.useEffect(()=>{const e=new MO;return t.current&&e.init(t.current).then(()=>e.startLoop()),()=>e.destroy()},[t.current]),me.jsx("canvas",{ref:t,style:{width:"100%",height:"100%"}})}function EO(){return me.jsxs(Xd,{hero:me.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"14rem",background:"linear-gradient(180deg, var(--primary4) 0%, var(--primary3) 100%)"},children:me.jsx(wv,{heroBackground:me.jsx(TO,{}),title:"Resources",subtitle:"Software and media used in creating this site"})}),children:[me.jsx("h1",{children:"Software"}),me.jsxs("ul",{children:[me.jsx("li",{children:"d3-ease"}),me.jsx("li",{children:"d3-scale"}),me.jsx("li",{children:"d3-selection"}),me.jsx("li",{children:"d3-shape"}),me.jsx("li",{children:"d3-transition"}),me.jsx("li",{children:"katex"}),me.jsx("li",{children:"maplibre-gl"}),me.jsx("li",{children:"react"}),me.jsx("li",{children:"react-dom"}),me.jsx("li",{children:"react-router-dom"}),me.jsx("li",{children:"three"})]}),me.jsx("h1",{children:"Media"}),me.jsxs("ul",{children:[me.jsx("li",{children:me.jsx("a",{href:"https://www.pexels.com/de-de/foto/weisse-windmuhle-unter-blauem-und-weissem-himmel-tagsuber-112846/",children:"Photo by musicFactory lehmannsound on Pexels"})}),me.jsx("li",{children:me.jsx("a",{href:"https://www.pexels.com/photo/aerial-photography-of-rocks-beside-body-of-water-3575654/",children:"Photo by Luciann Photography on Pexels"})}),me.jsx("li",{children:me.jsx("a",{href:"https://www.pexels.com/photo/body-of-water-near-green-mountain-931018/",children:"Photo by Oliver Sjöström on Pexels"})}),me.jsx("li",{children:me.jsx("a",{href:"https://www.pexels.com/photo/close-up-shot-of-a-person-writing-on-a-contract-7841506/",children:"Photo by RDNE Stock project on Pexels"})})]})]})}function a1(t,e){return t==null||e==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function AO(t,e){return t==null||e==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function yA(t){let e,n,r;t.length!==2?(e=a1,n=(l,m)=>a1(t(l),m),r=(l,m)=>t(l)-m):(e=t===a1||t===AO?t:CO,n=t,r=t);function s(l,m,_=0,S=l.length){if(_<S){if(e(m,m)!==0)return S;do{const T=_+S>>>1;n(l[T],m)<0?_=T+1:S=T}while(_<S)}return _}function c(l,m,_=0,S=l.length){if(_<S){if(e(m,m)!==0)return S;do{const T=_+S>>>1;n(l[T],m)<=0?_=T+1:S=T}while(_<S)}return _}function h(l,m,_=0,S=l.length){const T=s(l,m,_,S-1);return T>_&&r(l[T-1],m)>-r(l[T],m)?T-1:T}return{left:s,center:h,right:c}}function CO(){return 0}function PO(t){return t===null?NaN:+t}const RO=yA(a1),IO=RO.right;yA(PO).center;const DO=Math.sqrt(50),kO=Math.sqrt(10),LO=Math.sqrt(2);function H1(t,e,n){const r=(e-t)/Math.max(0,n),s=Math.floor(Math.log10(r)),c=r/Math.pow(10,s),h=c>=DO?10:c>=kO?5:c>=LO?2:1;let l,m,_;return s<0?(_=Math.pow(10,-s)/h,l=Math.round(t*_),m=Math.round(e*_),l/_<t&&++l,m/_>e&&--m,_=-_):(_=Math.pow(10,s)*h,l=Math.round(t/_),m=Math.round(e/_),l*_<t&&++l,m*_>e&&--m),m<l&&.5<=n&&n<2?H1(t,e,n*2):[l,m,_]}function zO(t,e,n){if(e=+e,t=+t,n=+n,!(n>0))return[];if(t===e)return[t];const r=e<t,[s,c,h]=r?H1(e,t,n):H1(t,e,n);if(!(c>=s))return[];const l=c-s+1,m=new Array(l);if(r)if(h<0)for(let _=0;_<l;++_)m[_]=(c-_)/-h;else for(let _=0;_<l;++_)m[_]=(c-_)*h;else if(h<0)for(let _=0;_<l;++_)m[_]=(s+_)/-h;else for(let _=0;_<l;++_)m[_]=(s+_)*h;return m}function y2(t,e,n){return e=+e,t=+t,n=+n,H1(t,e,n)[2]}function FO(t,e,n){e=+e,t=+t,n=+n;const r=e<t,s=r?y2(e,t,n):y2(t,e,n);return(r?-1:1)*(s<0?1/-s:s)}function NO(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function qb(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function _A(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Bp(){}var xp=.7,G1=1/xp,Ed="\\s*([+-]?\\d+)\\s*",bp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",wo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",BO=/^#([0-9a-f]{3,8})$/,OO=new RegExp(`^rgb\\(${Ed},${Ed},${Ed}\\)$`),UO=new RegExp(`^rgb\\(${wo},${wo},${wo}\\)$`),VO=new RegExp(`^rgba\\(${Ed},${Ed},${Ed},${bp}\\)$`),HO=new RegExp(`^rgba\\(${wo},${wo},${wo},${bp}\\)$`),GO=new RegExp(`^hsl\\(${bp},${wo},${wo}\\)$`),jO=new RegExp(`^hsla\\(${bp},${wo},${wo},${bp}\\)$`),tM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};qb(Bp,Hu,{copy(t){return Object.assign(new this.constructor,this,t)},displayable(){return this.rgb().displayable()},hex:nM,formatHex:nM,formatHex8:WO,formatHsl:qO,formatRgb:rM,toString:rM});function nM(){return this.rgb().formatHex()}function WO(){return this.rgb().formatHex8()}function qO(){return xA(this).formatHsl()}function rM(){return this.rgb().formatRgb()}function Hu(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=BO.exec(t))?(n=e[1].length,e=parseInt(e[1],16),n===6?iM(e):n===3?new Ia(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):n===8?kg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):n===4?kg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=OO.exec(t))?new Ia(e[1],e[2],e[3],1):(e=UO.exec(t))?new Ia(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=VO.exec(t))?kg(e[1],e[2],e[3],e[4]):(e=HO.exec(t))?kg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=GO.exec(t))?oM(e[1],e[2]/100,e[3]/100,1):(e=jO.exec(t))?oM(e[1],e[2]/100,e[3]/100,e[4]):tM.hasOwnProperty(t)?iM(tM[t]):t==="transparent"?new Ia(NaN,NaN,NaN,0):null}function iM(t){return new Ia(t>>16&255,t>>8&255,t&255,1)}function kg(t,e,n,r){return r<=0&&(t=e=n=NaN),new Ia(t,e,n,r)}function $O(t){return t instanceof Bp||(t=Hu(t)),t?(t=t.rgb(),new Ia(t.r,t.g,t.b,t.opacity)):new Ia}function _2(t,e,n,r){return arguments.length===1?$O(t):new Ia(t,e,n,r??1)}function Ia(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}qb(Ia,_2,_A(Bp,{brighter(t){return t=t==null?G1:Math.pow(G1,t),new Ia(this.r*t,this.g*t,this.b*t,this.opacity)},darker(t){return t=t==null?xp:Math.pow(xp,t),new Ia(this.r*t,this.g*t,this.b*t,this.opacity)},rgb(){return this},clamp(){return new Ia(Du(this.r),Du(this.g),Du(this.b),j1(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:aM,formatHex:aM,formatHex8:XO,formatRgb:sM,toString:sM}));function aM(){return`#${Pu(this.r)}${Pu(this.g)}${Pu(this.b)}`}function XO(){return`#${Pu(this.r)}${Pu(this.g)}${Pu(this.b)}${Pu((isNaN(this.opacity)?1:this.opacity)*255)}`}function sM(){const t=j1(this.opacity);return`${t===1?"rgb(":"rgba("}${Du(this.r)}, ${Du(this.g)}, ${Du(this.b)}${t===1?")":`, ${t})`}`}function j1(t){return isNaN(t)?1:Math.max(0,Math.min(1,t))}function Du(t){return Math.max(0,Math.min(255,Math.round(t)||0))}function Pu(t){return t=Du(t),(t<16?"0":"")+t.toString(16)}function oM(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new Xs(t,e,n,r)}function xA(t){if(t instanceof Xs)return new Xs(t.h,t.s,t.l,t.opacity);if(t instanceof Bp||(t=Hu(t)),!t)return new Xs;if(t instanceof Xs)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,s=Math.min(e,n,r),c=Math.max(e,n,r),h=NaN,l=c-s,m=(c+s)/2;return l?(e===c?h=(n-r)/l+(n<r)*6:n===c?h=(r-e)/l+2:h=(e-n)/l+4,l/=m<.5?c+s:2-c-s,h*=60):l=m>0&&m<1?0:h,new Xs(h,l,m,t.opacity)}function ZO(t,e,n,r){return arguments.length===1?xA(t):new Xs(t,e,n,r??1)}function Xs(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}qb(Xs,ZO,_A(Bp,{brighter(t){return t=t==null?G1:Math.pow(G1,t),new Xs(this.h,this.s,this.l*t,this.opacity)},darker(t){return t=t==null?xp:Math.pow(xp,t),new Xs(this.h,this.s,this.l*t,this.opacity)},rgb(){var t=this.h%360+(this.h<0)*360,e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,s=2*n-r;return new Ia(Y_(t>=240?t-240:t+120,s,r),Y_(t,s,r),Y_(t<120?t+240:t-120,s,r),this.opacity)},clamp(){return new Xs(lM(this.h),Lg(this.s),Lg(this.l),j1(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const t=j1(this.opacity);return`${t===1?"hsl(":"hsla("}${lM(this.h)}, ${Lg(this.s)*100}%, ${Lg(this.l)*100}%${t===1?")":`, ${t})`}`}}));function lM(t){return t=(t||0)%360,t<0?t+360:t}function Lg(t){return Math.max(0,Math.min(1,t||0))}function Y_(t,e,n){return(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)*255}const $b=t=>()=>t;function YO(t,e){return function(n){return t+n*e}}function KO(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function JO(t){return(t=+t)==1?bA:function(e,n){return n-e?KO(e,n,t):$b(isNaN(e)?n:e)}}function bA(t,e){var n=e-t;return n?YO(t,n):$b(isNaN(t)?e:t)}const W1=function t(e){var n=JO(e);function r(s,c){var h=n((s=_2(s)).r,(c=_2(c)).r),l=n(s.g,c.g),m=n(s.b,c.b),_=bA(s.opacity,c.opacity);return function(S){return s.r=h(S),s.g=l(S),s.b=m(S),s.opacity=_(S),s+""}}return r.gamma=t,r}(1);function QO(t,e){e||(e=[]);var n=t?Math.min(e.length,t.length):0,r=e.slice(),s;return function(c){for(s=0;s<n;++s)r[s]=t[s]*(1-c)+e[s]*c;return r}}function eU(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function tU(t,e){var n=e?e.length:0,r=t?Math.min(n,t.length):0,s=new Array(r),c=new Array(n),h;for(h=0;h<r;++h)s[h]=Xb(t[h],e[h]);for(;h<n;++h)c[h]=e[h];return function(l){for(h=0;h<r;++h)c[h]=s[h](l);return c}}function nU(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function qs(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function rU(t,e){var n={},r={},s;(t===null||typeof t!="object")&&(t={}),(e===null||typeof e!="object")&&(e={});for(s in e)s in t?n[s]=Xb(t[s],e[s]):r[s]=e[s];return function(c){for(s in n)r[s]=n[s](c);return r}}var x2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,K_=new RegExp(x2.source,"g");function iU(t){return function(){return t}}function aU(t){return function(e){return t(e)+""}}function wA(t,e){var n=x2.lastIndex=K_.lastIndex=0,r,s,c,h=-1,l=[],m=[];for(t=t+"",e=e+"";(r=x2.exec(t))&&(s=K_.exec(e));)(c=s.index)>n&&(c=e.slice(n,c),l[h]?l[h]+=c:l[++h]=c),(r=r[0])===(s=s[0])?l[h]?l[h]+=s:l[++h]=s:(l[++h]=null,m.push({i:h,x:qs(r,s)})),n=K_.lastIndex;return n<e.length&&(c=e.slice(n),l[h]?l[h]+=c:l[++h]=c),l.length<2?m[0]?aU(m[0].x):iU(e):(e=m.length,function(_){for(var S=0,T;S<e;++S)l[(T=m[S]).i]=T.x(_);return l.join("")})}function Xb(t,e){var n=typeof e,r;return e==null||n==="boolean"?$b(e):(n==="number"?qs:n==="string"?(r=Hu(e))?(e=r,W1):wA:e instanceof Hu?W1:e instanceof Date?nU:eU(e)?QO:Array.isArray(e)?tU:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?rU:qs)(t,e)}function sU(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}var cM=180/Math.PI,b2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function SA(t,e,n,r,s,c){var h,l,m;return(h=Math.sqrt(t*t+e*e))&&(t/=h,e/=h),(m=t*n+e*r)&&(n-=t*m,r-=e*m),(l=Math.sqrt(n*n+r*r))&&(n/=l,r/=l,m/=l),t*r<e*n&&(t=-t,e=-e,m=-m,h=-h),{translateX:s,translateY:c,rotate:Math.atan2(e,t)*cM,skewX:Math.atan(m)*cM,scaleX:h,scaleY:l}}var zg;function oU(t){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(t+"");return e.isIdentity?b2:SA(e.a,e.b,e.c,e.d,e.e,e.f)}function lU(t){return t==null||(zg||(zg=document.createElementNS("http://www.w3.org/2000/svg","g")),zg.setAttribute("transform",t),!(t=zg.transform.baseVal.consolidate()))?b2:(t=t.matrix,SA(t.a,t.b,t.c,t.d,t.e,t.f))}function MA(t,e,n,r){function s(_){return _.length?_.pop()+" ":""}function c(_,S,T,M,I,N){if(_!==T||S!==M){var B=I.push("translate(",null,e,null,n);N.push({i:B-4,x:qs(_,T)},{i:B-2,x:qs(S,M)})}else(T||M)&&I.push("translate("+T+e+M+n)}function h(_,S,T,M){_!==S?(_-S>180?S+=360:S-_>180&&(_+=360),M.push({i:T.push(s(T)+"rotate(",null,r)-2,x:qs(_,S)})):S&&T.push(s(T)+"rotate("+S+r)}function l(_,S,T,M){_!==S?M.push({i:T.push(s(T)+"skewX(",null,r)-2,x:qs(_,S)}):S&&T.push(s(T)+"skewX("+S+r)}function m(_,S,T,M,I,N){if(_!==T||S!==M){var B=I.push(s(I)+"scale(",null,",",null,")");N.push({i:B-4,x:qs(_,T)},{i:B-2,x:qs(S,M)})}else(T!==1||M!==1)&&I.push(s(I)+"scale("+T+","+M+")")}return function(_,S){var T=[],M=[];return _=t(_),S=t(S),c(_.translateX,_.translateY,S.translateX,S.translateY,T,M),h(_.rotate,S.rotate,T,M),l(_.skewX,S.skewX,T,M),m(_.scaleX,_.scaleY,S.scaleX,S.scaleY,T,M),_=S=null,function(I){for(var N=-1,B=M.length,k;++N<B;)T[(k=M[N]).i]=k.x(I);return T.join("")}}}var cU=MA(oU,"px, ","px)","deg)"),uU=MA(lU,", ",")",")");function hU(t){return function(){return t}}function dU(t){return+t}var uM=[0,1];function gd(t){return t}function w2(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:hU(isNaN(e)?NaN:.5)}function fU(t,e){var n;return t>e&&(n=t,t=e,e=n),function(r){return Math.max(t,Math.min(e,r))}}function pU(t,e,n){var r=t[0],s=t[1],c=e[0],h=e[1];return s<r?(r=w2(s,r),c=n(h,c)):(r=w2(r,s),c=n(c,h)),function(l){return c(r(l))}}function mU(t,e,n){var r=Math.min(t.length,e.length)-1,s=new Array(r),c=new Array(r),h=-1;for(t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());++h<r;)s[h]=w2(t[h],t[h+1]),c[h]=n(e[h],e[h+1]);return function(l){var m=IO(t,l,1,r)-1;return c[m](s[m](l))}}function gU(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function vU(){var t=uM,e=uM,n=Xb,r,s,c,h=gd,l,m,_;function S(){var M=Math.min(t.length,e.length);return h!==gd&&(h=fU(t[0],t[M-1])),l=M>2?mU:pU,m=_=null,T}function T(M){return M==null||isNaN(M=+M)?c:(m||(m=l(t.map(r),e,n)))(r(h(M)))}return T.invert=function(M){return h(s((_||(_=l(e,t.map(r),qs)))(M)))},T.domain=function(M){return arguments.length?(t=Array.from(M,dU),S()):t.slice()},T.range=function(M){return arguments.length?(e=Array.from(M),S()):e.slice()},T.rangeRound=function(M){return e=Array.from(M),n=sU,S()},T.clamp=function(M){return arguments.length?(h=M?!0:gd,S()):h!==gd},T.interpolate=function(M){return arguments.length?(n=M,S()):n},T.unknown=function(M){return arguments.length?(c=M,T):c},function(M,I){return r=M,s=I,S()}}function yU(){return vU()(gd,gd)}function _U(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function q1(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function Ud(t){return t=q1(Math.abs(t)),t?t[1]:NaN}function xU(t,e){return function(n,r){for(var s=n.length,c=[],h=0,l=t[0],m=0;s>0&&l>0&&(m+l+1>r&&(l=Math.max(1,r-m)),c.push(n.substring(s-=l,s+l)),!((m+=l+1)>r));)l=t[h=(h+1)%t.length];return c.reverse().join(e)}}function bU(t){return function(e){return e.replace(/[0-9]/g,function(n){return t[+n]})}}var wU=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function $1(t){if(!(e=wU.exec(t)))throw new Error("invalid format: "+t);var e;return new Zb({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}$1.prototype=Zb.prototype;function Zb(t){this.fill=t.fill===void 0?" ":t.fill+"",this.align=t.align===void 0?">":t.align+"",this.sign=t.sign===void 0?"-":t.sign+"",this.symbol=t.symbol===void 0?"":t.symbol+"",this.zero=!!t.zero,this.width=t.width===void 0?void 0:+t.width,this.comma=!!t.comma,this.precision=t.precision===void 0?void 0:+t.precision,this.trim=!!t.trim,this.type=t.type===void 0?"":t.type+""}Zb.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function SU(t){e:for(var e=t.length,n=1,r=-1,s;n<e;++n)switch(t[n]){case".":r=s=n;break;case"0":r===0&&(r=n),s=n;break;default:if(!+t[n])break e;r>0&&(r=0);break}return r>0?t.slice(0,r)+t.slice(s+1):t}var TA;function MU(t,e){var n=q1(t,e);if(!n)return t+"";var r=n[0],s=n[1],c=s-(TA=Math.max(-8,Math.min(8,Math.floor(s/3)))*3)+1,h=r.length;return c===h?r:c>h?r+new Array(c-h+1).join("0"):c>0?r.slice(0,c)+"."+r.slice(c):"0."+new Array(1-c).join("0")+q1(t,Math.max(0,e+c-1))[0]}function hM(t,e){var n=q1(t,e);if(!n)return t+"";var r=n[0],s=n[1];return s<0?"0."+new Array(-s).join("0")+r:r.length>s+1?r.slice(0,s+1)+"."+r.slice(s+1):r+new Array(s-r.length+2).join("0")}const dM={"%":(t,e)=>(t*100).toFixed(e),b:t=>Math.round(t).toString(2),c:t=>t+"",d:_U,e:(t,e)=>t.toExponential(e),f:(t,e)=>t.toFixed(e),g:(t,e)=>t.toPrecision(e),o:t=>Math.round(t).toString(8),p:(t,e)=>hM(t*100,e),r:hM,s:MU,X:t=>Math.round(t).toString(16).toUpperCase(),x:t=>Math.round(t).toString(16)};function fM(t){return t}var pM=Array.prototype.map,mM=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function TU(t){var e=t.grouping===void 0||t.thousands===void 0?fM:xU(pM.call(t.grouping,Number),t.thousands+""),n=t.currency===void 0?"":t.currency[0]+"",r=t.currency===void 0?"":t.currency[1]+"",s=t.decimal===void 0?".":t.decimal+"",c=t.numerals===void 0?fM:bU(pM.call(t.numerals,String)),h=t.percent===void 0?"%":t.percent+"",l=t.minus===void 0?"−":t.minus+"",m=t.nan===void 0?"NaN":t.nan+"";function _(T){T=$1(T);var M=T.fill,I=T.align,N=T.sign,B=T.symbol,k=T.zero,C=T.width,U=T.comma,V=T.precision,Y=T.trim,he=T.type;he==="n"?(U=!0,he="g"):dM[he]||(V===void 0&&(V=12),Y=!0,he="g"),(k||M==="0"&&I==="=")&&(k=!0,M="0",I="=");var Z=B==="$"?n:B==="#"&&/[boxX]/.test(he)?"0"+he.toLowerCase():"",ne=B==="$"?r:/[%p]/.test(he)?h:"",xe=dM[he],ie=/[defgprs%]/.test(he);V=V===void 0?6:/[gprs]/.test(he)?Math.max(1,Math.min(21,V)):Math.max(0,Math.min(20,V));function J(Te){var Be=Z,Re=ne,We,ct,gt;if(he==="c")Re=xe(Te)+Re,Te="";else{Te=+Te;var ft=Te<0||1/Te<0;if(Te=isNaN(Te)?m:xe(Math.abs(Te),V),Y&&(Te=SU(Te)),ft&&+Te==0&&N!=="+"&&(ft=!1),Be=(ft?N==="("?N:l:N==="-"||N==="("?"":N)+Be,Re=(he==="s"?mM[8+TA/3]:"")+Re+(ft&&N==="("?")":""),ie){for(We=-1,ct=Te.length;++We<ct;)if(gt=Te.charCodeAt(We),48>gt||gt>57){Re=(gt===46?s+Te.slice(We+1):Te.slice(We))+Re,Te=Te.slice(0,We);break}}}U&&!k&&(Te=e(Te,1/0));var ke=Be.length+Te.length+Re.length,at=ke<C?new Array(C-ke+1).join(M):"";switch(U&&k&&(Te=e(at+Te,at.length?C-Re.length:1/0),at=""),I){case"<":Te=Be+Te+Re+at;break;case"=":Te=Be+at+Te+Re;break;case"^":Te=at.slice(0,ke=at.length>>1)+Be+Te+Re+at.slice(ke);break;default:Te=at+Be+Te+Re;break}return c(Te)}return J.toString=function(){return T+""},J}function S(T,M){var I=_((T=$1(T),T.type="f",T)),N=Math.max(-8,Math.min(8,Math.floor(Ud(M)/3)))*3,B=Math.pow(10,-N),k=mM[8+N/3];return function(C){return I(B*C)+k}}return{format:_,formatPrefix:S}}var Fg,EA,AA;EU({thousands:",",grouping:[3],currency:["$",""]});function EU(t){return Fg=TU(t),EA=Fg.format,AA=Fg.formatPrefix,Fg}function AU(t){return Math.max(0,-Ud(Math.abs(t)))}function CU(t,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ud(e)/3)))*3-Ud(Math.abs(t)))}function PU(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,Ud(e)-Ud(t))+1}function RU(t,e,n,r){var s=FO(t,e,n),c;switch(r=$1(r??",f"),r.type){case"s":{var h=Math.max(Math.abs(t),Math.abs(e));return r.precision==null&&!isNaN(c=CU(s,h))&&(r.precision=c),AA(r,h)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(c=PU(s,Math.max(Math.abs(t),Math.abs(e))))&&(r.precision=c-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(c=AU(s))&&(r.precision=c-(r.type==="%")*2);break}}return EA(r)}function IU(t){var e=t.domain;return t.ticks=function(n){var r=e();return zO(r[0],r[r.length-1],n??10)},t.tickFormat=function(n,r){var s=e();return RU(s[0],s[s.length-1],n??10,r)},t.nice=function(n){n==null&&(n=10);var r=e(),s=0,c=r.length-1,h=r[s],l=r[c],m,_,S=10;for(l<h&&(_=h,h=l,l=_,_=s,s=c,c=_);S-- >0;){if(_=y2(h,l,n),_===m)return r[s]=h,r[c]=l,e(r);if(_>0)h=Math.floor(h/_)*_,l=Math.ceil(l/_)*_;else if(_<0)h=Math.ceil(h*_)/_,l=Math.floor(l*_)/_;else break;m=_}return t},t}function wp(){var t=yU();return t.copy=function(){return gU(t,wp())},NO.apply(t,arguments),IU(t)}var S2="http://www.w3.org/1999/xhtml";const gM={svg:"http://www.w3.org/2000/svg",xhtml:S2,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Rv(t){var e=t+="",n=e.indexOf(":");return n>=0&&(e=t.slice(0,n))!=="xmlns"&&(t=t.slice(n+1)),gM.hasOwnProperty(e)?{space:gM[e],local:t}:t}function DU(t){return function(){var e=this.ownerDocument,n=this.namespaceURI;return n===S2&&e.documentElement.namespaceURI===S2?e.createElement(t):e.createElementNS(n,t)}}function kU(t){return function(){return this.ownerDocument.createElementNS(t.space,t.local)}}function CA(t){var e=Rv(t);return(e.local?kU:DU)(e)}function LU(){}function Yb(t){return t==null?LU:function(){return this.querySelector(t)}}function zU(t){typeof t!="function"&&(t=Yb(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var c=e[s],h=c.length,l=r[s]=new Array(h),m,_,S=0;S<h;++S)(m=c[S])&&(_=t.call(m,m.__data__,S,c))&&("__data__"in m&&(_.__data__=m.__data__),l[S]=_);return new ns(r,this._parents)}function FU(t){return t==null?[]:Array.isArray(t)?t:Array.from(t)}function NU(){return[]}function PA(t){return t==null?NU:function(){return this.querySelectorAll(t)}}function BU(t){return function(){return FU(t.apply(this,arguments))}}function OU(t){typeof t=="function"?t=BU(t):t=PA(t);for(var e=this._groups,n=e.length,r=[],s=[],c=0;c<n;++c)for(var h=e[c],l=h.length,m,_=0;_<l;++_)(m=h[_])&&(r.push(t.call(m,m.__data__,_,h)),s.push(m));return new ns(r,s)}function RA(t){return function(){return this.matches(t)}}function IA(t){return function(e){return e.matches(t)}}var UU=Array.prototype.find;function VU(t){return function(){return UU.call(this.children,t)}}function HU(){return this.firstElementChild}function GU(t){return this.select(t==null?HU:VU(typeof t=="function"?t:IA(t)))}var jU=Array.prototype.filter;function WU(){return Array.from(this.children)}function qU(t){return function(){return jU.call(this.children,t)}}function $U(t){return this.selectAll(t==null?WU:qU(typeof t=="function"?t:IA(t)))}function XU(t){typeof t!="function"&&(t=RA(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var c=e[s],h=c.length,l=r[s]=[],m,_=0;_<h;++_)(m=c[_])&&t.call(m,m.__data__,_,c)&&l.push(m);return new ns(r,this._parents)}function DA(t){return new Array(t.length)}function ZU(){return new ns(this._enter||this._groups.map(DA),this._parents)}function X1(t,e){this.ownerDocument=t.ownerDocument,this.namespaceURI=t.namespaceURI,this._next=null,this._parent=t,this.__data__=e}X1.prototype={constructor:X1,appendChild:function(t){return this._parent.insertBefore(t,this._next)},insertBefore:function(t,e){return this._parent.insertBefore(t,e)},querySelector:function(t){return this._parent.querySelector(t)},querySelectorAll:function(t){return this._parent.querySelectorAll(t)}};function YU(t){return function(){return t}}function KU(t,e,n,r,s,c){for(var h=0,l,m=e.length,_=c.length;h<_;++h)(l=e[h])?(l.__data__=c[h],r[h]=l):n[h]=new X1(t,c[h]);for(;h<m;++h)(l=e[h])&&(s[h]=l)}function JU(t,e,n,r,s,c,h){var l,m,_=new Map,S=e.length,T=c.length,M=new Array(S),I;for(l=0;l<S;++l)(m=e[l])&&(M[l]=I=h.call(m,m.__data__,l,e)+"",_.has(I)?s[l]=m:_.set(I,m));for(l=0;l<T;++l)I=h.call(t,c[l],l,c)+"",(m=_.get(I))?(r[l]=m,m.__data__=c[l],_.delete(I)):n[l]=new X1(t,c[l]);for(l=0;l<S;++l)(m=e[l])&&_.get(M[l])===m&&(s[l]=m)}function QU(t){return t.__data__}function eV(t,e){if(!arguments.length)return Array.from(this,QU);var n=e?JU:KU,r=this._parents,s=this._groups;typeof t!="function"&&(t=YU(t));for(var c=s.length,h=new Array(c),l=new Array(c),m=new Array(c),_=0;_<c;++_){var S=r[_],T=s[_],M=T.length,I=tV(t.call(S,S&&S.__data__,_,r)),N=I.length,B=l[_]=new Array(N),k=h[_]=new Array(N),C=m[_]=new Array(M);n(S,T,B,k,C,I,e);for(var U=0,V=0,Y,he;U<N;++U)if(Y=B[U]){for(U>=V&&(V=U+1);!(he=k[V])&&++V<N;);Y._next=he||null}}return h=new ns(h,r),h._enter=l,h._exit=m,h}function tV(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function nV(){return new ns(this._exit||this._groups.map(DA),this._parents)}function rV(t,e,n){var r=this.enter(),s=this,c=this.exit();return typeof t=="function"?(r=t(r),r&&(r=r.selection())):r=r.append(t+""),e!=null&&(s=e(s),s&&(s=s.selection())),n==null?c.remove():n(c),r&&s?r.merge(s).order():s}function iV(t){for(var e=t.selection?t.selection():t,n=this._groups,r=e._groups,s=n.length,c=r.length,h=Math.min(s,c),l=new Array(s),m=0;m<h;++m)for(var _=n[m],S=r[m],T=_.length,M=l[m]=new Array(T),I,N=0;N<T;++N)(I=_[N]||S[N])&&(M[N]=I);for(;m<s;++m)l[m]=n[m];return new ns(l,this._parents)}function aV(){for(var t=this._groups,e=-1,n=t.length;++e<n;)for(var r=t[e],s=r.length-1,c=r[s],h;--s>=0;)(h=r[s])&&(c&&h.compareDocumentPosition(c)^4&&c.parentNode.insertBefore(h,c),c=h);return this}function sV(t){t||(t=oV);function e(T,M){return T&&M?t(T.__data__,M.__data__):!T-!M}for(var n=this._groups,r=n.length,s=new Array(r),c=0;c<r;++c){for(var h=n[c],l=h.length,m=s[c]=new Array(l),_,S=0;S<l;++S)(_=h[S])&&(m[S]=_);m.sort(e)}return new ns(s,this._parents).order()}function oV(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function lV(){var t=arguments[0];return arguments[0]=this,t.apply(null,arguments),this}function cV(){return Array.from(this)}function uV(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,c=r.length;s<c;++s){var h=r[s];if(h)return h}return null}function hV(){let t=0;for(const e of this)++t;return t}function dV(){return!this.node()}function fV(t){for(var e=this._groups,n=0,r=e.length;n<r;++n)for(var s=e[n],c=0,h=s.length,l;c<h;++c)(l=s[c])&&t.call(l,l.__data__,c,s);return this}function pV(t){return function(){this.removeAttribute(t)}}function mV(t){return function(){this.removeAttributeNS(t.space,t.local)}}function gV(t,e){return function(){this.setAttribute(t,e)}}function vV(t,e){return function(){this.setAttributeNS(t.space,t.local,e)}}function yV(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttribute(t):this.setAttribute(t,n)}}function _V(t,e){return function(){var n=e.apply(this,arguments);n==null?this.removeAttributeNS(t.space,t.local):this.setAttributeNS(t.space,t.local,n)}}function xV(t,e){var n=Rv(t);if(arguments.length<2){var r=this.node();return n.local?r.getAttributeNS(n.space,n.local):r.getAttribute(n)}return this.each((e==null?n.local?mV:pV:typeof e=="function"?n.local?_V:yV:n.local?vV:gV)(n,e))}function kA(t){return t.ownerDocument&&t.ownerDocument.defaultView||t.document&&t||t.defaultView}function bV(t){return function(){this.style.removeProperty(t)}}function wV(t,e,n){return function(){this.style.setProperty(t,e,n)}}function SV(t,e,n){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(t):this.style.setProperty(t,r,n)}}function MV(t,e,n){return arguments.length>1?this.each((e==null?bV:typeof e=="function"?SV:wV)(t,e,n??"")):Vd(this.node(),t)}function Vd(t,e){return t.style.getPropertyValue(e)||kA(t).getComputedStyle(t,null).getPropertyValue(e)}function TV(t){return function(){delete this[t]}}function EV(t,e){return function(){this[t]=e}}function AV(t,e){return function(){var n=e.apply(this,arguments);n==null?delete this[t]:this[t]=n}}function CV(t,e){return arguments.length>1?this.each((e==null?TV:typeof e=="function"?AV:EV)(t,e)):this.node()[t]}function LA(t){return t.trim().split(/^|\s+/)}function Kb(t){return t.classList||new zA(t)}function zA(t){this._node=t,this._names=LA(t.getAttribute("class")||"")}zA.prototype={add:function(t){var e=this._names.indexOf(t);e<0&&(this._names.push(t),this._node.setAttribute("class",this._names.join(" ")))},remove:function(t){var e=this._names.indexOf(t);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(t){return this._names.indexOf(t)>=0}};function FA(t,e){for(var n=Kb(t),r=-1,s=e.length;++r<s;)n.add(e[r])}function NA(t,e){for(var n=Kb(t),r=-1,s=e.length;++r<s;)n.remove(e[r])}function PV(t){return function(){FA(this,t)}}function RV(t){return function(){NA(this,t)}}function IV(t,e){return function(){(e.apply(this,arguments)?FA:NA)(this,t)}}function DV(t,e){var n=LA(t+"");if(arguments.length<2){for(var r=Kb(this.node()),s=-1,c=n.length;++s<c;)if(!r.contains(n[s]))return!1;return!0}return this.each((typeof e=="function"?IV:e?PV:RV)(n,e))}function kV(){this.textContent=""}function LV(t){return function(){this.textContent=t}}function zV(t){return function(){var e=t.apply(this,arguments);this.textContent=e??""}}function FV(t){return arguments.length?this.each(t==null?kV:(typeof t=="function"?zV:LV)(t)):this.node().textContent}function NV(){this.innerHTML=""}function BV(t){return function(){this.innerHTML=t}}function OV(t){return function(){var e=t.apply(this,arguments);this.innerHTML=e??""}}function UV(t){return arguments.length?this.each(t==null?NV:(typeof t=="function"?OV:BV)(t)):this.node().innerHTML}function VV(){this.nextSibling&&this.parentNode.appendChild(this)}function HV(){return this.each(VV)}function GV(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function jV(){return this.each(GV)}function WV(t){var e=typeof t=="function"?t:CA(t);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function qV(){return null}function $V(t,e){var n=typeof t=="function"?t:CA(t),r=e==null?qV:typeof e=="function"?e:Yb(e);return this.select(function(){return this.insertBefore(n.apply(this,arguments),r.apply(this,arguments)||null)})}function XV(){var t=this.parentNode;t&&t.removeChild(this)}function ZV(){return this.each(XV)}function YV(){var t=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function KV(){var t=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(t,this.nextSibling):t}function JV(t){return this.select(t?KV:YV)}function QV(t){return arguments.length?this.property("__data__",t):this.node().__data__}function eH(t){return function(e){t.call(this,e,this.__data__)}}function tH(t){return t.trim().split(/^|\s+/).map(function(e){var n="",r=e.indexOf(".");return r>=0&&(n=e.slice(r+1),e=e.slice(0,r)),{type:e,name:n}})}function nH(t){return function(){var e=this.__on;if(e){for(var n=0,r=-1,s=e.length,c;n<s;++n)c=e[n],(!t.type||c.type===t.type)&&c.name===t.name?this.removeEventListener(c.type,c.listener,c.options):e[++r]=c;++r?e.length=r:delete this.__on}}}function rH(t,e,n){return function(){var r=this.__on,s,c=eH(e);if(r){for(var h=0,l=r.length;h<l;++h)if((s=r[h]).type===t.type&&s.name===t.name){this.removeEventListener(s.type,s.listener,s.options),this.addEventListener(s.type,s.listener=c,s.options=n),s.value=e;return}}this.addEventListener(t.type,c,n),s={type:t.type,name:t.name,value:e,listener:c,options:n},r?r.push(s):this.__on=[s]}}function iH(t,e,n){var r=tH(t+""),s,c=r.length,h;if(arguments.length<2){var l=this.node().__on;if(l){for(var m=0,_=l.length,S;m<_;++m)for(s=0,S=l[m];s<c;++s)if((h=r[s]).type===S.type&&h.name===S.name)return S.value}return}for(l=e?rH:nH,s=0;s<c;++s)this.each(l(r[s],e,n));return this}function BA(t,e,n){var r=kA(t),s=r.CustomEvent;typeof s=="function"?s=new s(e,n):(s=r.document.createEvent("Event"),n?(s.initEvent(e,n.bubbles,n.cancelable),s.detail=n.detail):s.initEvent(e,!1,!1)),t.dispatchEvent(s)}function aH(t,e){return function(){return BA(this,t,e)}}function sH(t,e){return function(){return BA(this,t,e.apply(this,arguments))}}function oH(t,e){return this.each((typeof e=="function"?sH:aH)(t,e))}function*lH(){for(var t=this._groups,e=0,n=t.length;e<n;++e)for(var r=t[e],s=0,c=r.length,h;s<c;++s)(h=r[s])&&(yield h)}var OA=[null];function ns(t,e){this._groups=t,this._parents=e}function Kd(){return new ns([[document.documentElement]],OA)}function cH(){return this}ns.prototype=Kd.prototype={constructor:ns,select:zU,selectAll:OU,selectChild:GU,selectChildren:$U,filter:XU,data:eV,enter:ZU,exit:nV,join:rV,merge:iV,selection:cH,order:aV,sort:sV,call:lV,nodes:cV,node:uV,size:hV,empty:dV,each:fV,attr:xV,style:MV,property:CV,classed:DV,text:FV,html:UV,raise:HV,lower:jV,append:WV,insert:$V,remove:ZV,clone:JV,datum:QV,on:iH,dispatch:oH,[Symbol.iterator]:lH};function UA(t){return typeof t=="string"?new ns([[document.querySelector(t)]],[document.documentElement]):new ns([[t]],OA)}function Kh(t){return function(){return t}}const M2=Math.PI,T2=2*M2,yu=1e-6,uH=T2-yu;function VA(t){this._+=t[0];for(let e=1,n=t.length;e<n;++e)this._+=arguments[e]+t[e]}function hH(t){let e=Math.floor(t);if(!(e>=0))throw new Error(`invalid digits: ${t}`);if(e>15)return VA;const n=10**e;return function(r){this._+=r[0];for(let s=1,c=r.length;s<c;++s)this._+=Math.round(arguments[s]*n)/n+r[s]}}let dH=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?VA:hH(e)}moveTo(e,n){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,n){this._append`L${this._x1=+e},${this._y1=+n}`}quadraticCurveTo(e,n,r,s){this._append`Q${+e},${+n},${this._x1=+r},${this._y1=+s}`}bezierCurveTo(e,n,r,s,c,h){this._append`C${+e},${+n},${+r},${+s},${this._x1=+c},${this._y1=+h}`}arcTo(e,n,r,s,c){if(e=+e,n=+n,r=+r,s=+s,c=+c,c<0)throw new Error(`negative radius: ${c}`);let h=this._x1,l=this._y1,m=r-e,_=s-n,S=h-e,T=l-n,M=S*S+T*T;if(this._x1===null)this._append`M${this._x1=e},${this._y1=n}`;else if(M>yu)if(!(Math.abs(T*m-_*S)>yu)||!c)this._append`L${this._x1=e},${this._y1=n}`;else{let I=r-h,N=s-l,B=m*m+_*_,k=I*I+N*N,C=Math.sqrt(B),U=Math.sqrt(M),V=c*Math.tan((M2-Math.acos((B+M-k)/(2*C*U)))/2),Y=V/U,he=V/C;Math.abs(Y-1)>yu&&this._append`L${e+Y*S},${n+Y*T}`,this._append`A${c},${c},0,0,${+(T*I>S*N)},${this._x1=e+he*m},${this._y1=n+he*_}`}}arc(e,n,r,s,c,h){if(e=+e,n=+n,r=+r,h=!!h,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(s),m=r*Math.sin(s),_=e+l,S=n+m,T=1^h,M=h?s-c:c-s;this._x1===null?this._append`M${_},${S}`:(Math.abs(this._x1-_)>yu||Math.abs(this._y1-S)>yu)&&this._append`L${_},${S}`,r&&(M<0&&(M=M%T2+T2),M>uH?this._append`A${r},${r},0,1,${T},${e-l},${n-m}A${r},${r},0,1,${T},${this._x1=_},${this._y1=S}`:M>yu&&this._append`A${r},${r},0,${+(M>=M2)},${T},${this._x1=e+r*Math.cos(c)},${this._y1=n+r*Math.sin(c)}`)}rect(e,n,r,s){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+n}h${r=+r}v${+s}h${-r}Z`}toString(){return this._}};function fH(t){let e=3;return t.digits=function(n){if(!arguments.length)return e;if(n==null)e=null;else{const r=Math.floor(n);if(!(r>=0))throw new RangeError(`invalid digits: ${n}`);e=r}return t},()=>new dH(e)}function pH(t){return typeof t=="object"&&"length"in t?t:Array.from(t)}function HA(t){this._context=t}HA.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(t,e){switch(t=+t,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(t,e):this._context.moveTo(t,e);break;case 1:this._point=2;default:this._context.lineTo(t,e);break}}};function mH(t){return new HA(t)}function gH(t){return t[0]}function vH(t){return t[1]}function yH(t,e){var n=Kh(!0),r=null,s=mH,c=null,h=fH(l);t=typeof t=="function"?t:t===void 0?gH:Kh(t),e=typeof e=="function"?e:e===void 0?vH:Kh(e);function l(m){var _,S=(m=pH(m)).length,T,M=!1,I;for(r==null&&(c=s(I=h())),_=0;_<=S;++_)!(_<S&&n(T=m[_],_,m))===M&&((M=!M)?c.lineStart():c.lineEnd()),M&&c.point(+t(T,_,m),+e(T,_,m));if(I)return c=null,I+""||null}return l.x=function(m){return arguments.length?(t=typeof m=="function"?m:Kh(+m),l):t},l.y=function(m){return arguments.length?(e=typeof m=="function"?m:Kh(+m),l):e},l.defined=function(m){return arguments.length?(n=typeof m=="function"?m:Kh(!!m),l):n},l.curve=function(m){return arguments.length?(s=m,r!=null&&(c=s(r)),l):s},l.context=function(m){return arguments.length?(m==null?r=c=null:c=s(r=m),l):r},l}var _H={value:()=>{}};function GA(){for(var t=0,e=arguments.length,n={},r;t<e;++t){if(!(r=arguments[t]+"")||r in n||/[\s.]/.test(r))throw new Error("illegal type: "+r);n[r]=[]}return new s1(n)}function s1(t){this._=t}function xH(t,e){return t.trim().split(/^|\s+/).map(function(n){var r="",s=n.indexOf(".");if(s>=0&&(r=n.slice(s+1),n=n.slice(0,s)),n&&!e.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:r}})}s1.prototype=GA.prototype={constructor:s1,on:function(t,e){var n=this._,r=xH(t+"",n),s,c=-1,h=r.length;if(arguments.length<2){for(;++c<h;)if((s=(t=r[c]).type)&&(s=bH(n[s],t.name)))return s;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++c<h;)if(s=(t=r[c]).type)n[s]=vM(n[s],t.name,e);else if(e==null)for(s in n)n[s]=vM(n[s],t.name,null);return this},copy:function(){var t={},e=this._;for(var n in e)t[n]=e[n].slice();return new s1(t)},call:function(t,e){if((s=arguments.length-2)>0)for(var n=new Array(s),r=0,s,c;r<s;++r)n[r]=arguments[r+2];if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(c=this._[t],r=0,s=c.length;r<s;++r)c[r].value.apply(e,n)},apply:function(t,e,n){if(!this._.hasOwnProperty(t))throw new Error("unknown type: "+t);for(var r=this._[t],s=0,c=r.length;s<c;++s)r[s].value.apply(e,n)}};function bH(t,e){for(var n=0,r=t.length,s;n<r;++n)if((s=t[n]).name===e)return s.value}function vM(t,e,n){for(var r=0,s=t.length;r<s;++r)if(t[r].name===e){t[r]=_H,t=t.slice(0,r).concat(t.slice(r+1));break}return n!=null&&t.push({name:e,value:n}),t}var Hd=0,D0=0,T0=0,jA=1e3,Z1,k0,Y1=0,Gu=0,Iv=0,Sp=typeof performance=="object"&&performance.now?performance:Date,WA=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(t){setTimeout(t,17)};function Jb(){return Gu||(WA(wH),Gu=Sp.now()+Iv)}function wH(){Gu=0}function K1(){this._call=this._time=this._next=null}K1.prototype=qA.prototype={constructor:K1,restart:function(t,e,n){if(typeof t!="function")throw new TypeError("callback is not a function");n=(n==null?Jb():+n)+(e==null?0:+e),!this._next&&k0!==this&&(k0?k0._next=this:Z1=this,k0=this),this._call=t,this._time=n,E2()},stop:function(){this._call&&(this._call=null,this._time=1/0,E2())}};function qA(t,e,n){var r=new K1;return r.restart(t,e,n),r}function SH(){Jb(),++Hd;for(var t=Z1,e;t;)(e=Gu-t._time)>=0&&t._call.call(void 0,e),t=t._next;--Hd}function yM(){Gu=(Y1=Sp.now())+Iv,Hd=D0=0;try{SH()}finally{Hd=0,TH(),Gu=0}}function MH(){var t=Sp.now(),e=t-Y1;e>jA&&(Iv-=e,Y1=t)}function TH(){for(var t,e=Z1,n,r=1/0;e;)e._call?(r>e._time&&(r=e._time),t=e,e=e._next):(n=e._next,e._next=null,e=t?t._next=n:Z1=n);k0=t,E2(r)}function E2(t){if(!Hd){D0&&(D0=clearTimeout(D0));var e=t-Gu;e>24?(t<1/0&&(D0=setTimeout(yM,t-Sp.now()-Iv)),T0&&(T0=clearInterval(T0))):(T0||(Y1=Sp.now(),T0=setInterval(MH,jA)),Hd=1,WA(yM))}}function _M(t,e,n){var r=new K1;return e=e==null?0:+e,r.restart(s=>{r.stop(),t(s+e)},e,n),r}var EH=GA("start","end","cancel","interrupt"),AH=[],$A=0,xM=1,A2=2,o1=3,bM=4,C2=5,l1=6;function Dv(t,e,n,r,s,c){var h=t.__transition;if(!h)t.__transition={};else if(n in h)return;CH(t,n,{name:e,index:r,group:s,on:EH,tween:AH,time:c.time,delay:c.delay,duration:c.duration,ease:c.ease,timer:null,state:$A})}function Qb(t,e){var n=Js(t,e);if(n.state>$A)throw new Error("too late; already scheduled");return n}function Mo(t,e){var n=Js(t,e);if(n.state>o1)throw new Error("too late; already running");return n}function Js(t,e){var n=t.__transition;if(!n||!(n=n[e]))throw new Error("transition not found");return n}function CH(t,e,n){var r=t.__transition,s;r[e]=n,n.timer=qA(c,0,n.time);function c(_){n.state=xM,n.timer.restart(h,n.delay,n.time),n.delay<=_&&h(_-n.delay)}function h(_){var S,T,M,I;if(n.state!==xM)return m();for(S in r)if(I=r[S],I.name===n.name){if(I.state===o1)return _M(h);I.state===bM?(I.state=l1,I.timer.stop(),I.on.call("interrupt",t,t.__data__,I.index,I.group),delete r[S]):+S<e&&(I.state=l1,I.timer.stop(),I.on.call("cancel",t,t.__data__,I.index,I.group),delete r[S])}if(_M(function(){n.state===o1&&(n.state=bM,n.timer.restart(l,n.delay,n.time),l(_))}),n.state=A2,n.on.call("start",t,t.__data__,n.index,n.group),n.state===A2){for(n.state=o1,s=new Array(M=n.tween.length),S=0,T=-1;S<M;++S)(I=n.tween[S].value.call(t,t.__data__,n.index,n.group))&&(s[++T]=I);s.length=T+1}}function l(_){for(var S=_<n.duration?n.ease.call(null,_/n.duration):(n.timer.restart(m),n.state=C2,1),T=-1,M=s.length;++T<M;)s[T].call(t,S);n.state===C2&&(n.on.call("end",t,t.__data__,n.index,n.group),m())}function m(){n.state=l1,n.timer.stop(),delete r[e];for(var _ in r)return;delete t.__transition}}function PH(t,e){var n=t.__transition,r,s,c=!0,h;if(n){e=e==null?null:e+"";for(h in n){if((r=n[h]).name!==e){c=!1;continue}s=r.state>A2&&r.state<C2,r.state=l1,r.timer.stop(),r.on.call(s?"interrupt":"cancel",t,t.__data__,r.index,r.group),delete n[h]}c&&delete t.__transition}}function RH(t){return this.each(function(){PH(this,t)})}function IH(t,e){var n,r;return function(){var s=Mo(this,t),c=s.tween;if(c!==n){r=n=c;for(var h=0,l=r.length;h<l;++h)if(r[h].name===e){r=r.slice(),r.splice(h,1);break}}s.tween=r}}function DH(t,e,n){var r,s;if(typeof n!="function")throw new Error;return function(){var c=Mo(this,t),h=c.tween;if(h!==r){s=(r=h).slice();for(var l={name:e,value:n},m=0,_=s.length;m<_;++m)if(s[m].name===e){s[m]=l;break}m===_&&s.push(l)}c.tween=s}}function kH(t,e){var n=this._id;if(t+="",arguments.length<2){for(var r=Js(this.node(),n).tween,s=0,c=r.length,h;s<c;++s)if((h=r[s]).name===t)return h.value;return null}return this.each((e==null?IH:DH)(n,t,e))}function ew(t,e,n){var r=t._id;return t.each(function(){var s=Mo(this,r);(s.value||(s.value={}))[e]=n.apply(this,arguments)}),function(s){return Js(s,r).value[e]}}function XA(t,e){var n;return(typeof e=="number"?qs:e instanceof Hu?W1:(n=Hu(e))?(e=n,W1):wA)(t,e)}function LH(t){return function(){this.removeAttribute(t)}}function zH(t){return function(){this.removeAttributeNS(t.space,t.local)}}function FH(t,e,n){var r,s=n+"",c;return function(){var h=this.getAttribute(t);return h===s?null:h===r?c:c=e(r=h,n)}}function NH(t,e,n){var r,s=n+"",c;return function(){var h=this.getAttributeNS(t.space,t.local);return h===s?null:h===r?c:c=e(r=h,n)}}function BH(t,e,n){var r,s,c;return function(){var h,l=n(this),m;return l==null?void this.removeAttribute(t):(h=this.getAttribute(t),m=l+"",h===m?null:h===r&&m===s?c:(s=m,c=e(r=h,l)))}}function OH(t,e,n){var r,s,c;return function(){var h,l=n(this),m;return l==null?void this.removeAttributeNS(t.space,t.local):(h=this.getAttributeNS(t.space,t.local),m=l+"",h===m?null:h===r&&m===s?c:(s=m,c=e(r=h,l)))}}function UH(t,e){var n=Rv(t),r=n==="transform"?uU:XA;return this.attrTween(t,typeof e=="function"?(n.local?OH:BH)(n,r,ew(this,"attr."+t,e)):e==null?(n.local?zH:LH)(n):(n.local?NH:FH)(n,r,e))}function VH(t,e){return function(n){this.setAttribute(t,e.call(this,n))}}function HH(t,e){return function(n){this.setAttributeNS(t.space,t.local,e.call(this,n))}}function GH(t,e){var n,r;function s(){var c=e.apply(this,arguments);return c!==r&&(n=(r=c)&&HH(t,c)),n}return s._value=e,s}function jH(t,e){var n,r;function s(){var c=e.apply(this,arguments);return c!==r&&(n=(r=c)&&VH(t,c)),n}return s._value=e,s}function WH(t,e){var n="attr."+t;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(e==null)return this.tween(n,null);if(typeof e!="function")throw new Error;var r=Rv(t);return this.tween(n,(r.local?GH:jH)(r,e))}function qH(t,e){return function(){Qb(this,t).delay=+e.apply(this,arguments)}}function $H(t,e){return e=+e,function(){Qb(this,t).delay=e}}function XH(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?qH:$H)(e,t)):Js(this.node(),e).delay}function ZH(t,e){return function(){Mo(this,t).duration=+e.apply(this,arguments)}}function YH(t,e){return e=+e,function(){Mo(this,t).duration=e}}function KH(t){var e=this._id;return arguments.length?this.each((typeof t=="function"?ZH:YH)(e,t)):Js(this.node(),e).duration}function JH(t,e){if(typeof e!="function")throw new Error;return function(){Mo(this,t).ease=e}}function QH(t){var e=this._id;return arguments.length?this.each(JH(e,t)):Js(this.node(),e).ease}function eG(t,e){return function(){var n=e.apply(this,arguments);if(typeof n!="function")throw new Error;Mo(this,t).ease=n}}function tG(t){if(typeof t!="function")throw new Error;return this.each(eG(this._id,t))}function nG(t){typeof t!="function"&&(t=RA(t));for(var e=this._groups,n=e.length,r=new Array(n),s=0;s<n;++s)for(var c=e[s],h=c.length,l=r[s]=[],m,_=0;_<h;++_)(m=c[_])&&t.call(m,m.__data__,_,c)&&l.push(m);return new ml(r,this._parents,this._name,this._id)}function rG(t){if(t._id!==this._id)throw new Error;for(var e=this._groups,n=t._groups,r=e.length,s=n.length,c=Math.min(r,s),h=new Array(r),l=0;l<c;++l)for(var m=e[l],_=n[l],S=m.length,T=h[l]=new Array(S),M,I=0;I<S;++I)(M=m[I]||_[I])&&(T[I]=M);for(;l<r;++l)h[l]=e[l];return new ml(h,this._parents,this._name,this._id)}function iG(t){return(t+"").trim().split(/^|\s+/).every(function(e){var n=e.indexOf(".");return n>=0&&(e=e.slice(0,n)),!e||e==="start"})}function aG(t,e,n){var r,s,c=iG(e)?Qb:Mo;return function(){var h=c(this,t),l=h.on;l!==r&&(s=(r=l).copy()).on(e,n),h.on=s}}function sG(t,e){var n=this._id;return arguments.length<2?Js(this.node(),n).on.on(t):this.each(aG(n,t,e))}function oG(t){return function(){var e=this.parentNode;for(var n in this.__transition)if(+n!==t)return;e&&e.removeChild(this)}}function lG(){return this.on("end.remove",oG(this._id))}function cG(t){var e=this._name,n=this._id;typeof t!="function"&&(t=Yb(t));for(var r=this._groups,s=r.length,c=new Array(s),h=0;h<s;++h)for(var l=r[h],m=l.length,_=c[h]=new Array(m),S,T,M=0;M<m;++M)(S=l[M])&&(T=t.call(S,S.__data__,M,l))&&("__data__"in S&&(T.__data__=S.__data__),_[M]=T,Dv(_[M],e,n,M,_,Js(S,n)));return new ml(c,this._parents,e,n)}function uG(t){var e=this._name,n=this._id;typeof t!="function"&&(t=PA(t));for(var r=this._groups,s=r.length,c=[],h=[],l=0;l<s;++l)for(var m=r[l],_=m.length,S,T=0;T<_;++T)if(S=m[T]){for(var M=t.call(S,S.__data__,T,m),I,N=Js(S,n),B=0,k=M.length;B<k;++B)(I=M[B])&&Dv(I,e,n,B,M,N);c.push(M),h.push(S)}return new ml(c,h,e,n)}var hG=Kd.prototype.constructor;function dG(){return new hG(this._groups,this._parents)}function fG(t,e){var n,r,s;return function(){var c=Vd(this,t),h=(this.style.removeProperty(t),Vd(this,t));return c===h?null:c===n&&h===r?s:s=e(n=c,r=h)}}function ZA(t){return function(){this.style.removeProperty(t)}}function pG(t,e,n){var r,s=n+"",c;return function(){var h=Vd(this,t);return h===s?null:h===r?c:c=e(r=h,n)}}function mG(t,e,n){var r,s,c;return function(){var h=Vd(this,t),l=n(this),m=l+"";return l==null&&(m=l=(this.style.removeProperty(t),Vd(this,t))),h===m?null:h===r&&m===s?c:(s=m,c=e(r=h,l))}}function gG(t,e){var n,r,s,c="style."+e,h="end."+c,l;return function(){var m=Mo(this,t),_=m.on,S=m.value[c]==null?l||(l=ZA(e)):void 0;(_!==n||s!==S)&&(r=(n=_).copy()).on(h,s=S),m.on=r}}function vG(t,e,n){var r=(t+="")=="transform"?cU:XA;return e==null?this.styleTween(t,fG(t,r)).on("end.style."+t,ZA(t)):typeof e=="function"?this.styleTween(t,mG(t,r,ew(this,"style."+t,e))).each(gG(this._id,t)):this.styleTween(t,pG(t,r,e),n).on("end.style."+t,null)}function yG(t,e,n){return function(r){this.style.setProperty(t,e.call(this,r),n)}}function _G(t,e,n){var r,s;function c(){var h=e.apply(this,arguments);return h!==s&&(r=(s=h)&&yG(t,h,n)),r}return c._value=e,c}function xG(t,e,n){var r="style."+(t+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,_G(t,e,n??""))}function bG(t){return function(){this.textContent=t}}function wG(t){return function(){var e=t(this);this.textContent=e??""}}function SG(t){return this.tween("text",typeof t=="function"?wG(ew(this,"text",t)):bG(t==null?"":t+""))}function MG(t){return function(e){this.textContent=t.call(this,e)}}function TG(t){var e,n;function r(){var s=t.apply(this,arguments);return s!==n&&(e=(n=s)&&MG(s)),e}return r._value=t,r}function EG(t){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(t==null)return this.tween(e,null);if(typeof t!="function")throw new Error;return this.tween(e,TG(t))}function AG(){for(var t=this._name,e=this._id,n=YA(),r=this._groups,s=r.length,c=0;c<s;++c)for(var h=r[c],l=h.length,m,_=0;_<l;++_)if(m=h[_]){var S=Js(m,e);Dv(m,t,n,_,h,{time:S.time+S.delay+S.duration,delay:0,duration:S.duration,ease:S.ease})}return new ml(r,this._parents,t,n)}function CG(){var t,e,n=this,r=n._id,s=n.size();return new Promise(function(c,h){var l={value:h},m={value:function(){--s===0&&c()}};n.each(function(){var _=Mo(this,r),S=_.on;S!==t&&(e=(t=S).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(m)),_.on=e}),s===0&&c()})}var PG=0;function ml(t,e,n,r){this._groups=t,this._parents=e,this._name=n,this._id=r}function J1(t){return Kd().transition(t)}function YA(){return++PG}var Yo=Kd.prototype;ml.prototype=J1.prototype={constructor:ml,select:cG,selectAll:uG,selectChild:Yo.selectChild,selectChildren:Yo.selectChildren,filter:nG,merge:rG,selection:dG,transition:AG,call:Yo.call,nodes:Yo.nodes,node:Yo.node,size:Yo.size,empty:Yo.empty,each:Yo.each,on:sG,attr:UH,attrTween:WH,style:vG,styleTween:xG,text:SG,textTween:EG,remove:lG,tween:kH,delay:XH,duration:KH,ease:QH,easeVarying:tG,end:CG,[Symbol.iterator]:Yo[Symbol.iterator]};const wM=t=>+t;function RG(t){return((t*=2)<=1?t*t*t:(t-=2)*t*t+2)/2}var IG={time:null,delay:0,duration:250,ease:RG};function DG(t,e){for(var n;!(n=t.__transition)||!(n=n[e]);)if(!(t=t.parentNode))throw new Error(`transition ${e} not found`);return n}function kG(t){var e,n;t instanceof ml?(e=t._id,t=t._name):(e=YA(),(n=IG).time=Jb(),t=t==null?null:t+"");for(var r=this._groups,s=r.length,c=0;c<s;++c)for(var h=r[c],l=h.length,m,_=0;_<l;++_)(m=h[_])&&Dv(m,t,e,_,h,n||DG(m,e));return new ml(r,this._parents,t,e)}Kd.prototype.interrupt=RH;Kd.prototype.transition=kG;class Ya{constructor(e,n,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=n,this.end=r}static range(e,n){return n?!e||!e.loc||!n.loc||e.loc.lexer!==n.loc.lexer?null:new Ya(e.loc.lexer,e.loc.start,n.loc.end):e&&e.loc}}class Ms{constructor(e,n){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=n}range(e,n){return new Ms(n,Ya.range(this,e))}}class Ot{constructor(e,n){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,s,c,h=n&&n.loc;if(h&&h.start<=h.end){var l=h.lexer.input;s=h.start,c=h.end,s===l.length?r+=" at end of input: ":r+=" at position "+(s+1)+": ";var m=l.slice(s,c).replace(/[^]/g,"$&̲"),_;s>15?_="…"+l.slice(s-15,s):_=l.slice(0,s);var S;c+15<l.length?S=l.slice(c,c+15)+"…":S=l.slice(c),r+=_+m+S}var T=new Error(r);return T.name="ParseError",T.__proto__=Ot.prototype,T.position=s,s!=null&&c!=null&&(T.length=c-s),T.rawMessage=e,T}}Ot.prototype.__proto__=Error.prototype;var LG=function(e,n){return e.indexOf(n)!==-1},zG=function(e,n){return e===void 0?n:e},FG=/([A-Z])/g,NG=function(e){return e.replace(FG,"-$1").toLowerCase()},BG={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},OG=/[&><"']/g;function UG(t){return String(t).replace(OG,e=>BG[e])}var KA=function t(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?t(e.body[0]):e:e.type==="font"?t(e.body):e},VG=function(e){var n=KA(e);return n.type==="mathord"||n.type==="textord"||n.type==="atom"},HG=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},GG=function(e){var n=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return n?n[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(n[1])?null:n[1].toLowerCase():"_relative"},kn={contains:LG,deflt:zG,escape:UG,hyphenate:NG,getBaseElem:KA,isCharacterBox:VG,protocolFromUrl:GG},c1={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:t=>"#"+t},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(t,e)=>(e.push(t),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:t=>Math.max(0,t),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:t=>Math.max(0,t),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:t=>Math.max(0,t),cli:"-e, --max-expand <n>",cliProcessor:t=>t==="Infinity"?1/0:parseInt(t)},globalGroup:{type:"boolean",cli:!1}};function jG(t){if(t.default)return t.default;var e=t.type,n=Array.isArray(e)?e[0]:e;if(typeof n!="string")return n.enum[0];switch(n){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class tw{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var n in c1)if(c1.hasOwnProperty(n)){var r=c1[n];this[n]=e[n]!==void 0?r.processor?r.processor(e[n]):e[n]:jG(r)}}reportNonstrict(e,n,r){var s=this.strict;if(typeof s=="function"&&(s=s(e,n,r)),!(!s||s==="ignore")){if(s===!0||s==="error")throw new Ot("LaTeX-incompatible input and strict mode is set to 'error': "+(n+" ["+e+"]"),r);s==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+n+" ["+e+"]"))}}useStrictBehavior(e,n,r){var s=this.strict;if(typeof s=="function")try{s=s(e,n,r)}catch{s="error"}return!s||s==="ignore"?!1:s===!0||s==="error"?!0:s==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(n+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+s+"': "+n+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var n=kn.protocolFromUrl(e.url);if(n==null)return!1;e.protocol=n}var r=typeof this.trust=="function"?this.trust(e):this.trust;return!!r}}class Ql{constructor(e,n,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=n,this.cramped=r}sup(){return co[WG[this.id]]}sub(){return co[qG[this.id]]}fracNum(){return co[$G[this.id]]}fracDen(){return co[XG[this.id]]}cramp(){return co[ZG[this.id]]}text(){return co[YG[this.id]]}isTight(){return this.size>=2}}var nw=0,Q1=1,Ad=2,ol=3,Mp=4,ws=5,Gd=6,ya=7,co=[new Ql(nw,0,!1),new Ql(Q1,0,!0),new Ql(Ad,1,!1),new Ql(ol,1,!0),new Ql(Mp,2,!1),new Ql(ws,2,!0),new Ql(Gd,3,!1),new Ql(ya,3,!0)],WG=[Mp,ws,Mp,ws,Gd,ya,Gd,ya],qG=[ws,ws,ws,ws,ya,ya,ya,ya],$G=[Ad,ol,Mp,ws,Gd,ya,Gd,ya],XG=[ol,ol,ws,ws,ya,ya,ya,ya],ZG=[Q1,Q1,ol,ol,ws,ws,ya,ya],YG=[nw,Q1,Ad,ol,Ad,ol,Ad,ol],Fn={DISPLAY:co[nw],TEXT:co[Ad],SCRIPT:co[Mp],SCRIPTSCRIPT:co[Gd]},P2=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function KG(t){for(var e=0;e<P2.length;e++)for(var n=P2[e],r=0;r<n.blocks.length;r++){var s=n.blocks[r];if(t>=s[0]&&t<=s[1])return n.name}return null}var u1=[];P2.forEach(t=>t.blocks.forEach(e=>u1.push(...e)));function JA(t){for(var e=0;e<u1.length;e+=2)if(t>=u1[e]&&t<=u1[e+1])return!0;return!1}var Jh=80,JG=function(e,n){return"M95,"+(622+e+n)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},QG=function(e,n){return"M263,"+(601+e+n)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},ej=function(e,n){return"M983 "+(10+e+n)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+n+"h400000v"+(40+e)+"h-400000z"},tj=function(e,n){return"M424,"+(2398+e+n)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+n+`
h400000v`+(40+e)+"h-400000z"},nj=function(e,n){return"M473,"+(2713+e+n)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+n+"h400000v"+(40+e)+"H1017.7z"},rj=function(e){var n=e/2;return"M400000 "+e+" H0 L"+n+" 0 l65 45 L145 "+(e-80)+" H400000z"},ij=function(e,n,r){var s=r-54-n-e;return"M702 "+(e+n)+"H400000"+(40+e)+`
H742v`+s+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+n+"H400000v"+(40+e)+"H742z"},aj=function(e,n,r){n=1e3*n;var s="";switch(e){case"sqrtMain":s=JG(n,Jh);break;case"sqrtSize1":s=QG(n,Jh);break;case"sqrtSize2":s=ej(n,Jh);break;case"sqrtSize3":s=tj(n,Jh);break;case"sqrtSize4":s=nj(n,Jh);break;case"sqrtTall":s=ij(n,Jh,r)}return s},sj=function(e,n){switch(e){case"⎜":return"M291 0 H417 V"+n+" H291z M291 0 H417 V"+n+" H291z";case"∣":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z";case"∥":return"M145 0 H188 V"+n+" H145z M145 0 H188 V"+n+" H145z"+("M367 0 H410 V"+n+" H367z M367 0 H410 V"+n+" H367z");case"⎟":return"M457 0 H583 V"+n+" H457z M457 0 H583 V"+n+" H457z";case"⎢":return"M319 0 H403 V"+n+" H319z M319 0 H403 V"+n+" H319z";case"⎥":return"M263 0 H347 V"+n+" H263z M263 0 H347 V"+n+" H263z";case"⎪":return"M384 0 H504 V"+n+" H384z M384 0 H504 V"+n+" H384z";case"⏐":return"M312 0 H355 V"+n+" H312z M312 0 H355 V"+n+" H312z";case"‖":return"M257 0 H300 V"+n+" H257z M257 0 H300 V"+n+" H257z"+("M478 0 H521 V"+n+" H478z M478 0 H521 V"+n+" H478z");default:return""}},SM={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},oj=function(e,n){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+n+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+n+" v1759 h84z";case"vert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+" v585 h43z";case"doublevert":return"M145 15 v585 v"+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+n+` v585 h43z
M367 15 v585 v`+n+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-n+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+n+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+n+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+n+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+n+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+n+` v602 h84z
M403 1759 V0 H319 V1759 v`+n+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+n+` v602 h84z
M347 1759 V0 h-84 V1759 v`+n+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(n+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(n+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(n+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(n+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class Op{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return kn.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),n=0;n<this.children.length;n++)e.appendChild(this.children[n].toNode());return e}toMarkup(){for(var e="",n=0;n<this.children.length;n++)e+=this.children[n].toMarkup();return e}toText(){var e=n=>n.toText();return this.children.map(e).join("")}}var vo={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},Ng={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},MM={Å:"A",Ð:"D",Þ:"o",å:"a",ð:"d",þ:"o",А:"A",Б:"B",В:"B",Г:"F",Д:"A",Е:"E",Ж:"K",З:"3",И:"N",Й:"N",К:"K",Л:"N",М:"M",Н:"H",О:"O",П:"N",Р:"P",С:"C",Т:"T",У:"y",Ф:"O",Х:"X",Ц:"U",Ч:"h",Ш:"W",Щ:"W",Ъ:"B",Ы:"X",Ь:"B",Э:"3",Ю:"X",Я:"R",а:"a",б:"b",в:"a",г:"r",д:"y",е:"e",ж:"m",з:"e",и:"n",й:"n",к:"n",л:"n",м:"m",н:"n",о:"o",п:"n",р:"p",с:"c",т:"o",у:"y",ф:"b",х:"x",ц:"n",ч:"n",ш:"w",щ:"w",ъ:"a",ы:"m",ь:"a",э:"e",ю:"m",я:"r"};function lj(t,e){vo[t]=e}function rw(t,e,n){if(!vo[e])throw new Error("Font metrics not found for font: "+e+".");var r=t.charCodeAt(0),s=vo[e][r];if(!s&&t[0]in MM&&(r=MM[t[0]].charCodeAt(0),s=vo[e][r]),!s&&n==="text"&&JA(r)&&(s=vo[e][77]),s)return{depth:s[0],height:s[1],italic:s[2],skew:s[3],width:s[4]}}var J_={};function cj(t){var e;if(t>=5?e=0:t>=3?e=1:e=2,!J_[e]){var n=J_[e]={cssEmPerMu:Ng.quad[e]/18};for(var r in Ng)Ng.hasOwnProperty(r)&&(n[r]=Ng[r][e])}return J_[e]}var uj=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],TM=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],EM=function(e,n){return n.size<2?e:uj[e-1][n.size-1]};class tl{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||tl.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=TM[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var n={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in e)e.hasOwnProperty(r)&&(n[r]=e[r]);return new tl(n)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:EM(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:TM[e-1]})}havingBaseStyle(e){e=e||this.style.text();var n=EM(tl.BASESIZE,e);return this.size===n&&this.textSize===tl.BASESIZE&&this.style===e?this:this.extend({style:e,size:n})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==tl.BASESIZE?["sizing","reset-size"+this.size,"size"+tl.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=cj(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}tl.BASESIZE=6;var R2={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},hj={ex:!0,em:!0,mu:!0},QA=function(e){return typeof e!="string"&&(e=e.unit),e in R2||e in hj||e==="ex"},qr=function(e,n){var r;if(e.unit in R2)r=R2[e.unit]/n.fontMetrics().ptPerEm/n.sizeMultiplier;else if(e.unit==="mu")r=n.fontMetrics().cssEmPerMu;else{var s;if(n.style.isTight()?s=n.havingStyle(n.style.text()):s=n,e.unit==="ex")r=s.fontMetrics().xHeight;else if(e.unit==="em")r=s.fontMetrics().quad;else throw new Ot("Invalid unit: '"+e.unit+"'");s!==n&&(r*=s.sizeMultiplier/n.sizeMultiplier)}return Math.min(e.number*r,n.maxSize)},Xt=function(e){return+e.toFixed(4)+"em"},Ac=function(e){return e.filter(n=>n).join(" ")},e8=function(e,n,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},n){n.style.isTight()&&this.classes.push("mtight");var s=n.getColor();s&&(this.style.color=s)}},t8=function(e){var n=document.createElement(e);n.className=Ac(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(n.style[r]=this.style[r]);for(var s in this.attributes)this.attributes.hasOwnProperty(s)&&n.setAttribute(s,this.attributes[s]);for(var c=0;c<this.children.length;c++)n.appendChild(this.children[c].toNode());return n},n8=function(e){var n="<"+e;this.classes.length&&(n+=' class="'+kn.escape(Ac(this.classes))+'"');var r="";for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=kn.hyphenate(s)+":"+this.style[s]+";");r&&(n+=' style="'+kn.escape(r)+'"');for(var c in this.attributes)this.attributes.hasOwnProperty(c)&&(n+=" "+c+'="'+kn.escape(this.attributes[c])+'"');n+=">";for(var h=0;h<this.children.length;h++)n+=this.children[h].toMarkup();return n+="</"+e+">",n};class Up{constructor(e,n,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,e8.call(this,e,r,s),this.children=n||[]}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return kn.contains(this.classes,e)}toNode(){return t8.call(this,"span")}toMarkup(){return n8.call(this,"span")}}class iw{constructor(e,n,r,s){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,e8.call(this,n,s),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,n){this.attributes[e]=n}hasClass(e){return kn.contains(this.classes,e)}toNode(){return t8.call(this,"a")}toMarkup(){return n8.call(this,"a")}}class dj{constructor(e,n,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=n,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return kn.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var n in this.style)this.style.hasOwnProperty(n)&&(e.style[n]=this.style[n]);return e}toMarkup(){var e='<img src="'+kn.escape(this.src)+'"'+(' alt="'+kn.escape(this.alt)+'"'),n="";for(var r in this.style)this.style.hasOwnProperty(r)&&(n+=kn.hyphenate(r)+":"+this.style[r]+";");return n&&(e+=' style="'+kn.escape(n)+'"'),e+="'/>",e}}var fj={î:"ı̂",ï:"ı̈",í:"ı́",ì:"ı̀"};class As{constructor(e,n,r,s,c,h,l,m){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=n||0,this.depth=r||0,this.italic=s||0,this.skew=c||0,this.width=h||0,this.classes=l||[],this.style=m||{},this.maxFontSize=0;var _=KG(this.text.charCodeAt(0));_&&this.classes.push(_+"_fallback"),/[îïíì]/.test(this.text)&&(this.text=fj[this.text])}hasClass(e){return kn.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),n=null;this.italic>0&&(n=document.createElement("span"),n.style.marginRight=Xt(this.italic)),this.classes.length>0&&(n=n||document.createElement("span"),n.className=Ac(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(n=n||document.createElement("span"),n.style[r]=this.style[r]);return n?(n.appendChild(e),n):e}toMarkup(){var e=!1,n="<span";this.classes.length&&(e=!0,n+=' class="',n+=kn.escape(Ac(this.classes)),n+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var s in this.style)this.style.hasOwnProperty(s)&&(r+=kn.hyphenate(s)+":"+this.style[s]+";");r&&(e=!0,n+=' style="'+kn.escape(r)+'"');var c=kn.escape(this.text);return e?(n+=">",n+=c,n+="</span>",n):c}}class gl{constructor(e,n){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=n||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);for(var s=0;s<this.children.length;s++)n.appendChild(this.children[s].toNode());return n}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+kn.escape(this.attributes[n])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class Cc{constructor(e,n){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=n}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"path");return this.alternate?n.setAttribute("d",this.alternate):n.setAttribute("d",SM[this.pathName]),n}toMarkup(){return this.alternate?'<path d="'+kn.escape(this.alternate)+'"/>':'<path d="'+kn.escape(SM[this.pathName])+'"/>'}}class I2{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&n.setAttribute(r,this.attributes[r]);return n}toMarkup(){var e="<line";for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="'+kn.escape(this.attributes[n])+'"');return e+="/>",e}}function AM(t){if(t instanceof As)return t;throw new Error("Expected symbolNode but got "+String(t)+".")}function pj(t){if(t instanceof Up)return t;throw new Error("Expected span<HtmlDomNode> but got "+String(t)+".")}var mj={bin:1,close:1,inner:1,open:1,punct:1,rel:1},gj={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Pr={math:{},text:{}};function z(t,e,n,r,s,c){Pr[t][s]={font:e,group:n,replace:r},c&&r&&(Pr[t][r]=Pr[t][s])}var G="math",Ct="text",ee="main",Ee="ams",Ur="accent-token",fn="bin",Sa="close",Jd="inner",zn="mathord",gi="op-token",as="open",kv="punct",Ie="rel",xl="spacing",Ue="textord";z(G,ee,Ie,"≡","\\equiv",!0);z(G,ee,Ie,"≺","\\prec",!0);z(G,ee,Ie,"≻","\\succ",!0);z(G,ee,Ie,"∼","\\sim",!0);z(G,ee,Ie,"⊥","\\perp");z(G,ee,Ie,"⪯","\\preceq",!0);z(G,ee,Ie,"⪰","\\succeq",!0);z(G,ee,Ie,"≃","\\simeq",!0);z(G,ee,Ie,"∣","\\mid",!0);z(G,ee,Ie,"≪","\\ll",!0);z(G,ee,Ie,"≫","\\gg",!0);z(G,ee,Ie,"≍","\\asymp",!0);z(G,ee,Ie,"∥","\\parallel");z(G,ee,Ie,"⋈","\\bowtie",!0);z(G,ee,Ie,"⌣","\\smile",!0);z(G,ee,Ie,"⊑","\\sqsubseteq",!0);z(G,ee,Ie,"⊒","\\sqsupseteq",!0);z(G,ee,Ie,"≐","\\doteq",!0);z(G,ee,Ie,"⌢","\\frown",!0);z(G,ee,Ie,"∋","\\ni",!0);z(G,ee,Ie,"∝","\\propto",!0);z(G,ee,Ie,"⊢","\\vdash",!0);z(G,ee,Ie,"⊣","\\dashv",!0);z(G,ee,Ie,"∋","\\owns");z(G,ee,kv,".","\\ldotp");z(G,ee,kv,"⋅","\\cdotp");z(G,ee,Ue,"#","\\#");z(Ct,ee,Ue,"#","\\#");z(G,ee,Ue,"&","\\&");z(Ct,ee,Ue,"&","\\&");z(G,ee,Ue,"ℵ","\\aleph",!0);z(G,ee,Ue,"∀","\\forall",!0);z(G,ee,Ue,"ℏ","\\hbar",!0);z(G,ee,Ue,"∃","\\exists",!0);z(G,ee,Ue,"∇","\\nabla",!0);z(G,ee,Ue,"♭","\\flat",!0);z(G,ee,Ue,"ℓ","\\ell",!0);z(G,ee,Ue,"♮","\\natural",!0);z(G,ee,Ue,"♣","\\clubsuit",!0);z(G,ee,Ue,"℘","\\wp",!0);z(G,ee,Ue,"♯","\\sharp",!0);z(G,ee,Ue,"♢","\\diamondsuit",!0);z(G,ee,Ue,"ℜ","\\Re",!0);z(G,ee,Ue,"♡","\\heartsuit",!0);z(G,ee,Ue,"ℑ","\\Im",!0);z(G,ee,Ue,"♠","\\spadesuit",!0);z(G,ee,Ue,"§","\\S",!0);z(Ct,ee,Ue,"§","\\S");z(G,ee,Ue,"¶","\\P",!0);z(Ct,ee,Ue,"¶","\\P");z(G,ee,Ue,"†","\\dag");z(Ct,ee,Ue,"†","\\dag");z(Ct,ee,Ue,"†","\\textdagger");z(G,ee,Ue,"‡","\\ddag");z(Ct,ee,Ue,"‡","\\ddag");z(Ct,ee,Ue,"‡","\\textdaggerdbl");z(G,ee,Sa,"⎱","\\rmoustache",!0);z(G,ee,as,"⎰","\\lmoustache",!0);z(G,ee,Sa,"⟯","\\rgroup",!0);z(G,ee,as,"⟮","\\lgroup",!0);z(G,ee,fn,"∓","\\mp",!0);z(G,ee,fn,"⊖","\\ominus",!0);z(G,ee,fn,"⊎","\\uplus",!0);z(G,ee,fn,"⊓","\\sqcap",!0);z(G,ee,fn,"∗","\\ast");z(G,ee,fn,"⊔","\\sqcup",!0);z(G,ee,fn,"◯","\\bigcirc",!0);z(G,ee,fn,"∙","\\bullet",!0);z(G,ee,fn,"‡","\\ddagger");z(G,ee,fn,"≀","\\wr",!0);z(G,ee,fn,"⨿","\\amalg");z(G,ee,fn,"&","\\And");z(G,ee,Ie,"⟵","\\longleftarrow",!0);z(G,ee,Ie,"⇐","\\Leftarrow",!0);z(G,ee,Ie,"⟸","\\Longleftarrow",!0);z(G,ee,Ie,"⟶","\\longrightarrow",!0);z(G,ee,Ie,"⇒","\\Rightarrow",!0);z(G,ee,Ie,"⟹","\\Longrightarrow",!0);z(G,ee,Ie,"↔","\\leftrightarrow",!0);z(G,ee,Ie,"⟷","\\longleftrightarrow",!0);z(G,ee,Ie,"⇔","\\Leftrightarrow",!0);z(G,ee,Ie,"⟺","\\Longleftrightarrow",!0);z(G,ee,Ie,"↦","\\mapsto",!0);z(G,ee,Ie,"⟼","\\longmapsto",!0);z(G,ee,Ie,"↗","\\nearrow",!0);z(G,ee,Ie,"↩","\\hookleftarrow",!0);z(G,ee,Ie,"↪","\\hookrightarrow",!0);z(G,ee,Ie,"↘","\\searrow",!0);z(G,ee,Ie,"↼","\\leftharpoonup",!0);z(G,ee,Ie,"⇀","\\rightharpoonup",!0);z(G,ee,Ie,"↙","\\swarrow",!0);z(G,ee,Ie,"↽","\\leftharpoondown",!0);z(G,ee,Ie,"⇁","\\rightharpoondown",!0);z(G,ee,Ie,"↖","\\nwarrow",!0);z(G,ee,Ie,"⇌","\\rightleftharpoons",!0);z(G,Ee,Ie,"≮","\\nless",!0);z(G,Ee,Ie,"","\\@nleqslant");z(G,Ee,Ie,"","\\@nleqq");z(G,Ee,Ie,"⪇","\\lneq",!0);z(G,Ee,Ie,"≨","\\lneqq",!0);z(G,Ee,Ie,"","\\@lvertneqq");z(G,Ee,Ie,"⋦","\\lnsim",!0);z(G,Ee,Ie,"⪉","\\lnapprox",!0);z(G,Ee,Ie,"⊀","\\nprec",!0);z(G,Ee,Ie,"⋠","\\npreceq",!0);z(G,Ee,Ie,"⋨","\\precnsim",!0);z(G,Ee,Ie,"⪹","\\precnapprox",!0);z(G,Ee,Ie,"≁","\\nsim",!0);z(G,Ee,Ie,"","\\@nshortmid");z(G,Ee,Ie,"∤","\\nmid",!0);z(G,Ee,Ie,"⊬","\\nvdash",!0);z(G,Ee,Ie,"⊭","\\nvDash",!0);z(G,Ee,Ie,"⋪","\\ntriangleleft");z(G,Ee,Ie,"⋬","\\ntrianglelefteq",!0);z(G,Ee,Ie,"⊊","\\subsetneq",!0);z(G,Ee,Ie,"","\\@varsubsetneq");z(G,Ee,Ie,"⫋","\\subsetneqq",!0);z(G,Ee,Ie,"","\\@varsubsetneqq");z(G,Ee,Ie,"≯","\\ngtr",!0);z(G,Ee,Ie,"","\\@ngeqslant");z(G,Ee,Ie,"","\\@ngeqq");z(G,Ee,Ie,"⪈","\\gneq",!0);z(G,Ee,Ie,"≩","\\gneqq",!0);z(G,Ee,Ie,"","\\@gvertneqq");z(G,Ee,Ie,"⋧","\\gnsim",!0);z(G,Ee,Ie,"⪊","\\gnapprox",!0);z(G,Ee,Ie,"⊁","\\nsucc",!0);z(G,Ee,Ie,"⋡","\\nsucceq",!0);z(G,Ee,Ie,"⋩","\\succnsim",!0);z(G,Ee,Ie,"⪺","\\succnapprox",!0);z(G,Ee,Ie,"≆","\\ncong",!0);z(G,Ee,Ie,"","\\@nshortparallel");z(G,Ee,Ie,"∦","\\nparallel",!0);z(G,Ee,Ie,"⊯","\\nVDash",!0);z(G,Ee,Ie,"⋫","\\ntriangleright");z(G,Ee,Ie,"⋭","\\ntrianglerighteq",!0);z(G,Ee,Ie,"","\\@nsupseteqq");z(G,Ee,Ie,"⊋","\\supsetneq",!0);z(G,Ee,Ie,"","\\@varsupsetneq");z(G,Ee,Ie,"⫌","\\supsetneqq",!0);z(G,Ee,Ie,"","\\@varsupsetneqq");z(G,Ee,Ie,"⊮","\\nVdash",!0);z(G,Ee,Ie,"⪵","\\precneqq",!0);z(G,Ee,Ie,"⪶","\\succneqq",!0);z(G,Ee,Ie,"","\\@nsubseteqq");z(G,Ee,fn,"⊴","\\unlhd");z(G,Ee,fn,"⊵","\\unrhd");z(G,Ee,Ie,"↚","\\nleftarrow",!0);z(G,Ee,Ie,"↛","\\nrightarrow",!0);z(G,Ee,Ie,"⇍","\\nLeftarrow",!0);z(G,Ee,Ie,"⇏","\\nRightarrow",!0);z(G,Ee,Ie,"↮","\\nleftrightarrow",!0);z(G,Ee,Ie,"⇎","\\nLeftrightarrow",!0);z(G,Ee,Ie,"△","\\vartriangle");z(G,Ee,Ue,"ℏ","\\hslash");z(G,Ee,Ue,"▽","\\triangledown");z(G,Ee,Ue,"◊","\\lozenge");z(G,Ee,Ue,"Ⓢ","\\circledS");z(G,Ee,Ue,"®","\\circledR");z(Ct,Ee,Ue,"®","\\circledR");z(G,Ee,Ue,"∡","\\measuredangle",!0);z(G,Ee,Ue,"∄","\\nexists");z(G,Ee,Ue,"℧","\\mho");z(G,Ee,Ue,"Ⅎ","\\Finv",!0);z(G,Ee,Ue,"⅁","\\Game",!0);z(G,Ee,Ue,"‵","\\backprime");z(G,Ee,Ue,"▲","\\blacktriangle");z(G,Ee,Ue,"▼","\\blacktriangledown");z(G,Ee,Ue,"■","\\blacksquare");z(G,Ee,Ue,"⧫","\\blacklozenge");z(G,Ee,Ue,"★","\\bigstar");z(G,Ee,Ue,"∢","\\sphericalangle",!0);z(G,Ee,Ue,"∁","\\complement",!0);z(G,Ee,Ue,"ð","\\eth",!0);z(Ct,ee,Ue,"ð","ð");z(G,Ee,Ue,"╱","\\diagup");z(G,Ee,Ue,"╲","\\diagdown");z(G,Ee,Ue,"□","\\square");z(G,Ee,Ue,"□","\\Box");z(G,Ee,Ue,"◊","\\Diamond");z(G,Ee,Ue,"¥","\\yen",!0);z(Ct,Ee,Ue,"¥","\\yen",!0);z(G,Ee,Ue,"✓","\\checkmark",!0);z(Ct,Ee,Ue,"✓","\\checkmark");z(G,Ee,Ue,"ℶ","\\beth",!0);z(G,Ee,Ue,"ℸ","\\daleth",!0);z(G,Ee,Ue,"ℷ","\\gimel",!0);z(G,Ee,Ue,"ϝ","\\digamma",!0);z(G,Ee,Ue,"ϰ","\\varkappa");z(G,Ee,as,"┌","\\@ulcorner",!0);z(G,Ee,Sa,"┐","\\@urcorner",!0);z(G,Ee,as,"└","\\@llcorner",!0);z(G,Ee,Sa,"┘","\\@lrcorner",!0);z(G,Ee,Ie,"≦","\\leqq",!0);z(G,Ee,Ie,"⩽","\\leqslant",!0);z(G,Ee,Ie,"⪕","\\eqslantless",!0);z(G,Ee,Ie,"≲","\\lesssim",!0);z(G,Ee,Ie,"⪅","\\lessapprox",!0);z(G,Ee,Ie,"≊","\\approxeq",!0);z(G,Ee,fn,"⋖","\\lessdot");z(G,Ee,Ie,"⋘","\\lll",!0);z(G,Ee,Ie,"≶","\\lessgtr",!0);z(G,Ee,Ie,"⋚","\\lesseqgtr",!0);z(G,Ee,Ie,"⪋","\\lesseqqgtr",!0);z(G,Ee,Ie,"≑","\\doteqdot");z(G,Ee,Ie,"≓","\\risingdotseq",!0);z(G,Ee,Ie,"≒","\\fallingdotseq",!0);z(G,Ee,Ie,"∽","\\backsim",!0);z(G,Ee,Ie,"⋍","\\backsimeq",!0);z(G,Ee,Ie,"⫅","\\subseteqq",!0);z(G,Ee,Ie,"⋐","\\Subset",!0);z(G,Ee,Ie,"⊏","\\sqsubset",!0);z(G,Ee,Ie,"≼","\\preccurlyeq",!0);z(G,Ee,Ie,"⋞","\\curlyeqprec",!0);z(G,Ee,Ie,"≾","\\precsim",!0);z(G,Ee,Ie,"⪷","\\precapprox",!0);z(G,Ee,Ie,"⊲","\\vartriangleleft");z(G,Ee,Ie,"⊴","\\trianglelefteq");z(G,Ee,Ie,"⊨","\\vDash",!0);z(G,Ee,Ie,"⊪","\\Vvdash",!0);z(G,Ee,Ie,"⌣","\\smallsmile");z(G,Ee,Ie,"⌢","\\smallfrown");z(G,Ee,Ie,"≏","\\bumpeq",!0);z(G,Ee,Ie,"≎","\\Bumpeq",!0);z(G,Ee,Ie,"≧","\\geqq",!0);z(G,Ee,Ie,"⩾","\\geqslant",!0);z(G,Ee,Ie,"⪖","\\eqslantgtr",!0);z(G,Ee,Ie,"≳","\\gtrsim",!0);z(G,Ee,Ie,"⪆","\\gtrapprox",!0);z(G,Ee,fn,"⋗","\\gtrdot");z(G,Ee,Ie,"⋙","\\ggg",!0);z(G,Ee,Ie,"≷","\\gtrless",!0);z(G,Ee,Ie,"⋛","\\gtreqless",!0);z(G,Ee,Ie,"⪌","\\gtreqqless",!0);z(G,Ee,Ie,"≖","\\eqcirc",!0);z(G,Ee,Ie,"≗","\\circeq",!0);z(G,Ee,Ie,"≜","\\triangleq",!0);z(G,Ee,Ie,"∼","\\thicksim");z(G,Ee,Ie,"≈","\\thickapprox");z(G,Ee,Ie,"⫆","\\supseteqq",!0);z(G,Ee,Ie,"⋑","\\Supset",!0);z(G,Ee,Ie,"⊐","\\sqsupset",!0);z(G,Ee,Ie,"≽","\\succcurlyeq",!0);z(G,Ee,Ie,"⋟","\\curlyeqsucc",!0);z(G,Ee,Ie,"≿","\\succsim",!0);z(G,Ee,Ie,"⪸","\\succapprox",!0);z(G,Ee,Ie,"⊳","\\vartriangleright");z(G,Ee,Ie,"⊵","\\trianglerighteq");z(G,Ee,Ie,"⊩","\\Vdash",!0);z(G,Ee,Ie,"∣","\\shortmid");z(G,Ee,Ie,"∥","\\shortparallel");z(G,Ee,Ie,"≬","\\between",!0);z(G,Ee,Ie,"⋔","\\pitchfork",!0);z(G,Ee,Ie,"∝","\\varpropto");z(G,Ee,Ie,"◀","\\blacktriangleleft");z(G,Ee,Ie,"∴","\\therefore",!0);z(G,Ee,Ie,"∍","\\backepsilon");z(G,Ee,Ie,"▶","\\blacktriangleright");z(G,Ee,Ie,"∵","\\because",!0);z(G,Ee,Ie,"⋘","\\llless");z(G,Ee,Ie,"⋙","\\gggtr");z(G,Ee,fn,"⊲","\\lhd");z(G,Ee,fn,"⊳","\\rhd");z(G,Ee,Ie,"≂","\\eqsim",!0);z(G,ee,Ie,"⋈","\\Join");z(G,Ee,Ie,"≑","\\Doteq",!0);z(G,Ee,fn,"∔","\\dotplus",!0);z(G,Ee,fn,"∖","\\smallsetminus");z(G,Ee,fn,"⋒","\\Cap",!0);z(G,Ee,fn,"⋓","\\Cup",!0);z(G,Ee,fn,"⩞","\\doublebarwedge",!0);z(G,Ee,fn,"⊟","\\boxminus",!0);z(G,Ee,fn,"⊞","\\boxplus",!0);z(G,Ee,fn,"⋇","\\divideontimes",!0);z(G,Ee,fn,"⋉","\\ltimes",!0);z(G,Ee,fn,"⋊","\\rtimes",!0);z(G,Ee,fn,"⋋","\\leftthreetimes",!0);z(G,Ee,fn,"⋌","\\rightthreetimes",!0);z(G,Ee,fn,"⋏","\\curlywedge",!0);z(G,Ee,fn,"⋎","\\curlyvee",!0);z(G,Ee,fn,"⊝","\\circleddash",!0);z(G,Ee,fn,"⊛","\\circledast",!0);z(G,Ee,fn,"⋅","\\centerdot");z(G,Ee,fn,"⊺","\\intercal",!0);z(G,Ee,fn,"⋒","\\doublecap");z(G,Ee,fn,"⋓","\\doublecup");z(G,Ee,fn,"⊠","\\boxtimes",!0);z(G,Ee,Ie,"⇢","\\dashrightarrow",!0);z(G,Ee,Ie,"⇠","\\dashleftarrow",!0);z(G,Ee,Ie,"⇇","\\leftleftarrows",!0);z(G,Ee,Ie,"⇆","\\leftrightarrows",!0);z(G,Ee,Ie,"⇚","\\Lleftarrow",!0);z(G,Ee,Ie,"↞","\\twoheadleftarrow",!0);z(G,Ee,Ie,"↢","\\leftarrowtail",!0);z(G,Ee,Ie,"↫","\\looparrowleft",!0);z(G,Ee,Ie,"⇋","\\leftrightharpoons",!0);z(G,Ee,Ie,"↶","\\curvearrowleft",!0);z(G,Ee,Ie,"↺","\\circlearrowleft",!0);z(G,Ee,Ie,"↰","\\Lsh",!0);z(G,Ee,Ie,"⇈","\\upuparrows",!0);z(G,Ee,Ie,"↿","\\upharpoonleft",!0);z(G,Ee,Ie,"⇃","\\downharpoonleft",!0);z(G,ee,Ie,"⊶","\\origof",!0);z(G,ee,Ie,"⊷","\\imageof",!0);z(G,Ee,Ie,"⊸","\\multimap",!0);z(G,Ee,Ie,"↭","\\leftrightsquigarrow",!0);z(G,Ee,Ie,"⇉","\\rightrightarrows",!0);z(G,Ee,Ie,"⇄","\\rightleftarrows",!0);z(G,Ee,Ie,"↠","\\twoheadrightarrow",!0);z(G,Ee,Ie,"↣","\\rightarrowtail",!0);z(G,Ee,Ie,"↬","\\looparrowright",!0);z(G,Ee,Ie,"↷","\\curvearrowright",!0);z(G,Ee,Ie,"↻","\\circlearrowright",!0);z(G,Ee,Ie,"↱","\\Rsh",!0);z(G,Ee,Ie,"⇊","\\downdownarrows",!0);z(G,Ee,Ie,"↾","\\upharpoonright",!0);z(G,Ee,Ie,"⇂","\\downharpoonright",!0);z(G,Ee,Ie,"⇝","\\rightsquigarrow",!0);z(G,Ee,Ie,"⇝","\\leadsto");z(G,Ee,Ie,"⇛","\\Rrightarrow",!0);z(G,Ee,Ie,"↾","\\restriction");z(G,ee,Ue,"‘","`");z(G,ee,Ue,"$","\\$");z(Ct,ee,Ue,"$","\\$");z(Ct,ee,Ue,"$","\\textdollar");z(G,ee,Ue,"%","\\%");z(Ct,ee,Ue,"%","\\%");z(G,ee,Ue,"_","\\_");z(Ct,ee,Ue,"_","\\_");z(Ct,ee,Ue,"_","\\textunderscore");z(G,ee,Ue,"∠","\\angle",!0);z(G,ee,Ue,"∞","\\infty",!0);z(G,ee,Ue,"′","\\prime");z(G,ee,Ue,"△","\\triangle");z(G,ee,Ue,"Γ","\\Gamma",!0);z(G,ee,Ue,"Δ","\\Delta",!0);z(G,ee,Ue,"Θ","\\Theta",!0);z(G,ee,Ue,"Λ","\\Lambda",!0);z(G,ee,Ue,"Ξ","\\Xi",!0);z(G,ee,Ue,"Π","\\Pi",!0);z(G,ee,Ue,"Σ","\\Sigma",!0);z(G,ee,Ue,"Υ","\\Upsilon",!0);z(G,ee,Ue,"Φ","\\Phi",!0);z(G,ee,Ue,"Ψ","\\Psi",!0);z(G,ee,Ue,"Ω","\\Omega",!0);z(G,ee,Ue,"A","Α");z(G,ee,Ue,"B","Β");z(G,ee,Ue,"E","Ε");z(G,ee,Ue,"Z","Ζ");z(G,ee,Ue,"H","Η");z(G,ee,Ue,"I","Ι");z(G,ee,Ue,"K","Κ");z(G,ee,Ue,"M","Μ");z(G,ee,Ue,"N","Ν");z(G,ee,Ue,"O","Ο");z(G,ee,Ue,"P","Ρ");z(G,ee,Ue,"T","Τ");z(G,ee,Ue,"X","Χ");z(G,ee,Ue,"¬","\\neg",!0);z(G,ee,Ue,"¬","\\lnot");z(G,ee,Ue,"⊤","\\top");z(G,ee,Ue,"⊥","\\bot");z(G,ee,Ue,"∅","\\emptyset");z(G,Ee,Ue,"∅","\\varnothing");z(G,ee,zn,"α","\\alpha",!0);z(G,ee,zn,"β","\\beta",!0);z(G,ee,zn,"γ","\\gamma",!0);z(G,ee,zn,"δ","\\delta",!0);z(G,ee,zn,"ϵ","\\epsilon",!0);z(G,ee,zn,"ζ","\\zeta",!0);z(G,ee,zn,"η","\\eta",!0);z(G,ee,zn,"θ","\\theta",!0);z(G,ee,zn,"ι","\\iota",!0);z(G,ee,zn,"κ","\\kappa",!0);z(G,ee,zn,"λ","\\lambda",!0);z(G,ee,zn,"μ","\\mu",!0);z(G,ee,zn,"ν","\\nu",!0);z(G,ee,zn,"ξ","\\xi",!0);z(G,ee,zn,"ο","\\omicron",!0);z(G,ee,zn,"π","\\pi",!0);z(G,ee,zn,"ρ","\\rho",!0);z(G,ee,zn,"σ","\\sigma",!0);z(G,ee,zn,"τ","\\tau",!0);z(G,ee,zn,"υ","\\upsilon",!0);z(G,ee,zn,"ϕ","\\phi",!0);z(G,ee,zn,"χ","\\chi",!0);z(G,ee,zn,"ψ","\\psi",!0);z(G,ee,zn,"ω","\\omega",!0);z(G,ee,zn,"ε","\\varepsilon",!0);z(G,ee,zn,"ϑ","\\vartheta",!0);z(G,ee,zn,"ϖ","\\varpi",!0);z(G,ee,zn,"ϱ","\\varrho",!0);z(G,ee,zn,"ς","\\varsigma",!0);z(G,ee,zn,"φ","\\varphi",!0);z(G,ee,fn,"∗","*",!0);z(G,ee,fn,"+","+");z(G,ee,fn,"−","-",!0);z(G,ee,fn,"⋅","\\cdot",!0);z(G,ee,fn,"∘","\\circ",!0);z(G,ee,fn,"÷","\\div",!0);z(G,ee,fn,"±","\\pm",!0);z(G,ee,fn,"×","\\times",!0);z(G,ee,fn,"∩","\\cap",!0);z(G,ee,fn,"∪","\\cup",!0);z(G,ee,fn,"∖","\\setminus",!0);z(G,ee,fn,"∧","\\land");z(G,ee,fn,"∨","\\lor");z(G,ee,fn,"∧","\\wedge",!0);z(G,ee,fn,"∨","\\vee",!0);z(G,ee,Ue,"√","\\surd");z(G,ee,as,"⟨","\\langle",!0);z(G,ee,as,"∣","\\lvert");z(G,ee,as,"∥","\\lVert");z(G,ee,Sa,"?","?");z(G,ee,Sa,"!","!");z(G,ee,Sa,"⟩","\\rangle",!0);z(G,ee,Sa,"∣","\\rvert");z(G,ee,Sa,"∥","\\rVert");z(G,ee,Ie,"=","=");z(G,ee,Ie,":",":");z(G,ee,Ie,"≈","\\approx",!0);z(G,ee,Ie,"≅","\\cong",!0);z(G,ee,Ie,"≥","\\ge");z(G,ee,Ie,"≥","\\geq",!0);z(G,ee,Ie,"←","\\gets");z(G,ee,Ie,">","\\gt",!0);z(G,ee,Ie,"∈","\\in",!0);z(G,ee,Ie,"","\\@not");z(G,ee,Ie,"⊂","\\subset",!0);z(G,ee,Ie,"⊃","\\supset",!0);z(G,ee,Ie,"⊆","\\subseteq",!0);z(G,ee,Ie,"⊇","\\supseteq",!0);z(G,Ee,Ie,"⊈","\\nsubseteq",!0);z(G,Ee,Ie,"⊉","\\nsupseteq",!0);z(G,ee,Ie,"⊨","\\models");z(G,ee,Ie,"←","\\leftarrow",!0);z(G,ee,Ie,"≤","\\le");z(G,ee,Ie,"≤","\\leq",!0);z(G,ee,Ie,"<","\\lt",!0);z(G,ee,Ie,"→","\\rightarrow",!0);z(G,ee,Ie,"→","\\to");z(G,Ee,Ie,"≱","\\ngeq",!0);z(G,Ee,Ie,"≰","\\nleq",!0);z(G,ee,xl," ","\\ ");z(G,ee,xl," ","\\space");z(G,ee,xl," ","\\nobreakspace");z(Ct,ee,xl," ","\\ ");z(Ct,ee,xl," "," ");z(Ct,ee,xl," ","\\space");z(Ct,ee,xl," ","\\nobreakspace");z(G,ee,xl,null,"\\nobreak");z(G,ee,xl,null,"\\allowbreak");z(G,ee,kv,",",",");z(G,ee,kv,";",";");z(G,Ee,fn,"⊼","\\barwedge",!0);z(G,Ee,fn,"⊻","\\veebar",!0);z(G,ee,fn,"⊙","\\odot",!0);z(G,ee,fn,"⊕","\\oplus",!0);z(G,ee,fn,"⊗","\\otimes",!0);z(G,ee,Ue,"∂","\\partial",!0);z(G,ee,fn,"⊘","\\oslash",!0);z(G,Ee,fn,"⊚","\\circledcirc",!0);z(G,Ee,fn,"⊡","\\boxdot",!0);z(G,ee,fn,"△","\\bigtriangleup");z(G,ee,fn,"▽","\\bigtriangledown");z(G,ee,fn,"†","\\dagger");z(G,ee,fn,"⋄","\\diamond");z(G,ee,fn,"⋆","\\star");z(G,ee,fn,"◃","\\triangleleft");z(G,ee,fn,"▹","\\triangleright");z(G,ee,as,"{","\\{");z(Ct,ee,Ue,"{","\\{");z(Ct,ee,Ue,"{","\\textbraceleft");z(G,ee,Sa,"}","\\}");z(Ct,ee,Ue,"}","\\}");z(Ct,ee,Ue,"}","\\textbraceright");z(G,ee,as,"{","\\lbrace");z(G,ee,Sa,"}","\\rbrace");z(G,ee,as,"[","\\lbrack",!0);z(Ct,ee,Ue,"[","\\lbrack",!0);z(G,ee,Sa,"]","\\rbrack",!0);z(Ct,ee,Ue,"]","\\rbrack",!0);z(G,ee,as,"(","\\lparen",!0);z(G,ee,Sa,")","\\rparen",!0);z(Ct,ee,Ue,"<","\\textless",!0);z(Ct,ee,Ue,">","\\textgreater",!0);z(G,ee,as,"⌊","\\lfloor",!0);z(G,ee,Sa,"⌋","\\rfloor",!0);z(G,ee,as,"⌈","\\lceil",!0);z(G,ee,Sa,"⌉","\\rceil",!0);z(G,ee,Ue,"\\","\\backslash");z(G,ee,Ue,"∣","|");z(G,ee,Ue,"∣","\\vert");z(Ct,ee,Ue,"|","\\textbar",!0);z(G,ee,Ue,"∥","\\|");z(G,ee,Ue,"∥","\\Vert");z(Ct,ee,Ue,"∥","\\textbardbl");z(Ct,ee,Ue,"~","\\textasciitilde");z(Ct,ee,Ue,"\\","\\textbackslash");z(Ct,ee,Ue,"^","\\textasciicircum");z(G,ee,Ie,"↑","\\uparrow",!0);z(G,ee,Ie,"⇑","\\Uparrow",!0);z(G,ee,Ie,"↓","\\downarrow",!0);z(G,ee,Ie,"⇓","\\Downarrow",!0);z(G,ee,Ie,"↕","\\updownarrow",!0);z(G,ee,Ie,"⇕","\\Updownarrow",!0);z(G,ee,gi,"∐","\\coprod");z(G,ee,gi,"⋁","\\bigvee");z(G,ee,gi,"⋀","\\bigwedge");z(G,ee,gi,"⨄","\\biguplus");z(G,ee,gi,"⋂","\\bigcap");z(G,ee,gi,"⋃","\\bigcup");z(G,ee,gi,"∫","\\int");z(G,ee,gi,"∫","\\intop");z(G,ee,gi,"∬","\\iint");z(G,ee,gi,"∭","\\iiint");z(G,ee,gi,"∏","\\prod");z(G,ee,gi,"∑","\\sum");z(G,ee,gi,"⨂","\\bigotimes");z(G,ee,gi,"⨁","\\bigoplus");z(G,ee,gi,"⨀","\\bigodot");z(G,ee,gi,"∮","\\oint");z(G,ee,gi,"∯","\\oiint");z(G,ee,gi,"∰","\\oiiint");z(G,ee,gi,"⨆","\\bigsqcup");z(G,ee,gi,"∫","\\smallint");z(Ct,ee,Jd,"…","\\textellipsis");z(G,ee,Jd,"…","\\mathellipsis");z(Ct,ee,Jd,"…","\\ldots",!0);z(G,ee,Jd,"…","\\ldots",!0);z(G,ee,Jd,"⋯","\\@cdots",!0);z(G,ee,Jd,"⋱","\\ddots",!0);z(G,ee,Ue,"⋮","\\varvdots");z(G,ee,Ur,"ˊ","\\acute");z(G,ee,Ur,"ˋ","\\grave");z(G,ee,Ur,"¨","\\ddot");z(G,ee,Ur,"~","\\tilde");z(G,ee,Ur,"ˉ","\\bar");z(G,ee,Ur,"˘","\\breve");z(G,ee,Ur,"ˇ","\\check");z(G,ee,Ur,"^","\\hat");z(G,ee,Ur,"⃗","\\vec");z(G,ee,Ur,"˙","\\dot");z(G,ee,Ur,"˚","\\mathring");z(G,ee,zn,"","\\@imath");z(G,ee,zn,"","\\@jmath");z(G,ee,Ue,"ı","ı");z(G,ee,Ue,"ȷ","ȷ");z(Ct,ee,Ue,"ı","\\i",!0);z(Ct,ee,Ue,"ȷ","\\j",!0);z(Ct,ee,Ue,"ß","\\ss",!0);z(Ct,ee,Ue,"æ","\\ae",!0);z(Ct,ee,Ue,"œ","\\oe",!0);z(Ct,ee,Ue,"ø","\\o",!0);z(Ct,ee,Ue,"Æ","\\AE",!0);z(Ct,ee,Ue,"Œ","\\OE",!0);z(Ct,ee,Ue,"Ø","\\O",!0);z(Ct,ee,Ur,"ˊ","\\'");z(Ct,ee,Ur,"ˋ","\\`");z(Ct,ee,Ur,"ˆ","\\^");z(Ct,ee,Ur,"˜","\\~");z(Ct,ee,Ur,"ˉ","\\=");z(Ct,ee,Ur,"˘","\\u");z(Ct,ee,Ur,"˙","\\.");z(Ct,ee,Ur,"¸","\\c");z(Ct,ee,Ur,"˚","\\r");z(Ct,ee,Ur,"ˇ","\\v");z(Ct,ee,Ur,"¨",'\\"');z(Ct,ee,Ur,"˝","\\H");z(Ct,ee,Ur,"◯","\\textcircled");var r8={"--":!0,"---":!0,"``":!0,"''":!0};z(Ct,ee,Ue,"–","--",!0);z(Ct,ee,Ue,"–","\\textendash");z(Ct,ee,Ue,"—","---",!0);z(Ct,ee,Ue,"—","\\textemdash");z(Ct,ee,Ue,"‘","`",!0);z(Ct,ee,Ue,"‘","\\textquoteleft");z(Ct,ee,Ue,"’","'",!0);z(Ct,ee,Ue,"’","\\textquoteright");z(Ct,ee,Ue,"“","``",!0);z(Ct,ee,Ue,"“","\\textquotedblleft");z(Ct,ee,Ue,"”","''",!0);z(Ct,ee,Ue,"”","\\textquotedblright");z(G,ee,Ue,"°","\\degree",!0);z(Ct,ee,Ue,"°","\\degree");z(Ct,ee,Ue,"°","\\textdegree",!0);z(G,ee,Ue,"£","\\pounds");z(G,ee,Ue,"£","\\mathsterling",!0);z(Ct,ee,Ue,"£","\\pounds");z(Ct,ee,Ue,"£","\\textsterling",!0);z(G,Ee,Ue,"✠","\\maltese");z(Ct,Ee,Ue,"✠","\\maltese");var CM='0123456789/@."';for(var Q_=0;Q_<CM.length;Q_++){var PM=CM.charAt(Q_);z(G,ee,Ue,PM,PM)}var RM='0123456789!@*()-=+";:?/.,';for(var ex=0;ex<RM.length;ex++){var IM=RM.charAt(ex);z(Ct,ee,Ue,IM,IM)}var ev="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var tx=0;tx<ev.length;tx++){var Bg=ev.charAt(tx);z(G,ee,zn,Bg,Bg),z(Ct,ee,Ue,Bg,Bg)}z(G,Ee,Ue,"C","ℂ");z(Ct,Ee,Ue,"C","ℂ");z(G,Ee,Ue,"H","ℍ");z(Ct,Ee,Ue,"H","ℍ");z(G,Ee,Ue,"N","ℕ");z(Ct,Ee,Ue,"N","ℕ");z(G,Ee,Ue,"P","ℙ");z(Ct,Ee,Ue,"P","ℙ");z(G,Ee,Ue,"Q","ℚ");z(Ct,Ee,Ue,"Q","ℚ");z(G,Ee,Ue,"R","ℝ");z(Ct,Ee,Ue,"R","ℝ");z(G,Ee,Ue,"Z","ℤ");z(Ct,Ee,Ue,"Z","ℤ");z(G,ee,zn,"h","ℎ");z(Ct,ee,zn,"h","ℎ");var Un="";for(var pa=0;pa<ev.length;pa++){var Jr=ev.charAt(pa);Un=String.fromCharCode(55349,56320+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56372+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56424+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56580+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56684+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56736+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56788+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56840+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56944+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),pa<26&&(Un=String.fromCharCode(55349,56632+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un),Un=String.fromCharCode(55349,56476+pa),z(G,ee,zn,Jr,Un),z(Ct,ee,Ue,Jr,Un))}Un="𝕜";z(G,ee,zn,"k",Un);z(Ct,ee,Ue,"k",Un);for(var du=0;du<10;du++){var ec=du.toString();Un=String.fromCharCode(55349,57294+du),z(G,ee,zn,ec,Un),z(Ct,ee,Ue,ec,Un),Un=String.fromCharCode(55349,57314+du),z(G,ee,zn,ec,Un),z(Ct,ee,Ue,ec,Un),Un=String.fromCharCode(55349,57324+du),z(G,ee,zn,ec,Un),z(Ct,ee,Ue,ec,Un),Un=String.fromCharCode(55349,57334+du),z(G,ee,zn,ec,Un),z(Ct,ee,Ue,ec,Un)}var D2="ÐÞþ";for(var nx=0;nx<D2.length;nx++){var Og=D2.charAt(nx);z(G,ee,zn,Og,Og),z(Ct,ee,Ue,Og,Og)}var Ug=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],DM=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],vj=function(e,n){var r=e.charCodeAt(0),s=e.charCodeAt(1),c=(r-55296)*1024+(s-56320)+65536,h=n==="math"?0:1;if(119808<=c&&c<120484){var l=Math.floor((c-119808)/26);return[Ug[l][2],Ug[l][h]]}else if(120782<=c&&c<=120831){var m=Math.floor((c-120782)/10);return[DM[m][2],DM[m][h]]}else{if(c===120485||c===120486)return[Ug[0][2],Ug[0][h]];if(120486<c&&c<120782)return["",""];throw new Ot("Unsupported character: "+e)}},Lv=function(e,n,r){return Pr[r][e]&&Pr[r][e].replace&&(e=Pr[r][e].replace),{value:e,metrics:rw(e,n,r)}},js=function(e,n,r,s,c){var h=Lv(e,n,r),l=h.metrics;e=h.value;var m;if(l){var _=l.italic;(r==="text"||s&&s.font==="mathit")&&(_=0),m=new As(e,l.height,l.depth,_,l.skew,l.width,c)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+n+"' and mode '"+r+"'")),m=new As(e,0,0,0,0,0,c);if(s){m.maxFontSize=s.sizeMultiplier,s.style.isTight()&&m.classes.push("mtight");var S=s.getColor();S&&(m.style.color=S)}return m},yj=function(e,n,r,s){return s===void 0&&(s=[]),r.font==="boldsymbol"&&Lv(e,"Main-Bold",n).metrics?js(e,"Main-Bold",n,r,s.concat(["mathbf"])):e==="\\"||Pr[n][e].font==="main"?js(e,"Main-Regular",n,r,s):js(e,"AMS-Regular",n,r,s.concat(["amsrm"]))},_j=function(e,n,r,s,c){return c!=="textord"&&Lv(e,"Math-BoldItalic",n).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},xj=function(e,n,r){var s=e.mode,c=e.text,h=["mord"],l=s==="math"||s==="text"&&n.font,m=l?n.font:n.fontFamily,_="",S="";if(c.charCodeAt(0)===55349&&([_,S]=vj(c,s)),_.length>0)return js(c,_,s,n,h.concat(S));if(m){var T,M;if(m==="boldsymbol"){var I=_j(c,s,n,h,r);T=I.fontName,M=[I.fontClass]}else l?(T=s8[m].fontName,M=[m]):(T=Vg(m,n.fontWeight,n.fontShape),M=[m,n.fontWeight,n.fontShape]);if(Lv(c,T,s).metrics)return js(c,T,s,n,h.concat(M));if(r8.hasOwnProperty(c)&&T.slice(0,10)==="Typewriter"){for(var N=[],B=0;B<c.length;B++)N.push(js(c[B],T,s,n,h.concat(M)));return a8(N)}}if(r==="mathord")return js(c,"Math-Italic",s,n,h.concat(["mathnormal"]));if(r==="textord"){var k=Pr[s][c]&&Pr[s][c].font;if(k==="ams"){var C=Vg("amsrm",n.fontWeight,n.fontShape);return js(c,C,s,n,h.concat("amsrm",n.fontWeight,n.fontShape))}else if(k==="main"||!k){var U=Vg("textrm",n.fontWeight,n.fontShape);return js(c,U,s,n,h.concat(n.fontWeight,n.fontShape))}else{var V=Vg(k,n.fontWeight,n.fontShape);return js(c,V,s,n,h.concat(V,n.fontWeight,n.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},bj=(t,e)=>{if(Ac(t.classes)!==Ac(e.classes)||t.skew!==e.skew||t.maxFontSize!==e.maxFontSize)return!1;if(t.classes.length===1){var n=t.classes[0];if(n==="mbin"||n==="mord")return!1}for(var r in t.style)if(t.style.hasOwnProperty(r)&&t.style[r]!==e.style[r])return!1;for(var s in e.style)if(e.style.hasOwnProperty(s)&&t.style[s]!==e.style[s])return!1;return!0},wj=t=>{for(var e=0;e<t.length-1;e++){var n=t[e],r=t[e+1];n instanceof As&&r instanceof As&&bj(n,r)&&(n.text+=r.text,n.height=Math.max(n.height,r.height),n.depth=Math.max(n.depth,r.depth),n.italic=r.italic,t.splice(e+1,1),e--)}return t},aw=function(e){for(var n=0,r=0,s=0,c=0;c<e.children.length;c++){var h=e.children[c];h.height>n&&(n=h.height),h.depth>r&&(r=h.depth),h.maxFontSize>s&&(s=h.maxFontSize)}e.height=n,e.depth=r,e.maxFontSize=s},Aa=function(e,n,r,s){var c=new Up(e,n,r,s);return aw(c),c},i8=(t,e,n,r)=>new Up(t,e,n,r),Sj=function(e,n,r){var s=Aa([e],[],n);return s.height=Math.max(r||n.fontMetrics().defaultRuleThickness,n.minRuleThickness),s.style.borderBottomWidth=Xt(s.height),s.maxFontSize=1,s},Mj=function(e,n,r,s){var c=new iw(e,n,r,s);return aw(c),c},a8=function(e){var n=new Op(e);return aw(n),n},Tj=function(e,n){return e instanceof Op?Aa([],[e],n):e},Ej=function(e){if(e.positionType==="individualShift"){for(var n=e.children,r=[n[0]],s=-n[0].shift-n[0].elem.depth,c=s,h=1;h<n.length;h++){var l=-n[h].shift-c-n[h].elem.depth,m=l-(n[h-1].elem.height+n[h-1].elem.depth);c=c+l,r.push({type:"kern",size:m}),r.push(n[h])}return{children:r,depth:s}}var _;if(e.positionType==="top"){for(var S=e.positionData,T=0;T<e.children.length;T++){var M=e.children[T];S-=M.type==="kern"?M.size:M.elem.height+M.elem.depth}_=S}else if(e.positionType==="bottom")_=-e.positionData;else{var I=e.children[0];if(I.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")_=-I.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")_=-I.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:_}},Aj=function(e,n){for(var{children:r,depth:s}=Ej(e),c=0,h=0;h<r.length;h++){var l=r[h];if(l.type==="elem"){var m=l.elem;c=Math.max(c,m.maxFontSize,m.height)}}c+=2;var _=Aa(["pstrut"],[]);_.style.height=Xt(c);for(var S=[],T=s,M=s,I=s,N=0;N<r.length;N++){var B=r[N];if(B.type==="kern")I+=B.size;else{var k=B.elem,C=B.wrapperClasses||[],U=B.wrapperStyle||{},V=Aa(C,[_,k],void 0,U);V.style.top=Xt(-c-I-k.depth),B.marginLeft&&(V.style.marginLeft=B.marginLeft),B.marginRight&&(V.style.marginRight=B.marginRight),S.push(V),I+=k.height+k.depth}T=Math.min(T,I),M=Math.max(M,I)}var Y=Aa(["vlist"],S);Y.style.height=Xt(M);var he;if(T<0){var Z=Aa([],[]),ne=Aa(["vlist"],[Z]);ne.style.height=Xt(-T);var xe=Aa(["vlist-s"],[new As("​")]);he=[Aa(["vlist-r"],[Y,xe]),Aa(["vlist-r"],[ne])]}else he=[Aa(["vlist-r"],[Y])];var ie=Aa(["vlist-t"],he);return he.length===2&&ie.classes.push("vlist-t2"),ie.height=M,ie.depth=-T,ie},Cj=(t,e)=>{var n=Aa(["mspace"],[],e),r=qr(t,e);return n.style.marginRight=Xt(r),n},Vg=function(e,n,r){var s="";switch(e){case"amsrm":s="AMS";break;case"textrm":s="Main";break;case"textsf":s="SansSerif";break;case"texttt":s="Typewriter";break;default:s=e}var c;return n==="textbf"&&r==="textit"?c="BoldItalic":n==="textbf"?c="Bold":n==="textit"?c="Italic":c="Regular",s+"-"+c},s8={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},o8={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},Pj=function(e,n){var[r,s,c]=o8[e],h=new Cc(r),l=new gl([h],{width:Xt(s),height:Xt(c),style:"width:"+Xt(s),viewBox:"0 0 "+1e3*s+" "+1e3*c,preserveAspectRatio:"xMinYMin"}),m=i8(["overlay"],[l],n);return m.height=c,m.style.height=Xt(c),m.style.width=Xt(s),m},rt={fontMap:s8,makeSymbol:js,mathsym:yj,makeSpan:Aa,makeSvgSpan:i8,makeLineSpan:Sj,makeAnchor:Mj,makeFragment:a8,wrapFragment:Tj,makeVList:Aj,makeOrd:xj,makeGlue:Cj,staticSvg:Pj,svgData:o8,tryCombineChars:wj},jr={number:3,unit:"mu"},fu={number:4,unit:"mu"},Ko={number:5,unit:"mu"},Rj={mord:{mop:jr,mbin:fu,mrel:Ko,minner:jr},mop:{mord:jr,mop:jr,mrel:Ko,minner:jr},mbin:{mord:fu,mop:fu,mopen:fu,minner:fu},mrel:{mord:Ko,mop:Ko,mopen:Ko,minner:Ko},mopen:{},mclose:{mop:jr,mbin:fu,mrel:Ko,minner:jr},mpunct:{mord:jr,mop:jr,mrel:Ko,mopen:jr,mclose:jr,mpunct:jr,minner:jr},minner:{mord:jr,mop:jr,mbin:fu,mrel:Ko,mopen:jr,mpunct:jr,minner:jr}},Ij={mord:{mop:jr},mop:{mord:jr,mop:jr},mbin:{},mrel:{},mopen:{},mclose:{mop:jr},mpunct:{},minner:{mop:jr}},l8={},tv={},nv={};function ln(t){for(var{type:e,names:n,props:r,handler:s,htmlBuilder:c,mathmlBuilder:h}=t,l={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:s},m=0;m<n.length;++m)l8[n[m]]=l;e&&(c&&(tv[e]=c),h&&(nv[e]=h))}function $u(t){var{type:e,htmlBuilder:n,mathmlBuilder:r}=t;ln({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:n,mathmlBuilder:r})}var rv=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},ui=function(e){return e.type==="ordgroup"?e.body:[e]},vl=rt.makeSpan,Dj=["leftmost","mbin","mopen","mrel","mop","mpunct"],kj=["rightmost","mrel","mclose","mpunct"],Lj={display:Fn.DISPLAY,text:Fn.TEXT,script:Fn.SCRIPT,scriptscript:Fn.SCRIPTSCRIPT},zj={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Mi=function(e,n,r,s){s===void 0&&(s=[null,null]);for(var c=[],h=0;h<e.length;h++){var l=cr(e[h],n);if(l instanceof Op){var m=l.children;c.push(...m)}else c.push(l)}if(rt.tryCombineChars(c),!r)return c;var _=n;if(e.length===1){var S=e[0];S.type==="sizing"?_=n.havingSize(S.size):S.type==="styling"&&(_=n.havingStyle(Lj[S.style]))}var T=vl([s[0]||"leftmost"],[],n),M=vl([s[1]||"rightmost"],[],n),I=r==="root";return kM(c,(N,B)=>{var k=B.classes[0],C=N.classes[0];k==="mbin"&&kn.contains(kj,C)?B.classes[0]="mord":C==="mbin"&&kn.contains(Dj,k)&&(N.classes[0]="mord")},{node:T},M,I),kM(c,(N,B)=>{var k=k2(B),C=k2(N),U=k&&C?N.hasClass("mtight")?Ij[k][C]:Rj[k][C]:null;if(U)return rt.makeGlue(U,_)},{node:T},M,I),c},kM=function t(e,n,r,s,c){s&&e.push(s);for(var h=0;h<e.length;h++){var l=e[h],m=c8(l);if(m){t(m.children,n,r,null,c);continue}var _=!l.hasClass("mspace");if(_){var S=n(l,r.node);S&&(r.insertAfter?r.insertAfter(S):(e.unshift(S),h++))}_?r.node=l:c&&l.hasClass("newline")&&(r.node=vl(["leftmost"])),r.insertAfter=(T=>M=>{e.splice(T+1,0,M),h++})(h)}s&&e.pop()},c8=function(e){return e instanceof Op||e instanceof iw||e instanceof Up&&e.hasClass("enclosing")?e:null},Fj=function t(e,n){var r=c8(e);if(r){var s=r.children;if(s.length){if(n==="right")return t(s[s.length-1],"right");if(n==="left")return t(s[0],"left")}}return e},k2=function(e,n){return e?(n&&(e=Fj(e,n)),zj[e.classes[0]]||null):null},Tp=function(e,n){var r=["nulldelimiter"].concat(e.baseSizingClasses());return vl(n.concat(r))},cr=function(e,n,r){if(!e)return vl();if(tv[e.type]){var s=tv[e.type](e,n);if(r&&n.size!==r.size){s=vl(n.sizingClasses(r),[s],n);var c=n.sizeMultiplier/r.sizeMultiplier;s.height*=c,s.depth*=c}return s}else throw new Ot("Got group of unknown type: '"+e.type+"'")};function Hg(t,e){var n=vl(["base"],t,e),r=vl(["strut"]);return r.style.height=Xt(n.height+n.depth),n.depth&&(r.style.verticalAlign=Xt(-n.depth)),n.children.unshift(r),n}function L2(t,e){var n=null;t.length===1&&t[0].type==="tag"&&(n=t[0].tag,t=t[0].body);var r=Mi(t,e,"root"),s;r.length===2&&r[1].hasClass("tag")&&(s=r.pop());for(var c=[],h=[],l=0;l<r.length;l++)if(h.push(r[l]),r[l].hasClass("mbin")||r[l].hasClass("mrel")||r[l].hasClass("allowbreak")){for(var m=!1;l<r.length-1&&r[l+1].hasClass("mspace")&&!r[l+1].hasClass("newline");)l++,h.push(r[l]),r[l].hasClass("nobreak")&&(m=!0);m||(c.push(Hg(h,e)),h=[])}else r[l].hasClass("newline")&&(h.pop(),h.length>0&&(c.push(Hg(h,e)),h=[]),c.push(r[l]));h.length>0&&c.push(Hg(h,e));var _;n?(_=Hg(Mi(n,e,!0)),_.classes=["tag"],c.push(_)):s&&c.push(s);var S=vl(["katex-html"],c);if(S.setAttribute("aria-hidden","true"),_){var T=_.children[0];T.style.height=Xt(S.height+S.depth),S.depth&&(T.style.verticalAlign=Xt(-S.depth))}return S}function u8(t){return new Op(t)}class ys{constructor(e,n,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=n||[],this.classes=r||[]}setAttribute(e,n){this.attributes[e]=n}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&e.setAttribute(n,this.attributes[n]);this.classes.length>0&&(e.className=Ac(this.classes));for(var r=0;r<this.children.length;r++)e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var n in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,n)&&(e+=" "+n+'="',e+=kn.escape(this.attributes[n]),e+='"');this.classes.length>0&&(e+=' class ="'+kn.escape(Ac(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class X0{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return kn.escape(this.toText())}toText(){return this.text}}class Nj{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character=" ":e>=.1666&&e<=.1667?this.character=" ":e>=.2222&&e<=.2223?this.character=" ":e>=.2777&&e<=.2778?this.character="  ":e>=-.05556&&e<=-.05555?this.character=" ⁣":e>=-.1667&&e<=-.1666?this.character=" ⁣":e>=-.2223&&e<=-.2222?this.character=" ⁣":e>=-.2778&&e<=-.2777?this.character=" ⁣":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",Xt(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+Xt(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var Dt={MathNode:ys,TextNode:X0,SpaceNode:Nj,newDocumentFragment:u8},Cs=function(e,n,r){return Pr[n][e]&&Pr[n][e].replace&&e.charCodeAt(0)!==55349&&!(r8.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=Pr[n][e].replace),new Dt.TextNode(e)},sw=function(e){return e.length===1?e[0]:new Dt.MathNode("mrow",e)},ow=function(e,n){if(n.fontFamily==="texttt")return"monospace";if(n.fontFamily==="textsf")return n.fontShape==="textit"&&n.fontWeight==="textbf"?"sans-serif-bold-italic":n.fontShape==="textit"?"sans-serif-italic":n.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(n.fontShape==="textit"&&n.fontWeight==="textbf")return"bold-italic";if(n.fontShape==="textit")return"italic";if(n.fontWeight==="textbf")return"bold";var r=n.font;if(!r||r==="mathnormal")return null;var s=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var c=e.text;if(kn.contains(["\\imath","\\jmath"],c))return null;Pr[s][c]&&Pr[s][c].replace&&(c=Pr[s][c].replace);var h=rt.fontMap[r].fontName;return rw(c,h,s)?rt.fontMap[r].variant:null},Fa=function(e,n,r){if(e.length===1){var s=Er(e[0],n);return r&&s instanceof ys&&s.type==="mo"&&(s.setAttribute("lspace","0em"),s.setAttribute("rspace","0em")),[s]}for(var c=[],h,l=0;l<e.length;l++){var m=Er(e[l],n);if(m instanceof ys&&h instanceof ys){if(m.type==="mtext"&&h.type==="mtext"&&m.getAttribute("mathvariant")===h.getAttribute("mathvariant")){h.children.push(...m.children);continue}else if(m.type==="mn"&&h.type==="mn"){h.children.push(...m.children);continue}else if(m.type==="mi"&&m.children.length===1&&h.type==="mn"){var _=m.children[0];if(_ instanceof X0&&_.text==="."){h.children.push(...m.children);continue}}else if(h.type==="mi"&&h.children.length===1){var S=h.children[0];if(S instanceof X0&&S.text==="̸"&&(m.type==="mo"||m.type==="mi"||m.type==="mn")){var T=m.children[0];T instanceof X0&&T.text.length>0&&(T.text=T.text.slice(0,1)+"̸"+T.text.slice(1),c.pop())}}}c.push(m),h=m}return c},Pc=function(e,n,r){return sw(Fa(e,n,r))},Er=function(e,n){if(!e)return new Dt.MathNode("mrow");if(nv[e.type]){var r=nv[e.type](e,n);return r}else throw new Ot("Got group of unknown type: '"+e.type+"'")};function LM(t,e,n,r,s){var c=Fa(t,n),h;c.length===1&&c[0]instanceof ys&&kn.contains(["mrow","mtable"],c[0].type)?h=c[0]:h=new Dt.MathNode("mrow",c);var l=new Dt.MathNode("annotation",[new Dt.TextNode(e)]);l.setAttribute("encoding","application/x-tex");var m=new Dt.MathNode("semantics",[h,l]),_=new Dt.MathNode("math",[m]);_.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&_.setAttribute("display","block");var S=s?"katex":"katex-mathml";return rt.makeSpan([S],[_])}var h8=function(e){return new tl({style:e.displayMode?Fn.DISPLAY:Fn.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},d8=function(e,n){if(n.displayMode){var r=["katex-display"];n.leqno&&r.push("leqno"),n.fleqn&&r.push("fleqn"),e=rt.makeSpan(r,[e])}return e},Bj=function(e,n,r){var s=h8(r),c;if(r.output==="mathml")return LM(e,n,s,r.displayMode,!0);if(r.output==="html"){var h=L2(e,s);c=rt.makeSpan(["katex"],[h])}else{var l=LM(e,n,s,r.displayMode,!1),m=L2(e,s);c=rt.makeSpan(["katex"],[l,m])}return d8(c,r)},Oj=function(e,n,r){var s=h8(r),c=L2(e,s),h=rt.makeSpan(["katex"],[c]);return d8(h,r)},Uj={widehat:"^",widecheck:"ˇ",widetilde:"~",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",undergroup:"⏡",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xrightleftarrows:"⇄",xrightequilibrium:"⇌",xleftequilibrium:"⇋","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},Vj=function(e){var n=new Dt.MathNode("mo",[new Dt.TextNode(Uj[e.replace(/^\\/,"")])]);return n.setAttribute("stretchy","true"),n},Hj={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},Gj=function(e){return e.type==="ordgroup"?e.body.length:1},jj=function(e,n){function r(){var l=4e5,m=e.label.slice(1);if(kn.contains(["widehat","widecheck","widetilde","utilde"],m)){var _=e,S=Gj(_.base),T,M,I;if(S>5)m==="widehat"||m==="widecheck"?(T=420,l=2364,I=.42,M=m+"4"):(T=312,l=2340,I=.34,M="tilde4");else{var N=[1,1,2,2,3,3][S];m==="widehat"||m==="widecheck"?(l=[0,1062,2364,2364,2364][N],T=[0,239,300,360,420][N],I=[0,.24,.3,.3,.36,.42][N],M=m+N):(l=[0,600,1033,2339,2340][N],T=[0,260,286,306,312][N],I=[0,.26,.286,.3,.306,.34][N],M="tilde"+N)}var B=new Cc(M),k=new gl([B],{width:"100%",height:Xt(I),viewBox:"0 0 "+l+" "+T,preserveAspectRatio:"none"});return{span:rt.makeSvgSpan([],[k],n),minWidth:0,height:I}}else{var C=[],U=Hj[m],[V,Y,he]=U,Z=he/1e3,ne=V.length,xe,ie;if(ne===1){var J=U[3];xe=["hide-tail"],ie=[J]}else if(ne===2)xe=["halfarrow-left","halfarrow-right"],ie=["xMinYMin","xMaxYMin"];else if(ne===3)xe=["brace-left","brace-center","brace-right"],ie=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+ne+" children.");for(var Te=0;Te<ne;Te++){var Be=new Cc(V[Te]),Re=new gl([Be],{width:"400em",height:Xt(Z),viewBox:"0 0 "+l+" "+he,preserveAspectRatio:ie[Te]+" slice"}),We=rt.makeSvgSpan([xe[Te]],[Re],n);if(ne===1)return{span:We,minWidth:Y,height:Z};We.style.height=Xt(Z),C.push(We)}return{span:rt.makeSpan(["stretchy"],C,n),minWidth:Y,height:Z}}}var{span:s,minWidth:c,height:h}=r();return s.height=h,s.style.height=Xt(h),c>0&&(s.style.minWidth=Xt(c)),s},Wj=function(e,n,r,s,c){var h,l=e.height+e.depth+r+s;if(/fbox|color|angl/.test(n)){if(h=rt.makeSpan(["stretchy",n],[],c),n==="fbox"){var m=c.color&&c.getColor();m&&(h.style.borderColor=m)}}else{var _=[];/^[bx]cancel$/.test(n)&&_.push(new I2({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(n)&&_.push(new I2({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var S=new gl(_,{width:"100%",height:Xt(l)});h=rt.makeSvgSpan([],[S],c)}return h.height=l,h.style.height=Xt(l),h},yl={encloseSpan:Wj,mathMLnode:Vj,svgSpan:jj};function Kn(t,e){if(!t||t.type!==e)throw new Error("Expected node of type "+e+", but got "+(t?"node of type "+t.type:String(t)));return t}function lw(t){var e=zv(t);if(!e)throw new Error("Expected node of symbol group type, but got "+(t?"node of type "+t.type:String(t)));return e}function zv(t){return t&&(t.type==="atom"||gj.hasOwnProperty(t.type))?t:null}var cw=(t,e)=>{var n,r,s;t&&t.type==="supsub"?(r=Kn(t.base,"accent"),n=r.base,t.base=n,s=pj(cr(t,e)),t.base=r):(r=Kn(t,"accent"),n=r.base);var c=cr(n,e.havingCrampedStyle()),h=r.isShifty&&kn.isCharacterBox(n),l=0;if(h){var m=kn.getBaseElem(n),_=cr(m,e.havingCrampedStyle());l=AM(_).skew}var S=r.label==="\\c",T=S?c.height+c.depth:Math.min(c.height,e.fontMetrics().xHeight),M;if(r.isStretchy)M=yl.svgSpan(r,e),M=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:c},{type:"elem",elem:M,wrapperClasses:["svg-align"],wrapperStyle:l>0?{width:"calc(100% - "+Xt(2*l)+")",marginLeft:Xt(2*l)}:void 0}]},e);else{var I,N;r.label==="\\vec"?(I=rt.staticSvg("vec",e),N=rt.svgData.vec[1]):(I=rt.makeOrd({mode:r.mode,text:r.label},e,"textord"),I=AM(I),I.italic=0,N=I.width,S&&(T+=I.depth)),M=rt.makeSpan(["accent-body"],[I]);var B=r.label==="\\textcircled";B&&(M.classes.push("accent-full"),T=c.height);var k=l;B||(k-=N/2),M.style.left=Xt(k),r.label==="\\textcircled"&&(M.style.top=".2em"),M=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:c},{type:"kern",size:-T},{type:"elem",elem:M}]},e)}var C=rt.makeSpan(["mord","accent"],[M],e);return s?(s.children[0]=C,s.height=Math.max(C.height,s.height),s.classes[0]="mord",s):C},f8=(t,e)=>{var n=t.isStretchy?yl.mathMLnode(t.label):new Dt.MathNode("mo",[Cs(t.label,t.mode)]),r=new Dt.MathNode("mover",[Er(t.base,e),n]);return r.setAttribute("accent","true"),r},qj=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(t=>"\\"+t).join("|"));ln({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(t,e)=>{var n=rv(e[0]),r=!qj.test(t.funcName),s=!r||t.funcName==="\\widehat"||t.funcName==="\\widetilde"||t.funcName==="\\widecheck";return{type:"accent",mode:t.parser.mode,label:t.funcName,isStretchy:r,isShifty:s,base:n}},htmlBuilder:cw,mathmlBuilder:f8});ln({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(t,e)=>{var n=e[0],r=t.parser.mode;return r==="math"&&(t.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+t.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:t.funcName,isStretchy:!1,isShifty:!0,base:n}},htmlBuilder:cw,mathmlBuilder:f8});ln({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"accentUnder",mode:n.mode,label:r,base:s}},htmlBuilder:(t,e)=>{var n=cr(t.base,e),r=yl.svgSpan(t,e),s=t.label==="\\utilde"?.12:0,c=rt.makeVList({positionType:"top",positionData:n.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:s},{type:"elem",elem:n}]},e);return rt.makeSpan(["mord","accentunder"],[c],e)},mathmlBuilder:(t,e)=>{var n=yl.mathMLnode(t.label),r=new Dt.MathNode("munder",[Er(t.base,e),n]);return r.setAttribute("accentunder","true"),r}});var Gg=t=>{var e=new Dt.MathNode("mpadded",t?[t]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};ln({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r,funcName:s}=t;return{type:"xArrow",mode:r.mode,label:s,body:e[0],below:n[0]}},htmlBuilder(t,e){var n=e.style,r=e.havingStyle(n.sup()),s=rt.wrapFragment(cr(t.body,r,e),e),c=t.label.slice(0,2)==="\\x"?"x":"cd";s.classes.push(c+"-arrow-pad");var h;t.below&&(r=e.havingStyle(n.sub()),h=rt.wrapFragment(cr(t.below,r,e),e),h.classes.push(c+"-arrow-pad"));var l=yl.svgSpan(t,e),m=-e.fontMetrics().axisHeight+.5*l.height,_=-e.fontMetrics().axisHeight-.5*l.height-.111;(s.depth>.25||t.label==="\\xleftequilibrium")&&(_-=s.depth);var S;if(h){var T=-e.fontMetrics().axisHeight+h.height+.5*l.height+.111;S=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:_},{type:"elem",elem:l,shift:m},{type:"elem",elem:h,shift:T}]},e)}else S=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:s,shift:_},{type:"elem",elem:l,shift:m}]},e);return S.children[0].children[0].children[1].classes.push("svg-align"),rt.makeSpan(["mrel","x-arrow"],[S],e)},mathmlBuilder(t,e){var n=yl.mathMLnode(t.label);n.setAttribute("minsize",t.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(t.body){var s=Gg(Er(t.body,e));if(t.below){var c=Gg(Er(t.below,e));r=new Dt.MathNode("munderover",[n,c,s])}else r=new Dt.MathNode("mover",[n,s])}else if(t.below){var h=Gg(Er(t.below,e));r=new Dt.MathNode("munder",[n,h])}else r=Gg(),r=new Dt.MathNode("mover",[n,r]);return r}});var $j=rt.makeSpan;function p8(t,e){var n=Mi(t.body,e,!0);return $j([t.mclass],n,e)}function m8(t,e){var n,r=Fa(t.body,e);return t.mclass==="minner"?n=new Dt.MathNode("mpadded",r):t.mclass==="mord"?t.isCharacterBox?(n=r[0],n.type="mi"):n=new Dt.MathNode("mi",r):(t.isCharacterBox?(n=r[0],n.type="mo"):n=new Dt.MathNode("mo",r),t.mclass==="mbin"?(n.attributes.lspace="0.22em",n.attributes.rspace="0.22em"):t.mclass==="mpunct"?(n.attributes.lspace="0em",n.attributes.rspace="0.17em"):t.mclass==="mopen"||t.mclass==="mclose"?(n.attributes.lspace="0em",n.attributes.rspace="0em"):t.mclass==="minner"&&(n.attributes.lspace="0.0556em",n.attributes.width="+0.1111em")),n}ln({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"mclass",mode:n.mode,mclass:"m"+r.slice(5),body:ui(s),isCharacterBox:kn.isCharacterBox(s)}},htmlBuilder:p8,mathmlBuilder:m8});var Fv=t=>{var e=t.type==="ordgroup"&&t.body.length?t.body[0]:t;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};ln({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(t,e){var{parser:n}=t;return{type:"mclass",mode:n.mode,mclass:Fv(e[0]),body:ui(e[1]),isCharacterBox:kn.isCharacterBox(e[1])}}});ln({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(t,e){var{parser:n,funcName:r}=t,s=e[1],c=e[0],h;r!=="\\stackrel"?h=Fv(s):h="mrel";var l={type:"op",mode:s.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:ui(s)},m={type:"supsub",mode:c.mode,base:l,sup:r==="\\underset"?null:c,sub:r==="\\underset"?c:null};return{type:"mclass",mode:n.mode,mclass:h,body:[m],isCharacterBox:kn.isCharacterBox(m)}},htmlBuilder:p8,mathmlBuilder:m8});ln({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"pmb",mode:n.mode,mclass:Fv(e[0]),body:ui(e[0])}},htmlBuilder(t,e){var n=Mi(t.body,e,!0),r=rt.makeSpan([t.mclass],n,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(t,e){var n=Fa(t.body,e),r=new Dt.MathNode("mstyle",n);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var Xj={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},zM=()=>({type:"styling",body:[],mode:"math",style:"display"}),FM=t=>t.type==="textord"&&t.text==="@",Zj=(t,e)=>(t.type==="mathord"||t.type==="atom")&&t.text===e;function Yj(t,e,n){var r=Xj[t];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return n.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var s=n.callFunction("\\\\cdleft",[e[0]],[]),c={type:"atom",text:r,mode:"math",family:"rel"},h=n.callFunction("\\Big",[c],[]),l=n.callFunction("\\\\cdright",[e[1]],[]),m={type:"ordgroup",mode:"math",body:[s,h,l]};return n.callFunction("\\\\cdparent",[m],[])}case"\\\\cdlongequal":return n.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var _={type:"textord",text:"\\Vert",mode:"math"};return n.callFunction("\\Big",[_],[])}default:return{type:"textord",text:" ",mode:"math"}}}function Kj(t){var e=[];for(t.gullet.beginGroup(),t.gullet.macros.set("\\cr","\\\\\\relax"),t.gullet.beginGroup();;){e.push(t.parseExpression(!1,"\\\\")),t.gullet.endGroup(),t.gullet.beginGroup();var n=t.fetch().text;if(n==="&"||n==="\\\\")t.consume();else if(n==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new Ot("Expected \\\\ or \\cr or \\end",t.nextToken)}for(var r=[],s=[r],c=0;c<e.length;c++){for(var h=e[c],l=zM(),m=0;m<h.length;m++)if(!FM(h[m]))l.body.push(h[m]);else{r.push(l),m+=1;var _=lw(h[m]).text,S=new Array(2);if(S[0]={type:"ordgroup",mode:"math",body:[]},S[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(_)>-1))if("<>AV".indexOf(_)>-1)for(var T=0;T<2;T++){for(var M=!0,I=m+1;I<h.length;I++){if(Zj(h[I],_)){M=!1,m=I;break}if(FM(h[I]))throw new Ot("Missing a "+_+" character to complete a CD arrow.",h[I]);S[T].body.push(h[I])}if(M)throw new Ot("Missing a "+_+" character to complete a CD arrow.",h[m])}else throw new Ot('Expected one of "<>AV=|." after @',h[m]);var N=Yj(_,S,t),B={type:"styling",body:[N],mode:"math",style:"display"};r.push(B),l=zM()}c%2===0?r.push(l):r.shift(),r=[],s.push(r)}t.gullet.endGroup(),t.gullet.endGroup();var k=new Array(s[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:s,arraystretch:1,addJot:!0,rowGaps:[null],cols:k,colSeparationType:"CD",hLinesBeforeRow:new Array(s.length+1).fill([])}}ln({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"cdlabel",mode:n.mode,side:r.slice(4),label:e[0]}},htmlBuilder(t,e){var n=e.havingStyle(e.style.sup()),r=rt.wrapFragment(cr(t.label,n,e),e);return r.classes.push("cd-label-"+t.side),r.style.bottom=Xt(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(t,e){var n=new Dt.MathNode("mrow",[Er(t.label,e)]);return n=new Dt.MathNode("mpadded",[n]),n.setAttribute("width","0"),t.side==="left"&&n.setAttribute("lspace","-1width"),n.setAttribute("voffset","0.7em"),n=new Dt.MathNode("mstyle",[n]),n.setAttribute("displaystyle","false"),n.setAttribute("scriptlevel","1"),n}});ln({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(t,e){var{parser:n}=t;return{type:"cdlabelparent",mode:n.mode,fragment:e[0]}},htmlBuilder(t,e){var n=rt.wrapFragment(cr(t.fragment,e),e);return n.classes.push("cd-vert-arrow"),n},mathmlBuilder(t,e){return new Dt.MathNode("mrow",[Er(t.fragment,e)])}});ln({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(t,e){for(var{parser:n}=t,r=Kn(e[0],"ordgroup"),s=r.body,c="",h=0;h<s.length;h++){var l=Kn(s[h],"textord");c+=l.text}var m=parseInt(c),_;if(isNaN(m))throw new Ot("\\@char has non-numeric argument "+c);if(m<0||m>=1114111)throw new Ot("\\@char with invalid code point "+c);return m<=65535?_=String.fromCharCode(m):(m-=65536,_=String.fromCharCode((m>>10)+55296,(m&1023)+56320)),{type:"textord",mode:n.mode,text:_}}});var g8=(t,e)=>{var n=Mi(t.body,e.withColor(t.color),!1);return rt.makeFragment(n)},v8=(t,e)=>{var n=Fa(t.body,e.withColor(t.color)),r=new Dt.MathNode("mstyle",n);return r.setAttribute("mathcolor",t.color),r};ln({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(t,e){var{parser:n}=t,r=Kn(e[0],"color-token").color,s=e[1];return{type:"color",mode:n.mode,color:r,body:ui(s)}},htmlBuilder:g8,mathmlBuilder:v8});ln({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(t,e){var{parser:n,breakOnTokenText:r}=t,s=Kn(e[0],"color-token").color;n.gullet.macros.set("\\current@color",s);var c=n.parseExpression(!0,r);return{type:"color",mode:n.mode,color:s,body:c}},htmlBuilder:g8,mathmlBuilder:v8});ln({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(t,e,n){var{parser:r}=t,s=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,c=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:c,size:s&&Kn(s,"size").value}},htmlBuilder(t,e){var n=rt.makeSpan(["mspace"],[],e);return t.newLine&&(n.classes.push("newline"),t.size&&(n.style.marginTop=Xt(qr(t.size,e)))),n},mathmlBuilder(t,e){var n=new Dt.MathNode("mspace");return t.newLine&&(n.setAttribute("linebreak","newline"),t.size&&n.setAttribute("height",Xt(qr(t.size,e)))),n}});var z2={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},y8=t=>{var e=t.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new Ot("Expected a control sequence",t);return e},Jj=t=>{var e=t.gullet.popToken();return e.text==="="&&(e=t.gullet.popToken(),e.text===" "&&(e=t.gullet.popToken())),e},_8=(t,e,n,r)=>{var s=t.gullet.macros.get(n.text);s==null&&(n.noexpand=!0,s={tokens:[n],numArgs:0,unexpandable:!t.gullet.isExpandable(n.text)}),t.gullet.macros.set(e,s,r)};ln({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(t){var{parser:e,funcName:n}=t;e.consumeSpaces();var r=e.fetch();if(z2[r.text])return(n==="\\global"||n==="\\\\globallong")&&(r.text=z2[r.text]),Kn(e.parseFunction(),"internal");throw new Ot("Invalid token after macro prefix",r)}});ln({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=e.gullet.popToken(),s=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(s))throw new Ot("Expected a control sequence",r);for(var c=0,h,l=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){h=e.gullet.future(),l[c].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new Ot('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==c+1)throw new Ot('Argument number "'+r.text+'" out of order');c++,l.push([])}else{if(r.text==="EOF")throw new Ot("Expected a macro definition");l[c].push(r.text)}var{tokens:m}=e.gullet.consumeArg();return h&&m.unshift(h),(n==="\\edef"||n==="\\xdef")&&(m=e.gullet.expandTokens(m),m.reverse()),e.gullet.macros.set(s,{tokens:m,numArgs:c,delimiters:l},n===z2[n]),{type:"internal",mode:e.mode}}});ln({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=y8(e.gullet.popToken());e.gullet.consumeSpaces();var s=Jj(e);return _8(e,r,s,n==="\\\\globallet"),{type:"internal",mode:e.mode}}});ln({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t){var{parser:e,funcName:n}=t,r=y8(e.gullet.popToken()),s=e.gullet.popToken(),c=e.gullet.popToken();return _8(e,r,c,n==="\\\\globalfuture"),e.gullet.pushToken(c),e.gullet.pushToken(s),{type:"internal",mode:e.mode}}});var L0=function(e,n,r){var s=Pr.math[e]&&Pr.math[e].replace,c=rw(s||e,n,r);if(!c)throw new Error("Unsupported symbol "+e+" and font size "+n+".");return c},uw=function(e,n,r,s){var c=r.havingBaseStyle(n),h=rt.makeSpan(s.concat(c.sizingClasses(r)),[e],r),l=c.sizeMultiplier/r.sizeMultiplier;return h.height*=l,h.depth*=l,h.maxFontSize=c.sizeMultiplier,h},x8=function(e,n,r){var s=n.havingBaseStyle(r),c=(1-n.sizeMultiplier/s.sizeMultiplier)*n.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=Xt(c),e.height-=c,e.depth+=c},Qj=function(e,n,r,s,c,h){var l=rt.makeSymbol(e,"Main-Regular",c,s),m=uw(l,n,s,h);return r&&x8(m,s,n),m},eW=function(e,n,r,s){return rt.makeSymbol(e,"Size"+n+"-Regular",r,s)},b8=function(e,n,r,s,c,h){var l=eW(e,n,c,s),m=uw(rt.makeSpan(["delimsizing","size"+n],[l],s),Fn.TEXT,s,h);return r&&x8(m,s,Fn.TEXT),m},rx=function(e,n,r){var s;n==="Size1-Regular"?s="delim-size1":s="delim-size4";var c=rt.makeSpan(["delimsizinginner",s],[rt.makeSpan([],[rt.makeSymbol(e,n,r)])]);return{type:"elem",elem:c}},ix=function(e,n,r){var s=vo["Size4-Regular"][e.charCodeAt(0)]?vo["Size4-Regular"][e.charCodeAt(0)][4]:vo["Size1-Regular"][e.charCodeAt(0)][4],c=new Cc("inner",sj(e,Math.round(1e3*n))),h=new gl([c],{width:Xt(s),height:Xt(n),style:"width:"+Xt(s),viewBox:"0 0 "+1e3*s+" "+Math.round(1e3*n),preserveAspectRatio:"xMinYMin"}),l=rt.makeSvgSpan([],[h],r);return l.height=n,l.style.height=Xt(n),l.style.width=Xt(s),{type:"elem",elem:l}},F2=.008,jg={type:"kern",size:-1*F2},tW=["|","\\lvert","\\rvert","\\vert"],nW=["\\|","\\lVert","\\rVert","\\Vert"],w8=function(e,n,r,s,c,h){var l,m,_,S,T="",M=0;l=_=S=e,m=null;var I="Size1-Regular";e==="\\uparrow"?_=S="⏐":e==="\\Uparrow"?_=S="‖":e==="\\downarrow"?l=_="⏐":e==="\\Downarrow"?l=_="‖":e==="\\updownarrow"?(l="\\uparrow",_="⏐",S="\\downarrow"):e==="\\Updownarrow"?(l="\\Uparrow",_="‖",S="\\Downarrow"):kn.contains(tW,e)?(_="∣",T="vert",M=333):kn.contains(nW,e)?(_="∥",T="doublevert",M=556):e==="["||e==="\\lbrack"?(l="⎡",_="⎢",S="⎣",I="Size4-Regular",T="lbrack",M=667):e==="]"||e==="\\rbrack"?(l="⎤",_="⎥",S="⎦",I="Size4-Regular",T="rbrack",M=667):e==="\\lfloor"||e==="⌊"?(_=l="⎢",S="⎣",I="Size4-Regular",T="lfloor",M=667):e==="\\lceil"||e==="⌈"?(l="⎡",_=S="⎢",I="Size4-Regular",T="lceil",M=667):e==="\\rfloor"||e==="⌋"?(_=l="⎥",S="⎦",I="Size4-Regular",T="rfloor",M=667):e==="\\rceil"||e==="⌉"?(l="⎤",_=S="⎥",I="Size4-Regular",T="rceil",M=667):e==="("||e==="\\lparen"?(l="⎛",_="⎜",S="⎝",I="Size4-Regular",T="lparen",M=875):e===")"||e==="\\rparen"?(l="⎞",_="⎟",S="⎠",I="Size4-Regular",T="rparen",M=875):e==="\\{"||e==="\\lbrace"?(l="⎧",m="⎨",S="⎩",_="⎪",I="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(l="⎫",m="⎬",S="⎭",_="⎪",I="Size4-Regular"):e==="\\lgroup"||e==="⟮"?(l="⎧",S="⎩",_="⎪",I="Size4-Regular"):e==="\\rgroup"||e==="⟯"?(l="⎫",S="⎭",_="⎪",I="Size4-Regular"):e==="\\lmoustache"||e==="⎰"?(l="⎧",S="⎭",_="⎪",I="Size4-Regular"):(e==="\\rmoustache"||e==="⎱")&&(l="⎫",S="⎩",_="⎪",I="Size4-Regular");var N=L0(l,I,c),B=N.height+N.depth,k=L0(_,I,c),C=k.height+k.depth,U=L0(S,I,c),V=U.height+U.depth,Y=0,he=1;if(m!==null){var Z=L0(m,I,c);Y=Z.height+Z.depth,he=2}var ne=B+V+Y,xe=Math.max(0,Math.ceil((n-ne)/(he*C))),ie=ne+xe*he*C,J=s.fontMetrics().axisHeight;r&&(J*=s.sizeMultiplier);var Te=ie/2-J,Be=[];if(T.length>0){var Re=ie-B-V,We=Math.round(ie*1e3),ct=oj(T,Math.round(Re*1e3)),gt=new Cc(T,ct),ft=(M/1e3).toFixed(3)+"em",ke=(We/1e3).toFixed(3)+"em",at=new gl([gt],{width:ft,height:ke,viewBox:"0 0 "+M+" "+We}),ot=rt.makeSvgSpan([],[at],s);ot.height=We/1e3,ot.style.width=ft,ot.style.height=ke,Be.push({type:"elem",elem:ot})}else{if(Be.push(rx(S,I,c)),Be.push(jg),m===null){var _t=ie-B-V+2*F2;Be.push(ix(_,_t,s))}else{var kt=(ie-B-V-Y)/2+2*F2;Be.push(ix(_,kt,s)),Be.push(jg),Be.push(rx(m,I,c)),Be.push(jg),Be.push(ix(_,kt,s))}Be.push(jg),Be.push(rx(l,I,c))}var Cn=s.havingBaseStyle(Fn.TEXT),it=rt.makeVList({positionType:"bottom",positionData:Te,children:Be},Cn);return uw(rt.makeSpan(["delimsizing","mult"],[it],Cn),Fn.TEXT,s,h)},ax=80,sx=.08,ox=function(e,n,r,s,c){var h=aj(e,s,r),l=new Cc(e,h),m=new gl([l],{width:"400em",height:Xt(n),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return rt.makeSvgSpan(["hide-tail"],[m],c)},rW=function(e,n){var r=n.havingBaseSizing(),s=E8("\\surd",e*r.sizeMultiplier,T8,r),c=r.sizeMultiplier,h=Math.max(0,n.minRuleThickness-n.fontMetrics().sqrtRuleThickness),l,m=0,_=0,S=0,T;return s.type==="small"?(S=1e3+1e3*h+ax,e<1?c=1:e<1.4&&(c=.7),m=(1+h+sx)/c,_=(1+h)/c,l=ox("sqrtMain",m,S,h,n),l.style.minWidth="0.853em",T=.833/c):s.type==="large"?(S=(1e3+ax)*Z0[s.size],_=(Z0[s.size]+h)/c,m=(Z0[s.size]+h+sx)/c,l=ox("sqrtSize"+s.size,m,S,h,n),l.style.minWidth="1.02em",T=1/c):(m=e+h+sx,_=e+h,S=Math.floor(1e3*e+h)+ax,l=ox("sqrtTall",m,S,h,n),l.style.minWidth="0.742em",T=1.056),l.height=_,l.style.height=Xt(m),{span:l,advanceWidth:T,ruleWidth:(n.fontMetrics().sqrtRuleThickness+h)*c}},S8=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","\\surd"],iW=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱"],M8=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Z0=[0,1.2,1.8,2.4,3],aW=function(e,n,r,s,c){if(e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle"),kn.contains(S8,e)||kn.contains(M8,e))return b8(e,n,!1,r,s,c);if(kn.contains(iW,e))return w8(e,Z0[n],!1,r,s,c);throw new Ot("Illegal delimiter: '"+e+"'")},sW=[{type:"small",style:Fn.SCRIPTSCRIPT},{type:"small",style:Fn.SCRIPT},{type:"small",style:Fn.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],oW=[{type:"small",style:Fn.SCRIPTSCRIPT},{type:"small",style:Fn.SCRIPT},{type:"small",style:Fn.TEXT},{type:"stack"}],T8=[{type:"small",style:Fn.SCRIPTSCRIPT},{type:"small",style:Fn.SCRIPT},{type:"small",style:Fn.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],lW=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},E8=function(e,n,r,s){for(var c=Math.min(2,3-s.style.size),h=c;h<r.length&&r[h].type!=="stack";h++){var l=L0(e,lW(r[h]),"math"),m=l.height+l.depth;if(r[h].type==="small"){var _=s.havingBaseStyle(r[h].style);m*=_.sizeMultiplier}if(m>n)return r[h]}return r[r.length-1]},A8=function(e,n,r,s,c,h){e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle");var l;kn.contains(M8,e)?l=sW:kn.contains(S8,e)?l=T8:l=oW;var m=E8(e,n,l,s);return m.type==="small"?Qj(e,m.style,r,s,c,h):m.type==="large"?b8(e,m.size,r,s,c,h):w8(e,n,r,s,c,h)},cW=function(e,n,r,s,c,h){var l=s.fontMetrics().axisHeight*s.sizeMultiplier,m=901,_=5/s.fontMetrics().ptPerEm,S=Math.max(n-l,r+l),T=Math.max(S/500*m,2*S-_);return A8(e,T,!0,s,c,h)},ll={sqrtImage:rW,sizedDelim:aW,sizeToMaxHeight:Z0,customSizedDelim:A8,leftRightDelim:cW},NM={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},uW=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function Nv(t,e){var n=zv(t);if(n&&kn.contains(uW,n.text))return n;throw n?new Ot("Invalid delimiter '"+n.text+"' after '"+e.funcName+"'",t):new Ot("Invalid delimiter type '"+t.type+"'",t)}ln({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(t,e)=>{var n=Nv(e[0],t);return{type:"delimsizing",mode:t.parser.mode,size:NM[t.funcName].size,mclass:NM[t.funcName].mclass,delim:n.text}},htmlBuilder:(t,e)=>t.delim==="."?rt.makeSpan([t.mclass]):ll.sizedDelim(t.delim,t.size,e,t.mode,[t.mclass]),mathmlBuilder:t=>{var e=[];t.delim!=="."&&e.push(Cs(t.delim,t.mode));var n=new Dt.MathNode("mo",e);t.mclass==="mopen"||t.mclass==="mclose"?n.setAttribute("fence","true"):n.setAttribute("fence","false"),n.setAttribute("stretchy","true");var r=Xt(ll.sizeToMaxHeight[t.size]);return n.setAttribute("minsize",r),n.setAttribute("maxsize",r),n}});function BM(t){if(!t.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}ln({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=t.parser.gullet.macros.get("\\current@color");if(n&&typeof n!="string")throw new Ot("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:t.parser.mode,delim:Nv(e[0],t).text,color:n}}});ln({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=Nv(e[0],t),r=t.parser;++r.leftrightDepth;var s=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var c=Kn(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:s,left:n.text,right:c.delim,rightColor:c.color}},htmlBuilder:(t,e)=>{BM(t);for(var n=Mi(t.body,e,!0,["mopen","mclose"]),r=0,s=0,c=!1,h=0;h<n.length;h++)n[h].isMiddle?c=!0:(r=Math.max(n[h].height,r),s=Math.max(n[h].depth,s));r*=e.sizeMultiplier,s*=e.sizeMultiplier;var l;if(t.left==="."?l=Tp(e,["mopen"]):l=ll.leftRightDelim(t.left,r,s,e,t.mode,["mopen"]),n.unshift(l),c)for(var m=1;m<n.length;m++){var _=n[m],S=_.isMiddle;S&&(n[m]=ll.leftRightDelim(S.delim,r,s,S.options,t.mode,[]))}var T;if(t.right===".")T=Tp(e,["mclose"]);else{var M=t.rightColor?e.withColor(t.rightColor):e;T=ll.leftRightDelim(t.right,r,s,M,t.mode,["mclose"])}return n.push(T),rt.makeSpan(["minner"],n,e)},mathmlBuilder:(t,e)=>{BM(t);var n=Fa(t.body,e);if(t.left!=="."){var r=new Dt.MathNode("mo",[Cs(t.left,t.mode)]);r.setAttribute("fence","true"),n.unshift(r)}if(t.right!=="."){var s=new Dt.MathNode("mo",[Cs(t.right,t.mode)]);s.setAttribute("fence","true"),t.rightColor&&s.setAttribute("mathcolor",t.rightColor),n.push(s)}return sw(n)}});ln({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var n=Nv(e[0],t);if(!t.parser.leftrightDepth)throw new Ot("\\middle without preceding \\left",n);return{type:"middle",mode:t.parser.mode,delim:n.text}},htmlBuilder:(t,e)=>{var n;if(t.delim===".")n=Tp(e,[]);else{n=ll.sizedDelim(t.delim,1,e,t.mode,[]);var r={delim:t.delim,options:e};n.isMiddle=r}return n},mathmlBuilder:(t,e)=>{var n=t.delim==="\\vert"||t.delim==="|"?Cs("|","text"):Cs(t.delim,t.mode),r=new Dt.MathNode("mo",[n]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var hw=(t,e)=>{var n=rt.wrapFragment(cr(t.body,e),e),r=t.label.slice(1),s=e.sizeMultiplier,c,h=0,l=kn.isCharacterBox(t.body);if(r==="sout")c=rt.makeSpan(["stretchy","sout"]),c.height=e.fontMetrics().defaultRuleThickness/s,h=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var m=qr({number:.6,unit:"pt"},e),_=qr({number:.35,unit:"ex"},e),S=e.havingBaseSizing();s=s/S.sizeMultiplier;var T=n.height+n.depth+m+_;n.style.paddingLeft=Xt(T/2+m);var M=Math.floor(1e3*T*s),I=rj(M),N=new gl([new Cc("phase",I)],{width:"400em",height:Xt(M/1e3),viewBox:"0 0 400000 "+M,preserveAspectRatio:"xMinYMin slice"});c=rt.makeSvgSpan(["hide-tail"],[N],e),c.style.height=Xt(T),h=n.depth+m+_}else{/cancel/.test(r)?l||n.classes.push("cancel-pad"):r==="angl"?n.classes.push("anglpad"):n.classes.push("boxpad");var B=0,k=0,C=0;/box/.test(r)?(C=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),B=e.fontMetrics().fboxsep+(r==="colorbox"?0:C),k=B):r==="angl"?(C=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),B=4*C,k=Math.max(0,.25-n.depth)):(B=l?.2:0,k=B),c=yl.encloseSpan(n,r,B,k,e),/fbox|boxed|fcolorbox/.test(r)?(c.style.borderStyle="solid",c.style.borderWidth=Xt(C)):r==="angl"&&C!==.049&&(c.style.borderTopWidth=Xt(C),c.style.borderRightWidth=Xt(C)),h=n.depth+k,t.backgroundColor&&(c.style.backgroundColor=t.backgroundColor,t.borderColor&&(c.style.borderColor=t.borderColor))}var U;if(t.backgroundColor)U=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:c,shift:h},{type:"elem",elem:n,shift:0}]},e);else{var V=/cancel|phase/.test(r)?["svg-align"]:[];U=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:n,shift:0},{type:"elem",elem:c,shift:h,wrapperClasses:V}]},e)}return/cancel/.test(r)&&(U.height=n.height,U.depth=n.depth),/cancel/.test(r)&&!l?rt.makeSpan(["mord","cancel-lap"],[U],e):rt.makeSpan(["mord"],[U],e)},dw=(t,e)=>{var n=0,r=new Dt.MathNode(t.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Er(t.body,e)]);switch(t.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(n=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*n+"pt"),r.setAttribute("height","+"+2*n+"pt"),r.setAttribute("lspace",n+"pt"),r.setAttribute("voffset",n+"pt"),t.label==="\\fcolorbox"){var s=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+s+"em solid "+String(t.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return t.backgroundColor&&r.setAttribute("mathbackground",t.backgroundColor),r};ln({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(t,e,n){var{parser:r,funcName:s}=t,c=Kn(e[0],"color-token").color,h=e[1];return{type:"enclose",mode:r.mode,label:s,backgroundColor:c,body:h}},htmlBuilder:hw,mathmlBuilder:dw});ln({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(t,e,n){var{parser:r,funcName:s}=t,c=Kn(e[0],"color-token").color,h=Kn(e[1],"color-token").color,l=e[2];return{type:"enclose",mode:r.mode,label:s,backgroundColor:h,borderColor:c,body:l}},htmlBuilder:hw,mathmlBuilder:dw});ln({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\fbox",body:e[0]}}});ln({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"enclose",mode:n.mode,label:r,body:s}},htmlBuilder:hw,mathmlBuilder:dw});ln({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"enclose",mode:n.mode,label:"\\angl",body:e[0]}}});var C8={};function To(t){for(var{type:e,names:n,props:r,handler:s,htmlBuilder:c,mathmlBuilder:h}=t,l={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:s},m=0;m<n.length;++m)C8[n[m]]=l;c&&(tv[e]=c),h&&(nv[e]=h)}var P8={};function ce(t,e){P8[t]=e}function OM(t){var e=[];t.consumeSpaces();var n=t.fetch().text;for(n==="\\relax"&&(t.consume(),t.consumeSpaces(),n=t.fetch().text);n==="\\hline"||n==="\\hdashline";)t.consume(),e.push(n==="\\hdashline"),t.consumeSpaces(),n=t.fetch().text;return e}var Bv=t=>{var e=t.parser.settings;if(!e.displayMode)throw new Ot("{"+t.envName+"} can be used only in display mode.")};function fw(t){if(t.indexOf("ed")===-1)return t.indexOf("*")===-1}function Nc(t,e,n){var{hskipBeforeAndAfter:r,addJot:s,cols:c,arraystretch:h,colSeparationType:l,autoTag:m,singleRow:_,emptySingleRow:S,maxNumCols:T,leqno:M}=e;if(t.gullet.beginGroup(),_||t.gullet.macros.set("\\cr","\\\\\\relax"),!h){var I=t.gullet.expandMacroAsText("\\arraystretch");if(I==null)h=1;else if(h=parseFloat(I),!h||h<0)throw new Ot("Invalid \\arraystretch: "+I)}t.gullet.beginGroup();var N=[],B=[N],k=[],C=[],U=m!=null?[]:void 0;function V(){m&&t.gullet.macros.set("\\@eqnsw","1",!0)}function Y(){U&&(t.gullet.macros.get("\\df@tag")?(U.push(t.subparse([new Ms("\\df@tag")])),t.gullet.macros.set("\\df@tag",void 0,!0)):U.push(!!m&&t.gullet.macros.get("\\@eqnsw")==="1"))}for(V(),C.push(OM(t));;){var he=t.parseExpression(!1,_?"\\end":"\\\\");t.gullet.endGroup(),t.gullet.beginGroup(),he={type:"ordgroup",mode:t.mode,body:he},n&&(he={type:"styling",mode:t.mode,style:n,body:[he]}),N.push(he);var Z=t.fetch().text;if(Z==="&"){if(T&&N.length===T){if(_||l)throw new Ot("Too many tab characters: &",t.nextToken);t.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}t.consume()}else if(Z==="\\end"){Y(),N.length===1&&he.type==="styling"&&he.body[0].body.length===0&&(B.length>1||!S)&&B.pop(),C.length<B.length+1&&C.push([]);break}else if(Z==="\\\\"){t.consume();var ne=void 0;t.gullet.future().text!==" "&&(ne=t.parseSizeGroup(!0)),k.push(ne?ne.value:null),Y(),C.push(OM(t)),N=[],B.push(N),V()}else throw new Ot("Expected & or \\\\ or \\cr or \\end",t.nextToken)}return t.gullet.endGroup(),t.gullet.endGroup(),{type:"array",mode:t.mode,addJot:s,arraystretch:h,body:B,cols:c,rowGaps:k,hskipBeforeAndAfter:r,hLinesBeforeRow:C,colSeparationType:l,tags:U,leqno:M}}function pw(t){return t.slice(0,1)==="d"?"display":"text"}var Eo=function(e,n){var r,s,c=e.body.length,h=e.hLinesBeforeRow,l=0,m=new Array(c),_=[],S=Math.max(n.fontMetrics().arrayRuleWidth,n.minRuleThickness),T=1/n.fontMetrics().ptPerEm,M=5*T;if(e.colSeparationType&&e.colSeparationType==="small"){var I=n.havingStyle(Fn.SCRIPT).sizeMultiplier;M=.2778*(I/n.sizeMultiplier)}var N=e.colSeparationType==="CD"?qr({number:3,unit:"ex"},n):12*T,B=3*T,k=e.arraystretch*N,C=.7*k,U=.3*k,V=0;function Y(qn){for(var Ae=0;Ae<qn.length;++Ae)Ae>0&&(V+=.25),_.push({pos:V,isDashed:qn[Ae]})}for(Y(h[0]),r=0;r<e.body.length;++r){var he=e.body[r],Z=C,ne=U;l<he.length&&(l=he.length);var xe=new Array(he.length);for(s=0;s<he.length;++s){var ie=cr(he[s],n);ne<ie.depth&&(ne=ie.depth),Z<ie.height&&(Z=ie.height),xe[s]=ie}var J=e.rowGaps[r],Te=0;J&&(Te=qr(J,n),Te>0&&(Te+=U,ne<Te&&(ne=Te),Te=0)),e.addJot&&(ne+=B),xe.height=Z,xe.depth=ne,V+=Z,xe.pos=V,V+=ne+Te,m[r]=xe,Y(h[r+1])}var Be=V/2+n.fontMetrics().axisHeight,Re=e.cols||[],We=[],ct,gt,ft=[];if(e.tags&&e.tags.some(qn=>qn))for(r=0;r<c;++r){var ke=m[r],at=ke.pos-Be,ot=e.tags[r],_t=void 0;ot===!0?_t=rt.makeSpan(["eqn-num"],[],n):ot===!1?_t=rt.makeSpan([],[],n):_t=rt.makeSpan([],Mi(ot,n,!0),n),_t.depth=ke.depth,_t.height=ke.height,ft.push({type:"elem",elem:_t,shift:at})}for(s=0,gt=0;s<l||gt<Re.length;++s,++gt){for(var kt=Re[gt]||{},Cn=!0;kt.type==="separator";){if(Cn||(ct=rt.makeSpan(["arraycolsep"],[]),ct.style.width=Xt(n.fontMetrics().doubleRuleSep),We.push(ct)),kt.separator==="|"||kt.separator===":"){var it=kt.separator==="|"?"solid":"dashed",Mt=rt.makeSpan(["vertical-separator"],[],n);Mt.style.height=Xt(V),Mt.style.borderRightWidth=Xt(S),Mt.style.borderRightStyle=it,Mt.style.margin="0 "+Xt(-S/2);var Ft=V-Be;Ft&&(Mt.style.verticalAlign=Xt(-Ft)),We.push(Mt)}else throw new Ot("Invalid separator type: "+kt.separator);gt++,kt=Re[gt]||{},Cn=!1}if(!(s>=l)){var At=void 0;(s>0||e.hskipBeforeAndAfter)&&(At=kn.deflt(kt.pregap,M),At!==0&&(ct=rt.makeSpan(["arraycolsep"],[]),ct.style.width=Xt(At),We.push(ct)));var Sn=[];for(r=0;r<c;++r){var Dn=m[r],qe=Dn[s];if(qe){var Nn=Dn.pos-Be;qe.depth=Dn.depth,qe.height=Dn.height,Sn.push({type:"elem",elem:qe,shift:Nn})}}Sn=rt.makeVList({positionType:"individualShift",children:Sn},n),Sn=rt.makeSpan(["col-align-"+(kt.align||"c")],[Sn]),We.push(Sn),(s<l-1||e.hskipBeforeAndAfter)&&(At=kn.deflt(kt.postgap,M),At!==0&&(ct=rt.makeSpan(["arraycolsep"],[]),ct.style.width=Xt(At),We.push(ct)))}}if(m=rt.makeSpan(["mtable"],We),_.length>0){for(var hn=rt.makeLineSpan("hline",n,S),Gn=rt.makeLineSpan("hdashline",n,S),gn=[{type:"elem",elem:m,shift:0}];_.length>0;){var un=_.pop(),Pn=un.pos-Be;un.isDashed?gn.push({type:"elem",elem:Gn,shift:Pn}):gn.push({type:"elem",elem:hn,shift:Pn})}m=rt.makeVList({positionType:"individualShift",children:gn},n)}if(ft.length===0)return rt.makeSpan(["mord"],[m],n);var je=rt.makeVList({positionType:"individualShift",children:ft},n);return je=rt.makeSpan(["tag"],[je],n),rt.makeFragment([m,je])},hW={c:"center ",l:"left ",r:"right "},Ao=function(e,n){for(var r=[],s=new Dt.MathNode("mtd",[],["mtr-glue"]),c=new Dt.MathNode("mtd",[],["mml-eqn-num"]),h=0;h<e.body.length;h++){for(var l=e.body[h],m=[],_=0;_<l.length;_++)m.push(new Dt.MathNode("mtd",[Er(l[_],n)]));e.tags&&e.tags[h]&&(m.unshift(s),m.push(s),e.leqno?m.unshift(c):m.push(c)),r.push(new Dt.MathNode("mtr",m))}var S=new Dt.MathNode("mtable",r),T=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);S.setAttribute("rowspacing",Xt(T));var M="",I="";if(e.cols&&e.cols.length>0){var N=e.cols,B="",k=!1,C=0,U=N.length;N[0].type==="separator"&&(M+="top ",C=1),N[N.length-1].type==="separator"&&(M+="bottom ",U-=1);for(var V=C;V<U;V++)N[V].type==="align"?(I+=hW[N[V].align],k&&(B+="none "),k=!0):N[V].type==="separator"&&k&&(B+=N[V].separator==="|"?"solid ":"dashed ",k=!1);S.setAttribute("columnalign",I.trim()),/[sd]/.test(B)&&S.setAttribute("columnlines",B.trim())}if(e.colSeparationType==="align"){for(var Y=e.cols||[],he="",Z=1;Z<Y.length;Z++)he+=Z%2?"0em ":"1em ";S.setAttribute("columnspacing",he.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?S.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?S.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?S.setAttribute("columnspacing","0.5em"):S.setAttribute("columnspacing","1em");var ne="",xe=e.hLinesBeforeRow;M+=xe[0].length>0?"left ":"",M+=xe[xe.length-1].length>0?"right ":"";for(var ie=1;ie<xe.length-1;ie++)ne+=xe[ie].length===0?"none ":xe[ie][0]?"dashed ":"solid ";return/[sd]/.test(ne)&&S.setAttribute("rowlines",ne.trim()),M!==""&&(S=new Dt.MathNode("menclose",[S]),S.setAttribute("notation",M.trim())),e.arraystretch&&e.arraystretch<1&&(S=new Dt.MathNode("mstyle",[S]),S.setAttribute("scriptlevel","1")),S},R8=function(e,n){e.envName.indexOf("ed")===-1&&Bv(e);var r=[],s=e.envName.indexOf("at")>-1?"alignat":"align",c=e.envName==="split",h=Nc(e.parser,{cols:r,addJot:!0,autoTag:c?void 0:fw(e.envName),emptySingleRow:!0,colSeparationType:s,maxNumCols:c?2:void 0,leqno:e.parser.settings.leqno},"display"),l,m=0,_={type:"ordgroup",mode:e.mode,body:[]};if(n[0]&&n[0].type==="ordgroup"){for(var S="",T=0;T<n[0].body.length;T++){var M=Kn(n[0].body[T],"textord");S+=M.text}l=Number(S),m=l*2}var I=!m;h.body.forEach(function(C){for(var U=1;U<C.length;U+=2){var V=Kn(C[U],"styling"),Y=Kn(V.body[0],"ordgroup");Y.body.unshift(_)}if(I)m<C.length&&(m=C.length);else{var he=C.length/2;if(l<he)throw new Ot("Too many math in a row: "+("expected "+l+", but got "+he),C[0])}});for(var N=0;N<m;++N){var B="r",k=0;N%2===1?B="l":N>0&&I&&(k=1),r[N]={type:"align",align:B,pregap:k,postgap:0}}return h.colSeparationType=I?"align":"alignat",h};To({type:"array",names:["array","darray"],props:{numArgs:1},handler(t,e){var n=zv(e[0]),r=n?[e[0]]:Kn(e[0],"ordgroup").body,s=r.map(function(h){var l=lw(h),m=l.text;if("lcr".indexOf(m)!==-1)return{type:"align",align:m};if(m==="|")return{type:"separator",separator:"|"};if(m===":")return{type:"separator",separator:":"};throw new Ot("Unknown column alignment: "+m,h)}),c={cols:s,hskipBeforeAndAfter:!0,maxNumCols:s.length};return Nc(t.parser,c,pw(t.envName))},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(t){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[t.envName.replace("*","")],n="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:n}]};if(t.envName.charAt(t.envName.length-1)==="*"){var s=t.parser;if(s.consumeSpaces(),s.fetch().text==="["){if(s.consume(),s.consumeSpaces(),n=s.fetch().text,"lcr".indexOf(n)===-1)throw new Ot("Expected l or c or r",s.nextToken);s.consume(),s.consumeSpaces(),s.expect("]"),s.consume(),r.cols=[{type:"align",align:n}]}}var c=Nc(t.parser,r,pw(t.envName)),h=Math.max(0,...c.body.map(l=>l.length));return c.cols=new Array(h).fill({type:"align",align:n}),e?{type:"leftright",mode:t.mode,body:[c],left:e[0],right:e[1],rightColor:void 0}:c},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(t){var e={arraystretch:.5},n=Nc(t.parser,e,"script");return n.colSeparationType="small",n},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["subarray"],props:{numArgs:1},handler(t,e){var n=zv(e[0]),r=n?[e[0]]:Kn(e[0],"ordgroup").body,s=r.map(function(h){var l=lw(h),m=l.text;if("lc".indexOf(m)!==-1)return{type:"align",align:m};throw new Ot("Unknown column alignment: "+m,h)});if(s.length>1)throw new Ot("{subarray} can contain only one column");var c={cols:s,hskipBeforeAndAfter:!1,arraystretch:.5};if(c=Nc(t.parser,c,"script"),c.body.length>0&&c.body[0].length>1)throw new Ot("{subarray} can contain only one column");return c},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(t){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},n=Nc(t.parser,e,pw(t.envName));return{type:"leftright",mode:t.mode,body:[n],left:t.envName.indexOf("r")>-1?".":"\\{",right:t.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:R8,htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(t){kn.contains(["gather","gather*"],t.envName)&&Bv(t);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:fw(t.envName),emptySingleRow:!0,leqno:t.parser.settings.leqno};return Nc(t.parser,e,"display")},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:R8,htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(t){Bv(t);var e={autoTag:fw(t.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:t.parser.settings.leqno};return Nc(t.parser,e,"display")},htmlBuilder:Eo,mathmlBuilder:Ao});To({type:"array",names:["CD"],props:{numArgs:0},handler(t){return Bv(t),Kj(t.parser)},htmlBuilder:Eo,mathmlBuilder:Ao});ce("\\nonumber","\\gdef\\@eqnsw{0}");ce("\\notag","\\nonumber");ln({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(t,e){throw new Ot(t.funcName+" valid only within array environment")}});var UM=C8;ln({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];if(s.type!=="ordgroup")throw new Ot("Invalid environment name",s);for(var c="",h=0;h<s.body.length;++h)c+=Kn(s.body[h],"textord").text;if(r==="\\begin"){if(!UM.hasOwnProperty(c))throw new Ot("No such environment: "+c,s);var l=UM[c],{args:m,optArgs:_}=n.parseArguments("\\begin{"+c+"}",l),S={mode:n.mode,envName:c,parser:n},T=l.handler(S,m,_);n.expect("\\end",!1);var M=n.nextToken,I=Kn(n.parseFunction(),"environment");if(I.name!==c)throw new Ot("Mismatch: \\begin{"+c+"} matched by \\end{"+I.name+"}",M);return T}return{type:"environment",mode:n.mode,name:c,nameGroup:s}}});var I8=(t,e)=>{var n=t.font,r=e.withFont(n);return cr(t.body,r)},D8=(t,e)=>{var n=t.font,r=e.withFont(n);return Er(t.body,r)},VM={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};ln({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=rv(e[0]),c=r;return c in VM&&(c=VM[c]),{type:"font",mode:n.mode,font:c.slice(1),body:s}},htmlBuilder:I8,mathmlBuilder:D8});ln({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(t,e)=>{var{parser:n}=t,r=e[0],s=kn.isCharacterBox(r);return{type:"mclass",mode:n.mode,mclass:Fv(r),body:[{type:"font",mode:n.mode,font:"boldsymbol",body:r}],isCharacterBox:s}}});ln({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,breakOnTokenText:s}=t,{mode:c}=n,h=n.parseExpression(!0,s),l="math"+r.slice(1);return{type:"font",mode:c,font:l,body:{type:"ordgroup",mode:n.mode,body:h}}},htmlBuilder:I8,mathmlBuilder:D8});var k8=(t,e)=>{var n=e;return t==="display"?n=n.id>=Fn.SCRIPT.id?n.text():Fn.DISPLAY:t==="text"&&n.size===Fn.DISPLAY.size?n=Fn.TEXT:t==="script"?n=Fn.SCRIPT:t==="scriptscript"&&(n=Fn.SCRIPTSCRIPT),n},mw=(t,e)=>{var n=k8(t.size,e.style),r=n.fracNum(),s=n.fracDen(),c;c=e.havingStyle(r);var h=cr(t.numer,c,e);if(t.continued){var l=8.5/e.fontMetrics().ptPerEm,m=3.5/e.fontMetrics().ptPerEm;h.height=h.height<l?l:h.height,h.depth=h.depth<m?m:h.depth}c=e.havingStyle(s);var _=cr(t.denom,c,e),S,T,M;t.hasBarLine?(t.barSize?(T=qr(t.barSize,e),S=rt.makeLineSpan("frac-line",e,T)):S=rt.makeLineSpan("frac-line",e),T=S.height,M=S.height):(S=null,T=0,M=e.fontMetrics().defaultRuleThickness);var I,N,B;n.size===Fn.DISPLAY.size||t.size==="display"?(I=e.fontMetrics().num1,T>0?N=3*M:N=7*M,B=e.fontMetrics().denom1):(T>0?(I=e.fontMetrics().num2,N=M):(I=e.fontMetrics().num3,N=3*M),B=e.fontMetrics().denom2);var k;if(S){var U=e.fontMetrics().axisHeight;I-h.depth-(U+.5*T)<N&&(I+=N-(I-h.depth-(U+.5*T))),U-.5*T-(_.height-B)<N&&(B+=N-(U-.5*T-(_.height-B)));var V=-(U-.5*T);k=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:_,shift:B},{type:"elem",elem:S,shift:V},{type:"elem",elem:h,shift:-I}]},e)}else{var C=I-h.depth-(_.height-B);C<N&&(I+=.5*(N-C),B+=.5*(N-C)),k=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:_,shift:B},{type:"elem",elem:h,shift:-I}]},e)}c=e.havingStyle(n),k.height*=c.sizeMultiplier/e.sizeMultiplier,k.depth*=c.sizeMultiplier/e.sizeMultiplier;var Y;n.size===Fn.DISPLAY.size?Y=e.fontMetrics().delim1:n.size===Fn.SCRIPTSCRIPT.size?Y=e.havingStyle(Fn.SCRIPT).fontMetrics().delim2:Y=e.fontMetrics().delim2;var he,Z;return t.leftDelim==null?he=Tp(e,["mopen"]):he=ll.customSizedDelim(t.leftDelim,Y,!0,e.havingStyle(n),t.mode,["mopen"]),t.continued?Z=rt.makeSpan([]):t.rightDelim==null?Z=Tp(e,["mclose"]):Z=ll.customSizedDelim(t.rightDelim,Y,!0,e.havingStyle(n),t.mode,["mclose"]),rt.makeSpan(["mord"].concat(c.sizingClasses(e)),[he,rt.makeSpan(["mfrac"],[k]),Z],e)},gw=(t,e)=>{var n=new Dt.MathNode("mfrac",[Er(t.numer,e),Er(t.denom,e)]);if(!t.hasBarLine)n.setAttribute("linethickness","0px");else if(t.barSize){var r=qr(t.barSize,e);n.setAttribute("linethickness",Xt(r))}var s=k8(t.size,e.style);if(s.size!==e.style.size){n=new Dt.MathNode("mstyle",[n]);var c=s.size===Fn.DISPLAY.size?"true":"false";n.setAttribute("displaystyle",c),n.setAttribute("scriptlevel","0")}if(t.leftDelim!=null||t.rightDelim!=null){var h=[];if(t.leftDelim!=null){var l=new Dt.MathNode("mo",[new Dt.TextNode(t.leftDelim.replace("\\",""))]);l.setAttribute("fence","true"),h.push(l)}if(h.push(n),t.rightDelim!=null){var m=new Dt.MathNode("mo",[new Dt.TextNode(t.rightDelim.replace("\\",""))]);m.setAttribute("fence","true"),h.push(m)}return sw(h)}return n};ln({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],c=e[1],h,l=null,m=null,_="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":h=!0;break;case"\\\\atopfrac":h=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":h=!1,l="(",m=")";break;case"\\\\bracefrac":h=!1,l="\\{",m="\\}";break;case"\\\\brackfrac":h=!1,l="[",m="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":_="display";break;case"\\tfrac":case"\\tbinom":_="text";break}return{type:"genfrac",mode:n.mode,continued:!1,numer:s,denom:c,hasBarLine:h,leftDelim:l,rightDelim:m,size:_,barSize:null}},htmlBuilder:mw,mathmlBuilder:gw});ln({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],c=e[1];return{type:"genfrac",mode:n.mode,continued:!0,numer:s,denom:c,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});ln({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(t){var{parser:e,funcName:n,token:r}=t,s;switch(n){case"\\over":s="\\frac";break;case"\\choose":s="\\binom";break;case"\\atop":s="\\\\atopfrac";break;case"\\brace":s="\\\\bracefrac";break;case"\\brack":s="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:s,token:r}}});var HM=["display","text","script","scriptscript"],GM=function(e){var n=null;return e.length>0&&(n=e,n=n==="."?null:n),n};ln({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(t,e){var{parser:n}=t,r=e[4],s=e[5],c=rv(e[0]),h=c.type==="atom"&&c.family==="open"?GM(c.text):null,l=rv(e[1]),m=l.type==="atom"&&l.family==="close"?GM(l.text):null,_=Kn(e[2],"size"),S,T=null;_.isBlank?S=!0:(T=_.value,S=T.number>0);var M="auto",I=e[3];if(I.type==="ordgroup"){if(I.body.length>0){var N=Kn(I.body[0],"textord");M=HM[Number(N.text)]}}else I=Kn(I,"textord"),M=HM[Number(I.text)];return{type:"genfrac",mode:n.mode,numer:r,denom:s,continued:!1,hasBarLine:S,barSize:T,leftDelim:h,rightDelim:m,size:M}},htmlBuilder:mw,mathmlBuilder:gw});ln({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(t,e){var{parser:n,funcName:r,token:s}=t;return{type:"infix",mode:n.mode,replaceWith:"\\\\abovefrac",size:Kn(e[0],"size").value,token:s}}});ln({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0],c=HG(Kn(e[1],"infix").size),h=e[2],l=c.number>0;return{type:"genfrac",mode:n.mode,numer:s,denom:h,continued:!1,hasBarLine:l,barSize:c,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:mw,mathmlBuilder:gw});var L8=(t,e)=>{var n=e.style,r,s;t.type==="supsub"?(r=t.sup?cr(t.sup,e.havingStyle(n.sup()),e):cr(t.sub,e.havingStyle(n.sub()),e),s=Kn(t.base,"horizBrace")):s=Kn(t,"horizBrace");var c=cr(s.base,e.havingBaseStyle(Fn.DISPLAY)),h=yl.svgSpan(s,e),l;if(s.isOver?(l=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:c},{type:"kern",size:.1},{type:"elem",elem:h}]},e),l.children[0].children[0].children[1].classes.push("svg-align")):(l=rt.makeVList({positionType:"bottom",positionData:c.depth+.1+h.height,children:[{type:"elem",elem:h},{type:"kern",size:.1},{type:"elem",elem:c}]},e),l.children[0].children[0].children[0].classes.push("svg-align")),r){var m=rt.makeSpan(["mord",s.isOver?"mover":"munder"],[l],e);s.isOver?l=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:m},{type:"kern",size:.2},{type:"elem",elem:r}]},e):l=rt.makeVList({positionType:"bottom",positionData:m.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:m}]},e)}return rt.makeSpan(["mord",s.isOver?"mover":"munder"],[l],e)},dW=(t,e)=>{var n=yl.mathMLnode(t.label);return new Dt.MathNode(t.isOver?"mover":"munder",[Er(t.base,e),n])};ln({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(t,e){var{parser:n,funcName:r}=t;return{type:"horizBrace",mode:n.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:L8,mathmlBuilder:dW});ln({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[1],s=Kn(e[0],"url").url;return n.settings.isTrusted({command:"\\href",url:s})?{type:"href",mode:n.mode,href:s,body:ui(r)}:n.formatUnsupportedCmd("\\href")},htmlBuilder:(t,e)=>{var n=Mi(t.body,e,!1);return rt.makeAnchor(t.href,[],n,e)},mathmlBuilder:(t,e)=>{var n=Pc(t.body,e);return n instanceof ys||(n=new ys("mrow",[n])),n.setAttribute("href",t.href),n}});ln({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=Kn(e[0],"url").url;if(!n.settings.isTrusted({command:"\\url",url:r}))return n.formatUnsupportedCmd("\\url");for(var s=[],c=0;c<r.length;c++){var h=r[c];h==="~"&&(h="\\textasciitilde"),s.push({type:"textord",mode:"text",text:h})}var l={type:"text",mode:n.mode,font:"\\texttt",body:s};return{type:"href",mode:n.mode,href:r,body:ui(l)}}});ln({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(t,e){var{parser:n}=t;return{type:"hbox",mode:n.mode,body:ui(e[0])}},htmlBuilder(t,e){var n=Mi(t.body,e,!1);return rt.makeFragment(n)},mathmlBuilder(t,e){return new Dt.MathNode("mrow",Fa(t.body,e))}});ln({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r,token:s}=t,c=Kn(e[0],"raw").string,h=e[1];n.settings.strict&&n.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var l,m={};switch(r){case"\\htmlClass":m.class=c,l={command:"\\htmlClass",class:c};break;case"\\htmlId":m.id=c,l={command:"\\htmlId",id:c};break;case"\\htmlStyle":m.style=c,l={command:"\\htmlStyle",style:c};break;case"\\htmlData":{for(var _=c.split(","),S=0;S<_.length;S++){var T=_[S].split("=");if(T.length!==2)throw new Ot("Error parsing key-value for \\htmlData");m["data-"+T[0].trim()]=T[1].trim()}l={command:"\\htmlData",attributes:m};break}default:throw new Error("Unrecognized html command")}return n.settings.isTrusted(l)?{type:"html",mode:n.mode,attributes:m,body:ui(h)}:n.formatUnsupportedCmd(r)},htmlBuilder:(t,e)=>{var n=Mi(t.body,e,!1),r=["enclosing"];t.attributes.class&&r.push(...t.attributes.class.trim().split(/\s+/));var s=rt.makeSpan(r,n,e);for(var c in t.attributes)c!=="class"&&t.attributes.hasOwnProperty(c)&&s.setAttribute(c,t.attributes[c]);return s},mathmlBuilder:(t,e)=>Pc(t.body,e)});ln({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"htmlmathml",mode:n.mode,html:ui(e[0]),mathml:ui(e[1])}},htmlBuilder:(t,e)=>{var n=Mi(t.html,e,!1);return rt.makeFragment(n)},mathmlBuilder:(t,e)=>Pc(t.mathml,e)});var lx=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var n=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!n)throw new Ot("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(n[1]+n[2]),unit:n[3]};if(!QA(r))throw new Ot("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};ln({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(t,e,n)=>{var{parser:r}=t,s={number:0,unit:"em"},c={number:.9,unit:"em"},h={number:0,unit:"em"},l="";if(n[0])for(var m=Kn(n[0],"raw").string,_=m.split(","),S=0;S<_.length;S++){var T=_[S].split("=");if(T.length===2){var M=T[1].trim();switch(T[0].trim()){case"alt":l=M;break;case"width":s=lx(M);break;case"height":c=lx(M);break;case"totalheight":h=lx(M);break;default:throw new Ot("Invalid key: '"+T[0]+"' in \\includegraphics.")}}}var I=Kn(e[0],"url").url;return l===""&&(l=I,l=l.replace(/^.*[\\/]/,""),l=l.substring(0,l.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:I})?{type:"includegraphics",mode:r.mode,alt:l,width:s,height:c,totalheight:h,src:I}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(t,e)=>{var n=qr(t.height,e),r=0;t.totalheight.number>0&&(r=qr(t.totalheight,e)-n);var s=0;t.width.number>0&&(s=qr(t.width,e));var c={height:Xt(n+r)};s>0&&(c.width=Xt(s)),r>0&&(c.verticalAlign=Xt(-r));var h=new dj(t.src,t.alt,c);return h.height=n,h.depth=r,h},mathmlBuilder:(t,e)=>{var n=new Dt.MathNode("mglyph",[]);n.setAttribute("alt",t.alt);var r=qr(t.height,e),s=0;if(t.totalheight.number>0&&(s=qr(t.totalheight,e)-r,n.setAttribute("valign",Xt(-s))),n.setAttribute("height",Xt(r+s)),t.width.number>0){var c=qr(t.width,e);n.setAttribute("width",Xt(c))}return n.setAttribute("src",t.src),n}});ln({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,s=Kn(e[0],"size");if(n.settings.strict){var c=r[1]==="m",h=s.value.unit==="mu";c?(h||n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+s.value.unit+" units")),n.mode!=="math"&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):h&&n.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:n.mode,dimension:s.value}},htmlBuilder(t,e){return rt.makeGlue(t.dimension,e)},mathmlBuilder(t,e){var n=qr(t.dimension,e);return new Dt.SpaceNode(n)}});ln({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"lap",mode:n.mode,alignment:r.slice(5),body:s}},htmlBuilder:(t,e)=>{var n;t.alignment==="clap"?(n=rt.makeSpan([],[cr(t.body,e)]),n=rt.makeSpan(["inner"],[n],e)):n=rt.makeSpan(["inner"],[cr(t.body,e)]);var r=rt.makeSpan(["fix"],[]),s=rt.makeSpan([t.alignment],[n,r],e),c=rt.makeSpan(["strut"]);return c.style.height=Xt(s.height+s.depth),s.depth&&(c.style.verticalAlign=Xt(-s.depth)),s.children.unshift(c),s=rt.makeSpan(["thinbox"],[s],e),rt.makeSpan(["mord","vbox"],[s],e)},mathmlBuilder:(t,e)=>{var n=new Dt.MathNode("mpadded",[Er(t.body,e)]);if(t.alignment!=="rlap"){var r=t.alignment==="llap"?"-1":"-0.5";n.setAttribute("lspace",r+"width")}return n.setAttribute("width","0px"),n}});ln({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){var{funcName:n,parser:r}=t,s=r.mode;r.switchMode("math");var c=n==="\\("?"\\)":"$",h=r.parseExpression(!1,c);return r.expect(c),r.switchMode(s),{type:"styling",mode:r.mode,style:"text",body:h}}});ln({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(t,e){throw new Ot("Mismatched "+t.funcName)}});var jM=(t,e)=>{switch(e.style.size){case Fn.DISPLAY.size:return t.display;case Fn.TEXT.size:return t.text;case Fn.SCRIPT.size:return t.script;case Fn.SCRIPTSCRIPT.size:return t.scriptscript;default:return t.text}};ln({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(t,e)=>{var{parser:n}=t;return{type:"mathchoice",mode:n.mode,display:ui(e[0]),text:ui(e[1]),script:ui(e[2]),scriptscript:ui(e[3])}},htmlBuilder:(t,e)=>{var n=jM(t,e),r=Mi(n,e,!1);return rt.makeFragment(r)},mathmlBuilder:(t,e)=>{var n=jM(t,e);return Pc(n,e)}});var z8=(t,e,n,r,s,c,h)=>{t=rt.makeSpan([],[t]);var l=n&&kn.isCharacterBox(n),m,_;if(e){var S=cr(e,r.havingStyle(s.sup()),r);_={elem:S,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-S.depth)}}if(n){var T=cr(n,r.havingStyle(s.sub()),r);m={elem:T,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-T.height)}}var M;if(_&&m){var I=r.fontMetrics().bigOpSpacing5+m.elem.height+m.elem.depth+m.kern+t.depth+h;M=rt.makeVList({positionType:"bottom",positionData:I,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:m.elem,marginLeft:Xt(-c)},{type:"kern",size:m.kern},{type:"elem",elem:t},{type:"kern",size:_.kern},{type:"elem",elem:_.elem,marginLeft:Xt(c)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(m){var N=t.height-h;M=rt.makeVList({positionType:"top",positionData:N,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:m.elem,marginLeft:Xt(-c)},{type:"kern",size:m.kern},{type:"elem",elem:t}]},r)}else if(_){var B=t.depth+h;M=rt.makeVList({positionType:"bottom",positionData:B,children:[{type:"elem",elem:t},{type:"kern",size:_.kern},{type:"elem",elem:_.elem,marginLeft:Xt(c)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return t;var k=[M];if(m&&c!==0&&!l){var C=rt.makeSpan(["mspace"],[],r);C.style.marginRight=Xt(c),k.unshift(C)}return rt.makeSpan(["mop","op-limits"],k,r)},F8=["\\smallint"],Qd=(t,e)=>{var n,r,s=!1,c;t.type==="supsub"?(n=t.sup,r=t.sub,c=Kn(t.base,"op"),s=!0):c=Kn(t,"op");var h=e.style,l=!1;h.size===Fn.DISPLAY.size&&c.symbol&&!kn.contains(F8,c.name)&&(l=!0);var m;if(c.symbol){var _=l?"Size2-Regular":"Size1-Regular",S="";if((c.name==="\\oiint"||c.name==="\\oiiint")&&(S=c.name.slice(1),c.name=S==="oiint"?"\\iint":"\\iiint"),m=rt.makeSymbol(c.name,_,"math",e,["mop","op-symbol",l?"large-op":"small-op"]),S.length>0){var T=m.italic,M=rt.staticSvg(S+"Size"+(l?"2":"1"),e);m=rt.makeVList({positionType:"individualShift",children:[{type:"elem",elem:m,shift:0},{type:"elem",elem:M,shift:l?.08:0}]},e),c.name="\\"+S,m.classes.unshift("mop"),m.italic=T}}else if(c.body){var I=Mi(c.body,e,!0);I.length===1&&I[0]instanceof As?(m=I[0],m.classes[0]="mop"):m=rt.makeSpan(["mop"],I,e)}else{for(var N=[],B=1;B<c.name.length;B++)N.push(rt.mathsym(c.name[B],c.mode,e));m=rt.makeSpan(["mop"],N,e)}var k=0,C=0;return(m instanceof As||c.name==="\\oiint"||c.name==="\\oiiint")&&!c.suppressBaseShift&&(k=(m.height-m.depth)/2-e.fontMetrics().axisHeight,C=m.italic),s?z8(m,n,r,e,h,C,k):(k&&(m.style.position="relative",m.style.top=Xt(k)),m)},Vp=(t,e)=>{var n;if(t.symbol)n=new ys("mo",[Cs(t.name,t.mode)]),kn.contains(F8,t.name)&&n.setAttribute("largeop","false");else if(t.body)n=new ys("mo",Fa(t.body,e));else{n=new ys("mi",[new X0(t.name.slice(1))]);var r=new ys("mo",[Cs("⁡","text")]);t.parentIsSupSub?n=new ys("mrow",[n,r]):n=u8([n,r])}return n},fW={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨆":"\\bigsqcup"};ln({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=r;return s.length===1&&(s=fW[s]),{type:"op",mode:n.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:s}},htmlBuilder:Qd,mathmlBuilder:Vp});ln({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"op",mode:n.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:ui(r)}},htmlBuilder:Qd,mathmlBuilder:Vp});var pW={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint"};ln({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Qd,mathmlBuilder:Vp});ln({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:n}},htmlBuilder:Qd,mathmlBuilder:Vp});ln({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","∫","∬","∭","∮","∯","∰"],props:{numArgs:0},handler(t){var{parser:e,funcName:n}=t,r=n;return r.length===1&&(r=pW[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Qd,mathmlBuilder:Vp});var N8=(t,e)=>{var n,r,s=!1,c;t.type==="supsub"?(n=t.sup,r=t.sub,c=Kn(t.base,"operatorname"),s=!0):c=Kn(t,"operatorname");var h;if(c.body.length>0){for(var l=c.body.map(T=>{var M=T.text;return typeof M=="string"?{type:"textord",mode:T.mode,text:M}:T}),m=Mi(l,e.withFont("mathrm"),!0),_=0;_<m.length;_++){var S=m[_];S instanceof As&&(S.text=S.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}h=rt.makeSpan(["mop"],m,e)}else h=rt.makeSpan(["mop"],[],e);return s?z8(h,n,r,e,e.style,0,0):h},mW=(t,e)=>{for(var n=Fa(t.body,e.withFont("mathrm")),r=!0,s=0;s<n.length;s++){var c=n[s];if(!(c instanceof Dt.SpaceNode))if(c instanceof Dt.MathNode)switch(c.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var h=c.children[0];c.children.length===1&&h instanceof Dt.TextNode?h.text=h.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var l=n.map(S=>S.toText()).join("");n=[new Dt.TextNode(l)]}var m=new Dt.MathNode("mi",n);m.setAttribute("mathvariant","normal");var _=new Dt.MathNode("mo",[Cs("⁡","text")]);return t.parentIsSupSub?new Dt.MathNode("mrow",[m,_]):Dt.newDocumentFragment([m,_])};ln({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(t,e)=>{var{parser:n,funcName:r}=t,s=e[0];return{type:"operatorname",mode:n.mode,body:ui(s),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:N8,mathmlBuilder:mW});ce("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");$u({type:"ordgroup",htmlBuilder(t,e){return t.semisimple?rt.makeFragment(Mi(t.body,e,!1)):rt.makeSpan(["mord"],Mi(t.body,e,!0),e)},mathmlBuilder(t,e){return Pc(t.body,e,!0)}});ln({type:"overline",names:["\\overline"],props:{numArgs:1},handler(t,e){var{parser:n}=t,r=e[0];return{type:"overline",mode:n.mode,body:r}},htmlBuilder(t,e){var n=cr(t.body,e.havingCrampedStyle()),r=rt.makeLineSpan("overline-line",e),s=e.fontMetrics().defaultRuleThickness,c=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n},{type:"kern",size:3*s},{type:"elem",elem:r},{type:"kern",size:s}]},e);return rt.makeSpan(["mord","overline"],[c],e)},mathmlBuilder(t,e){var n=new Dt.MathNode("mo",[new Dt.TextNode("‾")]);n.setAttribute("stretchy","true");var r=new Dt.MathNode("mover",[Er(t.body,e),n]);return r.setAttribute("accent","true"),r}});ln({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"phantom",mode:n.mode,body:ui(r)}},htmlBuilder:(t,e)=>{var n=Mi(t.body,e.withPhantom(),!1);return rt.makeFragment(n)},mathmlBuilder:(t,e)=>{var n=Fa(t.body,e);return new Dt.MathNode("mphantom",n)}});ln({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"hphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=rt.makeSpan([],[cr(t.body,e.withPhantom())]);if(n.height=0,n.depth=0,n.children)for(var r=0;r<n.children.length;r++)n.children[r].height=0,n.children[r].depth=0;return n=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e),rt.makeSpan(["mord"],[n],e)},mathmlBuilder:(t,e)=>{var n=Fa(ui(t.body),e),r=new Dt.MathNode("mphantom",n),s=new Dt.MathNode("mpadded",[r]);return s.setAttribute("height","0px"),s.setAttribute("depth","0px"),s}});ln({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(t,e)=>{var{parser:n}=t,r=e[0];return{type:"vphantom",mode:n.mode,body:r}},htmlBuilder:(t,e)=>{var n=rt.makeSpan(["inner"],[cr(t.body,e.withPhantom())]),r=rt.makeSpan(["fix"],[]);return rt.makeSpan(["mord","rlap"],[n,r],e)},mathmlBuilder:(t,e)=>{var n=Fa(ui(t.body),e),r=new Dt.MathNode("mphantom",n),s=new Dt.MathNode("mpadded",[r]);return s.setAttribute("width","0px"),s}});ln({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(t,e){var{parser:n}=t,r=Kn(e[0],"size").value,s=e[1];return{type:"raisebox",mode:n.mode,dy:r,body:s}},htmlBuilder(t,e){var n=cr(t.body,e),r=qr(t.dy,e);return rt.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){var n=new Dt.MathNode("mpadded",[Er(t.body,e)]),r=t.dy.number+t.dy.unit;return n.setAttribute("voffset",r),n}});ln({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(t){var{parser:e}=t;return{type:"internal",mode:e.mode}}});ln({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler(t,e,n){var{parser:r}=t,s=n[0],c=Kn(e[0],"size"),h=Kn(e[1],"size");return{type:"rule",mode:r.mode,shift:s&&Kn(s,"size").value,width:c.value,height:h.value}},htmlBuilder(t,e){var n=rt.makeSpan(["mord","rule"],[],e),r=qr(t.width,e),s=qr(t.height,e),c=t.shift?qr(t.shift,e):0;return n.style.borderRightWidth=Xt(r),n.style.borderTopWidth=Xt(s),n.style.bottom=Xt(c),n.width=r,n.height=s+c,n.depth=-c,n.maxFontSize=s*1.125*e.sizeMultiplier,n},mathmlBuilder(t,e){var n=qr(t.width,e),r=qr(t.height,e),s=t.shift?qr(t.shift,e):0,c=e.color&&e.getColor()||"black",h=new Dt.MathNode("mspace");h.setAttribute("mathbackground",c),h.setAttribute("width",Xt(n)),h.setAttribute("height",Xt(r));var l=new Dt.MathNode("mpadded",[h]);return s>=0?l.setAttribute("height",Xt(s)):(l.setAttribute("height",Xt(s)),l.setAttribute("depth",Xt(-s))),l.setAttribute("voffset",Xt(s)),l}});function B8(t,e,n){for(var r=Mi(t,e,!1),s=e.sizeMultiplier/n.sizeMultiplier,c=0;c<r.length;c++){var h=r[c].classes.indexOf("sizing");h<0?Array.prototype.push.apply(r[c].classes,e.sizingClasses(n)):r[c].classes[h+1]==="reset-size"+e.size&&(r[c].classes[h+1]="reset-size"+n.size),r[c].height*=s,r[c].depth*=s}return rt.makeFragment(r)}var WM=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],gW=(t,e)=>{var n=e.havingSize(t.size);return B8(t.body,n,e)};ln({type:"sizing",names:WM,props:{numArgs:0,allowedInText:!0},handler:(t,e)=>{var{breakOnTokenText:n,funcName:r,parser:s}=t,c=s.parseExpression(!1,n);return{type:"sizing",mode:s.mode,size:WM.indexOf(r)+1,body:c}},htmlBuilder:gW,mathmlBuilder:(t,e)=>{var n=e.havingSize(t.size),r=Fa(t.body,n),s=new Dt.MathNode("mstyle",r);return s.setAttribute("mathsize",Xt(n.sizeMultiplier)),s}});ln({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(t,e,n)=>{var{parser:r}=t,s=!1,c=!1,h=n[0]&&Kn(n[0],"ordgroup");if(h)for(var l="",m=0;m<h.body.length;++m){var _=h.body[m];if(l=_.text,l==="t")s=!0;else if(l==="b")c=!0;else{s=!1,c=!1;break}}else s=!0,c=!0;var S=e[0];return{type:"smash",mode:r.mode,body:S,smashHeight:s,smashDepth:c}},htmlBuilder:(t,e)=>{var n=rt.makeSpan([],[cr(t.body,e)]);if(!t.smashHeight&&!t.smashDepth)return n;if(t.smashHeight&&(n.height=0,n.children))for(var r=0;r<n.children.length;r++)n.children[r].height=0;if(t.smashDepth&&(n.depth=0,n.children))for(var s=0;s<n.children.length;s++)n.children[s].depth=0;var c=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n}]},e);return rt.makeSpan(["mord"],[c],e)},mathmlBuilder:(t,e)=>{var n=new Dt.MathNode("mpadded",[Er(t.body,e)]);return t.smashHeight&&n.setAttribute("height","0px"),t.smashDepth&&n.setAttribute("depth","0px"),n}});ln({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(t,e,n){var{parser:r}=t,s=n[0],c=e[0];return{type:"sqrt",mode:r.mode,body:c,index:s}},htmlBuilder(t,e){var n=cr(t.body,e.havingCrampedStyle());n.height===0&&(n.height=e.fontMetrics().xHeight),n=rt.wrapFragment(n,e);var r=e.fontMetrics(),s=r.defaultRuleThickness,c=s;e.style.id<Fn.TEXT.id&&(c=e.fontMetrics().xHeight);var h=s+c/4,l=n.height+n.depth+h+s,{span:m,ruleWidth:_,advanceWidth:S}=ll.sqrtImage(l,e),T=m.height-_;T>n.height+n.depth+h&&(h=(h+T-n.height-n.depth)/2);var M=m.height-n.height-h-_;n.style.paddingLeft=Xt(S);var I=rt.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:n,wrapperClasses:["svg-align"]},{type:"kern",size:-(n.height+M)},{type:"elem",elem:m},{type:"kern",size:_}]},e);if(t.index){var N=e.havingStyle(Fn.SCRIPTSCRIPT),B=cr(t.index,N,e),k=.6*(I.height-I.depth),C=rt.makeVList({positionType:"shift",positionData:-k,children:[{type:"elem",elem:B}]},e),U=rt.makeSpan(["root"],[C]);return rt.makeSpan(["mord","sqrt"],[U,I],e)}else return rt.makeSpan(["mord","sqrt"],[I],e)},mathmlBuilder(t,e){var{body:n,index:r}=t;return r?new Dt.MathNode("mroot",[Er(n,e),Er(r,e)]):new Dt.MathNode("msqrt",[Er(n,e)])}});var qM={display:Fn.DISPLAY,text:Fn.TEXT,script:Fn.SCRIPT,scriptscript:Fn.SCRIPTSCRIPT};ln({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(t,e){var{breakOnTokenText:n,funcName:r,parser:s}=t,c=s.parseExpression(!0,n),h=r.slice(1,r.length-5);return{type:"styling",mode:s.mode,style:h,body:c}},htmlBuilder(t,e){var n=qM[t.style],r=e.havingStyle(n).withFont("");return B8(t.body,r,e)},mathmlBuilder(t,e){var n=qM[t.style],r=e.havingStyle(n),s=Fa(t.body,r),c=new Dt.MathNode("mstyle",s),h={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},l=h[t.style];return c.setAttribute("scriptlevel",l[0]),c.setAttribute("displaystyle",l[1]),c}});var vW=function(e,n){var r=e.base;if(r)if(r.type==="op"){var s=r.limits&&(n.style.size===Fn.DISPLAY.size||r.alwaysHandleSupSub);return s?Qd:null}else if(r.type==="operatorname"){var c=r.alwaysHandleSupSub&&(n.style.size===Fn.DISPLAY.size||r.limits);return c?N8:null}else{if(r.type==="accent")return kn.isCharacterBox(r.base)?cw:null;if(r.type==="horizBrace"){var h=!e.sub;return h===r.isOver?L8:null}else return null}else return null};$u({type:"supsub",htmlBuilder(t,e){var n=vW(t,e);if(n)return n(t,e);var{base:r,sup:s,sub:c}=t,h=cr(r,e),l,m,_=e.fontMetrics(),S=0,T=0,M=r&&kn.isCharacterBox(r);if(s){var I=e.havingStyle(e.style.sup());l=cr(s,I,e),M||(S=h.height-I.fontMetrics().supDrop*I.sizeMultiplier/e.sizeMultiplier)}if(c){var N=e.havingStyle(e.style.sub());m=cr(c,N,e),M||(T=h.depth+N.fontMetrics().subDrop*N.sizeMultiplier/e.sizeMultiplier)}var B;e.style===Fn.DISPLAY?B=_.sup1:e.style.cramped?B=_.sup3:B=_.sup2;var k=e.sizeMultiplier,C=Xt(.5/_.ptPerEm/k),U=null;if(m){var V=t.base&&t.base.type==="op"&&t.base.name&&(t.base.name==="\\oiint"||t.base.name==="\\oiiint");(h instanceof As||V)&&(U=Xt(-h.italic))}var Y;if(l&&m){S=Math.max(S,B,l.depth+.25*_.xHeight),T=Math.max(T,_.sub2);var he=_.defaultRuleThickness,Z=4*he;if(S-l.depth-(m.height-T)<Z){T=Z-(S-l.depth)+m.height;var ne=.8*_.xHeight-(S-l.depth);ne>0&&(S+=ne,T-=ne)}var xe=[{type:"elem",elem:m,shift:T,marginRight:C,marginLeft:U},{type:"elem",elem:l,shift:-S,marginRight:C}];Y=rt.makeVList({positionType:"individualShift",children:xe},e)}else if(m){T=Math.max(T,_.sub1,m.height-.8*_.xHeight);var ie=[{type:"elem",elem:m,marginLeft:U,marginRight:C}];Y=rt.makeVList({positionType:"shift",positionData:T,children:ie},e)}else if(l)S=Math.max(S,B,l.depth+.25*_.xHeight),Y=rt.makeVList({positionType:"shift",positionData:-S,children:[{type:"elem",elem:l,marginRight:C}]},e);else throw new Error("supsub must have either sup or sub.");var J=k2(h,"right")||"mord";return rt.makeSpan([J],[h,rt.makeSpan(["msupsub"],[Y])],e)},mathmlBuilder(t,e){var n=!1,r,s;t.base&&t.base.type==="horizBrace"&&(s=!!t.sup,s===t.base.isOver&&(n=!0,r=t.base.isOver)),t.base&&(t.base.type==="op"||t.base.type==="operatorname")&&(t.base.parentIsSupSub=!0);var c=[Er(t.base,e)];t.sub&&c.push(Er(t.sub,e)),t.sup&&c.push(Er(t.sup,e));var h;if(n)h=r?"mover":"munder";else if(t.sub)if(t.sup){var _=t.base;_&&_.type==="op"&&_.limits&&e.style===Fn.DISPLAY||_&&_.type==="operatorname"&&_.alwaysHandleSupSub&&(e.style===Fn.DISPLAY||_.limits)?h="munderover":h="msubsup"}else{var m=t.base;m&&m.type==="op"&&m.limits&&(e.style===Fn.DISPLAY||m.alwaysHandleSupSub)||m&&m.type==="operatorname"&&m.alwaysHandleSupSub&&(m.limits||e.style===Fn.DISPLAY)?h="munder":h="msub"}else{var l=t.base;l&&l.type==="op"&&l.limits&&(e.style===Fn.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===Fn.DISPLAY)?h="mover":h="msup"}return new Dt.MathNode(h,c)}});$u({type:"atom",htmlBuilder(t,e){return rt.mathsym(t.text,t.mode,e,["m"+t.family])},mathmlBuilder(t,e){var n=new Dt.MathNode("mo",[Cs(t.text,t.mode)]);if(t.family==="bin"){var r=ow(t,e);r==="bold-italic"&&n.setAttribute("mathvariant",r)}else t.family==="punct"?n.setAttribute("separator","true"):(t.family==="open"||t.family==="close")&&n.setAttribute("stretchy","false");return n}});var O8={mi:"italic",mn:"normal",mtext:"normal"};$u({type:"mathord",htmlBuilder(t,e){return rt.makeOrd(t,e,"mathord")},mathmlBuilder(t,e){var n=new Dt.MathNode("mi",[Cs(t.text,t.mode,e)]),r=ow(t,e)||"italic";return r!==O8[n.type]&&n.setAttribute("mathvariant",r),n}});$u({type:"textord",htmlBuilder(t,e){return rt.makeOrd(t,e,"textord")},mathmlBuilder(t,e){var n=Cs(t.text,t.mode,e),r=ow(t,e)||"normal",s;return t.mode==="text"?s=new Dt.MathNode("mtext",[n]):/[0-9]/.test(t.text)?s=new Dt.MathNode("mn",[n]):t.text==="\\prime"?s=new Dt.MathNode("mo",[n]):s=new Dt.MathNode("mi",[n]),r!==O8[s.type]&&s.setAttribute("mathvariant",r),s}});var cx={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},ux={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};$u({type:"spacing",htmlBuilder(t,e){if(ux.hasOwnProperty(t.text)){var n=ux[t.text].className||"";if(t.mode==="text"){var r=rt.makeOrd(t,e,"textord");return r.classes.push(n),r}else return rt.makeSpan(["mspace",n],[rt.mathsym(t.text,t.mode,e)],e)}else{if(cx.hasOwnProperty(t.text))return rt.makeSpan(["mspace",cx[t.text]],[],e);throw new Ot('Unknown type of space "'+t.text+'"')}},mathmlBuilder(t,e){var n;if(ux.hasOwnProperty(t.text))n=new Dt.MathNode("mtext",[new Dt.TextNode(" ")]);else{if(cx.hasOwnProperty(t.text))return new Dt.MathNode("mspace");throw new Ot('Unknown type of space "'+t.text+'"')}return n}});var $M=()=>{var t=new Dt.MathNode("mtd",[]);return t.setAttribute("width","50%"),t};$u({type:"tag",mathmlBuilder(t,e){var n=new Dt.MathNode("mtable",[new Dt.MathNode("mtr",[$M(),new Dt.MathNode("mtd",[Pc(t.body,e)]),$M(),new Dt.MathNode("mtd",[Pc(t.tag,e)])])]);return n.setAttribute("width","100%"),n}});var XM={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},ZM={"\\textbf":"textbf","\\textmd":"textmd"},yW={"\\textit":"textit","\\textup":"textup"},YM=(t,e)=>{var n=t.font;return n?XM[n]?e.withTextFontFamily(XM[n]):ZM[n]?e.withTextFontWeight(ZM[n]):e.withTextFontShape(yW[n]):e};ln({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(t,e){var{parser:n,funcName:r}=t,s=e[0];return{type:"text",mode:n.mode,body:ui(s),font:r}},htmlBuilder(t,e){var n=YM(t,e),r=Mi(t.body,n,!0);return rt.makeSpan(["mord","text"],r,n)},mathmlBuilder(t,e){var n=YM(t,e);return Pc(t.body,n)}});ln({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(t,e){var{parser:n}=t;return{type:"underline",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=cr(t.body,e),r=rt.makeLineSpan("underline-line",e),s=e.fontMetrics().defaultRuleThickness,c=rt.makeVList({positionType:"top",positionData:n.height,children:[{type:"kern",size:s},{type:"elem",elem:r},{type:"kern",size:3*s},{type:"elem",elem:n}]},e);return rt.makeSpan(["mord","underline"],[c],e)},mathmlBuilder(t,e){var n=new Dt.MathNode("mo",[new Dt.TextNode("‾")]);n.setAttribute("stretchy","true");var r=new Dt.MathNode("munder",[Er(t.body,e),n]);return r.setAttribute("accentunder","true"),r}});ln({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(t,e){var{parser:n}=t;return{type:"vcenter",mode:n.mode,body:e[0]}},htmlBuilder(t,e){var n=cr(t.body,e),r=e.fontMetrics().axisHeight,s=.5*(n.height-r-(n.depth+r));return rt.makeVList({positionType:"shift",positionData:s,children:[{type:"elem",elem:n}]},e)},mathmlBuilder(t,e){return new Dt.MathNode("mpadded",[Er(t.body,e)],["vcenter"])}});ln({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(t,e,n){throw new Ot("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(t,e){for(var n=KM(t),r=[],s=e.havingStyle(e.style.text()),c=0;c<n.length;c++){var h=n[c];h==="~"&&(h="\\textasciitilde"),r.push(rt.makeSymbol(h,"Typewriter-Regular",t.mode,s,["mord","texttt"]))}return rt.makeSpan(["mord","text"].concat(s.sizingClasses(e)),rt.tryCombineChars(r),s)},mathmlBuilder(t,e){var n=new Dt.TextNode(KM(t)),r=new Dt.MathNode("mtext",[n]);return r.setAttribute("mathvariant","monospace"),r}});var KM=t=>t.body.replace(/ /g,t.star?"␣":" "),dc=l8,U8=`[ \r
	]`,_W="\\\\[a-zA-Z@]+",xW="\\\\[^\uD800-\uDFFF]",bW="("+_W+")"+U8+"*",wW=`\\\\(
|[ \r	]+
?)[ \r	]*`,N2="[̀-ͯ]",SW=new RegExp(N2+"+$"),MW="("+U8+"+)|"+(wW+"|")+"([!-\\[\\]-‧‪-퟿豈-￿]"+(N2+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(N2+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+bW)+("|"+xW+")");class JM{constructor(e,n){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=n,this.tokenRegex=new RegExp(MW,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,n){this.catcodes[e]=n}lex(){var e=this.input,n=this.tokenRegex.lastIndex;if(n===e.length)return new Ms("EOF",new Ya(this,n,n));var r=this.tokenRegex.exec(e);if(r===null||r.index!==n)throw new Ot("Unexpected character: '"+e[n]+"'",new Ms(e[n],new Ya(this,n,n+1)));var s=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[s]===14){var c=e.indexOf(`
`,this.tokenRegex.lastIndex);return c===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=c+1,this.lex()}return new Ms(s,new Ya(this,n,this.tokenRegex.lastIndex))}}class TW{constructor(e,n){e===void 0&&(e={}),n===void 0&&(n={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=n,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new Ot("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var n in e)e.hasOwnProperty(n)&&(e[n]==null?delete this.current[n]:this.current[n]=e[n])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,n,r){if(r===void 0&&(r=!1),r){for(var s=0;s<this.undefStack.length;s++)delete this.undefStack[s][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=n)}else{var c=this.undefStack[this.undefStack.length-1];c&&!c.hasOwnProperty(e)&&(c[e]=this.current[e])}n==null?delete this.current[e]:this.current[e]=n}}var EW=P8;ce("\\noexpand",function(t){var e=t.popToken();return t.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});ce("\\expandafter",function(t){var e=t.popToken();return t.expandOnce(!0),{tokens:[e],numArgs:0}});ce("\\@firstoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[0],numArgs:0}});ce("\\@secondoftwo",function(t){var e=t.consumeArgs(2);return{tokens:e[1],numArgs:0}});ce("\\@ifnextchar",function(t){var e=t.consumeArgs(3);t.consumeSpaces();var n=t.future();return e[0].length===1&&e[0][0].text===n.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});ce("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");ce("\\TextOrMath",function(t){var e=t.consumeArgs(2);return t.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var QM={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};ce("\\char",function(t){var e=t.popToken(),n,r="";if(e.text==="'")n=8,e=t.popToken();else if(e.text==='"')n=16,e=t.popToken();else if(e.text==="`")if(e=t.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new Ot("\\char` missing argument");r=e.text.charCodeAt(0)}else n=10;if(n){if(r=QM[e.text],r==null||r>=n)throw new Ot("Invalid base-"+n+" digit "+e.text);for(var s;(s=QM[t.future().text])!=null&&s<n;)r*=n,r+=s,t.popToken()}return"\\@char{"+r+"}"});var vw=(t,e,n)=>{var r=t.consumeArg().tokens;if(r.length!==1)throw new Ot("\\newcommand's first argument must be a macro name");var s=r[0].text,c=t.isDefined(s);if(c&&!e)throw new Ot("\\newcommand{"+s+"} attempting to redefine "+(s+"; use \\renewcommand"));if(!c&&!n)throw new Ot("\\renewcommand{"+s+"} when command "+s+" does not yet exist; use \\newcommand");var h=0;if(r=t.consumeArg().tokens,r.length===1&&r[0].text==="["){for(var l="",m=t.expandNextToken();m.text!=="]"&&m.text!=="EOF";)l+=m.text,m=t.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new Ot("Invalid number of arguments: "+l);h=parseInt(l),r=t.consumeArg().tokens}return t.macros.set(s,{tokens:r,numArgs:h}),""};ce("\\newcommand",t=>vw(t,!1,!0));ce("\\renewcommand",t=>vw(t,!0,!1));ce("\\providecommand",t=>vw(t,!0,!0));ce("\\message",t=>{var e=t.consumeArgs(1)[0];return console.log(e.reverse().map(n=>n.text).join("")),""});ce("\\errmessage",t=>{var e=t.consumeArgs(1)[0];return console.error(e.reverse().map(n=>n.text).join("")),""});ce("\\show",t=>{var e=t.popToken(),n=e.text;return console.log(e,t.macros.get(n),dc[n],Pr.math[n],Pr.text[n]),""});ce("\\bgroup","{");ce("\\egroup","}");ce("~","\\nobreakspace");ce("\\lq","`");ce("\\rq","'");ce("\\aa","\\r a");ce("\\AA","\\r A");ce("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`©}");ce("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");ce("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`®}");ce("ℬ","\\mathscr{B}");ce("ℰ","\\mathscr{E}");ce("ℱ","\\mathscr{F}");ce("ℋ","\\mathscr{H}");ce("ℐ","\\mathscr{I}");ce("ℒ","\\mathscr{L}");ce("ℳ","\\mathscr{M}");ce("ℛ","\\mathscr{R}");ce("ℭ","\\mathfrak{C}");ce("ℌ","\\mathfrak{H}");ce("ℨ","\\mathfrak{Z}");ce("\\Bbbk","\\Bbb{k}");ce("·","\\cdotp");ce("\\llap","\\mathllap{\\textrm{#1}}");ce("\\rlap","\\mathrlap{\\textrm{#1}}");ce("\\clap","\\mathclap{\\textrm{#1}}");ce("\\mathstrut","\\vphantom{(}");ce("\\underbar","\\underline{\\text{#1}}");ce("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');ce("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`≠}}");ce("\\ne","\\neq");ce("≠","\\neq");ce("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`∉}}");ce("∉","\\notin");ce("≘","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`≘}}");ce("≙","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`≘}}");ce("≚","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`≚}}");ce("≛","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`≛}}");ce("≝","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`≝}}");ce("≞","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`≞}}");ce("≟","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`≟}}");ce("⟂","\\perp");ce("‼","\\mathclose{!\\mkern-0.8mu!}");ce("∌","\\notni");ce("⌜","\\ulcorner");ce("⌝","\\urcorner");ce("⌞","\\llcorner");ce("⌟","\\lrcorner");ce("©","\\copyright");ce("®","\\textregistered");ce("️","\\textregistered");ce("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');ce("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');ce("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');ce("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');ce("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}");ce("⋮","\\vdots");ce("\\varGamma","\\mathit{\\Gamma}");ce("\\varDelta","\\mathit{\\Delta}");ce("\\varTheta","\\mathit{\\Theta}");ce("\\varLambda","\\mathit{\\Lambda}");ce("\\varXi","\\mathit{\\Xi}");ce("\\varPi","\\mathit{\\Pi}");ce("\\varSigma","\\mathit{\\Sigma}");ce("\\varUpsilon","\\mathit{\\Upsilon}");ce("\\varPhi","\\mathit{\\Phi}");ce("\\varPsi","\\mathit{\\Psi}");ce("\\varOmega","\\mathit{\\Omega}");ce("\\substack","\\begin{subarray}{c}#1\\end{subarray}");ce("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");ce("\\boxed","\\fbox{$\\displaystyle{#1}$}");ce("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");ce("\\implies","\\DOTSB\\;\\Longrightarrow\\;");ce("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var eT={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};ce("\\dots",function(t){var e="\\dotso",n=t.expandAfterFuture().text;return n in eT?e=eT[n]:(n.slice(0,4)==="\\not"||n in Pr.math&&kn.contains(["bin","rel"],Pr.math[n].group))&&(e="\\dotsb"),e});var yw={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};ce("\\dotso",function(t){var e=t.future().text;return e in yw?"\\ldots\\,":"\\ldots"});ce("\\dotsc",function(t){var e=t.future().text;return e in yw&&e!==","?"\\ldots\\,":"\\ldots"});ce("\\cdots",function(t){var e=t.future().text;return e in yw?"\\@cdots\\,":"\\@cdots"});ce("\\dotsb","\\cdots");ce("\\dotsm","\\cdots");ce("\\dotsi","\\!\\cdots");ce("\\dotsx","\\ldots\\,");ce("\\DOTSI","\\relax");ce("\\DOTSB","\\relax");ce("\\DOTSX","\\relax");ce("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");ce("\\,","\\tmspace+{3mu}{.1667em}");ce("\\thinspace","\\,");ce("\\>","\\mskip{4mu}");ce("\\:","\\tmspace+{4mu}{.2222em}");ce("\\medspace","\\:");ce("\\;","\\tmspace+{5mu}{.2777em}");ce("\\thickspace","\\;");ce("\\!","\\tmspace-{3mu}{.1667em}");ce("\\negthinspace","\\!");ce("\\negmedspace","\\tmspace-{4mu}{.2222em}");ce("\\negthickspace","\\tmspace-{5mu}{.277em}");ce("\\enspace","\\kern.5em ");ce("\\enskip","\\hskip.5em\\relax");ce("\\quad","\\hskip1em\\relax");ce("\\qquad","\\hskip2em\\relax");ce("\\tag","\\@ifstar\\tag@literal\\tag@paren");ce("\\tag@paren","\\tag@literal{({#1})}");ce("\\tag@literal",t=>{if(t.macros.get("\\df@tag"))throw new Ot("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});ce("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");ce("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");ce("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");ce("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");ce("\\newline","\\\\\\relax");ce("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var V8=Xt(vo["Main-Regular"][84][1]-.7*vo["Main-Regular"][65][1]);ce("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+V8+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");ce("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+V8+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");ce("\\hspace","\\@ifstar\\@hspacer\\@hspace");ce("\\@hspace","\\hskip #1\\relax");ce("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");ce("\\ordinarycolon",":");ce("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");ce("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');ce("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');ce("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');ce("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');ce("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');ce("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');ce("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');ce("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');ce("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');ce("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');ce("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');ce("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');ce("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');ce("∷","\\dblcolon");ce("∹","\\eqcolon");ce("≔","\\coloneqq");ce("≕","\\eqqcolon");ce("⩴","\\Coloneqq");ce("\\ratio","\\vcentcolon");ce("\\coloncolon","\\dblcolon");ce("\\colonequals","\\coloneqq");ce("\\coloncolonequals","\\Coloneqq");ce("\\equalscolon","\\eqqcolon");ce("\\equalscoloncolon","\\Eqqcolon");ce("\\colonminus","\\coloneq");ce("\\coloncolonminus","\\Coloneq");ce("\\minuscolon","\\eqcolon");ce("\\minuscoloncolon","\\Eqcolon");ce("\\coloncolonapprox","\\Colonapprox");ce("\\coloncolonsim","\\Colonsim");ce("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");ce("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");ce("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");ce("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");ce("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`∌}}");ce("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");ce("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");ce("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");ce("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");ce("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");ce("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");ce("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");ce("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");ce("\\gvertneqq","\\html@mathml{\\@gvertneqq}{≩}");ce("\\lvertneqq","\\html@mathml{\\@lvertneqq}{≨}");ce("\\ngeqq","\\html@mathml{\\@ngeqq}{≱}");ce("\\ngeqslant","\\html@mathml{\\@ngeqslant}{≱}");ce("\\nleqq","\\html@mathml{\\@nleqq}{≰}");ce("\\nleqslant","\\html@mathml{\\@nleqslant}{≰}");ce("\\nshortmid","\\html@mathml{\\@nshortmid}{∤}");ce("\\nshortparallel","\\html@mathml{\\@nshortparallel}{∦}");ce("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{⊈}");ce("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{⊉}");ce("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{⊊}");ce("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{⫋}");ce("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{⊋}");ce("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{⫌}");ce("\\imath","\\html@mathml{\\@imath}{ı}");ce("\\jmath","\\html@mathml{\\@jmath}{ȷ}");ce("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`⟦}}");ce("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`⟧}}");ce("⟦","\\llbracket");ce("⟧","\\rrbracket");ce("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`⦃}}");ce("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`⦄}}");ce("⦃","\\lBrace");ce("⦄","\\rBrace");ce("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`⦵}}");ce("⦵","\\minuso");ce("\\darr","\\downarrow");ce("\\dArr","\\Downarrow");ce("\\Darr","\\Downarrow");ce("\\lang","\\langle");ce("\\rang","\\rangle");ce("\\uarr","\\uparrow");ce("\\uArr","\\Uparrow");ce("\\Uarr","\\Uparrow");ce("\\N","\\mathbb{N}");ce("\\R","\\mathbb{R}");ce("\\Z","\\mathbb{Z}");ce("\\alef","\\aleph");ce("\\alefsym","\\aleph");ce("\\Alpha","\\mathrm{A}");ce("\\Beta","\\mathrm{B}");ce("\\bull","\\bullet");ce("\\Chi","\\mathrm{X}");ce("\\clubs","\\clubsuit");ce("\\cnums","\\mathbb{C}");ce("\\Complex","\\mathbb{C}");ce("\\Dagger","\\ddagger");ce("\\diamonds","\\diamondsuit");ce("\\empty","\\emptyset");ce("\\Epsilon","\\mathrm{E}");ce("\\Eta","\\mathrm{H}");ce("\\exist","\\exists");ce("\\harr","\\leftrightarrow");ce("\\hArr","\\Leftrightarrow");ce("\\Harr","\\Leftrightarrow");ce("\\hearts","\\heartsuit");ce("\\image","\\Im");ce("\\infin","\\infty");ce("\\Iota","\\mathrm{I}");ce("\\isin","\\in");ce("\\Kappa","\\mathrm{K}");ce("\\larr","\\leftarrow");ce("\\lArr","\\Leftarrow");ce("\\Larr","\\Leftarrow");ce("\\lrarr","\\leftrightarrow");ce("\\lrArr","\\Leftrightarrow");ce("\\Lrarr","\\Leftrightarrow");ce("\\Mu","\\mathrm{M}");ce("\\natnums","\\mathbb{N}");ce("\\Nu","\\mathrm{N}");ce("\\Omicron","\\mathrm{O}");ce("\\plusmn","\\pm");ce("\\rarr","\\rightarrow");ce("\\rArr","\\Rightarrow");ce("\\Rarr","\\Rightarrow");ce("\\real","\\Re");ce("\\reals","\\mathbb{R}");ce("\\Reals","\\mathbb{R}");ce("\\Rho","\\mathrm{P}");ce("\\sdot","\\cdot");ce("\\sect","\\S");ce("\\spades","\\spadesuit");ce("\\sub","\\subset");ce("\\sube","\\subseteq");ce("\\supe","\\supseteq");ce("\\Tau","\\mathrm{T}");ce("\\thetasym","\\vartheta");ce("\\weierp","\\wp");ce("\\Zeta","\\mathrm{Z}");ce("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");ce("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");ce("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");ce("\\bra","\\mathinner{\\langle{#1}|}");ce("\\ket","\\mathinner{|{#1}\\rangle}");ce("\\braket","\\mathinner{\\langle{#1}\\rangle}");ce("\\Bra","\\left\\langle#1\\right|");ce("\\Ket","\\left|#1\\right\\rangle");var H8=t=>e=>{var n=e.consumeArg().tokens,r=e.consumeArg().tokens,s=e.consumeArg().tokens,c=e.consumeArg().tokens,h=e.macros.get("|"),l=e.macros.get("\\|");e.macros.beginGroup();var m=T=>M=>{t&&(M.macros.set("|",h),s.length&&M.macros.set("\\|",l));var I=T;if(!T&&s.length){var N=M.future();N.text==="|"&&(M.popToken(),I=!0)}return{tokens:I?s:r,numArgs:0}};e.macros.set("|",m(!1)),s.length&&e.macros.set("\\|",m(!0));var _=e.consumeArg().tokens,S=e.expandTokens([...c,..._,...n]);return e.macros.endGroup(),{tokens:S.reverse(),numArgs:0}};ce("\\bra@ket",H8(!1));ce("\\bra@set",H8(!0));ce("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");ce("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");ce("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");ce("\\angln","{\\angl n}");ce("\\blue","\\textcolor{##6495ed}{#1}");ce("\\orange","\\textcolor{##ffa500}{#1}");ce("\\pink","\\textcolor{##ff00af}{#1}");ce("\\red","\\textcolor{##df0030}{#1}");ce("\\green","\\textcolor{##28ae7b}{#1}");ce("\\gray","\\textcolor{gray}{#1}");ce("\\purple","\\textcolor{##9d38bd}{#1}");ce("\\blueA","\\textcolor{##ccfaff}{#1}");ce("\\blueB","\\textcolor{##80f6ff}{#1}");ce("\\blueC","\\textcolor{##63d9ea}{#1}");ce("\\blueD","\\textcolor{##11accd}{#1}");ce("\\blueE","\\textcolor{##0c7f99}{#1}");ce("\\tealA","\\textcolor{##94fff5}{#1}");ce("\\tealB","\\textcolor{##26edd5}{#1}");ce("\\tealC","\\textcolor{##01d1c1}{#1}");ce("\\tealD","\\textcolor{##01a995}{#1}");ce("\\tealE","\\textcolor{##208170}{#1}");ce("\\greenA","\\textcolor{##b6ffb0}{#1}");ce("\\greenB","\\textcolor{##8af281}{#1}");ce("\\greenC","\\textcolor{##74cf70}{#1}");ce("\\greenD","\\textcolor{##1fab54}{#1}");ce("\\greenE","\\textcolor{##0d923f}{#1}");ce("\\goldA","\\textcolor{##ffd0a9}{#1}");ce("\\goldB","\\textcolor{##ffbb71}{#1}");ce("\\goldC","\\textcolor{##ff9c39}{#1}");ce("\\goldD","\\textcolor{##e07d10}{#1}");ce("\\goldE","\\textcolor{##a75a05}{#1}");ce("\\redA","\\textcolor{##fca9a9}{#1}");ce("\\redB","\\textcolor{##ff8482}{#1}");ce("\\redC","\\textcolor{##f9685d}{#1}");ce("\\redD","\\textcolor{##e84d39}{#1}");ce("\\redE","\\textcolor{##bc2612}{#1}");ce("\\maroonA","\\textcolor{##ffbde0}{#1}");ce("\\maroonB","\\textcolor{##ff92c6}{#1}");ce("\\maroonC","\\textcolor{##ed5fa6}{#1}");ce("\\maroonD","\\textcolor{##ca337c}{#1}");ce("\\maroonE","\\textcolor{##9e034e}{#1}");ce("\\purpleA","\\textcolor{##ddd7ff}{#1}");ce("\\purpleB","\\textcolor{##c6b9fc}{#1}");ce("\\purpleC","\\textcolor{##aa87ff}{#1}");ce("\\purpleD","\\textcolor{##7854ab}{#1}");ce("\\purpleE","\\textcolor{##543b78}{#1}");ce("\\mintA","\\textcolor{##f5f9e8}{#1}");ce("\\mintB","\\textcolor{##edf2df}{#1}");ce("\\mintC","\\textcolor{##e0e5cc}{#1}");ce("\\grayA","\\textcolor{##f6f7f7}{#1}");ce("\\grayB","\\textcolor{##f0f1f2}{#1}");ce("\\grayC","\\textcolor{##e3e5e6}{#1}");ce("\\grayD","\\textcolor{##d6d8da}{#1}");ce("\\grayE","\\textcolor{##babec2}{#1}");ce("\\grayF","\\textcolor{##888d93}{#1}");ce("\\grayG","\\textcolor{##626569}{#1}");ce("\\grayH","\\textcolor{##3b3e40}{#1}");ce("\\grayI","\\textcolor{##21242c}{#1}");ce("\\kaBlue","\\textcolor{##314453}{#1}");ce("\\kaGreen","\\textcolor{##71B307}{#1}");var G8={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class AW{constructor(e,n,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=n,this.expansionCount=0,this.feed(e),this.macros=new TW(EW,n.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new JM(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var n,r,s;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;n=this.popToken(),{tokens:s,end:r}=this.consumeArg(["]"])}else({tokens:s,start:n,end:r}=this.consumeArg());return this.pushToken(new Ms("EOF",r.loc)),this.pushTokens(s),n.range(r,"")}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var n=[],r=e&&e.length>0;r||this.consumeSpaces();var s=this.future(),c,h=0,l=0;do{if(c=this.popToken(),n.push(c),c.text==="{")++h;else if(c.text==="}"){if(--h,h===-1)throw new Ot("Extra }",c)}else if(c.text==="EOF")throw new Ot("Unexpected end of input in a macro argument, expected '"+(e&&r?e[l]:"}")+"'",c);if(e&&r)if((h===0||h===1&&e[l]==="{")&&c.text===e[l]){if(++l,l===e.length){n.splice(-l,l);break}}else l=0}while(h!==0||r);return s.text==="{"&&n[n.length-1].text==="}"&&(n.pop(),n.shift()),n.reverse(),{tokens:n,start:s,end:c}}consumeArgs(e,n){if(n){if(n.length!==e+1)throw new Ot("The length of delimiters doesn't match the number of args!");for(var r=n[0],s=0;s<r.length;s++){var c=this.popToken();if(r[s]!==c.text)throw new Ot("Use of the macro doesn't match its definition",c)}}for(var h=[],l=0;l<e;l++)h.push(this.consumeArg(n&&n[l+1]).tokens);return h}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new Ot("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var n=this.popToken(),r=n.text,s=n.noexpand?null:this._getExpansion(r);if(s==null||e&&s.unexpandable){if(e&&s==null&&r[0]==="\\"&&!this.isDefined(r))throw new Ot("Undefined control sequence: "+r);return this.pushToken(n),!1}this.countExpansion(1);var c=s.tokens,h=this.consumeArgs(s.numArgs,s.delimiters);if(s.numArgs){c=c.slice();for(var l=c.length-1;l>=0;--l){var m=c[l];if(m.text==="#"){if(l===0)throw new Ot("Incomplete placeholder at end of macro body",m);if(m=c[--l],m.text==="#")c.splice(l+1,1);else if(/^[1-9]$/.test(m.text))c.splice(l,2,...h[+m.text-1]);else throw new Ot("Not a valid argument number",m)}}}return this.pushTokens(c),c.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new Ms(e)]):void 0}expandTokens(e){var n=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;)if(this.expandOnce(!0)===!1){var s=this.stack.pop();s.treatAsRelax&&(s.noexpand=!1,s.treatAsRelax=!1),n.push(s)}return this.countExpansion(n.length),n}expandMacroAsText(e){var n=this.expandMacro(e);return n&&n.map(r=>r.text).join("")}_getExpansion(e){var n=this.macros.get(e);if(n==null)return n;if(e.length===1){var r=this.lexer.catcodes[e];if(r!=null&&r!==13)return}var s=typeof n=="function"?n(this):n;if(typeof s=="string"){var c=0;if(s.indexOf("#")!==-1)for(var h=s.replace(/##/g,"");h.indexOf("#"+(c+1))!==-1;)++c;for(var l=new JM(s,this.settings),m=[],_=l.lex();_.text!=="EOF";)m.push(_),_=l.lex();m.reverse();var S={tokens:m,numArgs:c};return S}return s}isDefined(e){return this.macros.has(e)||dc.hasOwnProperty(e)||Pr.math.hasOwnProperty(e)||Pr.text.hasOwnProperty(e)||G8.hasOwnProperty(e)}isExpandable(e){var n=this.macros.get(e);return n!=null?typeof n=="string"||typeof n=="function"||!n.unexpandable:dc.hasOwnProperty(e)&&!dc[e].primitive}}var tT=/^[₊₋₌₍₎₀₁₂₃₄₅₆₇₈₉ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓᵦᵧᵨᵩᵪ]/,Wg=Object.freeze({"₊":"+","₋":"-","₌":"=","₍":"(","₎":")","₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9","ₐ":"a","ₑ":"e","ₕ":"h","ᵢ":"i","ⱼ":"j","ₖ":"k","ₗ":"l","ₘ":"m","ₙ":"n","ₒ":"o","ₚ":"p","ᵣ":"r","ₛ":"s","ₜ":"t","ᵤ":"u","ᵥ":"v","ₓ":"x","ᵦ":"β","ᵧ":"γ","ᵨ":"ρ","ᵩ":"ϕ","ᵪ":"χ","⁺":"+","⁻":"-","⁼":"=","⁽":"(","⁾":")","⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","ᴬ":"A","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ⱽ":"V","ᵂ":"W","ᵃ":"a","ᵇ":"b","ᶜ":"c","ᵈ":"d","ᵉ":"e","ᶠ":"f","ᵍ":"g",ʰ:"h","ⁱ":"i",ʲ:"j","ᵏ":"k",ˡ:"l","ᵐ":"m",ⁿ:"n","ᵒ":"o","ᵖ":"p",ʳ:"r",ˢ:"s","ᵗ":"t","ᵘ":"u","ᵛ":"v",ʷ:"w",ˣ:"x",ʸ:"y","ᶻ":"z","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"ϕ","ᵡ":"χ","ᶿ":"θ"}),hx={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"},"̧":{text:"\\c"}},nT={á:"á",à:"à",ä:"ä",ǟ:"ǟ",ã:"ã",ā:"ā",ă:"ă",ắ:"ắ",ằ:"ằ",ẵ:"ẵ",ǎ:"ǎ",â:"â",ấ:"ấ",ầ:"ầ",ẫ:"ẫ",ȧ:"ȧ",ǡ:"ǡ",å:"å",ǻ:"ǻ",ḃ:"ḃ",ć:"ć",ḉ:"ḉ",č:"č",ĉ:"ĉ",ċ:"ċ",ç:"ç",ď:"ď",ḋ:"ḋ",ḑ:"ḑ",é:"é",è:"è",ë:"ë",ẽ:"ẽ",ē:"ē",ḗ:"ḗ",ḕ:"ḕ",ĕ:"ĕ",ḝ:"ḝ",ě:"ě",ê:"ê",ế:"ế",ề:"ề",ễ:"ễ",ė:"ė",ȩ:"ȩ",ḟ:"ḟ",ǵ:"ǵ",ḡ:"ḡ",ğ:"ğ",ǧ:"ǧ",ĝ:"ĝ",ġ:"ġ",ģ:"ģ",ḧ:"ḧ",ȟ:"ȟ",ĥ:"ĥ",ḣ:"ḣ",ḩ:"ḩ",í:"í",ì:"ì",ï:"ï",ḯ:"ḯ",ĩ:"ĩ",ī:"ī",ĭ:"ĭ",ǐ:"ǐ",î:"î",ǰ:"ǰ",ĵ:"ĵ",ḱ:"ḱ",ǩ:"ǩ",ķ:"ķ",ĺ:"ĺ",ľ:"ľ",ļ:"ļ",ḿ:"ḿ",ṁ:"ṁ",ń:"ń",ǹ:"ǹ",ñ:"ñ",ň:"ň",ṅ:"ṅ",ņ:"ņ",ó:"ó",ò:"ò",ö:"ö",ȫ:"ȫ",õ:"õ",ṍ:"ṍ",ṏ:"ṏ",ȭ:"ȭ",ō:"ō",ṓ:"ṓ",ṑ:"ṑ",ŏ:"ŏ",ǒ:"ǒ",ô:"ô",ố:"ố",ồ:"ồ",ỗ:"ỗ",ȯ:"ȯ",ȱ:"ȱ",ő:"ő",ṕ:"ṕ",ṗ:"ṗ",ŕ:"ŕ",ř:"ř",ṙ:"ṙ",ŗ:"ŗ",ś:"ś",ṥ:"ṥ",š:"š",ṧ:"ṧ",ŝ:"ŝ",ṡ:"ṡ",ş:"ş",ẗ:"ẗ",ť:"ť",ṫ:"ṫ",ţ:"ţ",ú:"ú",ù:"ù",ü:"ü",ǘ:"ǘ",ǜ:"ǜ",ǖ:"ǖ",ǚ:"ǚ",ũ:"ũ",ṹ:"ṹ",ū:"ū",ṻ:"ṻ",ŭ:"ŭ",ǔ:"ǔ",û:"û",ů:"ů",ű:"ű",ṽ:"ṽ",ẃ:"ẃ",ẁ:"ẁ",ẅ:"ẅ",ŵ:"ŵ",ẇ:"ẇ",ẘ:"ẘ",ẍ:"ẍ",ẋ:"ẋ",ý:"ý",ỳ:"ỳ",ÿ:"ÿ",ỹ:"ỹ",ȳ:"ȳ",ŷ:"ŷ",ẏ:"ẏ",ẙ:"ẙ",ź:"ź",ž:"ž",ẑ:"ẑ",ż:"ż",Á:"Á",À:"À",Ä:"Ä",Ǟ:"Ǟ",Ã:"Ã",Ā:"Ā",Ă:"Ă",Ắ:"Ắ",Ằ:"Ằ",Ẵ:"Ẵ",Ǎ:"Ǎ",Â:"Â",Ấ:"Ấ",Ầ:"Ầ",Ẫ:"Ẫ",Ȧ:"Ȧ",Ǡ:"Ǡ",Å:"Å",Ǻ:"Ǻ",Ḃ:"Ḃ",Ć:"Ć",Ḉ:"Ḉ",Č:"Č",Ĉ:"Ĉ",Ċ:"Ċ",Ç:"Ç",Ď:"Ď",Ḋ:"Ḋ",Ḑ:"Ḑ",É:"É",È:"È",Ë:"Ë",Ẽ:"Ẽ",Ē:"Ē",Ḗ:"Ḗ",Ḕ:"Ḕ",Ĕ:"Ĕ",Ḝ:"Ḝ",Ě:"Ě",Ê:"Ê",Ế:"Ế",Ề:"Ề",Ễ:"Ễ",Ė:"Ė",Ȩ:"Ȩ",Ḟ:"Ḟ",Ǵ:"Ǵ",Ḡ:"Ḡ",Ğ:"Ğ",Ǧ:"Ǧ",Ĝ:"Ĝ",Ġ:"Ġ",Ģ:"Ģ",Ḧ:"Ḧ",Ȟ:"Ȟ",Ĥ:"Ĥ",Ḣ:"Ḣ",Ḩ:"Ḩ",Í:"Í",Ì:"Ì",Ï:"Ï",Ḯ:"Ḯ",Ĩ:"Ĩ",Ī:"Ī",Ĭ:"Ĭ",Ǐ:"Ǐ",Î:"Î",İ:"İ",Ĵ:"Ĵ",Ḱ:"Ḱ",Ǩ:"Ǩ",Ķ:"Ķ",Ĺ:"Ĺ",Ľ:"Ľ",Ļ:"Ļ",Ḿ:"Ḿ",Ṁ:"Ṁ",Ń:"Ń",Ǹ:"Ǹ",Ñ:"Ñ",Ň:"Ň",Ṅ:"Ṅ",Ņ:"Ņ",Ó:"Ó",Ò:"Ò",Ö:"Ö",Ȫ:"Ȫ",Õ:"Õ",Ṍ:"Ṍ",Ṏ:"Ṏ",Ȭ:"Ȭ",Ō:"Ō",Ṓ:"Ṓ",Ṑ:"Ṑ",Ŏ:"Ŏ",Ǒ:"Ǒ",Ô:"Ô",Ố:"Ố",Ồ:"Ồ",Ỗ:"Ỗ",Ȯ:"Ȯ",Ȱ:"Ȱ",Ő:"Ő",Ṕ:"Ṕ",Ṗ:"Ṗ",Ŕ:"Ŕ",Ř:"Ř",Ṙ:"Ṙ",Ŗ:"Ŗ",Ś:"Ś",Ṥ:"Ṥ",Š:"Š",Ṧ:"Ṧ",Ŝ:"Ŝ",Ṡ:"Ṡ",Ş:"Ş",Ť:"Ť",Ṫ:"Ṫ",Ţ:"Ţ",Ú:"Ú",Ù:"Ù",Ü:"Ü",Ǘ:"Ǘ",Ǜ:"Ǜ",Ǖ:"Ǖ",Ǚ:"Ǚ",Ũ:"Ũ",Ṹ:"Ṹ",Ū:"Ū",Ṻ:"Ṻ",Ŭ:"Ŭ",Ǔ:"Ǔ",Û:"Û",Ů:"Ů",Ű:"Ű",Ṽ:"Ṽ",Ẃ:"Ẃ",Ẁ:"Ẁ",Ẅ:"Ẅ",Ŵ:"Ŵ",Ẇ:"Ẇ",Ẍ:"Ẍ",Ẋ:"Ẋ",Ý:"Ý",Ỳ:"Ỳ",Ÿ:"Ÿ",Ỹ:"Ỹ",Ȳ:"Ȳ",Ŷ:"Ŷ",Ẏ:"Ẏ",Ź:"Ź",Ž:"Ž",Ẑ:"Ẑ",Ż:"Ż",ά:"ά",ὰ:"ὰ",ᾱ:"ᾱ",ᾰ:"ᾰ",έ:"έ",ὲ:"ὲ",ή:"ή",ὴ:"ὴ",ί:"ί",ὶ:"ὶ",ϊ:"ϊ",ΐ:"ΐ",ῒ:"ῒ",ῑ:"ῑ",ῐ:"ῐ",ό:"ό",ὸ:"ὸ",ύ:"ύ",ὺ:"ὺ",ϋ:"ϋ",ΰ:"ΰ",ῢ:"ῢ",ῡ:"ῡ",ῠ:"ῠ",ώ:"ώ",ὼ:"ὼ",Ύ:"Ύ",Ὺ:"Ὺ",Ϋ:"Ϋ",Ῡ:"Ῡ",Ῠ:"Ῠ",Ώ:"Ώ",Ὼ:"Ὼ"};class Ov{constructor(e,n){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new AW(e,n,this.mode),this.settings=n,this.leftrightDepth=0}expect(e,n){if(n===void 0&&(n=!0),this.fetch().text!==e)throw new Ot("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());n&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var n=this.nextToken;this.consume(),this.gullet.pushToken(new Ms("}")),this.gullet.pushTokens(e);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=n,r}parseExpression(e,n){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var s=this.fetch();if(Ov.endOfExpression.indexOf(s.text)!==-1||n&&s.text===n||e&&dc[s.text]&&dc[s.text].infix)break;var c=this.parseAtom(n);if(c){if(c.type==="internal")continue}else break;r.push(c)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(e){for(var n=-1,r,s=0;s<e.length;s++)if(e[s].type==="infix"){if(n!==-1)throw new Ot("only one infix operator per group",e[s].token);n=s,r=e[s].replaceWith}if(n!==-1&&r){var c,h,l=e.slice(0,n),m=e.slice(n+1);l.length===1&&l[0].type==="ordgroup"?c=l[0]:c={type:"ordgroup",mode:this.mode,body:l},m.length===1&&m[0].type==="ordgroup"?h=m[0]:h={type:"ordgroup",mode:this.mode,body:m};var _;return r==="\\\\abovefrac"?_=this.callFunction(r,[c,e[n],h],[]):_=this.callFunction(r,[c,h],[]),[_]}else return e}handleSupSubscript(e){var n=this.fetch(),r=n.text;this.consume(),this.consumeSpaces();var s=this.parseGroup(e);if(!s)throw new Ot("Expected group after '"+r+"'",n);return s}formatUnsupportedCmd(e){for(var n=[],r=0;r<e.length;r++)n.push({type:"textord",mode:"text",text:e[r]});var s={type:"text",mode:this.mode,body:n},c={type:"color",mode:this.mode,color:this.settings.errorColor,body:[s]};return c}parseAtom(e){var n=this.parseGroup("atom",e);if(this.mode==="text")return n;for(var r,s;;){this.consumeSpaces();var c=this.fetch();if(c.text==="\\limits"||c.text==="\\nolimits"){if(n&&n.type==="op"){var h=c.text==="\\limits";n.limits=h,n.alwaysHandleSupSub=!0}else if(n&&n.type==="operatorname")n.alwaysHandleSupSub&&(n.limits=c.text==="\\limits");else throw new Ot("Limit controls must follow a math operator",c);this.consume()}else if(c.text==="^"){if(r)throw new Ot("Double superscript",c);r=this.handleSupSubscript("superscript")}else if(c.text==="_"){if(s)throw new Ot("Double subscript",c);s=this.handleSupSubscript("subscript")}else if(c.text==="'"){if(r)throw new Ot("Double superscript",c);var l={type:"textord",mode:this.mode,text:"\\prime"},m=[l];for(this.consume();this.fetch().text==="'";)m.push(l),this.consume();this.fetch().text==="^"&&m.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:m}}else if(Wg[c.text]){var _=tT.test(c.text),S=[];for(S.push(new Ms(Wg[c.text])),this.consume();;){var T=this.fetch().text;if(!Wg[T]||tT.test(T)!==_)break;S.unshift(new Ms(Wg[T])),this.consume()}var M=this.subparse(S);_?s={type:"ordgroup",mode:"math",body:M}:r={type:"ordgroup",mode:"math",body:M}}else break}return r||s?{type:"supsub",mode:this.mode,base:n,sup:r,sub:s}:n}parseFunction(e,n){var r=this.fetch(),s=r.text,c=dc[s];if(!c)return null;if(this.consume(),n&&n!=="atom"&&!c.allowedInArgument)throw new Ot("Got function '"+s+"' with no arguments"+(n?" as "+n:""),r);if(this.mode==="text"&&!c.allowedInText)throw new Ot("Can't use function '"+s+"' in text mode",r);if(this.mode==="math"&&c.allowedInMath===!1)throw new Ot("Can't use function '"+s+"' in math mode",r);var{args:h,optArgs:l}=this.parseArguments(s,c);return this.callFunction(s,h,l,r,e)}callFunction(e,n,r,s,c){var h={funcName:e,parser:this,token:s,breakOnTokenText:c},l=dc[e];if(l&&l.handler)return l.handler(h,n,r);throw new Ot("No function handler for "+e)}parseArguments(e,n){var r=n.numArgs+n.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var s=[],c=[],h=0;h<r;h++){var l=n.argTypes&&n.argTypes[h],m=h<n.numOptionalArgs;(n.primitive&&l==null||n.type==="sqrt"&&h===1&&c[0]==null)&&(l="primitive");var _=this.parseGroupOfType("argument to '"+e+"'",l,m);if(m)c.push(_);else if(_!=null)s.push(_);else throw new Ot("Null argument, please report this as a bug")}return{args:s,optArgs:c}}parseGroupOfType(e,n,r){switch(n){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,n);case"hbox":{var s=this.parseArgumentGroup(r,"text");return s!=null?{type:"styling",mode:s.mode,body:[s],style:"text"}:null}case"raw":{var c=this.parseStringGroup("raw",r);return c!=null?{type:"raw",mode:"text",string:c.text}:null}case"primitive":{if(r)throw new Ot("A primitive argument cannot be optional");var h=this.parseGroup(e);if(h==null)throw new Ot("Expected group as "+e,this.fetch());return h}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new Ot("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,n){var r=this.gullet.scanArgument(n);if(r==null)return null;for(var s="",c;(c=this.fetch()).text!=="EOF";)s+=c.text,this.consume();return this.consume(),r.text=s,r}parseRegexGroup(e,n){for(var r=this.fetch(),s=r,c="",h;(h=this.fetch()).text!=="EOF"&&e.test(c+h.text);)s=h,c+=s.text,this.consume();if(c==="")throw new Ot("Invalid "+n+": '"+r.text+"'",r);return r.range(s,c)}parseColorGroup(e){var n=this.parseStringGroup("color",e);if(n==null)return null;var r=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(n.text);if(!r)throw new Ot("Invalid color: '"+n.text+"'",n);var s=r[0];return/^[0-9a-f]{6}$/i.test(s)&&(s="#"+s),{type:"color-token",mode:this.mode,color:s}}parseSizeGroup(e){var n,r=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?n=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):n=this.parseStringGroup("size",e),!n)return null;!e&&n.text.length===0&&(n.text="0pt",r=!0);var s=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(n.text);if(!s)throw new Ot("Invalid size: '"+n.text+"'",n);var c={number:+(s[1]+s[2]),unit:s[3]};if(!QA(c))throw new Ot("Invalid unit: '"+c.unit+"'",n);return{type:"size",mode:this.mode,value:c,isBlank:r}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var n=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),n==null)return null;var r=n.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,n){var r=this.gullet.scanArgument(e);if(r==null)return null;var s=this.mode;n&&this.switchMode(n),this.gullet.beginGroup();var c=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var h={type:"ordgroup",mode:this.mode,loc:r.loc,body:c};return n&&this.switchMode(s),h}parseGroup(e,n){var r=this.fetch(),s=r.text,c;if(s==="{"||s==="\\begingroup"){this.consume();var h=s==="{"?"}":"\\endgroup";this.gullet.beginGroup();var l=this.parseExpression(!1,h),m=this.fetch();this.expect(h),this.gullet.endGroup(),c={type:"ordgroup",mode:this.mode,loc:Ya.range(r,m),body:l,semisimple:s==="\\begingroup"||void 0}}else if(c=this.parseFunction(n,e)||this.parseSymbol(),c==null&&s[0]==="\\"&&!G8.hasOwnProperty(s)){if(this.settings.throwOnError)throw new Ot("Undefined control sequence: "+s,r);c=this.formatUnsupportedCmd(s),this.consume()}return c}formLigatures(e){for(var n=e.length-1,r=0;r<n;++r){var s=e[r],c=s.text;c==="-"&&e[r+1].text==="-"&&(r+1<n&&e[r+2].text==="-"?(e.splice(r,3,{type:"textord",mode:"text",loc:Ya.range(s,e[r+2]),text:"---"}),n-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:Ya.range(s,e[r+1]),text:"--"}),n-=1)),(c==="'"||c==="`")&&e[r+1].text===c&&(e.splice(r,2,{type:"textord",mode:"text",loc:Ya.range(s,e[r+1]),text:c+c}),n-=1)}}parseSymbol(){var e=this.fetch(),n=e.text;if(/^\\verb[^a-zA-Z]/.test(n)){this.consume();var r=n.slice(5),s=r.charAt(0)==="*";if(s&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new Ot(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:s}}nT.hasOwnProperty(n[0])&&!Pr[this.mode][n[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+n[0]+'" used in math mode',e),n=nT[n[0]]+n.slice(1));var c=SW.exec(n);c&&(n=n.substring(0,c.index),n==="i"?n="ı":n==="j"&&(n="ȷ"));var h;if(Pr[this.mode][n]){this.settings.strict&&this.mode==="math"&&D2.indexOf(n)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+n[0]+'" used in math mode',e);var l=Pr[this.mode][n].group,m=Ya.range(e),_;if(mj.hasOwnProperty(l)){var S=l;_={type:"atom",mode:this.mode,family:S,loc:m,text:n}}else _={type:l,mode:this.mode,loc:m,text:n};h=_}else if(n.charCodeAt(0)>=128)this.settings.strict&&(JA(n.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+n[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+n[0]+'"'+(" ("+n.charCodeAt(0)+")"),e)),h={type:"textord",mode:"text",loc:Ya.range(e),text:n};else return null;if(this.consume(),c)for(var T=0;T<c[0].length;T++){var M=c[0][T];if(!hx[M])throw new Ot("Unknown accent ' "+M+"'",e);var I=hx[M][this.mode]||hx[M].text;if(!I)throw new Ot("Accent "+M+" unsupported in "+this.mode+" mode",e);h={type:"accent",mode:this.mode,loc:Ya.range(e),label:I,isStretchy:!1,isShifty:!0,base:h}}return h}}Ov.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var _w=function(e,n){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new Ov(e,n);delete r.gullet.macros.current["\\df@tag"];var s=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!n.displayMode)throw new Ot("\\tag works only in display equations");s=[{type:"tag",mode:"text",body:s,tag:r.subparse([new Ms("\\df@tag")])}]}return s},j8=function(e,n,r){n.textContent="";var s=xw(e,r).toNode();n.appendChild(s)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),j8=function(){throw new Ot("KaTeX doesn't work in quirks mode.")});var CW=function(e,n){var r=xw(e,n).toMarkup();return r},PW=function(e,n){var r=new tw(n);return _w(e,r)},W8=function(e,n,r){if(r.throwOnError||!(e instanceof Ot))throw e;var s=rt.makeSpan(["katex-error"],[new As(n)]);return s.setAttribute("title",e.toString()),s.setAttribute("style","color:"+r.errorColor),s},xw=function(e,n){var r=new tw(n);try{var s=_w(e,r);return Bj(s,e,r)}catch(c){return W8(c,e,r)}},RW=function(e,n){var r=new tw(n);try{var s=_w(e,r);return Oj(s,e,r)}catch(c){return W8(c,e,r)}},q8={version:"0.16.10",render:j8,renderToString:CW,ParseError:Ot,SETTINGS_SCHEMA:c1,__parse:PW,__renderToDomTree:xw,__renderToHTMLTree:RW,__setFontMetrics:lj,__defineSymbol:z,__defineFunction:ln,__defineMacro:ce,__domTree:{Span:Up,Anchor:iw,SymbolNode:As,SvgNode:gl,PathNode:Cc,LineNode:I2}};function IW(t,e,n,r){const s=t.node().width.baseVal.value,c=t.node().height.baseVal.value,h=wp().domain([0,1]).range([0,s]),l=wp().domain([0,1]).range([c,0]),m=M=>e.nodes.find(I=>I.id===M),_=J1().duration(n).ease(wM),S=t.selectAll("line.edge").data(e.edges,M=>M.id1+" "+M.id2);S.enter().append("line").attr("class","edge").attr("x1",M=>h(m(M.id1).x)).attr("y1",M=>l(m(M.id1).y)).attr("x2",M=>h(m(M.id2).x)).attr("y2",M=>l(m(M.id2).y)).attr("stroke-width",0).transition(_).attr("stroke-width",1).attr("stroke",r),S.transition(_).attr("x1",M=>h(m(M.id1).x)).attr("y1",M=>l(m(M.id1).y)).attr("x2",M=>h(m(M.id2).x)).attr("y2",M=>l(m(M.id2).y)),S.exit().transition(J1().duration(150).ease(wM)).remove();const T=t.selectAll("circle.node").data(e.nodes,M=>M.id);T.enter().append("circle").attr("class","node").attr("fill",r).attr("cx",M=>h(M.x)).attr("cy",M=>l(M.y)).attr("r",0).transition(_).attr("r",5),T.transition(_).attr("cx",M=>h(M.x)).attr("cy",M=>l(M.y)),T.exit().transition(_).remove()}function $8(t,e){const n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)}function DW(t,e,n){const r={nodes:[],edges:[]};for(let s=0;s<t;s++)r.nodes.push({id:s,x:Math.random(),y:Math.random()});for(const s of r.nodes)for(const c of r.nodes){if(s.id===c.id)continue;const h=$8(s,c);e<h&&h<n&&r.edges.push({id1:s.id,id2:c.id})}return r}class kW{constructor(){ht(this,"t");ht(this,"a");ht(this,"b");ht(this,"sa");ht(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const n=this.sa*Math.sin(this.a*this.t),r=this.sb*Math.sin(this.b*this.t),s=.5+n,c=.5+r;return{x:s,y:c}}}function LW(t,e,n,r,s){for(let c=0;c<t.nodes.length;c++){const h=t.nodes[c],l=e[c],{x:m,y:_}=l.advance(n);h.x=m,h.y=_}t.edges=[];for(let c=0;c<t.nodes.length;c++)for(let h=c+1;h<t.nodes.length;h++){const l=t.nodes[c],m=t.nodes[h],_=$8(l,m);r<_&&_<s&&t.edges.push({id1:l.id,id2:m.id})}return t}let zW=class{constructor(e="rgba(10, 10, 10, 0.125)",n=50,r=.15,s=.18,c=1e3,h=.02){ht(this,"paths",[]);ht(this,"graph");ht(this,"svg");ht(this,"handle");this.color=e,this.N=n,this.dMin=r,this.dMax=s,this.loopTime=c,this.dt=h}setContainer(e){const n=e.getBoundingClientRect(),s=UA(e).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,n.width,n.height]);let c=DW(this.N,this.dMin,this.dMax);const h=Array.apply(null,Array(c.nodes.length)).map(()=>new kW);this.svg=s,this.graph=c,this.paths=h,this.loop()}loop(){!this.graph||!this.svg||(this.graph=LW(this.graph,this.paths,this.dt,this.dMin,this.dMax),IW(this.svg,this.graph,this.loopTime,this.color),this.handle=setTimeout(()=>this.loop(),this.loopTime))}destroy(){var e;clearTimeout(this.handle),(e=this.svg)==null||e.remove()}};function FW(t){const e=pt.useRef(null);return pt.useEffect(()=>{const n=new zW(t.color);return e.current&&n.setContainer(e.current),()=>n.destroy()},[e.current]),me.jsx("div",{ref:e,style:{width:"100%",height:"100%"}})}class NW{constructor(e){ht(this,"svg");ht(this,"sinData");ht(this,"gradData");ht(this,"approxData");ht(this,"betterApproxData");ht(this,"xScale");ht(this,"yScale");ht(this,"focussedStep",-1);this.container=e;const n=this.container.getBoundingClientRect(),s=UA(this.container).append("svg").attr("width",n.width).attr("height",n.height).attr("viewBox",[0,0,n.width,n.height]);this.svg=s,this.sinData=[];for(let M=0;M<100;M++){const I=M/10,N=Math.sin(I);this.sinData.push({x:I,y:N})}this.gradData=[];for(let M=0;M<100;M++){const I=M/10,N=Math.sin(I),B=Math.cos(I);this.gradData.push({x:I,y:N,dydx:B})}let c=this.sinData[0].x;const h=this.sinData[this.sinData.length-1].x;let l=this.sinData[0].y;const m=10,_=(h-c)/m;this.approxData=[{x:c,y:l}];for(let M=1;M<m;M++){const I=Math.round((this.sinData.length-1)*(M-1)/m),N=this.gradData[I].dydx,B=c+_,k=l+N*_;this.approxData.push({x:B,y:k}),c=B,l=k}c=this.sinData[0].x,l=this.sinData[0].y,this.betterApproxData=[{x:c,y:l}];for(let M=1;M<m;M++){const I=Math.round((this.sinData.length-1)*(M-1)/m),N=this.gradData[I].dydx,B=Math.round((this.sinData.length-1)*M/m),k=this.gradData[B].dydx,C=c+_,U=l+(N+k)*_/2;this.betterApproxData.push({x:C,y:U}),c=C,l=U}const S=wp().domain([-1,11]).range([0,parseFloat(this.svg.attr("width"))]),T=wp().domain([-2,2]).range([parseFloat(this.svg.attr("height")),0]);this.xScale=S,this.yScale=T}destroy(){this.svg.remove()}stepHasFocus(e){const n=Math.round(e);n!==this.focussedStep&&(this.focussedStep=n,n<=1.5?this.plot({sinData:this.sinData,gradients:[],approxData:[]}):n<=2.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,1)}):n<=3.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,2)}):n<=4.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,2)}):n<=5.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,3)}):n<=6.1?this.plot({sinData:this.sinData,gradients:[],approxData:this.approxData}):n<=7.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:[this.approxData[0]]}):n<=8.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)]],approxData:this.approxData.slice(0,2)}):n<=9.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.betterApproxData.slice(0,2)}):n<=10.1&&this.plot({sinData:this.sinData,gradients:[],approxData:this.betterApproxData}))}plot(e){const n=yH(m=>this.xScale(m.x),m=>this.yScale(m.y)),r=J1("simple appear").duration(1e3),s=parseInt(this.svg.attr("width"))*3.14;this.svg.selectAll("path.rawData").data([e.sinData],m=>m.length).enter().append("path").attr("class","rawData").attr("d",n).attr("fill","none").attr("stroke","gray").attr("stroke-dasharray",s+" "+s).attr("stroke-dashoffset",s).transition(r).attr("stroke-dashoffset",0).attr("stroke-dasharray","10 10");const h=this.svg.selectAll("line.gradient").data(e.gradients,m=>m.x);h.enter().append("line").attr("class","gradient").attr("x1",m=>this.xScale(m.x-10)).attr("x2",m=>this.xScale(m.x+10)).attr("y1",m=>this.yScale(m.y-10*m.dydx)).attr("y2",m=>this.yScale(m.y+10*m.dydx)).transition(r).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5 5"),h.exit().transition(r).remove();const l=this.svg.selectAll("path.simData").data([e.approxData],m=>m.map(_=>_.y).join(" "));l.enter().append("path").attr("class","simData").attr("stroke","black").attr("fill","none").attr("stroke-width",4).attr("d",n).attr("stroke-dasharray",s+" "+s).attr("stroke-dashoffset",s).transition(r).attr("stroke-dashoffset",0),l.transition(r).attr("d",n),l.exit().transition(r).attr("stroke-dashoffset",s).remove()}approxIndexToRealIndex(e){return Math.round(this.sinData.length*e/this.approxData.length)}}class BW{constructor(){ht(this,"container");ht(this,"contents");ht(this,"slider");ht(this,"graphMgmt");ht(this,"io")}setContainer(e){this.container=e,this.contents=Array.from(e.querySelectorAll(".content")),this.slider=e.querySelector(".slider"),this.graphMgmt=new NW(this.slider);let n="-38% 0px -38% 0px";window.innerWidth<400&&(n="-40% 0px -60% 0px"),this.io=new IntersectionObserver((r,s)=>{r.forEach(c=>{var h;if(c.isIntersecting){const l=parseInt(c.target.dataset.stepnr);(h=this.graphMgmt)==null||h.stepHasFocus(l)}})},{rootMargin:n}),this.contents.map(r=>{var s;return(s=this.io)==null?void 0:s.observe(r)})}destroy(){var e,n;(e=this.graphMgmt)==null||e.destroy(),(n=this.io)==null||n.disconnect()}}function Us(t){return me.jsx("span",{dangerouslySetInnerHTML:{__html:q8.renderToString(t.katexString)}})}function dx(t){return me.jsx("div",{dangerouslySetInnerHTML:{__html:q8.renderToString(t.katexString)}})}function OW(){const t=pt.useRef(null);return pt.useEffect(()=>{const e=new BW;return t.current&&e.setContainer(t.current),()=>e.destroy()},[t.current]),me.jsxs(Xd,{hero:me.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px",background:"linear-gradient(180deg, var(--primary2) 0%,  var(--primary1) 100%)"},children:me.jsx(wv,{title:"Math animations",subtitle:"Explaining math visually",heroBackground:me.jsx(FW,{color:"var(--primary1-transparent25)"})})}),footerContent:me.jsx(Ob,{}),children:[me.jsxs("p",{children:["This section showcases math text-formatting and animations. As an example, we give a brief introduction into"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Euler_method",target:"_blank",children:"Euler's method"})," ","for numerically solving differential equations, and show how it can be improved upon."]}),me.jsxs("div",{ref:t,className:"container",children:[me.jsx("div",{className:"rightCol",children:me.jsx("div",{className:"slider"})}),me.jsxs("div",{className:"leftCol",children:[me.jsx("div",{className:"content","data-stepnr":"1",children:me.jsxs("p",{children:["Let's assume there is some function ",me.jsx(Us,{katexString:"y(t)"})," that we want to approximate. We don't know the analytical form of the function, but at each point we can evaluate its gradient as ",me.jsx(Us,{katexString:"f(t, y)"}),"."]})}),me.jsx("div",{className:"content","data-stepnr":"2",children:me.jsxs("p",{children:["So we start at the first point, ",me.jsx(Us,{katexString:"t_0, y_0"}),", and calculate the gradient ",me.jsx(Us,{katexString:"f(t_0, y_0)"})," there (shown here as a blue tangent)."]})}),me.jsxs("div",{className:"content","data-stepnr":"3",children:[me.jsxs("p",{children:["We then simply follow along that gradient for some distance ",me.jsx(Us,{katexString:"h"}),":"]}),me.jsx(dx,{katexString:"y_1 = y_0 + h f(t_0, y_0)"}),me.jsx("p",{children:"Note that we've already made a small approximation error: we've ended up a bit higher than the true curve."})]}),me.jsx("div",{className:"content","data-stepnr":"4",children:me.jsxs("p",{children:["Undeterred, we soldier on: we again evaluate the gradient of the function, but now at the new position"," ",me.jsx(Us,{katexString:"t_1, y_1"}),"."]})}),me.jsx("div",{className:"content","data-stepnr":"5",children:me.jsx("p",{children:"And again we take another step along that gradient."})}),me.jsx("div",{className:"content","data-stepnr":"6",children:me.jsx("p",{children:"We can repeat this process as long as required. As we do so, however, we continue to make small errors, causing our approximation to diverge quite a bit from the real function."})}),me.jsx("div",{className:"content","data-stepnr":"7",children:me.jsxs("p",{children:["One way to reduce those errors is in realizing that the functions gradient will change between the current and the next step. We can better approximate this effect by accounting for both the gradient at"," ",me.jsx(Us,{katexString:"t_0, y_0"})," and at"," ",me.jsx(Us,{katexString:"t_1, y_1"}),". This insight is known as the"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Trapezoidal_rule",target:"_blank",children:"trapezoidal rule"}),"."]})}),me.jsxs("div",{className:"content","data-stepnr":"8",children:[me.jsxs("p",{children:["So we switch to a two-step-process. We begin with a first estimate of the function value, starting from"," ",me.jsx(Us,{katexString:"t_0, y_0"}),":"," "]}),me.jsx(dx,{katexString:"\\tilde{y}_1 = y_0 + h f(t_0, y_0)"}),me.jsx("p",{children:"This is identical to what we've already done before."})]}),me.jsxs("div",{className:"content","data-stepnr":"9",children:[me.jsxs("p",{children:["In a second step, however, we refine our prediction by taking the mean of the gradient at"," ",me.jsx(Us,{katexString:"t_0, y_0"})," and the gradient at"," ",me.jsx(Us,{katexString:"t_1, y_1"})," (both shown here as blue tangents):"]}),me.jsx(dx,{katexString:"y_1 = y_0 + \\frac{h}{2} f(t_0, y_0) + \\frac{h}{2} f(t_1, \\tilde{y}_1)"})]}),me.jsx("div",{className:"content","data-stepnr":"10",style:{marginBottom:"15rem",marginTop:"20rem"},children:me.jsxs("p",{children:["Using this schema, known as"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Heun%27s_method",target:"_blank",children:"Heun's method"}),", we get a much better function approximation."]})})]})]}),me.jsx("div",{children:me.jsxs("p",{children:["This simple method is surprisingly useful for approximating the solution to differential equations. Fairly straightforward refinements are the"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"general Runge-Kutta"})," ","and"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Predictor%E2%80%93corrector_method",target:"_blank",children:"predictor-corrector"})," ","methods, which we use, for example, in our ",me.jsx(F1,{to:"/swe",children:"shallow water simulation"}),"."]})})]})}class UW{constructor(e,n,r,s,c,h,l=[1,1,1,1]){ht(this,"differentialGraph");ht(this,"summarizeGraph");ht(this,"dataTexture1");ht(this,"dataTexture2");ht(this,"k0Texture");ht(this,"k1Texture");ht(this,"k2Texture");ht(this,"k3Texture");ht(this,"k4Texture");ht(this,"gs");ht(this,"debugGraph");ht(this,"i",0);const m=e.gl,_={};for(const xe of c)_[xe.name]={type:xe.type,value:xe.value};const S={};for(const xe of h)S[xe.name]=xe.value;const T=Mv(0,0,2,2),M=new mo(m,{data:new Float32Array(T.flat()),changesOften:!1}),I=new MS(m,{data:r,t:"float4",edges:"clamp",interpolate:"none"}),N=new MS(m,{data:r,t:"float4",edges:"clamp",interpolate:"none"}),B=I.width,k=I.height,C=new ho(m,{width:B,height:k,type:"float4",edges:"clamp",interpolate:"none"}),U=new ho(m,{width:B,height:k,type:"float4",edges:"clamp",interpolate:"none"}),V=new ho(m,{width:B,height:k,type:"float4",edges:"clamp",interpolate:"none"}),Y=new ho(m,{width:B,height:k,type:"float4",edges:"clamp",interpolate:"none"}),he=new ho(m,{width:B,height:k,type:"float4",edges:"clamp",interpolate:"none"}),Z=new Pa(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          uniform vec2 textureSize;
          uniform sampler2D dataTexture;
          uniform sampler2D kTexture;
          uniform float kFactor;
          uniform float dt;
          ${c.map(xe=>`uniform ${xe.type} ${xe.name}; 
`)}
          ${h.map(xe=>`uniform sampler2D ${xe.name}; 
`)}
          in vec2 uv;
          out vec4 fragColor;
  
          void main() {
  
              vec2 deltaX = vec2(1.0 / textureSize.x, 0.0);
              vec2 deltaY = vec2(0.0, 1.0 / textureSize.y);
              vec4 data    = texture(dataTexture, uv          ) + dt * kFactor * texture(kTexture, uv          );
              vec4 data_px = texture(dataTexture, uv + deltaX ) + dt * kFactor * texture(kTexture, uv + deltaX );
              vec4 data_mx = texture(dataTexture, uv - deltaX ) + dt * kFactor * texture(kTexture, uv - deltaX );
              vec4 data_py = texture(dataTexture, uv + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaY );
              vec4 data_my = texture(dataTexture, uv - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaY );
  
              //-----------------------------------------------------------
              // Insert here shader code that takes "data", "data_px", ...
              // and fills "fragColor" with df/dt
              ${n}
              //-----------------------------------------------------------
  
          }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{...S,dataTexture:I,kTexture:C},uniforms:{..._,textureSize:{type:"vec2",value:[B,k]},kFactor:{type:"float",value:[0]},dt:{type:"float",value:[s]}}},outputs:{frameBuffer:{textures:[U]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:T.length,viewport:[0,0,B,k]}}),ne=new Pa(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          in vec2 uv;
          uniform sampler2D dataTexture;
          uniform sampler2D k1Texture;
          uniform sampler2D k2Texture;
          uniform sampler2D k3Texture;
          uniform sampler2D k4Texture;
          uniform float dt;
          uniform vec4 dampingFactor;
          out vec4 fragColor;
  
          void main() {
              vec4 data = texture(dataTexture, uv);
              vec4 k1   = texture(k1Texture,   uv);
              vec4 k2   = texture(k2Texture,   uv);
              vec4 k3   = texture(k3Texture,   uv);
              vec4 k4   = texture(k4Texture,   uv);
  
              vec4 weightedAverage = data + dt * (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0;
              weightedAverage *= dampingFactor;
  
              fragColor = weightedAverage;
          }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{dt:{type:"float",value:[s]},dampingFactor:{type:"vec4",value:l}},textures:{dataTexture:I,k1Texture:U,k2Texture:V,k3Texture:Y,k4Texture:he}},outputs:{frameBuffer:{textures:[N]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:T.length,viewport:[0,0,B,k]}});this.debugGraph=new Pa(e,{program:{vertexSource:`#version 300 es
              in vec2 pos;
              out vec2 uv;
              void main() {
                  gl_Position = vec4(pos.xy, 0, 1);
                  uv = (pos + 1.0) / 2.0;
              }`,fragmentSource:`#version 300 es
              precision highp float;
              in vec2 uv;
              uniform sampler2D drawTexture;
              out vec4 fragColor;
              void main() {
                  vec4 tex = texture(drawTexture, uv);
                  float h = (tex.x - 0.5) * 2.0;
                  fragColor = vec4(tex.x, tex.x, tex.x, 1.0);
              }`},inputs:{attributes:{pos:{buffer:M,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{drawTexture:N}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:T.length,viewport:[0,0,B,k]}}),this.gs=e,this.differentialGraph=Z,this.summarizeGraph=ne,this.dataTexture1=I,this.dataTexture2=N,this.k0Texture=C,this.k1Texture=U,this.k2Texture=V,this.k3Texture=Y,this.k4Texture=he}loop(e){const n=this.differentialGraph,r=this.summarizeGraph;let s=this.dataTexture1,c=this.dataTexture2;if(this.i%2!==0&&(s=this.dataTexture2,c=this.dataTexture1),e)for(const h of e)n.updateUniform(h.name,h.value);return n.updateUniform("kFactor",[0]),n.updateTexture("dataTexture",s),n.updateTexture("kTexture",this.k0Texture),n.updateFramebuffer({textures:[this.k1Texture]}),n.draw(),n.updateUniform("kFactor",[.5]),n.updateTexture("kTexture",this.k1Texture),n.updateFramebuffer({textures:[this.k2Texture]}),n.draw(),n.updateUniform("kFactor",[.5]),n.updateTexture("kTexture",this.k2Texture),n.updateFramebuffer({textures:[this.k3Texture]}),n.draw(),n.updateUniform("kFactor",[1]),n.updateTexture("kTexture",this.k3Texture),n.updateFramebuffer({textures:[this.k4Texture]}),n.draw(),r.updateTexture("dataTexture",s),r.updateFramebuffer({textures:[c]}),r.draw(),this.i+=1,c}destroy(e=!1){this.debugGraph.destroy(e),this.summarizeGraph.destroy(e),this.differentialGraph.destroy(e)}}let VW=class{constructor(e,n){ht(this,"rk");ht(this,"displayGraph");const r=e.getContext("webgl2"),s=5e-4,c=500,h=500;e.width=e.clientWidth,e.height=e.clientHeight;const l=JI(()=>[0,0,0,1],c,h),m=Mv(0,0,2,2),_=new mo(r,{data:new Float32Array(m.flat()),changesOften:!1}),S=new ki(r,{image:n.bgImg}),T=new ki(r,{image:n.hImg}),M=new Sv(r,{}),I=`

      // assuming a 6 x 6 m^2 field
      float dx = deltaX.x * 6.0;
      float dy = deltaY.y * 6.0;

      float h = data.x;
      float u = data.y;
      float v = data.z;
      float hPX = data_px.x;
      float uPX = data_px.y;
      float vPX = data_px.z;
      float hMX = data_mx.x;
      float uMX = data_mx.y;
      float vMX = data_mx.z;
      float hPY = data_py.x;
      float uPY = data_py.y;
      float vPY = data_py.z;
      float hMY = data_my.x;
      float uMY = data_my.y;
      float vMY = data_my.z;

      // finite differences
      vec2 uvTex = vec2(uv.x, 1.0 - uv.y);
      float H = texture(hTex, uvTex).x * 5.0; // 10.0;
      float f = 0.001;   // coriolis coefficient
      float b = 0.003;   // viscous drag
      float g = 9.831;   // fall acceleration

      float dudx = (uPX - uMX) / (2.0 * dx);
      float dvdy = (vPY - vMY) / (2.0 * dy);
      float dhdx = (hPX - hMX) / (2.0 * dx);
      float dhdy = (hPY - hMY) / (2.0 * dy);

      // user-interaction
      if (mousePos.w > 0.5) {
        float d = distance(mousePos.xy, uv);
        if (d < 0.01) {
          dhdx += mousePos.z;
          dhdy += mousePos.z;
        }
      }

      // edge conditions
      float x = gl_FragCoord.x;
      if (x < 2.0 || x > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dudx = 0.0;
        dhdx = 0.0; 
      }
      float y = gl_FragCoord.y;
      if (y < 2.0 || y > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dvdy = 0.0;
        dhdy = 0.0;
      }

      float dhdt =      - H * ( dudx + dvdy );
      float dudt = ( + f*v - b*u - g * dhdx );
      float dvdt = ( - f*u - b*v - g * dhdy );

      if (H < 0.1) {
        dhdt = 0.0;
        dudt = 0.0;
        dvdt = 0.0;
      }

      // detect and eliminate checkerboard pattern
      vec4 data_px_py = texture(dataTexture, uv + deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX + deltaY);
      vec4 data_px_my = texture(dataTexture, uv + deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX - deltaY);
      vec4 data_mx_py = texture(dataTexture, uv - deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX + deltaY);
      vec4 data_mx_my = texture(dataTexture, uv - deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX - deltaY);
      float neighborhoodSize = sqrt(
          data_mx_py.x * data_mx_py.x +  data_py.x * data_py.x + data_px_py.x * data_px_py.x
        + data_mx.x * data_mx.x       +  data.x * data.x       + data_px.x * data_px.x
        + data_mx_my.x * data_mx_my.x +  data_my.x * data_my.x + data_px_my.x * data_px_my.x
      );
      float h_norm       = data.x / neighborhoodSize;
      float h_mx_norm    = data_mx.x / neighborhoodSize;
      float h_px_norm    = data_px.x / neighborhoodSize;
      float h_my_norm    = data_my.x / neighborhoodSize;
      float h_py_norm    = data_py.x / neighborhoodSize;
      float h_mx_py_norm = data_mx_py.x / neighborhoodSize;
      float h_mx_my_norm = data_mx_my.x / neighborhoodSize;
      float h_px_py_norm = data_px_py.x / neighborhoodSize;
      float h_px_my_norm = data_px_my.x / neighborhoodSize;
      float signedSimilarity = (0.333 * h_mx_py_norm - 0.333 * h_py_norm  + 0.333 * h_px_py_norm  
                              - 0.333 * h_mx_norm    + 0.333 * h_norm     - 0.333 * h_px_norm  
                              + 0.333 * h_mx_my_norm - 0.333 * h_my_norm  + 0.333 * h_px_my_norm ) / 9.0;
      float similarityThreshold = 0.75;
      float nudgeStrength = 0.2;
      if (abs(signedSimilarity) > similarityThreshold) {
        float meanH = ( data_mx_py.x + data_py.x + data_px_py.x
                      + data_mx.x    + data.x    + data_px.x
                      + data_mx_my.x + data_my.x + data_px_my.x) / 9.0;
        float deltaHTarget = (meanH - data.x);
        float deltaHTrue = dhdt;
        float delta = deltaHTarget - deltaHTrue;
        dhdt += delta * nudgeStrength; 
      }

      fragColor = vec4(dhdt, dudt, dvdt, 1.0);
  `,N=new UW(M,I,l,s,[{name:"mousePos",type:"vec4",value:[0,0,0,0]}],[{name:"hTex",value:T}],[.995,.995,.995,1]),B=N.loop(),k=new Pa(M,{program:{vertexSource:`#version 300 es
        in vec2 pos;
        out vec2 uv;
        void main() {
            gl_Position = vec4(pos.xy, 0, 1);
            uv = (pos + 1.0) / 2.0;
        }`,fragmentSource:`#version 300 es
        precision highp float;
        in vec2 uv;
        uniform vec2 textureSize;
        uniform sampler2D tex;
        uniform sampler2D bgTex;
        out vec4 fragColor;

        float antiRound(float x) {
          float f = fract(x);
          if (f > 0.5) return floor(x);
          return ceil(x);
        }

        float prox(vec2 a, vec2 b) {
          float dx = a.x - b.x;
          float dy = a.y - b.y;
          float dist = sqrt(dx*dx + dy*dy);
          return 1. - dist;
        }

        // our data-texture allows no interpolation.
        // if we chose a low resolution R,C < 200, then the user can see individual pixels.
        // so we do interpolated sampling in software here.
        vec4 textureInterpolated(sampler2D tex, vec2 uv, vec2 textureSize) {
          vec2 rc = uv * textureSize;
          
          vec2 rcPicked = round(rc);
          float wPicked = prox(rc, rcPicked);

          vec2 rcAntiRow = vec2(antiRound(rc.x), rcPicked.y);
          float wAntiRow = prox(rc, rcAntiRow);

          vec2 rcAntiCol = vec2(rcPicked.x, antiRound(rc.y));
          float wAntiCol = prox(rc, rcAntiCol);

          float wTot = wPicked + wAntiRow + wAntiCol;
          wPicked    = wPicked  / wTot;
          wAntiRow   = wAntiRow / wTot;
          wAntiCol   = wAntiCol / wTot;

          vec4 valPicked  = texture(tex, rcPicked  / textureSize);
          vec4 valAntiRow = texture(tex, rcAntiRow / textureSize);
          vec4 valAntiCol = texture(tex, rcAntiCol / textureSize);

          vec4 valInterpol = valPicked * wPicked + valAntiRow * wAntiRow + valAntiCol * wAntiCol;
          return valInterpol;
        }

        void main() {
            // vec4 tex = texture(tex, uv);
            vec4 tex = textureInterpolated(tex, uv, textureSize);
            vec2 uvBg = vec2(uv.x, 1.0 - uv.y);
            uvBg += vec2(tex.x, tex.x) * 0.02;
            vec4 bg = texture(bgTex, uvBg);
            fragColor = bg;
        }`},inputs:{attributes:{pos:{buffer:_,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{textureSize:{type:"vec2",value:[h,c]}},textures:{tex:B,bgTex:S}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:m.length,viewport:[0,0,e.width,e.height]}});this.rk=N,this.displayGraph=k}step(e){const{userX:n,userY:r,userStrength:s,userMoving:c}=e,h=this.rk.loop([{name:"mousePos",type:"vec4",value:[n,r,s,c]}]);this.displayGraph.updateTexture("tex",h),this.displayGraph.draw()}destroy(e){this.rk.destroy(e),this.displayGraph.destroy(e)}};function X8(t){return me.jsx(Xd,{hero:me.jsx(UE,{backgroundImage:t.bgImg,title:t.title,subtitle:t.subTitle}),logo:t.logo,footerContent:me.jsx(Ob,{}),children:t.children})}class HW{constructor(){ht(this,"looper");ht(this,"swe");ht(this,"canvas");ht(this,"mouseListener",e=>{if(!this.canvas)return;const n=this.canvas.getBoundingClientRect();this.userX=(e.clientX-n.left)/this.canvas.clientWidth,this.userY=1-(e.clientY-n.top)/this.canvas.clientHeight,this.userMoving=1});ht(this,"userX",0);ht(this,"userY",0);ht(this,"userMoving",0);ht(this,"destroyed",!1)}async init(e){this.canvas=e,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight;const n=await ki.loadImage("/swe_bg.jpg"),r=await ki.loadImage("/swe_h2.jpg");this.destroyed||(this.swe=new VW(e,{bgImg:n,hImg:r}),this.looper=new kp(10,()=>{var s;(s=this.swe)==null||s.step({userX:this.userX,userY:this.userY,userMoving:this.userMoving,userStrength:1e3}),this.userMoving=0}),this.canvas.addEventListener("mousemove",this.mouseListener),this.startLoop())}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){var e,n;this.stopLoop(),this.mouseListener&&((e=this.canvas)==null||e.removeEventListener("mousemove",this.mouseListener)),(n=this.swe)==null||n.destroy(!0),this.swe=void 0,this.canvas=void 0,this.destroyed=!0}}function GW(){const t=pt.useRef(null);return pt.useEffect(()=>{const e=new HW;return t.current&&e.init(t.current),()=>e.destroy()},[t.current]),me.jsxs(X8,{bgImg:"/swe_bg.jpg",title:"Wave simulations",subTitle:"using the shallow water equations",logo:me.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 5 4",children:[me.jsx("defs",{children:me.jsx("path",{id:"squiggle",d:`M 0 0 
              C 0.5 0 0.5 0.5 1.0 0.5 
              S       1.5 0.0 2.0 0.0
              S       2.5 0.5 3.0 0.5
              S       3.5 0.0 4.0 0.0`,stroke:"black",strokeWidth:"0.2",strokeLinejoin:"round",fill:"none"})}),me.jsx("use",{href:"#squiggle",x:"0.5",y:"1.0"}),me.jsx("use",{href:"#squiggle",x:"0.5",y:"2.0"}),me.jsx("use",{href:"#squiggle",x:"0.5",y:"3.0"})]}),children:[me.jsxs("p",{style:{margin:"2rem"},children:["Water-surface-movement can be simulated accurately with the"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Shallow_water_equations",target:"_blank",children:"shallow water equations"}),". To augment the numerical stability of that simulation, approximation methods like"," ",me.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"Runge-Kutta"})," ","can be used."]}),me.jsxs("p",{style:{margin:"2rem"},children:["The image below contains an implementation of this method. ",me.jsx("b",{children:"Move your mouse over the water"})," to make waves!"]}),me.jsx("canvas",{ref:t,style:{width:"100%",aspectRatio:"3/2"}}),me.jsx("p",{style:{margin:"2rem"},children:"This method can be adjusted to be included in maps, 3d-scenes etc."})]})}var rT=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});function jW(){var t=new rT(16);return rT!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function WW(t,e){var n=e[0],r=e[1],s=e[2],c=e[3],h=e[4],l=e[5],m=e[6],_=e[7],S=e[8],T=e[9],M=e[10],I=e[11],N=e[12],B=e[13],k=e[14],C=e[15],U=n*l-r*h,V=n*m-s*h,Y=n*_-c*h,he=r*m-s*l,Z=r*_-c*l,ne=s*_-c*m,xe=S*B-T*N,ie=S*k-M*N,J=S*C-I*N,Te=T*k-M*B,Be=T*C-I*B,Re=M*C-I*k,We=U*Re-V*Be+Y*Te+he*J-Z*ie+ne*xe;return We?(We=1/We,t[0]=(l*Re-m*Be+_*Te)*We,t[1]=(s*Be-r*Re-c*Te)*We,t[2]=(B*ne-k*Z+C*he)*We,t[3]=(M*Z-T*ne-I*he)*We,t[4]=(m*J-h*Re-_*ie)*We,t[5]=(n*Re-s*J+c*ie)*We,t[6]=(k*Y-N*ne-C*V)*We,t[7]=(S*ne-M*Y+I*V)*We,t[8]=(h*Be-l*J+_*xe)*We,t[9]=(r*J-n*Be-c*xe)*We,t[10]=(N*Z-B*Y+C*U)*We,t[11]=(T*Y-S*Z-I*U)*We,t[12]=(l*ie-h*Te-m*xe)*We,t[13]=(n*Te-r*ie+s*xe)*We,t[14]=(B*V-N*he-k*U)*We,t[15]=(S*he-T*V+M*U)*We,t):null}var Z8={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(t,e){(function(n,r){t.exports=r()})(GC,function(){var n={},r={};function s(h,l,m){if(r[h]=m,h==="index"){var _="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",S={};return r.shared(S),r.index(n,S),typeof window<"u"&&n.setWorkerUrl(window.URL.createObjectURL(new Blob([_],{type:"text/javascript"}))),n}}s("shared",["exports"],function(h){function l(o,i,u,f){return new(u||(u=Promise))(function(v,b){function w(L){try{R(f.next(L))}catch(j){b(j)}}function E(L){try{R(f.throw(L))}catch(j){b(j)}}function R(L){var j;L.done?v(L.value):(j=L.value,j instanceof u?j:new u(function(W){W(j)})).then(w,E)}R((f=f.apply(o,i||[])).next())})}function m(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}typeof SuppressedError=="function"&&SuppressedError;var _=S;function S(o,i){this.x=o,this.y=i}S.prototype={clone:function(){return new S(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,i){return this.clone()._rotateAround(o,i)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var i=o.x-this.x,u=o.y-this.y;return i*i+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,i){return Math.atan2(this.x*i-this.y*o,this.x*o+this.y*i)},_matMult:function(o){var i=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=i,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var i=Math.cos(o),u=Math.sin(o),f=u*this.x+i*this.y;return this.x=i*this.x-u*this.y,this.y=f,this},_rotateAround:function(o,i){var u=Math.cos(o),f=Math.sin(o),v=i.y+f*(this.x-i.x)+u*(this.y-i.y);return this.x=i.x+u*(this.x-i.x)-f*(this.y-i.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},S.convert=function(o){return o instanceof S?o:Array.isArray(o)?new S(o[0],o[1]):o};var T=m(_),M=I;function I(o,i,u,f){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=f}I.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,f=0;f<8;f++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=v/b}var w=0,E=1;for(u=o,f=0;f<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));f++)o>v?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var N=m(M);let B,k;function C(){return B==null&&(B=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),B}function U(){if(k==null&&(k=!1,C())){const i=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(i){for(let f=0;f<5*5;f++){const v=4*f;i.fillStyle=`rgb(${v},${v+1},${v+2})`,i.fillRect(f%5,Math.floor(f/5),1,1)}const u=i.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&u[f]!==f){k=!0;break}}}return k||!1}function V(o,i,u,f){const v=new N(o,i,u,f);return function(b){return v.solve(b)}}const Y=V(.25,.1,.25,1);function he(o,i,u){return Math.min(u,Math.max(i,o))}function Z(o,i,u){const f=u-i,v=((o-i)%f+f)%f+i;return v===i?u:v}function ne(o,...i){for(const u of i)for(const f in u)o[f]=u[f];return o}let xe=1;function ie(o,i,u){const f={};for(const v in o)f[v]=i.call(u||this,o[v],v,o);return f}function J(o,i,u){const f={};for(const v in o)i.call(u||this,o[v],v,o)&&(f[v]=o[v]);return f}function Te(o){return Array.isArray(o)?o.map(Te):typeof o=="object"&&o?ie(o,Te):o}const Be={};function Re(o){Be[o]||(typeof console<"u"&&console.warn(o),Be[o]=!0)}function We(o,i,u){return(u.y-o.y)*(i.x-o.x)>(i.y-o.y)*(u.x-o.x)}function ct(o){let i=0;for(let u,f,v=0,b=o.length,w=b-1;v<b;w=v++)u=o[v],f=o[w],i+=(f.x-u.x)*(u.y+f.y);return i}function gt(o){return typeof WorkerGlobalScope<"u"&&o!==void 0&&o instanceof WorkerGlobalScope}let ft=null;function ke(o){return typeof ImageBitmap<"u"&&o instanceof ImageBitmap}const at="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function ot(o,i,u,f,v){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const b=new VideoFrame(o,{timestamp:0});try{const w=b==null?void 0:b.format;if(!w||!w.startsWith("BGR")&&!w.startsWith("RGB"))throw new Error(`Unrecognized format ${w}`);const E=w.startsWith("BGR"),R=new Uint8ClampedArray(f*v*4);if(yield b.copyTo(R,function(L,j,W,K,re){const le=4*Math.max(-j,0),fe=(Math.max(0,W)-W)*K*4+le,_e=4*K,Ce=Math.max(0,j),Ge=Math.max(0,W);return{rect:{x:Ce,y:Ge,width:Math.min(L.width,j+K)-Ce,height:Math.min(L.height,W+re)-Ge},layout:[{offset:fe,stride:_e}]}}(o,i,u,f,v)),E)for(let L=0;L<R.length;L+=4){const j=R[L];R[L]=R[L+2],R[L+2]=j}return R}finally{b.close()}})}let _t,kt;const Cn="AbortError";function it(){return new Error(Cn)}const Mt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ft(o){return Mt.REGISTERED_PROTOCOLS[o.substring(0,o.indexOf("://"))]}const At="global-dispatcher";class Sn extends Error{constructor(i,u,f,v){super(`AJAXError: ${u} (${i}): ${f}`),this.status=i,this.statusText=u,this.url=f,this.body=v}}const Dn=()=>gt(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,qe=function(o,i){if(/:\/\//.test(o.url)&&!/^https?:|^file:/.test(o.url)){const f=Ft(o.url);if(f)return f(o,i);if(gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:o,targetMapId:At},i)}if(!(/^file:/.test(u=o.url)||/^file:/.test(Dn())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,v){return l(this,void 0,void 0,function*(){const b=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:Dn(),signal:v.signal});f.type==="json"&&b.headers.set("Accept","application/json");const w=yield fetch(b);if(!w.ok){const L=yield w.blob();throw new Sn(w.status,w.statusText,f.url,L)}let E;E=f.type==="arrayBuffer"||f.type==="image"?w.arrayBuffer():f.type==="json"?w.json():w.text();const R=yield E;if(v.signal.aborted)throw it();return{data:R,cacheControl:w.headers.get("Cache-Control"),expires:w.headers.get("Expires")}})}(o,i);if(gt(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:o,mustQueue:!0,targetMapId:At},i)}var u;return function(f,v){return new Promise((b,w)=>{const E=new XMLHttpRequest;E.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(E.responseType="arraybuffer");for(const R in f.headers)E.setRequestHeader(R,f.headers[R]);f.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=f.credentials==="include",E.onerror=()=>{w(new Error(E.statusText))},E.onload=()=>{if(!v.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let R=E.response;if(f.type==="json")try{R=JSON.parse(E.response)}catch(L){return void w(L)}b({data:R,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const R=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});w(new Sn(E.status,E.statusText,f.url,R))}},v.signal.addEventListener("abort",()=>{E.abort(),w(it())}),E.send(f.body)})}(o,i)};function Nn(o){if(!o||o.indexOf("://")<=0||o.indexOf("data:image/")===0||o.indexOf("blob:")===0)return!0;const i=new URL(o),u=window.location;return i.protocol===u.protocol&&i.host===u.host}function hn(o,i,u){u[o]&&u[o].indexOf(i)!==-1||(u[o]=u[o]||[],u[o].push(i))}function Gn(o,i,u){if(u&&u[o]){const f=u[o].indexOf(i);f!==-1&&u[o].splice(f,1)}}class gn{constructor(i,u={}){ne(this,u),this.type=i}}class un extends gn{constructor(i,u={}){super("error",ne({error:i},u))}}class Pn{on(i,u){return this._listeners=this._listeners||{},hn(i,u,this._listeners),this}off(i,u){return Gn(i,u,this._listeners),Gn(i,u,this._oneTimeListeners),this}once(i,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},hn(i,u,this._oneTimeListeners),this):new Promise(f=>this.once(i,f))}fire(i,u){typeof i=="string"&&(i=new gn(i,u||{}));const f=i.type;if(this.listens(f)){i.target=this;const v=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of v)E.call(this,i);const b=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of b)Gn(f,E,this._oneTimeListeners),E.call(this,i);const w=this._eventedParent;w&&(ne(i,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),w.fire(i))}else i instanceof un&&console.error(i.error);return this}listens(i){return this._listeners&&this._listeners[i]&&this._listeners[i].length>0||this._oneTimeListeners&&this._oneTimeListeners[i]&&this._oneTimeListeners[i].length>0||this._eventedParent&&this._eventedParent.listens(i)}setEventedParent(i,u){return this._eventedParent=i,this._eventedParentData=u,this}}var je={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const qn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Ae(o,i){const u={};for(const f in o)f!=="ref"&&(u[f]=o[f]);return qn.forEach(f=>{f in i&&(u[f]=i[f])}),u}function se(o,i){if(Array.isArray(o)){if(!Array.isArray(i)||o.length!==i.length)return!1;for(let u=0;u<o.length;u++)if(!se(o[u],i[u]))return!1;return!0}if(typeof o=="object"&&o!==null&&i!==null){if(typeof i!="object"||Object.keys(o).length!==Object.keys(i).length)return!1;for(const u in o)if(!se(o[u],i[u]))return!1;return!0}return o===i}function tt(o,i){o.push(i)}function vt(o,i,u){tt(u,{command:"addSource",args:[o,i[o]]})}function Tt(o,i,u){tt(i,{command:"removeSource",args:[o]}),u[o]=!0}function wt(o,i,u,f){Tt(o,u,f),vt(o,i,u)}function pn(o,i,u){let f;for(f in o[u])if(Object.prototype.hasOwnProperty.call(o[u],f)&&f!=="data"&&!se(o[u][f],i[u][f]))return!1;for(f in i[u])if(Object.prototype.hasOwnProperty.call(i[u],f)&&f!=="data"&&!se(o[u][f],i[u][f]))return!1;return!0}function Gt(o,i,u,f,v,b){o=o||{},i=i||{};for(const w in o)Object.prototype.hasOwnProperty.call(o,w)&&(se(o[w],i[w])||u.push({command:b,args:[f,w,i[w],v]}));for(const w in i)Object.prototype.hasOwnProperty.call(i,w)&&!Object.prototype.hasOwnProperty.call(o,w)&&(se(o[w],i[w])||u.push({command:b,args:[f,w,i[w],v]}))}function Ht(o){return o.id}function Ln(o,i){return o[i.id]=i,o}class He{constructor(i,u,f,v){this.message=(i?`${i}: `:"")+f,v&&(this.identifier=v),u!=null&&u.__line__&&(this.line=u.__line__)}}function on(o,...i){for(const u of i)for(const f in u)o[f]=u[f];return o}class Rn extends Error{constructor(i,u){super(u),this.message=u,this.key=i}}class xn{constructor(i,u=[]){this.parent=i,this.bindings={};for(const[f,v]of u)this.bindings[f]=v}concat(i){return new xn(this,i)}get(i){if(this.bindings[i])return this.bindings[i];if(this.parent)return this.parent.get(i);throw new Error(`${i} not found in scope.`)}has(i){return!!this.bindings[i]||!!this.parent&&this.parent.has(i)}}const Qt={kind:"null"},lt={kind:"number"},Ut={kind:"string"},Zt={kind:"boolean"},yn={kind:"color"},Q={kind:"object"},ze={kind:"value"},Qe={kind:"collator"},bt={kind:"formatted"},ae={kind:"padding"},F={kind:"resolvedImage"},O={kind:"variableAnchorOffsetCollection"};function q(o,i){return{kind:"array",itemType:o,N:i}}function te(o){if(o.kind==="array"){const i=te(o.itemType);return typeof o.N=="number"?`array<${i}, ${o.N}>`:o.itemType.kind==="value"?"array":`array<${i}>`}return o.kind}const pe=[Qt,lt,Ut,Zt,yn,bt,Q,q(ze),ae,F,O];function we(o,i){if(i.kind==="error")return null;if(o.kind==="array"){if(i.kind==="array"&&(i.N===0&&i.itemType.kind==="value"||!we(o.itemType,i.itemType))&&(typeof o.N!="number"||o.N===i.N))return null}else{if(o.kind===i.kind)return null;if(o.kind==="value"){for(const u of pe)if(!we(u,i))return null}}return`Expected ${te(o)} but found ${te(i)} instead.`}function Se(o,i){return i.some(u=>u.kind===o.kind)}function ge(o,i){return i.some(u=>u==="null"?o===null:u==="array"?Array.isArray(o):u==="object"?o&&!Array.isArray(o)&&typeof o=="object":u===typeof o)}function Pe(o,i){return o.kind==="array"&&i.kind==="array"?o.itemType.kind===i.itemType.kind&&typeof o.N=="number":o.kind===i.kind}const Ye=.96422,Ke=.82521,Xe=4/29,Pt=6/29,en=3*Pt*Pt,an=Pt*Pt*Pt,bn=Math.PI/180,Mn=180/Math.PI;function sr(o){return(o%=360)<0&&(o+=360),o}function ue([o,i,u,f]){let v,b;const w=Ve((.2225045*(o=Ne(o))+.7168786*(i=Ne(i))+.0606169*(u=Ne(u)))/1);o===i&&i===u?v=b=w:(v=Ve((.4360747*o+.3850649*i+.1430804*u)/Ye),b=Ve((.0139322*o+.0971045*i+.7141733*u)/Ke));const E=116*w-16;return[E<0?0:E,500*(v-w),200*(w-b),f]}function Ne(o){return o<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Ve(o){return o>an?Math.pow(o,1/3):o/en+Xe}function $e([o,i,u,f]){let v=(o+16)/116,b=isNaN(i)?v:v+i/500,w=isNaN(u)?v:v-u/200;return v=1*Lt(v),b=Ye*Lt(b),w=Ke*Lt(w),[Ze(3.1338561*b-1.6168667*v-.4906146*w),Ze(-.9787684*b+1.9161415*v+.033454*w),Ze(.0719453*b-.2289914*v+1.4052427*w),f]}function Ze(o){return(o=o<=.00304?12.92*o:1.055*Math.pow(o,1/2.4)-.055)<0?0:o>1?1:o}function Lt(o){return o>Pt?o*o*o:en*(o-Xe)}function Wt(o){return parseInt(o.padEnd(2,o),16)/255}function Kt(o,i){return It(i?o/100:o,0,1)}function It(o,i,u){return Math.min(Math.max(i,o),u)}function tn(o){return!o.some(Number.isNaN)}const En={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class nn{constructor(i,u,f,v=1,b=!0){this.r=i,this.g=u,this.b=f,this.a=v,b||(this.r*=v,this.g*=v,this.b*=v,v||this.overwriteGetter("rgb",[i,u,f,v]))}static parse(i){if(i instanceof nn)return i;if(typeof i!="string")return;const u=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const v=En[f];if(v){const[w,E,R]=v;return[w/255,E/255,R/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const w=f.length<6?1:2;let E=1;return[Wt(f.slice(E,E+=w)),Wt(f.slice(E,E+=w)),Wt(f.slice(E,E+=w)),Wt(f.slice(E,E+w)||"ff")]}if(f.startsWith("rgb")){const w=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[E,R,L,j,W,K,re,le,fe,_e,Ce,Ge]=w,De=[j||" ",re||" ",_e].join("");if(De==="  "||De==="  /"||De===",,"||De===",,,"){const Fe=[L,K,fe].join(""),dt=Fe==="%%%"?100:Fe===""?255:0;if(dt){const mt=[It(+R/dt,0,1),It(+W/dt,0,1),It(+le/dt,0,1),Ce?Kt(+Ce,Ge):1];if(tn(mt))return mt}}return}}const b=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(b){const[w,E,R,L,j,W,K,re,le]=b,fe=[R||" ",j||" ",K].join("");if(fe==="  "||fe==="  /"||fe===",,"||fe===",,,"){const _e=[+E,It(+L,0,100),It(+W,0,100),re?Kt(+re,le):1];if(tn(_e))return function([Ce,Ge,De,Fe]){function dt(mt){const qt=(mt+Ce/30)%12,cn=Ge*Math.min(De,1-De);return De-cn*Math.max(-1,Math.min(qt-3,9-qt,1))}return Ce=sr(Ce),Ge/=100,De/=100,[dt(0),dt(8),dt(4),Fe]}(_e)}}}(i);return u?new nn(...u,!1):void 0}get rgb(){const{r:i,g:u,b:f,a:v}=this,b=v||1/0;return this.overwriteGetter("rgb",[i/b,u/b,f/b,v])}get hcl(){return this.overwriteGetter("hcl",function(i){const[u,f,v,b]=ue(i),w=Math.sqrt(f*f+v*v);return[Math.round(1e4*w)?sr(Math.atan2(v,f)*Mn):NaN,w,u,b]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ue(this.rgb))}overwriteGetter(i,u){return Object.defineProperty(this,i,{value:u}),u}toString(){const[i,u,f,v]=this.rgb;return`rgba(${[i,u,f].map(b=>Math.round(255*b)).join(",")},${v})`}}nn.black=new nn(0,0,0,1),nn.white=new nn(1,1,1,1),nn.transparent=new nn(0,0,0,0),nn.red=new nn(1,0,0,1);class yr{constructor(i,u,f){this.sensitivity=i?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(i,u){return this.collator.compare(i,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zr{constructor(i,u,f,v,b){this.text=i,this.image=u,this.scale=f,this.fontStack=v,this.textColor=b}}class fr{constructor(i){this.sections=i}static fromString(i){return new fr([new Zr(i,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(i=>i.text.length!==0||i.image&&i.image.name.length!==0)}static factory(i){return i instanceof fr?i:fr.fromString(i)}toString(){return this.sections.length===0?"":this.sections.map(i=>i.text).join("")}}class Rr{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof Rr)return i;if(typeof i=="number")return new Rr([i,i,i,i]);if(Array.isArray(i)&&!(i.length<1||i.length>4)){for(const u of i)if(typeof u!="number")return;switch(i.length){case 1:i=[i[0],i[0],i[0],i[0]];break;case 2:i=[i[0],i[1],i[0],i[1]];break;case 3:i=[i[0],i[1],i[2],i[1]]}return new Rr(i)}}toString(){return JSON.stringify(this.values)}}const ar=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class wn{constructor(i){this.values=i.slice()}static parse(i){if(i instanceof wn)return i;if(Array.isArray(i)&&!(i.length<1)&&i.length%2==0){for(let u=0;u<i.length;u+=2){const f=i[u],v=i[u+1];if(typeof f!="string"||!ar.has(f)||!Array.isArray(v)||v.length!==2||typeof v[0]!="number"||typeof v[1]!="number")return}return new wn(i)}}toString(){return JSON.stringify(this.values)}}class hi{constructor(i){this.name=i.name,this.available=i.available}toString(){return this.name}static fromString(i){return i?new hi({name:i,available:!1}):null}}function pr(o,i,u,f){return typeof o=="number"&&o>=0&&o<=255&&typeof i=="number"&&i>=0&&i<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[o,i,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[o,i,u,f]:[o,i,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ti(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof nn||o instanceof yr||o instanceof fr||o instanceof Rr||o instanceof wn||o instanceof hi)return!0;if(Array.isArray(o)){for(const i of o)if(!Ti(i))return!1;return!0}if(typeof o=="object"){for(const i in o)if(!Ti(o[i]))return!1;return!0}return!1}function Ir(o){if(o===null)return Qt;if(typeof o=="string")return Ut;if(typeof o=="boolean")return Zt;if(typeof o=="number")return lt;if(o instanceof nn)return yn;if(o instanceof yr)return Qe;if(o instanceof fr)return bt;if(o instanceof Rr)return ae;if(o instanceof wn)return O;if(o instanceof hi)return F;if(Array.isArray(o)){const i=o.length;let u;for(const f of o){const v=Ir(f);if(u){if(u===v)continue;u=ze;break}u=v}return q(u||ze,i)}return Q}function Na(o){const i=typeof o;return o===null?"":i==="string"||i==="number"||i==="boolean"?String(o):o instanceof nn||o instanceof fr||o instanceof Rr||o instanceof wn||o instanceof hi?o.toString():JSON.stringify(o)}class Ba{constructor(i,u){this.type=i,this.value=u}static parse(i,u){if(i.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${i.length-1} instead.`);if(!Ti(i[1]))return u.error("invalid value");const f=i[1];let v=Ir(f);const b=u.expectedType;return v.kind!=="array"||v.N!==0||!b||b.kind!=="array"||typeof b.N=="number"&&b.N!==0||(v=b),new Ba(v,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class $n{constructor(i){this.name="ExpressionEvaluationError",this.message=i}toJSON(){return this.message}}const Ei={string:Ut,number:lt,boolean:Zt,object:Q};class zi{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");let f,v=1;const b=i[0];if(b==="array"){let E,R;if(i.length>2){const L=i[1];if(typeof L!="string"||!(L in Ei)||L==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ei[L],v++}else E=ze;if(i.length>3){if(i[2]!==null&&(typeof i[2]!="number"||i[2]<0||i[2]!==Math.floor(i[2])))return u.error('The length argument to "array" must be a positive integer literal',2);R=i[2],v++}f=q(E,R)}else{if(!Ei[b])throw new Error(`Types doesn't contain name = ${b}`);f=Ei[b]}const w=[];for(;v<i.length;v++){const E=u.parse(i[v],v,ze);if(!E)return null;w.push(E)}return new zi(f,w)}evaluate(i){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(i);if(!we(this.type,Ir(f)))return f;if(u===this.args.length-1)throw new $n(`Expected value to be of type ${te(this.type)}, but found ${te(Ir(f))} instead.`)}throw new Error}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const vi={"to-boolean":Zt,"to-color":yn,"to-number":lt,"to-string":Ut};class Wi{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[0];if(!vi[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&i.length!==2)return u.error("Expected one argument.");const v=vi[f],b=[];for(let w=1;w<i.length;w++){const E=u.parse(i[w],w,ze);if(!E)return null;b.push(E)}return new Wi(v,b)}evaluate(i){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(i);case"color":{let u,f;for(const v of this.args){if(u=v.evaluate(i),f=null,u instanceof nn)return u;if(typeof u=="string"){const b=i.parseColor(u);if(b)return b}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:pr(u[0],u[1],u[2],u[3]),!f))return new nn(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new $n(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(i);const v=Rr.parse(u);if(v)return v}throw new $n(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(i);const v=wn.parse(u);if(v)return v}throw new $n(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(i),u===null)return 0;const v=Number(u);if(!isNaN(v))return v}throw new $n(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return fr.fromString(Na(this.args[0].evaluate(i)));case"resolvedImage":return hi.fromString(Na(this.args[0].evaluate(i)));default:return Na(this.args[0].evaluate(i))}}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}const Bc=["Unknown","Point","LineString","Polygon"];class Ps{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Bc[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(i){let u=this._parseColorCache[i];return u||(u=this._parseColorCache[i]=nn.parse(i)),u}}class or{constructor(i,u,f=[],v,b=new xn,w=[]){this.registry=i,this.path=f,this.key=f.map(E=>`[${E}]`).join(""),this.scope=b,this.errors=w,this.expectedType=v,this._isConstant=u}parse(i,u,f,v,b={}){return u?this.concat(u,f,v)._parse(i,b):this._parse(i,b)}_parse(i,u){function f(v,b,w){return w==="assert"?new zi(b,[v]):w==="coerce"?new Wi(b,[v]):v}if(i!==null&&typeof i!="string"&&typeof i!="boolean"&&typeof i!="number"||(i=["literal",i]),Array.isArray(i)){if(i.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const v=i[0];if(typeof v!="string")return this.error(`Expression name must be a string, but found ${typeof v} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const b=this.registry[v];if(b){let w=b.parse(i,this);if(!w)return null;if(this.expectedType){const E=this.expectedType,R=w.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||R.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string")if(E.kind!=="padding"||R.kind!=="value"&&R.kind!=="number"&&R.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||R.kind!=="value"&&R.kind!=="array"){if(this.checkSubtype(E,R))return null}else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"coerce");else w=f(w,E,u.typeAnnotation||"assert")}if(!(w instanceof Ba)&&w.type.kind!=="resolvedImage"&&this._isConstant(w)){const E=new Ps;try{w=new Ba(w.type,w.evaluate(E))}catch(R){return this.error(R.message),null}}return w}return this.error(`Unknown expression "${v}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(i===void 0?"'undefined' value invalid. Use null instead.":typeof i=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof i} instead.`)}concat(i,u,f){const v=typeof i=="number"?this.path.concat(i):this.path,b=f?this.scope.concat(f):this.scope;return new or(this.registry,this._isConstant,v,u||null,b,this.errors)}error(i,...u){const f=`${this.key}${u.map(v=>`[${v}]`).join("")}`;this.errors.push(new Rn(f,i))}checkSubtype(i,u){const f=we(i,u);return f&&this.error(f),f}}class Xu{constructor(i,u,f){this.type=Qe,this.locale=f,this.caseSensitive=i,this.diacriticSensitive=u}static parse(i,u){if(i.length!==2)return u.error("Expected one argument.");const f=i[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const v=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,Zt);if(!v)return null;const b=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,Zt);if(!b)return null;let w=null;return f.locale&&(w=u.parse(f.locale,1,Ut),!w)?null:new Xu(v,b,w)}evaluate(i){return new yr(this.caseSensitive.evaluate(i),this.diacriticSensitive.evaluate(i),this.locale?this.locale.evaluate(i):null)}eachChild(i){i(this.caseSensitive),i(this.diacriticSensitive),this.locale&&i(this.locale)}outputDefined(){return!1}}const ss=8192;function ef(o,i){o[0]=Math.min(o[0],i[0]),o[1]=Math.min(o[1],i[1]),o[2]=Math.max(o[2],i[0]),o[3]=Math.max(o[3],i[1])}function Oc(o,i){return!(o[0]<=i[0]||o[2]>=i[2]||o[1]<=i[1]||o[3]>=i[3])}function Hp(o,i){const u=(180+o[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,v=Math.pow(2,i.z);return[Math.round(u*v*ss),Math.round(f*v*ss)]}function Uv(o,i,u){const f=o[0]-i[0],v=o[1]-i[1],b=o[0]-u[0],w=o[1]-u[1];return f*w-b*v==0&&f*b<=0&&v*w<=0}function Zu(o,i){let u=!1;for(let w=0,E=i.length;w<E;w++){const R=i[w];for(let L=0,j=R.length;L<j-1;L++){if(Uv(o,R[L],R[L+1]))return!1;(v=R[L])[1]>(f=o)[1]!=(b=R[L+1])[1]>f[1]&&f[0]<(b[0]-v[0])*(f[1]-v[1])/(b[1]-v[1])+v[0]&&(u=!u)}}var f,v,b;return u}function Gp(o,i){for(let u=0;u<i.length;u++)if(Zu(o,i[u]))return!0;return!1}function jp(o,i,u,f){const v=f[0]-u[0],b=f[1]-u[1],w=(o[0]-u[0])*b-v*(o[1]-u[1]),E=(i[0]-u[0])*b-v*(i[1]-u[1]);return w>0&&E<0||w<0&&E>0}function Vv(o,i,u){for(const L of u)for(let j=0;j<L.length-1;++j)if((E=[(w=L[j+1])[0]-(b=L[j])[0],w[1]-b[1]])[0]*(R=[(v=i)[0]-(f=o)[0],v[1]-f[1]])[1]-E[1]*R[0]!=0&&jp(f,v,b,w)&&jp(b,w,f,v))return!0;var f,v,b,w,E,R;return!1}function Wp(o,i){for(let u=0;u<o.length;++u)if(!Zu(o[u],i))return!1;for(let u=0;u<o.length-1;++u)if(Vv(o[u],o[u+1],i))return!1;return!0}function Hv(o,i){for(let u=0;u<i.length;u++)if(Wp(o,i[u]))return!0;return!1}function Yu(o,i,u){const f=[];for(let v=0;v<o.length;v++){const b=[];for(let w=0;w<o[v].length;w++){const E=Hp(o[v][w],u);ef(i,E),b.push(E)}f.push(b)}return f}function tf(o,i,u){const f=[];for(let v=0;v<o.length;v++){const b=Yu(o[v],i,u);f.push(b)}return f}function qp(o,i,u,f){if(o[0]<u[0]||o[0]>u[2]){const v=.5*f;let b=o[0]-u[0]>v?-f:u[0]-o[0]>v?f:0;b===0&&(b=o[0]-u[2]>v?-f:u[2]-o[0]>v?f:0),o[0]+=b}ef(i,o)}function $p(o,i,u,f){const v=Math.pow(2,f.z)*ss,b=[f.x*ss,f.y*ss],w=[];for(const E of o)for(const R of E){const L=[R.x+b[0],R.y+b[1]];qp(L,i,u,v),w.push(L)}return w}function Ku(o,i,u,f){const v=Math.pow(2,f.z)*ss,b=[f.x*ss,f.y*ss],w=[];for(const R of o){const L=[];for(const j of R){const W=[j.x+b[0],j.y+b[1]];ef(i,W),L.push(W)}w.push(L)}if(i[2]-i[0]<=v/2){(E=i)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const R of w)for(const L of R)qp(L,i,u,v)}var E;return w}class Co{constructor(i,u){this.type=Zt,this.geojson=i,this.geometries=u}static parse(i,u){if(i.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${i.length-1} instead.`);if(Ti(i[1])){const f=i[1];if(f.type==="FeatureCollection"){const v=[];for(const b of f.features){const{type:w,coordinates:E}=b.geometry;w==="Polygon"&&v.push(E),w==="MultiPolygon"&&v.push(...E)}if(v.length)return new Co(f,{type:"MultiPolygon",coordinates:v})}else if(f.type==="Feature"){const v=f.geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Co(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Co(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(i){if(i.geometry()!=null&&i.canonicalID()!=null){if(i.geometryType()==="Point")return function(u,f){const v=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=Yu(f.coordinates,b,w),R=$p(u.geometry(),v,b,w);if(!Oc(v,b))return!1;for(const L of R)if(!Zu(L,E))return!1}if(f.type==="MultiPolygon"){const E=tf(f.coordinates,b,w),R=$p(u.geometry(),v,b,w);if(!Oc(v,b))return!1;for(const L of R)if(!Gp(L,E))return!1}return!0}(i,this.geometries);if(i.geometryType()==="LineString")return function(u,f){const v=[1/0,1/0,-1/0,-1/0],b=[1/0,1/0,-1/0,-1/0],w=u.canonicalID();if(f.type==="Polygon"){const E=Yu(f.coordinates,b,w),R=Ku(u.geometry(),v,b,w);if(!Oc(v,b))return!1;for(const L of R)if(!Wp(L,E))return!1}if(f.type==="MultiPolygon"){const E=tf(f.coordinates,b,w),R=Ku(u.geometry(),v,b,w);if(!Oc(v,b))return!1;for(const L of R)if(!Hv(L,E))return!1}return!0}(i,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Ju{constructor(i,u){this.type=u.type,this.name=i,this.boundExpression=u}static parse(i,u){if(i.length!==2||typeof i[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=i[1];return u.scope.has(f)?new Ju(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(i){return this.boundExpression.evaluate(i)}eachChild(){}outputDefined(){return!1}}class Ma{constructor(i,u,f,v){this.name=i,this.type=u,this._evaluate=f,this.args=v}evaluate(i){return this._evaluate(i,this.args)}eachChild(i){this.args.forEach(i)}outputDefined(){return!1}static parse(i,u){const f=i[0],v=Ma.definitions[f];if(!v)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const b=Array.isArray(v)?v[0]:v.type,w=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,E=w.filter(([L])=>!Array.isArray(L)||L.length===i.length-1);let R=null;for(const[L,j]of E){R=new or(u.registry,Uc,u.path,null,u.scope);const W=[];let K=!1;for(let re=1;re<i.length;re++){const le=i[re],fe=Array.isArray(L)?L[re-1]:L.type,_e=R.parse(le,1+W.length,fe);if(!_e){K=!0;break}W.push(_e)}if(!K)if(Array.isArray(L)&&L.length!==W.length)R.error(`Expected ${L.length} arguments, but found ${W.length} instead.`);else{for(let re=0;re<W.length;re++){const le=Array.isArray(L)?L[re]:L.type,fe=W[re];R.concat(re+1).checkSubtype(le,fe.type)}if(R.errors.length===0)return new Ma(f,b,j,W)}}if(E.length===1)u.errors.push(...R.errors);else{const L=(E.length?E:w).map(([W])=>{return K=W,Array.isArray(K)?`(${K.map(te).join(", ")})`:`(${te(K.type)}...)`;var K}).join(" | "),j=[];for(let W=1;W<i.length;W++){const K=u.parse(i[W],1+j.length);if(!K)return null;j.push(te(K.type))}u.error(`Expected arguments of type ${L}, but found (${j.join(", ")}) instead.`)}return null}static register(i,u){Ma.definitions=u;for(const f in u)i[f]=Ma}}function Uc(o){if(o instanceof Ju)return Uc(o.boundExpression);if(o instanceof Ma&&o.name==="error"||o instanceof Xu||o instanceof Co)return!1;const i=o instanceof Wi||o instanceof zi;let u=!0;return o.eachChild(f=>{u=i?u&&Uc(f):u&&f instanceof Ba}),!!u&&Vc(o)&&Qu(o,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Vc(o){if(o instanceof Ma&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Co)return!1;let i=!0;return o.eachChild(u=>{i&&!Vc(u)&&(i=!1)}),i}function Hc(o){if(o instanceof Ma&&o.name==="feature-state")return!1;let i=!0;return o.eachChild(u=>{i&&!Hc(u)&&(i=!1)}),i}function Qu(o,i){if(o instanceof Ma&&i.indexOf(o.name)>=0)return!1;let u=!0;return o.eachChild(f=>{u&&!Qu(f,i)&&(u=!1)}),u}function Gc(o,i){const u=o.length-1;let f,v,b=0,w=u,E=0;for(;b<=w;)if(E=Math.floor((b+w)/2),f=o[E],v=o[E+1],f<=i){if(E===u||i<v)return E;b=E+1}else{if(!(f>i))throw new $n("Input is not a number.");w=E-1}return 0}class bl{constructor(i,u,f){this.type=i,this.input=u,this.labels=[],this.outputs=[];for(const[v,b]of f)this.labels.push(v),this.outputs.push(b)}static parse(i,u){if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(i[1],1,lt);if(!f)return null;const v=[];let b=null;u.expectedType&&u.expectedType.kind!=="value"&&(b=u.expectedType);for(let w=1;w<i.length;w+=2){const E=w===1?-1/0:i[w],R=i[w+1],L=w,j=w+1;if(typeof E!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(v.length&&v[v.length-1][0]>=E)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const W=u.parse(R,j,b);if(!W)return null;b=b||W.type,v.push([E,W])}return new bl(b,f,v)}evaluate(i){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return f[0].evaluate(i);const b=u.length;return v>=u[b-1]?f[b-1].evaluate(i):f[Gc(u,v)].evaluate(i)}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function Gv(o){return o&&o.__esModule&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o}var jv=Xp;function Xp(o,i,u,f){this.cx=3*o,this.bx=3*(u-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(f-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=i,this.p2x=u,this.p2y=f}Xp.prototype={sampleCurveX:function(o){return((this.ax*o+this.bx)*o+this.cx)*o},sampleCurveY:function(o){return((this.ay*o+this.by)*o+this.cy)*o},sampleCurveDerivativeX:function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},solveCurveX:function(o,i){if(i===void 0&&(i=1e-6),o<0)return 0;if(o>1)return 1;for(var u=o,f=0;f<8;f++){var v=this.sampleCurveX(u)-o;if(Math.abs(v)<i)return u;var b=this.sampleCurveDerivativeX(u);if(Math.abs(b)<1e-6)break;u-=v/b}var w=0,E=1;for(u=o,f=0;f<20&&(v=this.sampleCurveX(u),!(Math.abs(v-o)<i));f++)o>v?w=u:E=u,u=.5*(E-w)+w;return u},solve:function(o,i){return this.sampleCurveY(this.solveCurveX(o,i))}};var Wv=Gv(jv);function Po(o,i,u){return o+u*(i-o)}function eh(o,i,u){return o.map((f,v)=>Po(f,i[v],u))}const oa={number:Po,color:function(o,i,u,f="rgb"){switch(f){case"rgb":{const[v,b,w,E]=eh(o.rgb,i.rgb,u);return new nn(v,b,w,E,!1)}case"hcl":{const[v,b,w,E]=o.hcl,[R,L,j,W]=i.hcl;let K,re;if(isNaN(v)||isNaN(R))isNaN(v)?isNaN(R)?K=NaN:(K=R,w!==1&&w!==0||(re=L)):(K=v,j!==1&&j!==0||(re=b));else{let Ge=R-v;R>v&&Ge>180?Ge-=360:R<v&&v-R>180&&(Ge+=360),K=v+u*Ge}const[le,fe,_e,Ce]=function([Ge,De,Fe,dt]){return Ge=isNaN(Ge)?0:Ge*bn,$e([Fe,Math.cos(Ge)*De,Math.sin(Ge)*De,dt])}([K,re??Po(b,L,u),Po(w,j,u),Po(E,W,u)]);return new nn(le,fe,_e,Ce,!1)}case"lab":{const[v,b,w,E]=$e(eh(o.lab,i.lab,u));return new nn(v,b,w,E,!1)}}},array:eh,padding:function(o,i,u){return new Rr(eh(o.values,i.values,u))},variableAnchorOffsetCollection:function(o,i,u){const f=o.values,v=i.values;if(f.length!==v.length)throw new $n(`Cannot interpolate values of different length. from: ${o.toString()}, to: ${i.toString()}`);const b=[];for(let w=0;w<f.length;w+=2){if(f[w]!==v[w])throw new $n(`Cannot interpolate values containing mismatched anchors. from[${w}]: ${f[w]}, to[${w}]: ${v[w]}`);b.push(f[w]);const[E,R]=f[w+1],[L,j]=v[w+1];b.push([Po(E,L,u),Po(R,j,u)])}return new wn(b)}};class Fi{constructor(i,u,f,v,b){this.type=i,this.operator=u,this.interpolation=f,this.input=v,this.labels=[],this.outputs=[];for(const[w,E]of b)this.labels.push(w),this.outputs.push(E)}static interpolationFactor(i,u,f,v){let b=0;if(i.name==="exponential")b=wl(u,i.base,f,v);else if(i.name==="linear")b=wl(u,1,f,v);else if(i.name==="cubic-bezier"){const w=i.controlPoints;b=new Wv(w[0],w[1],w[2],w[3]).solve(wl(u,1,f,v))}return b}static parse(i,u){let[f,v,b,...w]=i;if(!Array.isArray(v)||v.length===0)return u.error("Expected an interpolation type expression.",1);if(v[0]==="linear")v={name:"linear"};else if(v[0]==="exponential"){const L=v[1];if(typeof L!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);v={name:"exponential",base:L}}else{if(v[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(v[0])}`,1,0);{const L=v.slice(1);if(L.length!==4||L.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);v={name:"cubic-bezier",controlPoints:L}}}if(i.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if((i.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(b=u.parse(b,2,lt),!b)return null;const E=[];let R=null;f==="interpolate-hcl"||f==="interpolate-lab"?R=yn:u.expectedType&&u.expectedType.kind!=="value"&&(R=u.expectedType);for(let L=0;L<w.length;L+=2){const j=w[L],W=w[L+1],K=L+3,re=L+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(E.length&&E[E.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',K);const le=u.parse(W,re,R);if(!le)return null;R=R||le.type,E.push([j,le])}return Pe(R,lt)||Pe(R,yn)||Pe(R,ae)||Pe(R,O)||Pe(R,q(lt))?new Fi(R,f,v,b,E):u.error(`Type ${te(R)} is not interpolatable.`)}evaluate(i){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(i);const v=this.input.evaluate(i);if(v<=u[0])return f[0].evaluate(i);const b=u.length;if(v>=u[b-1])return f[b-1].evaluate(i);const w=Gc(u,v),E=Fi.interpolationFactor(this.interpolation,v,u[w],u[w+1]),R=f[w].evaluate(i),L=f[w+1].evaluate(i);switch(this.operator){case"interpolate":return oa[this.type.kind](R,L,E);case"interpolate-hcl":return oa.color(R,L,E,"hcl");case"interpolate-lab":return oa.color(R,L,E,"lab")}}eachChild(i){i(this.input);for(const u of this.outputs)i(u)}outputDefined(){return this.outputs.every(i=>i.outputDefined())}}function wl(o,i,u,f){const v=f-u,b=o-u;return v===0?0:i===1?b/v:(Math.pow(i,b)-1)/(Math.pow(i,v)-1)}class nr{constructor(i,u){this.type=i,this.args=u}static parse(i,u){if(i.length<2)return u.error("Expectected at least one argument.");let f=null;const v=u.expectedType;v&&v.kind!=="value"&&(f=v);const b=[];for(const E of i.slice(1)){const R=u.parse(E,1+b.length,f,void 0,{typeAnnotation:"omit"});if(!R)return null;f=f||R.type,b.push(R)}if(!f)throw new Error("No output type");const w=v&&b.some(E=>we(v,E.type));return new nr(w?ze:f,b)}evaluate(i){let u,f=null,v=0;for(const b of this.args)if(v++,f=b.evaluate(i),f&&f instanceof hi&&!f.available&&(u||(u=f.name),f=null,v===this.args.length&&(f=u)),f!==null)break;return f}eachChild(i){this.args.forEach(i)}outputDefined(){return this.args.every(i=>i.outputDefined())}}class th{constructor(i,u){this.type=u.type,this.bindings=[].concat(i),this.result=u}evaluate(i){return this.result.evaluate(i)}eachChild(i){for(const u of this.bindings)i(u[1]);i(this.result)}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found ${i.length-1} instead.`);const f=[];for(let b=1;b<i.length-1;b+=2){const w=i[b];if(typeof w!="string")return u.error(`Expected string, but found ${typeof w} instead.`,b);if(/[^a-zA-Z0-9_]/.test(w))return u.error("Variable names must contain only alphanumeric characters or '_'.",b);const E=u.parse(i[b+1],b+1);if(!E)return null;f.push([w,E])}const v=u.parse(i[i.length-1],i.length-1,u.expectedType,f);return v?new th(f,v):null}outputDefined(){return this.result.outputDefined()}}class nf{constructor(i,u,f){this.type=i,this.index=u,this.input=f}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,lt),v=u.parse(i[2],2,q(u.expectedType||ze));return f&&v?new nf(v.type.itemType,f,v):null}evaluate(i){const u=this.index.evaluate(i),f=this.input.evaluate(i);if(u<0)throw new $n(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new $n(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new $n(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(i){i(this.index),i(this.input)}outputDefined(){return!1}}class rf{constructor(i,u){this.type=Zt,this.needle=i,this.haystack=u}static parse(i,u){if(i.length!==3)return u.error(`Expected 2 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,ze),v=u.parse(i[2],2,ze);return f&&v?Se(f.type,[Zt,Ut,lt,Qt,ze])?new rf(f,v):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(f.type)} instead`):null}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!f)return!1;if(!ge(u,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${te(Ir(u))} instead.`);if(!ge(f,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${te(Ir(f))} instead.`);return f.indexOf(u)>=0}eachChild(i){i(this.needle),i(this.haystack)}outputDefined(){return!0}}class nh{constructor(i,u,f){this.type=lt,this.needle=i,this.haystack=u,this.fromIndex=f}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,ze),v=u.parse(i[2],2,ze);if(!f||!v)return null;if(!Se(f.type,[Zt,Ut,lt,Qt,ze]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${te(f.type)} instead`);if(i.length===4){const b=u.parse(i[3],3,lt);return b?new nh(f,v,b):null}return new nh(f,v)}evaluate(i){const u=this.needle.evaluate(i),f=this.haystack.evaluate(i);if(!ge(u,["boolean","string","number","null"]))throw new $n(`Expected first argument to be of type boolean, string, number or null, but found ${te(Ir(u))} instead.`);if(!ge(f,["string","array"]))throw new $n(`Expected second argument to be of type array or string, but found ${te(Ir(f))} instead.`);if(this.fromIndex){const v=this.fromIndex.evaluate(i);return f.indexOf(u,v)}return f.indexOf(u)}eachChild(i){i(this.needle),i(this.haystack),this.fromIndex&&i(this.fromIndex)}outputDefined(){return!1}}class af{constructor(i,u,f,v,b,w){this.inputType=i,this.type=u,this.input=f,this.cases=v,this.outputs=b,this.otherwise=w}static parse(i,u){if(i.length<5)return u.error(`Expected at least 4 arguments, but found only ${i.length-1}.`);if(i.length%2!=1)return u.error("Expected an even number of arguments.");let f,v;u.expectedType&&u.expectedType.kind!=="value"&&(v=u.expectedType);const b={},w=[];for(let L=2;L<i.length-1;L+=2){let j=i[L];const W=i[L+1];Array.isArray(j)||(j=[j]);const K=u.concat(L);if(j.length===0)return K.error("Expected at least one branch label.");for(const le of j){if(typeof le!="number"&&typeof le!="string")return K.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return K.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof le=="number"&&Math.floor(le)!==le)return K.error("Numeric branch labels must be integer values.");if(f){if(K.checkSubtype(f,Ir(le)))return null}else f=Ir(le);if(b[String(le)]!==void 0)return K.error("Branch labels must be unique.");b[String(le)]=w.length}const re=u.parse(W,L,v);if(!re)return null;v=v||re.type,w.push(re)}const E=u.parse(i[1],1,ze);if(!E)return null;const R=u.parse(i[i.length-1],i.length-1,v);return R?E.type.kind!=="value"&&u.concat(1).checkSubtype(f,E.type)?null:new af(f,v,E,b,w,R):null}evaluate(i){const u=this.input.evaluate(i);return(Ir(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(i)}eachChild(i){i(this.input),this.outputs.forEach(i),i(this.otherwise)}outputDefined(){return this.outputs.every(i=>i.outputDefined())&&this.otherwise.outputDefined()}}class sf{constructor(i,u,f){this.type=i,this.branches=u,this.otherwise=f}static parse(i,u){if(i.length<4)return u.error(`Expected at least 3 arguments, but found only ${i.length-1}.`);if(i.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const v=[];for(let w=1;w<i.length-1;w+=2){const E=u.parse(i[w],w,Zt);if(!E)return null;const R=u.parse(i[w+1],w+1,f);if(!R)return null;v.push([E,R]),f=f||R.type}const b=u.parse(i[i.length-1],i.length-1,f);if(!b)return null;if(!f)throw new Error("Can't infer output type");return new sf(f,v,b)}evaluate(i){for(const[u,f]of this.branches)if(u.evaluate(i))return f.evaluate(i);return this.otherwise.evaluate(i)}eachChild(i){for(const[u,f]of this.branches)i(u),i(f);i(this.otherwise)}outputDefined(){return this.branches.every(([i,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class rh{constructor(i,u,f,v){this.type=i,this.input=u,this.beginIndex=f,this.endIndex=v}static parse(i,u){if(i.length<=2||i.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${i.length-1} instead.`);const f=u.parse(i[1],1,ze),v=u.parse(i[2],2,lt);if(!f||!v)return null;if(!Se(f.type,[q(ze),Ut,ze]))return u.error(`Expected first argument to be of type array or string, but found ${te(f.type)} instead`);if(i.length===4){const b=u.parse(i[3],3,lt);return b?new rh(f.type,f,v,b):null}return new rh(f.type,f,v)}evaluate(i){const u=this.input.evaluate(i),f=this.beginIndex.evaluate(i);if(!ge(u,["string","array"]))throw new $n(`Expected first argument to be of type array or string, but found ${te(Ir(u))} instead.`);if(this.endIndex){const v=this.endIndex.evaluate(i);return u.slice(f,v)}return u.slice(f)}eachChild(i){i(this.input),i(this.beginIndex),this.endIndex&&i(this.endIndex)}outputDefined(){return!1}}function Zp(o,i){return o==="=="||o==="!="?i.kind==="boolean"||i.kind==="string"||i.kind==="number"||i.kind==="null"||i.kind==="value":i.kind==="string"||i.kind==="number"||i.kind==="value"}function Yp(o,i,u,f){return f.compare(i,u)===0}function Sl(o,i,u){const f=o!=="=="&&o!=="!=";return class Y8{constructor(b,w,E){this.type=Zt,this.lhs=b,this.rhs=w,this.collator=E,this.hasUntypedArgument=b.type.kind==="value"||w.type.kind==="value"}static parse(b,w){if(b.length!==3&&b.length!==4)return w.error("Expected two or three arguments.");const E=b[0];let R=w.parse(b[1],1,ze);if(!R)return null;if(!Zp(E,R.type))return w.concat(1).error(`"${E}" comparisons are not supported for type '${te(R.type)}'.`);let L=w.parse(b[2],2,ze);if(!L)return null;if(!Zp(E,L.type))return w.concat(2).error(`"${E}" comparisons are not supported for type '${te(L.type)}'.`);if(R.type.kind!==L.type.kind&&R.type.kind!=="value"&&L.type.kind!=="value")return w.error(`Cannot compare types '${te(R.type)}' and '${te(L.type)}'.`);f&&(R.type.kind==="value"&&L.type.kind!=="value"?R=new zi(L.type,[R]):R.type.kind!=="value"&&L.type.kind==="value"&&(L=new zi(R.type,[L])));let j=null;if(b.length===4){if(R.type.kind!=="string"&&L.type.kind!=="string"&&R.type.kind!=="value"&&L.type.kind!=="value")return w.error("Cannot use collator to compare non-string types.");if(j=w.parse(b[3],3,Qe),!j)return null}return new Y8(R,L,j)}evaluate(b){const w=this.lhs.evaluate(b),E=this.rhs.evaluate(b);if(f&&this.hasUntypedArgument){const R=Ir(w),L=Ir(E);if(R.kind!==L.kind||R.kind!=="string"&&R.kind!=="number")throw new $n(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${R.kind}, ${L.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const R=Ir(w),L=Ir(E);if(R.kind!=="string"||L.kind!=="string")return i(b,w,E)}return this.collator?u(b,w,E,this.collator.evaluate(b)):i(b,w,E)}eachChild(b){b(this.lhs),b(this.rhs),this.collator&&b(this.collator)}outputDefined(){return!0}}}const qv=Sl("==",function(o,i,u){return i===u},Yp),$v=Sl("!=",function(o,i,u){return i!==u},function(o,i,u,f){return!Yp(0,i,u,f)}),Xv=Sl("<",function(o,i,u){return i<u},function(o,i,u,f){return f.compare(i,u)<0}),Zv=Sl(">",function(o,i,u){return i>u},function(o,i,u,f){return f.compare(i,u)>0}),Yv=Sl("<=",function(o,i,u){return i<=u},function(o,i,u,f){return f.compare(i,u)<=0}),Kv=Sl(">=",function(o,i,u){return i>=u},function(o,i,u,f){return f.compare(i,u)>=0});class of{constructor(i,u,f,v,b){this.type=Ut,this.number=i,this.locale=u,this.currency=f,this.minFractionDigits=v,this.maxFractionDigits=b}static parse(i,u){if(i.length!==3)return u.error("Expected two arguments.");const f=u.parse(i[1],1,lt);if(!f)return null;const v=i[2];if(typeof v!="object"||Array.isArray(v))return u.error("NumberFormat options argument must be an object.");let b=null;if(v.locale&&(b=u.parse(v.locale,1,Ut),!b))return null;let w=null;if(v.currency&&(w=u.parse(v.currency,1,Ut),!w))return null;let E=null;if(v["min-fraction-digits"]&&(E=u.parse(v["min-fraction-digits"],1,lt),!E))return null;let R=null;return v["max-fraction-digits"]&&(R=u.parse(v["max-fraction-digits"],1,lt),!R)?null:new of(f,b,w,E,R)}evaluate(i){return new Intl.NumberFormat(this.locale?this.locale.evaluate(i):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(i):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(i):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(i):void 0}).format(this.number.evaluate(i))}eachChild(i){i(this.number),this.locale&&i(this.locale),this.currency&&i(this.currency),this.minFractionDigits&&i(this.minFractionDigits),this.maxFractionDigits&&i(this.maxFractionDigits)}outputDefined(){return!1}}class ih{constructor(i){this.type=bt,this.sections=i}static parse(i,u){if(i.length<2)return u.error("Expected at least one argument.");const f=i[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const v=[];let b=!1;for(let w=1;w<=i.length-1;++w){const E=i[w];if(b&&typeof E=="object"&&!Array.isArray(E)){b=!1;let R=null;if(E["font-scale"]&&(R=u.parse(E["font-scale"],1,lt),!R))return null;let L=null;if(E["text-font"]&&(L=u.parse(E["text-font"],1,q(Ut)),!L))return null;let j=null;if(E["text-color"]&&(j=u.parse(E["text-color"],1,yn),!j))return null;const W=v[v.length-1];W.scale=R,W.font=L,W.textColor=j}else{const R=u.parse(i[w],1,ze);if(!R)return null;const L=R.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");b=!0,v.push({content:R,scale:null,font:null,textColor:null})}}return new ih(v)}evaluate(i){return new fr(this.sections.map(u=>{const f=u.content.evaluate(i);return Ir(f)===F?new Zr("",f,null,null,null):new Zr(Na(f),null,u.scale?u.scale.evaluate(i):null,u.font?u.font.evaluate(i).join(","):null,u.textColor?u.textColor.evaluate(i):null)}))}eachChild(i){for(const u of this.sections)i(u.content),u.scale&&i(u.scale),u.font&&i(u.font),u.textColor&&i(u.textColor)}outputDefined(){return!1}}class lf{constructor(i){this.type=F,this.input=i}static parse(i,u){if(i.length!==2)return u.error("Expected two arguments.");const f=u.parse(i[1],1,Ut);return f?new lf(f):u.error("No image name provided.")}evaluate(i){const u=this.input.evaluate(i),f=hi.fromString(u);return f&&i.availableImages&&(f.available=i.availableImages.indexOf(u)>-1),f}eachChild(i){i(this.input)}outputDefined(){return!1}}class cf{constructor(i){this.type=lt,this.input=i}static parse(i,u){if(i.length!==2)return u.error(`Expected 1 argument, but found ${i.length-1} instead.`);const f=u.parse(i[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${te(f.type)} instead.`):new cf(f):null}evaluate(i){const u=this.input.evaluate(i);if(typeof u=="string"||Array.isArray(u))return u.length;throw new $n(`Expected value to be of type string or array, but found ${te(Ir(u))} instead.`)}eachChild(i){i(this.input)}outputDefined(){return!1}}const Ml={"==":qv,"!=":$v,">":Zv,"<":Xv,">=":Kv,"<=":Yv,array:zi,at:nf,boolean:zi,case:sf,coalesce:nr,collator:Xu,format:ih,image:lf,in:rf,"index-of":nh,interpolate:Fi,"interpolate-hcl":Fi,"interpolate-lab":Fi,length:cf,let:th,literal:Ba,match:af,number:zi,"number-format":of,object:zi,slice:rh,step:bl,string:zi,"to-boolean":Wi,"to-color":Wi,"to-number":Wi,"to-string":Wi,var:Ju,within:Co};function Kp(o,[i,u,f,v]){i=i.evaluate(o),u=u.evaluate(o),f=f.evaluate(o);const b=v?v.evaluate(o):1,w=pr(i,u,f,b);if(w)throw new $n(w);return new nn(i/255,u/255,f/255,b,!1)}function Jp(o,i){return o in i}function uf(o,i){const u=i[o];return u===void 0?null:u}function Ro(o){return{type:o}}function Qp(o){return{result:"success",value:o}}function Tl(o){return{result:"error",value:o}}function El(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function em(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function hf(o){return!!o.expression&&o.expression.interpolated}function rr(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Al(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function Jv(o){return o}function tm(o,i){const u=i.type==="color",f=o.stops&&typeof o.stops[0][0]=="object",v=f||!(f||o.property!==void 0),b=o.type||(hf(i)?"exponential":"interval");if(u||i.type==="padding"){const j=u?nn.parse:Rr.parse;(o=on({},o)).stops&&(o.stops=o.stops.map(W=>[W[0],j(W[1])])),o.default=j(o.default?o.default:i.default)}if(o.colorSpace&&(w=o.colorSpace)!=="rgb"&&w!=="hcl"&&w!=="lab")throw new Error(`Unknown color space: "${o.colorSpace}"`);var w;let E,R,L;if(b==="exponential")E=nm;else if(b==="interval")E=Vr;else if(b==="categorical"){E=Qv,R=Object.create(null);for(const j of o.stops)R[j[0]]=j[1];L=typeof o.stops[0][0]}else{if(b!=="identity")throw new Error(`Unknown function type "${b}"`);E=er}if(f){const j={},W=[];for(let le=0;le<o.stops.length;le++){const fe=o.stops[le],_e=fe[0].zoom;j[_e]===void 0&&(j[_e]={zoom:_e,type:o.type,property:o.property,default:o.default,stops:[]},W.push(_e)),j[_e].stops.push([fe[0].value,fe[1]])}const K=[];for(const le of W)K.push([j[le].zoom,tm(j[le],i)]);const re={name:"linear"};return{kind:"composite",interpolationType:re,interpolationFactor:Fi.interpolationFactor.bind(void 0,re),zoomStops:K.map(le=>le[0]),evaluate:({zoom:le},fe)=>nm({stops:K,base:o.base},i,le).evaluate(le,fe)}}if(v){const j=b==="exponential"?{name:"exponential",base:o.base!==void 0?o.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:Fi.interpolationFactor.bind(void 0,j),zoomStops:o.stops.map(W=>W[0]),evaluate:({zoom:W})=>E(o,i,W,R,L)}}return{kind:"source",evaluate(j,W){const K=W&&W.properties?W.properties[o.property]:void 0;return K===void 0?jc(o.default,i.default):E(o,i,K,R,L)}}}function jc(o,i,u){return o!==void 0?o:i!==void 0?i:u!==void 0?u:void 0}function Qv(o,i,u,f,v){return jc(typeof u===v?f[u]:void 0,o.default,i.default)}function Vr(o,i,u){if(rr(u)!=="number")return jc(o.default,i.default);const f=o.stops.length;if(f===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[f-1][0])return o.stops[f-1][1];const v=Gc(o.stops.map(b=>b[0]),u);return o.stops[v][1]}function nm(o,i,u){const f=o.base!==void 0?o.base:1;if(rr(u)!=="number")return jc(o.default,i.default);const v=o.stops.length;if(v===1||u<=o.stops[0][0])return o.stops[0][1];if(u>=o.stops[v-1][0])return o.stops[v-1][1];const b=Gc(o.stops.map(j=>j[0]),u),w=function(j,W,K,re){const le=re-K,fe=j-K;return le===0?0:W===1?fe/le:(Math.pow(W,fe)-1)/(Math.pow(W,le)-1)}(u,f,o.stops[b][0],o.stops[b+1][0]),E=o.stops[b][1],R=o.stops[b+1][1],L=oa[i.type]||Jv;return typeof E.evaluate=="function"?{evaluate(...j){const W=E.evaluate.apply(void 0,j),K=R.evaluate.apply(void 0,j);if(W!==void 0&&K!==void 0)return L(W,K,w,o.colorSpace)}}:L(E,R,w,o.colorSpace)}function er(o,i,u){switch(i.type){case"color":u=nn.parse(u);break;case"formatted":u=fr.fromString(u.toString());break;case"resolvedImage":u=hi.fromString(u.toString());break;case"padding":u=Rr.parse(u);break;default:rr(u)===i.type||i.type==="enum"&&i.values[u]||(u=void 0)}return jc(u,o.default,i.default)}Ma.register(Ml,{error:[{kind:"error"},[Ut],(o,[i])=>{throw new $n(i.evaluate(o))}],typeof:[Ut,[ze],(o,[i])=>te(Ir(i.evaluate(o)))],"to-rgba":[q(lt,4),[yn],(o,[i])=>{const[u,f,v,b]=i.evaluate(o).rgb;return[255*u,255*f,255*v,b]}],rgb:[yn,[lt,lt,lt],Kp],rgba:[yn,[lt,lt,lt,lt],Kp],has:{type:Zt,overloads:[[[Ut],(o,[i])=>Jp(i.evaluate(o),o.properties())],[[Ut,Q],(o,[i,u])=>Jp(i.evaluate(o),u.evaluate(o))]]},get:{type:ze,overloads:[[[Ut],(o,[i])=>uf(i.evaluate(o),o.properties())],[[Ut,Q],(o,[i,u])=>uf(i.evaluate(o),u.evaluate(o))]]},"feature-state":[ze,[Ut],(o,[i])=>uf(i.evaluate(o),o.featureState||{})],properties:[Q,[],o=>o.properties()],"geometry-type":[Ut,[],o=>o.geometryType()],id:[ze,[],o=>o.id()],zoom:[lt,[],o=>o.globals.zoom],"heatmap-density":[lt,[],o=>o.globals.heatmapDensity||0],"line-progress":[lt,[],o=>o.globals.lineProgress||0],accumulated:[ze,[],o=>o.globals.accumulated===void 0?null:o.globals.accumulated],"+":[lt,Ro(lt),(o,i)=>{let u=0;for(const f of i)u+=f.evaluate(o);return u}],"*":[lt,Ro(lt),(o,i)=>{let u=1;for(const f of i)u*=f.evaluate(o);return u}],"-":{type:lt,overloads:[[[lt,lt],(o,[i,u])=>i.evaluate(o)-u.evaluate(o)],[[lt],(o,[i])=>-i.evaluate(o)]]},"/":[lt,[lt,lt],(o,[i,u])=>i.evaluate(o)/u.evaluate(o)],"%":[lt,[lt,lt],(o,[i,u])=>i.evaluate(o)%u.evaluate(o)],ln2:[lt,[],()=>Math.LN2],pi:[lt,[],()=>Math.PI],e:[lt,[],()=>Math.E],"^":[lt,[lt,lt],(o,[i,u])=>Math.pow(i.evaluate(o),u.evaluate(o))],sqrt:[lt,[lt],(o,[i])=>Math.sqrt(i.evaluate(o))],log10:[lt,[lt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN10],ln:[lt,[lt],(o,[i])=>Math.log(i.evaluate(o))],log2:[lt,[lt],(o,[i])=>Math.log(i.evaluate(o))/Math.LN2],sin:[lt,[lt],(o,[i])=>Math.sin(i.evaluate(o))],cos:[lt,[lt],(o,[i])=>Math.cos(i.evaluate(o))],tan:[lt,[lt],(o,[i])=>Math.tan(i.evaluate(o))],asin:[lt,[lt],(o,[i])=>Math.asin(i.evaluate(o))],acos:[lt,[lt],(o,[i])=>Math.acos(i.evaluate(o))],atan:[lt,[lt],(o,[i])=>Math.atan(i.evaluate(o))],min:[lt,Ro(lt),(o,i)=>Math.min(...i.map(u=>u.evaluate(o)))],max:[lt,Ro(lt),(o,i)=>Math.max(...i.map(u=>u.evaluate(o)))],abs:[lt,[lt],(o,[i])=>Math.abs(i.evaluate(o))],round:[lt,[lt],(o,[i])=>{const u=i.evaluate(o);return u<0?-Math.round(-u):Math.round(u)}],floor:[lt,[lt],(o,[i])=>Math.floor(i.evaluate(o))],ceil:[lt,[lt],(o,[i])=>Math.ceil(i.evaluate(o))],"filter-==":[Zt,[Ut,ze],(o,[i,u])=>o.properties()[i.value]===u.value],"filter-id-==":[Zt,[ze],(o,[i])=>o.id()===i.value],"filter-type-==":[Zt,[Ut],(o,[i])=>o.geometryType()===i.value],"filter-<":[Zt,[Ut,ze],(o,[i,u])=>{const f=o.properties()[i.value],v=u.value;return typeof f==typeof v&&f<v}],"filter-id-<":[Zt,[ze],(o,[i])=>{const u=o.id(),f=i.value;return typeof u==typeof f&&u<f}],"filter->":[Zt,[Ut,ze],(o,[i,u])=>{const f=o.properties()[i.value],v=u.value;return typeof f==typeof v&&f>v}],"filter-id->":[Zt,[ze],(o,[i])=>{const u=o.id(),f=i.value;return typeof u==typeof f&&u>f}],"filter-<=":[Zt,[Ut,ze],(o,[i,u])=>{const f=o.properties()[i.value],v=u.value;return typeof f==typeof v&&f<=v}],"filter-id-<=":[Zt,[ze],(o,[i])=>{const u=o.id(),f=i.value;return typeof u==typeof f&&u<=f}],"filter->=":[Zt,[Ut,ze],(o,[i,u])=>{const f=o.properties()[i.value],v=u.value;return typeof f==typeof v&&f>=v}],"filter-id->=":[Zt,[ze],(o,[i])=>{const u=o.id(),f=i.value;return typeof u==typeof f&&u>=f}],"filter-has":[Zt,[ze],(o,[i])=>i.value in o.properties()],"filter-has-id":[Zt,[],o=>o.id()!==null&&o.id()!==void 0],"filter-type-in":[Zt,[q(Ut)],(o,[i])=>i.value.indexOf(o.geometryType())>=0],"filter-id-in":[Zt,[q(ze)],(o,[i])=>i.value.indexOf(o.id())>=0],"filter-in-small":[Zt,[Ut,q(ze)],(o,[i,u])=>u.value.indexOf(o.properties()[i.value])>=0],"filter-in-large":[Zt,[Ut,q(ze)],(o,[i,u])=>function(f,v,b,w){for(;b<=w;){const E=b+w>>1;if(v[E]===f)return!0;v[E]>f?w=E-1:b=E+1}return!1}(o.properties()[i.value],u.value,0,u.value.length-1)],all:{type:Zt,overloads:[[[Zt,Zt],(o,[i,u])=>i.evaluate(o)&&u.evaluate(o)],[Ro(Zt),(o,i)=>{for(const u of i)if(!u.evaluate(o))return!1;return!0}]]},any:{type:Zt,overloads:[[[Zt,Zt],(o,[i,u])=>i.evaluate(o)||u.evaluate(o)],[Ro(Zt),(o,i)=>{for(const u of i)if(u.evaluate(o))return!0;return!1}]]},"!":[Zt,[Zt],(o,[i])=>!i.evaluate(o)],"is-supported-script":[Zt,[Ut],(o,[i])=>{const u=o.globals&&o.globals.isSupportedScript;return!u||u(i.evaluate(o))}],upcase:[Ut,[Ut],(o,[i])=>i.evaluate(o).toUpperCase()],downcase:[Ut,[Ut],(o,[i])=>i.evaluate(o).toLowerCase()],concat:[Ut,Ro(ze),(o,i)=>i.map(u=>Na(u.evaluate(o))).join("")],"resolved-locale":[Ut,[Qe],(o,[i])=>i.evaluate(o).resolvedLocale()]});class Wc{constructor(i,u){var f;this.expression=i,this._warningHistory={},this._evaluator=new Ps,this._defaultValue=u?(f=u).type==="color"&&Al(f.default)?new nn(0,0,0,0):f.type==="color"?nn.parse(f.default)||null:f.type==="padding"?Rr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?wn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(i,u,f,v,b,w){return this._evaluator.globals=i,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=v,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w,this.expression.evaluate(this._evaluator)}evaluate(i,u,f,v,b,w){this._evaluator.globals=i,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=v,this._evaluator.availableImages=b||null,this._evaluator.formattedSection=w||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new $n(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function mr(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in Ml}function hr(o,i){const u=new or(Ml,Uc,[],i?function(v){const b={color:yn,string:Ut,number:lt,enum:Ut,boolean:Zt,formatted:bt,padding:ae,resolvedImage:F,variableAnchorOffsetCollection:O};return v.type==="array"?q(b[v.value]||ze,v.length):b[v.type]}(i):void 0),f=u.parse(o,void 0,void 0,void 0,i&&i.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?Qp(new Wc(f,i)):Tl(u.errors)}class Cl{constructor(i,u){this.kind=i,this._styleExpression=u,this.isStateDependent=i!=="constant"&&!Hc(u.expression)}evaluateWithoutErrorHandling(i,u,f,v,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,v,b,w)}evaluate(i,u,f,v,b,w){return this._styleExpression.evaluate(i,u,f,v,b,w)}}class ah{constructor(i,u,f,v){this.kind=i,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=i!=="camera"&&!Hc(u.expression),this.interpolationType=v}evaluateWithoutErrorHandling(i,u,f,v,b,w){return this._styleExpression.evaluateWithoutErrorHandling(i,u,f,v,b,w)}evaluate(i,u,f,v,b,w){return this._styleExpression.evaluate(i,u,f,v,b,w)}interpolationFactor(i,u,f){return this.interpolationType?Fi.interpolationFactor(this.interpolationType,i,u,f):0}}function rm(o,i){const u=hr(o,i);if(u.result==="error")return u;const f=u.value.expression,v=Vc(f);if(!v&&!El(i))return Tl([new Rn("","data expressions not supported")]);const b=Qu(f,["zoom"]);if(!b&&!em(i))return Tl([new Rn("","zoom expressions not supported")]);const w=oh(f);return w||b?w instanceof Rn?Tl([w]):w instanceof Fi&&!hf(i)?Tl([new Rn("",'"interpolate" expressions cannot be used with this property')]):Qp(w?new ah(v?"camera":"composite",u.value,w.labels,w instanceof Fi?w.interpolation:void 0):new Cl(v?"constant":"source",u.value)):Tl([new Rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class sh{constructor(i,u){this._parameters=i,this._specification=u,on(this,tm(this._parameters,this._specification))}static deserialize(i){return new sh(i._parameters,i._specification)}static serialize(i){return{_parameters:i._parameters,_specification:i._specification}}}function oh(o){let i=null;if(o instanceof th)i=oh(o.result);else if(o instanceof nr){for(const u of o.args)if(i=oh(u),i)break}else(o instanceof bl||o instanceof Fi)&&o.input instanceof Ma&&o.input.name==="zoom"&&(i=o);return i instanceof Rn||o.eachChild(u=>{const f=oh(u);f instanceof Rn?i=f:!i&&f?i=new Rn("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):i&&f&&i!==f&&(i=new Rn("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),i}function df(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const i of o.slice(1))if(!df(i)&&typeof i!="boolean")return!1;return!0;default:return!0}}const im={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function lh(o){if(o==null)return{filter:()=>!0,needGeometry:!1};df(o)||(o=Pl(o));const i=hr(o,im);if(i.result==="error")throw new Error(i.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,v)=>i.value.evaluate(u,f,{},v),needGeometry:ff(o)}}function am(o,i){return o<i?-1:o>i?1:0}function ff(o){if(!Array.isArray(o))return!1;if(o[0]==="within")return!0;for(let i=1;i<o.length;i++)if(ff(o[i]))return!0;return!1}function Pl(o){if(!o)return!0;const i=o[0];return o.length<=1?i!=="any":i==="=="?pf(o[1],o[2],"=="):i==="!="?ch(pf(o[1],o[2],"==")):i==="<"||i===">"||i==="<="||i===">="?pf(o[1],o[2],i):i==="any"?(u=o.slice(1),["any"].concat(u.map(Pl))):i==="all"?["all"].concat(o.slice(1).map(Pl)):i==="none"?["all"].concat(o.slice(1).map(Pl).map(ch)):i==="in"?sm(o[1],o.slice(2)):i==="!in"?ch(sm(o[1],o.slice(2))):i==="has"?om(o[1]):i==="!has"?ch(om(o[1])):i!=="within"||o;var u}function pf(o,i,u){switch(o){case"$type":return[`filter-type-${u}`,i];case"$id":return[`filter-id-${u}`,i];default:return[`filter-${u}`,o,i]}}function sm(o,i){if(i.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",i]];case"$id":return["filter-id-in",["literal",i]];default:return i.length>200&&!i.some(u=>typeof u!=typeof i[0])?["filter-in-large",o,["literal",i.sort(am)]]:["filter-in-small",o,["literal",i]]}}function om(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function ch(o){return["!",o]}function mf(o){const i=typeof o;if(i==="number"||i==="boolean"||i==="string"||o==null)return JSON.stringify(o);if(Array.isArray(o)){let v="[";for(const b of o)v+=`${mf(b)},`;return`${v}]`}const u=Object.keys(o).sort();let f="{";for(let v=0;v<u.length;v++)f+=`${JSON.stringify(u[v])}:${mf(o[u[v]])},`;return`${f}}`}function ey(o){let i="";for(const u of qn)i+=`/${mf(o[u])}`;return i}function lm(o){const i=o.value;return i?[new He(o.key,i,"constants have been deprecated as of v8")]:[]}function Nr(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Qs(o){if(Array.isArray(o))return o.map(Qs);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const i={};for(const u in o)i[u]=Qs(o[u]);return i}return Nr(o)}function la(o){const i=o.key,u=o.value,f=o.valueSpec||{},v=o.objectElementValidators||{},b=o.style,w=o.styleSpec,E=o.validateSpec;let R=[];const L=rr(u);if(L!=="object")return[new He(i,u,`object expected, ${L} found`)];for(const j in u){const W=j.split(".")[0],K=f[W]||f["*"];let re;if(v[W])re=v[W];else if(f[W])re=E;else if(v["*"])re=v["*"];else{if(!f["*"]){R.push(new He(i,u[j],`unknown property "${j}"`));continue}re=E}R=R.concat(re({key:(i&&`${i}.`)+j,value:u[j],valueSpec:K,style:b,styleSpec:w,object:u,objectKey:j,validateSpec:E},u))}for(const j in f)v[j]||f[j].required&&f[j].default===void 0&&u[j]===void 0&&R.push(new He(i,u,`missing required property "${j}"`));return R}function Rl(o){const i=o.value,u=o.valueSpec,f=o.style,v=o.styleSpec,b=o.key,w=o.arrayElementValidator||o.validateSpec;if(rr(i)!=="array")return[new He(b,i,`array expected, ${rr(i)} found`)];if(u.length&&i.length!==u.length)return[new He(b,i,`array length ${u.length} expected, length ${i.length} found`)];if(u["min-length"]&&i.length<u["min-length"])return[new He(b,i,`array length at least ${u["min-length"]} expected, length ${i.length} found`)];let E={type:u.value,values:u.values};v.$version<7&&(E.function=u.function),rr(u.value)==="object"&&(E=u.value);let R=[];for(let L=0;L<i.length;L++)R=R.concat(w({array:i,arrayIndex:L,value:i[L],valueSpec:E,validateSpec:o.validateSpec,style:f,styleSpec:v,key:`${b}[${L}]`}));return R}function gf(o){const i=o.key,u=o.value,f=o.valueSpec;let v=rr(u);return v==="number"&&u!=u&&(v="NaN"),v!=="number"?[new He(i,u,`number expected, ${v} found`)]:"minimum"in f&&u<f.minimum?[new He(i,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new He(i,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function vf(o){const i=o.valueSpec,u=Nr(o.value.type);let f,v,b,w={};const E=u!=="categorical"&&o.value.property===void 0,R=!E,L=rr(o.value.stops)==="array"&&rr(o.value.stops[0])==="array"&&rr(o.value.stops[0][0])==="object",j=la({key:o.key,value:o.value,valueSpec:o.styleSpec.function,validateSpec:o.validateSpec,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(re){if(u==="identity")return[new He(re.key,re.value,'identity function may not have a "stops" property')];let le=[];const fe=re.value;return le=le.concat(Rl({key:re.key,value:fe,valueSpec:re.valueSpec,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,arrayElementValidator:W})),rr(fe)==="array"&&fe.length===0&&le.push(new He(re.key,fe,"array must have at least one stop")),le},default:function(re){return re.validateSpec({key:re.key,value:re.value,valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec})}}});return u==="identity"&&E&&j.push(new He(o.key,o.value,'missing required property "property"')),u==="identity"||o.value.stops||j.push(new He(o.key,o.value,'missing required property "stops"')),u==="exponential"&&o.valueSpec.expression&&!hf(o.valueSpec)&&j.push(new He(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(R&&!El(o.valueSpec)?j.push(new He(o.key,o.value,"property functions not supported")):E&&!em(o.valueSpec)&&j.push(new He(o.key,o.value,"zoom functions not supported"))),u!=="categorical"&&!L||o.value.property!==void 0||j.push(new He(o.key,o.value,'"property" property is required')),j;function W(re){let le=[];const fe=re.value,_e=re.key;if(rr(fe)!=="array")return[new He(_e,fe,`array expected, ${rr(fe)} found`)];if(fe.length!==2)return[new He(_e,fe,`array length 2 expected, length ${fe.length} found`)];if(L){if(rr(fe[0])!=="object")return[new He(_e,fe,`object expected, ${rr(fe[0])} found`)];if(fe[0].zoom===void 0)return[new He(_e,fe,"object stop key must have zoom")];if(fe[0].value===void 0)return[new He(_e,fe,"object stop key must have value")];if(b&&b>Nr(fe[0].zoom))return[new He(_e,fe[0].zoom,"stop zoom values must appear in ascending order")];Nr(fe[0].zoom)!==b&&(b=Nr(fe[0].zoom),v=void 0,w={}),le=le.concat(la({key:`${_e}[0]`,value:fe[0],valueSpec:{zoom:{}},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec,objectElementValidators:{zoom:gf,value:K}}))}else le=le.concat(K({key:`${_e}[0]`,value:fe[0],valueSpec:{},validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec},fe));return mr(Qs(fe[1]))?le.concat([new He(`${_e}[1]`,fe[1],"expressions are not allowed in function stops.")]):le.concat(re.validateSpec({key:`${_e}[1]`,value:fe[1],valueSpec:i,validateSpec:re.validateSpec,style:re.style,styleSpec:re.styleSpec}))}function K(re,le){const fe=rr(re.value),_e=Nr(re.value),Ce=re.value!==null?re.value:le;if(f){if(fe!==f)return[new He(re.key,Ce,`${fe} stop domain type must match previous stop domain type ${f}`)]}else f=fe;if(fe!=="number"&&fe!=="string"&&fe!=="boolean")return[new He(re.key,Ce,"stop domain value must be a number, string, or boolean")];if(fe!=="number"&&u!=="categorical"){let Ge=`number expected, ${fe} found`;return El(i)&&u===void 0&&(Ge+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new He(re.key,Ce,Ge)]}return u!=="categorical"||fe!=="number"||isFinite(_e)&&Math.floor(_e)===_e?u!=="categorical"&&fe==="number"&&v!==void 0&&_e<v?[new He(re.key,Ce,"stop domain values must appear in ascending order")]:(v=_e,u==="categorical"&&_e in w?[new He(re.key,Ce,"stop domain values must be unique")]:(w[_e]=!0,[])):[new He(re.key,Ce,`integer expected, found ${_e}`)]}}function Il(o){const i=(o.expressionContext==="property"?rm:hr)(Qs(o.value),o.valueSpec);if(i.result==="error")return i.value.map(f=>new He(`${o.key}${f.key}`,o.value,f.message));const u=i.value.expression||i.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!u.outputDefined())return[new He(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Hc(u))return[new He(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Hc(u))return[new He(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Qu(u,["zoom","feature-state"]))return[new He(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!Vc(u))return[new He(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Io(o){const i=o.key,u=o.value,f=o.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Nr(u))===-1&&v.push(new He(i,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Nr(u))===-1&&v.push(new He(i,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),v}function Dl(o){return df(Qs(o.value))?Il(on({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):qc(o)}function qc(o){const i=o.value,u=o.key;if(rr(i)!=="array")return[new He(u,i,`array expected, ${rr(i)} found`)];const f=o.styleSpec;let v,b=[];if(i.length<1)return[new He(u,i,"filter array must have at least 1 element")];switch(b=b.concat(Io({key:`${u}[0]`,value:i[0],valueSpec:f.filter_operator,style:o.style,styleSpec:o.styleSpec})),Nr(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&Nr(i[1])==="$type"&&b.push(new He(u,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&b.push(new He(u,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(v=rr(i[1]),v!=="string"&&b.push(new He(`${u}[1]`,i[1],`string expected, ${v} found`)));for(let w=2;w<i.length;w++)v=rr(i[w]),Nr(i[1])==="$type"?b=b.concat(Io({key:`${u}[${w}]`,value:i[w],valueSpec:f.geometry_type,style:o.style,styleSpec:o.styleSpec})):v!=="string"&&v!=="number"&&v!=="boolean"&&b.push(new He(`${u}[${w}]`,i[w],`string, number, or boolean expected, ${v} found`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)b=b.concat(qc({key:`${u}[${w}]`,value:i[w],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":v=rr(i[1]),i.length!==2?b.push(new He(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="string"&&b.push(new He(`${u}[1]`,i[1],`string expected, ${v} found`));break;case"within":v=rr(i[1]),i.length!==2?b.push(new He(u,i,`filter array for "${i[0]}" operator must have 2 elements`)):v!=="object"&&b.push(new He(`${u}[1]`,i[1],`object expected, ${v} found`))}return b}function yf(o,i){const u=o.key,f=o.validateSpec,v=o.style,b=o.styleSpec,w=o.value,E=o.objectKey,R=b[`${i}_${o.layerType}`];if(!R)return[];const L=E.match(/^(.*)-transition$/);if(i==="paint"&&L&&R[L[1]]&&R[L[1]].transition)return f({key:u,value:w,valueSpec:b.transition,style:v,styleSpec:b});const j=o.valueSpec||R[E];if(!j)return[new He(u,w,`unknown property "${E}"`)];let W;if(rr(w)==="string"&&El(j)&&!j.tokens&&(W=/^{([^}]+)}$/.exec(w)))return[new He(u,w,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const K=[];return o.layerType==="symbol"&&(E==="text-field"&&v&&!v.glyphs&&K.push(new He(u,w,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Al(Qs(w))&&Nr(w.type)==="identity"&&K.push(new He(u,w,'"text-font" does not support identity functions'))),K.concat(f({key:o.key,value:w,valueSpec:j,style:v,styleSpec:b,expressionContext:"property",propertyType:i,propertyKey:E}))}function uh(o){return yf(o,"paint")}function _f(o){return yf(o,"layout")}function xf(o){let i=[];const u=o.value,f=o.key,v=o.style,b=o.styleSpec;u.type||u.ref||i.push(new He(f,u,'either "type" or "ref" is required'));let w=Nr(u.type);const E=Nr(u.ref);if(u.id){const R=Nr(u.id);for(let L=0;L<o.arrayIndex;L++){const j=v.layers[L];Nr(j.id)===R&&i.push(new He(f,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let R;["type","source","source-layer","filter","layout"].forEach(L=>{L in u&&i.push(new He(f,u[L],`"${L}" is prohibited for ref layers`))}),v.layers.forEach(L=>{Nr(L.id)===E&&(R=L)}),R?R.ref?i.push(new He(f,u.ref,"ref cannot reference another ref layer")):w=Nr(R.type):i.push(new He(f,u.ref,`ref layer "${E}" not found`))}else if(w!=="background")if(u.source){const R=v.sources&&v.sources[u.source],L=R&&Nr(R.type);R?L==="vector"&&w==="raster"?i.push(new He(f,u.source,`layer "${u.id}" requires a raster source`)):L!=="raster-dem"&&w==="hillshade"?i.push(new He(f,u.source,`layer "${u.id}" requires a raster-dem source`)):L==="raster"&&w!=="raster"?i.push(new He(f,u.source,`layer "${u.id}" requires a vector source`)):L!=="vector"||u["source-layer"]?L==="raster-dem"&&w!=="hillshade"?i.push(new He(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):w!=="line"||!u.paint||!u.paint["line-gradient"]||L==="geojson"&&R.lineMetrics||i.push(new He(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):i.push(new He(f,u,`layer "${u.id}" must specify a "source-layer"`)):i.push(new He(f,u.source,`source "${u.source}" not found`))}else i.push(new He(f,u,'missing required property "source"'));return i=i.concat(la({key:f,value:u,valueSpec:b.layer,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,objectElementValidators:{"*":()=>[],type:()=>o.validateSpec({key:`${f}.type`,value:u.type,valueSpec:b.layer.type,style:o.style,styleSpec:o.styleSpec,validateSpec:o.validateSpec,object:u,objectKey:"type"}),filter:Dl,layout:R=>la({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":L=>_f(on({layerType:w},L))}}),paint:R=>la({layer:u,key:R.key,value:R.value,style:R.style,styleSpec:R.styleSpec,validateSpec:R.validateSpec,objectElementValidators:{"*":L=>uh(on({layerType:w},L))}})}})),i}function os(o){const i=o.value,u=o.key,f=rr(i);return f!=="string"?[new He(u,i,`string expected, ${f} found`)]:[]}const cm={promoteId:function({key:o,value:i}){if(rr(i)==="string")return os({key:o,value:i});{const u=[];for(const f in i)u.push(...os({key:`${o}.${f}`,value:i[f]}));return u}}};function um(o){const i=o.value,u=o.key,f=o.styleSpec,v=o.style,b=o.validateSpec;if(!i.type)return[new He(u,i,'"type" is required')];const w=Nr(i.type);let E;switch(w){case"vector":case"raster":return E=la({key:u,value:i,valueSpec:f[`source_${w.replace("-","_")}`],style:o.style,styleSpec:f,objectElementValidators:cm,validateSpec:b}),E;case"raster-dem":return E=function(R){var L;const j=(L=R.sourceName)!==null&&L!==void 0?L:"",W=R.value,K=R.styleSpec,re=K.source_raster_dem,le=R.style;let fe=[];const _e=rr(W);if(W===void 0)return fe;if(_e!=="object")return fe.push(new He("source_raster_dem",W,`object expected, ${_e} found`)),fe;const Ce=Nr(W.encoding)==="custom",Ge=["redFactor","greenFactor","blueFactor","baseShift"],De=R.value.encoding?`"${R.value.encoding}"`:"Default";for(const Fe in W)!Ce&&Ge.includes(Fe)?fe.push(new He(Fe,W[Fe],`In "${j}": "${Fe}" is only valid when "encoding" is set to "custom". ${De} encoding found`)):re[Fe]?fe=fe.concat(R.validateSpec({key:Fe,value:W[Fe],valueSpec:re[Fe],validateSpec:R.validateSpec,style:le,styleSpec:K})):fe.push(new He(Fe,W[Fe],`unknown property "${Fe}"`));return fe}({sourceName:u,value:i,style:o.style,styleSpec:f,validateSpec:b}),E;case"geojson":if(E=la({key:u,value:i,valueSpec:f.source_geojson,style:v,styleSpec:f,validateSpec:b,objectElementValidators:cm}),i.cluster)for(const R in i.clusterProperties){const[L,j]=i.clusterProperties[R],W=typeof L=="string"?[L,["accumulated"],["get",R]]:L;E.push(...Il({key:`${u}.${R}.map`,value:j,validateSpec:b,expressionContext:"cluster-map"})),E.push(...Il({key:`${u}.${R}.reduce`,value:W,validateSpec:b,expressionContext:"cluster-reduce"}))}return E;case"video":return la({key:u,value:i,valueSpec:f.source_video,style:v,validateSpec:b,styleSpec:f});case"image":return la({key:u,value:i,valueSpec:f.source_image,style:v,validateSpec:b,styleSpec:f});case"canvas":return[new He(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Io({key:`${u}.type`,value:i.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,validateSpec:b,styleSpec:f})}}function hm(o){const i=o.value,u=o.styleSpec,f=u.light,v=o.style;let b=[];const w=rr(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new He("light",i,`object expected, ${w} found`)]),b;for(const E in i){const R=E.match(/^(.*)-transition$/);b=b.concat(R&&f[R[1]]&&f[R[1]].transition?o.validateSpec({key:E,value:i[E],valueSpec:u.transition,validateSpec:o.validateSpec,style:v,styleSpec:u}):f[E]?o.validateSpec({key:E,value:i[E],valueSpec:f[E],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new He(E,i[E],`unknown property "${E}"`)])}return b}function dm(o){const i=o.value,u=o.styleSpec,f=u.sky,v=o.style,b=rr(i);if(i===void 0)return[];if(b!=="object")return[new He("sky",i,`object expected, ${b} found`)];let w=[];for(const E in i)w=w.concat(f[E]?di({key:E,value:i[E],valueSpec:f[E],style:v,styleSpec:u}):[new He(E,i[E],`unknown property "${E}"`)]);return w}function fm(o){const i=o.value,u=o.styleSpec,f=u.terrain,v=o.style;let b=[];const w=rr(i);if(i===void 0)return b;if(w!=="object")return b=b.concat([new He("terrain",i,`object expected, ${w} found`)]),b;for(const E in i)b=b.concat(f[E]?o.validateSpec({key:E,value:i[E],valueSpec:f[E],validateSpec:o.validateSpec,style:v,styleSpec:u}):[new He(E,i[E],`unknown property "${E}"`)]);return b}function $c(o){let i=[];const u=o.value,f=o.key;if(Array.isArray(u)){const v=[],b=[];for(const w in u)u[w].id&&v.includes(u[w].id)&&i.push(new He(f,u,`all the sprites' ids must be unique, but ${u[w].id} is duplicated`)),v.push(u[w].id),u[w].url&&b.includes(u[w].url)&&i.push(new He(f,u,`all the sprites' URLs must be unique, but ${u[w].url} is duplicated`)),b.push(u[w].url),i=i.concat(la({key:`${f}[${w}]`,value:u[w],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:o.validateSpec}));return i}return os({key:f,value:u})}const Xc={"*":()=>[],array:Rl,boolean:function(o){const i=o.value,u=o.key,f=rr(i);return f!=="boolean"?[new He(u,i,`boolean expected, ${f} found`)]:[]},number:gf,color:function(o){const i=o.key,u=o.value,f=rr(u);return f!=="string"?[new He(i,u,`color expected, ${f} found`)]:nn.parse(String(u))?[]:[new He(i,u,`color expected, "${u}" found`)]},constants:lm,enum:Io,filter:Dl,function:vf,layer:xf,object:la,source:um,light:hm,sky:dm,terrain:fm,string:os,formatted:function(o){return os(o).length===0?[]:Il(o)},resolvedImage:function(o){return os(o).length===0?[]:Il(o)},padding:function(o){const i=o.key,u=o.value;if(rr(u)==="array"){if(u.length<1||u.length>4)return[new He(i,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let v=[];for(let b=0;b<u.length;b++)v=v.concat(o.validateSpec({key:`${i}[${b}]`,value:u[b],validateSpec:o.validateSpec,valueSpec:f}));return v}return gf({key:i,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(o){const i=o.key,u=o.value,f=rr(u),v=o.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new He(i,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let b=[];for(let w=0;w<u.length;w+=2)b=b.concat(Io({key:`${i}[${w}]`,value:u[w],valueSpec:v.layout_symbol["text-anchor"]})),b=b.concat(Rl({key:`${i}[${w+1}]`,value:u[w+1],valueSpec:{length:2,value:"number"},validateSpec:o.validateSpec,style:o.style,styleSpec:v}));return b},sprite:$c};function di(o){const i=o.value,u=o.valueSpec,f=o.styleSpec;return o.validateSpec=di,u.expression&&Al(Nr(i))?vf(o):u.expression&&mr(Qs(i))?Il(o):u.type&&Xc[u.type]?Xc[u.type](o):la(on({},o,{valueSpec:u.type?f[u.type]:u}))}function kl(o){const i=o.value,u=o.key,f=os(o);return f.length||(i.indexOf("{fontstack}")===-1&&f.push(new He(u,i,'"glyphs" url must include a "{fontstack}" token')),i.indexOf("{range}")===-1&&f.push(new He(u,i,'"glyphs" url must include a "{range}" token'))),f}function Ta(o,i=je){let u=[];return u=u.concat(di({key:"",value:o,valueSpec:i.$root,styleSpec:i,style:o,validateSpec:di,objectElementValidators:{glyphs:kl,"*":()=>[]}})),o.constants&&(u=u.concat(lm({key:"constants",value:o.constants,style:o,styleSpec:i,validateSpec:di}))),pm(u)}function ls(o){return function(i){return o({...i,validateSpec:di})}}function pm(o){return[].concat(o).sort((i,u)=>i.line-u.line)}function qi(o){return function(...i){return pm(o.apply(this,i))}}Ta.source=qi(ls(um)),Ta.sprite=qi(ls($c)),Ta.glyphs=qi(ls(kl)),Ta.light=qi(ls(hm)),Ta.sky=qi(ls(dm)),Ta.terrain=qi(ls(fm)),Ta.layer=qi(ls(xf)),Ta.filter=qi(ls(Dl)),Ta.paintProperty=qi(ls(uh)),Ta.layoutProperty=qi(ls(_f));const Ll=Ta,bf=Ll.light,ty=Ll.paintProperty,wf=Ll.layoutProperty;function mm(o,i){let u=!1;if(i&&i.length)for(const f of i)o.fire(new un(new Error(f.message))),u=!0;return u}class Rs{constructor(i,u,f){const v=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;const w=new Int32Array(this.arrayBuffer);i=w[0],this.d=(u=w[1])+2*(f=w[2]);for(let R=0;R<this.d*this.d;R++){const L=w[3+R],j=w[3+R+1];v.push(L===j?null:w.subarray(L,j))}const E=w[3+v.length+1];this.keys=w.subarray(w[3+v.length],E),this.bboxes=w.subarray(E),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let w=0;w<this.d*this.d;w++)v.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=f,this.scale=u/i,this.uid=0;const b=f/u*i;this.min=-b,this.max=i+b}insert(i,u,f,v,b){this._forEachCell(u,f,v,b,this._insertCell,this.uid++,void 0,void 0),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(v),this.bboxes.push(b)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(i,u,f,v,b,w){this.cells[b].push(w)}query(i,u,f,v,b){const w=this.min,E=this.max;if(i<=w&&u<=w&&E<=f&&E<=v&&!b)return Array.prototype.slice.call(this.keys);{const R=[];return this._forEachCell(i,u,f,v,this._queryCell,R,{},b),R}}_queryCell(i,u,f,v,b,w,E,R){const L=this.cells[b];if(L!==null){const j=this.keys,W=this.bboxes;for(let K=0;K<L.length;K++){const re=L[K];if(E[re]===void 0){const le=4*re;(R?R(W[le+0],W[le+1],W[le+2],W[le+3]):i<=W[le+2]&&u<=W[le+3]&&f>=W[le+0]&&v>=W[le+1])?(E[re]=!0,w.push(j[re])):E[re]=!1}}}}_forEachCell(i,u,f,v,b,w,E,R){const L=this._convertToCellCoord(i),j=this._convertToCellCoord(u),W=this._convertToCellCoord(f),K=this._convertToCellCoord(v);for(let re=L;re<=W;re++)for(let le=j;le<=K;le++){const fe=this.d*le+re;if((!R||R(this._convertFromCellCoord(re),this._convertFromCellCoord(le),this._convertFromCellCoord(re+1),this._convertFromCellCoord(le+1)))&&b.call(this,i,u,f,v,fe,w,E,R))return}}_convertFromCellCoord(i){return(i-this.padding)/this.scale}_convertToCellCoord(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const i=this.cells,u=3+this.cells.length+1+1;let f=0;for(let w=0;w<this.cells.length;w++)f+=this.cells[w].length;const v=new Int32Array(u+f+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;let b=u;for(let w=0;w<i.length;w++){const E=i[w];v[3+w]=b,v.set(E,b),b+=E.length}return v[3+i.length]=b,v.set(this.keys,b),b+=this.keys.length,v[3+i.length+1]=b,v.set(this.bboxes,b),b+=this.bboxes.length,v.buffer}static serialize(i,u){const f=i.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(i){return new Rs(i.buffer)}}const eo={};function Jt(o,i,u={}){if(eo[o])throw new Error(`${o} is already registered.`);Object.defineProperty(i,"_classRegistryKey",{value:o,writeable:!1}),eo[o]={klass:i,omit:u.omit||[],shallow:u.shallow||[]}}Jt("Object",Object),Jt("TransferableGridIndex",Rs),Jt("Color",nn),Jt("Error",Error),Jt("AJAXError",Sn),Jt("ResolvedImage",hi),Jt("StylePropertyFunction",sh),Jt("StyleExpression",Wc,{omit:["_evaluator"]}),Jt("ZoomDependentExpression",ah),Jt("ZoomConstantExpression",Cl),Jt("CompoundExpression",Ma,{omit:["_evaluate"]});for(const o in Ml)Ml[o]._classRegistryKey||Jt(`Expression_${o}`,Ml[o]);function Sf(o){return o&&typeof ArrayBuffer<"u"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Do(o,i){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error)return o;if(Sf(o)||ke(o))return i&&i.push(o),o;if(ArrayBuffer.isView(o)){const u=o;return i&&i.push(u.buffer),u}if(o instanceof ImageData)return i&&i.push(o.data.buffer),o;if(Array.isArray(o)){const u=[];for(const f of o)u.push(Do(f,i));return u}if(typeof o=="object"){const u=o.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${u.name}`);if(!eo[f])throw new Error(`${f} is not registered.`);const v=u.serialize?u.serialize(o,i):{};if(u.serialize){if(i&&v===i[i.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const b in o){if(!o.hasOwnProperty(b)||eo[f].omit.indexOf(b)>=0)continue;const w=o[b];v[b]=eo[f].shallow.indexOf(b)>=0?w:Do(w,i)}o instanceof Error&&(v.message=o.message)}if(v.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(v.$name=f),v}throw new Error("can't serialize object of type "+typeof o)}function zl(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||o instanceof Blob||o instanceof Error||Sf(o)||ke(o)||ArrayBuffer.isView(o)||o instanceof ImageData)return o;if(Array.isArray(o))return o.map(zl);if(typeof o=="object"){const i=o.$name||"Object";if(!eo[i])throw new Error(`can't deserialize unregistered class ${i}`);const{klass:u}=eo[i];if(!u)throw new Error(`can't deserialize unregistered class ${i}`);if(u.deserialize)return u.deserialize(o);const f=Object.create(u.prototype);for(const v of Object.keys(o)){if(v==="$name")continue;const b=o[v];f[v]=eo[i].shallow.indexOf(v)>=0?b:zl(b)}return f}throw new Error("can't deserialize object of type "+typeof o)}class Mf{constructor(){this.first=!0}update(i,u){const f=Math.floor(i);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=i,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),i!==this.lastZoom&&(this.lastZoom=i,this.lastFloorZoom=f,!0))}}const $t={"Latin-1 Supplement":o=>o>=128&&o<=255,Arabic:o=>o>=1536&&o<=1791,"Arabic Supplement":o=>o>=1872&&o<=1919,"Arabic Extended-A":o=>o>=2208&&o<=2303,"Hangul Jamo":o=>o>=4352&&o<=4607,"Unified Canadian Aboriginal Syllabics":o=>o>=5120&&o<=5759,Khmer:o=>o>=6016&&o<=6143,"Unified Canadian Aboriginal Syllabics Extended":o=>o>=6320&&o<=6399,"General Punctuation":o=>o>=8192&&o<=8303,"Letterlike Symbols":o=>o>=8448&&o<=8527,"Number Forms":o=>o>=8528&&o<=8591,"Miscellaneous Technical":o=>o>=8960&&o<=9215,"Control Pictures":o=>o>=9216&&o<=9279,"Optical Character Recognition":o=>o>=9280&&o<=9311,"Enclosed Alphanumerics":o=>o>=9312&&o<=9471,"Geometric Shapes":o=>o>=9632&&o<=9727,"Miscellaneous Symbols":o=>o>=9728&&o<=9983,"Miscellaneous Symbols and Arrows":o=>o>=11008&&o<=11263,"CJK Radicals Supplement":o=>o>=11904&&o<=12031,"Kangxi Radicals":o=>o>=12032&&o<=12255,"Ideographic Description Characters":o=>o>=12272&&o<=12287,"CJK Symbols and Punctuation":o=>o>=12288&&o<=12351,Hiragana:o=>o>=12352&&o<=12447,Katakana:o=>o>=12448&&o<=12543,Bopomofo:o=>o>=12544&&o<=12591,"Hangul Compatibility Jamo":o=>o>=12592&&o<=12687,Kanbun:o=>o>=12688&&o<=12703,"Bopomofo Extended":o=>o>=12704&&o<=12735,"CJK Strokes":o=>o>=12736&&o<=12783,"Katakana Phonetic Extensions":o=>o>=12784&&o<=12799,"Enclosed CJK Letters and Months":o=>o>=12800&&o<=13055,"CJK Compatibility":o=>o>=13056&&o<=13311,"CJK Unified Ideographs Extension A":o=>o>=13312&&o<=19903,"Yijing Hexagram Symbols":o=>o>=19904&&o<=19967,"CJK Unified Ideographs":o=>o>=19968&&o<=40959,"Yi Syllables":o=>o>=40960&&o<=42127,"Yi Radicals":o=>o>=42128&&o<=42191,"Hangul Jamo Extended-A":o=>o>=43360&&o<=43391,"Hangul Syllables":o=>o>=44032&&o<=55215,"Hangul Jamo Extended-B":o=>o>=55216&&o<=55295,"Private Use Area":o=>o>=57344&&o<=63743,"CJK Compatibility Ideographs":o=>o>=63744&&o<=64255,"Arabic Presentation Forms-A":o=>o>=64336&&o<=65023,"Vertical Forms":o=>o>=65040&&o<=65055,"CJK Compatibility Forms":o=>o>=65072&&o<=65103,"Small Form Variants":o=>o>=65104&&o<=65135,"Arabic Presentation Forms-B":o=>o>=65136&&o<=65279,"Halfwidth and Fullwidth Forms":o=>o>=65280&&o<=65519};function Zc(o){for(const i of o)if(dh(i.charCodeAt(0)))return!0;return!1}function hh(o){for(const i of o)if(!gm(i.charCodeAt(0)))return!1;return!0}function gm(o){return!($t.Arabic(o)||$t["Arabic Supplement"](o)||$t["Arabic Extended-A"](o)||$t["Arabic Presentation Forms-A"](o)||$t["Arabic Presentation Forms-B"](o))}function dh(o){return!(o!==746&&o!==747&&(o<4352||!($t["Bopomofo Extended"](o)||$t.Bopomofo(o)||$t["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||$t["CJK Compatibility Ideographs"](o)||$t["CJK Compatibility"](o)||$t["CJK Radicals Supplement"](o)||$t["CJK Strokes"](o)||!(!$t["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||$t["CJK Unified Ideographs Extension A"](o)||$t["CJK Unified Ideographs"](o)||$t["Enclosed CJK Letters and Months"](o)||$t["Hangul Compatibility Jamo"](o)||$t["Hangul Jamo Extended-A"](o)||$t["Hangul Jamo Extended-B"](o)||$t["Hangul Jamo"](o)||$t["Hangul Syllables"](o)||$t.Hiragana(o)||$t["Ideographic Description Characters"](o)||$t.Kanbun(o)||$t["Kangxi Radicals"](o)||$t["Katakana Phonetic Extensions"](o)||$t.Katakana(o)&&o!==12540||!(!$t["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!$t["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||$t["Unified Canadian Aboriginal Syllabics"](o)||$t["Unified Canadian Aboriginal Syllabics Extended"](o)||$t["Vertical Forms"](o)||$t["Yijing Hexagram Symbols"](o)||$t["Yi Syllables"](o)||$t["Yi Radicals"](o))))}function Tf(o){return!(dh(o)||function(i){return!!($t["Latin-1 Supplement"](i)&&(i===167||i===169||i===174||i===177||i===188||i===189||i===190||i===215||i===247)||$t["General Punctuation"](i)&&(i===8214||i===8224||i===8225||i===8240||i===8241||i===8251||i===8252||i===8258||i===8263||i===8264||i===8265||i===8273)||$t["Letterlike Symbols"](i)||$t["Number Forms"](i)||$t["Miscellaneous Technical"](i)&&(i>=8960&&i<=8967||i>=8972&&i<=8991||i>=8996&&i<=9e3||i===9003||i>=9085&&i<=9114||i>=9150&&i<=9165||i===9167||i>=9169&&i<=9179||i>=9186&&i<=9215)||$t["Control Pictures"](i)&&i!==9251||$t["Optical Character Recognition"](i)||$t["Enclosed Alphanumerics"](i)||$t["Geometric Shapes"](i)||$t["Miscellaneous Symbols"](i)&&!(i>=9754&&i<=9759)||$t["Miscellaneous Symbols and Arrows"](i)&&(i>=11026&&i<=11055||i>=11088&&i<=11097||i>=11192&&i<=11243)||$t["CJK Symbols and Punctuation"](i)||$t.Katakana(i)||$t["Private Use Area"](i)||$t["CJK Compatibility Forms"](i)||$t["Small Form Variants"](i)||$t["Halfwidth and Fullwidth Forms"](i)||i===8734||i===8756||i===8757||i>=9984&&i<=10087||i>=10102&&i<=10131||i===65532||i===65533)}(o))}function Ef(o){return o>=1424&&o<=2303||$t["Arabic Presentation Forms-A"](o)||$t["Arabic Presentation Forms-B"](o)}function Af(o,i){return!(!i&&Ef(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||$t.Khmer(o))}function vm(o){for(const i of o)if(Ef(i.charCodeAt(0)))return!0;return!1}const ko=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(o){this.pluginStatus=o.pluginStatus,this.pluginURL=o.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(o){this.applyArabicShaping=o.applyArabicShaping,this.processBidirectionalText=o.processBidirectionalText,this.processStyledBidirectionalText=o.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class _r{constructor(i,u){this.zoom=i,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Mf,this.transition={})}isSupportedScript(i){return function(u,f){for(const v of u)if(!Af(v.charCodeAt(0),f))return!1;return!0}(i,ko.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const i=this.zoom,u=i-Math.floor(i),f=this.crossFadingFactor();return i>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class fh{constructor(i,u){this.property=i,this.value=u,this.expression=function(f,v){if(Al(f))return new sh(f,v);if(mr(f)){const b=rm(f,v);if(b.result==="error")throw new Error(b.value.map(w=>`${w.key}: ${w.message}`).join(", "));return b.value}{let b=f;return v.type==="color"&&typeof f=="string"?b=nn.parse(f):v.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?v.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(b=wn.parse(f)):b=Rr.parse(f),{kind:"constant",evaluate:()=>b}}}(u===void 0?i.specification.default:u,i.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(i,u,f){return this.property.possiblyEvaluate(this,i,u,f)}}class ph{constructor(i){this.property=i,this.value=new fh(i,void 0)}transitioned(i,u){return new Pf(this.property,this.value,u,ne({},i.transition,this.transition),i.now)}untransitioned(){return new Pf(this.property,this.value,null,{},0)}}class Cf{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitionablePropertyValues)}getValue(i){return Te(this._values[i].value.value)}setValue(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ph(this._values[i].property)),this._values[i].value=new fh(this._values[i].property,u===null?void 0:Te(u))}getTransition(i){return Te(this._values[i].transition)}setTransition(i,u){Object.prototype.hasOwnProperty.call(this._values,i)||(this._values[i]=new ph(this._values[i].property)),this._values[i].transition=Te(u)||void 0}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(i[u]=f);const v=this.getTransition(u);v!==void 0&&(i[`${u}-transition`]=v)}return i}transitioned(i,u){const f=new ym(this._properties);for(const v of Object.keys(this._values))f._values[v]=this._values[v].transitioned(i,u._values[v]);return f}untransitioned(){const i=new ym(this._properties);for(const u of Object.keys(this._values))i._values[u]=this._values[u].untransitioned();return i}}class Pf{constructor(i,u,f,v,b){this.property=i,this.value=u,this.begin=b+v.delay||0,this.end=this.begin+v.duration||0,i.specification.transition&&(v.delay||v.duration)&&(this.prior=f)}possiblyEvaluate(i,u,f){const v=i.now||0,b=this.value.possiblyEvaluate(i,u,f),w=this.prior;if(w){if(v>this.end)return this.prior=null,b;if(this.value.isDataDriven())return this.prior=null,b;if(v<this.begin)return w.possiblyEvaluate(i,u,f);{const E=(v-this.begin)/(this.end-this.begin);return this.property.interpolate(w.possiblyEvaluate(i,u,f),b,function(R){if(R<=0)return 0;if(R>=1)return 1;const L=R*R,j=L*R;return 4*(R<.5?j:3*(R-L)+j-.75)}(E))}}return b}}class ym{constructor(i){this._properties=i,this._values=Object.create(i.defaultTransitioningPropertyValues)}possiblyEvaluate(i,u,f){const v=new Yc(this._properties);for(const b of Object.keys(this._values))v._values[b]=this._values[b].possiblyEvaluate(i,u,f);return v}hasTransition(){for(const i of Object.keys(this._values))if(this._values[i].prior)return!0;return!1}}class ny{constructor(i){this._properties=i,this._values=Object.create(i.defaultPropertyValues)}hasValue(i){return this._values[i].value!==void 0}getValue(i){return Te(this._values[i].value)}setValue(i,u){this._values[i]=new fh(this._values[i].property,u===null?void 0:Te(u))}serialize(){const i={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(i[u]=f)}return i}possiblyEvaluate(i,u,f){const v=new Yc(this._properties);for(const b of Object.keys(this._values))v._values[b]=this._values[b].possiblyEvaluate(i,u,f);return v}}class Oa{constructor(i,u,f){this.property=i,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(i){return this.value.kind==="constant"?this.value.value:i}evaluate(i,u,f,v){return this.property.evaluate(this.value,this.parameters,i,u,f,v)}}class Yc{constructor(i){this._properties=i,this._values=Object.create(i.defaultPossiblyEvaluatedValues)}get(i){return this._values[i]}}class mn{constructor(i){this.specification=i}possiblyEvaluate(i,u){if(i.isDataDriven())throw new Error("Value should not be data driven");return i.expression.evaluate(u)}interpolate(i,u,f){const v=oa[this.specification.type];return v?v(i,u,f):i}}class Tn{constructor(i,u){this.specification=i,this.overrides=u}possiblyEvaluate(i,u,f,v){return new Oa(this,i.expression.kind==="constant"||i.expression.kind==="camera"?{kind:"constant",value:i.expression.evaluate(u,null,{},f,v)}:i.expression,u)}interpolate(i,u,f){if(i.value.kind!=="constant"||u.value.kind!=="constant")return i;if(i.value.value===void 0||u.value.value===void 0)return new Oa(this,{kind:"constant",value:void 0},i.parameters);const v=oa[this.specification.type];if(v){const b=v(i.value.value,u.value.value,f);return new Oa(this,{kind:"constant",value:b},i.parameters)}return i}evaluate(i,u,f,v,b,w){return i.kind==="constant"?i.value:i.evaluate(u,f,v,b,w)}}class Lo extends Tn{possiblyEvaluate(i,u,f,v){if(i.value===void 0)return new Oa(this,{kind:"constant",value:void 0},u);if(i.expression.kind==="constant"){const b=i.expression.evaluate(u,null,{},f,v),w=i.property.specification.type==="resolvedImage"&&typeof b!="string"?b.name:b,E=this._calculate(w,w,w,u);return new Oa(this,{kind:"constant",value:E},u)}if(i.expression.kind==="camera"){const b=this._calculate(i.expression.evaluate({zoom:u.zoom-1}),i.expression.evaluate({zoom:u.zoom}),i.expression.evaluate({zoom:u.zoom+1}),u);return new Oa(this,{kind:"constant",value:b},u)}return new Oa(this,i.expression,u)}evaluate(i,u,f,v,b,w){if(i.kind==="source"){const E=i.evaluate(u,f,v,b,w);return this._calculate(E,E,E,u)}return i.kind==="composite"?this._calculate(i.evaluate({zoom:Math.floor(u.zoom)-1},f,v),i.evaluate({zoom:Math.floor(u.zoom)},f,v),i.evaluate({zoom:Math.floor(u.zoom)+1},f,v),u):i.value}_calculate(i,u,f,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:f,to:u}}interpolate(i){return i}}class Rf{constructor(i){this.specification=i}possiblyEvaluate(i,u,f,v){if(i.value!==void 0){if(i.expression.kind==="constant"){const b=i.expression.evaluate(u,null,{},f,v);return this._calculate(b,b,b,u)}return this._calculate(i.expression.evaluate(new _r(Math.floor(u.zoom-1),u)),i.expression.evaluate(new _r(Math.floor(u.zoom),u)),i.expression.evaluate(new _r(Math.floor(u.zoom+1),u)),u)}}_calculate(i,u,f,v){return v.zoom>v.zoomHistory.lastIntegerZoom?{from:i,to:u}:{from:f,to:u}}interpolate(i){return i}}class Kc{constructor(i){this.specification=i}possiblyEvaluate(i,u,f,v){return!!i.expression.evaluate(u,null,{},f,v)}interpolate(){return!1}}class $i{constructor(i){this.properties=i,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in i){const f=i[u];f.specification.overridable&&this.overridableProperties.push(u);const v=this.defaultPropertyValues[u]=new fh(f,void 0),b=this.defaultTransitionablePropertyValues[u]=new ph(f);this.defaultTransitioningPropertyValues[u]=b.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=v.possiblyEvaluate({})}}}Jt("DataDrivenProperty",Tn),Jt("DataConstantProperty",mn),Jt("CrossFadedDataDrivenProperty",Lo),Jt("CrossFadedProperty",Rf),Jt("ColorRampProperty",Kc);const _m="-transition";class Ua extends Pn{constructor(i,u){if(super(),this.id=i.id,this.type=i.type,this._featureFilter={filter:()=>!0,needGeometry:!1},i.type!=="custom"&&(this.metadata=i.metadata,this.minzoom=i.minzoom,this.maxzoom=i.maxzoom,i.type!=="background"&&(this.source=i.source,this.sourceLayer=i["source-layer"],this.filter=i.filter),u.layout&&(this._unevaluatedLayout=new ny(u.layout)),u.paint)){this._transitionablePaint=new Cf(u.paint);for(const f in i.paint)this.setPaintProperty(f,i.paint[f],{validate:!1});for(const f in i.layout)this.setLayoutProperty(f,i.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Yc(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(i){return i==="visibility"?this.visibility:this._unevaluatedLayout.getValue(i)}setLayoutProperty(i,u,f={}){u!=null&&this._validate(wf,`layers.${this.id}.layout.${i}`,i,u,f)||(i!=="visibility"?this._unevaluatedLayout.setValue(i,u):this.visibility=u)}getPaintProperty(i){return i.endsWith(_m)?this._transitionablePaint.getTransition(i.slice(0,-11)):this._transitionablePaint.getValue(i)}setPaintProperty(i,u,f={}){if(u!=null&&this._validate(ty,`layers.${this.id}.paint.${i}`,i,u,f))return!1;if(i.endsWith(_m))return this._transitionablePaint.setTransition(i.slice(0,-11),u||void 0),!1;{const v=this._transitionablePaint._values[i],b=v.property.specification["property-type"]==="cross-faded-data-driven",w=v.value.isDataDriven(),E=v.value;this._transitionablePaint.setValue(i,u),this._handleSpecialPaintPropertyUpdate(i);const R=this._transitionablePaint._values[i].value;return R.isDataDriven()||w||b||this._handleOverridablePaintPropertyUpdate(i,E,R)}}_handleSpecialPaintPropertyUpdate(i){}_handleOverridablePaintPropertyUpdate(i,u,f){return!1}isHidden(i){return!!(this.minzoom&&i<this.minzoom)||!!(this.maxzoom&&i>=this.maxzoom)||this.visibility==="none"}updateTransitions(i){this._transitioningPaint=this._transitionablePaint.transitioned(i,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(i,u){i.getCrossfadeParameters&&(this._crossfadeParameters=i.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(i,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(i,void 0,u)}serialize(){const i={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(i.layout=i.layout||{},i.layout.visibility=this.visibility),J(i,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(i,u,f,v,b={}){return(!b||b.validate!==!1)&&mm(this,i.call(Ll,{key:u,layerType:this.type,objectKey:f,value:v,styleSpec:je,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const i in this.paint._values){const u=this.paint.get(i);if(u instanceof Oa&&El(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const xm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Fl{constructor(i,u){this._structArray=i,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Dr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(i,u){return i._trim(),u&&(i.isTransferred=!0,u.push(i.arrayBuffer)),{length:i.length,arrayBuffer:i.arrayBuffer}}static deserialize(i){const u=Object.create(this.prototype);return u.arrayBuffer=i.arrayBuffer,u.length=i.length,u.capacity=i.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(i){this.reserve(i),this.length=i}reserve(i){if(i>this.capacity){this.capacity=Math.max(i,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Hr(o,i=1){let u=0,f=0;return{members:o.map(v=>{const b=xm[v.type].BYTES_PER_ELEMENT,w=u=bm(u,Math.max(i,b)),E=v.components||1;return f=Math.max(f,b),u+=b*E,{name:v.name,type:v.type,components:E,offset:w}}),size:bm(u,Math.max(f,i)),alignment:i}}function bm(o,i){return Math.ceil(o/i)*i}class Jc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const v=2*i;return this.int16[v+0]=u,this.int16[v+1]=f,i}}Jc.prototype.bytesPerElement=4,Jt("StructArrayLayout2i4",Jc);class mh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,f)}emplace(i,u,f,v){const b=3*i;return this.int16[b+0]=u,this.int16[b+1]=f,this.int16[b+2]=v,i}}mh.prototype.bytesPerElement=6,Jt("StructArrayLayout3i6",mh);class to extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,v){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,v)}emplace(i,u,f,v,b){const w=4*i;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=v,this.int16[w+3]=b,i}}to.prototype.bytesPerElement=8,Jt("StructArrayLayout4i8",to);class If extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,f,v,b,w)}emplace(i,u,f,v,b,w,E){const R=6*i;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=v,this.int16[R+3]=b,this.int16[R+4]=w,this.int16[R+5]=E,i}}If.prototype.bytesPerElement=12,Jt("StructArrayLayout2i4i12",If);class Df extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,f,v,b,w)}emplace(i,u,f,v,b,w,E){const R=4*i,L=8*i;return this.int16[R+0]=u,this.int16[R+1]=f,this.uint8[L+4]=v,this.uint8[L+5]=b,this.uint8[L+6]=w,this.uint8[L+7]=E,i}}Df.prototype.bytesPerElement=8,Jt("StructArrayLayout2i4ub8",Df);class Qc extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const v=2*i;return this.float32[v+0]=u,this.float32[v+1]=f,i}}Qc.prototype.bytesPerElement=8,Jt("StructArrayLayout2f8",Qc);class kf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w,E,R,L,j){const W=this.length;return this.resize(W+1),this.emplace(W,i,u,f,v,b,w,E,R,L,j)}emplace(i,u,f,v,b,w,E,R,L,j,W){const K=10*i;return this.uint16[K+0]=u,this.uint16[K+1]=f,this.uint16[K+2]=v,this.uint16[K+3]=b,this.uint16[K+4]=w,this.uint16[K+5]=E,this.uint16[K+6]=R,this.uint16[K+7]=L,this.uint16[K+8]=j,this.uint16[K+9]=W,i}}kf.prototype.bytesPerElement=20,Jt("StructArrayLayout10ui20",kf);class gh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w,E,R,L,j,W,K){const re=this.length;return this.resize(re+1),this.emplace(re,i,u,f,v,b,w,E,R,L,j,W,K)}emplace(i,u,f,v,b,w,E,R,L,j,W,K,re){const le=12*i;return this.int16[le+0]=u,this.int16[le+1]=f,this.int16[le+2]=v,this.int16[le+3]=b,this.uint16[le+4]=w,this.uint16[le+5]=E,this.uint16[le+6]=R,this.uint16[le+7]=L,this.int16[le+8]=j,this.int16[le+9]=W,this.int16[le+10]=K,this.int16[le+11]=re,i}}gh.prototype.bytesPerElement=24,Jt("StructArrayLayout4i4ui4i24",gh);class Lf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,f)}emplace(i,u,f,v){const b=3*i;return this.float32[b+0]=u,this.float32[b+1]=f,this.float32[b+2]=v,i}}Lf.prototype.bytesPerElement=12,Jt("StructArrayLayout3f12",Lf);class zf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint32[1*i+0]=u,i}}zf.prototype.bytesPerElement=4,Jt("StructArrayLayout1ul4",zf);class Is extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w,E,R,L){const j=this.length;return this.resize(j+1),this.emplace(j,i,u,f,v,b,w,E,R,L)}emplace(i,u,f,v,b,w,E,R,L,j){const W=10*i,K=5*i;return this.int16[W+0]=u,this.int16[W+1]=f,this.int16[W+2]=v,this.int16[W+3]=b,this.int16[W+4]=w,this.int16[W+5]=E,this.uint32[K+3]=R,this.uint16[W+8]=L,this.uint16[W+9]=j,i}}Is.prototype.bytesPerElement=20,Jt("StructArrayLayout6i1ul2ui20",Is);class vh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w){const E=this.length;return this.resize(E+1),this.emplace(E,i,u,f,v,b,w)}emplace(i,u,f,v,b,w,E){const R=6*i;return this.int16[R+0]=u,this.int16[R+1]=f,this.int16[R+2]=v,this.int16[R+3]=b,this.int16[R+4]=w,this.int16[R+5]=E,i}}vh.prototype.bytesPerElement=12,Jt("StructArrayLayout2i2i2i12",vh);class eu extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b){const w=this.length;return this.resize(w+1),this.emplace(w,i,u,f,v,b)}emplace(i,u,f,v,b,w){const E=4*i,R=8*i;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=v,this.int16[R+6]=b,this.int16[R+7]=w,i}}eu.prototype.bytesPerElement=16,Jt("StructArrayLayout2f1f2i16",eu);class yh extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,v){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,v)}emplace(i,u,f,v,b){const w=12*i,E=3*i;return this.uint8[w+0]=u,this.uint8[w+1]=f,this.float32[E+1]=v,this.float32[E+2]=b,i}}yh.prototype.bytesPerElement=12,Jt("StructArrayLayout2ub2f12",yh);class Nl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,f)}emplace(i,u,f,v){const b=3*i;return this.uint16[b+0]=u,this.uint16[b+1]=f,this.uint16[b+2]=v,i}}Nl.prototype.bytesPerElement=6,Jt("StructArrayLayout3ui6",Nl);class Ff extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce){const Ge=this.length;return this.resize(Ge+1),this.emplace(Ge,i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce)}emplace(i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce,Ge){const De=24*i,Fe=12*i,dt=48*i;return this.int16[De+0]=u,this.int16[De+1]=f,this.uint16[De+2]=v,this.uint16[De+3]=b,this.uint32[Fe+2]=w,this.uint32[Fe+3]=E,this.uint32[Fe+4]=R,this.uint16[De+10]=L,this.uint16[De+11]=j,this.uint16[De+12]=W,this.float32[Fe+7]=K,this.float32[Fe+8]=re,this.uint8[dt+36]=le,this.uint8[dt+37]=fe,this.uint8[dt+38]=_e,this.uint32[Fe+10]=Ce,this.int16[De+22]=Ge,i}}Ff.prototype.bytesPerElement=48,Jt("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Ff);class Bl extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce,Ge,De,Fe,dt,mt,qt,cn,jt,Vt,Rt,rn){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce,Ge,De,Fe,dt,mt,qt,cn,jt,Vt,Rt,rn)}emplace(i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe,_e,Ce,Ge,De,Fe,dt,mt,qt,cn,jt,Vt,Rt,rn,Bt){const Et=32*i,_n=16*i;return this.int16[Et+0]=u,this.int16[Et+1]=f,this.int16[Et+2]=v,this.int16[Et+3]=b,this.int16[Et+4]=w,this.int16[Et+5]=E,this.int16[Et+6]=R,this.int16[Et+7]=L,this.uint16[Et+8]=j,this.uint16[Et+9]=W,this.uint16[Et+10]=K,this.uint16[Et+11]=re,this.uint16[Et+12]=le,this.uint16[Et+13]=fe,this.uint16[Et+14]=_e,this.uint16[Et+15]=Ce,this.uint16[Et+16]=Ge,this.uint16[Et+17]=De,this.uint16[Et+18]=Fe,this.uint16[Et+19]=dt,this.uint16[Et+20]=mt,this.uint16[Et+21]=qt,this.uint16[Et+22]=cn,this.uint32[_n+12]=jt,this.float32[_n+13]=Vt,this.float32[_n+14]=Rt,this.uint16[Et+30]=rn,this.uint16[Et+31]=Bt,i}}Bl.prototype.bytesPerElement=64,Jt("StructArrayLayout8i15ui1ul2f2ui64",Bl);class no extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.float32[1*i+0]=u,i}}no.prototype.bytesPerElement=4,Jt("StructArrayLayout1f4",no);class Nf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,f)}emplace(i,u,f,v){const b=3*i;return this.uint16[6*i+0]=u,this.float32[b+1]=f,this.float32[b+2]=v,i}}Nf.prototype.bytesPerElement=12,Jt("StructArrayLayout1ui2f12",Nf);class _h extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u,f){const v=this.length;return this.resize(v+1),this.emplace(v,i,u,f)}emplace(i,u,f,v){const b=4*i;return this.uint32[2*i+0]=u,this.uint16[b+2]=f,this.uint16[b+3]=v,i}}_h.prototype.bytesPerElement=8,Jt("StructArrayLayout1ul2ui8",_h);class zo extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i,u){const f=this.length;return this.resize(f+1),this.emplace(f,i,u)}emplace(i,u,f){const v=2*i;return this.uint16[v+0]=u,this.uint16[v+1]=f,i}}zo.prototype.bytesPerElement=4,Jt("StructArrayLayout2ui4",zo);class Bf extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(i){const u=this.length;return this.resize(u+1),this.emplace(u,i)}emplace(i,u){return this.uint16[1*i+0]=u,i}}Bf.prototype.bytesPerElement=2,Jt("StructArrayLayout1ui2",Bf);class Of extends Dr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(i,u,f,v){const b=this.length;return this.resize(b+1),this.emplace(b,i,u,f,v)}emplace(i,u,f,v,b){const w=4*i;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=v,this.float32[w+3]=b,i}}Of.prototype.bytesPerElement=16,Jt("StructArrayLayout4f16",Of);class Uf extends Fl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new T(this.anchorPointX,this.anchorPointY)}}Uf.prototype.size=20;class wm extends Is{get(i){return new Uf(this,i)}}Jt("CollisionBoxArray",wm);class y extends Fl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(i){this._structArray.uint8[this._pos1+37]=i}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(i){this._structArray.uint8[this._pos1+38]=i}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(i){this._structArray.uint32[this._pos4+10]=i}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}y.prototype.size=48;class a extends Ff{get(i){return new y(this,i)}}Jt("PlacedSymbolArray",a);class d extends Fl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(i){this._structArray.uint32[this._pos4+12]=i}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class p extends Bl{get(i){return new d(this,i)}}Jt("SymbolInstanceArray",p);class g extends no{getoffsetX(i){return this.float32[1*i+0]}}Jt("GlyphOffsetArray",g);class x extends mh{getx(i){return this.int16[3*i+0]}gety(i){return this.int16[3*i+1]}gettileUnitDistanceFromAnchor(i){return this.int16[3*i+2]}}Jt("SymbolLineVertexArray",x);class A extends Fl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}A.prototype.size=12;class P extends Nf{get(i){return new A(this,i)}}Jt("TextAnchorOffsetArray",P);class D extends Fl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}D.prototype.size=8;class H extends _h{get(i){return new D(this,i)}}Jt("FeatureIndexArray",H);class $ extends Jc{}class X extends Jc{}class oe extends Jc{}class ye extends If{}class ve extends Df{}class be extends Qc{}class de extends kf{}class Le extends gh{}class Je extends Lf{}class Me extends zf{}class Oe extends vh{}class et extends yh{}class nt extends Nl{}class ut extends zo{}const St=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:yt}=St;class xt{constructor(i=[]){this.segments=i}prepareSegment(i,u,f,v){let b=this.segments[this.segments.length-1];return i>xt.MAX_VERTEX_ARRAY_LENGTH&&Re(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${i}`),(!b||b.vertexLength+i>xt.MAX_VERTEX_ARRAY_LENGTH||b.sortKey!==v)&&(b={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},v!==void 0&&(b.sortKey=v),this.segments.push(b)),b}get(){return this.segments}destroy(){for(const i of this.segments)for(const u in i.vaos)i.vaos[u].destroy()}static simpleSegment(i,u,f,v){return new xt([{vertexOffset:i,primitiveOffset:u,vertexLength:f,primitiveLength:v,vaos:{},sortKey:0}])}}function Yt(o,i){return 256*(o=he(Math.floor(o),0,255))+he(Math.floor(i),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Jt("SegmentVector",xt);const Bn=Hr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Nt={exports:{}},An={exports:{}};An.exports=function(o,i){var u,f,v,b,w,E,R,L;for(f=o.length-(u=3&o.length),v=i,w=3432918353,E=461845907,L=0;L<f;)R=255&o.charCodeAt(L)|(255&o.charCodeAt(++L))<<8|(255&o.charCodeAt(++L))<<16|(255&o.charCodeAt(++L))<<24,++L,v=27492+(65535&(b=5*(65535&(v=(v^=R=(65535&(R=(R=(65535&R)*w+(((R>>>16)*w&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(R=0,u){case 3:R^=(255&o.charCodeAt(L+2))<<16;case 2:R^=(255&o.charCodeAt(L+1))<<8;case 1:v^=R=(65535&(R=(R=(65535&(R^=255&o.charCodeAt(L)))*w+(((R>>>16)*w&65535)<<16)&4294967295)<<15|R>>>17))*E+(((R>>>16)*E&65535)<<16)&4294967295}return v^=o.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0};var On=An.exports,Xn={exports:{}};Xn.exports=function(o,i){for(var u,f=o.length,v=i^f,b=0;f>=4;)u=1540483477*(65535&(u=255&o.charCodeAt(b)|(255&o.charCodeAt(++b))<<8|(255&o.charCodeAt(++b))<<16|(255&o.charCodeAt(++b))<<24))+((1540483477*(u>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++b;switch(f){case 3:v^=(255&o.charCodeAt(b+2))<<16;case 2:v^=(255&o.charCodeAt(b+1))<<8;case 1:v=1540483477*(65535&(v^=255&o.charCodeAt(b)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0};var In=On,Vn=Xn.exports;Nt.exports=In,Nt.exports.murmur3=In,Nt.exports.murmur2=Vn;var Hn=m(Nt.exports);class Ar{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(i,u,f,v){this.ids.push(dr(i)),this.positions.push(u,f,v)}getPositions(i){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=dr(i);let f=0,v=this.ids.length-1;for(;f<v;){const w=f+v>>1;this.ids[w]>=u?v=w:f=w+1}const b=[];for(;this.ids[f]===u;)b.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return b}static serialize(i,u){const f=new Float64Array(i.ids),v=new Uint32Array(i.positions);return Xi(f,v,0,f.length-1),u&&u.push(f.buffer,v.buffer),{ids:f,positions:v}}static deserialize(i){const u=new Ar;return u.ids=i.ids,u.positions=i.positions,u.indexed=!0,u}}function dr(o){const i=+o;return!isNaN(i)&&i<=Number.MAX_SAFE_INTEGER?i:Hn(String(o))}function Xi(o,i,u,f){for(;u<f;){const v=o[u+f>>1];let b=u-1,w=f+1;for(;;){do b++;while(o[b]<v);do w--;while(o[w]>v);if(b>=w)break;Yr(o,b,w),Yr(i,3*b,3*w),Yr(i,3*b+1,3*w+1),Yr(i,3*b+2,3*w+2)}w-u<f-w?(Xi(o,i,u,w),u=w+1):(Xi(o,i,w+1,f),f=w)}}function Yr(o,i,u){const f=o[i];o[i]=o[u],o[u]=f}Jt("FeaturePositionMap",Ar);class gr{constructor(i,u){this.gl=i.gl,this.location=u}}class Ai extends gr{constructor(i,u){super(i,u),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Va extends gr{constructor(i,u){super(i,u),this.current=[0,0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3]))}}class cs extends gr{constructor(i,u){super(i,u),this.current=nn.transparent}set(i){i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a))}}const Fo=new Float32Array(16);function No(o){return[Yt(255*o.r,255*o.g),Yt(255*o.b,255*o.a)]}class us{constructor(i,u,f){this.value=i,this.uniformNames=u.map(v=>`u_${v}`),this.type=f}setUniform(i,u,f){i.set(f.constantOr(this.value))}getBinding(i,u,f){return this.type==="color"?new cs(i,u):new Ai(i,u)}}class Ha{constructor(i,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(i,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=i.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=i.tlbr}setUniform(i,u,f,v){const b=v==="u_pattern_to"?this.patternTo:v==="u_pattern_from"?this.patternFrom:v==="u_pixel_ratio_to"?this.pixelRatioTo:v==="u_pixel_ratio_from"?this.pixelRatioFrom:null;b&&i.set(b)}getBinding(i,u,f){return f.substr(0,9)==="u_pattern"?new Va(i,u):new Ai(i,u)}}class kr{constructor(i,u,f,v){this.expression=i,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(b=>({name:`a_${b}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new v}populatePaintArray(i,u,f,v,b){const w=this.paintVertexArray.length,E=this.expression.evaluate(new _r(0),u,{},v,[],b);this.paintVertexArray.resize(i),this._setPaintValue(w,i,E)}updatePaintArray(i,u,f,v){const b=this.expression.evaluate({zoom:0},f,v);this._setPaintValue(i,u,b)}_setPaintValue(i,u,f){if(this.type==="color"){const v=No(f);for(let b=i;b<u;b++)this.paintVertexArray.emplace(b,v[0],v[1])}else{for(let v=i;v<u;v++)this.paintVertexArray.emplace(v,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xr{constructor(i,u,f,v,b,w){this.expression=i,this.uniformNames=u.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=v,this.zoom=b,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new w}populatePaintArray(i,u,f,v,b){const w=this.expression.evaluate(new _r(this.zoom),u,{},v,[],b),E=this.expression.evaluate(new _r(this.zoom+1),u,{},v,[],b),R=this.paintVertexArray.length;this.paintVertexArray.resize(i),this._setPaintValue(R,i,w,E)}updatePaintArray(i,u,f,v){const b=this.expression.evaluate({zoom:this.zoom},f,v),w=this.expression.evaluate({zoom:this.zoom+1},f,v);this._setPaintValue(i,u,b,w)}_setPaintValue(i,u,f,v){if(this.type==="color"){const b=No(f),w=No(v);for(let E=i;E<u;E++)this.paintVertexArray.emplace(E,b[0],b[1],w[0],w[1])}else{for(let b=i;b<u;b++)this.paintVertexArray.emplace(b,f,v);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(v))}}upload(i){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=i.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(i,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,v=he(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);i.set(v)}getBinding(i,u,f){return new Ai(i,u)}}class Br{constructor(i,u,f,v,b,w){this.expression=i,this.type=u,this.useIntegerZoom=f,this.zoom=v,this.layerId=w,this.zoomInPaintVertexArray=new b,this.zoomOutPaintVertexArray=new b}populatePaintArray(i,u,f){const v=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(i),this.zoomOutPaintVertexArray.resize(i),this._setPaintValues(v,i,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(i,u,f,v,b){this._setPaintValues(i,u,f.patterns&&f.patterns[this.layerId],b)}_setPaintValues(i,u,f,v){if(!v||!f)return;const{min:b,mid:w,max:E}=f,R=v[b],L=v[w],j=v[E];if(R&&L&&j)for(let W=i;W<u;W++)this.zoomInPaintVertexArray.emplace(W,L.tl[0],L.tl[1],L.br[0],L.br[1],R.tl[0],R.tl[1],R.br[0],R.br[1],L.pixelRatio,R.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,L.tl[0],L.tl[1],L.br[0],L.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],L.pixelRatio,j.pixelRatio)}upload(i){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=i.createVertexBuffer(this.zoomInPaintVertexArray,Bn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=i.createVertexBuffer(this.zoomOutPaintVertexArray,Bn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ol{constructor(i,u,f){this.binders={},this._buffers=[];const v=[];for(const b in i.paint._values){if(!f(b))continue;const w=i.paint.get(b);if(!(w instanceof Oa&&El(w.property.specification)))continue;const E=fi(b,i.type),R=w.value,L=w.property.specification.type,j=w.property.useIntegerZoom,W=w.property.specification["property-type"],K=W==="cross-faded"||W==="cross-faded-data-driven";if(R.kind==="constant")this.binders[b]=K?new Ha(R.value,E):new us(R.value,E,L),v.push(`/u_${b}`);else if(R.kind==="source"||K){const re=ca(b,L,"source");this.binders[b]=K?new Br(R,L,j,u,re,i.id):new kr(R,E,L,re),v.push(`/a_${b}`)}else{const re=ca(b,L,"composite");this.binders[b]=new xr(R,E,L,j,u,re),v.push(`/z_${b}`)}}this.cacheKey=v.sort().join("")}getMaxValue(i){const u=this.binders[i];return u instanceof kr||u instanceof xr?u.maxValue:0}populatePaintArrays(i,u,f,v,b){for(const w in this.binders){const E=this.binders[w];(E instanceof kr||E instanceof xr||E instanceof Br)&&E.populatePaintArray(i,u,f,v,b)}}setConstantPatternPositions(i,u){for(const f in this.binders){const v=this.binders[f];v instanceof Ha&&v.setConstantPatternPositions(i,u)}}updatePaintArrays(i,u,f,v,b){let w=!1;for(const E in i){const R=u.getPositions(E);for(const L of R){const j=f.feature(L.index);for(const W in this.binders){const K=this.binders[W];if((K instanceof kr||K instanceof xr||K instanceof Br)&&K.expression.isStateDependent===!0){const re=v.paint.get(W);K.expression=re.value,K.updatePaintArray(L.start,L.end,j,i[E],b),w=!0}}}}return w}defines(){const i=[];for(const u in this.binders){const f=this.binders[u];(f instanceof us||f instanceof Ha)&&i.push(...f.uniformNames.map(v=>`#define HAS_UNIFORM_${v}`))}return i}getBinderAttributes(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof kr||f instanceof xr)for(let v=0;v<f.paintVertexAttributes.length;v++)i.push(f.paintVertexAttributes[v].name);else if(f instanceof Br)for(let v=0;v<Bn.members.length;v++)i.push(Bn.members[v].name)}return i}getBinderUniforms(){const i=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof us||f instanceof Ha||f instanceof xr)for(const v of f.uniformNames)i.push(v)}return i}getPaintVertexBuffers(){return this._buffers}getUniforms(i,u){const f=[];for(const v in this.binders){const b=this.binders[v];if(b instanceof us||b instanceof Ha||b instanceof xr){for(const w of b.uniformNames)if(u[w]){const E=b.getBinding(i,u[w],w);f.push({name:w,property:v,binding:E})}}}return f}setUniforms(i,u,f,v){for(const{name:b,property:w,binding:E}of u)this.binders[w].setUniform(E,v,f.get(w),b)}updatePaintBuffers(i){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(i&&f instanceof Br){const v=i.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;v&&this._buffers.push(v)}else(f instanceof kr||f instanceof xr)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(i){for(const u in this.binders){const f=this.binders[u];(f instanceof kr||f instanceof xr||f instanceof Br)&&f.upload(i)}this.updatePaintBuffers()}destroy(){for(const i in this.binders){const u=this.binders[i];(u instanceof kr||u instanceof xr||u instanceof Br)&&u.destroy()}}}class Mr{constructor(i,u,f=()=>!0){this.programConfigurations={};for(const v of i)this.programConfigurations[v.id]=new Ol(v,u,f);this.needsUpload=!1,this._featureMap=new Ar,this._bufferOffset=0}populatePaintArrays(i,u,f,v,b,w){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(i,u,v,b,w);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,i),this._bufferOffset=i,this.needsUpload=!0}updatePaintArrays(i,u,f,v){for(const b of f)this.needsUpload=this.programConfigurations[b.id].updatePaintArrays(i,this._featureMap,u,b,v)||this.needsUpload}get(i){return this.programConfigurations[i]}upload(i){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(i);this.needsUpload=!1}}destroy(){for(const i in this.programConfigurations)this.programConfigurations[i].destroy()}}function fi(o,i){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(`${i}-`,"").replace(/-/g,"_")]}function ca(o,i,u){const f={color:{source:Qc,composite:Of},number:{source:no,composite:Qc}},v=function(b){return{"line-pattern":{source:de,composite:de},"fill-pattern":{source:de,composite:de},"fill-extrusion-pattern":{source:de,composite:de}}[b]}(o);return v&&v[u]||f[i][u]}Jt("ConstantBinder",us),Jt("CrossFadedConstantBinder",Ha),Jt("SourceExpressionBinder",kr),Jt("CrossFadedCompositeBinder",Br),Jt("CompositeExpressionBinder",xr),Jt("ProgramConfiguration",Ol,{omit:["_buffers"]}),Jt("ProgramConfigurationSet",Mr);const Wn=8192,Vf=Math.pow(2,14)-1,Sm=-Vf-1;function Bo(o){const i=Wn/o.extent,u=o.loadGeometry();for(let f=0;f<u.length;f++){const v=u[f];for(let b=0;b<v.length;b++){const w=v[b],E=Math.round(w.x*i),R=Math.round(w.y*i);w.x=he(E,Sm,Vf),w.y=he(R,Sm,Vf),(E<w.x||E>w.x+1||R<w.y||R>w.y+1)&&Re("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Oo(o,i){return{type:o.type,id:o.id,properties:o.properties,geometry:i?Bo(o):[]}}function xh(o,i,u,f,v){o.emplaceBack(2*i+(f+1)/2,2*u+(v+1)/2)}class Hf{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new X,this.indexArray=new nt,this.segments=new xt,this.programConfigurations=new Mr(i.layers,i.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f){const v=this.layers[0],b=[];let w=null,E=!1;v.type==="circle"&&(w=v.layout.get("circle-sort-key"),E=!w.isConstant());for(const{feature:R,id:L,index:j,sourceLayerIndex:W}of i){const K=this.layers[0]._featureFilter.needGeometry,re=Oo(R,K);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),re,f))continue;const le=E?w.evaluate(re,{},f):void 0,fe={id:L,properties:R.properties,type:R.type,sourceLayerIndex:W,index:j,geometry:K?re.geometry:Bo(R),patterns:{},sortKey:le};b.push(fe)}E&&b.sort((R,L)=>R.sortKey-L.sortKey);for(const R of b){const{geometry:L,index:j,sourceLayerIndex:W}=R,K=i[j].feature;this.addFeature(R,L,j,f),u.featureIndex.insert(K,L,j,W,this.index)}}update(i,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,yt),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(i,u,f,v){for(const b of u)for(const w of b){const E=w.x,R=w.y;if(E<0||E>=Wn||R<0||R>=Wn)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,i.sortKey),j=L.vertexLength;xh(this.layoutVertexArray,E,R,-1,-1),xh(this.layoutVertexArray,E,R,1,-1),xh(this.layoutVertexArray,E,R,1,1),xh(this.layoutVertexArray,E,R,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,{},v)}}function Uo(o,i){for(let u=0;u<o.length;u++)if(bh(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(bh(o,i[u]))return!0;return!!tu(o,i)}function Mm(o,i,u){return!!bh(o,i)||!!nu(i,o,u)}function Gf(o,i){if(o.length===1)return ww(i,o[0]);for(let u=0;u<i.length;u++){const f=i[u];for(let v=0;v<f.length;v++)if(bh(o,f[v]))return!0}for(let u=0;u<o.length;u++)if(ww(i,o[u]))return!0;for(let u=0;u<i.length;u++)if(tu(o,i[u]))return!0;return!1}function Tm(o,i,u){if(o.length>1){if(tu(o,i))return!0;for(let f=0;f<i.length;f++)if(nu(i[f],o,u))return!0}for(let f=0;f<o.length;f++)if(nu(o[f],i,u))return!0;return!1}function tu(o,i){if(o.length===0||i.length===0)return!1;for(let u=0;u<o.length-1;u++){const f=o[u],v=o[u+1];for(let b=0;b<i.length-1;b++)if(Em(f,v,i[b],i[b+1]))return!0}return!1}function Em(o,i,u,f){return We(o,u,f)!==We(i,u,f)&&We(o,i,u)!==We(o,i,f)}function nu(o,i,u){const f=u*u;if(i.length===1)return o.distSqr(i[0])<f;for(let v=1;v<i.length;v++)if(bw(o,i[v-1],i[v])<f)return!0;return!1}function bw(o,i,u){const f=i.distSqr(u);if(f===0)return o.distSqr(i);const v=((o.x-i.x)*(u.x-i.x)+(o.y-i.y)*(u.y-i.y))/f;return o.distSqr(v<0?i:v>1?u:u.sub(i)._mult(v)._add(i))}function ww(o,i){let u,f,v,b=!1;for(let w=0;w<o.length;w++){u=o[w];for(let E=0,R=u.length-1;E<u.length;R=E++)f=u[E],v=u[R],f.y>i.y!=v.y>i.y&&i.x<(v.x-f.x)*(i.y-f.y)/(v.y-f.y)+f.x&&(b=!b)}return b}function bh(o,i){let u=!1;for(let f=0,v=o.length-1;f<o.length;v=f++){const b=o[f],w=o[v];b.y>i.y!=w.y>i.y&&i.x<(w.x-b.x)*(i.y-b.y)/(w.y-b.y)+b.x&&(u=!u)}return u}function K8(o,i,u){const f=u[0],v=u[2];if(o.x<f.x&&i.x<f.x||o.x>v.x&&i.x>v.x||o.y<f.y&&i.y<f.y||o.y>v.y&&i.y>v.y)return!1;const b=We(o,i,u[0]);return b!==We(o,i,u[1])||b!==We(o,i,u[2])||b!==We(o,i,u[3])}function jf(o,i,u){const f=i.paint.get(o).value;return f.kind==="constant"?f.value:u.programConfigurations.get(i.id).getMaxValue(o)}function Am(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Cm(o,i,u,f,v){if(!i[0]&&!i[1])return o;const b=T.convert(i)._mult(v);u==="viewport"&&b._rotate(-f);const w=[];for(let E=0;E<o.length;E++)w.push(o[E].sub(b));return w}let Sw,Mw;Jt("CircleBucket",Hf,{omit:["layers"]});var J8={get paint(){return Mw=Mw||new $i({"circle-radius":new Tn(je.paint_circle["circle-radius"]),"circle-color":new Tn(je.paint_circle["circle-color"]),"circle-blur":new Tn(je.paint_circle["circle-blur"]),"circle-opacity":new Tn(je.paint_circle["circle-opacity"]),"circle-translate":new mn(je.paint_circle["circle-translate"]),"circle-translate-anchor":new mn(je.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mn(je.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mn(je.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Tn(je.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Tn(je.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Tn(je.paint_circle["circle-stroke-opacity"])})},get layout(){return Sw=Sw||new $i({"circle-sort-key":new Tn(je.layout_circle["circle-sort-key"])})}},Zi=1e-6,wh=typeof Float32Array<"u"?Float32Array:Array;function ry(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function Tw(o,i,u){var f=i[0],v=i[1],b=i[2],w=i[3],E=i[4],R=i[5],L=i[6],j=i[7],W=i[8],K=i[9],re=i[10],le=i[11],fe=i[12],_e=i[13],Ce=i[14],Ge=i[15],De=u[0],Fe=u[1],dt=u[2],mt=u[3];return o[0]=De*f+Fe*E+dt*W+mt*fe,o[1]=De*v+Fe*R+dt*K+mt*_e,o[2]=De*b+Fe*L+dt*re+mt*Ce,o[3]=De*w+Fe*j+dt*le+mt*Ge,o[4]=(De=u[4])*f+(Fe=u[5])*E+(dt=u[6])*W+(mt=u[7])*fe,o[5]=De*v+Fe*R+dt*K+mt*_e,o[6]=De*b+Fe*L+dt*re+mt*Ce,o[7]=De*w+Fe*j+dt*le+mt*Ge,o[8]=(De=u[8])*f+(Fe=u[9])*E+(dt=u[10])*W+(mt=u[11])*fe,o[9]=De*v+Fe*R+dt*K+mt*_e,o[10]=De*b+Fe*L+dt*re+mt*Ce,o[11]=De*w+Fe*j+dt*le+mt*Ge,o[12]=(De=u[12])*f+(Fe=u[13])*E+(dt=u[14])*W+(mt=u[15])*fe,o[13]=De*v+Fe*R+dt*K+mt*_e,o[14]=De*b+Fe*L+dt*re+mt*Ce,o[15]=De*w+Fe*j+dt*le+mt*Ge,o}Math.hypot||(Math.hypot=function(){for(var o=0,i=arguments.length;i--;)o+=arguments[i]*arguments[i];return Math.sqrt(o)});var Wf,Q8=Tw;function Pm(o,i,u){var f=i[0],v=i[1],b=i[2],w=i[3];return o[0]=u[0]*f+u[4]*v+u[8]*b+u[12]*w,o[1]=u[1]*f+u[5]*v+u[9]*b+u[13]*w,o[2]=u[2]*f+u[6]*v+u[10]*b+u[14]*w,o[3]=u[3]*f+u[7]*v+u[11]*b+u[15]*w,o}Wf=new wh(4),wh!=Float32Array&&(Wf[0]=0,Wf[1]=0,Wf[2]=0,Wf[3]=0);class e7 extends Ua{constructor(i){super(i,J8)}createBucket(i){return new Hf(i)}queryRadius(i){const u=i;return jf("circle-radius",this,u)+jf("circle-stroke-width",this,u)+Am(this.paint.get("circle-translate"))}queryIntersectsFeature(i,u,f,v,b,w,E,R){const L=Cm(i,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),w.angle,E),j=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),W=this.paint.get("circle-pitch-alignment")==="map",K=W?L:function(le,fe){return le.map(_e=>Ew(_e,fe))}(L,R),re=W?j*E:j;for(const le of v)for(const fe of le){const _e=W?fe:Ew(fe,R);let Ce=re;const Ge=Pm([],[fe.x,fe.y,0,1],R);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Ce*=Ge[3]/w.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Ce*=w.cameraToCenterDistance/Ge[3]),Mm(K,_e,Ce))return!0}return!1}}function Ew(o,i){const u=Pm([],[o.x,o.y,0,1],i);return new T(u[0]/u[3],u[1]/u[3])}class Aw extends Hf{}let Cw;Jt("HeatmapBucket",Aw,{omit:["layers"]});var t7={get paint(){return Cw=Cw||new $i({"heatmap-radius":new Tn(je.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Tn(je.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mn(je.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Kc(je.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mn(je.paint_heatmap["heatmap-opacity"])})}};function iy(o,{width:i,height:u},f,v){if(v){if(v instanceof Uint8ClampedArray)v=new Uint8Array(v.buffer);else if(v.length!==i*u*f)throw new RangeError(`mismatched image size. expected: ${v.length} but got: ${i*u*f}`)}else v=new Uint8Array(i*u*f);return o.width=i,o.height=u,o.data=v,o}function Pw(o,{width:i,height:u},f){if(i===o.width&&u===o.height)return;const v=iy({},{width:i,height:u},f);ay(o,v,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,i),height:Math.min(o.height,u)},f),o.width=i,o.height=u,o.data=v.data}function ay(o,i,u,f,v,b){if(v.width===0||v.height===0)return i;if(v.width>o.width||v.height>o.height||u.x>o.width-v.width||u.y>o.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>i.width||v.height>i.height||f.x>i.width-v.width||f.y>i.height-v.height)throw new RangeError("out of range destination coordinates for image copy");const w=o.data,E=i.data;if(w===E)throw new Error("srcData equals dstData, so image is already copied");for(let R=0;R<v.height;R++){const L=((u.y+R)*o.width+u.x)*b,j=((f.y+R)*i.width+f.x)*b;for(let W=0;W<v.width*b;W++)E[j+W]=w[L+W]}return i}class qf{constructor(i,u){iy(this,i,1,u)}resize(i){Pw(this,i,1)}clone(){return new qf({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,v,b){ay(i,u,f,v,b,1)}}class Ga{constructor(i,u){iy(this,i,4,u)}resize(i){Pw(this,i,4)}replace(i,u){u?this.data.set(i):this.data=i instanceof Uint8ClampedArray?new Uint8Array(i.buffer):i}clone(){return new Ga({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(i,u,f,v,b){ay(i,u,f,v,b,4)}}function Rw(o){const i={},u=o.resolution||256,f=o.clips?o.clips.length:1,v=o.image||new Ga({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const b=(w,E,R)=>{i[o.evaluationKey]=R;const L=o.expression.evaluate(i);v.data[w+E+0]=Math.floor(255*L.r/L.a),v.data[w+E+1]=Math.floor(255*L.g/L.a),v.data[w+E+2]=Math.floor(255*L.b/L.a),v.data[w+E+3]=Math.floor(255*L.a)};if(o.clips)for(let w=0,E=0;w<f;++w,E+=4*u)for(let R=0,L=0;R<u;R++,L+=4){const j=R/(u-1),{start:W,end:K}=o.clips[w];b(E,L,W*(1-j)+K*j)}else for(let w=0,E=0;w<u;w++,E+=4)b(0,E,w/(u-1));return v}Jt("AlphaImage",qf),Jt("RGBAImage",Ga);class n7 extends Ua{createBucket(i){return new Aw(i)}constructor(i){super(i,t7),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(i){i==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Rw({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Iw;var r7={get paint(){return Iw=Iw||new $i({"hillshade-illumination-direction":new mn(je.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mn(je.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mn(je.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mn(je.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mn(je.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mn(je.paint_hillshade["hillshade-accent-color"])})}};class i7 extends Ua{constructor(i){super(i,r7)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const a7=Hr([{name:"a_pos",components:2,type:"Int16"}],4),{members:s7}=a7;var sy={exports:{}};function Rm(o,i,u){u=u||2;var f,v,b,w,E,R,L,j=i&&i.length,W=j?i[0]*u:o.length,K=Dw(o,0,W,u,!0),re=[];if(!K||K.next===K.prev)return re;if(j&&(K=function(fe,_e,Ce,Ge){var De,Fe,dt,mt=[];for(De=0,Fe=_e.length;De<Fe;De++)(dt=Dw(fe,_e[De]*Ge,De<Fe-1?_e[De+1]*Ge:fe.length,Ge,!1))===dt.next&&(dt.steiner=!0),mt.push(p7(dt));for(mt.sort(h7),De=0;De<mt.length;De++)Ce=d7(mt[De],Ce);return Ce}(o,i,K,u)),o.length>80*u){f=b=o[0],v=w=o[1];for(var le=u;le<W;le+=u)(E=o[le])<f&&(f=E),(R=o[le+1])<v&&(v=R),E>b&&(b=E),R>w&&(w=R);L=(L=Math.max(b-f,w-v))!==0?32767/L:0}return $f(K,re,u,f,v,L,0),re}function Dw(o,i,u,f,v){var b,w;if(v===cy(o,i,u,f)>0)for(b=i;b<u;b+=f)w=zw(b,o[b],o[b+1],w);else for(b=u-f;b>=i;b-=f)w=zw(b,o[b],o[b+1],w);return w&&Im(w,w.next)&&(Zf(w),w=w.next),w}function ru(o,i){if(!o)return o;i||(i=o);var u,f=o;do if(u=!1,f.steiner||!Im(f,f.next)&&Gr(f.prev,f,f.next)!==0)f=f.next;else{if(Zf(f),(f=i=f.prev)===f.next)break;u=!0}while(u||f!==i);return i}function $f(o,i,u,f,v,b,w){if(o){!w&&b&&function(j,W,K,re){var le=j;do le.z===0&&(le.z=oy(le.x,le.y,W,K,re)),le.prevZ=le.prev,le.nextZ=le.next,le=le.next;while(le!==j);le.prevZ.nextZ=null,le.prevZ=null,function(fe){var _e,Ce,Ge,De,Fe,dt,mt,qt,cn=1;do{for(Ce=fe,fe=null,Fe=null,dt=0;Ce;){for(dt++,Ge=Ce,mt=0,_e=0;_e<cn&&(mt++,Ge=Ge.nextZ);_e++);for(qt=cn;mt>0||qt>0&&Ge;)mt!==0&&(qt===0||!Ge||Ce.z<=Ge.z)?(De=Ce,Ce=Ce.nextZ,mt--):(De=Ge,Ge=Ge.nextZ,qt--),Fe?Fe.nextZ=De:fe=De,De.prevZ=Fe,Fe=De;Ce=Ge}Fe.nextZ=null,cn*=2}while(dt>1)}(le)}(o,f,v,b);for(var E,R,L=o;o.prev!==o.next;)if(E=o.prev,R=o.next,b?l7(o,f,v,b):o7(o))i.push(E.i/u|0),i.push(o.i/u|0),i.push(R.i/u|0),Zf(o),o=R.next,L=R.next;else if((o=R)===L){w?w===1?$f(o=c7(ru(o),i,u),i,u,f,v,b,2):w===2&&u7(o,i,u,f,v,b):$f(ru(o),i,u,f,v,b,1);break}}}function o7(o){var i=o.prev,u=o,f=o.next;if(Gr(i,u,f)>=0)return!1;for(var v=i.x,b=u.x,w=f.x,E=i.y,R=u.y,L=f.y,j=v<b?v<w?v:w:b<w?b:w,W=E<R?E<L?E:L:R<L?R:L,K=v>b?v>w?v:w:b>w?b:w,re=E>R?E>L?E:L:R>L?R:L,le=f.next;le!==i;){if(le.x>=j&&le.x<=K&&le.y>=W&&le.y<=re&&Sh(v,E,b,R,w,L,le.x,le.y)&&Gr(le.prev,le,le.next)>=0)return!1;le=le.next}return!0}function l7(o,i,u,f){var v=o.prev,b=o,w=o.next;if(Gr(v,b,w)>=0)return!1;for(var E=v.x,R=b.x,L=w.x,j=v.y,W=b.y,K=w.y,re=E<R?E<L?E:L:R<L?R:L,le=j<W?j<K?j:K:W<K?W:K,fe=E>R?E>L?E:L:R>L?R:L,_e=j>W?j>K?j:K:W>K?W:K,Ce=oy(re,le,i,u,f),Ge=oy(fe,_e,i,u,f),De=o.prevZ,Fe=o.nextZ;De&&De.z>=Ce&&Fe&&Fe.z<=Ge;){if(De.x>=re&&De.x<=fe&&De.y>=le&&De.y<=_e&&De!==v&&De!==w&&Sh(E,j,R,W,L,K,De.x,De.y)&&Gr(De.prev,De,De.next)>=0||(De=De.prevZ,Fe.x>=re&&Fe.x<=fe&&Fe.y>=le&&Fe.y<=_e&&Fe!==v&&Fe!==w&&Sh(E,j,R,W,L,K,Fe.x,Fe.y)&&Gr(Fe.prev,Fe,Fe.next)>=0))return!1;Fe=Fe.nextZ}for(;De&&De.z>=Ce;){if(De.x>=re&&De.x<=fe&&De.y>=le&&De.y<=_e&&De!==v&&De!==w&&Sh(E,j,R,W,L,K,De.x,De.y)&&Gr(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;Fe&&Fe.z<=Ge;){if(Fe.x>=re&&Fe.x<=fe&&Fe.y>=le&&Fe.y<=_e&&Fe!==v&&Fe!==w&&Sh(E,j,R,W,L,K,Fe.x,Fe.y)&&Gr(Fe.prev,Fe,Fe.next)>=0)return!1;Fe=Fe.nextZ}return!0}function c7(o,i,u){var f=o;do{var v=f.prev,b=f.next.next;!Im(v,b)&&kw(v,f,f.next,b)&&Xf(v,b)&&Xf(b,v)&&(i.push(v.i/u|0),i.push(f.i/u|0),i.push(b.i/u|0),Zf(f),Zf(f.next),f=o=b),f=f.next}while(f!==o);return ru(f)}function u7(o,i,u,f,v,b){var w=o;do{for(var E=w.next.next;E!==w.prev;){if(w.i!==E.i&&m7(w,E)){var R=Lw(w,E);return w=ru(w,w.next),R=ru(R,R.next),$f(w,i,u,f,v,b,0),void $f(R,i,u,f,v,b,0)}E=E.next}w=w.next}while(w!==o)}function h7(o,i){return o.x-i.x}function d7(o,i){var u=function(v,b){var w,E=b,R=v.x,L=v.y,j=-1/0;do{if(L<=E.y&&L>=E.next.y&&E.next.y!==E.y){var W=E.x+(L-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(W<=R&&W>j&&(j=W,w=E.x<E.next.x?E:E.next,W===R))return w}E=E.next}while(E!==b);if(!w)return null;var K,re=w,le=w.x,fe=w.y,_e=1/0;E=w;do R>=E.x&&E.x>=le&&R!==E.x&&Sh(L<fe?R:j,L,le,fe,L<fe?j:R,L,E.x,E.y)&&(K=Math.abs(L-E.y)/(R-E.x),Xf(E,v)&&(K<_e||K===_e&&(E.x>w.x||E.x===w.x&&f7(w,E)))&&(w=E,_e=K)),E=E.next;while(E!==re);return w}(o,i);if(!u)return i;var f=Lw(u,o);return ru(f,f.next),ru(u,u.next)}function f7(o,i){return Gr(o.prev,o,i.prev)<0&&Gr(i.next,o,o.next)<0}function oy(o,i,u,f,v){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=(o-u)*v|0)|o<<8))|o<<4))|o<<2))|o<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-f)*v|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function p7(o){var i=o,u=o;do(i.x<u.x||i.x===u.x&&i.y<u.y)&&(u=i),i=i.next;while(i!==o);return u}function Sh(o,i,u,f,v,b,w,E){return(v-w)*(i-E)>=(o-w)*(b-E)&&(o-w)*(f-E)>=(u-w)*(i-E)&&(u-w)*(b-E)>=(v-w)*(f-E)}function m7(o,i){return o.next.i!==i.i&&o.prev.i!==i.i&&!function(u,f){var v=u;do{if(v.i!==u.i&&v.next.i!==u.i&&v.i!==f.i&&v.next.i!==f.i&&kw(v,v.next,u,f))return!0;v=v.next}while(v!==u);return!1}(o,i)&&(Xf(o,i)&&Xf(i,o)&&function(u,f){var v=u,b=!1,w=(u.x+f.x)/2,E=(u.y+f.y)/2;do v.y>E!=v.next.y>E&&v.next.y!==v.y&&w<(v.next.x-v.x)*(E-v.y)/(v.next.y-v.y)+v.x&&(b=!b),v=v.next;while(v!==u);return b}(o,i)&&(Gr(o.prev,o,i.prev)||Gr(o,i.prev,i))||Im(o,i)&&Gr(o.prev,o,o.next)>0&&Gr(i.prev,i,i.next)>0)}function Gr(o,i,u){return(i.y-o.y)*(u.x-i.x)-(i.x-o.x)*(u.y-i.y)}function Im(o,i){return o.x===i.x&&o.y===i.y}function kw(o,i,u,f){var v=km(Gr(o,i,u)),b=km(Gr(o,i,f)),w=km(Gr(u,f,o)),E=km(Gr(u,f,i));return v!==b&&w!==E||!(v!==0||!Dm(o,u,i))||!(b!==0||!Dm(o,f,i))||!(w!==0||!Dm(u,o,f))||!(E!==0||!Dm(u,i,f))}function Dm(o,i,u){return i.x<=Math.max(o.x,u.x)&&i.x>=Math.min(o.x,u.x)&&i.y<=Math.max(o.y,u.y)&&i.y>=Math.min(o.y,u.y)}function km(o){return o>0?1:o<0?-1:0}function Xf(o,i){return Gr(o.prev,o,o.next)<0?Gr(o,i,o.next)>=0&&Gr(o,o.prev,i)>=0:Gr(o,i,o.prev)<0||Gr(o,o.next,i)<0}function Lw(o,i){var u=new ly(o.i,o.x,o.y),f=new ly(i.i,i.x,i.y),v=o.next,b=i.prev;return o.next=i,i.prev=o,u.next=v,v.prev=u,f.next=u,u.prev=f,b.next=f,f.prev=b,f}function zw(o,i,u,f){var v=new ly(o,i,u);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Zf(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function ly(o,i,u){this.i=o,this.x=i,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function cy(o,i,u,f){for(var v=0,b=i,w=u-f;b<u;b+=f)v+=(o[w]-o[b])*(o[b+1]+o[w+1]),w=b;return v}sy.exports=Rm,sy.exports.default=Rm,Rm.deviation=function(o,i,u,f){var v=i&&i.length,b=Math.abs(cy(o,0,v?i[0]*u:o.length,u));if(v)for(var w=0,E=i.length;w<E;w++)b-=Math.abs(cy(o,i[w]*u,w<E-1?i[w+1]*u:o.length,u));var R=0;for(w=0;w<f.length;w+=3){var L=f[w]*u,j=f[w+1]*u,W=f[w+2]*u;R+=Math.abs((o[L]-o[W])*(o[j+1]-o[L+1])-(o[L]-o[j])*(o[W+1]-o[L+1]))}return b===0&&R===0?0:Math.abs((R-b)/b)},Rm.flatten=function(o){for(var i=o[0][0].length,u={vertices:[],holes:[],dimensions:i},f=0,v=0;v<o.length;v++){for(var b=0;b<o[v].length;b++)for(var w=0;w<i;w++)u.vertices.push(o[v][b][w]);v>0&&u.holes.push(f+=o[v-1].length)}return u};var Fw=m(sy.exports);function g7(o,i,u,f,v){Nw(o,i,u||0,f||o.length-1,v||v7)}function Nw(o,i,u,f,v){for(;f>u;){if(f-u>600){var b=f-u+1,w=i-u+1,E=Math.log(b),R=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*R*(b-R)/b)*(w-b/2<0?-1:1);Nw(o,i,Math.max(u,Math.floor(i-w*R/b+L)),Math.min(f,Math.floor(i+(b-w)*R/b+L)),v)}var j=o[i],W=u,K=f;for(Yf(o,u,i),v(o[f],j)>0&&Yf(o,u,f);W<K;){for(Yf(o,W,K),W++,K--;v(o[W],j)<0;)W++;for(;v(o[K],j)>0;)K--}v(o[u],j)===0?Yf(o,u,K):Yf(o,++K,f),K<=i&&(u=K+1),i<=K&&(f=K-1)}}function Yf(o,i,u){var f=o[i];o[i]=o[u],o[u]=f}function v7(o,i){return o<i?-1:o>i?1:0}function uy(o,i){const u=o.length;if(u<=1)return[o];const f=[];let v,b;for(let w=0;w<u;w++){const E=ct(o[w]);E!==0&&(o[w].area=Math.abs(E),b===void 0&&(b=E<0),b===E<0?(v&&f.push(v),v=[o[w]]):v.push(o[w]))}if(v&&f.push(v),i>1)for(let w=0;w<f.length;w++)f[w].length<=i||(g7(f[w],i,1,f[w].length-1,y7),f[w]=f[w].slice(0,i));return f}function y7(o,i){return i.area-o.area}function hy(o,i,u){const f=u.patternDependencies;let v=!1;for(const b of i){const w=b.paint.get(`${o}-pattern`);w.isConstant()||(v=!0);const E=w.constantOr(null);E&&(v=!0,f[E.to]=!0,f[E.from]=!0)}return v}function dy(o,i,u,f,v){const b=v.patternDependencies;for(const w of i){const E=w.paint.get(`${o}-pattern`).value;if(E.kind!=="constant"){let R=E.evaluate({zoom:f-1},u,{},v.availableImages),L=E.evaluate({zoom:f},u,{},v.availableImages),j=E.evaluate({zoom:f+1},u,{},v.availableImages);R=R&&R.name?R.name:R,L=L&&L.name?L.name:L,j=j&&j.name?j.name:j,b[R]=!0,b[L]=!0,b[j]=!0,u.patterns[w.id]={min:R,mid:L,max:j}}}return u}class fy{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new oe,this.indexArray=new nt,this.indexArray2=new ut,this.programConfigurations=new Mr(i.layers,i.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f){this.hasPattern=hy("fill",this.layers,u);const v=this.layers[0].layout.get("fill-sort-key"),b=!v.isConstant(),w=[];for(const{feature:E,id:R,index:L,sourceLayerIndex:j}of i){const W=this.layers[0]._featureFilter.needGeometry,K=Oo(E,W);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),K,f))continue;const re=b?v.evaluate(K,{},f,u.availableImages):void 0,le={id:R,properties:E.properties,type:E.type,sourceLayerIndex:j,index:L,geometry:W?K.geometry:Bo(E),patterns:{},sortKey:re};w.push(le)}b&&w.sort((E,R)=>E.sortKey-R.sortKey);for(const E of w){const{geometry:R,index:L,sourceLayerIndex:j}=E;if(this.hasPattern){const W=dy("fill",this.layers,E,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(E,R,L,f,{});u.featureIndex.insert(i[L].feature,R,L,j,this.index)}}update(i,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f)}addFeatures(i,u,f){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,s7),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.indexBuffer2=i.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(i,u,f,v,b){for(const w of uy(u,500)){let E=0;for(const re of w)E+=re.length;const R=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),L=R.vertexLength,j=[],W=[];for(const re of w){if(re.length===0)continue;re!==w[0]&&W.push(j.length/2);const le=this.segments2.prepareSegment(re.length,this.layoutVertexArray,this.indexArray2),fe=le.vertexLength;this.layoutVertexArray.emplaceBack(re[0].x,re[0].y),this.indexArray2.emplaceBack(fe+re.length-1,fe),j.push(re[0].x),j.push(re[0].y);for(let _e=1;_e<re.length;_e++)this.layoutVertexArray.emplaceBack(re[_e].x,re[_e].y),this.indexArray2.emplaceBack(fe+_e-1,fe+_e),j.push(re[_e].x),j.push(re[_e].y);le.vertexLength+=re.length,le.primitiveLength+=re.length}const K=Fw(j,W);for(let re=0;re<K.length;re+=3)this.indexArray.emplaceBack(L+K[re],L+K[re+1],L+K[re+2]);R.vertexLength+=E,R.primitiveLength+=K.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,v)}}let Bw,Ow;Jt("FillBucket",fy,{omit:["layers","patternFeatures"]});var _7={get paint(){return Ow=Ow||new $i({"fill-antialias":new mn(je.paint_fill["fill-antialias"]),"fill-opacity":new Tn(je.paint_fill["fill-opacity"]),"fill-color":new Tn(je.paint_fill["fill-color"]),"fill-outline-color":new Tn(je.paint_fill["fill-outline-color"]),"fill-translate":new mn(je.paint_fill["fill-translate"]),"fill-translate-anchor":new mn(je.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lo(je.paint_fill["fill-pattern"])})},get layout(){return Bw=Bw||new $i({"fill-sort-key":new Tn(je.layout_fill["fill-sort-key"])})}};class x7 extends Ua{constructor(i){super(i,_7)}recalculate(i,u){super.recalculate(i,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(i){return new fy(i)}queryRadius(){return Am(this.paint.get("fill-translate"))}queryIntersectsFeature(i,u,f,v,b,w,E){return Gf(Cm(i,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),w.angle,E),v)}isTileClipped(){return!0}}const b7=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),w7=Hr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:S7}=b7;var Ul={},M7=_,Uw=Mh;function Mh(o,i,u,f,v){this.properties={},this.extent=u,this.type=0,this._pbf=o,this._geometry=-1,this._keys=f,this._values=v,o.readFields(T7,this,i)}function T7(o,i,u){o==1?i.id=u.readVarint():o==2?function(f,v){for(var b=f.readVarint()+f.pos;f.pos<b;){var w=v._keys[f.readVarint()],E=v._values[f.readVarint()];v.properties[w]=E}}(u,i):o==3?i.type=u.readVarint():o==4&&(i._geometry=u.pos)}function E7(o){for(var i,u,f=0,v=0,b=o.length,w=b-1;v<b;w=v++)f+=((u=o[w]).x-(i=o[v]).x)*(i.y+u.y);return f}Mh.types=["Unknown","Point","LineString","Polygon"],Mh.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var i,u=o.readVarint()+o.pos,f=1,v=0,b=0,w=0,E=[];o.pos<u;){if(v<=0){var R=o.readVarint();f=7&R,v=R>>3}if(v--,f===1||f===2)b+=o.readSVarint(),w+=o.readSVarint(),f===1&&(i&&E.push(i),i=[]),i.push(new M7(b,w));else{if(f!==7)throw new Error("unknown command "+f);i&&i.push(i[0].clone())}}return i&&E.push(i),E},Mh.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var i=o.readVarint()+o.pos,u=1,f=0,v=0,b=0,w=1/0,E=-1/0,R=1/0,L=-1/0;o.pos<i;){if(f<=0){var j=o.readVarint();u=7&j,f=j>>3}if(f--,u===1||u===2)(v+=o.readSVarint())<w&&(w=v),v>E&&(E=v),(b+=o.readSVarint())<R&&(R=b),b>L&&(L=b);else if(u!==7)throw new Error("unknown command "+u)}return[w,R,E,L]},Mh.prototype.toGeoJSON=function(o,i,u){var f,v,b=this.extent*Math.pow(2,u),w=this.extent*o,E=this.extent*i,R=this.loadGeometry(),L=Mh.types[this.type];function j(re){for(var le=0;le<re.length;le++){var fe=re[le];re[le]=[360*(fe.x+w)/b-180,360/Math.PI*Math.atan(Math.exp((180-360*(fe.y+E)/b)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(f=0;f<R.length;f++)W[f]=R[f][0];j(R=W);break;case 2:for(f=0;f<R.length;f++)j(R[f]);break;case 3:for(R=function(re){var le=re.length;if(le<=1)return[re];for(var fe,_e,Ce=[],Ge=0;Ge<le;Ge++){var De=E7(re[Ge]);De!==0&&(_e===void 0&&(_e=De<0),_e===De<0?(fe&&Ce.push(fe),fe=[re[Ge]]):fe.push(re[Ge]))}return fe&&Ce.push(fe),Ce}(R),f=0;f<R.length;f++)for(v=0;v<R[f].length;v++)j(R[f][v])}R.length===1?R=R[0]:L="Multi"+L;var K={type:"Feature",geometry:{type:L,coordinates:R},properties:this.properties};return"id"in this&&(K.id=this.id),K};var A7=Uw,Vw=Hw;function Hw(o,i){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(C7,this,i),this.length=this._features.length}function C7(o,i,u){o===15?i.version=u.readVarint():o===1?i.name=u.readString():o===5?i.extent=u.readVarint():o===2?i._features.push(u.pos):o===3?i._keys.push(u.readString()):o===4&&i._values.push(function(f){for(var v=null,b=f.readVarint()+f.pos;f.pos<b;){var w=f.readVarint()>>3;v=w===1?f.readString():w===2?f.readFloat():w===3?f.readDouble():w===4?f.readVarint64():w===5?f.readVarint():w===6?f.readSVarint():w===7?f.readBoolean():null}return v}(u))}Hw.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var i=this._pbf.readVarint()+this._pbf.pos;return new A7(this._pbf,i,this.extent,this._keys,this._values)};var P7=Vw;function R7(o,i,u){if(o===3){var f=new P7(u,u.readVarint()+u.pos);f.length&&(i[f.name]=f)}}Ul.VectorTile=function(o,i){this.layers=o.readFields(R7,{},i)},Ul.VectorTileFeature=Uw,Ul.VectorTileLayer=Vw;const I7=Ul.VectorTileFeature.types,py=Math.pow(2,13);function Kf(o,i,u,f,v,b,w,E){o.emplaceBack(i,u,2*Math.floor(f*py)+w,v*py*2,b*py*2,Math.round(E))}class my{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.layoutVertexArray=new ye,this.centroidVertexArray=new $,this.indexArray=new nt,this.programConfigurations=new Mr(i.layers,i.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f){this.features=[],this.hasPattern=hy("fill-extrusion",this.layers,u);for(const{feature:v,id:b,index:w,sourceLayerIndex:E}of i){const R=this.layers[0]._featureFilter.needGeometry,L=Oo(v,R);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),L,f))continue;const j={id:b,sourceLayerIndex:E,index:w,geometry:R?L.geometry:Bo(v),properties:v.properties,type:v.type,patterns:{}};this.hasPattern?this.features.push(dy("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,w,f,{}),u.featureIndex.insert(v,j.geometry,w,E,this.index,!0)}}addFeatures(i,u,f){for(const v of this.features){const{geometry:b}=v;this.addFeature(v,b,v.index,u,f)}}update(i,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,S7),this.centroidVertexBuffer=i.createVertexBuffer(this.centroidVertexArray,w7.members,!0),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(i,u,f,v,b){const w={x:0,y:0,vertexCount:0};for(const E of uy(u,500)){let R=0;for(const le of E)R+=le.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const le of E){if(le.length===0||k7(le))continue;let fe=0;for(let _e=0;_e<le.length;_e++){const Ce=le[_e];if(_e>=1){const Ge=le[_e-1];if(!D7(Ce,Ge)){L.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Ce.sub(Ge)._perp()._unit(),Fe=Ge.dist(Ce);fe+Fe>32768&&(fe=0),Kf(this.layoutVertexArray,Ce.x,Ce.y,De.x,De.y,0,0,fe),Kf(this.layoutVertexArray,Ce.x,Ce.y,De.x,De.y,0,1,fe),w.x+=2*Ce.x,w.y+=2*Ce.y,w.vertexCount+=2,fe+=Fe,Kf(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,0,fe),Kf(this.layoutVertexArray,Ge.x,Ge.y,De.x,De.y,0,1,fe),w.x+=2*Ge.x,w.y+=2*Ge.y,w.vertexCount+=2;const dt=L.vertexLength;this.indexArray.emplaceBack(dt,dt+2,dt+1),this.indexArray.emplaceBack(dt+1,dt+2,dt+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+R>xt.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(R,this.layoutVertexArray,this.indexArray)),I7[i.type]!=="Polygon")continue;const j=[],W=[],K=L.vertexLength;for(const le of E)if(le.length!==0){le!==E[0]&&W.push(j.length/2);for(let fe=0;fe<le.length;fe++){const _e=le[fe];Kf(this.layoutVertexArray,_e.x,_e.y,0,0,1,1,0),w.x+=_e.x,w.y+=_e.y,w.vertexCount+=1,j.push(_e.x),j.push(_e.y)}}const re=Fw(j,W);for(let le=0;le<re.length;le+=3)this.indexArray.emplaceBack(K+re[le],K+re[le+2],K+re[le+1]);L.primitiveLength+=re.length/3,L.vertexLength+=R}for(let E=0;E<w.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(w.x/w.vertexCount),Math.floor(w.y/w.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,v)}}function D7(o,i){return o.x===i.x&&(o.x<0||o.x>Wn)||o.y===i.y&&(o.y<0||o.y>Wn)}function k7(o){return o.every(i=>i.x<0)||o.every(i=>i.x>Wn)||o.every(i=>i.y<0)||o.every(i=>i.y>Wn)}let Gw;Jt("FillExtrusionBucket",my,{omit:["layers","features"]});var L7={get paint(){return Gw=Gw||new $i({"fill-extrusion-opacity":new mn(je["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Tn(je["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mn(je["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mn(je["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lo(je["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Tn(je["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Tn(je["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mn(je["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class z7 extends Ua{constructor(i){super(i,L7)}createBucket(i){return new my(i)}queryRadius(){return Am(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(i,u,f,v,b,w,E,R){const L=Cm(i,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),w.angle,E),j=this.paint.get("fill-extrusion-height").evaluate(u,f),W=this.paint.get("fill-extrusion-base").evaluate(u,f),K=function(le,fe,_e,Ce){const Ge=[];for(const De of le){const Fe=[De.x,De.y,0,1];Pm(Fe,Fe,fe),Ge.push(new T(Fe[0]/Fe[3],Fe[1]/Fe[3]))}return Ge}(L,R),re=function(le,fe,_e,Ce){const Ge=[],De=[],Fe=Ce[8]*fe,dt=Ce[9]*fe,mt=Ce[10]*fe,qt=Ce[11]*fe,cn=Ce[8]*_e,jt=Ce[9]*_e,Vt=Ce[10]*_e,Rt=Ce[11]*_e;for(const rn of le){const Bt=[],Et=[];for(const _n of rn){const dn=_n.x,jn=_n.y,br=Ce[0]*dn+Ce[4]*jn+Ce[12],Tr=Ce[1]*dn+Ce[5]*jn+Ce[13],ri=Ce[2]*dn+Ce[6]*jn+Ce[14],Ea=Ce[3]*dn+Ce[7]*jn+Ce[15],Yi=ri+mt,Kr=Ea+qt,yi=br+cn,Pi=Tr+jt,Ki=ri+Vt,Ji=Ea+Rt,ii=new T((br+Fe)/Kr,(Tr+dt)/Kr);ii.z=Yi/Kr,Bt.push(ii);const ai=new T(yi/Ji,Pi/Ji);ai.z=Ki/Ji,Et.push(ai)}Ge.push(Bt),De.push(Et)}return[Ge,De]}(v,W,j,R);return function(le,fe,_e){let Ce=1/0;Gf(_e,fe)&&(Ce=jw(_e,fe[0]));for(let Ge=0;Ge<fe.length;Ge++){const De=fe[Ge],Fe=le[Ge];for(let dt=0;dt<De.length-1;dt++){const mt=De[dt],qt=[mt,De[dt+1],Fe[dt+1],Fe[dt],mt];Uo(_e,qt)&&(Ce=Math.min(Ce,jw(_e,qt)))}}return Ce!==1/0&&Ce}(re[0],re[1],K)}}function Jf(o,i){return o.x*i.x+o.y*i.y}function jw(o,i){if(o.length===1){let u=0;const f=i[u++];let v;for(;!v||f.equals(v);)if(v=i[u++],!v)return 1/0;for(;u<i.length;u++){const b=i[u],w=o[0],E=v.sub(f),R=b.sub(f),L=w.sub(f),j=Jf(E,E),W=Jf(E,R),K=Jf(R,R),re=Jf(L,E),le=Jf(L,R),fe=j*K-W*W,_e=(K*re-W*le)/fe,Ce=(j*le-W*re)/fe,Ge=f.z*(1-_e-Ce)+v.z*_e+b.z*Ce;if(isFinite(Ge))return Ge}return 1/0}{let u=1/0;for(const f of i)u=Math.min(u,f.z);return u}}const F7=Hr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:N7}=F7,B7=Hr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:O7}=B7,U7=Ul.VectorTileFeature.types,V7=Math.cos(Math.PI/180*37.5),Ww=Math.pow(2,14)/.5;class gy{constructor(i){this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(u=>u.id),this.index=i.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new be,this.indexArray=new nt,this.programConfigurations=new Mr(i.layers,i.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(i,u,f){this.hasPattern=hy("line",this.layers,u);const v=this.layers[0].layout.get("line-sort-key"),b=!v.isConstant(),w=[];for(const{feature:E,id:R,index:L,sourceLayerIndex:j}of i){const W=this.layers[0]._featureFilter.needGeometry,K=Oo(E,W);if(!this.layers[0]._featureFilter.filter(new _r(this.zoom),K,f))continue;const re=b?v.evaluate(K,{},f):void 0,le={id:R,properties:E.properties,type:E.type,sourceLayerIndex:j,index:L,geometry:W?K.geometry:Bo(E),patterns:{},sortKey:re};w.push(le)}b&&w.sort((E,R)=>E.sortKey-R.sortKey);for(const E of w){const{geometry:R,index:L,sourceLayerIndex:j}=E;if(this.hasPattern){const W=dy("line",this.layers,E,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(E,R,L,f,{});u.featureIndex.insert(i[L].feature,R,L,j,this.index)}}update(i,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(i,u,this.stateDependentLayers,f)}addFeatures(i,u,f){for(const v of this.patternFeatures)this.addFeature(v,v.geometry,v.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(i){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=i.createVertexBuffer(this.layoutVertexArray2,O7)),this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,N7),this.indexBuffer=i.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(i),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(i){if(i.properties&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(i.properties,"mapbox_clip_end"))return{start:+i.properties.mapbox_clip_start,end:+i.properties.mapbox_clip_end}}addFeature(i,u,f,v,b){const w=this.layers[0].layout,E=w.get("line-join").evaluate(i,{}),R=w.get("line-cap"),L=w.get("line-miter-limit"),j=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(i);for(const W of u)this.addLine(W,i,E,R,L,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,f,b,v)}addLine(i,u,f,v,b,w){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Ce=0;Ce<i.length-1;Ce++)this.totalDistance+=i[Ce].dist(i[Ce+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=U7[u.type]==="Polygon";let R=i.length;for(;R>=2&&i[R-1].equals(i[R-2]);)R--;let L=0;for(;L<R-1&&i[L].equals(i[L+1]);)L++;if(R<(E?3:2))return;f==="bevel"&&(b=1.05);const j=this.overscaling<=16?15*Wn/(512*this.overscaling):0,W=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let K,re,le,fe,_e;this.e1=this.e2=-1,E&&(K=i[R-2],_e=i[L].sub(K)._unit()._perp());for(let Ce=L;Ce<R;Ce++){if(le=Ce===R-1?E?i[L+1]:void 0:i[Ce+1],le&&i[Ce].equals(le))continue;_e&&(fe=_e),K&&(re=K),K=i[Ce],_e=le?le.sub(K)._unit()._perp():fe,fe=fe||_e;let Ge=fe.add(_e);Ge.x===0&&Ge.y===0||Ge._unit();const De=fe.x*_e.x+fe.y*_e.y,Fe=Ge.x*_e.x+Ge.y*_e.y,dt=Fe!==0?1/Fe:1/0,mt=2*Math.sqrt(2-2*Fe),qt=Fe<V7&&re&&le,cn=fe.x*_e.y-fe.y*_e.x>0;if(qt&&Ce>L){const Rt=K.dist(re);if(Rt>2*j){const rn=K.sub(K.sub(re)._mult(j/Rt)._round());this.updateDistance(re,rn),this.addCurrentVertex(rn,fe,0,0,W),re=rn}}const jt=re&&le;let Vt=jt?f:E?"butt":v;if(jt&&Vt==="round"&&(dt<w?Vt="miter":dt<=2&&(Vt="fakeround")),Vt==="miter"&&dt>b&&(Vt="bevel"),Vt==="bevel"&&(dt>2&&(Vt="flipbevel"),dt<b&&(Vt="miter")),re&&this.updateDistance(re,K),Vt==="miter")Ge._mult(dt),this.addCurrentVertex(K,Ge,0,0,W);else if(Vt==="flipbevel"){if(dt>100)Ge=_e.mult(-1);else{const Rt=dt*fe.add(_e).mag()/fe.sub(_e).mag();Ge._perp()._mult(Rt*(cn?-1:1))}this.addCurrentVertex(K,Ge,0,0,W),this.addCurrentVertex(K,Ge.mult(-1),0,0,W)}else if(Vt==="bevel"||Vt==="fakeround"){const Rt=-Math.sqrt(dt*dt-1),rn=cn?Rt:0,Bt=cn?0:Rt;if(re&&this.addCurrentVertex(K,fe,rn,Bt,W),Vt==="fakeround"){const Et=Math.round(180*mt/Math.PI/20);for(let _n=1;_n<Et;_n++){let dn=_n/Et;if(dn!==.5){const br=dn-.5;dn+=dn*br*(dn-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*br*br+(.848013+De*(.215638*De-1.06021)))}const jn=_e.sub(fe)._mult(dn)._add(fe)._unit()._mult(cn?-1:1);this.addHalfVertex(K,jn.x,jn.y,!1,cn,0,W)}}le&&this.addCurrentVertex(K,_e,-rn,-Bt,W)}else if(Vt==="butt")this.addCurrentVertex(K,Ge,0,0,W);else if(Vt==="square"){const Rt=re?1:-1;this.addCurrentVertex(K,Ge,Rt,Rt,W)}else Vt==="round"&&(re&&(this.addCurrentVertex(K,fe,0,0,W),this.addCurrentVertex(K,fe,1,1,W,!0)),le&&(this.addCurrentVertex(K,_e,-1,-1,W,!0),this.addCurrentVertex(K,_e,0,0,W)));if(qt&&Ce<R-1){const Rt=K.dist(le);if(Rt>2*j){const rn=K.add(le.sub(K)._mult(j/Rt)._round());this.updateDistance(K,rn),this.addCurrentVertex(rn,_e,0,0,W),K=rn}}}}addCurrentVertex(i,u,f,v,b,w=!1){const E=u.y*v-u.x,R=-u.y-u.x*v;this.addHalfVertex(i,u.x+u.y*f,u.y-u.x*f,w,!1,f,b),this.addHalfVertex(i,E,R,w,!0,-v,b),this.distance>Ww/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(i,u,f,v,b,w))}addHalfVertex({x:i,y:u},f,v,b,w,E,R){const L=.5*(this.lineClips?this.scaledDistance*(Ww-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((i<<1)+(b?1:0),(u<<1)+(w?1:0),Math.round(63*f)+128,Math.round(63*v)+128,1+(E===0?0:E<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=R.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),R.primitiveLength++),w?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(i,u){this.distance+=i.dist(u),this.updateScaledDistance()}}let qw,$w;Jt("LineBucket",gy,{omit:["layers","patternFeatures"]});var Xw={get paint(){return $w=$w||new $i({"line-opacity":new Tn(je.paint_line["line-opacity"]),"line-color":new Tn(je.paint_line["line-color"]),"line-translate":new mn(je.paint_line["line-translate"]),"line-translate-anchor":new mn(je.paint_line["line-translate-anchor"]),"line-width":new Tn(je.paint_line["line-width"]),"line-gap-width":new Tn(je.paint_line["line-gap-width"]),"line-offset":new Tn(je.paint_line["line-offset"]),"line-blur":new Tn(je.paint_line["line-blur"]),"line-dasharray":new Rf(je.paint_line["line-dasharray"]),"line-pattern":new Lo(je.paint_line["line-pattern"]),"line-gradient":new Kc(je.paint_line["line-gradient"])})},get layout(){return qw=qw||new $i({"line-cap":new mn(je.layout_line["line-cap"]),"line-join":new Tn(je.layout_line["line-join"]),"line-miter-limit":new mn(je.layout_line["line-miter-limit"]),"line-round-limit":new mn(je.layout_line["line-round-limit"]),"line-sort-key":new Tn(je.layout_line["line-sort-key"])})}};class H7 extends Tn{possiblyEvaluate(i,u){return u=new _r(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(i,u)}evaluate(i,u,f,v){return u=ne({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(i,u,f,v)}}let Lm;class G7 extends Ua{constructor(i){super(i,Xw),this.gradientVersion=0,Lm||(Lm=new H7(Xw.paint.properties["line-width"].specification),Lm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(i){if(i==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof bl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(i,u){super.recalculate(i,u),this.paint._values["line-floorwidth"]=Lm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,i)}createBucket(i){return new gy(i)}queryRadius(i){const u=i,f=Zw(jf("line-width",this,u),jf("line-gap-width",this,u)),v=jf("line-offset",this,u);return f/2+Math.abs(v)+Am(this.paint.get("line-translate"))}queryIntersectsFeature(i,u,f,v,b,w,E){const R=Cm(i,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),w.angle,E),L=E/2*Zw(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),j=this.paint.get("line-offset").evaluate(u,f);return j&&(v=function(W,K){const re=[];for(let le=0;le<W.length;le++){const fe=W[le],_e=[];for(let Ce=0;Ce<fe.length;Ce++){const Ge=fe[Ce-1],De=fe[Ce],Fe=fe[Ce+1],dt=Ce===0?new T(0,0):De.sub(Ge)._unit()._perp(),mt=Ce===fe.length-1?new T(0,0):Fe.sub(De)._unit()._perp(),qt=dt._add(mt)._unit(),cn=qt.x*mt.x+qt.y*mt.y;cn!==0&&qt._mult(1/cn),_e.push(qt._mult(K)._add(De))}re.push(_e)}return re}(v,j*E)),function(W,K,re){for(let le=0;le<K.length;le++){const fe=K[le];if(W.length>=3){for(let _e=0;_e<fe.length;_e++)if(bh(W,fe[_e]))return!0}if(Tm(W,fe,re))return!0}return!1}(R,v,L)}isTileClipped(){return!0}}function Zw(o,i){return i>0?i+2*o:o}const j7=Hr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),W7=Hr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Hr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const q7=Hr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Hr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Yw=Hr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$7=Hr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function X7(o,i,u){return o.sections.forEach(f=>{f.text=function(v,b,w){const E=b.layout.get("text-transform").evaluate(w,{});return E==="uppercase"?v=v.toLocaleUpperCase():E==="lowercase"&&(v=v.toLocaleLowerCase()),ko.applyArabicShaping&&(v=ko.applyArabicShaping(v)),v}(f.text,i,u)}),o}Hr([{name:"triangle",components:3,type:"Uint16"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Hr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Hr([{type:"Float32",name:"offsetX"}]),Hr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Hr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const Qf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ni=24,Kw=ur,Jw=function(o,i,u,f,v){var b,w,E=8*v-f-1,R=(1<<E)-1,L=R>>1,j=-7,W=u?v-1:0,K=u?-1:1,re=o[i+W];for(W+=K,b=re&(1<<-j)-1,re>>=-j,j+=E;j>0;b=256*b+o[i+W],W+=K,j-=8);for(w=b&(1<<-j)-1,b>>=-j,j+=f;j>0;w=256*w+o[i+W],W+=K,j-=8);if(b===0)b=1-L;else{if(b===R)return w?NaN:1/0*(re?-1:1);w+=Math.pow(2,f),b-=L}return(re?-1:1)*w*Math.pow(2,b-f)},Qw=function(o,i,u,f,v,b){var w,E,R,L=8*b-v-1,j=(1<<L)-1,W=j>>1,K=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,re=f?0:b-1,le=f?1:-1,fe=i<0||i===0&&1/i<0?1:0;for(i=Math.abs(i),isNaN(i)||i===1/0?(E=isNaN(i)?1:0,w=j):(w=Math.floor(Math.log(i)/Math.LN2),i*(R=Math.pow(2,-w))<1&&(w--,R*=2),(i+=w+W>=1?K/R:K*Math.pow(2,1-W))*R>=2&&(w++,R/=2),w+W>=j?(E=0,w=j):w+W>=1?(E=(i*R-1)*Math.pow(2,v),w+=W):(E=i*Math.pow(2,W-1)*Math.pow(2,v),w=0));v>=8;o[u+re]=255&E,re+=le,E/=256,v-=8);for(w=w<<v|E,L+=v;L>0;o[u+re]=255&w,re+=le,w/=256,L-=8);o[u+re-le]|=128*fe};function ur(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}ur.Varint=0,ur.Fixed64=1,ur.Bytes=2,ur.Fixed32=5;var vy=4294967296,e4=1/vy,t4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Vo(o){return o.type===ur.Bytes?o.readVarint()+o.pos:o.pos+1}function Th(o,i,u){return u?4294967296*i+(o>>>0):4294967296*(i>>>0)+(o>>>0)}function n4(o,i,u){var f=i<=16383?1:i<=2097151?2:i<=268435455?3:Math.floor(Math.log(i)/(7*Math.LN2));u.realloc(f);for(var v=u.pos-1;v>=o;v--)u.buf[v+f]=u.buf[v]}function Z7(o,i){for(var u=0;u<o.length;u++)i.writeVarint(o[u])}function Y7(o,i){for(var u=0;u<o.length;u++)i.writeSVarint(o[u])}function K7(o,i){for(var u=0;u<o.length;u++)i.writeFloat(o[u])}function J7(o,i){for(var u=0;u<o.length;u++)i.writeDouble(o[u])}function Q7(o,i){for(var u=0;u<o.length;u++)i.writeBoolean(o[u])}function eC(o,i){for(var u=0;u<o.length;u++)i.writeFixed32(o[u])}function tC(o,i){for(var u=0;u<o.length;u++)i.writeSFixed32(o[u])}function nC(o,i){for(var u=0;u<o.length;u++)i.writeFixed64(o[u])}function rC(o,i){for(var u=0;u<o.length;u++)i.writeSFixed64(o[u])}function zm(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+16777216*o[i+3]}function Eh(o,i,u){o[u]=i,o[u+1]=i>>>8,o[u+2]=i>>>16,o[u+3]=i>>>24}function r4(o,i){return(o[i]|o[i+1]<<8|o[i+2]<<16)+(o[i+3]<<24)}ur.prototype={destroy:function(){this.buf=null},readFields:function(o,i,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),v=f>>3,b=this.pos;this.type=7&f,o(v,i,this),this.pos===b&&this.skip(f)}return i},readMessage:function(o,i){return this.readFields(o,i,this.readVarint()+this.pos)},readFixed32:function(){var o=zm(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=r4(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=zm(this.buf,this.pos)+zm(this.buf,this.pos+4)*vy;return this.pos+=8,o},readSFixed64:function(){var o=zm(this.buf,this.pos)+r4(this.buf,this.pos+4)*vy;return this.pos+=8,o},readFloat:function(){var o=Jw(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Jw(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var i,u,f=this.buf;return i=127&(u=f[this.pos++]),u<128?i:(i|=(127&(u=f[this.pos++]))<<7,u<128?i:(i|=(127&(u=f[this.pos++]))<<14,u<128?i:(i|=(127&(u=f[this.pos++]))<<21,u<128?i:function(v,b,w){var E,R,L=w.buf;if(E=(112&(R=L[w.pos++]))>>4,R<128||(E|=(127&(R=L[w.pos++]))<<3,R<128)||(E|=(127&(R=L[w.pos++]))<<10,R<128)||(E|=(127&(R=L[w.pos++]))<<17,R<128)||(E|=(127&(R=L[w.pos++]))<<24,R<128)||(E|=(1&(R=L[w.pos++]))<<31,R<128))return Th(v,E,b);throw new Error("Expected varint not more than 10 bytes")}(i|=(15&(u=f[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,i=this.pos;return this.pos=o,o-i>=12&&t4?function(u,f,v){return t4.decode(u.subarray(f,v))}(this.buf,i,o):function(u,f,v){for(var b="",w=f;w<v;){var E,R,L,j=u[w],W=null,K=j>239?4:j>223?3:j>191?2:1;if(w+K>v)break;K===1?j<128&&(W=j):K===2?(192&(E=u[w+1]))==128&&(W=(31&j)<<6|63&E)<=127&&(W=null):K===3?(R=u[w+2],(192&(E=u[w+1]))==128&&(192&R)==128&&((W=(15&j)<<12|(63&E)<<6|63&R)<=2047||W>=55296&&W<=57343)&&(W=null)):K===4&&(R=u[w+2],L=u[w+3],(192&(E=u[w+1]))==128&&(192&R)==128&&(192&L)==128&&((W=(15&j)<<18|(63&E)<<12|(63&R)<<6|63&L)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,K=1):W>65535&&(W-=65536,b+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),b+=String.fromCharCode(W),w+=K}return b}(this.buf,i,o)},readBytes:function(){var o=this.readVarint()+this.pos,i=this.buf.subarray(this.pos,o);return this.pos=o,i},readPackedVarint:function(o,i){if(this.type!==ur.Bytes)return o.push(this.readVarint(i));var u=Vo(this);for(o=o||[];this.pos<u;)o.push(this.readVarint(i));return o},readPackedSVarint:function(o){if(this.type!==ur.Bytes)return o.push(this.readSVarint());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==ur.Bytes)return o.push(this.readBoolean());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==ur.Bytes)return o.push(this.readFloat());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==ur.Bytes)return o.push(this.readDouble());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==ur.Bytes)return o.push(this.readFixed32());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==ur.Bytes)return o.push(this.readSFixed32());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==ur.Bytes)return o.push(this.readFixed64());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==ur.Bytes)return o.push(this.readSFixed64());var i=Vo(this);for(o=o||[];this.pos<i;)o.push(this.readSFixed64());return o},skip:function(o){var i=7&o;if(i===ur.Varint)for(;this.buf[this.pos++]>127;);else if(i===ur.Bytes)this.pos=this.readVarint()+this.pos;else if(i===ur.Fixed32)this.pos+=4;else{if(i!==ur.Fixed64)throw new Error("Unimplemented type: "+i);this.pos+=8}},writeTag:function(o,i){this.writeVarint(o<<3|i)},realloc:function(o){for(var i=this.length||16;i<this.pos+o;)i*=2;if(i!==this.length){var u=new Uint8Array(i);u.set(this.buf),this.buf=u,this.length=i}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Eh(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Eh(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Eh(this.buf,-1&o,this.pos),Eh(this.buf,Math.floor(o*e4),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Eh(this.buf,-1&o,this.pos),Eh(this.buf,Math.floor(o*e4),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(i,u){var f,v;if(i>=0?(f=i%4294967296|0,v=i/4294967296|0):(v=~(-i/4294967296),4294967295^(f=~(-i%4294967296))?f=f+1|0:(f=0,v=v+1|0)),i>=18446744073709552e3||i<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(b,w,E){E.buf[E.pos++]=127&b|128,b>>>=7,E.buf[E.pos++]=127&b|128,b>>>=7,E.buf[E.pos++]=127&b|128,b>>>=7,E.buf[E.pos++]=127&b|128,E.buf[E.pos]=127&(b>>>=7)}(f,0,u),function(b,w){var E=(7&b)<<4;w.buf[w.pos++]|=E|((b>>>=3)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b|((b>>>=7)?128:0),b&&(w.buf[w.pos++]=127&b)))))}(v,u)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var i=this.pos;this.pos=function(f,v,b){for(var w,E,R=0;R<v.length;R++){if((w=v.charCodeAt(R))>55295&&w<57344){if(!E){w>56319||R+1===v.length?(f[b++]=239,f[b++]=191,f[b++]=189):E=w;continue}if(w<56320){f[b++]=239,f[b++]=191,f[b++]=189,E=w;continue}w=E-55296<<10|w-56320|65536,E=null}else E&&(f[b++]=239,f[b++]=191,f[b++]=189,E=null);w<128?f[b++]=w:(w<2048?f[b++]=w>>6|192:(w<65536?f[b++]=w>>12|224:(f[b++]=w>>18|240,f[b++]=w>>12&63|128),f[b++]=w>>6&63|128),f[b++]=63&w|128)}return b}(this.buf,o,this.pos);var u=this.pos-i;u>=128&&n4(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u},writeFloat:function(o){this.realloc(4),Qw(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),Qw(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var i=o.length;this.writeVarint(i),this.realloc(i);for(var u=0;u<i;u++)this.buf[this.pos++]=o[u]},writeRawMessage:function(o,i){this.pos++;var u=this.pos;o(i,this);var f=this.pos-u;f>=128&&n4(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(o,i,u){this.writeTag(o,ur.Bytes),this.writeRawMessage(i,u)},writePackedVarint:function(o,i){i.length&&this.writeMessage(o,Z7,i)},writePackedSVarint:function(o,i){i.length&&this.writeMessage(o,Y7,i)},writePackedBoolean:function(o,i){i.length&&this.writeMessage(o,Q7,i)},writePackedFloat:function(o,i){i.length&&this.writeMessage(o,K7,i)},writePackedDouble:function(o,i){i.length&&this.writeMessage(o,J7,i)},writePackedFixed32:function(o,i){i.length&&this.writeMessage(o,eC,i)},writePackedSFixed32:function(o,i){i.length&&this.writeMessage(o,tC,i)},writePackedFixed64:function(o,i){i.length&&this.writeMessage(o,nC,i)},writePackedSFixed64:function(o,i){i.length&&this.writeMessage(o,rC,i)},writeBytesField:function(o,i){this.writeTag(o,ur.Bytes),this.writeBytes(i)},writeFixed32Field:function(o,i){this.writeTag(o,ur.Fixed32),this.writeFixed32(i)},writeSFixed32Field:function(o,i){this.writeTag(o,ur.Fixed32),this.writeSFixed32(i)},writeFixed64Field:function(o,i){this.writeTag(o,ur.Fixed64),this.writeFixed64(i)},writeSFixed64Field:function(o,i){this.writeTag(o,ur.Fixed64),this.writeSFixed64(i)},writeVarintField:function(o,i){this.writeTag(o,ur.Varint),this.writeVarint(i)},writeSVarintField:function(o,i){this.writeTag(o,ur.Varint),this.writeSVarint(i)},writeStringField:function(o,i){this.writeTag(o,ur.Bytes),this.writeString(i)},writeFloatField:function(o,i){this.writeTag(o,ur.Fixed32),this.writeFloat(i)},writeDoubleField:function(o,i){this.writeTag(o,ur.Fixed64),this.writeDouble(i)},writeBooleanField:function(o,i){this.writeVarintField(o,!!i)}};var yy=m(Kw);const _y=3;function iC(o,i,u){o===1&&u.readMessage(aC,i)}function aC(o,i,u){if(o===3){const{id:f,bitmap:v,width:b,height:w,left:E,top:R,advance:L}=u.readMessage(sC,{});i.push({id:f,bitmap:new qf({width:b+2*_y,height:w+2*_y},v),metrics:{width:b,height:w,left:E,top:R,advance:L}})}}function sC(o,i,u){o===1?i.id=u.readVarint():o===2?i.bitmap=u.readBytes():o===3?i.width=u.readVarint():o===4?i.height=u.readVarint():o===5?i.left=u.readSVarint():o===6?i.top=u.readSVarint():o===7&&(i.advance=u.readVarint())}const i4=_y;function a4(o){let i=0,u=0;for(const w of o)i+=w.w*w.h,u=Math.max(u,w.w);o.sort((w,E)=>E.h-w.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(i/.95)),u),h:1/0}];let v=0,b=0;for(const w of o)for(let E=f.length-1;E>=0;E--){const R=f[E];if(!(w.w>R.w||w.h>R.h)){if(w.x=R.x,w.y=R.y,b=Math.max(b,w.y+w.h),v=Math.max(v,w.x+w.w),w.w===R.w&&w.h===R.h){const L=f.pop();E<f.length&&(f[E]=L)}else w.h===R.h?(R.x+=w.w,R.w-=w.w):w.w===R.w?(R.y+=w.h,R.h-=w.h):(f.push({x:R.x+w.w,y:R.y,w:R.w-w.w,h:w.h}),R.y+=w.h,R.h-=w.h);break}}return{w:v,h:b,fill:i/(v*b)||0}}const ua=1;class xy{constructor(i,{pixelRatio:u,version:f,stretchX:v,stretchY:b,content:w}){this.paddedRect=i,this.pixelRatio=u,this.stretchX=v,this.stretchY=b,this.content=w,this.version=f}get tl(){return[this.paddedRect.x+ua,this.paddedRect.y+ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-ua,this.paddedRect.y+this.paddedRect.h-ua]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ua)/this.pixelRatio,(this.paddedRect.h-2*ua)/this.pixelRatio]}}class s4{constructor(i,u){const f={},v={};this.haveRenderCallbacks=[];const b=[];this.addImages(i,f,b),this.addImages(u,v,b);const{w,h:E}=a4(b),R=new Ga({width:w||1,height:E||1});for(const L in i){const j=i[L],W=f[L].paddedRect;Ga.copy(j.data,R,{x:0,y:0},{x:W.x+ua,y:W.y+ua},j.data)}for(const L in u){const j=u[L],W=v[L].paddedRect,K=W.x+ua,re=W.y+ua,le=j.data.width,fe=j.data.height;Ga.copy(j.data,R,{x:0,y:0},{x:K,y:re},j.data),Ga.copy(j.data,R,{x:0,y:fe-1},{x:K,y:re-1},{width:le,height:1}),Ga.copy(j.data,R,{x:0,y:0},{x:K,y:re+fe},{width:le,height:1}),Ga.copy(j.data,R,{x:le-1,y:0},{x:K-1,y:re},{width:1,height:fe}),Ga.copy(j.data,R,{x:0,y:0},{x:K+le,y:re},{width:1,height:fe})}this.image=R,this.iconPositions=f,this.patternPositions=v}addImages(i,u,f){for(const v in i){const b=i[v],w={x:0,y:0,w:b.data.width+2*ua,h:b.data.height+2*ua};f.push(w),u[v]=new xy(w,b),b.hasRenderCallback&&this.haveRenderCallbacks.push(v)}}patchUpdatedImages(i,u){i.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in i.updatedImages)this.patchUpdatedImage(this.iconPositions[f],i.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],i.getImage(f),u)}patchUpdatedImage(i,u,f){if(!i||!u||i.version===u.version)return;i.version=u.version;const[v,b]=i.tl;f.update(u.data,void 0,{x:v,y:b})}}var Vl;Jt("ImagePosition",xy),Jt("ImageAtlas",s4),h.ah=void 0,(Vl=h.ah||(h.ah={}))[Vl.none=0]="none",Vl[Vl.horizontal=1]="horizontal",Vl[Vl.vertical=2]="vertical",Vl[Vl.horizontalOnly=3]="horizontalOnly";const e0=-17;class t0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(i,u){const f=new t0;return f.scale=i||1,f.fontStack=u,f}static forImage(i){const u=new t0;return u.imageName=i,u}}class Ah{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(i,u){const f=new Ah;for(let v=0;v<i.sections.length;v++){const b=i.sections[v];b.image?f.addImageSection(b):f.addTextSection(b,u)}return f}length(){return this.text.length}getSection(i){return this.sections[this.sectionIndex[i]]}getSectionIndex(i){return this.sectionIndex[i]}getCharCode(i){return this.text.charCodeAt(i)}verticalizePunctuation(){this.text=function(i){let u="";for(let f=0;f<i.length;f++){const v=i.charCodeAt(f+1)||null,b=i.charCodeAt(f-1)||null;u+=v&&Tf(v)&&!Qf[i[f+1]]||b&&Tf(b)&&!Qf[i[f-1]]||!Qf[i[f]]?i[f]:Qf[i[f]]}return u}(this.text)}trim(){let i=0;for(let f=0;f<this.text.length&&Nm[this.text.charCodeAt(f)];f++)i++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=i&&Nm[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(i,u),this.sectionIndex=this.sectionIndex.slice(i,u)}substring(i,u){const f=new Ah;return f.text=this.text.substring(i,u),f.sectionIndex=this.sectionIndex.slice(i,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((i,u)=>Math.max(i,this.sections[u].scale),0)}addTextSection(i,u){this.text+=i.text,this.sections.push(t0.forText(i.scale,i.fontStack||u));const f=this.sections.length-1;for(let v=0;v<i.text.length;++v)this.sectionIndex.push(f)}addImageSection(i){const u=i.image?i.image.name:"";if(u.length===0)return void Re("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(t0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Re("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Fm(o,i,u,f,v,b,w,E,R,L,j,W,K,re,le,fe){const _e=Ah.fromFeature(o,v);let Ce;W===h.ah.vertical&&_e.verticalizePunctuation();const{processBidirectionalText:Ge,processStyledBidirectionalText:De}=ko;if(Ge&&_e.sections.length===1){Ce=[];const mt=Ge(_e.toString(),by(_e,L,b,i,f,re,le));for(const qt of mt){const cn=new Ah;cn.text=qt,cn.sections=_e.sections;for(let jt=0;jt<qt.length;jt++)cn.sectionIndex.push(0);Ce.push(cn)}}else if(De){Ce=[];const mt=De(_e.text,_e.sectionIndex,by(_e,L,b,i,f,re,le));for(const qt of mt){const cn=new Ah;cn.text=qt[0],cn.sectionIndex=qt[1],cn.sections=_e.sections,Ce.push(cn)}}else Ce=function(mt,qt){const cn=[],jt=mt.text;let Vt=0;for(const Rt of qt)cn.push(mt.substring(Vt,Rt)),Vt=Rt;return Vt<jt.length&&cn.push(mt.substring(Vt,jt.length)),cn}(_e,by(_e,L,b,i,f,re,le));const Fe=[],dt={positionedLines:Fe,text:_e.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(mt,qt,cn,jt,Vt,Rt,rn,Bt,Et,_n,dn,jn){let br=0,Tr=e0,ri=0,Ea=0;const Yi=Bt==="right"?1:Bt==="left"?0:.5;let Kr=0;for(const ii of Vt){ii.trim();const ai=ii.getMaxScale(),Ni=(ai-1)*ni,Qi={positionedGlyphs:[],lineOffset:0};mt.positionedLines[Kr]=Qi;const Bi=Qi.positionedGlyphs;let ha=0;if(!ii.length()){Tr+=Rt,++Kr;continue}for(let si=0;si<ii.length();si++){const Zn=ii.getSection(si),Oi=ii.getSectionIndex(si),Ri=ii.getCharCode(si);let oi=0,hs=null,Ds=null,ks=null,Ho=ni;const ds=!(Et===h.ah.horizontal||!dn&&!dh(Ri)||dn&&(Nm[Ri]||(yi=Ri,$t.Arabic(yi)||$t["Arabic Supplement"](yi)||$t["Arabic Extended-A"](yi)||$t["Arabic Presentation Forms-A"](yi)||$t["Arabic Presentation Forms-B"](yi))));if(Zn.imageName){const Wa=jt[Zn.imageName];if(!Wa)continue;ks=Zn.imageName,mt.iconsInText=mt.iconsInText||!0,Ds=Wa.paddedRect;const fa=Wa.displaySize;Zn.scale=Zn.scale*ni/jn,hs={width:fa[0],height:fa[1],left:ua,top:-i4,advance:ds?fa[1]:fa[0]},oi=Ni+(ni-fa[1]*Zn.scale),Ho=hs.advance;const Go=ds?fa[0]*Zn.scale-ni*ai:fa[1]*Zn.scale-ni*ai;Go>0&&Go>ha&&(ha=Go)}else{const Wa=cn[Zn.fontStack],fa=Wa&&Wa[Ri];if(fa&&fa.rect)Ds=fa.rect,hs=fa.metrics;else{const Go=qt[Zn.fontStack],s0=Go&&Go[Ri];if(!s0)continue;hs=s0.metrics}oi=(ai-Zn.scale)*ni}ds?(mt.verticalizable=!0,Bi.push({glyph:Ri,imageName:ks,x:br,y:Tr+oi,vertical:ds,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Oi,metrics:hs,rect:Ds}),br+=Ho*Zn.scale+_n):(Bi.push({glyph:Ri,imageName:ks,x:br,y:Tr+oi,vertical:ds,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Oi,metrics:hs,rect:Ds}),br+=hs.advance*Zn.scale+_n)}Bi.length!==0&&(ri=Math.max(br-_n,ri),cC(Bi,0,Bi.length-1,Yi,ha)),br=0;const da=Rt*ai+ha;Qi.lineOffset=Math.max(ha,Ni),Tr+=da,Ea=Math.max(da,Ea),++Kr}var yi;const Pi=Tr-e0,{horizontalAlign:Ki,verticalAlign:Ji}=wy(rn);(function(ii,ai,Ni,Qi,Bi,ha,da,si,Zn){const Oi=(ai-Ni)*Bi;let Ri=0;Ri=ha!==da?-si*Qi-e0:(-Qi*Zn+.5)*da;for(const oi of ii)for(const hs of oi.positionedGlyphs)hs.x+=Oi,hs.y+=Ri})(mt.positionedLines,Yi,Ki,Ji,ri,Ea,Rt,Pi,Vt.length),mt.top+=-Ji*Pi,mt.bottom=mt.top+Pi,mt.left+=-Ki*ri,mt.right=mt.left+ri}(dt,i,u,f,Ce,w,E,R,W,L,K,fe),!function(mt){for(const qt of mt)if(qt.positionedGlyphs.length!==0)return!1;return!0}(Fe)&&dt}const Nm={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oC={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function o4(o,i,u,f,v,b){if(i.imageName){const w=f[i.imageName];return w?w.displaySize[0]*i.scale*ni/b+v:0}{const w=u[i.fontStack],E=w&&w[o];return E?E.metrics.advance*i.scale+v:0}}function l4(o,i,u,f){const v=Math.pow(o-i,2);return f?o<i?v/2:2*v:v+Math.abs(u)*u}function lC(o,i,u){let f=0;return o===10&&(f-=1e4),u&&(f+=150),o!==40&&o!==65288||(f+=50),i!==41&&i!==65289||(f+=50),f}function c4(o,i,u,f,v,b){let w=null,E=l4(i,u,v,b);for(const R of f){const L=l4(i-R.x,u,v,b)+R.badness;L<=E&&(w=R,E=L)}return{index:o,x:i,priorBreak:w,badness:E}}function u4(o){return o?u4(o.priorBreak).concat(o.index):[]}function by(o,i,u,f,v,b,w){if(b!=="point")return[];if(!o)return[];const E=[],R=function(K,re,le,fe,_e,Ce){let Ge=0;for(let De=0;De<K.length();De++){const Fe=K.getSection(De);Ge+=o4(K.getCharCode(De),Fe,fe,_e,re,Ce)}return Ge/Math.max(1,Math.ceil(Ge/le))}(o,i,u,f,v,w),L=o.text.indexOf("​")>=0;let j=0;for(let K=0;K<o.length();K++){const re=o.getSection(K),le=o.getCharCode(K);if(Nm[le]||(j+=o4(le,re,f,v,i,w)),K<o.length()-1){const fe=!((W=le)<11904||!($t["Bopomofo Extended"](W)||$t.Bopomofo(W)||$t["CJK Compatibility Forms"](W)||$t["CJK Compatibility Ideographs"](W)||$t["CJK Compatibility"](W)||$t["CJK Radicals Supplement"](W)||$t["CJK Strokes"](W)||$t["CJK Symbols and Punctuation"](W)||$t["CJK Unified Ideographs Extension A"](W)||$t["CJK Unified Ideographs"](W)||$t["Enclosed CJK Letters and Months"](W)||$t["Halfwidth and Fullwidth Forms"](W)||$t.Hiragana(W)||$t["Ideographic Description Characters"](W)||$t["Kangxi Radicals"](W)||$t["Katakana Phonetic Extensions"](W)||$t.Katakana(W)||$t["Vertical Forms"](W)||$t["Yi Radicals"](W)||$t["Yi Syllables"](W)));(oC[le]||fe||re.imageName)&&E.push(c4(K+1,j,R,E,lC(le,o.getCharCode(K+1),fe&&L),!1))}}var W;return u4(c4(o.length(),j,R,E,0,!0))}function wy(o){let i=.5,u=.5;switch(o){case"right":case"top-right":case"bottom-right":i=1;break;case"left":case"top-left":case"bottom-left":i=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:i,verticalAlign:u}}function cC(o,i,u,f,v){if(!f&&!v)return;const b=o[u],w=(o[u].x+b.metrics.advance*b.scale)*f;for(let E=i;E<=u;E++)o[E].x-=w,o[E].y+=v}function uC(o,i,u){const{horizontalAlign:f,verticalAlign:v}=wy(u),b=i[0]-o.displaySize[0]*f,w=i[1]-o.displaySize[1]*v;return{image:o,top:w,bottom:w+o.displaySize[1],left:b,right:b+o.displaySize[0]}}function h4(o,i,u,f,v,b){const w=o.image;let E;if(w.content){const _e=w.content,Ce=w.pixelRatio||1;E=[_e[0]/Ce,_e[1]/Ce,w.displaySize[0]-_e[2]/Ce,w.displaySize[1]-_e[3]/Ce]}const R=i.left*b,L=i.right*b;let j,W,K,re;u==="width"||u==="both"?(re=v[0]+R-f[3],W=v[0]+L+f[1]):(re=v[0]+(R+L-w.displaySize[0])/2,W=re+w.displaySize[0]);const le=i.top*b,fe=i.bottom*b;return u==="height"||u==="both"?(j=v[1]+le-f[0],K=v[1]+fe+f[2]):(j=v[1]+(le+fe-w.displaySize[1])/2,K=j+w.displaySize[1]),{image:w,top:j,right:W,bottom:K,left:re,collisionPadding:E}}const n0=255,ro=128,Hl=n0*ro;function d4(o,i){const{expression:u}=i;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new _r(o+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:v}=u;let b=0;for(;b<f.length&&f[b]<=o;)b++;b=Math.max(0,b-1);let w=b;for(;w<f.length&&f[w]<o+1;)w++;w=Math.min(f.length-1,w);const E=f[b],R=f[w];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:R,interpolationType:v}:{kind:"camera",minZoom:E,maxZoom:R,minSize:u.evaluate(new _r(E)),maxSize:u.evaluate(new _r(R)),interpolationType:v}}}function Sy(o,i,u){let f="never";const v=o.get(i);return v?f=v:o.get(u)&&(f="always"),f}const hC=Ul.VectorTileFeature.types,dC=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bm(o,i,u,f,v,b,w,E,R,L,j,W,K){const re=E?Math.min(Hl,Math.round(E[0])):0,le=E?Math.min(Hl,Math.round(E[1])):0;o.emplaceBack(i,u,Math.round(32*f),Math.round(32*v),b,w,(re<<1)+(R?1:0),le,16*L,16*j,256*W,256*K)}function My(o,i,u){o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u),o.emplaceBack(i.x,i.y,u)}function fC(o){for(const i of o.sections)if(vm(i.text))return!0;return!1}class Ty{constructor(i){this.layoutVertexArray=new Le,this.indexArray=new nt,this.programConfigurations=i,this.segments=new xt,this.dynamicLayoutVertexArray=new Je,this.opacityVertexArray=new Me,this.hasVisibleVertices=!1,this.placedSymbolArray=new a}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(i,u,f,v){this.isEmpty()||(f&&(this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,j7.members),this.indexBuffer=i.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=i.createVertexBuffer(this.dynamicLayoutVertexArray,W7.members,!0),this.opacityVertexBuffer=i.createVertexBuffer(this.opacityVertexArray,dC,!0),this.opacityVertexBuffer.itemSize=1),(f||v)&&this.programConfigurations.upload(i))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Jt("SymbolBuffers",Ty);class Ey{constructor(i,u,f){this.layoutVertexArray=new i,this.layoutAttributes=u,this.indexArray=new f,this.segments=new xt,this.collisionVertexArray=new et}upload(i){this.layoutVertexBuffer=i.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=i.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=i.createVertexBuffer(this.collisionVertexArray,q7.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Jt("CollisionBuffers",Ey);class Ch{constructor(i){this.collisionBoxArray=i.collisionBoxArray,this.zoom=i.zoom,this.overscaling=i.overscaling,this.layers=i.layers,this.layerIds=this.layers.map(w=>w.id),this.index=i.index,this.pixelRatio=i.pixelRatio,this.sourceLayerIndex=i.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ry([]),this.placementViewportMatrix=ry([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=d4(this.zoom,u["text-size"]),this.iconSizeData=d4(this.zoom,u["icon-size"]);const f=this.layers[0].layout,v=f.get("symbol-sort-key"),b=f.get("symbol-z-order");this.canOverlap=Sy(f,"text-overlap","text-allow-overlap")!=="never"||Sy(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=b!=="viewport-y"&&!v.isConstant(),this.sortFeaturesByY=(b==="viewport-y"||b==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(w=>h.ah[w])),this.stateDependentLayerIds=this.layers.filter(w=>w.isStateDependent()).map(w=>w.id),this.sourceID=i.sourceID}createArrays(){this.text=new Ty(new Mr(this.layers,this.zoom,i=>/^text/.test(i))),this.icon=new Ty(new Mr(this.layers,this.zoom,i=>/^icon/.test(i))),this.glyphOffsetArray=new g,this.lineVertexArray=new x,this.symbolInstances=new p,this.textAnchorOffsets=new P}calculateGlyphDependencies(i,u,f,v,b){for(let w=0;w<i.length;w++)if(u[i.charCodeAt(w)]=!0,(f||v)&&b){const E=Qf[i.charAt(w)];E&&(u[E.charCodeAt(0)]=!0)}}populate(i,u,f){const v=this.layers[0],b=v.layout,w=b.get("text-font"),E=b.get("text-field"),R=b.get("icon-image"),L=(E.value.kind!=="constant"||E.value.value instanceof fr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(w.value.kind!=="constant"||w.value.value.length>0),j=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,W=b.get("symbol-sort-key");if(this.features=[],!L&&!j)return;const K=u.iconDependencies,re=u.glyphDependencies,le=u.availableImages,fe=new _r(this.zoom);for(const{feature:_e,id:Ce,index:Ge,sourceLayerIndex:De}of i){const Fe=v._featureFilter.needGeometry,dt=Oo(_e,Fe);if(!v._featureFilter.filter(fe,dt,f))continue;let mt,qt;if(Fe||(dt.geometry=Bo(_e)),L){const jt=v.getValueAndResolveTokens("text-field",dt,f,le),Vt=fr.factory(jt),Rt=this.hasRTLText=this.hasRTLText||fC(Vt);(!Rt||ko.getRTLTextPluginStatus()==="unavailable"||Rt&&ko.isParsed())&&(mt=X7(Vt,v,dt))}if(j){const jt=v.getValueAndResolveTokens("icon-image",dt,f,le);qt=jt instanceof hi?jt:hi.fromString(jt)}if(!mt&&!qt)continue;const cn=this.sortFeaturesByKey?W.evaluate(dt,{},f):void 0;if(this.features.push({id:Ce,text:mt,icon:qt,index:Ge,sourceLayerIndex:De,geometry:dt.geometry,properties:_e.properties,type:hC[_e.type],sortKey:cn}),qt&&(K[qt.name]=!0),mt){const jt=w.evaluate(dt,{},f).join(","),Vt=b.get("text-rotation-alignment")!=="viewport"&&b.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ah.vertical)>=0;for(const Rt of mt.sections)if(Rt.image)K[Rt.image.name]=!0;else{const rn=Zc(mt.toString()),Bt=Rt.fontStack||jt,Et=re[Bt]=re[Bt]||{};this.calculateGlyphDependencies(Rt.text,Et,Vt,this.allowVerticalPlacement,rn)}}}b.get("symbol-placement")==="line"&&(this.features=function(_e){const Ce={},Ge={},De=[];let Fe=0;function dt(jt){De.push(_e[jt]),Fe++}function mt(jt,Vt,Rt){const rn=Ge[jt];return delete Ge[jt],Ge[Vt]=rn,De[rn].geometry[0].pop(),De[rn].geometry[0]=De[rn].geometry[0].concat(Rt[0]),rn}function qt(jt,Vt,Rt){const rn=Ce[Vt];return delete Ce[Vt],Ce[jt]=rn,De[rn].geometry[0].shift(),De[rn].geometry[0]=Rt[0].concat(De[rn].geometry[0]),rn}function cn(jt,Vt,Rt){const rn=Rt?Vt[0][Vt[0].length-1]:Vt[0][0];return`${jt}:${rn.x}:${rn.y}`}for(let jt=0;jt<_e.length;jt++){const Vt=_e[jt],Rt=Vt.geometry,rn=Vt.text?Vt.text.toString():null;if(!rn){dt(jt);continue}const Bt=cn(rn,Rt),Et=cn(rn,Rt,!0);if(Bt in Ge&&Et in Ce&&Ge[Bt]!==Ce[Et]){const _n=qt(Bt,Et,Rt),dn=mt(Bt,Et,De[_n].geometry);delete Ce[Bt],delete Ge[Et],Ge[cn(rn,De[dn].geometry,!0)]=dn,De[_n].geometry=null}else Bt in Ge?mt(Bt,Et,Rt):Et in Ce?qt(Bt,Et,Rt):(dt(jt),Ce[Bt]=Fe-1,Ge[Et]=Fe-1)}return De.filter(jt=>jt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((_e,Ce)=>_e.sortKey-Ce.sortKey)}update(i,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(i,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(i,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(i),this.iconCollisionBox.upload(i)),this.text.upload(i,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(i,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(i,u){const f=this.lineVertexArray.length;if(i.segment!==void 0){let v=i.dist(u[i.segment+1]),b=i.dist(u[i.segment]);const w={};for(let E=i.segment+1;E<u.length;E++)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:v},E<u.length-1&&(v+=u[E+1].dist(u[E]));for(let E=i.segment||0;E>=0;E--)w[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:b},E>0&&(b+=u[E-1].dist(u[E]));for(let E=0;E<u.length;E++){const R=w[E];this.lineVertexArray.emplaceBack(R.x,R.y,R.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(i,u,f,v,b,w,E,R,L,j,W,K){const re=i.indexArray,le=i.layoutVertexArray,fe=i.segments.prepareSegment(4*u.length,le,re,this.canOverlap?w.sortKey:void 0),_e=this.glyphOffsetArray.length,Ce=fe.vertexLength,Ge=this.allowVerticalPlacement&&E===h.ah.vertical?Math.PI/2:0,De=w.text&&w.text.sections;for(let Fe=0;Fe<u.length;Fe++){const{tl:dt,tr:mt,bl:qt,br:cn,tex:jt,pixelOffsetTL:Vt,pixelOffsetBR:Rt,minFontScaleX:rn,minFontScaleY:Bt,glyphOffset:Et,isSDF:_n,sectionIndex:dn}=u[Fe],jn=fe.vertexLength,br=Et[1];Bm(le,R.x,R.y,dt.x,br+dt.y,jt.x,jt.y,f,_n,Vt.x,Vt.y,rn,Bt),Bm(le,R.x,R.y,mt.x,br+mt.y,jt.x+jt.w,jt.y,f,_n,Rt.x,Vt.y,rn,Bt),Bm(le,R.x,R.y,qt.x,br+qt.y,jt.x,jt.y+jt.h,f,_n,Vt.x,Rt.y,rn,Bt),Bm(le,R.x,R.y,cn.x,br+cn.y,jt.x+jt.w,jt.y+jt.h,f,_n,Rt.x,Rt.y,rn,Bt),My(i.dynamicLayoutVertexArray,R,Ge),re.emplaceBack(jn,jn+1,jn+2),re.emplaceBack(jn+1,jn+2,jn+3),fe.vertexLength+=4,fe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),Fe!==u.length-1&&dn===u[Fe+1].sectionIndex||i.programConfigurations.populatePaintArrays(le.length,w,w.index,{},K,De&&De[dn])}i.placedSymbolArray.emplaceBack(R.x,R.y,_e,this.glyphOffsetArray.length-_e,Ce,L,j,R.segment,f?f[0]:0,f?f[1]:0,v[0],v[1],E,0,!1,0,W)}_addCollisionDebugVertex(i,u,f,v,b,w){return u.emplaceBack(0,0),i.emplaceBack(f.x,f.y,v,b,Math.round(w.x),Math.round(w.y))}addCollisionDebugVertices(i,u,f,v,b,w,E){const R=b.segments.prepareSegment(4,b.layoutVertexArray,b.indexArray),L=R.vertexLength,j=b.layoutVertexArray,W=b.collisionVertexArray,K=E.anchorX,re=E.anchorY;this._addCollisionDebugVertex(j,W,w,K,re,new T(i,u)),this._addCollisionDebugVertex(j,W,w,K,re,new T(f,u)),this._addCollisionDebugVertex(j,W,w,K,re,new T(f,v)),this._addCollisionDebugVertex(j,W,w,K,re,new T(i,v)),R.vertexLength+=4;const le=b.indexArray;le.emplaceBack(L,L+1),le.emplaceBack(L+1,L+2),le.emplaceBack(L+2,L+3),le.emplaceBack(L+3,L),R.primitiveLength+=4}addDebugCollisionBoxes(i,u,f,v){for(let b=i;b<u;b++){const w=this.collisionBoxArray.get(b);this.addCollisionDebugVertices(w.x1,w.y1,w.x2,w.y2,v?this.textCollisionBox:this.iconCollisionBox,w.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Ey(Oe,Yw.members,ut),this.iconCollisionBox=new Ey(Oe,Yw.members,ut);for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(i,u,f,v,b,w,E,R,L){const j={};for(let W=u;W<f;W++){const K=i.get(W);j.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.textFeatureIndex=K.featureIndex;break}for(let W=v;W<b;W++){const K=i.get(W);j.verticalTextBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.verticalTextFeatureIndex=K.featureIndex;break}for(let W=w;W<E;W++){const K=i.get(W);j.iconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.iconFeatureIndex=K.featureIndex;break}for(let W=R;W<L;W++){const K=i.get(W);j.verticalIconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.verticalIconFeatureIndex=K.featureIndex;break}return j}deserializeCollisionBoxes(i){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(i,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(i,u){const f=i.placedSymbolArray.get(u),v=f.vertexStartIndex+4*f.numGlyphs;for(let b=f.vertexStartIndex;b<v;b+=4)i.indexArray.emplaceBack(b,b+1,b+2),i.indexArray.emplaceBack(b+1,b+2,b+3)}getSortedSymbolIndexes(i){if(this.sortedAngle===i&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(i),f=Math.cos(i),v=[],b=[],w=[];for(let E=0;E<this.symbolInstances.length;++E){w.push(E);const R=this.symbolInstances.get(E);v.push(0|Math.round(u*R.anchorX+f*R.anchorY)),b.push(R.featureIndex)}return w.sort((E,R)=>v[E]-v[R]||b[R]-b[E]),w}addToSortKeyRanges(i,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=i+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:i,symbolInstanceEnd:i+1})}sortFeatures(i){if(this.sortFeaturesByY&&this.sortedAngle!==i&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(i),this.sortedAngle=i,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((v,b,w)=>{v>=0&&w.indexOf(v)===b&&this.addIndicesForPlacedSymbol(this.text,v)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let f4,p4;Jt("SymbolBucket",Ch,{omit:["layers","collisionBoxArray","features","compareText"]}),Ch.MAX_GLYPHS=65535,Ch.addDynamicAttributes=My;var Ay={get paint(){return p4=p4||new $i({"icon-opacity":new Tn(je.paint_symbol["icon-opacity"]),"icon-color":new Tn(je.paint_symbol["icon-color"]),"icon-halo-color":new Tn(je.paint_symbol["icon-halo-color"]),"icon-halo-width":new Tn(je.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Tn(je.paint_symbol["icon-halo-blur"]),"icon-translate":new mn(je.paint_symbol["icon-translate"]),"icon-translate-anchor":new mn(je.paint_symbol["icon-translate-anchor"]),"text-opacity":new Tn(je.paint_symbol["text-opacity"]),"text-color":new Tn(je.paint_symbol["text-color"],{runtimeType:yn,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new Tn(je.paint_symbol["text-halo-color"]),"text-halo-width":new Tn(je.paint_symbol["text-halo-width"]),"text-halo-blur":new Tn(je.paint_symbol["text-halo-blur"]),"text-translate":new mn(je.paint_symbol["text-translate"]),"text-translate-anchor":new mn(je.paint_symbol["text-translate-anchor"])})},get layout(){return f4=f4||new $i({"symbol-placement":new mn(je.layout_symbol["symbol-placement"]),"symbol-spacing":new mn(je.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mn(je.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Tn(je.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mn(je.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mn(je.layout_symbol["icon-allow-overlap"]),"icon-overlap":new mn(je.layout_symbol["icon-overlap"]),"icon-ignore-placement":new mn(je.layout_symbol["icon-ignore-placement"]),"icon-optional":new mn(je.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mn(je.layout_symbol["icon-rotation-alignment"]),"icon-size":new Tn(je.layout_symbol["icon-size"]),"icon-text-fit":new mn(je.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mn(je.layout_symbol["icon-text-fit-padding"]),"icon-image":new Tn(je.layout_symbol["icon-image"]),"icon-rotate":new Tn(je.layout_symbol["icon-rotate"]),"icon-padding":new Tn(je.layout_symbol["icon-padding"]),"icon-keep-upright":new mn(je.layout_symbol["icon-keep-upright"]),"icon-offset":new Tn(je.layout_symbol["icon-offset"]),"icon-anchor":new Tn(je.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mn(je.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mn(je.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mn(je.layout_symbol["text-rotation-alignment"]),"text-field":new Tn(je.layout_symbol["text-field"]),"text-font":new Tn(je.layout_symbol["text-font"]),"text-size":new Tn(je.layout_symbol["text-size"]),"text-max-width":new Tn(je.layout_symbol["text-max-width"]),"text-line-height":new mn(je.layout_symbol["text-line-height"]),"text-letter-spacing":new Tn(je.layout_symbol["text-letter-spacing"]),"text-justify":new Tn(je.layout_symbol["text-justify"]),"text-radial-offset":new Tn(je.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mn(je.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Tn(je.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Tn(je.layout_symbol["text-anchor"]),"text-max-angle":new mn(je.layout_symbol["text-max-angle"]),"text-writing-mode":new mn(je.layout_symbol["text-writing-mode"]),"text-rotate":new Tn(je.layout_symbol["text-rotate"]),"text-padding":new mn(je.layout_symbol["text-padding"]),"text-keep-upright":new mn(je.layout_symbol["text-keep-upright"]),"text-transform":new Tn(je.layout_symbol["text-transform"]),"text-offset":new Tn(je.layout_symbol["text-offset"]),"text-allow-overlap":new mn(je.layout_symbol["text-allow-overlap"]),"text-overlap":new mn(je.layout_symbol["text-overlap"]),"text-ignore-placement":new mn(je.layout_symbol["text-ignore-placement"]),"text-optional":new mn(je.layout_symbol["text-optional"])})}};class m4{constructor(i){if(i.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=i.property.overrides?i.property.overrides.runtimeType:Qt,this.defaultValue=i}evaluate(i){if(i.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(i.formattedSection))return u.getOverride(i.formattedSection)}return i.feature&&i.featureState?this.defaultValue.evaluate(i.feature,i.featureState):this.defaultValue.property.specification.default}eachChild(i){this.defaultValue.isConstant()||i(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Jt("FormatSectionOverride",m4,{omit:["defaultValue"]});class Om extends Ua{constructor(i){super(i,Ay)}recalculate(i,u){if(super.recalculate(i,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const v=[];for(const b of f)v.indexOf(b)<0&&v.push(b);this.layout._values["text-writing-mode"]=v}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(i,u,f,v){const b=this.layout.get(i).evaluate(u,{},f,v),w=this._unevaluatedLayout._values[i];return w.isDataDriven()||mr(w.value)||!b?b:function(E,R){return R.replace(/{([^{}]+)}/g,(L,j)=>E&&j in E?String(E[j]):"")}(u.properties,b)}createBucket(i){return new Ch(i)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const i of Ay.paint.overridableProperties){if(!Om.hasPaintOverride(this.layout,i))continue;const u=this.paint.get(i),f=new m4(u),v=new Wc(f,u.property.specification);let b=null;b=u.value.kind==="constant"||u.value.kind==="source"?new Cl("source",v):new ah("composite",v,u.value.zoomStops),this.paint._values[i]=new Oa(u.property,b,u.parameters)}}_handleOverridablePaintPropertyUpdate(i,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Om.hasPaintOverride(this.layout,i)}static hasPaintOverride(i,u){const f=i.get("text-field"),v=Ay.paint.properties[u];let b=!1;const w=E=>{for(const R of E)if(v.overrides&&v.overrides.hasOverride(R))return void(b=!0)};if(f.value.kind==="constant"&&f.value.value instanceof fr)w(f.value.value.sections);else if(f.value.kind==="source"){const E=L=>{b||(L instanceof Ba&&Ir(L.value)===bt?w(L.value.sections):L instanceof ih?w(L.sections):L.eachChild(E))},R=f.value;R._styleExpression&&E(R._styleExpression.expression)}return b}}let g4;var pC={get paint(){return g4=g4||new $i({"background-color":new mn(je.paint_background["background-color"]),"background-pattern":new Rf(je.paint_background["background-pattern"]),"background-opacity":new mn(je.paint_background["background-opacity"])})}};class mC extends Ua{constructor(i){super(i,pC)}}let v4;var gC={get paint(){return v4=v4||new $i({"raster-opacity":new mn(je.paint_raster["raster-opacity"]),"raster-hue-rotate":new mn(je.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mn(je.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mn(je.paint_raster["raster-brightness-max"]),"raster-saturation":new mn(je.paint_raster["raster-saturation"]),"raster-contrast":new mn(je.paint_raster["raster-contrast"]),"raster-resampling":new mn(je.paint_raster["raster-resampling"]),"raster-fade-duration":new mn(je.paint_raster["raster-fade-duration"])})}};class vC extends Ua{constructor(i){super(i,gC)}}class yC extends Ua{constructor(i){super(i,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=i}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _C{constructor(i){this._methodToThrottle=i,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Cy=63710088e-1;class Gl{constructor(i,u){if(isNaN(i)||isNaN(u))throw new Error(`Invalid LngLat object: (${i}, ${u})`);if(this.lng=+i,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Gl(Z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(i){const u=Math.PI/180,f=this.lat*u,v=i.lat*u,b=Math.sin(f)*Math.sin(v)+Math.cos(f)*Math.cos(v)*Math.cos((i.lng-this.lng)*u);return Cy*Math.acos(Math.min(b,1))}static convert(i){if(i instanceof Gl)return i;if(Array.isArray(i)&&(i.length===2||i.length===3))return new Gl(Number(i[0]),Number(i[1]));if(!Array.isArray(i)&&typeof i=="object"&&i!==null)return new Gl(Number("lng"in i?i.lng:i.lon),Number(i.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const y4=2*Math.PI*Cy;function _4(o){return y4*Math.cos(o*Math.PI/180)}function x4(o){return(180+o)/360}function b4(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function w4(o,i){return o/_4(i)}function Py(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}class Um{constructor(i,u,f=0){this.x=+i,this.y=+u,this.z=+f}static fromLngLat(i,u=0){const f=Gl.convert(i);return new Um(x4(f.lng),b4(f.lat),w4(u,f.lat))}toLngLat(){return new Gl(360*this.x-180,Py(this.y))}toAltitude(){return this.z*_4(Py(this.y))}meterInMercatorCoordinateUnits(){return 1/y4*(i=Py(this.y),1/Math.cos(i*Math.PI/180));var i}}function S4(o,i,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[o*f-2*Math.PI*6378137/2,i*f-2*Math.PI*6378137/2]}class Ry{constructor(i,u,f){if(i<0||i>25||f<0||f>=Math.pow(2,i)||u<0||u>=Math.pow(2,i))throw new Error(`x=${u}, y=${f}, z=${i} outside of bounds. 0<=x<${Math.pow(2,i)}, 0<=y<${Math.pow(2,i)} 0<=z<=25 `);this.z=i,this.x=u,this.y=f,this.key=r0(0,i,i,u,f)}equals(i){return this.z===i.z&&this.x===i.x&&this.y===i.y}url(i,u,f){const v=(w=this.y,E=this.z,R=S4(256*(b=this.x),256*(w=Math.pow(2,E)-w-1),E),L=S4(256*(b+1),256*(w+1),E),R[0]+","+R[1]+","+L[0]+","+L[1]);var b,w,E,R,L;const j=function(W,K,re){let le,fe="";for(let _e=W;_e>0;_e--)le=1<<_e-1,fe+=(K&le?1:0)+(re&le?2:0);return fe}(this.z,this.x,this.y);return i[(this.x+this.y)%i.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,v)}isChildOf(i){const u=this.z-i.z;return u>0&&i.x===this.x>>u&&i.y===this.y>>u}getTilePoint(i){const u=Math.pow(2,this.z);return new T((i.x*u-this.x)*Wn,(i.y*u-this.y)*Wn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class M4{constructor(i,u){this.wrap=i,this.canonical=u,this.key=r0(i,u.z,u.z,u.x,u.y)}}class ja{constructor(i,u,f,v,b){if(i<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${i}; z = ${f}`);this.overscaledZ=i,this.wrap=u,this.canonical=new Ry(f,+v,+b),this.key=r0(u,i,f,v,b)}clone(){return new ja(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(i){return this.overscaledZ===i.overscaledZ&&this.wrap===i.wrap&&this.canonical.equals(i.canonical)}scaledTo(i){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-i;return i>this.canonical.z?new ja(i,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ja(i,this.wrap,i,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(i,u){if(i>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${i}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-i;return i>this.canonical.z?r0(this.wrap*+u,i,this.canonical.z,this.canonical.x,this.canonical.y):r0(this.wrap*+u,i,i,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(i){if(i.wrap!==this.wrap)return!1;const u=this.canonical.z-i.canonical.z;return i.overscaledZ===0||i.overscaledZ<this.overscaledZ&&i.canonical.x===this.canonical.x>>u&&i.canonical.y===this.canonical.y>>u}children(i){if(this.overscaledZ>=i)return[new ja(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,v=2*this.canonical.y;return[new ja(u,this.wrap,u,f,v),new ja(u,this.wrap,u,f+1,v),new ja(u,this.wrap,u,f,v+1),new ja(u,this.wrap,u,f+1,v+1)]}isLessThan(i){return this.wrap<i.wrap||!(this.wrap>i.wrap)&&(this.overscaledZ<i.overscaledZ||!(this.overscaledZ>i.overscaledZ)&&(this.canonical.x<i.canonical.x||!(this.canonical.x>i.canonical.x)&&this.canonical.y<i.canonical.y))}wrapped(){return new ja(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(i){return new ja(this.overscaledZ,i,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new M4(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(i){return this.canonical.getTilePoint(new Um(i.x-this.wrap,i.y))}}function r0(o,i,u,f,v){(o*=2)<0&&(o=-1*o-1);const b=1<<u;return(b*b*o+b*v+f).toString(36)+u.toString(36)+i.toString(36)}Jt("CanonicalTileID",Ry),Jt("OverscaledTileID",ja,{omit:["posMatrix"]});class T4{constructor(i,u,f,v=1,b=1,w=1,E=0){if(this.uid=i,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Re(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const R=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=v,this.greenFactor=b,this.blueFactor=w,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let L=0;L<R;L++)this.data[this._idx(-1,L)]=this.data[this._idx(0,L)],this.data[this._idx(R,L)]=this.data[this._idx(R-1,L)],this.data[this._idx(L,-1)]=this.data[this._idx(L,0)],this.data[this._idx(L,R)]=this.data[this._idx(L,R-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(R,-1)]=this.data[this._idx(R-1,0)],this.data[this._idx(-1,R)]=this.data[this._idx(0,R-1)],this.data[this._idx(R,R)]=this.data[this._idx(R-1,R-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let L=0;L<R;L++)for(let j=0;j<R;j++){const W=this.get(L,j);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(i,u){const f=new Uint8Array(this.data.buffer),v=4*this._idx(i,u);return this.unpack(f[v],f[v+1],f[v+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(i,u){if(i<-1||i>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(i+1)}unpack(i,u,f){return i*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Ga({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(i,u,f){if(this.dim!==i.dim)throw new Error("dem dimension mismatch");let v=u*this.dim,b=u*this.dim+this.dim,w=f*this.dim,E=f*this.dim+this.dim;switch(u){case-1:v=b-1;break;case 1:b=v+1}switch(f){case-1:w=E-1;break;case 1:E=w+1}const R=-u*this.dim,L=-f*this.dim;for(let j=w;j<E;j++)for(let W=v;W<b;W++)this.data[this._idx(W,j)]=i.data[this._idx(W+R,j+L)]}}Jt("DEMData",T4);class E4{constructor(i){this._stringToNumber={},this._numberToString=[];for(let u=0;u<i.length;u++){const f=i[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(i){return this._stringToNumber[i]}decode(i){if(i>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${i} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[i]}}class A4{constructor(i,u,f,v,b){this.type="Feature",this._vectorTileFeature=i,i._z=u,i._x=f,i._y=v,this.properties=i.properties,this.id=b}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(i){this._geometry=i}toJSON(){const i={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(i[u]=this[u]);return i}}class C4{constructor(i,u){this.tileID=i,this.x=i.canonical.x,this.y=i.canonical.y,this.z=i.canonical.z,this.grid=new Rs(Wn,16,0),this.grid3D=new Rs(Wn,16,0),this.featureIndexArray=new H,this.promoteId=u}insert(i,u,f,v,b,w){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,v,b);const R=w?this.grid3D:this.grid;for(let L=0;L<u.length;L++){const j=u[L],W=[1/0,1/0,-1/0,-1/0];for(let K=0;K<j.length;K++){const re=j[K];W[0]=Math.min(W[0],re.x),W[1]=Math.min(W[1],re.y),W[2]=Math.max(W[2],re.x),W[3]=Math.max(W[3],re.y)}W[0]<Wn&&W[1]<Wn&&W[2]>=0&&W[3]>=0&&R.insert(E,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Ul.VectorTile(new yy(this.rawTileData)).layers,this.sourceLayerCoder=new E4(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(i,u,f,v){this.loadVTLayers();const b=i.params||{},w=Wn/i.tileSize/i.scale,E=lh(b.filter),R=i.queryGeometry,L=i.queryPadding*w,j=R4(R),W=this.grid.query(j.minX-L,j.minY-L,j.maxX+L,j.maxY+L),K=R4(i.cameraQueryGeometry),re=this.grid3D.query(K.minX-L,K.minY-L,K.maxX+L,K.maxY+L,(_e,Ce,Ge,De)=>function(Fe,dt,mt,qt,cn){for(const Vt of Fe)if(dt<=Vt.x&&mt<=Vt.y&&qt>=Vt.x&&cn>=Vt.y)return!0;const jt=[new T(dt,mt),new T(dt,cn),new T(qt,cn),new T(qt,mt)];if(Fe.length>2){for(const Vt of jt)if(bh(Fe,Vt))return!0}for(let Vt=0;Vt<Fe.length-1;Vt++)if(K8(Fe[Vt],Fe[Vt+1],jt))return!0;return!1}(i.cameraQueryGeometry,_e-L,Ce-L,Ge+L,De+L));for(const _e of re)W.push(_e);W.sort(xC);const le={};let fe;for(let _e=0;_e<W.length;_e++){const Ce=W[_e];if(Ce===fe)continue;fe=Ce;const Ge=this.featureIndexArray.get(Ce);let De=null;this.loadMatchingFeature(le,Ge.bucketIndex,Ge.sourceLayerIndex,Ge.featureIndex,E,b.layers,b.availableImages,u,f,v,(Fe,dt,mt)=>(De||(De=Bo(Fe)),dt.queryIntersectsFeature(R,Fe,mt,De,this.z,i.transform,w,i.pixelPosMatrix)))}return le}loadMatchingFeature(i,u,f,v,b,w,E,R,L,j,W){const K=this.bucketLayerIDs[u];if(w&&!function(_e,Ce){for(let Ge=0;Ge<_e.length;Ge++)if(Ce.indexOf(_e[Ge])>=0)return!0;return!1}(w,K))return;const re=this.sourceLayerCoder.decode(f),le=this.vtLayers[re].feature(v);if(b.needGeometry){const _e=Oo(le,!0);if(!b.filter(new _r(this.tileID.overscaledZ),_e,this.tileID.canonical))return}else if(!b.filter(new _r(this.tileID.overscaledZ),le))return;const fe=this.getId(le,re);for(let _e=0;_e<K.length;_e++){const Ce=K[_e];if(w&&w.indexOf(Ce)<0)continue;const Ge=R[Ce];if(!Ge)continue;let De={};fe&&j&&(De=j.getState(Ge.sourceLayer||"_geojsonTileLayer",fe));const Fe=ne({},L[Ce]);Fe.paint=P4(Fe.paint,Ge.paint,le,De,E),Fe.layout=P4(Fe.layout,Ge.layout,le,De,E);const dt=!W||W(le,Ge,De);if(!dt)continue;const mt=new A4(le,this.z,this.x,this.y,fe);mt.layer=Fe;let qt=i[Ce];qt===void 0&&(qt=i[Ce]=[]),qt.push({featureIndex:v,feature:mt,intersectionZ:dt})}}lookupSymbolFeatures(i,u,f,v,b,w,E,R){const L={};this.loadVTLayers();const j=lh(b);for(const W of i)this.loadMatchingFeature(L,f,v,W,j,w,E,R,u);return L}hasLayer(i){for(const u of this.bucketLayerIDs)for(const f of u)if(i===f)return!0;return!1}getId(i,u){let f=i.id;return this.promoteId&&(f=i.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function P4(o,i,u,f,v){return ie(o,(b,w)=>{const E=i instanceof Yc?i.get(w):null;return E&&E.evaluate?E.evaluate(u,f,v):E})}function R4(o){let i=1/0,u=1/0,f=-1/0,v=-1/0;for(const b of o)i=Math.min(i,b.x),u=Math.min(u,b.y),f=Math.max(f,b.x),v=Math.max(v,b.y);return{minX:i,minY:u,maxX:f,maxY:v}}function xC(o,i){return i-o}function I4(o,i,u,f,v){const b=[];for(let w=0;w<o.length;w++){const E=o[w];let R;for(let L=0;L<E.length-1;L++){let j=E[L],W=E[L+1];j.x<i&&W.x<i||(j.x<i?j=new T(i,j.y+(i-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<i&&(W=new T(i,j.y+(i-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<u&&W.y<u||(j.y<u?j=new T(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round():W.y<u&&(W=new T(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round()),j.x>=f&&W.x>=f||(j.x>=f?j=new T(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=f&&(W=new T(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=v&&W.y>=v||(j.y>=v?j=new T(j.x+(v-j.y)/(W.y-j.y)*(W.x-j.x),v)._round():W.y>=v&&(W=new T(j.x+(v-j.y)/(W.y-j.y)*(W.x-j.x),v)._round()),R&&j.equals(R[R.length-1])||(R=[j],b.push(R)),R.push(W)))))}}return b}Jt("FeatureIndex",C4,{omit:["rawTileData","sourceLayerCoder"]});class jl extends T{constructor(i,u,f,v){super(i,u),this.angle=f,v!==void 0&&(this.segment=v)}clone(){return new jl(this.x,this.y,this.angle,this.segment)}}function D4(o,i,u,f,v){if(i.segment===void 0||u===0)return!0;let b=i,w=i.segment+1,E=0;for(;E>-u/2;){if(w--,w<0)return!1;E-=o[w].dist(b),b=o[w]}E+=o[w].dist(o[w+1]),w++;const R=[];let L=0;for(;E<u/2;){const j=o[w],W=o[w+1];if(!W)return!1;let K=o[w-1].angleTo(j)-j.angleTo(W);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),R.push({distance:E,angleDelta:K}),L+=K;E-R[0].distance>f;)L-=R.shift().angleDelta;if(L>v)return!1;w++,E+=j.dist(W)}return!0}function k4(o){let i=0;for(let u=0;u<o.length-1;u++)i+=o[u].dist(o[u+1]);return i}function L4(o,i,u){return o?.6*i*u:0}function z4(o,i){return Math.max(o?o.right-o.left:0,i?i.right-i.left:0)}function bC(o,i,u,f,v,b){const w=L4(u,v,b),E=z4(u,f)*b;let R=0;const L=k4(o)/2;for(let j=0;j<o.length-1;j++){const W=o[j],K=o[j+1],re=W.dist(K);if(R+re>L){const le=(L-R)/re,fe=oa.number(W.x,K.x,le),_e=oa.number(W.y,K.y,le),Ce=new jl(fe,_e,K.angleTo(W),j);return Ce._round(),!w||D4(o,Ce,E,w,i)?Ce:void 0}R+=re}}function wC(o,i,u,f,v,b,w,E,R){const L=L4(f,b,w),j=z4(f,v),W=j*w,K=o[0].x===0||o[0].x===R||o[0].y===0||o[0].y===R;return i-W<i/4&&(i=W+i/4),F4(o,K?i/2*E%i:(j/2+2*b)*w*E%i,i,L,u,W,K,!1,R)}function F4(o,i,u,f,v,b,w,E,R){const L=b/2,j=k4(o);let W=0,K=i-u,re=[];for(let le=0;le<o.length-1;le++){const fe=o[le],_e=o[le+1],Ce=fe.dist(_e),Ge=_e.angleTo(fe);for(;K+u<W+Ce;){K+=u;const De=(K-W)/Ce,Fe=oa.number(fe.x,_e.x,De),dt=oa.number(fe.y,_e.y,De);if(Fe>=0&&Fe<R&&dt>=0&&dt<R&&K-L>=0&&K+L<=j){const mt=new jl(Fe,dt,Ge,le);mt._round(),f&&!D4(o,mt,b,f,v)||re.push(mt)}}W+=Ce}return E||re.length||w||(re=F4(o,W/2,u,f,v,b,w,!0,R)),re}Jt("Anchor",jl);const Ph=ua;function N4(o,i,u,f){const v=[],b=o.image,w=b.pixelRatio,E=b.paddedRect.w-2*Ph,R=b.paddedRect.h-2*Ph,L=o.right-o.left,j=o.bottom-o.top,W=b.stretchX||[[0,E]],K=b.stretchY||[[0,R]],re=(Rt,rn)=>Rt+rn[1]-rn[0],le=W.reduce(re,0),fe=K.reduce(re,0),_e=E-le,Ce=R-fe;let Ge=0,De=le,Fe=0,dt=fe,mt=0,qt=_e,cn=0,jt=Ce;if(b.content&&f){const Rt=b.content;Ge=Vm(W,0,Rt[0]),Fe=Vm(K,0,Rt[1]),De=Vm(W,Rt[0],Rt[2]),dt=Vm(K,Rt[1],Rt[3]),mt=Rt[0]-Ge,cn=Rt[1]-Fe,qt=Rt[2]-Rt[0]-De,jt=Rt[3]-Rt[1]-dt}const Vt=(Rt,rn,Bt,Et)=>{const _n=Hm(Rt.stretch-Ge,De,L,o.left),dn=Gm(Rt.fixed-mt,qt,Rt.stretch,le),jn=Hm(rn.stretch-Fe,dt,j,o.top),br=Gm(rn.fixed-cn,jt,rn.stretch,fe),Tr=Hm(Bt.stretch-Ge,De,L,o.left),ri=Gm(Bt.fixed-mt,qt,Bt.stretch,le),Ea=Hm(Et.stretch-Fe,dt,j,o.top),Yi=Gm(Et.fixed-cn,jt,Et.stretch,fe),Kr=new T(_n,jn),yi=new T(Tr,jn),Pi=new T(Tr,Ea),Ki=new T(_n,Ea),Ji=new T(dn/w,br/w),ii=new T(ri/w,Yi/w),ai=i*Math.PI/180;if(ai){const Bi=Math.sin(ai),ha=Math.cos(ai),da=[ha,-Bi,Bi,ha];Kr._matMult(da),yi._matMult(da),Ki._matMult(da),Pi._matMult(da)}const Ni=Rt.stretch+Rt.fixed,Qi=rn.stretch+rn.fixed;return{tl:Kr,tr:yi,bl:Ki,br:Pi,tex:{x:b.paddedRect.x+Ph+Ni,y:b.paddedRect.y+Ph+Qi,w:Bt.stretch+Bt.fixed-Ni,h:Et.stretch+Et.fixed-Qi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ji,pixelOffsetBR:ii,minFontScaleX:qt/w/L,minFontScaleY:jt/w/j,isSDF:u}};if(f&&(b.stretchX||b.stretchY)){const Rt=B4(W,_e,le),rn=B4(K,Ce,fe);for(let Bt=0;Bt<Rt.length-1;Bt++){const Et=Rt[Bt],_n=Rt[Bt+1];for(let dn=0;dn<rn.length-1;dn++)v.push(Vt(Et,rn[dn],_n,rn[dn+1]))}}else v.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return v}function Vm(o,i,u){let f=0;for(const v of o)f+=Math.max(i,Math.min(u,v[1]))-Math.max(i,Math.min(u,v[0]));return f}function B4(o,i,u){const f=[{fixed:-Ph,stretch:0}];for(const[v,b]of o){const w=f[f.length-1];f.push({fixed:v-w.stretch,stretch:w.stretch}),f.push({fixed:v-w.stretch,stretch:w.stretch+(b-v)})}return f.push({fixed:i+Ph,stretch:u}),f}function Hm(o,i,u,f){return o/i*u+f}function Gm(o,i,u,f){return o-i*u/f}class jm{constructor(i,u,f,v,b,w,E,R,L,j){if(this.boxStartIndex=i.length,L){let W=w.top,K=w.bottom;const re=w.collisionPadding;re&&(W-=re[1],K+=re[3]);let le=K-W;le>0&&(le=Math.max(10,le),this.circleDiameter=le)}else{let W=w.top*E-R[0],K=w.bottom*E+R[2],re=w.left*E-R[3],le=w.right*E+R[1];const fe=w.collisionPadding;if(fe&&(re-=fe[0]*E,W-=fe[1]*E,le+=fe[2]*E,K+=fe[3]*E),j){const _e=new T(re,W),Ce=new T(le,W),Ge=new T(re,K),De=new T(le,K),Fe=j*Math.PI/180;_e._rotate(Fe),Ce._rotate(Fe),Ge._rotate(Fe),De._rotate(Fe),re=Math.min(_e.x,Ce.x,Ge.x,De.x),le=Math.max(_e.x,Ce.x,Ge.x,De.x),W=Math.min(_e.y,Ce.y,Ge.y,De.y),K=Math.max(_e.y,Ce.y,Ge.y,De.y)}i.emplaceBack(u.x,u.y,re,W,le,K,f,v,b)}this.boxEndIndex=i.length}}class SC{constructor(i=[],u=MC){if(this.data=i,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(i){this.data.push(i),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const i=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:u,compare:f}=this,v=u[i];for(;i>0;){const b=i-1>>1,w=u[b];if(f(v,w)>=0)break;u[i]=w,i=b}u[i]=v}_down(i){const{data:u,compare:f}=this,v=this.length>>1,b=u[i];for(;i<v;){let w=1+(i<<1),E=u[w];const R=w+1;if(R<this.length&&f(u[R],E)<0&&(w=R,E=u[R]),f(E,b)>=0)break;u[i]=E,i=w}u[i]=b}}function MC(o,i){return o<i?-1:o>i?1:0}function TC(o,i=1,u=!1){let f=1/0,v=1/0,b=-1/0,w=-1/0;const E=o[0];for(let re=0;re<E.length;re++){const le=E[re];(!re||le.x<f)&&(f=le.x),(!re||le.y<v)&&(v=le.y),(!re||le.x>b)&&(b=le.x),(!re||le.y>w)&&(w=le.y)}const R=Math.min(b-f,w-v);let L=R/2;const j=new SC([],EC);if(R===0)return new T(f,v);for(let re=f;re<b;re+=R)for(let le=v;le<w;le+=R)j.push(new Rh(re+L,le+L,L,o));let W=function(re){let le=0,fe=0,_e=0;const Ce=re[0];for(let Ge=0,De=Ce.length,Fe=De-1;Ge<De;Fe=Ge++){const dt=Ce[Ge],mt=Ce[Fe],qt=dt.x*mt.y-mt.x*dt.y;fe+=(dt.x+mt.x)*qt,_e+=(dt.y+mt.y)*qt,le+=3*qt}return new Rh(fe/le,_e/le,0,re)}(o),K=j.length;for(;j.length;){const re=j.pop();(re.d>W.d||!W.d)&&(W=re,u&&console.log("found best %d after %d probes",Math.round(1e4*re.d)/1e4,K)),re.max-W.d<=i||(L=re.h/2,j.push(new Rh(re.p.x-L,re.p.y-L,L,o)),j.push(new Rh(re.p.x+L,re.p.y-L,L,o)),j.push(new Rh(re.p.x-L,re.p.y+L,L,o)),j.push(new Rh(re.p.x+L,re.p.y+L,L,o)),K+=4)}return u&&(console.log(`num probes: ${K}`),console.log(`best distance: ${W.d}`)),W.p}function EC(o,i){return i.max-o.max}function Rh(o,i,u,f){this.p=new T(o,i),this.h=u,this.d=function(v,b){let w=!1,E=1/0;for(let R=0;R<b.length;R++){const L=b[R];for(let j=0,W=L.length,K=W-1;j<W;K=j++){const re=L[j],le=L[K];re.y>v.y!=le.y>v.y&&v.x<(le.x-re.x)*(v.y-re.y)/(le.y-re.y)+re.x&&(w=!w),E=Math.min(E,bw(v,re,le))}}return(w?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Ci;h.ap=void 0,(Ci=h.ap||(h.ap={}))[Ci.center=1]="center",Ci[Ci.left=2]="left",Ci[Ci.right=3]="right",Ci[Ci.top=4]="top",Ci[Ci.bottom=5]="bottom",Ci[Ci["top-left"]=6]="top-left",Ci[Ci["top-right"]=7]="top-right",Ci[Ci["bottom-left"]=8]="bottom-left",Ci[Ci["bottom-right"]=9]="bottom-right";const Wl=7,Iy=Number.POSITIVE_INFINITY;function O4(o,i){return i[1]!==Iy?function(u,f,v){let b=0,w=0;switch(f=Math.abs(f),v=Math.abs(v),u){case"top-right":case"top-left":case"top":w=v-Wl;break;case"bottom-right":case"bottom-left":case"bottom":w=-v+Wl}switch(u){case"top-right":case"bottom-right":case"right":b=-f;break;case"top-left":case"bottom-left":case"left":b=f}return[b,w]}(o,i[0],i[1]):function(u,f){let v=0,b=0;f<0&&(f=0);const w=f/Math.SQRT2;switch(u){case"top-right":case"top-left":b=w-Wl;break;case"bottom-right":case"bottom-left":b=-w+Wl;break;case"bottom":b=-f+Wl;break;case"top":b=f-Wl}switch(u){case"top-right":case"bottom-right":v=-w;break;case"top-left":case"bottom-left":v=w;break;case"left":v=f;break;case"right":v=-f}return[v,b]}(o,i[0])}function U4(o,i,u){var f;const v=o.layout,b=(f=v.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(i,{},u);if(b){const E=b.values,R=[];for(let L=0;L<E.length;L+=2){const j=R[L]=E[L],W=E[L+1].map(K=>K*ni);j.startsWith("top")?W[1]-=Wl:j.startsWith("bottom")&&(W[1]+=Wl),R[L+1]=W}return new wn(R)}const w=v.get("text-variable-anchor");if(w){let E;E=o._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[v.get("text-radial-offset").evaluate(i,{},u)*ni,Iy]:v.get("text-offset").evaluate(i,{},u).map(L=>L*ni);const R=[];for(const L of w)R.push(L,O4(L,E));return new wn(R)}return null}function Dy(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function AC(o,i,u,f,v,b,w,E,R,L,j){let W=b.textMaxSize.evaluate(i,{});W===void 0&&(W=w);const K=o.layers[0].layout,re=K.get("icon-offset").evaluate(i,{},j),le=H4(u.horizontal),fe=w/24,_e=o.tilePixelRatio*fe,Ce=o.tilePixelRatio*W/24,Ge=o.tilePixelRatio*E,De=o.tilePixelRatio*K.get("symbol-spacing"),Fe=K.get("text-padding")*o.tilePixelRatio,dt=function(Et,_n,dn,jn=1){const br=Et.get("icon-padding").evaluate(_n,{},dn),Tr=br&&br.values;return[Tr[0]*jn,Tr[1]*jn,Tr[2]*jn,Tr[3]*jn]}(K,i,j,o.tilePixelRatio),mt=K.get("text-max-angle")/180*Math.PI,qt=K.get("text-rotation-alignment")!=="viewport"&&K.get("symbol-placement")!=="point",cn=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",jt=K.get("symbol-placement"),Vt=De/2,Rt=K.get("icon-text-fit");let rn;f&&Rt!=="none"&&(o.allowVerticalPlacement&&u.vertical&&(rn=h4(f,u.vertical,Rt,K.get("icon-text-fit-padding"),re,fe)),le&&(f=h4(f,le,Rt,K.get("icon-text-fit-padding"),re,fe)));const Bt=(Et,_n)=>{_n.x<0||_n.x>=Wn||_n.y<0||_n.y>=Wn||function(dn,jn,br,Tr,ri,Ea,Yi,Kr,yi,Pi,Ki,Ji,ii,ai,Ni,Qi,Bi,ha,da,si,Zn,Oi,Ri,oi,hs){const Ds=dn.addToLineVertexArray(jn,br);let ks,Ho,ds,Wa,fa=0,Go=0,s0=0,q4=0,Uy=-1,Vy=-1;const jo={};let $4=Hn("");if(dn.allowVerticalPlacement&&Tr.vertical){const Ui=Kr.layout.get("text-rotate").evaluate(Zn,{},oi)+90;ds=new jm(yi,jn,Pi,Ki,Ji,Tr.vertical,ii,ai,Ni,Ui),Yi&&(Wa=new jm(yi,jn,Pi,Ki,Ji,Yi,Bi,ha,Ni,Ui))}if(ri){const Ui=Kr.layout.get("icon-rotate").evaluate(Zn,{}),qa=Kr.layout.get("icon-text-fit")!=="none",iu=N4(ri,Ui,Ri,qa),zs=Yi?N4(Yi,Ui,Ri,qa):void 0;Ho=new jm(yi,jn,Pi,Ki,Ji,ri,Bi,ha,!1,Ui),fa=4*iu.length;const au=dn.iconSizeData;let io=null;au.kind==="source"?(io=[ro*Kr.layout.get("icon-size").evaluate(Zn,{})],io[0]>Hl&&Re(`${dn.layerIds[0]}: Value for "icon-size" is >= ${n0}. Reduce your "icon-size".`)):au.kind==="composite"&&(io=[ro*Oi.compositeIconSizes[0].evaluate(Zn,{},oi),ro*Oi.compositeIconSizes[1].evaluate(Zn,{},oi)],(io[0]>Hl||io[1]>Hl)&&Re(`${dn.layerIds[0]}: Value for "icon-size" is >= ${n0}. Reduce your "icon-size".`)),dn.addSymbols(dn.icon,iu,io,si,da,Zn,h.ah.none,jn,Ds.lineStartIndex,Ds.lineLength,-1,oi),Uy=dn.icon.placedSymbolArray.length-1,zs&&(Go=4*zs.length,dn.addSymbols(dn.icon,zs,io,si,da,Zn,h.ah.vertical,jn,Ds.lineStartIndex,Ds.lineLength,-1,oi),Vy=dn.icon.placedSymbolArray.length-1)}const X4=Object.keys(Tr.horizontal);for(const Ui of X4){const qa=Tr.horizontal[Ui];if(!ks){$4=Hn(qa.text);const zs=Kr.layout.get("text-rotate").evaluate(Zn,{},oi);ks=new jm(yi,jn,Pi,Ki,Ji,qa,ii,ai,Ni,zs)}const iu=qa.positionedLines.length===1;if(s0+=V4(dn,jn,qa,Ea,Kr,Ni,Zn,Qi,Ds,Tr.vertical?h.ah.horizontal:h.ah.horizontalOnly,iu?X4:[Ui],jo,Uy,Oi,oi),iu)break}Tr.vertical&&(q4+=V4(dn,jn,Tr.vertical,Ea,Kr,Ni,Zn,Qi,Ds,h.ah.vertical,["vertical"],jo,Vy,Oi,oi));const RC=ks?ks.boxStartIndex:dn.collisionBoxArray.length,IC=ks?ks.boxEndIndex:dn.collisionBoxArray.length,DC=ds?ds.boxStartIndex:dn.collisionBoxArray.length,kC=ds?ds.boxEndIndex:dn.collisionBoxArray.length,LC=Ho?Ho.boxStartIndex:dn.collisionBoxArray.length,zC=Ho?Ho.boxEndIndex:dn.collisionBoxArray.length,FC=Wa?Wa.boxStartIndex:dn.collisionBoxArray.length,NC=Wa?Wa.boxEndIndex:dn.collisionBoxArray.length;let Ls=-1;const qm=(Ui,qa)=>Ui&&Ui.circleDiameter?Math.max(Ui.circleDiameter,qa):qa;Ls=qm(ks,Ls),Ls=qm(ds,Ls),Ls=qm(Ho,Ls),Ls=qm(Wa,Ls);const Z4=Ls>-1?1:0;Z4&&(Ls*=hs/ni),dn.glyphOffsetArray.length>=Ch.MAX_GLYPHS&&Re("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&dn.addToSortKeyRanges(dn.symbolInstances.length,Zn.sortKey);const BC=U4(Kr,Zn,oi),[OC,UC]=function(Ui,qa){const iu=Ui.length,zs=qa==null?void 0:qa.values;if((zs==null?void 0:zs.length)>0)for(let au=0;au<zs.length;au+=2){const io=zs[au+1];Ui.emplaceBack(h.ap[zs[au]],io[0],io[1])}return[iu,Ui.length]}(dn.textAnchorOffsets,BC);dn.symbolInstances.emplaceBack(jn.x,jn.y,jo.right>=0?jo.right:-1,jo.center>=0?jo.center:-1,jo.left>=0?jo.left:-1,jo.vertical||-1,Uy,Vy,$4,RC,IC,DC,kC,LC,zC,FC,NC,Pi,s0,q4,fa,Go,Z4,0,ii,Ls,OC,UC)}(o,_n,Et,u,f,v,rn,o.layers[0],o.collisionBoxArray,i.index,i.sourceLayerIndex,o.index,_e,[Fe,Fe,Fe,Fe],qt,R,Ge,dt,cn,re,i,b,L,j,w)};if(jt==="line")for(const Et of I4(i.geometry,0,0,Wn,Wn)){const _n=wC(Et,De,mt,u.vertical||le,f,24,Ce,o.overscaling,Wn);for(const dn of _n)le&&CC(o,le.text,Vt,dn)||Bt(Et,dn)}else if(jt==="line-center"){for(const Et of i.geometry)if(Et.length>1){const _n=bC(Et,mt,u.vertical||le,f,24,Ce);_n&&Bt(Et,_n)}}else if(i.type==="Polygon")for(const Et of uy(i.geometry,0)){const _n=TC(Et,16);Bt(Et[0],new jl(_n.x,_n.y,0))}else if(i.type==="LineString")for(const Et of i.geometry)Bt(Et,new jl(Et[0].x,Et[0].y,0));else if(i.type==="Point")for(const Et of i.geometry)for(const _n of Et)Bt([_n],new jl(_n.x,_n.y,0))}function V4(o,i,u,f,v,b,w,E,R,L,j,W,K,re,le){const fe=function(Ge,De,Fe,dt,mt,qt,cn,jt){const Vt=dt.layout.get("text-rotate").evaluate(qt,{})*Math.PI/180,Rt=[];for(const rn of De.positionedLines)for(const Bt of rn.positionedGlyphs){if(!Bt.rect)continue;const Et=Bt.rect||{};let _n=i4+1,dn=!0,jn=1,br=0;const Tr=(mt||jt)&&Bt.vertical,ri=Bt.metrics.advance*Bt.scale/2;if(jt&&De.verticalizable&&(br=rn.lineOffset/2-(Bt.imageName?-(ni-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*ni)),Bt.imageName){const si=cn[Bt.imageName];dn=si.sdf,jn=si.pixelRatio,_n=ua/jn}const Ea=mt?[Bt.x+ri,Bt.y]:[0,0];let Yi=mt?[0,0]:[Bt.x+ri+Fe[0],Bt.y+Fe[1]-br],Kr=[0,0];Tr&&(Kr=Yi,Yi=[0,0]);const yi=Bt.metrics.isDoubleResolution?2:1,Pi=(Bt.metrics.left-_n)*Bt.scale-ri+Yi[0],Ki=(-Bt.metrics.top-_n)*Bt.scale+Yi[1],Ji=Pi+Et.w/yi*Bt.scale/jn,ii=Ki+Et.h/yi*Bt.scale/jn,ai=new T(Pi,Ki),Ni=new T(Ji,Ki),Qi=new T(Pi,ii),Bi=new T(Ji,ii);if(Tr){const si=new T(-ri,ri-e0),Zn=-Math.PI/2,Oi=ni/2-ri,Ri=new T(5-e0-Oi,-(Bt.imageName?Oi:0)),oi=new T(...Kr);ai._rotateAround(Zn,si)._add(Ri)._add(oi),Ni._rotateAround(Zn,si)._add(Ri)._add(oi),Qi._rotateAround(Zn,si)._add(Ri)._add(oi),Bi._rotateAround(Zn,si)._add(Ri)._add(oi)}if(Vt){const si=Math.sin(Vt),Zn=Math.cos(Vt),Oi=[Zn,-si,si,Zn];ai._matMult(Oi),Ni._matMult(Oi),Qi._matMult(Oi),Bi._matMult(Oi)}const ha=new T(0,0),da=new T(0,0);Rt.push({tl:ai,tr:Ni,bl:Qi,br:Bi,tex:Et,writingMode:De.writingMode,glyphOffset:Ea,sectionIndex:Bt.sectionIndex,isSDF:dn,pixelOffsetTL:ha,pixelOffsetBR:da,minFontScaleX:0,minFontScaleY:0})}return Rt}(0,u,E,v,b,w,f,o.allowVerticalPlacement),_e=o.textSizeData;let Ce=null;_e.kind==="source"?(Ce=[ro*v.layout.get("text-size").evaluate(w,{})],Ce[0]>Hl&&Re(`${o.layerIds[0]}: Value for "text-size" is >= ${n0}. Reduce your "text-size".`)):_e.kind==="composite"&&(Ce=[ro*re.compositeTextSizes[0].evaluate(w,{},le),ro*re.compositeTextSizes[1].evaluate(w,{},le)],(Ce[0]>Hl||Ce[1]>Hl)&&Re(`${o.layerIds[0]}: Value for "text-size" is >= ${n0}. Reduce your "text-size".`)),o.addSymbols(o.text,fe,Ce,E,b,w,L,i,R.lineStartIndex,R.lineLength,K,le);for(const Ge of j)W[Ge]=o.text.placedSymbolArray.length-1;return 4*fe.length}function H4(o){for(const i in o)return o[i];return null}function CC(o,i,u,f){const v=o.compareText;if(i in v){const b=v[i];for(let w=b.length-1;w>=0;w--)if(f.dist(b[w])<u)return!0}else v[i]=[];return v[i].push(f),!1}const G4=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class ky{static from(i){if(!(i instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(i,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const v=f>>4;if(v!==1)throw new Error(`Got v${v} data when expected v1.`);const b=G4[15&f];if(!b)throw new Error("Unrecognized array type.");const[w]=new Uint16Array(i,2,1),[E]=new Uint32Array(i,4,1);return new ky(E,w,b,i)}constructor(i,u=64,f=Float64Array,v){if(isNaN(i)||i<0)throw new Error(`Unpexpected numItems value: ${i}.`);this.numItems=+i,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=i<65536?Uint16Array:Uint32Array;const b=G4.indexOf(this.ArrayType),w=2*i*this.ArrayType.BYTES_PER_ELEMENT,E=i*this.IndexArrayType.BYTES_PER_ELEMENT,R=(8-E%8)%8;if(b<0)throw new Error(`Unexpected typed array class: ${f}.`);v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+E+R,2*i),this._pos=2*i,this._finished=!0):(this.data=new ArrayBuffer(8+w+E+R),this.ids=new this.IndexArrayType(this.data,8,i),this.coords=new this.ArrayType(this.data,8+E+R,2*i),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+b]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=i)}add(i,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=i,this.coords[this._pos++]=u,f}finish(){const i=this._pos>>1;if(i!==this.numItems)throw new Error(`Added ${i} items when expected ${this.numItems}.`);return Ly(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(i,u,f,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:b,coords:w,nodeSize:E}=this,R=[0,b.length-1,0],L=[];for(;R.length;){const j=R.pop()||0,W=R.pop()||0,K=R.pop()||0;if(W-K<=E){for(let _e=K;_e<=W;_e++){const Ce=w[2*_e],Ge=w[2*_e+1];Ce>=i&&Ce<=f&&Ge>=u&&Ge<=v&&L.push(b[_e])}continue}const re=K+W>>1,le=w[2*re],fe=w[2*re+1];le>=i&&le<=f&&fe>=u&&fe<=v&&L.push(b[re]),(j===0?i<=le:u<=fe)&&(R.push(K),R.push(re-1),R.push(1-j)),(j===0?f>=le:v>=fe)&&(R.push(re+1),R.push(W),R.push(1-j))}return L}within(i,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:v,coords:b,nodeSize:w}=this,E=[0,v.length-1,0],R=[],L=f*f;for(;E.length;){const j=E.pop()||0,W=E.pop()||0,K=E.pop()||0;if(W-K<=w){for(let _e=K;_e<=W;_e++)W4(b[2*_e],b[2*_e+1],i,u)<=L&&R.push(v[_e]);continue}const re=K+W>>1,le=b[2*re],fe=b[2*re+1];W4(le,fe,i,u)<=L&&R.push(v[re]),(j===0?i-f<=le:u-f<=fe)&&(E.push(K),E.push(re-1),E.push(1-j)),(j===0?i+f>=le:u+f>=fe)&&(E.push(re+1),E.push(W),E.push(1-j))}return R}}function Ly(o,i,u,f,v,b){if(v-f<=u)return;const w=f+v>>1;j4(o,i,w,f,v,b),Ly(o,i,u,f,w-1,1-b),Ly(o,i,u,w+1,v,1-b)}function j4(o,i,u,f,v,b){for(;v>f;){if(v-f>600){const L=v-f+1,j=u-f+1,W=Math.log(L),K=.5*Math.exp(2*W/3),re=.5*Math.sqrt(W*K*(L-K)/L)*(j-L/2<0?-1:1);j4(o,i,u,Math.max(f,Math.floor(u-j*K/L+re)),Math.min(v,Math.floor(u+(L-j)*K/L+re)),b)}const w=i[2*u+b];let E=f,R=v;for(i0(o,i,f,u),i[2*v+b]>w&&i0(o,i,f,v);E<R;){for(i0(o,i,E,R),E++,R--;i[2*E+b]<w;)E++;for(;i[2*R+b]>w;)R--}i[2*f+b]===w?i0(o,i,f,R):(R++,i0(o,i,R,v)),R<=u&&(f=R+1),u<=R&&(v=R-1)}}function i0(o,i,u,f){zy(o,u,f),zy(i,2*u,2*f),zy(i,2*u+1,2*f+1)}function zy(o,i,u){const f=o[i];o[i]=o[u],o[u]=f}function W4(o,i,u,f){const v=o-u,b=i-f;return v*v+b*b}var Fy;h.bd=void 0,(Fy=h.bd||(h.bd={})).create="create",Fy.load="load",Fy.fullLoad="fullLoad";let Wm=null,a0=[];const Ny=1e3/60,By="loadTime",Oy="fullLoadTime",PC={mark(o){performance.mark(o)},frame(o){const i=o;Wm!=null&&a0.push(i-Wm),Wm=i},clearMetrics(){Wm=null,a0=[],performance.clearMeasures(By),performance.clearMeasures(Oy);for(const o in h.bd)performance.clearMarks(h.bd[o])},getPerformanceMetrics(){performance.measure(By,h.bd.create,h.bd.load),performance.measure(Oy,h.bd.create,h.bd.fullLoad);const o=performance.getEntriesByName(By)[0].duration,i=performance.getEntriesByName(Oy)[0].duration,u=a0.length,f=1/(a0.reduce((b,w)=>b+w,0)/u/1e3),v=a0.filter(b=>b>Ny).reduce((b,w)=>b+(w-Ny)/Ny,0);return{loadTime:o,fullLoadTime:i,fps:f,percentDroppedFrames:v/(u+v)*100,totalFrames:u}}};h.$=xt,h.A=wh,h.B=function(o){if(ft==null){const i=o.navigator?o.navigator.userAgent:null;ft=!!o.safari||!(!i||!(/\b(iPad|iPhone|iPod)\b/.test(i)||i.match("Safari")&&!i.match("Chrome")))}return ft},h.C=class{constructor(o,i){this.target=o,this.mapId=i,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _C(()=>this.process()),this.subscription=function(u,f,v,b){return u.addEventListener(f,v,!1),{unsubscribe:()=>{u.removeEventListener(f,v,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=gt(self)?o:window}registerMessageHandler(o,i){this.messageHandlers[o]=i}sendAsync(o,i){return new Promise((u,f)=>{const v=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[v]={resolve:u,reject:f},i&&i.signal.addEventListener("abort",()=>{delete this.resolveRejects[v];const E={id:v,type:"<cancel>",origin:location.origin,targetMapId:o.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const b=[],w=Object.assign(Object.assign({},o),{id:v,sourceMapId:this.mapId,origin:location.origin,data:Do(o.data,b)});this.target.postMessage(w,{transfer:b})})}receive(o){const i=o.data,u=i.id;if(!(i.origin!=="file://"&&location.origin!=="file://"&&i.origin!==location.origin||i.targetMapId&&this.mapId!==i.targetMapId)){if(i.type==="<cancel>"){delete this.tasks[u];const f=this.abortControllers[u];return delete this.abortControllers[u],void(f&&f.abort())}if(gt(self)||i.mustQueue)return this.tasks[u]=i,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,i)}}process(){if(this.taskQueue.length===0)return;const o=this.taskQueue.shift(),i=this.tasks[o];delete this.tasks[o],this.taskQueue.length>0&&this.invoker.trigger(),i&&this.processTask(o,i)}processTask(o,i){return l(this,void 0,void 0,function*(){if(i.type==="<response>"){const v=this.resolveRejects[o];return delete this.resolveRejects[o],v?void(i.error?v.reject(zl(i.error)):v.resolve(zl(i.data))):void 0}if(!this.messageHandlers[i.type])return void this.completeTask(o,new Error(`Could not find a registered handler for ${i.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=zl(i.data),f=new AbortController;this.abortControllers[o]=f;try{const v=yield this.messageHandlers[i.type](i.sourceMapId,u,f);this.completeTask(o,null,v)}catch(v){this.completeTask(o,v)}})}completeTask(o,i,u){const f=[];delete this.abortControllers[o];const v={id:o,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:i?Do(i):null,data:Do(u,f)};this.target.postMessage(v,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.D=mn,h.E=Pn,h.F=function(){var o=new wh(16);return wh!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},h.G=At,h.H=function(o,i,u){var f,v,b,w,E,R,L,j,W,K,re,le,fe=u[0],_e=u[1],Ce=u[2];return i===o?(o[12]=i[0]*fe+i[4]*_e+i[8]*Ce+i[12],o[13]=i[1]*fe+i[5]*_e+i[9]*Ce+i[13],o[14]=i[2]*fe+i[6]*_e+i[10]*Ce+i[14],o[15]=i[3]*fe+i[7]*_e+i[11]*Ce+i[15]):(v=i[1],b=i[2],w=i[3],E=i[4],R=i[5],L=i[6],j=i[7],W=i[8],K=i[9],re=i[10],le=i[11],o[0]=f=i[0],o[1]=v,o[2]=b,o[3]=w,o[4]=E,o[5]=R,o[6]=L,o[7]=j,o[8]=W,o[9]=K,o[10]=re,o[11]=le,o[12]=f*fe+E*_e+W*Ce+i[12],o[13]=v*fe+R*_e+K*Ce+i[13],o[14]=b*fe+L*_e+re*Ce+i[14],o[15]=w*fe+j*_e+le*Ce+i[15]),o},h.I=xy,h.J=function(o,i,u){var f=u[0],v=u[1],b=u[2];return o[0]=i[0]*f,o[1]=i[1]*f,o[2]=i[2]*f,o[3]=i[3]*f,o[4]=i[4]*v,o[5]=i[5]*v,o[6]=i[6]*v,o[7]=i[7]*v,o[8]=i[8]*b,o[9]=i[9]*b,o[10]=i[10]*b,o[11]=i[11]*b,o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},h.K=Tw,h.L=function(o,i){const u={};for(let f=0;f<i.length;f++){const v=i[f];v in o&&(u[v]=o[v])}return u},h.M=Gl,h.N=x4,h.O=b4,h.P=T,h.Q=ja,h.R=Ga,h.S=C,h.T=Cf,h.U=U,h.V=ot,h.W=Wn,h.X=Hr,h.Y=Um,h.Z=class extends to{},h._=l,h.a=Mt,h.a$=function(o,i,u){return o[0]=i[0]*u[0],o[1]=i[1]*u[1],o[2]=i[2]*u[2],o[3]=i[3]*u[3],o},h.a0=Ry,h.a1=He,h.a2=o=>{const i=window.document.createElement("video");return i.muted=!0,new Promise(u=>{i.onloadstart=()=>{u(i)};for(const f of o){const v=window.document.createElement("source");Nn(f)||(i.crossOrigin="Anonymous"),v.src=f,i.appendChild(v)}})},h.a3=function(){return xe++},h.a4=wm,h.a5=Ch,h.a6=lh,h.a7=Oo,h.a8=_r,h.a9=A4,h.aA=Te,h.aB=function(o,i){if(!o)return[{command:"setStyle",args:[i]}];let u=[];try{if(!se(o.version,i.version))return[{command:"setStyle",args:[i]}];se(o.center,i.center)||u.push({command:"setCenter",args:[i.center]}),se(o.zoom,i.zoom)||u.push({command:"setZoom",args:[i.zoom]}),se(o.bearing,i.bearing)||u.push({command:"setBearing",args:[i.bearing]}),se(o.pitch,i.pitch)||u.push({command:"setPitch",args:[i.pitch]}),se(o.sprite,i.sprite)||u.push({command:"setSprite",args:[i.sprite]}),se(o.glyphs,i.glyphs)||u.push({command:"setGlyphs",args:[i.glyphs]}),se(o.transition,i.transition)||u.push({command:"setTransition",args:[i.transition]}),se(o.light,i.light)||u.push({command:"setLight",args:[i.light]}),se(o.terrain,i.terrain)||u.push({command:"setTerrain",args:[i.terrain]}),se(o.sky,i.sky)||u.push({command:"setSky",args:[i.sky]});const f={},v=[];(function(w,E,R,L){let j;for(j in E=E||{},w=w||{})Object.prototype.hasOwnProperty.call(w,j)&&(Object.prototype.hasOwnProperty.call(E,j)||Tt(j,R,L));for(j in E)Object.prototype.hasOwnProperty.call(E,j)&&(Object.prototype.hasOwnProperty.call(w,j)?se(w[j],E[j])||(w[j].type==="geojson"&&E[j].type==="geojson"&&pn(w,E,j)?tt(R,{command:"setGeoJSONSourceData",args:[j,E[j].data]}):wt(j,E,R,L)):vt(j,E,R))})(o.sources,i.sources,v,f);const b=[];o.layers&&o.layers.forEach(w=>{"source"in w&&f[w.source]?u.push({command:"removeLayer",args:[w.id]}):b.push(w)}),u=u.concat(v),function(w,E,R){E=E||[];const L=(w=w||[]).map(Ht),j=E.map(Ht),W=w.reduce(Ln,{}),K=E.reduce(Ln,{}),re=L.slice(),le=Object.create(null);let fe,_e,Ce,Ge,De;for(let Fe=0,dt=0;Fe<L.length;Fe++)fe=L[Fe],Object.prototype.hasOwnProperty.call(K,fe)?dt++:(tt(R,{command:"removeLayer",args:[fe]}),re.splice(re.indexOf(fe,dt),1));for(let Fe=0,dt=0;Fe<j.length;Fe++)fe=j[j.length-1-Fe],re[re.length-1-Fe]!==fe&&(Object.prototype.hasOwnProperty.call(W,fe)?(tt(R,{command:"removeLayer",args:[fe]}),re.splice(re.lastIndexOf(fe,re.length-dt),1)):dt++,Ge=re[re.length-Fe],tt(R,{command:"addLayer",args:[K[fe],Ge]}),re.splice(re.length-Fe,0,fe),le[fe]=!0);for(let Fe=0;Fe<j.length;Fe++)if(fe=j[Fe],_e=W[fe],Ce=K[fe],!le[fe]&&!se(_e,Ce))if(se(_e.source,Ce.source)&&se(_e["source-layer"],Ce["source-layer"])&&se(_e.type,Ce.type)){for(De in Gt(_e.layout,Ce.layout,R,fe,null,"setLayoutProperty"),Gt(_e.paint,Ce.paint,R,fe,null,"setPaintProperty"),se(_e.filter,Ce.filter)||tt(R,{command:"setFilter",args:[fe,Ce.filter]}),se(_e.minzoom,Ce.minzoom)&&se(_e.maxzoom,Ce.maxzoom)||tt(R,{command:"setLayerZoomRange",args:[fe,Ce.minzoom,Ce.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Gt(_e[De],Ce[De],R,fe,De.slice(6),"setPaintProperty"):se(_e[De],Ce[De])||tt(R,{command:"setLayerProperty",args:[fe,De,Ce[De]]}));for(De in Ce)Object.prototype.hasOwnProperty.call(Ce,De)&&!Object.prototype.hasOwnProperty.call(_e,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?Gt(_e[De],Ce[De],R,fe,De.slice(6),"setPaintProperty"):se(_e[De],Ce[De])||tt(R,{command:"setLayerProperty",args:[fe,De,Ce[De]]}))}else tt(R,{command:"removeLayer",args:[fe]}),Ge=re[re.lastIndexOf(fe)+1],tt(R,{command:"addLayer",args:[Ce,Ge]})}(b,i.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:"setStyle",args:[i]}]}return u},h.aC=function(o){const i=[],u=o.id;return u===void 0&&i.push({message:`layers.${u}: missing required property "id"`}),o.render===void 0&&i.push({message:`layers.${u}: missing required method "render"`}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&i.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),i},h.aD=function o(i,u){if(Array.isArray(i)){if(!Array.isArray(u)||i.length!==u.length)return!1;for(let f=0;f<i.length;f++)if(!o(i[f],u[f]))return!1;return!0}if(typeof i=="object"&&i!==null&&u!==null){if(typeof u!="object"||Object.keys(i).length!==Object.keys(u).length)return!1;for(const f in i)if(!o(i[f],u[f]))return!1;return!0}return i===u},h.aE=ie,h.aF=J,h.aG=class extends gr{constructor(o,i){super(o,i),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},h.aH=Ai,h.aI=class extends gr{constructor(o,i){super(o,i),this.current=Fo}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let i=1;i<16;i++)if(o[i]!==this.current[i]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},h.aJ=Va,h.aK=class extends gr{constructor(o,i){super(o,i),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},h.aL=class extends gr{constructor(o,i){super(o,i),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},h.aM=cs,h.aN=function(o,i,u,f,v,b,w){var E=1/(i-u),R=1/(f-v),L=1/(b-w);return o[0]=-2*E,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*R,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*L,o[11]=0,o[12]=(i+u)*E,o[13]=(v+f)*R,o[14]=(w+b)*L,o[15]=1,o},h.aO=nn,h.aP=Q8,h.aQ=class extends eu{},h.aR=$7,h.aS=class extends Nl{},h.aT=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},h.aU=Rw,h.aV=$,h.aW=class extends Bf{},h.aX=nt,h.aY=function(o,i){return o[0]===i[0]&&o[1]===i[1]&&o[2]===i[2]&&o[3]===i[3]&&o[4]===i[4]&&o[5]===i[5]&&o[6]===i[6]&&o[7]===i[7]&&o[8]===i[8]&&o[9]===i[9]&&o[10]===i[10]&&o[11]===i[11]&&o[12]===i[12]&&o[13]===i[13]&&o[14]===i[14]&&o[15]===i[15]},h.aZ=function(o,i){var u=o[0],f=o[1],v=o[2],b=o[3],w=o[4],E=o[5],R=o[6],L=o[7],j=o[8],W=o[9],K=o[10],re=o[11],le=o[12],fe=o[13],_e=o[14],Ce=o[15],Ge=i[0],De=i[1],Fe=i[2],dt=i[3],mt=i[4],qt=i[5],cn=i[6],jt=i[7],Vt=i[8],Rt=i[9],rn=i[10],Bt=i[11],Et=i[12],_n=i[13],dn=i[14],jn=i[15];return Math.abs(u-Ge)<=Zi*Math.max(1,Math.abs(u),Math.abs(Ge))&&Math.abs(f-De)<=Zi*Math.max(1,Math.abs(f),Math.abs(De))&&Math.abs(v-Fe)<=Zi*Math.max(1,Math.abs(v),Math.abs(Fe))&&Math.abs(b-dt)<=Zi*Math.max(1,Math.abs(b),Math.abs(dt))&&Math.abs(w-mt)<=Zi*Math.max(1,Math.abs(w),Math.abs(mt))&&Math.abs(E-qt)<=Zi*Math.max(1,Math.abs(E),Math.abs(qt))&&Math.abs(R-cn)<=Zi*Math.max(1,Math.abs(R),Math.abs(cn))&&Math.abs(L-jt)<=Zi*Math.max(1,Math.abs(L),Math.abs(jt))&&Math.abs(j-Vt)<=Zi*Math.max(1,Math.abs(j),Math.abs(Vt))&&Math.abs(W-Rt)<=Zi*Math.max(1,Math.abs(W),Math.abs(Rt))&&Math.abs(K-rn)<=Zi*Math.max(1,Math.abs(K),Math.abs(rn))&&Math.abs(re-Bt)<=Zi*Math.max(1,Math.abs(re),Math.abs(Bt))&&Math.abs(le-Et)<=Zi*Math.max(1,Math.abs(le),Math.abs(Et))&&Math.abs(fe-_n)<=Zi*Math.max(1,Math.abs(fe),Math.abs(_n))&&Math.abs(_e-dn)<=Zi*Math.max(1,Math.abs(_e),Math.abs(dn))&&Math.abs(Ce-jn)<=Zi*Math.max(1,Math.abs(Ce),Math.abs(jn))},h.a_=function(o,i){return o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[4]=i[4],o[5]=i[5],o[6]=i[6],o[7]=i[7],o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15],o},h.aa=function(o){const i={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,v,b)=>{const w=v||b;return i[f]=!w||w.toLowerCase(),""}),i["max-age"]){const u=parseInt(i["max-age"],10);isNaN(u)?delete i["max-age"]:i["max-age"]=u}return i},h.ab=function(o,i){const u=[];for(const f in o)f in i||u.push(f);return u},h.ac=he,h.ad=function(o,i,u){var f=Math.sin(u),v=Math.cos(u),b=i[0],w=i[1],E=i[2],R=i[3],L=i[4],j=i[5],W=i[6],K=i[7];return i!==o&&(o[8]=i[8],o[9]=i[9],o[10]=i[10],o[11]=i[11],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[0]=b*v+L*f,o[1]=w*v+j*f,o[2]=E*v+W*f,o[3]=R*v+K*f,o[4]=L*v-b*f,o[5]=j*v-w*f,o[6]=W*v-E*f,o[7]=K*v-R*f,o},h.ae=function(o){var i=new wh(16);return i[0]=o[0],i[1]=o[1],i[2]=o[2],i[3]=o[3],i[4]=o[4],i[5]=o[5],i[6]=o[6],i[7]=o[7],i[8]=o[8],i[9]=o[9],i[10]=o[10],i[11]=o[11],i[12]=o[12],i[13]=o[13],i[14]=o[14],i[15]=o[15],i},h.af=Pm,h.ag=function(o,i){let u=0,f=0;if(o.kind==="constant")f=o.layoutSize;else if(o.kind!=="source"){const{interpolationType:v,minZoom:b,maxZoom:w}=o,E=v?he(Fi.interpolationFactor(v,i,b,w),0,1):0;o.kind==="camera"?f=oa.number(o.minSize,o.maxSize,E):u=E}return{uSizeT:u,uSize:f}},h.ai=function(o,{uSize:i,uSizeT:u},{lowerSize:f,upperSize:v}){return o.kind==="source"?f/ro:o.kind==="composite"?oa.number(f/ro,v/ro,u):i},h.aj=My,h.ak=function(o,i,u,f){const v=i.y-o.y,b=i.x-o.x,w=f.y-u.y,E=f.x-u.x,R=w*b-E*v;if(R===0)return null;const L=(E*(o.y-u.y)-w*(o.x-u.x))/R;return new T(o.x+L*b,o.y+L*v)},h.al=I4,h.am=Uo,h.an=ry,h.ao=ni,h.aq=Sy,h.ar=function(o,i){var u=i[0],f=i[1],v=i[2],b=i[3],w=i[4],E=i[5],R=i[6],L=i[7],j=i[8],W=i[9],K=i[10],re=i[11],le=i[12],fe=i[13],_e=i[14],Ce=i[15],Ge=u*E-f*w,De=u*R-v*w,Fe=u*L-b*w,dt=f*R-v*E,mt=f*L-b*E,qt=v*L-b*R,cn=j*fe-W*le,jt=j*_e-K*le,Vt=j*Ce-re*le,Rt=W*_e-K*fe,rn=W*Ce-re*fe,Bt=K*Ce-re*_e,Et=Ge*Bt-De*rn+Fe*Rt+dt*Vt-mt*jt+qt*cn;return Et?(o[0]=(E*Bt-R*rn+L*Rt)*(Et=1/Et),o[1]=(v*rn-f*Bt-b*Rt)*Et,o[2]=(fe*qt-_e*mt+Ce*dt)*Et,o[3]=(K*mt-W*qt-re*dt)*Et,o[4]=(R*Vt-w*Bt-L*jt)*Et,o[5]=(u*Bt-v*Vt+b*jt)*Et,o[6]=(_e*Fe-le*qt-Ce*De)*Et,o[7]=(j*qt-K*Fe+re*De)*Et,o[8]=(w*rn-E*Vt+L*cn)*Et,o[9]=(f*Vt-u*rn-b*cn)*Et,o[10]=(le*mt-fe*Fe+Ce*Ge)*Et,o[11]=(W*Fe-j*mt-re*Ge)*Et,o[12]=(E*jt-w*Rt-R*cn)*Et,o[13]=(u*Rt-f*jt+v*cn)*Et,o[14]=(fe*De-le*dt-_e*Ge)*Et,o[15]=(j*dt-W*De+K*Ge)*Et,o):null},h.as=Dy,h.at=wy,h.au=ky,h.av=function(){const o={},i=je.$version;for(const u in je.$root){const f=je.$root[u];if(f.required){let v=null;v=u==="version"?i:f.type==="array"?[]:{},v!=null&&(o[u]=v)}}return o},h.aw=Mf,h.ax=Dn,h.ay=function(o){o=o.slice();const i=Object.create(null);for(let u=0;u<o.length;u++)i[o[u].id]=o[u];for(let u=0;u<o.length;u++)"ref"in o[u]&&(o[u]=Ae(o[u],i[o[u].ref]));return o},h.az=function(o){if(o.type==="custom")return new yC(o);switch(o.type){case"background":return new mC(o);case"circle":return new e7(o);case"fill":return new x7(o);case"fill-extrusion":return new z7(o);case"heatmap":return new n7(o);case"hillshade":return new i7(o);case"line":return new G7(o);case"raster":return new vC(o);case"symbol":return new Om(o)}},h.b=ke,h.b0=function(o,i){return o[0]*i[0]+o[1]*i[1]+o[2]*i[2]+o[3]*i[3]},h.b1=Z,h.b2=M4,h.b3=w4,h.b4=function(o,i,u,f,v){var b,w=1/Math.tan(i/2);return o[0]=w/u,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,v!=null&&v!==1/0?(o[10]=(v+f)*(b=1/(f-v)),o[14]=2*v*f*b):(o[10]=-1,o[14]=-2*f),o},h.b5=function(o,i,u){var f=Math.sin(u),v=Math.cos(u),b=i[4],w=i[5],E=i[6],R=i[7],L=i[8],j=i[9],W=i[10],K=i[11];return i!==o&&(o[0]=i[0],o[1]=i[1],o[2]=i[2],o[3]=i[3],o[12]=i[12],o[13]=i[13],o[14]=i[14],o[15]=i[15]),o[4]=b*v+L*f,o[5]=w*v+j*f,o[6]=E*v+W*f,o[7]=R*v+K*f,o[8]=L*v-b*f,o[9]=j*v-w*f,o[10]=W*v-E*f,o[11]=K*v-R*f,o},h.b6=V,h.b7=Y,h.b8=function(o){return o*Math.PI/180},h.b9=function(o,i){return o[0]=i[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=i[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=i[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},h.bA=ko,h.ba=class extends mh{},h.bb=Cy,h.bc=PC,h.be=Sn,h.bf=function(o,i){Mt.REGISTERED_PROTOCOLS[o]=i},h.bg=function(o){delete Mt.REGISTERED_PROTOCOLS[o]},h.bh=function(o,i){const u={};for(let v=0;v<o.length;v++){const b=i&&i[o[v].id]||ey(o[v]);i&&(i[o[v].id]=b);let w=u[b];w||(w=u[b]=[]),w.push(o[v])}const f=[];for(const v in u)f.push(u[v]);return f},h.bi=Jt,h.bj=E4,h.bk=C4,h.bl=s4,h.bm=function(o){o.bucket.createArrays(),o.bucket.tilePixelRatio=Wn/(512*o.bucket.overscaling),o.bucket.compareText={},o.bucket.iconsNeedLinear=!1;const i=o.bucket.layers[0],u=i.layout,f=i._unevaluatedLayout._values,v={layoutIconSize:f["icon-size"].possiblyEvaluate(new _r(o.bucket.zoom+1),o.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new _r(o.bucket.zoom+1),o.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new _r(18))};if(o.bucket.textSizeData.kind==="composite"){const{minZoom:L,maxZoom:j}=o.bucket.textSizeData;v.compositeTextSizes=[f["text-size"].possiblyEvaluate(new _r(L),o.canonical),f["text-size"].possiblyEvaluate(new _r(j),o.canonical)]}if(o.bucket.iconSizeData.kind==="composite"){const{minZoom:L,maxZoom:j}=o.bucket.iconSizeData;v.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new _r(L),o.canonical),f["icon-size"].possiblyEvaluate(new _r(j),o.canonical)]}const b=u.get("text-line-height")*ni,w=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",E=u.get("text-keep-upright"),R=u.get("text-size");for(const L of o.bucket.features){const j=u.get("text-font").evaluate(L,{},o.canonical).join(","),W=R.evaluate(L,{},o.canonical),K=v.layoutTextSize.evaluate(L,{},o.canonical),re=v.layoutIconSize.evaluate(L,{},o.canonical),le={horizontal:{},vertical:void 0},fe=L.text;let _e,Ce=[0,0];if(fe){const Fe=fe.toString(),dt=u.get("text-letter-spacing").evaluate(L,{},o.canonical)*ni,mt=hh(Fe)?dt:0,qt=u.get("text-anchor").evaluate(L,{},o.canonical),cn=U4(i,L,o.canonical);if(!cn){const Bt=u.get("text-radial-offset").evaluate(L,{},o.canonical);Ce=Bt?O4(qt,[Bt*ni,Iy]):u.get("text-offset").evaluate(L,{},o.canonical).map(Et=>Et*ni)}let jt=w?"center":u.get("text-justify").evaluate(L,{},o.canonical);const Vt=u.get("symbol-placement"),Rt=Vt==="point"?u.get("text-max-width").evaluate(L,{},o.canonical)*ni:0,rn=()=>{o.bucket.allowVerticalPlacement&&Zc(Fe)&&(le.vertical=Fm(fe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Rt,b,qt,"left",mt,Ce,h.ah.vertical,!0,Vt,K,W))};if(!w&&cn){const Bt=new Set;if(jt==="auto")for(let _n=0;_n<cn.values.length;_n+=2)Bt.add(Dy(cn.values[_n]));else Bt.add(jt);let Et=!1;for(const _n of Bt)if(!le.horizontal[_n])if(Et)le.horizontal[_n]=le.horizontal[0];else{const dn=Fm(fe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Rt,b,"center",_n,mt,Ce,h.ah.horizontal,!1,Vt,K,W);dn&&(le.horizontal[_n]=dn,Et=dn.positionedLines.length===1)}rn()}else{jt==="auto"&&(jt=Dy(qt));const Bt=Fm(fe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Rt,b,qt,jt,mt,Ce,h.ah.horizontal,!1,Vt,K,W);Bt&&(le.horizontal[jt]=Bt),rn(),Zc(Fe)&&w&&E&&(le.vertical=Fm(fe,o.glyphMap,o.glyphPositions,o.imagePositions,j,Rt,b,qt,jt,mt,Ce,h.ah.vertical,!1,Vt,K,W))}}let Ge=!1;if(L.icon&&L.icon.name){const Fe=o.imageMap[L.icon.name];Fe&&(_e=uC(o.imagePositions[L.icon.name],u.get("icon-offset").evaluate(L,{},o.canonical),u.get("icon-anchor").evaluate(L,{},o.canonical)),Ge=!!Fe.sdf,o.bucket.sdfIcons===void 0?o.bucket.sdfIcons=Ge:o.bucket.sdfIcons!==Ge&&Re("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Fe.pixelRatio!==o.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(o.bucket.iconsNeedLinear=!0))}const De=H4(le.horizontal)||le.vertical;o.bucket.iconsInText=!!De&&De.iconsInText,(De||_e)&&AC(o.bucket,L,le,_e,o.imageMap,v,K,re,Ce,Ge,o.canonical)}o.showCollisionBoxes&&o.bucket.generateCollisionDebugBuffers()},h.bn=gy,h.bo=fy,h.bp=my,h.bq=Ul,h.br=yy,h.bs=class{constructor(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let o=performance.getEntriesByName(this._marks.measure);return o.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),o=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),o}},h.bt=function(o,i,u,f,v){return l(this,void 0,void 0,function*(){if(U())try{return yield ot(o,i,u,f,v)}catch{}return function(b,w,E,R,L){const j=b.width,W=b.height;_t&&kt||(_t=new OffscreenCanvas(j,W),kt=_t.getContext("2d",{willReadFrequently:!0})),_t.width=j,_t.height=W,kt.drawImage(b,0,0,j,W);const K=kt.getImageData(w,E,R,L);return kt.clearRect(0,0,j,W),K.data}(o,i,u,f,v)})},h.bu=T4,h.bv=m,h.bw=_,h.bx=Kw,h.by=hr,h.bz=function(o){return o.message===Cn},h.c=it,h.d=o=>l(void 0,void 0,void 0,function*(){if(o.byteLength===0)return createImageBitmap(new ImageData(1,1));const i=new Blob([new Uint8Array(o)],{type:"image/png"});try{return createImageBitmap(i)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.e=ne,h.f=o=>new Promise((i,u)=>{const f=new Image;f.onload=()=>{i(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=at})},f.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const v=new Blob([new Uint8Array(o)],{type:"image/png"});f.src=o.byteLength?URL.createObjectURL(v):at}),h.g=Ft,h.h=(o,i)=>qe(ne(o,{type:"json"}),i),h.i=gt,h.j=un,h.k=gn,h.l=(o,i)=>qe(ne(o,{type:"arrayBuffer"}),i),h.m=qe,h.n=function(o){return new yy(o).readFields(iC,[])},h.o=qf,h.p=a4,h.q=$i,h.r=bf,h.s=Nn,h.t=mm,h.u=$t,h.v=je,h.w=Re,h.x=Ll,h.y=function([o,i,u]){return i+=90,i*=Math.PI/180,u*=Math.PI/180,{x:o*Math.cos(i)*Math.sin(u),y:o*Math.sin(i)*Math.sin(u),z:o*Math.cos(u)}},h.z=oa}),s("worker",["./shared"],function(h){class l{constructor(F){this.keyCache={},F&&this.replace(F)}replace(F){this._layerConfigs={},this._layers={},this.update(F,[])}update(F,O){for(const te of F){this._layerConfigs[te.id]=te;const pe=this._layers[te.id]=h.az(te);pe._featureFilter=h.a6(pe.filter),this.keyCache[te.id]&&delete this.keyCache[te.id]}for(const te of O)delete this.keyCache[te],delete this._layerConfigs[te],delete this._layers[te];this.familiesBySource={};const q=h.bh(Object.values(this._layerConfigs),this.keyCache);for(const te of q){const pe=te.map(Ke=>this._layers[Ke.id]),we=pe[0];if(we.visibility==="none")continue;const Se=we.source||"";let ge=this.familiesBySource[Se];ge||(ge=this.familiesBySource[Se]={});const Pe=we.sourceLayer||"_geojsonTileLayer";let Ye=ge[Pe];Ye||(Ye=ge[Pe]=[]),Ye.push(pe)}}}class m{constructor(F){const O={},q=[];for(const Se in F){const ge=F[Se],Pe=O[Se]={};for(const Ye in ge){const Ke=ge[+Ye];if(!Ke||Ke.bitmap.width===0||Ke.bitmap.height===0)continue;const Xe={x:0,y:0,w:Ke.bitmap.width+2,h:Ke.bitmap.height+2};q.push(Xe),Pe[Ye]={rect:Xe,metrics:Ke.metrics}}}const{w:te,h:pe}=h.p(q),we=new h.o({width:te||1,height:pe||1});for(const Se in F){const ge=F[Se];for(const Pe in ge){const Ye=ge[+Pe];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ke=O[Se][Pe].rect;h.o.copy(Ye.bitmap,we,{x:0,y:0},{x:Ke.x+1,y:Ke.y+1},Ye.bitmap)}}this.image=we,this.positions=O}}h.bi("GlyphAtlas",m);class _{constructor(F){this.tileID=new h.Q(F.tileID.overscaledZ,F.tileID.wrap,F.tileID.canonical.z,F.tileID.canonical.x,F.tileID.canonical.y),this.uid=F.uid,this.zoom=F.zoom,this.pixelRatio=F.pixelRatio,this.tileSize=F.tileSize,this.source=F.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=F.showCollisionBoxes,this.collectResourceTiming=!!F.collectResourceTiming,this.returnDependencies=!!F.returnDependencies,this.promoteId=F.promoteId,this.inFlightDependencies=[]}parse(F,O,q,te){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=F,this.collisionBoxArray=new h.a4;const pe=new h.bj(Object.keys(F.layers).sort()),we=new h.bk(this.tileID,this.promoteId);we.bucketLayerIDs=[];const Se={},ge={featureIndex:we,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},Pe=O.familiesBySource[this.source];for(const Ve in Pe){const $e=F.layers[Ve];if(!$e)continue;$e.version===1&&h.w(`Vector tile source "${this.source}" layer "${Ve}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ze=pe.encode(Ve),Lt=[];for(let Wt=0;Wt<$e.length;Wt++){const Kt=$e.feature(Wt),It=we.getId(Kt,Ve);Lt.push({feature:Kt,id:It,index:Wt,sourceLayerIndex:Ze})}for(const Wt of Pe[Ve]){const Kt=Wt[0];Kt.source!==this.source&&h.w(`layer.source = ${Kt.source} does not equal this.source = ${this.source}`),Kt.minzoom&&this.zoom<Math.floor(Kt.minzoom)||Kt.maxzoom&&this.zoom>=Kt.maxzoom||Kt.visibility!=="none"&&(S(Wt,this.zoom,q),(Se[Kt.id]=Kt.createBucket({index:we.bucketLayerIDs.length,layers:Wt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ze,sourceID:this.source})).populate(Lt,ge,this.tileID.canonical),we.bucketLayerIDs.push(Wt.map(It=>It.id)))}}const Ye=h.aE(ge.glyphDependencies,Ve=>Object.keys(Ve).map(Number));this.inFlightDependencies.forEach(Ve=>Ve==null?void 0:Ve.abort()),this.inFlightDependencies=[];let Ke=Promise.resolve({});if(Object.keys(Ye).length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),Ke=te.sendAsync({type:"getGlyphs",data:{stacks:Ye,source:this.source,tileID:this.tileID,type:"glyphs"}},Ve)}const Xe=Object.keys(ge.iconDependencies);let Pt=Promise.resolve({});if(Xe.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),Pt=te.sendAsync({type:"getImages",data:{icons:Xe,source:this.source,tileID:this.tileID,type:"icons"}},Ve)}const en=Object.keys(ge.patternDependencies);let an=Promise.resolve({});if(en.length){const Ve=new AbortController;this.inFlightDependencies.push(Ve),an=te.sendAsync({type:"getImages",data:{icons:en,source:this.source,tileID:this.tileID,type:"patterns"}},Ve)}const[bn,Mn,sr]=yield Promise.all([Ke,Pt,an]),ue=new m(bn),Ne=new h.bl(Mn,sr);for(const Ve in Se){const $e=Se[Ve];$e instanceof h.a5?(S($e.layers,this.zoom,q),h.bm({bucket:$e,glyphMap:bn,glyphPositions:ue.positions,imageMap:Mn,imagePositions:Ne.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):$e.hasPattern&&($e instanceof h.bn||$e instanceof h.bo||$e instanceof h.bp)&&(S($e.layers,this.zoom,q),$e.addFeatures(ge,this.tileID.canonical,Ne.patternPositions))}return this.status="done",{buckets:Object.values(Se).filter(Ve=>!Ve.isEmpty()),featureIndex:we,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ue.image,imageAtlas:Ne,glyphMap:this.returnDependencies?bn:null,iconMap:this.returnDependencies?Mn:null,glyphPositions:this.returnDependencies?ue.positions:null}})}}function S(ae,F,O){const q=new h.a8(F);for(const te of ae)te.recalculate(q,O)}class T{constructor(F,O,q){this.actor=F,this.layerIndex=O,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(F,O){return h._(this,void 0,void 0,function*(){const q=yield h.l(F.request,O);try{return{vectorTile:new h.bq.VectorTile(new h.br(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(te){const pe=new Uint8Array(q.data);let we=`Unable to parse the tile at ${F.request.url}, `;throw we+=pe[0]===31&&pe[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${te.messge}`,new Error(we)}})}loadTile(F){return h._(this,void 0,void 0,function*(){const O=F.uid,q=!!(F&&F.request&&F.request.collectResourceTiming)&&new h.bs(F.request),te=new _(F);this.loading[O]=te;const pe=new AbortController;te.abort=pe;try{const we=yield this.loadVectorTile(F,pe);if(delete this.loading[O],!we)return null;const Se=we.rawData,ge={};we.expires&&(ge.expires=we.expires),we.cacheControl&&(ge.cacheControl=we.cacheControl);const Pe={};if(q){const Ke=q.finish();Ke&&(Pe.resourceTiming=JSON.parse(JSON.stringify(Ke)))}te.vectorTile=we.vectorTile;const Ye=te.parse(we.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[O]=te,this.fetching[O]={rawTileData:Se,cacheControl:ge,resourceTiming:Pe};try{const Ke=yield Ye;return h.e({rawTileData:Se.slice(0)},Ke,ge,Pe)}finally{delete this.fetching[O]}}catch(we){throw delete this.loading[O],te.status="done",this.loaded[O]=te,we}})}reloadTile(F){return h._(this,void 0,void 0,function*(){const O=F.uid;if(!this.loaded||!this.loaded[O])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[O];if(q.showCollisionBoxes=F.showCollisionBoxes,q.status==="parsing"){const te=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let pe;if(this.fetching[O]){const{rawTileData:we,cacheControl:Se,resourceTiming:ge}=this.fetching[O];delete this.fetching[O],pe=h.e({rawTileData:we.slice(0)},te,Se,ge)}else pe=te;return pe}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(F){return h._(this,void 0,void 0,function*(){const O=this.loading,q=F.uid;O&&O[q]&&O[q].abort&&(O[q].abort.abort(),delete O[q])})}removeTile(F){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[F.uid]&&delete this.loaded[F.uid]})}}class M{constructor(){this.loaded={}}loadTile(F){return h._(this,void 0,void 0,function*(){const{uid:O,encoding:q,rawImageData:te,redFactor:pe,greenFactor:we,blueFactor:Se,baseShift:ge}=F,Pe=te.width+2,Ye=te.height+2,Ke=h.b(te)?new h.R({width:Pe,height:Ye},yield h.bt(te,-1,-1,Pe,Ye)):te,Xe=new h.bu(O,Ke,q,pe,we,Se,ge);return this.loaded=this.loaded||{},this.loaded[O]=Xe,Xe})}removeTile(F){const O=this.loaded,q=F.uid;O&&O[q]&&delete O[q]}}function I(ae,F){if(ae.length!==0){N(ae[0],F);for(var O=1;O<ae.length;O++)N(ae[O],!F)}}function N(ae,F){for(var O=0,q=0,te=0,pe=ae.length,we=pe-1;te<pe;we=te++){var Se=(ae[te][0]-ae[we][0])*(ae[we][1]+ae[te][1]),ge=O+Se;q+=Math.abs(O)>=Math.abs(Se)?O-ge+Se:Se-ge+O,O=ge}O+q>=0!=!!F&&ae.reverse()}var B=h.bv(function ae(F,O){var q,te=F&&F.type;if(te==="FeatureCollection")for(q=0;q<F.features.length;q++)ae(F.features[q],O);else if(te==="GeometryCollection")for(q=0;q<F.geometries.length;q++)ae(F.geometries[q],O);else if(te==="Feature")ae(F.geometry,O);else if(te==="Polygon")I(F.coordinates,O);else if(te==="MultiPolygon")for(q=0;q<F.coordinates.length;q++)I(F.coordinates[q],O);return F});const k=h.bq.VectorTileFeature.prototype.toGeoJSON;var C={exports:{}},U=h.bw,V=h.bq.VectorTileFeature,Y=he;function he(ae,F){this.options=F||{},this.features=ae,this.length=ae.length}function Z(ae,F){this.id=typeof ae.id=="number"?ae.id:void 0,this.type=ae.type,this.rawGeometry=ae.type===1?[ae.geometry]:ae.geometry,this.properties=ae.tags,this.extent=F||4096}he.prototype.feature=function(ae){return new Z(this.features[ae],this.options.extent)},Z.prototype.loadGeometry=function(){var ae=this.rawGeometry;this.geometry=[];for(var F=0;F<ae.length;F++){for(var O=ae[F],q=[],te=0;te<O.length;te++)q.push(new U(O[te][0],O[te][1]));this.geometry.push(q)}return this.geometry},Z.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ae=this.geometry,F=1/0,O=-1/0,q=1/0,te=-1/0,pe=0;pe<ae.length;pe++)for(var we=ae[pe],Se=0;Se<we.length;Se++){var ge=we[Se];F=Math.min(F,ge.x),O=Math.max(O,ge.x),q=Math.min(q,ge.y),te=Math.max(te,ge.y)}return[F,q,O,te]},Z.prototype.toGeoJSON=V.prototype.toGeoJSON;var ne=h.bx,xe=Y;function ie(ae){var F=new ne;return function(O,q){for(var te in O.layers)q.writeMessage(3,J,O.layers[te])}(ae,F),F.finish()}function J(ae,F){var O;F.writeVarintField(15,ae.version||1),F.writeStringField(1,ae.name||""),F.writeVarintField(5,ae.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(O=0;O<ae.length;O++)q.feature=ae.feature(O),F.writeMessage(2,Te,q);var te=q.keys;for(O=0;O<te.length;O++)F.writeStringField(3,te[O]);var pe=q.values;for(O=0;O<pe.length;O++)F.writeMessage(4,gt,pe[O])}function Te(ae,F){var O=ae.feature;O.id!==void 0&&F.writeVarintField(1,O.id),F.writeMessage(2,Be,ae),F.writeVarintField(3,O.type),F.writeMessage(4,ct,O)}function Be(ae,F){var O=ae.feature,q=ae.keys,te=ae.values,pe=ae.keycache,we=ae.valuecache;for(var Se in O.properties){var ge=O.properties[Se],Pe=pe[Se];if(ge!==null){Pe===void 0&&(q.push(Se),pe[Se]=Pe=q.length-1),F.writeVarint(Pe);var Ye=typeof ge;Ye!=="string"&&Ye!=="boolean"&&Ye!=="number"&&(ge=JSON.stringify(ge));var Ke=Ye+":"+ge,Xe=we[Ke];Xe===void 0&&(te.push(ge),we[Ke]=Xe=te.length-1),F.writeVarint(Xe)}}}function Re(ae,F){return(F<<3)+(7&ae)}function We(ae){return ae<<1^ae>>31}function ct(ae,F){for(var O=ae.loadGeometry(),q=ae.type,te=0,pe=0,we=O.length,Se=0;Se<we;Se++){var ge=O[Se],Pe=1;q===1&&(Pe=ge.length),F.writeVarint(Re(1,Pe));for(var Ye=q===3?ge.length-1:ge.length,Ke=0;Ke<Ye;Ke++){Ke===1&&q!==1&&F.writeVarint(Re(2,Ye-1));var Xe=ge[Ke].x-te,Pt=ge[Ke].y-pe;F.writeVarint(We(Xe)),F.writeVarint(We(Pt)),te+=Xe,pe+=Pt}q===3&&F.writeVarint(Re(7,1))}}function gt(ae,F){var O=typeof ae;O==="string"?F.writeStringField(1,ae):O==="boolean"?F.writeBooleanField(7,ae):O==="number"&&(ae%1!=0?F.writeDoubleField(3,ae):ae<0?F.writeSVarintField(6,ae):F.writeVarintField(5,ae))}C.exports=ie,C.exports.fromVectorTileJs=ie,C.exports.fromGeojsonVt=function(ae,F){F=F||{};var O={};for(var q in ae)O[q]=new xe(ae[q].features,F),O[q].name=q,O[q].version=F.version,O[q].extent=F.extent;return ie({layers:O})},C.exports.GeoJSONWrapper=xe;var ft=h.bv(C.exports);const ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ae=>ae},at=Math.fround||(ot=new Float32Array(1),ae=>(ot[0]=+ae,ot[0]));var ot;const _t=3,kt=5,Cn=6;class it{constructor(F){this.options=Object.assign(Object.create(ke),F),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(F){const{log:O,minZoom:q,maxZoom:te}=this.options;O&&console.time("total time");const pe=`prepare ${F.length} points`;O&&console.time(pe),this.points=F;const we=[];for(let ge=0;ge<F.length;ge++){const Pe=F[ge];if(!Pe.geometry)continue;const[Ye,Ke]=Pe.geometry.coordinates,Xe=at(At(Ye)),Pt=at(Sn(Ke));we.push(Xe,Pt,1/0,ge,-1,1),this.options.reduce&&we.push(0)}let Se=this.trees[te+1]=this._createTree(we);O&&console.timeEnd(pe);for(let ge=te;ge>=q;ge--){const Pe=+Date.now();Se=this.trees[ge]=this._createTree(this._cluster(Se,ge)),O&&console.log("z%d: %d clusters in %dms",ge,Se.numItems,+Date.now()-Pe)}return O&&console.timeEnd("total time"),this}getClusters(F,O){let q=((F[0]+180)%360+360)%360-180;const te=Math.max(-90,Math.min(90,F[1]));let pe=F[2]===180?180:((F[2]+180)%360+360)%360-180;const we=Math.max(-90,Math.min(90,F[3]));if(F[2]-F[0]>=360)q=-180,pe=180;else if(q>pe){const Ke=this.getClusters([q,te,180,we],O),Xe=this.getClusters([-180,te,pe,we],O);return Ke.concat(Xe)}const Se=this.trees[this._limitZoom(O)],ge=Se.range(At(q),Sn(we),At(pe),Sn(te)),Pe=Se.data,Ye=[];for(const Ke of ge){const Xe=this.stride*Ke;Ye.push(Pe[Xe+kt]>1?Mt(Pe,Xe,this.clusterProps):this.points[Pe[Xe+_t]])}return Ye}getChildren(F){const O=this._getOriginId(F),q=this._getOriginZoom(F),te="No cluster with the specified id.",pe=this.trees[q];if(!pe)throw new Error(te);const we=pe.data;if(O*this.stride>=we.length)throw new Error(te);const Se=this.options.radius/(this.options.extent*Math.pow(2,q-1)),ge=pe.within(we[O*this.stride],we[O*this.stride+1],Se),Pe=[];for(const Ye of ge){const Ke=Ye*this.stride;we[Ke+4]===F&&Pe.push(we[Ke+kt]>1?Mt(we,Ke,this.clusterProps):this.points[we[Ke+_t]])}if(Pe.length===0)throw new Error(te);return Pe}getLeaves(F,O,q){const te=[];return this._appendLeaves(te,F,O=O||10,q=q||0,0),te}getTile(F,O,q){const te=this.trees[this._limitZoom(F)],pe=Math.pow(2,F),{extent:we,radius:Se}=this.options,ge=Se/we,Pe=(q-ge)/pe,Ye=(q+1+ge)/pe,Ke={features:[]};return this._addTileFeatures(te.range((O-ge)/pe,Pe,(O+1+ge)/pe,Ye),te.data,O,q,pe,Ke),O===0&&this._addTileFeatures(te.range(1-ge/pe,Pe,1,Ye),te.data,pe,q,pe,Ke),O===pe-1&&this._addTileFeatures(te.range(0,Pe,ge/pe,Ye),te.data,-1,q,pe,Ke),Ke.features.length?Ke:null}getClusterExpansionZoom(F){let O=this._getOriginZoom(F)-1;for(;O<=this.options.maxZoom;){const q=this.getChildren(F);if(O++,q.length!==1)break;F=q[0].properties.cluster_id}return O}_appendLeaves(F,O,q,te,pe){const we=this.getChildren(O);for(const Se of we){const ge=Se.properties;if(ge&&ge.cluster?pe+ge.point_count<=te?pe+=ge.point_count:pe=this._appendLeaves(F,ge.cluster_id,q,te,pe):pe<te?pe++:F.push(Se),F.length===q)break}return pe}_createTree(F){const O=new h.au(F.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<F.length;q+=this.stride)O.add(F[q],F[q+1]);return O.finish(),O.data=F,O}_addTileFeatures(F,O,q,te,pe,we){for(const Se of F){const ge=Se*this.stride,Pe=O[ge+kt]>1;let Ye,Ke,Xe;if(Pe)Ye=Ft(O,ge,this.clusterProps),Ke=O[ge],Xe=O[ge+1];else{const an=this.points[O[ge+_t]];Ye=an.properties;const[bn,Mn]=an.geometry.coordinates;Ke=At(bn),Xe=Sn(Mn)}const Pt={type:1,geometry:[[Math.round(this.options.extent*(Ke*pe-q)),Math.round(this.options.extent*(Xe*pe-te))]],tags:Ye};let en;en=Pe||this.options.generateId?O[ge+_t]:this.points[O[ge+_t]].id,en!==void 0&&(Pt.id=en),we.features.push(Pt)}}_limitZoom(F){return Math.max(this.options.minZoom,Math.min(Math.floor(+F),this.options.maxZoom+1))}_cluster(F,O){const{radius:q,extent:te,reduce:pe,minPoints:we}=this.options,Se=q/(te*Math.pow(2,O)),ge=F.data,Pe=[],Ye=this.stride;for(let Ke=0;Ke<ge.length;Ke+=Ye){if(ge[Ke+2]<=O)continue;ge[Ke+2]=O;const Xe=ge[Ke],Pt=ge[Ke+1],en=F.within(ge[Ke],ge[Ke+1],Se),an=ge[Ke+kt];let bn=an;for(const Mn of en){const sr=Mn*Ye;ge[sr+2]>O&&(bn+=ge[sr+kt])}if(bn>an&&bn>=we){let Mn,sr=Xe*an,ue=Pt*an,Ne=-1;const Ve=((Ke/Ye|0)<<5)+(O+1)+this.points.length;for(const $e of en){const Ze=$e*Ye;if(ge[Ze+2]<=O)continue;ge[Ze+2]=O;const Lt=ge[Ze+kt];sr+=ge[Ze]*Lt,ue+=ge[Ze+1]*Lt,ge[Ze+4]=Ve,pe&&(Mn||(Mn=this._map(ge,Ke,!0),Ne=this.clusterProps.length,this.clusterProps.push(Mn)),pe(Mn,this._map(ge,Ze)))}ge[Ke+4]=Ve,Pe.push(sr/bn,ue/bn,1/0,Ve,-1,bn),pe&&Pe.push(Ne)}else{for(let Mn=0;Mn<Ye;Mn++)Pe.push(ge[Ke+Mn]);if(bn>1)for(const Mn of en){const sr=Mn*Ye;if(!(ge[sr+2]<=O)){ge[sr+2]=O;for(let ue=0;ue<Ye;ue++)Pe.push(ge[sr+ue])}}}}return Pe}_getOriginId(F){return F-this.points.length>>5}_getOriginZoom(F){return(F-this.points.length)%32}_map(F,O,q){if(F[O+kt]>1){const we=this.clusterProps[F[O+Cn]];return q?Object.assign({},we):we}const te=this.points[F[O+_t]].properties,pe=this.options.map(te);return q&&pe===te?Object.assign({},pe):pe}}function Mt(ae,F,O){return{type:"Feature",id:ae[F+_t],properties:Ft(ae,F,O),geometry:{type:"Point",coordinates:[(q=ae[F],360*(q-.5)),Dn(ae[F+1])]}};var q}function Ft(ae,F,O){const q=ae[F+kt],te=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,pe=ae[F+Cn],we=pe===-1?{}:Object.assign({},O[pe]);return Object.assign(we,{cluster:!0,cluster_id:ae[F+_t],point_count:q,point_count_abbreviated:te})}function At(ae){return ae/360+.5}function Sn(ae){const F=Math.sin(ae*Math.PI/180),O=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return O<0?0:O>1?1:O}function Dn(ae){const F=(180-360*ae)*Math.PI/180;return 360*Math.atan(Math.exp(F))/Math.PI-90}function qe(ae,F,O,q){for(var te,pe=q,we=O-F>>1,Se=O-F,ge=ae[F],Pe=ae[F+1],Ye=ae[O],Ke=ae[O+1],Xe=F+3;Xe<O;Xe+=3){var Pt=Nn(ae[Xe],ae[Xe+1],ge,Pe,Ye,Ke);if(Pt>pe)te=Xe,pe=Pt;else if(Pt===pe){var en=Math.abs(Xe-we);en<Se&&(te=Xe,Se=en)}}pe>q&&(te-F>3&&qe(ae,F,te,q),ae[te+2]=pe,O-te>3&&qe(ae,te,O,q))}function Nn(ae,F,O,q,te,pe){var we=te-O,Se=pe-q;if(we!==0||Se!==0){var ge=((ae-O)*we+(F-q)*Se)/(we*we+Se*Se);ge>1?(O=te,q=pe):ge>0&&(O+=we*ge,q+=Se*ge)}return(we=ae-O)*we+(Se=F-q)*Se}function hn(ae,F,O,q){var te={id:ae===void 0?null:ae,type:F,geometry:O,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(pe){var we=pe.geometry,Se=pe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")Gn(pe,we);else if(Se==="Polygon"||Se==="MultiLineString")for(var ge=0;ge<we.length;ge++)Gn(pe,we[ge]);else if(Se==="MultiPolygon")for(ge=0;ge<we.length;ge++)for(var Pe=0;Pe<we[ge].length;Pe++)Gn(pe,we[ge][Pe])}(te),te}function Gn(ae,F){for(var O=0;O<F.length;O+=3)ae.minX=Math.min(ae.minX,F[O]),ae.minY=Math.min(ae.minY,F[O+1]),ae.maxX=Math.max(ae.maxX,F[O]),ae.maxY=Math.max(ae.maxY,F[O+1])}function gn(ae,F,O,q){if(F.geometry){var te=F.geometry.coordinates,pe=F.geometry.type,we=Math.pow(O.tolerance/((1<<O.maxZoom)*O.extent),2),Se=[],ge=F.id;if(O.promoteId?ge=F.properties[O.promoteId]:O.generateId&&(ge=q||0),pe==="Point")un(te,Se);else if(pe==="MultiPoint")for(var Pe=0;Pe<te.length;Pe++)un(te[Pe],Se);else if(pe==="LineString")Pn(te,Se,we,!1);else if(pe==="MultiLineString"){if(O.lineMetrics){for(Pe=0;Pe<te.length;Pe++)Pn(te[Pe],Se=[],we,!1),ae.push(hn(ge,"LineString",Se,F.properties));return}je(te,Se,we,!1)}else if(pe==="Polygon")je(te,Se,we,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(Pe=0;Pe<F.geometry.geometries.length;Pe++)gn(ae,{id:ge,geometry:F.geometry.geometries[Pe],properties:F.properties},O,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Pe=0;Pe<te.length;Pe++){var Ye=[];je(te[Pe],Ye,we,!0),Se.push(Ye)}}ae.push(hn(ge,pe,Se,F.properties))}}function un(ae,F){F.push(qn(ae[0])),F.push(Ae(ae[1])),F.push(0)}function Pn(ae,F,O,q){for(var te,pe,we=0,Se=0;Se<ae.length;Se++){var ge=qn(ae[Se][0]),Pe=Ae(ae[Se][1]);F.push(ge),F.push(Pe),F.push(0),Se>0&&(we+=q?(te*Pe-ge*pe)/2:Math.sqrt(Math.pow(ge-te,2)+Math.pow(Pe-pe,2))),te=ge,pe=Pe}var Ye=F.length-3;F[2]=1,qe(F,0,Ye,O),F[Ye+2]=1,F.size=Math.abs(we),F.start=0,F.end=F.size}function je(ae,F,O,q){for(var te=0;te<ae.length;te++){var pe=[];Pn(ae[te],pe,O,q),F.push(pe)}}function qn(ae){return ae/360+.5}function Ae(ae){var F=Math.sin(ae*Math.PI/180),O=.5-.25*Math.log((1+F)/(1-F))/Math.PI;return O<0?0:O>1?1:O}function se(ae,F,O,q,te,pe,we,Se){if(q/=F,pe>=(O/=F)&&we<q)return ae;if(we<O||pe>=q)return null;for(var ge=[],Pe=0;Pe<ae.length;Pe++){var Ye=ae[Pe],Ke=Ye.geometry,Xe=Ye.type,Pt=te===0?Ye.minX:Ye.minY,en=te===0?Ye.maxX:Ye.maxY;if(Pt>=O&&en<q)ge.push(Ye);else if(!(en<O||Pt>=q)){var an=[];if(Xe==="Point"||Xe==="MultiPoint")tt(Ke,an,O,q,te);else if(Xe==="LineString")vt(Ke,an,O,q,te,!1,Se.lineMetrics);else if(Xe==="MultiLineString")wt(Ke,an,O,q,te,!1);else if(Xe==="Polygon")wt(Ke,an,O,q,te,!0);else if(Xe==="MultiPolygon")for(var bn=0;bn<Ke.length;bn++){var Mn=[];wt(Ke[bn],Mn,O,q,te,!0),Mn.length&&an.push(Mn)}if(an.length){if(Se.lineMetrics&&Xe==="LineString"){for(bn=0;bn<an.length;bn++)ge.push(hn(Ye.id,Xe,an[bn],Ye.tags));continue}Xe!=="LineString"&&Xe!=="MultiLineString"||(an.length===1?(Xe="LineString",an=an[0]):Xe="MultiLineString"),Xe!=="Point"&&Xe!=="MultiPoint"||(Xe=an.length===3?"Point":"MultiPoint"),ge.push(hn(Ye.id,Xe,an,Ye.tags))}}}return ge.length?ge:null}function tt(ae,F,O,q,te){for(var pe=0;pe<ae.length;pe+=3){var we=ae[pe+te];we>=O&&we<=q&&(F.push(ae[pe]),F.push(ae[pe+1]),F.push(ae[pe+2]))}}function vt(ae,F,O,q,te,pe,we){for(var Se,ge,Pe=Tt(ae),Ye=te===0?Gt:Ht,Ke=ae.start,Xe=0;Xe<ae.length-3;Xe+=3){var Pt=ae[Xe],en=ae[Xe+1],an=ae[Xe+2],bn=ae[Xe+3],Mn=ae[Xe+4],sr=te===0?Pt:en,ue=te===0?bn:Mn,Ne=!1;we&&(Se=Math.sqrt(Math.pow(Pt-bn,2)+Math.pow(en-Mn,2))),sr<O?ue>O&&(ge=Ye(Pe,Pt,en,bn,Mn,O),we&&(Pe.start=Ke+Se*ge)):sr>q?ue<q&&(ge=Ye(Pe,Pt,en,bn,Mn,q),we&&(Pe.start=Ke+Se*ge)):pn(Pe,Pt,en,an),ue<O&&sr>=O&&(ge=Ye(Pe,Pt,en,bn,Mn,O),Ne=!0),ue>q&&sr<=q&&(ge=Ye(Pe,Pt,en,bn,Mn,q),Ne=!0),!pe&&Ne&&(we&&(Pe.end=Ke+Se*ge),F.push(Pe),Pe=Tt(ae)),we&&(Ke+=Se)}var Ve=ae.length-3;Pt=ae[Ve],en=ae[Ve+1],an=ae[Ve+2],(sr=te===0?Pt:en)>=O&&sr<=q&&pn(Pe,Pt,en,an),Ve=Pe.length-3,pe&&Ve>=3&&(Pe[Ve]!==Pe[0]||Pe[Ve+1]!==Pe[1])&&pn(Pe,Pe[0],Pe[1],Pe[2]),Pe.length&&F.push(Pe)}function Tt(ae){var F=[];return F.size=ae.size,F.start=ae.start,F.end=ae.end,F}function wt(ae,F,O,q,te,pe){for(var we=0;we<ae.length;we++)vt(ae[we],F,O,q,te,pe,!1)}function pn(ae,F,O,q){ae.push(F),ae.push(O),ae.push(q)}function Gt(ae,F,O,q,te,pe){var we=(pe-F)/(q-F);return ae.push(pe),ae.push(O+(te-O)*we),ae.push(1),we}function Ht(ae,F,O,q,te,pe){var we=(pe-O)/(te-O);return ae.push(F+(q-F)*we),ae.push(pe),ae.push(1),we}function Ln(ae,F){for(var O=[],q=0;q<ae.length;q++){var te,pe=ae[q],we=pe.type;if(we==="Point"||we==="MultiPoint"||we==="LineString")te=He(pe.geometry,F);else if(we==="MultiLineString"||we==="Polygon"){te=[];for(var Se=0;Se<pe.geometry.length;Se++)te.push(He(pe.geometry[Se],F))}else if(we==="MultiPolygon")for(te=[],Se=0;Se<pe.geometry.length;Se++){for(var ge=[],Pe=0;Pe<pe.geometry[Se].length;Pe++)ge.push(He(pe.geometry[Se][Pe],F));te.push(ge)}O.push(hn(pe.id,we,te,pe.tags))}return O}function He(ae,F){var O=[];O.size=ae.size,ae.start!==void 0&&(O.start=ae.start,O.end=ae.end);for(var q=0;q<ae.length;q+=3)O.push(ae[q]+F,ae[q+1],ae[q+2]);return O}function on(ae,F){if(ae.transformed)return ae;var O,q,te,pe=1<<ae.z,we=ae.x,Se=ae.y;for(O=0;O<ae.features.length;O++){var ge=ae.features[O],Pe=ge.geometry,Ye=ge.type;if(ge.geometry=[],Ye===1)for(q=0;q<Pe.length;q+=2)ge.geometry.push(Rn(Pe[q],Pe[q+1],F,pe,we,Se));else for(q=0;q<Pe.length;q++){var Ke=[];for(te=0;te<Pe[q].length;te+=2)Ke.push(Rn(Pe[q][te],Pe[q][te+1],F,pe,we,Se));ge.geometry.push(Ke)}}return ae.transformed=!0,ae}function Rn(ae,F,O,q,te,pe){return[Math.round(O*(ae*q-te)),Math.round(O*(F*q-pe))]}function xn(ae,F,O,q,te){for(var pe=F===te.maxZoom?0:te.tolerance/((1<<F)*te.extent),we={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:O,y:q,z:F,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<ae.length;Se++){we.numFeatures++,Qt(we,ae[Se],pe,te);var ge=ae[Se].minX,Pe=ae[Se].minY,Ye=ae[Se].maxX,Ke=ae[Se].maxY;ge<we.minX&&(we.minX=ge),Pe<we.minY&&(we.minY=Pe),Ye>we.maxX&&(we.maxX=Ye),Ke>we.maxY&&(we.maxY=Ke)}return we}function Qt(ae,F,O,q){var te=F.geometry,pe=F.type,we=[];if(pe==="Point"||pe==="MultiPoint")for(var Se=0;Se<te.length;Se+=3)we.push(te[Se]),we.push(te[Se+1]),ae.numPoints++,ae.numSimplified++;else if(pe==="LineString")lt(we,te,ae,O,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(Se=0;Se<te.length;Se++)lt(we,te[Se],ae,O,pe==="Polygon",Se===0);else if(pe==="MultiPolygon")for(var ge=0;ge<te.length;ge++){var Pe=te[ge];for(Se=0;Se<Pe.length;Se++)lt(we,Pe[Se],ae,O,!0,Se===0)}if(we.length){var Ye=F.tags||null;if(pe==="LineString"&&q.lineMetrics){for(var Ke in Ye={},F.tags)Ye[Ke]=F.tags[Ke];Ye.mapbox_clip_start=te.start/te.size,Ye.mapbox_clip_end=te.end/te.size}var Xe={geometry:we,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ye};F.id!==null&&(Xe.id=F.id),ae.features.push(Xe)}}function lt(ae,F,O,q,te,pe){var we=q*q;if(q>0&&F.size<(te?we:q))O.numPoints+=F.length/3;else{for(var Se=[],ge=0;ge<F.length;ge+=3)(q===0||F[ge+2]>we)&&(O.numSimplified++,Se.push(F[ge]),Se.push(F[ge+1])),O.numPoints++;te&&function(Pe,Ye){for(var Ke=0,Xe=0,Pt=Pe.length,en=Pt-2;Xe<Pt;en=Xe,Xe+=2)Ke+=(Pe[Xe]-Pe[en])*(Pe[Xe+1]+Pe[en+1]);if(Ke>0===Ye)for(Xe=0,Pt=Pe.length;Xe<Pt/2;Xe+=2){var an=Pe[Xe],bn=Pe[Xe+1];Pe[Xe]=Pe[Pt-2-Xe],Pe[Xe+1]=Pe[Pt-1-Xe],Pe[Pt-2-Xe]=an,Pe[Pt-1-Xe]=bn}}(Se,pe),ae.push(Se)}}function Ut(ae,F){var O=(F=this.options=function(te,pe){for(var we in pe)te[we]=pe[we];return te}(Object.create(this.options),F)).debug;if(O&&console.time("preprocess data"),F.maxZoom<0||F.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(F.promoteId&&F.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(te,pe){var we=[];if(te.type==="FeatureCollection")for(var Se=0;Se<te.features.length;Se++)gn(we,te.features[Se],pe,Se);else gn(we,te.type==="Feature"?te:{geometry:te},pe);return we}(ae,F);this.tiles={},this.tileCoords=[],O&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",F.indexMaxZoom,F.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(te,pe){var we=pe.buffer/pe.extent,Se=te,ge=se(te,1,-1-we,we,0,-1,2,pe),Pe=se(te,1,1-we,2+we,0,-1,2,pe);return(ge||Pe)&&(Se=se(te,1,-we,1+we,0,-1,2,pe)||[],ge&&(Se=Ln(ge,1).concat(Se)),Pe&&(Se=Se.concat(Ln(Pe,-1)))),Se}(q,F),q.length&&this.splitTile(q,0,0,0),O&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Zt(ae,F,O){return 32*((1<<ae)*O+F)+ae}function yn(ae,F){return F?ae.properties[F]:ae.id}function Q(ae,F){if(ae==null)return!0;if(ae.type==="Feature")return yn(ae,F)!=null;if(ae.type==="FeatureCollection"){const O=new Set;for(const q of ae.features){const te=yn(q,F);if(te==null||O.has(te))return!1;O.add(te)}return!0}return!1}function ze(ae,F){const O=new Map;if(ae!=null)if(ae.type==="Feature")O.set(yn(ae,F),ae);else for(const q of ae.features)O.set(yn(q,F),q);return O}Ut.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ut.prototype.splitTile=function(ae,F,O,q,te,pe,we){for(var Se=[ae,F,O,q],ge=this.options,Pe=ge.debug;Se.length;){q=Se.pop(),O=Se.pop(),F=Se.pop(),ae=Se.pop();var Ye=1<<F,Ke=Zt(F,O,q),Xe=this.tiles[Ke];if(!Xe&&(Pe>1&&console.time("creation"),Xe=this.tiles[Ke]=xn(ae,F,O,q,ge),this.tileCoords.push({z:F,x:O,y:q}),Pe)){Pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",F,O,q,Xe.numFeatures,Xe.numPoints,Xe.numSimplified),console.timeEnd("creation"));var Pt="z"+F;this.stats[Pt]=(this.stats[Pt]||0)+1,this.total++}if(Xe.source=ae,te){if(F===ge.maxZoom||F===te)continue;var en=1<<te-F;if(O!==Math.floor(pe/en)||q!==Math.floor(we/en))continue}else if(F===ge.indexMaxZoom||Xe.numPoints<=ge.indexMaxPoints)continue;if(Xe.source=null,ae.length!==0){Pe>1&&console.time("clipping");var an,bn,Mn,sr,ue,Ne,Ve=.5*ge.buffer/ge.extent,$e=.5-Ve,Ze=.5+Ve,Lt=1+Ve;an=bn=Mn=sr=null,ue=se(ae,Ye,O-Ve,O+Ze,0,Xe.minX,Xe.maxX,ge),Ne=se(ae,Ye,O+$e,O+Lt,0,Xe.minX,Xe.maxX,ge),ae=null,ue&&(an=se(ue,Ye,q-Ve,q+Ze,1,Xe.minY,Xe.maxY,ge),bn=se(ue,Ye,q+$e,q+Lt,1,Xe.minY,Xe.maxY,ge),ue=null),Ne&&(Mn=se(Ne,Ye,q-Ve,q+Ze,1,Xe.minY,Xe.maxY,ge),sr=se(Ne,Ye,q+$e,q+Lt,1,Xe.minY,Xe.maxY,ge),Ne=null),Pe>1&&console.timeEnd("clipping"),Se.push(an||[],F+1,2*O,2*q),Se.push(bn||[],F+1,2*O,2*q+1),Se.push(Mn||[],F+1,2*O+1,2*q),Se.push(sr||[],F+1,2*O+1,2*q+1)}}},Ut.prototype.getTile=function(ae,F,O){var q=this.options,te=q.extent,pe=q.debug;if(ae<0||ae>24)return null;var we=1<<ae,Se=Zt(ae,F=(F%we+we)%we,O);if(this.tiles[Se])return on(this.tiles[Se],te);pe>1&&console.log("drilling down to z%d-%d-%d",ae,F,O);for(var ge,Pe=ae,Ye=F,Ke=O;!ge&&Pe>0;)Pe--,Ye=Math.floor(Ye/2),Ke=Math.floor(Ke/2),ge=this.tiles[Zt(Pe,Ye,Ke)];return ge&&ge.source?(pe>1&&console.log("found parent tile z%d-%d-%d",Pe,Ye,Ke),pe>1&&console.time("drilling down"),this.splitTile(ge.source,Pe,Ye,Ke,ae,F,O),pe>1&&console.timeEnd("drilling down"),this.tiles[Se]?on(this.tiles[Se],te):null):null};class Qe extends T{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(F,O){return h._(this,void 0,void 0,function*(){const q=F.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const te=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!te)return null;const pe=new class{constructor(Se){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.W,this.length=Se.length,this._features=Se}feature(Se){return new class{constructor(ge){this._feature=ge,this.extent=h.W,this.type=ge.type,this.properties=ge.tags,"id"in ge&&!isNaN(ge.id)&&(this.id=parseInt(ge.id,10))}loadGeometry(){if(this._feature.type===1){const ge=[];for(const Pe of this._feature.geometry)ge.push([new h.P(Pe[0],Pe[1])]);return ge}{const ge=[];for(const Pe of this._feature.geometry){const Ye=[];for(const Ke of Pe)Ye.push(new h.P(Ke[0],Ke[1]));ge.push(Ye)}return ge}}toGeoJSON(ge,Pe,Ye){return k.call(this,ge,Pe,Ye)}}(this._features[Se])}}(te.features);let we=ft(pe);return we.byteOffset===0&&we.byteLength===we.buffer.byteLength||(we=new Uint8Array(we)),{vectorTile:pe,rawData:we.buffer}})}loadData(F){return h._(this,void 0,void 0,function*(){var O;(O=this._pendingRequest)===null||O===void 0||O.abort();const q=!!(F&&F.request&&F.request.collectResourceTiming)&&new h.bs(F.request);this._pendingRequest=new AbortController;try{let te=yield this.loadGeoJSON(F,this._pendingRequest);if(delete this._pendingRequest,typeof te!="object")throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(B(te,!0),F.filter){const we=h.by(F.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(we.result==="error")throw new Error(we.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));te={type:"FeatureCollection",features:te.features.filter(ge=>we.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=F.cluster?new it(function({superclusterOptions:we,clusterProperties:Se}){if(!Se||!we)return we;const ge={},Pe={},Ye={accumulated:null,zoom:0},Ke={properties:null},Xe=Object.keys(Se);for(const Pt of Xe){const[en,an]=Se[Pt],bn=h.by(an),Mn=h.by(typeof en=="string"?[en,["accumulated"],["get",Pt]]:en);ge[Pt]=bn.value,Pe[Pt]=Mn.value}return we.map=Pt=>{Ke.properties=Pt;const en={};for(const an of Xe)en[an]=ge[an].evaluate(Ye,Ke);return en},we.reduce=(Pt,en)=>{Ke.properties=en;for(const an of Xe)Ye.accumulated=Pt[an],Pt[an]=Pe[an].evaluate(Ye,Ke)},we}(F)).load(te.features):function(we,Se){return new Ut(we,Se)}(te,F.geojsonVtOptions),this.loaded={};const pe={};if(q){const we=q.finish();we&&(pe.resourceTiming={},pe.resourceTiming[F.source]=JSON.parse(JSON.stringify(we)))}return pe}catch(te){if(delete this._pendingRequest,h.bz(te))return{abandoned:!0};throw te}})}reloadTile(F){const O=this.loaded;return O&&O[F.uid]?super.reloadTile(F):this.loadTile(F)}loadGeoJSON(F,O){return h._(this,void 0,void 0,function*(){const{promoteId:q}=F;if(F.request){const te=yield h.h(F.request,O);return this._dataUpdateable=Q(te.data,q)?ze(te.data,q):void 0,te.data}if(typeof F.data=="string")try{const te=JSON.parse(F.data);return this._dataUpdateable=Q(te,q)?ze(te,q):void 0,te}catch{throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`)}if(!F.dataDiff)throw new Error(`Input data given to '${F.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${F.source}`);return function(te,pe,we){var Se,ge,Pe,Ye;if(pe.removeAll&&te.clear(),pe.remove)for(const Ke of pe.remove)te.delete(Ke);if(pe.add)for(const Ke of pe.add){const Xe=yn(Ke,we);Xe!=null&&te.set(Xe,Ke)}if(pe.update)for(const Ke of pe.update){let Xe=te.get(Ke.id);if(Xe==null)continue;const Pt=!Ke.removeAllProperties&&(((Se=Ke.removeProperties)===null||Se===void 0?void 0:Se.length)>0||((ge=Ke.addOrUpdateProperties)===null||ge===void 0?void 0:ge.length)>0);if((Ke.newGeometry||Ke.removeAllProperties||Pt)&&(Xe=Object.assign({},Xe),te.set(Ke.id,Xe),Pt&&(Xe.properties=Object.assign({},Xe.properties))),Ke.newGeometry&&(Xe.geometry=Ke.newGeometry),Ke.removeAllProperties)Xe.properties={};else if(((Pe=Ke.removeProperties)===null||Pe===void 0?void 0:Pe.length)>0)for(const en of Ke.removeProperties)Object.prototype.hasOwnProperty.call(Xe.properties,en)&&delete Xe.properties[en];if(((Ye=Ke.addOrUpdateProperties)===null||Ye===void 0?void 0:Ye.length)>0)for(const{key:en,value:an}of Ke.addOrUpdateProperties)Xe.properties[en]=an}}(this._dataUpdateable,F.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(F){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(F){return this._geoJSONIndex.getClusterExpansionZoom(F.clusterId)}getClusterChildren(F){return this._geoJSONIndex.getChildren(F.clusterId)}getClusterLeaves(F){return this._geoJSONIndex.getLeaves(F.clusterId,F.limit,F.offset)}}class bt{constructor(F){this.self=F,this.actor=new h.C(F),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(O,q)=>{if(this.externalWorkerSourceTypes[O])throw new Error(`Worker source with name "${O}" already registered.`);this.externalWorkerSourceTypes[O]=q},this.self.addProtocol=h.bf,this.self.removeProtocol=h.bg,this.self.registerRTLTextPlugin=O=>{if(h.bA.isParsed())throw new Error("RTL text plugin already registered.");h.bA.setMethods(O)},this.actor.registerMessageHandler("loadDEMTile",(O,q)=>this._getDEMWorkerSource(O,q.source).loadTile(q)),this.actor.registerMessageHandler("removeDEMTile",(O,q)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource(O,q.source).removeTile(q)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(O,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(O,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("getClusterChildren",(O,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(O,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("getClusterLeaves",(O,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(O,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("loadData",(O,q)=>this._getWorkerSource(O,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("loadTile",(O,q)=>this._getWorkerSource(O,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("reloadTile",(O,q)=>this._getWorkerSource(O,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("abortTile",(O,q)=>this._getWorkerSource(O,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("removeTile",(O,q)=>this._getWorkerSource(O,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("removeSource",(O,q)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[O]||!this.workerSources[O][q.type]||!this.workerSources[O][q.type][q.source])return;const te=this.workerSources[O][q.type][q.source];delete this.workerSources[O][q.type][q.source],te.removeSource!==void 0&&te.removeSource(q)})),this.actor.registerMessageHandler("removeMap",O=>h._(this,void 0,void 0,function*(){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O]})),this.actor.registerMessageHandler("setReferrer",(O,q)=>h._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("syncRTLPluginState",(O,q)=>this._syncRTLPluginState(O,q)),this.actor.registerMessageHandler("importScript",(O,q)=>h._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("setImages",(O,q)=>this._setImages(O,q)),this.actor.registerMessageHandler("updateLayers",(O,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(O).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("setLayers",(O,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(O).replace(q)}))}_setImages(F,O){return h._(this,void 0,void 0,function*(){this.availableImages[F]=O;for(const q in this.workerSources[F]){const te=this.workerSources[F][q];for(const pe in te)te[pe].availableImages=O}})}_syncRTLPluginState(F,O){return h._(this,void 0,void 0,function*(){if(h.bA.isParsed())return h.bA.getState();if(O.pluginStatus!=="loading")return h.bA.setState(O),O;const q=O.pluginURL;if(this.self.importScripts(q),h.bA.isParsed()){const te={pluginStatus:"loaded",pluginURL:q};return h.bA.setState(te),te}throw h.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(F){let O=this.availableImages[F];return O||(O=[]),O}_getLayerIndex(F){let O=this.layerIndexes[F];return O||(O=this.layerIndexes[F]=new l),O}_getWorkerSource(F,O,q){if(this.workerSources[F]||(this.workerSources[F]={}),this.workerSources[F][O]||(this.workerSources[F][O]={}),!this.workerSources[F][O][q]){const te={sendAsync:(pe,we)=>(pe.targetMapId=F,this.actor.sendAsync(pe,we))};switch(O){case"vector":this.workerSources[F][O][q]=new T(te,this._getLayerIndex(F),this._getAvailableImages(F));break;case"geojson":this.workerSources[F][O][q]=new Qe(te,this._getLayerIndex(F),this._getAvailableImages(F));break;default:this.workerSources[F][O][q]=new this.externalWorkerSourceTypes[O](te,this._getLayerIndex(F),this._getAvailableImages(F))}}return this.workerSources[F][O][q]}_getDEMWorkerSource(F,O){return this.demWorkerSources[F]||(this.demWorkerSources[F]={}),this.demWorkerSources[F][O]||(this.demWorkerSources[F][O]=new M),this.demWorkerSources[F][O]}}return h.i(self)&&(self.worker=new bt(self)),bt}),s("index",["exports","./shared"],function(h,l){var m="4.1.2";let _,S;const T={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:y=>new Promise((a,d)=>{const p=requestAnimationFrame(a);y.signal.addEventListener("abort",()=>{cancelAnimationFrame(p),d(l.c())})}),getImageData(y,a=0){return this.getImageCanvasContext(y).getImageData(-a,-a,y.width+2*a,y.height+2*a)},getImageCanvasContext(y){const a=window.document.createElement("canvas"),d=a.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return a.width=y.width,a.height=y.height,d.drawImage(y,0,0,y.width,y.height),d},resolveURL:y=>(_||(_=document.createElement("a")),_.href=y,_.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(S==null&&(S=matchMedia("(prefers-reduced-motion: reduce)")),S.matches)}};class M{static testProp(a){if(!M.docStyle)return a[0];for(let d=0;d<a.length;d++)if(a[d]in M.docStyle)return a[d];return a[0]}static create(a,d,p){const g=window.document.createElement(a);return d!==void 0&&(g.className=d),p&&p.appendChild(g),g}static createNS(a,d){return window.document.createElementNS(a,d)}static disableDrag(){M.docStyle&&M.selectProp&&(M.userSelect=M.docStyle[M.selectProp],M.docStyle[M.selectProp]="none")}static enableDrag(){M.docStyle&&M.selectProp&&(M.docStyle[M.selectProp]=M.userSelect)}static setTransform(a,d){a.style[M.transformProp]=d}static addEventListener(a,d,p,g={}){a.addEventListener(d,p,"passive"in g?g:g.capture)}static removeEventListener(a,d,p,g={}){a.removeEventListener(d,p,"passive"in g?g:g.capture)}static suppressClickInternal(a){a.preventDefault(),a.stopPropagation(),window.removeEventListener("click",M.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",M.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",M.suppressClickInternal,!0)},0)}static getScale(a){const d=a.getBoundingClientRect();return{x:d.width/a.offsetWidth||1,y:d.height/a.offsetHeight||1,boundingClientRect:d}}static getPoint(a,d,p){const g=d.boundingClientRect;return new l.P((p.clientX-g.left)/d.x-a.clientLeft,(p.clientY-g.top)/d.y-a.clientTop)}static mousePos(a,d){const p=M.getScale(a);return M.getPoint(a,p,d)}static touchPos(a,d){const p=[],g=M.getScale(a);for(let x=0;x<d.length;x++)p.push(M.getPoint(a,g,d[x]));return p}static mouseButton(a){return a.button}static remove(a){a.parentNode&&a.parentNode.removeChild(a)}}M.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,M.selectProp=M.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),M.transformProp=M.testProp(["transform","WebkitTransform"]);const I={supported:!1,testSupport:function(y){!k&&B&&(C?U(y):N=y)}};let N,B,k=!1,C=!1;function U(y){const a=y.createTexture();y.bindTexture(y.TEXTURE_2D,a);try{if(y.texImage2D(y.TEXTURE_2D,0,y.RGBA,y.RGBA,y.UNSIGNED_BYTE,B),y.isContextLost())return;I.supported=!0}catch{}y.deleteTexture(a),k=!0}var V,Y;typeof document<"u"&&(B=document.createElement("img"),B.onload=function(){N&&U(N),N=null,C=!0},B.onerror=function(){k=!0,N=null},B.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(y){let a,d,p,g;y.resetRequestQueue=()=>{a=[],d=0,p=0,g={}},y.addThrottleControl=D=>{const H=p++;return g[H]=D,H},y.removeThrottleControl=D=>{delete g[D],A()},y.getImage=(D,H,$=!0)=>new Promise((X,oe)=>{I.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),l.e(D,{type:"image"}),a.push({abortController:H,requestParameters:D,supportImageRefresh:$,state:"queued",onError:ye=>{oe(ye)},onSuccess:ye=>{X(ye)}}),A()});const x=D=>l._(this,void 0,void 0,function*(){D.state="running";const{requestParameters:H,supportImageRefresh:$,onError:X,onSuccess:oe,abortController:ye}=D,ve=$===!1&&!l.i(self)&&!l.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((Le,Je)=>Le&&Je==="accept",!0));d++;const be=ve?P(H,ye):l.m(H,ye);try{const Le=yield be;delete D.abortController,D.state="completed",Le.data instanceof HTMLImageElement||l.b(Le.data)?oe(Le):Le.data&&oe({data:yield(de=Le.data,typeof createImageBitmap=="function"?l.d(de):l.f(de)),cacheControl:Le.cacheControl,expires:Le.expires})}catch(Le){delete D.abortController,X(Le)}finally{d--,A()}var de}),A=()=>{const D=(()=>{for(const H of Object.keys(g))if(g[H]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=d;H<D&&a.length>0;H++){const $=a.shift();$.abortController.signal.aborted?H--:x($)}},P=(D,H)=>new Promise(($,X)=>{const oe=new Image,ye=D.url,ve=D.credentials;ve&&ve==="include"?oe.crossOrigin="use-credentials":(ve&&ve==="same-origin"||!l.s(ye))&&(oe.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{oe.src="",X(l.c())}),oe.fetchPriority="high",oe.onload=()=>{oe.onerror=oe.onload=null,$({data:oe})},oe.onerror=()=>{oe.onerror=oe.onload=null,H.signal.aborted||X(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},oe.src=ye})}(V||(V={})),V.resetRequestQueue(),function(y){y.Glyphs="Glyphs",y.Image="Image",y.Source="Source",y.SpriteImage="SpriteImage",y.SpriteJSON="SpriteJSON",y.Style="Style",y.Tile="Tile",y.Unknown="Unknown"}(Y||(Y={}));class he{constructor(a){this._transformRequestFn=a}transformRequest(a,d){return this._transformRequestFn&&this._transformRequestFn(a,d)||{url:a}}normalizeSpriteURL(a,d,p){const g=function(x){const A=x.match(Z);if(!A)throw new Error(`Unable to parse URL "${x}"`);return{protocol:A[1],authority:A[2],path:A[3]||"/",params:A[4]?A[4].split("&"):[]}}(a);return g.path+=`${d}${p}`,function(x){const A=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${A}`}(g)}setTransformRequest(a){this._transformRequestFn=a}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ne(y){var a=new l.A(3);return a[0]=y[0],a[1]=y[1],a[2]=y[2],a}var xe,ie=function(y,a,d){return y[0]=a[0]-d[0],y[1]=a[1]-d[1],y[2]=a[2]-d[2],y};xe=new l.A(3),l.A!=Float32Array&&(xe[0]=0,xe[1]=0,xe[2]=0);var J=function(y){var a=y[0],d=y[1];return a*a+d*d};function Te(y){const a=[];if(typeof y=="string")a.push({id:"default",url:y});else if(y&&y.length>0){const d=[];for(const{id:p,url:g}of y){const x=`${p}${g}`;d.indexOf(x)===-1&&(d.push(x),a.push({id:p,url:g}))}}return a}(function(){var y=new l.A(2);l.A!=Float32Array&&(y[0]=0,y[1]=0)})();class Be{constructor(a,d,p,g){this.context=a,this.format=p,this.texture=a.gl.createTexture(),this.update(d,g)}update(a,d,p){const{width:g,height:x}=a,A=!(this.size&&this.size[0]===g&&this.size[1]===x||p),{context:P}=this,{gl:D}=P;if(this.useMipmap=!!(d&&d.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!d||d.premultiply!==!1)),A)this.size=[g,x],a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,a):D.texImage2D(D.TEXTURE_2D,0,this.format,g,x,0,this.format,D.UNSIGNED_BYTE,a.data);else{const{x:H,y:$}=p||{x:0,y:0};a instanceof HTMLImageElement||a instanceof HTMLCanvasElement||a instanceof HTMLVideoElement||a instanceof ImageData||l.b(a)?D.texSubImage2D(D.TEXTURE_2D,0,H,$,D.RGBA,D.UNSIGNED_BYTE,a):D.texSubImage2D(D.TEXTURE_2D,0,H,$,g,x,D.RGBA,D.UNSIGNED_BYTE,a.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(a,d,p){const{context:g}=this,{gl:x}=g;x.bindTexture(x.TEXTURE_2D,this.texture),p!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(p=x.LINEAR),a!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,a),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,p||a),this.filter=a),d!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,d),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}}function Re(y){const{userImage:a}=y;return!!(a&&a.render&&a.render())&&(y.data.replace(new Uint8Array(a.data.buffer)),!0)}class We extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(a){if(this.loaded!==a&&(this.loaded=a,a)){for(const{ids:d,promiseResolve:p}of this.requestors)p(this._getImagesForIds(d));this.requestors=[]}}getImage(a){const d=this.images[a];if(d&&!d.data&&d.spriteData){const p=d.spriteData;d.data=new l.R({width:p.width,height:p.height},p.context.getImageData(p.x,p.y,p.width,p.height).data),d.spriteData=null}return d}addImage(a,d){if(this.images[a])throw new Error(`Image id ${a} already exist, use updateImage instead`);this._validate(a,d)&&(this.images[a]=d)}_validate(a,d){let p=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchX" value`))),p=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "stretchY" value`))),p=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${a}" has invalid "content" value`))),p=!1),p}_validateStretch(a,d){if(!a)return!0;let p=0;for(const g of a){if(g[0]<p||g[1]<g[0]||d<g[1])return!1;p=g[1]}return!0}_validateContent(a,d){if(!a)return!0;if(a.length!==4)return!1;const p=d.spriteData,g=p&&p.width||d.data.width,x=p&&p.height||d.data.height;return!(a[0]<0||g<a[0]||a[1]<0||x<a[1]||a[2]<0||g<a[2]||a[3]<0||x<a[3]||a[2]<a[0]||a[3]<a[1])}updateImage(a,d,p=!0){const g=this.getImage(a);if(p&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[a]=d,this.updatedImages[a]=!0}removeImage(a){const d=this.images[a];delete this.images[a],delete this.patterns[a],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(a){return new Promise((d,p)=>{let g=!0;if(!this.isLoaded())for(const x of a)this.images[x]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(a)):this.requestors.push({ids:a,promiseResolve:d})})}_getImagesForIds(a){const d={};for(const p of a){let g=this.getImage(p);g||(this.fire(new l.k("styleimagemissing",{id:p})),g=this.getImage(p)),g?d[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:a,height:d}=this.atlasImage;return{width:a,height:d}}getPattern(a){const d=this.patterns[a],p=this.getImage(a);if(!p)return null;if(d&&d.position.version===p.version)return d.position;if(d)d.position.version=p.version;else{const g={w:p.data.width+2,h:p.data.height+2,x:0,y:0},x=new l.I(g,p);this.patterns[a]={bin:g,position:x}}return this._updatePatternAtlas(),this.patterns[a].position}bind(a){const d=a.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Be(a,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const a=[];for(const x in this.patterns)a.push(this.patterns[x].bin);const{w:d,h:p}=l.p(a),g=this.atlasImage;g.resize({width:d||1,height:p||1});for(const x in this.patterns){const{bin:A}=this.patterns[x],P=A.x+1,D=A.y+1,H=this.getImage(x).data,$=H.width,X=H.height;l.R.copy(H,g,{x:0,y:0},{x:P,y:D},{width:$,height:X}),l.R.copy(H,g,{x:0,y:X-1},{x:P,y:D-1},{width:$,height:1}),l.R.copy(H,g,{x:0,y:0},{x:P,y:D+X},{width:$,height:1}),l.R.copy(H,g,{x:$-1,y:0},{x:P-1,y:D},{width:1,height:X}),l.R.copy(H,g,{x:0,y:0},{x:P+$,y:D},{width:1,height:X})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(a){for(const d of a){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const p=this.getImage(d);p||l.w(`Image with ID: "${d}" was not found`),Re(p)&&this.updateImage(d,p)}}}const ct=1e20;function gt(y,a,d,p,g,x,A,P,D){for(let H=a;H<a+p;H++)ft(y,d*x+H,x,g,A,P,D);for(let H=d;H<d+g;H++)ft(y,H*x+a,1,p,A,P,D)}function ft(y,a,d,p,g,x,A){x[0]=0,A[0]=-ct,A[1]=ct,g[0]=y[a];for(let P=1,D=0,H=0;P<p;P++){g[P]=y[a+P*d];const $=P*P;do{const X=x[D];H=(g[P]-g[X]+$-X*X)/(P-X)/2}while(H<=A[D]&&--D>-1);D++,x[D]=P,A[D]=H,A[D+1]=ct}for(let P=0,D=0;P<p;P++){for(;A[D+1]<P;)D++;const H=x[D],$=P-H;y[a+P*d]=g[H]+$*$}}class ke{constructor(a,d){this.requestManager=a,this.localIdeographFontFamily=d,this.entries={}}setURL(a){this.url=a}getGlyphs(a){return l._(this,void 0,void 0,function*(){const d=[];for(const x in a)for(const A of a[x])d.push(this._getAndCacheGlyphsPromise(x,A));const p=yield Promise.all(d),g={};for(const{stack:x,id:A,glyph:P}of p)g[x]||(g[x]={}),g[x][A]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics};return g})}_getAndCacheGlyphsPromise(a,d){return l._(this,void 0,void 0,function*(){let p=this.entries[a];p||(p=this.entries[a]={glyphs:{},requests:{},ranges:{}});let g=p.glyphs[d];if(g!==void 0)return{stack:a,id:d,glyph:g};if(g=this._tinySDF(p,a,d),g)return p.glyphs[d]=g,{stack:a,id:d,glyph:g};const x=Math.floor(d/256);if(256*x>65535)throw new Error("glyphs > 65535 not supported");if(p.ranges[x])return{stack:a,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!p.requests[x]){const P=ke.loadGlyphRange(a,x,this.url,this.requestManager);p.requests[x]=P}const A=yield p.requests[x];for(const P in A)this._doesCharSupportLocalGlyph(+P)||(p.glyphs[+P]=A[+P]);return p.ranges[x]=!0,{stack:a,id:d,glyph:A[d]||null}})}_doesCharSupportLocalGlyph(a){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](a)||l.u["Hangul Syllables"](a)||l.u.Hiragana(a)||l.u.Katakana(a))}_tinySDF(a,d,p){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(p))return;let x=a.tinySDF;if(!x){let P="400";/bold/i.test(d)?P="900":/medium/i.test(d)?P="500":/light/i.test(d)&&(P="200"),x=a.tinySDF=new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:P})}const A=x.draw(String.fromCharCode(p));return{id:p,bitmap:new l.o({width:A.width||60,height:A.height||60},A.data),metrics:{width:A.glyphWidth/2||24,height:A.glyphHeight/2||24,left:A.glyphLeft/2+.5||0,top:A.glyphTop/2-27.5||-8,advance:A.glyphAdvance/2||24,isDoubleResolution:!0}}}}ke.loadGlyphRange=function(y,a,d,p){return l._(this,void 0,void 0,function*(){const g=256*a,x=g+255,A=p.transformRequest(d.replace("{fontstack}",y).replace("{range}",`${g}-${x}`),Y.Glyphs),P=yield l.l(A,new AbortController);if(!P||!P.data)throw new Error(`Could not load glyph range. range: ${a}, ${g}-${x}`);const D={};for(const H of l.n(P.data))D[H.id]=H;return D})},ke.TinySDF=class{constructor({fontSize:y=24,buffer:a=3,radius:d=8,cutoff:p=.25,fontFamily:g="sans-serif",fontWeight:x="normal",fontStyle:A="normal"}={}){this.buffer=a,this.cutoff=p,this.radius=d;const P=this.size=y+4*a,D=this._createCanvas(P),H=this.ctx=D.getContext("2d",{willReadFrequently:!0});H.font=`${A} ${x} ${y}px ${g}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(y){const a=document.createElement("canvas");return a.width=a.height=y,a}draw(y){const{width:a,actualBoundingBoxAscent:d,actualBoundingBoxDescent:p,actualBoundingBoxLeft:g,actualBoundingBoxRight:x}=this.ctx.measureText(y),A=Math.ceil(d),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-g))),D=Math.min(this.size-this.buffer,A+Math.ceil(p)),H=P+2*this.buffer,$=D+2*this.buffer,X=Math.max(H*$,0),oe=new Uint8ClampedArray(X),ye={data:oe,width:H,height:$,glyphWidth:P,glyphHeight:D,glyphTop:A,glyphLeft:0,glyphAdvance:a};if(P===0||D===0)return ye;const{ctx:ve,buffer:be,gridInner:de,gridOuter:Le}=this;ve.clearRect(be,be,P,D),ve.fillText(y,be,be+A);const Je=ve.getImageData(be,be,P,D);Le.fill(ct,0,X),de.fill(0,0,X);for(let Me=0;Me<D;Me++)for(let Oe=0;Oe<P;Oe++){const et=Je.data[4*(Me*P+Oe)+3]/255;if(et===0)continue;const nt=(Me+be)*H+Oe+be;if(et===1)Le[nt]=0,de[nt]=ct;else{const ut=.5-et;Le[nt]=ut>0?ut*ut:0,de[nt]=ut<0?ut*ut:0}}gt(Le,0,0,H,$,H,this.f,this.v,this.z),gt(de,be,be,P,D,H,this.f,this.v,this.z);for(let Me=0;Me<X;Me++){const Oe=Math.sqrt(Le[Me])-Math.sqrt(de[Me]);oe[Me]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return ye}};class at{constructor(){this.specification=l.v.light.position}possiblyEvaluate(a,d){return l.y(a.expression.evaluate(d))}interpolate(a,d,p){return{x:l.z.number(a.x,d.x,p),y:l.z.number(a.y,d.y,p),z:l.z.number(a.z,d.z,p)}}}let ot;class _t extends l.E{constructor(a){super(),ot=ot||new l.q({anchor:new l.D(l.v.light.anchor),position:new at,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(ot),this.setLight(a),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(a,d={}){if(!this._validate(l.r,a,d))for(const p in a){const g=a[p];p.endsWith("-transition")?this._transitionable.setTransition(p.slice(0,-11),g):this._transitionable.setValue(p,g)}}updateTransitions(a){this._transitioning=this._transitionable.transitioned(a,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(a){this.properties=this._transitioning.possiblyEvaluate(a)}_validate(a,d,p){return(!p||p.validate!==!1)&&l.t(this,a.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class kt{constructor(a,d){this.width=a,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(a,d){const p=a.join(",")+String(d);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(a,d)),this.dashEntry[p]}getDashRanges(a,d,p){const g=[];let x=a.length%2==1?-a[a.length-1]*p:0,A=a[0]*p,P=!0;g.push({left:x,right:A,isDash:P,zeroLength:a[0]===0});let D=a[0];for(let H=1;H<a.length;H++){P=!P;const $=a[H];x=D*p,D+=$,A=D*p,g.push({left:x,right:A,isDash:P,zeroLength:$===0})}return g}addRoundDash(a,d,p){const g=d/2;for(let x=-p;x<=p;x++){const A=this.width*(this.nextRow+p+x);let P=0,D=a[P];for(let H=0;H<this.width;H++){H/D.right>1&&(D=a[++P]);const $=Math.abs(H-D.left),X=Math.abs(H-D.right),oe=Math.min($,X);let ye;const ve=x/p*(g+1);if(D.isDash){const be=g-Math.abs(ve);ye=Math.sqrt(oe*oe+be*be)}else ye=g-Math.sqrt(oe*oe+ve*ve);this.data[A+H]=Math.max(0,Math.min(255,ye+128))}}}addRegularDash(a){for(let P=a.length-1;P>=0;--P){const D=a[P],H=a[P+1];D.zeroLength?a.splice(P,1):H&&H.isDash===D.isDash&&(H.left=D.left,a.splice(P,1))}const d=a[0],p=a[a.length-1];d.isDash===p.isDash&&(d.left=p.left-this.width,p.right=d.right+this.width);const g=this.width*this.nextRow;let x=0,A=a[x];for(let P=0;P<this.width;P++){P/A.right>1&&(A=a[++x]);const D=Math.abs(P-A.left),H=Math.abs(P-A.right),$=Math.min(D,H);this.data[g+P]=Math.max(0,Math.min(255,(A.isDash?$:-$)+128))}}addDash(a,d){const p=d?7:0,g=2*p+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let x=0;for(let P=0;P<a.length;P++)x+=a[P];if(x!==0){const P=this.width/x,D=this.getDashRanges(a,this.width,P);d?this.addRoundDash(D,P,p):this.addRegularDash(D)}const A={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:x};return this.nextRow+=g,this.dirty=!0,A}bind(a){const d=a.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Cn="maplibre_preloaded_worker_pool";class it{constructor(){this.active={}}acquire(a){if(!this.workers)for(this.workers=[];this.workers.length<it.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[a]=!0,this.workers.slice()}release(a){delete this.active[a],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cn]}numActive(){return Object.keys(this.active).length}}const Mt=Math.floor(T.hardwareConcurrency/2);let Ft,At;function Sn(){return Ft||(Ft=new it),Ft}it.workerCount=l.B(globalThis)?Math.max(Math.min(Mt,3),1):1;class Dn{constructor(a,d){this.workerPool=a,this.actors=[],this.currentActor=0,this.id=d;const p=this.workerPool.acquire(d);for(let g=0;g<p.length;g++){const x=new l.C(p[g],d);x.name=`Worker ${g}`,this.actors.push(x)}if(!this.actors.length)throw new Error("No actors found")}broadcast(a,d){const p=[];for(const g of this.actors)p.push(g.sendAsync({type:a,data:d}));return Promise.all(p)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(a=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],a&&this.workerPool.release(this.id)}registerMessageHandler(a,d){for(const p of this.actors)p.registerMessageHandler(a,d)}}function qe(){return At||(At=new Dn(Sn(),l.G),At.registerMessageHandler("getResource",(y,a,d)=>l.m(a,d))),At}function Nn(y,a){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*y.width,.5*y.height,1]),l.K(d,d,y.calculatePosMatrix(a.toUnwrapped()))}function hn(y,a,d,p,g,x){const A=function(X,oe,ye){if(X)for(const ve of X){const be=oe[ve];if(be&&be.source===ye&&be.type==="fill-extrusion")return!0}else for(const ve in oe){const be=oe[ve];if(be.source===ye&&be.type==="fill-extrusion")return!0}return!1}(g&&g.layers,a,y.id),P=x.maxPitchScaleFactor(),D=y.tilesIn(p,P,A);D.sort(Gn);const H=[];for(const X of D)H.push({wrappedTileID:X.tileID.wrapped().key,queryResults:X.tile.queryRenderedFeatures(a,d,y._state,X.queryGeometry,X.cameraQueryGeometry,X.scale,g,x,P,Nn(y.transform,X.tileID))});const $=function(X){const oe={},ye={};for(const ve of X){const be=ve.queryResults,de=ve.wrappedTileID,Le=ye[de]=ye[de]||{};for(const Je in be){const Me=be[Je],Oe=Le[Je]=Le[Je]||{},et=oe[Je]=oe[Je]||[];for(const nt of Me)Oe[nt.featureIndex]||(Oe[nt.featureIndex]=!0,et.push(nt))}}return oe}(H);for(const X in $)$[X].forEach(oe=>{const ye=oe.feature,ve=y.getFeatureState(ye.layer["source-layer"],ye.id);ye.source=ye.layer.source,ye.layer["source-layer"]&&(ye.sourceLayer=ye.layer["source-layer"]),ye.state=ve});return $}function Gn(y,a){const d=y.tileID,p=a.tileID;return d.overscaledZ-p.overscaledZ||d.canonical.y-p.canonical.y||d.wrap-p.wrap||d.canonical.x-p.canonical.x}function gn(y,a,d){return l._(this,void 0,void 0,function*(){let p=y;if(y.url?p=(yield l.h(a.transformRequest(y.url,Y.Source),d)).data:yield T.frameAsync(d),!p)return null;const g=l.L(l.e(p,y),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in p&&p.vector_layers&&(g.vectorLayerIds=p.vector_layers.map(x=>x.id)),g})}class un{constructor(a,d){a&&(d?this.setSouthWest(a).setNorthEast(d):Array.isArray(a)&&(a.length===4?this.setSouthWest([a[0],a[1]]).setNorthEast([a[2],a[3]]):this.setSouthWest(a[0]).setNorthEast(a[1])))}setNorthEast(a){return this._ne=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}setSouthWest(a){return this._sw=a instanceof l.M?new l.M(a.lng,a.lat):l.M.convert(a),this}extend(a){const d=this._sw,p=this._ne;let g,x;if(a instanceof l.M)g=a,x=a;else{if(!(a instanceof un))return Array.isArray(a)?a.length===4||a.every(Array.isArray)?this.extend(un.convert(a)):this.extend(l.M.convert(a)):a&&("lng"in a||"lon"in a)&&"lat"in a?this.extend(l.M.convert(a)):this;if(g=a._sw,x=a._ne,!g||!x)return this}return d||p?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),p.lng=Math.max(x.lng,p.lng),p.lat=Math.max(x.lat,p.lat)):(this._sw=new l.M(g.lng,g.lat),this._ne=new l.M(x.lng,x.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(a){const{lng:d,lat:p}=l.M.convert(a);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=p&&p<=this._ne.lat&&g}static convert(a){return a instanceof un?a:a&&new un(a)}static fromLngLat(a,d=0){const p=360*d/40075017,g=p/Math.cos(Math.PI/180*a.lat);return new un(new l.M(a.lng-g,a.lat-p),new l.M(a.lng+g,a.lat+p))}}class Pn{constructor(a,d,p){this.bounds=un.convert(this.validateBounds(a)),this.minzoom=d||0,this.maxzoom=p||24}validateBounds(a){return Array.isArray(a)&&a.length===4?[Math.max(-180,a[0]),Math.max(-90,a[1]),Math.min(180,a[2]),Math.min(90,a[3])]:[-180,-90,180,90]}contains(a){const d=Math.pow(2,a.z),p=Math.floor(l.N(this.bounds.getWest())*d),g=Math.floor(l.O(this.bounds.getNorth())*d),x=Math.ceil(l.N(this.bounds.getEast())*d),A=Math.ceil(l.O(this.bounds.getSouth())*d);return a.x>=p&&a.x<x&&a.y>=g&&a.y<A}}class je extends l.E{constructor(a,d,p,g){if(super(),this.id=a,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),a&&(l.e(this,a),a.bounds&&(this.tileBounds=new Pn(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}onAdd(a){this.map=a,this.load()}setSourceProperty(a){this._tileJSONRequest&&this._tileJSONRequest.abort(),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(d,Y.Tile),uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,tileSize:this.tileSize*a.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};p.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(a.actor&&a.state!=="expired"){if(a.state==="loading")return new Promise((x,A)=>{a.reloadPromise={resolve:x,reject:A}})}else a.actor=this.dispatcher.getActor(),g="loadTile";a.abortController=new AbortController;try{const x=yield a.actor.sendAsync({type:g,data:p},a.abortController);if(delete a.abortController,a.aborted)return;this._afterTileLoadWorkerResponse(a,x)}catch(x){if(delete a.abortController,a.aborted)return;if(x&&x.status!==404)throw x;this._afterTileLoadWorkerResponse(a,null)}})}_afterTileLoadWorkerResponse(a,d){if(d&&d.resourceTiming&&(a.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&a.setExpiryData(d),a.loadVectorData(d,this.map.painter),a.reloadPromise){const p=a.reloadPromise;a.reloadPromise=null,this.loadTile(a).then(p.resolve).catch(p.reject)}}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.actor&&(yield a.actor.sendAsync({type:"abortTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),a.actor&&(yield a.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class qn extends l.E{constructor(a,d,p,g){super(),this.id=a,this.dispatcher=p,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const a=yield gn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,a&&(l.e(this,a),a.bounds&&(this.tileBounds=new Pn(a.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(a){this._tileJSONRequest=null,this.fire(new l.j(a))}})}loaded(){return this._loaded}onAdd(a){this.map=a,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(a){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),a(),this.load()}setTiles(a){return this.setSourceProperty(()=>{this._options.tiles=a}),this}setUrl(a){return this.setSourceProperty(()=>{this.url=a,this._options.url=a}),this}serialize(){return l.e({},this._options)}hasTile(a){return!this.tileBounds||this.tileBounds.contains(a.canonical)}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);a.abortController=new AbortController;try{const p=yield V.getImage(this.map._requestManager.transformRequest(d,Y.Tile),a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(p&&p.data){this.map._refreshExpiredTiles&&p.cacheControl&&p.expires&&a.setExpiryData({cacheControl:p.cacheControl,expires:p.expires});const g=this.map.painter.context,x=g.gl,A=p.data;a.texture=this.map.painter.getTileTexture(A.width),a.texture?a.texture.update(A,{useMipmap:!0}):(a.texture=new Be(g,A,x.RGBA,{useMipmap:!0}),a.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&x.texParameterf(x.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),a.state="loaded"}}catch(p){if(delete a.abortController,a.aborted)a.state="unloaded";else if(p)throw a.state="errored",p}})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController)})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.texture&&this.map.painter.saveTileTexture(a.texture)})}hasTransition(){return!1}}class Ae extends qn{constructor(a,d,p,g){super(a,d,p,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p=this.map._requestManager.transformRequest(d,Y.Tile);a.neighboringTiles=this._getNeighboringTiles(a.tileID),a.abortController=new AbortController;try{const g=yield V.getImage(p,a.abortController,this.map._refreshExpiredTiles);if(delete a.abortController,a.aborted)return void(a.state="unloaded");if(g&&g.data){const x=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&a.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const A=l.b(x)&&l.S()?x:yield this.readImageNow(x),P={type:this.type,uid:a.uid,source:this.id,rawImageData:A,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!a.actor||a.state==="expired"){a.actor=this.dispatcher.getActor();const D=yield a.actor.sendAsync({type:"loadDEMTile",data:P});a.dem=D,a.needsHillshadePrepare=!0,a.needsTerrainPrepare=!0,a.state="loaded"}}}catch(g){if(delete a.abortController,a.aborted)a.state="unloaded";else if(g)throw a.state="errored",g}})}readImageNow(a){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=a.width+2,p=a.height+2;try{return new l.R({width:d,height:p},yield l.V(a,-1,-1,d,p))}catch{}}return T.getImageData(a,1)})}_getNeighboringTiles(a){const d=a.canonical,p=Math.pow(2,d.z),g=(d.x-1+p)%p,x=d.x===0?a.wrap-1:a.wrap,A=(d.x+1+p)%p,P=d.x+1===p?a.wrap+1:a.wrap,D={};return D[new l.Q(a.overscaledZ,x,d.z,g,d.y).key]={backfilled:!1},D[new l.Q(a.overscaledZ,P,d.z,A,d.y).key]={backfilled:!1},d.y>0&&(D[new l.Q(a.overscaledZ,x,d.z,g,d.y-1).key]={backfilled:!1},D[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},D[new l.Q(a.overscaledZ,P,d.z,A,d.y-1).key]={backfilled:!1}),d.y+1<p&&(D[new l.Q(a.overscaledZ,x,d.z,g,d.y+1).key]={backfilled:!1},D[new l.Q(a.overscaledZ,a.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},D[new l.Q(a.overscaledZ,P,d.z,A,d.y+1).key]={backfilled:!1}),D}unloadTile(a){return l._(this,void 0,void 0,function*(){a.demTexture&&this.map.painter.saveTileTexture(a.demTexture),a.fbo&&(a.fbo.destroy(),delete a.fbo),a.dem&&delete a.dem,delete a.neighboringTiles,a.state="unloaded",a.actor&&(yield a.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:a.uid,source:this.id}}))})}}class se extends l.E{constructor(a,d,p,g){super(),this.id=a,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=p.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const x=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*x,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*x,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*x,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(a){this.map=a,this.load()}setData(a){return this._data=a,this._updateWorkerData(),this}updateData(a){return this._updateWorkerData(a),this}setClusterOptions(a){return this.workerOptions.cluster=a.cluster,a&&(a.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=a.clusterRadius),a.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=a.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(a){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:a,source:this.id}})}getClusterChildren(a){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:a,source:this.id}})}getClusterLeaves(a,d,p){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:a,limit:d,offset:p}})}_updateWorkerData(a){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);a?d.dataDiff=a:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(T.resolveURL(this._data),Y.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const p=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||p.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;p.resourceTiming&&p.resourceTiming[this.id]&&(g=p.resourceTiming[this.id].slice(0));const x={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(x,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},x),{sourceDataType:"content"})))}catch(p){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(p))}})}loaded(){return this._pendingLoads===0}loadTile(a){return l._(this,void 0,void 0,function*(){const d=a.actor?"reloadTile":"loadTile";a.actor=this.actor;const p={type:this.type,uid:a.uid,tileID:a.tileID,zoom:a.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};a.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:p},a.abortController);delete a.abortController,a.unloadVectorData(),a.aborted||a.loadVectorData(g,this.map.painter,d==="reloadTile")})}abortTile(a){return l._(this,void 0,void 0,function*(){a.abortController&&(a.abortController.abort(),delete a.abortController),a.aborted=!0})}unloadTile(a){return l._(this,void 0,void 0,function*(){a.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:a.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var tt=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class vt extends l.E{constructor(a,d,p,g){super(),this.id=a,this.dispatcher=p,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(a){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield V.getImage(this.map._requestManager.transformRequest(this.url,Y.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,a&&(this.coordinates=a),this._finishLoading())}catch(d){this._request=null,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(a){return a.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=a.url,this.load(a.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(a){this.map=a,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(a){this.coordinates=a;const d=a.map(l.Y.fromLngLat);this.tileID=function(g){let x=1/0,A=1/0,P=-1/0,D=-1/0;for(const oe of g)x=Math.min(x,oe.x),A=Math.min(A,oe.y),P=Math.max(P,oe.x),D=Math.max(D,oe.y);const H=Math.max(P-x,D-A),$=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),X=Math.pow(2,$);return new l.a0($,Math.floor((x+P)/2*X),Math.floor((A+D)/2*X))}(d),this.minzoom=this.maxzoom=this.tileID.z;const p=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(p[0].x,p[0].y,0,0),this._boundsArray.emplaceBack(p[1].x,p[1].y,l.W,0),this._boundsArray.emplaceBack(p[3].x,p[3].y,0,l.W),this._boundsArray.emplaceBack(p[2].x,p[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Be(a,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(a){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(a.tileID.canonical)?(this.tiles[String(a.tileID.wrap)]=a,a.buckets={}):a.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Tt extends vt{constructor(a,d,p,g){super(a,d,p,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const a=this.options;this.urls=[];for(const d of a.urls)this.urls.push(this.map._requestManager.transformRequest(d,Y.Source).url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(a){if(this.video){const d=this.video.seekable;a<d.start(0)||a>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=a}}getVideo(){return this.video}onAdd(a){this.map||(this.map=a,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const a=this.map.painter.context,d=a.gl;this.boundsBuffer||(this.boundsBuffer=a.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Be(a,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let p=!1;for(const g in this.tiles){const x=this.tiles[g];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,p=!0)}p&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class wt extends vt{constructor(a,d,p,g){super(a,d,p,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(A=>typeof A!="number"))||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${a}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${a}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${a}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(a){this.map=a,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let a=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,a=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,a=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,p=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,tt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(a||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Be(d,this.canvas,p.RGBA,{premultiply:!0});let g=!1;for(const x in this.tiles){const A=this.tiles[x];A.state!=="loaded"&&(A.state="loaded",A.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const a of[this.canvas.width,this.canvas.height])if(isNaN(a)||a<=0)return!0;return!1}}const pn={},Gt=y=>{switch(y){case"geojson":return se;case"image":return vt;case"raster":return qn;case"raster-dem":return Ae;case"vector":return je;case"video":return Tt;case"canvas":return wt}return pn[y]},Ht="RTLPluginLoaded";class Ln extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=qe()}_syncState(a){return this.status=a,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:a,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(a){return l._(this,arguments,void 0,function*(d,p=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=T.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!p)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Ht))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let He=null;function on(){return He||(He=new Ln),He}class Rn{constructor(a,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=a,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(a){const d=a+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(a){this.demTexture&&a.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(a,d,p){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",a){a.featureIndex&&(this.latestFeatureIndex=a.featureIndex,a.rawTileData?(this.latestRawTileData=a.rawTileData,this.latestFeatureIndex.rawTileData=a.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=a.collisionBoxArray,this.buckets=function(g,x){const A={};if(!x)return A;for(const P of g){const D=P.layerIds.map(H=>x.getLayer(H)).filter(Boolean);if(D.length!==0){P.layers=D,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(H=>D.filter($=>$.id===H)[0]));for(const H of D)A[H.id]=P}}return A}(a.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5){if(this.hasSymbolBuckets=!0,!p)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const x=this.buckets[g];if(x instanceof l.a5&&x.hasRTLText){this.hasRTLText=!0,on().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const x=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(x))}a.imageAtlas&&(this.imageAtlas=a.imageAtlas),a.glyphAtlasImage&&(this.glyphAtlasImage=a.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const a in this.buckets)this.buckets[a].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(a){return this.buckets[a.id]}upload(a){for(const p in this.buckets){const g=this.buckets[p];g.uploadPending()&&g.upload(a)}const d=a.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Be(a,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Be(a,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(a){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(a,this.imageAtlasTexture)}queryRenderedFeatures(a,d,p,g,x,A,P,D,H,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:x,scale:A,tileSize:this.tileSize,pixelPosMatrix:$,transform:D,params:P,queryPadding:this.queryPadding*H},a,d,p):{}}querySourceFeatures(a,d){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const g=p.loadVTLayers(),x=d&&d.sourceLayer?d.sourceLayer:"",A=g._geojsonTileLayer||g[x];if(!A)return;const P=l.a6(d&&d.filter),{z:D,x:H,y:$}=this.tileID.canonical,X={z:D,x:H,y:$};for(let oe=0;oe<A.length;oe++){const ye=A.feature(oe);if(P.needGeometry){const de=l.a7(ye,!0);if(!P.filter(new l.a8(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!P.filter(new l.a8(this.tileID.overscaledZ),ye))continue;const ve=p.getId(ye,x),be=new l.a9(ye,D,H,$,ve);be.tile=X,a.push(be)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(a){const d=this.expirationTime;if(a.cacheControl){const p=l.aa(a.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else a.expires&&(this.expirationTime=new Date(a.expires).getTime());if(this.expirationTime){const p=Date.now();let g=!1;if(this.expirationTime>p)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const x=this.expirationTime-d;x?this.expirationTime=p+Math.max(x,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(a,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(a).length===0)return;const p=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const x=this.buckets[g],A=x.layers[0].sourceLayer||"_geojsonTileLayer",P=p[A],D=a[A];if(!P||!D||Object.keys(D).length===0)continue;x.update(D,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=d&&d.style&&d.style.getLayer(g);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<T.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(a){this.symbolFadeHoldUntil=T.now()+a}setDependencies(a,d){const p={};for(const g of d)p[g]=!0;this.dependencies[a]=p}hasDependency(a,d){for(const p of a){const g=this.dependencies[p];if(g){for(const x of d)if(g[x])return!0}}return!1}}class xn{constructor(a,d){this.max=a,this.onRemove=d,this.reset()}reset(){for(const a in this.data)for(const d of this.data[a])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(a,d,p){const g=a.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const x={value:d,timeout:void 0};if(p!==void 0&&(x.timeout=setTimeout(()=>{this.remove(a,x)},p)),this.data[g].push(x),this.order.push(g),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(a){return a.wrapped().key in this.data}getAndRemove(a){return this.has(a)?this._getAndRemoveByKey(a.wrapped().key):null}_getAndRemoveByKey(a){const d=this.data[a].shift();return d.timeout&&clearTimeout(d.timeout),this.data[a].length===0&&delete this.data[a],this.order.splice(this.order.indexOf(a),1),d.value}getByKey(a){const d=this.data[a];return d?d[0].value:null}get(a){return this.has(a)?this.data[a.wrapped().key][0].value:null}remove(a,d){if(!this.has(a))return this;const p=a.wrapped().key,g=d===void 0?0:this.data[p].indexOf(d),x=this.data[p][g];return this.data[p].splice(g,1),x.timeout&&clearTimeout(x.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(x.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(a){for(this.max=a;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(a){const d=[];for(const p in this.data)for(const g of this.data[p])a(g.value)||d.push(g);for(const p of d)this.remove(p.value.tileID,p)}}class Qt{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(a,d,p){const g=String(d);if(this.stateChanges[a]=this.stateChanges[a]||{},this.stateChanges[a][g]=this.stateChanges[a][g]||{},l.e(this.stateChanges[a][g],p),this.deletedStates[a]===null){this.deletedStates[a]={};for(const x in this.state[a])x!==g&&(this.deletedStates[a][x]=null)}else if(this.deletedStates[a]&&this.deletedStates[a][g]===null){this.deletedStates[a][g]={};for(const x in this.state[a][g])p[x]||(this.deletedStates[a][g][x]=null)}else for(const x in p)this.deletedStates[a]&&this.deletedStates[a][g]&&this.deletedStates[a][g][x]===null&&delete this.deletedStates[a][g][x]}removeFeatureState(a,d,p){if(this.deletedStates[a]===null)return;const g=String(d);if(this.deletedStates[a]=this.deletedStates[a]||{},p&&d!==void 0)this.deletedStates[a][g]!==null&&(this.deletedStates[a][g]=this.deletedStates[a][g]||{},this.deletedStates[a][g][p]=null);else if(d!==void 0)if(this.stateChanges[a]&&this.stateChanges[a][g])for(p in this.deletedStates[a][g]={},this.stateChanges[a][g])this.deletedStates[a][g][p]=null;else this.deletedStates[a][g]=null;else this.deletedStates[a]=null}getState(a,d){const p=String(d),g=l.e({},(this.state[a]||{})[p],(this.stateChanges[a]||{})[p]);if(this.deletedStates[a]===null)return{};if(this.deletedStates[a]){const x=this.deletedStates[a][d];if(x===null)return{};for(const A in x)delete g[A]}return g}initializeTileState(a,d){a.setFeatureState(this.state,d)}coalesceChanges(a,d){const p={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const x={};for(const A in this.stateChanges[g])this.state[g][A]||(this.state[g][A]={}),l.e(this.state[g][A],this.stateChanges[g][A]),x[A]=this.state[g][A];p[g]=x}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const x={};if(this.deletedStates[g]===null)for(const A in this.state[g])x[A]={},this.state[g][A]={};else for(const A in this.deletedStates[g]){if(this.deletedStates[g][A]===null)this.state[g][A]={};else for(const P of Object.keys(this.deletedStates[g][A]))delete this.state[g][A][P];x[A]=this.state[g][A]}p[g]=p[g]||{},l.e(p[g],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const g in a)a[g].setFeatureState(p,d)}}class lt extends l.E{constructor(a,d,p){super(),this.id=a,this.dispatcher=p,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,x,A,P)=>{const D=new(Gt(x.type))(g,x,A,P);if(D.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${D.id}`);return D})(a,d,p,this),this._tiles={},this._cache=new xn(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Qt,this._didEmitContent=!1,this._updated=!1}onAdd(a){this.map=a,this._maxTileCacheSize=a?a._maxTileCacheSize:null,this._maxTileCacheZoomLevels=a?a._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(a)}onRemove(a){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(a)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const a in this._tiles){const d=this._tiles[a];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const a=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,a&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(a,d,p){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(a),this._tileLoaded(a,d,p)}catch(g){a.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:a})):this.update(this.transform,this.terrain)}})}_unloadTile(a){this._source.unloadTile&&this._source.unloadTile(a)}_abortTile(a){this._source.abortTile&&this._source.abortTile(a),this._source.fire(new l.k("dataabort",{tile:a,coord:a.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(a){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const p=this._tiles[d];p.upload(a),p.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(a=>a.tileID).sort(Ut).map(a=>a.key)}getRenderableIds(a){const d=[];for(const p in this._tiles)this._isIdRenderable(p,a)&&d.push(this._tiles[p]);return a?d.sort((p,g)=>{const x=p.tileID,A=g.tileID,P=new l.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),D=new l.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-A.overscaledZ||D.y-P.y||D.x-P.x}).map(p=>p.tileID.key):d.map(p=>p.tileID).sort(Ut).map(p=>p.key)}hasRenderableParent(a){const d=this.findLoadedParent(a,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(a,d){return this._tiles[a]&&this._tiles[a].hasData()&&!this._coveredTiles[a]&&(d||!this._tiles[a].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const a in this._tiles)this._tiles[a].state!=="errored"&&this._reloadTile(a,"reloading")}}_reloadTile(a,d){return l._(this,void 0,void 0,function*(){const p=this._tiles[a];p&&(p.state!=="loading"&&(p.state=d),yield this._loadTile(p,a,d))})}_tileLoaded(a,d,p){a.timeAdded=T.now(),p==="expired"&&(a.refreshedUponExpiration=!0),this._setTileReloadTimer(d,a),this.getSource().type==="raster-dem"&&a.dem&&this._backfillDEM(a),this._state.initializeTileState(a,this.map?this.map.painter:null),a.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:a,coord:a.tileID}))}_backfillDEM(a){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const x=d[g];if(a.neighboringTiles&&a.neighboringTiles[x]){const A=this.getTileByID(x);p(a,A),p(A,a)}}function p(g,x){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let A=x.tileID.canonical.x-g.tileID.canonical.x;const P=x.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),H=x.tileID.key;A===0&&P===0||Math.abs(P)>1||(Math.abs(A)>1&&(Math.abs(A+D)===1?A+=D:Math.abs(A-D)===1&&(A-=D)),x.dem&&g.dem&&(g.dem.backfillBorder(x.dem,A,P),g.neighboringTiles&&g.neighboringTiles[H]&&(g.neighboringTiles[H].backfilled=!0)))}}getTile(a){return this.getTileByID(a.key)}getTileByID(a){return this._tiles[a]}_retainLoadedChildren(a,d,p,g){for(const x in this._tiles){let A=this._tiles[x];if(g[x]||!A.hasData()||A.tileID.overscaledZ<=d||A.tileID.overscaledZ>p)continue;let P=A.tileID;for(;A&&A.tileID.overscaledZ>d+1;){const H=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[H.key],A&&A.hasData()&&(P=H)}let D=P;for(;D.overscaledZ>d;)if(D=D.scaledTo(D.overscaledZ-1),a[D.key]){g[P.key]=P;break}}}findLoadedParent(a,d){if(a.key in this._loadedParentTiles){const p=this._loadedParentTiles[a.key];return p&&p.tileID.overscaledZ>=d?p:null}for(let p=a.overscaledZ-1;p>=d;p--){const g=a.scaledTo(p),x=this._getLoadedTile(g);if(x)return x}}_getLoadedTile(a){const d=this._tiles[a.key];return d&&d.hasData()?d:this._cache.getByKey(a.wrapped().key)}updateCacheSize(a){const d=Math.ceil(a.width/this._source.tileSize)+1,p=Math.ceil(a.height/this._source.tileSize)+1,g=Math.floor(d*p*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(x)}handleWrapJump(a){const d=Math.round((a-(this._prevLng===void 0?a:this._prevLng))/360);if(this._prevLng=a,d){const p={};for(const g in this._tiles){const x=this._tiles[g];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+d),p[x.tileID.key]=x}this._tiles=p;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(a,d){if(this.transform=a,this.terrain=d,!this._sourceLoaded||this._paused)return;let p;this.updateCacheSize(a),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?p=a.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new l.Q($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(p=a.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(p=p.filter($=>this._source.hasTile($)))):p=[];const g=a.coveringZoomLevel(this._source),x=Math.max(g-lt.maxOverzooming,this._source.minzoom),A=Math.max(g+lt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const X of p)if(X.canonical.z>this._source.minzoom){const oe=X.scaledTo(X.canonical.z-1);$[oe.key]=oe;const ye=X.scaledTo(Math.max(this._source.minzoom,Math.min(X.canonical.z,5)));$[ye.key]=ye}p=p.concat(Object.values($))}const P=p.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(p,g);if(Zt(this._source.type)){const $={},X={},oe=Object.keys(D),ye=T.now();for(const ve of oe){const be=D[ve],de=this._tiles[ve];if(!de||de.fadeEndTime!==0&&de.fadeEndTime<=ye)continue;const Le=this.findLoadedParent(be,x);Le&&(this._addTile(Le.tileID),$[Le.tileID.key]=Le.tileID),X[ve]=be}this._retainLoadedChildren(X,g,A,D);for(const ve in $)D[ve]||(this._coveredTiles[ve]=!0,D[ve]=$[ve]);if(d){const ve={},be={};for(const de of p)this._tiles[de.key].hasData()?ve[de.key]=de:be[de.key]=de;for(const de in be){const Le=be[de].children(this._source.maxzoom);this._tiles[Le[0].key]&&this._tiles[Le[1].key]&&this._tiles[Le[2].key]&&this._tiles[Le[3].key]&&(ve[Le[0].key]=D[Le[0].key]=Le[0],ve[Le[1].key]=D[Le[1].key]=Le[1],ve[Le[2].key]=D[Le[2].key]=Le[2],ve[Le[3].key]=D[Le[3].key]=Le[3],delete be[de])}for(const de in be){const Le=this.findLoadedParent(be[de],this._source.minzoom);if(Le){ve[Le.tileID.key]=D[Le.tileID.key]=Le.tileID;for(const Je in ve)ve[Je].isChildOf(Le.tileID)&&delete ve[Je]}}for(const de in this._tiles)ve[de]||(this._coveredTiles[de]=!0)}}for(const $ in D)this._tiles[$].clearFadeHold();const H=l.ab(this._tiles,D);for(const $ of H){const X=this._tiles[$];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const a in this._tiles)this._tiles[a].holdingForFade()&&this._removeTile(a)}_updateRetainedTiles(a,d){const p={},g={},x=Math.max(d-lt.maxOverzooming,this._source.minzoom),A=Math.max(d+lt.maxUnderzooming,this._source.minzoom),P={};for(const D of a){const H=this._addTile(D);p[D.key]=D,H.hasData()||d<this._source.maxzoom&&(P[D.key]=D)}this._retainLoadedChildren(P,d,A,p);for(const D of a){let H=this._tiles[D.key];if(H.hasData())continue;if(d+1>this._source.maxzoom){const X=D.children(this._source.maxzoom)[0],oe=this.getTile(X);if(oe&&oe.hasData()){p[X.key]=X;continue}}else{const X=D.children(this._source.maxzoom);if(p[X[0].key]&&p[X[1].key]&&p[X[2].key]&&p[X[3].key])continue}let $=H.wasRequested();for(let X=D.overscaledZ-1;X>=x;--X){const oe=D.scaledTo(X);if(g[oe.key])break;if(g[oe.key]=!0,H=this.getTile(oe),!H&&$&&(H=this._addTile(oe)),H){const ye=H.hasData();if(($||ye)&&(p[oe.key]=oe),$=H.wasRequested(),ye)break}}}return p}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const a in this._tiles){const d=[];let p,g=this._tiles[a].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){p=this._loadedParentTiles[g.key];break}d.push(g.key);const x=g.scaledTo(g.overscaledZ-1);if(p=this._getLoadedTile(x),p)break;g=x}for(const x of d)this._loadedParentTiles[x]=p}}_addTile(a){let d=this._tiles[a.key];if(d)return d;d=this._cache.getAndRemove(a),d&&(this._setTileReloadTimer(a.key,d),d.tileID=a,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[a.key]&&(clearTimeout(this._cacheTimers[a.key]),delete this._cacheTimers[a.key],this._setTileReloadTimer(a.key,d)));const p=d;return d||(d=new Rn(a,this._source.tileSize*a.overscaleFactor()),this._loadTile(d,a.key,d.state)),d.uses++,this._tiles[a.key]=d,p||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(a,d){a in this._timers&&(clearTimeout(this._timers[a]),delete this._timers[a]);const p=d.getExpiryTimeout();p&&(this._timers[a]=setTimeout(()=>{this._reloadTile(a,"expired"),delete this._timers[a]},p))}_removeTile(a){const d=this._tiles[a];d&&(d.uses--,delete this._tiles[a],this._timers[a]&&(clearTimeout(this._timers[a]),delete this._timers[a]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const a in this._tiles)this._removeTile(a);this._cache.reset()}tilesIn(a,d,p){const g=[],x=this.transform;if(!x)return g;const A=p?x.getCameraQueryGeometry(a):a,P=a.map(ve=>x.pointCoordinate(ve,this.terrain)),D=A.map(ve=>x.pointCoordinate(ve,this.terrain)),H=this.getIds();let $=1/0,X=1/0,oe=-1/0,ye=-1/0;for(const ve of D)$=Math.min($,ve.x),X=Math.min(X,ve.y),oe=Math.max(oe,ve.x),ye=Math.max(ye,ve.y);for(let ve=0;ve<H.length;ve++){const be=this._tiles[H[ve]];if(be.holdingForFade())continue;const de=be.tileID,Le=Math.pow(2,x.zoom-be.tileID.overscaledZ),Je=d*be.queryPadding*l.W/be.tileSize/Le,Me=[de.getTilePoint(new l.Y($,X)),de.getTilePoint(new l.Y(oe,ye))];if(Me[0].x-Je<l.W&&Me[0].y-Je<l.W&&Me[1].x+Je>=0&&Me[1].y+Je>=0){const Oe=P.map(nt=>de.getTilePoint(nt)),et=D.map(nt=>de.getTilePoint(nt));g.push({tile:be,tileID:de,queryGeometry:Oe,cameraQueryGeometry:et,scale:Le})}}return g}getVisibleCoordinates(a){const d=this.getRenderableIds(a).map(p=>this._tiles[p].tileID);for(const p of d)p.posMatrix=this.transform.calculatePosMatrix(p.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(Zt(this._source.type)){const a=T.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=a)return!0}return!1}setFeatureState(a,d,p){this._state.updateState(a=a||"_geojsonTileLayer",d,p)}removeFeatureState(a,d,p){this._state.removeFeatureState(a=a||"_geojsonTileLayer",d,p)}getFeatureState(a,d){return this._state.getState(a=a||"_geojsonTileLayer",d)}setDependencies(a,d,p){const g=this._tiles[a];g&&g.setDependencies(d,p)}reloadTilesForDependencies(a,d){for(const p in this._tiles)this._tiles[p].hasDependency(a,d)&&this._reloadTile(p,"reloading");this._cache.filter(p=>!p.hasDependency(a,d))}}function Ut(y,a){const d=Math.abs(2*y.wrap)-+(y.wrap<0),p=Math.abs(2*a.wrap)-+(a.wrap<0);return y.overscaledZ-a.overscaledZ||p-d||a.canonical.y-y.canonical.y||a.canonical.x-y.canonical.x}function Zt(y){return y==="raster"||y==="image"||y==="video"}lt.maxOverzooming=10,lt.maxUnderzooming=3;class yn{constructor(a,d){this.reset(a,d)}reset(a,d){this.points=a||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(a){if(this.points.length===1)return this.points[0];a=l.ac(a,0,1);let d=1,p=this._distances[d];const g=a*this.paddedLength+this.padding;for(;p<g&&d<this._distances.length;)p=this._distances[++d];const x=d-1,A=this._distances[x],P=p-A,D=P>0?(g-A)/P:0;return this.points[x].mult(1-D).add(this.points[d].mult(D))}}function Q(y,a){let d=!0;return y==="always"||y!=="never"&&a!=="never"||(d=!1),d}class ze{constructor(a,d,p){const g=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(a/p),this.yCellCount=Math.ceil(d/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)g.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=a,this.height=d,this.xScale=this.xCellCount/a,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(a,d,p,g,x){this._forEachCell(d,p,g,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(d),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(x)}insertCircle(a,d,p,g){this._forEachCell(d-g,p-g,d+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(a),this.circles.push(d),this.circles.push(p),this.circles.push(g)}_insertBoxCell(a,d,p,g,x,A){this.boxCells[x].push(A)}_insertCircleCell(a,d,p,g,x,A){this.circleCells[x].push(A)}_query(a,d,p,g,x,A,P){if(p<0||a>this.width||g<0||d>this.height)return[];const D=[];if(a<=0&&d<=0&&this.width<=p&&this.height<=g){if(x)return[{key:null,x1:a,y1:d,x2:p,y2:g}];for(let H=0;H<this.boxKeys.length;H++)D.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const $=this.circles[3*H],X=this.circles[3*H+1],oe=this.circles[3*H+2];D.push({key:this.circleKeys[H],x1:$-oe,y1:X-oe,x2:$+oe,y2:X+oe})}}else this._forEachCell(a,d,p,g,this._queryCell,D,{hitTest:x,overlapMode:A,seenUids:{box:{},circle:{}}},P);return D}query(a,d,p,g){return this._query(a,d,p,g,!1,null)}hitTest(a,d,p,g,x,A){return this._query(a,d,p,g,!0,x,A).length>0}hitTestCircle(a,d,p,g,x){const A=a-p,P=a+p,D=d-p,H=d+p;if(P<0||A>this.width||H<0||D>this.height)return!1;const $=[];return this._forEachCell(A,D,P,H,this._queryCellCircle,$,{hitTest:!0,overlapMode:g,circle:{x:a,y:d,radius:p},seenUids:{box:{},circle:{}}},x),$.length>0}_queryCell(a,d,p,g,x,A,P,D){const{seenUids:H,hitTest:$,overlapMode:X}=P,oe=this.boxCells[x];if(oe!==null){const ve=this.bboxes;for(const be of oe)if(!H.box[be]){H.box[be]=!0;const de=4*be,Le=this.boxKeys[be];if(a<=ve[de+2]&&d<=ve[de+3]&&p>=ve[de+0]&&g>=ve[de+1]&&(!D||D(Le))&&(!$||!Q(X,Le.overlapMode))&&(A.push({key:Le,x1:ve[de],y1:ve[de+1],x2:ve[de+2],y2:ve[de+3]}),$))return!0}}const ye=this.circleCells[x];if(ye!==null){const ve=this.circles;for(const be of ye)if(!H.circle[be]){H.circle[be]=!0;const de=3*be,Le=this.circleKeys[be];if(this._circleAndRectCollide(ve[de],ve[de+1],ve[de+2],a,d,p,g)&&(!D||D(Le))&&(!$||!Q(X,Le.overlapMode))){const Je=ve[de],Me=ve[de+1],Oe=ve[de+2];if(A.push({key:Le,x1:Je-Oe,y1:Me-Oe,x2:Je+Oe,y2:Me+Oe}),$)return!0}}}return!1}_queryCellCircle(a,d,p,g,x,A,P,D){const{circle:H,seenUids:$,overlapMode:X}=P,oe=this.boxCells[x];if(oe!==null){const ve=this.bboxes;for(const be of oe)if(!$.box[be]){$.box[be]=!0;const de=4*be,Le=this.boxKeys[be];if(this._circleAndRectCollide(H.x,H.y,H.radius,ve[de+0],ve[de+1],ve[de+2],ve[de+3])&&(!D||D(Le))&&!Q(X,Le.overlapMode))return A.push(!0),!0}}const ye=this.circleCells[x];if(ye!==null){const ve=this.circles;for(const be of ye)if(!$.circle[be]){$.circle[be]=!0;const de=3*be,Le=this.circleKeys[be];if(this._circlesCollide(ve[de],ve[de+1],ve[de+2],H.x,H.y,H.radius)&&(!D||D(Le))&&!Q(X,Le.overlapMode))return A.push(!0),!0}}}_forEachCell(a,d,p,g,x,A,P,D){const H=this._convertToXCellCoord(a),$=this._convertToYCellCoord(d),X=this._convertToXCellCoord(p),oe=this._convertToYCellCoord(g);for(let ye=H;ye<=X;ye++)for(let ve=$;ve<=oe;ve++)if(x.call(this,a,d,p,g,this.xCellCount*ve+ye,A,P,D))return}_convertToXCellCoord(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}_convertToYCellCoord(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}_circlesCollide(a,d,p,g,x,A){const P=g-a,D=x-d,H=p+A;return H*H>P*P+D*D}_circleAndRectCollide(a,d,p,g,x,A,P){const D=(A-g)/2,H=Math.abs(a-(g+D));if(H>D+p)return!1;const $=(P-x)/2,X=Math.abs(d-(x+$));if(X>$+p)return!1;if(H<=D||X<=$)return!0;const oe=H-D,ye=X-$;return oe*oe+ye*ye<=p*p}}function Qe(y,a,d,p,g){const x=l.F();return a?(l.J(x,x,[1/g,1/g,1]),d||l.ad(x,x,p.angle)):l.K(x,p.labelPlaneMatrix,y),x}function bt(y,a,d,p,g){if(a){const x=l.ae(y);return l.J(x,x,[g,g,1]),d||l.ad(x,x,-p.angle),x}return p.glCoordMatrix}function ae(y,a,d){let p;d?(p=[y.x,y.y,d(y.x,y.y),1],l.af(p,p,a)):(p=[y.x,y.y,0,1],en(p,p,a));const g=p[3];return{point:new l.P(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function F(y,a){return .5+y/a*.5}function O(y,a){const d=y[0]/y[3],p=y[1]/y[3];return d>=-a[0]&&d<=a[0]&&p>=-a[1]&&p<=a[1]}function q(y,a,d,p,g,x,A,P,D,H){const $=p?y.textSizeData:y.iconSizeData,X=l.ag($,d.transform.zoom),oe=[256/d.width*2+1,256/d.height*2+1],ye=p?y.text.dynamicLayoutVertexArray:y.icon.dynamicLayoutVertexArray;ye.clear();const ve=y.lineVertexArray,be=p?y.text.placedSymbolArray:y.icon.placedSymbolArray,de=d.transform.width/d.transform.height;let Le=!1;for(let Je=0;Je<be.length;Je++){const Me=be.get(Je);if(Me.hidden||Me.writingMode===l.ah.vertical&&!Le){Pt(Me.numGlyphs,ye);continue}let Oe;if(Le=!1,H?(Oe=[Me.anchorX,Me.anchorY,H(Me.anchorX,Me.anchorY),1],l.af(Oe,Oe,a)):(Oe=[Me.anchorX,Me.anchorY,0,1],en(Oe,Oe,a)),!O(Oe,oe)){Pt(Me.numGlyphs,ye);continue}const et=F(d.transform.cameraToCenterDistance,Oe[3]),nt=l.ai($,X,Me),ut=A?nt/et:nt*et,St=new l.P(Me.anchorX,Me.anchorY),yt=ae(St,g,H).point,xt={projections:{},offsets:{}},Yt=we(Me,ut,!1,P,a,g,x,y.glyphOffsetArray,ve,ye,yt,St,xt,de,D,H);Le=Yt.useVertical,(Yt.notEnoughRoom||Le||Yt.needsFlipping&&we(Me,ut,!0,P,a,g,x,y.glyphOffsetArray,ve,ye,yt,St,xt,de,D,H).notEnoughRoom)&&Pt(Me.numGlyphs,ye)}p?y.text.dynamicLayoutVertexBuffer.updateData(ye):y.icon.dynamicLayoutVertexBuffer.updateData(ye)}function te(y,a,d,p,g,x,A,P,D,H,$,X,oe){const ye=P.glyphStartIndex+P.numGlyphs,ve=P.lineStartIndex,be=P.lineStartIndex+P.lineLength,de=a.getoffsetX(P.glyphStartIndex),Le=a.getoffsetX(ye-1),Je=Ke(y*de,d,p,g,x,A,P.segment,ve,be,D,H,$,X,oe);if(!Je)return null;const Me=Ke(y*Le,d,p,g,x,A,P.segment,ve,be,D,H,$,X,oe);return Me?{first:Je,last:Me}:null}function pe(y,a,d,p){return y===l.ah.horizontal&&Math.abs(d.y-a.y)>Math.abs(d.x-a.x)*p?{useVertical:!0}:(y===l.ah.vertical?a.y<d.y:a.x>d.x)?{needsFlipping:!0}:null}function we(y,a,d,p,g,x,A,P,D,H,$,X,oe,ye,ve,be){const de=a/24,Le=y.lineOffsetX*de,Je=y.lineOffsetY*de;let Me;if(y.numGlyphs>1){const Oe=y.glyphStartIndex+y.numGlyphs,et=y.lineStartIndex,nt=y.lineStartIndex+y.lineLength,ut=te(de,P,Le,Je,d,$,X,y,D,x,oe,ve,be);if(!ut)return{notEnoughRoom:!0};const St=ae(ut.first.point,A,be).point,yt=ae(ut.last.point,A,be).point;if(p&&!d){const xt=pe(y.writingMode,St,yt,ye);if(xt)return xt}Me=[ut.first];for(let xt=y.glyphStartIndex+1;xt<Oe-1;xt++)Me.push(Ke(de*P.getoffsetX(xt),Le,Je,d,$,X,y.segment,et,nt,D,x,oe,ve,be));Me.push(ut.last)}else{if(p&&!d){const et=ae(X,g,be).point,nt=y.lineStartIndex+y.segment+1,ut=new l.P(D.getx(nt),D.gety(nt)),St=ae(ut,g,be),yt=St.signedDistanceFromCamera>0?St.point:Se(X,ut,et,1,g,be),xt=pe(y.writingMode,et,yt,ye);if(xt)return xt}const Oe=Ke(de*P.getoffsetX(y.glyphStartIndex),Le,Je,d,$,X,y.segment,y.lineStartIndex,y.lineStartIndex+y.lineLength,D,x,oe,ve,be);if(!Oe)return{notEnoughRoom:!0};Me=[Oe]}for(const Oe of Me)l.aj(H,Oe.point,Oe.angle);return{}}function Se(y,a,d,p,g,x){const A=ae(y.add(y.sub(a)._unit()),g,x).point,P=d.sub(A);return d.add(P._mult(p/P.mag()))}function ge(y,a){const{projectionCache:d,lineVertexArray:p,labelPlaneMatrix:g,tileAnchorPoint:x,distanceFromAnchor:A,getElevation:P,previousVertex:D,direction:H,absOffsetX:$}=a;if(d.projections[y])return d.projections[y];const X=new l.P(p.getx(y),p.gety(y)),oe=ae(X,g,P);if(oe.signedDistanceFromCamera>0)return d.projections[y]=oe.point,oe.point;const ye=y-H;return Se(A===0?x:new l.P(p.getx(ye),p.gety(ye)),X,D,$-A+1,g,P)}function Pe(y,a,d){return y._unit()._perp()._mult(a*d)}function Ye(y,a,d,p,g,x,A,P){const{projectionCache:D,direction:H}=P;if(D.offsets[y])return D.offsets[y];const $=d.add(a);if(y+H<p||y+H>=g)return D.offsets[y]=$,$;const X=ge(y+H,P),oe=Pe(X.sub(d),A,H),ye=d.add(oe),ve=X.add(oe);return D.offsets[y]=l.ak(x,$,ye,ve)||$,D.offsets[y]}function Ke(y,a,d,p,g,x,A,P,D,H,$,X,oe,ye){const ve=p?y-a:y+a;let be=ve>0?1:-1,de=0;p&&(be*=-1,de=Math.PI),be<0&&(de+=Math.PI);let Le,Je,Me=be>0?P+A:P+A+1,Oe=g,et=g,nt=0,ut=0;const St=Math.abs(ve),yt=[];let xt;for(;nt+ut<=St;){if(Me+=be,Me<P||Me>=D)return null;nt+=ut,et=Oe,Je=Le;const Nt={projectionCache:X,lineVertexArray:H,labelPlaneMatrix:$,tileAnchorPoint:x,distanceFromAnchor:nt,getElevation:ye,previousVertex:et,direction:be,absOffsetX:St};if(Oe=ge(Me,Nt),d===0)yt.push(et),xt=Oe.sub(et);else{let An;const On=Oe.sub(et);An=On.mag()===0?Pe(ge(Me+be,Nt).sub(Oe),d,be):Pe(On,d,be),Je||(Je=et.add(An)),Le=Ye(Me,An,Oe,P,D,Je,d,Nt),yt.push(Je),xt=Le.sub(Je)}ut=xt.mag()}const Yt=xt._mult((St-nt)/ut)._add(Je||et),Bn=de+Math.atan2(Oe.y-et.y,Oe.x-et.x);return yt.push(Yt),{point:Yt,angle:oe?Bn:0,path:yt}}const Xe=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Pt(y,a){for(let d=0;d<y;d++){const p=a.length;a.resize(p+4),a.float32.set(Xe,3*p)}}function en(y,a,d){const p=a[0],g=a[1];return y[0]=d[0]*p+d[4]*g+d[12],y[1]=d[1]*p+d[5]*g+d[13],y[3]=d[3]*p+d[7]*g+d[15],y}const an=100;class bn{constructor(a,d=new ze(a.width+200,a.height+200,25),p=new ze(a.width+200,a.height+200,25)){this.transform=a,this.grid=d,this.ignoredGrid=p,this.pitchfactor=Math.cos(a._pitch)*a.cameraToCenterDistance,this.screenRightBoundary=a.width+an,this.screenBottomBoundary=a.height+an,this.gridRightBoundary=a.width+200,this.gridBottomBoundary=a.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(a,d,p,g,x,A){const P=this.projectAndGetPerspectiveRatio(g,a.anchorPointX,a.anchorPointY,A),D=p*P.perspectiveRatio,H=a.x1*D+P.point.x,$=a.y1*D+P.point.y,X=a.x2*D+P.point.x,oe=a.y2*D+P.point.y;return!this.isInsideGrid(H,$,X,oe)||d!=="always"&&this.grid.hitTest(H,$,X,oe,d,x)||P.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[H,$,X,oe],offscreen:this.isOffscreen(H,$,X,oe)}}placeCollisionCircles(a,d,p,g,x,A,P,D,H,$,X,oe,ye,ve){const be=[],de=new l.P(d.anchorX,d.anchorY),Le=ae(de,A,ve),Je=F(this.transform.cameraToCenterDistance,Le.signedDistanceFromCamera),Me=($?x/Je:x*Je)/l.ao,Oe=ae(de,P,ve).point,et=te(Me,g,d.lineOffsetX*Me,d.lineOffsetY*Me,!1,Oe,de,d,p,P,{projections:{},offsets:{}},!1,ve);let nt=!1,ut=!1,St=!0;if(et){const yt=.5*oe*Je+ye,xt=new l.P(-100,-100),Yt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),Bn=new yn,Nt=et.first,An=et.last;let On=[];for(let Vn=Nt.path.length-1;Vn>=1;Vn--)On.push(Nt.path[Vn]);for(let Vn=1;Vn<An.path.length;Vn++)On.push(An.path[Vn]);const Xn=2.5*yt;if(D){const Vn=On.map(Hn=>ae(Hn,D,ve));On=Vn.some(Hn=>Hn.signedDistanceFromCamera<=0)?[]:Vn.map(Hn=>Hn.point)}let In=[];if(On.length>0){const Vn=On[0].clone(),Hn=On[0].clone();for(let Ar=1;Ar<On.length;Ar++)Vn.x=Math.min(Vn.x,On[Ar].x),Vn.y=Math.min(Vn.y,On[Ar].y),Hn.x=Math.max(Hn.x,On[Ar].x),Hn.y=Math.max(Hn.y,On[Ar].y);In=Vn.x>=xt.x&&Hn.x<=Yt.x&&Vn.y>=xt.y&&Hn.y<=Yt.y?[On]:Hn.x<xt.x||Vn.x>Yt.x||Hn.y<xt.y||Vn.y>Yt.y?[]:l.al([On],xt.x,xt.y,Yt.x,Yt.y)}for(const Vn of In){Bn.reset(Vn,.25*yt);let Hn=0;Hn=Bn.length<=.5*yt?1:Math.ceil(Bn.paddedLength/Xn)+1;for(let Ar=0;Ar<Hn;Ar++){const dr=Ar/Math.max(Hn-1,1),Xi=Bn.lerp(dr),Yr=Xi.x+an,gr=Xi.y+an;be.push(Yr,gr,yt,0);const Ai=Yr-yt,Va=gr-yt,cs=Yr+yt,Fo=gr+yt;if(St=St&&this.isOffscreen(Ai,Va,cs,Fo),ut=ut||this.isInsideGrid(Ai,Va,cs,Fo),a!=="always"&&this.grid.hitTestCircle(Yr,gr,yt,a,X)&&(nt=!0,!H))return{circles:[],offscreen:!1,collisionDetected:nt}}}}return{circles:!H&&nt||!ut||Je<this.perspectiveRatioCutoff?[]:be,offscreen:St,collisionDetected:nt}}queryRenderedSymbols(a){if(a.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let p=1/0,g=1/0,x=-1/0,A=-1/0;for(const $ of a){const X=new l.P($.x+an,$.y+an);p=Math.min(p,X.x),g=Math.min(g,X.y),x=Math.max(x,X.x),A=Math.max(A,X.y),d.push(X)}const P=this.grid.query(p,g,x,A).concat(this.ignoredGrid.query(p,g,x,A)),D={},H={};for(const $ of P){const X=$.key;if(D[X.bucketInstanceId]===void 0&&(D[X.bucketInstanceId]={}),D[X.bucketInstanceId][X.featureIndex])continue;const oe=[new l.P($.x1,$.y1),new l.P($.x2,$.y1),new l.P($.x2,$.y2),new l.P($.x1,$.y2)];l.am(d,oe)&&(D[X.bucketInstanceId][X.featureIndex]=!0,H[X.bucketInstanceId]===void 0&&(H[X.bucketInstanceId]=[]),H[X.bucketInstanceId].push(X.featureIndex))}return H}insertCollisionBox(a,d,p,g,x,A){(p?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:x,collisionGroupID:A,overlapMode:d},a[0],a[1],a[2],a[3])}insertCollisionCircles(a,d,p,g,x,A){const P=p?this.ignoredGrid:this.grid,D={bucketInstanceId:g,featureIndex:x,collisionGroupID:A,overlapMode:d};for(let H=0;H<a.length;H+=4)P.insertCircle(D,a[H],a[H+1],a[H+2])}projectAndGetPerspectiveRatio(a,d,p,g){let x;return g?(x=[d,p,g(d,p),1],l.af(x,x,a)):(x=[d,p,0,1],en(x,x,a)),{point:new l.P((x[0]/x[3]+1)/2*this.transform.width+an,(-x[1]/x[3]+1)/2*this.transform.height+an),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(a,d,p,g){return p<an||a>=this.screenRightBoundary||g<an||d>this.screenBottomBoundary}isInsideGrid(a,d,p,g){return p>=0&&a<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const a=l.an([]);return l.H(a,a,[-100,-100,0]),a}}function Mn(y,a,d){return a*(l.W/(y.tileSize*Math.pow(2,d-y.tileID.overscaledZ)))}class sr{constructor(a,d,p,g){this.opacity=a?Math.max(0,Math.min(1,a.opacity+(a.placed?d:-d))):g&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ue{constructor(a,d,p,g,x){this.text=new sr(a?a.text:null,d,p,x),this.icon=new sr(a?a.icon:null,d,g,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ne{constructor(a,d,p){this.text=a,this.icon=d,this.skipFade=p}}class Ve{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class $e{constructor(a,d,p,g,x){this.bucketInstanceId=a,this.featureIndex=d,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=x}}class Ze{constructor(a){this.crossSourceCollisions=a,this.maxGroupID=0,this.collisionGroups={}}get(a){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[a]){const d=++this.maxGroupID;this.collisionGroups[a]={ID:d,predicate:p=>p.collisionGroupID===d}}return this.collisionGroups[a]}}function Lt(y,a,d,p,g){const{horizontalAlign:x,verticalAlign:A}=l.at(y);return new l.P(-(x-.5)*a+p[0]*g,-(A-.5)*d+p[1]*g)}function Wt(y,a,d,p,g,x){const{x1:A,x2:P,y1:D,y2:H,anchorPointX:$,anchorPointY:X}=y,oe=new l.P(a,d);return p&&oe._rotate(g?x:-x),{x1:A+oe.x,y1:D+oe.y,x2:P+oe.x,y2:H+oe.y,anchorPointX:$,anchorPointY:X}}class Kt{constructor(a,d,p,g,x){this.transform=a.clone(),this.terrain=d,this.collisionIndex=new bn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=p,this.retainedQueryData={},this.collisionGroups=new Ze(g),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(a,d,p,g){const x=p.getBucket(d),A=p.latestFeatureIndex;if(!x||!A||d.id!==x.layerIds[0])return;const P=p.collisionBoxArray,D=x.layers[0].layout,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),$=p.tileSize/l.W,X=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),oe=D.get("text-pitch-alignment")==="map",ye=D.get("text-rotation-alignment")==="map",ve=Mn(p,1,this.transform.zoom),be=Qe(X,oe,ye,this.transform,ve);let de=null;if(oe){const Je=bt(X,oe,ye,this.transform,ve);de=l.K([],this.transform.labelPlaneMatrix,Je)}this.retainedQueryData[x.bucketInstanceId]=new $e(x.bucketInstanceId,A,x.sourceLayerIndex,x.index,p.tileID);const Le={bucket:x,layout:D,posMatrix:X,textLabelPlaneMatrix:be,labelToScreenMatrix:de,scale:H,textPixelRatio:$,holdingForFade:p.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:l.ag(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(g)for(const Je of x.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:Oe,symbolInstanceEnd:et}=Je;a.push({sortKey:Me,symbolInstanceStart:Oe,symbolInstanceEnd:et,parameters:Le})}else a.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Le})}attemptAnchorPlacement(a,d,p,g,x,A,P,D,H,$,X,oe,ye,ve,be,de){const Le=l.ap[a.textAnchor],Je=[a.textOffset0,a.textOffset1],Me=Lt(Le,p,g,Je,x),Oe=this.collisionIndex.placeCollisionBox(Wt(d,Me.x,Me.y,A,P,this.transform.angle),X,D,H,$.predicate,de);if((!be||this.collisionIndex.placeCollisionBox(Wt(be,Me.x,Me.y,A,P,this.transform.angle),X,D,H,$.predicate,de).box.length!==0)&&Oe.box.length>0){let et;if(this.prevPlacement&&this.prevPlacement.variableOffsets[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID]&&this.prevPlacement.placements[oe.crossTileID].text&&(et=this.prevPlacement.variableOffsets[oe.crossTileID].anchor),oe.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[oe.crossTileID]={textOffset:Je,width:p,height:g,anchor:Le,textBoxScale:x,prevAnchor:et},this.markUsedJustification(ye,Le,oe,ve),ye.allowVerticalPlacement&&(this.markUsedOrientation(ye,ve,oe),this.placedOrientations[oe.crossTileID]=ve),{shift:Me,placedGlyphBoxes:Oe}}}placeLayerBucketPart(a,d,p){const{bucket:g,layout:x,posMatrix:A,textLabelPlaneMatrix:P,labelToScreenMatrix:D,textPixelRatio:H,holdingForFade:$,collisionBoxArray:X,partiallyEvaluatedTextSize:oe,collisionGroup:ye}=a.parameters,ve=x.get("text-optional"),be=x.get("icon-optional"),de=l.aq(x,"text-overlap","text-allow-overlap"),Le=de==="always",Je=l.aq(x,"icon-overlap","icon-allow-overlap"),Me=Je==="always",Oe=x.get("text-rotation-alignment")==="map",et=x.get("text-pitch-alignment")==="map",nt=x.get("icon-text-fit")!=="none",ut=x.get("symbol-z-order")==="viewport-y",St=Le&&(Me||!g.hasIconData()||be),yt=Me&&(Le||!g.hasTextData()||ve);!g.collisionArrays&&X&&g.deserializeCollisionBoxes(X);const xt=this.retainedQueryData[g.bucketInstanceId].tileID,Yt=this.terrain?(Nt,An)=>this.terrain.getElevation(xt,Nt,An):null,Bn=(Nt,An)=>{var On,Xn;if(d[Nt.crossTileID])return;if($)return void(this.placements[Nt.crossTileID]=new Ne(!1,!1,!1));let In=!1,Vn=!1,Hn=!0,Ar=null,dr={box:null,offscreen:null},Xi={box:null,offscreen:null},Yr=null,gr=null,Ai=null,Va=0,cs=0,Fo=0;An.textFeatureIndex?Va=An.textFeatureIndex:Nt.useRuntimeCollisionCircles&&(Va=Nt.featureIndex),An.verticalTextFeatureIndex&&(cs=An.verticalTextFeatureIndex);const No=An.textBox;if(No){const kr=Mr=>{let fi=l.ah.horizontal;if(g.allowVerticalPlacement&&!Mr&&this.prevPlacement){const ca=this.prevPlacement.placedOrientations[Nt.crossTileID];ca&&(this.placedOrientations[Nt.crossTileID]=ca,fi=ca,this.markUsedOrientation(g,fi,Nt))}return fi},xr=(Mr,fi)=>{if(g.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&An.verticalTextBox){for(const ca of g.writingModes)if(ca===l.ah.vertical?(dr=fi(),Xi=dr):dr=Mr(),dr&&dr.box&&dr.box.length)break}else dr=Mr()},Br=Nt.textAnchorOffsetStartIndex,Ol=Nt.textAnchorOffsetEndIndex;if(Ol===Br){const Mr=(fi,ca)=>{const Wn=this.collisionIndex.placeCollisionBox(fi,de,H,A,ye.predicate,Yt);return Wn&&Wn.box&&Wn.box.length&&(this.markUsedOrientation(g,ca,Nt),this.placedOrientations[Nt.crossTileID]=ca),Wn};xr(()=>Mr(No,l.ah.horizontal),()=>{const fi=An.verticalTextBox;return g.allowVerticalPlacement&&Nt.numVerticalGlyphVertices>0&&fi?Mr(fi,l.ah.vertical):{box:null,offscreen:null}}),kr(dr&&dr.box&&dr.box.length)}else{let Mr=l.ap[(Xn=(On=this.prevPlacement)===null||On===void 0?void 0:On.variableOffsets[Nt.crossTileID])===null||Xn===void 0?void 0:Xn.anchor];const fi=(Wn,Vf,Sm)=>{const Bo=Wn.x2-Wn.x1,Oo=Wn.y2-Wn.y1,xh=Nt.textBoxScale,Hf=nt&&Je==="never"?Vf:null;let Uo={box:[],offscreen:!1},Mm=de==="never"?1:2,Gf="never";Mr&&Mm++;for(let Tm=0;Tm<Mm;Tm++){for(let tu=Br;tu<Ol;tu++){const Em=g.textAnchorOffsets.get(tu);if(Mr&&Em.textAnchor!==Mr)continue;const nu=this.attemptAnchorPlacement(Em,Wn,Bo,Oo,xh,Oe,et,H,A,ye,Gf,Nt,g,Sm,Hf,Yt);if(nu&&(Uo=nu.placedGlyphBoxes,Uo&&Uo.box&&Uo.box.length))return In=!0,Ar=nu.shift,Uo}Mr?Mr=null:Gf=de}return Uo};xr(()=>fi(No,An.iconBox,l.ah.horizontal),()=>{const Wn=An.verticalTextBox;return g.allowVerticalPlacement&&!(dr&&dr.box&&dr.box.length)&&Nt.numVerticalGlyphVertices>0&&Wn?fi(Wn,An.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),dr&&(In=dr.box,Hn=dr.offscreen);const ca=kr(dr&&dr.box);if(!In&&this.prevPlacement){const Wn=this.prevPlacement.variableOffsets[Nt.crossTileID];Wn&&(this.variableOffsets[Nt.crossTileID]=Wn,this.markUsedJustification(g,Wn.anchor,Nt,ca))}}}if(Yr=dr,In=Yr&&Yr.box&&Yr.box.length>0,Hn=Yr&&Yr.offscreen,Nt.useRuntimeCollisionCircles){const kr=g.text.placedSymbolArray.get(Nt.centerJustifiedTextSymbolIndex),xr=l.ai(g.textSizeData,oe,kr),Br=x.get("text-padding");gr=this.collisionIndex.placeCollisionCircles(de,kr,g.lineVertexArray,g.glyphOffsetArray,xr,A,P,D,p,et,ye.predicate,Nt.collisionCircleDiameter,Br,Yt),gr.circles.length&&gr.collisionDetected&&!p&&l.w("Collisions detected, but collision boxes are not shown"),In=Le||gr.circles.length>0&&!gr.collisionDetected,Hn=Hn&&gr.offscreen}if(An.iconFeatureIndex&&(Fo=An.iconFeatureIndex),An.iconBox){const kr=xr=>{const Br=nt&&Ar?Wt(xr,Ar.x,Ar.y,Oe,et,this.transform.angle):xr;return this.collisionIndex.placeCollisionBox(Br,Je,H,A,ye.predicate,Yt)};Xi&&Xi.box&&Xi.box.length&&An.verticalIconBox?(Ai=kr(An.verticalIconBox),Vn=Ai.box.length>0):(Ai=kr(An.iconBox),Vn=Ai.box.length>0),Hn=Hn&&Ai.offscreen}const us=ve||Nt.numHorizontalGlyphVertices===0&&Nt.numVerticalGlyphVertices===0,Ha=be||Nt.numIconVertices===0;if(us||Ha?Ha?us||(Vn=Vn&&In):In=Vn&&In:Vn=In=Vn&&In,In&&Yr&&Yr.box&&this.collisionIndex.insertCollisionBox(Yr.box,de,x.get("text-ignore-placement"),g.bucketInstanceId,Xi&&Xi.box&&cs?cs:Va,ye.ID),Vn&&Ai&&this.collisionIndex.insertCollisionBox(Ai.box,Je,x.get("icon-ignore-placement"),g.bucketInstanceId,Fo,ye.ID),gr&&(In&&this.collisionIndex.insertCollisionCircles(gr.circles,de,x.get("text-ignore-placement"),g.bucketInstanceId,Va,ye.ID),p)){const kr=g.bucketInstanceId;let xr=this.collisionCircleArrays[kr];xr===void 0&&(xr=this.collisionCircleArrays[kr]=new Ve);for(let Br=0;Br<gr.circles.length;Br+=4)xr.circles.push(gr.circles[Br+0]),xr.circles.push(gr.circles[Br+1]),xr.circles.push(gr.circles[Br+2]),xr.circles.push(gr.collisionDetected?1:0)}if(Nt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Nt.crossTileID]=new Ne(In||St,Vn||yt,Hn||g.justReloaded),d[Nt.crossTileID]=!0};if(ut){if(a.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Nt=g.getSortedSymbolIndexes(this.transform.angle);for(let An=Nt.length-1;An>=0;--An){const On=Nt[An];Bn(g.symbolInstances.get(On),g.collisionArrays[On])}}else for(let Nt=a.symbolInstanceStart;Nt<a.symbolInstanceEnd;Nt++)Bn(g.symbolInstances.get(Nt),g.collisionArrays[Nt]);if(p&&g.bucketInstanceId in this.collisionCircleArrays){const Nt=this.collisionCircleArrays[g.bucketInstanceId];l.ar(Nt.invProjMatrix,A),Nt.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(a,d,p,g){let x;x=g===l.ah.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[l.as(d)];const A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];for(const P of A)P>=0&&(a.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:p.crossTileID)}markUsedOrientation(a,d,p){const g=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,x=d===l.ah.vertical?d:0,A=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];for(const P of A)a.text.placedSymbolArray.get(P).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(a.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(a){this.commitTime=a,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let p=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(a):1,x=d?d.opacities:{},A=d?d.variableOffsets:{},P=d?d.placedOrientations:{};for(const D in this.placements){const H=this.placements[D],$=x[D];$?(this.opacities[D]=new ue($,g,H.text,H.icon),p=p||H.text!==$.text.placed||H.icon!==$.icon.placed):(this.opacities[D]=new ue(null,g,H.text,H.icon,H.skipFade),p=p||H.text||H.icon)}for(const D in x){const H=x[D];if(!this.opacities[D]){const $=new ue(H,g,!1,!1);$.isHidden()||(this.opacities[D]=$,p=p||H.text.placed||H.icon.placed)}}for(const D in A)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=A[D]);for(const D in P)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=P[D]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");p?this.lastPlacementChangeTime=a:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:a)}updateLayerOpacities(a,d){const p={};for(const g of d){const x=g.getBucket(a);x&&g.latestFeatureIndex&&a.id===x.layerIds[0]&&this.updateBucketOpacities(x,p,g.collisionBoxArray)}}updateBucketOpacities(a,d,p){a.hasTextData()&&(a.text.opacityVertexArray.clear(),a.text.hasVisibleVertices=!1),a.hasIconData()&&(a.icon.opacityVertexArray.clear(),a.icon.hasVisibleVertices=!1),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexArray.clear(),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexArray.clear();const g=a.layers[0],x=g.layout,A=new ue(null,0,!1,!1,!0),P=x.get("text-allow-overlap"),D=x.get("icon-allow-overlap"),H=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=x.get("text-rotation-alignment")==="map",X=x.get("text-pitch-alignment")==="map",oe=x.get("icon-text-fit")!=="none",ye=new ue(null,0,P&&(D||!a.hasIconData()||x.get("icon-optional")),D&&(P||!a.hasTextData()||x.get("text-optional")),!0);!a.collisionArrays&&p&&(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData())&&a.deserializeCollisionBoxes(p);const ve=(be,de,Le)=>{for(let Je=0;Je<de/4;Je++)be.opacityVertexArray.emplaceBack(Le);be.hasVisibleVertices=be.hasVisibleVertices||Le!==wn};for(let be=0;be<a.symbolInstances.length;be++){const de=a.symbolInstances.get(be),{numHorizontalGlyphVertices:Le,numVerticalGlyphVertices:Je,crossTileID:Me}=de;let Oe=this.opacities[Me];d[Me]?Oe=A:Oe||(Oe=ye,this.opacities[Me]=Oe),d[Me]=!0;const et=de.numIconVertices>0,nt=this.placedOrientations[de.crossTileID],ut=nt===l.ah.vertical,St=nt===l.ah.horizontal||nt===l.ah.horizontalOnly;if(Le>0||Je>0){const yt=ar(Oe.text);ve(a.text,Le,ut?wn:yt),ve(a.text,Je,St?wn:yt);const xt=Oe.text.isHidden();[de.rightJustifiedTextSymbolIndex,de.centerJustifiedTextSymbolIndex,de.leftJustifiedTextSymbolIndex].forEach(Nt=>{Nt>=0&&(a.text.placedSymbolArray.get(Nt).hidden=xt||ut?1:0)}),de.verticalPlacedTextSymbolIndex>=0&&(a.text.placedSymbolArray.get(de.verticalPlacedTextSymbolIndex).hidden=xt||St?1:0);const Yt=this.variableOffsets[de.crossTileID];Yt&&this.markUsedJustification(a,Yt.anchor,de,nt);const Bn=this.placedOrientations[de.crossTileID];Bn&&(this.markUsedJustification(a,"left",de,Bn),this.markUsedOrientation(a,Bn,de))}if(et){const yt=ar(Oe.icon),xt=!(oe&&de.verticalPlacedIconSymbolIndex&&ut);de.placedIconSymbolIndex>=0&&(ve(a.icon,de.numIconVertices,xt?yt:wn),a.icon.placedSymbolArray.get(de.placedIconSymbolIndex).hidden=Oe.icon.isHidden()),de.verticalPlacedIconSymbolIndex>=0&&(ve(a.icon,de.numVerticalIconVertices,xt?wn:yt),a.icon.placedSymbolArray.get(de.verticalPlacedIconSymbolIndex).hidden=Oe.icon.isHidden())}if(a.hasIconCollisionBoxData()||a.hasTextCollisionBoxData()){const yt=a.collisionArrays[be];if(yt){let xt=new l.P(0,0);if(yt.textBox||yt.verticalTextBox){let Bn=!0;if(H){const Nt=this.variableOffsets[Me];Nt?(xt=Lt(Nt.anchor,Nt.width,Nt.height,Nt.textOffset,Nt.textBoxScale),$&&xt._rotate(X?this.transform.angle:-this.transform.angle)):Bn=!1}yt.textBox&&It(a.textCollisionBox.collisionVertexArray,Oe.text.placed,!Bn||ut,xt.x,xt.y),yt.verticalTextBox&&It(a.textCollisionBox.collisionVertexArray,Oe.text.placed,!Bn||St,xt.x,xt.y)}const Yt=!!(!St&&yt.verticalIconBox);yt.iconBox&&It(a.iconCollisionBox.collisionVertexArray,Oe.icon.placed,Yt,oe?xt.x:0,oe?xt.y:0),yt.verticalIconBox&&It(a.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!Yt,oe?xt.x:0,oe?xt.y:0)}}}if(a.sortFeatures(this.transform.angle),this.retainedQueryData[a.bucketInstanceId]&&(this.retainedQueryData[a.bucketInstanceId].featureSortOrder=a.featureSortOrder),a.hasTextData()&&a.text.opacityVertexBuffer&&a.text.opacityVertexBuffer.updateData(a.text.opacityVertexArray),a.hasIconData()&&a.icon.opacityVertexBuffer&&a.icon.opacityVertexBuffer.updateData(a.icon.opacityVertexArray),a.hasIconCollisionBoxData()&&a.iconCollisionBox.collisionVertexBuffer&&a.iconCollisionBox.collisionVertexBuffer.updateData(a.iconCollisionBox.collisionVertexArray),a.hasTextCollisionBoxData()&&a.textCollisionBox.collisionVertexBuffer&&a.textCollisionBox.collisionVertexBuffer.updateData(a.textCollisionBox.collisionVertexArray),a.text.opacityVertexArray.length!==a.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${a.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${a.text.layoutVertexArray.length}) / 4`);if(a.icon.opacityVertexArray.length!==a.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${a.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${a.icon.layoutVertexArray.length}) / 4`);if(a.bucketInstanceId in this.collisionCircleArrays){const be=this.collisionCircleArrays[a.bucketInstanceId];a.placementInvProjMatrix=be.invProjMatrix,a.placementViewportMatrix=be.viewportMatrix,a.collisionCircleArray=be.circles,delete this.collisionCircleArrays[a.bucketInstanceId]}}symbolFadeChange(a){return this.fadeDuration===0?1:(a-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(a){return Math.max(0,(this.transform.zoom-a)/1.5)}hasTransitions(a){return this.stale||a-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(a,d){const p=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*p>a}setStale(){this.stale=!0}}function It(y,a,d,p,g){y.emplaceBack(a?1:0,d?1:0,p||0,g||0),y.emplaceBack(a?1:0,d?1:0,p||0,g||0),y.emplaceBack(a?1:0,d?1:0,p||0,g||0),y.emplaceBack(a?1:0,d?1:0,p||0,g||0)}const tn=Math.pow(2,25),En=Math.pow(2,24),nn=Math.pow(2,17),yr=Math.pow(2,16),Zr=Math.pow(2,9),fr=Math.pow(2,8),Rr=Math.pow(2,1);function ar(y){if(y.opacity===0&&!y.placed)return 0;if(y.opacity===1&&y.placed)return 4294967295;const a=y.placed?1:0,d=Math.floor(127*y.opacity);return d*tn+a*En+d*nn+a*yr+d*Zr+a*fr+d*Rr+a}const wn=0;class hi{constructor(a){this._sortAcrossTiles=a.layout.get("symbol-z-order")!=="viewport-y"&&!a.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(a,d,p,g,x){const A=this._bucketParts;for(;this._currentTileIndex<a.length;)if(d.getBucketParts(A,g,a[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,A.sort((P,D)=>P.sortKey-D.sortKey));this._currentPartIndex<A.length;)if(d.placeLayerBucketPart(A[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,x())return!0;return!1}}class pr{constructor(a,d,p,g,x,A,P,D){this.placement=new Kt(a,d,A,P,D),this._currentPlacementIndex=p.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(a,d,p){const g=T.now(),x=()=>!this._forceFullPlacement&&T.now()-g>2;for(;this._currentPlacementIndex>=0;){const A=d[a[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(A.type==="symbol"&&(!A.minzoom||A.minzoom<=P)&&(!A.maxzoom||A.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new hi(A)),this._inProgressLayer.continuePlacement(p[A.source],this.placement,this._showCollisionBoxes,A,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(a){return this.placement.commit(a),this.placement}}const Ti=512/l.W/2;class Ir{constructor(a,d,p){this.tileID=a,this.bucketInstanceId=p,this._symbolsByKey={};const g=new Map;for(let x=0;x<d.length;x++){const A=d.get(x),P=A.key,D=g.get(P);D?D.push(A):g.set(P,[A])}for(const[x,A]of g){const P={positions:A.map(D=>({x:Math.floor(D.anchorX*Ti),y:Math.floor(D.anchorY*Ti)})),crossTileIDs:A.map(D=>D.crossTileID)};if(P.positions.length>128){const D=new l.au(P.positions.length,16,Uint16Array);for(const{x:H,y:$}of P.positions)D.add(H,$);D.finish(),delete P.positions,P.index=D}this._symbolsByKey[x]=P}}getScaledCoordinates(a,d){const{x:p,y:g,z:x}=this.tileID.canonical,{x:A,y:P,z:D}=d.canonical,H=Ti/Math.pow(2,D-x),$=(P*l.W+a.anchorY)*H,X=g*l.W*Ti;return{x:Math.floor((A*l.W+a.anchorX)*H-p*l.W*Ti),y:Math.floor($-X)}}findMatches(a,d,p){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let x=0;x<a.length;x++){const A=a.get(x);if(A.crossTileID)continue;const P=this._symbolsByKey[A.key];if(!P)continue;const D=this.getScaledCoordinates(A,d);if(P.index){const H=P.index.range(D.x-g,D.y-g,D.x+g,D.y+g).sort();for(const $ of H){const X=P.crossTileIDs[$];if(!p[X]){p[X]=!0,A.crossTileID=X;break}}}else if(P.positions)for(let H=0;H<P.positions.length;H++){const $=P.positions[H],X=P.crossTileIDs[H];if(Math.abs($.x-D.x)<=g&&Math.abs($.y-D.y)<=g&&!p[X]){p[X]=!0,A.crossTileID=X;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:a})=>a)}}class Na{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ba{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(a){const d=Math.round((a-this.lng)/360);if(d!==0)for(const p in this.indexes){const g=this.indexes[p],x={};for(const A in g){const P=g[A];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+d),x[P.tileID.key]=P}this.indexes[p]=x}this.lng=a}addBucket(a,d,p){if(this.indexes[a.overscaledZ]&&this.indexes[a.overscaledZ][a.key]){if(this.indexes[a.overscaledZ][a.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(a.overscaledZ,this.indexes[a.overscaledZ][a.key])}for(let x=0;x<d.symbolInstances.length;x++)d.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[a.overscaledZ]||(this.usedCrossTileIDs[a.overscaledZ]={});const g=this.usedCrossTileIDs[a.overscaledZ];for(const x in this.indexes){const A=this.indexes[x];if(Number(x)>a.overscaledZ)for(const P in A){const D=A[P];D.tileID.isChildOf(a)&&D.findMatches(d.symbolInstances,a,g)}else{const P=A[a.scaledTo(Number(x)).key];P&&P.findMatches(d.symbolInstances,a,g)}}for(let x=0;x<d.symbolInstances.length;x++){const A=d.symbolInstances.get(x);A.crossTileID||(A.crossTileID=p.generate(),g[A.crossTileID]=!0)}return this.indexes[a.overscaledZ]===void 0&&(this.indexes[a.overscaledZ]={}),this.indexes[a.overscaledZ][a.key]=new Ir(a,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(a,d){for(const p of d.getCrossTileIDsLists())for(const g of p)delete this.usedCrossTileIDs[a][g]}removeStaleBuckets(a){let d=!1;for(const p in this.indexes){const g=this.indexes[p];for(const x in g)a[g[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[x]),delete g[x],d=!0)}return d}}class $n{constructor(){this.layerIndexes={},this.crossTileIDs=new Na,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(a,d,p){let g=this.layerIndexes[a.id];g===void 0&&(g=this.layerIndexes[a.id]=new Ba);let x=!1;const A={};g.handleWrapJump(p);for(const P of d){const D=P.getBucket(a);D&&a.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(P.tileID,D,this.crossTileIDs)&&(x=!0),A[D.bucketInstanceId]=!0)}return g.removeStaleBuckets(A)&&(x=!0),x}pruneUnusedLayers(a){const d={};a.forEach(p=>{d[p]=!0});for(const p in this.layerIndexes)d[p]||delete this.layerIndexes[p]}}const Ei=(y,a)=>l.t(y,a&&a.filter(d=>d.identifier!=="source.canvas")),zi=l.av();class vi extends l.E{constructor(a,d={}){super(),this._rtlPluginLoaded=()=>{for(const p in this.sourceCaches){const g=this.sourceCaches[p].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[p].reload()}},this.map=a,this.dispatcher=new Dn(Sn(),a._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(p,g)=>this.getGlyphs(p,g)),this.dispatcher.registerMessageHandler("getImages",(p,g)=>this.getImages(p,g)),this.imageManager=new We,this.imageManager.setEventedParent(this),this.glyphManager=new ke(a._requestManager,d.localIdeographFontFamily),this.lineAtlas=new kt(256,512),this.crossTileSymbolIndex=new $n,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.ax()),on().on(Ht,this._rtlPluginLoaded),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const A in this._layers){const P=this._layers[A];P.source===x.id&&this._validateLayer(P)}})}loadURL(a,d={},p){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(a,Y.Style);this._loadStyleRequest=new AbortController,l.h(g,this._loadStyleRequest).then(x=>{this._loadStyleRequest=null,this._load(x.data,d,p)}).catch(x=>{this._loadStyleRequest=null,x&&this.fire(new l.j(x))})}loadJSON(a,d={},p){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(a,d,p)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(zi,{validate:!1})}_load(a,d,p){var g;const x=d.transformStyle?d.transformStyle(p,a):a;if(!d.validate||!Ei(this,l.x(x))){this._loaded=!0,this.stylesheet=x;for(const A in x.sources)this.addSource(A,x.sources[A],{validate:!1});x.sprite?this._loadSprite(x.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(x.glyphs),this._createLayers(),this.light=new _t(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const a=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",a),this._order=a.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of a){const p=l.az(d);p.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=p}}_loadSprite(a,d=!1,p=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(x,A,P,D){return l._(this,void 0,void 0,function*(){const H=Te(x),$=P>1?"@2x":"",X={},oe={};for(const{id:ye,url:ve}of H){const be=A.transformRequest(A.normalizeSpriteURL(ve,$,".json"),Y.SpriteJSON);X[ye]=l.h(be,D);const de=A.transformRequest(A.normalizeSpriteURL(ve,$,".png"),Y.SpriteImage);oe[ye]=V.getImage(de,D)}return yield Promise.all([...Object.values(X),...Object.values(oe)]),function(ye,ve){return l._(this,void 0,void 0,function*(){const be={};for(const de in ye){be[de]={};const Le=T.getImageCanvasContext((yield ve[de]).data),Je=(yield ye[de]).data;for(const Me in Je){const{width:Oe,height:et,x:nt,y:ut,sdf:St,pixelRatio:yt,stretchX:xt,stretchY:Yt,content:Bn}=Je[Me];be[de][Me]={data:null,pixelRatio:yt,sdf:St,stretchX:xt,stretchY:Yt,content:Bn,spriteData:{width:Oe,height:et,x:nt,y:ut,context:Le}}}}return be})}(X,oe)})}(a,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(x=>{if(this._spriteRequest=null,x)for(const A in x){this._spritesImagesIds[A]=[];const P=this._spritesImagesIds[A]?this._spritesImagesIds[A].filter(D=>!(D in x)):[];for(const D of P)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in x[A]){const H=A==="default"?D:`${A}:${D}`;this._spritesImagesIds[A].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,x[A][D],!1):this.imageManager.addImage(H,x[A][D]),d&&(this._changedImages[H]=!0)}}}).catch(x=>{this._spriteRequest=null,g=x,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),p&&p(g)})}_unloadSprite(){for(const a of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(a),this._changedImages[a]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(a){const d=this.sourceCaches[a.source];if(!d)return;const p=a.sourceLayer;if(!p)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(p)===-1)&&this.fire(new l.j(new Error(`Source layer "${p}" does not exist on source "${g.id}" as specified by style layer "${a.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const a in this.sourceCaches)if(!this.sourceCaches[a].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(a){const d=this._serializedAllLayers();if(!a||a.length===0)return Object.values(d);const p=[];for(const g of a)d[g]&&p.push(d[g]);return p}_serializedAllLayers(){let a=this._serializedLayers;if(a)return a;a=this._serializedLayers={};const d=Object.keys(this._layers);for(const p of d){const g=this._layers[p];g.type!=="custom"&&(a[p]=g.serialize())}return a}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const a in this.sourceCaches)if(this.sourceCaches[a].hasTransition())return!0;for(const a in this._layers)if(this._layers[a].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(a){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(g.length||x.length)&&this._updateWorkerLayers(g,x);for(const A in this._updatedSources){const P=this._updatedSources[A];if(P==="reload")this._reloadSource(A);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(A)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const A in this._updatedPaintProps)this._layers[A].updateTransitions(a);this.light.updateTransitions(a),this._resetUpdates()}const p={};for(const g in this.sourceCaches){const x=this.sourceCaches[g];p[g]=x.used,x.used=!1}for(const g of this._order){const x=this._layers[g];x.recalculate(a,this._availableImages),!x.isHidden(a.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const g in p){const x=this.sourceCaches[g];p[g]!==x.used&&x.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(a),this.z=a.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const a=Object.keys(this._changedImages);if(a.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],a);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const a in this.sourceCaches)this.sourceCaches[a].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(a,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(a),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(a,d={}){var p;this._checkLoaded();const g=this.serialize();if(a=d.transformStyle?d.transformStyle(g,a):a,((p=d.validate)===null||p===void 0||p)&&Ei(this,l.x(a)))return!1;(a=l.aA(a)).layers=l.ay(a.layers);const x=l.aB(g,a),A=this._getOperationsToPerform(x);if(A.unimplemented.length>0)throw new Error(`Unimplemented: ${A.unimplemented.join(", ")}.`);if(A.operations.length===0)return!1;for(const P of A.operations)P();return this.stylesheet=a,this._serializedLayers=null,!0}_getOperationsToPerform(a){const d=[],p=[];for(const g of a)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:p.push(g.command)}return{operations:d,unimplemented:p}}addImage(a,d){if(this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" already exists.`)));this.imageManager.addImage(a,d),this._afterImageUpdated(a)}updateImage(a,d){this.imageManager.updateImage(a,d)}getImage(a){return this.imageManager.getImage(a)}removeImage(a){if(!this.getImage(a))return this.fire(new l.j(new Error(`An image named "${a}" does not exist.`)));this.imageManager.removeImage(a),this._afterImageUpdated(a)}_afterImageUpdated(a){this._availableImages=this.imageManager.listImages(),this._changedImages[a]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(a,d,p={}){if(this._checkLoaded(),this.sourceCaches[a]!==void 0)throw new Error(`Source "${a}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${a}`,d,null,p))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[a]=new lt(a,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:a})),g.onAdd(this.map),this._changed=!0}removeSource(a){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error("There is no source with this ID");for(const p in this._layers)if(this._layers[p].source===a)return this.fire(new l.j(new Error(`Source "${a}" cannot be removed while layer "${p}" is using it.`)));const d=this.sourceCaches[a];delete this.sourceCaches[a],delete this._updatedSources[a],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:a})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(a,d){if(this._checkLoaded(),this.sourceCaches[a]===void 0)throw new Error(`There is no source with this ID=${a}`);const p=this.sourceCaches[a].getSource();if(p.type!=="geojson")throw new Error(`geojsonSource.type is ${p.type}, which is !== 'geojson`);p.setData(d),this._changed=!0}getSource(a){return this.sourceCaches[a]&&this.sourceCaches[a].getSource()}addLayer(a,d,p={}){this._checkLoaded();const g=a.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let x;if(a.type==="custom"){if(Ei(this,l.aC(a)))return;x=l.az(a)}else{if("source"in a&&typeof a.source=="object"&&(this.addSource(g,a.source),a=l.aA(a),a=l.e(a,{source:g})),this._validate(l.x.layer,`layers.${g}`,a,{arrayIndex:-1},p))return;x=l.az(a),this._validateLayer(x),x.setEventedParent(this,{layer:{id:g}})}const A=d?this._order.indexOf(d):this._order.length;if(d&&A===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(A,0,g),this._layerOrderChanged=!0,this._layers[g]=x,this._removedLayers[g]&&x.source&&x.type!=="custom"){const P=this._removedLayers[g];delete this._removedLayers[g],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(a,d){if(this._checkLoaded(),this._changed=!0,!this._layers[a])return void this.fire(new l.j(new Error(`The layer '${a}' does not exist in the map's style and cannot be moved.`)));if(a===d)return;const p=this._order.indexOf(a);this._order.splice(p,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${a}" before non-existing layer "${d}".`))):(this._order.splice(g,0,a),this._layerOrderChanged=!0)}removeLayer(a){this._checkLoaded();const d=this._layers[a];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${a}".`)));d.setEventedParent(null);const p=this._order.indexOf(a);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[a]=d,delete this._layers[a],this._serializedLayers&&delete this._serializedLayers[a],delete this._updatedLayers[a],delete this._updatedPaintProps[a],d.onRemove&&d.onRemove(this.map)}getLayer(a){return this._layers[a]}getLayersOrder(){return[...this._order]}hasLayer(a){return a in this._layers}setLayerZoomRange(a,d,p){this._checkLoaded();const g=this.getLayer(a);g?g.minzoom===d&&g.maxzoom===p||(d!=null&&(g.minzoom=d),p!=null&&(g.maxzoom=p),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${a}".`)))}setFilter(a,d,p={}){this._checkLoaded();const g=this.getLayer(a);if(g){if(!l.aD(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.x.filter,`layers.${g.id}.filter`,d,null,p)||(g.filter=l.aA(d),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${a}".`)))}getFilter(a){return l.aA(this.getLayer(a).filter)}setLayoutProperty(a,d,p,g={}){this._checkLoaded();const x=this.getLayer(a);x?l.aD(x.getLayoutProperty(d),p)||(x.setLayoutProperty(d,p,g),this._updateLayer(x)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getLayoutProperty(a,d){const p=this.getLayer(a);if(p)return p.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${a}".`)))}setPaintProperty(a,d,p,g={}){this._checkLoaded();const x=this.getLayer(a);x?l.aD(x.getPaintProperty(d),p)||(x.setPaintProperty(d,p,g)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[a]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${a}".`)))}getPaintProperty(a,d){return this.getLayer(a).getPaintProperty(d)}setFeatureState(a,d){this._checkLoaded();const p=a.source,g=a.sourceLayer,x=this.sourceCaches[p];if(x===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const A=x.getSource().type;A==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):A!=="vector"||g?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),x.setFeatureState(g,a.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(a,d){this._checkLoaded();const p=a.source,g=this.sourceCaches[p];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${p}' does not exist in the map's style.`)));const x=g.getSource().type,A=x==="vector"?a.sourceLayer:void 0;x!=="vector"||A?d&&typeof a.id!="string"&&typeof a.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(A,a.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(a){this._checkLoaded();const d=a.source,p=a.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||p?(a.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(p,a.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const a=l.aE(this.sourceCaches,x=>x.serialize()),d=this._serializeByIds(this._order),p=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:a,layers:d,terrain:p},x=>x!==void 0)}_updateLayer(a){this._updatedLayers[a.id]=!0,a.source&&!this._updatedSources[a.source]&&this.sourceCaches[a.source].getSource().type!=="raster"&&(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(a){const d=A=>this._layers[A].type==="fill-extrusion",p={},g=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(d(P)){p[P]=A;for(const D of a){const H=D[P];if(H)for(const $ of H)g.push($)}}}g.sort((A,P)=>P.intersectionZ-A.intersectionZ);const x=[];for(let A=this._order.length-1;A>=0;A--){const P=this._order[A];if(d(P))for(let D=g.length-1;D>=0;D--){const H=g[D].feature;if(p[H.layer.id]<A)break;x.push(H),g.pop()}else for(const D of a){const H=D[P];if(H)for(const $ of H)x.push($.feature)}}return x}queryRenderedFeatures(a,d,p){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const P of d.layers){const D=this._layers[P];if(!D)return this.fire(new l.j(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];g[D.source]=!0}}const x=[];d.availableImages=this._availableImages;const A=this._serializedAllLayers();for(const P in this.sourceCaches)d.layers&&!g[P]||x.push(hn(this.sourceCaches[P],this._layers,A,a,d,p));return this.placement&&x.push(function(P,D,H,$,X,oe,ye){const ve={},be=oe.queryRenderedSymbols($),de=[];for(const Le of Object.keys(be).map(Number))de.push(ye[Le]);de.sort(Gn);for(const Le of de){const Je=Le.featureIndex.lookupSymbolFeatures(be[Le.bucketInstanceId],D,Le.bucketIndex,Le.sourceLayerIndex,X.filter,X.layers,X.availableImages,P);for(const Me in Je){const Oe=ve[Me]=ve[Me]||[],et=Je[Me];et.sort((nt,ut)=>{const St=Le.featureSortOrder;if(St){const yt=St.indexOf(nt.featureIndex);return St.indexOf(ut.featureIndex)-yt}return ut.featureIndex-nt.featureIndex});for(const nt of et)Oe.push(nt)}}for(const Le in ve)ve[Le].forEach(Je=>{const Me=Je.feature,Oe=H[P[Le].source].getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Oe});return ve}(this._layers,A,this.sourceCaches,a,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(a,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const p=this.sourceCaches[a];return p?function(g,x){const A=g.getRenderableIds().map(H=>g.getTileByID(H)),P=[],D={};for(let H=0;H<A.length;H++){const $=A[H],X=$.tileID.canonical.key;D[X]||(D[X]=!0,$.querySourceFeatures(P,x))}return P}(p,d):[]}getLight(){return this.light.getLight()}setLight(a,d={}){this._checkLoaded();const p=this.light.getLight();let g=!1;for(const A in a)if(!l.aD(a[A],p[A])){g=!0;break}if(!g)return;const x={now:T.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(a,d),this.light.updateTransitions(x)}_validate(a,d,p,g,x={}){return(!x||x.validate!==!1)&&Ei(this,a.call(l.x,l.e({key:d,style:this.serialize(),value:p,styleSpec:l.v},g)))}_remove(a=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),on().off(Ht,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const p=this.sourceCaches[d];p.setEventedParent(null),p.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),a&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(a)}_clearSource(a){this.sourceCaches[a].clearTiles()}_reloadSource(a){this.sourceCaches[a].resume(),this.sourceCaches[a].reload()}_updateSources(a){for(const d in this.sourceCaches)this.sourceCaches[d].update(a,this.map.terrain)}_generateCollisionBoxes(){for(const a in this.sourceCaches)this._reloadSource(a)}_updatePlacement(a,d,p,g,x=!1){let A=!1,P=!1;const D={};for(const H of this._order){const $=this._layers[H];if($.type!=="symbol")continue;if(!D[$.source]){const oe=this.sourceCaches[$.source];D[$.source]=oe.getRenderableIds(!0).map(ye=>oe.getTileByID(ye)).sort((ye,ve)=>ve.tileID.overscaledZ-ye.tileID.overscaledZ||(ye.tileID.isLessThan(ve.tileID)?-1:1))}const X=this.crossTileSymbolIndex.addLayer($,D[$.source],a.center.lng);A=A||X}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||p===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(T.now(),a.zoom))&&(this.pauseablePlacement=new pr(a,this.map.terrain,this._order,x,d,p,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(T.now()),P=!0),A&&this.pauseablePlacement.placement.setStale()),P||A)for(const H of this._order){const $=this._layers[H];$.type==="symbol"&&this.placement.updateLayerOpacities($,D[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(T.now())}_releaseSymbolFadeTiles(){for(const a in this.sourceCaches)this.sourceCaches[a].releaseSymbolFadeTiles()}getImages(a,d){return l._(this,void 0,void 0,function*(){const p=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),p})}getGlyphs(a,d){return l._(this,void 0,void 0,function*(){const p=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),p})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(a,d={}){this._checkLoaded(),a&&this._validate(l.x.glyphs,"glyphs",a,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=a,this.glyphManager.entries={},this.glyphManager.setURL(a))}addSprite(a,d,p={},g){this._checkLoaded();const x=[{id:a,url:d}],A=[...Te(this.stylesheet.sprite),...x];this._validate(l.x.sprite,"sprite",A,null,p)||(this.stylesheet.sprite=A,this._loadSprite(x,!0,g))}removeSprite(a){this._checkLoaded();const d=Te(this.stylesheet.sprite);if(d.find(p=>p.id===a)){if(this._spritesImagesIds[a])for(const p of this._spritesImagesIds[a])this.imageManager.removeImage(p),this._changedImages[p]=!0;d.splice(d.findIndex(p=>p.id===a),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[a],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${a}" doesn't exists on this map.`)))}getSprite(){return Te(this.stylesheet.sprite)}setSprite(a,d={},p){this._checkLoaded(),a&&this._validate(l.x.sprite,"sprite",a,null,d)||(this.stylesheet.sprite=a,a?this._loadSprite(a,!0,p):(this._unloadSprite(),p&&p(null)))}}var Wi=l.X([{name:"a_pos",type:"Int16",components:2}]),Bc="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ps={prelude:or(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:or(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:or(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:or(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:or("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:or(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:or(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:or("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:or("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:or("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:or(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:or(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:or(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:or(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:or(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:or(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:or(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:or(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:or(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:or(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:or(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:or(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:or(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:or(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:or(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:or("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Bc),terrainDepth:or("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Bc),terrainCoords:or("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Bc)};function or(y,a){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=a.match(/attribute ([\w]+) ([\w]+)/g),g=y.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=a.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),A=x?x.concat(g):g,P={};return{fragmentSource:y=y.replace(d,(D,H,$,X,oe)=>(P[oe]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
varying ${$} ${X} ${oe};
#else
uniform ${$} ${X} u_${oe};
#endif
`:`
#ifdef HAS_UNIFORM_u_${oe}
    ${$} ${X} ${oe} = u_${oe};
#endif
`)),vertexSource:a=a.replace(d,(D,H,$,X,oe)=>{const ye=X==="float"?"vec2":"vec4",ve=oe.match(/color/)?"color":ye;return P[oe]?H==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
attribute ${$} ${ye} a_${oe};
varying ${$} ${X} ${oe};
#else
uniform ${$} ${X} u_${oe};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = a_${oe};
#else
    ${$} ${X} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${oe} = unpack_mix_${ve}(a_${oe}, u_${oe}_t);
#else
    ${$} ${X} ${oe} = u_${oe};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${oe}
uniform lowp float u_${oe}_t;
attribute ${$} ${ye} a_${oe};
#else
uniform ${$} ${X} u_${oe};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${oe}
    ${$} ${X} ${oe} = a_${oe};
#else
    ${$} ${X} ${oe} = u_${oe};
#endif
`:`
#ifndef HAS_UNIFORM_u_${oe}
    ${$} ${X} ${oe} = unpack_mix_${ve}(a_${oe}, u_${oe}_t);
#else
    ${$} ${X} ${oe} = u_${oe};
#endif
`}),staticAttributes:p,staticUniforms:A}}class Xu{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(a,d,p,g,x,A,P,D,H){this.context=a;let $=this.boundPaintVertexBuffers.length!==g.length;for(let X=0;!$&&X<g.length;X++)this.boundPaintVertexBuffers[X]!==g[X]&&($=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==p||$||this.boundIndexBuffer!==x||this.boundVertexOffset!==A||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==H?this.freshBind(d,p,g,x,A,P,D,H):(a.bindVertexArray.set(this.vao),P&&P.bind(),x&&x.dynamicDraw&&x.bind(),D&&D.bind(),H&&H.bind())}freshBind(a,d,p,g,x,A,P,D){const H=a.numAttributes,$=this.context,X=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=a,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=A,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=D,d.enableAttributes(X,a);for(const oe of p)oe.enableAttributes(X,a);A&&A.enableAttributes(X,a),P&&P.enableAttributes(X,a),D&&D.enableAttributes(X,a),d.bind(),d.setVertexAttribPointers(X,a,x);for(const oe of p)oe.bind(),oe.setVertexAttribPointers(X,a,x);A&&(A.bind(),A.setVertexAttribPointers(X,a,x)),g&&g.bind(),P&&(P.bind(),P.setVertexAttribPointers(X,a,x)),D&&(D.bind(),D.setVertexAttribPointers(X,a,x)),$.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ss(y){const a=[];for(let d=0;d<y.length;d++){if(y[d]===null)continue;const p=y[d].split(" ");a.push(p.pop())}return a}class ef{constructor(a,d,p,g,x,A){const P=a.gl;this.program=P.createProgram();const D=ss(d.staticAttributes),H=p?p.getBinderAttributes():[],$=D.concat(H),X=Ps.prelude.staticUniforms?ss(Ps.prelude.staticUniforms):[],oe=d.staticUniforms?ss(d.staticUniforms):[],ye=p?p.getBinderUniforms():[],ve=X.concat(oe).concat(ye),be=[];for(const nt of ve)be.indexOf(nt)<0&&be.push(nt);const de=p?p.defines():[];x&&de.push("#define OVERDRAW_INSPECTOR;"),A&&de.push("#define TERRAIN3D;");const Le=de.concat(Ps.prelude.fragmentSource,d.fragmentSource).join(`
`),Je=de.concat(Ps.prelude.vertexSource,d.vertexSource).join(`
`),Me=P.createShader(P.FRAGMENT_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Me,Le),P.compileShader(Me),!P.getShaderParameter(Me,P.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${P.getShaderInfoLog(Me)}`);P.attachShader(this.program,Me);const Oe=P.createShader(P.VERTEX_SHADER);if(P.isContextLost())return void(this.failedToCreate=!0);if(P.shaderSource(Oe,Je),P.compileShader(Oe),!P.getShaderParameter(Oe,P.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${P.getShaderInfoLog(Oe)}`);P.attachShader(this.program,Oe),this.attributes={};const et={};this.numAttributes=$.length;for(let nt=0;nt<this.numAttributes;nt++)$[nt]&&(P.bindAttribLocation(this.program,nt,$[nt]),this.attributes[$[nt]]=nt);if(P.linkProgram(this.program),!P.getProgramParameter(this.program,P.LINK_STATUS))throw new Error(`Program failed to link: ${P.getProgramInfoLog(this.program)}`);P.deleteShader(Oe),P.deleteShader(Me);for(let nt=0;nt<be.length;nt++){const ut=be[nt];if(ut&&!et[ut]){const St=P.getUniformLocation(this.program,ut);St&&(et[ut]=St)}}this.fixedUniforms=g(a,et),this.terrainUniforms=((nt,ut)=>({u_depth:new l.aG(nt,ut.u_depth),u_terrain:new l.aG(nt,ut.u_terrain),u_terrain_dim:new l.aH(nt,ut.u_terrain_dim),u_terrain_matrix:new l.aI(nt,ut.u_terrain_matrix),u_terrain_unpack:new l.aJ(nt,ut.u_terrain_unpack),u_terrain_exaggeration:new l.aH(nt,ut.u_terrain_exaggeration)}))(a,et),this.binderUniforms=p?p.getUniforms(a,et):[]}draw(a,d,p,g,x,A,P,D,H,$,X,oe,ye,ve,be,de,Le,Je){const Me=a.gl;if(this.failedToCreate)return;if(a.program.set(this.program),a.setDepthMode(p),a.setStencilMode(g),a.setColorMode(x),a.setCullFace(A),D){a.activeTexture.set(Me.TEXTURE2),Me.bindTexture(Me.TEXTURE_2D,D.depthTexture),a.activeTexture.set(Me.TEXTURE3),Me.bindTexture(Me.TEXTURE_2D,D.texture);for(const et in this.terrainUniforms)this.terrainUniforms[et].set(D[et])}for(const et in this.fixedUniforms)this.fixedUniforms[et].set(P[et]);be&&be.setUniforms(a,this.binderUniforms,ye,{zoom:ve});let Oe=0;switch(d){case Me.LINES:Oe=2;break;case Me.TRIANGLES:Oe=3;break;case Me.LINE_STRIP:Oe=1}for(const et of oe.get()){const nt=et.vaos||(et.vaos={});(nt[H]||(nt[H]=new Xu)).bind(a,this,$,be?be.getPaintVertexBuffers():[],X,et.vertexOffset,de,Le,Je),Me.drawElements(d,et.primitiveLength*Oe,Me.UNSIGNED_SHORT,et.primitiveOffset*Oe*2)}}}function Oc(y,a,d){const p=1/Mn(d,1,a.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),x=d.tileSize*Math.pow(2,a.transform.tileZoom)/g,A=x*(d.tileID.canonical.x+d.tileID.wrap*g),P=x*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[p,y.fromScale,y.toScale],u_fade:y.t,u_pixel_coord_upper:[A>>16,P>>16],u_pixel_coord_lower:[65535&A,65535&P]}}const Hp=(y,a,d,p)=>{const g=a.style.light,x=g.properties.get("position"),A=[x.x,x.y,x.z],P=function(){var H=new l.A(9);return l.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();g.properties.get("anchor")==="viewport"&&function(H,$){var X=Math.sin($),oe=Math.cos($);H[0]=oe,H[1]=X,H[2]=0,H[3]=-X,H[4]=oe,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(P,-a.transform.angle),function(H,$,X){var oe=$[0],ye=$[1],ve=$[2];H[0]=oe*X[0]+ye*X[3]+ve*X[6],H[1]=oe*X[1]+ye*X[4]+ve*X[7],H[2]=oe*X[2]+ye*X[5]+ve*X[8]}(A,A,P);const D=g.properties.get("color");return{u_matrix:y,u_lightpos:A,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+d,u_opacity:p}},Uv=(y,a,d,p,g,x,A)=>l.e(Hp(y,a,d,p),Oc(x,a,A),{u_height_factor:-Math.pow(2,g.overscaledZ)/A.tileSize/8}),Zu=y=>({u_matrix:y}),Gp=(y,a,d,p)=>l.e(Zu(y),Oc(d,a,p)),jp=(y,a)=>({u_matrix:y,u_world:a}),Vv=(y,a,d,p,g)=>l.e(Gp(y,a,d,p),{u_world:g}),Wp=(y,a,d,p)=>{const g=y.transform;let x,A;if(p.paint.get("circle-pitch-alignment")==="map"){const P=Mn(d,1,g.zoom);x=!0,A=[P,P]}else x=!1,A=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(p.paint.get("circle-pitch-scale")==="map"),u_matrix:y.translatePosMatrix(a.posMatrix,d,p.paint.get("circle-translate"),p.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:y.pixelRatio,u_extrude_scale:A}},Hv=(y,a,d)=>{const p=Mn(d,1,a.zoom),g=Math.pow(2,a.zoom-d.tileID.overscaledZ),x=d.tileID.overscaleFactor();return{u_matrix:y,u_camera_to_center_distance:a.cameraToCenterDistance,u_pixels_to_tile_units:p,u_extrude_scale:[a.pixelsToGLUnits[0]/(p*g),a.pixelsToGLUnits[1]/(p*g)],u_overscale_factor:x}},Yu=(y,a,d=1)=>({u_matrix:y,u_color:a,u_overlay:0,u_overlay_scale:d}),tf=y=>({u_matrix:y}),qp=(y,a,d,p)=>({u_matrix:y,u_extrude_scale:Mn(a,1,d),u_intensity:p});function $p(y,a){const d=Math.pow(2,a.canonical.z),p=a.canonical.y;return[new l.Y(0,p/d).toLngLat().lat,new l.Y(0,(p+1)/d).toLngLat().lat]}const Ku=(y,a,d,p)=>{const g=y.transform;return{u_matrix:Vc(y,a,d,p),u_ratio:1/Mn(a,1,g.zoom),u_device_pixel_ratio:y.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Co=(y,a,d,p,g)=>l.e(Ku(y,a,d,g),{u_image:0,u_image_height:p}),Ju=(y,a,d,p,g)=>{const x=y.transform,A=Uc(a,x);return{u_matrix:Vc(y,a,d,g),u_texsize:a.imageAtlasTexture.size,u_ratio:1/Mn(a,1,x.zoom),u_device_pixel_ratio:y.pixelRatio,u_image:0,u_scale:[A,p.fromScale,p.toScale],u_fade:p.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Ma=(y,a,d,p,g,x)=>{const A=y.lineAtlas,P=Uc(a,y.transform),D=d.layout.get("line-cap")==="round",H=A.getDash(p.from,D),$=A.getDash(p.to,D),X=H.width*g.fromScale,oe=$.width*g.toScale;return l.e(Ku(y,a,d,x),{u_patternscale_a:[P/X,-H.height/2],u_patternscale_b:[P/oe,-$.height/2],u_sdfgamma:A.width/(256*Math.min(X,oe)*y.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:$.y,u_mix:g.t})};function Uc(y,a){return 1/Mn(y,1,a.tileZoom)}function Vc(y,a,d,p){return y.translatePosMatrix(p?p.posMatrix:a.tileID.posMatrix,a,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Hc=(y,a,d,p,g)=>{return{u_matrix:y,u_tl_parent:a,u_scale_parent:d,u_buffer_scale:1,u_fade_t:p.mix,u_opacity:p.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(A=g.paint.get("raster-saturation"),A>0?1-1/(1.001-A):-A),u_contrast_factor:(x=g.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:Qu(g.paint.get("raster-hue-rotate"))};var x,A};function Qu(y){y*=Math.PI/180;const a=Math.sin(y),d=Math.cos(y);return[(2*d+1)/3,(-Math.sqrt(3)*a-d+1)/3,(Math.sqrt(3)*a-d+1)/3]}const Gc=(y,a,d,p,g,x,A,P,D,H)=>{const $=g.transform;return{u_is_size_zoom_constant:+(y==="constant"||y==="source"),u_is_size_feature_constant:+(y==="constant"||y==="camera"),u_size_t:a?a.uSizeT:0,u_size:a?a.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:$.width/$.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:A,u_coord_matrix:P,u_is_text:+D,u_pitch_with_map:+p,u_texsize:H,u_texture:0}},bl=(y,a,d,p,g,x,A,P,D,H,$)=>{const X=g.transform;return l.e(Gc(y,a,d,p,g,x,A,P,D,H),{u_gamma_scale:p?Math.cos(X._pitch)*X.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+$})},Gv=(y,a,d,p,g,x,A,P,D,H)=>l.e(bl(y,a,d,p,g,x,A,P,!0,D,!0),{u_texsize_icon:H,u_texture_icon:1}),jv=(y,a,d)=>({u_matrix:y,u_opacity:a,u_color:d}),Xp=(y,a,d,p,g,x)=>l.e(function(A,P,D,H){const $=D.imageManager.getPattern(A.from.toString()),X=D.imageManager.getPattern(A.to.toString()),{width:oe,height:ye}=D.imageManager.getPixelSize(),ve=Math.pow(2,H.tileID.overscaledZ),be=H.tileSize*Math.pow(2,D.transform.tileZoom)/ve,de=be*(H.tileID.canonical.x+H.tileID.wrap*ve),Le=be*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:X.tl,u_pattern_br_b:X.br,u_texsize:[oe,ye],u_mix:P.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:X.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/Mn(H,1,D.transform.tileZoom),u_pixel_coord_upper:[de>>16,Le>>16],u_pixel_coord_lower:[65535&de,65535&Le]}}(p,x,d,g),{u_matrix:y,u_opacity:a}),Wv={fillExtrusion:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_lightpos:new l.aK(y,a.u_lightpos),u_lightintensity:new l.aH(y,a.u_lightintensity),u_lightcolor:new l.aK(y,a.u_lightcolor),u_vertical_gradient:new l.aH(y,a.u_vertical_gradient),u_opacity:new l.aH(y,a.u_opacity)}),fillExtrusionPattern:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_lightpos:new l.aK(y,a.u_lightpos),u_lightintensity:new l.aH(y,a.u_lightintensity),u_lightcolor:new l.aK(y,a.u_lightcolor),u_vertical_gradient:new l.aH(y,a.u_vertical_gradient),u_height_factor:new l.aH(y,a.u_height_factor),u_image:new l.aG(y,a.u_image),u_texsize:new l.aL(y,a.u_texsize),u_pixel_coord_upper:new l.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,a.u_pixel_coord_lower),u_scale:new l.aK(y,a.u_scale),u_fade:new l.aH(y,a.u_fade),u_opacity:new l.aH(y,a.u_opacity)}),fill:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix)}),fillPattern:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_image:new l.aG(y,a.u_image),u_texsize:new l.aL(y,a.u_texsize),u_pixel_coord_upper:new l.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,a.u_pixel_coord_lower),u_scale:new l.aK(y,a.u_scale),u_fade:new l.aH(y,a.u_fade)}),fillOutline:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_world:new l.aL(y,a.u_world)}),fillOutlinePattern:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_world:new l.aL(y,a.u_world),u_image:new l.aG(y,a.u_image),u_texsize:new l.aL(y,a.u_texsize),u_pixel_coord_upper:new l.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,a.u_pixel_coord_lower),u_scale:new l.aK(y,a.u_scale),u_fade:new l.aH(y,a.u_fade)}),circle:(y,a)=>({u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_scale_with_map:new l.aG(y,a.u_scale_with_map),u_pitch_with_map:new l.aG(y,a.u_pitch_with_map),u_extrude_scale:new l.aL(y,a.u_extrude_scale),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_matrix:new l.aI(y,a.u_matrix)}),collisionBox:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(y,a.u_pixels_to_tile_units),u_extrude_scale:new l.aL(y,a.u_extrude_scale),u_overscale_factor:new l.aH(y,a.u_overscale_factor)}),collisionCircle:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_inv_matrix:new l.aI(y,a.u_inv_matrix),u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_viewport_size:new l.aL(y,a.u_viewport_size)}),debug:(y,a)=>({u_color:new l.aM(y,a.u_color),u_matrix:new l.aI(y,a.u_matrix),u_overlay:new l.aG(y,a.u_overlay),u_overlay_scale:new l.aH(y,a.u_overlay_scale)}),clippingMask:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix)}),heatmap:(y,a)=>({u_extrude_scale:new l.aH(y,a.u_extrude_scale),u_intensity:new l.aH(y,a.u_intensity),u_matrix:new l.aI(y,a.u_matrix)}),heatmapTexture:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_world:new l.aL(y,a.u_world),u_image:new l.aG(y,a.u_image),u_color_ramp:new l.aG(y,a.u_color_ramp),u_opacity:new l.aH(y,a.u_opacity)}),hillshade:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_image:new l.aG(y,a.u_image),u_latrange:new l.aL(y,a.u_latrange),u_light:new l.aL(y,a.u_light),u_shadow:new l.aM(y,a.u_shadow),u_highlight:new l.aM(y,a.u_highlight),u_accent:new l.aM(y,a.u_accent)}),hillshadePrepare:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_image:new l.aG(y,a.u_image),u_dimension:new l.aL(y,a.u_dimension),u_zoom:new l.aH(y,a.u_zoom),u_unpack:new l.aJ(y,a.u_unpack)}),line:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_ratio:new l.aH(y,a.u_ratio),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,a.u_units_to_pixels)}),lineGradient:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_ratio:new l.aH(y,a.u_ratio),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,a.u_units_to_pixels),u_image:new l.aG(y,a.u_image),u_image_height:new l.aH(y,a.u_image_height)}),linePattern:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_texsize:new l.aL(y,a.u_texsize),u_ratio:new l.aH(y,a.u_ratio),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_image:new l.aG(y,a.u_image),u_units_to_pixels:new l.aL(y,a.u_units_to_pixels),u_scale:new l.aK(y,a.u_scale),u_fade:new l.aH(y,a.u_fade)}),lineSDF:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_ratio:new l.aH(y,a.u_ratio),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_units_to_pixels:new l.aL(y,a.u_units_to_pixels),u_patternscale_a:new l.aL(y,a.u_patternscale_a),u_patternscale_b:new l.aL(y,a.u_patternscale_b),u_sdfgamma:new l.aH(y,a.u_sdfgamma),u_image:new l.aG(y,a.u_image),u_tex_y_a:new l.aH(y,a.u_tex_y_a),u_tex_y_b:new l.aH(y,a.u_tex_y_b),u_mix:new l.aH(y,a.u_mix)}),raster:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_tl_parent:new l.aL(y,a.u_tl_parent),u_scale_parent:new l.aH(y,a.u_scale_parent),u_buffer_scale:new l.aH(y,a.u_buffer_scale),u_fade_t:new l.aH(y,a.u_fade_t),u_opacity:new l.aH(y,a.u_opacity),u_image0:new l.aG(y,a.u_image0),u_image1:new l.aG(y,a.u_image1),u_brightness_low:new l.aH(y,a.u_brightness_low),u_brightness_high:new l.aH(y,a.u_brightness_high),u_saturation_factor:new l.aH(y,a.u_saturation_factor),u_contrast_factor:new l.aH(y,a.u_contrast_factor),u_spin_weights:new l.aK(y,a.u_spin_weights)}),symbolIcon:(y,a)=>({u_is_size_zoom_constant:new l.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,a.u_is_size_feature_constant),u_size_t:new l.aH(y,a.u_size_t),u_size:new l.aH(y,a.u_size),u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_pitch:new l.aH(y,a.u_pitch),u_rotate_symbol:new l.aG(y,a.u_rotate_symbol),u_aspect_ratio:new l.aH(y,a.u_aspect_ratio),u_fade_change:new l.aH(y,a.u_fade_change),u_matrix:new l.aI(y,a.u_matrix),u_label_plane_matrix:new l.aI(y,a.u_label_plane_matrix),u_coord_matrix:new l.aI(y,a.u_coord_matrix),u_is_text:new l.aG(y,a.u_is_text),u_pitch_with_map:new l.aG(y,a.u_pitch_with_map),u_texsize:new l.aL(y,a.u_texsize),u_texture:new l.aG(y,a.u_texture)}),symbolSDF:(y,a)=>({u_is_size_zoom_constant:new l.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,a.u_is_size_feature_constant),u_size_t:new l.aH(y,a.u_size_t),u_size:new l.aH(y,a.u_size),u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_pitch:new l.aH(y,a.u_pitch),u_rotate_symbol:new l.aG(y,a.u_rotate_symbol),u_aspect_ratio:new l.aH(y,a.u_aspect_ratio),u_fade_change:new l.aH(y,a.u_fade_change),u_matrix:new l.aI(y,a.u_matrix),u_label_plane_matrix:new l.aI(y,a.u_label_plane_matrix),u_coord_matrix:new l.aI(y,a.u_coord_matrix),u_is_text:new l.aG(y,a.u_is_text),u_pitch_with_map:new l.aG(y,a.u_pitch_with_map),u_texsize:new l.aL(y,a.u_texsize),u_texture:new l.aG(y,a.u_texture),u_gamma_scale:new l.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_is_halo:new l.aG(y,a.u_is_halo)}),symbolTextAndIcon:(y,a)=>({u_is_size_zoom_constant:new l.aG(y,a.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(y,a.u_is_size_feature_constant),u_size_t:new l.aH(y,a.u_size_t),u_size:new l.aH(y,a.u_size),u_camera_to_center_distance:new l.aH(y,a.u_camera_to_center_distance),u_pitch:new l.aH(y,a.u_pitch),u_rotate_symbol:new l.aG(y,a.u_rotate_symbol),u_aspect_ratio:new l.aH(y,a.u_aspect_ratio),u_fade_change:new l.aH(y,a.u_fade_change),u_matrix:new l.aI(y,a.u_matrix),u_label_plane_matrix:new l.aI(y,a.u_label_plane_matrix),u_coord_matrix:new l.aI(y,a.u_coord_matrix),u_is_text:new l.aG(y,a.u_is_text),u_pitch_with_map:new l.aG(y,a.u_pitch_with_map),u_texsize:new l.aL(y,a.u_texsize),u_texsize_icon:new l.aL(y,a.u_texsize_icon),u_texture:new l.aG(y,a.u_texture),u_texture_icon:new l.aG(y,a.u_texture_icon),u_gamma_scale:new l.aH(y,a.u_gamma_scale),u_device_pixel_ratio:new l.aH(y,a.u_device_pixel_ratio),u_is_halo:new l.aG(y,a.u_is_halo)}),background:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_opacity:new l.aH(y,a.u_opacity),u_color:new l.aM(y,a.u_color)}),backgroundPattern:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_opacity:new l.aH(y,a.u_opacity),u_image:new l.aG(y,a.u_image),u_pattern_tl_a:new l.aL(y,a.u_pattern_tl_a),u_pattern_br_a:new l.aL(y,a.u_pattern_br_a),u_pattern_tl_b:new l.aL(y,a.u_pattern_tl_b),u_pattern_br_b:new l.aL(y,a.u_pattern_br_b),u_texsize:new l.aL(y,a.u_texsize),u_mix:new l.aH(y,a.u_mix),u_pattern_size_a:new l.aL(y,a.u_pattern_size_a),u_pattern_size_b:new l.aL(y,a.u_pattern_size_b),u_scale_a:new l.aH(y,a.u_scale_a),u_scale_b:new l.aH(y,a.u_scale_b),u_pixel_coord_upper:new l.aL(y,a.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(y,a.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(y,a.u_tile_units_to_pixels)}),terrain:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_texture:new l.aG(y,a.u_texture),u_ele_delta:new l.aH(y,a.u_ele_delta)}),terrainDepth:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_ele_delta:new l.aH(y,a.u_ele_delta)}),terrainCoords:(y,a)=>({u_matrix:new l.aI(y,a.u_matrix),u_texture:new l.aG(y,a.u_texture),u_terrain_coords_id:new l.aH(y,a.u_terrain_coords_id),u_ele_delta:new l.aH(y,a.u_ele_delta)})};class Po{constructor(a,d,p){this.context=a;const g=a.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),a.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(a){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,a.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const eh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oa{constructor(a,d,p,g){this.length=d.length,this.attributes=p,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=a;const x=a.gl;this.buffer=x.createBuffer(),a.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(a){if(a.length!==this.length)throw new Error(`Length of new data is ${a.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,a.arrayBuffer)}enableAttributes(a,d){for(let p=0;p<this.attributes.length;p++){const g=d.attributes[this.attributes[p].name];g!==void 0&&a.enableVertexAttribArray(g)}}setVertexAttribPointers(a,d,p){for(let g=0;g<this.attributes.length;g++){const x=this.attributes[g],A=d.attributes[x.name];A!==void 0&&a.vertexAttribPointer(A,x.components,a[eh[x.type]],!1,this.itemSize,x.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fi=new WeakMap;function wl(y){var a;if(Fi.has(y))return Fi.get(y);{const d=(a=y.getParameter(y.VERSION))===null||a===void 0?void 0:a.startsWith("WebGL 2.0");return Fi.set(y,d),d}}class nr{constructor(a){this.gl=a.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(a){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class th extends nr{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.clearColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class nf extends nr{getDefault(){return 1}set(a){(a!==this.current||this.dirty)&&(this.gl.clearDepth(a),this.current=a,this.dirty=!1)}}class rf extends nr{getDefault(){return 0}set(a){(a!==this.current||this.dirty)&&(this.gl.clearStencil(a),this.current=a,this.dirty=!1)}}class nh extends nr{getDefault(){return[!0,!0,!0,!0]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.colorMask(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class af extends nr{getDefault(){return!0}set(a){(a!==this.current||this.dirty)&&(this.gl.depthMask(a),this.current=a,this.dirty=!1)}}class sf extends nr{getDefault(){return 255}set(a){(a!==this.current||this.dirty)&&(this.gl.stencilMask(a),this.current=a,this.dirty=!1)}}class rh extends nr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(a){const d=this.current;(a.func!==d.func||a.ref!==d.ref||a.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(a.func,a.ref,a.mask),this.current=a,this.dirty=!1)}}class Zp extends nr{getDefault(){const a=this.gl;return[a.KEEP,a.KEEP,a.KEEP]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(a[0],a[1],a[2]),this.current=a,this.dirty=!1)}}class Yp extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=a,this.dirty=!1}}class Sl extends nr{getDefault(){return[0,1]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.depthRange(a[0],a[1]),this.current=a,this.dirty=!1)}}class qv extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=a,this.dirty=!1}}class $v extends nr{getDefault(){return this.gl.LESS}set(a){(a!==this.current||this.dirty)&&(this.gl.depthFunc(a),this.current=a,this.dirty=!1)}}class Xv extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.BLEND):d.disable(d.BLEND),this.current=a,this.dirty=!1}}class Zv extends nr{getDefault(){const a=this.gl;return[a.ONE,a.ZERO]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(a[0],a[1]),this.current=a,this.dirty=!1)}}class Yv extends nr{getDefault(){return l.aO.transparent}set(a){const d=this.current;(a.r!==d.r||a.g!==d.g||a.b!==d.b||a.a!==d.a||this.dirty)&&(this.gl.blendColor(a.r,a.g,a.b,a.a),this.current=a,this.dirty=!1)}}class Kv extends nr{getDefault(){return this.gl.FUNC_ADD}set(a){(a!==this.current||this.dirty)&&(this.gl.blendEquation(a),this.current=a,this.dirty=!1)}}class of extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;a?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=a,this.dirty=!1}}class ih extends nr{getDefault(){return this.gl.BACK}set(a){(a!==this.current||this.dirty)&&(this.gl.cullFace(a),this.current=a,this.dirty=!1)}}class lf extends nr{getDefault(){return this.gl.CCW}set(a){(a!==this.current||this.dirty)&&(this.gl.frontFace(a),this.current=a,this.dirty=!1)}}class cf extends nr{getDefault(){return null}set(a){(a!==this.current||this.dirty)&&(this.gl.useProgram(a),this.current=a,this.dirty=!1)}}class Ml extends nr{getDefault(){return this.gl.TEXTURE0}set(a){(a!==this.current||this.dirty)&&(this.gl.activeTexture(a),this.current=a,this.dirty=!1)}}class Kp extends nr{getDefault(){const a=this.gl;return[0,0,a.drawingBufferWidth,a.drawingBufferHeight]}set(a){const d=this.current;(a[0]!==d[0]||a[1]!==d[1]||a[2]!==d[2]||a[3]!==d[3]||this.dirty)&&(this.gl.viewport(a[0],a[1],a[2],a[3]),this.current=a,this.dirty=!1)}}class Jp extends nr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,a),this.current=a,this.dirty=!1}}class uf extends nr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Ro extends nr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,a),this.current=a,this.dirty=!1}}class Qp extends nr{getDefault(){return null}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class Tl extends nr{getDefault(){return null}set(a){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,a),this.current=a,this.dirty=!1}}class El extends nr{getDefault(){return null}set(a){var d;if(a===this.current&&!this.dirty)return;const p=this.gl;wl(p)?p.bindVertexArray(a):(d=p.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(a),this.current=a,this.dirty=!1}}class em extends nr{getDefault(){return 4}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,a),this.current=a,this.dirty=!1}}class hf extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,a),this.current=a,this.dirty=!1}}class rr extends nr{getDefault(){return!1}set(a){if(a===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,a),this.current=a,this.dirty=!1}}class Al extends nr{constructor(a,d){super(a),this.context=a,this.parent=d}getDefault(){return null}}class Jv extends Al{setDirty(){this.dirty=!0}set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,a,0),this.current=a,this.dirty=!1}}class tm extends Al{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class jc extends Al{set(a){if(a===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,a),this.current=a,this.dirty=!1}}class Qv{constructor(a,d,p,g,x){this.context=a,this.width=d,this.height=p;const A=a.gl,P=this.framebuffer=A.createFramebuffer();if(this.colorAttachment=new Jv(a,P),g)this.depthAttachment=x?new jc(a,P):new tm(a,P);else if(x)throw new Error("Stencil cannot be set without depth");if(A.checkFramebufferStatus(A.FRAMEBUFFER)!==A.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const a=this.context.gl,d=this.colorAttachment.get();if(d&&a.deleteTexture(d),this.depthAttachment){const p=this.depthAttachment.get();p&&a.deleteRenderbuffer(p)}a.deleteFramebuffer(this.framebuffer)}}class Vr{constructor(a,d,p){this.blendFunction=a,this.blendColor=d,this.mask=p}}Vr.Replace=[1,0],Vr.disabled=new Vr(Vr.Replace,l.aO.transparent,[!1,!1,!1,!1]),Vr.unblended=new Vr(Vr.Replace,l.aO.transparent,[!0,!0,!0,!0]),Vr.alphaBlended=new Vr([1,771],l.aO.transparent,[!0,!0,!0,!0]);class nm{constructor(a){var d,p;if(this.gl=a,this.clearColor=new th(this),this.clearDepth=new nf(this),this.clearStencil=new rf(this),this.colorMask=new nh(this),this.depthMask=new af(this),this.stencilMask=new sf(this),this.stencilFunc=new rh(this),this.stencilOp=new Zp(this),this.stencilTest=new Yp(this),this.depthRange=new Sl(this),this.depthTest=new qv(this),this.depthFunc=new $v(this),this.blend=new Xv(this),this.blendFunc=new Zv(this),this.blendColor=new Yv(this),this.blendEquation=new Kv(this),this.cullFace=new of(this),this.cullFaceSide=new ih(this),this.frontFace=new lf(this),this.program=new cf(this),this.activeTexture=new Ml(this),this.viewport=new Kp(this),this.bindFramebuffer=new Jp(this),this.bindRenderbuffer=new uf(this),this.bindTexture=new Ro(this),this.bindVertexBuffer=new Qp(this),this.bindElementBuffer=new Tl(this),this.bindVertexArray=new El(this),this.pixelStoreUnpack=new em(this),this.pixelStoreUnpackPremultiplyAlpha=new hf(this),this.pixelStoreUnpackFlipY=new rr(this),this.extTextureFilterAnisotropic=a.getExtension("EXT_texture_filter_anisotropic")||a.getExtension("MOZ_EXT_texture_filter_anisotropic")||a.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=a.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=a.getParameter(a.MAX_TEXTURE_SIZE),wl(a)){this.HALF_FLOAT=a.HALF_FLOAT;const g=a.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=a.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(p=a.RGB16F)!==null&&p!==void 0?p:g==null?void 0:g.RGB16F_EXT,a.getExtension("EXT_color_buffer_float")}else{a.getExtension("EXT_color_buffer_half_float"),a.getExtension("OES_texture_half_float_linear");const g=a.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(a,d){return new Po(this,a,d)}createVertexBuffer(a,d,p){return new oa(this,a,d,p)}createRenderbuffer(a,d,p){const g=this.gl,x=g.createRenderbuffer();return this.bindRenderbuffer.set(x),g.renderbufferStorage(g.RENDERBUFFER,a,d,p),this.bindRenderbuffer.set(null),x}createFramebuffer(a,d,p,g){return new Qv(this,a,d,p,g)}clear({color:a,depth:d,stencil:p}){const g=this.gl;let x=0;a&&(x|=g.COLOR_BUFFER_BIT,this.clearColor.set(a),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(x|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),p!==void 0&&(x|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),g.clear(x)}setCullFace(a){a.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(a.mode),this.frontFace.set(a.frontFace))}setDepthMode(a){a.func!==this.gl.ALWAYS||a.mask?(this.depthTest.set(!0),this.depthFunc.set(a.func),this.depthMask.set(a.mask),this.depthRange.set(a.range)):this.depthTest.set(!1)}setStencilMode(a){a.test.func!==this.gl.ALWAYS||a.mask?(this.stencilTest.set(!0),this.stencilMask.set(a.mask),this.stencilOp.set([a.fail,a.depthFail,a.pass]),this.stencilFunc.set({func:a.test.func,ref:a.ref,mask:a.test.mask})):this.stencilTest.set(!1)}setColorMode(a){l.aD(a.blendFunction,Vr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(a.blendFunction),this.blendColor.set(a.blendColor)),this.colorMask.set(a.mask)}createVertexArray(){var a;return wl(this.gl)?this.gl.createVertexArray():(a=this.gl.getExtension("OES_vertex_array_object"))===null||a===void 0?void 0:a.createVertexArrayOES()}deleteVertexArray(a){var d;return wl(this.gl)?this.gl.deleteVertexArray(a):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(a)}unbindVAO(){this.bindVertexArray.set(null)}}class er{constructor(a,d,p){this.func=a,this.mask=d,this.range=p}}er.ReadOnly=!1,er.ReadWrite=!0,er.disabled=new er(519,er.ReadOnly,[0,1]);const Wc=7680;class mr{constructor(a,d,p,g,x,A){this.test=a,this.ref=d,this.mask=p,this.fail=g,this.depthFail=x,this.pass=A}}mr.disabled=new mr({func:519,mask:0},0,0,Wc,Wc,Wc);class hr{constructor(a,d,p){this.enable=a,this.mode=d,this.frontFace=p}}let Cl;function ah(y,a,d,p,g,x,A){const P=y.context,D=P.gl,H=y.useProgram("collisionBox"),$=[];let X=0,oe=0;for(let Me=0;Me<p.length;Me++){const Oe=p[Me],et=a.getTile(Oe),nt=et.getBucket(d);if(!nt)continue;let ut=Oe.posMatrix;g[0]===0&&g[1]===0||(ut=y.translatePosMatrix(Oe.posMatrix,et,g,x));const St=A?nt.textCollisionBox:nt.iconCollisionBox,yt=nt.collisionCircleArray;if(yt.length>0){const xt=l.F(),Yt=ut;l.aP(xt,nt.placementInvProjMatrix,y.transform.glCoordMatrix),l.aP(xt,xt,nt.placementViewportMatrix),$.push({circleArray:yt,circleOffset:oe,transform:Yt,invTransform:xt,coord:Oe}),X+=yt.length/4,oe=X}St&&H.draw(P,D.LINES,er.disabled,mr.disabled,y.colorModeForRenderPass(),hr.disabled,Hv(ut,y.transform,et),y.style.map.terrain&&y.style.map.terrain.getTerrainData(Oe),d.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,null,y.transform.zoom,null,null,St.collisionVertexBuffer)}if(!A||!$.length)return;const ye=y.useProgram("collisionCircle"),ve=new l.aQ;ve.resize(4*X),ve._trim();let be=0;for(const Me of $)for(let Oe=0;Oe<Me.circleArray.length/4;Oe++){const et=4*Oe,nt=Me.circleArray[et+0],ut=Me.circleArray[et+1],St=Me.circleArray[et+2],yt=Me.circleArray[et+3];ve.emplace(be++,nt,ut,St,yt,0),ve.emplace(be++,nt,ut,St,yt,1),ve.emplace(be++,nt,ut,St,yt,2),ve.emplace(be++,nt,ut,St,yt,3)}(!Cl||Cl.length<2*X)&&(Cl=function(Me){const Oe=2*Me,et=new l.aS;et.resize(Oe),et._trim();for(let nt=0;nt<Oe;nt++){const ut=6*nt;et.uint16[ut+0]=4*nt+0,et.uint16[ut+1]=4*nt+1,et.uint16[ut+2]=4*nt+2,et.uint16[ut+3]=4*nt+2,et.uint16[ut+4]=4*nt+3,et.uint16[ut+5]=4*nt+0}return et}(X));const de=P.createIndexBuffer(Cl,!0),Le=P.createVertexBuffer(ve,l.aR.members,!0);for(const Me of $){const Oe={u_matrix:Me.transform,u_inv_matrix:Me.invTransform,u_camera_to_center_distance:(Je=y.transform).cameraToCenterDistance,u_viewport_size:[Je.width,Je.height]};ye.draw(P,D.TRIANGLES,er.disabled,mr.disabled,y.colorModeForRenderPass(),hr.disabled,Oe,y.style.map.terrain&&y.style.map.terrain.getTerrainData(Me.coord),d.id,Le,de,l.$.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,y.transform.zoom,null,null,null)}var Je;Le.destroy(),de.destroy()}hr.disabled=new hr(!1,1029,2305),hr.backCCW=new hr(!0,1029,2305);const rm=l.an(new Float32Array(16));function sh(y,a,d,p,g,x){const{horizontalAlign:A,verticalAlign:P}=l.at(y);return new l.P((-(A-.5)*a/g+p[0])*x,(-(P-.5)*d/g+p[1])*x)}function oh(y,a,d,p,g,x,A,P,D,H,$){const X=y.text.placedSymbolArray,oe=y.text.dynamicLayoutVertexArray,ye=y.icon.dynamicLayoutVertexArray,ve={};oe.clear();for(let be=0;be<X.length;be++){const de=X.get(be),Le=de.hidden||!de.crossTileID||y.allowVerticalPlacement&&!de.placedOrientation?null:p[de.crossTileID];if(Le){const Je=new l.P(de.anchorX,de.anchorY),Me=ae(Je,d?A:x,$),Oe=F(g.cameraToCenterDistance,Me.signedDistanceFromCamera);let et=l.ai(y.textSizeData,D,de)*Oe/l.ao;d&&(et*=y.tilePixelRatio/P);const{width:nt,height:ut,anchor:St,textOffset:yt,textBoxScale:xt}=Le,Yt=sh(St,nt,ut,yt,xt,et),Bn=d?ae(Je.add(Yt),x,$).point:Me.point.add(a?Yt.rotate(-g.angle):Yt),Nt=y.allowVerticalPlacement&&de.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let An=0;An<de.numGlyphs;An++)l.aj(oe,Bn,Nt);H&&de.associatedIconIndex>=0&&(ve[de.associatedIconIndex]={shiftedAnchor:Bn,angle:Nt})}else Pt(de.numGlyphs,oe)}if(H){ye.clear();const be=y.icon.placedSymbolArray;for(let de=0;de<be.length;de++){const Le=be.get(de);if(Le.hidden)Pt(Le.numGlyphs,ye);else{const Je=ve[de];if(Je)for(let Me=0;Me<Le.numGlyphs;Me++)l.aj(ye,Je.shiftedAnchor,Je.angle);else Pt(Le.numGlyphs,ye)}}y.icon.dynamicLayoutVertexBuffer.updateData(ye)}y.text.dynamicLayoutVertexBuffer.updateData(oe)}function df(y,a,d){return d.iconsInText&&a?"symbolTextAndIcon":y?"symbolSDF":"symbolIcon"}function im(y,a,d,p,g,x,A,P,D,H,$,X){const oe=y.context,ye=oe.gl,ve=y.transform,be=P==="map",de=D==="map",Le=P!=="viewport"&&d.layout.get("symbol-placement")!=="point",Je=be&&!de&&!Le,Me=!d.layout.get("symbol-sort-key").isConstant();let Oe=!1;const et=y.depthModeForSublayer(0,er.ReadOnly),nt=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ut=[];for(const St of p){const yt=a.getTile(St),xt=yt.getBucket(d);if(!xt)continue;const Yt=g?xt.text:xt.icon;if(!Yt||!Yt.segments.get().length||!Yt.hasVisibleVertices)continue;const Bn=Yt.programConfigurations.get(d.id),Nt=g||xt.sdfIcons,An=g?xt.textSizeData:xt.iconSizeData,On=de||ve.pitch!==0,Xn=y.useProgram(df(Nt,g,xt),Bn),In=l.ag(An,ve.zoom),Vn=y.style.map.terrain&&y.style.map.terrain.getTerrainData(St);let Hn,Ar,dr,Xi,Yr=[0,0],gr=null;if(g)Ar=yt.glyphAtlasTexture,dr=ye.LINEAR,Hn=yt.glyphAtlasTexture.size,xt.iconsInText&&(Yr=yt.imageAtlasTexture.size,gr=yt.imageAtlasTexture,Xi=On||y.options.rotating||y.options.zooming||An.kind==="composite"||An.kind==="camera"?ye.LINEAR:ye.NEAREST);else{const Mr=d.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Ar=yt.imageAtlasTexture,dr=Nt||y.options.rotating||y.options.zooming||Mr||On?ye.LINEAR:ye.NEAREST,Hn=yt.imageAtlasTexture.size}const Ai=Mn(yt,1,y.transform.zoom),Va=Qe(St.posMatrix,de,be,y.transform,Ai),cs=bt(St.posMatrix,de,be,y.transform,Ai),Fo=nt&&xt.hasTextData(),No=d.layout.get("icon-text-fit")!=="none"&&Fo&&xt.hasIconData();if(Le){const Mr=y.style.map.terrain?(ca,Wn)=>y.style.map.terrain.getElevation(St,ca,Wn):null,fi=d.layout.get("text-rotation-alignment")==="map";q(xt,St.posMatrix,y,g,Va,cs,de,H,fi,Mr)}const us=y.translatePosMatrix(St.posMatrix,yt,x,A),Ha=Le||g&&nt||No?rm:Va,kr=y.translatePosMatrix(cs,yt,x,A,!0),xr=Nt&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Br;Br=Nt?xt.iconsInText?Gv(An.kind,In,Je,de,y,us,Ha,kr,Hn,Yr):bl(An.kind,In,Je,de,y,us,Ha,kr,g,Hn,!0):Gc(An.kind,In,Je,de,y,us,Ha,kr,g,Hn);const Ol={program:Xn,buffers:Yt,uniformValues:Br,atlasTexture:Ar,atlasTextureIcon:gr,atlasInterpolation:dr,atlasInterpolationIcon:Xi,isSDF:Nt,hasHalo:xr};if(Me&&xt.canOverlap){Oe=!0;const Mr=Yt.segments.get();for(const fi of Mr)ut.push({segments:new l.$([fi]),sortKey:fi.sortKey,state:Ol,terrainData:Vn})}else ut.push({segments:Yt.segments,sortKey:0,state:Ol,terrainData:Vn})}Oe&&ut.sort((St,yt)=>St.sortKey-yt.sortKey);for(const St of ut){const yt=St.state;if(oe.activeTexture.set(ye.TEXTURE0),yt.atlasTexture.bind(yt.atlasInterpolation,ye.CLAMP_TO_EDGE),yt.atlasTextureIcon&&(oe.activeTexture.set(ye.TEXTURE1),yt.atlasTextureIcon&&yt.atlasTextureIcon.bind(yt.atlasInterpolationIcon,ye.CLAMP_TO_EDGE)),yt.isSDF){const xt=yt.uniformValues;yt.hasHalo&&(xt.u_is_halo=1,lh(yt.buffers,St.segments,d,y,yt.program,et,$,X,xt,St.terrainData)),xt.u_is_halo=0}lh(yt.buffers,St.segments,d,y,yt.program,et,$,X,yt.uniformValues,St.terrainData)}}function lh(y,a,d,p,g,x,A,P,D,H){const $=p.context;g.draw($,$.gl.TRIANGLES,x,A,P,hr.disabled,D,H,d.id,y.layoutVertexBuffer,y.indexBuffer,a,d.paint,p.transform.zoom,y.programConfigurations.get(d.id),y.dynamicLayoutVertexBuffer,y.opacityVertexBuffer)}function am(y,a,d,p,g){if(!d||!p||!p.imageAtlas)return;const x=p.imageAtlas.patternPositions;let A=x[d.to.toString()],P=x[d.from.toString()];if(!A&&P&&(A=P),!P&&A&&(P=A),!A||!P){const D=g.getPaintProperty(a);A=x[D],P=x[D]}A&&P&&y.setConstantPatternPositions(A,P)}function ff(y,a,d,p,g,x,A){const P=y.context.gl,D="fill-pattern",H=d.paint.get(D),$=H&&H.constantOr(1),X=d.getCrossfadeParameters();let oe,ye,ve,be,de;A?(ye=$&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",oe=P.LINES):(ye=$?"fillPattern":"fill",oe=P.TRIANGLES);const Le=H.constantOr(null);for(const Je of p){const Me=a.getTile(Je);if($&&!Me.patternsLoaded())continue;const Oe=Me.getBucket(d);if(!Oe)continue;const et=Oe.programConfigurations.get(d.id),nt=y.useProgram(ye,et),ut=y.style.map.terrain&&y.style.map.terrain.getTerrainData(Je);$&&(y.context.activeTexture.set(P.TEXTURE0),Me.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),et.updatePaintBuffers(X)),am(et,D,Le,Me,d);const St=ut?Je:null,yt=y.translatePosMatrix(St?St.posMatrix:Je.posMatrix,Me,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(A){be=Oe.indexBuffer2,de=Oe.segments2;const xt=[P.drawingBufferWidth,P.drawingBufferHeight];ve=ye==="fillOutlinePattern"&&$?Vv(yt,y,X,Me,xt):jp(yt,xt)}else be=Oe.indexBuffer,de=Oe.segments,ve=$?Gp(yt,y,X,Me):Zu(yt);nt.draw(y.context,oe,g,y.stencilModeForClipping(Je),x,hr.disabled,ve,ut,d.id,Oe.layoutVertexBuffer,be,de,d.paint,y.transform.zoom,et)}}function Pl(y,a,d,p,g,x,A){const P=y.context,D=P.gl,H="fill-extrusion-pattern",$=d.paint.get(H),X=$.constantOr(1),oe=d.getCrossfadeParameters(),ye=d.paint.get("fill-extrusion-opacity"),ve=$.constantOr(null);for(const be of p){const de=a.getTile(be),Le=de.getBucket(d);if(!Le)continue;const Je=y.style.map.terrain&&y.style.map.terrain.getTerrainData(be),Me=Le.programConfigurations.get(d.id),Oe=y.useProgram(X?"fillExtrusionPattern":"fillExtrusion",Me);X&&(y.context.activeTexture.set(D.TEXTURE0),de.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Me.updatePaintBuffers(oe)),am(Me,H,ve,de,d);const et=y.translatePosMatrix(be.posMatrix,de,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),nt=d.paint.get("fill-extrusion-vertical-gradient"),ut=X?Uv(et,y,nt,ye,be,oe,de):Hp(et,y,nt,ye);Oe.draw(P,P.gl.TRIANGLES,g,x,A,hr.backCCW,ut,Je,d.id,Le.layoutVertexBuffer,Le.indexBuffer,Le.segments,d.paint,y.transform.zoom,Me,y.style.map.terrain&&Le.centroidVertexBuffer)}}function pf(y,a,d,p,g,x,A){const P=y.context,D=P.gl,H=d.fbo;if(!H)return;const $=y.useProgram("hillshade"),X=y.style.map.terrain&&y.style.map.terrain.getTerrainData(a);P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,H.colorAttachment.get()),$.draw(P,D.TRIANGLES,g,x,A,hr.disabled,((oe,ye,ve,be)=>{const de=ve.paint.get("hillshade-shadow-color"),Le=ve.paint.get("hillshade-highlight-color"),Je=ve.paint.get("hillshade-accent-color");let Me=ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(Me-=oe.transform.angle);const Oe=!oe.options.moving;return{u_matrix:be?be.posMatrix:oe.transform.calculatePosMatrix(ye.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:$p(0,ye.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Me],u_shadow:de,u_highlight:Le,u_accent:Je}})(y,d,p,X?a:null),X,p.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments)}function sm(y,a,d,p,g,x){const A=y.context,P=A.gl,D=a.dem;if(D&&D.data){const H=D.dim,$=D.stride,X=D.getPixels();if(A.activeTexture.set(P.TEXTURE1),A.pixelStoreUnpackPremultiplyAlpha.set(!1),a.demTexture=a.demTexture||y.getTileTexture($),a.demTexture){const ye=a.demTexture;ye.update(X,{premultiply:!1}),ye.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else a.demTexture=new Be(A,X,P.RGBA,{premultiply:!1}),a.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);A.activeTexture.set(P.TEXTURE0);let oe=a.fbo;if(!oe){const ye=new Be(A,{width:H,height:H,data:null},P.RGBA);ye.bind(P.LINEAR,P.CLAMP_TO_EDGE),oe=a.fbo=A.createFramebuffer(H,H,!0,!1),oe.colorAttachment.set(ye.texture)}A.bindFramebuffer.set(oe.framebuffer),A.viewport.set([0,0,H,H]),y.useProgram("hillshadePrepare").draw(A,P.TRIANGLES,p,g,x,hr.disabled,((ye,ve)=>{const be=ve.stride,de=l.F();return l.aN(de,0,l.W,-l.W,0,0,1),l.H(de,de,[0,-l.W,0]),{u_matrix:de,u_image:1,u_dimension:[be,be],u_zoom:ye.overscaledZ,u_unpack:ve.getUnpackVector()}})(a.tileID,D),null,d.id,y.rasterBoundsBuffer,y.quadTriangleIndexBuffer,y.rasterBoundsSegments),a.needsHillshadePrepare=!1}}function om(y,a,d,p,g,x){const A=p.paint.get("raster-fade-duration");if(!x&&A>0){const P=T.now(),D=(P-y.timeAdded)/A,H=a?(P-a.timeAdded)/A:-1,$=d.getSource(),X=g.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),oe=!a||Math.abs(a.tileID.overscaledZ-X)>Math.abs(y.tileID.overscaledZ-X),ye=oe&&y.refreshedUponExpiration?1:l.ac(oe?D:1-H,0,1);return y.refreshedUponExpiration&&D>=1&&(y.refreshedUponExpiration=!1),a?{opacity:1,mix:1-ye}:{opacity:ye,mix:0}}return{opacity:1,mix:0}}const ch=new l.aO(1,0,0,1),mf=new l.aO(0,1,0,1),ey=new l.aO(0,0,1,1),lm=new l.aO(1,0,1,1),Nr=new l.aO(0,1,1,1);function Qs(y,a,d,p){Rl(y,0,a+d/2,y.transform.width,d,p)}function la(y,a,d,p){Rl(y,a-d/2,0,d,y.transform.height,p)}function Rl(y,a,d,p,g,x){const A=y.context,P=A.gl;P.enable(P.SCISSOR_TEST),P.scissor(a*y.pixelRatio,d*y.pixelRatio,p*y.pixelRatio,g*y.pixelRatio),A.clear({color:x}),P.disable(P.SCISSOR_TEST)}function gf(y,a,d){const p=y.context,g=p.gl,x=d.posMatrix,A=y.useProgram("debug"),P=er.disabled,D=mr.disabled,H=y.colorModeForRenderPass(),$="$debug",X=y.style.map.terrain&&y.style.map.terrain.getTerrainData(d);p.activeTexture.set(g.TEXTURE0);const oe=a.getTileByID(d.key).latestRawTileData,ye=Math.floor((oe&&oe.byteLength||0)/1024),ve=a.getTile(d).tileSize,be=512/Math.min(ve,512)*(d.overscaledZ/y.transform.zoom)*.5;let de=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(de+=` => ${d.overscaledZ}`),function(Le,Je){Le.initDebugOverlayCanvas();const Me=Le.debugOverlayCanvas,Oe=Le.context.gl,et=Le.debugOverlayCanvas.getContext("2d");et.clearRect(0,0,Me.width,Me.height),et.shadowColor="white",et.shadowBlur=2,et.lineWidth=1.5,et.strokeStyle="white",et.textBaseline="top",et.font="bold 36px Open Sans, sans-serif",et.fillText(Je,5,5),et.strokeText(Je,5,5),Le.debugOverlayTexture.update(Me),Le.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(y,`${de} ${ye}kB`),A.draw(p,g.TRIANGLES,P,D,Vr.alphaBlended,hr.disabled,Yu(x,l.aO.transparent,be),null,$,y.debugBuffer,y.quadTriangleIndexBuffer,y.debugSegments),A.draw(p,g.LINE_STRIP,P,D,H,hr.disabled,Yu(x,l.aO.red),X,$,y.debugBuffer,y.tileBorderIndexBuffer,y.debugSegments)}function vf(y,a,d){const p=y.context,g=p.gl,x=y.colorModeForRenderPass(),A=new er(g.LEQUAL,er.ReadWrite,y.depthRangeFor3D),P=y.useProgram("terrain"),D=a.getTerrainMesh();p.bindFramebuffer.set(null),p.viewport.set([0,0,y.width,y.height]);for(const H of d){const $=y.renderToTexture.getTexture(H),X=a.getTerrainData(H.tileID);p.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,$.texture);const oe={u_matrix:y.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_texture:0,u_ele_delta:a.getMeshFrameDelta(y.transform.zoom)};P.draw(p,g.TRIANGLES,A,mr.disabled,x,hr.backCCW,oe,X,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class Il{constructor(a,d){this.context=new nm(a),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=lt.maxUnderzooming+lt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new $n}resize(a,d,p){if(this.width=Math.floor(a*p),this.height=Math.floor(d*p),this.pixelRatio=p,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const a=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=a.createVertexBuffer(d,Wi.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const p=new l.aV;p.emplaceBack(0,0),p.emplaceBack(l.W,0),p.emplaceBack(0,l.W),p.emplaceBack(l.W,l.W),this.debugBuffer=a.createVertexBuffer(p,Wi.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const g=new l.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(l.W,0,l.W,0),g.emplaceBack(0,l.W,0,l.W),g.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=a.createVertexBuffer(g,tt.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const x=new l.aV;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=a.createVertexBuffer(x,Wi.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const A=new l.aW;A.emplaceBack(0),A.emplaceBack(1),A.emplaceBack(3),A.emplaceBack(2),A.emplaceBack(0),this.tileBorderIndexBuffer=a.createIndexBuffer(A);const P=new l.aX;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=a.createIndexBuffer(P);const D=this.context.gl;this.stencilClearMode=new mr({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const a=this.context,d=a.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const p=l.F();l.aN(p,0,this.width,this.height,0,0,1),l.J(p,p,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(a,d.TRIANGLES,er.disabled,this.stencilClearMode,Vr.disabled,hr.disabled,tf(p),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(a,d){if(this.currentStencilSource===a.source||!a.isTileClipped()||!d||!d.length)return;this.currentStencilSource=a.source;const p=this.context,g=p.gl;this.nextStencilID+d.length>256&&this.clearStencil(),p.setColorMode(Vr.disabled),p.setDepthMode(er.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const A of d){const P=this._tileClippingMaskIDs[A.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(A);x.draw(p,g.TRIANGLES,er.disabled,new mr({func:g.ALWAYS,mask:0},P,255,g.KEEP,g.KEEP,g.REPLACE),Vr.disabled,hr.disabled,tf(A.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const a=this.nextStencilID++,d=this.context.gl;return new mr({func:d.NOTEQUAL,mask:255},a,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(a){const d=this.context.gl;return new mr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[a.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(a){const d=this.context.gl,p=a.sort((A,P)=>P.overscaledZ-A.overscaledZ),g=p[p.length-1].overscaledZ,x=p[0].overscaledZ-g+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const A={};for(let P=0;P<x;P++)A[P+g]=new mr({func:d.GEQUAL,mask:255},P+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=x,[A,p]}return[{[g]:mr.disabled},p]}colorModeForRenderPass(){const a=this.context.gl;return this._showOverdrawInspector?new Vr([a.CONSTANT_COLOR,a.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Vr.unblended:Vr.alphaBlended}depthModeForSublayer(a,d,p){if(!this.opaquePassEnabledForLayer())return er.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+a)*this.depthEpsilon;return new er(p||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(a,d){this.style=a,this.options=d,this.lineAtlas=a.lineAtlas,this.imageManager=a.imageManager,this.glyphManager=a.glyphManager,this.symbolFadeChange=a.placement.symbolFadeChange(T.now()),this.imageManager.beginFrame();const p=this.style._order,g=this.style.sourceCaches,x={},A={},P={};for(const D in g){const H=g[D];H.used&&H.prepare(this.context),x[D]=H.getVisibleCoordinates(),A[D]=x[D].slice().reverse(),P[D]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<p.length;D++)if(this.style._layers[p[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of p){const H=this.style._layers[D];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const $=A[H.source];(H.type==="custom"||$.length)&&this.renderLayer(this,g[H.source],H,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(a._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[p[this.currentLayer]],H=g[D.source],$=x[D.source];this._renderTileClippingMasks(D,$),this.renderLayer(this,H,D,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const D=this.style._layers[p[this.currentLayer]],H=g[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const $=(D.type==="symbol"?P:A)[D.source];this._renderTileClippingMasks(D,x[D.source]),this.renderLayer(this,H,D,$)}if(this.options.showTileBoundaries){const D=function(H,$){let X=null;const oe=Object.values(H._layers).flatMap(de=>de.source&&!de.isHidden($)?[H.sourceCaches[de.source]]:[]),ye=oe.filter(de=>de.getSource().type==="vector"),ve=oe.filter(de=>de.getSource().type!=="vector"),be=de=>{(!X||X.getSource().maxzoom<de.getSource().maxzoom)&&(X=de)};return ye.forEach(de=>be(de)),X||ve.forEach(de=>be(de)),X}(this.style,this.transform.zoom);D&&function(H,$,X){for(let oe=0;oe<X.length;oe++)gf(H,$,X[oe])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const H=D.transform.padding;Qs(D,D.transform.height-(H.top||0),3,ch),Qs(D,H.bottom||0,3,mf),la(D,H.left||0,3,ey),la(D,D.transform.width-(H.right||0),3,lm);const $=D.transform.centerPoint;(function(X,oe,ye,ve){Rl(X,oe-1,ye-10,2,20,ve),Rl(X,oe-10,ye-1,20,2,ve)})(D,$.x,D.transform.height-$.y,Nr)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(a){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,p=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=a?!l.aY(d,p):!l.aZ(d,p)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.a_(d,p),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(x,A){const P=x.context,D=P.gl,H=Vr.unblended,$=new er(D.LEQUAL,er.ReadWrite,[0,1]),X=A.getTerrainMesh(),oe=A.sourceCache.getRenderableTiles(),ye=x.useProgram("terrainDepth");P.bindFramebuffer.set(A.getFramebuffer("depth").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:l.aO.transparent,depth:1});for(const ve of oe){const be=A.getTerrainData(ve.tileID),de={u_matrix:x.transform.calculatePosMatrix(ve.tileID.toUnwrapped()),u_ele_delta:A.getMeshFrameDelta(x.transform.zoom)};ye.draw(P,D.TRIANGLES,$,mr.disabled,H,hr.backCCW,de,be,"terrain",X.vertexBuffer,X.indexBuffer,X.segments)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain),function(x,A){const P=x.context,D=P.gl,H=Vr.unblended,$=new er(D.LEQUAL,er.ReadWrite,[0,1]),X=A.getTerrainMesh(),oe=A.getCoordsTexture(),ye=A.sourceCache.getRenderableTiles(),ve=x.useProgram("terrainCoords");P.bindFramebuffer.set(A.getFramebuffer("coords").framebuffer),P.viewport.set([0,0,x.width/devicePixelRatio,x.height/devicePixelRatio]),P.clear({color:l.aO.transparent,depth:1}),A.coordsIndex=[];for(const be of ye){const de=A.getTerrainData(be.tileID);P.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,oe.texture);const Le={u_matrix:x.transform.calculatePosMatrix(be.tileID.toUnwrapped()),u_terrain_coords_id:(255-A.coordsIndex.length)/255,u_texture:0,u_ele_delta:A.getMeshFrameDelta(x.transform.zoom)};ve.draw(P,D.TRIANGLES,$,mr.disabled,H,hr.backCCW,Le,de,"terrain",X.vertexBuffer,X.indexBuffer,X.segments),A.coordsIndex.push(be.tileID.key)}P.bindFramebuffer.set(null),P.viewport.set([0,0,x.width,x.height])}(this,this.style.map.terrain))}renderLayer(a,d,p,g){if(!p.isHidden(this.transform.zoom)&&(p.type==="background"||p.type==="custom"||(g||[]).length))switch(this.id=p.id,p.type){case"symbol":(function(x,A,P,D,H){if(x.renderPass!=="translucent")return;const $=mr.disabled,X=x.colorModeForRenderPass();(P._unevaluatedLayout.hasValue("text-variable-anchor")||P._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(oe,ye,ve,be,de,Le,Je){const Me=ye.transform,Oe=de==="map",et=Le==="map";for(const nt of oe){const ut=be.getTile(nt),St=ut.getBucket(ve);if(!St||!St.text||!St.text.segments.get().length)continue;const yt=l.ag(St.textSizeData,Me.zoom),xt=Mn(ut,1,ye.transform.zoom),Yt=Qe(nt.posMatrix,et,Oe,ye.transform,xt),Bn=ve.layout.get("icon-text-fit")!=="none"&&St.hasIconData();if(yt){const Nt=Math.pow(2,Me.zoom-ut.tileID.overscaledZ);oh(St,Oe,et,Je,Me,Yt,nt.posMatrix,Nt,yt,Bn,ye.style.map.terrain?(An,On)=>ye.style.map.terrain.getElevation(nt,An,On):null)}}}(D,x,P,A,P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),H),P.paint.get("icon-opacity").constantOr(1)!==0&&im(x,A,P,D,!1,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),P.layout.get("icon-rotation-alignment"),P.layout.get("icon-pitch-alignment"),P.layout.get("icon-keep-upright"),$,X),P.paint.get("text-opacity").constantOr(1)!==0&&im(x,A,P,D,!0,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),P.layout.get("text-rotation-alignment"),P.layout.get("text-pitch-alignment"),P.layout.get("text-keep-upright"),$,X),A.map.showCollisionBoxes&&(ah(x,A,P,D,P.paint.get("text-translate"),P.paint.get("text-translate-anchor"),!0),ah(x,A,P,D,P.paint.get("icon-translate"),P.paint.get("icon-translate-anchor"),!1))})(a,d,p,g,this.style.placement.variableOffsets);break;case"circle":(function(x,A,P,D){if(x.renderPass!=="translucent")return;const H=P.paint.get("circle-opacity"),$=P.paint.get("circle-stroke-width"),X=P.paint.get("circle-stroke-opacity"),oe=!P.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&($.constantOr(1)===0||X.constantOr(1)===0))return;const ye=x.context,ve=ye.gl,be=x.depthModeForSublayer(0,er.ReadOnly),de=mr.disabled,Le=x.colorModeForRenderPass(),Je=[];for(let Me=0;Me<D.length;Me++){const Oe=D[Me],et=A.getTile(Oe),nt=et.getBucket(P);if(!nt)continue;const ut=nt.programConfigurations.get(P.id),St=x.useProgram("circle",ut),yt=nt.layoutVertexBuffer,xt=nt.indexBuffer,Yt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Oe),Bn={programConfiguration:ut,program:St,layoutVertexBuffer:yt,indexBuffer:xt,uniformValues:Wp(x,Oe,et,P),terrainData:Yt};if(oe){const Nt=nt.segments.get();for(const An of Nt)Je.push({segments:new l.$([An]),sortKey:An.sortKey,state:Bn})}else Je.push({segments:nt.segments,sortKey:0,state:Bn})}oe&&Je.sort((Me,Oe)=>Me.sortKey-Oe.sortKey);for(const Me of Je){const{programConfiguration:Oe,program:et,layoutVertexBuffer:nt,indexBuffer:ut,uniformValues:St,terrainData:yt}=Me.state;et.draw(ye,ve.TRIANGLES,be,de,Le,hr.disabled,St,yt,P.id,nt,ut,Me.segments,P.paint,x.transform.zoom,Oe)}})(a,d,p,g);break;case"heatmap":(function(x,A,P,D){if(P.paint.get("heatmap-opacity")!==0)if(x.renderPass==="offscreen"){const H=x.context,$=H.gl,X=mr.disabled,oe=new Vr([$.ONE,$.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(ye,ve,be){const de=ye.gl;ye.activeTexture.set(de.TEXTURE1),ye.viewport.set([0,0,ve.width/4,ve.height/4]);let Le=be.heatmapFbo;if(Le)de.bindTexture(de.TEXTURE_2D,Le.colorAttachment.get()),ye.bindFramebuffer.set(Le.framebuffer);else{const Je=de.createTexture();de.bindTexture(de.TEXTURE_2D,Je),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_S,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_WRAP_T,de.CLAMP_TO_EDGE),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MIN_FILTER,de.LINEAR),de.texParameteri(de.TEXTURE_2D,de.TEXTURE_MAG_FILTER,de.LINEAR),Le=be.heatmapFbo=ye.createFramebuffer(ve.width/4,ve.height/4,!1,!1),function(Me,Oe,et,nt){var ut,St;const yt=Me.gl,xt=(ut=Me.HALF_FLOAT)!==null&&ut!==void 0?ut:yt.UNSIGNED_BYTE,Yt=(St=Me.RGBA16F)!==null&&St!==void 0?St:yt.RGBA;yt.texImage2D(yt.TEXTURE_2D,0,Yt,Oe.width/4,Oe.height/4,0,yt.RGBA,xt,null),nt.colorAttachment.set(et)}(ye,ve,Je,Le)}})(H,x,P),H.clear({color:l.aO.transparent});for(let ye=0;ye<D.length;ye++){const ve=D[ye];if(A.hasRenderableParent(ve))continue;const be=A.getTile(ve),de=be.getBucket(P);if(!de)continue;const Le=de.programConfigurations.get(P.id),Je=x.useProgram("heatmap",Le),{zoom:Me}=x.transform;Je.draw(H,$.TRIANGLES,er.disabled,X,oe,hr.disabled,qp(ve.posMatrix,be,Me,P.paint.get("heatmap-intensity")),null,P.id,de.layoutVertexBuffer,de.indexBuffer,de.segments,P.paint,x.transform.zoom,Le)}H.viewport.set([0,0,x.width,x.height])}else x.renderPass==="translucent"&&(x.context.setColorMode(x.colorModeForRenderPass()),function(H,$){const X=H.context,oe=X.gl,ye=$.heatmapFbo;if(!ye)return;X.activeTexture.set(oe.TEXTURE0),oe.bindTexture(oe.TEXTURE_2D,ye.colorAttachment.get()),X.activeTexture.set(oe.TEXTURE1);let ve=$.colorRampTexture;ve||(ve=$.colorRampTexture=new Be(X,$.colorRamp,oe.RGBA)),ve.bind(oe.LINEAR,oe.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(X,oe.TRIANGLES,er.disabled,mr.disabled,H.colorModeForRenderPass(),hr.disabled,((be,de,Le,Je)=>{const Me=l.F();l.aN(Me,0,be.width,be.height,0,0,1);const Oe=be.context.gl;return{u_matrix:Me,u_world:[Oe.drawingBufferWidth,Oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:de.paint.get("heatmap-opacity")}})(H,$),null,$.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,$.paint,H.transform.zoom)}(x,P))})(a,d,p,g);break;case"line":(function(x,A,P,D){if(x.renderPass!=="translucent")return;const H=P.paint.get("line-opacity"),$=P.paint.get("line-width");if(H.constantOr(1)===0||$.constantOr(1)===0)return;const X=x.depthModeForSublayer(0,er.ReadOnly),oe=x.colorModeForRenderPass(),ye=P.paint.get("line-dasharray"),ve=P.paint.get("line-pattern"),be=ve.constantOr(1),de=P.paint.get("line-gradient"),Le=P.getCrossfadeParameters(),Je=be?"linePattern":ye?"lineSDF":de?"lineGradient":"line",Me=x.context,Oe=Me.gl;let et=!0;for(const nt of D){const ut=A.getTile(nt);if(be&&!ut.patternsLoaded())continue;const St=ut.getBucket(P);if(!St)continue;const yt=St.programConfigurations.get(P.id),xt=x.context.program.get(),Yt=x.useProgram(Je,yt),Bn=et||Yt.program!==xt,Nt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(nt),An=ve.constantOr(null);if(An&&ut.imageAtlas){const In=ut.imageAtlas,Vn=In.patternPositions[An.to.toString()],Hn=In.patternPositions[An.from.toString()];Vn&&Hn&&yt.setConstantPatternPositions(Vn,Hn)}const On=Nt?nt:null,Xn=be?Ju(x,ut,P,Le,On):ye?Ma(x,ut,P,ye,Le,On):de?Co(x,ut,P,St.lineClipsArray.length,On):Ku(x,ut,P,On);if(be)Me.activeTexture.set(Oe.TEXTURE0),ut.imageAtlasTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),yt.updatePaintBuffers(Le);else if(ye&&(Bn||x.lineAtlas.dirty))Me.activeTexture.set(Oe.TEXTURE0),x.lineAtlas.bind(Me);else if(de){const In=St.gradients[P.id];let Vn=In.texture;if(P.gradientVersion!==In.version){let Hn=256;if(P.stepInterpolant){const Ar=A.getSource().maxzoom,dr=nt.canonical.z===Ar?Math.ceil(1<<x.transform.maxZoom-nt.canonical.z):1;Hn=l.ac(l.aT(St.maxLineLength/l.W*1024*dr),256,Me.maxTextureSize)}In.gradient=l.aU({expression:P.gradientExpression(),evaluationKey:"lineProgress",resolution:Hn,image:In.gradient||void 0,clips:St.lineClipsArray}),In.texture?In.texture.update(In.gradient):In.texture=new Be(Me,In.gradient,Oe.RGBA),In.version=P.gradientVersion,Vn=In.texture}Me.activeTexture.set(Oe.TEXTURE0),Vn.bind(P.stepInterpolant?Oe.NEAREST:Oe.LINEAR,Oe.CLAMP_TO_EDGE)}Yt.draw(Me,Oe.TRIANGLES,X,x.stencilModeForClipping(nt),oe,hr.disabled,Xn,Nt,P.id,St.layoutVertexBuffer,St.indexBuffer,St.segments,P.paint,x.transform.zoom,yt,St.layoutVertexBuffer2),et=!1}})(a,d,p,g);break;case"fill":(function(x,A,P,D){const H=P.paint.get("fill-color"),$=P.paint.get("fill-opacity");if($.constantOr(1)===0)return;const X=x.colorModeForRenderPass(),oe=P.paint.get("fill-pattern"),ye=x.opaquePassEnabledForLayer()&&!oe.constantOr(1)&&H.constantOr(l.aO.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(x.renderPass===ye){const ve=x.depthModeForSublayer(1,x.renderPass==="opaque"?er.ReadWrite:er.ReadOnly);ff(x,A,P,D,ve,X,!1)}if(x.renderPass==="translucent"&&P.paint.get("fill-antialias")){const ve=x.depthModeForSublayer(P.getPaintProperty("fill-outline-color")?2:0,er.ReadOnly);ff(x,A,P,D,ve,X,!0)}})(a,d,p,g);break;case"fill-extrusion":(function(x,A,P,D){const H=P.paint.get("fill-extrusion-opacity");if(H!==0&&x.renderPass==="translucent"){const $=new er(x.context.gl.LEQUAL,er.ReadWrite,x.depthRangeFor3D);if(H!==1||P.paint.get("fill-extrusion-pattern").constantOr(1))Pl(x,A,P,D,$,mr.disabled,Vr.disabled),Pl(x,A,P,D,$,x.stencilModeFor3D(),x.colorModeForRenderPass());else{const X=x.colorModeForRenderPass();Pl(x,A,P,D,$,mr.disabled,X)}}})(a,d,p,g);break;case"hillshade":(function(x,A,P,D){if(x.renderPass!=="offscreen"&&x.renderPass!=="translucent")return;const H=x.context,$=x.depthModeForSublayer(0,er.ReadOnly),X=x.colorModeForRenderPass(),[oe,ye]=x.renderPass==="translucent"?x.stencilConfigForOverlap(D):[{},D];for(const ve of ye){const be=A.getTile(ve);be.needsHillshadePrepare!==void 0&&be.needsHillshadePrepare&&x.renderPass==="offscreen"?sm(x,be,P,$,mr.disabled,X):x.renderPass==="translucent"&&pf(x,ve,be,P,$,oe[ve.overscaledZ],X)}H.viewport.set([0,0,x.width,x.height])})(a,d,p,g);break;case"raster":(function(x,A,P,D){if(x.renderPass!=="translucent"||P.paint.get("raster-opacity")===0||!D.length)return;const H=x.context,$=H.gl,X=A.getSource(),oe=x.useProgram("raster"),ye=x.colorModeForRenderPass(),[ve,be]=X instanceof vt?[{},D]:x.stencilConfigForOverlap(D),de=be[be.length-1].overscaledZ,Le=!x.options.moving;for(const Je of be){const Me=x.depthModeForSublayer(Je.overscaledZ-de,P.paint.get("raster-opacity")===1?er.ReadWrite:er.ReadOnly,$.LESS),Oe=A.getTile(Je);Oe.registerFadeDuration(P.paint.get("raster-fade-duration"));const et=A.findLoadedParent(Je,0),nt=om(Oe,et,A,P,x.transform,x.style.map.terrain);let ut,St;const yt=P.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;H.activeTexture.set($.TEXTURE0),Oe.texture.bind(yt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),H.activeTexture.set($.TEXTURE1),et?(et.texture.bind(yt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),ut=Math.pow(2,et.tileID.overscaledZ-Oe.tileID.overscaledZ),St=[Oe.tileID.canonical.x*ut%1,Oe.tileID.canonical.y*ut%1]):Oe.texture.bind(yt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const xt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(Je),Yt=xt?Je:null,Bn=Yt?Yt.posMatrix:x.transform.calculatePosMatrix(Je.toUnwrapped(),Le),Nt=Hc(Bn,St||[0,0],ut||1,nt,P);X instanceof vt?oe.draw(H,$.TRIANGLES,Me,mr.disabled,ye,hr.disabled,Nt,xt,P.id,X.boundsBuffer,x.quadTriangleIndexBuffer,X.boundsSegments):oe.draw(H,$.TRIANGLES,Me,ve[Je.overscaledZ],ye,hr.disabled,Nt,xt,P.id,x.rasterBoundsBuffer,x.quadTriangleIndexBuffer,x.rasterBoundsSegments)}})(a,d,p,g);break;case"background":(function(x,A,P,D){const H=P.paint.get("background-color"),$=P.paint.get("background-opacity");if($===0)return;const X=x.context,oe=X.gl,ye=x.transform,ve=ye.tileSize,be=P.paint.get("background-pattern");if(x.isPatternMissing(be))return;const de=!be&&H.a===1&&$===1&&x.opaquePassEnabledForLayer()?"opaque":"translucent";if(x.renderPass!==de)return;const Le=mr.disabled,Je=x.depthModeForSublayer(0,de==="opaque"?er.ReadWrite:er.ReadOnly),Me=x.colorModeForRenderPass(),Oe=x.useProgram(be?"backgroundPattern":"background"),et=D||ye.coveringTiles({tileSize:ve,terrain:x.style.map.terrain});be&&(X.activeTexture.set(oe.TEXTURE0),x.imageManager.bind(x.context));const nt=P.getCrossfadeParameters();for(const ut of et){const St=D?ut.posMatrix:x.transform.calculatePosMatrix(ut.toUnwrapped()),yt=be?Xp(St,$,x,be,{tileID:ut,tileSize:ve},nt):jv(St,$,H),xt=x.style.map.terrain&&x.style.map.terrain.getTerrainData(ut);Oe.draw(X,oe.TRIANGLES,Je,Le,Me,hr.disabled,yt,xt,P.id,x.tileExtentBuffer,x.quadTriangleIndexBuffer,x.tileExtentSegments)}})(a,0,p,g);break;case"custom":(function(x,A,P){const D=x.context,H=P.implementation;if(x.renderPass==="offscreen"){const $=H.prerender;$&&(x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),$.call(H,D.gl,x.transform.customLayerMatrix()),D.setDirty(),x.setBaseState())}else if(x.renderPass==="translucent"){x.setCustomLayerDefaults(),D.setColorMode(x.colorModeForRenderPass()),D.setStencilMode(mr.disabled);const $=H.renderingMode==="3d"?new er(x.context.gl.LEQUAL,er.ReadWrite,x.depthRangeFor3D):x.depthModeForSublayer(0,er.ReadOnly);D.setDepthMode($),H.render(D.gl,x.transform.customLayerMatrix()),D.setDirty(),x.setBaseState(),D.bindFramebuffer.set(null)}})(a,0,p)}}translatePosMatrix(a,d,p,g,x){if(!p[0]&&!p[1])return a;const A=x?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(A){const H=Math.sin(A),$=Math.cos(A);p=[p[0]*$-p[1]*H,p[0]*H+p[1]*$]}const P=[x?p[0]:Mn(d,p[0],this.transform.zoom),x?p[1]:Mn(d,p[1],this.transform.zoom),0],D=new Float32Array(16);return l.H(D,a,P),D}saveTileTexture(a){const d=this._tileTextures[a.size[0]];d?d.push(a):this._tileTextures[a.size[0]]=[a]}getTileTexture(a){const d=this._tileTextures[a];return d&&d.length>0?d.pop():null}isPatternMissing(a){if(!a)return!1;if(!a.from||!a.to)return!0;const d=this.imageManager.getPattern(a.from.toString()),p=this.imageManager.getPattern(a.to.toString());return!d||!p}useProgram(a,d){this.cache=this.cache||{};const p=a+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[p]||(this.cache[p]=new ef(this.context,Ps[a],d,Wv[a],this._showOverdrawInspector,this.style.map.terrain)),this.cache[p]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const a=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(a.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Be(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:a,drawingBufferHeight:d}=this.context.gl;return this.width!==a||this.height!==d}}class Io{constructor(a,d){this.points=a,this.planes=d}static fromInvProjectionMatrix(a,d,p){const g=Math.pow(2,p),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const D=1/(P=l.af([],P,a))[3]/d*g;return l.a$(P,P,[D,D,1/P[3],D])}),A=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const D=function(oe,ye){var ve=ye[0],be=ye[1],de=ye[2],Le=ve*ve+be*be+de*de;return Le>0&&(Le=1/Math.sqrt(Le)),oe[0]=ye[0]*Le,oe[1]=ye[1]*Le,oe[2]=ye[2]*Le,oe}([],function(oe,ye,ve){var be=ye[0],de=ye[1],Le=ye[2],Je=ve[0],Me=ve[1],Oe=ve[2];return oe[0]=de*Oe-Le*Me,oe[1]=Le*Je-be*Oe,oe[2]=be*Me-de*Je,oe}([],ie([],x[P[0]],x[P[1]]),ie([],x[P[2]],x[P[1]]))),H=-(($=D)[0]*(X=x[P[1]])[0]+$[1]*X[1]+$[2]*X[2]);var $,X;return D.concat(H)});return new Io(x,A)}}class Dl{constructor(a,d){this.min=a,this.max=d,this.center=function(p,g,x){return p[0]=.5*g[0],p[1]=.5*g[1],p[2]=.5*g[2],p}([],function(p,g,x){return p[0]=g[0]+x[0],p[1]=g[1]+x[1],p[2]=g[2]+x[2],p}([],this.min,this.max))}quadrant(a){const d=[a%2==0,a<2],p=ne(this.min),g=ne(this.max);for(let x=0;x<d.length;x++)p[x]=d[x]?this.min[x]:this.center[x],g[x]=d[x]?this.center[x]:this.max[x];return g[2]=this.max[2],new Dl(p,g)}distanceX(a){return Math.max(Math.min(this.max[0],a[0]),this.min[0])-a[0]}distanceY(a){return Math.max(Math.min(this.max[1],a[1]),this.min[1])-a[1]}intersects(a){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let p=!0;for(let g=0;g<a.planes.length;g++){const x=a.planes[g];let A=0;for(let P=0;P<d.length;P++)l.b0(x,d[P])>=0&&A++;if(A===0)return 0;A!==d.length&&(p=!1)}if(p)return 2;for(let g=0;g<3;g++){let x=Number.MAX_VALUE,A=-Number.MAX_VALUE;for(let P=0;P<a.points.length;P++){const D=a.points[P][g]-this.min[g];x=Math.min(x,D),A=Math.max(A,D)}if(A<0||x>this.max[g]-this.min[g])return 0}return 1}}class qc{constructor(a=0,d=0,p=0,g=0){if(isNaN(a)||a<0||isNaN(d)||d<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=a,this.bottom=d,this.left=p,this.right=g}interpolate(a,d,p){return d.top!=null&&a.top!=null&&(this.top=l.z.number(a.top,d.top,p)),d.bottom!=null&&a.bottom!=null&&(this.bottom=l.z.number(a.bottom,d.bottom,p)),d.left!=null&&a.left!=null&&(this.left=l.z.number(a.left,d.left,p)),d.right!=null&&a.right!=null&&(this.right=l.z.number(a.right,d.right,p)),this}getCenter(a,d){const p=l.ac((this.left+a-this.right)/2,0,a),g=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(p,g)}equals(a){return this.top===a.top&&this.bottom===a.bottom&&this.left===a.left&&this.right===a.right}clone(){return new qc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const yf=85.051129;class uh{constructor(a,d,p,g,x){this.tileSize=512,this._renderWorldCopies=x===void 0||!!x,this._minZoom=a||0,this._maxZoom=d||22,this._minPitch=p??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new qc,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const a=new uh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return a.apply(this),a}apply(a){this.tileSize=a.tileSize,this.latRange=a.latRange,this.width=a.width,this.height=a.height,this._center=a._center,this._elevation=a._elevation,this.minElevationForCurrentTile=a.minElevationForCurrentTile,this.zoom=a.zoom,this.angle=a.angle,this._fov=a._fov,this._pitch=a._pitch,this._unmodified=a._unmodified,this._edgeInsets=a._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(a){this._minZoom!==a&&(this._minZoom=a,this.zoom=Math.max(this.zoom,a))}get maxZoom(){return this._maxZoom}set maxZoom(a){this._maxZoom!==a&&(this._maxZoom=a,this.zoom=Math.min(this.zoom,a))}get minPitch(){return this._minPitch}set minPitch(a){this._minPitch!==a&&(this._minPitch=a,this.pitch=Math.max(this.pitch,a))}get maxPitch(){return this._maxPitch}set maxPitch(a){this._maxPitch!==a&&(this._maxPitch=a,this.pitch=Math.min(this.pitch,a))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(a){a===void 0?a=!0:a===null&&(a=!1),this._renderWorldCopies=a}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(a){const d=-l.b1(a,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var p=new l.A(4);return l.A!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p}(),function(p,g,x){var A=g[0],P=g[1],D=g[2],H=g[3],$=Math.sin(x),X=Math.cos(x);p[0]=A*X+D*$,p[1]=P*X+H*$,p[2]=A*-$+D*X,p[3]=P*-$+H*X}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(a){const d=l.ac(a,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(a){a=Math.max(.01,Math.min(60,a)),this._fov!==a&&(this._unmodified=!1,this._fov=a/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(a){const d=Math.min(Math.max(a,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(a){a.lat===this._center.lat&&a.lng===this._center.lng||(this._unmodified=!1,this._center=a,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(a){a!==this._elevation&&(this._elevation=a,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(a){this._edgeInsets.equals(a)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,a,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(a){return this._edgeInsets.equals(a)}interpolatePadding(a,d,p){this._unmodified=!1,this._edgeInsets.interpolate(a,d,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(a){const d=(a.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/a.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(a){const d=[new l.b2(0,a)];if(this._renderWorldCopies){const p=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),x=this.pointCoordinate(new l.P(this.width,this.height)),A=this.pointCoordinate(new l.P(0,this.height)),P=Math.floor(Math.min(p.x,g.x,x.x,A.x)),D=Math.floor(Math.max(p.x,g.x,x.x,A.x)),H=1;for(let $=P-H;$<=D+H;$++)$!==0&&d.push(new l.b2($,a))}return d}coveringTiles(a){var d,p;let g=this.coveringZoomLevel(a);const x=g;if(a.minzoom!==void 0&&g<a.minzoom)return[];a.maxzoom!==void 0&&g>a.maxzoom&&(g=a.maxzoom);const A=this.pointCoordinate(this.getCameraPoint()),P=l.Y.fromLngLat(this.center),D=Math.pow(2,g),H=[D*A.x,D*A.y,0],$=[D*P.x,D*P.y,0],X=Io.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let oe=a.minzoom||0;!a.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(oe=g);const ye=a.terrain?2/Math.min(this.tileSize,a.tileSize)*this.tileSize:3,ve=Me=>({aabb:new Dl([Me*D,0,0],[(Me+1)*D,D,0]),zoom:0,x:0,y:0,wrap:Me,fullyVisible:!1}),be=[],de=[],Le=g,Je=a.reparseOverscaled?x:g;if(this._renderWorldCopies)for(let Me=1;Me<=3;Me++)be.push(ve(-Me)),be.push(ve(Me));for(be.push(ve(0));be.length>0;){const Me=be.pop(),Oe=Me.x,et=Me.y;let nt=Me.fullyVisible;if(!nt){const Yt=Me.aabb.intersects(X);if(Yt===0)continue;nt=Yt===2}const ut=a.terrain?H:$,St=Me.aabb.distanceX(ut),yt=Me.aabb.distanceY(ut),xt=Math.max(Math.abs(St),Math.abs(yt));if(Me.zoom===Le||xt>ye+(1<<Le-Me.zoom)-2&&Me.zoom>=oe){const Yt=Le-Me.zoom,Bn=H[0]-.5-(Oe<<Yt),Nt=H[1]-.5-(et<<Yt);de.push({tileID:new l.Q(Me.zoom===Le?Je:Me.zoom,Me.wrap,Me.zoom,Oe,et),distanceSq:J([$[0]-.5-Oe,$[1]-.5-et]),tileDistanceToCamera:Math.sqrt(Bn*Bn+Nt*Nt)})}else for(let Yt=0;Yt<4;Yt++){const Bn=(Oe<<1)+Yt%2,Nt=(et<<1)+(Yt>>1),An=Me.zoom+1;let On=Me.aabb.quadrant(Yt);if(a.terrain){const Xn=new l.Q(An,Me.wrap,An,Bn,Nt),In=a.terrain.getMinMaxElevation(Xn),Vn=(d=In.minElevation)!==null&&d!==void 0?d:this.elevation,Hn=(p=In.maxElevation)!==null&&p!==void 0?p:this.elevation;On=new Dl([On.min[0],On.min[1],Vn],[On.max[0],On.max[1],Hn])}be.push({aabb:On,zoom:An,x:Bn,y:Nt,wrap:Me.wrap,fullyVisible:nt})}}return de.sort((Me,Oe)=>Me.distanceSq-Oe.distanceSq).map(Me=>Me.tileID)}resize(a,d){this.width=a,this.height=d,this.pixelsToGLUnits=[2/a,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(a){return Math.pow(2,a)}scaleZoom(a){return Math.log(a)/Math.LN2}project(a){const d=l.ac(a.lat,-85.051129,yf);return new l.P(l.N(a.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(a){return new l.Y(a.x/this.worldSize,a.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(a){const d=this.elevation,p=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,a),x=a.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-x))return;const A=p+d-x,P=Math.cos(this._pitch)*this.cameraToCenterDistance/A/l.b3(1,g.lat),D=this.scaleZoom(P/this.tileSize);this._elevation=x,this._center=g,this.zoom=D}setLocationAtPoint(a,d){const p=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(a),A=new l.Y(x.x-(p.x-g.x),x.y-(p.y-g.y));this.center=this.coordinateLocation(A),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(a,d){return d?this.coordinatePoint(this.locationCoordinate(a),d.getElevationForLngLatZoom(a,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(a))}pointLocation(a,d){return this.coordinateLocation(this.pointCoordinate(a,d))}locationCoordinate(a){return l.Y.fromLngLat(a)}coordinateLocation(a){return a&&a.toLngLat()}pointCoordinate(a,d){if(d){const oe=d.pointCoordinate(a);if(oe!=null)return oe}const p=[a.x,a.y,0,1],g=[a.x,a.y,1,1];l.af(p,p,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const x=p[3],A=g[3],P=p[1]/x,D=g[1]/A,H=p[2]/x,$=g[2]/A,X=H===$?0:(0-H)/($-H);return new l.Y(l.z.number(p[0]/x,g[0]/A,X)/this.worldSize,l.z.number(P,D,X)/this.worldSize)}coordinatePoint(a,d=0,p=this.pixelMatrix){const g=[a.x*this.worldSize,a.y*this.worldSize,d,1];return l.af(g,g,p),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const a=Math.max(0,this.height/2-this.getHorizon());return new un().extend(this.pointLocation(new l.P(0,a))).extend(this.pointLocation(new l.P(this.width,a))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new un([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(a){a?(this.lngRange=[a.getWest(),a.getEast()],this.latRange=[a.getSouth(),a.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,yf])}calculatePosMatrix(a,d=!1){const p=a.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];const x=a.canonical,A=this.worldSize/this.zoomScale(x.z),P=x.x+Math.pow(2,x.z)*a.wrap,D=l.an(new Float64Array(16));return l.H(D,D,[P*A,x.y*A,0]),l.J(D,D,[A/l.W,A/l.W,1]),l.K(D,d?this.alignedProjMatrix:this.projMatrix,D),g[p]=new Float32Array(D),g[p]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(a,d){d=l.ac(+d,this.minZoom,this.maxZoom);const p={center:new l.M(a.lng,a.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const Me=179.9999999999;g=[-Me,Me]}const x=this.tileSize*this.zoomScale(p.zoom);let A=0,P=x,D=0,H=x,$=0,X=0;const{x:oe,y:ye}=this.size;if(this.latRange){const Me=this.latRange;A=l.O(Me[1])*x,P=l.O(Me[0])*x,P-A<ye&&($=ye/(P-A))}g&&(D=l.b1(l.N(g[0])*x,0,x),H=l.b1(l.N(g[1])*x,0,x),H<D&&(H+=x),H-D<oe&&(X=oe/(H-D)));const{x:ve,y:be}=this.project.call({worldSize:x},a);let de,Le;const Je=Math.max(X||0,$||0);if(Je){const Me=new l.P(X?(H+D)/2:ve,$?(P+A)/2:be);return p.center=this.unproject.call({worldSize:x},Me).wrap(),p.zoom+=this.scaleZoom(Je),p}if(this.latRange){const Me=ye/2;be-Me<A&&(Le=A+Me),be+Me>P&&(Le=P-Me)}if(g){const Me=(D+H)/2;let Oe=ve;this._renderWorldCopies&&(Oe=l.b1(ve,Me-x/2,Me+x/2));const et=oe/2;Oe-et<D&&(de=D+et),Oe+et>H&&(de=H-et)}if(de!==void 0||Le!==void 0){const Me=new l.P(de??ve,Le??be);p.center=this.unproject.call({worldSize:x},Me).wrap()}return p}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const a=this._unmodified,{center:d,zoom:p}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=p,this._unmodified=a,this._constraining=!1}_calcMatrices(){if(!this.height)return;const a=this.centerOffset,d=this.point.x,p=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.J(g,g,[this.width/2,-this.height/2,1]),l.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.J(g,g,[1,-1,1]),l.H(g,g,[-1,-1,0]),l.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const x=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),A=Math.min(this.elevation,this.minElevationForCurrentTile),P=x-A*this._pixelPerMeter/Math.cos(this._pitch),D=A<0?P:x,H=Math.PI/2+this._pitch,$=this._fov*(.5+a.y/this.height),X=Math.sin($)*D/Math.sin(l.ac(Math.PI-H-$,.01,Math.PI-.01)),oe=this.getHorizon(),ye=2*Math.atan(oe/this.cameraToCenterDistance)*(.5+a.y/(2*oe)),ve=Math.sin(ye)*D/Math.sin(l.ac(Math.PI-H-ye,.01,Math.PI-.01)),be=Math.min(X,ve),de=1.01*(Math.cos(Math.PI/2-this._pitch)*be+D),Le=this.height/50;g=new Float64Array(16),l.b4(g,this._fov,this.width/this.height,Le,de),g[8]=2*-a.x/this.width,g[9]=2*a.y/this.height,l.J(g,g,[1,-1,1]),l.H(g,g,[0,0,-this.cameraToCenterDistance]),l.b5(g,g,this._pitch),l.ad(g,g,this.angle),l.H(g,g,[-d,-p,0]),this.mercatorMatrix=l.J([],g,[this.worldSize,this.worldSize,this.worldSize]),l.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,g),l.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.ar([],g),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,g);const Je=this.width%2/2,Me=this.height%2/2,Oe=Math.cos(this.angle),et=Math.sin(this.angle),nt=d-Math.round(d)+Oe*Je+et*Me,ut=p-Math.round(p)+Oe*Me+et*Je,St=new Float64Array(g);if(l.H(St,St,[nt>.5?nt-1:nt,ut>.5?ut-1:ut,0]),this.alignedProjMatrix=St,g=l.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const a=this.pointCoordinate(new l.P(0,0)),d=[a.x*this.worldSize,a.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const a=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,a))}getCameraQueryGeometry(a){const d=this.getCameraPoint();if(a.length===1)return[a[0],d];{let p=d.x,g=d.y,x=d.x,A=d.y;for(const P of a)p=Math.min(p,P.x),g=Math.min(g,P.y),x=Math.max(x,P.x),A=Math.max(A,P.y);return[new l.P(p,g),new l.P(x,g),new l.P(x,A),new l.P(p,A),new l.P(p,g)]}}lngLatToCameraDepth(a,d){const p=this.locationCoordinate(a),g=[p.x*this.worldSize,p.y*this.worldSize,d,1];return l.af(g,g,this.projMatrix),g[2]/g[3]}}function _f(y,a){let d,p=!1,g=null,x=null;const A=()=>{g=null,p&&(y.apply(x,d),g=setTimeout(A,a),p=!1)};return(...P)=>(p=!0,x=this,d=P,g||A(),g)}class xf{constructor(a){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let p;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(p=g)}),(p&&p[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(p=>isNaN(p))){const p=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:p,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=_f(this._updateHashUnthrottled,300),this._hashName=a&&encodeURIComponent(a)}addTo(a){return this._map=a,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(a){const d=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,g),A=Math.round(d.lng*x)/x,P=Math.round(d.lat*x)/x,D=this._map.getBearing(),H=this._map.getPitch();let $="";if($+=a?`/${A}/${P}/${p}`:`${p}/${P}/${A}`,(D||H)&&($+="/"+Math.round(10*D)/10),H&&($+=`/${Math.round(H)}`),this._hashName){const X=this._hashName;let oe=!1;const ye=window.location.hash.slice(1).split("&").map(ve=>{const be=ve.split("=")[0];return be===X?(oe=!0,`${be}=${$}`):ve}).filter(ve=>ve);return oe||ye.push(`${X}=${$}`),`#${ye.join("&")}`}return`#${$}`}}const os={linearity:.3,easing:l.b6(0,0,.3,1)},cm=l.e({deceleration:2500,maxSpeed:1400},os),um=l.e({deceleration:20,maxSpeed:1400},os),hm=l.e({deceleration:1e3,maxSpeed:360},os),dm=l.e({deceleration:1e3,maxSpeed:90},os);class fm{constructor(a){this._map=a,this.clear()}clear(){this._inertiaBuffer=[]}record(a){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:T.now(),settings:a})}_drainInertiaBuffer(){const a=this._inertiaBuffer,d=T.now();for(;a.length>0&&d-a[0].time>160;)a.shift()}_onMoveEnd(a){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)d.zoom+=x.zoomDelta||0,d.bearing+=x.bearingDelta||0,d.pitch+=x.pitchDelta||0,x.panDelta&&d.pan._add(x.panDelta),x.around&&(d.around=x.around),x.pinchAround&&(d.pinchAround=x.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const x=Xc(d.pan.mag(),p,l.e({},cm,a||{}));g.offset=d.pan.mult(x.amount/d.pan.mag()),g.center=this._map.transform.center,$c(g,x)}if(d.zoom){const x=Xc(d.zoom,p,um);g.zoom=this._map.transform.zoom+x.amount,$c(g,x)}if(d.bearing){const x=Xc(d.bearing,p,hm);g.bearing=this._map.transform.bearing+l.ac(x.amount,-179,179),$c(g,x)}if(d.pitch){const x=Xc(d.pitch,p,dm);g.pitch=this._map.transform.pitch+x.amount,$c(g,x)}if(g.zoom||g.bearing){const x=d.pinchAround===void 0?d.around:d.pinchAround;g.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function $c(y,a){(!y.duration||y.duration<a.duration)&&(y.duration=a.duration,y.easing=a.easing)}function Xc(y,a,d){const{maxSpeed:p,linearity:g,deceleration:x}=d,A=l.ac(y*g/(a/1e3),-p,p),P=Math.abs(A)/(x*g);return{easing:d.easing,duration:1e3*P,amount:A*(P/2)}}class di extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,p,g={}){const x=M.mousePos(d.getCanvas(),p),A=d.unproject(x);super(a,l.e({point:x,lngLat:A,originalEvent:p},g)),this._defaultPrevented=!1,this.target=d}}class kl extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,p){const g=a==="touchend"?p.changedTouches:p.touches,x=M.touchPos(d.getCanvasContainer(),g),A=x.map(D=>d.unproject(D)),P=x.reduce((D,H,$,X)=>D.add(H.div(X.length)),new l.P(0,0));super(a,{points:x,point:P,lngLats:A,lngLat:d.unproject(P),originalEvent:p}),this._defaultPrevented=!1}}class Ta extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(a,d,p){super(a,{originalEvent:p}),this._defaultPrevented=!1}}class ls{constructor(a,d){this._map=a,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(a){return this._firePreventable(new Ta(a.type,this._map,a))}mousedown(a,d){return this._mousedownPos=d,this._firePreventable(new di(a.type,this._map,a))}mouseup(a){this._map.fire(new di(a.type,this._map,a))}click(a,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new di(a.type,this._map,a))}dblclick(a){return this._firePreventable(new di(a.type,this._map,a))}mouseover(a){this._map.fire(new di(a.type,this._map,a))}mouseout(a){this._map.fire(new di(a.type,this._map,a))}touchstart(a){return this._firePreventable(new kl(a.type,this._map,a))}touchmove(a){this._map.fire(new kl(a.type,this._map,a))}touchend(a){this._map.fire(new kl(a.type,this._map,a))}touchcancel(a){this._map.fire(new kl(a.type,this._map,a))}_firePreventable(a){if(this._map.fire(a),a.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class pm{constructor(a){this._map=a}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(a){this._map.fire(new di(a.type,this._map,a))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new di("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(a){this._delayContextMenu?this._contextMenuEvent=a:this._ignoreContextMenu||this._map.fire(new di(a.type,this._map,a)),this._map.listens("contextmenu")&&a.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qi{constructor(a){this._map=a}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(a){return this.transform.pointLocation(l.P.convert(a),this._map.terrain)}}class Ll{constructor(a,d){this._map=a,this._tr=new qi(a),this._el=a.getCanvasContainer(),this._container=a.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(a,d){this.isEnabled()&&a.shiftKey&&a.button===0&&(M.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(a,d){if(!this._active)return;const p=d;if(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=p,this._box||(this._box=M.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",a));const x=Math.min(g.x,p.x),A=Math.max(g.x,p.x),P=Math.min(g.y,p.y),D=Math.max(g.y,p.y);M.setTransform(this._box,`translate(${x}px,${P}px)`),this._box.style.width=A-x+"px",this._box.style.height=D-P+"px"}mouseupWindow(a,d){if(!this._active||a.button!==0)return;const p=this._startPos,g=d;if(this.reset(),M.suppressClick(),p.x!==g.x||p.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:a})),{cameraAnimation:x=>x.fitScreenCoordinates(p,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",a)}keydown(a){this._active&&a.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",a))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(M.remove(this._box),this._box=null),M.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(a,d){return this._map.fire(new l.k(a,{originalEvent:d}))}}function bf(y,a){if(y.length!==a.length)throw new Error(`The number of touches and points are not equal - touches ${y.length}, points ${a.length}`);const d={};for(let p=0;p<y.length;p++)d[y[p].identifier]=a[p];return d}class ty{constructor(a){this.reset(),this.numTouches=a.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(a,d,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=a.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){const x=new l.P(0,0);for(const A of g)x._add(A);return x.div(g.length)}(d),this.touches=bf(p,d)))}touchmove(a,d,p){if(this.aborted||!this.centroid)return;const g=bf(p,d);for(const x in this.touches){const A=g[x];(!A||A.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(a,d,p){if((!this.centroid||a.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class wf{constructor(a){this.singleTap=new ty(a),this.numTaps=a.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(a,d,p){this.singleTap.touchstart(a,d,p)}touchmove(a,d,p){this.singleTap.touchmove(a,d,p)}touchend(a,d,p){const g=this.singleTap.touchend(a,d,p);if(g){const x=a.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(g)<30;if(x&&A||this.reset(),this.count++,this.lastTime=a.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class mm{constructor(a){this._tr=new qi(a),this._zoomIn=new wf({numTouches:1,numTaps:2}),this._zoomOut=new wf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(a,d,p){this._zoomIn.touchstart(a,d,p),this._zoomOut.touchstart(a,d,p)}touchmove(a,d,p){this._zoomIn.touchmove(a,d,p),this._zoomOut.touchmove(a,d,p)}touchend(a,d,p){const g=this._zoomIn.touchend(a,d,p),x=this._zoomOut.touchend(a,d,p),A=this._tr;return g?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom+1,around:A.unproject(g)},{originalEvent:a})}):x?(this._active=!0,a.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:A.zoom-1,around:A.unproject(x)},{originalEvent:a})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rs{constructor(a){this._enabled=!!a.enable,this._moveStateManager=a.moveStateManager,this._clickTolerance=a.clickTolerance||1,this._moveFunction=a.move,this._activateOnStart=!!a.activateOnStart,a.assignEvents(this),this.reset()}reset(a){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(a)}_move(...a){const d=this._moveFunction(...a);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(a,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(a)&&(this._moveStateManager.startMove(a),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(a,d){if(!this.isEnabled())return;const p=this._lastPoint;if(!p)return;if(a.preventDefault(),!this._moveStateManager.isValidMoveEvent(a))return void this.reset(a);const g=d.length?d[0]:d;return!this._moved&&g.dist(p)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(p,g))}dragEnd(a){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(a)&&(this._moved&&M.suppressClick(),this.reset(a))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const eo={0:1,2:2};class Jt{constructor(a){this._correctEvent=a.checkCorrectEvent}startMove(a){const d=M.mouseButton(a);this._eventButton=d}endMove(a){delete this._eventButton}isValidStartEvent(a){return this._correctEvent(a)}isValidMoveEvent(a){return!function(d,p){const g=eo[p];return d.buttons===void 0||(d.buttons&g)!==g}(a,this._eventButton)}isValidEndEvent(a){return M.mouseButton(a)===this._eventButton}}class Sf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(a){return a.targetTouches.length===1}_isSameTouchEvent(a){return a.targetTouches[0].identifier===this._firstTouch}startMove(a){this._firstTouch=a.targetTouches[0].identifier}endMove(a){delete this._firstTouch}isValidStartEvent(a){return this._isOneFingerTouch(a)}isValidMoveEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}isValidEndEvent(a){return this._isOneFingerTouch(a)&&this._isSameTouchEvent(a)}}const Do=y=>{y.mousedown=y.dragStart,y.mousemoveWindow=y.dragMove,y.mouseup=y.dragEnd,y.contextmenu=function(a){a.preventDefault()}},zl=({enable:y,clickTolerance:a,bearingDegreesPerPixelMoved:d=.8})=>{const p=new Jt({checkCorrectEvent:g=>M.mouseButton(g)===0&&g.ctrlKey||M.mouseButton(g)===2});return new Rs({clickTolerance:a,move:(g,x)=>({bearingDelta:(x.x-g.x)*d}),moveStateManager:p,enable:y,assignEvents:Do})},Mf=({enable:y,clickTolerance:a,pitchDegreesPerPixelMoved:d=-.5})=>{const p=new Jt({checkCorrectEvent:g=>M.mouseButton(g)===0&&g.ctrlKey||M.mouseButton(g)===2});return new Rs({clickTolerance:a,move:(g,x)=>({pitchDelta:(x.y-g.y)*d}),moveStateManager:p,enable:y,assignEvents:Do})};class $t{constructor(a,d){this._clickTolerance=a.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(a,d,p){return this._calculateTransform(a,d,p)}touchmove(a,d,p){if(this._active&&!(p.length<this.minTouchs()))return a.preventDefault(),this._calculateTransform(a,d,p)}touchend(a,d,p){this._calculateTransform(a,d,p),this._active&&p.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(a,d,p){p.length>0&&(this._active=!0);const g=bf(p,d),x=new l.P(0,0),A=new l.P(0,0);let P=0;for(const H in g){const $=g[H],X=this._touches[H];X&&(x._add($),A._add($.sub(X)),P++,g[H]=$)}if(this._touches=g,P<this.minTouchs()||!A.mag())return;const D=A.div(P);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(P),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Zc{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(a,d,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([d[0],d[1]]))}touchmove(a,d,p){if(!this._firstTwoTouches)return;a.preventDefault();const[g,x]=this._firstTwoTouches,A=hh(p,d,g),P=hh(p,d,x);if(!A||!P)return;const D=this._aroundCenter?null:A.add(P).div(2);return this._move([A,P],D,a)}touchend(a,d,p){if(!this._firstTwoTouches)return;const[g,x]=this._firstTwoTouches,A=hh(p,d,g),P=hh(p,d,x);A&&P||(this._active&&M.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(a){this._enabled=!0,this._aroundCenter=!!a&&a.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function hh(y,a,d){for(let p=0;p<y.length;p++)if(y[p].identifier===d)return a[p]}function gm(y,a){return Math.log(y/a)/Math.LN2}class dh extends Zc{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(a){this._startDistance=this._distance=a[0].dist(a[1])}_move(a,d){const p=this._distance;if(this._distance=a[0].dist(a[1]),this._active||!(Math.abs(gm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:gm(this._distance,p),pinchAround:d}}}function Tf(y,a){return 180*y.angleWith(a)/Math.PI}class Ef extends Zc{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(a){this._startVector=this._vector=a[0].sub(a[1]),this._minDiameter=a[0].dist(a[1])}_move(a,d,p){const g=this._vector;if(this._vector=a[0].sub(a[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Tf(this._vector,g),pinchAround:d}}_isBelowThreshold(a){this._minDiameter=Math.min(this._minDiameter,a.mag());const d=25/(Math.PI*this._minDiameter)*360,p=Tf(a,this._startVector);return Math.abs(p)<d}}function Af(y){return Math.abs(y.y)>Math.abs(y.x)}class vm extends Zc{constructor(a){super(),this._currentTouchCount=0,this._map=a}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(a,d,p){super.touchstart(a,d,p),this._currentTouchCount=p.length}_start(a){this._lastPoints=a,Af(a[0].sub(a[1]))&&(this._valid=!1)}_move(a,d,p){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=a[0].sub(this._lastPoints[0]),x=a[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,x,p.timeStamp),this._valid?(this._lastPoints=a,this._active=!0,{pitchDelta:(g.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(a,d,p){if(this._valid!==void 0)return this._valid;const g=a.mag()>=2,x=d.mag()>=2;if(!g&&!x)return;if(!g||!x)return this._firstMove===void 0&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=a.y>0==d.y>0;return Af(a)&&Af(d)&&A}}const ko={panStep:100,bearingStep:15,pitchStep:10};class _r{constructor(a){this._tr=new qi(a);const d=ko;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(a){if(a.altKey||a.ctrlKey||a.metaKey)return;let d=0,p=0,g=0,x=0,A=0;switch(a.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:a.shiftKey?p=-1:(a.preventDefault(),x=-1);break;case 39:a.shiftKey?p=1:(a.preventDefault(),x=1);break;case 38:a.shiftKey?g=1:(a.preventDefault(),A=-1);break;case 40:a.shiftKey?g=-1:(a.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,g=0),{cameraAnimation:P=>{const D=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:fh,zoom:d?Math.round(D.zoom)+d*(a.shiftKey?2:1):D.zoom,bearing:D.bearing+p*this._bearingStep,pitch:D.pitch+g*this._pitchStep,offset:[-x*this._panStep,-A*this._panStep],center:D.center},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function fh(y){return y*(2-y)}const ph=4.000244140625;class Cf{constructor(a,d){this._onTimeout=p=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(p)},this._map=a,this._tr=new qi(a),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(a){this._defaultZoomRate=a}setWheelZoomRate(a){this._wheelZoomRate=a}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(a){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!a&&a.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(a){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!a[this._map.cooperativeGestures._bypassKey])return;let d=a.deltaMode===WheelEvent.DOM_DELTA_LINE?40*a.deltaY:a.deltaY;const p=T.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,d!==0&&d%ph==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,a)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),a.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=a,this._delta-=d,this._active||this._start(a)),a.preventDefault()}_start(a){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=M.mousePos(this._map.getCanvas(),a),p=this._tr;this._around=d.y>p.transform.height/2-p.transform.getHorizon()?l.M.convert(this._aroundCenter?p.center:p.unproject(d)):l.M.convert(p.center),this._aroundPoint=p.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const a=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>ph?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&D!==0&&(D=1/D);const H=typeof this._targetZoom=="number"?a.zoomScale(this._targetZoom):a.scale;this._targetZoom=Math.min(a.maxZoom,Math.max(a.minZoom,a.scaleZoom(H*D))),this._type==="wheel"&&(this._startZoom=a.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:a.zoom,p=this._startZoom,g=this._easing;let x,A=!1;if(this._type==="wheel"&&p&&g){const P=Math.min((T.now()-this._lastWheelEventTime)/200,1),D=g(P);x=l.z.number(p,d,D),P<1?this._frameId||(this._frameId=!0):A=!0}else x=d,A=!0;return this._active=!0,A&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!A,zoomDelta:x-a.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(a){let d=l.b7;if(this._prevEase){const p=this._prevEase,g=(T.now()-p.start)/p.duration,x=p.easing(g+.01)-p.easing(g),A=.27/Math.sqrt(x*x+1e-4)*.01,P=Math.sqrt(.0729-A*A);d=l.b6(A,P,.25,1)}return this._prevEase={start:T.now(),duration:a,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Pf{constructor(a,d){this._clickZoom=a,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ym{constructor(a){this._tr=new qi(a),this.reset()}reset(){this._active=!1}dblclick(a,d){return a.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:this._tr.zoom+(a.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:a})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ny{constructor(){this._tap=new wf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(a,d,p){if(!this._swipePoint)if(this._tapTime){const g=d[0],x=a.timeStamp-this._tapTime<500,A=this._tapPoint.dist(g)<30;x&&A?p.length>0&&(this._swipePoint=g,this._swipeTouch=p[0].identifier):this.reset()}else this._tap.touchstart(a,d,p)}touchmove(a,d,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const g=d[0],x=g.y-this._swipePoint.y;return this._swipePoint=g,a.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(a,d,p)}touchend(a,d,p){if(this._tapTime)this._swipePoint&&p.length===0&&this.reset();else{const g=this._tap.touchend(a,d,p);g&&(this._tapTime=a.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Oa{constructor(a,d,p){this._el=a,this._mousePan=d,this._touchPan=p}enable(a){this._inertiaOptions=a||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yc{constructor(a,d,p){this._pitchWithRotate=a.pitchWithRotate,this._mouseRotate=d,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class mn{constructor(a,d,p,g){this._el=a,this._touchZoom=d,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(a){this._touchZoom.enable(a),this._rotationDisabled||this._touchRotate.enable(a),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Tn{constructor(a,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=a,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const a=this._map.getCanvasContainer();a.classList.add("maplibregl-cooperative-gestures"),this._container=M.create("div","maplibregl-cooperative-gesture-screen",a);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const p=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const x=document.createElement("div");x.className="maplibregl-mobile-message",x.textContent=p,this._container.appendChild(x),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(M.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(a){this._onCooperativeGesture(a.touches.length===1)}wheel(a){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!a[this._bypassKey])}_onCooperativeGesture(a){this._enabled&&a&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Lo=y=>y.zoom||y.drag||y.pitch||y.rotate;class Rf extends l.k{}function Kc(y){return y.panDelta&&y.panDelta.mag()||y.zoomDelta||y.bearingDelta||y.pitchDelta}class $i{constructor(a,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,x)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const A=g.type==="renderFrame"?void 0:g,P={needsRenderFrame:!1},D={},H={},$=g.touches,X=$?this._getMapTouches($):void 0,oe=X?M.touchPos(this._map.getCanvas(),X):M.mousePos(this._map.getCanvas(),g);for(const{handlerName:be,handler:de,allowed:Le}of this._handlers){if(!de.isEnabled())continue;let Je;this._blockedByActive(H,Le,be)?de.reset():de[x||g.type]&&(Je=de[x||g.type](g,oe,X),this.mergeHandlerResult(P,D,Je,be,A),Je&&Je.needsRenderFrame&&this._triggerRenderFrame()),(Je||de.isActive())&&(H[be]=de)}const ye={};for(const be in this._previousActiveHandlers)H[be]||(ye[be]=A);this._previousActiveHandlers=H,(Object.keys(ye).length||Kc(P))&&(this._changes.push([P,D,ye]),this._triggerRenderFrame()),(Object.keys(H).length||Kc(P))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ve}=P;ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))},this._map=a,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new fm(a),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,x,A]of this._listeners)M.addEventListener(g,x,g===document?this.handleWindowEvent:this.handleEvent,A)}destroy(){for(const[a,d,p]of this._listeners)M.removeEventListener(a,d,a===document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(a){const d=this._map,p=d.getCanvasContainer();this._add("mapEvent",new ls(d,a));const g=d.boxZoom=new Ll(d,a);this._add("boxZoom",g),a.interactive&&a.boxZoom&&g.enable();const x=d.cooperativeGestures=new Tn(d,a.cooperativeGestures);this._add("cooperativeGestures",x),a.cooperativeGestures&&x.enable();const A=new mm(d),P=new ym(d);d.doubleClickZoom=new Pf(P,A),this._add("tapZoom",A),this._add("clickZoom",P),a.interactive&&a.doubleClickZoom&&d.doubleClickZoom.enable();const D=new ny;this._add("tapDragZoom",D);const H=d.touchPitch=new vm(d);this._add("touchPitch",H),a.interactive&&a.touchPitch&&d.touchPitch.enable(a.touchPitch);const $=zl(a),X=Mf(a);d.dragRotate=new Yc(a,$,X),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",X,["mouseRotate"]),a.interactive&&a.dragRotate&&d.dragRotate.enable();const oe=(({enable:Je,clickTolerance:Me})=>{const Oe=new Jt({checkCorrectEvent:et=>M.mouseButton(et)===0&&!et.ctrlKey});return new Rs({clickTolerance:Me,move:(et,nt)=>({around:nt,panDelta:nt.sub(et)}),activateOnStart:!0,moveStateManager:Oe,enable:Je,assignEvents:Do})})(a),ye=new $t(a,d);d.dragPan=new Oa(p,oe,ye),this._add("mousePan",oe),this._add("touchPan",ye,["touchZoom","touchRotate"]),a.interactive&&a.dragPan&&d.dragPan.enable(a.dragPan);const ve=new Ef,be=new dh;d.touchZoomRotate=new mn(p,be,ve,D),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",be,["touchPan","touchRotate"]),a.interactive&&a.touchZoomRotate&&d.touchZoomRotate.enable(a.touchZoomRotate);const de=d.scrollZoom=new Cf(d,()=>this._triggerRenderFrame());this._add("scrollZoom",de,["mousePan"]),a.interactive&&a.scrollZoom&&d.scrollZoom.enable(a.scrollZoom);const Le=d.keyboard=new _r(d);this._add("keyboard",Le),a.interactive&&a.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new pm(d))}_add(a,d,p){this._handlers.push({handlerName:a,handler:d,allowed:p}),this._handlersById[a]=d}stop(a){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},a),this._changes=[]}}isActive(){for(const{handler:a}of this._handlers)if(a.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Lo(this._eventsInProgress)||this.isZooming()}_blockedByActive(a,d,p){for(const g in a)if(g!==p&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(a){const d=[];for(const p of a)this._el.contains(p.target)&&d.push(p);return d}mergeHandlerResult(a,d,p,g,x){if(!p)return;l.e(a,p);const A={handlerName:g,originalEvent:p.originalEvent||x};p.zoomDelta!==void 0&&(d.zoom=A),p.panDelta!==void 0&&(d.drag=A),p.pitchDelta!==void 0&&(d.pitch=A),p.bearingDelta!==void 0&&(d.rotate=A)}_applyChanges(){const a={},d={},p={};for(const[g,x,A]of this._changes)g.panDelta&&(a.panDelta=(a.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(a.zoomDelta=(a.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(a.bearingDelta=(a.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(a.pitchDelta=(a.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(a.around=g.around),g.pinchAround!==void 0&&(a.pinchAround=g.pinchAround),g.noInertia&&(a.noInertia=g.noInertia),l.e(d,x),l.e(p,A);this._updateMapTransform(a,d,p),this._changes=[]}_updateMapTransform(a,d,p){const g=this._map,x=g._getTransformForUpdate(),A=g.terrain;if(!(Kc(a)||A&&this._terrainMovement))return this._fireEvents(d,p,!0);let{panDelta:P,zoomDelta:D,bearingDelta:H,pitchDelta:$,around:X,pinchAround:oe}=a;oe!==void 0&&(X=oe),g._stop(!0),X=X||g.transform.centerPoint;const ye=x.pointLocation(P?X.sub(P):X);H&&(x.bearing+=H),$&&(x.pitch+=$),D&&(x.zoom+=D),A?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(P)):x.setLocationAtPoint(ye,X):(this._terrainMovement=!0,this._map._elevationFreeze=!0,x.setLocationAtPoint(ye,X),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,x.recalculateZoom(g.terrain)})):x.setLocationAtPoint(ye,X),g._applyUpdatedTransform(x),this._map._update(),a.noInertia||this._inertia.record(a),this._fireEvents(d,p,!0)}_fireEvents(a,d,p){const g=Lo(this._eventsInProgress),x=Lo(a),A={};for(const $ in a){const{originalEvent:X}=a[$];this._eventsInProgress[$]||(A[`${$}start`]=X),this._eventsInProgress[$]=a[$]}!g&&x&&this._fireEvent("movestart",x.originalEvent);for(const $ in A)this._fireEvent($,A[$]);x&&this._fireEvent("move",x.originalEvent);for(const $ in a){const{originalEvent:X}=a[$];this._fireEvent($,X)}const P={};let D;for(const $ in this._eventsInProgress){const{handlerName:X,originalEvent:oe}=this._eventsInProgress[$];this._handlersById[X].isActive()||(delete this._eventsInProgress[$],D=d[X]||oe,P[`${$}end`]=D)}for(const $ in P)this._fireEvent($,P[$]);const H=Lo(this._eventsInProgress);if(p&&(g||x)&&!H){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),X=oe=>oe!==0&&-this._bearingSnap<oe&&oe<this._bearingSnap;!$||!$.essential&&T.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:D})),X(this._map.getBearing())&&this._map.resetNorth()):(X($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(a,d){this._map.fire(new l.k(a,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(a=>{delete this._frameId,this.handleEvent(new Rf("renderFrame",{timeStamp:a})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class _m extends l.E{constructor(a,d){super(),this._renderFrameCallback=()=>{const p=Math.min((T.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=a,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(a,d){return this.jumpTo({center:a},d)}panBy(a,d,p){return a=l.P.convert(a).mult(-1),this.panTo(this.transform.center,l.e({offset:a},d),p)}panTo(a,d,p){return this.easeTo(l.e({center:a},d),p)}getZoom(){return this.transform.zoom}setZoom(a,d){return this.jumpTo({zoom:a},d),this}zoomTo(a,d,p){return this.easeTo(l.e({zoom:a},d),p)}zoomIn(a,d){return this.zoomTo(this.getZoom()+1,a,d),this}zoomOut(a,d){return this.zoomTo(this.getZoom()-1,a,d),this}getBearing(){return this.transform.bearing}setBearing(a,d){return this.jumpTo({bearing:a},d),this}getPadding(){return this.transform.padding}setPadding(a,d){return this.jumpTo({padding:a},d),this}rotateTo(a,d,p){return this.easeTo(l.e({bearing:a},d),p)}resetNorth(a,d){return this.rotateTo(0,l.e({duration:1e3},a),d),this}resetNorthPitch(a,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},a),d),this}snapToNorth(a,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(a,d):this}getPitch(){return this.transform.pitch}setPitch(a,d){return this.jumpTo({pitch:a},d),this}cameraForBounds(a,d){a=un.convert(a);const p=d&&d.bearing||0;return this._cameraForBoxAndBearing(a.getNorthWest(),a.getSouthEast(),p,d)}_cameraForBoxAndBearing(a,d,p,g){const x={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Yt=g.padding;g.padding={top:Yt,bottom:Yt,right:Yt,left:Yt}}g.padding=l.e(x,g.padding);const A=this.transform,P=A.padding,D=new un(a,d),H=A.project(D.getNorthWest()),$=A.project(D.getNorthEast()),X=A.project(D.getSouthEast()),oe=A.project(D.getSouthWest()),ye=l.b8(-p),ve=H.rotate(ye),be=$.rotate(ye),de=X.rotate(ye),Le=oe.rotate(ye),Je=new l.P(Math.max(ve.x,be.x,Le.x,de.x),Math.max(ve.y,be.y,Le.y,de.y)),Me=new l.P(Math.min(ve.x,be.x,Le.x,de.x),Math.min(ve.y,be.y,Le.y,de.y)),Oe=Je.sub(Me),et=(A.width-(P.left+P.right+g.padding.left+g.padding.right))/Oe.x,nt=(A.height-(P.top+P.bottom+g.padding.top+g.padding.bottom))/Oe.y;if(nt<0||et<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ut=Math.min(A.scaleZoom(A.scale*Math.min(et,nt)),g.maxZoom),St=l.P.convert(g.offset),yt=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.b8(p)),xt=St.add(yt).mult(A.scale/A.zoomScale(ut));return{center:A.unproject(H.add(X).div(2).sub(xt)),zoom:ut,bearing:p}}fitBounds(a,d,p){return this._fitInternal(this.cameraForBounds(a,d),d,p)}fitScreenCoordinates(a,d,p,g,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(a)),this.transform.pointLocation(l.P.convert(d)),p,g),g,x)}_fitInternal(a,d,p){return a?(delete(d=l.e(a,d)).padding,d.linear?this.easeTo(d,p):this.flyTo(d,p)):this}jumpTo(a,d){this.stop();const p=this._getTransformForUpdate();let g=!1,x=!1,A=!1;return"zoom"in a&&p.zoom!==+a.zoom&&(g=!0,p.zoom=+a.zoom),a.center!==void 0&&(p.center=l.M.convert(a.center)),"bearing"in a&&p.bearing!==+a.bearing&&(x=!0,p.bearing=+a.bearing),"pitch"in a&&p.pitch!==+a.pitch&&(A=!0,p.pitch=+a.pitch),a.padding==null||p.isPaddingEqual(a.padding)||(p.padding=a.padding),this._applyUpdatedTransform(p),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),g&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),x&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),A&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(a,d,p,g=0){const x=l.Y.fromLngLat(a,d),A=l.Y.fromLngLat(p,g),P=A.x-x.x,D=A.y-x.y,H=A.z-x.z,$=Math.hypot(P,D,H);if($===0)throw new Error("Can't calculate camera options with same From and To");const X=Math.hypot(P,D),oe=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),ye=180*Math.atan2(P,-D)/Math.PI;let ve=180*Math.acos(X/$)/Math.PI;return ve=H<0?90-ve:90+ve,{center:A.toLngLat(),zoom:oe,pitch:ve,bearing:ye}}easeTo(a,d){var p;this._stop(!1,a.easeId),((a=l.e({offset:[0,0],duration:500,easing:l.b7},a)).animate===!1||!a.essential&&T.prefersReducedMotion)&&(a.duration=0);const g=this._getTransformForUpdate(),x=this.getZoom(),A=this.getBearing(),P=this.getPitch(),D=this.getPadding(),H="bearing"in a?this._normalizeBearing(a.bearing,A):A,$="pitch"in a?+a.pitch:P,X="padding"in a?a.padding:g.padding,oe=l.P.convert(a.offset);let ye=g.centerPoint.add(oe);const ve=g.pointLocation(ye),{center:be,zoom:de}=g.getConstrained(l.M.convert(a.center||ve),(p=a.zoom)!==null&&p!==void 0?p:x);this._normalizeCenter(be);const Le=g.project(ve),Je=g.project(be).sub(Le),Me=g.zoomScale(de-x);let Oe,et;a.around&&(Oe=l.M.convert(a.around),et=g.locationPoint(Oe));const nt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||de!==x,this._rotating=this._rotating||A!==H,this._pitching=this._pitching||$!==P,this._padding=!g.isPaddingEqual(X),this._easeId=a.easeId,this._prepareEase(d,a.noMoveStart,nt),this.terrain&&this._prepareElevation(be),this._ease(ut=>{if(this._zooming&&(g.zoom=l.z.number(x,de,ut)),this._rotating&&(g.bearing=l.z.number(A,H,ut)),this._pitching&&(g.pitch=l.z.number(P,$,ut)),this._padding&&(g.interpolatePadding(D,X,ut),ye=g.centerPoint.add(oe)),this.terrain&&!a.freezeElevation&&this._updateElevation(ut),Oe)g.setLocationAtPoint(Oe,et);else{const St=g.zoomScale(g.zoom-x),yt=de>x?Math.min(2,Me):Math.max(.5,Me),xt=Math.pow(yt,1-ut),Yt=g.unproject(Le.add(Je.mult(ut*xt)).mult(St));g.setLocationAtPoint(g.renderWorldCopies?Yt.wrap():Yt,ye)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},ut=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,ut)},a),this}_prepareEase(a,d,p={}){this._moving=!0,d||p.moving||this.fire(new l.k("movestart",a)),this._zooming&&!p.zooming&&this.fire(new l.k("zoomstart",a)),this._rotating&&!p.rotating&&this.fire(new l.k("rotatestart",a)),this._pitching&&!p.pitching&&this.fire(new l.k("pitchstart",a))}_prepareElevation(a){this._elevationCenter=a,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(a,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(a){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(a<1&&d!==this._elevationTarget){const p=this._elevationTarget-this._elevationStart;this._elevationStart+=a*(p-(d-(p*a+this._elevationStart))/(1-a)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,a)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(a){if(!this.transformCameraUpdate)return;const d=a.clone(),{center:p,zoom:g,pitch:x,bearing:A,elevation:P}=this.transformCameraUpdate(d);p&&(d.center=p),g!==void 0&&(d.zoom=g),x!==void 0&&(d.pitch=x),A!==void 0&&(d.bearing=A),P!==void 0&&(d.elevation=P),this.transform.apply(d)}_fireMoveEvents(a){this.fire(new l.k("move",a)),this._zooming&&this.fire(new l.k("zoom",a)),this._rotating&&this.fire(new l.k("rotate",a)),this._pitching&&this.fire(new l.k("pitch",a))}_afterEase(a,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const p=this._zooming,g=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new l.k("zoomend",a)),g&&this.fire(new l.k("rotateend",a)),x&&this.fire(new l.k("pitchend",a)),this.fire(new l.k("moveend",a))}flyTo(a,d){var p;if(!a.essential&&T.prefersReducedMotion){const Xn=l.L(a,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xn,d)}this.stop(),a=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},a);const g=this._getTransformForUpdate(),x=this.getZoom(),A=this.getBearing(),P=this.getPitch(),D=this.getPadding(),H="bearing"in a?this._normalizeBearing(a.bearing,A):A,$="pitch"in a?+a.pitch:P,X="padding"in a?a.padding:g.padding,oe=l.P.convert(a.offset);let ye=g.centerPoint.add(oe);const ve=g.pointLocation(ye),{center:be,zoom:de}=g.getConstrained(l.M.convert(a.center||ve),(p=a.zoom)!==null&&p!==void 0?p:x);this._normalizeCenter(be);const Le=g.zoomScale(de-x),Je=g.project(ve),Me=g.project(be).sub(Je);let Oe=a.curve;const et=Math.max(g.width,g.height),nt=et/Le,ut=Me.mag();if("minZoom"in a){const Xn=l.ac(Math.min(a.minZoom,x,de),g.minZoom,g.maxZoom),In=et/g.zoomScale(Xn-x);Oe=Math.sqrt(In/ut*2)}const St=Oe*Oe;function yt(Xn){const In=(nt*nt-et*et+(Xn?-1:1)*St*St*ut*ut)/(2*(Xn?nt:et)*St*ut);return Math.log(Math.sqrt(In*In+1)-In)}function xt(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function Yt(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}const Bn=yt(!1);let Nt=function(Xn){return Yt(Bn)/Yt(Bn+Oe*Xn)},An=function(Xn){return et*((Yt(Bn)*(xt(In=Bn+Oe*Xn)/Yt(In))-xt(Bn))/St)/ut;var In},On=(yt(!0)-Bn)/Oe;if(Math.abs(ut)<1e-6||!isFinite(On)){if(Math.abs(et-nt)<1e-6)return this.easeTo(a,d);const Xn=nt<et?-1:1;On=Math.abs(Math.log(nt/et))/Oe,An=function(){return 0},Nt=function(In){return Math.exp(Xn*Oe*In)}}return a.duration="duration"in a?+a.duration:1e3*On/("screenSpeed"in a?+a.screenSpeed/Oe:+a.speed),a.maxDuration&&a.duration>a.maxDuration&&(a.duration=0),this._zooming=!0,this._rotating=A!==H,this._pitching=$!==P,this._padding=!g.isPaddingEqual(X),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(be),this._ease(Xn=>{const In=Xn*On,Vn=1/Nt(In);g.zoom=Xn===1?de:x+g.scaleZoom(Vn),this._rotating&&(g.bearing=l.z.number(A,H,Xn)),this._pitching&&(g.pitch=l.z.number(P,$,Xn)),this._padding&&(g.interpolatePadding(D,X,Xn),ye=g.centerPoint.add(oe)),this.terrain&&!a.freezeElevation&&this._updateElevation(Xn);const Hn=Xn===1?be:g.unproject(Je.add(Me.mult(An(In))).mult(Vn));g.setLocationAtPoint(g.renderWorldCopies?Hn.wrap():Hn,ye),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},a),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(a,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const p=this._onEaseEnd;delete this._onEaseEnd,p.call(this,d)}if(!a){const p=this.handlers;p&&p.stop(!1)}return this}_ease(a,d,p){p.animate===!1||p.duration===0?(a(1),d()):(this._easeStart=T.now(),this._easeOptions=p,this._onEaseFrame=a,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(a,d){a=l.b1(a,-180,180);const p=Math.abs(a-d);return Math.abs(a-360-d)<p&&(a-=360),Math.abs(a+360-d)<p&&(a+=360),a}_normalizeCenter(a){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const p=a.lng-d.center.lng;a.lng+=p>180?-360:p<-180?360:0}queryTerrainElevation(a){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(a),this.transform.tileZoom)-this.transform.elevation:null}}const Ua={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class xm{constructor(a=Ua){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=a}getDefaultPosition(){return"bottom-right"}onAdd(a){return this._map=a,this._compact=this.options.compact,this._container=M.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=M.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=M.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){M.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(a,d){const p=this._map._getUIString(`AttributionControl.${d}`);a.title=p,a.setAttribute("aria-label",p)}_updateAttributions(){if(!this._map.style)return;let a=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?a=a.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&a.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const x=d[g];if(x.used||x.usedForTerrain){const A=x.getSource();A.attribution&&a.indexOf(A.attribution)<0&&a.push(A.attribution)}}a=a.filter(g=>String(g).trim()),a.sort((g,x)=>g.length-x.length),a=a.filter((g,x)=>{for(let A=x+1;A<a.length;A++)if(a[A].indexOf(g)>=0)return!1;return!0});const p=a.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,a.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Fl{constructor(a={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const p=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&p.classList.add("maplibregl-compact"):p.classList.remove("maplibregl-compact")}},this.options=a}getDefaultPosition(){return"bottom-left"}onAdd(a){this._map=a,this._compact=this.options&&this.options.compact,this._container=M.create("div","maplibregl-ctrl");const d=M.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){M.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class Dr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(a){const d=++this._id;return this._queue.push({callback:a,id:d,cancelled:!1}),d}remove(a){const d=this._currentlyRunning,p=d?this._queue.concat(d):this._queue;for(const g of p)if(g.id===a)return void(g.cancelled=!0)}run(a=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const p of d)if(!p.cancelled&&(p.callback(a),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Hr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class bm extends l.E{constructor(a){super(),this.sourceCache=a,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,a.usedForTerrain=!0,a.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(a,d){this.sourceCache.update(a,d),this._renderableTilesKeys=[];const p={};for(const g of a.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))p[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aN(g.posMatrix,0,l.W,0,l.W,0,1),this._tiles[g.key]=new Rn(g,this.tileSize));for(const g in this._tiles)p[g]||delete this._tiles[g]}freeRtt(a){for(const d in this._tiles){const p=this._tiles[d];(!a||p.tileID.equals(a)||p.tileID.isChildOf(a)||a.isChildOf(p.tileID))&&(p.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(a=>this.getTileByID(a))}getTileByID(a){return this._tiles[a]}getTerrainCoords(a){const d={};for(const p of this._renderableTilesKeys){const g=this._tiles[p].tileID;if(g.canonical.equals(a.canonical)){const x=a.clone();x.posMatrix=new Float64Array(16),l.aN(x.posMatrix,0,l.W,0,l.W,0,1),d[p]=x}else if(g.canonical.isChildOf(a.canonical)){const x=a.clone();x.posMatrix=new Float64Array(16);const A=g.canonical.z-a.canonical.z,P=g.canonical.x-(g.canonical.x>>A<<A),D=g.canonical.y-(g.canonical.y>>A<<A),H=l.W>>A;l.aN(x.posMatrix,0,H,0,H,0,1),l.H(x.posMatrix,x.posMatrix,[-P*H,-D*H,0]),d[p]=x}else if(a.canonical.isChildOf(g.canonical)){const x=a.clone();x.posMatrix=new Float64Array(16);const A=a.canonical.z-g.canonical.z,P=a.canonical.x-(a.canonical.x>>A<<A),D=a.canonical.y-(a.canonical.y>>A<<A),H=l.W>>A;l.aN(x.posMatrix,0,l.W,0,l.W,0,1),l.H(x.posMatrix,x.posMatrix,[P*H,D*H,0]),l.J(x.posMatrix,x.posMatrix,[1/2**A,1/2**A,0]),d[p]=x}}return d}getSourceTile(a,d){const p=this.sourceCache._source;let g=a.overscaledZ-this.deltaZoom;if(g>p.maxzoom&&(g=p.maxzoom),g<p.minzoom)return null;this._sourceTileCache[a.key]||(this._sourceTileCache[a.key]=a.scaledTo(g).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[a.key]);if((!x||!x.dem)&&d)for(;g>=p.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(a.scaledTo(g--).key);return x}tilesAfterTime(a=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=a)}}class Jc{constructor(a,d,p){this.painter=a,this.sourceCache=new bm(d),this.options=p,this.exaggeration=typeof p.exaggeration=="number"?p.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(a,d,p,g=l.W){var x;if(!(d>=0&&d<g&&p>=0&&p<g))return 0;const A=this.getTerrainData(a),P=(x=A.tile)===null||x===void 0?void 0:x.dem;if(!P)return 0;const D=function(ve,be,de){var Le=be[0],Je=be[1];return ve[0]=de[0]*Le+de[4]*Je+de[12],ve[1]=de[1]*Le+de[5]*Je+de[13],ve}([],[d/g*l.W,p/g*l.W],A.u_terrain_matrix),H=[D[0]*P.dim,D[1]*P.dim],$=Math.floor(H[0]),X=Math.floor(H[1]),oe=H[0]-$,ye=H[1]-X;return P.get($,X)*(1-oe)*(1-ye)+P.get($+1,X)*oe*(1-ye)+P.get($,X+1)*(1-oe)*ye+P.get($+1,X+1)*oe*ye}getElevationForLngLatZoom(a,d){const{tileID:p,mercatorX:g,mercatorY:x}=this._getOverscaledTileIDFromLngLatZoom(a,d);return this.getElevation(p,g%l.W,x%l.W,l.W)}getElevation(a,d,p,g=l.W){return this.getDEMElevation(a,d,p,g)*this.exaggeration}getTerrainData(a){if(!this._emptyDemTexture){const g=this.painter.context,x=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Be(g,x,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Be(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(a,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Be(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const p=d&&d+d.tileID.key+a.key;if(p&&!this._demMatrixCache[p]){const g=this.sourceCache.sourceCache._source.maxzoom;let x=a.canonical.z-d.tileID.canonical.z;a.overscaledZ>a.canonical.z&&(a.canonical.z>=g?x=a.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const A=a.canonical.x-(a.canonical.x>>x<<x),P=a.canonical.y-(a.canonical.y>>x<<x),D=l.b9(new Float64Array(16),[1/(l.W<<x),1/(l.W<<x),0]);l.H(D,D,[A*l.W,P*l.W,0]),this._demMatrixCache[a.key]={matrix:D,coord:a}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:p?this._demMatrixCache[a.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(a){const d=this.painter,p=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===p&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Be(d.context,{width:p,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Be(d.context,{width:p,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(p,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,p,g))),this._fbo.colorAttachment.set(a==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const a=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,A=0;x<this._coordsTextureSize;x++)for(let P=0;P<this._coordsTextureSize;P++,A+=4)d[A+0]=255&P,d[A+1]=255&x,d[A+2]=P>>8<<4|x>>8,d[A+3]=0;const p=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new Be(a,p,a.gl.RGBA,{premultiply:!1});return g.bind(a.gl.NEAREST,a.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(a){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),p=this.painter.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null);const x=d[0]+(d[2]>>4<<8),A=d[1]+((15&d[2])<<8),P=this.coordsIndex[255-d[3]],D=P&&this.sourceCache.getTileByID(P);if(!D)return null;const H=this._coordsTextureSize,$=(1<<D.tileID.canonical.z)*H;return new l.Y((D.tileID.canonical.x*H+x)/$+D.tileID.wrap,(D.tileID.canonical.y*H+A)/$,this.getElevation(D.tileID,x,A,H))}depthAtPoint(a){const d=new Uint8Array(4),p=this.painter.context,g=p.gl;return p.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(a.x,this.painter.height/devicePixelRatio-a.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),p.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const a=this.painter.context,d=new l.ba,p=new l.aX,g=this.meshSize,x=l.W/g,A=g*g;for(let X=0;X<=g;X++)for(let oe=0;oe<=g;oe++)d.emplaceBack(oe*x,X*x,0);for(let X=0;X<A;X+=g+1)for(let oe=0;oe<g;oe++)p.emplaceBack(oe+X,g+oe+X+1,g+oe+X+2),p.emplaceBack(oe+X,g+oe+X+2,oe+X+1);const P=d.length,D=P+2*(g+1);for(const X of[0,1])for(let oe=0;oe<=g;oe++)for(const ye of[0,1])d.emplaceBack(oe*x,X*l.W,ye);for(let X=0;X<2*g;X+=2)p.emplaceBack(D+X,D+X+1,D+X+3),p.emplaceBack(D+X,D+X+3,D+X+2),p.emplaceBack(P+X,P+X+3,P+X+1),p.emplaceBack(P+X,P+X+2,P+X+3);const H=d.length,$=H+2*(g+1);for(const X of[0,1])for(let oe=0;oe<=g;oe++)for(const ye of[0,1])d.emplaceBack(X*l.W,oe*x,ye);for(let X=0;X<2*g;X+=2)p.emplaceBack(H+X,H+X+1,H+X+3),p.emplaceBack(H+X,H+X+3,H+X+2),p.emplaceBack($+X,$+X+3,$+X+1),p.emplaceBack($+X,$+X+2,$+X+3);return this._mesh={indexBuffer:a.createIndexBuffer(p),vertexBuffer:a.createVertexBuffer(d,Hr.members),segments:l.$.simpleSegment(0,0,d.length,p.length)},this._mesh}getMeshFrameDelta(a){return 2*Math.PI*l.bb/Math.pow(2,a)/5}getMinTileElevationForLngLatZoom(a,d){var p;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(a,d);return(p=this.getMinMaxElevation(g).minElevation)!==null&&p!==void 0?p:0}getMinMaxElevation(a){const d=this.getTerrainData(a).tile,p={minElevation:null,maxElevation:null};return d&&d.dem&&(p.minElevation=d.dem.min*this.exaggeration,p.maxElevation=d.dem.max*this.exaggeration),p}_getOverscaledTileIDFromLngLatZoom(a,d){const p=l.Y.fromLngLat(a.wrap()),g=(1<<d)*l.W,x=p.x*g,A=p.y*g,P=Math.floor(x/l.W),D=Math.floor(A/l.W);return{tileID:new l.Q(d,0,d,P,D),mercatorX:x,mercatorY:A}}}class mh{constructor(a,d,p){this._context=a,this._size=d,this._tileSize=p,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const a of this._objects)a.texture.destroy(),a.fbo.destroy()}_createObject(a){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),p=new Be(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return p.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(p.texture),{id:a,fbo:d,texture:p,stamp:-1,inUse:!1}}getObjectForId(a){return this._objects[a]}useObject(a){a.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>a.id!==d),this._recentlyUsed.push(a.id)}stampObject(a){a.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const a=this._createObject(this._objects.length);return this._objects.push(a),a}freeObject(a){a.inUse=!1}freeAllObjects(){for(const a of this._objects)this.freeObject(a)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(a=>!a.inUse)===!1}}const to={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class If{constructor(a,d){this.painter=a,this.terrain=d,this.pool=new mh(a.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(a){return this.pool.getObjectForId(a.rtt[this._stacks.length-1].id).texture}prepareForRender(a,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=a._order.filter(p=>!a._layers[p].isHidden(d)),this._coordsDescendingInv={};for(const p in a.sourceCaches){this._coordsDescendingInv[p]={};const g=a.sourceCaches[p].getVisibleCoordinates();for(const x of g){const A=this.terrain.sourceCache.getTerrainCoords(x);for(const P in A)this._coordsDescendingInv[p][P]||(this._coordsDescendingInv[p][P]=[]),this._coordsDescendingInv[p][P].push(A[P])}}this._coordsDescendingInvStr={};for(const p of a._order){const g=a._layers[p],x=g.source;if(to[g.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const A in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][A]=this._coordsDescendingInv[x][A].map(P=>P.key).sort().join()}}for(const p of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[g][p.tileID.key];x&&x!==p.rttCoords[g]&&(p.rtt=[])}}renderLayer(a){if(a.isHidden(this.painter.transform.zoom))return!1;const d=a.type,p=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===a.id;if(to[d]&&(this._prevType&&to[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(a.id),!g))return!0;if(to[this._prevType]||to[d]&&g){this._prevType=d;const x=this._stacks.length-1,A=this._stacks[x]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(vf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[x]){const H=this.pool.getObjectForId(P.rtt[x].id);if(H.stamp===P.rtt[x].stamp){this.pool.useObject(H);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),P.rtt[x]={id:D.id,stamp:D.stamp},p.context.bindFramebuffer.set(D.fbo.framebuffer),p.context.clear({color:l.aO.transparent,stencil:0}),p.currentStencilSource=void 0;for(let H=0;H<A.length;H++){const $=p.style._layers[A[H]],X=$.source?this._coordsDescendingInv[$.source][P.tileID.key]:[P.tileID];p.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),p._renderTileClippingMasks($,X),p.renderLayer(p,p.style.sourceCaches[$.source],$,X),$.source&&(P.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][P.tileID.key])}}return vf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),to[d]}return!1}}const Df={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Qc=m,kf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Ua,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},gh=y=>{y.touchstart=y.dragStart,y.touchmoveWindow=y.dragMove,y.touchend=y.dragEnd},Lf={showCompass:!0,showZoom:!0,visualizePitch:!1};class zf{constructor(a,d,p=!1){this.mousedown=A=>{this.startMouse(l.e({},A,{ctrlKey:!0,preventDefault:()=>A.preventDefault()}),M.mousePos(this.element,A)),M.addEventListener(window,"mousemove",this.mousemove),M.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=A=>{this.moveMouse(A,M.mousePos(this.element,A))},this.mouseup=A=>{this.mouseRotate.dragEnd(A),this.mousePitch&&this.mousePitch.dragEnd(A),this.offTemp()},this.touchstart=A=>{A.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=M.touchPos(this.element,A.targetTouches)[0],this.startTouch(A,this._startPos),M.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.addEventListener(window,"touchend",this.touchend))},this.touchmove=A=>{A.targetTouches.length!==1?this.reset():(this._lastPos=M.touchPos(this.element,A.targetTouches)[0],this.moveTouch(A,this._lastPos))},this.touchend=A=>{A.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=a.dragRotate._mouseRotate.getClickTolerance(),x=a.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=zl({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:A,clickTolerance:P,bearingDegreesPerPixelMoved:D=.8})=>{const H=new Sf;return new Rs({clickTolerance:P,move:($,X)=>({bearingDelta:(X.x-$.x)*D}),moveStateManager:H,enable:A,assignEvents:gh})})({clickTolerance:g,enable:!0}),this.map=a,p&&(this.mousePitch=Mf({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:A,clickTolerance:P,pitchDegreesPerPixelMoved:D=-.5})=>{const H=new Sf;return new Rs({clickTolerance:P,move:($,X)=>({pitchDelta:(X.y-$.y)*D}),moveStateManager:H,enable:A,assignEvents:gh})})({clickTolerance:x,enable:!0})),M.addEventListener(d,"mousedown",this.mousedown),M.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),M.addEventListener(d,"touchcancel",this.reset)}startMouse(a,d){this.mouseRotate.dragStart(a,d),this.mousePitch&&this.mousePitch.dragStart(a,d),M.disableDrag()}startTouch(a,d){this.touchRotate.dragStart(a,d),this.touchPitch&&this.touchPitch.dragStart(a,d),M.disableDrag()}moveMouse(a,d){const p=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(a,d)||{};if(g&&p.setBearing(p.getBearing()+g),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(a,d)||{};x&&p.setPitch(p.getPitch()+x)}}moveTouch(a,d){const p=this.map,{bearingDelta:g}=this.touchRotate.dragMove(a,d)||{};if(g&&p.setBearing(p.getBearing()+g),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(a,d)||{};x&&p.setPitch(p.getPitch()+x)}}off(){const a=this.element;M.removeEventListener(a,"mousedown",this.mousedown),M.removeEventListener(a,"touchstart",this.touchstart,{passive:!1}),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend),M.removeEventListener(a,"touchcancel",this.reset),this.offTemp()}offTemp(){M.enableDrag(),M.removeEventListener(window,"mousemove",this.mousemove),M.removeEventListener(window,"mouseup",this.mouseup),M.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),M.removeEventListener(window,"touchend",this.touchend)}}let Is;function vh(y,a,d){const p=new l.M(y.lng,y.lat);if(y=new l.M(y.lng,y.lat),a){const g=new l.M(y.lng-360,y.lat),x=new l.M(y.lng+360,y.lat),A=d.locationPoint(y).distSqr(a);d.locationPoint(g).distSqr(a)<A?y=g:d.locationPoint(x).distSqr(a)<A&&(y=x)}for(;Math.abs(y.lng-d.center.lng)>180;){const g=d.locationPoint(y);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;y.lng>d.center.lng?y.lng-=360:y.lng+=360}return y.lng!==p.lng&&d.locationPoint(y).y>d.height/2-d.getHorizon()?y:p}const eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function yh(y,a,d){const p=y.classList;for(const g in eu)p.remove(`maplibregl-${d}-anchor-${g}`);p.add(`maplibregl-${d}-anchor-${a}`)}class Nl extends l.E{constructor(a){if(super(),this._onKeyPress=d=>{const p=d.code,g=d.charCode||d.keyCode;p!=="Space"&&p!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const p=d.originalEvent.target,g=this._element;this._popup&&(p===g||g.contains(p))&&this.togglePopup()},this._update=d=>{var p;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?vh(this._lngLat,this._flatPos,this._map.transform):(p=this._lngLat)===null||p===void 0?void 0:p.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let x="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?x=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(x=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let A="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?A="rotateX(0deg)":this._pitchAlignment==="map"&&(A=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),M.setTransform(this._element,`${eu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${A} ${x}`),T.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const p=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=p}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=a&&a.anchor||"center",this._color=a&&a.color||"#3FB1CE",this._scale=a&&a.scale||1,this._draggable=a&&a.draggable||!1,this._clickTolerance=a&&a.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=a&&a.rotation||0,this._rotationAlignment=a&&a.rotationAlignment||"auto",this._pitchAlignment=a&&a.pitchAlignment&&a.pitchAlignment!=="auto"?a.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(a==null?void 0:a.opacity,a==null?void 0:a.opacityWhenCovered),a&&a.element)this._element=a.element,this._offset=l.P.convert(a&&a.offset||[0,0]);else{this._defaultMarker=!0,this._element=M.create("div"),this._element.setAttribute("aria-label","Map marker");const d=M.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${p}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const x=M.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const A=M.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill-rule","nonzero");const P=M.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"transform","translate(3.0, 29.0)"),P.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Le of D){const Je=M.createNS("http://www.w3.org/2000/svg","ellipse");Je.setAttributeNS(null,"opacity","0.04"),Je.setAttributeNS(null,"cx","10.5"),Je.setAttributeNS(null,"cy","5.80029008"),Je.setAttributeNS(null,"rx",Le.rx),Je.setAttributeNS(null,"ry",Le.ry),P.appendChild(Je)}const H=M.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const $=M.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild($);const X=M.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const oe=M.createNS("http://www.w3.org/2000/svg","path");oe.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(oe);const ye=M.createNS("http://www.w3.org/2000/svg","g");ye.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ye.setAttributeNS(null,"fill","#FFFFFF");const ve=M.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");const be=M.createNS("http://www.w3.org/2000/svg","circle");be.setAttributeNS(null,"fill","#000000"),be.setAttributeNS(null,"opacity","0.25"),be.setAttributeNS(null,"cx","5.5"),be.setAttributeNS(null,"cy","5.5"),be.setAttributeNS(null,"r","5.4999962");const de=M.createNS("http://www.w3.org/2000/svg","circle");de.setAttributeNS(null,"fill","#FFFFFF"),de.setAttributeNS(null,"cx","5.5"),de.setAttributeNS(null,"cy","5.5"),de.setAttributeNS(null,"r","5.4999962"),ve.appendChild(be),ve.appendChild(de),A.appendChild(P),A.appendChild(H),A.appendChild(X),A.appendChild(ye),A.appendChild(ve),d.appendChild(A),d.setAttributeNS(null,"height",p*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(a&&a.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),yh(this._element,this._anchor,"marker"),a&&a.className)for(const d of a.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(a){return this.remove(),this._map=a,a.getCanvasContainer().appendChild(this._element),a.on("move",this._update),a.on("moveend",this._update),a.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),M.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(a){return this._lngLat=l.M.convert(a),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(a){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),a){if(!("offset"in a.options)){const g=Math.abs(13.5)/Math.SQRT2;a.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=a,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const a=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:a?(a.isOpen()?a.remove():(a.setLngLat(this._lngLat),a.addTo(this._map)),this):this}_updateOpacity(a=!1){var d,p;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(a)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,x=g.terrain.depthAtPoint(this._pos),A=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,A)-x<.006)return void(this._element.style.opacity=this._opacity);const P=-this._offset.y/g.transform._pixelPerMeter,D=Math.sin(g.getPitch()*Math.PI/180)*P,H=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),$=g.transform.lngLatToCameraDepth(this._lngLat,A+D)-H>.006;!((p=this._popup)===null||p===void 0)&&p.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(a){return this._offset=l.P.convert(a),this._update(),this}addClassName(a){this._element.classList.add(a)}removeClassName(a){this._element.classList.remove(a)}toggleClassName(a){return this._element.classList.toggle(a)}setDraggable(a){return this._draggable=!!a,this._map&&(a?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(a){return this._rotation=a||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(a){return this._rotationAlignment=a||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(a){return this._pitchAlignment=a&&a!=="auto"?a:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(a,d){return a===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),a!==void 0&&(this._opacity=a),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Ff={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Bl=0,no=!1;const Nf={maxWidth:100,unit:"metric"};function _h(y,a,d){const p=d&&d.maxWidth||100,g=y._container.clientHeight/2,x=y.unproject([0,g]),A=y.unproject([p,g]),P=x.distanceTo(A);if(d&&d.unit==="imperial"){const D=3.2808*P;D>5280?zo(a,p,D/5280,y._getUIString("ScaleControl.Miles")):zo(a,p,D,y._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?zo(a,p,P/1852,y._getUIString("ScaleControl.NauticalMiles")):P>=1e3?zo(a,p,P/1e3,y._getUIString("ScaleControl.Kilometers")):zo(a,p,P,y._getUIString("ScaleControl.Meters"))}function zo(y,a,d,p){const g=function(x){const A=Math.pow(10,`${Math.floor(x)}`.length-1);let P=x/A;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(D){const H=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*H)/H}(P),A*P}(d);y.style.width=a*(g/d)+"px",y.innerHTML=`${g}&nbsp;${p}`}const Bf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Of=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Uf(y){if(y){if(typeof y=="number"){const a=Math.round(Math.abs(y)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,y),"top-left":new l.P(a,a),"top-right":new l.P(-a,a),bottom:new l.P(0,-y),"bottom-left":new l.P(a,-a),"bottom-right":new l.P(-a,-a),left:new l.P(y,0),right:new l.P(-y,0)}}if(y instanceof l.P||Array.isArray(y)){const a=l.P.convert(y);return{center:a,top:a,"top-left":a,"top-right":a,bottom:a,"bottom-left":a,"bottom-right":a,left:a,right:a}}return{center:l.P.convert(y.center||[0,0]),top:l.P.convert(y.top||[0,0]),"top-left":l.P.convert(y["top-left"]||[0,0]),"top-right":l.P.convert(y["top-right"]||[0,0]),bottom:l.P.convert(y.bottom||[0,0]),"bottom-left":l.P.convert(y["bottom-left"]||[0,0]),"bottom-right":l.P.convert(y["bottom-right"]||[0,0]),left:l.P.convert(y.left||[0,0]),right:l.P.convert(y.right||[0,0])}}return Uf(new l.P(0,0))}const wm=m;h.AJAXError=l.be,h.Evented=l.E,h.LngLat=l.M,h.MercatorCoordinate=l.Y,h.Point=l.P,h.addProtocol=l.bf,h.config=l.a,h.removeProtocol=l.bg,h.AttributionControl=xm,h.BoxZoomHandler=Ll,h.CanvasSource=wt,h.CooperativeGesturesHandler=Tn,h.DoubleClickZoomHandler=Pf,h.DragPanHandler=Oa,h.DragRotateHandler=Yc,h.EdgeInsets=qc,h.FullscreenControl=class extends l.E{constructor(y={}){super(),this._onFullscreenChange=()=>{var a;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((a=d==null?void 0:d.shadowRoot)===null||a===void 0)&&a.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,y&&y.container&&(y.container instanceof HTMLElement?this._container=y.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(y){return this._map=y,this._container||(this._container=this._map.getContainer()),this._controlContainer=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){M.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const y=this._fullscreenButton=M.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);M.create("span","maplibregl-ctrl-icon",y).setAttribute("aria-hidden","true"),y.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const y=this._getTitle();this._fullscreenButton.setAttribute("aria-label",y),this._fullscreenButton.title=y}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=se,h.GeolocateControl=class extends l.E{constructor(y){super(),this._onSuccess=a=>{if(this._map){if(this._isOutOfMapMaxBounds(a))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",a)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=a,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(a),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(a),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",a)),this._finish()}},this._updateCamera=a=>{const d=new l.M(a.coords.longitude,a.coords.latitude),p=a.coords.accuracy,g=this._map.getBearing(),x=l.e({bearing:g},this.options.fitBoundsOptions),A=un.fromLngLat(d,p);this._map.fitBounds(A,x,{geolocateSource:!0})},this._updateMarker=a=>{if(a){const d=new l.M(a.coords.longitude,a.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=a.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=a=>{if(this._map){if(this.options.trackUserLocation)if(a.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(a.code===3&&no)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",a)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=a=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=M.create("button","maplibregl-ctrl-geolocate",this._container),M.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",a===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=M.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Nl({element:this._dotElement}),this._circleElement=M.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Nl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},Ff,y)}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(a=!1){if(Is!==void 0&&!a)return Is;if(window.navigator.permissions===void 0)return Is=!!window.navigator.geolocation,Is;try{Is=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Is=!!window.navigator.geolocation}return Is})}().then(a=>this._setupUI(a)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),M.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bl=0,no=!1}_isOutOfMapMaxBounds(y){const a=this._map.getMaxBounds(),d=y.coords;return a&&(d.longitude<a.getWest()||d.longitude>a.getEast()||d.latitude<a.getSouth()||d.latitude>a.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const y=this._map.getBounds(),a=y.getSouthEast(),d=y.getNorthEast(),p=a.distanceTo(d),g=Math.ceil(this._accuracy/(p/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bl--,no=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let y;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Bl++,Bl>1?(y={maximumAge:6e5,timeout:0},no=!0):(y=this.options.positionOptions,no=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,y)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.Hash=xf,h.ImageSource=vt,h.KeyboardHandler=_r,h.LngLatBounds=un,h.LogoControl=Fl,h.Map=class extends _m{constructor(y){if(l.bc.mark(l.bd.create),(y=l.e({},kf,y)).minZoom!=null&&y.maxZoom!=null&&y.minZoom>y.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(y.minPitch!=null&&y.maxPitch!=null&&y.minPitch>y.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(y.minPitch!=null&&y.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(y.maxPitch!=null&&y.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new uh(y.minZoom,y.maxZoom,y.minPitch,y.maxPitch,y.renderWorldCopies),{bearingSnap:y.bearingSnap}),this._contextLost=a=>{a.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:a}))},this._contextRestored=a=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:a}))},this._onMapScroll=a=>{if(a.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=y.interactive,this._maxTileCacheSize=y.maxTileCacheSize,this._maxTileCacheZoomLevels=y.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=y.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=y.preserveDrawingBuffer,this._antialias=y.antialias,this._trackResize=y.trackResize,this._bearingSnap=y.bearingSnap,this._refreshExpiredTiles=y.refreshExpiredTiles,this._fadeDuration=y.fadeDuration,this._crossSourceCollisions=y.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=y.collectResourceTiming,this._renderTaskQueue=new Dr,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},Df,y.locale),this._clickTolerance=y.clickTolerance,this._overridePixelRatio=y.pixelRatio,this._maxCanvasSize=y.maxCanvasSize,this.transformCameraUpdate=y.transformCameraUpdate,this._imageQueueHandle=V.addThrottleControl(()=>this.isMoving()),this._requestManager=new he(y.transformRequest),typeof y.container=="string"){if(this._container=document.getElementById(y.container),!this._container)throw new Error(`Container '${y.container}' not found.`)}else{if(!(y.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=y.container}if(y.maxBounds&&this.setMaxBounds(y.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let a=!1;const d=_f(p=>{this._trackResize&&!this._removed&&this.resize(p)._update()},50);this._resizeObserver=new ResizeObserver(p=>{a?d(p):a=!0}),this._resizeObserver.observe(this._container)}this.handlers=new $i(this,y),this._hash=y.hash&&new xf(typeof y.hash=="string"&&y.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:y.center,zoom:y.zoom,bearing:y.bearing,pitch:y.pitch}),y.bounds&&(this.resize(),this.fitBounds(y.bounds,l.e({},y.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=y.localIdeographFontFamily,this._validateStyle=y.validateStyle,y.style&&this.setStyle(y.style,{localIdeographFontFamily:y.localIdeographFontFamily}),y.attributionControl&&this.addControl(new xm(typeof y.attributionControl=="boolean"?void 0:y.attributionControl)),y.maplibreLogo&&this.addControl(new Fl,y.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",a=>{this._update(a.dataType==="style"),this.fire(new l.k(`${a.dataType}data`,a))}),this.on("dataloading",a=>{this.fire(new l.k(`${a.dataType}dataloading`,a))}),this.on("dataabort",a=>{this.fire(new l.k("sourcedataabort",a))})}_getMapId(){return this._mapId}addControl(y,a){if(a===void 0&&(a=y.getDefaultPosition?y.getDefaultPosition():"top-right"),!y||!y.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=y.onAdd(this);this._controls.push(y);const p=this._controlPositions[a];return a.indexOf("bottom")!==-1?p.insertBefore(d,p.firstChild):p.appendChild(d),this}removeControl(y){if(!y||!y.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const a=this._controls.indexOf(y);return a>-1&&this._controls.splice(a,1),y.onRemove(this),this}hasControl(y){return this._controls.indexOf(y)>-1}calculateCameraOptionsFromTo(y,a,d,p){return p==null&&this.terrain&&(p=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(y,a,d,p)}resize(y){var a;const d=this._containerDimensions(),p=d[0],g=d[1],x=this._getClampedPixelRatio(p,g);if(this._resizeCanvas(p,g,x),this.painter.resize(p,g,x),this.painter.overLimit()){const P=this.painter.context.gl;this._maxCanvasSize=[P.drawingBufferWidth,P.drawingBufferHeight];const D=this._getClampedPixelRatio(p,g);this._resizeCanvas(p,g,D),this.painter.resize(p,g,D)}this.transform.resize(p,g),(a=this._requestedCameraState)===null||a===void 0||a.resize(p,g);const A=!this._moving;return A&&(this.stop(),this.fire(new l.k("movestart",y)).fire(new l.k("move",y))),this.fire(new l.k("resize",y)),A&&this.fire(new l.k("moveend",y)),this}_getClampedPixelRatio(y,a){const{0:d,1:p}=this._maxCanvasSize,g=this.getPixelRatio(),x=y*g,A=a*g;return Math.min(x>d?d/x:1,A>p?p/A:1)*g}getPixelRatio(){var y;return(y=this._overridePixelRatio)!==null&&y!==void 0?y:devicePixelRatio}setPixelRatio(y){this._overridePixelRatio=y,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(y){return this.transform.setMaxBounds(un.convert(y)),this._update()}setMinZoom(y){if((y=y??-2)>=-2&&y<=this.transform.maxZoom)return this.transform.minZoom=y,this._update(),this.getZoom()<y&&this.setZoom(y),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(y){if((y=y??22)>=this.transform.minZoom)return this.transform.maxZoom=y,this._update(),this.getZoom()>y&&this.setZoom(y),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(y){if((y=y??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(y>=0&&y<=this.transform.maxPitch)return this.transform.minPitch=y,this._update(),this.getPitch()<y&&this.setPitch(y),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(y){if((y=y??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(y>=this.transform.minPitch)return this.transform.maxPitch=y,this._update(),this.getPitch()>y&&this.setPitch(y),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(y){return this.transform.renderWorldCopies=y,this._update()}project(y){return this.transform.locationPoint(l.M.convert(y),this.style&&this.terrain)}unproject(y){return this.transform.pointLocation(l.P.convert(y),this.terrain)}isMoving(){var y;return this._moving||((y=this.handlers)===null||y===void 0?void 0:y.isMoving())}isZooming(){var y;return this._zooming||((y=this.handlers)===null||y===void 0?void 0:y.isZooming())}isRotating(){var y;return this._rotating||((y=this.handlers)===null||y===void 0?void 0:y.isRotating())}_createDelegatedListener(y,a,d){if(y==="mouseenter"||y==="mouseover"){let p=!1;return{layer:a,listener:d,delegates:{mousemove:x=>{const A=this.getLayer(a)?this.queryRenderedFeatures(x.point,{layers:[a]}):[];A.length?p||(p=!0,d.call(this,new di(y,this,x.originalEvent,{features:A}))):p=!1},mouseout:()=>{p=!1}}}}if(y==="mouseleave"||y==="mouseout"){let p=!1;return{layer:a,listener:d,delegates:{mousemove:A=>{(this.getLayer(a)?this.queryRenderedFeatures(A.point,{layers:[a]}):[]).length?p=!0:p&&(p=!1,d.call(this,new di(y,this,A.originalEvent)))},mouseout:A=>{p&&(p=!1,d.call(this,new di(y,this,A.originalEvent)))}}}}{const p=g=>{const x=this.getLayer(a)?this.queryRenderedFeatures(g.point,{layers:[a]}):[];x.length&&(g.features=x,d.call(this,g),delete g.features)};return{layer:a,listener:d,delegates:{[y]:p}}}}on(y,a,d){if(d===void 0)return super.on(y,a);const p=this._createDelegatedListener(y,a,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[y]=this._delegatedListeners[y]||[],this._delegatedListeners[y].push(p);for(const g in p.delegates)this.on(g,p.delegates[g]);return this}once(y,a,d){if(d===void 0)return super.once(y,a);const p=this._createDelegatedListener(y,a,d);for(const g in p.delegates)this.once(g,p.delegates[g]);return this}off(y,a,d){return d===void 0?super.off(y,a):(this._delegatedListeners&&this._delegatedListeners[y]&&(p=>{const g=this._delegatedListeners[y];for(let x=0;x<g.length;x++){const A=g[x];if(A.layer===a&&A.listener===d){for(const P in A.delegates)this.off(P,A.delegates[P]);return g.splice(x,1),this}}})(),this)}queryRenderedFeatures(y,a){if(!this.style)return[];let d;const p=y instanceof l.P||Array.isArray(y),g=p?y:[[0,0],[this.transform.width,this.transform.height]];if(a=a||(p?{}:y)||{},g instanceof l.P||typeof g[0]=="number")d=[l.P.convert(g)];else{const x=l.P.convert(g[0]),A=l.P.convert(g[1]);d=[x,new l.P(A.x,x.y),A,new l.P(x.x,A.y),x]}return this.style.queryRenderedFeatures(d,a,this.transform)}querySourceFeatures(y,a){return this.style.querySourceFeatures(y,a)}setStyle(y,a){return(a=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},a)).diff!==!1&&a.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&y?(this._diffStyle(y,a),this):(this._localIdeographFontFamily=a.localIdeographFontFamily,this._updateStyle(y,a))}setTransformRequest(y){return this._requestManager.setTransformRequest(y),this}_getUIString(y){const a=this._locale[y];if(a==null)throw new Error(`Missing UI string '${y}'`);return a}_updateStyle(y,a){if(a.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(y,a));const d=this.style&&a.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!y)),y?(this.style=new vi(this,a||{}),this.style.setEventedParent(this,{style:this.style}),typeof y=="string"?this.style.loadURL(y,a,d):this.style.loadJSON(y,a,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(y,a){if(typeof y=="string"){const d=this._requestManager.transformRequest(y,Y.Style);l.h(d,new AbortController).then(p=>{this._updateDiff(p.data,a)}).catch(p=>{p&&this.fire(new l.j(p))})}else typeof y=="object"&&this._updateDiff(y,a)}_updateDiff(y,a){try{this.style.setState(y,a)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(y,a)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(y,a){return this._lazyInitEmptyStyle(),this.style.addSource(y,a),this._update(!0)}isSourceLoaded(y){const a=this.style&&this.style.sourceCaches[y];if(a!==void 0)return a.loaded();this.fire(new l.j(new Error(`There is no source with ID '${y}'`)))}setTerrain(y){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),y){const a=this.style.sourceCaches[y.source];if(!a)throw new Error(`cannot load terrain, because there exists no source with ID: ${y.source}`);this.terrain===null&&a.reload();for(const d in this.style._layers){const p=this.style._layers[d];p.type==="hillshade"&&p.source===y.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Jc(this.painter,a,y),this.painter.renderToTexture=new If(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==y.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:y})),this}getTerrain(){var y,a;return(a=(y=this.terrain)===null||y===void 0?void 0:y.options)!==null&&a!==void 0?a:null}areTilesLoaded(){const y=this.style&&this.style.sourceCaches;for(const a in y){const d=y[a]._tiles;for(const p in d){const g=d[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(y){return this.style.removeSource(y),this._update(!0)}getSource(y){return this.style.getSource(y)}addImage(y,a,d={}){const{pixelRatio:p=1,sdf:g=!1,stretchX:x,stretchY:A,content:P}=d;if(this._lazyInitEmptyStyle(),!(a instanceof HTMLImageElement||l.b(a))){if(a.width===void 0||a.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:H,data:$}=a,X=a;return this.style.addImage(y,{data:new l.R({width:D,height:H},new Uint8Array($)),pixelRatio:p,stretchX:x,stretchY:A,content:P,sdf:g,version:0,userImage:X}),X.onAdd&&X.onAdd(this,y),this}}{const{width:D,height:H,data:$}=T.getImageData(a);this.style.addImage(y,{data:new l.R({width:D,height:H},$),pixelRatio:p,stretchX:x,stretchY:A,content:P,sdf:g,version:0})}}updateImage(y,a){const d=this.style.getImage(y);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=a instanceof HTMLImageElement||l.b(a)?T.getImageData(a):a,{width:g,height:x,data:A}=p;if(g===void 0||x===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||x!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(a instanceof HTMLImageElement||l.b(a));return d.data.replace(A,P),this.style.updateImage(y,d),this}getImage(y){return this.style.getImage(y)}hasImage(y){return y?!!this.style.getImage(y):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(y){this.style.removeImage(y)}loadImage(y){return V.getImage(this._requestManager.transformRequest(y,Y.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(y,a){return this._lazyInitEmptyStyle(),this.style.addLayer(y,a),this._update(!0)}moveLayer(y,a){return this.style.moveLayer(y,a),this._update(!0)}removeLayer(y){return this.style.removeLayer(y),this._update(!0)}getLayer(y){return this.style.getLayer(y)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(y,a,d){return this.style.setLayerZoomRange(y,a,d),this._update(!0)}setFilter(y,a,d={}){return this.style.setFilter(y,a,d),this._update(!0)}getFilter(y){return this.style.getFilter(y)}setPaintProperty(y,a,d,p={}){return this.style.setPaintProperty(y,a,d,p),this._update(!0)}getPaintProperty(y,a){return this.style.getPaintProperty(y,a)}setLayoutProperty(y,a,d,p={}){return this.style.setLayoutProperty(y,a,d,p),this._update(!0)}getLayoutProperty(y,a){return this.style.getLayoutProperty(y,a)}setGlyphs(y,a={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(y,a),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(y,a,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(y,a,d,p=>{p||this._update(!0)}),this}removeSprite(y){return this._lazyInitEmptyStyle(),this.style.removeSprite(y),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(y,a={}){return this._lazyInitEmptyStyle(),this.style.setSprite(y,a,d=>{d||this._update(!0)}),this}setLight(y,a={}){return this._lazyInitEmptyStyle(),this.style.setLight(y,a),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(y,a){return this.style.setFeatureState(y,a),this._update()}removeFeatureState(y,a){return this.style.removeFeatureState(y,a),this._update()}getFeatureState(y){return this.style.getFeatureState(y)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let y=0,a=0;return this._container&&(y=this._container.clientWidth||400,a=this._container.clientHeight||300),[y,a]}_setupContainer(){const y=this._container;y.classList.add("maplibregl-map");const a=this._canvasContainer=M.create("div","maplibregl-canvas-container",y);this._interactive&&a.classList.add("maplibregl-interactive"),this._canvas=M.create("canvas","maplibregl-canvas",a),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),p=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],p);const g=this._controlContainer=M.create("div","maplibregl-control-container",y),x=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(A=>{x[A]=M.create("div",`maplibregl-ctrl-${A} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(y,a,d){this._canvas.width=Math.floor(d*y),this._canvas.height=Math.floor(d*a),this._canvas.style.width=`${y}px`,this._canvas.style.height=`${a}px`}_setupPainter(){const y={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let a=null;this._canvas.addEventListener("webglcontextcreationerror",p=>{a={requestedAttributes:y},p&&(a.statusMessage=p.statusMessage,a.type=p.type)},{once:!0});const d=this._canvas.getContext("webgl2",y)||this._canvas.getContext("webgl",y);if(!d){const p="Failed to initialize WebGL";throw a?(a.message=p,new Error(JSON.stringify(a))):new Error(p)}this.painter=new Il(d,this.transform),I.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(y){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||y,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(y){return this._update(),this._renderTaskQueue.add(y)}_cancelRenderFrame(y){this._renderTaskQueue.remove(y)}_render(y){const a=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(y),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,x=T.now();this.style.zoomHistory.update(g,x);const A=new l.a8(g,{now:x,fadeDuration:a,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=A.crossFadingFactor();P===1&&P===this._crossFadingFactor||(d=!0,this._crossFadingFactor=P),this.style.update(A)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,a,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:a,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var y;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),V.removeThrottleControl(this._imageQueueHandle),(y=this._resizeObserver)===null||y===void 0||y.disconnect();const a=this.painter.context.gl.getExtension("WEBGL_lose_context");a&&a.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),M.remove(this._canvasContainer),M.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,T.frameAsync(this._frameRequest).then(y=>{l.bc.frame(y),this._frameRequest=null,this._render(y)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(y){this._showTileBoundaries!==y&&(this._showTileBoundaries=y,this._update())}get showPadding(){return!!this._showPadding}set showPadding(y){this._showPadding!==y&&(this._showPadding=y,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(y){this._showCollisionBoxes!==y&&(this._showCollisionBoxes=y,y?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(y){this._showOverdrawInspector!==y&&(this._showOverdrawInspector=y,this._update())}get repaint(){return!!this._repaint}set repaint(y){this._repaint!==y&&(this._repaint=y,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(y){this._vertices=y,this._update()}get version(){return Qc}getCameraTargetElevation(){return this.transform.elevation}},h.MapMouseEvent=di,h.MapTouchEvent=kl,h.MapWheelEvent=Ta,h.Marker=Nl,h.NavigationControl=class{constructor(y){this._updateZoomButtons=()=>{const a=this._map.getZoom(),d=a===this._map.getMaxZoom(),p=a===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},this._rotateCompassArrow=()=>{const a=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=a},this._setButtonTitle=(a,d)=>{const p=this._map._getUIString(`NavigationControl.${d}`);a.title=p,a.setAttribute("aria-label",p)},this.options=l.e({},Lf,y),this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",a=>a.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",a=>this._map.zoomIn({},{originalEvent:a})),M.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",a=>this._map.zoomOut({},{originalEvent:a})),M.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",a=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:a}):this._map.resetNorth({},{originalEvent:a})}),this._compassIcon=M.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(y){return this._map=y,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new zf(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){M.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(y,a){const d=M.create("button",y,this._container);return d.type="button",d.addEventListener("click",a),d}},h.Popup=class extends l.E{constructor(y){super(),this.remove=()=>(this._content&&M.remove(this._content),this._container&&(M.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=a=>{this._update(a.point)},this._onMouseMove=a=>{this._update(a.point)},this._onDrag=a=>{this._update(a.point)},this._update=a=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=M.create("div","maplibregl-popup",this._map.getContainer()),this._tip=M.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const P of this.options.className.split(" "))this._container.classList.add(P);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?vh(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!a)return;const p=this._flatPos=this._pos=this._trackPointer&&a?a:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&a?a:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const x=Uf(this.options.offset);if(!g){const P=this._container.offsetWidth,D=this._container.offsetHeight;let H;H=p.y+x.bottom.y<D?["top"]:p.y>this._map.transform.height-D?["bottom"]:[],p.x<P/2?H.push("left"):p.x>this._map.transform.width-P/2&&H.push("right"),g=H.length===0?"bottom":H.join("-")}let A=p.add(x[g]);this.options.subpixelPositioning||(A=A.round()),M.setTransform(this._container,`${eu[g]} translate(${A.x}px,${A.y}px)`),yh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(Bf),y)}addTo(y){return this._map&&this.remove(),this._map=y,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(y){return this._lngLat=l.M.convert(y),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(y){return this.setDOMContent(document.createTextNode(y))}setHTML(y){const a=document.createDocumentFragment(),d=document.createElement("body");let p;for(d.innerHTML=y;p=d.firstChild,p;)a.appendChild(p);return this.setDOMContent(a)}getMaxWidth(){var y;return(y=this._container)===null||y===void 0?void 0:y.style.maxWidth}setMaxWidth(y){return this.options.maxWidth=y,this._update(),this}setDOMContent(y){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=M.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(y),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(y){this._container&&this._container.classList.add(y)}removeClassName(y){this._container&&this._container.classList.remove(y)}setOffset(y){return this.options.offset=y,this._update(),this}toggleClassName(y){if(this._container)return this._container.classList.toggle(y)}setSubpixelPositioning(y){this.options.subpixelPositioning=y}_createCloseButton(){this.options.closeButton&&(this._closeButton=M.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const y=this._container.querySelector(Of);y&&y.focus()}},h.RasterDEMTileSource=Ae,h.RasterTileSource=qn,h.ScaleControl=class{constructor(y){this._onMove=()=>{_h(this._map,this._container,this.options)},this.setUnit=a=>{this.options.unit=a,_h(this._map,this._container,this.options)},this.options=l.e({},Nf,y)}getDefaultPosition(){return"bottom-left"}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-scale",y.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){M.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=Cf,h.Style=vi,h.TerrainControl=class{constructor(y){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=y}onAdd(y){return this._map=y,this._container=M.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=M.create("button","maplibregl-ctrl-terrain",this._container),M.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){M.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=vm,h.TwoFingersTouchRotateHandler=Ef,h.TwoFingersTouchZoomHandler=dh,h.TwoFingersTouchZoomRotateHandler=mn,h.VectorTileSource=je,h.VideoSource=Tt,h.addSourceType=(y,a)=>l._(void 0,void 0,void 0,function*(){if(Gt(y))throw new Error(`A source type called "${y}" already exists.`);((d,p)=>{pn[d]=p})(y,a)}),h.clearPrewarmedResources=function(){const y=Ft;y&&(y.isPreloaded()&&y.numActive()===1?(y.release(Cn),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return on().getRTLTextPluginStatus()},h.getVersion=function(){return wm},h.getWorkerCount=function(){return it.workerCount},h.getWorkerUrl=function(){return l.a.WORKER_URL},h.importScriptInWorkers=function(y){return qe().broadcast("importScript",y)},h.prewarm=function(){Sn().acquire(Cn)},h.setMaxParallelImageRequests=function(y){l.a.MAX_PARALLEL_IMAGE_REQUESTS=y},h.setRTLTextPlugin=function(y,a){return on().setRTLTextPlugin(y,a)},h.setWorkerCount=function(y){it.workerCount=y},h.setWorkerUrl=function(y){l.a.WORKER_URL=y}});var c=n;return c})})(Z8);var pu=Z8.exports;function qW(t,e){const n=[];for(let r=0;r<t;r++)n.push(e(r));return n}let $W=class{constructor(e,n){ht(this,"canvas");ht(this,"gl");ht(this,"windGraph1");ht(this,"windGraph2");ht(this,"smudgeGraph1");ht(this,"smudgeGraph2");ht(this,"outGraph1");ht(this,"outGraph2");ht(this,"i",0);e.width=e.clientWidth,e.height=e.clientHeight;let r=e.getContext("webgl2");const s=new Sv(r,{allowAlpha:!0}),c=e.width,h=e.height,l=2e3,m=qW(l,We=>[Math.random(),Math.random(),Math.random()]),_=new mo(r,{data:new Float32Array(m.flat()),changesOften:!0}),S=structuredClone(m),T=new mo(r,{data:new Float32Array(S.flat()),changesOften:!0}),M=[[1,1,0,1],[1,-1,0,1],[-1,1,0,1],[-1,1,0,1],[1,-1,0,1],[-1,-1,0,1]],I=new mo(r,{data:new Float32Array(M.flat()),changesOften:!1}),[N,B,k,C]=[n.tlMerc.x,n.tlMerc.y,n.brMerc.x,n.brMerc.y],U=[[k,C,0,1],[k,B,0,1],[N,C,0,1],[N,C,0,1],[k,B,0,1],[N,B,0,1]],V=new mo(r,{data:new Float32Array(U.flat()),changesOften:!1}),Y=new ho(r,{width:c,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),he=new ho(r,{width:c,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),Z=new ho(r,{width:c,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),ne=new ki(r,{image:n.speedImage}),xe=new Pa(s,{program:{vertexSource:`#version 300 es
                      in vec3 particles;              // [mercator.x, mercator.y, lifetime]
                      out vec3 particlesNew;          // [mercator.x, mercator.y, lifetime]
                      uniform mat4 projMatrix;        // mercator to clip-space
                      uniform mat4 projMatrixInv;     // clip-space to mercator
                      uniform sampler2D speedTexture;
                      uniform float time;
                      uniform float zoom;
                      uniform vec4 bbox;
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }
        
                      float rand(vec2 co) {
                        return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
                      }
        
                      float zClipFromInverse(float xClip, float yClip) {
                        mat4 M = projMatrixInv;
                        return (- M[0][2] * xClip - M[1][2] * yClip - M[3][2]) / M[2][2];
                      }
        
                      // Or more generally, if zMerc !== 0:
                      float zClipFromInverseWithHeight(float xClip, float yClip, float zMerc) {
                        mat4 M = projMatrixInv;
                        float a = M[0][2] * xClip + M[1][2] * yClip + M[3][2]; 
                        float b = zMerc * ( M[0][3] * xClip + M[1][3] * yClip + M[3][3] );
                        float c = zMerc * M[2][3] - M[2][2];
                        return (a - b) / c;
                      }
        
                      void main() {
                          vec2 positionMerc = particles.xy;
                          float lifeTime = particles.z - 0.005;
                          
                          if (lifeTime < 0.0) {
                            float clipX = (rand(particles.xy) * 2.0 - 1.0) * 1.05;
                            float clipY = (rand(particles.yx) * 2.0 - 1.0) * 1.05;
                            float clipZ = zClipFromInverse(clipX, clipY);
                            vec4 randPointClip = vec4(clipX, clipY, clipZ, 1.0);
        
                            vec4 randPointMerc = projMatrixInv * randPointClip;
                            positionMerc.xy = randPointMerc.xy / randPointMerc.w;
                            lifeTime = 1.0;
                          }
        
                          gl_PointSize = 2.0;
                          vec4 speedMerc =  2.0 * texture(speedTexture, merc2uv(positionMerc.xy)) - 1.0;
                          vec4 updatedPositionMerc = vec4(positionMerc.xy, 0, 1) + 0.1 * speedMerc / (50.0 * zoom * zoom * zoom);
                          gl_Position = projMatrix * updatedPositionMerc;
                          particlesNew = vec3(updatedPositionMerc.xy, lifeTime);
                          // gl_Position = vec4(updatedPositionMerc.xy, 0, 1); <-- nothing
                          // gl_Position = vec4(positionMerc.xy, 0, 1); <-- something drawn before matrix is available, but fading.
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      out vec4 fragColor;
                      void main() {
                          fragColor = vec4(1, 0, 0, 1);
                      }
                  `},inputs:{attributes:{particles:{buffer:_,config:{type:"vec3",normalize:!1,nrInstances:0}}},textures:{speedTexture:ne},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},projMatrixInv:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},time:{type:"float",value:[0]},zoom:{type:"float",value:[0]},bbox:{type:"vec4",value:[N,B,k,C]}}},outputs:{transformFeedback:{data:{particlesNew:T},runFragmentShader:!0},frameBuffer:{textures:[Y]}},settings:{drawingMode:"points",instanced:!1,nrVertices:l,viewport:[0,0,c,h]}}),ie=new Pa(s,{...xe.config,program:xe.program,inputs:{...xe.config.inputs,attributes:{particles:{buffer:T,config:{type:"vec3",normalize:!1,nrInstances:0}}}},outputs:{...xe.config.outputs,transformFeedback:{data:{particlesNew:_},runFragmentShader:!0}}}),J=new Pa(s,{program:{vertexSource:`#version 300 es
                in vec4 tposition;
                void main() {
                  gl_Position = vec4(tposition.x, tposition.y, 0, 1);
                }
              `,fragmentSource:`#version 300 es
                precision highp float;
                uniform sampler2D particlesTexture;
                uniform sampler2D smudgeTextureLast;
                uniform vec2 texSize;
                uniform bool isMoving;
                out vec4 fragColor;
                void main() {
                  vec2 uv = vec2(
                      gl_FragCoord.x / texSize.x, 
                      gl_FragCoord.y / texSize.y
                  );
                  vec4 lastColor = texture(smudgeTextureLast, uv);
                  lastColor *= 0.95;
                  vec4 particleColor = texture(particlesTexture, uv);
                  fragColor = particleColor + lastColor;
                  if (isMoving) fragColor = vec4(0,0,0,0);
                }
              `},inputs:{attributes:{tposition:{buffer:I,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{particlesTexture:Y,smudgeTextureLast:he},uniforms:{isMoving:{type:"bool",value:[0]},texSize:{type:"vec2",value:[c,h]}}},outputs:{frameBuffer:{textures:[Z]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,c,h]}}),Te=new Pa(s,{...J.config,program:J.program,inputs:{...J.config.inputs,textures:{particlesTexture:Y,smudgeTextureLast:Z}},outputs:{...J.config.outputs,frameBuffer:{textures:[he]}}}),Be=new Pa(s,{program:{vertexSource:`#version 300 es
                      in vec4 bboxPosMerc;
                      uniform mat4 projMatrix;
                      out vec2 positionMerc;
                      void main() {
                          gl_Position = projMatrix * vec4(bboxPosMerc.xy, 0, 1);  
                          positionMerc = bboxPosMerc.xy;
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      uniform sampler2D smudgedTexture;
                      uniform sampler2D speedTexture;
                      uniform vec4 bbox;
                      uniform vec2 texSize;
                      in vec2 positionMerc;
                      out highp vec4 fragColor;
        
                      vec2 currentClipUv() {
                        float u = gl_FragCoord.x / texSize.x;
                        float v = gl_FragCoord.y / texSize.y;
                        return vec2(u, v);
                      }
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }

                      vec3 colorRamp1 = vec3(0.07890625, 0.25546875, 0.4);
                      vec3 colorRamp2 = vec3(0.36015625, 0.2984375,  0.56015625);
                      vec3 colorRamp3 = vec3(0.653125,   0.18125,    0.29453125);

                      vec3 colorScale(float h) {
                        if (h < 0.5) {
                          float deg = 2.0 * h;
                          return mix(colorRamp1, colorRamp2, deg);
                        }
                        else {
                          float deg = (h - 0.5) * 2.0;
                          return mix(colorRamp2, colorRamp3, deg);
                        }
                      }
        
                      void main() {
                          vec2 uvSmudge = currentClipUv();
                          vec4 currentSmudge = texture(smudgedTexture, uvSmudge);
                          float p = currentSmudge.x;
                          vec3 particleColor = vec3(p);
                          
                          vec2 uvSpeed = merc2uv(positionMerc);
                          vec4 currentSpeed = texture(speedTexture, uvSpeed);
                          float magSpeed = length(currentSpeed) / 1.732; // 1.732: sqrt(1+1+1)
                          vec3 speedColor = colorScale(magSpeed);

                          fragColor = vec4(
                            max(particleColor.x, speedColor.x),
                            max(particleColor.y, speedColor.y),
                            max(particleColor.z, speedColor.z),
                            max(p, 0.3)
                          );

                          // if (p > 0.1) {
                          //   fragColor = vec4(particleColor.xyz, 1.0);
                          // } else {
                          //   fragColor = vec4(speedColor.xyz, 0.6);
                          // }
                          // fragColor = max(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0)
                          // );
                          // fragColor = mix(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0),
                          //   p
                          // );
                          // fragColor = max(vec4(currentSmudge.x), vec4(magSpeed, 1.0 - magSpeed, 1.0 - magSpeed, 0.4));
                          // fragColor = vec4(currentSmudge.x) + vec4(0.1, 0.1, 0.1, 0.4);
                          // fragColor = vec4(currentSmudge.x) + currentSpeed;
                      }
              `},inputs:{attributes:{bboxPosMerc:{buffer:V,config:{type:"vec4",normalize:!1,nrInstances:0}}},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},bbox:{type:"vec4",value:[N,B,k,C]},texSize:{type:"vec2",value:[c,h]}},textures:{smudgedTexture:Z,speedTexture:ne}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:U.length,viewport:[0,0,c,h]}}),Re=new Pa(s,{...Be.config,program:Be.program,inputs:{...Be.config.inputs,textures:{smudgedTexture:he,speedTexture:ne}}});this.canvas=e,this.gl=r,this.windGraph1=xe,this.windGraph2=ie,this.smudgeGraph1=J,this.smudgeGraph2=Te,this.outGraph1=Be,this.outGraph2=Re}step(e){this.i%2===0?(this.windGraph1.updateUniform("projMatrix",e.matrix),this.windGraph1.updateUniform("projMatrixInv",e.invMatrix),this.windGraph1.updateUniform("time",[new Date().getTime()]),this.windGraph1.updateUniform("zoom",[e.zoom]),this.smudgeGraph1.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph1.updateUniform("projMatrix",e.matrix),this.outGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph1.draw([0,0,0,1]),this.smudgeGraph1.draw([0,0,0,1]),this.outGraph1.draw()):(this.windGraph2.updateUniform("projMatrix",e.matrix),this.windGraph2.updateUniform("projMatrixInv",e.invMatrix),this.windGraph2.updateUniform("time",[new Date().getTime()]),this.windGraph2.updateUniform("zoom",[e.zoom]),this.smudgeGraph2.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph2.updateUniform("projMatrix",e.matrix),this.outGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph2.draw([0,0,0,1]),this.smudgeGraph2.draw([0,0,0,1]),this.outGraph2.draw()),this.i+=1}destroy(e){var n,r,s,c,h,l;(n=this.windGraph1)==null||n.destroy(e),(r=this.windGraph2)==null||r.destroy(e),(s=this.smudgeGraph1)==null||s.destroy(e),(c=this.smudgeGraph2)==null||c.destroy(e),(h=this.outGraph1)==null||h.destroy(e),(l=this.outGraph2)==null||l.destroy(e)}};const XW=8,ZW="Dark Matter DLR",YW={"mapbox:autocomposite":!1,"mapbox:groups":{"101da9f13b64a08fa4b6ac1168e89e5f":{collapsed:!1,name:"Places"},a14c9607bc7954ba1df7205bf660433f:{name:"Boundaries"},b6371a3f2f5a9932464fa3867530a2e5:{collapsed:!1,name:"Transportation"}},"mapbox:type":"template","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t","openmaptiles:version":"3.x","maputnik:renderer":"mlgljs"},KW={openmaptiles:{type:"vector",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"],minZoom:0,maxZoom:14}},JW="https://openmaptiles.github.io/dark-matter-gl-style/sprite",QW="https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf",eq=[{id:"background",type:"background",paint:{"background-color":"rgb(12,12,12)"}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-antialias":!1,"fill-color":"rgb(27 ,27 ,29)"}},{id:"landcover_ice_shelf",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","ice_shelf"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(12,12,12)","fill-opacity":.7}},{id:"landcover_glacier",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","glacier"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 1%, 2%)","fill-opacity":{base:1,stops:[[0,1],[8,.5]]}}},{id:"landuse_residential",type:"fill",source:"openmaptiles","source-layer":"landuse",maxzoom:9,filter:["all",["==","$type","Polygon"],["==","class","residential"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 2%, 5%)","fill-opacity":.4}},{id:"landcover_wood",type:"fill",source:"openmaptiles","source-layer":"landcover",minzoom:10,filter:["all",["==","$type","Polygon"],["==","class","wood"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)","fill-opacity":{base:.3,stops:[[8,0],[10,.8],[13,.4]]},"fill-pattern":"wood-pattern","fill-translate":[0,0]}},{id:"landuse_park",type:"fill",source:"openmaptiles","source-layer":"landuse",filter:["all",["==","$type","Polygon"],["==","class","park"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)"}},{id:"waterway",type:"line",source:"openmaptiles","source-layer":"waterway",filter:["==","$type","LineString"],layout:{visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)"}},{id:"water_name",type:"symbol",source:"openmaptiles","source-layer":"water_name",filter:["==","$type","LineString"],layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Condensed Italic"],"text-rotation-alignment":"map","text-size":12},paint:{"text-color":"hsla(0, 0%, 0%, 0.7)","text-halo-color":"hsl(0, 0%, 27%)"}},{id:"building",type:"fill",source:"openmaptiles","source-layer":"building",minzoom:12,filter:["==","$type","Polygon"],paint:{"fill-antialias":!0,"fill-color":"rgb(10,10,10)","fill-outline-color":"rgb(27 ,27 ,29)"}},{id:"aeroway-taxiway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":1,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"aeroway-runway-casing",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-opacity":1,"line-width":{base:1.5,stops:[[11,5],[17,55]]}}},{id:"aeroway-area",type:"fill",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],layout:{visibility:"visible"},paint:{"fill-color":"#000","fill-opacity":1}},{id:"aeroway-runway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#000","line-opacity":1,"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"road_area_pier",type:"fill",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","Polygon"],["==","class","pier"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"rgb(12,12,12)"}},{id:"road_pier",type:"line",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["in","class","pier"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(12,12,12)","line-width":{base:1.2,stops:[[15,1],[17,4]]}}},{id:"highway_path",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["==","class","path"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)","line-dasharray":[1.5,1.5],"line-opacity":.9,"line-width":{base:1.2,stops:[[13,1],[20,10]]}}},{id:"highway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:8,filter:["all",["==","$type","LineString"],["in","class","minor","service","track"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":.9,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"highway_major_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[12,0],"line-width":{base:1.3,stops:[[10,3],[20,23]]}}},{id:"highway_major_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"hsl(0, 0%, 7%)","line-width":{base:1.3,stops:[[10,2],[20,20]]}}},{id:"highway_major_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,maxzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#2a2a2a","line-width":{stops:[[6,0],[8,2]]}}},{id:"highway_motorway_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[2,0],"line-opacity":1,"line-width":{base:1.4,stops:[[5.8,0],[6,3],[20,40]]}}},{id:"highway_motorway_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":{base:1,stops:[[5.8,"hsla(0, 0%, 85%, 0.53)"],[6,"#000"]]},"line-width":{base:1.4,stops:[[4,2],[6,1.3],[20,30]]}}},{id:"road_oneway",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":0,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"road_oneway_opposite",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",-1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":180,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"highway_motorway_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",maxzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-width":{base:1.4,stops:[[4,2],[6,1.3]]}}},{id:"railway_transit",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_transit_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_minor_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":{base:1.3,stops:[[16,3],[20,7]]}}},{id:"railway_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":{base:1.3,stops:[[16,2],[20,6]]}}},{id:"highway_name_other",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["!=","class","motorway"],["==","$type","LineString"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{name:latin} {name:nonlatin}","text-font":["Roboto Regular"],"text-max-angle":30,"text-pitch-alignment":"viewport","text-rotation-alignment":"map","text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgba(80, 78, 78, 1)","text-halo-blur":0,"text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":1,"text-translate":[0,0]}},{id:"highway_name_motorway",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{ref}","text-font":["Roboto Light"],"text-pitch-alignment":"viewport","text-rotation-alignment":"viewport","text-size":10,visibility:"visible"},paint:{"text-color":"hsl(0, 0%, 37%)","text-translate":[0,2]}},{id:"boundary_state",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",filter:["==","admin_level",4],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-blur":.4,"line-color":"hsl(0, 0%, 21%)","line-dasharray":[2,2],"line-opacity":1,"line-width":{base:1.3,stops:[[3,1],[22,15]]}}},{id:"boundary_country_z0-4",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",maxzoom:5,filter:["all",["==","admin_level",2],["!has","claimed_by"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"boundary_country_z5-",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",minzoom:5,filter:["==","admin_level",2],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"place_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["in","class","hamlet","isolated_dwelling","neighbourhood"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_suburb",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","suburb"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_village",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","village"]],layout:{"icon-size":.4,"text-anchor":"left","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_town",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","town"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","city"],[">","rank",3]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city_large",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["<=","rank",3],["==","class","city"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":14,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_state",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["==","class","state"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_country_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Condensed Italic"],"text-size":{base:1,stops:[[0,9],[1,11]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_minor",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],[">=","rank",2],["has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1,stops:[[0,10],[6,12]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_major",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:6,filter:["all",["==","$type","Point"],["<=","rank",1],["==","class","country"],["has","iso_a2"]],layout:{"text-anchor":"center","text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1.4,stops:[[0,10],[3,12],[4,14]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}}],tq="dark-matter",nq={version:XW,name:ZW,metadata:YW,sources:KW,sprite:JW,glyphs:QW,layers:eq,id:tq};class rq{constructor(){ht(this,"container");ht(this,"overlay");ht(this,"looper");ht(this,"ws");ht(this,"map");ht(this,"destroyed",!1);ht(this,"zoom",1);ht(this,"movingTimeout");ht(this,"isMoving",!1);ht(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);ht(this,"invMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}async init(e,n){n.width=n.clientWidth,n.height=n.clientHeight,this.container=e,this.overlay=n;const r=52.99489512738211,s=55.20539216798002,c=6.787129861958135,h=12.989942944851833;this.map=new pu.Map({container:e,style:nq,center:new pu.LngLat((h-c)/2+c,(s-r)/2+r),maxZoom:11,minZoom:6,maxBounds:new pu.LngLatBounds(new pu.LngLat(c-1,r-1),new pu.LngLat(h+1,s+1)),zoom:8,bearing:15,pitch:30});const l=new pu.LngLat(c,s),m=new pu.LngLat(h,r),_=this.map.transform.locationCoordinate(l),S=this.map.transform.locationCoordinate(m),T=await ki.loadImage("/wind_map.jpg");this.ws=new $W(n,{tlMerc:_,brMerc:S,speedImage:T}),this.looper=new kp(30,()=>{var M;(M=this.ws)==null||M.step({zoom:this.zoom,isMoving:this.isMoving,matrix:this.matrix,invMatrix:this.invMatrix})}),this.map.addLayer({id:"windSim",type:"custom",render:(M,I)=>{this.matrix=Array.from(I),this.invMatrix=Array.from(WW(jW(),I)),this.map&&(this.zoom=this.map.getZoom()),this.isMoving=!0,this.movingTimeout&&(clearTimeout(this.movingTimeout),this.movingTimeout=void 0),this.movingTimeout=setTimeout(()=>this.isMoving=!1,100)}}),this.startLoop()}startLoop(){var e;!this.container||!this.overlay||(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){this.stopLoop(),this.ws&&this.ws.destroy(!0),this.map&&this.map.remove(),this.overlay=void 0,this.container=void 0,this.destroyed=!0}}function iq(){const t=pt.useRef(null),e=pt.useRef(null);return pt.useEffect(()=>{const n=new rq;return t.current&&e.current&&n.init(t.current,e.current),()=>n.destroy()},[t.current,e.current]),me.jsx("div",{ref:t,style:{width:"100%",height:"100%"},children:me.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",position:"absolute",zIndex:1,top:0,left:0,pointerEvents:"none"}})})}function aq(){return me.jsxs(X8,{bgImg:"/turbine_img.jpg",title:"Wind visualization",subTitle:"Scaling to thousands of points",logo:me.jsxs("svg",{id:"fullBuilding",width:"100%",height:"100%",viewBox:"0 0 100 200",children:[me.jsx("rect",{x:"47.5",y:"70",width:"5",height:"100",fill:"black"}),me.jsx("rect",{x:"45",y:"70",width:"10",height:"8",fill:"black"}),me.jsxs("svg",{id:"fullRotor",x:"0",y:"20",width:"100",height:"100",viewBox:"0 0 100 100",children:[me.jsx("defs",{children:me.jsx("path",{id:"blade",d:"M 0,50 C 9,40, 0,30, 0,0 Z",fill:"black"})}),me.jsxs("g",{transform:"rotate(10 50 50)",children:[me.jsx("svg",{x:"45",y:"45",width:"10",height:"10",viewBox:"0 0 100 100",children:me.jsx("g",{transform:"rotate(15 50 50)",children:me.jsx("path",{d:"M 50 0 L 93.3 75 L 6.7 75 Z",fill:"black"})})}),me.jsx("use",{href:"#blade",x:"50",y:"0",transform:""}),me.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(120 50 50)"}),me.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(240 50 50)"}),me.jsx("circle",{cx:"50",cy:"50",r:"2.5",fill:"black"})]})]})]}),children:[me.jsx("p",{style:{margin:"2rem"},children:"Using particles is a highly readable and intuitive way of displaying wind speed and development. Such a visualization has the highest impact only with many hundreds or thousands of individual particles - which is not realistically possible on standard CPUs."}),me.jsx("p",{style:{margin:"2rem"},children:"Here we've build custom glsl-shaders to simulate thousands of particles at a time. This way, your main site remains responsive, while the heavy lifting has been outsourced to the GPU."}),me.jsx("div",{style:{width:"100%",aspectRatio:"3/2"},children:me.jsx(iq,{})}),me.jsx("p",{style:{margin:"2rem"},children:"The above example has been written for use in maplibre, but can be adjusted for other mapping libraries such as openlayers."})]})}const sq=RI([{path:"/",element:me.jsx(AD,{}),errorElement:me.jsx(gD,{}),children:[{path:"/",element:me.jsx(MD,{})},{path:"/contact",element:me.jsx(mD,{})},{path:"/swe",element:me.jsx(GW,{})},{path:"/wind",element:me.jsx(aq,{})},{path:"/imprint",element:me.jsx(CD,{})},{path:"/resources",element:me.jsx(EO,{})},{path:"/math",element:me.jsx(OW,{})}]}]);fx.createRoot(document.getElementById("root")).render(me.jsx(mT.StrictMode,{children:me.jsx(BI,{router:sq})}));
