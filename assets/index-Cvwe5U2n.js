var w9=Object.defineProperty;var S9=(n,e,t)=>e in n?w9(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ct=(n,e,t)=>(S9(n,typeof e!="symbol"?e+"":e,t),t);function $6(n,e){for(var t=0;t<e.length;t++){const r=e[t];if(typeof r!="string"&&!Array.isArray(r)){for(const i in r)if(i!=="default"&&!(i in n)){const o=Object.getOwnPropertyDescriptor(r,i);o&&Object.defineProperty(n,i,o.get?o:{enumerable:!0,get:()=>r[i]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const u of o.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&r(u)}).observe(document,{childList:!0,subtree:!0});function t(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=t(i);fetch(i.href,o)}})();var D1=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Yb(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}function M9(n){if(n.__esModule)return n;var e=n.default;if(typeof e=="function"){var t=function r(){return this instanceof r?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(n).forEach(function(r){var i=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(t,r,i.get?i:{enumerable:!0,get:function(){return n[r]}})}),t}var q6={exports:{}},Zy={},X6={exports:{}},sr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var im=Symbol.for("react.element"),T9=Symbol.for("react.portal"),E9=Symbol.for("react.fragment"),A9=Symbol.for("react.strict_mode"),C9=Symbol.for("react.profiler"),P9=Symbol.for("react.provider"),R9=Symbol.for("react.context"),I9=Symbol.for("react.forward_ref"),D9=Symbol.for("react.suspense"),k9=Symbol.for("react.memo"),L9=Symbol.for("react.lazy"),yS=Symbol.iterator;function z9(n){return n===null||typeof n!="object"?null:(n=yS&&n[yS]||n["@@iterator"],typeof n=="function"?n:null)}var Z6={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Y6=Object.assign,K6={};function vf(n,e,t){this.props=n,this.context=e,this.refs=K6,this.updater=t||Z6}vf.prototype.isReactComponent={};vf.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};vf.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function J6(){}J6.prototype=vf.prototype;function Kb(n,e,t){this.props=n,this.context=e,this.refs=K6,this.updater=t||Z6}var Jb=Kb.prototype=new J6;Jb.constructor=Kb;Y6(Jb,vf.prototype);Jb.isPureReactComponent=!0;var vS=Array.isArray,Q6=Object.prototype.hasOwnProperty,Qb={current:null},eE={key:!0,ref:!0,__self:!0,__source:!0};function tE(n,e,t){var r,i={},o=null,u=null;if(e!=null)for(r in e.ref!==void 0&&(u=e.ref),e.key!==void 0&&(o=""+e.key),e)Q6.call(e,r)&&!eE.hasOwnProperty(r)&&(i[r]=e[r]);var l=arguments.length-2;if(l===1)i.children=t;else if(1<l){for(var p=Array(l),v=0;v<l;v++)p[v]=arguments[v+2];i.children=p}if(n&&n.defaultProps)for(r in l=n.defaultProps,l)i[r]===void 0&&(i[r]=l[r]);return{$$typeof:im,type:n,key:o,ref:u,props:i,_owner:Qb.current}}function F9(n,e){return{$$typeof:im,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function ew(n){return typeof n=="object"&&n!==null&&n.$$typeof===im}function N9(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var _S=/\/+/g;function O_(n,e){return typeof n=="object"&&n!==null&&n.key!=null?N9(""+n.key):e.toString(36)}function k1(n,e,t,r,i){var o=typeof n;(o==="undefined"||o==="boolean")&&(n=null);var u=!1;if(n===null)u=!0;else switch(o){case"string":case"number":u=!0;break;case"object":switch(n.$$typeof){case im:case T9:u=!0}}if(u)return u=n,i=i(u),n=r===""?"."+O_(u,0):r,vS(i)?(t="",n!=null&&(t=n.replace(_S,"$&/")+"/"),k1(i,e,t,"",function(v){return v})):i!=null&&(ew(i)&&(i=F9(i,t+(!i.key||u&&u.key===i.key?"":(""+i.key).replace(_S,"$&/")+"/")+n)),e.push(i)),1;if(u=0,r=r===""?".":r+":",vS(n))for(var l=0;l<n.length;l++){o=n[l];var p=r+O_(o,l);u+=k1(o,e,t,p,i)}else if(p=z9(n),typeof p=="function")for(n=p.call(n),l=0;!(o=n.next()).done;)o=o.value,p=r+O_(o,l++),u+=k1(o,e,t,p,i);else if(o==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return u}function Pg(n,e,t){if(n==null)return n;var r=[],i=0;return k1(n,r,"","",function(o){return e.call(t,o,i++)}),r}function O9(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var Pa={current:null},L1={transition:null},B9={ReactCurrentDispatcher:Pa,ReactCurrentBatchConfig:L1,ReactCurrentOwner:Qb};sr.Children={map:Pg,forEach:function(n,e,t){Pg(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return Pg(n,function(){e++}),e},toArray:function(n){return Pg(n,function(e){return e})||[]},only:function(n){if(!ew(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};sr.Component=vf;sr.Fragment=E9;sr.Profiler=C9;sr.PureComponent=Kb;sr.StrictMode=A9;sr.Suspense=D9;sr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B9;sr.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var r=Y6({},n.props),i=n.key,o=n.ref,u=n._owner;if(e!=null){if(e.ref!==void 0&&(o=e.ref,u=Qb.current),e.key!==void 0&&(i=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(p in e)Q6.call(e,p)&&!eE.hasOwnProperty(p)&&(r[p]=e[p]===void 0&&l!==void 0?l[p]:e[p])}var p=arguments.length-2;if(p===1)r.children=t;else if(1<p){l=Array(p);for(var v=0;v<p;v++)l[v]=arguments[v+2];r.children=l}return{$$typeof:im,type:n.type,key:i,ref:o,props:r,_owner:u}};sr.createContext=function(n){return n={$$typeof:R9,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:P9,_context:n},n.Consumer=n};sr.createElement=tE;sr.createFactory=function(n){var e=tE.bind(null,n);return e.type=n,e};sr.createRef=function(){return{current:null}};sr.forwardRef=function(n){return{$$typeof:I9,render:n}};sr.isValidElement=ew;sr.lazy=function(n){return{$$typeof:L9,_payload:{_status:-1,_result:n},_init:O9}};sr.memo=function(n,e){return{$$typeof:k9,type:n,compare:e===void 0?null:e}};sr.startTransition=function(n){var e=L1.transition;L1.transition={};try{n()}finally{L1.transition=e}};sr.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};sr.useCallback=function(n,e){return Pa.current.useCallback(n,e)};sr.useContext=function(n){return Pa.current.useContext(n)};sr.useDebugValue=function(){};sr.useDeferredValue=function(n){return Pa.current.useDeferredValue(n)};sr.useEffect=function(n,e){return Pa.current.useEffect(n,e)};sr.useId=function(){return Pa.current.useId()};sr.useImperativeHandle=function(n,e,t){return Pa.current.useImperativeHandle(n,e,t)};sr.useInsertionEffect=function(n,e){return Pa.current.useInsertionEffect(n,e)};sr.useLayoutEffect=function(n,e){return Pa.current.useLayoutEffect(n,e)};sr.useMemo=function(n,e){return Pa.current.useMemo(n,e)};sr.useReducer=function(n,e,t){return Pa.current.useReducer(n,e,t)};sr.useRef=function(n){return Pa.current.useRef(n)};sr.useState=function(n){return Pa.current.useState(n)};sr.useSyncExternalStore=function(n,e,t){return Pa.current.useSyncExternalStore(n,e,t)};sr.useTransition=function(){return Pa.current.useTransition()};sr.version="18.2.0";X6.exports=sr;var yt=X6.exports;const nE=Yb(yt),U9=$6({__proto__:null,default:nE},[yt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var V9=yt,H9=Symbol.for("react.element"),G9=Symbol.for("react.fragment"),j9=Object.prototype.hasOwnProperty,W9=V9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$9={key:!0,ref:!0,__self:!0,__source:!0};function rE(n,e,t){var r,i={},o=null,u=null;t!==void 0&&(o=""+t),e.key!==void 0&&(o=""+e.key),e.ref!==void 0&&(u=e.ref);for(r in e)j9.call(e,r)&&!$9.hasOwnProperty(r)&&(i[r]=e[r]);if(n&&n.defaultProps)for(r in e=n.defaultProps,e)i[r]===void 0&&(i[r]=e[r]);return{$$typeof:H9,type:n,key:o,ref:u,props:i,_owner:W9.current}}Zy.Fragment=G9;Zy.jsx=rE;Zy.jsxs=rE;q6.exports=Zy;var ge=q6.exports,_2={},iE={exports:{}},ps={},aE={exports:{}},sE={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(ke,Je){var tt=ke.length;ke.push(Je);e:for(;0<tt;){var _t=tt-1>>>1,Lt=ke[_t];if(0<i(Lt,Je))ke[_t]=Je,ke[tt]=Lt,tt=_t;else break e}}function t(ke){return ke.length===0?null:ke[0]}function r(ke){if(ke.length===0)return null;var Je=ke[0],tt=ke.pop();if(tt!==Je){ke[0]=tt;e:for(var _t=0,Lt=ke.length,Cn=Lt>>>1;_t<Cn;){var nt=2*(_t+1)-1,wt=ke[nt],Ft=nt+1,At=ke[Ft];if(0>i(wt,tt))Ft<Lt&&0>i(At,wt)?(ke[_t]=At,ke[Ft]=tt,_t=Ft):(ke[_t]=wt,ke[nt]=tt,_t=nt);else if(Ft<Lt&&0>i(At,tt))ke[_t]=At,ke[Ft]=tt,_t=Ft;else break e}}return Je}function i(ke,Je){var tt=ke.sortIndex-Je.sortIndex;return tt!==0?tt:ke.id-Je.id}if(typeof performance=="object"&&typeof performance.now=="function"){var o=performance;n.unstable_now=function(){return o.now()}}else{var u=Date,l=u.now();n.unstable_now=function(){return u.now()-l}}var p=[],v=[],x=1,M=null,w=3,A=!1,k=!1,z=!1,D=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,U=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function B(ke){for(var Je=t(v);Je!==null;){if(Je.callback===null)r(v);else if(Je.startTime<=ke)r(v),Je.sortIndex=Je.expirationTime,e(p,Je);else break;Je=t(v)}}function K(ke){if(z=!1,B(ke),!k)if(t(p)!==null)k=!0,ut(ue);else{var Je=t(v);Je!==null&&pt(K,Je.startTime-ke)}}function ue(ke,Je){k=!1,z&&(z=!1,C(be),be=-1),A=!0;var tt=w;try{for(B(Je),M=t(p);M!==null&&(!(M.expirationTime>Je)||ke&&!Ee());){var _t=M.callback;if(typeof _t=="function"){M.callback=null,w=M.priorityLevel;var Lt=_t(M.expirationTime<=Je);Je=n.unstable_now(),typeof Lt=="function"?M.callback=Lt:M===t(p)&&r(p),B(Je)}else r(p);M=t(p)}if(M!==null)var Cn=!0;else{var nt=t(v);nt!==null&&pt(K,nt.startTime-Je),Cn=!1}return Cn}finally{M=null,w=tt,A=!1}}var Z=!1,ee=null,be=-1,ie=5,Q=-1;function Ee(){return!(n.unstable_now()-Q<ie)}function Fe(){if(ee!==null){var ke=n.unstable_now();Q=ke;var Je=!0;try{Je=ee(!0,ke)}finally{Je?Ae():(Z=!1,ee=null)}}else Z=!1}var Ae;if(typeof U=="function")Ae=function(){U(Fe)};else if(typeof MessageChannel<"u"){var Ve=new MessageChannel,lt=Ve.port2;Ve.port1.onmessage=Fe,Ae=function(){lt.postMessage(null)}}else Ae=function(){D(Fe,0)};function ut(ke){ee=ke,Z||(Z=!0,Ae())}function pt(ke,Je){be=D(function(){ke(n.unstable_now())},Je)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ke){ke.callback=null},n.unstable_continueExecution=function(){k||A||(k=!0,ut(ue))},n.unstable_forceFrameRate=function(ke){0>ke||125<ke?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ie=0<ke?Math.floor(1e3/ke):5},n.unstable_getCurrentPriorityLevel=function(){return w},n.unstable_getFirstCallbackNode=function(){return t(p)},n.unstable_next=function(ke){switch(w){case 1:case 2:case 3:var Je=3;break;default:Je=w}var tt=w;w=Je;try{return ke()}finally{w=tt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ke,Je){switch(ke){case 1:case 2:case 3:case 4:case 5:break;default:ke=3}var tt=w;w=ke;try{return Je()}finally{w=tt}},n.unstable_scheduleCallback=function(ke,Je,tt){var _t=n.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?_t+tt:_t):tt=_t,ke){case 1:var Lt=-1;break;case 2:Lt=250;break;case 5:Lt=1073741823;break;case 4:Lt=1e4;break;default:Lt=5e3}return Lt=tt+Lt,ke={id:x++,callback:Je,priorityLevel:ke,startTime:tt,expirationTime:Lt,sortIndex:-1},tt>_t?(ke.sortIndex=tt,e(v,ke),t(p)===null&&ke===t(v)&&(z?(C(be),be=-1):z=!0,pt(K,tt-_t))):(ke.sortIndex=Lt,e(p,ke),k||A||(k=!0,ut(ue))),ke},n.unstable_shouldYield=Ee,n.unstable_wrapCallback=function(ke){var Je=w;return function(){var tt=w;w=Je;try{return ke.apply(this,arguments)}finally{w=tt}}}})(sE);aE.exports=sE;var q9=aE.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oE=yt,ds=q9;function zt(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var lE=new Set,Ap={};function oh(n,e){ef(n,e),ef(n+"Capture",e)}function ef(n,e){for(Ap[n]=e,n=0;n<e.length;n++)lE.add(e[n])}var El=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),x2=Object.prototype.hasOwnProperty,X9=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,xS={},bS={};function Z9(n){return x2.call(bS,n)?!0:x2.call(xS,n)?!1:X9.test(n)?bS[n]=!0:(xS[n]=!0,!1)}function Y9(n,e,t,r){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return r?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function K9(n,e,t,r){if(e===null||typeof e>"u"||Y9(n,e,t,r))return!0;if(r)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function Ra(n,e,t,r,i,o,u){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=o,this.removeEmptyString=u}var qi={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){qi[n]=new Ra(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];qi[e]=new Ra(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){qi[n]=new Ra(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){qi[n]=new Ra(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){qi[n]=new Ra(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){qi[n]=new Ra(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){qi[n]=new Ra(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){qi[n]=new Ra(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){qi[n]=new Ra(n,5,!1,n.toLowerCase(),null,!1,!1)});var tw=/[\-:]([a-z])/g;function nw(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(tw,nw);qi[e]=new Ra(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(tw,nw);qi[e]=new Ra(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(tw,nw);qi[e]=new Ra(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){qi[n]=new Ra(n,1,!1,n.toLowerCase(),null,!1,!1)});qi.xlinkHref=new Ra("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){qi[n]=new Ra(n,1,!1,n.toLowerCase(),null,!0,!0)});function rw(n,e,t,r){var i=qi.hasOwnProperty(e)?qi[e]:null;(i!==null?i.type!==0:r||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(K9(e,t,i,r)&&(t=null),r||i===null?Z9(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):i.mustUseProperty?n[i.propertyName]=t===null?i.type===3?!1:"":t:(e=i.attributeName,r=i.attributeNamespace,t===null?n.removeAttribute(e):(i=i.type,t=i===3||i===4&&t===!0?"":""+t,r?n.setAttributeNS(r,e,t):n.setAttribute(e,t))))}var Fl=oE.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Rg=Symbol.for("react.element"),Md=Symbol.for("react.portal"),Td=Symbol.for("react.fragment"),iw=Symbol.for("react.strict_mode"),b2=Symbol.for("react.profiler"),cE=Symbol.for("react.provider"),uE=Symbol.for("react.context"),aw=Symbol.for("react.forward_ref"),w2=Symbol.for("react.suspense"),S2=Symbol.for("react.suspense_list"),sw=Symbol.for("react.memo"),wc=Symbol.for("react.lazy"),hE=Symbol.for("react.offscreen"),wS=Symbol.iterator;function L0(n){return n===null||typeof n!="object"?null:(n=wS&&n[wS]||n["@@iterator"],typeof n=="function"?n:null)}var Kr=Object.assign,B_;function np(n){if(B_===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);B_=e&&e[1]||""}return`
`+B_+n}var U_=!1;function V_(n,e){if(!n||U_)return"";U_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(v){var r=v}Reflect.construct(n,[],e)}else{try{e.call()}catch(v){r=v}n.call(e.prototype)}else{try{throw Error()}catch(v){r=v}n()}}catch(v){if(v&&r&&typeof v.stack=="string"){for(var i=v.stack.split(`
`),o=r.stack.split(`
`),u=i.length-1,l=o.length-1;1<=u&&0<=l&&i[u]!==o[l];)l--;for(;1<=u&&0<=l;u--,l--)if(i[u]!==o[l]){if(u!==1||l!==1)do if(u--,l--,0>l||i[u]!==o[l]){var p=`
`+i[u].replace(" at new "," at ");return n.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",n.displayName)),p}while(1<=u&&0<=l);break}}}finally{U_=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?np(n):""}function J9(n){switch(n.tag){case 5:return np(n.type);case 16:return np("Lazy");case 13:return np("Suspense");case 19:return np("SuspenseList");case 0:case 2:case 15:return n=V_(n.type,!1),n;case 11:return n=V_(n.type.render,!1),n;case 1:return n=V_(n.type,!0),n;default:return""}}function M2(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Td:return"Fragment";case Md:return"Portal";case b2:return"Profiler";case iw:return"StrictMode";case w2:return"Suspense";case S2:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case uE:return(n.displayName||"Context")+".Consumer";case cE:return(n._context.displayName||"Context")+".Provider";case aw:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case sw:return e=n.displayName||null,e!==null?e:M2(n.type)||"Memo";case wc:e=n._payload,n=n._init;try{return M2(n(e))}catch{}}return null}function Q9(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return M2(e);case 8:return e===iw?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function Gc(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function dE(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function eI(n){var e=dE(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),r=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var i=t.get,o=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return i.call(this)},set:function(u){r=""+u,o.call(this,u)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return r},setValue:function(u){r=""+u},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function Ig(n){n._valueTracker||(n._valueTracker=eI(n))}function fE(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),r="";return n&&(r=dE(n)?n.checked?"true":"false":n.value),n=r,n!==t?(e.setValue(n),!0):!1}function ty(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function T2(n,e){var t=e.checked;return Kr({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function SS(n,e){var t=e.defaultValue==null?"":e.defaultValue,r=e.checked!=null?e.checked:e.defaultChecked;t=Gc(e.value!=null?e.value:t),n._wrapperState={initialChecked:r,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function pE(n,e){e=e.checked,e!=null&&rw(n,"checked",e,!1)}function E2(n,e){pE(n,e);var t=Gc(e.value),r=e.type;if(t!=null)r==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(r==="submit"||r==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?A2(n,e.type,t):e.hasOwnProperty("defaultValue")&&A2(n,e.type,Gc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function MS(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var r=e.type;if(!(r!=="submit"&&r!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function A2(n,e,t){(e!=="number"||ty(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var rp=Array.isArray;function Hd(n,e,t,r){if(n=n.options,e){e={};for(var i=0;i<t.length;i++)e["$"+t[i]]=!0;for(t=0;t<n.length;t++)i=e.hasOwnProperty("$"+n[t].value),n[t].selected!==i&&(n[t].selected=i),i&&r&&(n[t].defaultSelected=!0)}else{for(t=""+Gc(t),e=null,i=0;i<n.length;i++){if(n[i].value===t){n[i].selected=!0,r&&(n[i].defaultSelected=!0);return}e!==null||n[i].disabled||(e=n[i])}e!==null&&(e.selected=!0)}}function C2(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(zt(91));return Kr({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function TS(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(zt(92));if(rp(t)){if(1<t.length)throw Error(zt(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:Gc(t)}}function mE(n,e){var t=Gc(e.value),r=Gc(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),r!=null&&(n.defaultValue=""+r)}function ES(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function gE(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function P2(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?gE(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var Dg,yE=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,r,i){MSApp.execUnsafeLocalFunction(function(){return n(e,t,r,i)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(Dg=Dg||document.createElement("div"),Dg.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=Dg.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function Cp(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var dp={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},tI=["Webkit","ms","Moz","O"];Object.keys(dp).forEach(function(n){tI.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),dp[e]=dp[n]})});function vE(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||dp.hasOwnProperty(n)&&dp[n]?(""+e).trim():e+"px"}function _E(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var r=t.indexOf("--")===0,i=vE(t,e[t],r);t==="float"&&(t="cssFloat"),r?n.setProperty(t,i):n[t]=i}}var nI=Kr({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function R2(n,e){if(e){if(nI[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(zt(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(zt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(zt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(zt(62))}}function I2(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var D2=null;function ow(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var k2=null,Gd=null,jd=null;function AS(n){if(n=om(n)){if(typeof k2!="function")throw Error(zt(280));var e=n.stateNode;e&&(e=ev(e),k2(n.stateNode,n.type,e))}}function xE(n){Gd?jd?jd.push(n):jd=[n]:Gd=n}function bE(){if(Gd){var n=Gd,e=jd;if(jd=Gd=null,AS(n),e)for(n=0;n<e.length;n++)AS(e[n])}}function wE(n,e){return n(e)}function SE(){}var H_=!1;function ME(n,e,t){if(H_)return n(e,t);H_=!0;try{return wE(n,e,t)}finally{H_=!1,(Gd!==null||jd!==null)&&(SE(),bE())}}function Pp(n,e){var t=n.stateNode;if(t===null)return null;var r=ev(t);if(r===null)return null;t=r[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(n=n.type,r=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!r;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(zt(231,e,typeof t));return t}var L2=!1;if(El)try{var z0={};Object.defineProperty(z0,"passive",{get:function(){L2=!0}}),window.addEventListener("test",z0,z0),window.removeEventListener("test",z0,z0)}catch{L2=!1}function rI(n,e,t,r,i,o,u,l,p){var v=Array.prototype.slice.call(arguments,3);try{e.apply(t,v)}catch(x){this.onError(x)}}var fp=!1,ny=null,ry=!1,z2=null,iI={onError:function(n){fp=!0,ny=n}};function aI(n,e,t,r,i,o,u,l,p){fp=!1,ny=null,rI.apply(iI,arguments)}function sI(n,e,t,r,i,o,u,l,p){if(aI.apply(this,arguments),fp){if(fp){var v=ny;fp=!1,ny=null}else throw Error(zt(198));ry||(ry=!0,z2=v)}}function lh(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function TE(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function CS(n){if(lh(n)!==n)throw Error(zt(188))}function oI(n){var e=n.alternate;if(!e){if(e=lh(n),e===null)throw Error(zt(188));return e!==n?null:n}for(var t=n,r=e;;){var i=t.return;if(i===null)break;var o=i.alternate;if(o===null){if(r=i.return,r!==null){t=r;continue}break}if(i.child===o.child){for(o=i.child;o;){if(o===t)return CS(i),n;if(o===r)return CS(i),e;o=o.sibling}throw Error(zt(188))}if(t.return!==r.return)t=i,r=o;else{for(var u=!1,l=i.child;l;){if(l===t){u=!0,t=i,r=o;break}if(l===r){u=!0,r=i,t=o;break}l=l.sibling}if(!u){for(l=o.child;l;){if(l===t){u=!0,t=o,r=i;break}if(l===r){u=!0,r=o,t=i;break}l=l.sibling}if(!u)throw Error(zt(189))}}if(t.alternate!==r)throw Error(zt(190))}if(t.tag!==3)throw Error(zt(188));return t.stateNode.current===t?n:e}function EE(n){return n=oI(n),n!==null?AE(n):null}function AE(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=AE(n);if(e!==null)return e;n=n.sibling}return null}var CE=ds.unstable_scheduleCallback,PS=ds.unstable_cancelCallback,lI=ds.unstable_shouldYield,cI=ds.unstable_requestPaint,pi=ds.unstable_now,uI=ds.unstable_getCurrentPriorityLevel,lw=ds.unstable_ImmediatePriority,PE=ds.unstable_UserBlockingPriority,iy=ds.unstable_NormalPriority,hI=ds.unstable_LowPriority,RE=ds.unstable_IdlePriority,Yy=null,Do=null;function dI(n){if(Do&&typeof Do.onCommitFiberRoot=="function")try{Do.onCommitFiberRoot(Yy,n,void 0,(n.current.flags&128)===128)}catch{}}var so=Math.clz32?Math.clz32:mI,fI=Math.log,pI=Math.LN2;function mI(n){return n>>>=0,n===0?32:31-(fI(n)/pI|0)|0}var kg=64,Lg=4194304;function ip(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ay(n,e){var t=n.pendingLanes;if(t===0)return 0;var r=0,i=n.suspendedLanes,o=n.pingedLanes,u=t&268435455;if(u!==0){var l=u&~i;l!==0?r=ip(l):(o&=u,o!==0&&(r=ip(o)))}else u=t&~i,u!==0?r=ip(u):o!==0&&(r=ip(o));if(r===0)return 0;if(e!==0&&e!==r&&!(e&i)&&(i=r&-r,o=e&-e,i>=o||i===16&&(o&4194240)!==0))return e;if(r&4&&(r|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=r;0<e;)t=31-so(e),i=1<<t,r|=n[t],e&=~i;return r}function gI(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function yI(n,e){for(var t=n.suspendedLanes,r=n.pingedLanes,i=n.expirationTimes,o=n.pendingLanes;0<o;){var u=31-so(o),l=1<<u,p=i[u];p===-1?(!(l&t)||l&r)&&(i[u]=gI(l,e)):p<=e&&(n.expiredLanes|=l),o&=~l}}function F2(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function IE(){var n=kg;return kg<<=1,!(kg&4194240)&&(kg=64),n}function G_(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function am(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-so(e),n[e]=t}function vI(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var r=n.eventTimes;for(n=n.expirationTimes;0<t;){var i=31-so(t),o=1<<i;e[i]=0,r[i]=-1,n[i]=-1,t&=~o}}function cw(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var r=31-so(t),i=1<<r;i&e|n[r]&e&&(n[r]|=e),t&=~i}}var _r=0;function DE(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var kE,uw,LE,zE,FE,N2=!1,zg=[],Dc=null,kc=null,Lc=null,Rp=new Map,Ip=new Map,Tc=[],_I="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function RS(n,e){switch(n){case"focusin":case"focusout":Dc=null;break;case"dragenter":case"dragleave":kc=null;break;case"mouseover":case"mouseout":Lc=null;break;case"pointerover":case"pointerout":Rp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ip.delete(e.pointerId)}}function F0(n,e,t,r,i,o){return n===null||n.nativeEvent!==o?(n={blockedOn:e,domEventName:t,eventSystemFlags:r,nativeEvent:o,targetContainers:[i]},e!==null&&(e=om(e),e!==null&&uw(e)),n):(n.eventSystemFlags|=r,e=n.targetContainers,i!==null&&e.indexOf(i)===-1&&e.push(i),n)}function xI(n,e,t,r,i){switch(e){case"focusin":return Dc=F0(Dc,n,e,t,r,i),!0;case"dragenter":return kc=F0(kc,n,e,t,r,i),!0;case"mouseover":return Lc=F0(Lc,n,e,t,r,i),!0;case"pointerover":var o=i.pointerId;return Rp.set(o,F0(Rp.get(o)||null,n,e,t,r,i)),!0;case"gotpointercapture":return o=i.pointerId,Ip.set(o,F0(Ip.get(o)||null,n,e,t,r,i)),!0}return!1}function NE(n){var e=Bu(n.target);if(e!==null){var t=lh(e);if(t!==null){if(e=t.tag,e===13){if(e=TE(t),e!==null){n.blockedOn=e,FE(n.priority,function(){LE(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function z1(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=O2(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var r=new t.constructor(t.type,t);D2=r,t.target.dispatchEvent(r),D2=null}else return e=om(t),e!==null&&uw(e),n.blockedOn=t,!1;e.shift()}return!0}function IS(n,e,t){z1(n)&&t.delete(e)}function bI(){N2=!1,Dc!==null&&z1(Dc)&&(Dc=null),kc!==null&&z1(kc)&&(kc=null),Lc!==null&&z1(Lc)&&(Lc=null),Rp.forEach(IS),Ip.forEach(IS)}function N0(n,e){n.blockedOn===e&&(n.blockedOn=null,N2||(N2=!0,ds.unstable_scheduleCallback(ds.unstable_NormalPriority,bI)))}function Dp(n){function e(i){return N0(i,n)}if(0<zg.length){N0(zg[0],n);for(var t=1;t<zg.length;t++){var r=zg[t];r.blockedOn===n&&(r.blockedOn=null)}}for(Dc!==null&&N0(Dc,n),kc!==null&&N0(kc,n),Lc!==null&&N0(Lc,n),Rp.forEach(e),Ip.forEach(e),t=0;t<Tc.length;t++)r=Tc[t],r.blockedOn===n&&(r.blockedOn=null);for(;0<Tc.length&&(t=Tc[0],t.blockedOn===null);)NE(t),t.blockedOn===null&&Tc.shift()}var Wd=Fl.ReactCurrentBatchConfig,sy=!0;function wI(n,e,t,r){var i=_r,o=Wd.transition;Wd.transition=null;try{_r=1,hw(n,e,t,r)}finally{_r=i,Wd.transition=o}}function SI(n,e,t,r){var i=_r,o=Wd.transition;Wd.transition=null;try{_r=4,hw(n,e,t,r)}finally{_r=i,Wd.transition=o}}function hw(n,e,t,r){if(sy){var i=O2(n,e,t,r);if(i===null)Q_(n,e,r,oy,t),RS(n,r);else if(xI(i,n,e,t,r))r.stopPropagation();else if(RS(n,r),e&4&&-1<_I.indexOf(n)){for(;i!==null;){var o=om(i);if(o!==null&&kE(o),o=O2(n,e,t,r),o===null&&Q_(n,e,r,oy,t),o===i)break;i=o}i!==null&&r.stopPropagation()}else Q_(n,e,r,null,t)}}var oy=null;function O2(n,e,t,r){if(oy=null,n=ow(r),n=Bu(n),n!==null)if(e=lh(n),e===null)n=null;else if(t=e.tag,t===13){if(n=TE(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return oy=n,null}function OE(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(uI()){case lw:return 1;case PE:return 4;case iy:case hI:return 16;case RE:return 536870912;default:return 16}default:return 16}}var Cc=null,dw=null,F1=null;function BE(){if(F1)return F1;var n,e=dw,t=e.length,r,i="value"in Cc?Cc.value:Cc.textContent,o=i.length;for(n=0;n<t&&e[n]===i[n];n++);var u=t-n;for(r=1;r<=u&&e[t-r]===i[o-r];r++);return F1=i.slice(n,1<r?1-r:void 0)}function N1(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function Fg(){return!0}function DS(){return!1}function ms(n){function e(t,r,i,o,u){this._reactName=t,this._targetInst=i,this.type=r,this.nativeEvent=o,this.target=u,this.currentTarget=null;for(var l in n)n.hasOwnProperty(l)&&(t=n[l],this[l]=t?t(o):o[l]);return this.isDefaultPrevented=(o.defaultPrevented!=null?o.defaultPrevented:o.returnValue===!1)?Fg:DS,this.isPropagationStopped=DS,this}return Kr(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=Fg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=Fg)},persist:function(){},isPersistent:Fg}),e}var _f={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},fw=ms(_f),sm=Kr({},_f,{view:0,detail:0}),MI=ms(sm),j_,W_,O0,Ky=Kr({},sm,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:pw,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==O0&&(O0&&n.type==="mousemove"?(j_=n.screenX-O0.screenX,W_=n.screenY-O0.screenY):W_=j_=0,O0=n),j_)},movementY:function(n){return"movementY"in n?n.movementY:W_}}),kS=ms(Ky),TI=Kr({},Ky,{dataTransfer:0}),EI=ms(TI),AI=Kr({},sm,{relatedTarget:0}),$_=ms(AI),CI=Kr({},_f,{animationName:0,elapsedTime:0,pseudoElement:0}),PI=ms(CI),RI=Kr({},_f,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),II=ms(RI),DI=Kr({},_f,{data:0}),LS=ms(DI),kI={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},LI={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},zI={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function FI(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=zI[n])?!!e[n]:!1}function pw(){return FI}var NI=Kr({},sm,{key:function(n){if(n.key){var e=kI[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=N1(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?LI[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:pw,charCode:function(n){return n.type==="keypress"?N1(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?N1(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),OI=ms(NI),BI=Kr({},Ky,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),zS=ms(BI),UI=Kr({},sm,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:pw}),VI=ms(UI),HI=Kr({},_f,{propertyName:0,elapsedTime:0,pseudoElement:0}),GI=ms(HI),jI=Kr({},Ky,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),WI=ms(jI),$I=[9,13,27,32],mw=El&&"CompositionEvent"in window,pp=null;El&&"documentMode"in document&&(pp=document.documentMode);var qI=El&&"TextEvent"in window&&!pp,UE=El&&(!mw||pp&&8<pp&&11>=pp),FS=" ",NS=!1;function VE(n,e){switch(n){case"keyup":return $I.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function HE(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var Ed=!1;function XI(n,e){switch(n){case"compositionend":return HE(e);case"keypress":return e.which!==32?null:(NS=!0,FS);case"textInput":return n=e.data,n===FS&&NS?null:n;default:return null}}function ZI(n,e){if(Ed)return n==="compositionend"||!mw&&VE(n,e)?(n=BE(),F1=dw=Cc=null,Ed=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return UE&&e.locale!=="ko"?null:e.data;default:return null}}var YI={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function OS(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!YI[n.type]:e==="textarea"}function GE(n,e,t,r){xE(r),e=ly(e,"onChange"),0<e.length&&(t=new fw("onChange","change",null,t,r),n.push({event:t,listeners:e}))}var mp=null,kp=null;function KI(n){eA(n,0)}function Jy(n){var e=Pd(n);if(fE(e))return n}function JI(n,e){if(n==="change")return e}var jE=!1;if(El){var q_;if(El){var X_="oninput"in document;if(!X_){var BS=document.createElement("div");BS.setAttribute("oninput","return;"),X_=typeof BS.oninput=="function"}q_=X_}else q_=!1;jE=q_&&(!document.documentMode||9<document.documentMode)}function US(){mp&&(mp.detachEvent("onpropertychange",WE),kp=mp=null)}function WE(n){if(n.propertyName==="value"&&Jy(kp)){var e=[];GE(e,kp,n,ow(n)),ME(KI,e)}}function QI(n,e,t){n==="focusin"?(US(),mp=e,kp=t,mp.attachEvent("onpropertychange",WE)):n==="focusout"&&US()}function eD(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Jy(kp)}function tD(n,e){if(n==="click")return Jy(e)}function nD(n,e){if(n==="input"||n==="change")return Jy(e)}function rD(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var lo=typeof Object.is=="function"?Object.is:rD;function Lp(n,e){if(lo(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),r=Object.keys(e);if(t.length!==r.length)return!1;for(r=0;r<t.length;r++){var i=t[r];if(!x2.call(e,i)||!lo(n[i],e[i]))return!1}return!0}function VS(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function HS(n,e){var t=VS(n);n=0;for(var r;t;){if(t.nodeType===3){if(r=n+t.textContent.length,n<=e&&r>=e)return{node:t,offset:e-n};n=r}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=VS(t)}}function $E(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?$E(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function qE(){for(var n=window,e=ty();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=ty(n.document)}return e}function gw(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function iD(n){var e=qE(),t=n.focusedElem,r=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&$E(t.ownerDocument.documentElement,t)){if(r!==null&&gw(t)){if(e=r.start,n=r.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var i=t.textContent.length,o=Math.min(r.start,i);r=r.end===void 0?o:Math.min(r.end,i),!n.extend&&o>r&&(i=r,r=o,o=i),i=HS(t,o);var u=HS(t,r);i&&u&&(n.rangeCount!==1||n.anchorNode!==i.node||n.anchorOffset!==i.offset||n.focusNode!==u.node||n.focusOffset!==u.offset)&&(e=e.createRange(),e.setStart(i.node,i.offset),n.removeAllRanges(),o>r?(n.addRange(e),n.extend(u.node,u.offset)):(e.setEnd(u.node,u.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var aD=El&&"documentMode"in document&&11>=document.documentMode,Ad=null,B2=null,gp=null,U2=!1;function GS(n,e,t){var r=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;U2||Ad==null||Ad!==ty(r)||(r=Ad,"selectionStart"in r&&gw(r)?r={start:r.selectionStart,end:r.selectionEnd}:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection(),r={anchorNode:r.anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset}),gp&&Lp(gp,r)||(gp=r,r=ly(B2,"onSelect"),0<r.length&&(e=new fw("onSelect","select",null,e,t),n.push({event:e,listeners:r}),e.target=Ad)))}function Ng(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var Cd={animationend:Ng("Animation","AnimationEnd"),animationiteration:Ng("Animation","AnimationIteration"),animationstart:Ng("Animation","AnimationStart"),transitionend:Ng("Transition","TransitionEnd")},Z_={},XE={};El&&(XE=document.createElement("div").style,"AnimationEvent"in window||(delete Cd.animationend.animation,delete Cd.animationiteration.animation,delete Cd.animationstart.animation),"TransitionEvent"in window||delete Cd.transitionend.transition);function Qy(n){if(Z_[n])return Z_[n];if(!Cd[n])return n;var e=Cd[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in XE)return Z_[n]=e[t];return n}var ZE=Qy("animationend"),YE=Qy("animationiteration"),KE=Qy("animationstart"),JE=Qy("transitionend"),QE=new Map,jS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Zc(n,e){QE.set(n,e),oh(e,[n])}for(var Y_=0;Y_<jS.length;Y_++){var K_=jS[Y_],sD=K_.toLowerCase(),oD=K_[0].toUpperCase()+K_.slice(1);Zc(sD,"on"+oD)}Zc(ZE,"onAnimationEnd");Zc(YE,"onAnimationIteration");Zc(KE,"onAnimationStart");Zc("dblclick","onDoubleClick");Zc("focusin","onFocus");Zc("focusout","onBlur");Zc(JE,"onTransitionEnd");ef("onMouseEnter",["mouseout","mouseover"]);ef("onMouseLeave",["mouseout","mouseover"]);ef("onPointerEnter",["pointerout","pointerover"]);ef("onPointerLeave",["pointerout","pointerover"]);oh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));oh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));oh("onBeforeInput",["compositionend","keypress","textInput","paste"]);oh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));oh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));oh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ap="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),lD=new Set("cancel close invalid load scroll toggle".split(" ").concat(ap));function WS(n,e,t){var r=n.type||"unknown-event";n.currentTarget=t,sI(r,e,void 0,n),n.currentTarget=null}function eA(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var r=n[t],i=r.event;r=r.listeners;e:{var o=void 0;if(e)for(var u=r.length-1;0<=u;u--){var l=r[u],p=l.instance,v=l.currentTarget;if(l=l.listener,p!==o&&i.isPropagationStopped())break e;WS(i,l,v),o=p}else for(u=0;u<r.length;u++){if(l=r[u],p=l.instance,v=l.currentTarget,l=l.listener,p!==o&&i.isPropagationStopped())break e;WS(i,l,v),o=p}}}if(ry)throw n=z2,ry=!1,z2=null,n}function Nr(n,e){var t=e[W2];t===void 0&&(t=e[W2]=new Set);var r=n+"__bubble";t.has(r)||(tA(e,n,2,!1),t.add(r))}function J_(n,e,t){var r=0;e&&(r|=4),tA(t,n,r,e)}var Og="_reactListening"+Math.random().toString(36).slice(2);function zp(n){if(!n[Og]){n[Og]=!0,lE.forEach(function(t){t!=="selectionchange"&&(lD.has(t)||J_(t,!1,n),J_(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[Og]||(e[Og]=!0,J_("selectionchange",!1,e))}}function tA(n,e,t,r){switch(OE(e)){case 1:var i=wI;break;case 4:i=SI;break;default:i=hw}t=i.bind(null,e,t,n),i=void 0,!L2||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(i=!0),r?i!==void 0?n.addEventListener(e,t,{capture:!0,passive:i}):n.addEventListener(e,t,!0):i!==void 0?n.addEventListener(e,t,{passive:i}):n.addEventListener(e,t,!1)}function Q_(n,e,t,r,i){var o=r;if(!(e&1)&&!(e&2)&&r!==null)e:for(;;){if(r===null)return;var u=r.tag;if(u===3||u===4){var l=r.stateNode.containerInfo;if(l===i||l.nodeType===8&&l.parentNode===i)break;if(u===4)for(u=r.return;u!==null;){var p=u.tag;if((p===3||p===4)&&(p=u.stateNode.containerInfo,p===i||p.nodeType===8&&p.parentNode===i))return;u=u.return}for(;l!==null;){if(u=Bu(l),u===null)return;if(p=u.tag,p===5||p===6){r=o=u;continue e}l=l.parentNode}}r=r.return}ME(function(){var v=o,x=ow(t),M=[];e:{var w=QE.get(n);if(w!==void 0){var A=fw,k=n;switch(n){case"keypress":if(N1(t)===0)break e;case"keydown":case"keyup":A=OI;break;case"focusin":k="focus",A=$_;break;case"focusout":k="blur",A=$_;break;case"beforeblur":case"afterblur":A=$_;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=kS;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=EI;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=VI;break;case ZE:case YE:case KE:A=PI;break;case JE:A=GI;break;case"scroll":A=MI;break;case"wheel":A=WI;break;case"copy":case"cut":case"paste":A=II;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=zS}var z=(e&4)!==0,D=!z&&n==="scroll",C=z?w!==null?w+"Capture":null:w;z=[];for(var U=v,B;U!==null;){B=U;var K=B.stateNode;if(B.tag===5&&K!==null&&(B=K,C!==null&&(K=Pp(U,C),K!=null&&z.push(Fp(U,K,B)))),D)break;U=U.return}0<z.length&&(w=new A(w,k,null,t,x),M.push({event:w,listeners:z}))}}if(!(e&7)){e:{if(w=n==="mouseover"||n==="pointerover",A=n==="mouseout"||n==="pointerout",w&&t!==D2&&(k=t.relatedTarget||t.fromElement)&&(Bu(k)||k[Al]))break e;if((A||w)&&(w=x.window===x?x:(w=x.ownerDocument)?w.defaultView||w.parentWindow:window,A?(k=t.relatedTarget||t.toElement,A=v,k=k?Bu(k):null,k!==null&&(D=lh(k),k!==D||k.tag!==5&&k.tag!==6)&&(k=null)):(A=null,k=v),A!==k)){if(z=kS,K="onMouseLeave",C="onMouseEnter",U="mouse",(n==="pointerout"||n==="pointerover")&&(z=zS,K="onPointerLeave",C="onPointerEnter",U="pointer"),D=A==null?w:Pd(A),B=k==null?w:Pd(k),w=new z(K,U+"leave",A,t,x),w.target=D,w.relatedTarget=B,K=null,Bu(x)===v&&(z=new z(C,U+"enter",k,t,x),z.target=B,z.relatedTarget=D,K=z),D=K,A&&k)t:{for(z=A,C=k,U=0,B=z;B;B=Xh(B))U++;for(B=0,K=C;K;K=Xh(K))B++;for(;0<U-B;)z=Xh(z),U--;for(;0<B-U;)C=Xh(C),B--;for(;U--;){if(z===C||C!==null&&z===C.alternate)break t;z=Xh(z),C=Xh(C)}z=null}else z=null;A!==null&&$S(M,w,A,z,!1),k!==null&&D!==null&&$S(M,D,k,z,!0)}}e:{if(w=v?Pd(v):window,A=w.nodeName&&w.nodeName.toLowerCase(),A==="select"||A==="input"&&w.type==="file")var ue=JI;else if(OS(w))if(jE)ue=nD;else{ue=eD;var Z=QI}else(A=w.nodeName)&&A.toLowerCase()==="input"&&(w.type==="checkbox"||w.type==="radio")&&(ue=tD);if(ue&&(ue=ue(n,v))){GE(M,ue,t,x);break e}Z&&Z(n,w,v),n==="focusout"&&(Z=w._wrapperState)&&Z.controlled&&w.type==="number"&&A2(w,"number",w.value)}switch(Z=v?Pd(v):window,n){case"focusin":(OS(Z)||Z.contentEditable==="true")&&(Ad=Z,B2=v,gp=null);break;case"focusout":gp=B2=Ad=null;break;case"mousedown":U2=!0;break;case"contextmenu":case"mouseup":case"dragend":U2=!1,GS(M,t,x);break;case"selectionchange":if(aD)break;case"keydown":case"keyup":GS(M,t,x)}var ee;if(mw)e:{switch(n){case"compositionstart":var be="onCompositionStart";break e;case"compositionend":be="onCompositionEnd";break e;case"compositionupdate":be="onCompositionUpdate";break e}be=void 0}else Ed?VE(n,t)&&(be="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(be="onCompositionStart");be&&(UE&&t.locale!=="ko"&&(Ed||be!=="onCompositionStart"?be==="onCompositionEnd"&&Ed&&(ee=BE()):(Cc=x,dw="value"in Cc?Cc.value:Cc.textContent,Ed=!0)),Z=ly(v,be),0<Z.length&&(be=new LS(be,n,null,t,x),M.push({event:be,listeners:Z}),ee?be.data=ee:(ee=HE(t),ee!==null&&(be.data=ee)))),(ee=qI?XI(n,t):ZI(n,t))&&(v=ly(v,"onBeforeInput"),0<v.length&&(x=new LS("onBeforeInput","beforeinput",null,t,x),M.push({event:x,listeners:v}),x.data=ee))}eA(M,e)})}function Fp(n,e,t){return{instance:n,listener:e,currentTarget:t}}function ly(n,e){for(var t=e+"Capture",r=[];n!==null;){var i=n,o=i.stateNode;i.tag===5&&o!==null&&(i=o,o=Pp(n,t),o!=null&&r.unshift(Fp(n,o,i)),o=Pp(n,e),o!=null&&r.push(Fp(n,o,i))),n=n.return}return r}function Xh(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function $S(n,e,t,r,i){for(var o=e._reactName,u=[];t!==null&&t!==r;){var l=t,p=l.alternate,v=l.stateNode;if(p!==null&&p===r)break;l.tag===5&&v!==null&&(l=v,i?(p=Pp(t,o),p!=null&&u.unshift(Fp(t,p,l))):i||(p=Pp(t,o),p!=null&&u.push(Fp(t,p,l)))),t=t.return}u.length!==0&&n.push({event:e,listeners:u})}var cD=/\r\n?/g,uD=/\u0000|\uFFFD/g;function qS(n){return(typeof n=="string"?n:""+n).replace(cD,`
`).replace(uD,"")}function Bg(n,e,t){if(e=qS(e),qS(n)!==e&&t)throw Error(zt(425))}function cy(){}var V2=null,H2=null;function G2(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var j2=typeof setTimeout=="function"?setTimeout:void 0,hD=typeof clearTimeout=="function"?clearTimeout:void 0,XS=typeof Promise=="function"?Promise:void 0,dD=typeof queueMicrotask=="function"?queueMicrotask:typeof XS<"u"?function(n){return XS.resolve(null).then(n).catch(fD)}:j2;function fD(n){setTimeout(function(){throw n})}function ex(n,e){var t=e,r=0;do{var i=t.nextSibling;if(n.removeChild(t),i&&i.nodeType===8)if(t=i.data,t==="/$"){if(r===0){n.removeChild(i),Dp(e);return}r--}else t!=="$"&&t!=="$?"&&t!=="$!"||r++;t=i}while(t);Dp(e)}function zc(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function ZS(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var xf=Math.random().toString(36).slice(2),To="__reactFiber$"+xf,Np="__reactProps$"+xf,Al="__reactContainer$"+xf,W2="__reactEvents$"+xf,pD="__reactListeners$"+xf,mD="__reactHandles$"+xf;function Bu(n){var e=n[To];if(e)return e;for(var t=n.parentNode;t;){if(e=t[Al]||t[To]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=ZS(n);n!==null;){if(t=n[To])return t;n=ZS(n)}return e}n=t,t=n.parentNode}return null}function om(n){return n=n[To]||n[Al],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Pd(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(zt(33))}function ev(n){return n[Np]||null}var $2=[],Rd=-1;function Yc(n){return{current:n}}function Br(n){0>Rd||(n.current=$2[Rd],$2[Rd]=null,Rd--)}function Dr(n,e){Rd++,$2[Rd]=n.current,n.current=e}var jc={},ha=Yc(jc),Ga=Yc(!1),Yu=jc;function tf(n,e){var t=n.type.contextTypes;if(!t)return jc;var r=n.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===e)return r.__reactInternalMemoizedMaskedChildContext;var i={},o;for(o in t)i[o]=e[o];return r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=i),i}function ja(n){return n=n.childContextTypes,n!=null}function uy(){Br(Ga),Br(ha)}function YS(n,e,t){if(ha.current!==jc)throw Error(zt(168));Dr(ha,e),Dr(Ga,t)}function nA(n,e,t){var r=n.stateNode;if(e=e.childContextTypes,typeof r.getChildContext!="function")return t;r=r.getChildContext();for(var i in r)if(!(i in e))throw Error(zt(108,Q9(n)||"Unknown",i));return Kr({},t,r)}function hy(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||jc,Yu=ha.current,Dr(ha,n),Dr(Ga,Ga.current),!0}function KS(n,e,t){var r=n.stateNode;if(!r)throw Error(zt(169));t?(n=nA(n,e,Yu),r.__reactInternalMemoizedMergedChildContext=n,Br(Ga),Br(ha),Dr(ha,n)):Br(Ga),Dr(Ga,t)}var gl=null,tv=!1,tx=!1;function rA(n){gl===null?gl=[n]:gl.push(n)}function gD(n){tv=!0,rA(n)}function Kc(){if(!tx&&gl!==null){tx=!0;var n=0,e=_r;try{var t=gl;for(_r=1;n<t.length;n++){var r=t[n];do r=r(!0);while(r!==null)}gl=null,tv=!1}catch(i){throw gl!==null&&(gl=gl.slice(n+1)),CE(lw,Kc),i}finally{_r=e,tx=!1}}return null}var Id=[],Dd=0,dy=null,fy=0,Es=[],As=0,Ku=null,_l=1,xl="";function ku(n,e){Id[Dd++]=fy,Id[Dd++]=dy,dy=n,fy=e}function iA(n,e,t){Es[As++]=_l,Es[As++]=xl,Es[As++]=Ku,Ku=n;var r=_l;n=xl;var i=32-so(r)-1;r&=~(1<<i),t+=1;var o=32-so(e)+i;if(30<o){var u=i-i%5;o=(r&(1<<u)-1).toString(32),r>>=u,i-=u,_l=1<<32-so(e)+i|t<<i|r,xl=o+n}else _l=1<<o|t<<i|r,xl=n}function yw(n){n.return!==null&&(ku(n,1),iA(n,1,0))}function vw(n){for(;n===dy;)dy=Id[--Dd],Id[Dd]=null,fy=Id[--Dd],Id[Dd]=null;for(;n===Ku;)Ku=Es[--As],Es[As]=null,xl=Es[--As],Es[As]=null,_l=Es[--As],Es[As]=null}var us=null,ls=null,Hr=!1,no=null;function aA(n,e){var t=Rs(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function JS(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,us=n,ls=zc(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,us=n,ls=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Ku!==null?{id:_l,overflow:xl}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=Rs(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,us=n,ls=null,!0):!1;default:return!1}}function q2(n){return(n.mode&1)!==0&&(n.flags&128)===0}function X2(n){if(Hr){var e=ls;if(e){var t=e;if(!JS(n,e)){if(q2(n))throw Error(zt(418));e=zc(t.nextSibling);var r=us;e&&JS(n,e)?aA(r,t):(n.flags=n.flags&-4097|2,Hr=!1,us=n)}}else{if(q2(n))throw Error(zt(418));n.flags=n.flags&-4097|2,Hr=!1,us=n}}}function QS(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;us=n}function Ug(n){if(n!==us)return!1;if(!Hr)return QS(n),Hr=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!G2(n.type,n.memoizedProps)),e&&(e=ls)){if(q2(n))throw sA(),Error(zt(418));for(;e;)aA(n,e),e=zc(e.nextSibling)}if(QS(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(zt(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){ls=zc(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}ls=null}}else ls=us?zc(n.stateNode.nextSibling):null;return!0}function sA(){for(var n=ls;n;)n=zc(n.nextSibling)}function nf(){ls=us=null,Hr=!1}function _w(n){no===null?no=[n]:no.push(n)}var yD=Fl.ReactCurrentBatchConfig;function Js(n,e){if(n&&n.defaultProps){e=Kr({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var py=Yc(null),my=null,kd=null,xw=null;function bw(){xw=kd=my=null}function ww(n){var e=py.current;Br(py),n._currentValue=e}function Z2(n,e,t){for(;n!==null;){var r=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,r!==null&&(r.childLanes|=e)):r!==null&&(r.childLanes&e)!==e&&(r.childLanes|=e),n===t)break;n=n.return}}function $d(n,e){my=n,xw=kd=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Va=!0),n.firstContext=null)}function Fs(n){var e=n._currentValue;if(xw!==n)if(n={context:n,memoizedValue:e,next:null},kd===null){if(my===null)throw Error(zt(308));kd=n,my.dependencies={lanes:0,firstContext:n}}else kd=kd.next=n;return e}var Uu=null;function Sw(n){Uu===null?Uu=[n]:Uu.push(n)}function oA(n,e,t,r){var i=e.interleaved;return i===null?(t.next=t,Sw(e)):(t.next=i.next,i.next=t),e.interleaved=t,Cl(n,r)}function Cl(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var Sc=!1;function Mw(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lA(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function wl(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Fc(n,e,t){var r=n.updateQueue;if(r===null)return null;if(r=r.shared,ur&2){var i=r.pending;return i===null?e.next=e:(e.next=i.next,i.next=e),r.pending=e,Cl(n,t)}return i=r.interleaved,i===null?(e.next=e,Sw(r)):(e.next=i.next,i.next=e),r.interleaved=e,Cl(n,t)}function O1(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,cw(n,t)}}function e5(n,e){var t=n.updateQueue,r=n.alternate;if(r!==null&&(r=r.updateQueue,t===r)){var i=null,o=null;if(t=t.firstBaseUpdate,t!==null){do{var u={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};o===null?i=o=u:o=o.next=u,t=t.next}while(t!==null);o===null?i=o=e:o=o.next=e}else i=o=e;t={baseState:r.baseState,firstBaseUpdate:i,lastBaseUpdate:o,shared:r.shared,effects:r.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function gy(n,e,t,r){var i=n.updateQueue;Sc=!1;var o=i.firstBaseUpdate,u=i.lastBaseUpdate,l=i.shared.pending;if(l!==null){i.shared.pending=null;var p=l,v=p.next;p.next=null,u===null?o=v:u.next=v,u=p;var x=n.alternate;x!==null&&(x=x.updateQueue,l=x.lastBaseUpdate,l!==u&&(l===null?x.firstBaseUpdate=v:l.next=v,x.lastBaseUpdate=p))}if(o!==null){var M=i.baseState;u=0,x=v=p=null,l=o;do{var w=l.lane,A=l.eventTime;if((r&w)===w){x!==null&&(x=x.next={eventTime:A,lane:0,tag:l.tag,payload:l.payload,callback:l.callback,next:null});e:{var k=n,z=l;switch(w=e,A=t,z.tag){case 1:if(k=z.payload,typeof k=="function"){M=k.call(A,M,w);break e}M=k;break e;case 3:k.flags=k.flags&-65537|128;case 0:if(k=z.payload,w=typeof k=="function"?k.call(A,M,w):k,w==null)break e;M=Kr({},M,w);break e;case 2:Sc=!0}}l.callback!==null&&l.lane!==0&&(n.flags|=64,w=i.effects,w===null?i.effects=[l]:w.push(l))}else A={eventTime:A,lane:w,tag:l.tag,payload:l.payload,callback:l.callback,next:null},x===null?(v=x=A,p=M):x=x.next=A,u|=w;if(l=l.next,l===null){if(l=i.shared.pending,l===null)break;w=l,l=w.next,w.next=null,i.lastBaseUpdate=w,i.shared.pending=null}}while(!0);if(x===null&&(p=M),i.baseState=p,i.firstBaseUpdate=v,i.lastBaseUpdate=x,e=i.shared.interleaved,e!==null){i=e;do u|=i.lane,i=i.next;while(i!==e)}else o===null&&(i.shared.lanes=0);Qu|=u,n.lanes=u,n.memoizedState=M}}function t5(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var r=n[e],i=r.callback;if(i!==null){if(r.callback=null,r=t,typeof i!="function")throw Error(zt(191,i));i.call(r)}}}var cA=new oE.Component().refs;function Y2(n,e,t,r){e=n.memoizedState,t=t(r,e),t=t==null?e:Kr({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var nv={isMounted:function(n){return(n=n._reactInternals)?lh(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var r=Aa(),i=Oc(n),o=wl(r,i);o.payload=e,t!=null&&(o.callback=t),e=Fc(n,o,i),e!==null&&(oo(e,n,i,r),O1(e,n,i))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var r=Aa(),i=Oc(n),o=wl(r,i);o.tag=1,o.payload=e,t!=null&&(o.callback=t),e=Fc(n,o,i),e!==null&&(oo(e,n,i,r),O1(e,n,i))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=Aa(),r=Oc(n),i=wl(t,r);i.tag=2,e!=null&&(i.callback=e),e=Fc(n,i,r),e!==null&&(oo(e,n,r,t),O1(e,n,r))}};function n5(n,e,t,r,i,o,u){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(r,o,u):e.prototype&&e.prototype.isPureReactComponent?!Lp(t,r)||!Lp(i,o):!0}function uA(n,e,t){var r=!1,i=jc,o=e.contextType;return typeof o=="object"&&o!==null?o=Fs(o):(i=ja(e)?Yu:ha.current,r=e.contextTypes,o=(r=r!=null)?tf(n,i):jc),e=new e(t,o),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=nv,n.stateNode=e,e._reactInternals=n,r&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=i,n.__reactInternalMemoizedMaskedChildContext=o),e}function r5(n,e,t,r){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,r),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,r),e.state!==n&&nv.enqueueReplaceState(e,e.state,null)}function K2(n,e,t,r){var i=n.stateNode;i.props=t,i.state=n.memoizedState,i.refs=cA,Mw(n);var o=e.contextType;typeof o=="object"&&o!==null?i.context=Fs(o):(o=ja(e)?Yu:ha.current,i.context=tf(n,o)),i.state=n.memoizedState,o=e.getDerivedStateFromProps,typeof o=="function"&&(Y2(n,e,o,t),i.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof i.getSnapshotBeforeUpdate=="function"||typeof i.UNSAFE_componentWillMount!="function"&&typeof i.componentWillMount!="function"||(e=i.state,typeof i.componentWillMount=="function"&&i.componentWillMount(),typeof i.UNSAFE_componentWillMount=="function"&&i.UNSAFE_componentWillMount(),e!==i.state&&nv.enqueueReplaceState(i,i.state,null),gy(n,t,i,r),i.state=n.memoizedState),typeof i.componentDidMount=="function"&&(n.flags|=4194308)}function B0(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(zt(309));var r=t.stateNode}if(!r)throw Error(zt(147,n));var i=r,o=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===o?e.ref:(e=function(u){var l=i.refs;l===cA&&(l=i.refs={}),u===null?delete l[o]:l[o]=u},e._stringRef=o,e)}if(typeof n!="string")throw Error(zt(284));if(!t._owner)throw Error(zt(290,n))}return n}function Vg(n,e){throw n=Object.prototype.toString.call(e),Error(zt(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function i5(n){var e=n._init;return e(n._payload)}function hA(n){function e(C,U){if(n){var B=C.deletions;B===null?(C.deletions=[U],C.flags|=16):B.push(U)}}function t(C,U){if(!n)return null;for(;U!==null;)e(C,U),U=U.sibling;return null}function r(C,U){for(C=new Map;U!==null;)U.key!==null?C.set(U.key,U):C.set(U.index,U),U=U.sibling;return C}function i(C,U){return C=Bc(C,U),C.index=0,C.sibling=null,C}function o(C,U,B){return C.index=B,n?(B=C.alternate,B!==null?(B=B.index,B<U?(C.flags|=2,U):B):(C.flags|=2,U)):(C.flags|=1048576,U)}function u(C){return n&&C.alternate===null&&(C.flags|=2),C}function l(C,U,B,K){return U===null||U.tag!==6?(U=lx(B,C.mode,K),U.return=C,U):(U=i(U,B),U.return=C,U)}function p(C,U,B,K){var ue=B.type;return ue===Td?x(C,U,B.props.children,K,B.key):U!==null&&(U.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===wc&&i5(ue)===U.type)?(K=i(U,B.props),K.ref=B0(C,U,B),K.return=C,K):(K=j1(B.type,B.key,B.props,null,C.mode,K),K.ref=B0(C,U,B),K.return=C,K)}function v(C,U,B,K){return U===null||U.tag!==4||U.stateNode.containerInfo!==B.containerInfo||U.stateNode.implementation!==B.implementation?(U=cx(B,C.mode,K),U.return=C,U):(U=i(U,B.children||[]),U.return=C,U)}function x(C,U,B,K,ue){return U===null||U.tag!==7?(U=Xu(B,C.mode,K,ue),U.return=C,U):(U=i(U,B),U.return=C,U)}function M(C,U,B){if(typeof U=="string"&&U!==""||typeof U=="number")return U=lx(""+U,C.mode,B),U.return=C,U;if(typeof U=="object"&&U!==null){switch(U.$$typeof){case Rg:return B=j1(U.type,U.key,U.props,null,C.mode,B),B.ref=B0(C,null,U),B.return=C,B;case Md:return U=cx(U,C.mode,B),U.return=C,U;case wc:var K=U._init;return M(C,K(U._payload),B)}if(rp(U)||L0(U))return U=Xu(U,C.mode,B,null),U.return=C,U;Vg(C,U)}return null}function w(C,U,B,K){var ue=U!==null?U.key:null;if(typeof B=="string"&&B!==""||typeof B=="number")return ue!==null?null:l(C,U,""+B,K);if(typeof B=="object"&&B!==null){switch(B.$$typeof){case Rg:return B.key===ue?p(C,U,B,K):null;case Md:return B.key===ue?v(C,U,B,K):null;case wc:return ue=B._init,w(C,U,ue(B._payload),K)}if(rp(B)||L0(B))return ue!==null?null:x(C,U,B,K,null);Vg(C,B)}return null}function A(C,U,B,K,ue){if(typeof K=="string"&&K!==""||typeof K=="number")return C=C.get(B)||null,l(U,C,""+K,ue);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case Rg:return C=C.get(K.key===null?B:K.key)||null,p(U,C,K,ue);case Md:return C=C.get(K.key===null?B:K.key)||null,v(U,C,K,ue);case wc:var Z=K._init;return A(C,U,B,Z(K._payload),ue)}if(rp(K)||L0(K))return C=C.get(B)||null,x(U,C,K,ue,null);Vg(U,K)}return null}function k(C,U,B,K){for(var ue=null,Z=null,ee=U,be=U=0,ie=null;ee!==null&&be<B.length;be++){ee.index>be?(ie=ee,ee=null):ie=ee.sibling;var Q=w(C,ee,B[be],K);if(Q===null){ee===null&&(ee=ie);break}n&&ee&&Q.alternate===null&&e(C,ee),U=o(Q,U,be),Z===null?ue=Q:Z.sibling=Q,Z=Q,ee=ie}if(be===B.length)return t(C,ee),Hr&&ku(C,be),ue;if(ee===null){for(;be<B.length;be++)ee=M(C,B[be],K),ee!==null&&(U=o(ee,U,be),Z===null?ue=ee:Z.sibling=ee,Z=ee);return Hr&&ku(C,be),ue}for(ee=r(C,ee);be<B.length;be++)ie=A(ee,C,be,B[be],K),ie!==null&&(n&&ie.alternate!==null&&ee.delete(ie.key===null?be:ie.key),U=o(ie,U,be),Z===null?ue=ie:Z.sibling=ie,Z=ie);return n&&ee.forEach(function(Ee){return e(C,Ee)}),Hr&&ku(C,be),ue}function z(C,U,B,K){var ue=L0(B);if(typeof ue!="function")throw Error(zt(150));if(B=ue.call(B),B==null)throw Error(zt(151));for(var Z=ue=null,ee=U,be=U=0,ie=null,Q=B.next();ee!==null&&!Q.done;be++,Q=B.next()){ee.index>be?(ie=ee,ee=null):ie=ee.sibling;var Ee=w(C,ee,Q.value,K);if(Ee===null){ee===null&&(ee=ie);break}n&&ee&&Ee.alternate===null&&e(C,ee),U=o(Ee,U,be),Z===null?ue=Ee:Z.sibling=Ee,Z=Ee,ee=ie}if(Q.done)return t(C,ee),Hr&&ku(C,be),ue;if(ee===null){for(;!Q.done;be++,Q=B.next())Q=M(C,Q.value,K),Q!==null&&(U=o(Q,U,be),Z===null?ue=Q:Z.sibling=Q,Z=Q);return Hr&&ku(C,be),ue}for(ee=r(C,ee);!Q.done;be++,Q=B.next())Q=A(ee,C,be,Q.value,K),Q!==null&&(n&&Q.alternate!==null&&ee.delete(Q.key===null?be:Q.key),U=o(Q,U,be),Z===null?ue=Q:Z.sibling=Q,Z=Q);return n&&ee.forEach(function(Fe){return e(C,Fe)}),Hr&&ku(C,be),ue}function D(C,U,B,K){if(typeof B=="object"&&B!==null&&B.type===Td&&B.key===null&&(B=B.props.children),typeof B=="object"&&B!==null){switch(B.$$typeof){case Rg:e:{for(var ue=B.key,Z=U;Z!==null;){if(Z.key===ue){if(ue=B.type,ue===Td){if(Z.tag===7){t(C,Z.sibling),U=i(Z,B.props.children),U.return=C,C=U;break e}}else if(Z.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===wc&&i5(ue)===Z.type){t(C,Z.sibling),U=i(Z,B.props),U.ref=B0(C,Z,B),U.return=C,C=U;break e}t(C,Z);break}else e(C,Z);Z=Z.sibling}B.type===Td?(U=Xu(B.props.children,C.mode,K,B.key),U.return=C,C=U):(K=j1(B.type,B.key,B.props,null,C.mode,K),K.ref=B0(C,U,B),K.return=C,C=K)}return u(C);case Md:e:{for(Z=B.key;U!==null;){if(U.key===Z)if(U.tag===4&&U.stateNode.containerInfo===B.containerInfo&&U.stateNode.implementation===B.implementation){t(C,U.sibling),U=i(U,B.children||[]),U.return=C,C=U;break e}else{t(C,U);break}else e(C,U);U=U.sibling}U=cx(B,C.mode,K),U.return=C,C=U}return u(C);case wc:return Z=B._init,D(C,U,Z(B._payload),K)}if(rp(B))return k(C,U,B,K);if(L0(B))return z(C,U,B,K);Vg(C,B)}return typeof B=="string"&&B!==""||typeof B=="number"?(B=""+B,U!==null&&U.tag===6?(t(C,U.sibling),U=i(U,B),U.return=C,C=U):(t(C,U),U=lx(B,C.mode,K),U.return=C,C=U),u(C)):t(C,U)}return D}var rf=hA(!0),dA=hA(!1),lm={},ko=Yc(lm),Op=Yc(lm),Bp=Yc(lm);function Vu(n){if(n===lm)throw Error(zt(174));return n}function Tw(n,e){switch(Dr(Bp,e),Dr(Op,n),Dr(ko,lm),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:P2(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=P2(e,n)}Br(ko),Dr(ko,e)}function af(){Br(ko),Br(Op),Br(Bp)}function fA(n){Vu(Bp.current);var e=Vu(ko.current),t=P2(e,n.type);e!==t&&(Dr(Op,n),Dr(ko,t))}function Ew(n){Op.current===n&&(Br(ko),Br(Op))}var Xr=Yc(0);function yy(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var nx=[];function Aw(){for(var n=0;n<nx.length;n++)nx[n]._workInProgressVersionPrimary=null;nx.length=0}var B1=Fl.ReactCurrentDispatcher,rx=Fl.ReactCurrentBatchConfig,Ju=0,Yr=null,Si=null,Li=null,vy=!1,yp=!1,Up=0,vD=0;function ra(){throw Error(zt(321))}function Cw(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!lo(n[t],e[t]))return!1;return!0}function Pw(n,e,t,r,i,o){if(Ju=o,Yr=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,B1.current=n===null||n.memoizedState===null?wD:SD,n=t(r,i),yp){o=0;do{if(yp=!1,Up=0,25<=o)throw Error(zt(301));o+=1,Li=Si=null,e.updateQueue=null,B1.current=MD,n=t(r,i)}while(yp)}if(B1.current=_y,e=Si!==null&&Si.next!==null,Ju=0,Li=Si=Yr=null,vy=!1,e)throw Error(zt(300));return n}function Rw(){var n=Up!==0;return Up=0,n}function bo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Li===null?Yr.memoizedState=Li=n:Li=Li.next=n,Li}function Ns(){if(Si===null){var n=Yr.alternate;n=n!==null?n.memoizedState:null}else n=Si.next;var e=Li===null?Yr.memoizedState:Li.next;if(e!==null)Li=e,Si=n;else{if(n===null)throw Error(zt(310));Si=n,n={memoizedState:Si.memoizedState,baseState:Si.baseState,baseQueue:Si.baseQueue,queue:Si.queue,next:null},Li===null?Yr.memoizedState=Li=n:Li=Li.next=n}return Li}function Vp(n,e){return typeof e=="function"?e(n):e}function ix(n){var e=Ns(),t=e.queue;if(t===null)throw Error(zt(311));t.lastRenderedReducer=n;var r=Si,i=r.baseQueue,o=t.pending;if(o!==null){if(i!==null){var u=i.next;i.next=o.next,o.next=u}r.baseQueue=i=o,t.pending=null}if(i!==null){o=i.next,r=r.baseState;var l=u=null,p=null,v=o;do{var x=v.lane;if((Ju&x)===x)p!==null&&(p=p.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),r=v.hasEagerState?v.eagerState:n(r,v.action);else{var M={lane:x,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};p===null?(l=p=M,u=r):p=p.next=M,Yr.lanes|=x,Qu|=x}v=v.next}while(v!==null&&v!==o);p===null?u=r:p.next=l,lo(r,e.memoizedState)||(Va=!0),e.memoizedState=r,e.baseState=u,e.baseQueue=p,t.lastRenderedState=r}if(n=t.interleaved,n!==null){i=n;do o=i.lane,Yr.lanes|=o,Qu|=o,i=i.next;while(i!==n)}else i===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function ax(n){var e=Ns(),t=e.queue;if(t===null)throw Error(zt(311));t.lastRenderedReducer=n;var r=t.dispatch,i=t.pending,o=e.memoizedState;if(i!==null){t.pending=null;var u=i=i.next;do o=n(o,u.action),u=u.next;while(u!==i);lo(o,e.memoizedState)||(Va=!0),e.memoizedState=o,e.baseQueue===null&&(e.baseState=o),t.lastRenderedState=o}return[o,r]}function pA(){}function mA(n,e){var t=Yr,r=Ns(),i=e(),o=!lo(r.memoizedState,i);if(o&&(r.memoizedState=i,Va=!0),r=r.queue,Iw(vA.bind(null,t,r,n),[n]),r.getSnapshot!==e||o||Li!==null&&Li.memoizedState.tag&1){if(t.flags|=2048,Hp(9,yA.bind(null,t,r,i,e),void 0,null),Fi===null)throw Error(zt(349));Ju&30||gA(t,e,i)}return i}function gA(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Yr.updateQueue,e===null?(e={lastEffect:null,stores:null},Yr.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function yA(n,e,t,r){e.value=t,e.getSnapshot=r,_A(e)&&xA(n)}function vA(n,e,t){return t(function(){_A(e)&&xA(n)})}function _A(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!lo(n,t)}catch{return!0}}function xA(n){var e=Cl(n,1);e!==null&&oo(e,n,1,-1)}function a5(n){var e=bo();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Vp,lastRenderedState:n},e.queue=n,n=n.dispatch=bD.bind(null,Yr,n),[e.memoizedState,n]}function Hp(n,e,t,r){return n={tag:n,create:e,destroy:t,deps:r,next:null},e=Yr.updateQueue,e===null?(e={lastEffect:null,stores:null},Yr.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(r=t.next,t.next=n,n.next=r,e.lastEffect=n)),n}function bA(){return Ns().memoizedState}function U1(n,e,t,r){var i=bo();Yr.flags|=n,i.memoizedState=Hp(1|e,t,void 0,r===void 0?null:r)}function rv(n,e,t,r){var i=Ns();r=r===void 0?null:r;var o=void 0;if(Si!==null){var u=Si.memoizedState;if(o=u.destroy,r!==null&&Cw(r,u.deps)){i.memoizedState=Hp(e,t,o,r);return}}Yr.flags|=n,i.memoizedState=Hp(1|e,t,o,r)}function s5(n,e){return U1(8390656,8,n,e)}function Iw(n,e){return rv(2048,8,n,e)}function wA(n,e){return rv(4,2,n,e)}function SA(n,e){return rv(4,4,n,e)}function MA(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function TA(n,e,t){return t=t!=null?t.concat([n]):null,rv(4,4,MA.bind(null,e,n),t)}function Dw(){}function EA(n,e){var t=Ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Cw(e,r[1])?r[0]:(t.memoizedState=[n,e],n)}function AA(n,e){var t=Ns();e=e===void 0?null:e;var r=t.memoizedState;return r!==null&&e!==null&&Cw(e,r[1])?r[0]:(n=n(),t.memoizedState=[n,e],n)}function CA(n,e,t){return Ju&21?(lo(t,e)||(t=IE(),Yr.lanes|=t,Qu|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Va=!0),n.memoizedState=t)}function _D(n,e){var t=_r;_r=t!==0&&4>t?t:4,n(!0);var r=rx.transition;rx.transition={};try{n(!1),e()}finally{_r=t,rx.transition=r}}function PA(){return Ns().memoizedState}function xD(n,e,t){var r=Oc(n);if(t={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null},RA(n))IA(e,t);else if(t=oA(n,e,t,r),t!==null){var i=Aa();oo(t,n,r,i),DA(t,e,r)}}function bD(n,e,t){var r=Oc(n),i={lane:r,action:t,hasEagerState:!1,eagerState:null,next:null};if(RA(n))IA(e,i);else{var o=n.alternate;if(n.lanes===0&&(o===null||o.lanes===0)&&(o=e.lastRenderedReducer,o!==null))try{var u=e.lastRenderedState,l=o(u,t);if(i.hasEagerState=!0,i.eagerState=l,lo(l,u)){var p=e.interleaved;p===null?(i.next=i,Sw(e)):(i.next=p.next,p.next=i),e.interleaved=i;return}}catch{}finally{}t=oA(n,e,i,r),t!==null&&(i=Aa(),oo(t,n,r,i),DA(t,e,r))}}function RA(n){var e=n.alternate;return n===Yr||e!==null&&e===Yr}function IA(n,e){yp=vy=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function DA(n,e,t){if(t&4194240){var r=e.lanes;r&=n.pendingLanes,t|=r,e.lanes=t,cw(n,t)}}var _y={readContext:Fs,useCallback:ra,useContext:ra,useEffect:ra,useImperativeHandle:ra,useInsertionEffect:ra,useLayoutEffect:ra,useMemo:ra,useReducer:ra,useRef:ra,useState:ra,useDebugValue:ra,useDeferredValue:ra,useTransition:ra,useMutableSource:ra,useSyncExternalStore:ra,useId:ra,unstable_isNewReconciler:!1},wD={readContext:Fs,useCallback:function(n,e){return bo().memoizedState=[n,e===void 0?null:e],n},useContext:Fs,useEffect:s5,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,U1(4194308,4,MA.bind(null,e,n),t)},useLayoutEffect:function(n,e){return U1(4194308,4,n,e)},useInsertionEffect:function(n,e){return U1(4,2,n,e)},useMemo:function(n,e){var t=bo();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var r=bo();return e=t!==void 0?t(e):e,r.memoizedState=r.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},r.queue=n,n=n.dispatch=xD.bind(null,Yr,n),[r.memoizedState,n]},useRef:function(n){var e=bo();return n={current:n},e.memoizedState=n},useState:a5,useDebugValue:Dw,useDeferredValue:function(n){return bo().memoizedState=n},useTransition:function(){var n=a5(!1),e=n[0];return n=_D.bind(null,n[1]),bo().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var r=Yr,i=bo();if(Hr){if(t===void 0)throw Error(zt(407));t=t()}else{if(t=e(),Fi===null)throw Error(zt(349));Ju&30||gA(r,e,t)}i.memoizedState=t;var o={value:t,getSnapshot:e};return i.queue=o,s5(vA.bind(null,r,o,n),[n]),r.flags|=2048,Hp(9,yA.bind(null,r,o,t,e),void 0,null),t},useId:function(){var n=bo(),e=Fi.identifierPrefix;if(Hr){var t=xl,r=_l;t=(r&~(1<<32-so(r)-1)).toString(32)+t,e=":"+e+"R"+t,t=Up++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=vD++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},SD={readContext:Fs,useCallback:EA,useContext:Fs,useEffect:Iw,useImperativeHandle:TA,useInsertionEffect:wA,useLayoutEffect:SA,useMemo:AA,useReducer:ix,useRef:bA,useState:function(){return ix(Vp)},useDebugValue:Dw,useDeferredValue:function(n){var e=Ns();return CA(e,Si.memoizedState,n)},useTransition:function(){var n=ix(Vp)[0],e=Ns().memoizedState;return[n,e]},useMutableSource:pA,useSyncExternalStore:mA,useId:PA,unstable_isNewReconciler:!1},MD={readContext:Fs,useCallback:EA,useContext:Fs,useEffect:Iw,useImperativeHandle:TA,useInsertionEffect:wA,useLayoutEffect:SA,useMemo:AA,useReducer:ax,useRef:bA,useState:function(){return ax(Vp)},useDebugValue:Dw,useDeferredValue:function(n){var e=Ns();return Si===null?e.memoizedState=n:CA(e,Si.memoizedState,n)},useTransition:function(){var n=ax(Vp)[0],e=Ns().memoizedState;return[n,e]},useMutableSource:pA,useSyncExternalStore:mA,useId:PA,unstable_isNewReconciler:!1};function sf(n,e){try{var t="",r=e;do t+=J9(r),r=r.return;while(r);var i=t}catch(o){i=`
Error generating stack: `+o.message+`
`+o.stack}return{value:n,source:e,stack:i,digest:null}}function sx(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function J2(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var TD=typeof WeakMap=="function"?WeakMap:Map;function kA(n,e,t){t=wl(-1,t),t.tag=3,t.payload={element:null};var r=e.value;return t.callback=function(){by||(by=!0,lb=r),J2(n,e)},t}function LA(n,e,t){t=wl(-1,t),t.tag=3;var r=n.type.getDerivedStateFromError;if(typeof r=="function"){var i=e.value;t.payload=function(){return r(i)},t.callback=function(){J2(n,e)}}var o=n.stateNode;return o!==null&&typeof o.componentDidCatch=="function"&&(t.callback=function(){J2(n,e),typeof r!="function"&&(Nc===null?Nc=new Set([this]):Nc.add(this));var u=e.stack;this.componentDidCatch(e.value,{componentStack:u!==null?u:""})}),t}function o5(n,e,t){var r=n.pingCache;if(r===null){r=n.pingCache=new TD;var i=new Set;r.set(e,i)}else i=r.get(e),i===void 0&&(i=new Set,r.set(e,i));i.has(t)||(i.add(t),n=BD.bind(null,n,e,t),e.then(n,n))}function l5(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function c5(n,e,t,r,i){return n.mode&1?(n.flags|=65536,n.lanes=i,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=wl(-1,1),e.tag=2,Fc(t,e,1))),t.lanes|=1),n)}var ED=Fl.ReactCurrentOwner,Va=!1;function Ta(n,e,t,r){e.child=n===null?dA(e,null,t,r):rf(e,n.child,t,r)}function u5(n,e,t,r,i){t=t.render;var o=e.ref;return $d(e,i),r=Pw(n,e,t,r,o,i),t=Rw(),n!==null&&!Va?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Pl(n,e,i)):(Hr&&t&&yw(e),e.flags|=1,Ta(n,e,r,i),e.child)}function h5(n,e,t,r,i){if(n===null){var o=t.type;return typeof o=="function"&&!Uw(o)&&o.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=o,zA(n,e,o,r,i)):(n=j1(t.type,null,r,e,e.mode,i),n.ref=e.ref,n.return=e,e.child=n)}if(o=n.child,!(n.lanes&i)){var u=o.memoizedProps;if(t=t.compare,t=t!==null?t:Lp,t(u,r)&&n.ref===e.ref)return Pl(n,e,i)}return e.flags|=1,n=Bc(o,r),n.ref=e.ref,n.return=e,e.child=n}function zA(n,e,t,r,i){if(n!==null){var o=n.memoizedProps;if(Lp(o,r)&&n.ref===e.ref)if(Va=!1,e.pendingProps=r=o,(n.lanes&i)!==0)n.flags&131072&&(Va=!0);else return e.lanes=n.lanes,Pl(n,e,i)}return Q2(n,e,t,r,i)}function FA(n,e,t){var r=e.pendingProps,i=r.children,o=n!==null?n.memoizedState:null;if(r.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},Dr(zd,ss),ss|=t;else{if(!(t&1073741824))return n=o!==null?o.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,Dr(zd,ss),ss|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=o!==null?o.baseLanes:t,Dr(zd,ss),ss|=r}else o!==null?(r=o.baseLanes|t,e.memoizedState=null):r=t,Dr(zd,ss),ss|=r;return Ta(n,e,i,t),e.child}function NA(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function Q2(n,e,t,r,i){var o=ja(t)?Yu:ha.current;return o=tf(e,o),$d(e,i),t=Pw(n,e,t,r,o,i),r=Rw(),n!==null&&!Va?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~i,Pl(n,e,i)):(Hr&&r&&yw(e),e.flags|=1,Ta(n,e,t,i),e.child)}function d5(n,e,t,r,i){if(ja(t)){var o=!0;hy(e)}else o=!1;if($d(e,i),e.stateNode===null)V1(n,e),uA(e,t,r),K2(e,t,r,i),r=!0;else if(n===null){var u=e.stateNode,l=e.memoizedProps;u.props=l;var p=u.context,v=t.contextType;typeof v=="object"&&v!==null?v=Fs(v):(v=ja(t)?Yu:ha.current,v=tf(e,v));var x=t.getDerivedStateFromProps,M=typeof x=="function"||typeof u.getSnapshotBeforeUpdate=="function";M||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(l!==r||p!==v)&&r5(e,u,r,v),Sc=!1;var w=e.memoizedState;u.state=w,gy(e,r,u,i),p=e.memoizedState,l!==r||w!==p||Ga.current||Sc?(typeof x=="function"&&(Y2(e,t,x,r),p=e.memoizedState),(l=Sc||n5(e,t,l,r,w,p,v))?(M||typeof u.UNSAFE_componentWillMount!="function"&&typeof u.componentWillMount!="function"||(typeof u.componentWillMount=="function"&&u.componentWillMount(),typeof u.UNSAFE_componentWillMount=="function"&&u.UNSAFE_componentWillMount()),typeof u.componentDidMount=="function"&&(e.flags|=4194308)):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=r,e.memoizedState=p),u.props=r,u.state=p,u.context=v,r=l):(typeof u.componentDidMount=="function"&&(e.flags|=4194308),r=!1)}else{u=e.stateNode,lA(n,e),l=e.memoizedProps,v=e.type===e.elementType?l:Js(e.type,l),u.props=v,M=e.pendingProps,w=u.context,p=t.contextType,typeof p=="object"&&p!==null?p=Fs(p):(p=ja(t)?Yu:ha.current,p=tf(e,p));var A=t.getDerivedStateFromProps;(x=typeof A=="function"||typeof u.getSnapshotBeforeUpdate=="function")||typeof u.UNSAFE_componentWillReceiveProps!="function"&&typeof u.componentWillReceiveProps!="function"||(l!==M||w!==p)&&r5(e,u,r,p),Sc=!1,w=e.memoizedState,u.state=w,gy(e,r,u,i);var k=e.memoizedState;l!==M||w!==k||Ga.current||Sc?(typeof A=="function"&&(Y2(e,t,A,r),k=e.memoizedState),(v=Sc||n5(e,t,v,r,w,k,p)||!1)?(x||typeof u.UNSAFE_componentWillUpdate!="function"&&typeof u.componentWillUpdate!="function"||(typeof u.componentWillUpdate=="function"&&u.componentWillUpdate(r,k,p),typeof u.UNSAFE_componentWillUpdate=="function"&&u.UNSAFE_componentWillUpdate(r,k,p)),typeof u.componentDidUpdate=="function"&&(e.flags|=4),typeof u.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof u.componentDidUpdate!="function"||l===n.memoizedProps&&w===n.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&w===n.memoizedState||(e.flags|=1024),e.memoizedProps=r,e.memoizedState=k),u.props=r,u.state=k,u.context=p,r=v):(typeof u.componentDidUpdate!="function"||l===n.memoizedProps&&w===n.memoizedState||(e.flags|=4),typeof u.getSnapshotBeforeUpdate!="function"||l===n.memoizedProps&&w===n.memoizedState||(e.flags|=1024),r=!1)}return eb(n,e,t,r,o,i)}function eb(n,e,t,r,i,o){NA(n,e);var u=(e.flags&128)!==0;if(!r&&!u)return i&&KS(e,t,!1),Pl(n,e,o);r=e.stateNode,ED.current=e;var l=u&&typeof t.getDerivedStateFromError!="function"?null:r.render();return e.flags|=1,n!==null&&u?(e.child=rf(e,n.child,null,o),e.child=rf(e,null,l,o)):Ta(n,e,l,o),e.memoizedState=r.state,i&&KS(e,t,!0),e.child}function OA(n){var e=n.stateNode;e.pendingContext?YS(n,e.pendingContext,e.pendingContext!==e.context):e.context&&YS(n,e.context,!1),Tw(n,e.containerInfo)}function f5(n,e,t,r,i){return nf(),_w(i),e.flags|=256,Ta(n,e,t,r),e.child}var tb={dehydrated:null,treeContext:null,retryLane:0};function nb(n){return{baseLanes:n,cachePool:null,transitions:null}}function BA(n,e,t){var r=e.pendingProps,i=Xr.current,o=!1,u=(e.flags&128)!==0,l;if((l=u)||(l=n!==null&&n.memoizedState===null?!1:(i&2)!==0),l?(o=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(i|=1),Dr(Xr,i&1),n===null)return X2(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(u=r.children,n=r.fallback,o?(r=e.mode,o=e.child,u={mode:"hidden",children:u},!(r&1)&&o!==null?(o.childLanes=0,o.pendingProps=u):o=sv(u,r,0,null),n=Xu(n,r,t,null),o.return=e,n.return=e,o.sibling=n,e.child=o,e.child.memoizedState=nb(t),e.memoizedState=tb,n):kw(e,u));if(i=n.memoizedState,i!==null&&(l=i.dehydrated,l!==null))return AD(n,e,u,r,l,i,t);if(o){o=r.fallback,u=e.mode,i=n.child,l=i.sibling;var p={mode:"hidden",children:r.children};return!(u&1)&&e.child!==i?(r=e.child,r.childLanes=0,r.pendingProps=p,e.deletions=null):(r=Bc(i,p),r.subtreeFlags=i.subtreeFlags&14680064),l!==null?o=Bc(l,o):(o=Xu(o,u,t,null),o.flags|=2),o.return=e,r.return=e,r.sibling=o,e.child=r,r=o,o=e.child,u=n.child.memoizedState,u=u===null?nb(t):{baseLanes:u.baseLanes|t,cachePool:null,transitions:u.transitions},o.memoizedState=u,o.childLanes=n.childLanes&~t,e.memoizedState=tb,r}return o=n.child,n=o.sibling,r=Bc(o,{mode:"visible",children:r.children}),!(e.mode&1)&&(r.lanes=t),r.return=e,r.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=r,e.memoizedState=null,r}function kw(n,e){return e=sv({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function Hg(n,e,t,r){return r!==null&&_w(r),rf(e,n.child,null,t),n=kw(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function AD(n,e,t,r,i,o,u){if(t)return e.flags&256?(e.flags&=-257,r=sx(Error(zt(422))),Hg(n,e,u,r)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(o=r.fallback,i=e.mode,r=sv({mode:"visible",children:r.children},i,0,null),o=Xu(o,i,u,null),o.flags|=2,r.return=e,o.return=e,r.sibling=o,e.child=r,e.mode&1&&rf(e,n.child,null,u),e.child.memoizedState=nb(u),e.memoizedState=tb,o);if(!(e.mode&1))return Hg(n,e,u,null);if(i.data==="$!"){if(r=i.nextSibling&&i.nextSibling.dataset,r)var l=r.dgst;return r=l,o=Error(zt(419)),r=sx(o,r,void 0),Hg(n,e,u,r)}if(l=(u&n.childLanes)!==0,Va||l){if(r=Fi,r!==null){switch(u&-u){case 4:i=2;break;case 16:i=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:i=32;break;case 536870912:i=268435456;break;default:i=0}i=i&(r.suspendedLanes|u)?0:i,i!==0&&i!==o.retryLane&&(o.retryLane=i,Cl(n,i),oo(r,n,i,-1))}return Bw(),r=sx(Error(zt(421))),Hg(n,e,u,r)}return i.data==="$?"?(e.flags|=128,e.child=n.child,e=UD.bind(null,n),i._reactRetry=e,null):(n=o.treeContext,ls=zc(i.nextSibling),us=e,Hr=!0,no=null,n!==null&&(Es[As++]=_l,Es[As++]=xl,Es[As++]=Ku,_l=n.id,xl=n.overflow,Ku=e),e=kw(e,r.children),e.flags|=4096,e)}function p5(n,e,t){n.lanes|=e;var r=n.alternate;r!==null&&(r.lanes|=e),Z2(n.return,e,t)}function ox(n,e,t,r,i){var o=n.memoizedState;o===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:r,tail:t,tailMode:i}:(o.isBackwards=e,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=t,o.tailMode=i)}function UA(n,e,t){var r=e.pendingProps,i=r.revealOrder,o=r.tail;if(Ta(n,e,r.children,t),r=Xr.current,r&2)r=r&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&p5(n,t,e);else if(n.tag===19)p5(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}r&=1}if(Dr(Xr,r),!(e.mode&1))e.memoizedState=null;else switch(i){case"forwards":for(t=e.child,i=null;t!==null;)n=t.alternate,n!==null&&yy(n)===null&&(i=t),t=t.sibling;t=i,t===null?(i=e.child,e.child=null):(i=t.sibling,t.sibling=null),ox(e,!1,i,t,o);break;case"backwards":for(t=null,i=e.child,e.child=null;i!==null;){if(n=i.alternate,n!==null&&yy(n)===null){e.child=i;break}n=i.sibling,i.sibling=t,t=i,i=n}ox(e,!0,t,null,o);break;case"together":ox(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function V1(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function Pl(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Qu|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(zt(153));if(e.child!==null){for(n=e.child,t=Bc(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Bc(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function CD(n,e,t){switch(e.tag){case 3:OA(e),nf();break;case 5:fA(e);break;case 1:ja(e.type)&&hy(e);break;case 4:Tw(e,e.stateNode.containerInfo);break;case 10:var r=e.type._context,i=e.memoizedProps.value;Dr(py,r._currentValue),r._currentValue=i;break;case 13:if(r=e.memoizedState,r!==null)return r.dehydrated!==null?(Dr(Xr,Xr.current&1),e.flags|=128,null):t&e.child.childLanes?BA(n,e,t):(Dr(Xr,Xr.current&1),n=Pl(n,e,t),n!==null?n.sibling:null);Dr(Xr,Xr.current&1);break;case 19:if(r=(t&e.childLanes)!==0,n.flags&128){if(r)return UA(n,e,t);e.flags|=128}if(i=e.memoizedState,i!==null&&(i.rendering=null,i.tail=null,i.lastEffect=null),Dr(Xr,Xr.current),r)break;return null;case 22:case 23:return e.lanes=0,FA(n,e,t)}return Pl(n,e,t)}var VA,rb,HA,GA;VA=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};rb=function(){};HA=function(n,e,t,r){var i=n.memoizedProps;if(i!==r){n=e.stateNode,Vu(ko.current);var o=null;switch(t){case"input":i=T2(n,i),r=T2(n,r),o=[];break;case"select":i=Kr({},i,{value:void 0}),r=Kr({},r,{value:void 0}),o=[];break;case"textarea":i=C2(n,i),r=C2(n,r),o=[];break;default:typeof i.onClick!="function"&&typeof r.onClick=="function"&&(n.onclick=cy)}R2(t,r);var u;t=null;for(v in i)if(!r.hasOwnProperty(v)&&i.hasOwnProperty(v)&&i[v]!=null)if(v==="style"){var l=i[v];for(u in l)l.hasOwnProperty(u)&&(t||(t={}),t[u]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Ap.hasOwnProperty(v)?o||(o=[]):(o=o||[]).push(v,null));for(v in r){var p=r[v];if(l=i!=null?i[v]:void 0,r.hasOwnProperty(v)&&p!==l&&(p!=null||l!=null))if(v==="style")if(l){for(u in l)!l.hasOwnProperty(u)||p&&p.hasOwnProperty(u)||(t||(t={}),t[u]="");for(u in p)p.hasOwnProperty(u)&&l[u]!==p[u]&&(t||(t={}),t[u]=p[u])}else t||(o||(o=[]),o.push(v,t)),t=p;else v==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,l=l?l.__html:void 0,p!=null&&l!==p&&(o=o||[]).push(v,p)):v==="children"?typeof p!="string"&&typeof p!="number"||(o=o||[]).push(v,""+p):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(Ap.hasOwnProperty(v)?(p!=null&&v==="onScroll"&&Nr("scroll",n),o||l===p||(o=[])):(o=o||[]).push(v,p))}t&&(o=o||[]).push("style",t);var v=o;(e.updateQueue=v)&&(e.flags|=4)}};GA=function(n,e,t,r){t!==r&&(e.flags|=4)};function U0(n,e){if(!Hr)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var r=null;t!==null;)t.alternate!==null&&(r=t),t=t.sibling;r===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:r.sibling=null}}function ia(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,r=0;if(e)for(var i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags&14680064,r|=i.flags&14680064,i.return=n,i=i.sibling;else for(i=n.child;i!==null;)t|=i.lanes|i.childLanes,r|=i.subtreeFlags,r|=i.flags,i.return=n,i=i.sibling;return n.subtreeFlags|=r,n.childLanes=t,e}function PD(n,e,t){var r=e.pendingProps;switch(vw(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return ia(e),null;case 1:return ja(e.type)&&uy(),ia(e),null;case 3:return r=e.stateNode,af(),Br(Ga),Br(ha),Aw(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),(n===null||n.child===null)&&(Ug(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,no!==null&&(hb(no),no=null))),rb(n,e),ia(e),null;case 5:Ew(e);var i=Vu(Bp.current);if(t=e.type,n!==null&&e.stateNode!=null)HA(n,e,t,r,i),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!r){if(e.stateNode===null)throw Error(zt(166));return ia(e),null}if(n=Vu(ko.current),Ug(e)){r=e.stateNode,t=e.type;var o=e.memoizedProps;switch(r[To]=e,r[Np]=o,n=(e.mode&1)!==0,t){case"dialog":Nr("cancel",r),Nr("close",r);break;case"iframe":case"object":case"embed":Nr("load",r);break;case"video":case"audio":for(i=0;i<ap.length;i++)Nr(ap[i],r);break;case"source":Nr("error",r);break;case"img":case"image":case"link":Nr("error",r),Nr("load",r);break;case"details":Nr("toggle",r);break;case"input":SS(r,o),Nr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Nr("invalid",r);break;case"textarea":TS(r,o),Nr("invalid",r)}R2(t,o),i=null;for(var u in o)if(o.hasOwnProperty(u)){var l=o[u];u==="children"?typeof l=="string"?r.textContent!==l&&(o.suppressHydrationWarning!==!0&&Bg(r.textContent,l,n),i=["children",l]):typeof l=="number"&&r.textContent!==""+l&&(o.suppressHydrationWarning!==!0&&Bg(r.textContent,l,n),i=["children",""+l]):Ap.hasOwnProperty(u)&&l!=null&&u==="onScroll"&&Nr("scroll",r)}switch(t){case"input":Ig(r),MS(r,o,!0);break;case"textarea":Ig(r),ES(r);break;case"select":case"option":break;default:typeof o.onClick=="function"&&(r.onclick=cy)}r=i,e.updateQueue=r,r!==null&&(e.flags|=4)}else{u=i.nodeType===9?i:i.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=gE(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=u.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof r.is=="string"?n=u.createElement(t,{is:r.is}):(n=u.createElement(t),t==="select"&&(u=n,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):n=u.createElementNS(n,t),n[To]=e,n[Np]=r,VA(n,e,!1,!1),e.stateNode=n;e:{switch(u=I2(t,r),t){case"dialog":Nr("cancel",n),Nr("close",n),i=r;break;case"iframe":case"object":case"embed":Nr("load",n),i=r;break;case"video":case"audio":for(i=0;i<ap.length;i++)Nr(ap[i],n);i=r;break;case"source":Nr("error",n),i=r;break;case"img":case"image":case"link":Nr("error",n),Nr("load",n),i=r;break;case"details":Nr("toggle",n),i=r;break;case"input":SS(n,r),i=T2(n,r),Nr("invalid",n);break;case"option":i=r;break;case"select":n._wrapperState={wasMultiple:!!r.multiple},i=Kr({},r,{value:void 0}),Nr("invalid",n);break;case"textarea":TS(n,r),i=C2(n,r),Nr("invalid",n);break;default:i=r}R2(t,i),l=i;for(o in l)if(l.hasOwnProperty(o)){var p=l[o];o==="style"?_E(n,p):o==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&yE(n,p)):o==="children"?typeof p=="string"?(t!=="textarea"||p!=="")&&Cp(n,p):typeof p=="number"&&Cp(n,""+p):o!=="suppressContentEditableWarning"&&o!=="suppressHydrationWarning"&&o!=="autoFocus"&&(Ap.hasOwnProperty(o)?p!=null&&o==="onScroll"&&Nr("scroll",n):p!=null&&rw(n,o,p,u))}switch(t){case"input":Ig(n),MS(n,r,!1);break;case"textarea":Ig(n),ES(n);break;case"option":r.value!=null&&n.setAttribute("value",""+Gc(r.value));break;case"select":n.multiple=!!r.multiple,o=r.value,o!=null?Hd(n,!!r.multiple,o,!1):r.defaultValue!=null&&Hd(n,!!r.multiple,r.defaultValue,!0);break;default:typeof i.onClick=="function"&&(n.onclick=cy)}switch(t){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return ia(e),null;case 6:if(n&&e.stateNode!=null)GA(n,e,n.memoizedProps,r);else{if(typeof r!="string"&&e.stateNode===null)throw Error(zt(166));if(t=Vu(Bp.current),Vu(ko.current),Ug(e)){if(r=e.stateNode,t=e.memoizedProps,r[To]=e,(o=r.nodeValue!==t)&&(n=us,n!==null))switch(n.tag){case 3:Bg(r.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Bg(r.nodeValue,t,(n.mode&1)!==0)}o&&(e.flags|=4)}else r=(t.nodeType===9?t:t.ownerDocument).createTextNode(r),r[To]=e,e.stateNode=r}return ia(e),null;case 13:if(Br(Xr),r=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Hr&&ls!==null&&e.mode&1&&!(e.flags&128))sA(),nf(),e.flags|=98560,o=!1;else if(o=Ug(e),r!==null&&r.dehydrated!==null){if(n===null){if(!o)throw Error(zt(318));if(o=e.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(zt(317));o[To]=e}else nf(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;ia(e),o=!1}else no!==null&&(hb(no),no=null),o=!0;if(!o)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(r=r!==null,r!==(n!==null&&n.memoizedState!==null)&&r&&(e.child.flags|=8192,e.mode&1&&(n===null||Xr.current&1?Mi===0&&(Mi=3):Bw())),e.updateQueue!==null&&(e.flags|=4),ia(e),null);case 4:return af(),rb(n,e),n===null&&zp(e.stateNode.containerInfo),ia(e),null;case 10:return ww(e.type._context),ia(e),null;case 17:return ja(e.type)&&uy(),ia(e),null;case 19:if(Br(Xr),o=e.memoizedState,o===null)return ia(e),null;if(r=(e.flags&128)!==0,u=o.rendering,u===null)if(r)U0(o,!1);else{if(Mi!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(u=yy(n),u!==null){for(e.flags|=128,U0(o,!1),r=u.updateQueue,r!==null&&(e.updateQueue=r,e.flags|=4),e.subtreeFlags=0,r=t,t=e.child;t!==null;)o=t,n=r,o.flags&=14680066,u=o.alternate,u===null?(o.childLanes=0,o.lanes=n,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,n=u.dependencies,o.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return Dr(Xr,Xr.current&1|2),e.child}n=n.sibling}o.tail!==null&&pi()>of&&(e.flags|=128,r=!0,U0(o,!1),e.lanes=4194304)}else{if(!r)if(n=yy(u),n!==null){if(e.flags|=128,r=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),U0(o,!0),o.tail===null&&o.tailMode==="hidden"&&!u.alternate&&!Hr)return ia(e),null}else 2*pi()-o.renderingStartTime>of&&t!==1073741824&&(e.flags|=128,r=!0,U0(o,!1),e.lanes=4194304);o.isBackwards?(u.sibling=e.child,e.child=u):(t=o.last,t!==null?t.sibling=u:e.child=u,o.last=u)}return o.tail!==null?(e=o.tail,o.rendering=e,o.tail=e.sibling,o.renderingStartTime=pi(),e.sibling=null,t=Xr.current,Dr(Xr,r?t&1|2:t&1),e):(ia(e),null);case 22:case 23:return Ow(),r=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==r&&(e.flags|=8192),r&&e.mode&1?ss&1073741824&&(ia(e),e.subtreeFlags&6&&(e.flags|=8192)):ia(e),null;case 24:return null;case 25:return null}throw Error(zt(156,e.tag))}function RD(n,e){switch(vw(e),e.tag){case 1:return ja(e.type)&&uy(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return af(),Br(Ga),Br(ha),Aw(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Ew(e),null;case 13:if(Br(Xr),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(zt(340));nf()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Br(Xr),null;case 4:return af(),null;case 10:return ww(e.type._context),null;case 22:case 23:return Ow(),null;case 24:return null;default:return null}}var Gg=!1,ca=!1,ID=typeof WeakSet=="function"?WeakSet:Set,mn=null;function Ld(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(r){ri(n,e,r)}else t.current=null}function ib(n,e,t){try{t()}catch(r){ri(n,e,r)}}var m5=!1;function DD(n,e){if(V2=sy,n=qE(),gw(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var r=t.getSelection&&t.getSelection();if(r&&r.rangeCount!==0){t=r.anchorNode;var i=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{t.nodeType,o.nodeType}catch{t=null;break e}var u=0,l=-1,p=-1,v=0,x=0,M=n,w=null;t:for(;;){for(var A;M!==t||i!==0&&M.nodeType!==3||(l=u+i),M!==o||r!==0&&M.nodeType!==3||(p=u+r),M.nodeType===3&&(u+=M.nodeValue.length),(A=M.firstChild)!==null;)w=M,M=A;for(;;){if(M===n)break t;if(w===t&&++v===i&&(l=u),w===o&&++x===r&&(p=u),(A=M.nextSibling)!==null)break;M=w,w=M.parentNode}M=A}t=l===-1||p===-1?null:{start:l,end:p}}else t=null}t=t||{start:0,end:0}}else t=null;for(H2={focusedElem:n,selectionRange:t},sy=!1,mn=e;mn!==null;)if(e=mn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,mn=n;else for(;mn!==null;){e=mn;try{var k=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(k!==null){var z=k.memoizedProps,D=k.memoizedState,C=e.stateNode,U=C.getSnapshotBeforeUpdate(e.elementType===e.type?z:Js(e.type,z),D);C.__reactInternalSnapshotBeforeUpdate=U}break;case 3:var B=e.stateNode.containerInfo;B.nodeType===1?B.textContent="":B.nodeType===9&&B.documentElement&&B.removeChild(B.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(zt(163))}}catch(K){ri(e,e.return,K)}if(n=e.sibling,n!==null){n.return=e.return,mn=n;break}mn=e.return}return k=m5,m5=!1,k}function vp(n,e,t){var r=e.updateQueue;if(r=r!==null?r.lastEffect:null,r!==null){var i=r=r.next;do{if((i.tag&n)===n){var o=i.destroy;i.destroy=void 0,o!==void 0&&ib(e,t,o)}i=i.next}while(i!==r)}}function iv(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var r=t.create;t.destroy=r()}t=t.next}while(t!==e)}}function ab(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function jA(n){var e=n.alternate;e!==null&&(n.alternate=null,jA(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[To],delete e[Np],delete e[W2],delete e[pD],delete e[mD])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function WA(n){return n.tag===5||n.tag===3||n.tag===4}function g5(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||WA(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function sb(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=cy));else if(r!==4&&(n=n.child,n!==null))for(sb(n,e,t),n=n.sibling;n!==null;)sb(n,e,t),n=n.sibling}function ob(n,e,t){var r=n.tag;if(r===5||r===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(r!==4&&(n=n.child,n!==null))for(ob(n,e,t),n=n.sibling;n!==null;)ob(n,e,t),n=n.sibling}var ji=null,Qs=!1;function uc(n,e,t){for(t=t.child;t!==null;)$A(n,e,t),t=t.sibling}function $A(n,e,t){if(Do&&typeof Do.onCommitFiberUnmount=="function")try{Do.onCommitFiberUnmount(Yy,t)}catch{}switch(t.tag){case 5:ca||Ld(t,e);case 6:var r=ji,i=Qs;ji=null,uc(n,e,t),ji=r,Qs=i,ji!==null&&(Qs?(n=ji,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):ji.removeChild(t.stateNode));break;case 18:ji!==null&&(Qs?(n=ji,t=t.stateNode,n.nodeType===8?ex(n.parentNode,t):n.nodeType===1&&ex(n,t),Dp(n)):ex(ji,t.stateNode));break;case 4:r=ji,i=Qs,ji=t.stateNode.containerInfo,Qs=!0,uc(n,e,t),ji=r,Qs=i;break;case 0:case 11:case 14:case 15:if(!ca&&(r=t.updateQueue,r!==null&&(r=r.lastEffect,r!==null))){i=r=r.next;do{var o=i,u=o.destroy;o=o.tag,u!==void 0&&(o&2||o&4)&&ib(t,e,u),i=i.next}while(i!==r)}uc(n,e,t);break;case 1:if(!ca&&(Ld(t,e),r=t.stateNode,typeof r.componentWillUnmount=="function"))try{r.props=t.memoizedProps,r.state=t.memoizedState,r.componentWillUnmount()}catch(l){ri(t,e,l)}uc(n,e,t);break;case 21:uc(n,e,t);break;case 22:t.mode&1?(ca=(r=ca)||t.memoizedState!==null,uc(n,e,t),ca=r):uc(n,e,t);break;default:uc(n,e,t)}}function y5(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new ID),e.forEach(function(r){var i=VD.bind(null,n,r);t.has(r)||(t.add(r),r.then(i,i))})}}function $s(n,e){var t=e.deletions;if(t!==null)for(var r=0;r<t.length;r++){var i=t[r];try{var o=n,u=e,l=u;e:for(;l!==null;){switch(l.tag){case 5:ji=l.stateNode,Qs=!1;break e;case 3:ji=l.stateNode.containerInfo,Qs=!0;break e;case 4:ji=l.stateNode.containerInfo,Qs=!0;break e}l=l.return}if(ji===null)throw Error(zt(160));$A(o,u,i),ji=null,Qs=!1;var p=i.alternate;p!==null&&(p.return=null),i.return=null}catch(v){ri(i,e,v)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)qA(e,n),e=e.sibling}function qA(n,e){var t=n.alternate,r=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if($s(e,n),xo(n),r&4){try{vp(3,n,n.return),iv(3,n)}catch(z){ri(n,n.return,z)}try{vp(5,n,n.return)}catch(z){ri(n,n.return,z)}}break;case 1:$s(e,n),xo(n),r&512&&t!==null&&Ld(t,t.return);break;case 5:if($s(e,n),xo(n),r&512&&t!==null&&Ld(t,t.return),n.flags&32){var i=n.stateNode;try{Cp(i,"")}catch(z){ri(n,n.return,z)}}if(r&4&&(i=n.stateNode,i!=null)){var o=n.memoizedProps,u=t!==null?t.memoizedProps:o,l=n.type,p=n.updateQueue;if(n.updateQueue=null,p!==null)try{l==="input"&&o.type==="radio"&&o.name!=null&&pE(i,o),I2(l,u);var v=I2(l,o);for(u=0;u<p.length;u+=2){var x=p[u],M=p[u+1];x==="style"?_E(i,M):x==="dangerouslySetInnerHTML"?yE(i,M):x==="children"?Cp(i,M):rw(i,x,M,v)}switch(l){case"input":E2(i,o);break;case"textarea":mE(i,o);break;case"select":var w=i._wrapperState.wasMultiple;i._wrapperState.wasMultiple=!!o.multiple;var A=o.value;A!=null?Hd(i,!!o.multiple,A,!1):w!==!!o.multiple&&(o.defaultValue!=null?Hd(i,!!o.multiple,o.defaultValue,!0):Hd(i,!!o.multiple,o.multiple?[]:"",!1))}i[Np]=o}catch(z){ri(n,n.return,z)}}break;case 6:if($s(e,n),xo(n),r&4){if(n.stateNode===null)throw Error(zt(162));i=n.stateNode,o=n.memoizedProps;try{i.nodeValue=o}catch(z){ri(n,n.return,z)}}break;case 3:if($s(e,n),xo(n),r&4&&t!==null&&t.memoizedState.isDehydrated)try{Dp(e.containerInfo)}catch(z){ri(n,n.return,z)}break;case 4:$s(e,n),xo(n);break;case 13:$s(e,n),xo(n),i=n.child,i.flags&8192&&(o=i.memoizedState!==null,i.stateNode.isHidden=o,!o||i.alternate!==null&&i.alternate.memoizedState!==null||(Fw=pi())),r&4&&y5(n);break;case 22:if(x=t!==null&&t.memoizedState!==null,n.mode&1?(ca=(v=ca)||x,$s(e,n),ca=v):$s(e,n),xo(n),r&8192){if(v=n.memoizedState!==null,(n.stateNode.isHidden=v)&&!x&&n.mode&1)for(mn=n,x=n.child;x!==null;){for(M=mn=x;mn!==null;){switch(w=mn,A=w.child,w.tag){case 0:case 11:case 14:case 15:vp(4,w,w.return);break;case 1:Ld(w,w.return);var k=w.stateNode;if(typeof k.componentWillUnmount=="function"){r=w,t=w.return;try{e=r,k.props=e.memoizedProps,k.state=e.memoizedState,k.componentWillUnmount()}catch(z){ri(r,t,z)}}break;case 5:Ld(w,w.return);break;case 22:if(w.memoizedState!==null){_5(M);continue}}A!==null?(A.return=w,mn=A):_5(M)}x=x.sibling}e:for(x=null,M=n;;){if(M.tag===5){if(x===null){x=M;try{i=M.stateNode,v?(o=i.style,typeof o.setProperty=="function"?o.setProperty("display","none","important"):o.display="none"):(l=M.stateNode,p=M.memoizedProps.style,u=p!=null&&p.hasOwnProperty("display")?p.display:null,l.style.display=vE("display",u))}catch(z){ri(n,n.return,z)}}}else if(M.tag===6){if(x===null)try{M.stateNode.nodeValue=v?"":M.memoizedProps}catch(z){ri(n,n.return,z)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===n)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===n)break e;for(;M.sibling===null;){if(M.return===null||M.return===n)break e;x===M&&(x=null),M=M.return}x===M&&(x=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:$s(e,n),xo(n),r&4&&y5(n);break;case 21:break;default:$s(e,n),xo(n)}}function xo(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(WA(t)){var r=t;break e}t=t.return}throw Error(zt(160))}switch(r.tag){case 5:var i=r.stateNode;r.flags&32&&(Cp(i,""),r.flags&=-33);var o=g5(n);ob(n,o,i);break;case 3:case 4:var u=r.stateNode.containerInfo,l=g5(n);sb(n,l,u);break;default:throw Error(zt(161))}}catch(p){ri(n,n.return,p)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function kD(n,e,t){mn=n,XA(n)}function XA(n,e,t){for(var r=(n.mode&1)!==0;mn!==null;){var i=mn,o=i.child;if(i.tag===22&&r){var u=i.memoizedState!==null||Gg;if(!u){var l=i.alternate,p=l!==null&&l.memoizedState!==null||ca;l=Gg;var v=ca;if(Gg=u,(ca=p)&&!v)for(mn=i;mn!==null;)u=mn,p=u.child,u.tag===22&&u.memoizedState!==null?x5(i):p!==null?(p.return=u,mn=p):x5(i);for(;o!==null;)mn=o,XA(o),o=o.sibling;mn=i,Gg=l,ca=v}v5(n)}else i.subtreeFlags&8772&&o!==null?(o.return=i,mn=o):v5(n)}}function v5(n){for(;mn!==null;){var e=mn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ca||iv(5,e);break;case 1:var r=e.stateNode;if(e.flags&4&&!ca)if(t===null)r.componentDidMount();else{var i=e.elementType===e.type?t.memoizedProps:Js(e.type,t.memoizedProps);r.componentDidUpdate(i,t.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=e.updateQueue;o!==null&&t5(e,o,r);break;case 3:var u=e.updateQueue;if(u!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}t5(e,u,t)}break;case 5:var l=e.stateNode;if(t===null&&e.flags&4){t=l;var p=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&t.focus();break;case"img":p.src&&(t.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var v=e.alternate;if(v!==null){var x=v.memoizedState;if(x!==null){var M=x.dehydrated;M!==null&&Dp(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(zt(163))}ca||e.flags&512&&ab(e)}catch(w){ri(e,e.return,w)}}if(e===n){mn=null;break}if(t=e.sibling,t!==null){t.return=e.return,mn=t;break}mn=e.return}}function _5(n){for(;mn!==null;){var e=mn;if(e===n){mn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,mn=t;break}mn=e.return}}function x5(n){for(;mn!==null;){var e=mn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{iv(4,e)}catch(p){ri(e,t,p)}break;case 1:var r=e.stateNode;if(typeof r.componentDidMount=="function"){var i=e.return;try{r.componentDidMount()}catch(p){ri(e,i,p)}}var o=e.return;try{ab(e)}catch(p){ri(e,o,p)}break;case 5:var u=e.return;try{ab(e)}catch(p){ri(e,u,p)}}}catch(p){ri(e,e.return,p)}if(e===n){mn=null;break}var l=e.sibling;if(l!==null){l.return=e.return,mn=l;break}mn=e.return}}var LD=Math.ceil,xy=Fl.ReactCurrentDispatcher,Lw=Fl.ReactCurrentOwner,Ls=Fl.ReactCurrentBatchConfig,ur=0,Fi=null,_i=null,$i=0,ss=0,zd=Yc(0),Mi=0,Gp=null,Qu=0,av=0,zw=0,_p=null,Ba=null,Fw=0,of=1/0,ml=null,by=!1,lb=null,Nc=null,jg=!1,Pc=null,wy=0,xp=0,cb=null,H1=-1,G1=0;function Aa(){return ur&6?pi():H1!==-1?H1:H1=pi()}function Oc(n){return n.mode&1?ur&2&&$i!==0?$i&-$i:yD.transition!==null?(G1===0&&(G1=IE()),G1):(n=_r,n!==0||(n=window.event,n=n===void 0?16:OE(n.type)),n):1}function oo(n,e,t,r){if(50<xp)throw xp=0,cb=null,Error(zt(185));am(n,t,r),(!(ur&2)||n!==Fi)&&(n===Fi&&(!(ur&2)&&(av|=t),Mi===4&&Ec(n,$i)),Wa(n,r),t===1&&ur===0&&!(e.mode&1)&&(of=pi()+500,tv&&Kc()))}function Wa(n,e){var t=n.callbackNode;yI(n,e);var r=ay(n,n===Fi?$i:0);if(r===0)t!==null&&PS(t),n.callbackNode=null,n.callbackPriority=0;else if(e=r&-r,n.callbackPriority!==e){if(t!=null&&PS(t),e===1)n.tag===0?gD(b5.bind(null,n)):rA(b5.bind(null,n)),dD(function(){!(ur&6)&&Kc()}),t=null;else{switch(DE(r)){case 1:t=lw;break;case 4:t=PE;break;case 16:t=iy;break;case 536870912:t=RE;break;default:t=iy}t=n8(t,ZA.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function ZA(n,e){if(H1=-1,G1=0,ur&6)throw Error(zt(327));var t=n.callbackNode;if(qd()&&n.callbackNode!==t)return null;var r=ay(n,n===Fi?$i:0);if(r===0)return null;if(r&30||r&n.expiredLanes||e)e=Sy(n,r);else{e=r;var i=ur;ur|=2;var o=KA();(Fi!==n||$i!==e)&&(ml=null,of=pi()+500,qu(n,e));do try{ND();break}catch(l){YA(n,l)}while(!0);bw(),xy.current=o,ur=i,_i!==null?e=0:(Fi=null,$i=0,e=Mi)}if(e!==0){if(e===2&&(i=F2(n),i!==0&&(r=i,e=ub(n,i))),e===1)throw t=Gp,qu(n,0),Ec(n,r),Wa(n,pi()),t;if(e===6)Ec(n,r);else{if(i=n.current.alternate,!(r&30)&&!zD(i)&&(e=Sy(n,r),e===2&&(o=F2(n),o!==0&&(r=o,e=ub(n,o))),e===1))throw t=Gp,qu(n,0),Ec(n,r),Wa(n,pi()),t;switch(n.finishedWork=i,n.finishedLanes=r,e){case 0:case 1:throw Error(zt(345));case 2:Lu(n,Ba,ml);break;case 3:if(Ec(n,r),(r&130023424)===r&&(e=Fw+500-pi(),10<e)){if(ay(n,0)!==0)break;if(i=n.suspendedLanes,(i&r)!==r){Aa(),n.pingedLanes|=n.suspendedLanes&i;break}n.timeoutHandle=j2(Lu.bind(null,n,Ba,ml),e);break}Lu(n,Ba,ml);break;case 4:if(Ec(n,r),(r&4194240)===r)break;for(e=n.eventTimes,i=-1;0<r;){var u=31-so(r);o=1<<u,u=e[u],u>i&&(i=u),r&=~o}if(r=i,r=pi()-r,r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*LD(r/1960))-r,10<r){n.timeoutHandle=j2(Lu.bind(null,n,Ba,ml),r);break}Lu(n,Ba,ml);break;case 5:Lu(n,Ba,ml);break;default:throw Error(zt(329))}}}return Wa(n,pi()),n.callbackNode===t?ZA.bind(null,n):null}function ub(n,e){var t=_p;return n.current.memoizedState.isDehydrated&&(qu(n,e).flags|=256),n=Sy(n,e),n!==2&&(e=Ba,Ba=t,e!==null&&hb(e)),n}function hb(n){Ba===null?Ba=n:Ba.push.apply(Ba,n)}function zD(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var r=0;r<t.length;r++){var i=t[r],o=i.getSnapshot;i=i.value;try{if(!lo(o(),i))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function Ec(n,e){for(e&=~zw,e&=~av,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-so(e),r=1<<t;n[t]=-1,e&=~r}}function b5(n){if(ur&6)throw Error(zt(327));qd();var e=ay(n,0);if(!(e&1))return Wa(n,pi()),null;var t=Sy(n,e);if(n.tag!==0&&t===2){var r=F2(n);r!==0&&(e=r,t=ub(n,r))}if(t===1)throw t=Gp,qu(n,0),Ec(n,e),Wa(n,pi()),t;if(t===6)throw Error(zt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Lu(n,Ba,ml),Wa(n,pi()),null}function Nw(n,e){var t=ur;ur|=1;try{return n(e)}finally{ur=t,ur===0&&(of=pi()+500,tv&&Kc())}}function eh(n){Pc!==null&&Pc.tag===0&&!(ur&6)&&qd();var e=ur;ur|=1;var t=Ls.transition,r=_r;try{if(Ls.transition=null,_r=1,n)return n()}finally{_r=r,Ls.transition=t,ur=e,!(ur&6)&&Kc()}}function Ow(){ss=zd.current,Br(zd)}function qu(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,hD(t)),_i!==null)for(t=_i.return;t!==null;){var r=t;switch(vw(r),r.tag){case 1:r=r.type.childContextTypes,r!=null&&uy();break;case 3:af(),Br(Ga),Br(ha),Aw();break;case 5:Ew(r);break;case 4:af();break;case 13:Br(Xr);break;case 19:Br(Xr);break;case 10:ww(r.type._context);break;case 22:case 23:Ow()}t=t.return}if(Fi=n,_i=n=Bc(n.current,null),$i=ss=e,Mi=0,Gp=null,zw=av=Qu=0,Ba=_p=null,Uu!==null){for(e=0;e<Uu.length;e++)if(t=Uu[e],r=t.interleaved,r!==null){t.interleaved=null;var i=r.next,o=t.pending;if(o!==null){var u=o.next;o.next=i,r.next=u}t.pending=r}Uu=null}return n}function YA(n,e){do{var t=_i;try{if(bw(),B1.current=_y,vy){for(var r=Yr.memoizedState;r!==null;){var i=r.queue;i!==null&&(i.pending=null),r=r.next}vy=!1}if(Ju=0,Li=Si=Yr=null,yp=!1,Up=0,Lw.current=null,t===null||t.return===null){Mi=1,Gp=e,_i=null;break}e:{var o=n,u=t.return,l=t,p=e;if(e=$i,l.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var v=p,x=l,M=x.tag;if(!(x.mode&1)&&(M===0||M===11||M===15)){var w=x.alternate;w?(x.updateQueue=w.updateQueue,x.memoizedState=w.memoizedState,x.lanes=w.lanes):(x.updateQueue=null,x.memoizedState=null)}var A=l5(u);if(A!==null){A.flags&=-257,c5(A,u,l,o,e),A.mode&1&&o5(o,v,e),e=A,p=v;var k=e.updateQueue;if(k===null){var z=new Set;z.add(p),e.updateQueue=z}else k.add(p);break e}else{if(!(e&1)){o5(o,v,e),Bw();break e}p=Error(zt(426))}}else if(Hr&&l.mode&1){var D=l5(u);if(D!==null){!(D.flags&65536)&&(D.flags|=256),c5(D,u,l,o,e),_w(sf(p,l));break e}}o=p=sf(p,l),Mi!==4&&(Mi=2),_p===null?_p=[o]:_p.push(o),o=u;do{switch(o.tag){case 3:o.flags|=65536,e&=-e,o.lanes|=e;var C=kA(o,p,e);e5(o,C);break e;case 1:l=p;var U=o.type,B=o.stateNode;if(!(o.flags&128)&&(typeof U.getDerivedStateFromError=="function"||B!==null&&typeof B.componentDidCatch=="function"&&(Nc===null||!Nc.has(B)))){o.flags|=65536,e&=-e,o.lanes|=e;var K=LA(o,l,e);e5(o,K);break e}}o=o.return}while(o!==null)}QA(t)}catch(ue){e=ue,_i===t&&t!==null&&(_i=t=t.return);continue}break}while(!0)}function KA(){var n=xy.current;return xy.current=_y,n===null?_y:n}function Bw(){(Mi===0||Mi===3||Mi===2)&&(Mi=4),Fi===null||!(Qu&268435455)&&!(av&268435455)||Ec(Fi,$i)}function Sy(n,e){var t=ur;ur|=2;var r=KA();(Fi!==n||$i!==e)&&(ml=null,qu(n,e));do try{FD();break}catch(i){YA(n,i)}while(!0);if(bw(),ur=t,xy.current=r,_i!==null)throw Error(zt(261));return Fi=null,$i=0,Mi}function FD(){for(;_i!==null;)JA(_i)}function ND(){for(;_i!==null&&!lI();)JA(_i)}function JA(n){var e=t8(n.alternate,n,ss);n.memoizedProps=n.pendingProps,e===null?QA(n):_i=e,Lw.current=null}function QA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=RD(t,e),t!==null){t.flags&=32767,_i=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Mi=6,_i=null;return}}else if(t=PD(t,e,ss),t!==null){_i=t;return}if(e=e.sibling,e!==null){_i=e;return}_i=e=n}while(e!==null);Mi===0&&(Mi=5)}function Lu(n,e,t){var r=_r,i=Ls.transition;try{Ls.transition=null,_r=1,OD(n,e,t,r)}finally{Ls.transition=i,_r=r}return null}function OD(n,e,t,r){do qd();while(Pc!==null);if(ur&6)throw Error(zt(327));t=n.finishedWork;var i=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(zt(177));n.callbackNode=null,n.callbackPriority=0;var o=t.lanes|t.childLanes;if(vI(n,o),n===Fi&&(_i=Fi=null,$i=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||jg||(jg=!0,n8(iy,function(){return qd(),null})),o=(t.flags&15990)!==0,t.subtreeFlags&15990||o){o=Ls.transition,Ls.transition=null;var u=_r;_r=1;var l=ur;ur|=4,Lw.current=null,DD(n,t),qA(t,n),iD(H2),sy=!!V2,H2=V2=null,n.current=t,kD(t),cI(),ur=l,_r=u,Ls.transition=o}else n.current=t;if(jg&&(jg=!1,Pc=n,wy=i),o=n.pendingLanes,o===0&&(Nc=null),dI(t.stateNode),Wa(n,pi()),e!==null)for(r=n.onRecoverableError,t=0;t<e.length;t++)i=e[t],r(i.value,{componentStack:i.stack,digest:i.digest});if(by)throw by=!1,n=lb,lb=null,n;return wy&1&&n.tag!==0&&qd(),o=n.pendingLanes,o&1?n===cb?xp++:(xp=0,cb=n):xp=0,Kc(),null}function qd(){if(Pc!==null){var n=DE(wy),e=Ls.transition,t=_r;try{if(Ls.transition=null,_r=16>n?16:n,Pc===null)var r=!1;else{if(n=Pc,Pc=null,wy=0,ur&6)throw Error(zt(331));var i=ur;for(ur|=4,mn=n.current;mn!==null;){var o=mn,u=o.child;if(mn.flags&16){var l=o.deletions;if(l!==null){for(var p=0;p<l.length;p++){var v=l[p];for(mn=v;mn!==null;){var x=mn;switch(x.tag){case 0:case 11:case 15:vp(8,x,o)}var M=x.child;if(M!==null)M.return=x,mn=M;else for(;mn!==null;){x=mn;var w=x.sibling,A=x.return;if(jA(x),x===v){mn=null;break}if(w!==null){w.return=A,mn=w;break}mn=A}}}var k=o.alternate;if(k!==null){var z=k.child;if(z!==null){k.child=null;do{var D=z.sibling;z.sibling=null,z=D}while(z!==null)}}mn=o}}if(o.subtreeFlags&2064&&u!==null)u.return=o,mn=u;else e:for(;mn!==null;){if(o=mn,o.flags&2048)switch(o.tag){case 0:case 11:case 15:vp(9,o,o.return)}var C=o.sibling;if(C!==null){C.return=o.return,mn=C;break e}mn=o.return}}var U=n.current;for(mn=U;mn!==null;){u=mn;var B=u.child;if(u.subtreeFlags&2064&&B!==null)B.return=u,mn=B;else e:for(u=U;mn!==null;){if(l=mn,l.flags&2048)try{switch(l.tag){case 0:case 11:case 15:iv(9,l)}}catch(ue){ri(l,l.return,ue)}if(l===u){mn=null;break e}var K=l.sibling;if(K!==null){K.return=l.return,mn=K;break e}mn=l.return}}if(ur=i,Kc(),Do&&typeof Do.onPostCommitFiberRoot=="function")try{Do.onPostCommitFiberRoot(Yy,n)}catch{}r=!0}return r}finally{_r=t,Ls.transition=e}}return!1}function w5(n,e,t){e=sf(t,e),e=kA(n,e,1),n=Fc(n,e,1),e=Aa(),n!==null&&(am(n,1,e),Wa(n,e))}function ri(n,e,t){if(n.tag===3)w5(n,n,t);else for(;e!==null;){if(e.tag===3){w5(e,n,t);break}else if(e.tag===1){var r=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof r.componentDidCatch=="function"&&(Nc===null||!Nc.has(r))){n=sf(t,n),n=LA(e,n,1),e=Fc(e,n,1),n=Aa(),e!==null&&(am(e,1,n),Wa(e,n));break}}e=e.return}}function BD(n,e,t){var r=n.pingCache;r!==null&&r.delete(e),e=Aa(),n.pingedLanes|=n.suspendedLanes&t,Fi===n&&($i&t)===t&&(Mi===4||Mi===3&&($i&130023424)===$i&&500>pi()-Fw?qu(n,0):zw|=t),Wa(n,e)}function e8(n,e){e===0&&(n.mode&1?(e=Lg,Lg<<=1,!(Lg&130023424)&&(Lg=4194304)):e=1);var t=Aa();n=Cl(n,e),n!==null&&(am(n,e,t),Wa(n,t))}function UD(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),e8(n,t)}function VD(n,e){var t=0;switch(n.tag){case 13:var r=n.stateNode,i=n.memoizedState;i!==null&&(t=i.retryLane);break;case 19:r=n.stateNode;break;default:throw Error(zt(314))}r!==null&&r.delete(e),e8(n,t)}var t8;t8=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Ga.current)Va=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Va=!1,CD(n,e,t);Va=!!(n.flags&131072)}else Va=!1,Hr&&e.flags&1048576&&iA(e,fy,e.index);switch(e.lanes=0,e.tag){case 2:var r=e.type;V1(n,e),n=e.pendingProps;var i=tf(e,ha.current);$d(e,t),i=Pw(null,e,r,n,i,t);var o=Rw();return e.flags|=1,typeof i=="object"&&i!==null&&typeof i.render=="function"&&i.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,ja(r)?(o=!0,hy(e)):o=!1,e.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,Mw(e),i.updater=nv,e.stateNode=i,i._reactInternals=e,K2(e,r,n,t),e=eb(null,e,r,!0,o,t)):(e.tag=0,Hr&&o&&yw(e),Ta(null,e,i,t),e=e.child),e;case 16:r=e.elementType;e:{switch(V1(n,e),n=e.pendingProps,i=r._init,r=i(r._payload),e.type=r,i=e.tag=GD(r),n=Js(r,n),i){case 0:e=Q2(null,e,r,n,t);break e;case 1:e=d5(null,e,r,n,t);break e;case 11:e=u5(null,e,r,n,t);break e;case 14:e=h5(null,e,r,Js(r.type,n),t);break e}throw Error(zt(306,r,""))}return e;case 0:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Js(r,i),Q2(n,e,r,i,t);case 1:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Js(r,i),d5(n,e,r,i,t);case 3:e:{if(OA(e),n===null)throw Error(zt(387));r=e.pendingProps,o=e.memoizedState,i=o.element,lA(n,e),gy(e,r,null,t);var u=e.memoizedState;if(r=u.element,o.isDehydrated)if(o={element:r,isDehydrated:!1,cache:u.cache,pendingSuspenseBoundaries:u.pendingSuspenseBoundaries,transitions:u.transitions},e.updateQueue.baseState=o,e.memoizedState=o,e.flags&256){i=sf(Error(zt(423)),e),e=f5(n,e,r,t,i);break e}else if(r!==i){i=sf(Error(zt(424)),e),e=f5(n,e,r,t,i);break e}else for(ls=zc(e.stateNode.containerInfo.firstChild),us=e,Hr=!0,no=null,t=dA(e,null,r,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(nf(),r===i){e=Pl(n,e,t);break e}Ta(n,e,r,t)}e=e.child}return e;case 5:return fA(e),n===null&&X2(e),r=e.type,i=e.pendingProps,o=n!==null?n.memoizedProps:null,u=i.children,G2(r,i)?u=null:o!==null&&G2(r,o)&&(e.flags|=32),NA(n,e),Ta(n,e,u,t),e.child;case 6:return n===null&&X2(e),null;case 13:return BA(n,e,t);case 4:return Tw(e,e.stateNode.containerInfo),r=e.pendingProps,n===null?e.child=rf(e,null,r,t):Ta(n,e,r,t),e.child;case 11:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Js(r,i),u5(n,e,r,i,t);case 7:return Ta(n,e,e.pendingProps,t),e.child;case 8:return Ta(n,e,e.pendingProps.children,t),e.child;case 12:return Ta(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(r=e.type._context,i=e.pendingProps,o=e.memoizedProps,u=i.value,Dr(py,r._currentValue),r._currentValue=u,o!==null)if(lo(o.value,u)){if(o.children===i.children&&!Ga.current){e=Pl(n,e,t);break e}}else for(o=e.child,o!==null&&(o.return=e);o!==null;){var l=o.dependencies;if(l!==null){u=o.child;for(var p=l.firstContext;p!==null;){if(p.context===r){if(o.tag===1){p=wl(-1,t&-t),p.tag=2;var v=o.updateQueue;if(v!==null){v=v.shared;var x=v.pending;x===null?p.next=p:(p.next=x.next,x.next=p),v.pending=p}}o.lanes|=t,p=o.alternate,p!==null&&(p.lanes|=t),Z2(o.return,t,e),l.lanes|=t;break}p=p.next}}else if(o.tag===10)u=o.type===e.type?null:o.child;else if(o.tag===18){if(u=o.return,u===null)throw Error(zt(341));u.lanes|=t,l=u.alternate,l!==null&&(l.lanes|=t),Z2(u,t,e),u=o.sibling}else u=o.child;if(u!==null)u.return=o;else for(u=o;u!==null;){if(u===e){u=null;break}if(o=u.sibling,o!==null){o.return=u.return,u=o;break}u=u.return}o=u}Ta(n,e,i.children,t),e=e.child}return e;case 9:return i=e.type,r=e.pendingProps.children,$d(e,t),i=Fs(i),r=r(i),e.flags|=1,Ta(n,e,r,t),e.child;case 14:return r=e.type,i=Js(r,e.pendingProps),i=Js(r.type,i),h5(n,e,r,i,t);case 15:return zA(n,e,e.type,e.pendingProps,t);case 17:return r=e.type,i=e.pendingProps,i=e.elementType===r?i:Js(r,i),V1(n,e),e.tag=1,ja(r)?(n=!0,hy(e)):n=!1,$d(e,t),uA(e,r,i),K2(e,r,i,t),eb(null,e,r,!0,n,t);case 19:return UA(n,e,t);case 22:return FA(n,e,t)}throw Error(zt(156,e.tag))};function n8(n,e){return CE(n,e)}function HD(n,e,t,r){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rs(n,e,t,r){return new HD(n,e,t,r)}function Uw(n){return n=n.prototype,!(!n||!n.isReactComponent)}function GD(n){if(typeof n=="function")return Uw(n)?1:0;if(n!=null){if(n=n.$$typeof,n===aw)return 11;if(n===sw)return 14}return 2}function Bc(n,e){var t=n.alternate;return t===null?(t=Rs(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function j1(n,e,t,r,i,o){var u=2;if(r=n,typeof n=="function")Uw(n)&&(u=1);else if(typeof n=="string")u=5;else e:switch(n){case Td:return Xu(t.children,i,o,e);case iw:u=8,i|=8;break;case b2:return n=Rs(12,t,e,i|2),n.elementType=b2,n.lanes=o,n;case w2:return n=Rs(13,t,e,i),n.elementType=w2,n.lanes=o,n;case S2:return n=Rs(19,t,e,i),n.elementType=S2,n.lanes=o,n;case hE:return sv(t,i,o,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case cE:u=10;break e;case uE:u=9;break e;case aw:u=11;break e;case sw:u=14;break e;case wc:u=16,r=null;break e}throw Error(zt(130,n==null?n:typeof n,""))}return e=Rs(u,t,e,i),e.elementType=n,e.type=r,e.lanes=o,e}function Xu(n,e,t,r){return n=Rs(7,n,r,e),n.lanes=t,n}function sv(n,e,t,r){return n=Rs(22,n,r,e),n.elementType=hE,n.lanes=t,n.stateNode={isHidden:!1},n}function lx(n,e,t){return n=Rs(6,n,null,e),n.lanes=t,n}function cx(n,e,t){return e=Rs(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function jD(n,e,t,r,i){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=G_(0),this.expirationTimes=G_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=G_(0),this.identifierPrefix=r,this.onRecoverableError=i,this.mutableSourceEagerHydrationData=null}function Vw(n,e,t,r,i,o,u,l,p){return n=new jD(n,e,t,l,p),e===1?(e=1,o===!0&&(e|=8)):e=0,o=Rs(3,null,null,e),n.current=o,o.stateNode=n,o.memoizedState={element:r,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Mw(o),n}function WD(n,e,t){var r=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Md,key:r==null?null:""+r,children:n,containerInfo:e,implementation:t}}function r8(n){if(!n)return jc;n=n._reactInternals;e:{if(lh(n)!==n||n.tag!==1)throw Error(zt(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(ja(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(zt(171))}if(n.tag===1){var t=n.type;if(ja(t))return nA(n,t,e)}return e}function i8(n,e,t,r,i,o,u,l,p){return n=Vw(t,r,!0,n,i,o,u,l,p),n.context=r8(null),t=n.current,r=Aa(),i=Oc(t),o=wl(r,i),o.callback=e??null,Fc(t,o,i),n.current.lanes=i,am(n,i,r),Wa(n,r),n}function ov(n,e,t,r){var i=e.current,o=Aa(),u=Oc(i);return t=r8(t),e.context===null?e.context=t:e.pendingContext=t,e=wl(o,u),e.payload={element:n},r=r===void 0?null:r,r!==null&&(e.callback=r),n=Fc(i,e,u),n!==null&&(oo(n,i,u,o),O1(n,i,u)),u}function My(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function S5(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function Hw(n,e){S5(n,e),(n=n.alternate)&&S5(n,e)}function $D(){return null}var a8=typeof reportError=="function"?reportError:function(n){console.error(n)};function Gw(n){this._internalRoot=n}lv.prototype.render=Gw.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(zt(409));ov(n,e,null,null)};lv.prototype.unmount=Gw.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;eh(function(){ov(null,n,null,null)}),e[Al]=null}};function lv(n){this._internalRoot=n}lv.prototype.unstable_scheduleHydration=function(n){if(n){var e=zE();n={blockedOn:null,target:n,priority:e};for(var t=0;t<Tc.length&&e!==0&&e<Tc[t].priority;t++);Tc.splice(t,0,n),t===0&&NE(n)}};function jw(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function cv(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function M5(){}function qD(n,e,t,r,i){if(i){if(typeof r=="function"){var o=r;r=function(){var v=My(u);o.call(v)}}var u=i8(e,r,n,0,null,!1,!1,"",M5);return n._reactRootContainer=u,n[Al]=u.current,zp(n.nodeType===8?n.parentNode:n),eh(),u}for(;i=n.lastChild;)n.removeChild(i);if(typeof r=="function"){var l=r;r=function(){var v=My(p);l.call(v)}}var p=Vw(n,0,!1,null,null,!1,!1,"",M5);return n._reactRootContainer=p,n[Al]=p.current,zp(n.nodeType===8?n.parentNode:n),eh(function(){ov(e,p,t,r)}),p}function uv(n,e,t,r,i){var o=t._reactRootContainer;if(o){var u=o;if(typeof i=="function"){var l=i;i=function(){var p=My(u);l.call(p)}}ov(e,u,n,i)}else u=qD(t,e,n,i,r);return My(u)}kE=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=ip(e.pendingLanes);t!==0&&(cw(e,t|1),Wa(e,pi()),!(ur&6)&&(of=pi()+500,Kc()))}break;case 13:eh(function(){var r=Cl(n,1);if(r!==null){var i=Aa();oo(r,n,1,i)}}),Hw(n,1)}};uw=function(n){if(n.tag===13){var e=Cl(n,134217728);if(e!==null){var t=Aa();oo(e,n,134217728,t)}Hw(n,134217728)}};LE=function(n){if(n.tag===13){var e=Oc(n),t=Cl(n,e);if(t!==null){var r=Aa();oo(t,n,e,r)}Hw(n,e)}};zE=function(){return _r};FE=function(n,e){var t=_r;try{return _r=n,e()}finally{_r=t}};k2=function(n,e,t){switch(e){case"input":if(E2(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var r=t[e];if(r!==n&&r.form===n.form){var i=ev(r);if(!i)throw Error(zt(90));fE(r),E2(r,i)}}}break;case"textarea":mE(n,t);break;case"select":e=t.value,e!=null&&Hd(n,!!t.multiple,e,!1)}};wE=Nw;SE=eh;var XD={usingClientEntryPoint:!1,Events:[om,Pd,ev,xE,bE,Nw]},V0={findFiberByHostInstance:Bu,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},ZD={bundleType:V0.bundleType,version:V0.version,rendererPackageName:V0.rendererPackageName,rendererConfig:V0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Fl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=EE(n),n===null?null:n.stateNode},findFiberByHostInstance:V0.findFiberByHostInstance||$D,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Wg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Wg.isDisabled&&Wg.supportsFiber)try{Yy=Wg.inject(ZD),Do=Wg}catch{}}ps.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=XD;ps.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jw(e))throw Error(zt(200));return WD(n,e,null,t)};ps.createRoot=function(n,e){if(!jw(n))throw Error(zt(299));var t=!1,r="",i=a8;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(r=e.identifierPrefix),e.onRecoverableError!==void 0&&(i=e.onRecoverableError)),e=Vw(n,1,!1,null,null,t,!1,r,i),n[Al]=e.current,zp(n.nodeType===8?n.parentNode:n),new Gw(e)};ps.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(zt(188)):(n=Object.keys(n).join(","),Error(zt(268,n)));return n=EE(e),n=n===null?null:n.stateNode,n};ps.flushSync=function(n){return eh(n)};ps.hydrate=function(n,e,t){if(!cv(e))throw Error(zt(200));return uv(null,n,e,!0,t)};ps.hydrateRoot=function(n,e,t){if(!jw(n))throw Error(zt(405));var r=t!=null&&t.hydratedSources||null,i=!1,o="",u=a8;if(t!=null&&(t.unstable_strictMode===!0&&(i=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(u=t.onRecoverableError)),e=i8(e,null,n,1,t??null,i,!1,o,u),n[Al]=e.current,zp(n),r)for(n=0;n<r.length;n++)t=r[n],i=t._getVersion,i=i(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,i]:e.mutableSourceEagerHydrationData.push(t,i);return new lv(e)};ps.render=function(n,e,t){if(!cv(e))throw Error(zt(200));return uv(null,n,e,!1,t)};ps.unmountComponentAtNode=function(n){if(!cv(n))throw Error(zt(40));return n._reactRootContainer?(eh(function(){uv(null,null,n,!1,function(){n._reactRootContainer=null,n[Al]=null})}),!0):!1};ps.unstable_batchedUpdates=Nw;ps.unstable_renderSubtreeIntoContainer=function(n,e,t,r){if(!cv(t))throw Error(zt(200));if(n==null||n._reactInternals===void 0)throw Error(zt(38));return uv(n,e,t,!1,r)};ps.version="18.2.0-next-9e3b772b8-20220608";function s8(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(s8)}catch(n){console.error(n)}}s8(),iE.exports=ps;var Ww=iE.exports;const YD=Yb(Ww),KD=$6({__proto__:null,default:YD},[Ww]);var T5=Ww;_2.createRoot=T5.createRoot,_2.hydrateRoot=T5.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function ii(){return ii=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},ii.apply(this,arguments)}var fi;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(fi||(fi={}));const E5="popstate";function JD(n){n===void 0&&(n={});function e(i,o){let{pathname:u="/",search:l="",hash:p=""}=No(i.location.hash.substr(1));return!u.startsWith("/")&&!u.startsWith(".")&&(u="/"+u),jp("",{pathname:u,search:l,hash:p},o.state&&o.state.usr||null,o.state&&o.state.key||"default")}function t(i,o){let u=i.document.querySelector("base"),l="";if(u&&u.getAttribute("href")){let p=i.location.href,v=p.indexOf("#");l=v===-1?p:p.slice(0,v)}return l+"#"+(typeof o=="string"?o:nh(o))}function r(i,o){th(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(o)+")")}return ek(e,t,r,n)}function nr(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function th(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function QD(){return Math.random().toString(36).substr(2,8)}function A5(n,e){return{usr:n.state,key:n.key,idx:e}}function jp(n,e,t,r){return t===void 0&&(t=null),ii({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?No(e):e,{state:t,key:e&&e.key||r||QD()})}function nh(n){let{pathname:e="/",search:t="",hash:r=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),r&&r!=="#"&&(e+=r.charAt(0)==="#"?r:"#"+r),e}function No(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let r=n.indexOf("?");r>=0&&(e.search=n.substr(r),n=n.substr(0,r)),n&&(e.pathname=n)}return e}function ek(n,e,t,r){r===void 0&&(r={});let{window:i=document.defaultView,v5Compat:o=!1}=r,u=i.history,l=fi.Pop,p=null,v=x();v==null&&(v=0,u.replaceState(ii({},u.state,{idx:v}),""));function x(){return(u.state||{idx:null}).idx}function M(){l=fi.Pop;let D=x(),C=D==null?null:D-v;v=D,p&&p({action:l,location:z.location,delta:C})}function w(D,C){l=fi.Push;let U=jp(z.location,D,C);t&&t(U,D),v=x()+1;let B=A5(U,v),K=z.createHref(U);try{u.pushState(B,"",K)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;i.location.assign(K)}o&&p&&p({action:l,location:z.location,delta:1})}function A(D,C){l=fi.Replace;let U=jp(z.location,D,C);t&&t(U,D),v=x();let B=A5(U,v),K=z.createHref(U);u.replaceState(B,"",K),o&&p&&p({action:l,location:z.location,delta:0})}function k(D){let C=i.location.origin!=="null"?i.location.origin:i.location.href,U=typeof D=="string"?D:nh(D);return U=U.replace(/ $/,"%20"),nr(C,"No window.location.(origin|href) available to create URL for href: "+U),new URL(U,C)}let z={get action(){return l},get location(){return n(i,u)},listen(D){if(p)throw new Error("A history only accepts one active listener");return i.addEventListener(E5,M),p=D,()=>{i.removeEventListener(E5,M),p=null}},createHref(D){return e(i,D)},createURL:k,encodeLocation(D){let C=k(D);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:w,replace:A,go(D){return u.go(D)}};return z}var ni;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(ni||(ni={}));const tk=new Set(["lazy","caseSensitive","path","id","index","children"]);function nk(n){return n.index===!0}function db(n,e,t,r){return t===void 0&&(t=[]),r===void 0&&(r={}),n.map((i,o)=>{let u=[...t,o],l=typeof i.id=="string"?i.id:u.join("-");if(nr(i.index!==!0||!i.children,"Cannot specify children on an index route"),nr(!r[l],'Found a route id collision on id "'+l+`".  Route id's must be globally unique within Data Router usages`),nk(i)){let p=ii({},i,e(i),{id:l});return r[l]=p,p}else{let p=ii({},i,e(i),{id:l,children:void 0});return r[l]=p,i.children&&(p.children=db(i.children,e,u,r)),p}})}function Fd(n,e,t){t===void 0&&(t="/");let r=typeof e=="string"?No(e):e,i=Rl(r.pathname||"/",t);if(i==null)return null;let o=o8(n);ik(o);let u=null;for(let l=0;u==null&&l<o.length;++l){let p=mk(i);u=fk(o[l],p)}return u}function rk(n,e){let{route:t,pathname:r,params:i}=n;return{id:t.id,pathname:r,params:i,data:e[t.id],handle:t.handle}}function o8(n,e,t,r){e===void 0&&(e=[]),t===void 0&&(t=[]),r===void 0&&(r="");let i=(o,u,l)=>{let p={relativePath:l===void 0?o.path||"":l,caseSensitive:o.caseSensitive===!0,childrenIndex:u,route:o};p.relativePath.startsWith("/")&&(nr(p.relativePath.startsWith(r),'Absolute route path "'+p.relativePath+'" nested under path '+('"'+r+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),p.relativePath=p.relativePath.slice(r.length));let v=Sl([r,p.relativePath]),x=t.concat(p);o.children&&o.children.length>0&&(nr(o.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+v+'".')),o8(o.children,e,x,v)),!(o.path==null&&!o.index)&&e.push({path:v,score:hk(v,o.index),routesMeta:x})};return n.forEach((o,u)=>{var l;if(o.path===""||!((l=o.path)!=null&&l.includes("?")))i(o,u);else for(let p of l8(o.path))i(o,u,p)}),e}function l8(n){let e=n.split("/");if(e.length===0)return[];let[t,...r]=e,i=t.endsWith("?"),o=t.replace(/\?$/,"");if(r.length===0)return i?[o,""]:[o];let u=l8(r.join("/")),l=[];return l.push(...u.map(p=>p===""?o:[o,p].join("/"))),i&&l.push(...u),l.map(p=>n.startsWith("/")&&p===""?"/":p)}function ik(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:dk(e.routesMeta.map(r=>r.childrenIndex),t.routesMeta.map(r=>r.childrenIndex)))}const ak=/^:[\w-]+$/,sk=3,ok=2,lk=1,ck=10,uk=-2,C5=n=>n==="*";function hk(n,e){let t=n.split("/"),r=t.length;return t.some(C5)&&(r+=uk),e&&(r+=ok),t.filter(i=>!C5(i)).reduce((i,o)=>i+(ak.test(o)?sk:o===""?lk:ck),r)}function dk(n,e){return n.length===e.length&&n.slice(0,-1).every((r,i)=>r===e[i])?n[n.length-1]-e[e.length-1]:0}function fk(n,e){let{routesMeta:t}=n,r={},i="/",o=[];for(let u=0;u<t.length;++u){let l=t[u],p=u===t.length-1,v=i==="/"?e:e.slice(i.length)||"/",x=fb({path:l.relativePath,caseSensitive:l.caseSensitive,end:p},v);if(!x)return null;Object.assign(r,x.params);let M=l.route;o.push({params:r,pathname:Sl([i,x.pathname]),pathnameBase:vk(Sl([i,x.pathnameBase])),route:M}),x.pathnameBase!=="/"&&(i=Sl([i,x.pathnameBase]))}return o}function fb(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,r]=pk(n.path,n.caseSensitive,n.end),i=e.match(t);if(!i)return null;let o=i[0],u=o.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:r.reduce((v,x,M)=>{let{paramName:w,isOptional:A}=x;if(w==="*"){let z=l[M]||"";u=o.slice(0,o.length-z.length).replace(/(.)\/+$/,"$1")}const k=l[M];return A&&!k?v[w]=void 0:v[w]=(k||"").replace(/%2F/g,"/"),v},{}),pathname:o,pathnameBase:u,pattern:n}}function pk(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),th(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let r=[],i="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(u,l,p)=>(r.push({paramName:l,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(r.push({paramName:"*"}),i+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":n!==""&&n!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),r]}function mk(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return th(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function Rl(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,r=n.charAt(t);return r&&r!=="/"?null:n.slice(t)||"/"}function gk(n,e){e===void 0&&(e="/");let{pathname:t,search:r="",hash:i=""}=typeof n=="string"?No(n):n;return{pathname:t?t.startsWith("/")?t:yk(t,e):e,search:_k(r),hash:xk(i)}}function yk(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function ux(n,e,t,r){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(r)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function c8(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function $w(n,e){let t=c8(n);return e?t.map((r,i)=>i===n.length-1?r.pathname:r.pathnameBase):t.map(r=>r.pathnameBase)}function qw(n,e,t,r){r===void 0&&(r=!1);let i;typeof n=="string"?i=No(n):(i=ii({},n),nr(!i.pathname||!i.pathname.includes("?"),ux("?","pathname","search",i)),nr(!i.pathname||!i.pathname.includes("#"),ux("#","pathname","hash",i)),nr(!i.search||!i.search.includes("#"),ux("#","search","hash",i)));let o=n===""||i.pathname==="",u=o?"/":i.pathname,l;if(u==null)l=t;else{let M=e.length-1;if(!r&&u.startsWith("..")){let w=u.split("/");for(;w[0]==="..";)w.shift(),M-=1;i.pathname=w.join("/")}l=M>=0?e[M]:"/"}let p=gk(i,l),v=u&&u!=="/"&&u.endsWith("/"),x=(o||u===".")&&t.endsWith("/");return!p.pathname.endsWith("/")&&(v||x)&&(p.pathname+="/"),p}const Sl=n=>n.join("/").replace(/\/\/+/g,"/"),vk=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),_k=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,xk=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class Xw{constructor(e,t,r,i){i===void 0&&(i=!1),this.status=e,this.statusText=t||"",this.internal=i,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}}function u8(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const h8=["post","put","patch","delete"],bk=new Set(h8),wk=["get",...h8],Sk=new Set(wk),Mk=new Set([301,302,303,307,308]),Tk=new Set([307,308]),hx={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},Ek={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},H0={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},d8=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ak=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),f8="remix-router-transitions";function Ck(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",r=!t;nr(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let i;if(n.mapRouteProperties)i=n.mapRouteProperties;else if(n.detectErrorBoundary){let O=n.detectErrorBoundary;i=V=>({hasErrorBoundary:O(V)})}else i=Ak;let o={},u=db(n.routes,i,void 0,o),l,p=n.basename||"/",v=ii({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},n.future),x=null,M=new Set,w=null,A=null,k=null,z=n.hydrationData!=null,D=Fd(u,n.history.location,p),C=null;if(D==null){let O=Ts(404,{pathname:n.history.location.pathname}),{matches:V,route:$}=F5(u);D=V,C={[$.id]:O}}let U,B=D.some(O=>O.route.lazy),K=D.some(O=>O.route.loader);if(B)U=!1;else if(!K)U=!0;else if(v.v7_partialHydration){let O=n.hydrationData?n.hydrationData.loaderData:null,V=n.hydrationData?n.hydrationData.errors:null,$=ne=>ne.route.loader?ne.route.loader.hydrate===!0?!1:O&&O[ne.route.id]!==void 0||V&&V[ne.route.id]!==void 0:!0;if(V){let ne=D.findIndex(me=>V[me.route.id]!==void 0);U=D.slice(0,ne+1).every($)}else U=D.every($)}else U=n.hydrationData!=null;let ue,Z={historyAction:n.history.action,location:n.history.location,matches:D,initialized:U,navigation:hx,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||C,fetchers:new Map,blockers:new Map},ee=fi.Pop,be=!1,ie,Q=!1,Ee=new Map,Fe=null,Ae=!1,Ve=!1,lt=[],ut=[],pt=new Map,ke=0,Je=-1,tt=new Map,_t=new Set,Lt=new Map,Cn=new Map,nt=new Set,wt=new Map,Ft=new Map,At=!1;function gn(){if(x=n.history.listen(O=>{let{action:V,location:$,delta:ne}=O;if(At){At=!1;return}th(Ft.size===0||ne!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let me=jt({currentLocation:Z.location,nextLocation:$,historyAction:V});if(me&&ne!=null){At=!0,n.history.go(ne*-1),Ht(me,{state:"blocked",location:$,proceed(){Ht(me,{state:"proceeding",proceed:void 0,reset:void 0,location:$}),n.history.go(ne)},reset(){let Se=new Map(Z.blockers);Se.set(me,H0),je({blockers:Se})}});return}return Yt(V,$)}),t){Bk(e,Ee);let O=()=>Uk(e,Ee);e.addEventListener("pagehide",O),Fe=()=>e.removeEventListener("pagehide",O)}return Z.initialized||Yt(fi.Pop,Z.location,{initialHydration:!0}),ue}function En(){x&&x(),Fe&&Fe(),M.clear(),ie&&ie.abort(),Z.fetchers.forEach((O,V)=>Nt(V)),Z.blockers.forEach((O,V)=>dt(V))}function In(O){return M.add(O),()=>M.delete(O)}function je(O,V){V===void 0&&(V={}),Z=ii({},Z,O);let $=[],ne=[];v.v7_fetcherPersist&&Z.fetchers.forEach((me,Se)=>{me.state==="idle"&&(nt.has(Se)?ne.push(Se):$.push(Se))}),[...M].forEach(me=>me(Z,{deletedFetchers:ne,unstable_viewTransitionOpts:V.viewTransitionOpts,unstable_flushSync:V.flushSync===!0})),v.v7_fetcherPersist&&($.forEach(me=>Z.fetchers.delete(me)),ne.forEach(me=>Nt(me)))}function An(O,V,$){var ne,me;let{flushSync:Se}=$===void 0?{}:$,Te=Z.actionData!=null&&Z.navigation.formMethod!=null&&eo(Z.navigation.formMethod)&&Z.navigation.state==="loading"&&((ne=O.state)==null?void 0:ne._isRedirect)!==!0,ye;V.actionData?Object.keys(V.actionData).length>0?ye=V.actionData:ye=null:Te?ye=Z.actionData:ye=null;let Re=V.loaderData?z5(Z.loaderData,V.loaderData,V.matches||[],V.errors):Z.loaderData,$e=Z.blockers;$e.size>0&&($e=new Map($e),$e.forEach((Ct,nn)=>$e.set(nn,H0)));let Ye=be===!0||Z.navigation.formMethod!=null&&eo(Z.navigation.formMethod)&&((me=O.state)==null?void 0:me._isRedirect)!==!0;l&&(u=l,l=void 0),Ae||ee===fi.Pop||(ee===fi.Push?n.history.push(O,O.state):ee===fi.Replace&&n.history.replace(O,O.state));let Ge;if(ee===fi.Pop){let Ct=Ee.get(Z.location.pathname);Ct&&Ct.has(O.pathname)?Ge={currentLocation:Z.location,nextLocation:O}:Ee.has(O.pathname)&&(Ge={currentLocation:O,nextLocation:Z.location})}else if(Q){let Ct=Ee.get(Z.location.pathname);Ct?Ct.add(O.pathname):(Ct=new Set([O.pathname]),Ee.set(Z.location.pathname,Ct)),Ge={currentLocation:Z.location,nextLocation:O}}je(ii({},V,{actionData:ye,loaderData:Re,historyAction:ee,location:O,initialized:!0,navigation:hx,revalidation:"idle",restoreScrollPosition:kt(O,V.matches||Z.matches),preventScrollReset:Ye,blockers:$e}),{viewTransitionOpts:Ge,flushSync:Se===!0}),ee=fi.Pop,be=!1,Q=!1,Ae=!1,Ve=!1,lt=[],ut=[]}async function yn(O,V){if(typeof O=="number"){n.history.go(O);return}let $=pb(Z.location,Z.matches,p,v.v7_prependBasename,O,v.v7_relativeSplatPath,V==null?void 0:V.fromRouteId,V==null?void 0:V.relative),{path:ne,submission:me,error:Se}=P5(v.v7_normalizeFormMethod,!1,$,V),Te=Z.location,ye=jp(Z.location,ne,V&&V.state);ye=ii({},ye,n.history.encodeLocation(ye));let Re=V&&V.replace!=null?V.replace:void 0,$e=fi.Push;Re===!0?$e=fi.Replace:Re===!1||me!=null&&eo(me.formMethod)&&me.formAction===Z.location.pathname+Z.location.search&&($e=fi.Replace);let Ye=V&&"preventScrollReset"in V?V.preventScrollReset===!0:void 0,Ge=(V&&V.unstable_flushSync)===!0,Ct=jt({currentLocation:Te,nextLocation:ye,historyAction:$e});if(Ct){Ht(Ct,{state:"blocked",location:ye,proceed(){Ht(Ct,{state:"proceeding",proceed:void 0,reset:void 0,location:ye}),yn(O,V)},reset(){let nn=new Map(Z.blockers);nn.set(Ct,H0),je({blockers:nn})}});return}return await Yt($e,ye,{submission:me,pendingError:Se,preventScrollReset:Ye,replace:V&&V.replace,enableViewTransition:V&&V.unstable_viewTransition,flushSync:Ge})}function Qn(){if(_n(),je({revalidation:"loading"}),Z.navigation.state!=="submitting"){if(Z.navigation.state==="idle"){Yt(Z.historyAction,Z.location,{startUninterruptedRevalidation:!0});return}Yt(ee||Z.historyAction,Z.navigation.location,{overrideNavigation:Z.navigation})}}async function Yt(O,V,$){ie&&ie.abort(),ie=null,ee=O,Ae=($&&$.startUninterruptedRevalidation)===!0,ft(Z.location,Z.matches),be=($&&$.preventScrollReset)===!0,Q=($&&$.enableViewTransition)===!0;let ne=l||u,me=$&&$.overrideNavigation,Se=Fd(ne,V,p),Te=($&&$.flushSync)===!0;if(!Se){let nn=Ts(404,{pathname:V.pathname}),{matches:on,route:bn}=F5(ne);Jt(),An(V,{matches:on,loaderData:{},errors:{[bn.id]:nn}},{flushSync:Te});return}if(Z.initialized&&!Ve&&kk(Z.location,V)&&!($&&$.submission&&eo($.submission.formMethod))){An(V,{matches:Se},{flushSync:Te});return}ie=new AbortController;let ye=j0(n.history,V,ie.signal,$&&$.submission),Re,$e;if($&&$.pendingError)$e={[bp(Se).route.id]:$.pendingError};else if($&&$.submission&&eo($.submission.formMethod)){let nn=await Gn(ye,V,$.submission,Se,{replace:$.replace,flushSync:Te});if(nn.shortCircuited)return;Re=nn.pendingActionData,$e=nn.pendingActionError,me=dx(V,$.submission),Te=!1,ye=new Request(ye.url,{signal:ye.signal})}let{shortCircuited:Ye,loaderData:Ge,errors:Ct}=await re(ye,V,Se,me,$&&$.submission,$&&$.fetcherSubmission,$&&$.replace,$&&$.initialHydration===!0,Te,Re,$e);Ye||(ie=null,An(V,ii({matches:Se},Re?{actionData:Re}:{},{loaderData:Ge,errors:Ct})))}async function Gn(O,V,$,ne,me){me===void 0&&(me={}),_n();let Se=Nk(V,$);je({navigation:Se},{flushSync:me.flushSync===!0});let Te,ye=gb(ne,V);if(!ye.route.action&&!ye.route.lazy)Te={type:ni.error,error:Ts(405,{method:O.method,pathname:V.pathname,routeId:ye.route.id})};else if(Te=await G0("action",O,ye,ne,o,i,p,v.v7_relativeSplatPath),O.signal.aborted)return{shortCircuited:!0};if(Gu(Te)){let Re;return me&&me.replace!=null?Re=me.replace:Re=Te.location===Z.location.pathname+Z.location.search,await mt(Z,Te,{submission:$,replace:Re}),{shortCircuited:!0}}if(Nd(Te)){let Re=bp(ne,ye.route.id);return(me&&me.replace)!==!0&&(ee=fi.Push),{pendingActionData:{},pendingActionError:{[Re.route.id]:Te.error}}}if(Hu(Te))throw Ts(400,{type:"defer-action"});return{pendingActionData:{[ye.route.id]:Te.data}}}async function re(O,V,$,ne,me,Se,Te,ye,Re,$e,Ye){let Ge=ne||dx(V,me),Ct=me||Se||B5(Ge),nn=l||u,[on,bn]=R5(n.history,Z,$,Ct,V,v.v7_partialHydration&&ye===!0,Ve,lt,ut,nt,Lt,_t,nn,p,$e,Ye);if(Jt(It=>!($&&$.some(Qt=>Qt.route.id===It))||on&&on.some(Qt=>Qt.route.id===It)),Je=++ke,on.length===0&&bn.length===0){let It=Kt();return An(V,ii({matches:$,loaderData:{},errors:Ye||null},$e?{actionData:$e}:{},It?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Re}),{shortCircuited:!0}}if(!Ae&&(!v.v7_partialHydration||!ye)){bn.forEach(Qt=>{let Sn=Z.fetchers.get(Qt.key),Xt=W0(void 0,Sn?Sn.data:void 0);Z.fetchers.set(Qt.key,Xt)});let It=$e||Z.actionData;je(ii({navigation:Ge},It?Object.keys(It).length===0?{actionData:null}:{actionData:It}:{},bn.length>0?{fetchers:new Map(Z.fetchers)}:{}),{flushSync:Re})}bn.forEach(It=>{pt.has(It.key)&&at(It.key),It.controller&&pt.set(It.key,It.controller)});let wn=()=>bn.forEach(It=>at(It.key));ie&&ie.signal.addEventListener("abort",wn);let{results:lr,loaderResults:er,fetcherResults:de}=await St(Z.matches,$,on,bn,O);if(O.signal.aborted)return{shortCircuited:!0};ie&&ie.signal.removeEventListener("abort",wn),bn.forEach(It=>pt.delete(It.key));let Le=N5(lr);if(Le){if(Le.idx>=on.length){let It=bn[Le.idx-on.length].key;_t.add(It)}return await mt(Z,Le.result,{replace:Te}),{shortCircuited:!0}}let{loaderData:We,errors:Xe}=L5(Z,$,on,er,Ye,bn,de,wt);wt.forEach((It,Qt)=>{It.subscribe(Sn=>{(Sn||It.done)&&wt.delete(Qt)})}),v.v7_partialHydration&&ye&&Z.errors&&Object.entries(Z.errors).filter(It=>{let[Qt]=It;return!on.some(Sn=>Sn.route.id===Qt)}).forEach(It=>{let[Qt,Sn]=It;Xe=Object.assign(Xe||{},{[Qt]:Sn})});let Ze=Kt(),Pt=Bn(Je),rn=Ze||Pt||bn.length>0;return ii({loaderData:We,errors:Xe},rn?{fetchers:new Map(Z.fetchers)}:{})}function le(O,V,$,ne){if(r)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");pt.has(O)&&at(O);let me=(ne&&ne.unstable_flushSync)===!0,Se=l||u,Te=pb(Z.location,Z.matches,p,v.v7_prependBasename,$,v.v7_relativeSplatPath,V,ne==null?void 0:ne.relative),ye=Fd(Se,Te,p);if(!ye){hn(O,V,Ts(404,{pathname:Te}),{flushSync:me});return}let{path:Re,submission:$e,error:Ye}=P5(v.v7_normalizeFormMethod,!0,Te,ne);if(Ye){hn(O,V,Ye,{flushSync:me});return}let Ge=gb(ye,Re);if(be=(ne&&ne.preventScrollReset)===!0,$e&&eo($e.formMethod)){st(O,V,Re,Ge,ye,me,$e);return}Lt.set(O,{routeId:V,path:Re}),it(O,V,Re,Ge,ye,me,$e)}async function st(O,V,$,ne,me,Se,Te){if(_n(),Lt.delete(O),!ne.route.action&&!ne.route.lazy){let Qt=Ts(405,{method:Te.formMethod,pathname:$,routeId:V});hn(O,V,Qt,{flushSync:Se});return}let ye=Z.fetchers.get(O);Mt(O,Ok(Te,ye),{flushSync:Se});let Re=new AbortController,$e=j0(n.history,$,Re.signal,Te);pt.set(O,Re);let Ye=ke,Ge=await G0("action",$e,ne,me,o,i,p,v.v7_relativeSplatPath);if($e.signal.aborted){pt.get(O)===Re&&pt.delete(O);return}if(v.v7_fetcherPersist&&nt.has(O)){if(Gu(Ge)||Nd(Ge)){Mt(O,xc(void 0));return}}else{if(Gu(Ge))if(pt.delete(O),Je>Ye){Mt(O,xc(void 0));return}else return _t.add(O),Mt(O,W0(Te)),mt(Z,Ge,{fetcherSubmission:Te});if(Nd(Ge)){hn(O,V,Ge.error);return}}if(Hu(Ge))throw Ts(400,{type:"defer-action"});let Ct=Z.navigation.location||Z.location,nn=j0(n.history,Ct,Re.signal),on=l||u,bn=Z.navigation.state!=="idle"?Fd(on,Z.navigation.location,p):Z.matches;nr(bn,"Didn't find any matches after fetcher action");let wn=++ke;tt.set(O,wn);let lr=W0(Te,Ge.data);Z.fetchers.set(O,lr);let[er,de]=R5(n.history,Z,bn,Te,Ct,!1,Ve,lt,ut,nt,Lt,_t,on,p,{[ne.route.id]:Ge.data},void 0);de.filter(Qt=>Qt.key!==O).forEach(Qt=>{let Sn=Qt.key,Xt=Z.fetchers.get(Sn),Fn=W0(void 0,Xt?Xt.data:void 0);Z.fetchers.set(Sn,Fn),pt.has(Sn)&&at(Sn),Qt.controller&&pt.set(Sn,Qt.controller)}),je({fetchers:new Map(Z.fetchers)});let Le=()=>de.forEach(Qt=>at(Qt.key));Re.signal.addEventListener("abort",Le);let{results:We,loaderResults:Xe,fetcherResults:Ze}=await St(Z.matches,bn,er,de,nn);if(Re.signal.aborted)return;Re.signal.removeEventListener("abort",Le),tt.delete(O),pt.delete(O),de.forEach(Qt=>pt.delete(Qt.key));let Pt=N5(We);if(Pt){if(Pt.idx>=er.length){let Qt=de[Pt.idx-er.length].key;_t.add(Qt)}return mt(Z,Pt.result)}let{loaderData:rn,errors:It}=L5(Z,Z.matches,er,Xe,void 0,de,Ze,wt);if(Z.fetchers.has(O)){let Qt=xc(Ge.data);Z.fetchers.set(O,Qt)}Bn(wn),Z.navigation.state==="loading"&&wn>Je?(nr(ee,"Expected pending action"),ie&&ie.abort(),An(Z.navigation.location,{matches:bn,loaderData:rn,errors:It,fetchers:new Map(Z.fetchers)})):(je({errors:It,loaderData:z5(Z.loaderData,rn,bn,It),fetchers:new Map(Z.fetchers)}),Ve=!1)}async function it(O,V,$,ne,me,Se,Te){let ye=Z.fetchers.get(O);Mt(O,W0(Te,ye?ye.data:void 0),{flushSync:Se});let Re=new AbortController,$e=j0(n.history,$,Re.signal);pt.set(O,Re);let Ye=ke,Ge=await G0("loader",$e,ne,me,o,i,p,v.v7_relativeSplatPath);if(Hu(Ge)&&(Ge=await g8(Ge,$e.signal,!0)||Ge),pt.get(O)===Re&&pt.delete(O),!$e.signal.aborted){if(nt.has(O)){Mt(O,xc(void 0));return}if(Gu(Ge))if(Je>Ye){Mt(O,xc(void 0));return}else{_t.add(O),await mt(Z,Ge);return}if(Nd(Ge)){hn(O,V,Ge.error);return}nr(!Hu(Ge),"Unhandled fetcher deferred data"),Mt(O,xc(Ge.data))}}async function mt(O,V,$){let{submission:ne,fetcherSubmission:me,replace:Se}=$===void 0?{}:$;V.revalidate&&(Ve=!0);let Te=jp(O.location,V.location,{_isRedirect:!0});if(nr(Te,"Expected a location on the redirect navigation"),t){let Ct=!1;if(V.reloadDocument)Ct=!0;else if(d8.test(V.location)){const nn=n.history.createURL(V.location);Ct=nn.origin!==e.location.origin||Rl(nn.pathname,p)==null}if(Ct){Se?e.location.replace(V.location):e.location.assign(V.location);return}}ie=null;let ye=Se===!0?fi.Replace:fi.Push,{formMethod:Re,formAction:$e,formEncType:Ye}=O.navigation;!ne&&!me&&Re&&$e&&Ye&&(ne=B5(O.navigation));let Ge=ne||me;if(Tk.has(V.status)&&Ge&&eo(Ge.formMethod))await Yt(ye,Te,{submission:ii({},Ge,{formAction:V.location}),preventScrollReset:be});else{let Ct=dx(Te,ne);await Yt(ye,Te,{overrideNavigation:Ct,fetcherSubmission:me,preventScrollReset:be})}}async function St(O,V,$,ne,me){let Se=await Promise.all([...$.map(Re=>G0("loader",me,Re,V,o,i,p,v.v7_relativeSplatPath)),...ne.map(Re=>Re.matches&&Re.match&&Re.controller?G0("loader",j0(n.history,Re.path,Re.controller.signal),Re.match,Re.matches,o,i,p,v.v7_relativeSplatPath):{type:ni.error,error:Ts(404,{pathname:Re.path})})]),Te=Se.slice(0,$.length),ye=Se.slice($.length);return await Promise.all([O5(O,$,Te,Te.map(()=>me.signal),!1,Z.loaderData),O5(O,ne.map(Re=>Re.match),ye,ne.map(Re=>Re.controller?Re.controller.signal:null),!0)]),{results:Se,loaderResults:Te,fetcherResults:ye}}function _n(){Ve=!0,lt.push(...Jt()),Lt.forEach((O,V)=>{pt.has(V)&&(ut.push(V),at(V))})}function Mt(O,V,$){$===void 0&&($={}),Z.fetchers.set(O,V),je({fetchers:new Map(Z.fetchers)},{flushSync:($&&$.flushSync)===!0})}function hn(O,V,$,ne){ne===void 0&&(ne={});let me=bp(Z.matches,V);Nt(O),je({errors:{[me.route.id]:$},fetchers:new Map(Z.fetchers)},{flushSync:(ne&&ne.flushSync)===!0})}function xn(O){return v.v7_fetcherPersist&&(Cn.set(O,(Cn.get(O)||0)+1),nt.has(O)&&nt.delete(O)),Z.fetchers.get(O)||Ek}function Nt(O){let V=Z.fetchers.get(O);pt.has(O)&&!(V&&V.state==="loading"&&tt.has(O))&&at(O),Lt.delete(O),tt.delete(O),_t.delete(O),nt.delete(O),Z.fetchers.delete(O)}function an(O){if(v.v7_fetcherPersist){let V=(Cn.get(O)||0)-1;V<=0?(Cn.delete(O),nt.add(O)):Cn.set(O,V)}else Nt(O);je({fetchers:new Map(Z.fetchers)})}function at(O){let V=pt.get(O);nr(V,"Expected fetch controller: "+O),V.abort(),pt.delete(O)}function tn(O){for(let V of O){let $=xn(V),ne=xc($.data);Z.fetchers.set(V,ne)}}function Kt(){let O=[],V=!1;for(let $ of _t){let ne=Z.fetchers.get($);nr(ne,"Expected fetcher: "+$),ne.state==="loading"&&(_t.delete($),O.push($),V=!0)}return tn(O),V}function Bn(O){let V=[];for(let[$,ne]of tt)if(ne<O){let me=Z.fetchers.get($);nr(me,"Expected fetcher: "+$),me.state==="loading"&&(at($),tt.delete($),V.push($))}return tn(V),V.length>0}function Un(O,V){let $=Z.blockers.get(O)||H0;return Ft.get(O)!==V&&Ft.set(O,V),$}function dt(O){Z.blockers.delete(O),Ft.delete(O)}function Ht(O,V){let $=Z.blockers.get(O)||H0;nr($.state==="unblocked"&&V.state==="blocked"||$.state==="blocked"&&V.state==="blocked"||$.state==="blocked"&&V.state==="proceeding"||$.state==="blocked"&&V.state==="unblocked"||$.state==="proceeding"&&V.state==="unblocked","Invalid blocker state transition: "+$.state+" -> "+V.state);let ne=new Map(Z.blockers);ne.set(O,V),je({blockers:ne})}function jt(O){let{currentLocation:V,nextLocation:$,historyAction:ne}=O;if(Ft.size===0)return;Ft.size>1&&th(!1,"A router only supports one blocker at a time");let me=Array.from(Ft.entries()),[Se,Te]=me[me.length-1],ye=Z.blockers.get(Se);if(!(ye&&ye.state==="proceeding")&&Te({currentLocation:V,nextLocation:$,historyAction:ne}))return Se}function Jt(O){let V=[];return wt.forEach(($,ne)=>{(!O||O(ne))&&($.cancel(),V.push(ne),wt.delete(ne))}),V}function X(O,V,$){if(w=O,k=V,A=$||null,!z&&Z.navigation===hx){z=!0;let ne=kt(Z.location,Z.matches);ne!=null&&je({restoreScrollPosition:ne})}return()=>{w=null,k=null,A=null}}function Be(O,V){return A&&A(O,V.map(ne=>rk(ne,Z.loaderData)))||O.key}function ft(O,V){if(w&&k){let $=Be(O,V);w[$]=k()}}function kt(O,V){if(w){let $=Be(O,V),ne=w[$];if(typeof ne=="number")return ne}return null}function ce(O){o={},l=db(O,i,void 0,o)}return ue={get basename(){return p},get future(){return v},get state(){return Z},get routes(){return u},get window(){return e},initialize:gn,subscribe:In,enableScrollRestoration:X,navigate:yn,fetch:le,revalidate:Qn,createHref:O=>n.history.createHref(O),encodeLocation:O=>n.history.encodeLocation(O),getFetcher:xn,deleteFetcher:an,dispose:En,getBlocker:Un,deleteBlocker:dt,_internalFetchControllers:pt,_internalActiveDeferreds:wt,_internalSetRoutes:ce},ue}function Pk(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function pb(n,e,t,r,i,o,u,l){let p,v;if(u){p=[];for(let M of e)if(p.push(M),M.route.id===u){v=M;break}}else p=e,v=e[e.length-1];let x=qw(i||".",$w(p,o),Rl(n.pathname,t)||n.pathname,l==="path");return i==null&&(x.search=n.search,x.hash=n.hash),(i==null||i===""||i===".")&&v&&v.route.index&&!Zw(x.search)&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),r&&t!=="/"&&(x.pathname=x.pathname==="/"?t:Sl([t,x.pathname])),nh(x)}function P5(n,e,t,r){if(!r||!Pk(r))return{path:t};if(r.formMethod&&!Fk(r.formMethod))return{path:t,error:Ts(405,{method:r.formMethod})};let i=()=>({path:t,error:Ts(400,{type:"invalid-body"})}),o=r.formMethod||"get",u=n?o.toUpperCase():o.toLowerCase(),l=m8(t);if(r.body!==void 0){if(r.formEncType==="text/plain"){if(!eo(u))return i();let w=typeof r.body=="string"?r.body:r.body instanceof FormData||r.body instanceof URLSearchParams?Array.from(r.body.entries()).reduce((A,k)=>{let[z,D]=k;return""+A+z+"="+D+`
`},""):String(r.body);return{path:t,submission:{formMethod:u,formAction:l,formEncType:r.formEncType,formData:void 0,json:void 0,text:w}}}else if(r.formEncType==="application/json"){if(!eo(u))return i();try{let w=typeof r.body=="string"?JSON.parse(r.body):r.body;return{path:t,submission:{formMethod:u,formAction:l,formEncType:r.formEncType,formData:void 0,json:w,text:void 0}}}catch{return i()}}}nr(typeof FormData=="function","FormData is not available in this environment");let p,v;if(r.formData)p=mb(r.formData),v=r.formData;else if(r.body instanceof FormData)p=mb(r.body),v=r.body;else if(r.body instanceof URLSearchParams)p=r.body,v=k5(p);else if(r.body==null)p=new URLSearchParams,v=new FormData;else try{p=new URLSearchParams(r.body),v=k5(p)}catch{return i()}let x={formMethod:u,formAction:l,formEncType:r&&r.formEncType||"application/x-www-form-urlencoded",formData:v,json:void 0,text:void 0};if(eo(x.formMethod))return{path:t,submission:x};let M=No(t);return e&&M.search&&Zw(M.search)&&p.append("index",""),M.search="?"+p,{path:nh(M),submission:x}}function Rk(n,e){let t=n;if(e){let r=n.findIndex(i=>i.route.id===e);r>=0&&(t=n.slice(0,r))}return t}function R5(n,e,t,r,i,o,u,l,p,v,x,M,w,A,k,z){let D=z?Object.values(z)[0]:k?Object.values(k)[0]:void 0,C=n.createURL(e.location),U=n.createURL(i),B=z?Object.keys(z)[0]:void 0,ue=Rk(t,B).filter((ee,be)=>{let{route:ie}=ee;if(ie.lazy)return!0;if(ie.loader==null)return!1;if(o)return ie.loader.hydrate?!0:e.loaderData[ie.id]===void 0&&(!e.errors||e.errors[ie.id]===void 0);if(Ik(e.loaderData,e.matches[be],ee)||l.some(Fe=>Fe===ee.route.id))return!0;let Q=e.matches[be],Ee=ee;return I5(ee,ii({currentUrl:C,currentParams:Q.params,nextUrl:U,nextParams:Ee.params},r,{actionResult:D,defaultShouldRevalidate:u||C.pathname+C.search===U.pathname+U.search||C.search!==U.search||p8(Q,Ee)}))}),Z=[];return x.forEach((ee,be)=>{if(o||!t.some(Ae=>Ae.route.id===ee.routeId)||v.has(be))return;let ie=Fd(w,ee.path,A);if(!ie){Z.push({key:be,routeId:ee.routeId,path:ee.path,matches:null,match:null,controller:null});return}let Q=e.fetchers.get(be),Ee=gb(ie,ee.path),Fe=!1;M.has(be)?Fe=!1:p.includes(be)?Fe=!0:Q&&Q.state!=="idle"&&Q.data===void 0?Fe=u:Fe=I5(Ee,ii({currentUrl:C,currentParams:e.matches[e.matches.length-1].params,nextUrl:U,nextParams:t[t.length-1].params},r,{actionResult:D,defaultShouldRevalidate:u})),Fe&&Z.push({key:be,routeId:ee.routeId,path:ee.path,matches:ie,match:Ee,controller:new AbortController})}),[ue,Z]}function Ik(n,e,t){let r=!e||t.route.id!==e.route.id,i=n[t.route.id]===void 0;return r||i}function p8(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function I5(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}async function D5(n,e,t){if(!n.lazy)return;let r=await n.lazy();if(!n.lazy)return;let i=t[n.id];nr(i,"No route found in manifest");let o={};for(let u in r){let p=i[u]!==void 0&&u!=="hasErrorBoundary";th(!p,'Route "'+i.id+'" has a static property "'+u+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+u+'" will be ignored.')),!p&&!tk.has(u)&&(o[u]=r[u])}Object.assign(i,o),Object.assign(i,ii({},e(i),{lazy:void 0}))}async function G0(n,e,t,r,i,o,u,l,p){p===void 0&&(p={});let v,x,M,w=z=>{let D,C=new Promise((U,B)=>D=B);return M=()=>D(),e.signal.addEventListener("abort",M),Promise.race([z({request:e,params:t.params,context:p.requestContext}),C])};try{let z=t.route[n];if(t.route.lazy)if(z){let D,C=await Promise.all([w(z).catch(U=>{D=U}),D5(t.route,o,i)]);if(D)throw D;x=C[0]}else if(await D5(t.route,o,i),z=t.route[n],z)x=await w(z);else if(n==="action"){let D=new URL(e.url),C=D.pathname+D.search;throw Ts(405,{method:e.method,pathname:C,routeId:t.route.id})}else return{type:ni.data,data:void 0};else if(z)x=await w(z);else{let D=new URL(e.url),C=D.pathname+D.search;throw Ts(404,{pathname:C})}nr(x!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(z){v=ni.error,x=z}finally{M&&e.signal.removeEventListener("abort",M)}if(zk(x)){let z=x.status;if(Mk.has(z)){let C=x.headers.get("Location");if(nr(C,"Redirects returned/thrown from loaders/actions must have a Location header"),!d8.test(C))C=pb(new URL(e.url),r.slice(0,r.indexOf(t)+1),u,!0,C,l);else if(!p.isStaticRequest){let U=new URL(e.url),B=C.startsWith("//")?new URL(U.protocol+C):new URL(C),K=Rl(B.pathname,u)!=null;B.origin===U.origin&&K&&(C=B.pathname+B.search+B.hash)}if(p.isStaticRequest)throw x.headers.set("Location",C),x;return{type:ni.redirect,status:z,location:C,revalidate:x.headers.get("X-Remix-Revalidate")!==null,reloadDocument:x.headers.get("X-Remix-Reload-Document")!==null}}if(p.isRouteRequest)throw{type:v===ni.error?ni.error:ni.data,response:x};let D;try{let C=x.headers.get("Content-Type");C&&/\bapplication\/json\b/.test(C)?x.body==null?D=null:D=await x.json():D=await x.text()}catch(C){return{type:ni.error,error:C}}return v===ni.error?{type:v,error:new Xw(z,x.statusText,D),headers:x.headers}:{type:ni.data,data:D,statusCode:x.status,headers:x.headers}}if(v===ni.error)return{type:v,error:x};if(Lk(x)){var A,k;return{type:ni.deferred,deferredData:x,statusCode:(A=x.init)==null?void 0:A.status,headers:((k=x.init)==null?void 0:k.headers)&&new Headers(x.init.headers)}}return{type:ni.data,data:x}}function j0(n,e,t,r){let i=n.createURL(m8(e)).toString(),o={signal:t};if(r&&eo(r.formMethod)){let{formMethod:u,formEncType:l}=r;o.method=u.toUpperCase(),l==="application/json"?(o.headers=new Headers({"Content-Type":l}),o.body=JSON.stringify(r.json)):l==="text/plain"?o.body=r.text:l==="application/x-www-form-urlencoded"&&r.formData?o.body=mb(r.formData):o.body=r.formData}return new Request(i,o)}function mb(n){let e=new URLSearchParams;for(let[t,r]of n.entries())e.append(t,typeof r=="string"?r:r.name);return e}function k5(n){let e=new FormData;for(let[t,r]of n.entries())e.append(t,r);return e}function Dk(n,e,t,r,i){let o={},u=null,l,p=!1,v={};return t.forEach((x,M)=>{let w=e[M].route.id;if(nr(!Gu(x),"Cannot handle redirect results in processLoaderData"),Nd(x)){let A=bp(n,w),k=x.error;r&&(k=Object.values(r)[0],r=void 0),u=u||{},u[A.route.id]==null&&(u[A.route.id]=k),o[w]=void 0,p||(p=!0,l=u8(x.error)?x.error.status:500),x.headers&&(v[w]=x.headers)}else Hu(x)?(i.set(w,x.deferredData),o[w]=x.deferredData.data):o[w]=x.data,x.statusCode!=null&&x.statusCode!==200&&!p&&(l=x.statusCode),x.headers&&(v[w]=x.headers)}),r&&(u=r,o[Object.keys(r)[0]]=void 0),{loaderData:o,errors:u,statusCode:l||200,loaderHeaders:v}}function L5(n,e,t,r,i,o,u,l){let{loaderData:p,errors:v}=Dk(e,t,r,i,l);for(let x=0;x<o.length;x++){let{key:M,match:w,controller:A}=o[x];nr(u!==void 0&&u[x]!==void 0,"Did not find corresponding fetcher result");let k=u[x];if(!(A&&A.signal.aborted))if(Nd(k)){let z=bp(n.matches,w==null?void 0:w.route.id);v&&v[z.route.id]||(v=ii({},v,{[z.route.id]:k.error})),n.fetchers.delete(M)}else if(Gu(k))nr(!1,"Unhandled fetcher revalidation redirect");else if(Hu(k))nr(!1,"Unhandled fetcher deferred data");else{let z=xc(k.data);n.fetchers.set(M,z)}}return{loaderData:p,errors:v}}function z5(n,e,t,r){let i=ii({},e);for(let o of t){let u=o.route.id;if(e.hasOwnProperty(u)?e[u]!==void 0&&(i[u]=e[u]):n[u]!==void 0&&o.route.loader&&(i[u]=n[u]),r&&r.hasOwnProperty(u))break}return i}function bp(n,e){return(e?n.slice(0,n.findIndex(r=>r.route.id===e)+1):[...n]).reverse().find(r=>r.route.hasErrorBoundary===!0)||n[0]}function F5(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function Ts(n,e){let{pathname:t,routeId:r,method:i,type:o}=e===void 0?{}:e,u="Unknown Server Error",l="Unknown @remix-run/router error";return n===400?(u="Bad Request",i&&t&&r?l="You made a "+i+' request to "'+t+'" but '+('did not provide a `loader` for route "'+r+'", ')+"so there is no way to handle the request.":o==="defer-action"?l="defer() is not supported in actions":o==="invalid-body"&&(l="Unable to encode submission body")):n===403?(u="Forbidden",l='Route "'+r+'" does not match URL "'+t+'"'):n===404?(u="Not Found",l='No route matches URL "'+t+'"'):n===405&&(u="Method Not Allowed",i&&t&&r?l="You made a "+i.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+r+'", ')+"so there is no way to handle the request.":i&&(l='Invalid request method "'+i.toUpperCase()+'"')),new Xw(n||500,u,new Error(l),!0)}function N5(n){for(let e=n.length-1;e>=0;e--){let t=n[e];if(Gu(t))return{result:t,idx:e}}}function m8(n){let e=typeof n=="string"?No(n):n;return nh(ii({},e,{hash:""}))}function kk(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function Hu(n){return n.type===ni.deferred}function Nd(n){return n.type===ni.error}function Gu(n){return(n&&n.type)===ni.redirect}function Lk(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function zk(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function Fk(n){return Sk.has(n.toLowerCase())}function eo(n){return bk.has(n.toLowerCase())}async function O5(n,e,t,r,i,o){for(let u=0;u<t.length;u++){let l=t[u],p=e[u];if(!p)continue;let v=n.find(M=>M.route.id===p.route.id),x=v!=null&&!p8(v,p)&&(o&&o[p.route.id])!==void 0;if(Hu(l)&&(i||x)){let M=r[u];nr(M,"Expected an AbortSignal for revalidating fetcher deferred result"),await g8(l,M,i).then(w=>{w&&(t[u]=w||t[u])})}}}async function g8(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:ni.data,data:n.deferredData.unwrappedData}}catch(i){return{type:ni.error,error:i}}return{type:ni.data,data:n.deferredData.data}}}function Zw(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function gb(n,e){let t=typeof e=="string"?No(e).search:e.search;if(n[n.length-1].route.index&&Zw(t||""))return n[n.length-1];let r=c8(n);return r[r.length-1]}function B5(n){let{formMethod:e,formAction:t,formEncType:r,text:i,formData:o,json:u}=n;if(!(!e||!t||!r)){if(i!=null)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:void 0,text:i};if(o!=null)return{formMethod:e,formAction:t,formEncType:r,formData:o,json:void 0,text:void 0};if(u!==void 0)return{formMethod:e,formAction:t,formEncType:r,formData:void 0,json:u,text:void 0}}}function dx(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function Nk(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function W0(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function Ok(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function xc(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function Bk(n,e){try{let t=n.sessionStorage.getItem(f8);if(t){let r=JSON.parse(t);for(let[i,o]of Object.entries(r||{}))o&&Array.isArray(o)&&e.set(i,new Set(o||[]))}}catch{}}function Uk(n,e){if(e.size>0){let t={};for(let[r,i]of e)t[r]=[...i];try{n.sessionStorage.setItem(f8,JSON.stringify(t))}catch(r){th(!1,"Failed to save applied view transitions in sessionStorage ("+r+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Wp(){return Wp=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},Wp.apply(this,arguments)}const cm=yt.createContext(null),Yw=yt.createContext(null),Jc=yt.createContext(null),hv=yt.createContext(null),Qc=yt.createContext({outlet:null,matches:[],isDataRoute:!1}),y8=yt.createContext(null);function Vk(n,e){let{relative:t}=e===void 0?{}:e;um()||nr(!1);let{basename:r,navigator:i}=yt.useContext(Jc),{hash:o,pathname:u,search:l}=dv(n,{relative:t}),p=u;return r!=="/"&&(p=u==="/"?r:Sl([r,u])),i.createHref({pathname:p,search:l,hash:o})}function um(){return yt.useContext(hv)!=null}function bf(){return um()||nr(!1),yt.useContext(hv).location}function v8(n){yt.useContext(Jc).static||yt.useLayoutEffect(n)}function Kw(){let{isDataRoute:n}=yt.useContext(Qc);return n?tL():Hk()}function Hk(){um()||nr(!1);let n=yt.useContext(cm),{basename:e,future:t,navigator:r}=yt.useContext(Jc),{matches:i}=yt.useContext(Qc),{pathname:o}=bf(),u=JSON.stringify($w(i,t.v7_relativeSplatPath)),l=yt.useRef(!1);return v8(()=>{l.current=!0}),yt.useCallback(function(v,x){if(x===void 0&&(x={}),!l.current)return;if(typeof v=="number"){r.go(v);return}let M=qw(v,JSON.parse(u),o,x.relative==="path");n==null&&e!=="/"&&(M.pathname=M.pathname==="/"?e:Sl([e,M.pathname])),(x.replace?r.replace:r.push)(M,x.state,x)},[e,r,u,o,n])}const Gk=yt.createContext(null);function jk(n){let e=yt.useContext(Qc).outlet;return e&&yt.createElement(Gk.Provider,{value:n},e)}function dv(n,e){let{relative:t}=e===void 0?{}:e,{future:r}=yt.useContext(Jc),{matches:i}=yt.useContext(Qc),{pathname:o}=bf(),u=JSON.stringify($w(i,r.v7_relativeSplatPath));return yt.useMemo(()=>qw(n,JSON.parse(u),o,t==="path"),[n,u,o,t])}function Wk(n,e,t,r){um()||nr(!1);let{navigator:i}=yt.useContext(Jc),{matches:o}=yt.useContext(Qc),u=o[o.length-1],l=u?u.params:{};u&&u.pathname;let p=u?u.pathnameBase:"/";u&&u.route;let v=bf(),x;if(e){var M;let D=typeof e=="string"?No(e):e;p==="/"||(M=D.pathname)!=null&&M.startsWith(p)||nr(!1),x=D}else x=v;let w=x.pathname||"/",A=w;if(p!=="/"){let D=p.replace(/^\//,"").split("/");A="/"+w.replace(/^\//,"").split("/").slice(D.length).join("/")}let k=Fd(n,{pathname:A}),z=Yk(k&&k.map(D=>Object.assign({},D,{params:Object.assign({},l,D.params),pathname:Sl([p,i.encodeLocation?i.encodeLocation(D.pathname).pathname:D.pathname]),pathnameBase:D.pathnameBase==="/"?p:Sl([p,i.encodeLocation?i.encodeLocation(D.pathnameBase).pathname:D.pathnameBase])})),o,t,r);return e&&z?yt.createElement(hv.Provider,{value:{location:Wp({pathname:"/",search:"",hash:"",state:null,key:"default"},x),navigationType:fi.Pop}},z):z}function $k(){let n=eL(),e=u8(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return yt.createElement(yt.Fragment,null,yt.createElement("h2",null,"Unexpected Application Error!"),yt.createElement("h3",{style:{fontStyle:"italic"}},e),t?yt.createElement("pre",{style:i},t):null,null)}const qk=yt.createElement($k,null);class Xk extends yt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?yt.createElement(Qc.Provider,{value:this.props.routeContext},yt.createElement(y8.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Zk(n){let{routeContext:e,match:t,children:r}=n,i=yt.useContext(cm);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),yt.createElement(Qc.Provider,{value:e},r)}function Yk(n,e,t,r){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),r===void 0&&(r=null),n==null){var o;if((o=t)!=null&&o.errors)n=t.matches;else return null}let u=n,l=(i=t)==null?void 0:i.errors;if(l!=null){let x=u.findIndex(M=>M.route.id&&(l==null?void 0:l[M.route.id]));x>=0||nr(!1),u=u.slice(0,Math.min(u.length,x+1))}let p=!1,v=-1;if(t&&r&&r.v7_partialHydration)for(let x=0;x<u.length;x++){let M=u[x];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(v=x),M.route.id){let{loaderData:w,errors:A}=t,k=M.route.loader&&w[M.route.id]===void 0&&(!A||A[M.route.id]===void 0);if(M.route.lazy||k){p=!0,v>=0?u=u.slice(0,v+1):u=[u[0]];break}}}return u.reduceRight((x,M,w)=>{let A,k=!1,z=null,D=null;t&&(A=l&&M.route.id?l[M.route.id]:void 0,z=M.route.errorElement||qk,p&&(v<0&&w===0?(nL("route-fallback",!1),k=!0,D=null):v===w&&(k=!0,D=M.route.hydrateFallbackElement||null)));let C=e.concat(u.slice(0,w+1)),U=()=>{let B;return A?B=z:k?B=D:M.route.Component?B=yt.createElement(M.route.Component,null):M.route.element?B=M.route.element:B=x,yt.createElement(Zk,{match:M,routeContext:{outlet:x,matches:C,isDataRoute:t!=null},children:B})};return t&&(M.route.ErrorBoundary||M.route.errorElement||w===0)?yt.createElement(Xk,{location:t.location,revalidation:t.revalidation,component:z,error:A,children:U(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):U()},null)}var _8=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(_8||{}),Ty=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(Ty||{});function Kk(n){let e=yt.useContext(cm);return e||nr(!1),e}function Jk(n){let e=yt.useContext(Yw);return e||nr(!1),e}function Qk(n){let e=yt.useContext(Qc);return e||nr(!1),e}function x8(n){let e=Qk(),t=e.matches[e.matches.length-1];return t.route.id||nr(!1),t.route.id}function eL(){var n;let e=yt.useContext(y8),t=Jk(Ty.UseRouteError),r=x8(Ty.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[r]}function tL(){let{router:n}=Kk(_8.UseNavigateStable),e=x8(Ty.UseNavigateStable),t=yt.useRef(!1);return v8(()=>{t.current=!0}),yt.useCallback(function(i,o){o===void 0&&(o={}),t.current&&(typeof i=="number"?n.navigate(i):n.navigate(i,Wp({fromRouteId:e},o)))},[n,e])}const U5={};function nL(n,e,t){!e&&!U5[n]&&(U5[n]=!0)}function rL(n){return jk(n.context)}function iL(n){let{basename:e="/",children:t=null,location:r,navigationType:i=fi.Pop,navigator:o,static:u=!1,future:l}=n;um()&&nr(!1);let p=e.replace(/^\/*/,"/"),v=yt.useMemo(()=>({basename:p,navigator:o,static:u,future:Wp({v7_relativeSplatPath:!1},l)}),[p,l,o,u]);typeof r=="string"&&(r=No(r));let{pathname:x="/",search:M="",hash:w="",state:A=null,key:k="default"}=r,z=yt.useMemo(()=>{let D=Rl(x,p);return D==null?null:{location:{pathname:D,search:M,hash:w,state:A,key:k},navigationType:i}},[p,x,M,w,A,k,i]);return z==null?null:yt.createElement(Jc.Provider,{value:v},yt.createElement(hv.Provider,{children:t,value:z}))}new Promise(()=>{});function aL(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:yt.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:yt.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:yt.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function lf(){return lf=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},lf.apply(this,arguments)}function b8(n,e){if(n==null)return{};var t={},r=Object.keys(n),i,o;for(o=0;o<r.length;o++)i=r[o],!(e.indexOf(i)>=0)&&(t[i]=n[i]);return t}function sL(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function oL(n,e){return n.button===0&&(!e||e==="_self")&&!sL(n)}const lL=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],cL=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],uL="6";try{window.__reactRouterVersion=uL}catch{}function hL(n,e){return Ck({basename:e==null?void 0:e.basename,future:lf({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:JD({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||dL(),routes:n,mapRouteProperties:aL,window:e==null?void 0:e.window}).initialize()}function dL(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=lf({},e,{errors:fL(e.errors)})),e}function fL(n){if(!n)return null;let e=Object.entries(n),t={};for(let[r,i]of e)if(i&&i.__type==="RouteErrorResponse")t[r]=new Xw(i.status,i.statusText,i.data,i.internal===!0);else if(i&&i.__type==="Error"){if(i.__subType){let o=window[i.__subType];if(typeof o=="function")try{let u=new o(i.message);u.stack="",t[r]=u}catch{}}if(t[r]==null){let o=new Error(i.message);o.stack="",t[r]=o}}else t[r]=i;return t}const w8=yt.createContext({isTransitioning:!1}),pL=yt.createContext(new Map),mL="startTransition",V5=U9[mL],gL="flushSync",H5=KD[gL];function yL(n){V5?V5(n):n()}function $0(n){H5?H5(n):n()}class vL{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=r=>{this.status==="pending"&&(this.status="resolved",e(r))},this.reject=r=>{this.status==="pending"&&(this.status="rejected",t(r))}})}}function _L(n){let{fallbackElement:e,router:t,future:r}=n,[i,o]=yt.useState(t.state),[u,l]=yt.useState(),[p,v]=yt.useState({isTransitioning:!1}),[x,M]=yt.useState(),[w,A]=yt.useState(),[k,z]=yt.useState(),D=yt.useRef(new Map),{v7_startTransition:C}=r||{},U=yt.useCallback(ee=>{C?yL(ee):ee()},[C]),B=yt.useCallback((ee,be)=>{let{deletedFetchers:ie,unstable_flushSync:Q,unstable_viewTransitionOpts:Ee}=be;ie.forEach(Ae=>D.current.delete(Ae)),ee.fetchers.forEach((Ae,Ve)=>{Ae.data!==void 0&&D.current.set(Ve,Ae.data)});let Fe=t.window==null||typeof t.window.document.startViewTransition!="function";if(!Ee||Fe){Q?$0(()=>o(ee)):U(()=>o(ee));return}if(Q){$0(()=>{w&&(x&&x.resolve(),w.skipTransition()),v({isTransitioning:!0,flushSync:!0,currentLocation:Ee.currentLocation,nextLocation:Ee.nextLocation})});let Ae=t.window.document.startViewTransition(()=>{$0(()=>o(ee))});Ae.finished.finally(()=>{$0(()=>{M(void 0),A(void 0),l(void 0),v({isTransitioning:!1})})}),$0(()=>A(Ae));return}w?(x&&x.resolve(),w.skipTransition(),z({state:ee,currentLocation:Ee.currentLocation,nextLocation:Ee.nextLocation})):(l(ee),v({isTransitioning:!0,flushSync:!1,currentLocation:Ee.currentLocation,nextLocation:Ee.nextLocation}))},[t.window,w,x,D,U]);yt.useLayoutEffect(()=>t.subscribe(B),[t,B]),yt.useEffect(()=>{p.isTransitioning&&!p.flushSync&&M(new vL)},[p]),yt.useEffect(()=>{if(x&&u&&t.window){let ee=u,be=x.promise,ie=t.window.document.startViewTransition(async()=>{U(()=>o(ee)),await be});ie.finished.finally(()=>{M(void 0),A(void 0),l(void 0),v({isTransitioning:!1})}),A(ie)}},[U,u,x,t.window]),yt.useEffect(()=>{x&&u&&i.location.key===u.location.key&&x.resolve()},[x,w,i.location,u]),yt.useEffect(()=>{!p.isTransitioning&&k&&(l(k.state),v({isTransitioning:!0,flushSync:!1,currentLocation:k.currentLocation,nextLocation:k.nextLocation}),z(void 0))},[p.isTransitioning,k]),yt.useEffect(()=>{},[]);let K=yt.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:ee=>t.navigate(ee),push:(ee,be,ie)=>t.navigate(ee,{state:be,preventScrollReset:ie==null?void 0:ie.preventScrollReset}),replace:(ee,be,ie)=>t.navigate(ee,{replace:!0,state:be,preventScrollReset:ie==null?void 0:ie.preventScrollReset})}),[t]),ue=t.basename||"/",Z=yt.useMemo(()=>({router:t,navigator:K,static:!1,basename:ue}),[t,K,ue]);return yt.createElement(yt.Fragment,null,yt.createElement(cm.Provider,{value:Z},yt.createElement(Yw.Provider,{value:i},yt.createElement(pL.Provider,{value:D.current},yt.createElement(w8.Provider,{value:p},yt.createElement(iL,{basename:ue,location:i.location,navigationType:i.historyAction,navigator:K,future:{v7_relativeSplatPath:t.future.v7_relativeSplatPath}},i.initialized||t.future.v7_partialHydration?yt.createElement(xL,{routes:t.routes,future:t.future,state:i}):e))))),null)}function xL(n){let{routes:e,future:t,state:r}=n;return Wk(e,void 0,r,t)}const bL=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",wL=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ey=yt.forwardRef(function(e,t){let{onClick:r,relative:i,reloadDocument:o,replace:u,state:l,target:p,to:v,preventScrollReset:x,unstable_viewTransition:M}=e,w=b8(e,lL),{basename:A}=yt.useContext(Jc),k,z=!1;if(typeof v=="string"&&wL.test(v)&&(k=v,bL))try{let B=new URL(window.location.href),K=v.startsWith("//")?new URL(B.protocol+v):new URL(v),ue=Rl(K.pathname,A);K.origin===B.origin&&ue!=null?v=ue+K.search+K.hash:z=!0}catch{}let D=Vk(v,{relative:i}),C=ML(v,{replace:u,state:l,target:p,preventScrollReset:x,relative:i,unstable_viewTransition:M});function U(B){r&&r(B),B.defaultPrevented||C(B)}return yt.createElement("a",lf({},w,{href:k||D,onClick:z||o?r:U,ref:t,target:p}))}),q0=yt.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:i=!1,className:o="",end:u=!1,style:l,to:p,unstable_viewTransition:v,children:x}=e,M=b8(e,cL),w=dv(p,{relative:M.relative}),A=bf(),k=yt.useContext(Yw),{navigator:z,basename:D}=yt.useContext(Jc),C=k!=null&&TL(w)&&v===!0,U=z.encodeLocation?z.encodeLocation(w).pathname:w.pathname,B=A.pathname,K=k&&k.navigation&&k.navigation.location?k.navigation.location.pathname:null;i||(B=B.toLowerCase(),K=K?K.toLowerCase():null,U=U.toLowerCase()),K&&D&&(K=Rl(K,D)||K);const ue=U!=="/"&&U.endsWith("/")?U.length-1:U.length;let Z=B===U||!u&&B.startsWith(U)&&B.charAt(ue)==="/",ee=K!=null&&(K===U||!u&&K.startsWith(U)&&K.charAt(U.length)==="/"),be={isActive:Z,isPending:ee,isTransitioning:C},ie=Z?r:void 0,Q;typeof o=="function"?Q=o(be):Q=[o,Z?"active":null,ee?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let Ee=typeof l=="function"?l(be):l;return yt.createElement(Ey,lf({},M,{"aria-current":ie,className:Q,ref:t,style:Ee,to:p,unstable_viewTransition:v}),typeof x=="function"?x(be):x)});var yb;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(yb||(yb={}));var G5;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(G5||(G5={}));function SL(n){let e=yt.useContext(cm);return e||nr(!1),e}function ML(n,e){let{target:t,replace:r,state:i,preventScrollReset:o,relative:u,unstable_viewTransition:l}=e===void 0?{}:e,p=Kw(),v=bf(),x=dv(n,{relative:u});return yt.useCallback(M=>{if(oL(M,t)){M.preventDefault();let w=r!==void 0?r:nh(v)===nh(x);p(n,{replace:w,state:i,preventScrollReset:o,relative:u,unstable_viewTransition:l})}},[v,p,x,r,i,t,n,o,u,l])}function TL(n,e){e===void 0&&(e={});let t=yt.useContext(w8);t==null&&nr(!1);let{basename:r}=SL(yb.useViewTransitionState),i=dv(n,{relative:e.relative});if(!t.isTransitioning)return!1;let o=Rl(t.currentLocation.pathname,r)||t.currentLocation.pathname,u=Rl(t.nextLocation.pathname,r)||t.nextLocation.pathname;return fb(i.pathname,u)!=null||fb(i.pathname,o)!=null}function S8(n){return ge.jsx("div",{className:"body",children:n.children})}function fv(n){return ge.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[ge.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:n.heroBackground}),ge.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",color:"var(--white)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:[ge.jsx("h1",{children:n.title}),ge.jsx("h3",{children:n.subtitle})]})]})}const $p=7;function EL(n,e){switch(e){case n.FLOAT:return 4;case n.UNSIGNED_BYTE:return 1;case n.BYTE:case n.SHORT:case n.UNSIGNED_SHORT:default:throw new Error(`Unknown type ${e}`)}}class j5{constructor(e,t){ct(this,"program");this.gl=e,this.config=t;const r=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(r,t.vertexSource),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));const i=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(i,t.fragmentSource),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));const o=e.createProgram();if(e.attachShader(o,r),e.attachShader(o,i),t.transformFeedbackVaryings&&e.transformFeedbackVaryings(o,t.transformFeedbackVaryings,e.SEPARATE_ATTRIBS),e.linkProgram(o),!e.getProgramParameter(o,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(o));e.detachShader(o,r),e.deleteShader(r),e.detachShader(o,i),e.deleteShader(i),this.program=o}getAttributeLocation(e){return this.gl.getAttribLocation(this.program,e)}getUniformLocation(e){return this.gl.getUniformLocation(this.program,e)}setUniformValue(e,t,r){const i=this.gl,o=this.getUniformLocation(e);switch(t){case"bool":i.uniform1i(o,r[0]);break;case"bvec2":i.uniform2i(o,r[0],r[1]);break;case"bvec3":i.uniform3i(o,r[0],r[1],r[2]);break;case"bvec4":i.uniform4i(o,r[0],r[1],r[2],r[3]);break;case"bool[]":i.uniform1iv(o,r);break;case"bvec2[]":i.uniform2iv(o,r);break;case"bvec3[]":i.uniform3iv(o,r);break;case"bvec4[]":i.uniform4iv(o,r);break;case"int":i.uniform1i(o,r[0]);break;case"ivec2":i.uniform2i(o,r[0],r[1]);break;case"ivec3":i.uniform3i(o,r[0],r[1],r[2]);break;case"ivec4":i.uniform4i(o,r[0],r[1],r[2],r[3]);break;case"int[]":i.uniform1iv(o,r);break;case"ivec2[]":i.uniform2iv(o,r);break;case"ivec3[]":i.uniform3iv(o,r);break;case"ivec4[]":i.uniform4iv(o,r);break;case"float":i.uniform1f(o,r[0]);break;case"vec2":i.uniform2f(o,r[0],r[1]);break;case"vec3":i.uniform3f(o,r[0],r[1],r[2]);break;case"vec4":i.uniform4f(o,r[0],r[1],r[2],r[3]);break;case"float[]":i.uniform1fv(o,r);break;case"vec2[]":i.uniform2fv(o,r);break;case"vec3[]":i.uniform3fv(o,r);break;case"vec4[]":i.uniform4fv(o,r);break;case"mat2":i.uniformMatrix2fv(o,!1,r);break;case"mat3":i.uniformMatrix3fv(o,!1,r);break;case"mat4":i.uniformMatrix4fv(o,!1,r);break;default:throw Error(`Type ${t} not implemented.`)}}destroy(){this.gl.deleteProgram(this.program)}}class Po{constructor(e,t){ct(this,"buffer");ct(this,"dataPointType");this.gl=e,this.config=t;const r=e.createBuffer();if(e.bindBuffer(e.ARRAY_BUFFER,r),e.bufferData(e.ARRAY_BUFFER,t.data,t.changesOften?e.DYNAMIC_DRAW:e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.buffer=r,t.data.BYTES_PER_ELEMENT===4)this.dataPointType=e.FLOAT;else if(t.data.BYTES_PER_ELEMENT===2)this.dataPointType=e.UNSIGNED_SHORT;else if(t.data.BYTES_PER_ELEMENT===1)this.dataPointType=e.UNSIGNED_BYTE;else throw new Error("Buffer data may be Float32Array(gl.FLOAT), UInt16Array(gl.UNSIGNED_SHORT) or UInt8Array(gl.UNSIGNED_BYTE)")}updateData(e){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,e,this.config.changesOften?t.DYNAMIC_DRAW:t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.config.data=e}destroy(){this.gl.deleteBuffer(this.buffer)}getBufferContent(){const e=this.gl,t=this.config.data.length;let r;if(this.config.data instanceof Float32Array&&(r=new Float32Array(t)),this.config.data instanceof Uint16Array&&(r=new Uint16Array(t)),this.config.data instanceof Uint8Array)r=new Uint8Array(t);else throw Error("This should not have happened: this buffer does not seem to have a numeric array as data.");return e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.buffer),e.getBufferSubData(e.TRANSFORM_FEEDBACK_BUFFER,0,r),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),r}}let qp=class{constructor(e,t,r,i,o,u,l,p,v,x){this.gl=e,this.textureType=t,this.texture=r,this.level=i,this.internalformat=o,this.format=u,this.type=l,this.width=p,this.height=v,this.border=x}static getTextureParas(e,t,r){switch(t){case"ubyte1":return{internalFormat:e.LUMINANCE,format:e.LUMINANCE,type:e.UNSIGNED_BYTE,binData:new Uint8Array(r),allowsInterpolation:!0,allowsRenderingTo:!0};case"ubyte4":return{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE,binData:new Uint8Array(r),allowsInterpolation:!0,allowsRenderingTo:!0};case"byte32":return{internalFormat:e.RGBA32I,format:e.RGBA_INTEGER,type:e.INT,binData:new Int32Array(r),allowsInterpolation:!1,allowsRenderingTo:!0};case"float1":return{internalFormat:e.R32F,format:e.RED,type:e.FLOAT,binData:new Float32Array(r),allowsInterpolation:!1,allowsRenderingTo:!1};case"float4":return{internalFormat:e.RGBA32F,format:e.RGBA,type:e.FLOAT,binData:new Float32Array(r),allowsInterpolation:!1,allowsRenderingTo:!1}}}destroy(){this.gl.deleteTexture(this.texture)}getCurrentPixels(e){const t=this.gl,r=this.format,i=this.type;let o;if(i===t.UNSIGNED_BYTE)o=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(i===t.UNSIGNED_SHORT_5_6_5||i===t.UNSIGNED_SHORT_4_4_4_4||i===t.UNSIGNED_SHORT_5_5_5_1)o=new Uint16Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(i===t.FLOAT)o=new Float32Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else throw new Error(`Did not understand pixel data type ${i} for format ${r}`);if(t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE)return t.bindFramebuffer(t.FRAMEBUFFER,e),t.readPixels(0,0,this.width,this.height,r,i,o),t.bindFramebuffer(t.FRAMEBUFFER,null),o}};class zi extends qp{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none"),t.mipmaps||(t.mipmaps=!1);const r=e.createTexture();if(!r)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+$p),e.bindTexture(e.TEXTURE_2D,r);const i=0,o=e.RGBA,u=e.RGBA,l=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,i,o,u,l,t.image),t.mipmaps&&e.generateMipmap(e.TEXTURE_2D),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"?(t.mipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,null);let p,v;t.image instanceof HTMLImageElement?(p=t.image.naturalWidth,v=t.image.naturalHeight):(p=t.image.width,v=t.image.height),super(e,"ubyte4",r,i,o,u,l,p,v,0),this.config=t}static async loadImage(e){const t=new Image;return t.src=e,await t.decode(),t}}class W5 extends qp{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none");const{data:r,t:i}=t,o=e.createTexture();if(!o)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+$p),e.bindTexture(e.TEXTURE_2D,o);let u=0,l=0,p=0,v=[];Array.isArray(r)?(u=r.length,l=r[0].length,p=r[0][0].length,v=r.flat().flat()):(u=r.height,l=r.width,p=r.channels,v=Array.from(r.data));const x=0,M=0,w=qp.getTextureParas(e,i,v);if(p!==4&&e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,x,w.internalFormat,l,u,M,w.format,w.type,w.binData),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"){if(!w.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,i,o,x,w.internalFormat,w.format,w.type,l,u,M),this.config=t}}class Eo extends qp{constructor(e,t){const{width:r,height:i,type:o,edges:u,interpolate:l}=t;if(r<=0||i<=0)throw new Error("Width and height must be positive.");const p=e.createTexture();if(!p)throw new Error("No texture was created");const v=qp.getTextureParas(e,o,[]);if(e.activeTexture(e.TEXTURE0+$p),e.bindTexture(e.TEXTURE_2D,p),e.texImage2D(e.TEXTURE_2D,0,v.internalFormat,r,i,0,v.format,v.type,null),u==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):u==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),l==="linear"){if(!v.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else l==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,o,p,0,v.internalFormat,v.format,v.type,r,i,0),this.config=t}}class M8{constructor(e){ct(this,"attachedBuffers",{});ct(this,"indexBuffer");this.gl=e}attachBuffer(e,t){const r=this.gl,i=EL(r,e.dataPointType),o=t.location,u=t.nrInstances,l=t.normalize;switch(t.type){case"float":r.enableVertexAttribArray(o),r.vertexAttribPointer(o,1,e.dataPointType,l,1*i,0),u&&r.vertexAttribDivisor(o,u);break;case"vec2":r.enableVertexAttribArray(o),r.vertexAttribPointer(o,2,e.dataPointType,l,2*i,0),u&&r.vertexAttribDivisor(o,u);break;case"vec3":r.enableVertexAttribArray(o),r.vertexAttribPointer(o,3,e.dataPointType,l,3*i,0),u&&r.vertexAttribDivisor(o,u);break;case"vec4":r.enableVertexAttribArray(o),r.vertexAttribPointer(o,4,e.dataPointType,l,4*i,0),u&&r.vertexAttribDivisor(o,u);break;case"mat2":r.enableVertexAttribArray(o+0),r.vertexAttribPointer(o+0,2,e.dataPointType,l,4*i,0*2*i),u&&r.vertexAttribDivisor(o,u),r.enableVertexAttribArray(o+1),r.vertexAttribPointer(o+1,2,e.dataPointType,l,4*i,1*2*i),u&&r.vertexAttribDivisor(o+1,u);break;case"mat3":r.enableVertexAttribArray(o+0),r.vertexAttribPointer(o+0,3,e.dataPointType,l,9*i,0*3*i),u&&r.vertexAttribDivisor(o,u),r.enableVertexAttribArray(o+1),r.vertexAttribPointer(o+1,3,e.dataPointType,l,9*i,1*3*i),u&&r.vertexAttribDivisor(o+1,u),r.enableVertexAttribArray(o+2),r.vertexAttribPointer(o+2,3,e.dataPointType,l,9*i,2*3*i),u&&r.vertexAttribDivisor(o+2,u);break;case"mat4":r.enableVertexAttribArray(o+0),r.vertexAttribPointer(o+0,4,e.dataPointType,l,16*i,0*4*i),u&&r.vertexAttribDivisor(o,u),r.enableVertexAttribArray(o+1),r.vertexAttribPointer(o+1,4,e.dataPointType,l,16*i,1*4*i),u&&r.vertexAttribDivisor(o+1,u),r.enableVertexAttribArray(o+2),r.vertexAttribPointer(o+2,4,e.dataPointType,l,16*i,2*4*i),u&&r.vertexAttribDivisor(o+2,u),r.enableVertexAttribArray(o+3),r.vertexAttribPointer(o+3,4,e.dataPointType,l,16*i,3*4*i),u&&r.vertexAttribDivisor(o+3,u);break}this.attachedBuffers[t.location]={buffer:e,config:t}}detachBuffer(e){for(const[t,r]of Object.entries(this.attachedBuffers))r.buffer===e&&this.gl.disableVertexAttribArray(r.config.location)}attachIndexBuffer(e){const t=this.gl,r=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,r),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.indexBuffer=r}}class AL extends M8{constructor(t,r){super(t);ct(this,"vertexArray");this.config=r;const i=t.createVertexArray();this.vertexArray=i}destroy(t=!1){if(t){for(const[r,i]of Object.entries(this.attachedBuffers))this.detachBuffer(i.buffer),i.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}this.gl.deleteVertexArray(this.vertexArray)}}class CL extends M8{constructor(e,t){super(e),this.config=t}destroy(e=!1){if(e){for(const[t,r]of Object.entries(this.attachedBuffers))this.detachBuffer(r.buffer),r.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}}}class T8{constructor(e){ct(this,"boundBuffers",[]);this.gl=e}attachBuffer(e,t){const r=t??this.boundBuffers.length;this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,r,e.buffer)}detachBuffer(e){const t=this.boundBuffers.indexOf(e);this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null)}}class PL extends T8{constructor(t,r){super(t);ct(this,"transformFeedback");this.config=r;const i=t.createTransformFeedback();this.transformFeedback=i}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(t=!1){if(t)for(const r of this.boundBuffers)this.detachBuffer(r),r.destroy();this.gl.deleteTransformFeedback(this.transformFeedback)}}class RL extends T8{constructor(e,t){super(e),this.config=t}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(e=!1){if(e)for(const t of this.boundBuffers)this.detachBuffer(t),t.destroy()}}class $5{constructor(e,t){ct(this,"frameBuffer");ct(this,"boundTextures",[]);ct(this,"boundDepthRenderBuffer");this.gl=e,this.config=t;const r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),this.frameBuffer=r}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawBuffers(this.getBufferNames())}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}attachTexture(e,t=0){const r=this.gl;r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+t,r.TEXTURE_2D,e.texture,0),this.boundTextures[t]=e}attachDepthRenderBuffer(e){const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e.renderBuffer),this.boundDepthRenderBuffer=e}getBufferNames(){const e=[];for(let t=0;t<this.boundTextures.length;t++)t===0&&e.push(this.gl.COLOR_ATTACHMENT0),t===1&&e.push(this.gl.COLOR_ATTACHMENT1),t===2&&e.push(this.gl.COLOR_ATTACHMENT2),t===3&&e.push(this.gl.COLOR_ATTACHMENT3),t===4&&e.push(this.gl.COLOR_ATTACHMENT4),t===5&&e.push(this.gl.COLOR_ATTACHMENT5),t===6&&e.push(this.gl.COLOR_ATTACHMENT6),t===7&&e.push(this.gl.COLOR_ATTACHMENT7);return e}destroy(e=!1){if(e){for(const t of this.boundTextures)t.destroy();this.boundDepthRenderBuffer&&this.boundDepthRenderBuffer.destroy()}this.gl.deleteFramebuffer(this.frameBuffer)}}class pv{constructor(e,t){ct(this,"boundProgram");ct(this,"boundVertexArray");ct(this,"defaultVertexArray");ct(this,"boundBuffer");ct(this,"boundTextures",[]);ct(this,"boundFrameBuffer");ct(this,"boundTransformFeedback");ct(this,"defaultTransformFeedback");this.gl=e,this.config=t,t.viewport&&e.viewport(...t.viewport),t.depthTest&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)),t.cullFace&&e.enable(e.CULL_FACE),t.allowAlpha&&(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),(t.colorBufferFloat===void 0||t.colorBufferFloat===!0)&&(e.getExtension("EXT_color_buffer_float")||console.error(`Could not load extension "EXT_color_buffer_float". Won't be able to render to f32 textures!`)),this.defaultVertexArray=new CL(e,{}),this.boundVertexArray=this.defaultVertexArray,this.defaultTransformFeedback=new RL(e,{}),this.boundTransformFeedback=this.defaultTransformFeedback}setViewPort(e){this.config.viewport=e,this.gl.viewport(...this.config.viewport)}bindProgram(e,t=!0){t&&e===this.boundProgram||(this.gl.useProgram(e.program),this.boundProgram=e)}bindVertexArray(e,t=!0){t&&e===this.boundVertexArray||(this.gl.bindVertexArray(e.vertexArray),this.boundVertexArray=e)}unbindVertexArray(){this.boundVertexArray!==this.defaultVertexArray&&(this.gl.bindVertexArray(null),this.boundVertexArray=this.defaultVertexArray)}bindBuffer(e){e!==this.boundBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.boundBuffer=e)}unbindBuffer(){this.boundBuffer!==void 0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.boundBuffer=void 0)}bindFramebuffer(e){this.boundFrameBuffer!==e&&(e.bind(),this.boundFrameBuffer=e,e.boundTextures.length>0&&this.setViewPort([0,0,e.boundTextures[0].width,e.boundTextures[0].height]))}unbindFramebuffer(){this.boundFrameBuffer!==void 0&&(this.boundFrameBuffer.unbind(),this.boundFrameBuffer=void 0,this.setViewPort([0,0,this.gl.canvas.width,this.gl.canvas.height]))}bindBufferToDefaultVertexArray(e,t){this.unbindVertexArray(),this.bindBuffer(e),this.defaultVertexArray.attachBuffer(e,t),this.unbindBuffer()}bindBufferToVertexArray(e,t,r){this.bindVertexArray(e),this.bindBuffer(t),e.attachBuffer(t,r),this.unbindBuffer()}bindIndexToVertexArray(e,t){this.bindVertexArray(e),e.attachIndexBuffer(t)}bindTextureToFramebuffer(e,t,r=0){this.bindFramebuffer(e),e.attachTexture(t,r),t.type===this.gl.FLOAT&&this.config.colorBufferFloat===!1&&console.warn(`You're trying to add a float-texture to a framebuffer.
        WebGL cannot render to float-textures - this won't work.
        https://registry.khronos.org/OpenGL/specs/es/3.0/es_spec_3.0.pdf#page=143&zoom=100,168,666`),e===this.boundFrameBuffer&&this.setViewPort([0,0,t.width,t.height])}bindDepthToFramebuffer(e,t){this.bindFramebuffer(e),e.attachDepthRenderBuffer(t)}getUniformLocation(e,t){return e.getUniformLocation(t)}setUniformValue(e,t,r,i){this.bindProgram(e),e.setUniformValue(t,r,i)}bindTextureToSlot(e,t){const r=this.gl,i=e.texture,o=t??this.boundTextures.length;if(o>r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${o}.`);return o===$p&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${$p}).
                            If after this call another texture is built, your shader will now use that new texture instead of this one!
                            Consider using another bind point.`),r.activeTexture(r.TEXTURE0+o),r.bindTexture(r.TEXTURE_2D,i),this.boundTextures[o]=e,o}bindTexUniformToSlot(e,t,r){this.bindProgram(e);const i=e.getUniformLocation(t);this.gl.uniform1i(i,r)}updateVideoTexture(e){for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]===e&&e.update(t)}bindTextureToUniform(e,t,r,i){const o=this.bindTextureToSlot(r,i);this.bindTexUniformToSlot(e,t,o)}bindTransformFeedback(e){this.boundTransformFeedback!==e&&(this.boundTransformFeedback=e,e.bind())}unbindTransformFeedback(){this.boundTransformFeedback!==this.defaultTransformFeedback&&(this.boundTransformFeedback.unbind(),this.boundTransformFeedback,this.defaultTransformFeedback)}bindBufferToTransformFeedback(e,t,r){var i;this.bindTransformFeedback(e),(i=this.boundTransformFeedback)==null||i.attachBuffer(t,r)}clearScreen(e,t){t?this.bindFramebuffer(t):this.unbindFramebuffer(),this.gl.clearColor(...e),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}drawArrays(e,t,r,i){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer();const o=bc(this.gl,r);this.gl.drawArrays(o,0,i)}drawArraysInstanced(e,t,r,i,o){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const u=bc(this.gl,r);this.gl.drawArraysInstanced(u,0,i,o)}drawArraysToFramebuffer(e,t,r,i,o){o?this.bindFramebuffer(o):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const u=bc(this.gl,r);this.gl.drawArrays(u,0,i)}drawArraysInstancedToFramebuffer(e,t,r,i,o,u){u?this.bindFramebuffer(u):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const l=bc(this.gl,r);this.gl.drawArraysInstanced(l,0,i,o)}drawArraysToTransformFeedback(e,t,r,i,o,u){const l=this.gl,p=bc(this.gl,r);this.bindProgram(e),u||l.enable(l.RASTERIZER_DISCARD),this.bindTransformFeedback(o),l.beginTransformFeedback(p),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer(),this.gl.drawArrays(p,0,i),l.endTransformFeedback(),this.unbindTransformFeedback(),u||l.disable(l.RASTERIZER_DISCARD)}drawArraysToFramebufferAndTransformFeedback(e,t,r,i,o,u){const l=this.gl;u?this.bindFramebuffer(u):this.unbindFramebuffer();const p=bc(this.gl,r);this.bindProgram(e),this.bindTransformFeedback(o),l.beginTransformFeedback(p),t?this.bindVertexArray(t):this.unbindVertexArray(),this.gl.drawArrays(p,0,i),l.endTransformFeedback(),this.unbindTransformFeedback()}drawElements(e,t,r,i,o){if(this.bindProgram(e),this.bindVertexArray(t),!t.indexBuffer)throw new Error("VertexArray has no index buffer attached. Cannot draw elements");o?this.bindFramebuffer(o):this.unbindFramebuffer();let u=bc(this.gl,r);this.gl.drawElements(u,i,this.gl.UNSIGNED_SHORT,0)}destroy(e=!1){var t;this.boundTransformFeedback.destroy(e),this.boundFrameBuffer&&((t=this.boundFrameBuffer)==null||t.destroy(e));for(const r of this.boundTextures)r.destroy();this.boundBuffer&&this.boundBuffer.destroy(),this.boundVertexArray.destroy(e),this.boundProgram&&this.boundProgram.destroy()}}function bc(n,e){switch(e){case"triangles":return n.TRIANGLES;case"lines":return n.LINES;case"points":return n.POINTS}}function IL(n){var r;const e=n.program.vertexSource,t=n.program.fragmentSource;for(const[i,o]of Object.entries(n.inputs.attributes)){const u=`in ${o.config.type} ${i};`;!e.includes(u)&&!t.includes(u)&&console.error(`Neither vertex nor fragment shader contain the string: ${u}`)}for(const[i,o]of Object.entries(n.inputs.uniforms)){const u=`uniform ${o.type} ${i};`;!e.includes(u)&&!t.includes(u)&&console.error(`Neither vertex nor fragment shader contain the string: ${u}`)}for(const[i,o]of Object.entries(n.inputs.textures)){const u=`uniform sampler2D ${i};`;!e.includes(u)&&!t.includes(u)&&console.error(`Neither vertex nor fragment shader contain the string: ${u}`)}for(const[i,o]of Object.entries(((r=n.outputs.transformFeedback)==null?void 0:r.data)??{})){const u=` ${i};`;e.includes(u)||console.error(`Vertex source doesn't contain the string ${u}`)}}class Ua{constructor(e,t){ct(this,"program");ct(this,"vao");ct(this,"fb");ct(this,"tf");ct(this,"unboundFramebuffer");var r;this.gs=e,this.config=t,t.program instanceof j5?this.program=t.program:(IL(t),this.program=new j5(e.gl,{...t.program,transformFeedbackVaryings:Object.keys(((r=t.outputs.transformFeedback)==null?void 0:r.data)??[])})),this.vao=new AL(e.gl,{});for(const[i,o]of Object.entries(t.inputs.attributes)){const u=this.program.getAttributeLocation(i);this.gs.bindBufferToVertexArray(this.vao,o.buffer,{...o.config,location:u})}if(t.inputs.index&&this.gs.bindIndexToVertexArray(this.vao,t.inputs.index),this.config.outputs.frameBuffer){const i=this.config.outputs.frameBuffer;this.fb=new $5(e.gl,{});let o=0;for(const u of i.textures)e.bindTextureToFramebuffer(this.fb,u,o),o+=1;i.depth&&e.bindDepthToFramebuffer(this.fb,i.depth),this.fb.bind()}if(this.config.outputs.transformFeedback){this.tf=new PL(e.gl,{});let i=0;for(const[o,u]of Object.entries(this.config.outputs.transformFeedback.data))e.bindBufferToTransformFeedback(this.tf,u,i),i+=1}}activate(){this.gs.bindProgram(this.program),this.gs.bindVertexArray(this.vao);let e=0;for(const[t,r]of Object.entries(this.config.inputs.textures))this.gs.bindTextureToSlot(r,e),this.gs.bindTexUniformToSlot(this.program,t,e),e+=1;for(const[t,r]of Object.entries(this.config.inputs.uniforms))this.gs.setUniformValue(this.program,t,r.type,r.value);this.fb?this.gs.bindFramebuffer(this.fb):this.gs.unbindFramebuffer(),this.tf?this.gs.bindTransformFeedback(this.tf):this.gs.unbindTransformFeedback(),this.gs.setViewPort(this.config.settings.viewport)}updateUniform(e,t){const r=this.config.inputs.uniforms[e].type;this.config.inputs.uniforms[e].value=t,this.gs.setUniformValue(this.program,e,r,t)}updateTexture(e,t){let r=0;for(const[i,o]of Object.entries(this.config.inputs.textures))if(i===e){this.gs.bindTextureToUniform(this.program,e,o,r);break}else r+=1;this.config.inputs.textures[e]=t}updateViewport(e){this.gs.setViewPort(e),this.config.settings.viewport=e}updateFramebuffer(e){if(this.config.outputs.frameBuffer=e,e===void 0)this.gs.unbindFramebuffer(),this.unboundFramebuffer=this.fb,this.fb=void 0;else{const t=e;this.fb||(this.fb=this.unboundFramebuffer),this.fb||(console.warn("having to create new fb - is this on purpose?"),this.fb=new $5(this.gs.gl,{}));let r=0;for(const i of t.textures)this.gs.bindTextureToFramebuffer(this.fb,i,r),r+=1;t.depth&&this.gs.bindDepthToFramebuffer(this.fb,t.depth)}}draw(e){var i,o;e&&this.gs.clearScreen(e,this.fb??void 0);const t=this.gs.gl,r=this.config.settings;this.activate(),this.tf&&(this.gs.gl.beginTransformFeedback(bc(t,r.drawingMode)),((i=this.config.outputs.transformFeedback)==null?void 0:i.runFragmentShader)===!1&&t.enable(t.RASTERIZER_DISCARD)),this.config.inputs.index?this.fb?this.gs.drawElements(this.program,this.vao,r.drawingMode,this.config.inputs.index.length,this.fb):this.gs.drawElements(this.program,this.vao,r.drawingMode,this.config.inputs.index.length):this.fb?r.instanced?this.gs.drawArraysInstancedToFramebuffer(this.program,this.vao,r.drawingMode,r.nrVertices,r.instanced,this.fb):this.gs.drawArraysToFramebuffer(this.program,this.vao,r.drawingMode,r.nrVertices,this.fb):r.instanced?this.gs.drawArraysInstanced(this.program,this.vao,r.drawingMode,r.nrVertices,r.instanced):this.gs.drawArrays(this.program,this.vao,r.drawingMode,r.nrVertices),this.tf&&(t.endTransformFeedback(),((o=this.config.outputs.transformFeedback)==null?void 0:o.runFragmentShader)===!1&&t.disable(t.RASTERIZER_DISCARD))}destroy(e=!1){this.tf&&this.tf.destroy(e),this.fb&&this.fb.destroy(e),this.vao.destroy(e),this.program.destroy()}}function DL(n,e){const t=[];for(let r=0;r<e;r++)t.push(n(r));return t}function kL(n,e,t){const r=[];for(let i=0;i<e;i++){const o=[];for(let u=0;u<t;u++)o.push(n(i,u));r.push(o)}return r}function mv(n,e,t,r){const i=n-t/2,o=n+t/2,u=e+r/2,l=e-r/2;return[[i,u],[i,l],[o,l],[i,u],[o,l],[o,u]]}function q5(n,e,t=1,r=0){const i=n.gl.canvas,o=mv(0,0,2,2),u=new Po(n.gl,{data:new Float32Array(o.flat()),changesOften:!1});return new Ua(n,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos + 1.0) / 2.0;
                uv.y = 1.0 - uv.y;
            }`,fragmentSource:`#version 300 es
            precision highp float;
            in vec2 uv;
            uniform float blur;
            uniform vec2 texSize;
            uniform sampler2D tex;
            out vec4 fragColor;
            void main() {
                vec4 color = texture(tex, uv);

                if (blur > 0.0) {
                  vec2 dX = blur * vec2(1.0 / texSize.x, 0);
                  vec2 dY = blur * vec2(0, 1.0 / texSize.y);
                  color *= 0.4;
                  color += 0.6 / 4.0 * texture(tex, uv + dX);
                  color += 0.6 / 4.0 * texture(tex, uv - dX);
                  color += 0.6 / 4.0 * texture(tex, uv + dY);
                  color += 0.6 / 4.0 * texture(tex, uv - dY);
                }

                fragColor = vec4(color.xyz, ${t});
            }`},inputs:{attributes:{pos:{buffer:u,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{texSize:{type:"vec2",value:[e.width,e.height]},blur:{type:"float",value:[r]}},textures:{tex:e}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:o.length,viewport:[0,0,i.width,i.height]}})}class hm{constructor(e,t){ct(this,"doesLoop",!1);ct(this,"lastRenderStart",+document.timeline.currentTime);this.loopTime=e,this.callback=t}loop(){const e=+document.timeline.currentTime;this.loopTime-(e-this.lastRenderStart)<0&&(this.lastRenderStart=e,this.callback(e)),this.doesLoop&&requestAnimationFrame(()=>this.loop())}startLoop(){this.doesLoop=!0,this.loop()}stopLoop(){this.doesLoop=!1}}class LL{constructor(e,t){ct(this,"movement1");ct(this,"movement2");ct(this,"pt1");ct(this,"pt2");ct(this,"i",0);const r=e.canvas,i=new pv(e,{allowAlpha:!0}),o=t.nrParticles,u=new zi(e,{image:t.sdfImg,interpolate:"linear",edges:"clamp",mipmaps:!0}),l=DL(()=>[(Math.random()*2-1)*.8,(Math.random()*2-1)*.8,0,0],o),p=new Po(e,{data:new Float32Array(l.flat()),changesOften:!1}),v=new Po(e,{data:new Float32Array(l.flat()),changesOften:!1}),x=new Eo(e,{width:r.width,height:r.height,type:"float4",interpolate:"none",edges:"clamp"}),M=new Eo(e,{width:r.width,height:r.height,type:"float4",interpolate:"none",edges:"clamp"}),w=new Ua(i,{program:{vertexSource:`#version 300 es
            in vec4 offset;
            uniform vec3 pointerPos;
            uniform vec2 lastPosTexSize;
            uniform vec2 sdfTextureSize;
            uniform sampler2D lastPosTex;
            uniform sampler2D sdfTexture;
            out vec4 offsetNew;

            float particleSize = 10.0;
            vec2 dxdyPos() {
                return vec2(particleSize / lastPosTexSize.x, particleSize / lastPosTexSize.y);
            }
            vec2 dxdySdf() {
              return vec2(1.0 / sdfTextureSize.x, 1.0 / sdfTextureSize.y);
            }

            vec4 sampleQuadrant(vec2 uv, vec2 dPrimary, vec2 dSecondary, sampler2D tex, int level) {
                vec4 data = vec4(0);

                if (level > -2) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.0 * dSecondary);
                }
                if (level > -1) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.1 * dSecondary);
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary - 0.1 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.0 * dSecondary);
                }
                if (level > 0) {
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.3 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary - 0.3 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.0 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.5 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary - 0.5 * dSecondary);
                }
                if (level > 1) {
                  data += 1.00 * texture(tex, uv + 1.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary - 1.0 * dSecondary);
                }
                if (level > 2) {
                  data += 0.50 * texture(tex, uv + 2.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary - 1.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary + 2.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary - 2.0 * dSecondary);
                }
                if (level > 3) {
                  data += 0.25 * texture(tex, uv + 3.0 * dPrimary + 0.0 * dSecondary);
                }
                return data;
            }

            vec4 sampleRight(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(dx, 0.0);
                vec2 dSecondary = vec2(0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleLeft(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(-dx, 0.0);
                vec2 dSecondary = vec2( 0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleTop(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleBottom(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, -dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            void main() {

                vec2 pos = offset.xy;
                vec2 speed = offset.zw;
                vec2 uv = (pos + 1.0) / 2.0;

                vec2 uvSdf = vec2(uv.x, uv.y);
                float dxSdf = dxdySdf().x;
                float dySdf = dxdySdf().y;
                float dist    = texture(sdfTexture, uvSdf).x;
                float dist_px = sampleRight (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_mx = sampleLeft  (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_py = sampleTop   (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_my = sampleBottom(uvSdf, dxdySdf(), sdfTexture, 3).x;
    
                float dDistdx = (dist_px - dist_mx) / (2.0 * dxSdf);
                float dDistdy = (dist_py - dist_my) / (2.0 * dySdf);
                float sign = 1.0;
                // if (dist >= 0.7) {
                //   sign *= -1.0;
                // }
                vec2 textAttractionForce = sign * vec2(dDistdx, dDistdy);



                float dxPos = dxdyPos().x;
                float dyPos = dxdyPos().y;
                vec4 presenceRight  = sampleRight (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceLeft   = sampleLeft  (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceTop    = sampleTop   (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceBottom = sampleBottom(uv, dxdyPos(), lastPosTex, 4);
                float pr = presenceRight.x * presenceRight.w;
                float pl = presenceLeft.x * presenceLeft.w;
                float pt = presenceTop.x * presenceTop.w;
                float pb = presenceBottom.x * presenceBottom.w;
                float dpdx = (pr - pl) / (2.0 * dxPos);
                float dpdy = (pt - pb) / (2.0 * dyPos);
                vec2 particleRepulsionForce = -0.0001 * vec2(dpdx, dpdy);



                vec2 mouseRepulsionForce = vec2(0);
                if (pointerPos.z > 0.5) {
                  vec2 mousePos = pointerPos.xy;
                  vec2 mouseDir = mousePos - pos;
                  float mouseDist = length(mouseDir);
                  if (mouseDist < 0.7) {
                    float mouseProx = (0.7 - mouseDist) / 0.7;
                    mouseRepulsionForce = -1.0 * (mouseProx * mouseProx) * mouseDir;
                  }
                }

                

                vec2 newSpeed = 0.800 * speed 
                              + 0.800 * particleRepulsionForce 
                              + 0.005 * textAttractionForce
                              + 2.0 * mouseRepulsionForce;
                vec2 newPos = pos + 0.04 * newSpeed;


                if (newPos.x < -1.0) {
                  newPos.x = 1.0 - (-1.0 - newPos.x);
                }
                if (newPos.x > 1.0) {
                  newPos.x = -1.0 + (1.0 - newPos.x);
                }
                if (newPos.y < -1.0) {
                  newPos.y = 1.0 - (-1.0 - newPos.y);
                }
                if (newPos.y > 1.0) {
                  newPos.y = -1.0 + (1.0 - newPos.y);
                }

                gl_Position = vec4(newPos, 0, 1);
                gl_PointSize = particleSize;
                offsetNew = vec4(newPos, newSpeed);
            }`,fragmentSource:`#version 300 es
            precision highp float;
            out vec4 fragColor;
            void main() {
                fragColor = vec4(1, 1, 1, 0.8);
            }`},inputs:{attributes:{offset:{buffer:p,config:{normalize:!1,nrInstances:0,type:"vec4"}}},uniforms:{lastPosTexSize:{type:"vec2",value:[x.width,x.height]},sdfTextureSize:{type:"vec2",value:[u.width,u.height]},pointerPos:{type:"vec3",value:[0,0,0]}},textures:{sdfTexture:u,lastPosTex:x}},outputs:{transformFeedback:{data:{offsetNew:v},runFragmentShader:!0},frameBuffer:{textures:[M]}},settings:{drawingMode:"points",instanced:!1,nrVertices:o,viewport:[0,0,r.width,r.height]}}),A=new Ua(i,{...w.config,program:w.program,inputs:{...w.config.inputs,attributes:{...w.config.inputs.attributes,offset:{buffer:v,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{...w.config.inputs.textures,lastPosTex:M}},outputs:{...w.config.outputs,transformFeedback:{data:{offsetNew:p},runFragmentShader:!0},frameBuffer:{textures:[x]}}}),k=q5(i,M,t.opacity,t.blur),z=q5(i,x,t.opacity,t.blur);this.movement1=w,this.movement2=A,this.pt1=k,this.pt2=z}step(e){this.i%2===0?(this.movement1.updateUniform("pointerPos",e.pointerPos),this.movement1.draw([0,0,0,0]),this.pt1.draw()):(this.movement2.updateUniform("pointerPos",e.pointerPos),this.movement2.draw([0,0,0,0]),this.pt2.draw()),this.i++}destroy(e){this.pt2.destroy(e),this.pt1.destroy(e),this.movement2.destroy(e),this.movement1.destroy(e)}}class zL{constructor(){ct(this,"looper");ct(this,"p");ct(this,"canvas");ct(this,"destroyed",!1);ct(this,"pointerPos",[0,0,0]);ct(this,"onMouseMove",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect(),r=(e.clientX-t.left)/this.canvas.clientWidth,i=(e.clientY-t.top)/this.canvas.clientHeight;this.pointerPos[0]=(r-.5)*2,this.pointerPos[1]=(i-.5)*2,this.pointerPos[2]=1});ct(this,"timeout");ct(this,"onDevMove",e=>{let t=0;e.gamma&&(t=e.gamma/90);let r=0;e.beta&&(r=e.beta/180),this.pointerPos[0]=t,this.pointerPos[1]=r,this.pointerPos[2]=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.pointerPos[2]=0,60)})}async init(e){const t=await zi.loadImage("/c_c_fat_sdf.jpg");if(this.destroyed)return;const r=e.getContext("webgl2");this.p=new LL(r,{sdfImg:t,nrParticles:Math.max(e.width*3,3e3),opacity:.1,blur:0}),this.looper=new hm(30,()=>{var i;(i=this.p)==null||i.step({pointerPos:this.pointerPos}),this.pointerPos[2]=0}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove)}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,r;(e=this.looper)==null||e.stopLoop(),(t=this.p)==null||t.destroy(!0),this.p=void 0,(r=this.canvas)==null||r.removeEventListener("mousemove",this.onMouseMove),this.canvas=void 0,this.destroyed=!0}}function FL(){const n=yt.useRef(null);return yt.useEffect(()=>{const e=new zL;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(180deg, var(--white) 0%, var(--primary4) 100%)",position:"relative"},children:ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"all"}})})}function Od(n){return ge.jsx("div",{style:{height:n.height??"0",width:n.width??"0"}})}function NL(n){return ge.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"100%",padding:"0.25rem",position:"relative",background:"var(--primary2)"},children:ge.jsx("div",{style:{borderRadius:"100%",position:"absolute",width:"calc(100% - 2 * 0.25rem)",height:"calc(100% - 2 * 0.25rem)",overflow:"hidden",background:"var(--white)"},children:n.children})})}function OL(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`M 0 0 
  L 1 0
  L 1 0.9 
  C 0.8 -1.1   0.2 1.0   0 0.9
  Z`})})}function BL(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`
        M 0 0 
        C 0.3 1.8    0.5 0.5    1 0 
        L 1 1 
        L 0 1
        Z`})})}function UL(){return ge.jsx("div",{style:{minHeight:"5rem"},children:ge.jsxs("div",{style:{position:"relative",padding:"2rem",display:"flex",flexWrap:"wrap",flexDirection:"row",alignContent:"space-around",justifyContent:"space-around",width:"100%"},children:[ge.jsx("div",{children:"Site made by codeandcolors"}),ge.jsx("div",{children:ge.jsx(Ey,{to:"/imprint",children:"Imprint"})}),ge.jsx("div",{children:ge.jsx(Ey,{to:"/resources",children:"Resources"})})]})})}function VL(n){if(n.hasAttribute("width"))return{x:+n.getAttribute("width"),y:+n.getAttribute("height")};if(n.getBBox){const e=n.getBBox();return{x:e.width,y:e.height}}else return console.warn("Could not determine dimensions of svg-element ",n),{x:0,y:0}}function X5(n){var r;if((r=n.viewBox)!=null&&r.baseVal){const i=n.viewBox.baseVal;return{x:i.x+i.width/2,y:i.y+i.height/2}}const e=E8(n),t=VL(n);return{x:e.x+t.x/2,y:e.y+t.y/2}}function E8(n){return{x:+n.getAttribute("x"),y:+n.getAttribute("y")}}function HL(n,e){return{x:n.x-e.x,y:n.y-e.y}}function GL(n,e){return{x:n.x+e.x,y:n.y+e.y}}function jL(n,e){return{x:n.x*e,y:n.y*e}}class WL{constructor(){ct(this,"svg");ct(this,"io");ct(this,"doesLoop",!1)}init(e){this.doesLoop=!0,this.io=new IntersectionObserver((t,r)=>{for(const i of t)if(i.intersectionRatio>.7){const o=i.target;this.doesLoop&&(this.implode(o),r.unobserve(i.target))}}),this.io.observe(e)}delete(){var e,t;this.svg&&((e=this.io)==null||e.unobserve(this.svg)),(t=this.io)==null||t.disconnect(),this.doesLoop=!1}implode(e){const t=X5(e),r=[],i=Array.from(e.childNodes).filter(l=>!["defs"].includes(l.tagName));if(i.length<=0)return;for(const l of i){const p=E8(l);let v=X5(l);v.x===0&&v.y===0&&(v=structuredClone(t)),r.push({childTL:p,childCenter:v}),this.implode(l)}let o=30;const u=l=>{l<0||(i.map((p,v)=>{const{childTL:x,childCenter:M}=r[v],w=HL(M,t),A=GL(x,jL(w,l/o));p.setAttribute("x",A.x+""),p.setAttribute("y",A.y+"")}),this.doesLoop&&setTimeout(()=>requestAnimationFrame(()=>u(l-1)),30))};u(o)}}function $L(n){const e=yt.useRef(null);return yt.useEffect(()=>{const t=new WL;if(e.current){const i=e.current.firstChild;t.init(i)}return()=>t.delete()},[e.current]),ge.jsx("div",{ref:e,style:{width:"100%",height:"100%"},children:n.children})}let qL=class{constructor(){ct(this,"t");ct(this,"a");ct(this,"b");ct(this,"sa");ct(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const t=this.sa*Math.sin(this.a*this.t),r=this.sb*Math.sin(this.b*this.t),i=.5+t/2,o=.5+r/2;return{x:i,y:o}}};class XL{constructor(e=[]){ct(this,"balls",[]);ct(this,"paths",[]);ct(this,"dt",.02);ct(this,"loopHandle");ct(this,"j",0);this.circles=e;for(const t of this.circles)this.balls.push({pos:{x:+t.getAttribute("cx"),y:+t.getAttribute("cy")},r:+t.getAttribute("r")}),this.paths.push(new qL)}loop(){const e=this.circles,t=this.balls,r=this.paths,i=this.dt;for(let u=0;u<e.length;u++){const l=t[u],p=e[u],v=r[u],{x,y:M}=v.advance(i);l.pos.x=x,l.pos.y=M,p.setAttribute("cx",l.pos.x+""),p.setAttribute("cy",l.pos.y+""),p.setAttribute("r",l.r+"")}const o=setTimeout(()=>requestAnimationFrame(()=>this.loop()),100);this.loopHandle=o,this.j+=1}cancelLoop(){clearTimeout(this.loopHandle)}}function ZL(n){const e=yt.useRef(null);return yt.useEffect(()=>{let t;if(e.current){const r=e.current.querySelectorAll("circle");t=new XL(Array.from(r)),t.loop()}return()=>t==null?void 0:t.cancelLoop()},[e.current]),ge.jsxs("div",{style:{position:"relative",background:"var(--white)"},children:[ge.jsxs("svg",{ref:e,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},viewBox:"0 0 1 1",preserveAspectRatio:"none",children:[ge.jsx("defs",{children:ge.jsx("filter",{id:"bbblurry-filter",children:ge.jsx("feGaussianBlur",{stdDeviation:"0.008",in:"SourceGraphic",edgeMode:"none",result:"blur"})})}),ge.jsxs("g",{filter:"url(#bbblurry-filter)",children:[ge.jsx("rect",{x:"-100",y:"-100",width:"200",height:"200",fill:"none"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--primary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--secondary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--tertiary4)",opacity:"0.3"})]})]}),ge.jsx("div",{style:{position:"relative"},children:n.children})]})}function wf(n){return ge.jsxs("div",{style:{position:"relative"},children:[n.hero,ge.jsxs("div",{style:{zIndex:1,position:"relative",marginTop:"-5rem",marginBottom:"-5rem"},children:[n.logo&&ge.jsx("div",{style:{zIndex:1,position:"absolute",width:"max(10%, 75px)",left:"max(5%, 1rem)",aspectRatio:"1/1"},children:ge.jsx(NL,{children:ge.jsx($L,{children:n.logo})})}),ge.jsx("div",{style:{width:"100%",height:"5.1rem"},children:ge.jsx(BL,{fill:"var(--white)"})}),ge.jsxs("div",{children:[ge.jsx(Od,{height:"5rem"}),ge.jsx(S8,{children:n.children}),ge.jsx(Od,{height:"5rem"})]}),ge.jsx("div",{style:{width:"100%",height:"5.1rem"},children:ge.jsx(OL,{fill:"var(--white)"})})]}),ge.jsxs("div",{style:{position:"relative"},children:[ge.jsxs(ZL,{children:[ge.jsx(Od,{height:"5rem"}),n.footerContent,ge.jsx(Od,{height:"5rem"}),ge.jsx(UL,{})]}),ge.jsx("div",{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"none",background:"linear-gradient(0deg, var(--primary2-transparent25) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 90%, var(--primary2-transparent25) 100%)",opacity:.5}})]})]})}function YL(){return ge.jsxs(wf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(fv,{title:"",subtitle:"",heroBackground:ge.jsx(FL,{})})}),logo:ge.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",children:ge.jsxs("svg",{x:"0.1",y:"0.25",width:"0.8",height:"0.5",viewBox:"0 0 1 1",children:[ge.jsxs("defs",{children:[ge.jsx("path",{id:"envelopA",d:"M 0 0 L 1 0 L 1 0.2 L 0.5 0.6 L 0 0.2 Z",fill:"black"}),ge.jsx("path",{id:"envelopB",d:"M 0 0.2 L 0.5 0.6 L 1 0.2 L 1 1 L 0 1 Z",fill:"black"})]}),ge.jsx("use",{href:"#envelopA",x:"0",y:"0.0"}),ge.jsx("use",{href:"#envelopB",x:"0",y:"0.2"})]})}),footerContent:ge.jsxs(S8,{children:[ge.jsx("h2",{children:"See you soon!"}),ge.jsx(Od,{height:"5rem"})]}),children:[ge.jsx("h1",{children:"Contact us!"}),ge.jsx("p",{children:"We'll be happy to answer all your requests."}),ge.jsx("div",{className:"ctaContainer",children:ge.jsx("a",{href:"mailto:michael.langbein@codeandcolors.net",children:ge.jsx("button",{type:"button",className:"ctaButton",children:"Send Email"})})})]})}function KL(){return ge.jsx("div",{children:ge.jsx("h1",{children:"Error"})})}function A8(){const n=Kw();return ge.jsx("div",{className:"ctaContainer",children:ge.jsxs("div",{className:"CTA",children:[ge.jsx("div",{children:ge.jsx("h2",{children:"Let's build something great together!"})}),ge.jsx("button",{className:"ctaButton",onClick:()=>n("/contact"),children:"Contact us"})]})})}class JL{constructor(e,t){ct(this,"graph");const r=e.getContext("webgl2"),i=new pv(r,{colorBufferFloat:!1,allowAlpha:!0}),o=mv(0,0,2,2),u=new Po(r,{data:new Float32Array(o.flat()),changesOften:!1}),l=new zi(r,{image:t.heightImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),p=new zi(r,{image:t.rgbImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),v=new zi(r,{image:t.waterNormal1,interpolate:"linear",edges:"repeat",mipmaps:!0}),x=new zi(r,{image:t.waterNormal2,interpolate:"linear",edges:"repeat",mipmaps:!0}),M=new zi(r,{image:t.clouds,interpolate:"linear",edges:"mirror"}),w=new Ua(i,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos - 1.0) / 2.0;
                uv.x = 1.0 - uv.x;
            }
        `,fragmentSource:`#version 300 es
            precision mediump float;
            in vec2 uv;
            uniform sampler2D imageTex;
            uniform sampler2D heightTex;
            uniform sampler2D waterNormalTexture1;
            uniform sampler2D waterNormalTexture2;
            uniform sampler2D cloudTexture;
            uniform float mousex;
            uniform float mousey;
            uniform float time;
            uniform vec2 textureSize;
            out vec4 fragColor;

            vec4 lighten(vec4 baseColor, vec4 lightenWith, float degree) {
              vec4 distance = lightenWith - baseColor;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 darken(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x -= degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y -= degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z -= degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 glow(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            void main() {
                float waterLine = ${t.waterLine};
                float dx = 1.0 / textureSize.x;
                float dy = 1.0 / textureSize.y;

                // 0. data

                vec2 sunPos = normalize(vec2(mousex * 2.0 - 1.0, mousey * 2.0 - 1.0));
                vec2 water1point = uv * 3.0 + 0.02 * time * vec2(0.1, 0.2);
                vec2 water2point = uv * 3.0 + 0.02 * time * vec2(-0.3, 0.1);
                vec4 waterNorm1 = 2.0 * (texture(waterNormalTexture1,  water1point) - 0.5);
                vec4 waterNorm2 = 2.0 * (texture(waterNormalTexture2,  water2point) - 0.5);
                vec4 waterNorm = mix(waterNorm1, waterNorm2, 0.5);
                vec2 waterNormXY = waterNorm.rg;

                // 1. perspective

                vec4 landColor = vec4(0);
                float height = texture(heightTex, uv).x;
                if (height >= waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + height * ${t.strength} * mouse;
                  landColor = texture(imageTex, queryPoint);
                }

                // 2. water reflection

                vec4 reflectionColor = vec4(0);
                float waveHeight = waterNorm.z;
                float reflection = dot(waterNormXY, sunPos);
                reflection *= reflection;
                if (height < waterLine) {
                  float proxToCenter = 0.25 - length(uv - vec2(0.5));
                  reflectionColor = vec4(reflection);
                }

                // 3. surf

                vec4 surfColor = vec4(0);
                float distFromShore = waterLine - height;
                float surf = sin(distFromShore * 200.0 + time * 1.0);
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  surfColor = vec4(surf, surf, surf, 1);
                }


                // 4. water refraction

                vec4 refractionColor = vec4(0);
                if (height < waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + (height + surf + waveHeight * 0.5) * ${t.strength} * mouse;
                  refractionColor = texture(imageTex, queryPoint);
                }


                // 5. clouds

                vec2 cloudUv = uv * 0.2;
                vec2 cloudTimeOffset = vec2(-0.005 * time, 0);
                vec2 cloudHeightOffset = 0.005 * vec2(mousex, mousey);
                vec4 cloudColor = texture(cloudTexture, cloudUv + cloudTimeOffset + cloudHeightOffset);

                
                // 6. mixing

                vec4 baseColor = landColor + refractionColor;
                vec4 combinedColor = baseColor;
                if (height < waterLine) {
                  // combinedColor = mix(combinedColor, reflectionColor, reflection);
                  // combinedColor = lighten(combinedColor, vec4(1.0), reflection);
                  combinedColor = darken(combinedColor, vec4(0.0), reflection);
                  // combinedColor = lighten(combinedColor, surfColor, 1.0 - distFromShore / 0.1);
                }
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  combinedColor.xyz *= (1.0 + surf * 0.25);
                }
                // combinedColor = mix(combinedColor, vec4(0), cloudColor.w * cloudColor.w * 0.2);
                combinedColor = glow(combinedColor, vec4(0), cloudColor.w * cloudColor.w * cloudColor.w * 2.0);

                fragColor = combinedColor;
            }
        `},inputs:{attributes:{pos:{buffer:u,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{heightTex:l,imageTex:p,waterNormalTexture1:v,waterNormalTexture2:x,cloudTexture:M},uniforms:{mousex:{type:"float",value:[0]},mousey:{type:"float",value:[0]},time:{type:"float",value:[0]},textureSize:{type:"vec2",value:[p.width,p.height]}}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:o.length,viewport:[0,0,e.width,e.height]}});this.graph=w}step(e){this.graph.updateUniform("mousex",[e.mousex]),this.graph.updateUniform("mousey",[e.mousey]),this.graph.updateUniform("time",[e.time]),this.graph.draw()}destroy(e){var t;(t=this.graph)==null||t.destroy(e)}}class QL{constructor(){ct(this,"looper");ct(this,"islands");ct(this,"canvas");ct(this,"destroyed",!1);ct(this,"mousex",0);ct(this,"mousey",0);ct(this,"onMouseMove",e=>{if(!this.canvas)return;const t=e.clientX/this.canvas.clientWidth,r=1-e.clientY/this.canvas.clientHeight;this.mousex=t,this.mousey=r});ct(this,"onDevMove",e=>{let t=0;e.gamma&&(t=e.gamma/90);let r=0;e.beta&&(r=e.beta/180);const i=Math.max(-1,Math.min(t*3,1)),o=Math.max(-1,Math.min(r*3,1));this.mousex=(i+1)/2,this.mousey=(o+1)/2})}async init(e){const t=await zi.loadImage("/hawaii_depth.jpg"),r=await zi.loadImage("/hawaii_bg2.jpg"),i=await zi.loadImage("/water-normal.png"),o=await zi.loadImage("/water-normal2.png"),u=await zi.loadImage("/clouds.png");this.destroyed||(this.islands=new JL(e,{heightImage:t,rgbImage:r,strength:.004,waterLine:.83,waterNormal1:i,waterNormal2:o,clouds:u}),this.looper=new hm(30,l=>{var p;(p=this.islands)==null||p.step({mousex:this.mousex,mousey:this.mousey,time:l/1e3})}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove))}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,r;(e=this.looper)==null||e.stopLoop(),(t=this.islands)==null||t.destroy(!0),this.islands=void 0,(r=this.canvas)==null||r.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("deviceorientationabsolute",this.onDevMove),this.canvas=void 0,this.destroyed=!0}}function ez(){const n=yt.useRef(null);return yt.useEffect(()=>{const e=new QL;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,t.width<600&&(t.width=t.clientWidth*devicePixelRatio,t.height=t.clientHeight*devicePixelRatio),e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}const tz="modulepreload",nz=function(n){return"/"+n},Z5={},Na=function(e,t,r){let i=Promise.resolve();if(t&&t.length>0){const o=document.getElementsByTagName("link"),u=document.querySelector("meta[property=csp-nonce]"),l=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));i=Promise.all(t.map(p=>{if(p=nz(p),p in Z5)return;Z5[p]=!0;const v=p.endsWith(".css"),x=v?'[rel="stylesheet"]':"";if(!!r)for(let A=o.length-1;A>=0;A--){const k=o[A];if(k.href===p&&(!v||k.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${p}"]${x}`))return;const w=document.createElement("link");if(w.rel=v?"stylesheet":tz,v||(w.as="script",w.crossOrigin=""),w.href=p,l&&w.setAttribute("nonce",l),document.head.appendChild(w),v)return new Promise((A,k)=>{w.addEventListener("load",A),w.addEventListener("error",()=>k(new Error(`Unable to preload CSS for ${p}`)))})}))}return i.then(()=>e()).catch(o=>{const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=o,window.dispatchEvent(u),!u.defaultPrevented)throw o})};var rz=function(e,t,r){var i=document.head||document.getElementsByTagName("head")[0],o=document.createElement("script");typeof t=="function"&&(r=t,t={}),t=t||{},r=r||function(){},o.type=t.type||"text/javascript",o.charset=t.charset||"utf8",o.async="async"in t?!!t.async:!0,o.src=e,t.attrs&&iz(o,t.attrs),t.text&&(o.text=""+t.text);var u="onload"in o?Y5:az;u(o,r),o.onload||Y5(o,r),i.appendChild(o)};function iz(n,e){for(var t in e)n.setAttribute(t,e[t])}function Y5(n,e){n.onload=function(){this.onerror=this.onload=null,e(null,n)},n.onerror=function(){this.onerror=this.onload=null,e(new Error("Failed to load "+this.src),n)}}function az(n,e){n.onreadystatechange=function(){this.readyState!="complete"&&this.readyState!="loaded"||(this.onreadystatechange=null,e(null,n))}}var sz=function(e){return oz(e)&&!lz(e)};function oz(n){return!!n&&typeof n=="object"}function lz(n){var e=Object.prototype.toString.call(n);return e==="[object RegExp]"||e==="[object Date]"||hz(n)}var cz=typeof Symbol=="function"&&Symbol.for,uz=cz?Symbol.for("react.element"):60103;function hz(n){return n.$$typeof===uz}function dz(n){return Array.isArray(n)?[]:{}}function Xp(n,e){return e.clone!==!1&&e.isMergeableObject(n)?cf(dz(n),n,e):n}function fz(n,e,t){return n.concat(e).map(function(r){return Xp(r,t)})}function pz(n,e){if(!e.customMerge)return cf;var t=e.customMerge(n);return typeof t=="function"?t:cf}function mz(n){return Object.getOwnPropertySymbols?Object.getOwnPropertySymbols(n).filter(function(e){return Object.propertyIsEnumerable.call(n,e)}):[]}function K5(n){return Object.keys(n).concat(mz(n))}function C8(n,e){try{return e in n}catch{return!1}}function gz(n,e){return C8(n,e)&&!(Object.hasOwnProperty.call(n,e)&&Object.propertyIsEnumerable.call(n,e))}function yz(n,e,t){var r={};return t.isMergeableObject(n)&&K5(n).forEach(function(i){r[i]=Xp(n[i],t)}),K5(e).forEach(function(i){gz(n,i)||(C8(n,i)&&t.isMergeableObject(e[i])?r[i]=pz(i,t)(n[i],e[i],t):r[i]=Xp(e[i],t))}),r}function cf(n,e,t){t=t||{},t.arrayMerge=t.arrayMerge||fz,t.isMergeableObject=t.isMergeableObject||sz,t.cloneUnlessOtherwiseSpecified=Xp;var r=Array.isArray(e),i=Array.isArray(n),o=r===i;return o?r?t.arrayMerge(n,e,t):yz(n,e,t):Xp(e,t)}cf.all=function(e,t){if(!Array.isArray(e))throw new Error("first argument should be an array");return e.reduce(function(r,i){return cf(r,i,t)},{})};var vz=cf,P8=vz,_z=Object.create,gv=Object.defineProperty,xz=Object.getOwnPropertyDescriptor,bz=Object.getOwnPropertyNames,wz=Object.getPrototypeOf,Sz=Object.prototype.hasOwnProperty,Mz=(n,e)=>{for(var t in e)gv(n,t,{get:e[t],enumerable:!0})},R8=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of bz(e))!Sz.call(n,i)&&i!==t&&gv(n,i,{get:()=>e[i],enumerable:!(r=xz(e,i))||r.enumerable});return n},Jw=(n,e,t)=>(t=n!=null?_z(wz(n)):{},R8(e||!n||!n.__esModule?gv(t,"default",{value:n,enumerable:!0}):t,n)),Tz=n=>R8(gv({},"__esModule",{value:!0}),n),I8={};Mz(I8,{callPlayer:()=>Vz,getConfig:()=>Bz,getSDK:()=>Oz,isBlobUrl:()=>Gz,isMediaStream:()=>Hz,lazy:()=>Pz,omit:()=>Uz,parseEndTime:()=>zz,parseStartTime:()=>Lz,queryString:()=>Nz,randomString:()=>Fz,supportsWebKitPresentationMode:()=>jz});var yv=Tz(I8),Ez=Jw(yt),Az=Jw(rz),Cz=Jw(P8);const Pz=n=>Ez.default.lazy(async()=>{const e=await n();return typeof e.default=="function"?e:e.default}),Rz=/[?&#](?:start|t)=([0-9hms]+)/,Iz=/[?&#]end=([0-9hms]+)/,vb=/(\d+)(h|m|s)/g,Dz=/^\d+$/;function D8(n,e){if(n instanceof Array)return;const t=n.match(e);if(t){const r=t[1];if(r.match(vb))return kz(r);if(Dz.test(r))return parseInt(r)}}function kz(n){let e=0,t=vb.exec(n);for(;t!==null;){const[,r,i]=t;i==="h"&&(e+=parseInt(r,10)*60*60),i==="m"&&(e+=parseInt(r,10)*60),i==="s"&&(e+=parseInt(r,10)),t=vb.exec(n)}return e}function Lz(n){return D8(n,Rz)}function zz(n){return D8(n,Iz)}function Fz(){return Math.random().toString(36).substr(2,5)}function Nz(n){return Object.keys(n).map(e=>`${e}=${n[e]}`).join("&")}function fx(n){return window[n]?window[n]:window.exports&&window.exports[n]?window.exports[n]:window.module&&window.module.exports&&window.module.exports[n]?window.module.exports[n]:null}const Zh={},Oz=function(e,t,r=null,i=()=>!0,o=Az.default){const u=fx(t);return u&&i(u)?Promise.resolve(u):new Promise((l,p)=>{if(Zh[e]){Zh[e].push({resolve:l,reject:p});return}Zh[e]=[{resolve:l,reject:p}];const v=x=>{Zh[e].forEach(M=>M.resolve(x))};if(r){const x=window[r];window[r]=function(){x&&x(),v(fx(t))}}o(e,x=>{x?(Zh[e].forEach(M=>M.reject(x)),Zh[e]=null):r||v(fx(t))})})};function Bz(n,e){return(0,Cz.default)(e.config,n.config)}function Uz(n,...e){const t=[].concat(...e),r={},i=Object.keys(n);for(const o of i)t.indexOf(o)===-1&&(r[o]=n[o]);return r}function Vz(n,...e){if(!this.player||!this.player[n]){let t=`ReactPlayer: ${this.constructor.displayName} player could not call %c${n}%c  `;return this.player?this.player[n]||(t+="The method was not available"):t+="The player was not available",console.warn(t,"font-weight: bold",""),null}return this.player[n](...e)}function Hz(n){return typeof window<"u"&&typeof window.MediaStream<"u"&&n instanceof window.MediaStream}function Gz(n){return/^blob:/.test(n)}function jz(n=document.createElement("video")){const e=/iPhone|iPod/.test(navigator.userAgent)===!1;return n.webkitSupportsPresentationMode&&typeof n.webkitSetPresentationMode=="function"&&e}var Qw=Object.defineProperty,Wz=Object.getOwnPropertyDescriptor,$z=Object.getOwnPropertyNames,qz=Object.prototype.hasOwnProperty,Xz=(n,e)=>{for(var t in e)Qw(n,t,{get:e[t],enumerable:!0})},Zz=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $z(e))!qz.call(n,i)&&i!==t&&Qw(n,i,{get:()=>e[i],enumerable:!(r=Wz(e,i))||r.enumerable});return n},Yz=n=>Zz(Qw({},"__esModule",{value:!0}),n),k8={};Xz(k8,{AUDIO_EXTENSIONS:()=>e4,DASH_EXTENSIONS:()=>q8,FLV_EXTENSIONS:()=>X8,HLS_EXTENSIONS:()=>n4,MATCH_URL_DAILYMOTION:()=>G8,MATCH_URL_FACEBOOK:()=>N8,MATCH_URL_FACEBOOK_WATCH:()=>O8,MATCH_URL_KALTURA:()=>$8,MATCH_URL_MIXCLOUD:()=>j8,MATCH_URL_MUX:()=>F8,MATCH_URL_SOUNDCLOUD:()=>L8,MATCH_URL_STREAMABLE:()=>B8,MATCH_URL_TWITCH_CHANNEL:()=>H8,MATCH_URL_TWITCH_VIDEO:()=>V8,MATCH_URL_VIDYARD:()=>W8,MATCH_URL_VIMEO:()=>z8,MATCH_URL_WISTIA:()=>U8,MATCH_URL_YOUTUBE:()=>_b,VIDEO_EXTENSIONS:()=>t4,canPlay:()=>Jz});var Kz=Yz(k8),J5=yv;const _b=/(?:youtu\.be\/|youtube(?:-nocookie|education)?\.com\/(?:embed\/|v\/|watch\/|watch\?v=|watch\?.+&v=|shorts\/|live\/))((\w|-){11})|youtube\.com\/playlist\?list=|youtube\.com\/user\//,L8=/(?:soundcloud\.com|snd\.sc)\/[^.]+$/,z8=/vimeo\.com\/(?!progressive_redirect).+/,F8=/stream\.mux\.com\/(?!\w+\.m3u8)(\w+)/,N8=/^https?:\/\/(www\.)?facebook\.com.*\/(video(s)?|watch|story)(\.php?|\/).+$/,O8=/^https?:\/\/fb\.watch\/.+$/,B8=/streamable\.com\/([a-z0-9]+)$/,U8=/(?:wistia\.(?:com|net)|wi\.st)\/(?:medias|embed)\/(?:iframe\/)?([^?]+)/,V8=/(?:www\.|go\.)?twitch\.tv\/videos\/(\d+)($|\?)/,H8=/(?:www\.|go\.)?twitch\.tv\/([a-zA-Z0-9_]+)($|\?)/,G8=/^(?:(?:https?):)?(?:\/\/)?(?:www\.)?(?:(?:dailymotion\.com(?:\/embed)?\/video)|dai\.ly)\/([a-zA-Z0-9]+)(?:_[\w_-]+)?(?:[\w.#_-]+)?/,j8=/mixcloud\.com\/([^/]+\/[^/]+)/,W8=/vidyard.com\/(?:watch\/)?([a-zA-Z0-9-_]+)/,$8=/^https?:\/\/[a-zA-Z]+\.kaltura.(com|org)\/p\/([0-9]+)\/sp\/([0-9]+)00\/embedIframeJs\/uiconf_id\/([0-9]+)\/partner_id\/([0-9]+)(.*)entry_id.([a-zA-Z0-9-_].*)$/,e4=/\.(m4a|m4b|mp4a|mpga|mp2|mp2a|mp3|m2a|m3a|wav|weba|aac|oga|spx)($|\?)/i,t4=/\.(mp4|og[gv]|webm|mov|m4v)(#t=[,\d+]+)?($|\?)/i,n4=/\.(m3u8)($|\?)/i,q8=/\.(mpd)($|\?)/i,X8=/\.(flv)($|\?)/i,xb=n=>{if(n instanceof Array){for(const e of n)if(typeof e=="string"&&xb(e)||xb(e.src))return!0;return!1}return(0,J5.isMediaStream)(n)||(0,J5.isBlobUrl)(n)?!0:e4.test(n)||t4.test(n)||n4.test(n)||q8.test(n)||X8.test(n)},Jz={youtube:n=>n instanceof Array?n.every(e=>_b.test(e)):_b.test(n),soundcloud:n=>L8.test(n)&&!e4.test(n),vimeo:n=>z8.test(n)&&!t4.test(n)&&!n4.test(n),mux:n=>F8.test(n),facebook:n=>N8.test(n)||O8.test(n),streamable:n=>B8.test(n),wistia:n=>U8.test(n),twitch:n=>V8.test(n)||H8.test(n),dailymotion:n=>G8.test(n),mixcloud:n=>j8.test(n),vidyard:n=>W8.test(n),kaltura:n=>$8.test(n),file:xb};var r4=Object.defineProperty,Qz=Object.getOwnPropertyDescriptor,eF=Object.getOwnPropertyNames,tF=Object.prototype.hasOwnProperty,nF=(n,e)=>{for(var t in e)r4(n,t,{get:e[t],enumerable:!0})},rF=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of eF(e))!tF.call(n,i)&&i!==t&&r4(n,i,{get:()=>e[i],enumerable:!(r=Qz(e,i))||r.enumerable});return n},iF=n=>rF(r4({},"__esModule",{value:!0}),n),Z8={};nF(Z8,{default:()=>sF});var aF=iF(Z8),Fa=yv,xa=Kz,sF=[{key:"youtube",name:"YouTube",canPlay:xa.canPlay.youtube,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./YouTube-DRVuRP8d.js").then(n=>n.Y),[]))},{key:"soundcloud",name:"SoundCloud",canPlay:xa.canPlay.soundcloud,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./SoundCloud-D8FaJ8D1.js").then(n=>n.S),[]))},{key:"vimeo",name:"Vimeo",canPlay:xa.canPlay.vimeo,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Vimeo-Dg4J3ubZ.js").then(n=>n.V),[]))},{key:"mux",name:"Mux",canPlay:xa.canPlay.mux,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Mux-CTdMYw6j.js").then(n=>n.M),[]))},{key:"facebook",name:"Facebook",canPlay:xa.canPlay.facebook,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Facebook-oIlf4QCD.js").then(n=>n.F),[]))},{key:"streamable",name:"Streamable",canPlay:xa.canPlay.streamable,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Streamable-CCpY3m2Z.js").then(n=>n.S),[]))},{key:"wistia",name:"Wistia",canPlay:xa.canPlay.wistia,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Wistia-CZd_mkh5.js").then(n=>n.W),[]))},{key:"twitch",name:"Twitch",canPlay:xa.canPlay.twitch,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Twitch-Biu7fLjS.js").then(n=>n.T),[]))},{key:"dailymotion",name:"DailyMotion",canPlay:xa.canPlay.dailymotion,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./DailyMotion-B7GnwLd0.js").then(n=>n.D),[]))},{key:"mixcloud",name:"Mixcloud",canPlay:xa.canPlay.mixcloud,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Mixcloud-Bbm066RK.js").then(n=>n.M),[]))},{key:"vidyard",name:"Vidyard",canPlay:xa.canPlay.vidyard,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Vidyard-DcUjOJ8x.js").then(n=>n.V),[]))},{key:"kaltura",name:"Kaltura",canPlay:xa.canPlay.kaltura,lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./Kaltura-UlhRusMV.js").then(n=>n.K),[]))},{key:"file",name:"FilePlayer",canPlay:xa.canPlay.file,canEnablePIP:n=>xa.canPlay.file(n)&&(document.pictureInPictureEnabled||(0,Fa.supportsWebKitPresentationMode)())&&!xa.AUDIO_EXTENSIONS.test(n),lazyPlayer:(0,Fa.lazy)(()=>Na(()=>import("./FilePlayer-BagPq-ou.js").then(n=>n.F),[]))}],Q5=Number.isNaN||function(e){return typeof e=="number"&&e!==e};function oF(n,e){return!!(n===e||Q5(n)&&Q5(e))}function lF(n,e){if(n.length!==e.length)return!1;for(var t=0;t<n.length;t++)if(!oF(n[t],e[t]))return!1;return!0}function cF(n,e){e===void 0&&(e=lF);var t,r=[],i,o=!1;function u(){for(var l=[],p=0;p<arguments.length;p++)l[p]=arguments[p];return o&&t===this&&e(l,r)||(i=n.apply(this,l),o=!0,t=this,r=l),i}return u}const uF=Object.freeze(Object.defineProperty({__proto__:null,default:cF},Symbol.toStringTag,{value:"Module"})),hF=M9(uF);var dF=typeof Element<"u",fF=typeof Map=="function",pF=typeof Set=="function",mF=typeof ArrayBuffer=="function"&&!!ArrayBuffer.isView;function W1(n,e){if(n===e)return!0;if(n&&e&&typeof n=="object"&&typeof e=="object"){if(n.constructor!==e.constructor)return!1;var t,r,i;if(Array.isArray(n)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(!W1(n[r],e[r]))return!1;return!0}var o;if(fF&&n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;for(o=n.entries();!(r=o.next()).done;)if(!e.has(r.value[0]))return!1;for(o=n.entries();!(r=o.next()).done;)if(!W1(r.value[1],e.get(r.value[0])))return!1;return!0}if(pF&&n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;for(o=n.entries();!(r=o.next()).done;)if(!e.has(r.value[0]))return!1;return!0}if(mF&&ArrayBuffer.isView(n)&&ArrayBuffer.isView(e)){if(t=n.length,t!=e.length)return!1;for(r=t;r--!==0;)if(n[r]!==e[r])return!1;return!0}if(n.constructor===RegExp)return n.source===e.source&&n.flags===e.flags;if(n.valueOf!==Object.prototype.valueOf&&typeof n.valueOf=="function"&&typeof e.valueOf=="function")return n.valueOf()===e.valueOf();if(n.toString!==Object.prototype.toString&&typeof n.toString=="function"&&typeof e.toString=="function")return n.toString()===e.toString();if(i=Object.keys(n),t=i.length,t!==Object.keys(e).length)return!1;for(r=t;r--!==0;)if(!Object.prototype.hasOwnProperty.call(e,i[r]))return!1;if(dF&&n instanceof Element)return!1;for(r=t;r--!==0;)if(!((i[r]==="_owner"||i[r]==="__v"||i[r]==="__o")&&n.$$typeof)&&!W1(n[i[r]],e[i[r]]))return!1;return!0}return n!==n&&e!==e}var Y8=function(e,t){try{return W1(e,t)}catch(r){if((r.message||"").match(/stack|recursion/i))return console.warn("react-fast-compare cannot handle circular refs"),!1;throw r}},K8={exports:{}},gF="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",yF=gF,vF=yF;function J8(){}function Q8(){}Q8.resetWarningCache=J8;var _F=function(){function n(r,i,o,u,l,p){if(p!==vF){var v=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw v.name="Invariant Violation",v}}n.isRequired=n;function e(){return n}var t={array:n,bigint:n,bool:n,func:n,number:n,object:n,string:n,symbol:n,any:n,arrayOf:e,element:n,elementType:n,instanceOf:e,node:n,objectOf:e,oneOf:e,oneOfType:e,shape:e,exact:e,checkPropTypes:Q8,resetWarningCache:J8};return t.PropTypes=t,t};K8.exports=_F();var xF=K8.exports,bF=Object.create,vv=Object.defineProperty,wF=Object.getOwnPropertyDescriptor,SF=Object.getOwnPropertyNames,MF=Object.getPrototypeOf,TF=Object.prototype.hasOwnProperty,EF=(n,e)=>{for(var t in e)vv(n,t,{get:e[t],enumerable:!0})},e7=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of SF(e))!TF.call(n,i)&&i!==t&&vv(n,i,{get:()=>e[i],enumerable:!(r=wF(e,i))||r.enumerable});return n},AF=(n,e,t)=>(t=n!=null?bF(MF(n)):{},e7(e||!n||!n.__esModule?vv(t,"default",{value:n,enumerable:!0}):t,n)),CF=n=>e7(vv({},"__esModule",{value:!0}),n),t7={};EF(t7,{defaultProps:()=>IF,propTypes:()=>RF});var n7=CF(t7),PF=AF(xF);const{string:Hi,bool:ba,number:Yh,array:px,oneOfType:X0,shape:ns,object:aa,func:wi,node:eM}=PF.default,RF={url:X0([Hi,px,aa]),playing:ba,loop:ba,controls:ba,volume:Yh,muted:ba,playbackRate:Yh,width:X0([Hi,Yh]),height:X0([Hi,Yh]),style:aa,progressInterval:Yh,playsinline:ba,pip:ba,stopOnUnmount:ba,light:X0([ba,Hi,aa]),playIcon:eM,previewTabIndex:Yh,previewAriaLabel:Hi,fallback:eM,oEmbedUrl:Hi,wrapper:X0([Hi,wi,ns({render:wi.isRequired})]),config:ns({soundcloud:ns({options:aa}),youtube:ns({playerVars:aa,embedOptions:aa,onUnstarted:wi}),facebook:ns({appId:Hi,version:Hi,playerId:Hi,attributes:aa}),dailymotion:ns({params:aa}),vimeo:ns({playerOptions:aa,title:Hi}),mux:ns({attributes:aa,version:Hi}),file:ns({attributes:aa,tracks:px,forceVideo:ba,forceAudio:ba,forceHLS:ba,forceSafariHLS:ba,forceDisableHls:ba,forceDASH:ba,forceFLV:ba,hlsOptions:aa,hlsVersion:Hi,dashVersion:Hi,flvVersion:Hi}),wistia:ns({options:aa,playerId:Hi,customControls:px}),mixcloud:ns({options:aa}),twitch:ns({options:aa,playerId:Hi}),vidyard:ns({options:aa})}),onReady:wi,onStart:wi,onPlay:wi,onPause:wi,onBuffer:wi,onBufferEnd:wi,onEnded:wi,onError:wi,onDuration:wi,onSeek:wi,onPlaybackRateChange:wi,onPlaybackQualityChange:wi,onProgress:wi,onClickPreview:wi,onEnablePIP:wi,onDisablePIP:wi},Gi=()=>{},IF={playing:!1,loop:!1,controls:!1,volume:null,muted:!1,playbackRate:1,width:"640px",height:"360px",style:{},progressInterval:1e3,playsinline:!1,pip:!1,stopOnUnmount:!0,light:!1,fallback:null,wrapper:"div",previewTabIndex:0,previewAriaLabel:"",oEmbedUrl:"https://noembed.com/embed?url={url}",config:{soundcloud:{options:{visual:!0,buying:!1,liking:!1,download:!1,sharing:!1,show_comments:!1,show_playcount:!1}},youtube:{playerVars:{playsinline:1,showinfo:0,rel:0,iv_load_policy:3,modestbranding:1},embedOptions:{},onUnstarted:Gi},facebook:{appId:"1309697205772819",version:"v3.3",playerId:null,attributes:{}},dailymotion:{params:{api:1,"endscreen-enable":!1}},vimeo:{playerOptions:{autopause:!1,byline:!1,portrait:!1,title:!1},title:null},mux:{attributes:{},version:"2"},file:{attributes:{},tracks:[],forceVideo:!1,forceAudio:!1,forceHLS:!1,forceDASH:!1,forceFLV:!1,hlsOptions:{},hlsVersion:"1.1.4",dashVersion:"3.1.3",flvVersion:"1.5.0",forceDisableHls:!1},wistia:{options:{},playerId:null,customControls:null},mixcloud:{options:{hide_cover:1}},twitch:{options:{},playerId:null},vidyard:{options:{}}},onReady:Gi,onStart:Gi,onPlay:Gi,onPause:Gi,onBuffer:Gi,onBufferEnd:Gi,onEnded:Gi,onError:Gi,onDuration:Gi,onSeek:Gi,onPlaybackRateChange:Gi,onPlaybackQualityChange:Gi,onProgress:Gi,onClickPreview:Gi,onEnablePIP:Gi,onDisablePIP:Gi};var DF=Object.create,dm=Object.defineProperty,kF=Object.getOwnPropertyDescriptor,LF=Object.getOwnPropertyNames,zF=Object.getPrototypeOf,FF=Object.prototype.hasOwnProperty,NF=(n,e,t)=>e in n?dm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,OF=(n,e)=>{for(var t in e)dm(n,t,{get:e[t],enumerable:!0})},r7=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of LF(e))!FF.call(n,i)&&i!==t&&dm(n,i,{get:()=>e[i],enumerable:!(r=kF(e,i))||r.enumerable});return n},i7=(n,e,t)=>(t=n!=null?DF(zF(n)):{},r7(e||!n||!n.__esModule?dm(t,"default",{value:n,enumerable:!0}):t,n)),BF=n=>r7(dm({},"__esModule",{value:!0}),n),di=(n,e,t)=>(NF(n,typeof e!="symbol"?e+"":e,t),t),a7={};OF(a7,{default:()=>_v});var UF=BF(a7),tM=i7(yt),VF=i7(Y8),s7=n7,HF=yv;const GF=5e3;class _v extends tM.Component{constructor(){super(...arguments),di(this,"mounted",!1),di(this,"isReady",!1),di(this,"isPlaying",!1),di(this,"isLoading",!0),di(this,"loadOnReady",null),di(this,"startOnPlay",!0),di(this,"seekOnPlay",null),di(this,"onDurationCalled",!1),di(this,"handlePlayerMount",e=>{if(this.player){this.progress();return}this.player=e,this.player.load(this.props.url),this.progress()}),di(this,"getInternalPlayer",e=>this.player?this.player[e]:null),di(this,"progress",()=>{if(this.props.url&&this.player&&this.isReady){const e=this.getCurrentTime()||0,t=this.getSecondsLoaded(),r=this.getDuration();if(r){const i={playedSeconds:e,played:e/r};t!==null&&(i.loadedSeconds=t,i.loaded=t/r),(i.playedSeconds!==this.prevPlayed||i.loadedSeconds!==this.prevLoaded)&&this.props.onProgress(i),this.prevPlayed=i.playedSeconds,this.prevLoaded=i.loadedSeconds}}this.progressTimeout=setTimeout(this.progress,this.props.progressFrequency||this.props.progressInterval)}),di(this,"handleReady",()=>{if(!this.mounted)return;this.isReady=!0,this.isLoading=!1;const{onReady:e,playing:t,volume:r,muted:i}=this.props;e(),!i&&r!==null&&this.player.setVolume(r),this.loadOnReady?(this.player.load(this.loadOnReady,!0),this.loadOnReady=null):t&&this.player.play(),this.handleDurationCheck()}),di(this,"handlePlay",()=>{this.isPlaying=!0,this.isLoading=!1;const{onStart:e,onPlay:t,playbackRate:r}=this.props;this.startOnPlay&&(this.player.setPlaybackRate&&r!==1&&this.player.setPlaybackRate(r),e(),this.startOnPlay=!1),t(),this.seekOnPlay&&(this.seekTo(this.seekOnPlay),this.seekOnPlay=null),this.handleDurationCheck()}),di(this,"handlePause",e=>{this.isPlaying=!1,this.isLoading||this.props.onPause(e)}),di(this,"handleEnded",()=>{const{activePlayer:e,loop:t,onEnded:r}=this.props;e.loopOnEnded&&t&&this.seekTo(0),t||(this.isPlaying=!1,r())}),di(this,"handleError",(...e)=>{this.isLoading=!1,this.props.onError(...e)}),di(this,"handleDurationCheck",()=>{clearTimeout(this.durationCheckTimeout);const e=this.getDuration();e?this.onDurationCalled||(this.props.onDuration(e),this.onDurationCalled=!0):this.durationCheckTimeout=setTimeout(this.handleDurationCheck,100)}),di(this,"handleLoaded",()=>{this.isLoading=!1})}componentDidMount(){this.mounted=!0}componentWillUnmount(){clearTimeout(this.progressTimeout),clearTimeout(this.durationCheckTimeout),this.isReady&&this.props.stopOnUnmount&&(this.player.stop(),this.player.disablePIP&&this.player.disablePIP()),this.mounted=!1}componentDidUpdate(e){if(!this.player)return;const{url:t,playing:r,volume:i,muted:o,playbackRate:u,pip:l,loop:p,activePlayer:v,disableDeferredLoading:x}=this.props;if(!(0,VF.default)(e.url,t)){if(this.isLoading&&!v.forceLoad&&!x&&!(0,HF.isMediaStream)(t)){console.warn(`ReactPlayer: the attempt to load ${t} is being deferred until the player has loaded`),this.loadOnReady=t;return}this.isLoading=!0,this.startOnPlay=!0,this.onDurationCalled=!1,this.player.load(t,this.isReady)}!e.playing&&r&&!this.isPlaying&&this.player.play(),e.playing&&!r&&this.isPlaying&&this.player.pause(),!e.pip&&l&&this.player.enablePIP&&this.player.enablePIP(),e.pip&&!l&&this.player.disablePIP&&this.player.disablePIP(),e.volume!==i&&i!==null&&this.player.setVolume(i),e.muted!==o&&(o?this.player.mute():(this.player.unmute(),i!==null&&setTimeout(()=>this.player.setVolume(i)))),e.playbackRate!==u&&this.player.setPlaybackRate&&this.player.setPlaybackRate(u),e.loop!==p&&this.player.setLoop&&this.player.setLoop(p)}getDuration(){return this.isReady?this.player.getDuration():null}getCurrentTime(){return this.isReady?this.player.getCurrentTime():null}getSecondsLoaded(){return this.isReady?this.player.getSecondsLoaded():null}seekTo(e,t,r){if(!this.isReady){e!==0&&(this.seekOnPlay=e,setTimeout(()=>{this.seekOnPlay=null},GF));return}if(t?t==="fraction":e>0&&e<1){const o=this.player.getDuration();if(!o){console.warn("ReactPlayer: could not seek using fraction duration not yet available");return}this.player.seekTo(o*e,r);return}this.player.seekTo(e,r)}render(){const e=this.props.activePlayer;return e?tM.default.createElement(e,{...this.props,onMount:this.handlePlayerMount,onReady:this.handleReady,onPlay:this.handlePlay,onPause:this.handlePause,onEnded:this.handleEnded,onLoaded:this.handleLoaded,onError:this.handleError}):null}}di(_v,"displayName","Player");di(_v,"propTypes",s7.propTypes);di(_v,"defaultProps",s7.defaultProps);var jF=Object.create,fm=Object.defineProperty,WF=Object.getOwnPropertyDescriptor,$F=Object.getOwnPropertyNames,qF=Object.getPrototypeOf,XF=Object.prototype.hasOwnProperty,ZF=(n,e,t)=>e in n?fm(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,YF=(n,e)=>{for(var t in e)fm(n,t,{get:e[t],enumerable:!0})},o7=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of $F(e))!XF.call(n,i)&&i!==t&&fm(n,i,{get:()=>e[i],enumerable:!(r=WF(e,i))||r.enumerable});return n},pm=(n,e,t)=>(t=n!=null?jF(qF(n)):{},o7(e||!n||!n.__esModule?fm(t,"default",{value:n,enumerable:!0}):t,n)),KF=n=>o7(fm({},"__esModule",{value:!0}),n),hi=(n,e,t)=>(ZF(n,typeof e!="symbol"?e+"":e,t),t),l7={};YF(l7,{createReactPlayer:()=>sN});var JF=KF(l7),wd=pm(yt),QF=pm(P8),mx=pm(hF),nM=pm(Y8),sp=n7,c7=yv,eN=pm(UF);const tN=(0,c7.lazy)(()=>Na(()=>import("./Preview-DECe8QYG.js").then(n=>n.P),[])),nN=typeof window<"u"&&window.document&&typeof document<"u",rN=typeof D1<"u"&&D1.window&&D1.window.document,iN=Object.keys(sp.propTypes),aN=nN||rN?wd.Suspense:()=>null,Z0=[],sN=(n,e)=>{var t;return t=class extends wd.Component{constructor(){super(...arguments),hi(this,"state",{showPreview:!!this.props.light}),hi(this,"references",{wrapper:r=>{this.wrapper=r},player:r=>{this.player=r}}),hi(this,"handleClickPreview",r=>{this.setState({showPreview:!1}),this.props.onClickPreview(r)}),hi(this,"showPreview",()=>{this.setState({showPreview:!0})}),hi(this,"getDuration",()=>this.player?this.player.getDuration():null),hi(this,"getCurrentTime",()=>this.player?this.player.getCurrentTime():null),hi(this,"getSecondsLoaded",()=>this.player?this.player.getSecondsLoaded():null),hi(this,"getInternalPlayer",(r="player")=>this.player?this.player.getInternalPlayer(r):null),hi(this,"seekTo",(r,i,o)=>{if(!this.player)return null;this.player.seekTo(r,i,o)}),hi(this,"handleReady",()=>{this.props.onReady(this)}),hi(this,"getActivePlayer",(0,mx.default)(r=>{for(const i of[...Z0,...n])if(i.canPlay(r))return i;return e||null})),hi(this,"getConfig",(0,mx.default)((r,i)=>{const{config:o}=this.props;return QF.default.all([sp.defaultProps.config,sp.defaultProps.config[i]||{},o,o[i]||{}])})),hi(this,"getAttributes",(0,mx.default)(r=>(0,c7.omit)(this.props,iN))),hi(this,"renderActivePlayer",r=>{if(!r)return null;const i=this.getActivePlayer(r);if(!i)return null;const o=this.getConfig(r,i.key);return wd.default.createElement(eN.default,{...this.props,key:i.key,ref:this.references.player,config:o,activePlayer:i.lazyPlayer||i,onReady:this.handleReady})})}shouldComponentUpdate(r,i){return!(0,nM.default)(this.props,r)||!(0,nM.default)(this.state,i)}componentDidUpdate(r){const{light:i}=this.props;!r.light&&i&&this.setState({showPreview:!0}),r.light&&!i&&this.setState({showPreview:!1})}renderPreview(r){if(!r)return null;const{light:i,playIcon:o,previewTabIndex:u,oEmbedUrl:l,previewAriaLabel:p}=this.props;return wd.default.createElement(tN,{url:r,light:i,playIcon:o,previewTabIndex:u,previewAriaLabel:p,oEmbedUrl:l,onClick:this.handleClickPreview})}render(){const{url:r,style:i,width:o,height:u,fallback:l,wrapper:p}=this.props,{showPreview:v}=this.state,x=this.getAttributes(r),M=typeof p=="string"?this.references.wrapper:void 0;return wd.default.createElement(p,{ref:M,style:{...i,width:o,height:u},...x},wd.default.createElement(aN,{fallback:l},v?this.renderPreview(r):this.renderActivePlayer(r)))}},hi(t,"displayName","ReactPlayer"),hi(t,"propTypes",sp.propTypes),hi(t,"defaultProps",sp.defaultProps),hi(t,"addCustomPlayer",r=>{Z0.push(r)}),hi(t,"removeCustomPlayers",()=>{Z0.length=0}),hi(t,"canPlay",r=>{for(const i of[...Z0,...n])if(i.canPlay(r))return!0;return!1}),hi(t,"canEnablePIP",r=>{for(const i of[...Z0,...n])if(i.canEnablePIP&&i.canEnablePIP(r))return!0;return!1}),t};var oN=Object.create,xv=Object.defineProperty,lN=Object.getOwnPropertyDescriptor,cN=Object.getOwnPropertyNames,uN=Object.getPrototypeOf,hN=Object.prototype.hasOwnProperty,dN=(n,e)=>{for(var t in e)xv(n,t,{get:e[t],enumerable:!0})},u7=(n,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let i of cN(e))!hN.call(n,i)&&i!==t&&xv(n,i,{get:()=>e[i],enumerable:!(r=lN(e,i))||r.enumerable});return n},fN=(n,e,t)=>(t=n!=null?oN(uN(n)):{},u7(e||!n||!n.__esModule?xv(t,"default",{value:n,enumerable:!0}):t,n)),pN=n=>u7(xv({},"__esModule",{value:!0}),n),h7={};dN(h7,{default:()=>vN});var mN=pN(h7),bb=fN(aF),gN=JF;const yN=bb.default[bb.default.length-1];var vN=(0,gN.createReactPlayer)(bb.default,yN);const _N=Yb(mN);function rM(n){return ge.jsx("div",{className:"hoverBox",onMouseEnter:e=>{n.hoverAction&&n.hoverAction(!0,e)},onMouseLeave:e=>{n.hoverAction&&n.hoverAction(!1,e)},onClick:e=>{n.clickAction&&n.clickAction(e)},style:{cursor:n.clickAction?"pointer":"default"},children:n.children})}function xN(n){const e=yt.useRef(null);return yt.useEffect(()=>{const t=i=>{for(const o of i)o.isIntersecting&&o.target.classList.add("viewed")},r=new IntersectionObserver(t,{rootMargin:"-10%"});return e.current&&r.observe(e.current),()=>{e.current&&r.unobserve(e.current),r.disconnect}},[e.current]),ge.jsx("div",{ref:e,className:"animatedBlock","data-animationtype":n.direction,children:n.children})}function iM(n){const e=yt.Children.count(n.children);function t(r){return r<=0?"fromLeft":r>=e-1?"fromRight":"fromBottom"}return ge.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap"},children:n.children&&yt.Children.map(n.children,(r,i)=>ge.jsx("div",{style:{flex:"1 0 50%"},children:ge.jsx(xN,{direction:t(i),children:r},i)}))})}function gx(n){const e=Kw(),[t,r]=yt.useState(!1),i=ge.jsx("div",{style:{borderRadius:"1rem",overflow:"hidden"},children:ge.jsx(_N,{url:n.videoUrl,width:"100%",height:"100%",playing:t,loop:!0,fallback:ge.jsx("img",{src:n.posterUrl})})});return n.direction==="left"?ge.jsx(rM,{clickAction:()=>e(n.navTo),hoverAction:o=>r(o),children:ge.jsxs(iM,{children:[ge.jsx("div",{style:{margin:"2rem"},children:n.children}),i]})}):ge.jsx(rM,{clickAction:()=>e(n.navTo),hoverAction:o=>r(o),children:ge.jsxs(iM,{children:[i,ge.jsx("div",{style:{margin:"2rem"},children:n.children})]})})}function bN(){return ge.jsxs(ge.Fragment,{children:[ge.jsx("div",{style:{margin:"3rem"},children:ge.jsx("h1",{children:"Visualization gallery"})}),ge.jsx("div",{style:{marginTop:"3rem"},children:ge.jsxs(gx,{navTo:"/swe",videoUrl:"/water_big.mp4",posterUrl:"swe-bg.jpg",direction:"left",children:[ge.jsx("h4",{children:"Fluid simulations"}),ge.jsx("p",{children:"See how we use scientifically accurate fluid simulations to build immersive landscapes."})]})}),ge.jsx("div",{style:{marginTop:"3rem"},children:ge.jsxs(gx,{navTo:"wind",videoUrl:"/wind_big.mp4",posterUrl:"/wind_firstframe.png",direction:"right",children:[ge.jsx("h4",{children:"Wind visualizations"}),ge.jsx("p",{children:"Integrate our dynamic wind visualizations into your maps."})]})}),ge.jsx("div",{style:{marginTop:"3rem"},children:ge.jsxs(gx,{navTo:"/math",videoUrl:"/math_big.mp4",posterUrl:"/math_firstframe.png",direction:"left",children:[ge.jsx("h4",{children:"Math visualizations"}),ge.jsx("p",{children:"Explaining mathematics visually."})]})})]})}function wN(){return ge.jsx(wf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(fv,{title:"Code and Colors",subtitle:"Scientific data visualizations",heroBackground:ge.jsx(ez,{})})}),footerContent:ge.jsx(A8,{}),children:ge.jsx(bN,{})})}function SN(){const[n,e]=yt.useState("burger-bar unclicked"),[t,r]=yt.useState("menu hidden"),[i,o]=yt.useState(!1),u=()=>{i?(e("burger-bar unclicked"),r("menu hidden")):(e("burger-bar clicked"),r("menu visible")),o(!i)};return ge.jsxs("div",{style:{width:"100%"},children:[ge.jsx("nav",{children:ge.jsxs("div",{className:"burger-menu",onClick:u,children:[ge.jsx("div",{className:n}),ge.jsx("div",{className:n}),ge.jsx("div",{className:n})]})}),ge.jsxs("div",{className:t,children:[ge.jsx(Od,{height:"3rem"}),ge.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[ge.jsx(q0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/",onClick:u,children:"Home"}),ge.jsx(q0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/contact",onClick:u,children:"Contact"}),ge.jsx(q0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/swe",onClick:u,children:"SWE"}),ge.jsx(q0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/wind",onClick:u,children:"Wind"}),ge.jsx(q0,{className:({isActive:l})=>l?"navLink active":"navLink",to:"/math",onClick:u,children:"Math"})]})]})]})}function MN(){const{pathname:n}=bf();return yt.useEffect(()=>{window.scrollTo(0,0)},[n]),null}function TN(){return ge.jsxs("div",{style:{width:"100%",position:"relative"},children:[ge.jsx("div",{style:{position:"fixed",width:"100%",zIndex:2},children:ge.jsx(SN,{})}),ge.jsx(MN,{}),ge.jsx(rL,{})]})}const d7=({backgroundImage:n,logo:e,title:t,subtitle:r})=>ge.jsx("div",{className:"hero",style:{backgroundImage:`url(${n})`},children:ge.jsxs("div",{className:"hero-content",children:[e&&ge.jsx("div",{className:"hero-logo",children:e}),ge.jsxs("div",{className:"hero-text-content",children:[ge.jsx("h1",{className:"hero-title",children:t}),ge.jsx("h3",{className:"hero-subtitle",children:r})]})]})});function EN(){return ge.jsx(wf,{hero:ge.jsx(d7,{backgroundImage:"/legal.jpg",title:"Imprint",subtitle:""}),children:ge.jsxs("div",{className:"impressum",children:[ge.jsx("h1",{children:"Legal Notice"}),ge.jsxs("div",{className:"section",style:{marginBottom:"2rem"},children:[ge.jsx("p",{children:"code and colors"}),ge.jsx("p",{children:" Bahnhofstr. 1, 82205 Gilching "}),ge.jsx("p",{children:"+49 152 6799543"}),ge.jsx("p",{children:"michael.langbein [at] codeandcolors.net"}),ge.jsx("p",{children:"Represented by: Michael Langbein"}),ge.jsx("p",{children:"Responsible for Content: Michael Lanbgein"}),ge.jsx("p",{children:"VAT ID: TBD"}),ge.jsx("p",{children:"Regulatory Authority: TBD"}),ge.jsx("p",{children:"Online Dispute Resolution: TBD"}),ge.jsx("p",{children:"This Legal Notice complies with the German laws under  5 TMG and  55 RStV."})]}),ge.jsx("h2",{children:"Liability for Content"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"The contents of our website have been created with the greatest possible care. However, we cannot guarantee the contents' accuracy, completeness, or topicality. According to Section 7, paragraph 1 of the TMG (Telemediengesetz - German Telemedia Act), we as service providers are liable for our content on these pages by general laws. However, according to Sections 8 to 10 of the TMG, we service providers are not obliged to monitor external information transmitted or stored or investigate circumstances pointing to illegal activity. Obligations to remove or block the use of information under general laws remain unaffected. However, a liability in this regard is only possible from the moment of knowledge of a specific infringement. Upon notification of such violations, we will remove the content immediately."})}),ge.jsx("h2",{children:"Liability for Links"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"Our website contains links to external websites, over whose contents we have no control. Therefore, we cannot accept any liability for these external contents. The respective provider or operator of the websites is always responsible for the contents of the linked pages. The linked pages were checked for possible legal violations at the time of linking. Illegal contents were not identified at the time of linking. However, permanent monitoring of the contents of the linked pages is not reasonable without specific indications of a violation. Upon notification of violations, we will remove such links immediately."})}),ge.jsx("h2",{children:"Copyright"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"The contents and works on these pages created by the site operator are subject to German copyright law. The duplication, processing, distribution, and any kind of utilization outside the limits of copyright require the written consent of the respective author or creator. Downloads and copies of these pages are only permitted for private, non-commercial use. In so far as the contents on this site were not created by the operator, the copyrights of third parties are respected. In particular, third-party content is marked as such. Should you become aware of a copyright infringement, please inform us accordingly. Upon notification of violations, we will remove such contents immediately."})}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"Last Updated: May 03, 2024"})})]})})}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const f7="164",p7=300,Bd=1e3,$g=1001,aM=1002,sM=1003,AN=1006,CN=1008,PN=1009,RN=1014,IN=1020,DN=1023,yx=1026,oM=1027,kN="",LN=515,qg=2e3,lM=2001;let m7=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,u=i.length;o<u;o++)i[o].call(this,e);e.target=null}}};const sa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function i4(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(sa[n&255]+sa[n>>8&255]+sa[n>>16&255]+sa[n>>24&255]+"-"+sa[e&255]+sa[e>>8&255]+"-"+sa[e>>16&15|64]+sa[e>>24&255]+"-"+sa[t&63|128]+sa[t>>8&255]+"-"+sa[t>>16&255]+sa[t>>24&255]+sa[r&255]+sa[r>>8&255]+sa[r>>16&255]+sa[r>>24&255]).toLowerCase()}function yl(n,e,t){return Math.max(e,Math.min(t,n))}let vx=class g7{constructor(e=0,t=0){g7.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(yl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,u=this.y-e.y;return this.x=o*r-u*i+e.x,this.y=o*i+u*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},a4=class y7{constructor(e,t,r,i,o,u,l,p,v){y7.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,u,l,p,v)}set(e,t,r,i,o,u,l,p,v){const x=this.elements;return x[0]=e,x[1]=i,x[2]=l,x[3]=t,x[4]=o,x[5]=p,x[6]=r,x[7]=u,x[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,u=r[0],l=r[3],p=r[6],v=r[1],x=r[4],M=r[7],w=r[2],A=r[5],k=r[8],z=i[0],D=i[3],C=i[6],U=i[1],B=i[4],K=i[7],ue=i[2],Z=i[5],ee=i[8];return o[0]=u*z+l*U+p*ue,o[3]=u*D+l*B+p*Z,o[6]=u*C+l*K+p*ee,o[1]=v*z+x*U+M*ue,o[4]=v*D+x*B+M*Z,o[7]=v*C+x*K+M*ee,o[2]=w*z+A*U+k*ue,o[5]=w*D+A*B+k*Z,o[8]=w*C+A*K+k*ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8];return t*u*x-t*l*v-r*o*x+r*l*p+i*o*v-i*u*p}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],M=x*u-l*v,w=l*p-x*o,A=v*o-u*p,k=t*M+r*w+i*A;if(k===0)return this.set(0,0,0,0,0,0,0,0,0);const z=1/k;return e[0]=M*z,e[1]=(i*v-x*r)*z,e[2]=(l*r-i*u)*z,e[3]=w*z,e[4]=(x*t-i*p)*z,e[5]=(i*o-l*t)*z,e[6]=A*z,e[7]=(r*p-v*t)*z,e[8]=(u*t-r*o)*z,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,u,l){const p=Math.cos(o),v=Math.sin(o);return this.set(r*p,r*v,-r*(p*u+v*l)+u+e,-i*v,i*p,-i*(-v*u+p*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(_x.makeScale(e,t)),this}rotate(e){return this.premultiply(_x.makeRotation(-e)),this}translate(e,t){return this.premultiply(_x.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const _x=new a4;function cM(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function xx(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let Kh,zN=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Kh===void 0&&(Kh=cM("canvas")),Kh.width=e.width,Kh.height=e.height;const r=Kh.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=Kh}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=cM("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let u=0;u<o.length;u++)o[u]=xx(o[u]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(xx(t[r]/255)*255):t[r]=xx(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},FN=0,NN=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:FN++}),this.uuid=i4(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let u=0,l=i.length;u<l;u++)i[u].isDataTexture?o.push(bx(i[u].image)):o.push(bx(i[u]))}else o=bx(i);r.url=o}return t||(e.images[this.uuid]=r),r}};function bx(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?zN.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let ON=0,bv=class $1 extends m7{constructor(e=$1.DEFAULT_IMAGE,t=$1.DEFAULT_MAPPING,r=$g,i=$g,o=AN,u=CN,l=DN,p=PN,v=$1.DEFAULT_ANISOTROPY,x=kN){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:ON++}),this.uuid=i4(),this.name="",this.source=new NN(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=u,this.anisotropy=v,this.format=l,this.internalFormat=null,this.type=p,this.offset=new vx(0,0),this.repeat=new vx(1,1),this.center=new vx(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new a4,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==p7)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Bd:e.x=e.x-Math.floor(e.x);break;case $g:e.x=e.x<0?0:1;break;case aM:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Bd:e.y=e.y-Math.floor(e.y);break;case $g:e.y=e.y<0?0:1;break;case aM:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};bv.DEFAULT_IMAGE=null;bv.DEFAULT_MAPPING=p7;bv.DEFAULT_ANISOTROPY=1;let mm=class{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,u,l){let p=r[i+0],v=r[i+1],x=r[i+2],M=r[i+3];const w=o[u+0],A=o[u+1],k=o[u+2],z=o[u+3];if(l===0){e[t+0]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M;return}if(l===1){e[t+0]=w,e[t+1]=A,e[t+2]=k,e[t+3]=z;return}if(M!==z||p!==w||v!==A||x!==k){let D=1-l;const C=p*w+v*A+x*k+M*z,U=C>=0?1:-1,B=1-C*C;if(B>Number.EPSILON){const ue=Math.sqrt(B),Z=Math.atan2(ue,C*U);D=Math.sin(D*Z)/ue,l=Math.sin(l*Z)/ue}const K=l*U;if(p=p*D+w*K,v=v*D+A*K,x=x*D+k*K,M=M*D+z*K,D===1-l){const ue=1/Math.sqrt(p*p+v*v+x*x+M*M);p*=ue,v*=ue,x*=ue,M*=ue}}e[t]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M}static multiplyQuaternionsFlat(e,t,r,i,o,u){const l=r[i],p=r[i+1],v=r[i+2],x=r[i+3],M=o[u],w=o[u+1],A=o[u+2],k=o[u+3];return e[t]=l*k+x*M+p*A-v*w,e[t+1]=p*k+x*w+v*M-l*A,e[t+2]=v*k+x*A+l*w-p*M,e[t+3]=x*k-l*M-p*w-v*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,u=e._order,l=Math.cos,p=Math.sin,v=l(r/2),x=l(i/2),M=l(o/2),w=p(r/2),A=p(i/2),k=p(o/2);switch(u){case"XYZ":this._x=w*x*M+v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M-w*A*k;break;case"YXZ":this._x=w*x*M+v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M+w*A*k;break;case"ZXY":this._x=w*x*M-v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M-w*A*k;break;case"ZYX":this._x=w*x*M-v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M+w*A*k;break;case"YZX":this._x=w*x*M+v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M-w*A*k;break;case"XZY":this._x=w*x*M-v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M+w*A*k;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],u=t[1],l=t[5],p=t[9],v=t[2],x=t[6],M=t[10],w=r+l+M;if(w>0){const A=.5/Math.sqrt(w+1);this._w=.25/A,this._x=(x-p)*A,this._y=(o-v)*A,this._z=(u-i)*A}else if(r>l&&r>M){const A=2*Math.sqrt(1+r-l-M);this._w=(x-p)/A,this._x=.25*A,this._y=(i+u)/A,this._z=(o+v)/A}else if(l>M){const A=2*Math.sqrt(1+l-r-M);this._w=(o-v)/A,this._x=(i+u)/A,this._y=.25*A,this._z=(p+x)/A}else{const A=2*Math.sqrt(1+M-r-l);this._w=(u-i)/A,this._x=(o+v)/A,this._y=(p+x)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(yl(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,u=e._w,l=t._x,p=t._y,v=t._z,x=t._w;return this._x=r*x+u*l+i*v-o*p,this._y=i*x+u*p+o*l-r*v,this._z=o*x+u*v+r*p-i*l,this._w=u*x-r*l-i*p-o*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,u=this._w;let l=u*e._w+r*e._x+i*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=u,this._x=r,this._y=i,this._z=o,this;const p=1-l*l;if(p<=Number.EPSILON){const A=1-t;return this._w=A*u+t*this._w,this._x=A*r+t*this._x,this._y=A*i+t*this._y,this._z=A*o+t*this._z,this.normalize(),this}const v=Math.sqrt(p),x=Math.atan2(v,l),M=Math.sin((1-t)*x)/v,w=Math.sin(t*x)/v;return this._w=u*M+this._w*w,this._x=r*M+this._x*w,this._y=i*M+this._y*w,this._z=o*M+this._z*w,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Xi=class v7{constructor(e=0,t=0,r=0){v7.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(uM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(uM.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,u=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*u,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*u,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*u,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,u=e.y,l=e.z,p=e.w,v=2*(u*i-l*r),x=2*(l*t-o*i),M=2*(o*r-u*t);return this.x=t+p*v+u*M-l*x,this.y=r+p*x+l*v-o*M,this.z=i+p*M+o*x-u*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,u=t.x,l=t.y,p=t.z;return this.x=i*p-o*l,this.y=o*u-r*p,this.z=r*l-i*u,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return wx.copy(this).projectOnVector(e),this.sub(wx)}reflect(e){return this.sub(wx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(yl(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const wx=new Xi,uM=new mm;let Xd=class wb{constructor(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D){wb.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D)}set(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D){const C=this.elements;return C[0]=e,C[4]=t,C[8]=r,C[12]=i,C[1]=o,C[5]=u,C[9]=l,C[13]=p,C[2]=v,C[6]=x,C[10]=M,C[14]=w,C[3]=A,C[7]=k,C[11]=z,C[15]=D,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new wb().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/Jh.setFromMatrixColumn(e,0).length(),o=1/Jh.setFromMatrixColumn(e,1).length(),u=1/Jh.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*u,t[9]=r[9]*u,t[10]=r[10]*u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,u=Math.cos(r),l=Math.sin(r),p=Math.cos(i),v=Math.sin(i),x=Math.cos(o),M=Math.sin(o);if(e.order==="XYZ"){const w=u*x,A=u*M,k=l*x,z=l*M;t[0]=p*x,t[4]=-p*M,t[8]=v,t[1]=A+k*v,t[5]=w-z*v,t[9]=-l*p,t[2]=z-w*v,t[6]=k+A*v,t[10]=u*p}else if(e.order==="YXZ"){const w=p*x,A=p*M,k=v*x,z=v*M;t[0]=w+z*l,t[4]=k*l-A,t[8]=u*v,t[1]=u*M,t[5]=u*x,t[9]=-l,t[2]=A*l-k,t[6]=z+w*l,t[10]=u*p}else if(e.order==="ZXY"){const w=p*x,A=p*M,k=v*x,z=v*M;t[0]=w-z*l,t[4]=-u*M,t[8]=k+A*l,t[1]=A+k*l,t[5]=u*x,t[9]=z-w*l,t[2]=-u*v,t[6]=l,t[10]=u*p}else if(e.order==="ZYX"){const w=u*x,A=u*M,k=l*x,z=l*M;t[0]=p*x,t[4]=k*v-A,t[8]=w*v+z,t[1]=p*M,t[5]=z*v+w,t[9]=A*v-k,t[2]=-v,t[6]=l*p,t[10]=u*p}else if(e.order==="YZX"){const w=u*p,A=u*v,k=l*p,z=l*v;t[0]=p*x,t[4]=z-w*M,t[8]=k*M+A,t[1]=M,t[5]=u*x,t[9]=-l*x,t[2]=-v*x,t[6]=A*M+k,t[10]=w-z*M}else if(e.order==="XZY"){const w=u*p,A=u*v,k=l*p,z=l*v;t[0]=p*x,t[4]=-M,t[8]=v*x,t[1]=w*M+z,t[5]=u*x,t[9]=A*M-k,t[2]=k*M-A,t[6]=l*x,t[10]=z*M+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(BN,e,UN)}lookAt(e,t,r){const i=this.elements;return rs.subVectors(e,t),rs.lengthSq()===0&&(rs.z=1),rs.normalize(),hc.crossVectors(r,rs),hc.lengthSq()===0&&(Math.abs(r.z)===1?rs.x+=1e-4:rs.z+=1e-4,rs.normalize(),hc.crossVectors(r,rs)),hc.normalize(),Xg.crossVectors(rs,hc),i[0]=hc.x,i[4]=Xg.x,i[8]=rs.x,i[1]=hc.y,i[5]=Xg.y,i[9]=rs.y,i[2]=hc.z,i[6]=Xg.z,i[10]=rs.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,u=r[0],l=r[4],p=r[8],v=r[12],x=r[1],M=r[5],w=r[9],A=r[13],k=r[2],z=r[6],D=r[10],C=r[14],U=r[3],B=r[7],K=r[11],ue=r[15],Z=i[0],ee=i[4],be=i[8],ie=i[12],Q=i[1],Ee=i[5],Fe=i[9],Ae=i[13],Ve=i[2],lt=i[6],ut=i[10],pt=i[14],ke=i[3],Je=i[7],tt=i[11],_t=i[15];return o[0]=u*Z+l*Q+p*Ve+v*ke,o[4]=u*ee+l*Ee+p*lt+v*Je,o[8]=u*be+l*Fe+p*ut+v*tt,o[12]=u*ie+l*Ae+p*pt+v*_t,o[1]=x*Z+M*Q+w*Ve+A*ke,o[5]=x*ee+M*Ee+w*lt+A*Je,o[9]=x*be+M*Fe+w*ut+A*tt,o[13]=x*ie+M*Ae+w*pt+A*_t,o[2]=k*Z+z*Q+D*Ve+C*ke,o[6]=k*ee+z*Ee+D*lt+C*Je,o[10]=k*be+z*Fe+D*ut+C*tt,o[14]=k*ie+z*Ae+D*pt+C*_t,o[3]=U*Z+B*Q+K*Ve+ue*ke,o[7]=U*ee+B*Ee+K*lt+ue*Je,o[11]=U*be+B*Fe+K*ut+ue*tt,o[15]=U*ie+B*Ae+K*pt+ue*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],u=e[1],l=e[5],p=e[9],v=e[13],x=e[2],M=e[6],w=e[10],A=e[14],k=e[3],z=e[7],D=e[11],C=e[15];return k*(+o*p*M-i*v*M-o*l*w+r*v*w+i*l*A-r*p*A)+z*(+t*p*A-t*v*w+o*u*w-i*u*A+i*v*x-o*p*x)+D*(+t*v*M-t*l*A-o*u*M+r*u*A+o*l*x-r*v*x)+C*(-i*l*x-t*p*M+t*l*w+i*u*M-r*u*w+r*p*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],M=e[9],w=e[10],A=e[11],k=e[12],z=e[13],D=e[14],C=e[15],U=M*D*v-z*w*v+z*p*A-l*D*A-M*p*C+l*w*C,B=k*w*v-x*D*v-k*p*A+u*D*A+x*p*C-u*w*C,K=x*z*v-k*M*v+k*l*A-u*z*A-x*l*C+u*M*C,ue=k*M*p-x*z*p-k*l*w+u*z*w+x*l*D-u*M*D,Z=t*U+r*B+i*K+o*ue;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ee=1/Z;return e[0]=U*ee,e[1]=(z*w*o-M*D*o-z*i*A+r*D*A+M*i*C-r*w*C)*ee,e[2]=(l*D*o-z*p*o+z*i*v-r*D*v-l*i*C+r*p*C)*ee,e[3]=(M*p*o-l*w*o-M*i*v+r*w*v+l*i*A-r*p*A)*ee,e[4]=B*ee,e[5]=(x*D*o-k*w*o+k*i*A-t*D*A-x*i*C+t*w*C)*ee,e[6]=(k*p*o-u*D*o-k*i*v+t*D*v+u*i*C-t*p*C)*ee,e[7]=(u*w*o-x*p*o+x*i*v-t*w*v-u*i*A+t*p*A)*ee,e[8]=K*ee,e[9]=(k*M*o-x*z*o-k*r*A+t*z*A+x*r*C-t*M*C)*ee,e[10]=(u*z*o-k*l*o+k*r*v-t*z*v-u*r*C+t*l*C)*ee,e[11]=(x*l*o-u*M*o-x*r*v+t*M*v+u*r*A-t*l*A)*ee,e[12]=ue*ee,e[13]=(x*z*i-k*M*i+k*r*w-t*z*w-x*r*D+t*M*D)*ee,e[14]=(k*l*i-u*z*i-k*r*p+t*z*p+u*r*D-t*l*D)*ee,e[15]=(u*M*i-x*l*i+x*r*p-t*M*p-u*r*w+t*l*w)*ee,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,u=e.x,l=e.y,p=e.z,v=o*u,x=o*l;return this.set(v*u+r,v*l-i*p,v*p+i*l,0,v*l+i*p,x*l+r,x*p-i*u,0,v*p-i*l,x*p+i*u,o*p*p+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,u){return this.set(1,r,o,0,e,1,u,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,u=t._y,l=t._z,p=t._w,v=o+o,x=u+u,M=l+l,w=o*v,A=o*x,k=o*M,z=u*x,D=u*M,C=l*M,U=p*v,B=p*x,K=p*M,ue=r.x,Z=r.y,ee=r.z;return i[0]=(1-(z+C))*ue,i[1]=(A+K)*ue,i[2]=(k-B)*ue,i[3]=0,i[4]=(A-K)*Z,i[5]=(1-(w+C))*Z,i[6]=(D+U)*Z,i[7]=0,i[8]=(k+B)*ee,i[9]=(D-U)*ee,i[10]=(1-(w+z))*ee,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=Jh.set(i[0],i[1],i[2]).length();const u=Jh.set(i[4],i[5],i[6]).length(),l=Jh.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],qs.copy(this);const v=1/o,x=1/u,M=1/l;return qs.elements[0]*=v,qs.elements[1]*=v,qs.elements[2]*=v,qs.elements[4]*=x,qs.elements[5]*=x,qs.elements[6]*=x,qs.elements[8]*=M,qs.elements[9]*=M,qs.elements[10]*=M,t.setFromRotationMatrix(qs),r.x=o,r.y=u,r.z=l,this}makePerspective(e,t,r,i,o,u,l=qg){const p=this.elements,v=2*o/(t-e),x=2*o/(r-i),M=(t+e)/(t-e),w=(r+i)/(r-i);let A,k;if(l===qg)A=-(u+o)/(u-o),k=-2*u*o/(u-o);else if(l===lM)A=-u/(u-o),k=-u*o/(u-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return p[0]=v,p[4]=0,p[8]=M,p[12]=0,p[1]=0,p[5]=x,p[9]=w,p[13]=0,p[2]=0,p[6]=0,p[10]=A,p[14]=k,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(e,t,r,i,o,u,l=qg){const p=this.elements,v=1/(t-e),x=1/(r-i),M=1/(u-o),w=(t+e)*v,A=(r+i)*x;let k,z;if(l===qg)k=(u+o)*M,z=-2*M;else if(l===lM)k=o*M,z=-1*M;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return p[0]=2*v,p[4]=0,p[8]=0,p[12]=-w,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-A,p[2]=0,p[6]=0,p[10]=z,p[14]=-k,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}};const Jh=new Xi,qs=new Xd,BN=new Xi(0,0,0),UN=new Xi(1,1,1),hc=new Xi,Xg=new Xi,rs=new Xi,hM=new Xd,dM=new mm;let _7=class x7{constructor(e=0,t=0,r=0,i=x7.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],u=i[4],l=i[8],p=i[1],v=i[5],x=i[9],M=i[2],w=i[6],A=i[10];switch(t){case"XYZ":this._y=Math.asin(yl(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-x,A),this._z=Math.atan2(-u,o)):(this._x=Math.atan2(w,v),this._z=0);break;case"YXZ":this._x=Math.asin(-yl(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(l,A),this._z=Math.atan2(p,v)):(this._y=Math.atan2(-M,o),this._z=0);break;case"ZXY":this._x=Math.asin(yl(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(-M,A),this._z=Math.atan2(-u,v)):(this._y=0,this._z=Math.atan2(p,o));break;case"ZYX":this._y=Math.asin(-yl(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(w,A),this._z=Math.atan2(p,o)):(this._x=0,this._z=Math.atan2(-u,v));break;case"YZX":this._z=Math.asin(yl(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,v),this._y=Math.atan2(-M,o)):(this._x=0,this._y=Math.atan2(l,A));break;case"XZY":this._z=Math.asin(-yl(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(w,v),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-x,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return hM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(hM,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return dM.setFromEuler(this),this.setFromQuaternion(dM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};_7.DEFAULT_ORDER="XYZ";let VN=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},HN=0;const fM=new Xi,Qh=new mm,sl=new Xd,Zg=new Xi,Y0=new Xi,GN=new Xi,jN=new mm,pM=new Xi(1,0,0),mM=new Xi(0,1,0),gM=new Xi(0,0,1),yM={type:"added"},WN={type:"removed"},ed={type:"childadded",child:null},Sx={type:"childremoved",child:null};let s4=class q1 extends m7{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:HN++}),this.uuid=i4(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=q1.DEFAULT_UP.clone();const e=new Xi,t=new _7,r=new mm,i=new Xi(1,1,1);function o(){r.setFromEuler(t,!1)}function u(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(u),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Xd},normalMatrix:{value:new a4}}),this.matrix=new Xd,this.matrixWorld=new Xd,this.matrixAutoUpdate=q1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=q1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new VN,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Qh.setFromAxisAngle(e,t),this.quaternion.multiply(Qh),this}rotateOnWorldAxis(e,t){return Qh.setFromAxisAngle(e,t),this.quaternion.premultiply(Qh),this}rotateX(e){return this.rotateOnAxis(pM,e)}rotateY(e){return this.rotateOnAxis(mM,e)}rotateZ(e){return this.rotateOnAxis(gM,e)}translateOnAxis(e,t){return fM.copy(e).applyQuaternion(this.quaternion),this.position.add(fM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(pM,e)}translateY(e){return this.translateOnAxis(mM,e)}translateZ(e){return this.translateOnAxis(gM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(sl.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?Zg.copy(e):Zg.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Y0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?sl.lookAt(Y0,Zg,this.up):sl.lookAt(Zg,Y0,this.up),this.quaternion.setFromRotationMatrix(sl),i&&(sl.extractRotation(i.matrixWorld),Qh.setFromRotationMatrix(sl),this.quaternion.premultiply(Qh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(yM),ed.child=e,this.dispatchEvent(ed),ed.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(WN),Sx.child=e,this.dispatchEvent(Sx),Sx.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),sl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),sl.multiply(e.parent.matrixWorld)),e.applyMatrix4(sl),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(yM),ed.child=e,this.dispatchEvent(ed),ed.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const u=this.children[r].getObjectByProperty(e,t);if(u!==void 0)return u}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,u=i.length;o<u;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Y0,e,GN),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Y0,jN,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const o=t[r];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let o=0,u=i.length;o<u;o++){const l=i[o];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function o(l,p){return l[p.uuid]===void 0&&(l[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const p=l.shapes;if(Array.isArray(p))for(let v=0,x=p.length;v<x;v++){const M=p[v];o(e.shapes,M)}else o(e.shapes,p)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let p=0,v=this.material.length;p<v;p++)l.push(o(e.materials,this.material[p]));i.material=l}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const p=this.animations[l];i.animations.push(o(e.animations,p))}}if(t){const l=u(e.geometries),p=u(e.materials),v=u(e.textures),x=u(e.images),M=u(e.shapes),w=u(e.skeletons),A=u(e.animations),k=u(e.nodes);l.length>0&&(r.geometries=l),p.length>0&&(r.materials=p),v.length>0&&(r.textures=v),x.length>0&&(r.images=x),M.length>0&&(r.shapes=M),w.length>0&&(r.skeletons=w),A.length>0&&(r.animations=A),k.length>0&&(r.nodes=k)}return r.object=i,r;function u(l){const p=[];for(const v in l){const x=l[v];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}};s4.DEFAULT_UP=new Xi(0,1,0);s4.DEFAULT_MATRIX_AUTO_UPDATE=!0;s4.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let $N=class extends bv{constructor(e,t,r,i,o,u,l,p,v,x){if(x=x!==void 0?x:yx,x!==yx&&x!==oM)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&x===yx&&(r=RN),r===void 0&&x===oM&&(r=IN),super(null,i,o,u,l,p,x,r,v),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:sM,this.minFilter=p!==void 0?p:sM,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};const qN=new $N(1,1);qN.compareFunction=LN;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:f7}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=f7);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const o4="163",td={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},nd={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},XN=0,vM=1,ZN=2,b7=1,YN=2,pl=3,Wc=0,$a=1,Ao=2,Uc=0,Zd=1,_M=2,xM=3,bM=4,KN=5,Nu=100,JN=101,QN=102,eO=103,tO=104,nO=200,rO=201,iO=202,aO=203,Sb=204,Mb=205,sO=206,oO=207,lO=208,cO=209,uO=210,hO=211,dO=212,fO=213,pO=214,mO=0,gO=1,yO=2,Ay=3,vO=4,_O=5,xO=6,bO=7,w7=0,wO=1,SO=2,Vc=0,MO=1,TO=2,EO=3,AO=4,CO=5,PO=6,RO=7,S7=300,uf=301,hf=302,Tb=303,Eb=304,wv=306,Ab=1e3,ju=1001,Cb=1002,Is=1003,IO=1004,Yg=1005,io=1006,Mx=1007,Wu=1008,Hc=1009,DO=1010,kO=1011,M7=1012,T7=1013,df=1014,Rc=1015,Cy=1016,E7=1017,A7=1018,gm=1020,LO=35902,zO=1021,FO=1022,Ro=1023,NO=1024,OO=1025,Yd=1026,Zp=1027,BO=1028,C7=1029,UO=1030,P7=1031,R7=1033,Tx=33776,Ex=33777,Ax=33778,Cx=33779,wM=35840,SM=35841,MM=35842,TM=35843,I7=36196,EM=37492,AM=37496,CM=37808,PM=37809,RM=37810,IM=37811,DM=37812,kM=37813,LM=37814,zM=37815,FM=37816,NM=37817,OM=37818,BM=37819,UM=37820,VM=37821,Px=36492,HM=36494,GM=36495,VO=36283,jM=36284,WM=36285,$M=36286,HO=3200,GO=3201,jO=0,WO=1,Ac="",wo="srgb",eu="srgb-linear",l4="display-p3",Sv="display-p3-linear",Py="linear",Or="srgb",Ry="rec709",Iy="p3",rd=7680,qM=519,$O=512,qO=513,XO=514,D7=515,ZO=516,YO=517,KO=518,JO=519,XM=35044,ZM="300 es",bl=2e3,Dy=2001;class ch{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const i=this._listeners[e];if(i!==void 0){const o=i.indexOf(t);o!==-1&&i.splice(o,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const r=this._listeners[e.type];if(r!==void 0){e.target=this;const i=r.slice(0);for(let o=0,u=i.length;o<u;o++)i[o].call(this,e);e.target=null}}}const oa=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let YM=1234567;const wp=Math.PI/180,Yp=180/Math.PI;function Sf(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(oa[n&255]+oa[n>>8&255]+oa[n>>16&255]+oa[n>>24&255]+"-"+oa[e&255]+oa[e>>8&255]+"-"+oa[e>>16&15|64]+oa[e>>24&255]+"-"+oa[t&63|128]+oa[t>>8&255]+"-"+oa[t>>16&255]+oa[t>>24&255]+oa[r&255]+oa[r>>8&255]+oa[r>>16&255]+oa[r>>24&255]).toLowerCase()}function ua(n,e,t){return Math.max(e,Math.min(t,n))}function c4(n,e){return(n%e+e)%e}function QO(n,e,t,r,i){return r+(n-e)*(i-r)/(t-e)}function eB(n,e,t){return n!==e?(t-n)/(e-n):0}function Sp(n,e,t){return(1-t)*n+t*e}function tB(n,e,t,r){return Sp(n,e,1-Math.exp(-t*r))}function nB(n,e=1){return e-Math.abs(c4(n,e*2)-e)}function rB(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function iB(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function aB(n,e){return n+Math.floor(Math.random()*(e-n+1))}function sB(n,e){return n+Math.random()*(e-n)}function oB(n){return n*(.5-Math.random())}function lB(n){n!==void 0&&(YM=n);let e=YM+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function cB(n){return n*wp}function uB(n){return n*Yp}function hB(n){return(n&n-1)===0&&n!==0}function dB(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function fB(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function pB(n,e,t,r,i){const o=Math.cos,u=Math.sin,l=o(t/2),p=u(t/2),v=o((e+r)/2),x=u((e+r)/2),M=o((e-r)/2),w=u((e-r)/2),A=o((r-e)/2),k=u((r-e)/2);switch(i){case"XYX":n.set(l*x,p*M,p*w,l*v);break;case"YZY":n.set(p*w,l*x,p*M,l*v);break;case"ZXZ":n.set(p*M,p*w,l*x,l*v);break;case"XZX":n.set(l*x,p*k,p*A,l*v);break;case"YXY":n.set(p*A,l*x,p*k,l*v);break;case"ZYZ":n.set(p*k,p*A,l*x,l*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function Sd(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function Sa(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const mB={DEG2RAD:wp,RAD2DEG:Yp,generateUUID:Sf,clamp:ua,euclideanModulo:c4,mapLinear:QO,inverseLerp:eB,lerp:Sp,damp:tB,pingpong:nB,smoothstep:rB,smootherstep:iB,randInt:aB,randFloat:sB,randFloatSpread:oB,seededRandom:lB,degToRad:cB,radToDeg:uB,isPowerOfTwo:hB,ceilPowerOfTwo:dB,floorPowerOfTwo:fB,setQuaternionFromProperEuler:pB,normalize:Sa,denormalize:Sd};class qn{constructor(e=0,t=0){qn.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ua(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y;return t*t+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const r=Math.cos(t),i=Math.sin(t),o=this.x-e.x,u=this.y-e.y;return this.x=o*r-u*i+e.x,this.y=o*i+u*r+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Jn{constructor(e,t,r,i,o,u,l,p,v){Jn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,u,l,p,v)}set(e,t,r,i,o,u,l,p,v){const x=this.elements;return x[0]=e,x[1]=i,x[2]=l,x[3]=t,x[4]=o,x[5]=p,x[6]=r,x[7]=u,x[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this}extractBasis(e,t,r){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,u=r[0],l=r[3],p=r[6],v=r[1],x=r[4],M=r[7],w=r[2],A=r[5],k=r[8],z=i[0],D=i[3],C=i[6],U=i[1],B=i[4],K=i[7],ue=i[2],Z=i[5],ee=i[8];return o[0]=u*z+l*U+p*ue,o[3]=u*D+l*B+p*Z,o[6]=u*C+l*K+p*ee,o[1]=v*z+x*U+M*ue,o[4]=v*D+x*B+M*Z,o[7]=v*C+x*K+M*ee,o[2]=w*z+A*U+k*ue,o[5]=w*D+A*B+k*Z,o[8]=w*C+A*K+k*ee,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8];return t*u*x-t*l*v-r*o*x+r*l*p+i*o*v-i*u*p}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],M=x*u-l*v,w=l*p-x*o,A=v*o-u*p,k=t*M+r*w+i*A;if(k===0)return this.set(0,0,0,0,0,0,0,0,0);const z=1/k;return e[0]=M*z,e[1]=(i*v-x*r)*z,e[2]=(l*r-i*u)*z,e[3]=w*z,e[4]=(x*t-i*p)*z,e[5]=(i*o-l*t)*z,e[6]=A*z,e[7]=(r*p-v*t)*z,e[8]=(u*t-r*o)*z,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,r,i,o,u,l){const p=Math.cos(o),v=Math.sin(o);return this.set(r*p,r*v,-r*(p*u+v*l)+u+e,-i*v,i*p,-i*(-v*u+p*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(Rx.makeScale(e,t)),this}rotate(e){return this.premultiply(Rx.makeRotation(-e)),this}translate(e,t){return this.premultiply(Rx.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,r,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<9;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const Rx=new Jn;function k7(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function Kp(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function gB(){const n=Kp("canvas");return n.style.display="block",n}const KM={};function yB(n){n in KM||(KM[n]=!0,console.warn(n))}const JM=new Jn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),QM=new Jn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Kg={[eu]:{transfer:Py,primaries:Ry,toReference:n=>n,fromReference:n=>n},[wo]:{transfer:Or,primaries:Ry,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Sv]:{transfer:Py,primaries:Iy,toReference:n=>n.applyMatrix3(QM),fromReference:n=>n.applyMatrix3(JM)},[l4]:{transfer:Or,primaries:Iy,toReference:n=>n.convertSRGBToLinear().applyMatrix3(QM),fromReference:n=>n.applyMatrix3(JM).convertLinearToSRGB()}},vB=new Set([eu,Sv]),Mr={enabled:!0,_workingColorSpace:eu,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!vB.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const r=Kg[e].toReference,i=Kg[t].fromReference;return i(r(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Kg[n].primaries},getTransfer:function(n){return n===Ac?Py:Kg[n].transfer}};function Kd(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Ix(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let id;class _B{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{id===void 0&&(id=Kp("canvas")),id.width=e.width,id.height=e.height;const r=id.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=id}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=Kp("canvas");t.width=e.width,t.height=e.height;const r=t.getContext("2d");r.drawImage(e,0,0,e.width,e.height);const i=r.getImageData(0,0,e.width,e.height),o=i.data;for(let u=0;u<o.length;u++)o[u]=Kd(o[u]/255)*255;return r.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let r=0;r<t.length;r++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[r]=Math.floor(Kd(t[r]/255)*255):t[r]=Kd(t[r]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let xB=0;class L7{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:xB++}),this.uuid=Sf(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let o;if(Array.isArray(i)){o=[];for(let u=0,l=i.length;u<l;u++)i[u].isDataTexture?o.push(Dx(i[u].image)):o.push(Dx(i[u]))}else o=Dx(i);r.url=o}return t||(e.images[this.uuid]=r),r}}function Dx(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?_B.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let bB=0;class Ca extends ch{constructor(e=Ca.DEFAULT_IMAGE,t=Ca.DEFAULT_MAPPING,r=ju,i=ju,o=io,u=Wu,l=Ro,p=Hc,v=Ca.DEFAULT_ANISOTROPY,x=Ac){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:bB++}),this.uuid=Sf(),this.name="",this.source=new L7(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=o,this.minFilter=u,this.anisotropy=v,this.format=l,this.internalFormat=null,this.type=p,this.offset=new qn(0,0),this.repeat=new qn(1,1),this.center=new qn(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),t||(e.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==S7)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Ab:e.x=e.x-Math.floor(e.x);break;case ju:e.x=e.x<0?0:1;break;case Cb:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Ab:e.y=e.y-Math.floor(e.y);break;case ju:e.y=e.y<0?0:1;break;case Cb:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Ca.DEFAULT_IMAGE=null;Ca.DEFAULT_MAPPING=S7;Ca.DEFAULT_ANISOTROPY=1;class Wi{constructor(e=0,t=0,r=0,i=1){Wi.prototype.isVector4=!0,this.x=e,this.y=t,this.z=r,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=this.w,u=e.elements;return this.x=u[0]*t+u[4]*r+u[8]*i+u[12]*o,this.y=u[1]*t+u[5]*r+u[9]*i+u[13]*o,this.z=u[2]*t+u[6]*r+u[10]*i+u[14]*o,this.w=u[3]*t+u[7]*r+u[11]*i+u[15]*o,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,r,i,o;const p=e.elements,v=p[0],x=p[4],M=p[8],w=p[1],A=p[5],k=p[9],z=p[2],D=p[6],C=p[10];if(Math.abs(x-w)<.01&&Math.abs(M-z)<.01&&Math.abs(k-D)<.01){if(Math.abs(x+w)<.1&&Math.abs(M+z)<.1&&Math.abs(k+D)<.1&&Math.abs(v+A+C-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const B=(v+1)/2,K=(A+1)/2,ue=(C+1)/2,Z=(x+w)/4,ee=(M+z)/4,be=(k+D)/4;return B>K&&B>ue?B<.01?(r=0,i=.707106781,o=.707106781):(r=Math.sqrt(B),i=Z/r,o=ee/r):K>ue?K<.01?(r=.707106781,i=0,o=.707106781):(i=Math.sqrt(K),r=Z/i,o=be/i):ue<.01?(r=.707106781,i=.707106781,o=0):(o=Math.sqrt(ue),r=ee/o,i=be/o),this.set(r,i,o,t),this}let U=Math.sqrt((D-k)*(D-k)+(M-z)*(M-z)+(w-x)*(w-x));return Math.abs(U)<.001&&(U=1),this.x=(D-k)/U,this.y=(M-z)/U,this.z=(w-x)/U,this.w=Math.acos((v+A+C-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this.w=e.w+(t.w-e.w)*r,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class wB extends ch{constructor(e=1,t=1,r={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Wi(0,0,e,t),this.scissorTest=!1,this.viewport=new Wi(0,0,e,t);const i={width:e,height:t,depth:1};r=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:io,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},r);const o=new Ca(i,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.colorSpace);o.flipY=!1,o.generateMipmaps=r.generateMipmaps,o.internalFormat=r.internalFormat,this.textures=[];const u=r.count;for(let l=0;l<u;l++)this.textures[l]=o.clone(),this.textures[l].isRenderTargetTexture=!0;this.depthBuffer=r.depthBuffer,this.stencilBuffer=r.stencilBuffer,this.depthTexture=r.depthTexture,this.samples=r.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,r=1){if(this.width!==e||this.height!==t||this.depth!==r){this.width=e,this.height=t,this.depth=r;for(let i=0,o=this.textures.length;i<o;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=r;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let r=0,i=e.textures.length;r<i;r++)this.textures[r]=e.textures[r].clone(),this.textures[r].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new L7(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class rh extends wB{constructor(e=1,t=1,r={}){super(e,t,r),this.isWebGLRenderTarget=!0}}class z7 extends Ca{constructor(e=null,t=1,r=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Is,this.minFilter=Is,this.wrapR=ju,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class SB extends Ca{constructor(e=null,t=1,r=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:r,depth:i},this.magFilter=Is,this.minFilter=Is,this.wrapR=ju,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class ih{constructor(e=0,t=0,r=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=r,this._w=i}static slerpFlat(e,t,r,i,o,u,l){let p=r[i+0],v=r[i+1],x=r[i+2],M=r[i+3];const w=o[u+0],A=o[u+1],k=o[u+2],z=o[u+3];if(l===0){e[t+0]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M;return}if(l===1){e[t+0]=w,e[t+1]=A,e[t+2]=k,e[t+3]=z;return}if(M!==z||p!==w||v!==A||x!==k){let D=1-l;const C=p*w+v*A+x*k+M*z,U=C>=0?1:-1,B=1-C*C;if(B>Number.EPSILON){const ue=Math.sqrt(B),Z=Math.atan2(ue,C*U);D=Math.sin(D*Z)/ue,l=Math.sin(l*Z)/ue}const K=l*U;if(p=p*D+w*K,v=v*D+A*K,x=x*D+k*K,M=M*D+z*K,D===1-l){const ue=1/Math.sqrt(p*p+v*v+x*x+M*M);p*=ue,v*=ue,x*=ue,M*=ue}}e[t]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M}static multiplyQuaternionsFlat(e,t,r,i,o,u){const l=r[i],p=r[i+1],v=r[i+2],x=r[i+3],M=o[u],w=o[u+1],A=o[u+2],k=o[u+3];return e[t]=l*k+x*M+p*A-v*w,e[t+1]=p*k+x*w+v*M-l*A,e[t+2]=v*k+x*A+l*w-p*M,e[t+3]=x*k-l*M-p*w-v*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const r=e._x,i=e._y,o=e._z,u=e._order,l=Math.cos,p=Math.sin,v=l(r/2),x=l(i/2),M=l(o/2),w=p(r/2),A=p(i/2),k=p(o/2);switch(u){case"XYZ":this._x=w*x*M+v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M-w*A*k;break;case"YXZ":this._x=w*x*M+v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M+w*A*k;break;case"ZXY":this._x=w*x*M-v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M-w*A*k;break;case"ZYX":this._x=w*x*M-v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M+w*A*k;break;case"YZX":this._x=w*x*M+v*A*k,this._y=v*A*M+w*x*k,this._z=v*x*k-w*A*M,this._w=v*x*M-w*A*k;break;case"XZY":this._x=w*x*M-v*A*k,this._y=v*A*M-w*x*k,this._z=v*x*k+w*A*M,this._w=v*x*M+w*A*k;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+u)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,r=t[0],i=t[4],o=t[8],u=t[1],l=t[5],p=t[9],v=t[2],x=t[6],M=t[10],w=r+l+M;if(w>0){const A=.5/Math.sqrt(w+1);this._w=.25/A,this._x=(x-p)*A,this._y=(o-v)*A,this._z=(u-i)*A}else if(r>l&&r>M){const A=2*Math.sqrt(1+r-l-M);this._w=(x-p)/A,this._x=.25*A,this._y=(i+u)/A,this._z=(o+v)/A}else if(l>M){const A=2*Math.sqrt(1+l-r-M);this._w=(o-v)/A,this._x=(i+u)/A,this._y=.25*A,this._z=(p+x)/A}else{const A=2*Math.sqrt(1+M-r-l);this._w=(u-i)/A,this._x=(o+v)/A,this._y=(p+x)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let r=e.dot(t)+1;return r<Number.EPSILON?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=r):(this._x=0,this._y=-e.z,this._z=e.y,this._w=r)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=r),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ua(this.dot(e),-1,1)))}rotateTowards(e,t){const r=this.angleTo(e);if(r===0)return this;const i=Math.min(1,t/r);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const r=e._x,i=e._y,o=e._z,u=e._w,l=t._x,p=t._y,v=t._z,x=t._w;return this._x=r*x+u*l+i*v-o*p,this._y=i*x+u*p+o*l-r*v,this._z=o*x+u*v+r*p-i*l,this._w=u*x-r*l-i*p-o*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const r=this._x,i=this._y,o=this._z,u=this._w;let l=u*e._w+r*e._x+i*e._y+o*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=u,this._x=r,this._y=i,this._z=o,this;const p=1-l*l;if(p<=Number.EPSILON){const A=1-t;return this._w=A*u+t*this._w,this._x=A*r+t*this._x,this._y=A*i+t*this._y,this._z=A*o+t*this._z,this.normalize(),this}const v=Math.sqrt(p),x=Math.atan2(v,l),M=Math.sin((1-t)*x)/v,w=Math.sin(t*x)/v;return this._w=u*M+this._w*w,this._x=r*M+this._x*w,this._y=i*M+this._y*w,this._z=o*M+this._z*w,this._onChangeCallback(),this}slerpQuaternions(e,t,r){return this.copy(e).slerp(t,r)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),o=Math.sqrt(r);return this.set(i*Math.sin(e),i*Math.cos(e),o*Math.sin(t),o*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class rt{constructor(e=0,t=0,r=0){rt.prototype.isVector3=!0,this.x=e,this.y=t,this.z=r}set(e,t,r){return r===void 0&&(r=this.z),this.x=e,this.y=t,this.z=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(eT.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(eT.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[3]*r+o[6]*i,this.y=o[1]*t+o[4]*r+o[7]*i,this.z=o[2]*t+o[5]*r+o[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,r=this.y,i=this.z,o=e.elements,u=1/(o[3]*t+o[7]*r+o[11]*i+o[15]);return this.x=(o[0]*t+o[4]*r+o[8]*i+o[12])*u,this.y=(o[1]*t+o[5]*r+o[9]*i+o[13])*u,this.z=(o[2]*t+o[6]*r+o[10]*i+o[14])*u,this}applyQuaternion(e){const t=this.x,r=this.y,i=this.z,o=e.x,u=e.y,l=e.z,p=e.w,v=2*(u*i-l*r),x=2*(l*t-o*i),M=2*(o*r-u*t);return this.x=t+p*v+u*M-l*x,this.y=r+p*x+l*v-o*M,this.z=i+p*M+o*x-u*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,r=this.y,i=this.z,o=e.elements;return this.x=o[0]*t+o[4]*r+o[8]*i,this.y=o[1]*t+o[5]*r+o[9]*i,this.z=o[2]*t+o[6]*r+o[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,r){return this.x=e.x+(t.x-e.x)*r,this.y=e.y+(t.y-e.y)*r,this.z=e.z+(t.z-e.z)*r,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const r=e.x,i=e.y,o=e.z,u=t.x,l=t.y,p=t.z;return this.x=i*p-o*l,this.y=o*u-r*p,this.z=r*l-i*u,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)}projectOnPlane(e){return kx.copy(this).projectOnVector(e),this.sub(kx)}reflect(e){return this.sub(kx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const r=this.dot(e)/t;return Math.acos(ua(r,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,r){const i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,r=Math.sqrt(1-t*t);return this.x=r*Math.cos(e),this.y=t,this.z=r*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const kx=new rt,eT=new ih;class ym{constructor(e=new rt(1/0,1/0,1/0),t=new rt(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t+=3)this.expandByPoint(Xs.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,r=e.count;t<r;t++)this.expandByPoint(Xs.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const r=Xs.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const r=e.geometry;if(r!==void 0){const o=r.getAttribute("position");if(t===!0&&o!==void 0&&e.isInstancedMesh!==!0)for(let u=0,l=o.count;u<l;u++)e.isMesh===!0?e.getVertexPosition(u,Xs):Xs.fromBufferAttribute(o,u),Xs.applyMatrix4(e.matrixWorld),this.expandByPoint(Xs);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Jg.copy(e.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Jg.copy(r.boundingBox)),Jg.applyMatrix4(e.matrixWorld),this.union(Jg)}const i=e.children;for(let o=0,u=i.length;o<u;o++)this.expandByObject(i[o],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Xs),Xs.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,r;return e.normal.x>0?(t=e.normal.x*this.min.x,r=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,r=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(K0),Qg.subVectors(this.max,K0),ad.subVectors(e.a,K0),sd.subVectors(e.b,K0),od.subVectors(e.c,K0),dc.subVectors(sd,ad),fc.subVectors(od,sd),Mu.subVectors(ad,od);let t=[0,-dc.z,dc.y,0,-fc.z,fc.y,0,-Mu.z,Mu.y,dc.z,0,-dc.x,fc.z,0,-fc.x,Mu.z,0,-Mu.x,-dc.y,dc.x,0,-fc.y,fc.x,0,-Mu.y,Mu.x,0];return!Lx(t,ad,sd,od,Qg)||(t=[1,0,0,0,1,0,0,0,1],!Lx(t,ad,sd,od,Qg))?!1:(e1.crossVectors(dc,fc),t=[e1.x,e1.y,e1.z],Lx(t,ad,sd,od,Qg))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Xs).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Xs).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(ol[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),ol[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),ol[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),ol[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),ol[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),ol[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),ol[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),ol[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(ol),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const ol=[new rt,new rt,new rt,new rt,new rt,new rt,new rt,new rt],Xs=new rt,Jg=new ym,ad=new rt,sd=new rt,od=new rt,dc=new rt,fc=new rt,Mu=new rt,K0=new rt,Qg=new rt,e1=new rt,Tu=new rt;function Lx(n,e,t,r,i){for(let o=0,u=n.length-3;o<=u;o+=3){Tu.fromArray(n,o);const l=i.x*Math.abs(Tu.x)+i.y*Math.abs(Tu.y)+i.z*Math.abs(Tu.z),p=e.dot(Tu),v=t.dot(Tu),x=r.dot(Tu);if(Math.max(-Math.max(p,v,x),Math.min(p,v,x))>l)return!1}return!0}const MB=new ym,J0=new rt,zx=new rt;class u4{constructor(e=new rt,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const r=this.center;t!==void 0?r.copy(t):MB.setFromPoints(e).getCenter(r);let i=0;for(let o=0,u=e.length;o<u;o++)i=Math.max(i,r.distanceToSquared(e[o]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const r=this.center.distanceToSquared(e);return t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;J0.subVectors(e,this.center);const t=J0.lengthSq();if(t>this.radius*this.radius){const r=Math.sqrt(t),i=(r-this.radius)*.5;this.center.addScaledVector(J0,i/r),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(zx.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(J0.copy(e.center).add(zx)),this.expandByPoint(J0.copy(e.center).sub(zx))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const ll=new rt,Fx=new rt,t1=new rt,pc=new rt,Nx=new rt,n1=new rt,Ox=new rt;class F7{constructor(e=new rt,t=new rt(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,ll)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,r)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=ll.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ll.copy(this.origin).addScaledVector(this.direction,t),ll.distanceToSquared(e))}distanceSqToSegment(e,t,r,i){Fx.copy(e).add(t).multiplyScalar(.5),t1.copy(t).sub(e).normalize(),pc.copy(this.origin).sub(Fx);const o=e.distanceTo(t)*.5,u=-this.direction.dot(t1),l=pc.dot(this.direction),p=-pc.dot(t1),v=pc.lengthSq(),x=Math.abs(1-u*u);let M,w,A,k;if(x>0)if(M=u*p-l,w=u*l-p,k=o*x,M>=0)if(w>=-k)if(w<=k){const z=1/x;M*=z,w*=z,A=M*(M+u*w+2*l)+w*(u*M+w+2*p)+v}else w=o,M=Math.max(0,-(u*w+l)),A=-M*M+w*(w+2*p)+v;else w=-o,M=Math.max(0,-(u*w+l)),A=-M*M+w*(w+2*p)+v;else w<=-k?(M=Math.max(0,-(-u*o+l)),w=M>0?-o:Math.min(Math.max(-o,-p),o),A=-M*M+w*(w+2*p)+v):w<=k?(M=0,w=Math.min(Math.max(-o,-p),o),A=w*(w+2*p)+v):(M=Math.max(0,-(u*o+l)),w=M>0?o:Math.min(Math.max(-o,-p),o),A=-M*M+w*(w+2*p)+v);else w=u>0?-o:o,M=Math.max(0,-(u*w+l)),A=-M*M+w*(w+2*p)+v;return r&&r.copy(this.origin).addScaledVector(this.direction,M),i&&i.copy(Fx).addScaledVector(t1,w),A}intersectSphere(e,t){ll.subVectors(e.center,this.origin);const r=ll.dot(this.direction),i=ll.dot(ll)-r*r,o=e.radius*e.radius;if(i>o)return null;const u=Math.sqrt(o-i),l=r-u,p=r+u;return p<0?null:l<0?this.at(p,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const r=-(this.origin.dot(e.normal)+e.constant)/t;return r>=0?r:null}intersectPlane(e,t){const r=this.distanceToPlane(e);return r===null?null:this.at(r,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let r,i,o,u,l,p;const v=1/this.direction.x,x=1/this.direction.y,M=1/this.direction.z,w=this.origin;return v>=0?(r=(e.min.x-w.x)*v,i=(e.max.x-w.x)*v):(r=(e.max.x-w.x)*v,i=(e.min.x-w.x)*v),x>=0?(o=(e.min.y-w.y)*x,u=(e.max.y-w.y)*x):(o=(e.max.y-w.y)*x,u=(e.min.y-w.y)*x),r>u||o>i||((o>r||isNaN(r))&&(r=o),(u<i||isNaN(i))&&(i=u),M>=0?(l=(e.min.z-w.z)*M,p=(e.max.z-w.z)*M):(l=(e.max.z-w.z)*M,p=(e.min.z-w.z)*M),r>p||l>i)||((l>r||r!==r)&&(r=l),(p<i||i!==i)&&(i=p),i<0)?null:this.at(r>=0?r:i,t)}intersectsBox(e){return this.intersectBox(e,ll)!==null}intersectTriangle(e,t,r,i,o){Nx.subVectors(t,e),n1.subVectors(r,e),Ox.crossVectors(Nx,n1);let u=this.direction.dot(Ox),l;if(u>0){if(i)return null;l=1}else if(u<0)l=-1,u=-u;else return null;pc.subVectors(this.origin,e);const p=l*this.direction.dot(n1.crossVectors(pc,n1));if(p<0)return null;const v=l*this.direction.dot(Nx.cross(pc));if(v<0||p+v>u)return null;const x=-l*pc.dot(Ox);return x<0?null:this.at(x/u,o)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Ti{constructor(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D){Ti.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D)}set(e,t,r,i,o,u,l,p,v,x,M,w,A,k,z,D){const C=this.elements;return C[0]=e,C[4]=t,C[8]=r,C[12]=i,C[1]=o,C[5]=u,C[9]=l,C[13]=p,C[2]=v,C[6]=x,C[10]=M,C[14]=w,C[3]=A,C[7]=k,C[11]=z,C[15]=D,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ti().fromArray(this.elements)}copy(e){const t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this}copyPosition(e){const t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,r=e.elements,i=1/ld.setFromMatrixColumn(e,0).length(),o=1/ld.setFromMatrixColumn(e,1).length(),u=1/ld.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*o,t[5]=r[5]*o,t[6]=r[6]*o,t[7]=0,t[8]=r[8]*u,t[9]=r[9]*u,t[10]=r[10]*u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,r=e.x,i=e.y,o=e.z,u=Math.cos(r),l=Math.sin(r),p=Math.cos(i),v=Math.sin(i),x=Math.cos(o),M=Math.sin(o);if(e.order==="XYZ"){const w=u*x,A=u*M,k=l*x,z=l*M;t[0]=p*x,t[4]=-p*M,t[8]=v,t[1]=A+k*v,t[5]=w-z*v,t[9]=-l*p,t[2]=z-w*v,t[6]=k+A*v,t[10]=u*p}else if(e.order==="YXZ"){const w=p*x,A=p*M,k=v*x,z=v*M;t[0]=w+z*l,t[4]=k*l-A,t[8]=u*v,t[1]=u*M,t[5]=u*x,t[9]=-l,t[2]=A*l-k,t[6]=z+w*l,t[10]=u*p}else if(e.order==="ZXY"){const w=p*x,A=p*M,k=v*x,z=v*M;t[0]=w-z*l,t[4]=-u*M,t[8]=k+A*l,t[1]=A+k*l,t[5]=u*x,t[9]=z-w*l,t[2]=-u*v,t[6]=l,t[10]=u*p}else if(e.order==="ZYX"){const w=u*x,A=u*M,k=l*x,z=l*M;t[0]=p*x,t[4]=k*v-A,t[8]=w*v+z,t[1]=p*M,t[5]=z*v+w,t[9]=A*v-k,t[2]=-v,t[6]=l*p,t[10]=u*p}else if(e.order==="YZX"){const w=u*p,A=u*v,k=l*p,z=l*v;t[0]=p*x,t[4]=z-w*M,t[8]=k*M+A,t[1]=M,t[5]=u*x,t[9]=-l*x,t[2]=-v*x,t[6]=A*M+k,t[10]=w-z*M}else if(e.order==="XZY"){const w=u*p,A=u*v,k=l*p,z=l*v;t[0]=p*x,t[4]=-M,t[8]=v*x,t[1]=w*M+z,t[5]=u*x,t[9]=A*M-k,t[2]=k*M-A,t[6]=l*x,t[10]=z*M+w}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(TB,e,EB)}lookAt(e,t,r){const i=this.elements;return is.subVectors(e,t),is.lengthSq()===0&&(is.z=1),is.normalize(),mc.crossVectors(r,is),mc.lengthSq()===0&&(Math.abs(r.z)===1?is.x+=1e-4:is.z+=1e-4,is.normalize(),mc.crossVectors(r,is)),mc.normalize(),r1.crossVectors(is,mc),i[0]=mc.x,i[4]=r1.x,i[8]=is.x,i[1]=mc.y,i[5]=r1.y,i[9]=is.y,i[2]=mc.z,i[6]=r1.z,i[10]=is.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const r=e.elements,i=t.elements,o=this.elements,u=r[0],l=r[4],p=r[8],v=r[12],x=r[1],M=r[5],w=r[9],A=r[13],k=r[2],z=r[6],D=r[10],C=r[14],U=r[3],B=r[7],K=r[11],ue=r[15],Z=i[0],ee=i[4],be=i[8],ie=i[12],Q=i[1],Ee=i[5],Fe=i[9],Ae=i[13],Ve=i[2],lt=i[6],ut=i[10],pt=i[14],ke=i[3],Je=i[7],tt=i[11],_t=i[15];return o[0]=u*Z+l*Q+p*Ve+v*ke,o[4]=u*ee+l*Ee+p*lt+v*Je,o[8]=u*be+l*Fe+p*ut+v*tt,o[12]=u*ie+l*Ae+p*pt+v*_t,o[1]=x*Z+M*Q+w*Ve+A*ke,o[5]=x*ee+M*Ee+w*lt+A*Je,o[9]=x*be+M*Fe+w*ut+A*tt,o[13]=x*ie+M*Ae+w*pt+A*_t,o[2]=k*Z+z*Q+D*Ve+C*ke,o[6]=k*ee+z*Ee+D*lt+C*Je,o[10]=k*be+z*Fe+D*ut+C*tt,o[14]=k*ie+z*Ae+D*pt+C*_t,o[3]=U*Z+B*Q+K*Ve+ue*ke,o[7]=U*ee+B*Ee+K*lt+ue*Je,o[11]=U*be+B*Fe+K*ut+ue*tt,o[15]=U*ie+B*Ae+K*pt+ue*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],r=e[4],i=e[8],o=e[12],u=e[1],l=e[5],p=e[9],v=e[13],x=e[2],M=e[6],w=e[10],A=e[14],k=e[3],z=e[7],D=e[11],C=e[15];return k*(+o*p*M-i*v*M-o*l*w+r*v*w+i*l*A-r*p*A)+z*(+t*p*A-t*v*w+o*u*w-i*u*A+i*v*x-o*p*x)+D*(+t*v*M-t*l*A-o*u*M+r*u*A+o*l*x-r*v*x)+C*(-i*l*x-t*p*M+t*l*w+i*u*M-r*u*w+r*p*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,r){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this}invert(){const e=this.elements,t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],M=e[9],w=e[10],A=e[11],k=e[12],z=e[13],D=e[14],C=e[15],U=M*D*v-z*w*v+z*p*A-l*D*A-M*p*C+l*w*C,B=k*w*v-x*D*v-k*p*A+u*D*A+x*p*C-u*w*C,K=x*z*v-k*M*v+k*l*A-u*z*A-x*l*C+u*M*C,ue=k*M*p-x*z*p-k*l*w+u*z*w+x*l*D-u*M*D,Z=t*U+r*B+i*K+o*ue;if(Z===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const ee=1/Z;return e[0]=U*ee,e[1]=(z*w*o-M*D*o-z*i*A+r*D*A+M*i*C-r*w*C)*ee,e[2]=(l*D*o-z*p*o+z*i*v-r*D*v-l*i*C+r*p*C)*ee,e[3]=(M*p*o-l*w*o-M*i*v+r*w*v+l*i*A-r*p*A)*ee,e[4]=B*ee,e[5]=(x*D*o-k*w*o+k*i*A-t*D*A-x*i*C+t*w*C)*ee,e[6]=(k*p*o-u*D*o-k*i*v+t*D*v+u*i*C-t*p*C)*ee,e[7]=(u*w*o-x*p*o+x*i*v-t*w*v-u*i*A+t*p*A)*ee,e[8]=K*ee,e[9]=(k*M*o-x*z*o-k*r*A+t*z*A+x*r*C-t*M*C)*ee,e[10]=(u*z*o-k*l*o+k*r*v-t*z*v-u*r*C+t*l*C)*ee,e[11]=(x*l*o-u*M*o-x*r*v+t*M*v+u*r*A-t*l*A)*ee,e[12]=ue*ee,e[13]=(x*z*i-k*M*i+k*r*w-t*z*w-x*r*D+t*M*D)*ee,e[14]=(k*l*i-u*z*i-k*r*p+t*z*p+u*r*D-t*l*D)*ee,e[15]=(u*M*i-x*l*i+x*r*p-t*M*p-u*r*w+t*l*w)*ee,this}scale(e){const t=this.elements,r=e.x,i=e.y,o=e.z;return t[0]*=r,t[4]*=i,t[8]*=o,t[1]*=r,t[5]*=i,t[9]*=o,t[2]*=r,t[6]*=i,t[10]*=o,t[3]*=r,t[7]*=i,t[11]*=o,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))}makeTranslation(e,t,r){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const r=Math.cos(t),i=Math.sin(t),o=1-r,u=e.x,l=e.y,p=e.z,v=o*u,x=o*l;return this.set(v*u+r,v*l-i*p,v*p+i*l,0,v*l+i*p,x*l+r,x*p-i*u,0,v*p-i*l,x*p+i*u,o*p*p+r,0,0,0,0,1),this}makeScale(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this}makeShear(e,t,r,i,o,u){return this.set(1,r,o,0,e,1,u,0,t,i,1,0,0,0,0,1),this}compose(e,t,r){const i=this.elements,o=t._x,u=t._y,l=t._z,p=t._w,v=o+o,x=u+u,M=l+l,w=o*v,A=o*x,k=o*M,z=u*x,D=u*M,C=l*M,U=p*v,B=p*x,K=p*M,ue=r.x,Z=r.y,ee=r.z;return i[0]=(1-(z+C))*ue,i[1]=(A+K)*ue,i[2]=(k-B)*ue,i[3]=0,i[4]=(A-K)*Z,i[5]=(1-(w+C))*Z,i[6]=(D+U)*Z,i[7]=0,i[8]=(k+B)*ee,i[9]=(D-U)*ee,i[10]=(1-(w+z))*ee,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,r){const i=this.elements;let o=ld.set(i[0],i[1],i[2]).length();const u=ld.set(i[4],i[5],i[6]).length(),l=ld.set(i[8],i[9],i[10]).length();this.determinant()<0&&(o=-o),e.x=i[12],e.y=i[13],e.z=i[14],Zs.copy(this);const v=1/o,x=1/u,M=1/l;return Zs.elements[0]*=v,Zs.elements[1]*=v,Zs.elements[2]*=v,Zs.elements[4]*=x,Zs.elements[5]*=x,Zs.elements[6]*=x,Zs.elements[8]*=M,Zs.elements[9]*=M,Zs.elements[10]*=M,t.setFromRotationMatrix(Zs),r.x=o,r.y=u,r.z=l,this}makePerspective(e,t,r,i,o,u,l=bl){const p=this.elements,v=2*o/(t-e),x=2*o/(r-i),M=(t+e)/(t-e),w=(r+i)/(r-i);let A,k;if(l===bl)A=-(u+o)/(u-o),k=-2*u*o/(u-o);else if(l===Dy)A=-u/(u-o),k=-u*o/(u-o);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return p[0]=v,p[4]=0,p[8]=M,p[12]=0,p[1]=0,p[5]=x,p[9]=w,p[13]=0,p[2]=0,p[6]=0,p[10]=A,p[14]=k,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(e,t,r,i,o,u,l=bl){const p=this.elements,v=1/(t-e),x=1/(r-i),M=1/(u-o),w=(t+e)*v,A=(r+i)*x;let k,z;if(l===bl)k=(u+o)*M,z=-2*M;else if(l===Dy)k=o*M,z=-1*M;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return p[0]=2*v,p[4]=0,p[8]=0,p[12]=-w,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-A,p[2]=0,p[6]=0,p[10]=z,p[14]=-k,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(e){const t=this.elements,r=e.elements;for(let i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0}fromArray(e,t=0){for(let r=0;r<16;r++)this.elements[r]=e[r+t];return this}toArray(e=[],t=0){const r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}}const ld=new rt,Zs=new Ti,TB=new rt(0,0,0),EB=new rt(1,1,1),mc=new rt,r1=new rt,is=new rt,tT=new Ti,nT=new ih;class Il{constructor(e=0,t=0,r=0,i=Il.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=r,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,r,i=this._order){return this._x=e,this._y=t,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,r=!0){const i=e.elements,o=i[0],u=i[4],l=i[8],p=i[1],v=i[5],x=i[9],M=i[2],w=i[6],A=i[10];switch(t){case"XYZ":this._y=Math.asin(ua(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-x,A),this._z=Math.atan2(-u,o)):(this._x=Math.atan2(w,v),this._z=0);break;case"YXZ":this._x=Math.asin(-ua(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(l,A),this._z=Math.atan2(p,v)):(this._y=Math.atan2(-M,o),this._z=0);break;case"ZXY":this._x=Math.asin(ua(w,-1,1)),Math.abs(w)<.9999999?(this._y=Math.atan2(-M,A),this._z=Math.atan2(-u,v)):(this._y=0,this._z=Math.atan2(p,o));break;case"ZYX":this._y=Math.asin(-ua(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(w,A),this._z=Math.atan2(p,o)):(this._x=0,this._z=Math.atan2(-u,v));break;case"YZX":this._z=Math.asin(ua(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,v),this._y=Math.atan2(-M,o)):(this._x=0,this._y=Math.atan2(l,A));break;case"XZY":this._z=Math.asin(-ua(u,-1,1)),Math.abs(u)<.9999999?(this._x=Math.atan2(w,v),this._y=Math.atan2(l,o)):(this._x=Math.atan2(-x,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,r===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,r){return tT.makeRotationFromQuaternion(e),this.setFromRotationMatrix(tT,t,r)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return nT.setFromEuler(this),this.setFromQuaternion(nT,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Il.DEFAULT_ORDER="XYZ";class N7{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let AB=0;const rT=new rt,cd=new ih,cl=new Ti,i1=new rt,Q0=new rt,CB=new rt,PB=new ih,iT=new rt(1,0,0),aT=new rt(0,1,0),sT=new rt(0,0,1),oT={type:"added"},RB={type:"removed"},ud={type:"childadded",child:null},Bx={type:"childremoved",child:null};class hs extends ch{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:AB++}),this.uuid=Sf(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=hs.DEFAULT_UP.clone();const e=new rt,t=new Il,r=new ih,i=new rt(1,1,1);function o(){r.setFromEuler(t,!1)}function u(){t.setFromQuaternion(r,void 0,!1)}t._onChange(o),r._onChange(u),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ti},normalMatrix:{value:new Jn}}),this.matrix=new Ti,this.matrixWorld=new Ti,this.matrixAutoUpdate=hs.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=hs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new N7,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return cd.setFromAxisAngle(e,t),this.quaternion.multiply(cd),this}rotateOnWorldAxis(e,t){return cd.setFromAxisAngle(e,t),this.quaternion.premultiply(cd),this}rotateX(e){return this.rotateOnAxis(iT,e)}rotateY(e){return this.rotateOnAxis(aT,e)}rotateZ(e){return this.rotateOnAxis(sT,e)}translateOnAxis(e,t){return rT.copy(e).applyQuaternion(this.quaternion),this.position.add(rT.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(iT,e)}translateY(e){return this.translateOnAxis(aT,e)}translateZ(e){return this.translateOnAxis(sT,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(cl.copy(this.matrixWorld).invert())}lookAt(e,t,r){e.isVector3?i1.copy(e):i1.set(e,t,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Q0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?cl.lookAt(Q0,i1,this.up):cl.lookAt(i1,Q0,this.up),this.quaternion.setFromRotationMatrix(cl),i&&(cl.extractRotation(i.matrixWorld),cd.setFromRotationMatrix(cl),this.quaternion.premultiply(cd.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(oT),ud.child=e,this.dispatchEvent(ud),ud.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(RB),Bx.child=e,this.dispatchEvent(Bx),Bx.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),cl.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),cl.multiply(e.parent.matrixWorld)),e.applyMatrix4(cl),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(oT),ud.child=e,this.dispatchEvent(ud),ud.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let r=0,i=this.children.length;r<i;r++){const u=this.children[r].getObjectByProperty(e,t);if(u!==void 0)return u}}getObjectsByProperty(e,t,r=[]){this[e]===t&&r.push(this);const i=this.children;for(let o=0,u=i.length;o<u;o++)i[o].getObjectsByProperty(e,t,r);return r}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Q0,e,CB),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Q0,PB,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let r=0,i=t.length;r<i;r++){const o=t[r];(o.matrixWorldAutoUpdate===!0||e===!0)&&o.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const r=this.parent;if(e===!0&&r!==null&&r.matrixWorldAutoUpdate===!0&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const i=this.children;for(let o=0,u=i.length;o<u;o++){const l=i[o];l.matrixWorldAutoUpdate===!0&&l.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),i.maxGeometryCount=this._maxGeometryCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function o(l,p){return l[p.uuid]===void 0&&(l[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=o(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const p=l.shapes;if(Array.isArray(p))for(let v=0,x=p.length;v<x;v++){const M=p[v];o(e.shapes,M)}else o(e.shapes,p)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(o(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let p=0,v=this.material.length;p<v;p++)l.push(o(e.materials,this.material[p]));i.material=l}else i.material=o(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const p=this.animations[l];i.animations.push(o(e.animations,p))}}if(t){const l=u(e.geometries),p=u(e.materials),v=u(e.textures),x=u(e.images),M=u(e.shapes),w=u(e.skeletons),A=u(e.animations),k=u(e.nodes);l.length>0&&(r.geometries=l),p.length>0&&(r.materials=p),v.length>0&&(r.textures=v),x.length>0&&(r.images=x),M.length>0&&(r.shapes=M),w.length>0&&(r.skeletons=w),A.length>0&&(r.animations=A),k.length>0&&(r.nodes=k)}return r.object=i,r;function u(l){const p=[];for(const v in l){const x=l[v];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let r=0;r<e.children.length;r++){const i=e.children[r];this.add(i.clone())}return this}}hs.DEFAULT_UP=new rt(0,1,0);hs.DEFAULT_MATRIX_AUTO_UPDATE=!0;hs.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Ys=new rt,ul=new rt,Ux=new rt,hl=new rt,hd=new rt,dd=new rt,lT=new rt,Vx=new rt,Hx=new rt,Gx=new rt;class Co{constructor(e=new rt,t=new rt,r=new rt){this.a=e,this.b=t,this.c=r}static getNormal(e,t,r,i){i.subVectors(r,t),Ys.subVectors(e,t),i.cross(Ys);const o=i.lengthSq();return o>0?i.multiplyScalar(1/Math.sqrt(o)):i.set(0,0,0)}static getBarycoord(e,t,r,i,o){Ys.subVectors(i,t),ul.subVectors(r,t),Ux.subVectors(e,t);const u=Ys.dot(Ys),l=Ys.dot(ul),p=Ys.dot(Ux),v=ul.dot(ul),x=ul.dot(Ux),M=u*v-l*l;if(M===0)return o.set(0,0,0),null;const w=1/M,A=(v*p-l*x)*w,k=(u*x-l*p)*w;return o.set(1-A-k,k,A)}static containsPoint(e,t,r,i){return this.getBarycoord(e,t,r,i,hl)===null?!1:hl.x>=0&&hl.y>=0&&hl.x+hl.y<=1}static getInterpolation(e,t,r,i,o,u,l,p){return this.getBarycoord(e,t,r,i,hl)===null?(p.x=0,p.y=0,"z"in p&&(p.z=0),"w"in p&&(p.w=0),null):(p.setScalar(0),p.addScaledVector(o,hl.x),p.addScaledVector(u,hl.y),p.addScaledVector(l,hl.z),p)}static isFrontFacing(e,t,r,i){return Ys.subVectors(r,t),ul.subVectors(e,t),Ys.cross(ul).dot(i)<0}set(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this}setFromPointsAndIndices(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,r,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,r),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Ys.subVectors(this.c,this.b),ul.subVectors(this.a,this.b),Ys.cross(ul).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Co.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Co.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,r,i,o){return Co.getInterpolation(e,this.a,this.b,this.c,t,r,i,o)}containsPoint(e){return Co.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Co.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const r=this.a,i=this.b,o=this.c;let u,l;hd.subVectors(i,r),dd.subVectors(o,r),Vx.subVectors(e,r);const p=hd.dot(Vx),v=dd.dot(Vx);if(p<=0&&v<=0)return t.copy(r);Hx.subVectors(e,i);const x=hd.dot(Hx),M=dd.dot(Hx);if(x>=0&&M<=x)return t.copy(i);const w=p*M-x*v;if(w<=0&&p>=0&&x<=0)return u=p/(p-x),t.copy(r).addScaledVector(hd,u);Gx.subVectors(e,o);const A=hd.dot(Gx),k=dd.dot(Gx);if(k>=0&&A<=k)return t.copy(o);const z=A*v-p*k;if(z<=0&&v>=0&&k<=0)return l=v/(v-k),t.copy(r).addScaledVector(dd,l);const D=x*k-A*M;if(D<=0&&M-x>=0&&A-k>=0)return lT.subVectors(o,i),l=(M-x)/(M-x+(A-k)),t.copy(i).addScaledVector(lT,l);const C=1/(D+z+w);return u=z*C,l=w*C,t.copy(r).addScaledVector(hd,u).addScaledVector(dd,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const O7={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},gc={h:0,s:0,l:0},a1={h:0,s:0,l:0};function jx(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Tr=class{constructor(e,t,r){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,r)}set(e,t,r){if(t===void 0&&r===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,r);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=wo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mr.toWorkingColorSpace(this,t),this}setRGB(e,t,r,i=Mr.workingColorSpace){return this.r=e,this.g=t,this.b=r,Mr.toWorkingColorSpace(this,i),this}setHSL(e,t,r,i=Mr.workingColorSpace){if(e=c4(e,1),t=ua(t,0,1),r=ua(r,0,1),t===0)this.r=this.g=this.b=r;else{const o=r<=.5?r*(1+t):r+t-r*t,u=2*r-o;this.r=jx(u,o,e+1/3),this.g=jx(u,o,e),this.b=jx(u,o,e-1/3)}return Mr.toWorkingColorSpace(this,i),this}setStyle(e,t=wo){function r(o){o!==void 0&&parseFloat(o)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let o;const u=i[1],l=i[2];switch(u){case"rgb":case"rgba":if(o=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setRGB(Math.min(255,parseInt(o[1],10))/255,Math.min(255,parseInt(o[2],10))/255,Math.min(255,parseInt(o[3],10))/255,t);if(o=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setRGB(Math.min(100,parseInt(o[1],10))/100,Math.min(100,parseInt(o[2],10))/100,Math.min(100,parseInt(o[3],10))/100,t);break;case"hsl":case"hsla":if(o=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return r(o[4]),this.setHSL(parseFloat(o[1])/360,parseFloat(o[2])/100,parseFloat(o[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const o=i[1],u=o.length;if(u===3)return this.setRGB(parseInt(o.charAt(0),16)/15,parseInt(o.charAt(1),16)/15,parseInt(o.charAt(2),16)/15,t);if(u===6)return this.setHex(parseInt(o,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=wo){const r=O7[e.toLowerCase()];return r!==void 0?this.setHex(r,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Kd(e.r),this.g=Kd(e.g),this.b=Kd(e.b),this}copyLinearToSRGB(e){return this.r=Ix(e.r),this.g=Ix(e.g),this.b=Ix(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=wo){return Mr.fromWorkingColorSpace(la.copy(this),e),Math.round(ua(la.r*255,0,255))*65536+Math.round(ua(la.g*255,0,255))*256+Math.round(ua(la.b*255,0,255))}getHexString(e=wo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Mr.workingColorSpace){Mr.fromWorkingColorSpace(la.copy(this),t);const r=la.r,i=la.g,o=la.b,u=Math.max(r,i,o),l=Math.min(r,i,o);let p,v;const x=(l+u)/2;if(l===u)p=0,v=0;else{const M=u-l;switch(v=x<=.5?M/(u+l):M/(2-u-l),u){case r:p=(i-o)/M+(i<o?6:0);break;case i:p=(o-r)/M+2;break;case o:p=(r-i)/M+4;break}p/=6}return e.h=p,e.s=v,e.l=x,e}getRGB(e,t=Mr.workingColorSpace){return Mr.fromWorkingColorSpace(la.copy(this),t),e.r=la.r,e.g=la.g,e.b=la.b,e}getStyle(e=wo){Mr.fromWorkingColorSpace(la.copy(this),e);const t=la.r,r=la.g,i=la.b;return e!==wo?`color(${e} ${t.toFixed(3)} ${r.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(r*255)},${Math.round(i*255)})`}offsetHSL(e,t,r){return this.getHSL(gc),this.setHSL(gc.h+e,gc.s+t,gc.l+r)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,r){return this.r=e.r+(t.r-e.r)*r,this.g=e.g+(t.g-e.g)*r,this.b=e.b+(t.b-e.b)*r,this}lerpHSL(e,t){this.getHSL(gc),e.getHSL(a1);const r=Sp(gc.h,a1.h,t),i=Sp(gc.s,a1.s,t),o=Sp(gc.l,a1.l,t);return this.setHSL(r,i,o),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,r=this.g,i=this.b,o=e.elements;return this.r=o[0]*t+o[3]*r+o[6]*i,this.g=o[1]*t+o[4]*r+o[7]*i,this.b=o[2]*t+o[5]*r+o[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const la=new Tr;Tr.NAMES=O7;let IB=0;class Mv extends ch{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:IB++}),this.uuid=Sf(),this.name="",this.type="Material",this.blending=Zd,this.side=Wc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Sb,this.blendDst=Mb,this.blendEquation=Nu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Tr(0,0,0),this.blendAlpha=0,this.depthFunc=Ay,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=qM,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=rd,this.stencilZFail=rd,this.stencilZPass=rd,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const r=e[t];if(r===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const r={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen!==void 0&&(r.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(r.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(r.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(r.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(r.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(r.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(r.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(r.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(r.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(r.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(r.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(r.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(r.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(r.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(r.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid,r.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(r.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(r.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(r.combine=this.combine)),this.envMapRotation!==void 0&&(r.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(r.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(r.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(r.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(r.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(r.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(r.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(r.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(r.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(r.size=this.size),this.shadowSide!==null&&(r.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==Zd&&(r.blending=this.blending),this.side!==Wc&&(r.side=this.side),this.vertexColors===!0&&(r.vertexColors=!0),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=!0),this.blendSrc!==Sb&&(r.blendSrc=this.blendSrc),this.blendDst!==Mb&&(r.blendDst=this.blendDst),this.blendEquation!==Nu&&(r.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(r.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(r.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(r.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(r.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(r.blendAlpha=this.blendAlpha),this.depthFunc!==Ay&&(r.depthFunc=this.depthFunc),this.depthTest===!1&&(r.depthTest=this.depthTest),this.depthWrite===!1&&(r.depthWrite=this.depthWrite),this.colorWrite===!1&&(r.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(r.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==qM&&(r.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(r.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(r.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==rd&&(r.stencilFail=this.stencilFail),this.stencilZFail!==rd&&(r.stencilZFail=this.stencilZFail),this.stencilZPass!==rd&&(r.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(r.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),this.alphaTest>0&&(r.alphaTest=this.alphaTest),this.alphaHash===!0&&(r.alphaHash=!0),this.alphaToCoverage===!0&&(r.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=!0),this.forceSinglePass===!0&&(r.forceSinglePass=!0),this.wireframe===!0&&(r.wireframe=!0),this.wireframeLinewidth>1&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(r.flatShading=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),this.fog===!1&&(r.fog=!1),Object.keys(this.userData).length>0&&(r.userData=this.userData);function i(o){const u=[];for(const l in o){const p=o[l];delete p.metadata,u.push(p)}return u}if(t){const o=i(e.textures),u=i(e.images);o.length>0&&(r.textures=o),u.length>0&&(r.images=u)}return r}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let r=null;if(t!==null){const i=t.length;r=new Array(i);for(let o=0;o!==i;++o)r[o]=t[o].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class B7 extends Mv{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Tr(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new Il,this.combine=w7,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const vi=new rt,s1=new qn;class Lo{constructor(e,t,r=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r,this.usage=XM,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=Rc,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return yB("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,r){e*=this.itemSize,r*=t.itemSize;for(let i=0,o=this.itemSize;i<o;i++)this.array[e+i]=t.array[r+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,r=this.count;t<r;t++)s1.fromBufferAttribute(this,t),s1.applyMatrix3(e),this.setXY(t,s1.x,s1.y);else if(this.itemSize===3)for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.applyMatrix3(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}applyMatrix4(e){for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.applyMatrix4(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}applyNormalMatrix(e){for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.applyNormalMatrix(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}transformDirection(e){for(let t=0,r=this.count;t<r;t++)vi.fromBufferAttribute(this,t),vi.transformDirection(e),this.setXYZ(t,vi.x,vi.y,vi.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let r=this.array[e*this.itemSize+t];return this.normalized&&(r=Sd(r,this.array)),r}setComponent(e,t,r){return this.normalized&&(r=Sa(r,this.array)),this.array[e*this.itemSize+t]=r,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=Sd(t,this.array)),t}setX(e,t){return this.normalized&&(t=Sa(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=Sd(t,this.array)),t}setY(e,t){return this.normalized&&(t=Sa(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=Sd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=Sa(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=Sd(t,this.array)),t}setW(e,t){return this.normalized&&(t=Sa(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,r){return e*=this.itemSize,this.normalized&&(t=Sa(t,this.array),r=Sa(r,this.array)),this.array[e+0]=t,this.array[e+1]=r,this}setXYZ(e,t,r,i){return e*=this.itemSize,this.normalized&&(t=Sa(t,this.array),r=Sa(r,this.array),i=Sa(i,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this}setXYZW(e,t,r,i,o){return e*=this.itemSize,this.normalized&&(t=Sa(t,this.array),r=Sa(r,this.array),i=Sa(i,this.array),o=Sa(o,this.array)),this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=o,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==XM&&(e.usage=this.usage),e}}class U7 extends Lo{constructor(e,t,r){super(new Uint16Array(e),t,r)}}class V7 extends Lo{constructor(e,t,r){super(new Uint32Array(e),t,r)}}class zo extends Lo{constructor(e,t,r){super(new Float32Array(e),t,r)}}let DB=0;const Ms=new Ti,Wx=new hs,fd=new rt,as=new ym,ep=new ym,ki=new rt;class tu extends ch{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:DB++}),this.uuid=Sf(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(k7(e)?V7:U7)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,r=0){this.groups.push({start:e,count:t,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const o=new Jn().getNormalMatrix(e);r.applyNormalMatrix(o),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return Ms.makeRotationFromQuaternion(e),this.applyMatrix4(Ms),this}rotateX(e){return Ms.makeRotationX(e),this.applyMatrix4(Ms),this}rotateY(e){return Ms.makeRotationY(e),this.applyMatrix4(Ms),this}rotateZ(e){return Ms.makeRotationZ(e),this.applyMatrix4(Ms),this}translate(e,t,r){return Ms.makeTranslation(e,t,r),this.applyMatrix4(Ms),this}scale(e,t,r){return Ms.makeScale(e,t,r),this.applyMatrix4(Ms),this}lookAt(e){return Wx.lookAt(e),Wx.updateMatrix(),this.applyMatrix4(Wx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(fd).negate(),this.translate(fd.x,fd.y,fd.z),this}setFromPoints(e){const t=[];for(let r=0,i=e.length;r<i;r++){const o=e[r];t.push(o.x,o.y,o.z||0)}return this.setAttribute("position",new zo(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ym);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new rt(-1/0,-1/0,-1/0),new rt(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let r=0,i=t.length;r<i;r++){const o=t[r];as.setFromBufferAttribute(o),this.morphTargetsRelative?(ki.addVectors(this.boundingBox.min,as.min),this.boundingBox.expandByPoint(ki),ki.addVectors(this.boundingBox.max,as.max),this.boundingBox.expandByPoint(ki)):(this.boundingBox.expandByPoint(as.min),this.boundingBox.expandByPoint(as.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new u4);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new rt,1/0);return}if(e){const r=this.boundingSphere.center;if(as.setFromBufferAttribute(e),t)for(let o=0,u=t.length;o<u;o++){const l=t[o];ep.setFromBufferAttribute(l),this.morphTargetsRelative?(ki.addVectors(as.min,ep.min),as.expandByPoint(ki),ki.addVectors(as.max,ep.max),as.expandByPoint(ki)):(as.expandByPoint(ep.min),as.expandByPoint(ep.max))}as.getCenter(r);let i=0;for(let o=0,u=e.count;o<u;o++)ki.fromBufferAttribute(e,o),i=Math.max(i,r.distanceToSquared(ki));if(t)for(let o=0,u=t.length;o<u;o++){const l=t[o],p=this.morphTargetsRelative;for(let v=0,x=l.count;v<x;v++)ki.fromBufferAttribute(l,v),p&&(fd.fromBufferAttribute(e,v),ki.add(fd)),i=Math.max(i,r.distanceToSquared(ki))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=t.position,i=t.normal,o=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Lo(new Float32Array(4*r.count),4));const u=this.getAttribute("tangent"),l=[],p=[];for(let be=0;be<r.count;be++)l[be]=new rt,p[be]=new rt;const v=new rt,x=new rt,M=new rt,w=new qn,A=new qn,k=new qn,z=new rt,D=new rt;function C(be,ie,Q){v.fromBufferAttribute(r,be),x.fromBufferAttribute(r,ie),M.fromBufferAttribute(r,Q),w.fromBufferAttribute(o,be),A.fromBufferAttribute(o,ie),k.fromBufferAttribute(o,Q),x.sub(v),M.sub(v),A.sub(w),k.sub(w);const Ee=1/(A.x*k.y-k.x*A.y);isFinite(Ee)&&(z.copy(x).multiplyScalar(k.y).addScaledVector(M,-A.y).multiplyScalar(Ee),D.copy(M).multiplyScalar(A.x).addScaledVector(x,-k.x).multiplyScalar(Ee),l[be].add(z),l[ie].add(z),l[Q].add(z),p[be].add(D),p[ie].add(D),p[Q].add(D))}let U=this.groups;U.length===0&&(U=[{start:0,count:e.count}]);for(let be=0,ie=U.length;be<ie;++be){const Q=U[be],Ee=Q.start,Fe=Q.count;for(let Ae=Ee,Ve=Ee+Fe;Ae<Ve;Ae+=3)C(e.getX(Ae+0),e.getX(Ae+1),e.getX(Ae+2))}const B=new rt,K=new rt,ue=new rt,Z=new rt;function ee(be){ue.fromBufferAttribute(i,be),Z.copy(ue);const ie=l[be];B.copy(ie),B.sub(ue.multiplyScalar(ue.dot(ie))).normalize(),K.crossVectors(Z,ie);const Ee=K.dot(p[be])<0?-1:1;u.setXYZW(be,B.x,B.y,B.z,Ee)}for(let be=0,ie=U.length;be<ie;++be){const Q=U[be],Ee=Q.start,Fe=Q.count;for(let Ae=Ee,Ve=Ee+Fe;Ae<Ve;Ae+=3)ee(e.getX(Ae+0)),ee(e.getX(Ae+1)),ee(e.getX(Ae+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new Lo(new Float32Array(t.count*3),3),this.setAttribute("normal",r);else for(let w=0,A=r.count;w<A;w++)r.setXYZ(w,0,0,0);const i=new rt,o=new rt,u=new rt,l=new rt,p=new rt,v=new rt,x=new rt,M=new rt;if(e)for(let w=0,A=e.count;w<A;w+=3){const k=e.getX(w+0),z=e.getX(w+1),D=e.getX(w+2);i.fromBufferAttribute(t,k),o.fromBufferAttribute(t,z),u.fromBufferAttribute(t,D),x.subVectors(u,o),M.subVectors(i,o),x.cross(M),l.fromBufferAttribute(r,k),p.fromBufferAttribute(r,z),v.fromBufferAttribute(r,D),l.add(x),p.add(x),v.add(x),r.setXYZ(k,l.x,l.y,l.z),r.setXYZ(z,p.x,p.y,p.z),r.setXYZ(D,v.x,v.y,v.z)}else for(let w=0,A=t.count;w<A;w+=3)i.fromBufferAttribute(t,w+0),o.fromBufferAttribute(t,w+1),u.fromBufferAttribute(t,w+2),x.subVectors(u,o),M.subVectors(i,o),x.cross(M),r.setXYZ(w+0,x.x,x.y,x.z),r.setXYZ(w+1,x.x,x.y,x.z),r.setXYZ(w+2,x.x,x.y,x.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,r=e.count;t<r;t++)ki.fromBufferAttribute(e,t),ki.normalize(),e.setXYZ(t,ki.x,ki.y,ki.z)}toNonIndexed(){function e(l,p){const v=l.array,x=l.itemSize,M=l.normalized,w=new v.constructor(p.length*x);let A=0,k=0;for(let z=0,D=p.length;z<D;z++){l.isInterleavedBufferAttribute?A=p[z]*l.data.stride+l.offset:A=p[z]*x;for(let C=0;C<x;C++)w[k++]=v[A++]}return new Lo(w,x,M)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new tu,r=this.index.array,i=this.attributes;for(const l in i){const p=i[l],v=e(p,r);t.setAttribute(l,v)}const o=this.morphAttributes;for(const l in o){const p=[],v=o[l];for(let x=0,M=v.length;x<M;x++){const w=v[x],A=e(w,r);p.push(A)}t.morphAttributes[l]=p}t.morphTargetsRelative=this.morphTargetsRelative;const u=this.groups;for(let l=0,p=u.length;l<p;l++){const v=u[l];t.addGroup(v.start,v.count,v.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const p=this.parameters;for(const v in p)p[v]!==void 0&&(e[v]=p[v]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const r=this.attributes;for(const p in r){const v=r[p];e.data.attributes[p]=v.toJSON(e.data)}const i={};let o=!1;for(const p in this.morphAttributes){const v=this.morphAttributes[p],x=[];for(let M=0,w=v.length;M<w;M++){const A=v[M];x.push(A.toJSON(e.data))}x.length>0&&(i[p]=x,o=!0)}o&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const u=this.groups;u.length>0&&(e.data.groups=JSON.parse(JSON.stringify(u)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const r=e.index;r!==null&&this.setIndex(r.clone(t));const i=e.attributes;for(const v in i){const x=i[v];this.setAttribute(v,x.clone(t))}const o=e.morphAttributes;for(const v in o){const x=[],M=o[v];for(let w=0,A=M.length;w<A;w++)x.push(M[w].clone(t));this.morphAttributes[v]=x}this.morphTargetsRelative=e.morphTargetsRelative;const u=e.groups;for(let v=0,x=u.length;v<x;v++){const M=u[v];this.addGroup(M.start,M.count,M.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const cT=new Ti,Eu=new F7,o1=new u4,uT=new rt,pd=new rt,md=new rt,gd=new rt,$x=new rt,l1=new rt,c1=new qn,u1=new qn,h1=new qn,hT=new rt,dT=new rt,fT=new rt,d1=new rt,f1=new rt;class cs extends hs{constructor(e=new tu,t=new B7){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,r=Object.keys(t);if(r.length>0){const i=t[r[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let o=0,u=i.length;o<u;o++){const l=i[o].name||String(o);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=o}}}}getVertexPosition(e,t){const r=this.geometry,i=r.attributes.position,o=r.morphAttributes.position,u=r.morphTargetsRelative;t.fromBufferAttribute(i,e);const l=this.morphTargetInfluences;if(o&&l){l1.set(0,0,0);for(let p=0,v=o.length;p<v;p++){const x=l[p],M=o[p];x!==0&&($x.fromBufferAttribute(M,e),u?l1.addScaledVector($x,x):l1.addScaledVector($x.sub(t),x))}t.add(l1)}return t}raycast(e,t){const r=this.geometry,i=this.material,o=this.matrixWorld;i!==void 0&&(r.boundingSphere===null&&r.computeBoundingSphere(),o1.copy(r.boundingSphere),o1.applyMatrix4(o),Eu.copy(e.ray).recast(e.near),!(o1.containsPoint(Eu.origin)===!1&&(Eu.intersectSphere(o1,uT)===null||Eu.origin.distanceToSquared(uT)>(e.far-e.near)**2))&&(cT.copy(o).invert(),Eu.copy(e.ray).applyMatrix4(cT),!(r.boundingBox!==null&&Eu.intersectsBox(r.boundingBox)===!1)&&this._computeIntersections(e,t,Eu)))}_computeIntersections(e,t,r){let i;const o=this.geometry,u=this.material,l=o.index,p=o.attributes.position,v=o.attributes.uv,x=o.attributes.uv1,M=o.attributes.normal,w=o.groups,A=o.drawRange;if(l!==null)if(Array.isArray(u))for(let k=0,z=w.length;k<z;k++){const D=w[k],C=u[D.materialIndex],U=Math.max(D.start,A.start),B=Math.min(l.count,Math.min(D.start+D.count,A.start+A.count));for(let K=U,ue=B;K<ue;K+=3){const Z=l.getX(K),ee=l.getX(K+1),be=l.getX(K+2);i=p1(this,C,e,r,v,x,M,Z,ee,be),i&&(i.faceIndex=Math.floor(K/3),i.face.materialIndex=D.materialIndex,t.push(i))}}else{const k=Math.max(0,A.start),z=Math.min(l.count,A.start+A.count);for(let D=k,C=z;D<C;D+=3){const U=l.getX(D),B=l.getX(D+1),K=l.getX(D+2);i=p1(this,u,e,r,v,x,M,U,B,K),i&&(i.faceIndex=Math.floor(D/3),t.push(i))}}else if(p!==void 0)if(Array.isArray(u))for(let k=0,z=w.length;k<z;k++){const D=w[k],C=u[D.materialIndex],U=Math.max(D.start,A.start),B=Math.min(p.count,Math.min(D.start+D.count,A.start+A.count));for(let K=U,ue=B;K<ue;K+=3){const Z=K,ee=K+1,be=K+2;i=p1(this,C,e,r,v,x,M,Z,ee,be),i&&(i.faceIndex=Math.floor(K/3),i.face.materialIndex=D.materialIndex,t.push(i))}}else{const k=Math.max(0,A.start),z=Math.min(p.count,A.start+A.count);for(let D=k,C=z;D<C;D+=3){const U=D,B=D+1,K=D+2;i=p1(this,u,e,r,v,x,M,U,B,K),i&&(i.faceIndex=Math.floor(D/3),t.push(i))}}}}function kB(n,e,t,r,i,o,u,l){let p;if(e.side===$a?p=r.intersectTriangle(u,o,i,!0,l):p=r.intersectTriangle(i,o,u,e.side===Wc,l),p===null)return null;f1.copy(l),f1.applyMatrix4(n.matrixWorld);const v=t.ray.origin.distanceTo(f1);return v<t.near||v>t.far?null:{distance:v,point:f1.clone(),object:n}}function p1(n,e,t,r,i,o,u,l,p,v){n.getVertexPosition(l,pd),n.getVertexPosition(p,md),n.getVertexPosition(v,gd);const x=kB(n,e,t,r,pd,md,gd,d1);if(x){i&&(c1.fromBufferAttribute(i,l),u1.fromBufferAttribute(i,p),h1.fromBufferAttribute(i,v),x.uv=Co.getInterpolation(d1,pd,md,gd,c1,u1,h1,new qn)),o&&(c1.fromBufferAttribute(o,l),u1.fromBufferAttribute(o,p),h1.fromBufferAttribute(o,v),x.uv1=Co.getInterpolation(d1,pd,md,gd,c1,u1,h1,new qn)),u&&(hT.fromBufferAttribute(u,l),dT.fromBufferAttribute(u,p),fT.fromBufferAttribute(u,v),x.normal=Co.getInterpolation(d1,pd,md,gd,hT,dT,fT,new rt),x.normal.dot(r.direction)>0&&x.normal.multiplyScalar(-1));const M={a:l,b:p,c:v,normal:new rt,materialIndex:0};Co.getNormal(pd,md,gd,M.normal),x.face=M}return x}class vm extends tu{constructor(e=1,t=1,r=1,i=1,o=1,u=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:r,widthSegments:i,heightSegments:o,depthSegments:u};const l=this;i=Math.floor(i),o=Math.floor(o),u=Math.floor(u);const p=[],v=[],x=[],M=[];let w=0,A=0;k("z","y","x",-1,-1,r,t,e,u,o,0),k("z","y","x",1,-1,r,t,-e,u,o,1),k("x","z","y",1,1,e,r,t,i,u,2),k("x","z","y",1,-1,e,r,-t,i,u,3),k("x","y","z",1,-1,e,t,r,i,o,4),k("x","y","z",-1,-1,e,t,-r,i,o,5),this.setIndex(p),this.setAttribute("position",new zo(v,3)),this.setAttribute("normal",new zo(x,3)),this.setAttribute("uv",new zo(M,2));function k(z,D,C,U,B,K,ue,Z,ee,be,ie){const Q=K/ee,Ee=ue/be,Fe=K/2,Ae=ue/2,Ve=Z/2,lt=ee+1,ut=be+1;let pt=0,ke=0;const Je=new rt;for(let tt=0;tt<ut;tt++){const _t=tt*Ee-Ae;for(let Lt=0;Lt<lt;Lt++){const Cn=Lt*Q-Fe;Je[z]=Cn*U,Je[D]=_t*B,Je[C]=Ve,v.push(Je.x,Je.y,Je.z),Je[z]=0,Je[D]=0,Je[C]=Z>0?1:-1,x.push(Je.x,Je.y,Je.z),M.push(Lt/ee),M.push(1-tt/be),pt+=1}}for(let tt=0;tt<be;tt++)for(let _t=0;_t<ee;_t++){const Lt=w+_t+lt*tt,Cn=w+_t+lt*(tt+1),nt=w+(_t+1)+lt*(tt+1),wt=w+(_t+1)+lt*tt;p.push(Lt,Cn,wt),p.push(Cn,nt,wt),ke+=6}l.addGroup(A,ke,ie),A+=ke,w+=pt}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new vm(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function ff(n){const e={};for(const t in n){e[t]={};for(const r in n[t]){const i=n[t][r];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][r]=null):e[t][r]=i.clone():Array.isArray(i)?e[t][r]=i.slice():e[t][r]=i}}return e}function Ma(n){const e={};for(let t=0;t<n.length;t++){const r=ff(n[t]);for(const i in r)e[i]=r[i]}return e}function LB(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function H7(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Mr.workingColorSpace}const zB={clone:ff,merge:Ma};var FB=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,NB=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Ds extends Mv{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=FB,this.fragmentShader=NB,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=ff(e.uniforms),this.uniformsGroups=LB(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const u=this.uniforms[i].value;u&&u.isTexture?t.uniforms[i]={type:"t",value:u.toJSON(e).uuid}:u&&u.isColor?t.uniforms[i]={type:"c",value:u.getHex()}:u&&u.isVector2?t.uniforms[i]={type:"v2",value:u.toArray()}:u&&u.isVector3?t.uniforms[i]={type:"v3",value:u.toArray()}:u&&u.isVector4?t.uniforms[i]={type:"v4",value:u.toArray()}:u&&u.isMatrix3?t.uniforms[i]={type:"m3",value:u.toArray()}:u&&u.isMatrix4?t.uniforms[i]={type:"m4",value:u.toArray()}:t.uniforms[i]={value:u}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const r={};for(const i in this.extensions)this.extensions[i]===!0&&(r[i]=!0);return Object.keys(r).length>0&&(t.extensions=r),t}}class G7 extends hs{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Ti,this.projectionMatrix=new Ti,this.projectionMatrixInverse=new Ti,this.coordinateSystem=bl}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const yc=new rt,pT=new qn,mT=new qn;class Cs extends G7{constructor(e=50,t=1,r=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=r,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Yp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(wp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Yp*2*Math.atan(Math.tan(wp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,r){yc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(yc.x,yc.y).multiplyScalar(-e/yc.z),yc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),r.set(yc.x,yc.y).multiplyScalar(-e/yc.z)}getViewSize(e,t){return this.getViewBounds(e,pT,mT),t.subVectors(mT,pT)}setViewOffset(e,t,r,i,o,u){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(wp*.5*this.fov)/this.zoom,r=2*t,i=this.aspect*r,o=-.5*i;const u=this.view;if(this.view!==null&&this.view.enabled){const p=u.fullWidth,v=u.fullHeight;o+=u.offsetX*i/p,t-=u.offsetY*r/v,i*=u.width/p,r*=u.height/v}const l=this.filmOffset;l!==0&&(o+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(o,o+i,t,t-r,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const yd=-90,vd=1;class OB extends hs{constructor(e,t,r){super(),this.type="CubeCamera",this.renderTarget=r,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new Cs(yd,vd,e,t);i.layers=this.layers,this.add(i);const o=new Cs(yd,vd,e,t);o.layers=this.layers,this.add(o);const u=new Cs(yd,vd,e,t);u.layers=this.layers,this.add(u);const l=new Cs(yd,vd,e,t);l.layers=this.layers,this.add(l);const p=new Cs(yd,vd,e,t);p.layers=this.layers,this.add(p);const v=new Cs(yd,vd,e,t);v.layers=this.layers,this.add(v)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[r,i,o,u,l,p]=t;for(const v of t)this.remove(v);if(e===bl)r.up.set(0,1,0),r.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),o.up.set(0,0,-1),o.lookAt(0,1,0),u.up.set(0,0,1),u.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),p.up.set(0,1,0),p.lookAt(0,0,-1);else if(e===Dy)r.up.set(0,-1,0),r.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),o.up.set(0,0,1),o.lookAt(0,1,0),u.up.set(0,0,-1),u.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),p.up.set(0,-1,0),p.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const v of t)this.add(v),v.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:r,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[o,u,l,p,v,x]=this.children,M=e.getRenderTarget(),w=e.getActiveCubeFace(),A=e.getActiveMipmapLevel(),k=e.xr.enabled;e.xr.enabled=!1;const z=r.texture.generateMipmaps;r.texture.generateMipmaps=!1,e.setRenderTarget(r,0,i),e.render(t,o),e.setRenderTarget(r,1,i),e.render(t,u),e.setRenderTarget(r,2,i),e.render(t,l),e.setRenderTarget(r,3,i),e.render(t,p),e.setRenderTarget(r,4,i),e.render(t,v),r.texture.generateMipmaps=z,e.setRenderTarget(r,5,i),e.render(t,x),e.setRenderTarget(M,w,A),e.xr.enabled=k,r.texture.needsPMREMUpdate=!0}}class j7 extends Ca{constructor(e,t,r,i,o,u,l,p,v,x){e=e!==void 0?e:[],t=t!==void 0?t:uf,super(e,t,r,i,o,u,l,p,v,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class BB extends rh{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const r={width:e,height:e,depth:1},i=[r,r,r,r,r,r];this.texture=new j7(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:io}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const r={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new vm(5,5,5),o=new Ds({name:"CubemapFromEquirect",uniforms:ff(r.uniforms),vertexShader:r.vertexShader,fragmentShader:r.fragmentShader,side:$a,blending:Uc});o.uniforms.tEquirect.value=t;const u=new cs(i,o),l=t.minFilter;return t.minFilter===Wu&&(t.minFilter=io),new OB(1,10,this).update(e,u),t.minFilter=l,u.geometry.dispose(),u.material.dispose(),this}clear(e,t,r,i){const o=e.getRenderTarget();for(let u=0;u<6;u++)e.setRenderTarget(this,u),e.clear(t,r,i);e.setRenderTarget(o)}}const qx=new rt,UB=new rt,VB=new Jn;class Mc{constructor(e=new rt(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,r){const i=qx.subVectors(r,t).cross(UB.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const r=e.delta(qx),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const o=-(e.start.dot(this.normal)+this.constant)/i;return o<0||o>1?null:t.copy(e.start).addScaledVector(r,o)}intersectsLine(e){const t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&r>0||r<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const r=t||VB.getNormalMatrix(e),i=this.coplanarPoint(qx).applyMatrix4(e),o=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(o),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const Au=new u4,m1=new rt;class W7{constructor(e=new Mc,t=new Mc,r=new Mc,i=new Mc,o=new Mc,u=new Mc){this.planes=[e,t,r,i,o,u]}set(e,t,r,i,o,u){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(r),l[3].copy(i),l[4].copy(o),l[5].copy(u),this}copy(e){const t=this.planes;for(let r=0;r<6;r++)t[r].copy(e.planes[r]);return this}setFromProjectionMatrix(e,t=bl){const r=this.planes,i=e.elements,o=i[0],u=i[1],l=i[2],p=i[3],v=i[4],x=i[5],M=i[6],w=i[7],A=i[8],k=i[9],z=i[10],D=i[11],C=i[12],U=i[13],B=i[14],K=i[15];if(r[0].setComponents(p-o,w-v,D-A,K-C).normalize(),r[1].setComponents(p+o,w+v,D+A,K+C).normalize(),r[2].setComponents(p+u,w+x,D+k,K+U).normalize(),r[3].setComponents(p-u,w-x,D-k,K-U).normalize(),r[4].setComponents(p-l,w-M,D-z,K-B).normalize(),t===bl)r[5].setComponents(p+l,w+M,D+z,K+B).normalize();else if(t===Dy)r[5].setComponents(l,M,z,B).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),Au.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),Au.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(Au)}intersectsSprite(e){return Au.center.set(0,0,0),Au.radius=.7071067811865476,Au.applyMatrix4(e.matrixWorld),this.intersectsSphere(Au)}intersectsSphere(e){const t=this.planes,r=e.center,i=-e.radius;for(let o=0;o<6;o++)if(t[o].distanceToPoint(r)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let r=0;r<6;r++){const i=t[r];if(m1.x=i.normal.x>0?e.max.x:e.min.x,m1.y=i.normal.y>0?e.max.y:e.min.y,m1.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(m1)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function $7(){let n=null,e=!1,t=null,r=null;function i(o,u){t(o,u),r=n.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(r=n.requestAnimationFrame(i),e=!0)},stop:function(){n.cancelAnimationFrame(r),e=!1},setAnimationLoop:function(o){t=o},setContext:function(o){n=o}}}function HB(n){const e=new WeakMap;function t(l,p){const v=l.array,x=l.usage,M=v.byteLength,w=n.createBuffer();n.bindBuffer(p,w),n.bufferData(p,v,x),l.onUploadCallback();let A;if(v instanceof Float32Array)A=n.FLOAT;else if(v instanceof Uint16Array)l.isFloat16BufferAttribute?A=n.HALF_FLOAT:A=n.UNSIGNED_SHORT;else if(v instanceof Int16Array)A=n.SHORT;else if(v instanceof Uint32Array)A=n.UNSIGNED_INT;else if(v instanceof Int32Array)A=n.INT;else if(v instanceof Int8Array)A=n.BYTE;else if(v instanceof Uint8Array)A=n.UNSIGNED_BYTE;else if(v instanceof Uint8ClampedArray)A=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+v);return{buffer:w,type:A,bytesPerElement:v.BYTES_PER_ELEMENT,version:l.version,size:M}}function r(l,p,v){const x=p.array,M=p._updateRange,w=p.updateRanges;if(n.bindBuffer(v,l),M.count===-1&&w.length===0&&n.bufferSubData(v,0,x),w.length!==0){for(let A=0,k=w.length;A<k;A++){const z=w[A];n.bufferSubData(v,z.start*x.BYTES_PER_ELEMENT,x,z.start,z.count)}p.clearUpdateRanges()}M.count!==-1&&(n.bufferSubData(v,M.offset*x.BYTES_PER_ELEMENT,x,M.offset,M.count),M.count=-1),p.onUploadCallback()}function i(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function o(l){l.isInterleavedBufferAttribute&&(l=l.data);const p=e.get(l);p&&(n.deleteBuffer(p.buffer),e.delete(l))}function u(l,p){if(l.isGLBufferAttribute){const x=e.get(l);(!x||x.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}l.isInterleavedBufferAttribute&&(l=l.data);const v=e.get(l);if(v===void 0)e.set(l,t(l,p));else if(v.version<l.version){if(v.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");r(v.buffer,l,p),v.version=l.version}}return{get:i,remove:o,update:u}}class _m extends tu{constructor(e=1,t=1,r=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};const o=e/2,u=t/2,l=Math.floor(r),p=Math.floor(i),v=l+1,x=p+1,M=e/l,w=t/p,A=[],k=[],z=[],D=[];for(let C=0;C<x;C++){const U=C*w-u;for(let B=0;B<v;B++){const K=B*M-o;k.push(K,-U,0),z.push(0,0,1),D.push(B/l),D.push(1-C/p)}}for(let C=0;C<p;C++)for(let U=0;U<l;U++){const B=U+v*C,K=U+v*(C+1),ue=U+1+v*(C+1),Z=U+1+v*C;A.push(B,K,Z),A.push(K,ue,Z)}this.setIndex(A),this.setAttribute("position",new zo(k,3)),this.setAttribute("normal",new zo(z,3)),this.setAttribute("uv",new zo(D,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new _m(e.width,e.height,e.widthSegments,e.heightSegments)}}var GB=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,jB=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,WB=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,$B=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,qB=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,XB=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,ZB=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,YB=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,KB=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,JB=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,QB=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,eU=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,tU=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,nU=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,rU=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,iU=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,aU=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,sU=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,oU=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,lU=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,cU=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,uU=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,hU=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,dU=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,fU=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,pU=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,mU=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,gU=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,yU=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,vU=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,_U="gl_FragColor = linearToOutputTexel( gl_FragColor );",xU=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,bU=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,wU=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,SU=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,MU=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,TU=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,EU=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,AU=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,CU=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,PU=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,RU=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,IU=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,DU=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,kU=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,LU=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,zU=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,FU=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,NU=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,OU=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,BU=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,UU=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,VU=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,HU=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,GU=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,jU=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,WU=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,$U=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,qU=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,XU=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,ZU=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,YU=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,KU=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,JU=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,QU=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,eV=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,tV=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,nV=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,rV=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,iV=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,aV=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,sV=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,oV=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,lV=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,cV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,uV=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,hV=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,dV=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,fV=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,pV=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,mV=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,gV=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,yV=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,vV=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,_V=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,xV=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,bV=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,wV=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,SV=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,MV=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,TV=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,EV=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,AV=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,CV=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,PV=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,RV=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,IV=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,DV=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,kV=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,LV=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,zV=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,FV=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, newPeak * vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,NV=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,OV=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,BV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,UV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,VV=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,HV=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const GV=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,jV=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,WV=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,$V=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,qV=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XV=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZV=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,YV=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,KV=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,JV=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,QV=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,eH=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,tH=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,nH=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,rH=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,iH=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,aH=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sH=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oH=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,lH=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cH=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,uH=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,hH=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,dH=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,fH=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,pH=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mH=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,gH=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yH=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,vH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,_H=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,xH=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,bH=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,wH=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Kn={alphahash_fragment:GB,alphahash_pars_fragment:jB,alphamap_fragment:WB,alphamap_pars_fragment:$B,alphatest_fragment:qB,alphatest_pars_fragment:XB,aomap_fragment:ZB,aomap_pars_fragment:YB,batching_pars_vertex:KB,batching_vertex:JB,begin_vertex:QB,beginnormal_vertex:eU,bsdfs:tU,iridescence_fragment:nU,bumpmap_pars_fragment:rU,clipping_planes_fragment:iU,clipping_planes_pars_fragment:aU,clipping_planes_pars_vertex:sU,clipping_planes_vertex:oU,color_fragment:lU,color_pars_fragment:cU,color_pars_vertex:uU,color_vertex:hU,common:dU,cube_uv_reflection_fragment:fU,defaultnormal_vertex:pU,displacementmap_pars_vertex:mU,displacementmap_vertex:gU,emissivemap_fragment:yU,emissivemap_pars_fragment:vU,colorspace_fragment:_U,colorspace_pars_fragment:xU,envmap_fragment:bU,envmap_common_pars_fragment:wU,envmap_pars_fragment:SU,envmap_pars_vertex:MU,envmap_physical_pars_fragment:FU,envmap_vertex:TU,fog_vertex:EU,fog_pars_vertex:AU,fog_fragment:CU,fog_pars_fragment:PU,gradientmap_pars_fragment:RU,lightmap_fragment:IU,lightmap_pars_fragment:DU,lights_lambert_fragment:kU,lights_lambert_pars_fragment:LU,lights_pars_begin:zU,lights_toon_fragment:NU,lights_toon_pars_fragment:OU,lights_phong_fragment:BU,lights_phong_pars_fragment:UU,lights_physical_fragment:VU,lights_physical_pars_fragment:HU,lights_fragment_begin:GU,lights_fragment_maps:jU,lights_fragment_end:WU,logdepthbuf_fragment:$U,logdepthbuf_pars_fragment:qU,logdepthbuf_pars_vertex:XU,logdepthbuf_vertex:ZU,map_fragment:YU,map_pars_fragment:KU,map_particle_fragment:JU,map_particle_pars_fragment:QU,metalnessmap_fragment:eV,metalnessmap_pars_fragment:tV,morphinstance_vertex:nV,morphcolor_vertex:rV,morphnormal_vertex:iV,morphtarget_pars_vertex:aV,morphtarget_vertex:sV,normal_fragment_begin:oV,normal_fragment_maps:lV,normal_pars_fragment:cV,normal_pars_vertex:uV,normal_vertex:hV,normalmap_pars_fragment:dV,clearcoat_normal_fragment_begin:fV,clearcoat_normal_fragment_maps:pV,clearcoat_pars_fragment:mV,iridescence_pars_fragment:gV,opaque_fragment:yV,packing:vV,premultiplied_alpha_fragment:_V,project_vertex:xV,dithering_fragment:bV,dithering_pars_fragment:wV,roughnessmap_fragment:SV,roughnessmap_pars_fragment:MV,shadowmap_pars_fragment:TV,shadowmap_pars_vertex:EV,shadowmap_vertex:AV,shadowmask_pars_fragment:CV,skinbase_vertex:PV,skinning_pars_vertex:RV,skinning_vertex:IV,skinnormal_vertex:DV,specularmap_fragment:kV,specularmap_pars_fragment:LV,tonemapping_fragment:zV,tonemapping_pars_fragment:FV,transmission_fragment:NV,transmission_pars_fragment:OV,uv_pars_fragment:BV,uv_pars_vertex:UV,uv_vertex:VV,worldpos_vertex:HV,background_vert:GV,background_frag:jV,backgroundCube_vert:WV,backgroundCube_frag:$V,cube_vert:qV,cube_frag:XV,depth_vert:ZV,depth_frag:YV,distanceRGBA_vert:KV,distanceRGBA_frag:JV,equirect_vert:QV,equirect_frag:eH,linedashed_vert:tH,linedashed_frag:nH,meshbasic_vert:rH,meshbasic_frag:iH,meshlambert_vert:aH,meshlambert_frag:sH,meshmatcap_vert:oH,meshmatcap_frag:lH,meshnormal_vert:cH,meshnormal_frag:uH,meshphong_vert:hH,meshphong_frag:dH,meshphysical_vert:fH,meshphysical_frag:pH,meshtoon_vert:mH,meshtoon_frag:gH,points_vert:yH,points_frag:vH,shadow_vert:_H,shadow_frag:xH,sprite_vert:bH,sprite_frag:wH},ln={common:{diffuse:{value:new Tr(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jn}},envmap:{envMap:{value:null},envMapRotation:{value:new Jn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jn},normalScale:{value:new qn(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Tr(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Tr(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Tr(16777215)},opacity:{value:1},center:{value:new qn(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}}},So={basic:{uniforms:Ma([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.fog]),vertexShader:Kn.meshbasic_vert,fragmentShader:Kn.meshbasic_frag},lambert:{uniforms:Ma([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Tr(0)}}]),vertexShader:Kn.meshlambert_vert,fragmentShader:Kn.meshlambert_frag},phong:{uniforms:Ma([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Tr(0)},specular:{value:new Tr(1118481)},shininess:{value:30}}]),vertexShader:Kn.meshphong_vert,fragmentShader:Kn.meshphong_frag},standard:{uniforms:Ma([ln.common,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.roughnessmap,ln.metalnessmap,ln.fog,ln.lights,{emissive:{value:new Tr(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kn.meshphysical_vert,fragmentShader:Kn.meshphysical_frag},toon:{uniforms:Ma([ln.common,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.gradientmap,ln.fog,ln.lights,{emissive:{value:new Tr(0)}}]),vertexShader:Kn.meshtoon_vert,fragmentShader:Kn.meshtoon_frag},matcap:{uniforms:Ma([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,{matcap:{value:null}}]),vertexShader:Kn.meshmatcap_vert,fragmentShader:Kn.meshmatcap_frag},points:{uniforms:Ma([ln.points,ln.fog]),vertexShader:Kn.points_vert,fragmentShader:Kn.points_frag},dashed:{uniforms:Ma([ln.common,ln.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kn.linedashed_vert,fragmentShader:Kn.linedashed_frag},depth:{uniforms:Ma([ln.common,ln.displacementmap]),vertexShader:Kn.depth_vert,fragmentShader:Kn.depth_frag},normal:{uniforms:Ma([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,{opacity:{value:1}}]),vertexShader:Kn.meshnormal_vert,fragmentShader:Kn.meshnormal_frag},sprite:{uniforms:Ma([ln.sprite,ln.fog]),vertexShader:Kn.sprite_vert,fragmentShader:Kn.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Kn.background_vert,fragmentShader:Kn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Jn}},vertexShader:Kn.backgroundCube_vert,fragmentShader:Kn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kn.cube_vert,fragmentShader:Kn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kn.equirect_vert,fragmentShader:Kn.equirect_frag},distanceRGBA:{uniforms:Ma([ln.common,ln.displacementmap,{referencePosition:{value:new rt},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kn.distanceRGBA_vert,fragmentShader:Kn.distanceRGBA_frag},shadow:{uniforms:Ma([ln.lights,ln.fog,{color:{value:new Tr(0)},opacity:{value:1}}]),vertexShader:Kn.shadow_vert,fragmentShader:Kn.shadow_frag}};So.physical={uniforms:Ma([So.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jn},clearcoatNormalScale:{value:new qn(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jn},sheen:{value:0},sheenColor:{value:new Tr(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jn},transmissionSamplerSize:{value:new qn},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jn},attenuationDistance:{value:0},attenuationColor:{value:new Tr(0)},specularColor:{value:new Tr(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jn},anisotropyVector:{value:new qn},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jn}}]),vertexShader:Kn.meshphysical_vert,fragmentShader:Kn.meshphysical_frag};const g1={r:0,b:0,g:0},Cu=new Il,SH=new Ti;function MH(n,e,t,r,i,o,u){const l=new Tr(0);let p=o===!0?0:1,v,x,M=null,w=0,A=null;function k(D,C){let U=!1,B=C.isScene===!0?C.background:null;B&&B.isTexture&&(B=(C.backgroundBlurriness>0?t:e).get(B)),B===null?z(l,p):B&&B.isColor&&(z(B,1),U=!0);const K=n.xr.getEnvironmentBlendMode();K==="additive"?r.buffers.color.setClear(0,0,0,1,u):K==="alpha-blend"&&r.buffers.color.setClear(0,0,0,0,u),(n.autoClear||U)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),B&&(B.isCubeTexture||B.mapping===wv)?(x===void 0&&(x=new cs(new vm(1,1,1),new Ds({name:"BackgroundCubeMaterial",uniforms:ff(So.backgroundCube.uniforms),vertexShader:So.backgroundCube.vertexShader,fragmentShader:So.backgroundCube.fragmentShader,side:$a,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(ue,Z,ee){this.matrixWorld.copyPosition(ee.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(x)),Cu.copy(C.backgroundRotation),Cu.x*=-1,Cu.y*=-1,Cu.z*=-1,B.isCubeTexture&&B.isRenderTargetTexture===!1&&(Cu.y*=-1,Cu.z*=-1),x.material.uniforms.envMap.value=B,x.material.uniforms.flipEnvMap.value=B.isCubeTexture&&B.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=C.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,x.material.uniforms.backgroundRotation.value.setFromMatrix4(SH.makeRotationFromEuler(Cu)),x.material.toneMapped=Mr.getTransfer(B.colorSpace)!==Or,(M!==B||w!==B.version||A!==n.toneMapping)&&(x.material.needsUpdate=!0,M=B,w=B.version,A=n.toneMapping),x.layers.enableAll(),D.unshift(x,x.geometry,x.material,0,0,null)):B&&B.isTexture&&(v===void 0&&(v=new cs(new _m(2,2),new Ds({name:"BackgroundMaterial",uniforms:ff(So.background.uniforms),vertexShader:So.background.vertexShader,fragmentShader:So.background.fragmentShader,side:Wc,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),Object.defineProperty(v.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(v)),v.material.uniforms.t2D.value=B,v.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,v.material.toneMapped=Mr.getTransfer(B.colorSpace)!==Or,B.matrixAutoUpdate===!0&&B.updateMatrix(),v.material.uniforms.uvTransform.value.copy(B.matrix),(M!==B||w!==B.version||A!==n.toneMapping)&&(v.material.needsUpdate=!0,M=B,w=B.version,A=n.toneMapping),v.layers.enableAll(),D.unshift(v,v.geometry,v.material,0,0,null))}function z(D,C){D.getRGB(g1,H7(n)),r.buffers.color.setClear(g1.r,g1.g,g1.b,C,u)}return{getClearColor:function(){return l},setClearColor:function(D,C=1){l.set(D),p=C,z(l,p)},getClearAlpha:function(){return p},setClearAlpha:function(D){p=D,z(l,p)},render:k}}function TH(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),r={},i=w(null);let o=i,u=!1;function l(Q,Ee,Fe,Ae,Ve){let lt=!1;const ut=M(Ae,Fe,Ee);o!==ut&&(o=ut,v(o.object)),lt=A(Q,Ae,Fe,Ve),lt&&k(Q,Ae,Fe,Ve),Ve!==null&&e.update(Ve,n.ELEMENT_ARRAY_BUFFER),(lt||u)&&(u=!1,K(Q,Ee,Fe,Ae),Ve!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(Ve).buffer))}function p(){return n.createVertexArray()}function v(Q){return n.bindVertexArray(Q)}function x(Q){return n.deleteVertexArray(Q)}function M(Q,Ee,Fe){const Ae=Fe.wireframe===!0;let Ve=r[Q.id];Ve===void 0&&(Ve={},r[Q.id]=Ve);let lt=Ve[Ee.id];lt===void 0&&(lt={},Ve[Ee.id]=lt);let ut=lt[Ae];return ut===void 0&&(ut=w(p()),lt[Ae]=ut),ut}function w(Q){const Ee=[],Fe=[],Ae=[];for(let Ve=0;Ve<t;Ve++)Ee[Ve]=0,Fe[Ve]=0,Ae[Ve]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Ee,enabledAttributes:Fe,attributeDivisors:Ae,object:Q,attributes:{},index:null}}function A(Q,Ee,Fe,Ae){const Ve=o.attributes,lt=Ee.attributes;let ut=0;const pt=Fe.getAttributes();for(const ke in pt)if(pt[ke].location>=0){const tt=Ve[ke];let _t=lt[ke];if(_t===void 0&&(ke==="instanceMatrix"&&Q.instanceMatrix&&(_t=Q.instanceMatrix),ke==="instanceColor"&&Q.instanceColor&&(_t=Q.instanceColor)),tt===void 0||tt.attribute!==_t||_t&&tt.data!==_t.data)return!0;ut++}return o.attributesNum!==ut||o.index!==Ae}function k(Q,Ee,Fe,Ae){const Ve={},lt=Ee.attributes;let ut=0;const pt=Fe.getAttributes();for(const ke in pt)if(pt[ke].location>=0){let tt=lt[ke];tt===void 0&&(ke==="instanceMatrix"&&Q.instanceMatrix&&(tt=Q.instanceMatrix),ke==="instanceColor"&&Q.instanceColor&&(tt=Q.instanceColor));const _t={};_t.attribute=tt,tt&&tt.data&&(_t.data=tt.data),Ve[ke]=_t,ut++}o.attributes=Ve,o.attributesNum=ut,o.index=Ae}function z(){const Q=o.newAttributes;for(let Ee=0,Fe=Q.length;Ee<Fe;Ee++)Q[Ee]=0}function D(Q){C(Q,0)}function C(Q,Ee){const Fe=o.newAttributes,Ae=o.enabledAttributes,Ve=o.attributeDivisors;Fe[Q]=1,Ae[Q]===0&&(n.enableVertexAttribArray(Q),Ae[Q]=1),Ve[Q]!==Ee&&(n.vertexAttribDivisor(Q,Ee),Ve[Q]=Ee)}function U(){const Q=o.newAttributes,Ee=o.enabledAttributes;for(let Fe=0,Ae=Ee.length;Fe<Ae;Fe++)Ee[Fe]!==Q[Fe]&&(n.disableVertexAttribArray(Fe),Ee[Fe]=0)}function B(Q,Ee,Fe,Ae,Ve,lt,ut){ut===!0?n.vertexAttribIPointer(Q,Ee,Fe,Ve,lt):n.vertexAttribPointer(Q,Ee,Fe,Ae,Ve,lt)}function K(Q,Ee,Fe,Ae){z();const Ve=Ae.attributes,lt=Fe.getAttributes(),ut=Ee.defaultAttributeValues;for(const pt in lt){const ke=lt[pt];if(ke.location>=0){let Je=Ve[pt];if(Je===void 0&&(pt==="instanceMatrix"&&Q.instanceMatrix&&(Je=Q.instanceMatrix),pt==="instanceColor"&&Q.instanceColor&&(Je=Q.instanceColor)),Je!==void 0){const tt=Je.normalized,_t=Je.itemSize,Lt=e.get(Je);if(Lt===void 0)continue;const Cn=Lt.buffer,nt=Lt.type,wt=Lt.bytesPerElement,Ft=nt===n.INT||nt===n.UNSIGNED_INT||Je.gpuType===T7;if(Je.isInterleavedBufferAttribute){const At=Je.data,gn=At.stride,En=Je.offset;if(At.isInstancedInterleavedBuffer){for(let In=0;In<ke.locationSize;In++)C(ke.location+In,At.meshPerAttribute);Q.isInstancedMesh!==!0&&Ae._maxInstanceCount===void 0&&(Ae._maxInstanceCount=At.meshPerAttribute*At.count)}else for(let In=0;In<ke.locationSize;In++)D(ke.location+In);n.bindBuffer(n.ARRAY_BUFFER,Cn);for(let In=0;In<ke.locationSize;In++)B(ke.location+In,_t/ke.locationSize,nt,tt,gn*wt,(En+_t/ke.locationSize*In)*wt,Ft)}else{if(Je.isInstancedBufferAttribute){for(let At=0;At<ke.locationSize;At++)C(ke.location+At,Je.meshPerAttribute);Q.isInstancedMesh!==!0&&Ae._maxInstanceCount===void 0&&(Ae._maxInstanceCount=Je.meshPerAttribute*Je.count)}else for(let At=0;At<ke.locationSize;At++)D(ke.location+At);n.bindBuffer(n.ARRAY_BUFFER,Cn);for(let At=0;At<ke.locationSize;At++)B(ke.location+At,_t/ke.locationSize,nt,tt,_t*wt,_t/ke.locationSize*At*wt,Ft)}}else if(ut!==void 0){const tt=ut[pt];if(tt!==void 0)switch(tt.length){case 2:n.vertexAttrib2fv(ke.location,tt);break;case 3:n.vertexAttrib3fv(ke.location,tt);break;case 4:n.vertexAttrib4fv(ke.location,tt);break;default:n.vertexAttrib1fv(ke.location,tt)}}}}U()}function ue(){be();for(const Q in r){const Ee=r[Q];for(const Fe in Ee){const Ae=Ee[Fe];for(const Ve in Ae)x(Ae[Ve].object),delete Ae[Ve];delete Ee[Fe]}delete r[Q]}}function Z(Q){if(r[Q.id]===void 0)return;const Ee=r[Q.id];for(const Fe in Ee){const Ae=Ee[Fe];for(const Ve in Ae)x(Ae[Ve].object),delete Ae[Ve];delete Ee[Fe]}delete r[Q.id]}function ee(Q){for(const Ee in r){const Fe=r[Ee];if(Fe[Q.id]===void 0)continue;const Ae=Fe[Q.id];for(const Ve in Ae)x(Ae[Ve].object),delete Ae[Ve];delete Fe[Q.id]}}function be(){ie(),u=!0,o!==i&&(o=i,v(o.object))}function ie(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:l,reset:be,resetDefaultState:ie,dispose:ue,releaseStatesOfGeometry:Z,releaseStatesOfProgram:ee,initAttributes:z,enableAttribute:D,disableUnusedAttributes:U}}function EH(n,e,t){let r;function i(p){r=p}function o(p,v){n.drawArrays(r,p,v),t.update(v,r,1)}function u(p,v,x){x!==0&&(n.drawArraysInstanced(r,p,v,x),t.update(v,r,x))}function l(p,v,x){if(x===0)return;const M=e.get("WEBGL_multi_draw");if(M===null)for(let w=0;w<x;w++)this.render(p[w],v[w]);else{M.multiDrawArraysWEBGL(r,p,0,v,0,x);let w=0;for(let A=0;A<x;A++)w+=v[A];t.update(w,r,1)}}this.setMode=i,this.render=o,this.renderInstances=u,this.renderMultiDraw=l}function AH(n,e,t){let r;function i(){if(r!==void 0)return r;if(e.has("EXT_texture_filter_anisotropic")===!0){const B=e.get("EXT_texture_filter_anisotropic");r=n.getParameter(B.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r}function o(B){if(B==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";B="mediump"}return B==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let u=t.precision!==void 0?t.precision:"highp";const l=o(u);l!==u&&(console.warn("THREE.WebGLRenderer:",u,"not supported, using",l,"instead."),u=l);const p=t.logarithmicDepthBuffer===!0,v=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),x=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),M=n.getParameter(n.MAX_TEXTURE_SIZE),w=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),A=n.getParameter(n.MAX_VERTEX_ATTRIBS),k=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),z=n.getParameter(n.MAX_VARYING_VECTORS),D=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),C=x>0,U=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:i,getMaxPrecision:o,precision:u,logarithmicDepthBuffer:p,maxTextures:v,maxVertexTextures:x,maxTextureSize:M,maxCubemapSize:w,maxAttributes:A,maxVertexUniforms:k,maxVaryings:z,maxFragmentUniforms:D,vertexTextures:C,maxSamples:U}}function CH(n){const e=this;let t=null,r=0,i=!1,o=!1;const u=new Mc,l=new Jn,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(M,w){const A=M.length!==0||w||r!==0||i;return i=w,r=M.length,A},this.beginShadows=function(){o=!0,x(null)},this.endShadows=function(){o=!1},this.setGlobalState=function(M,w){t=x(M,w,0)},this.setState=function(M,w,A){const k=M.clippingPlanes,z=M.clipIntersection,D=M.clipShadows,C=n.get(M);if(!i||k===null||k.length===0||o&&!D)o?x(null):v();else{const U=o?0:r,B=U*4;let K=C.clippingState||null;p.value=K,K=x(k,w,B,A);for(let ue=0;ue!==B;++ue)K[ue]=t[ue];C.clippingState=K,this.numIntersection=z?this.numPlanes:0,this.numPlanes+=U}};function v(){p.value!==t&&(p.value=t,p.needsUpdate=r>0),e.numPlanes=r,e.numIntersection=0}function x(M,w,A,k){const z=M!==null?M.length:0;let D=null;if(z!==0){if(D=p.value,k!==!0||D===null){const C=A+z*4,U=w.matrixWorldInverse;l.getNormalMatrix(U),(D===null||D.length<C)&&(D=new Float32Array(C));for(let B=0,K=A;B!==z;++B,K+=4)u.copy(M[B]).applyMatrix4(U,l),u.normal.toArray(D,K),D[K+3]=u.constant}p.value=D,p.needsUpdate=!0}return e.numPlanes=z,e.numIntersection=0,D}}function PH(n){let e=new WeakMap;function t(u,l){return l===Tb?u.mapping=uf:l===Eb&&(u.mapping=hf),u}function r(u){if(u&&u.isTexture){const l=u.mapping;if(l===Tb||l===Eb)if(e.has(u)){const p=e.get(u).texture;return t(p,u.mapping)}else{const p=u.image;if(p&&p.height>0){const v=new BB(p.height);return v.fromEquirectangularTexture(n,u),e.set(u,v),u.addEventListener("dispose",i),t(v.texture,u.mapping)}else return null}}return u}function i(u){const l=u.target;l.removeEventListener("dispose",i);const p=e.get(l);p!==void 0&&(e.delete(l),p.dispose())}function o(){e=new WeakMap}return{get:r,dispose:o}}class RH extends G7{constructor(e=-1,t=1,r=1,i=-1,o=.1,u=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=r,this.bottom=i,this.near=o,this.far=u,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,r,i,o,u){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=o,this.view.height=u,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let o=r-e,u=r+e,l=i+t,p=i-t;if(this.view!==null&&this.view.enabled){const v=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;o+=v*this.view.offsetX,u=o+v*this.view.width,l-=x*this.view.offsetY,p=l-x*this.view.height}this.projectionMatrix.makeOrthographic(o,u,l,p,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ud=4,gT=[.125,.215,.35,.446,.526,.582],Ou=20,Xx=new RH,yT=new Tr;let Zx=null,Yx=0,Kx=0,Jx=!1;const zu=(1+Math.sqrt(5))/2,_d=1/zu,vT=[new rt(1,1,1),new rt(-1,1,1),new rt(1,1,-1),new rt(-1,1,-1),new rt(0,zu,_d),new rt(0,zu,-_d),new rt(_d,0,zu),new rt(-_d,0,zu),new rt(zu,_d,0),new rt(-zu,_d,0)];class _T{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,r=.1,i=100){Zx=this._renderer.getRenderTarget(),Yx=this._renderer.getActiveCubeFace(),Kx=this._renderer.getActiveMipmapLevel(),Jx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const o=this._allocateTargets();return o.depthBuffer=!0,this._sceneToCubeUV(e,r,i,o),t>0&&this._blur(o,0,0,t),this._applyPMREM(o),this._cleanup(o),o}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=wT(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=bT(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(Zx,Yx,Kx),this._renderer.xr.enabled=Jx,e.scissorTest=!1,y1(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===uf||e.mapping===hf?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),Zx=this._renderer.getRenderTarget(),Yx=this._renderer.getActiveCubeFace(),Kx=this._renderer.getActiveMipmapLevel(),Jx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const r=t||this._allocateTargets();return this._textureToCubeUV(e,r),this._applyPMREM(r),this._cleanup(r),r}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,r={magFilter:io,minFilter:io,generateMipmaps:!1,type:Cy,format:Ro,colorSpace:eu,depthBuffer:!1},i=xT(e,t,r);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=xT(e,t,r);const{_lodMax:o}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=IH(o)),this._blurMaterial=DH(o,e,t)}return i}_compileMaterial(e){const t=new cs(this._lodPlanes[0],e);this._renderer.compile(t,Xx)}_sceneToCubeUV(e,t,r,i){const l=new Cs(90,1,t,r),p=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],x=this._renderer,M=x.autoClear,w=x.toneMapping;x.getClearColor(yT),x.toneMapping=Vc,x.autoClear=!1;const A=new B7({name:"PMREM.Background",side:$a,depthWrite:!1,depthTest:!1}),k=new cs(new vm,A);let z=!1;const D=e.background;D?D.isColor&&(A.color.copy(D),e.background=null,z=!0):(A.color.copy(yT),z=!0);for(let C=0;C<6;C++){const U=C%3;U===0?(l.up.set(0,p[C],0),l.lookAt(v[C],0,0)):U===1?(l.up.set(0,0,p[C]),l.lookAt(0,v[C],0)):(l.up.set(0,p[C],0),l.lookAt(0,0,v[C]));const B=this._cubeSize;y1(i,U*B,C>2?B:0,B,B),x.setRenderTarget(i),z&&x.render(k,l),x.render(e,l)}k.geometry.dispose(),k.material.dispose(),x.toneMapping=w,x.autoClear=M,e.background=D}_textureToCubeUV(e,t){const r=this._renderer,i=e.mapping===uf||e.mapping===hf;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=wT()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=bT());const o=i?this._cubemapMaterial:this._equirectMaterial,u=new cs(this._lodPlanes[0],o),l=o.uniforms;l.envMap.value=e;const p=this._cubeSize;y1(t,0,0,3*p,2*p),r.setRenderTarget(t),r.render(u,Xx)}_applyPMREM(e){const t=this._renderer,r=t.autoClear;t.autoClear=!1;for(let i=1;i<this._lodPlanes.length;i++){const o=Math.sqrt(this._sigmas[i]*this._sigmas[i]-this._sigmas[i-1]*this._sigmas[i-1]),u=vT[(i-1)%vT.length];this._blur(e,i-1,i,o,u)}t.autoClear=r}_blur(e,t,r,i,o){const u=this._pingPongRenderTarget;this._halfBlur(e,u,t,r,i,"latitudinal",o),this._halfBlur(u,e,r,r,i,"longitudinal",o)}_halfBlur(e,t,r,i,o,u,l){const p=this._renderer,v=this._blurMaterial;u!=="latitudinal"&&u!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=3,M=new cs(this._lodPlanes[i],v),w=v.uniforms,A=this._sizeLods[r]-1,k=isFinite(o)?Math.PI/(2*A):2*Math.PI/(2*Ou-1),z=o/k,D=isFinite(o)?1+Math.floor(x*z):Ou;D>Ou&&console.warn(`sigmaRadians, ${o}, is too large and will clip, as it requested ${D} samples when the maximum is set to ${Ou}`);const C=[];let U=0;for(let ee=0;ee<Ou;++ee){const be=ee/z,ie=Math.exp(-be*be/2);C.push(ie),ee===0?U+=ie:ee<D&&(U+=2*ie)}for(let ee=0;ee<C.length;ee++)C[ee]=C[ee]/U;w.envMap.value=e.texture,w.samples.value=D,w.weights.value=C,w.latitudinal.value=u==="latitudinal",l&&(w.poleAxis.value=l);const{_lodMax:B}=this;w.dTheta.value=k,w.mipInt.value=B-r;const K=this._sizeLods[i],ue=3*K*(i>B-Ud?i-B+Ud:0),Z=4*(this._cubeSize-K);y1(t,ue,Z,3*K,2*K),p.setRenderTarget(t),p.render(M,Xx)}}function IH(n){const e=[],t=[],r=[];let i=n;const o=n-Ud+1+gT.length;for(let u=0;u<o;u++){const l=Math.pow(2,i);t.push(l);let p=1/l;u>n-Ud?p=gT[u-n+Ud-1]:u===0&&(p=0),r.push(p);const v=1/(l-2),x=-v,M=1+v,w=[x,x,M,x,M,M,x,x,M,M,x,M],A=6,k=6,z=3,D=2,C=1,U=new Float32Array(z*k*A),B=new Float32Array(D*k*A),K=new Float32Array(C*k*A);for(let Z=0;Z<A;Z++){const ee=Z%3*2/3-1,be=Z>2?0:-1,ie=[ee,be,0,ee+2/3,be,0,ee+2/3,be+1,0,ee,be,0,ee+2/3,be+1,0,ee,be+1,0];U.set(ie,z*k*Z),B.set(w,D*k*Z);const Q=[Z,Z,Z,Z,Z,Z];K.set(Q,C*k*Z)}const ue=new tu;ue.setAttribute("position",new Lo(U,z)),ue.setAttribute("uv",new Lo(B,D)),ue.setAttribute("faceIndex",new Lo(K,C)),e.push(ue),i>Ud&&i--}return{lodPlanes:e,sizeLods:t,sigmas:r}}function xT(n,e,t){const r=new rh(n,e,t);return r.texture.mapping=wv,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function y1(n,e,t,r,i){n.viewport.set(e,t,r,i),n.scissor.set(e,t,r,i)}function DH(n,e,t){const r=new Float32Array(Ou),i=new rt(0,1,0);return new Ds({name:"SphericalGaussianBlur",defines:{n:Ou,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:h4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Uc,depthTest:!1,depthWrite:!1})}function bT(){return new Ds({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:h4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Uc,depthTest:!1,depthWrite:!1})}function wT(){return new Ds({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:h4(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Uc,depthTest:!1,depthWrite:!1})}function h4(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function kH(n){let e=new WeakMap,t=null;function r(l){if(l&&l.isTexture){const p=l.mapping,v=p===Tb||p===Eb,x=p===uf||p===hf;if(v||x){let M=e.get(l);const w=M!==void 0?M.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==w)return t===null&&(t=new _T(n)),M=v?t.fromEquirectangular(l,M):t.fromCubemap(l,M),M.texture.pmremVersion=l.pmremVersion,e.set(l,M),M.texture;if(M!==void 0)return M.texture;{const A=l.image;return v&&A&&A.height>0||x&&A&&i(A)?(t===null&&(t=new _T(n)),M=v?t.fromEquirectangular(l):t.fromCubemap(l),M.texture.pmremVersion=l.pmremVersion,e.set(l,M),l.addEventListener("dispose",o),M.texture):null}}}return l}function i(l){let p=0;const v=6;for(let x=0;x<v;x++)l[x]!==void 0&&p++;return p===v}function o(l){const p=l.target;p.removeEventListener("dispose",o);const v=e.get(p);v!==void 0&&(e.delete(p),v.dispose())}function u(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:r,dispose:u}}function LH(n){const e={};function t(r){if(e[r]!==void 0)return e[r];let i;switch(r){case"WEBGL_depth_texture":i=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=n.getExtension(r)}return e[r]=i,i}return{has:function(r){return t(r)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(r){const i=t(r);return i===null&&console.warn("THREE.WebGLRenderer: "+r+" extension not supported."),i}}}function zH(n,e,t,r){const i={},o=new WeakMap;function u(M){const w=M.target;w.index!==null&&e.remove(w.index);for(const k in w.attributes)e.remove(w.attributes[k]);for(const k in w.morphAttributes){const z=w.morphAttributes[k];for(let D=0,C=z.length;D<C;D++)e.remove(z[D])}w.removeEventListener("dispose",u),delete i[w.id];const A=o.get(w);A&&(e.remove(A),o.delete(w)),r.releaseStatesOfGeometry(w),w.isInstancedBufferGeometry===!0&&delete w._maxInstanceCount,t.memory.geometries--}function l(M,w){return i[w.id]===!0||(w.addEventListener("dispose",u),i[w.id]=!0,t.memory.geometries++),w}function p(M){const w=M.attributes;for(const k in w)e.update(w[k],n.ARRAY_BUFFER);const A=M.morphAttributes;for(const k in A){const z=A[k];for(let D=0,C=z.length;D<C;D++)e.update(z[D],n.ARRAY_BUFFER)}}function v(M){const w=[],A=M.index,k=M.attributes.position;let z=0;if(A!==null){const U=A.array;z=A.version;for(let B=0,K=U.length;B<K;B+=3){const ue=U[B+0],Z=U[B+1],ee=U[B+2];w.push(ue,Z,Z,ee,ee,ue)}}else if(k!==void 0){const U=k.array;z=k.version;for(let B=0,K=U.length/3-1;B<K;B+=3){const ue=B+0,Z=B+1,ee=B+2;w.push(ue,Z,Z,ee,ee,ue)}}else return;const D=new(k7(w)?V7:U7)(w,1);D.version=z;const C=o.get(M);C&&e.remove(C),o.set(M,D)}function x(M){const w=o.get(M);if(w){const A=M.index;A!==null&&w.version<A.version&&v(M)}else v(M);return o.get(M)}return{get:l,update:p,getWireframeAttribute:x}}function FH(n,e,t){let r;function i(M){r=M}let o,u;function l(M){o=M.type,u=M.bytesPerElement}function p(M,w){n.drawElements(r,w,o,M*u),t.update(w,r,1)}function v(M,w,A){A!==0&&(n.drawElementsInstanced(r,w,o,M*u,A),t.update(w,r,A))}function x(M,w,A){if(A===0)return;const k=e.get("WEBGL_multi_draw");if(k===null)for(let z=0;z<A;z++)this.render(M[z]/u,w[z]);else{k.multiDrawElementsWEBGL(r,w,0,o,M,0,A);let z=0;for(let D=0;D<A;D++)z+=w[D];t.update(z,r,1)}}this.setMode=i,this.setIndex=l,this.render=p,this.renderInstances=v,this.renderMultiDraw=x}function NH(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function r(o,u,l){switch(t.calls++,u){case n.TRIANGLES:t.triangles+=l*(o/3);break;case n.LINES:t.lines+=l*(o/2);break;case n.LINE_STRIP:t.lines+=l*(o-1);break;case n.LINE_LOOP:t.lines+=l*o;break;case n.POINTS:t.points+=l*o;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",u);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:r}}function OH(n,e,t){const r=new WeakMap,i=new Wi;function o(u,l,p){const v=u.morphTargetInfluences,x=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,M=x!==void 0?x.length:0;let w=r.get(l);if(w===void 0||w.count!==M){let ie=function(){ee.dispose(),r.delete(l),l.removeEventListener("dispose",ie)};w!==void 0&&w.texture.dispose();const A=l.morphAttributes.position!==void 0,k=l.morphAttributes.normal!==void 0,z=l.morphAttributes.color!==void 0,D=l.morphAttributes.position||[],C=l.morphAttributes.normal||[],U=l.morphAttributes.color||[];let B=0;A===!0&&(B=1),k===!0&&(B=2),z===!0&&(B=3);let K=l.attributes.position.count*B,ue=1;K>e.maxTextureSize&&(ue=Math.ceil(K/e.maxTextureSize),K=e.maxTextureSize);const Z=new Float32Array(K*ue*4*M),ee=new z7(Z,K,ue,M);ee.type=Rc,ee.needsUpdate=!0;const be=B*4;for(let Q=0;Q<M;Q++){const Ee=D[Q],Fe=C[Q],Ae=U[Q],Ve=K*ue*4*Q;for(let lt=0;lt<Ee.count;lt++){const ut=lt*be;A===!0&&(i.fromBufferAttribute(Ee,lt),Z[Ve+ut+0]=i.x,Z[Ve+ut+1]=i.y,Z[Ve+ut+2]=i.z,Z[Ve+ut+3]=0),k===!0&&(i.fromBufferAttribute(Fe,lt),Z[Ve+ut+4]=i.x,Z[Ve+ut+5]=i.y,Z[Ve+ut+6]=i.z,Z[Ve+ut+7]=0),z===!0&&(i.fromBufferAttribute(Ae,lt),Z[Ve+ut+8]=i.x,Z[Ve+ut+9]=i.y,Z[Ve+ut+10]=i.z,Z[Ve+ut+11]=Ae.itemSize===4?i.w:1)}}w={count:M,texture:ee,size:new qn(K,ue)},r.set(l,w),l.addEventListener("dispose",ie)}if(u.isInstancedMesh===!0&&u.morphTexture!==null)p.getUniforms().setValue(n,"morphTexture",u.morphTexture,t);else{let A=0;for(let z=0;z<v.length;z++)A+=v[z];const k=l.morphTargetsRelative?1:1-A;p.getUniforms().setValue(n,"morphTargetBaseInfluence",k),p.getUniforms().setValue(n,"morphTargetInfluences",v)}p.getUniforms().setValue(n,"morphTargetsTexture",w.texture,t),p.getUniforms().setValue(n,"morphTargetsTextureSize",w.size)}return{update:o}}function BH(n,e,t,r){let i=new WeakMap;function o(p){const v=r.render.frame,x=p.geometry,M=e.get(p,x);if(i.get(M)!==v&&(e.update(M),i.set(M,v)),p.isInstancedMesh&&(p.hasEventListener("dispose",l)===!1&&p.addEventListener("dispose",l),i.get(p)!==v&&(t.update(p.instanceMatrix,n.ARRAY_BUFFER),p.instanceColor!==null&&t.update(p.instanceColor,n.ARRAY_BUFFER),i.set(p,v))),p.isSkinnedMesh){const w=p.skeleton;i.get(w)!==v&&(w.update(),i.set(w,v))}return M}function u(){i=new WeakMap}function l(p){const v=p.target;v.removeEventListener("dispose",l),t.remove(v.instanceMatrix),v.instanceColor!==null&&t.remove(v.instanceColor)}return{update:o,dispose:u}}class q7 extends Ca{constructor(e,t,r,i,o,u,l,p,v,x){if(x=x!==void 0?x:Yd,x!==Yd&&x!==Zp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&x===Yd&&(r=df),r===void 0&&x===Zp&&(r=gm),super(null,i,o,u,l,p,x,r,v),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=l!==void 0?l:Is,this.minFilter=p!==void 0?p:Is,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const X7=new Ca,Z7=new q7(1,1);Z7.compareFunction=D7;const Y7=new z7,K7=new SB,J7=new j7,ST=[],MT=[],TT=new Float32Array(16),ET=new Float32Array(9),AT=new Float32Array(4);function Mf(n,e,t){const r=n[0];if(r<=0||r>0)return n;const i=e*t;let o=ST[i];if(o===void 0&&(o=new Float32Array(i),ST[i]=o),e!==0){r.toArray(o,0);for(let u=1,l=0;u!==e;++u)l+=t,n[u].toArray(o,l)}return o}function Ei(n,e){if(n.length!==e.length)return!1;for(let t=0,r=n.length;t<r;t++)if(n[t]!==e[t])return!1;return!0}function Ai(n,e){for(let t=0,r=e.length;t<r;t++)n[t]=e[t]}function Tv(n,e){let t=MT[e];t===void 0&&(t=new Int32Array(e),MT[e]=t);for(let r=0;r!==e;++r)t[r]=n.allocateTextureUnit();return t}function UH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function VH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;n.uniform2fv(this.addr,e),Ai(t,e)}}function HH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Ei(t,e))return;n.uniform3fv(this.addr,e),Ai(t,e)}}function GH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;n.uniform4fv(this.addr,e),Ai(t,e)}}function jH(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ei(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,r))return;AT.set(r),n.uniformMatrix2fv(this.addr,!1,AT),Ai(t,r)}}function WH(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ei(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,r))return;ET.set(r),n.uniformMatrix3fv(this.addr,!1,ET),Ai(t,r)}}function $H(n,e){const t=this.cache,r=e.elements;if(r===void 0){if(Ei(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Ai(t,e)}else{if(Ei(t,r))return;TT.set(r),n.uniformMatrix4fv(this.addr,!1,TT),Ai(t,r)}}function qH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function XH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;n.uniform2iv(this.addr,e),Ai(t,e)}}function ZH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ei(t,e))return;n.uniform3iv(this.addr,e),Ai(t,e)}}function YH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;n.uniform4iv(this.addr,e),Ai(t,e)}}function KH(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function JH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Ei(t,e))return;n.uniform2uiv(this.addr,e),Ai(t,e)}}function QH(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Ei(t,e))return;n.uniform3uiv(this.addr,e),Ai(t,e)}}function eG(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Ei(t,e))return;n.uniform4uiv(this.addr,e),Ai(t,e)}}function tG(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i);const o=this.type===n.SAMPLER_2D_SHADOW?Z7:X7;t.setTexture2D(e||o,i)}function nG(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture3D(e||K7,i)}function rG(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTextureCube(e||J7,i)}function iG(n,e,t){const r=this.cache,i=t.allocateTextureUnit();r[0]!==i&&(n.uniform1i(this.addr,i),r[0]=i),t.setTexture2DArray(e||Y7,i)}function aG(n){switch(n){case 5126:return UH;case 35664:return VH;case 35665:return HH;case 35666:return GH;case 35674:return jH;case 35675:return WH;case 35676:return $H;case 5124:case 35670:return qH;case 35667:case 35671:return XH;case 35668:case 35672:return ZH;case 35669:case 35673:return YH;case 5125:return KH;case 36294:return JH;case 36295:return QH;case 36296:return eG;case 35678:case 36198:case 36298:case 36306:case 35682:return tG;case 35679:case 36299:case 36307:return nG;case 35680:case 36300:case 36308:case 36293:return rG;case 36289:case 36303:case 36311:case 36292:return iG}}function sG(n,e){n.uniform1fv(this.addr,e)}function oG(n,e){const t=Mf(e,this.size,2);n.uniform2fv(this.addr,t)}function lG(n,e){const t=Mf(e,this.size,3);n.uniform3fv(this.addr,t)}function cG(n,e){const t=Mf(e,this.size,4);n.uniform4fv(this.addr,t)}function uG(n,e){const t=Mf(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function hG(n,e){const t=Mf(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function dG(n,e){const t=Mf(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function fG(n,e){n.uniform1iv(this.addr,e)}function pG(n,e){n.uniform2iv(this.addr,e)}function mG(n,e){n.uniform3iv(this.addr,e)}function gG(n,e){n.uniform4iv(this.addr,e)}function yG(n,e){n.uniform1uiv(this.addr,e)}function vG(n,e){n.uniform2uiv(this.addr,e)}function _G(n,e){n.uniform3uiv(this.addr,e)}function xG(n,e){n.uniform4uiv(this.addr,e)}function bG(n,e,t){const r=this.cache,i=e.length,o=Tv(t,i);Ei(r,o)||(n.uniform1iv(this.addr,o),Ai(r,o));for(let u=0;u!==i;++u)t.setTexture2D(e[u]||X7,o[u])}function wG(n,e,t){const r=this.cache,i=e.length,o=Tv(t,i);Ei(r,o)||(n.uniform1iv(this.addr,o),Ai(r,o));for(let u=0;u!==i;++u)t.setTexture3D(e[u]||K7,o[u])}function SG(n,e,t){const r=this.cache,i=e.length,o=Tv(t,i);Ei(r,o)||(n.uniform1iv(this.addr,o),Ai(r,o));for(let u=0;u!==i;++u)t.setTextureCube(e[u]||J7,o[u])}function MG(n,e,t){const r=this.cache,i=e.length,o=Tv(t,i);Ei(r,o)||(n.uniform1iv(this.addr,o),Ai(r,o));for(let u=0;u!==i;++u)t.setTexture2DArray(e[u]||Y7,o[u])}function TG(n){switch(n){case 5126:return sG;case 35664:return oG;case 35665:return lG;case 35666:return cG;case 35674:return uG;case 35675:return hG;case 35676:return dG;case 5124:case 35670:return fG;case 35667:case 35671:return pG;case 35668:case 35672:return mG;case 35669:case 35673:return gG;case 5125:return yG;case 36294:return vG;case 36295:return _G;case 36296:return xG;case 35678:case 36198:case 36298:case 36306:case 35682:return bG;case 35679:case 36299:case 36307:return wG;case 35680:case 36300:case 36308:case 36293:return SG;case 36289:case 36303:case 36311:case 36292:return MG}}class EG{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.setValue=aG(t.type)}}class AG{constructor(e,t,r){this.id=e,this.addr=r,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=TG(t.type)}}class CG{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,r){const i=this.seq;for(let o=0,u=i.length;o!==u;++o){const l=i[o];l.setValue(e,t[l.id],r)}}}const Qx=/(\w+)(\])?(\[|\.)?/g;function CT(n,e){n.seq.push(e),n.map[e.id]=e}function PG(n,e,t){const r=n.name,i=r.length;for(Qx.lastIndex=0;;){const o=Qx.exec(r),u=Qx.lastIndex;let l=o[1];const p=o[2]==="]",v=o[3];if(p&&(l=l|0),v===void 0||v==="["&&u+2===i){CT(t,v===void 0?new EG(l,n,e):new AG(l,n,e));break}else{let M=t.map[l];M===void 0&&(M=new CG(l),CT(t,M)),t=M}}}class X1{constructor(e,t){this.seq=[],this.map={};const r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;++i){const o=e.getActiveUniform(t,i),u=e.getUniformLocation(t,o.name);PG(o,u,this)}}setValue(e,t,r,i){const o=this.map[t];o!==void 0&&o.setValue(e,r,i)}setOptional(e,t,r){const i=t[r];i!==void 0&&this.setValue(e,r,i)}static upload(e,t,r,i){for(let o=0,u=t.length;o!==u;++o){const l=t[o],p=r[l.id];p.needsUpdate!==!1&&l.setValue(e,p.value,i)}}static seqWithValue(e,t){const r=[];for(let i=0,o=e.length;i!==o;++i){const u=e[i];u.id in t&&r.push(u)}return r}}function PT(n,e,t){const r=n.createShader(e);return n.shaderSource(r,t),n.compileShader(r),r}const RG=37297;let IG=0;function DG(n,e){const t=n.split(`
`),r=[],i=Math.max(e-6,0),o=Math.min(e+6,t.length);for(let u=i;u<o;u++){const l=u+1;r.push(`${l===e?">":" "} ${l}: ${t[u]}`)}return r.join(`
`)}function kG(n){const e=Mr.getPrimaries(Mr.workingColorSpace),t=Mr.getPrimaries(n);let r;switch(e===t?r="":e===Iy&&t===Ry?r="LinearDisplayP3ToLinearSRGB":e===Ry&&t===Iy&&(r="LinearSRGBToLinearDisplayP3"),n){case eu:case Sv:return[r,"LinearTransferOETF"];case wo:case l4:return[r,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[r,"LinearTransferOETF"]}}function RT(n,e,t){const r=n.getShaderParameter(e,n.COMPILE_STATUS),i=n.getShaderInfoLog(e).trim();if(r&&i==="")return"";const o=/ERROR: 0:(\d+)/.exec(i);if(o){const u=parseInt(o[1]);return t.toUpperCase()+`

`+i+`

`+DG(n.getShaderSource(e),u)}else return i}function LG(n,e){const t=kG(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function zG(n,e){let t;switch(e){case MO:t="Linear";break;case TO:t="Reinhard";break;case EO:t="OptimizedCineon";break;case AO:t="ACESFilmic";break;case PO:t="AgX";break;case RO:t="Neutral";break;case CO:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function FG(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(op).join(`
`)}function NG(n){const e=[];for(const t in n){const r=n[t];r!==!1&&e.push("#define "+t+" "+r)}return e.join(`
`)}function OG(n,e){const t={},r=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const o=n.getActiveAttrib(e,i),u=o.name;let l=1;o.type===n.FLOAT_MAT2&&(l=2),o.type===n.FLOAT_MAT3&&(l=3),o.type===n.FLOAT_MAT4&&(l=4),t[u]={type:o.type,location:n.getAttribLocation(e,u),locationSize:l}}return t}function op(n){return n!==""}function IT(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function DT(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const BG=/^[ \t]*#include +<([\w\d./]+)>/gm;function Pb(n){return n.replace(BG,VG)}const UG=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function VG(n,e){let t=Kn[e];if(t===void 0){const r=UG.get(e);if(r!==void 0)t=Kn[r],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,r);else throw new Error("Can not resolve #include <"+e+">")}return Pb(t)}const HG=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function kT(n){return n.replace(HG,GG)}function GG(n,e,t,r){let i="";for(let o=parseInt(e);o<parseInt(t);o++)i+=r.replace(/\[\s*i\s*\]/g,"[ "+o+" ]").replace(/UNROLLED_LOOP_INDEX/g,o);return i}function LT(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function jG(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===b7?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===YN?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===pl&&(e="SHADOWMAP_TYPE_VSM"),e}function WG(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case uf:case hf:e="ENVMAP_TYPE_CUBE";break;case wv:e="ENVMAP_TYPE_CUBE_UV";break}return e}function $G(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case hf:e="ENVMAP_MODE_REFRACTION";break}return e}function qG(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case w7:e="ENVMAP_BLENDING_MULTIPLY";break;case wO:e="ENVMAP_BLENDING_MIX";break;case SO:e="ENVMAP_BLENDING_ADD";break}return e}function XG(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,r=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:r,maxMip:t}}function ZG(n,e,t,r){const i=n.getContext(),o=t.defines;let u=t.vertexShader,l=t.fragmentShader;const p=jG(t),v=WG(t),x=$G(t),M=qG(t),w=XG(t),A=FG(t),k=NG(o),z=i.createProgram();let D,C,U=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(D=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,k].filter(op).join(`
`),D.length>0&&(D+=`
`),C=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,k].filter(op).join(`
`),C.length>0&&(C+=`
`)):(D=[LT(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,k,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+x:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(op).join(`
`),C=[LT(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,k,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+v:"",t.envMap?"#define "+x:"",t.envMap?"#define "+M:"",w?"#define CUBEUV_TEXEL_WIDTH "+w.texelWidth:"",w?"#define CUBEUV_TEXEL_HEIGHT "+w.texelHeight:"",w?"#define CUBEUV_MAX_MIP "+w.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Vc?"#define TONE_MAPPING":"",t.toneMapping!==Vc?Kn.tonemapping_pars_fragment:"",t.toneMapping!==Vc?zG("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Kn.colorspace_pars_fragment,LG("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(op).join(`
`)),u=Pb(u),u=IT(u,t),u=DT(u,t),l=Pb(l),l=IT(l,t),l=DT(l,t),u=kT(u),l=kT(l),t.isRawShaderMaterial!==!0&&(U=`#version 300 es
`,D=[A,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+D,C=["#define varying in",t.glslVersion===ZM?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===ZM?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+C);const B=U+D+u,K=U+C+l,ue=PT(i,i.VERTEX_SHADER,B),Z=PT(i,i.FRAGMENT_SHADER,K);i.attachShader(z,ue),i.attachShader(z,Z),t.index0AttributeName!==void 0?i.bindAttribLocation(z,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(z,0,"position"),i.linkProgram(z);function ee(Ee){if(n.debug.checkShaderErrors){const Fe=i.getProgramInfoLog(z).trim(),Ae=i.getShaderInfoLog(ue).trim(),Ve=i.getShaderInfoLog(Z).trim();let lt=!0,ut=!0;if(i.getProgramParameter(z,i.LINK_STATUS)===!1)if(lt=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(i,z,ue,Z);else{const pt=RT(i,ue,"vertex"),ke=RT(i,Z,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(z,i.VALIDATE_STATUS)+`

Material Name: `+Ee.name+`
Material Type: `+Ee.type+`

Program Info Log: `+Fe+`
`+pt+`
`+ke)}else Fe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Fe):(Ae===""||Ve==="")&&(ut=!1);ut&&(Ee.diagnostics={runnable:lt,programLog:Fe,vertexShader:{log:Ae,prefix:D},fragmentShader:{log:Ve,prefix:C}})}i.deleteShader(ue),i.deleteShader(Z),be=new X1(i,z),ie=OG(i,z)}let be;this.getUniforms=function(){return be===void 0&&ee(this),be};let ie;this.getAttributes=function(){return ie===void 0&&ee(this),ie};let Q=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return Q===!1&&(Q=i.getProgramParameter(z,RG)),Q},this.destroy=function(){r.releaseStatesOfProgram(this),i.deleteProgram(z),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=IG++,this.cacheKey=e,this.usedTimes=1,this.program=z,this.vertexShader=ue,this.fragmentShader=Z,this}let YG=0;class KG{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,r=e.fragmentShader,i=this._getShaderStage(t),o=this._getShaderStage(r),u=this._getShaderCacheForMaterial(e);return u.has(i)===!1&&(u.add(i),i.usedTimes++),u.has(o)===!1&&(u.add(o),o.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const r of t)r.usedTimes--,r.usedTimes===0&&this.shaderCache.delete(r.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let r=t.get(e);return r===void 0&&(r=new Set,t.set(e,r)),r}_getShaderStage(e){const t=this.shaderCache;let r=t.get(e);return r===void 0&&(r=new JG(e),t.set(e,r)),r}}class JG{constructor(e){this.id=YG++,this.code=e,this.usedTimes=0}}function QG(n,e,t,r,i,o,u){const l=new N7,p=new KG,v=new Set,x=[],M=i.logarithmicDepthBuffer,w=i.vertexTextures;let A=i.precision;const k={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function z(ie){return v.add(ie),ie===0?"uv":`uv${ie}`}function D(ie,Q,Ee,Fe,Ae){const Ve=Fe.fog,lt=Ae.geometry,ut=ie.isMeshStandardMaterial?Fe.environment:null,pt=(ie.isMeshStandardMaterial?t:e).get(ie.envMap||ut),ke=pt&&pt.mapping===wv?pt.image.height:null,Je=k[ie.type];ie.precision!==null&&(A=i.getMaxPrecision(ie.precision),A!==ie.precision&&console.warn("THREE.WebGLProgram.getParameters:",ie.precision,"not supported, using",A,"instead."));const tt=lt.morphAttributes.position||lt.morphAttributes.normal||lt.morphAttributes.color,_t=tt!==void 0?tt.length:0;let Lt=0;lt.morphAttributes.position!==void 0&&(Lt=1),lt.morphAttributes.normal!==void 0&&(Lt=2),lt.morphAttributes.color!==void 0&&(Lt=3);let Cn,nt,wt,Ft;if(Je){const ne=So[Je];Cn=ne.vertexShader,nt=ne.fragmentShader}else Cn=ie.vertexShader,nt=ie.fragmentShader,p.update(ie),wt=p.getVertexShaderID(ie),Ft=p.getFragmentShaderID(ie);const At=n.getRenderTarget(),gn=Ae.isInstancedMesh===!0,En=Ae.isBatchedMesh===!0,In=!!ie.map,je=!!ie.matcap,An=!!pt,yn=!!ie.aoMap,Qn=!!ie.lightMap,Yt=!!ie.bumpMap,Gn=!!ie.normalMap,re=!!ie.displacementMap,le=!!ie.emissiveMap,st=!!ie.metalnessMap,it=!!ie.roughnessMap,mt=ie.anisotropy>0,St=ie.clearcoat>0,_n=ie.iridescence>0,Mt=ie.sheen>0,hn=ie.transmission>0,xn=mt&&!!ie.anisotropyMap,Nt=St&&!!ie.clearcoatMap,an=St&&!!ie.clearcoatNormalMap,at=St&&!!ie.clearcoatRoughnessMap,tn=_n&&!!ie.iridescenceMap,Kt=_n&&!!ie.iridescenceThicknessMap,Bn=Mt&&!!ie.sheenColorMap,Un=Mt&&!!ie.sheenRoughnessMap,dt=!!ie.specularMap,Ht=!!ie.specularColorMap,jt=!!ie.specularIntensityMap,Jt=hn&&!!ie.transmissionMap,X=hn&&!!ie.thicknessMap,Be=!!ie.gradientMap,ft=!!ie.alphaMap,kt=ie.alphaTest>0,ce=!!ie.alphaHash,O=!!ie.extensions;let V=Vc;ie.toneMapped&&(At===null||At.isXRRenderTarget===!0)&&(V=n.toneMapping);const $={shaderID:Je,shaderType:ie.type,shaderName:ie.name,vertexShader:Cn,fragmentShader:nt,defines:ie.defines,customVertexShaderID:wt,customFragmentShaderID:Ft,isRawShaderMaterial:ie.isRawShaderMaterial===!0,glslVersion:ie.glslVersion,precision:A,batching:En,instancing:gn,instancingColor:gn&&Ae.instanceColor!==null,instancingMorph:gn&&Ae.morphTexture!==null,supportsVertexTextures:w,outputColorSpace:At===null?n.outputColorSpace:At.isXRRenderTarget===!0?At.texture.colorSpace:eu,alphaToCoverage:!!ie.alphaToCoverage,map:In,matcap:je,envMap:An,envMapMode:An&&pt.mapping,envMapCubeUVHeight:ke,aoMap:yn,lightMap:Qn,bumpMap:Yt,normalMap:Gn,displacementMap:w&&re,emissiveMap:le,normalMapObjectSpace:Gn&&ie.normalMapType===WO,normalMapTangentSpace:Gn&&ie.normalMapType===jO,metalnessMap:st,roughnessMap:it,anisotropy:mt,anisotropyMap:xn,clearcoat:St,clearcoatMap:Nt,clearcoatNormalMap:an,clearcoatRoughnessMap:at,iridescence:_n,iridescenceMap:tn,iridescenceThicknessMap:Kt,sheen:Mt,sheenColorMap:Bn,sheenRoughnessMap:Un,specularMap:dt,specularColorMap:Ht,specularIntensityMap:jt,transmission:hn,transmissionMap:Jt,thicknessMap:X,gradientMap:Be,opaque:ie.transparent===!1&&ie.blending===Zd&&ie.alphaToCoverage===!1,alphaMap:ft,alphaTest:kt,alphaHash:ce,combine:ie.combine,mapUv:In&&z(ie.map.channel),aoMapUv:yn&&z(ie.aoMap.channel),lightMapUv:Qn&&z(ie.lightMap.channel),bumpMapUv:Yt&&z(ie.bumpMap.channel),normalMapUv:Gn&&z(ie.normalMap.channel),displacementMapUv:re&&z(ie.displacementMap.channel),emissiveMapUv:le&&z(ie.emissiveMap.channel),metalnessMapUv:st&&z(ie.metalnessMap.channel),roughnessMapUv:it&&z(ie.roughnessMap.channel),anisotropyMapUv:xn&&z(ie.anisotropyMap.channel),clearcoatMapUv:Nt&&z(ie.clearcoatMap.channel),clearcoatNormalMapUv:an&&z(ie.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:at&&z(ie.clearcoatRoughnessMap.channel),iridescenceMapUv:tn&&z(ie.iridescenceMap.channel),iridescenceThicknessMapUv:Kt&&z(ie.iridescenceThicknessMap.channel),sheenColorMapUv:Bn&&z(ie.sheenColorMap.channel),sheenRoughnessMapUv:Un&&z(ie.sheenRoughnessMap.channel),specularMapUv:dt&&z(ie.specularMap.channel),specularColorMapUv:Ht&&z(ie.specularColorMap.channel),specularIntensityMapUv:jt&&z(ie.specularIntensityMap.channel),transmissionMapUv:Jt&&z(ie.transmissionMap.channel),thicknessMapUv:X&&z(ie.thicknessMap.channel),alphaMapUv:ft&&z(ie.alphaMap.channel),vertexTangents:!!lt.attributes.tangent&&(Gn||mt),vertexColors:ie.vertexColors,vertexAlphas:ie.vertexColors===!0&&!!lt.attributes.color&&lt.attributes.color.itemSize===4,pointsUvs:Ae.isPoints===!0&&!!lt.attributes.uv&&(In||ft),fog:!!Ve,useFog:ie.fog===!0,fogExp2:!!Ve&&Ve.isFogExp2,flatShading:ie.flatShading===!0,sizeAttenuation:ie.sizeAttenuation===!0,logarithmicDepthBuffer:M,skinning:Ae.isSkinnedMesh===!0,morphTargets:lt.morphAttributes.position!==void 0,morphNormals:lt.morphAttributes.normal!==void 0,morphColors:lt.morphAttributes.color!==void 0,morphTargetsCount:_t,morphTextureStride:Lt,numDirLights:Q.directional.length,numPointLights:Q.point.length,numSpotLights:Q.spot.length,numSpotLightMaps:Q.spotLightMap.length,numRectAreaLights:Q.rectArea.length,numHemiLights:Q.hemi.length,numDirLightShadows:Q.directionalShadowMap.length,numPointLightShadows:Q.pointShadowMap.length,numSpotLightShadows:Q.spotShadowMap.length,numSpotLightShadowsWithMaps:Q.numSpotLightShadowsWithMaps,numLightProbes:Q.numLightProbes,numClippingPlanes:u.numPlanes,numClipIntersection:u.numIntersection,dithering:ie.dithering,shadowMapEnabled:n.shadowMap.enabled&&Ee.length>0,shadowMapType:n.shadowMap.type,toneMapping:V,useLegacyLights:n._useLegacyLights,decodeVideoTexture:In&&ie.map.isVideoTexture===!0&&Mr.getTransfer(ie.map.colorSpace)===Or,premultipliedAlpha:ie.premultipliedAlpha,doubleSided:ie.side===Ao,flipSided:ie.side===$a,useDepthPacking:ie.depthPacking>=0,depthPacking:ie.depthPacking||0,index0AttributeName:ie.index0AttributeName,extensionClipCullDistance:O&&ie.extensions.clipCullDistance===!0&&r.has("WEBGL_clip_cull_distance"),extensionMultiDraw:O&&ie.extensions.multiDraw===!0&&r.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:r.has("KHR_parallel_shader_compile"),customProgramCacheKey:ie.customProgramCacheKey()};return $.vertexUv1s=v.has(1),$.vertexUv2s=v.has(2),$.vertexUv3s=v.has(3),v.clear(),$}function C(ie){const Q=[];if(ie.shaderID?Q.push(ie.shaderID):(Q.push(ie.customVertexShaderID),Q.push(ie.customFragmentShaderID)),ie.defines!==void 0)for(const Ee in ie.defines)Q.push(Ee),Q.push(ie.defines[Ee]);return ie.isRawShaderMaterial===!1&&(U(Q,ie),B(Q,ie),Q.push(n.outputColorSpace)),Q.push(ie.customProgramCacheKey),Q.join()}function U(ie,Q){ie.push(Q.precision),ie.push(Q.outputColorSpace),ie.push(Q.envMapMode),ie.push(Q.envMapCubeUVHeight),ie.push(Q.mapUv),ie.push(Q.alphaMapUv),ie.push(Q.lightMapUv),ie.push(Q.aoMapUv),ie.push(Q.bumpMapUv),ie.push(Q.normalMapUv),ie.push(Q.displacementMapUv),ie.push(Q.emissiveMapUv),ie.push(Q.metalnessMapUv),ie.push(Q.roughnessMapUv),ie.push(Q.anisotropyMapUv),ie.push(Q.clearcoatMapUv),ie.push(Q.clearcoatNormalMapUv),ie.push(Q.clearcoatRoughnessMapUv),ie.push(Q.iridescenceMapUv),ie.push(Q.iridescenceThicknessMapUv),ie.push(Q.sheenColorMapUv),ie.push(Q.sheenRoughnessMapUv),ie.push(Q.specularMapUv),ie.push(Q.specularColorMapUv),ie.push(Q.specularIntensityMapUv),ie.push(Q.transmissionMapUv),ie.push(Q.thicknessMapUv),ie.push(Q.combine),ie.push(Q.fogExp2),ie.push(Q.sizeAttenuation),ie.push(Q.morphTargetsCount),ie.push(Q.morphAttributeCount),ie.push(Q.numDirLights),ie.push(Q.numPointLights),ie.push(Q.numSpotLights),ie.push(Q.numSpotLightMaps),ie.push(Q.numHemiLights),ie.push(Q.numRectAreaLights),ie.push(Q.numDirLightShadows),ie.push(Q.numPointLightShadows),ie.push(Q.numSpotLightShadows),ie.push(Q.numSpotLightShadowsWithMaps),ie.push(Q.numLightProbes),ie.push(Q.shadowMapType),ie.push(Q.toneMapping),ie.push(Q.numClippingPlanes),ie.push(Q.numClipIntersection),ie.push(Q.depthPacking)}function B(ie,Q){l.disableAll(),Q.supportsVertexTextures&&l.enable(0),Q.instancing&&l.enable(1),Q.instancingColor&&l.enable(2),Q.instancingMorph&&l.enable(3),Q.matcap&&l.enable(4),Q.envMap&&l.enable(5),Q.normalMapObjectSpace&&l.enable(6),Q.normalMapTangentSpace&&l.enable(7),Q.clearcoat&&l.enable(8),Q.iridescence&&l.enable(9),Q.alphaTest&&l.enable(10),Q.vertexColors&&l.enable(11),Q.vertexAlphas&&l.enable(12),Q.vertexUv1s&&l.enable(13),Q.vertexUv2s&&l.enable(14),Q.vertexUv3s&&l.enable(15),Q.vertexTangents&&l.enable(16),Q.anisotropy&&l.enable(17),Q.alphaHash&&l.enable(18),Q.batching&&l.enable(19),ie.push(l.mask),l.disableAll(),Q.fog&&l.enable(0),Q.useFog&&l.enable(1),Q.flatShading&&l.enable(2),Q.logarithmicDepthBuffer&&l.enable(3),Q.skinning&&l.enable(4),Q.morphTargets&&l.enable(5),Q.morphNormals&&l.enable(6),Q.morphColors&&l.enable(7),Q.premultipliedAlpha&&l.enable(8),Q.shadowMapEnabled&&l.enable(9),Q.useLegacyLights&&l.enable(10),Q.doubleSided&&l.enable(11),Q.flipSided&&l.enable(12),Q.useDepthPacking&&l.enable(13),Q.dithering&&l.enable(14),Q.transmission&&l.enable(15),Q.sheen&&l.enable(16),Q.opaque&&l.enable(17),Q.pointsUvs&&l.enable(18),Q.decodeVideoTexture&&l.enable(19),Q.alphaToCoverage&&l.enable(20),ie.push(l.mask)}function K(ie){const Q=k[ie.type];let Ee;if(Q){const Fe=So[Q];Ee=zB.clone(Fe.uniforms)}else Ee=ie.uniforms;return Ee}function ue(ie,Q){let Ee;for(let Fe=0,Ae=x.length;Fe<Ae;Fe++){const Ve=x[Fe];if(Ve.cacheKey===Q){Ee=Ve,++Ee.usedTimes;break}}return Ee===void 0&&(Ee=new ZG(n,Q,ie,o),x.push(Ee)),Ee}function Z(ie){if(--ie.usedTimes===0){const Q=x.indexOf(ie);x[Q]=x[x.length-1],x.pop(),ie.destroy()}}function ee(ie){p.remove(ie)}function be(){p.dispose()}return{getParameters:D,getProgramCacheKey:C,getUniforms:K,acquireProgram:ue,releaseProgram:Z,releaseShaderCache:ee,programs:x,dispose:be}}function ej(){let n=new WeakMap;function e(o){let u=n.get(o);return u===void 0&&(u={},n.set(o,u)),u}function t(o){n.delete(o)}function r(o,u,l){n.get(o)[u]=l}function i(){n=new WeakMap}return{get:e,remove:t,update:r,dispose:i}}function tj(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function zT(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function FT(){const n=[];let e=0;const t=[],r=[],i=[];function o(){e=0,t.length=0,r.length=0,i.length=0}function u(M,w,A,k,z,D){let C=n[e];return C===void 0?(C={id:M.id,object:M,geometry:w,material:A,groupOrder:k,renderOrder:M.renderOrder,z,group:D},n[e]=C):(C.id=M.id,C.object=M,C.geometry=w,C.material=A,C.groupOrder=k,C.renderOrder=M.renderOrder,C.z=z,C.group=D),e++,C}function l(M,w,A,k,z,D){const C=u(M,w,A,k,z,D);A.transmission>0?r.push(C):A.transparent===!0?i.push(C):t.push(C)}function p(M,w,A,k,z,D){const C=u(M,w,A,k,z,D);A.transmission>0?r.unshift(C):A.transparent===!0?i.unshift(C):t.unshift(C)}function v(M,w){t.length>1&&t.sort(M||tj),r.length>1&&r.sort(w||zT),i.length>1&&i.sort(w||zT)}function x(){for(let M=e,w=n.length;M<w;M++){const A=n[M];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:r,transparent:i,init:o,push:l,unshift:p,finish:x,sort:v}}function nj(){let n=new WeakMap;function e(r,i){const o=n.get(r);let u;return o===void 0?(u=new FT,n.set(r,[u])):i>=o.length?(u=new FT,o.push(u)):u=o[i],u}function t(){n=new WeakMap}return{get:e,dispose:t}}function rj(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new rt,color:new Tr};break;case"SpotLight":t={position:new rt,direction:new rt,color:new Tr,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new rt,color:new Tr,distance:0,decay:0};break;case"HemisphereLight":t={direction:new rt,skyColor:new Tr,groundColor:new Tr};break;case"RectAreaLight":t={color:new Tr,position:new rt,halfWidth:new rt,halfHeight:new rt};break}return n[e.id]=t,t}}}function ij(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new qn};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new qn};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new qn,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let aj=0;function sj(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function oj(n){const e=new rj,t=ij(),r={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let v=0;v<9;v++)r.probe.push(new rt);const i=new rt,o=new Ti,u=new Ti;function l(v,x){let M=0,w=0,A=0;for(let Ee=0;Ee<9;Ee++)r.probe[Ee].set(0,0,0);let k=0,z=0,D=0,C=0,U=0,B=0,K=0,ue=0,Z=0,ee=0,be=0;v.sort(sj);const ie=x===!0?Math.PI:1;for(let Ee=0,Fe=v.length;Ee<Fe;Ee++){const Ae=v[Ee],Ve=Ae.color,lt=Ae.intensity,ut=Ae.distance,pt=Ae.shadow&&Ae.shadow.map?Ae.shadow.map.texture:null;if(Ae.isAmbientLight)M+=Ve.r*lt*ie,w+=Ve.g*lt*ie,A+=Ve.b*lt*ie;else if(Ae.isLightProbe){for(let ke=0;ke<9;ke++)r.probe[ke].addScaledVector(Ae.sh.coefficients[ke],lt);be++}else if(Ae.isDirectionalLight){const ke=e.get(Ae);if(ke.color.copy(Ae.color).multiplyScalar(Ae.intensity*ie),Ae.castShadow){const Je=Ae.shadow,tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,r.directionalShadow[k]=tt,r.directionalShadowMap[k]=pt,r.directionalShadowMatrix[k]=Ae.shadow.matrix,B++}r.directional[k]=ke,k++}else if(Ae.isSpotLight){const ke=e.get(Ae);ke.position.setFromMatrixPosition(Ae.matrixWorld),ke.color.copy(Ve).multiplyScalar(lt*ie),ke.distance=ut,ke.coneCos=Math.cos(Ae.angle),ke.penumbraCos=Math.cos(Ae.angle*(1-Ae.penumbra)),ke.decay=Ae.decay,r.spot[D]=ke;const Je=Ae.shadow;if(Ae.map&&(r.spotLightMap[Z]=Ae.map,Z++,Je.updateMatrices(Ae),Ae.castShadow&&ee++),r.spotLightMatrix[D]=Je.matrix,Ae.castShadow){const tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,r.spotShadow[D]=tt,r.spotShadowMap[D]=pt,ue++}D++}else if(Ae.isRectAreaLight){const ke=e.get(Ae);ke.color.copy(Ve).multiplyScalar(lt),ke.halfWidth.set(Ae.width*.5,0,0),ke.halfHeight.set(0,Ae.height*.5,0),r.rectArea[C]=ke,C++}else if(Ae.isPointLight){const ke=e.get(Ae);if(ke.color.copy(Ae.color).multiplyScalar(Ae.intensity*ie),ke.distance=Ae.distance,ke.decay=Ae.decay,Ae.castShadow){const Je=Ae.shadow,tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,tt.shadowCameraNear=Je.camera.near,tt.shadowCameraFar=Je.camera.far,r.pointShadow[z]=tt,r.pointShadowMap[z]=pt,r.pointShadowMatrix[z]=Ae.shadow.matrix,K++}r.point[z]=ke,z++}else if(Ae.isHemisphereLight){const ke=e.get(Ae);ke.skyColor.copy(Ae.color).multiplyScalar(lt*ie),ke.groundColor.copy(Ae.groundColor).multiplyScalar(lt*ie),r.hemi[U]=ke,U++}}C>0&&(n.has("OES_texture_float_linear")===!0?(r.rectAreaLTC1=ln.LTC_FLOAT_1,r.rectAreaLTC2=ln.LTC_FLOAT_2):(r.rectAreaLTC1=ln.LTC_HALF_1,r.rectAreaLTC2=ln.LTC_HALF_2)),r.ambient[0]=M,r.ambient[1]=w,r.ambient[2]=A;const Q=r.hash;(Q.directionalLength!==k||Q.pointLength!==z||Q.spotLength!==D||Q.rectAreaLength!==C||Q.hemiLength!==U||Q.numDirectionalShadows!==B||Q.numPointShadows!==K||Q.numSpotShadows!==ue||Q.numSpotMaps!==Z||Q.numLightProbes!==be)&&(r.directional.length=k,r.spot.length=D,r.rectArea.length=C,r.point.length=z,r.hemi.length=U,r.directionalShadow.length=B,r.directionalShadowMap.length=B,r.pointShadow.length=K,r.pointShadowMap.length=K,r.spotShadow.length=ue,r.spotShadowMap.length=ue,r.directionalShadowMatrix.length=B,r.pointShadowMatrix.length=K,r.spotLightMatrix.length=ue+Z-ee,r.spotLightMap.length=Z,r.numSpotLightShadowsWithMaps=ee,r.numLightProbes=be,Q.directionalLength=k,Q.pointLength=z,Q.spotLength=D,Q.rectAreaLength=C,Q.hemiLength=U,Q.numDirectionalShadows=B,Q.numPointShadows=K,Q.numSpotShadows=ue,Q.numSpotMaps=Z,Q.numLightProbes=be,r.version=aj++)}function p(v,x){let M=0,w=0,A=0,k=0,z=0;const D=x.matrixWorldInverse;for(let C=0,U=v.length;C<U;C++){const B=v[C];if(B.isDirectionalLight){const K=r.directional[M];K.direction.setFromMatrixPosition(B.matrixWorld),i.setFromMatrixPosition(B.target.matrixWorld),K.direction.sub(i),K.direction.transformDirection(D),M++}else if(B.isSpotLight){const K=r.spot[A];K.position.setFromMatrixPosition(B.matrixWorld),K.position.applyMatrix4(D),K.direction.setFromMatrixPosition(B.matrixWorld),i.setFromMatrixPosition(B.target.matrixWorld),K.direction.sub(i),K.direction.transformDirection(D),A++}else if(B.isRectAreaLight){const K=r.rectArea[k];K.position.setFromMatrixPosition(B.matrixWorld),K.position.applyMatrix4(D),u.identity(),o.copy(B.matrixWorld),o.premultiply(D),u.extractRotation(o),K.halfWidth.set(B.width*.5,0,0),K.halfHeight.set(0,B.height*.5,0),K.halfWidth.applyMatrix4(u),K.halfHeight.applyMatrix4(u),k++}else if(B.isPointLight){const K=r.point[w];K.position.setFromMatrixPosition(B.matrixWorld),K.position.applyMatrix4(D),w++}else if(B.isHemisphereLight){const K=r.hemi[z];K.direction.setFromMatrixPosition(B.matrixWorld),K.direction.transformDirection(D),z++}}}return{setup:l,setupView:p,state:r}}function NT(n){const e=new oj(n),t=[],r=[];function i(){t.length=0,r.length=0}function o(x){t.push(x)}function u(x){r.push(x)}function l(x){e.setup(t,x)}function p(x){e.setupView(t,x)}return{init:i,state:{lightsArray:t,shadowsArray:r,lights:e,transmissionRenderTarget:null},setupLights:l,setupLightsView:p,pushLight:o,pushShadow:u}}function lj(n){let e=new WeakMap;function t(i,o=0){const u=e.get(i);let l;return u===void 0?(l=new NT(n),e.set(i,[l])):o>=u.length?(l=new NT(n),u.push(l)):l=u[o],l}function r(){e=new WeakMap}return{get:t,dispose:r}}class cj extends Mv{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=HO,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class uj extends Mv{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const hj=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,dj=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function fj(n,e,t){let r=new W7;const i=new qn,o=new qn,u=new Wi,l=new cj({depthPacking:GO}),p=new uj,v={},x=t.maxTextureSize,M={[Wc]:$a,[$a]:Wc,[Ao]:Ao},w=new Ds({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new qn},radius:{value:4}},vertexShader:hj,fragmentShader:dj}),A=w.clone();A.defines.HORIZONTAL_PASS=1;const k=new tu;k.setAttribute("position",new Lo(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const z=new cs(k,w),D=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=b7;let C=this.type;this.render=function(Z,ee,be){if(D.enabled===!1||D.autoUpdate===!1&&D.needsUpdate===!1||Z.length===0)return;const ie=n.getRenderTarget(),Q=n.getActiveCubeFace(),Ee=n.getActiveMipmapLevel(),Fe=n.state;Fe.setBlending(Uc),Fe.buffers.color.setClear(1,1,1,1),Fe.buffers.depth.setTest(!0),Fe.setScissorTest(!1);const Ae=C!==pl&&this.type===pl,Ve=C===pl&&this.type!==pl;for(let lt=0,ut=Z.length;lt<ut;lt++){const pt=Z[lt],ke=pt.shadow;if(ke===void 0){console.warn("THREE.WebGLShadowMap:",pt,"has no shadow.");continue}if(ke.autoUpdate===!1&&ke.needsUpdate===!1)continue;i.copy(ke.mapSize);const Je=ke.getFrameExtents();if(i.multiply(Je),o.copy(ke.mapSize),(i.x>x||i.y>x)&&(i.x>x&&(o.x=Math.floor(x/Je.x),i.x=o.x*Je.x,ke.mapSize.x=o.x),i.y>x&&(o.y=Math.floor(x/Je.y),i.y=o.y*Je.y,ke.mapSize.y=o.y)),ke.map===null||Ae===!0||Ve===!0){const _t=this.type!==pl?{minFilter:Is,magFilter:Is}:{};ke.map!==null&&ke.map.dispose(),ke.map=new rh(i.x,i.y,_t),ke.map.texture.name=pt.name+".shadowMap",ke.camera.updateProjectionMatrix()}n.setRenderTarget(ke.map),n.clear();const tt=ke.getViewportCount();for(let _t=0;_t<tt;_t++){const Lt=ke.getViewport(_t);u.set(o.x*Lt.x,o.y*Lt.y,o.x*Lt.z,o.y*Lt.w),Fe.viewport(u),ke.updateMatrices(pt,_t),r=ke.getFrustum(),K(ee,be,ke.camera,pt,this.type)}ke.isPointLightShadow!==!0&&this.type===pl&&U(ke,be),ke.needsUpdate=!1}C=this.type,D.needsUpdate=!1,n.setRenderTarget(ie,Q,Ee)};function U(Z,ee){const be=e.update(z);w.defines.VSM_SAMPLES!==Z.blurSamples&&(w.defines.VSM_SAMPLES=Z.blurSamples,A.defines.VSM_SAMPLES=Z.blurSamples,w.needsUpdate=!0,A.needsUpdate=!0),Z.mapPass===null&&(Z.mapPass=new rh(i.x,i.y)),w.uniforms.shadow_pass.value=Z.map.texture,w.uniforms.resolution.value=Z.mapSize,w.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.mapPass),n.clear(),n.renderBufferDirect(ee,null,be,w,z,null),A.uniforms.shadow_pass.value=Z.mapPass.texture,A.uniforms.resolution.value=Z.mapSize,A.uniforms.radius.value=Z.radius,n.setRenderTarget(Z.map),n.clear(),n.renderBufferDirect(ee,null,be,A,z,null)}function B(Z,ee,be,ie){let Q=null;const Ee=be.isPointLight===!0?Z.customDistanceMaterial:Z.customDepthMaterial;if(Ee!==void 0)Q=Ee;else if(Q=be.isPointLight===!0?p:l,n.localClippingEnabled&&ee.clipShadows===!0&&Array.isArray(ee.clippingPlanes)&&ee.clippingPlanes.length!==0||ee.displacementMap&&ee.displacementScale!==0||ee.alphaMap&&ee.alphaTest>0||ee.map&&ee.alphaTest>0){const Fe=Q.uuid,Ae=ee.uuid;let Ve=v[Fe];Ve===void 0&&(Ve={},v[Fe]=Ve);let lt=Ve[Ae];lt===void 0&&(lt=Q.clone(),Ve[Ae]=lt,ee.addEventListener("dispose",ue)),Q=lt}if(Q.visible=ee.visible,Q.wireframe=ee.wireframe,ie===pl?Q.side=ee.shadowSide!==null?ee.shadowSide:ee.side:Q.side=ee.shadowSide!==null?ee.shadowSide:M[ee.side],Q.alphaMap=ee.alphaMap,Q.alphaTest=ee.alphaTest,Q.map=ee.map,Q.clipShadows=ee.clipShadows,Q.clippingPlanes=ee.clippingPlanes,Q.clipIntersection=ee.clipIntersection,Q.displacementMap=ee.displacementMap,Q.displacementScale=ee.displacementScale,Q.displacementBias=ee.displacementBias,Q.wireframeLinewidth=ee.wireframeLinewidth,Q.linewidth=ee.linewidth,be.isPointLight===!0&&Q.isMeshDistanceMaterial===!0){const Fe=n.properties.get(Q);Fe.light=be}return Q}function K(Z,ee,be,ie,Q){if(Z.visible===!1)return;if(Z.layers.test(ee.layers)&&(Z.isMesh||Z.isLine||Z.isPoints)&&(Z.castShadow||Z.receiveShadow&&Q===pl)&&(!Z.frustumCulled||r.intersectsObject(Z))){Z.modelViewMatrix.multiplyMatrices(be.matrixWorldInverse,Z.matrixWorld);const Ae=e.update(Z),Ve=Z.material;if(Array.isArray(Ve)){const lt=Ae.groups;for(let ut=0,pt=lt.length;ut<pt;ut++){const ke=lt[ut],Je=Ve[ke.materialIndex];if(Je&&Je.visible){const tt=B(Z,Je,ie,Q);Z.onBeforeShadow(n,Z,ee,be,Ae,tt,ke),n.renderBufferDirect(be,null,Ae,tt,Z,ke),Z.onAfterShadow(n,Z,ee,be,Ae,tt,ke)}}}else if(Ve.visible){const lt=B(Z,Ve,ie,Q);Z.onBeforeShadow(n,Z,ee,be,Ae,lt,null),n.renderBufferDirect(be,null,Ae,lt,Z,null),Z.onAfterShadow(n,Z,ee,be,Ae,lt,null)}}const Fe=Z.children;for(let Ae=0,Ve=Fe.length;Ae<Ve;Ae++)K(Fe[Ae],ee,be,ie,Q)}function ue(Z){Z.target.removeEventListener("dispose",ue);for(const be in v){const ie=v[be],Q=Z.target.uuid;Q in ie&&(ie[Q].dispose(),delete ie[Q])}}}function pj(n){function e(){let X=!1;const Be=new Wi;let ft=null;const kt=new Wi(0,0,0,0);return{setMask:function(ce){ft!==ce&&!X&&(n.colorMask(ce,ce,ce,ce),ft=ce)},setLocked:function(ce){X=ce},setClear:function(ce,O,V,$,ne){ne===!0&&(ce*=$,O*=$,V*=$),Be.set(ce,O,V,$),kt.equals(Be)===!1&&(n.clearColor(ce,O,V,$),kt.copy(Be))},reset:function(){X=!1,ft=null,kt.set(-1,0,0,0)}}}function t(){let X=!1,Be=null,ft=null,kt=null;return{setTest:function(ce){ce?Ft(n.DEPTH_TEST):At(n.DEPTH_TEST)},setMask:function(ce){Be!==ce&&!X&&(n.depthMask(ce),Be=ce)},setFunc:function(ce){if(ft!==ce){switch(ce){case mO:n.depthFunc(n.NEVER);break;case gO:n.depthFunc(n.ALWAYS);break;case yO:n.depthFunc(n.LESS);break;case Ay:n.depthFunc(n.LEQUAL);break;case vO:n.depthFunc(n.EQUAL);break;case _O:n.depthFunc(n.GEQUAL);break;case xO:n.depthFunc(n.GREATER);break;case bO:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}ft=ce}},setLocked:function(ce){X=ce},setClear:function(ce){kt!==ce&&(n.clearDepth(ce),kt=ce)},reset:function(){X=!1,Be=null,ft=null,kt=null}}}function r(){let X=!1,Be=null,ft=null,kt=null,ce=null,O=null,V=null,$=null,ne=null;return{setTest:function(me){X||(me?Ft(n.STENCIL_TEST):At(n.STENCIL_TEST))},setMask:function(me){Be!==me&&!X&&(n.stencilMask(me),Be=me)},setFunc:function(me,Se,Te){(ft!==me||kt!==Se||ce!==Te)&&(n.stencilFunc(me,Se,Te),ft=me,kt=Se,ce=Te)},setOp:function(me,Se,Te){(O!==me||V!==Se||$!==Te)&&(n.stencilOp(me,Se,Te),O=me,V=Se,$=Te)},setLocked:function(me){X=me},setClear:function(me){ne!==me&&(n.clearStencil(me),ne=me)},reset:function(){X=!1,Be=null,ft=null,kt=null,ce=null,O=null,V=null,$=null,ne=null}}}const i=new e,o=new t,u=new r,l=new WeakMap,p=new WeakMap;let v={},x={},M=new WeakMap,w=[],A=null,k=!1,z=null,D=null,C=null,U=null,B=null,K=null,ue=null,Z=new Tr(0,0,0),ee=0,be=!1,ie=null,Q=null,Ee=null,Fe=null,Ae=null;const Ve=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let lt=!1,ut=0;const pt=n.getParameter(n.VERSION);pt.indexOf("WebGL")!==-1?(ut=parseFloat(/^WebGL (\d)/.exec(pt)[1]),lt=ut>=1):pt.indexOf("OpenGL ES")!==-1&&(ut=parseFloat(/^OpenGL ES (\d)/.exec(pt)[1]),lt=ut>=2);let ke=null,Je={};const tt=n.getParameter(n.SCISSOR_BOX),_t=n.getParameter(n.VIEWPORT),Lt=new Wi().fromArray(tt),Cn=new Wi().fromArray(_t);function nt(X,Be,ft,kt){const ce=new Uint8Array(4),O=n.createTexture();n.bindTexture(X,O),n.texParameteri(X,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(X,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let V=0;V<ft;V++)X===n.TEXTURE_3D||X===n.TEXTURE_2D_ARRAY?n.texImage3D(Be,0,n.RGBA,1,1,kt,0,n.RGBA,n.UNSIGNED_BYTE,ce):n.texImage2D(Be+V,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ce);return O}const wt={};wt[n.TEXTURE_2D]=nt(n.TEXTURE_2D,n.TEXTURE_2D,1),wt[n.TEXTURE_CUBE_MAP]=nt(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),wt[n.TEXTURE_2D_ARRAY]=nt(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),wt[n.TEXTURE_3D]=nt(n.TEXTURE_3D,n.TEXTURE_3D,1,1),i.setClear(0,0,0,1),o.setClear(1),u.setClear(0),Ft(n.DEPTH_TEST),o.setFunc(Ay),Yt(!1),Gn(vM),Ft(n.CULL_FACE),yn(Uc);function Ft(X){v[X]!==!0&&(n.enable(X),v[X]=!0)}function At(X){v[X]!==!1&&(n.disable(X),v[X]=!1)}function gn(X,Be){return x[X]!==Be?(n.bindFramebuffer(X,Be),x[X]=Be,X===n.DRAW_FRAMEBUFFER&&(x[n.FRAMEBUFFER]=Be),X===n.FRAMEBUFFER&&(x[n.DRAW_FRAMEBUFFER]=Be),!0):!1}function En(X,Be){let ft=w,kt=!1;if(X){ft=M.get(Be),ft===void 0&&(ft=[],M.set(Be,ft));const ce=X.textures;if(ft.length!==ce.length||ft[0]!==n.COLOR_ATTACHMENT0){for(let O=0,V=ce.length;O<V;O++)ft[O]=n.COLOR_ATTACHMENT0+O;ft.length=ce.length,kt=!0}}else ft[0]!==n.BACK&&(ft[0]=n.BACK,kt=!0);kt&&n.drawBuffers(ft)}function In(X){return A!==X?(n.useProgram(X),A=X,!0):!1}const je={[Nu]:n.FUNC_ADD,[JN]:n.FUNC_SUBTRACT,[QN]:n.FUNC_REVERSE_SUBTRACT};je[eO]=n.MIN,je[tO]=n.MAX;const An={[nO]:n.ZERO,[rO]:n.ONE,[iO]:n.SRC_COLOR,[Sb]:n.SRC_ALPHA,[uO]:n.SRC_ALPHA_SATURATE,[lO]:n.DST_COLOR,[sO]:n.DST_ALPHA,[aO]:n.ONE_MINUS_SRC_COLOR,[Mb]:n.ONE_MINUS_SRC_ALPHA,[cO]:n.ONE_MINUS_DST_COLOR,[oO]:n.ONE_MINUS_DST_ALPHA,[hO]:n.CONSTANT_COLOR,[dO]:n.ONE_MINUS_CONSTANT_COLOR,[fO]:n.CONSTANT_ALPHA,[pO]:n.ONE_MINUS_CONSTANT_ALPHA};function yn(X,Be,ft,kt,ce,O,V,$,ne,me){if(X===Uc){k===!0&&(At(n.BLEND),k=!1);return}if(k===!1&&(Ft(n.BLEND),k=!0),X!==KN){if(X!==z||me!==be){if((D!==Nu||B!==Nu)&&(n.blendEquation(n.FUNC_ADD),D=Nu,B=Nu),me)switch(X){case Zd:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case _M:n.blendFunc(n.ONE,n.ONE);break;case xM:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case bM:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}else switch(X){case Zd:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case _M:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case xM:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case bM:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}C=null,U=null,K=null,ue=null,Z.set(0,0,0),ee=0,z=X,be=me}return}ce=ce||Be,O=O||ft,V=V||kt,(Be!==D||ce!==B)&&(n.blendEquationSeparate(je[Be],je[ce]),D=Be,B=ce),(ft!==C||kt!==U||O!==K||V!==ue)&&(n.blendFuncSeparate(An[ft],An[kt],An[O],An[V]),C=ft,U=kt,K=O,ue=V),($.equals(Z)===!1||ne!==ee)&&(n.blendColor($.r,$.g,$.b,ne),Z.copy($),ee=ne),z=X,be=!1}function Qn(X,Be){X.side===Ao?At(n.CULL_FACE):Ft(n.CULL_FACE);let ft=X.side===$a;Be&&(ft=!ft),Yt(ft),X.blending===Zd&&X.transparent===!1?yn(Uc):yn(X.blending,X.blendEquation,X.blendSrc,X.blendDst,X.blendEquationAlpha,X.blendSrcAlpha,X.blendDstAlpha,X.blendColor,X.blendAlpha,X.premultipliedAlpha),o.setFunc(X.depthFunc),o.setTest(X.depthTest),o.setMask(X.depthWrite),i.setMask(X.colorWrite);const kt=X.stencilWrite;u.setTest(kt),kt&&(u.setMask(X.stencilWriteMask),u.setFunc(X.stencilFunc,X.stencilRef,X.stencilFuncMask),u.setOp(X.stencilFail,X.stencilZFail,X.stencilZPass)),le(X.polygonOffset,X.polygonOffsetFactor,X.polygonOffsetUnits),X.alphaToCoverage===!0?Ft(n.SAMPLE_ALPHA_TO_COVERAGE):At(n.SAMPLE_ALPHA_TO_COVERAGE)}function Yt(X){ie!==X&&(X?n.frontFace(n.CW):n.frontFace(n.CCW),ie=X)}function Gn(X){X!==XN?(Ft(n.CULL_FACE),X!==Q&&(X===vM?n.cullFace(n.BACK):X===ZN?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):At(n.CULL_FACE),Q=X}function re(X){X!==Ee&&(lt&&n.lineWidth(X),Ee=X)}function le(X,Be,ft){X?(Ft(n.POLYGON_OFFSET_FILL),(Fe!==Be||Ae!==ft)&&(n.polygonOffset(Be,ft),Fe=Be,Ae=ft)):At(n.POLYGON_OFFSET_FILL)}function st(X){X?Ft(n.SCISSOR_TEST):At(n.SCISSOR_TEST)}function it(X){X===void 0&&(X=n.TEXTURE0+Ve-1),ke!==X&&(n.activeTexture(X),ke=X)}function mt(X,Be,ft){ft===void 0&&(ke===null?ft=n.TEXTURE0+Ve-1:ft=ke);let kt=Je[ft];kt===void 0&&(kt={type:void 0,texture:void 0},Je[ft]=kt),(kt.type!==X||kt.texture!==Be)&&(ke!==ft&&(n.activeTexture(ft),ke=ft),n.bindTexture(X,Be||wt[X]),kt.type=X,kt.texture=Be)}function St(){const X=Je[ke];X!==void 0&&X.type!==void 0&&(n.bindTexture(X.type,null),X.type=void 0,X.texture=void 0)}function _n(){try{n.compressedTexImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Mt(){try{n.compressedTexImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function hn(){try{n.texSubImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function xn(){try{n.texSubImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Nt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function an(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function at(){try{n.texStorage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function tn(){try{n.texStorage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Kt(){try{n.texImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Bn(){try{n.texImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Un(X){Lt.equals(X)===!1&&(n.scissor(X.x,X.y,X.z,X.w),Lt.copy(X))}function dt(X){Cn.equals(X)===!1&&(n.viewport(X.x,X.y,X.z,X.w),Cn.copy(X))}function Ht(X,Be){let ft=p.get(Be);ft===void 0&&(ft=new WeakMap,p.set(Be,ft));let kt=ft.get(X);kt===void 0&&(kt=n.getUniformBlockIndex(Be,X.name),ft.set(X,kt))}function jt(X,Be){const kt=p.get(Be).get(X);l.get(Be)!==kt&&(n.uniformBlockBinding(Be,kt,X.__bindingPointIndex),l.set(Be,kt))}function Jt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),v={},ke=null,Je={},x={},M=new WeakMap,w=[],A=null,k=!1,z=null,D=null,C=null,U=null,B=null,K=null,ue=null,Z=new Tr(0,0,0),ee=0,be=!1,ie=null,Q=null,Ee=null,Fe=null,Ae=null,Lt.set(0,0,n.canvas.width,n.canvas.height),Cn.set(0,0,n.canvas.width,n.canvas.height),i.reset(),o.reset(),u.reset()}return{buffers:{color:i,depth:o,stencil:u},enable:Ft,disable:At,bindFramebuffer:gn,drawBuffers:En,useProgram:In,setBlending:yn,setMaterial:Qn,setFlipSided:Yt,setCullFace:Gn,setLineWidth:re,setPolygonOffset:le,setScissorTest:st,activeTexture:it,bindTexture:mt,unbindTexture:St,compressedTexImage2D:_n,compressedTexImage3D:Mt,texImage2D:Kt,texImage3D:Bn,updateUBOMapping:Ht,uniformBlockBinding:jt,texStorage2D:at,texStorage3D:tn,texSubImage2D:hn,texSubImage3D:xn,compressedTexSubImage2D:Nt,compressedTexSubImage3D:an,scissor:Un,viewport:dt,reset:Jt}}function mj(n,e,t,r,i,o,u){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),v=new qn,x=new WeakMap;let M;const w=new WeakMap;let A=!1;try{A=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function k(re,le){return A?new OffscreenCanvas(re,le):Kp("canvas")}function z(re,le,st){let it=1;const mt=Gn(re);if((mt.width>st||mt.height>st)&&(it=st/Math.max(mt.width,mt.height)),it<1)if(typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&re instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&re instanceof ImageBitmap||typeof VideoFrame<"u"&&re instanceof VideoFrame){const St=Math.floor(it*mt.width),_n=Math.floor(it*mt.height);M===void 0&&(M=k(St,_n));const Mt=le?k(St,_n):M;return Mt.width=St,Mt.height=_n,Mt.getContext("2d").drawImage(re,0,0,St,_n),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+mt.width+"x"+mt.height+") to ("+St+"x"+_n+")."),Mt}else return"data"in re&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+mt.width+"x"+mt.height+")."),re;return re}function D(re){return re.generateMipmaps&&re.minFilter!==Is&&re.minFilter!==io}function C(re){n.generateMipmap(re)}function U(re,le,st,it,mt=!1){if(re!==null){if(n[re]!==void 0)return n[re];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+re+"'")}let St=le;if(le===n.RED&&(st===n.FLOAT&&(St=n.R32F),st===n.HALF_FLOAT&&(St=n.R16F),st===n.UNSIGNED_BYTE&&(St=n.R8)),le===n.RED_INTEGER&&(st===n.UNSIGNED_BYTE&&(St=n.R8UI),st===n.UNSIGNED_SHORT&&(St=n.R16UI),st===n.UNSIGNED_INT&&(St=n.R32UI),st===n.BYTE&&(St=n.R8I),st===n.SHORT&&(St=n.R16I),st===n.INT&&(St=n.R32I)),le===n.RG&&(st===n.FLOAT&&(St=n.RG32F),st===n.HALF_FLOAT&&(St=n.RG16F),st===n.UNSIGNED_BYTE&&(St=n.RG8)),le===n.RG_INTEGER&&(st===n.UNSIGNED_BYTE&&(St=n.RG8UI),st===n.UNSIGNED_SHORT&&(St=n.RG16UI),st===n.UNSIGNED_INT&&(St=n.RG32UI),st===n.BYTE&&(St=n.RG8I),st===n.SHORT&&(St=n.RG16I),st===n.INT&&(St=n.RG32I)),le===n.RGB&&st===n.UNSIGNED_INT_5_9_9_9_REV&&(St=n.RGB9_E5),le===n.RGBA){const _n=mt?Py:Mr.getTransfer(it);st===n.FLOAT&&(St=n.RGBA32F),st===n.HALF_FLOAT&&(St=n.RGBA16F),st===n.UNSIGNED_BYTE&&(St=_n===Or?n.SRGB8_ALPHA8:n.RGBA8),st===n.UNSIGNED_SHORT_4_4_4_4&&(St=n.RGBA4),st===n.UNSIGNED_SHORT_5_5_5_1&&(St=n.RGB5_A1)}return(St===n.R16F||St===n.R32F||St===n.RG16F||St===n.RG32F||St===n.RGBA16F||St===n.RGBA32F)&&e.get("EXT_color_buffer_float"),St}function B(re,le){return D(re)===!0||re.isFramebufferTexture&&re.minFilter!==Is&&re.minFilter!==io?Math.log2(Math.max(le.width,le.height))+1:re.mipmaps!==void 0&&re.mipmaps.length>0?re.mipmaps.length:re.isCompressedTexture&&Array.isArray(re.image)?le.mipmaps.length:1}function K(re){const le=re.target;le.removeEventListener("dispose",K),Z(le),le.isVideoTexture&&x.delete(le)}function ue(re){const le=re.target;le.removeEventListener("dispose",ue),be(le)}function Z(re){const le=r.get(re);if(le.__webglInit===void 0)return;const st=re.source,it=w.get(st);if(it){const mt=it[le.__cacheKey];mt.usedTimes--,mt.usedTimes===0&&ee(re),Object.keys(it).length===0&&w.delete(st)}r.remove(re)}function ee(re){const le=r.get(re);n.deleteTexture(le.__webglTexture);const st=re.source,it=w.get(st);delete it[le.__cacheKey],u.memory.textures--}function be(re){const le=r.get(re);if(re.depthTexture&&re.depthTexture.dispose(),re.isWebGLCubeRenderTarget)for(let it=0;it<6;it++){if(Array.isArray(le.__webglFramebuffer[it]))for(let mt=0;mt<le.__webglFramebuffer[it].length;mt++)n.deleteFramebuffer(le.__webglFramebuffer[it][mt]);else n.deleteFramebuffer(le.__webglFramebuffer[it]);le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer[it])}else{if(Array.isArray(le.__webglFramebuffer))for(let it=0;it<le.__webglFramebuffer.length;it++)n.deleteFramebuffer(le.__webglFramebuffer[it]);else n.deleteFramebuffer(le.__webglFramebuffer);if(le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer),le.__webglMultisampledFramebuffer&&n.deleteFramebuffer(le.__webglMultisampledFramebuffer),le.__webglColorRenderbuffer)for(let it=0;it<le.__webglColorRenderbuffer.length;it++)le.__webglColorRenderbuffer[it]&&n.deleteRenderbuffer(le.__webglColorRenderbuffer[it]);le.__webglDepthRenderbuffer&&n.deleteRenderbuffer(le.__webglDepthRenderbuffer)}const st=re.textures;for(let it=0,mt=st.length;it<mt;it++){const St=r.get(st[it]);St.__webglTexture&&(n.deleteTexture(St.__webglTexture),u.memory.textures--),r.remove(st[it])}r.remove(re)}let ie=0;function Q(){ie=0}function Ee(){const re=ie;return re>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+re+" texture units while this GPU supports only "+i.maxTextures),ie+=1,re}function Fe(re){const le=[];return le.push(re.wrapS),le.push(re.wrapT),le.push(re.wrapR||0),le.push(re.magFilter),le.push(re.minFilter),le.push(re.anisotropy),le.push(re.internalFormat),le.push(re.format),le.push(re.type),le.push(re.generateMipmaps),le.push(re.premultiplyAlpha),le.push(re.flipY),le.push(re.unpackAlignment),le.push(re.colorSpace),le.join()}function Ae(re,le){const st=r.get(re);if(re.isVideoTexture&&Qn(re),re.isRenderTargetTexture===!1&&re.version>0&&st.__version!==re.version){const it=re.image;if(it===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(it.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Lt(st,re,le);return}}t.bindTexture(n.TEXTURE_2D,st.__webglTexture,n.TEXTURE0+le)}function Ve(re,le){const st=r.get(re);if(re.version>0&&st.__version!==re.version){Lt(st,re,le);return}t.bindTexture(n.TEXTURE_2D_ARRAY,st.__webglTexture,n.TEXTURE0+le)}function lt(re,le){const st=r.get(re);if(re.version>0&&st.__version!==re.version){Lt(st,re,le);return}t.bindTexture(n.TEXTURE_3D,st.__webglTexture,n.TEXTURE0+le)}function ut(re,le){const st=r.get(re);if(re.version>0&&st.__version!==re.version){Cn(st,re,le);return}t.bindTexture(n.TEXTURE_CUBE_MAP,st.__webglTexture,n.TEXTURE0+le)}const pt={[Ab]:n.REPEAT,[ju]:n.CLAMP_TO_EDGE,[Cb]:n.MIRRORED_REPEAT},ke={[Is]:n.NEAREST,[IO]:n.NEAREST_MIPMAP_NEAREST,[Yg]:n.NEAREST_MIPMAP_LINEAR,[io]:n.LINEAR,[Mx]:n.LINEAR_MIPMAP_NEAREST,[Wu]:n.LINEAR_MIPMAP_LINEAR},Je={[$O]:n.NEVER,[JO]:n.ALWAYS,[qO]:n.LESS,[D7]:n.LEQUAL,[XO]:n.EQUAL,[KO]:n.GEQUAL,[ZO]:n.GREATER,[YO]:n.NOTEQUAL};function tt(re,le){if(le.type===Rc&&e.has("OES_texture_float_linear")===!1&&(le.magFilter===io||le.magFilter===Mx||le.magFilter===Yg||le.magFilter===Wu||le.minFilter===io||le.minFilter===Mx||le.minFilter===Yg||le.minFilter===Wu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(re,n.TEXTURE_WRAP_S,pt[le.wrapS]),n.texParameteri(re,n.TEXTURE_WRAP_T,pt[le.wrapT]),(re===n.TEXTURE_3D||re===n.TEXTURE_2D_ARRAY)&&n.texParameteri(re,n.TEXTURE_WRAP_R,pt[le.wrapR]),n.texParameteri(re,n.TEXTURE_MAG_FILTER,ke[le.magFilter]),n.texParameteri(re,n.TEXTURE_MIN_FILTER,ke[le.minFilter]),le.compareFunction&&(n.texParameteri(re,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(re,n.TEXTURE_COMPARE_FUNC,Je[le.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(le.magFilter===Is||le.minFilter!==Yg&&le.minFilter!==Wu||le.type===Rc&&e.has("OES_texture_float_linear")===!1)return;if(le.anisotropy>1||r.get(le).__currentAnisotropy){const st=e.get("EXT_texture_filter_anisotropic");n.texParameterf(re,st.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,i.getMaxAnisotropy())),r.get(le).__currentAnisotropy=le.anisotropy}}}function _t(re,le){let st=!1;re.__webglInit===void 0&&(re.__webglInit=!0,le.addEventListener("dispose",K));const it=le.source;let mt=w.get(it);mt===void 0&&(mt={},w.set(it,mt));const St=Fe(le);if(St!==re.__cacheKey){mt[St]===void 0&&(mt[St]={texture:n.createTexture(),usedTimes:0},u.memory.textures++,st=!0),mt[St].usedTimes++;const _n=mt[re.__cacheKey];_n!==void 0&&(mt[re.__cacheKey].usedTimes--,_n.usedTimes===0&&ee(le)),re.__cacheKey=St,re.__webglTexture=mt[St].texture}return st}function Lt(re,le,st){let it=n.TEXTURE_2D;(le.isDataArrayTexture||le.isCompressedArrayTexture)&&(it=n.TEXTURE_2D_ARRAY),le.isData3DTexture&&(it=n.TEXTURE_3D);const mt=_t(re,le),St=le.source;t.bindTexture(it,re.__webglTexture,n.TEXTURE0+st);const _n=r.get(St);if(St.version!==_n.__version||mt===!0){t.activeTexture(n.TEXTURE0+st);const Mt=Mr.getPrimaries(Mr.workingColorSpace),hn=le.colorSpace===Ac?null:Mr.getPrimaries(le.colorSpace),xn=le.colorSpace===Ac||Mt===hn?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,xn);let Nt=z(le.image,!1,i.maxTextureSize);Nt=Yt(le,Nt);const an=o.convert(le.format,le.colorSpace),at=o.convert(le.type);let tn=U(le.internalFormat,an,at,le.colorSpace,le.isVideoTexture);tt(it,le);let Kt;const Bn=le.mipmaps,Un=le.isVideoTexture!==!0&&tn!==I7,dt=_n.__version===void 0||mt===!0,Ht=St.dataReady,jt=B(le,Nt);if(le.isDepthTexture)tn=n.DEPTH_COMPONENT16,le.type===Rc?tn=n.DEPTH_COMPONENT32F:le.type===df?tn=n.DEPTH_COMPONENT24:le.type===gm&&(tn=n.DEPTH24_STENCIL8),dt&&(Un?t.texStorage2D(n.TEXTURE_2D,1,tn,Nt.width,Nt.height):t.texImage2D(n.TEXTURE_2D,0,tn,Nt.width,Nt.height,0,an,at,null));else if(le.isDataTexture)if(Bn.length>0){Un&&dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,Bn[0].width,Bn[0].height);for(let Jt=0,X=Bn.length;Jt<X;Jt++)Kt=Bn[Jt],Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,at,Kt.data):t.texImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,an,at,Kt.data);le.generateMipmaps=!1}else Un?(dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,Nt.width,Nt.height),Ht&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Nt.width,Nt.height,an,at,Nt.data)):t.texImage2D(n.TEXTURE_2D,0,tn,Nt.width,Nt.height,0,an,at,Nt.data);else if(le.isCompressedTexture)if(le.isCompressedArrayTexture){Un&&dt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,jt,tn,Bn[0].width,Bn[0].height,Nt.depth);for(let Jt=0,X=Bn.length;Jt<X;Jt++)Kt=Bn[Jt],le.format!==Ro?an!==null?Un?Ht&&t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Jt,0,0,0,Kt.width,Kt.height,Nt.depth,an,Kt.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Jt,tn,Kt.width,Kt.height,Nt.depth,0,Kt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Un?Ht&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Jt,0,0,0,Kt.width,Kt.height,Nt.depth,an,at,Kt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Jt,tn,Kt.width,Kt.height,Nt.depth,0,an,at,Kt.data)}else{Un&&dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,Bn[0].width,Bn[0].height);for(let Jt=0,X=Bn.length;Jt<X;Jt++)Kt=Bn[Jt],le.format!==Ro?an!==null?Un?Ht&&t.compressedTexSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,Kt.data):t.compressedTexImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,Kt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,at,Kt.data):t.texImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,an,at,Kt.data)}else if(le.isDataArrayTexture)Un?(dt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,jt,tn,Nt.width,Nt.height,Nt.depth),Ht&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Nt.width,Nt.height,Nt.depth,an,at,Nt.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,tn,Nt.width,Nt.height,Nt.depth,0,an,at,Nt.data);else if(le.isData3DTexture)Un?(dt&&t.texStorage3D(n.TEXTURE_3D,jt,tn,Nt.width,Nt.height,Nt.depth),Ht&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Nt.width,Nt.height,Nt.depth,an,at,Nt.data)):t.texImage3D(n.TEXTURE_3D,0,tn,Nt.width,Nt.height,Nt.depth,0,an,at,Nt.data);else if(le.isFramebufferTexture){if(dt)if(Un)t.texStorage2D(n.TEXTURE_2D,jt,tn,Nt.width,Nt.height);else{let Jt=Nt.width,X=Nt.height;for(let Be=0;Be<jt;Be++)t.texImage2D(n.TEXTURE_2D,Be,tn,Jt,X,0,an,at,null),Jt>>=1,X>>=1}}else if(Bn.length>0){if(Un&&dt){const Jt=Gn(Bn[0]);t.texStorage2D(n.TEXTURE_2D,jt,tn,Jt.width,Jt.height)}for(let Jt=0,X=Bn.length;Jt<X;Jt++)Kt=Bn[Jt],Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,an,at,Kt):t.texImage2D(n.TEXTURE_2D,Jt,tn,an,at,Kt);le.generateMipmaps=!1}else if(Un){if(dt){const Jt=Gn(Nt);t.texStorage2D(n.TEXTURE_2D,jt,tn,Jt.width,Jt.height)}Ht&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,an,at,Nt)}else t.texImage2D(n.TEXTURE_2D,0,tn,an,at,Nt);D(le)&&C(it),_n.__version=St.version,le.onUpdate&&le.onUpdate(le)}re.__version=le.version}function Cn(re,le,st){if(le.image.length!==6)return;const it=_t(re,le),mt=le.source;t.bindTexture(n.TEXTURE_CUBE_MAP,re.__webglTexture,n.TEXTURE0+st);const St=r.get(mt);if(mt.version!==St.__version||it===!0){t.activeTexture(n.TEXTURE0+st);const _n=Mr.getPrimaries(Mr.workingColorSpace),Mt=le.colorSpace===Ac?null:Mr.getPrimaries(le.colorSpace),hn=le.colorSpace===Ac||_n===Mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,hn);const xn=le.isCompressedTexture||le.image[0].isCompressedTexture,Nt=le.image[0]&&le.image[0].isDataTexture,an=[];for(let X=0;X<6;X++)!xn&&!Nt?an[X]=z(le.image[X],!0,i.maxCubemapSize):an[X]=Nt?le.image[X].image:le.image[X],an[X]=Yt(le,an[X]);const at=an[0],tn=o.convert(le.format,le.colorSpace),Kt=o.convert(le.type),Bn=U(le.internalFormat,tn,Kt,le.colorSpace),Un=le.isVideoTexture!==!0,dt=St.__version===void 0||it===!0,Ht=mt.dataReady;let jt=B(le,at);tt(n.TEXTURE_CUBE_MAP,le);let Jt;if(xn){Un&&dt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,jt,Bn,at.width,at.height);for(let X=0;X<6;X++){Jt=an[X].mipmaps;for(let Be=0;Be<Jt.length;Be++){const ft=Jt[Be];le.format!==Ro?tn!==null?Un?Ht&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be,0,0,ft.width,ft.height,tn,ft.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be,Bn,ft.width,ft.height,0,ft.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be,0,0,ft.width,ft.height,tn,Kt,ft.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be,Bn,ft.width,ft.height,0,tn,Kt,ft.data)}}}else{if(Jt=le.mipmaps,Un&&dt){Jt.length>0&&jt++;const X=Gn(an[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,jt,Bn,X.width,X.height)}for(let X=0;X<6;X++)if(Nt){Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,an[X].width,an[X].height,tn,Kt,an[X].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,Bn,an[X].width,an[X].height,0,tn,Kt,an[X].data);for(let Be=0;Be<Jt.length;Be++){const kt=Jt[Be].image[X].image;Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be+1,0,0,kt.width,kt.height,tn,Kt,kt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be+1,Bn,kt.width,kt.height,0,tn,Kt,kt.data)}}else{Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,tn,Kt,an[X]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,Bn,tn,Kt,an[X]);for(let Be=0;Be<Jt.length;Be++){const ft=Jt[Be];Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be+1,0,0,tn,Kt,ft.image[X]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Be+1,Bn,tn,Kt,ft.image[X])}}}D(le)&&C(n.TEXTURE_CUBE_MAP),St.__version=mt.version,le.onUpdate&&le.onUpdate(le)}re.__version=le.version}function nt(re,le,st,it,mt,St){const _n=o.convert(st.format,st.colorSpace),Mt=o.convert(st.type),hn=U(st.internalFormat,_n,Mt,st.colorSpace);if(!r.get(le).__hasExternalTextures){const Nt=Math.max(1,le.width>>St),an=Math.max(1,le.height>>St);mt===n.TEXTURE_3D||mt===n.TEXTURE_2D_ARRAY?t.texImage3D(mt,St,hn,Nt,an,le.depth,0,_n,Mt,null):t.texImage2D(mt,St,hn,Nt,an,0,_n,Mt,null)}t.bindFramebuffer(n.FRAMEBUFFER,re),yn(le)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,it,mt,r.get(st).__webglTexture,0,An(le)):(mt===n.TEXTURE_2D||mt>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&mt<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,it,mt,r.get(st).__webglTexture,St),t.bindFramebuffer(n.FRAMEBUFFER,null)}function wt(re,le,st){if(n.bindRenderbuffer(n.RENDERBUFFER,re),le.depthBuffer&&!le.stencilBuffer){let it=n.DEPTH_COMPONENT24;if(st||yn(le)){const mt=le.depthTexture;mt&&mt.isDepthTexture&&(mt.type===Rc?it=n.DEPTH_COMPONENT32F:mt.type===df&&(it=n.DEPTH_COMPONENT24));const St=An(le);yn(le)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,St,it,le.width,le.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,St,it,le.width,le.height)}else n.renderbufferStorage(n.RENDERBUFFER,it,le.width,le.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,re)}else if(le.depthBuffer&&le.stencilBuffer){const it=An(le);st&&yn(le)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,it,n.DEPTH24_STENCIL8,le.width,le.height):yn(le)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,it,n.DEPTH24_STENCIL8,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,le.width,le.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,re)}else{const it=le.textures;for(let mt=0;mt<it.length;mt++){const St=it[mt],_n=o.convert(St.format,St.colorSpace),Mt=o.convert(St.type),hn=U(St.internalFormat,_n,Mt,St.colorSpace),xn=An(le);st&&yn(le)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,xn,hn,le.width,le.height):yn(le)?l.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,xn,hn,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,hn,le.width,le.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ft(re,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,re),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!r.get(le.depthTexture).__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),Ae(le.depthTexture,0);const it=r.get(le.depthTexture).__webglTexture,mt=An(le);if(le.depthTexture.format===Yd)yn(le)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,it,0,mt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,it,0);else if(le.depthTexture.format===Zp)yn(le)?l.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,it,0,mt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,it,0);else throw new Error("Unknown depthTexture format")}function At(re){const le=r.get(re),st=re.isWebGLCubeRenderTarget===!0;if(re.depthTexture&&!le.__autoAllocateDepthBuffer){if(st)throw new Error("target.depthTexture not supported in Cube render targets");Ft(le.__webglFramebuffer,re)}else if(st){le.__webglDepthbuffer=[];for(let it=0;it<6;it++)t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer[it]),le.__webglDepthbuffer[it]=n.createRenderbuffer(),wt(le.__webglDepthbuffer[it],re,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer=n.createRenderbuffer(),wt(le.__webglDepthbuffer,re,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function gn(re,le,st){const it=r.get(re);le!==void 0&&nt(it.__webglFramebuffer,re,re.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),st!==void 0&&At(re)}function En(re){const le=re.texture,st=r.get(re),it=r.get(le);re.addEventListener("dispose",ue);const mt=re.textures,St=re.isWebGLCubeRenderTarget===!0,_n=mt.length>1;if(_n||(it.__webglTexture===void 0&&(it.__webglTexture=n.createTexture()),it.__version=le.version,u.memory.textures++),St){st.__webglFramebuffer=[];for(let Mt=0;Mt<6;Mt++)if(le.mipmaps&&le.mipmaps.length>0){st.__webglFramebuffer[Mt]=[];for(let hn=0;hn<le.mipmaps.length;hn++)st.__webglFramebuffer[Mt][hn]=n.createFramebuffer()}else st.__webglFramebuffer[Mt]=n.createFramebuffer()}else{if(le.mipmaps&&le.mipmaps.length>0){st.__webglFramebuffer=[];for(let Mt=0;Mt<le.mipmaps.length;Mt++)st.__webglFramebuffer[Mt]=n.createFramebuffer()}else st.__webglFramebuffer=n.createFramebuffer();if(_n)for(let Mt=0,hn=mt.length;Mt<hn;Mt++){const xn=r.get(mt[Mt]);xn.__webglTexture===void 0&&(xn.__webglTexture=n.createTexture(),u.memory.textures++)}if(re.samples>0&&yn(re)===!1){st.__webglMultisampledFramebuffer=n.createFramebuffer(),st.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,st.__webglMultisampledFramebuffer);for(let Mt=0;Mt<mt.length;Mt++){const hn=mt[Mt];st.__webglColorRenderbuffer[Mt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,st.__webglColorRenderbuffer[Mt]);const xn=o.convert(hn.format,hn.colorSpace),Nt=o.convert(hn.type),an=U(hn.internalFormat,xn,Nt,hn.colorSpace,re.isXRRenderTarget===!0),at=An(re);n.renderbufferStorageMultisample(n.RENDERBUFFER,at,an,re.width,re.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.RENDERBUFFER,st.__webglColorRenderbuffer[Mt])}n.bindRenderbuffer(n.RENDERBUFFER,null),re.depthBuffer&&(st.__webglDepthRenderbuffer=n.createRenderbuffer(),wt(st.__webglDepthRenderbuffer,re,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(St){t.bindTexture(n.TEXTURE_CUBE_MAP,it.__webglTexture),tt(n.TEXTURE_CUBE_MAP,le);for(let Mt=0;Mt<6;Mt++)if(le.mipmaps&&le.mipmaps.length>0)for(let hn=0;hn<le.mipmaps.length;hn++)nt(st.__webglFramebuffer[Mt][hn],re,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,hn);else nt(st.__webglFramebuffer[Mt],re,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0);D(le)&&C(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(_n){for(let Mt=0,hn=mt.length;Mt<hn;Mt++){const xn=mt[Mt],Nt=r.get(xn);t.bindTexture(n.TEXTURE_2D,Nt.__webglTexture),tt(n.TEXTURE_2D,xn),nt(st.__webglFramebuffer,re,xn,n.COLOR_ATTACHMENT0+Mt,n.TEXTURE_2D,0),D(xn)&&C(n.TEXTURE_2D)}t.unbindTexture()}else{let Mt=n.TEXTURE_2D;if((re.isWebGL3DRenderTarget||re.isWebGLArrayRenderTarget)&&(Mt=re.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Mt,it.__webglTexture),tt(Mt,le),le.mipmaps&&le.mipmaps.length>0)for(let hn=0;hn<le.mipmaps.length;hn++)nt(st.__webglFramebuffer[hn],re,le,n.COLOR_ATTACHMENT0,Mt,hn);else nt(st.__webglFramebuffer,re,le,n.COLOR_ATTACHMENT0,Mt,0);D(le)&&C(Mt),t.unbindTexture()}re.depthBuffer&&At(re)}function In(re){const le=re.textures;for(let st=0,it=le.length;st<it;st++){const mt=le[st];if(D(mt)){const St=re.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,_n=r.get(mt).__webglTexture;t.bindTexture(St,_n),C(St),t.unbindTexture()}}}function je(re){if(re.samples>0&&yn(re)===!1){const le=re.textures,st=re.width,it=re.height;let mt=n.COLOR_BUFFER_BIT;const St=[],_n=re.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Mt=r.get(re),hn=le.length>1;if(hn)for(let xn=0;xn<le.length;xn++)t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Mt.__webglFramebuffer);for(let xn=0;xn<le.length;xn++){St.push(n.COLOR_ATTACHMENT0+xn),re.depthBuffer&&St.push(_n);const Nt=Mt.__ignoreDepthValues!==void 0?Mt.__ignoreDepthValues:!1;if(Nt===!1&&(re.depthBuffer&&(mt|=n.DEPTH_BUFFER_BIT),re.stencilBuffer&&Mt.__isTransmissionRenderTarget!==!0&&(mt|=n.STENCIL_BUFFER_BIT)),hn&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Mt.__webglColorRenderbuffer[xn]),Nt===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[_n]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[_n])),hn){const an=r.get(le[xn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,an,0)}n.blitFramebuffer(0,0,st,it,0,0,st,it,mt,n.NEAREST),p&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,St)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),hn)for(let xn=0;xn<le.length;xn++){t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.RENDERBUFFER,Mt.__webglColorRenderbuffer[xn]);const Nt=r.get(le[xn]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.TEXTURE_2D,Nt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer)}}function An(re){return Math.min(i.maxSamples,re.samples)}function yn(re){const le=r.get(re);return re.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function Qn(re){const le=u.render.frame;x.get(re)!==le&&(x.set(re,le),re.update())}function Yt(re,le){const st=re.colorSpace,it=re.format,mt=re.type;return re.isCompressedTexture===!0||re.isVideoTexture===!0||st!==eu&&st!==Ac&&(Mr.getTransfer(st)===Or?(it!==Ro||mt!==Hc)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",st)),le}function Gn(re){return typeof HTMLImageElement<"u"&&re instanceof HTMLImageElement?(v.width=re.naturalWidth||re.width,v.height=re.naturalHeight||re.height):typeof VideoFrame<"u"&&re instanceof VideoFrame?(v.width=re.displayWidth,v.height=re.displayHeight):(v.width=re.width,v.height=re.height),v}this.allocateTextureUnit=Ee,this.resetTextureUnits=Q,this.setTexture2D=Ae,this.setTexture2DArray=Ve,this.setTexture3D=lt,this.setTextureCube=ut,this.rebindTextures=gn,this.setupRenderTarget=En,this.updateRenderTargetMipmap=In,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=At,this.setupFrameBufferTexture=nt,this.useMultisampledRTT=yn}function gj(n,e){function t(r,i=Ac){let o;const u=Mr.getTransfer(i);if(r===Hc)return n.UNSIGNED_BYTE;if(r===E7)return n.UNSIGNED_SHORT_4_4_4_4;if(r===A7)return n.UNSIGNED_SHORT_5_5_5_1;if(r===LO)return n.UNSIGNED_INT_5_9_9_9_REV;if(r===DO)return n.BYTE;if(r===kO)return n.SHORT;if(r===M7)return n.UNSIGNED_SHORT;if(r===T7)return n.INT;if(r===df)return n.UNSIGNED_INT;if(r===Rc)return n.FLOAT;if(r===Cy)return n.HALF_FLOAT;if(r===zO)return n.ALPHA;if(r===FO)return n.RGB;if(r===Ro)return n.RGBA;if(r===NO)return n.LUMINANCE;if(r===OO)return n.LUMINANCE_ALPHA;if(r===Yd)return n.DEPTH_COMPONENT;if(r===Zp)return n.DEPTH_STENCIL;if(r===BO)return n.RED;if(r===C7)return n.RED_INTEGER;if(r===UO)return n.RG;if(r===P7)return n.RG_INTEGER;if(r===R7)return n.RGBA_INTEGER;if(r===Tx||r===Ex||r===Ax||r===Cx)if(u===Or)if(o=e.get("WEBGL_compressed_texture_s3tc_srgb"),o!==null){if(r===Tx)return o.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(r===Ex)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(r===Ax)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(r===Cx)return o.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(o=e.get("WEBGL_compressed_texture_s3tc"),o!==null){if(r===Tx)return o.COMPRESSED_RGB_S3TC_DXT1_EXT;if(r===Ex)return o.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(r===Ax)return o.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(r===Cx)return o.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(r===wM||r===SM||r===MM||r===TM)if(o=e.get("WEBGL_compressed_texture_pvrtc"),o!==null){if(r===wM)return o.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(r===SM)return o.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(r===MM)return o.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(r===TM)return o.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(r===I7)return o=e.get("WEBGL_compressed_texture_etc1"),o!==null?o.COMPRESSED_RGB_ETC1_WEBGL:null;if(r===EM||r===AM)if(o=e.get("WEBGL_compressed_texture_etc"),o!==null){if(r===EM)return u===Or?o.COMPRESSED_SRGB8_ETC2:o.COMPRESSED_RGB8_ETC2;if(r===AM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:o.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(r===CM||r===PM||r===RM||r===IM||r===DM||r===kM||r===LM||r===zM||r===FM||r===NM||r===OM||r===BM||r===UM||r===VM)if(o=e.get("WEBGL_compressed_texture_astc"),o!==null){if(r===CM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:o.COMPRESSED_RGBA_ASTC_4x4_KHR;if(r===PM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:o.COMPRESSED_RGBA_ASTC_5x4_KHR;if(r===RM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:o.COMPRESSED_RGBA_ASTC_5x5_KHR;if(r===IM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:o.COMPRESSED_RGBA_ASTC_6x5_KHR;if(r===DM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:o.COMPRESSED_RGBA_ASTC_6x6_KHR;if(r===kM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:o.COMPRESSED_RGBA_ASTC_8x5_KHR;if(r===LM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:o.COMPRESSED_RGBA_ASTC_8x6_KHR;if(r===zM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:o.COMPRESSED_RGBA_ASTC_8x8_KHR;if(r===FM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:o.COMPRESSED_RGBA_ASTC_10x5_KHR;if(r===NM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:o.COMPRESSED_RGBA_ASTC_10x6_KHR;if(r===OM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:o.COMPRESSED_RGBA_ASTC_10x8_KHR;if(r===BM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:o.COMPRESSED_RGBA_ASTC_10x10_KHR;if(r===UM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:o.COMPRESSED_RGBA_ASTC_12x10_KHR;if(r===VM)return u===Or?o.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:o.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(r===Px||r===HM||r===GM)if(o=e.get("EXT_texture_compression_bptc"),o!==null){if(r===Px)return u===Or?o.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:o.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(r===HM)return o.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(r===GM)return o.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(r===VO||r===jM||r===WM||r===$M)if(o=e.get("EXT_texture_compression_rgtc"),o!==null){if(r===Px)return o.COMPRESSED_RED_RGTC1_EXT;if(r===jM)return o.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(r===WM)return o.COMPRESSED_RED_GREEN_RGTC2_EXT;if(r===$M)return o.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return r===gm?n.UNSIGNED_INT_24_8:n[r]!==void 0?n[r]:null}return{convert:t}}class yj extends Cs{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class lp extends hs{constructor(){super(),this.isGroup=!0,this.type="Group"}}const vj={type:"move"};class e2{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new lp,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new lp,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new rt,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new rt),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new lp,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new rt,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new rt),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const r of e.hand.values())this._getHandJoint(t,r)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,r){let i=null,o=null,u=null;const l=this._targetRay,p=this._grip,v=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(v&&e.hand){u=!0;for(const z of e.hand.values()){const D=t.getJointPose(z,r),C=this._getHandJoint(v,z);D!==null&&(C.matrix.fromArray(D.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,C.jointRadius=D.radius),C.visible=D!==null}const x=v.joints["index-finger-tip"],M=v.joints["thumb-tip"],w=x.position.distanceTo(M.position),A=.02,k=.005;v.inputState.pinching&&w>A+k?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!v.inputState.pinching&&w<=A-k&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else p!==null&&e.gripSpace&&(o=t.getPose(e.gripSpace,r),o!==null&&(p.matrix.fromArray(o.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,o.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(o.linearVelocity)):p.hasLinearVelocity=!1,o.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(o.angularVelocity)):p.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,r),i===null&&o!==null&&(i=o),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(vj)))}return l!==null&&(l.visible=i!==null),p!==null&&(p.visible=o!==null),v!==null&&(v.visible=u!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const r=new lp;r.matrixAutoUpdate=!1,r.visible=!1,e.joints[t.jointName]=r,e.add(r)}return e.joints[t.jointName]}}const _j=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,xj=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class bj{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,r){if(this.texture===null){const i=new Ca,o=e.properties.get(i);o.__webglTexture=t.texture,(t.depthNear!=r.depthNear||t.depthFar!=r.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}render(e,t){if(this.texture!==null){if(this.mesh===null){const r=t.cameras[0].viewport,i=new Ds({vertexShader:_j,fragmentShader:xj,uniforms:{depthColor:{value:this.texture},depthWidth:{value:r.z},depthHeight:{value:r.w}}});this.mesh=new cs(new _m(20,20),i)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class wj extends ch{constructor(e,t){super();const r=this;let i=null,o=1,u=null,l="local-floor",p=1,v=null,x=null,M=null,w=null,A=null,k=null;const z=new bj,D=t.getContextAttributes();let C=null,U=null;const B=[],K=[],ue=new qn;let Z=null;const ee=new Cs;ee.layers.enable(1),ee.viewport=new Wi;const be=new Cs;be.layers.enable(2),be.viewport=new Wi;const ie=[ee,be],Q=new yj;Q.layers.enable(1),Q.layers.enable(2);let Ee=null,Fe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(nt){let wt=B[nt];return wt===void 0&&(wt=new e2,B[nt]=wt),wt.getTargetRaySpace()},this.getControllerGrip=function(nt){let wt=B[nt];return wt===void 0&&(wt=new e2,B[nt]=wt),wt.getGripSpace()},this.getHand=function(nt){let wt=B[nt];return wt===void 0&&(wt=new e2,B[nt]=wt),wt.getHandSpace()};function Ae(nt){const wt=K.indexOf(nt.inputSource);if(wt===-1)return;const Ft=B[wt];Ft!==void 0&&(Ft.update(nt.inputSource,nt.frame,v||u),Ft.dispatchEvent({type:nt.type,data:nt.inputSource}))}function Ve(){i.removeEventListener("select",Ae),i.removeEventListener("selectstart",Ae),i.removeEventListener("selectend",Ae),i.removeEventListener("squeeze",Ae),i.removeEventListener("squeezestart",Ae),i.removeEventListener("squeezeend",Ae),i.removeEventListener("end",Ve),i.removeEventListener("inputsourceschange",lt);for(let nt=0;nt<B.length;nt++){const wt=K[nt];wt!==null&&(K[nt]=null,B[nt].disconnect(wt))}Ee=null,Fe=null,z.reset(),e.setRenderTarget(C),A=null,w=null,M=null,i=null,U=null,Cn.stop(),r.isPresenting=!1,e.setPixelRatio(Z),e.setSize(ue.width,ue.height,!1),r.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(nt){o=nt,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(nt){l=nt,r.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return v||u},this.setReferenceSpace=function(nt){v=nt},this.getBaseLayer=function(){return w!==null?w:A},this.getBinding=function(){return M},this.getFrame=function(){return k},this.getSession=function(){return i},this.setSession=async function(nt){if(i=nt,i!==null){if(C=e.getRenderTarget(),i.addEventListener("select",Ae),i.addEventListener("selectstart",Ae),i.addEventListener("selectend",Ae),i.addEventListener("squeeze",Ae),i.addEventListener("squeezestart",Ae),i.addEventListener("squeezeend",Ae),i.addEventListener("end",Ve),i.addEventListener("inputsourceschange",lt),D.xrCompatible!==!0&&await t.makeXRCompatible(),Z=e.getPixelRatio(),e.getSize(ue),i.renderState.layers===void 0){const wt={antialias:D.antialias,alpha:!0,depth:D.depth,stencil:D.stencil,framebufferScaleFactor:o};A=new XRWebGLLayer(i,t,wt),i.updateRenderState({baseLayer:A}),e.setPixelRatio(1),e.setSize(A.framebufferWidth,A.framebufferHeight,!1),U=new rh(A.framebufferWidth,A.framebufferHeight,{format:Ro,type:Hc,colorSpace:e.outputColorSpace,stencilBuffer:D.stencil})}else{let wt=null,Ft=null,At=null;D.depth&&(At=D.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,wt=D.stencil?Zp:Yd,Ft=D.stencil?gm:df);const gn={colorFormat:t.RGBA8,depthFormat:At,scaleFactor:o};M=new XRWebGLBinding(i,t),w=M.createProjectionLayer(gn),i.updateRenderState({layers:[w]}),e.setPixelRatio(1),e.setSize(w.textureWidth,w.textureHeight,!1),U=new rh(w.textureWidth,w.textureHeight,{format:Ro,type:Hc,depthTexture:new q7(w.textureWidth,w.textureHeight,Ft,void 0,void 0,void 0,void 0,void 0,void 0,wt),stencilBuffer:D.stencil,colorSpace:e.outputColorSpace,samples:D.antialias?4:0});const En=e.properties.get(U);En.__ignoreDepthValues=w.ignoreDepthValues}U.isXRRenderTarget=!0,this.setFoveation(p),v=null,u=await i.requestReferenceSpace(l),Cn.setContext(i),Cn.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode};function lt(nt){for(let wt=0;wt<nt.removed.length;wt++){const Ft=nt.removed[wt],At=K.indexOf(Ft);At>=0&&(K[At]=null,B[At].disconnect(Ft))}for(let wt=0;wt<nt.added.length;wt++){const Ft=nt.added[wt];let At=K.indexOf(Ft);if(At===-1){for(let En=0;En<B.length;En++)if(En>=K.length){K.push(Ft),At=En;break}else if(K[En]===null){K[En]=Ft,At=En;break}if(At===-1)break}const gn=B[At];gn&&gn.connect(Ft)}}const ut=new rt,pt=new rt;function ke(nt,wt,Ft){ut.setFromMatrixPosition(wt.matrixWorld),pt.setFromMatrixPosition(Ft.matrixWorld);const At=ut.distanceTo(pt),gn=wt.projectionMatrix.elements,En=Ft.projectionMatrix.elements,In=gn[14]/(gn[10]-1),je=gn[14]/(gn[10]+1),An=(gn[9]+1)/gn[5],yn=(gn[9]-1)/gn[5],Qn=(gn[8]-1)/gn[0],Yt=(En[8]+1)/En[0],Gn=In*Qn,re=In*Yt,le=At/(-Qn+Yt),st=le*-Qn;wt.matrixWorld.decompose(nt.position,nt.quaternion,nt.scale),nt.translateX(st),nt.translateZ(le),nt.matrixWorld.compose(nt.position,nt.quaternion,nt.scale),nt.matrixWorldInverse.copy(nt.matrixWorld).invert();const it=In+le,mt=je+le,St=Gn-st,_n=re+(At-st),Mt=An*je/mt*it,hn=yn*je/mt*it;nt.projectionMatrix.makePerspective(St,_n,Mt,hn,it,mt),nt.projectionMatrixInverse.copy(nt.projectionMatrix).invert()}function Je(nt,wt){wt===null?nt.matrixWorld.copy(nt.matrix):nt.matrixWorld.multiplyMatrices(wt.matrixWorld,nt.matrix),nt.matrixWorldInverse.copy(nt.matrixWorld).invert()}this.updateCamera=function(nt){if(i===null)return;z.texture!==null&&(nt.near=z.depthNear,nt.far=z.depthFar),Q.near=be.near=ee.near=nt.near,Q.far=be.far=ee.far=nt.far,(Ee!==Q.near||Fe!==Q.far)&&(i.updateRenderState({depthNear:Q.near,depthFar:Q.far}),Ee=Q.near,Fe=Q.far,ee.near=Ee,ee.far=Fe,be.near=Ee,be.far=Fe,ee.updateProjectionMatrix(),be.updateProjectionMatrix(),nt.updateProjectionMatrix());const wt=nt.parent,Ft=Q.cameras;Je(Q,wt);for(let At=0;At<Ft.length;At++)Je(Ft[At],wt);Ft.length===2?ke(Q,ee,be):Q.projectionMatrix.copy(ee.projectionMatrix),tt(nt,Q,wt)};function tt(nt,wt,Ft){Ft===null?nt.matrix.copy(wt.matrixWorld):(nt.matrix.copy(Ft.matrixWorld),nt.matrix.invert(),nt.matrix.multiply(wt.matrixWorld)),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale),nt.updateMatrixWorld(!0),nt.projectionMatrix.copy(wt.projectionMatrix),nt.projectionMatrixInverse.copy(wt.projectionMatrixInverse),nt.isPerspectiveCamera&&(nt.fov=Yp*2*Math.atan(1/nt.projectionMatrix.elements[5]),nt.zoom=1)}this.getCamera=function(){return Q},this.getFoveation=function(){if(!(w===null&&A===null))return p},this.setFoveation=function(nt){p=nt,w!==null&&(w.fixedFoveation=nt),A!==null&&A.fixedFoveation!==void 0&&(A.fixedFoveation=nt)},this.hasDepthSensing=function(){return z.texture!==null};let _t=null;function Lt(nt,wt){if(x=wt.getViewerPose(v||u),k=wt,x!==null){const Ft=x.views;A!==null&&(e.setRenderTargetFramebuffer(U,A.framebuffer),e.setRenderTarget(U));let At=!1;Ft.length!==Q.cameras.length&&(Q.cameras.length=0,At=!0);for(let En=0;En<Ft.length;En++){const In=Ft[En];let je=null;if(A!==null)je=A.getViewport(In);else{const yn=M.getViewSubImage(w,In);je=yn.viewport,En===0&&(e.setRenderTargetTextures(U,yn.colorTexture,w.ignoreDepthValues?void 0:yn.depthStencilTexture),e.setRenderTarget(U))}let An=ie[En];An===void 0&&(An=new Cs,An.layers.enable(En),An.viewport=new Wi,ie[En]=An),An.matrix.fromArray(In.transform.matrix),An.matrix.decompose(An.position,An.quaternion,An.scale),An.projectionMatrix.fromArray(In.projectionMatrix),An.projectionMatrixInverse.copy(An.projectionMatrix).invert(),An.viewport.set(je.x,je.y,je.width,je.height),En===0&&(Q.matrix.copy(An.matrix),Q.matrix.decompose(Q.position,Q.quaternion,Q.scale)),At===!0&&Q.cameras.push(An)}const gn=i.enabledFeatures;if(gn&&gn.includes("depth-sensing")){const En=M.getDepthInformation(Ft[0]);En&&En.isValid&&En.texture&&z.init(e,En,i.renderState)}}for(let Ft=0;Ft<B.length;Ft++){const At=K[Ft],gn=B[Ft];At!==null&&gn!==void 0&&gn.update(At,wt,v||u)}z.render(e,Q),_t&&_t(nt,wt),wt.detectedPlanes&&r.dispatchEvent({type:"planesdetected",data:wt}),k=null}const Cn=new $7;Cn.setAnimationLoop(Lt),this.setAnimationLoop=function(nt){_t=nt},this.dispose=function(){}}}const Pu=new Il,Sj=new Ti;function Mj(n,e){function t(D,C){D.matrixAutoUpdate===!0&&D.updateMatrix(),C.value.copy(D.matrix)}function r(D,C){C.color.getRGB(D.fogColor.value,H7(n)),C.isFog?(D.fogNear.value=C.near,D.fogFar.value=C.far):C.isFogExp2&&(D.fogDensity.value=C.density)}function i(D,C,U,B,K){C.isMeshBasicMaterial||C.isMeshLambertMaterial?o(D,C):C.isMeshToonMaterial?(o(D,C),M(D,C)):C.isMeshPhongMaterial?(o(D,C),x(D,C)):C.isMeshStandardMaterial?(o(D,C),w(D,C),C.isMeshPhysicalMaterial&&A(D,C,K)):C.isMeshMatcapMaterial?(o(D,C),k(D,C)):C.isMeshDepthMaterial?o(D,C):C.isMeshDistanceMaterial?(o(D,C),z(D,C)):C.isMeshNormalMaterial?o(D,C):C.isLineBasicMaterial?(u(D,C),C.isLineDashedMaterial&&l(D,C)):C.isPointsMaterial?p(D,C,U,B):C.isSpriteMaterial?v(D,C):C.isShadowMaterial?(D.color.value.copy(C.color),D.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function o(D,C){D.opacity.value=C.opacity,C.color&&D.diffuse.value.copy(C.color),C.emissive&&D.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(D.map.value=C.map,t(C.map,D.mapTransform)),C.alphaMap&&(D.alphaMap.value=C.alphaMap,t(C.alphaMap,D.alphaMapTransform)),C.bumpMap&&(D.bumpMap.value=C.bumpMap,t(C.bumpMap,D.bumpMapTransform),D.bumpScale.value=C.bumpScale,C.side===$a&&(D.bumpScale.value*=-1)),C.normalMap&&(D.normalMap.value=C.normalMap,t(C.normalMap,D.normalMapTransform),D.normalScale.value.copy(C.normalScale),C.side===$a&&D.normalScale.value.negate()),C.displacementMap&&(D.displacementMap.value=C.displacementMap,t(C.displacementMap,D.displacementMapTransform),D.displacementScale.value=C.displacementScale,D.displacementBias.value=C.displacementBias),C.emissiveMap&&(D.emissiveMap.value=C.emissiveMap,t(C.emissiveMap,D.emissiveMapTransform)),C.specularMap&&(D.specularMap.value=C.specularMap,t(C.specularMap,D.specularMapTransform)),C.alphaTest>0&&(D.alphaTest.value=C.alphaTest);const U=e.get(C),B=U.envMap,K=U.envMapRotation;if(B&&(D.envMap.value=B,Pu.copy(K),Pu.x*=-1,Pu.y*=-1,Pu.z*=-1,B.isCubeTexture&&B.isRenderTargetTexture===!1&&(Pu.y*=-1,Pu.z*=-1),D.envMapRotation.value.setFromMatrix4(Sj.makeRotationFromEuler(Pu)),D.flipEnvMap.value=B.isCubeTexture&&B.isRenderTargetTexture===!1?-1:1,D.reflectivity.value=C.reflectivity,D.ior.value=C.ior,D.refractionRatio.value=C.refractionRatio),C.lightMap){D.lightMap.value=C.lightMap;const ue=n._useLegacyLights===!0?Math.PI:1;D.lightMapIntensity.value=C.lightMapIntensity*ue,t(C.lightMap,D.lightMapTransform)}C.aoMap&&(D.aoMap.value=C.aoMap,D.aoMapIntensity.value=C.aoMapIntensity,t(C.aoMap,D.aoMapTransform))}function u(D,C){D.diffuse.value.copy(C.color),D.opacity.value=C.opacity,C.map&&(D.map.value=C.map,t(C.map,D.mapTransform))}function l(D,C){D.dashSize.value=C.dashSize,D.totalSize.value=C.dashSize+C.gapSize,D.scale.value=C.scale}function p(D,C,U,B){D.diffuse.value.copy(C.color),D.opacity.value=C.opacity,D.size.value=C.size*U,D.scale.value=B*.5,C.map&&(D.map.value=C.map,t(C.map,D.uvTransform)),C.alphaMap&&(D.alphaMap.value=C.alphaMap,t(C.alphaMap,D.alphaMapTransform)),C.alphaTest>0&&(D.alphaTest.value=C.alphaTest)}function v(D,C){D.diffuse.value.copy(C.color),D.opacity.value=C.opacity,D.rotation.value=C.rotation,C.map&&(D.map.value=C.map,t(C.map,D.mapTransform)),C.alphaMap&&(D.alphaMap.value=C.alphaMap,t(C.alphaMap,D.alphaMapTransform)),C.alphaTest>0&&(D.alphaTest.value=C.alphaTest)}function x(D,C){D.specular.value.copy(C.specular),D.shininess.value=Math.max(C.shininess,1e-4)}function M(D,C){C.gradientMap&&(D.gradientMap.value=C.gradientMap)}function w(D,C){D.metalness.value=C.metalness,C.metalnessMap&&(D.metalnessMap.value=C.metalnessMap,t(C.metalnessMap,D.metalnessMapTransform)),D.roughness.value=C.roughness,C.roughnessMap&&(D.roughnessMap.value=C.roughnessMap,t(C.roughnessMap,D.roughnessMapTransform)),C.envMap&&(D.envMapIntensity.value=C.envMapIntensity)}function A(D,C,U){D.ior.value=C.ior,C.sheen>0&&(D.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),D.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(D.sheenColorMap.value=C.sheenColorMap,t(C.sheenColorMap,D.sheenColorMapTransform)),C.sheenRoughnessMap&&(D.sheenRoughnessMap.value=C.sheenRoughnessMap,t(C.sheenRoughnessMap,D.sheenRoughnessMapTransform))),C.clearcoat>0&&(D.clearcoat.value=C.clearcoat,D.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(D.clearcoatMap.value=C.clearcoatMap,t(C.clearcoatMap,D.clearcoatMapTransform)),C.clearcoatRoughnessMap&&(D.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap,t(C.clearcoatRoughnessMap,D.clearcoatRoughnessMapTransform)),C.clearcoatNormalMap&&(D.clearcoatNormalMap.value=C.clearcoatNormalMap,t(C.clearcoatNormalMap,D.clearcoatNormalMapTransform),D.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),C.side===$a&&D.clearcoatNormalScale.value.negate())),C.iridescence>0&&(D.iridescence.value=C.iridescence,D.iridescenceIOR.value=C.iridescenceIOR,D.iridescenceThicknessMinimum.value=C.iridescenceThicknessRange[0],D.iridescenceThicknessMaximum.value=C.iridescenceThicknessRange[1],C.iridescenceMap&&(D.iridescenceMap.value=C.iridescenceMap,t(C.iridescenceMap,D.iridescenceMapTransform)),C.iridescenceThicknessMap&&(D.iridescenceThicknessMap.value=C.iridescenceThicknessMap,t(C.iridescenceThicknessMap,D.iridescenceThicknessMapTransform))),C.transmission>0&&(D.transmission.value=C.transmission,D.transmissionSamplerMap.value=U.texture,D.transmissionSamplerSize.value.set(U.width,U.height),C.transmissionMap&&(D.transmissionMap.value=C.transmissionMap,t(C.transmissionMap,D.transmissionMapTransform)),D.thickness.value=C.thickness,C.thicknessMap&&(D.thicknessMap.value=C.thicknessMap,t(C.thicknessMap,D.thicknessMapTransform)),D.attenuationDistance.value=C.attenuationDistance,D.attenuationColor.value.copy(C.attenuationColor)),C.anisotropy>0&&(D.anisotropyVector.value.set(C.anisotropy*Math.cos(C.anisotropyRotation),C.anisotropy*Math.sin(C.anisotropyRotation)),C.anisotropyMap&&(D.anisotropyMap.value=C.anisotropyMap,t(C.anisotropyMap,D.anisotropyMapTransform))),D.specularIntensity.value=C.specularIntensity,D.specularColor.value.copy(C.specularColor),C.specularColorMap&&(D.specularColorMap.value=C.specularColorMap,t(C.specularColorMap,D.specularColorMapTransform)),C.specularIntensityMap&&(D.specularIntensityMap.value=C.specularIntensityMap,t(C.specularIntensityMap,D.specularIntensityMapTransform))}function k(D,C){C.matcap&&(D.matcap.value=C.matcap)}function z(D,C){const U=e.get(C).light;D.referencePosition.value.setFromMatrixPosition(U.matrixWorld),D.nearDistance.value=U.shadow.camera.near,D.farDistance.value=U.shadow.camera.far}return{refreshFogUniforms:r,refreshMaterialUniforms:i}}function Tj(n,e,t,r){let i={},o={},u=[];const l=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function p(U,B){const K=B.program;r.uniformBlockBinding(U,K)}function v(U,B){let K=i[U.id];K===void 0&&(k(U),K=x(U),i[U.id]=K,U.addEventListener("dispose",D));const ue=B.program;r.updateUBOMapping(U,ue);const Z=e.render.frame;o[U.id]!==Z&&(w(U),o[U.id]=Z)}function x(U){const B=M();U.__bindingPointIndex=B;const K=n.createBuffer(),ue=U.__size,Z=U.usage;return n.bindBuffer(n.UNIFORM_BUFFER,K),n.bufferData(n.UNIFORM_BUFFER,ue,Z),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,B,K),K}function M(){for(let U=0;U<l;U++)if(u.indexOf(U)===-1)return u.push(U),U;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function w(U){const B=i[U.id],K=U.uniforms,ue=U.__cache;n.bindBuffer(n.UNIFORM_BUFFER,B);for(let Z=0,ee=K.length;Z<ee;Z++){const be=Array.isArray(K[Z])?K[Z]:[K[Z]];for(let ie=0,Q=be.length;ie<Q;ie++){const Ee=be[ie];if(A(Ee,Z,ie,ue)===!0){const Fe=Ee.__offset,Ae=Array.isArray(Ee.value)?Ee.value:[Ee.value];let Ve=0;for(let lt=0;lt<Ae.length;lt++){const ut=Ae[lt],pt=z(ut);typeof ut=="number"||typeof ut=="boolean"?(Ee.__data[0]=ut,n.bufferSubData(n.UNIFORM_BUFFER,Fe+Ve,Ee.__data)):ut.isMatrix3?(Ee.__data[0]=ut.elements[0],Ee.__data[1]=ut.elements[1],Ee.__data[2]=ut.elements[2],Ee.__data[3]=0,Ee.__data[4]=ut.elements[3],Ee.__data[5]=ut.elements[4],Ee.__data[6]=ut.elements[5],Ee.__data[7]=0,Ee.__data[8]=ut.elements[6],Ee.__data[9]=ut.elements[7],Ee.__data[10]=ut.elements[8],Ee.__data[11]=0):(ut.toArray(Ee.__data,Ve),Ve+=pt.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Fe,Ee.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function A(U,B,K,ue){const Z=U.value,ee=B+"_"+K;if(ue[ee]===void 0)return typeof Z=="number"||typeof Z=="boolean"?ue[ee]=Z:ue[ee]=Z.clone(),!0;{const be=ue[ee];if(typeof Z=="number"||typeof Z=="boolean"){if(be!==Z)return ue[ee]=Z,!0}else if(be.equals(Z)===!1)return be.copy(Z),!0}return!1}function k(U){const B=U.uniforms;let K=0;const ue=16;for(let ee=0,be=B.length;ee<be;ee++){const ie=Array.isArray(B[ee])?B[ee]:[B[ee]];for(let Q=0,Ee=ie.length;Q<Ee;Q++){const Fe=ie[Q],Ae=Array.isArray(Fe.value)?Fe.value:[Fe.value];for(let Ve=0,lt=Ae.length;Ve<lt;Ve++){const ut=Ae[Ve],pt=z(ut),ke=K%ue;ke!==0&&ue-ke<pt.boundary&&(K+=ue-ke),Fe.__data=new Float32Array(pt.storage/Float32Array.BYTES_PER_ELEMENT),Fe.__offset=K,K+=pt.storage}}}const Z=K%ue;return Z>0&&(K+=ue-Z),U.__size=K,U.__cache={},this}function z(U){const B={boundary:0,storage:0};return typeof U=="number"||typeof U=="boolean"?(B.boundary=4,B.storage=4):U.isVector2?(B.boundary=8,B.storage=8):U.isVector3||U.isColor?(B.boundary=16,B.storage=12):U.isVector4?(B.boundary=16,B.storage=16):U.isMatrix3?(B.boundary=48,B.storage=48):U.isMatrix4?(B.boundary=64,B.storage=64):U.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",U),B}function D(U){const B=U.target;B.removeEventListener("dispose",D);const K=u.indexOf(B.__bindingPointIndex);u.splice(K,1),n.deleteBuffer(i[B.id]),delete i[B.id],delete o[B.id]}function C(){for(const U in i)n.deleteBuffer(i[U]);u=[],i={},o={}}return{bind:p,update:v,dispose:C}}class Ej{constructor(e={}){const{canvas:t=gB(),context:r=null,depth:i=!0,stencil:o=!1,alpha:u=!1,antialias:l=!1,premultipliedAlpha:p=!0,preserveDrawingBuffer:v=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:M=!1}=e;this.isWebGLRenderer=!0;let w;if(r!==null){if(typeof WebGLRenderingContext<"u"&&r instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");w=r.getContextAttributes().alpha}else w=u;const A=new Uint32Array(4),k=new Int32Array(4);let z=null,D=null;const C=[],U=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=wo,this._useLegacyLights=!1,this.toneMapping=Vc,this.toneMappingExposure=1;const B=this;let K=!1,ue=0,Z=0,ee=null,be=-1,ie=null;const Q=new Wi,Ee=new Wi;let Fe=null;const Ae=new Tr(0);let Ve=0,lt=t.width,ut=t.height,pt=1,ke=null,Je=null;const tt=new Wi(0,0,lt,ut),_t=new Wi(0,0,lt,ut);let Lt=!1;const Cn=new W7;let nt=!1,wt=!1;const Ft=new Ti,At=new qn,gn=new rt,En={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function In(){return ee===null?pt:1}let je=r;function An(de,Le){const We=t.getContext(de,Le);return We!==null?We:null}try{const de={alpha:!0,depth:i,stencil:o,antialias:l,premultipliedAlpha:p,preserveDrawingBuffer:v,powerPreference:x,failIfMajorPerformanceCaveat:M};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${o4}`),t.addEventListener("webglcontextlost",Be,!1),t.addEventListener("webglcontextrestored",ft,!1),t.addEventListener("webglcontextcreationerror",kt,!1),je===null){const Le="webgl2";if(je=An(Le,de),je===null)throw An(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(de){throw console.error("THREE.WebGLRenderer: "+de.message),de}let yn,Qn,Yt,Gn,re,le,st,it,mt,St,_n,Mt,hn,xn,Nt,an,at,tn,Kt,Bn,Un,dt,Ht,jt;function Jt(){yn=new LH(je),yn.init(),Qn=new AH(je,yn,e),dt=new gj(je,yn),Yt=new pj(je),Gn=new NH(je),re=new ej,le=new mj(je,yn,Yt,re,Qn,dt,Gn),st=new PH(B),it=new kH(B),mt=new HB(je),Ht=new TH(je,mt),St=new zH(je,mt,Gn,Ht),_n=new BH(je,St,mt,Gn),Kt=new OH(je,Qn,le),an=new CH(re),Mt=new QG(B,st,it,yn,Qn,Ht,an),hn=new Mj(B,re),xn=new nj,Nt=new lj(yn),tn=new MH(B,st,it,Yt,_n,w,p),at=new fj(B,_n,Qn),jt=new Tj(je,Gn,Qn,Yt),Bn=new EH(je,yn,Gn),Un=new FH(je,yn,Gn),Gn.programs=Mt.programs,B.capabilities=Qn,B.extensions=yn,B.properties=re,B.renderLists=xn,B.shadowMap=at,B.state=Yt,B.info=Gn}Jt();const X=new wj(B,je);this.xr=X,this.getContext=function(){return je},this.getContextAttributes=function(){return je.getContextAttributes()},this.forceContextLoss=function(){const de=yn.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){const de=yn.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return pt},this.setPixelRatio=function(de){de!==void 0&&(pt=de,this.setSize(lt,ut,!1))},this.getSize=function(de){return de.set(lt,ut)},this.setSize=function(de,Le,We=!0){if(X.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}lt=de,ut=Le,t.width=Math.floor(de*pt),t.height=Math.floor(Le*pt),We===!0&&(t.style.width=de+"px",t.style.height=Le+"px"),this.setViewport(0,0,de,Le)},this.getDrawingBufferSize=function(de){return de.set(lt*pt,ut*pt).floor()},this.setDrawingBufferSize=function(de,Le,We){lt=de,ut=Le,pt=We,t.width=Math.floor(de*We),t.height=Math.floor(Le*We),this.setViewport(0,0,de,Le)},this.getCurrentViewport=function(de){return de.copy(Q)},this.getViewport=function(de){return de.copy(tt)},this.setViewport=function(de,Le,We,Xe){de.isVector4?tt.set(de.x,de.y,de.z,de.w):tt.set(de,Le,We,Xe),Yt.viewport(Q.copy(tt).multiplyScalar(pt).round())},this.getScissor=function(de){return de.copy(_t)},this.setScissor=function(de,Le,We,Xe){de.isVector4?_t.set(de.x,de.y,de.z,de.w):_t.set(de,Le,We,Xe),Yt.scissor(Ee.copy(_t).multiplyScalar(pt).round())},this.getScissorTest=function(){return Lt},this.setScissorTest=function(de){Yt.setScissorTest(Lt=de)},this.setOpaqueSort=function(de){ke=de},this.setTransparentSort=function(de){Je=de},this.getClearColor=function(de){return de.copy(tn.getClearColor())},this.setClearColor=function(){tn.setClearColor.apply(tn,arguments)},this.getClearAlpha=function(){return tn.getClearAlpha()},this.setClearAlpha=function(){tn.setClearAlpha.apply(tn,arguments)},this.clear=function(de=!0,Le=!0,We=!0){let Xe=0;if(de){let Ze=!1;if(ee!==null){const Pt=ee.texture.format;Ze=Pt===R7||Pt===P7||Pt===C7}if(Ze){const Pt=ee.texture.type,rn=Pt===Hc||Pt===df||Pt===M7||Pt===gm||Pt===E7||Pt===A7,It=tn.getClearColor(),Qt=tn.getClearAlpha(),Sn=It.r,Xt=It.g,Fn=It.b;rn?(A[0]=Sn,A[1]=Xt,A[2]=Fn,A[3]=Qt,je.clearBufferuiv(je.COLOR,0,A)):(k[0]=Sn,k[1]=Xt,k[2]=Fn,k[3]=Qt,je.clearBufferiv(je.COLOR,0,k))}else Xe|=je.COLOR_BUFFER_BIT}Le&&(Xe|=je.DEPTH_BUFFER_BIT),We&&(Xe|=je.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),je.clear(Xe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Be,!1),t.removeEventListener("webglcontextrestored",ft,!1),t.removeEventListener("webglcontextcreationerror",kt,!1),xn.dispose(),Nt.dispose(),re.dispose(),st.dispose(),it.dispose(),_n.dispose(),Ht.dispose(),jt.dispose(),Mt.dispose(),X.dispose(),X.removeEventListener("sessionstart",Se),X.removeEventListener("sessionend",Te),ye.stop()};function Be(de){de.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),K=!0}function ft(){console.log("THREE.WebGLRenderer: Context Restored."),K=!1;const de=Gn.autoReset,Le=at.enabled,We=at.autoUpdate,Xe=at.needsUpdate,Ze=at.type;Jt(),Gn.autoReset=de,at.enabled=Le,at.autoUpdate=We,at.needsUpdate=Xe,at.type=Ze}function kt(de){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",de.statusMessage)}function ce(de){const Le=de.target;Le.removeEventListener("dispose",ce),O(Le)}function O(de){V(de),re.remove(de)}function V(de){const Le=re.get(de).programs;Le!==void 0&&(Le.forEach(function(We){Mt.releaseProgram(We)}),de.isShaderMaterial&&Mt.releaseShaderCache(de))}this.renderBufferDirect=function(de,Le,We,Xe,Ze,Pt){Le===null&&(Le=En);const rn=Ze.isMesh&&Ze.matrixWorld.determinant()<0,It=wn(de,Le,We,Xe,Ze);Yt.setMaterial(Xe,rn);let Qt=We.index,Sn=1;if(Xe.wireframe===!0){if(Qt=St.getWireframeAttribute(We),Qt===void 0)return;Sn=2}const Xt=We.drawRange,Fn=We.attributes.position;let Er=Xt.start*Sn,gr=(Xt.start+Xt.count)*Sn;Pt!==null&&(Er=Math.max(Er,Pt.start*Sn),gr=Math.min(gr,(Pt.start+Pt.count)*Sn)),Qt!==null?(Er=Math.max(Er,0),gr=Math.min(gr,Qt.count)):Fn!=null&&(Er=Math.max(Er,0),gr=Math.min(gr,Fn.count));const cr=gr-Er;if(cr<0||cr===1/0)return;Ht.setup(Ze,Xe,It,We,Qt);let Da,Wn=Bn;if(Qt!==null&&(Da=mt.get(Qt),Wn=Un,Wn.setIndex(Da)),Ze.isMesh)Xe.wireframe===!0?(Yt.setLineWidth(Xe.wireframeLinewidth*In()),Wn.setMode(je.LINES)):Wn.setMode(je.TRIANGLES);else if(Ze.isLine){let Pn=Xe.linewidth;Pn===void 0&&(Pn=1),Yt.setLineWidth(Pn*In()),Ze.isLineSegments?Wn.setMode(je.LINES):Ze.isLineLoop?Wn.setMode(je.LINE_LOOP):Wn.setMode(je.LINE_STRIP)}else Ze.isPoints?Wn.setMode(je.POINTS):Ze.isSprite&&Wn.setMode(je.TRIANGLES);if(Ze.isBatchedMesh)Wn.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else if(Ze.isInstancedMesh)Wn.renderInstances(Er,cr,Ze.count);else if(We.isInstancedBufferGeometry){const Pn=We._maxInstanceCount!==void 0?We._maxInstanceCount:1/0,Ol=Math.min(We.instanceCount,Pn);Wn.renderInstances(Er,cr,Ol)}else Wn.render(Er,cr)};function $(de,Le,We){de.transparent===!0&&de.side===Ao&&de.forceSinglePass===!1?(de.side=$a,de.needsUpdate=!0,nn(de,Le,We),de.side=Wc,de.needsUpdate=!0,nn(de,Le,We),de.side=Ao):nn(de,Le,We)}this.compile=function(de,Le,We=null){We===null&&(We=de),D=Nt.get(We),D.init(),U.push(D),We.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Le.layers)&&(D.pushLight(Ze),Ze.castShadow&&D.pushShadow(Ze))}),de!==We&&de.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Le.layers)&&(D.pushLight(Ze),Ze.castShadow&&D.pushShadow(Ze))}),D.setupLights(B._useLegacyLights);const Xe=new Set;return de.traverse(function(Ze){const Pt=Ze.material;if(Pt)if(Array.isArray(Pt))for(let rn=0;rn<Pt.length;rn++){const It=Pt[rn];$(It,We,Ze),Xe.add(It)}else $(Pt,We,Ze),Xe.add(Pt)}),U.pop(),D=null,Xe},this.compileAsync=function(de,Le,We=null){const Xe=this.compile(de,Le,We);return new Promise(Ze=>{function Pt(){if(Xe.forEach(function(rn){re.get(rn).currentProgram.isReady()&&Xe.delete(rn)}),Xe.size===0){Ze(de);return}setTimeout(Pt,10)}yn.get("KHR_parallel_shader_compile")!==null?Pt():setTimeout(Pt,10)})};let ne=null;function me(de){ne&&ne(de)}function Se(){ye.stop()}function Te(){ye.start()}const ye=new $7;ye.setAnimationLoop(me),typeof self<"u"&&ye.setContext(self),this.setAnimationLoop=function(de){ne=de,X.setAnimationLoop(de),de===null?ye.stop():ye.start()},X.addEventListener("sessionstart",Se),X.addEventListener("sessionend",Te),this.render=function(de,Le){if(Le!==void 0&&Le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(K===!0)return;de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),Le.parent===null&&Le.matrixWorldAutoUpdate===!0&&Le.updateMatrixWorld(),X.enabled===!0&&X.isPresenting===!0&&(X.cameraAutoUpdate===!0&&X.updateCamera(Le),Le=X.getCamera()),de.isScene===!0&&de.onBeforeRender(B,de,Le,ee),D=Nt.get(de,U.length),D.init(),U.push(D),Ft.multiplyMatrices(Le.projectionMatrix,Le.matrixWorldInverse),Cn.setFromProjectionMatrix(Ft),wt=this.localClippingEnabled,nt=an.init(this.clippingPlanes,wt),z=xn.get(de,C.length),z.init(),C.push(z),Re(de,Le,0,B.sortObjects),z.finish(),B.sortObjects===!0&&z.sort(ke,Je),this.info.render.frame++,nt===!0&&an.beginShadows();const We=D.state.shadowsArray;if(at.render(We,de,Le),nt===!0&&an.endShadows(),this.info.autoReset===!0&&this.info.reset(),(X.enabled===!1||X.isPresenting===!1||X.hasDepthSensing()===!1)&&tn.render(z,de),D.setupLights(B._useLegacyLights),Le.isArrayCamera){const Xe=Le.cameras;for(let Ze=0,Pt=Xe.length;Ze<Pt;Ze++){const rn=Xe[Ze];$e(z,de,rn,rn.viewport)}}else $e(z,de,Le);ee!==null&&(le.updateMultisampleRenderTarget(ee),le.updateRenderTargetMipmap(ee)),de.isScene===!0&&de.onAfterRender(B,de,Le),Ht.resetDefaultState(),be=-1,ie=null,U.pop(),U.length>0?D=U[U.length-1]:D=null,C.pop(),C.length>0?z=C[C.length-1]:z=null};function Re(de,Le,We,Xe){if(de.visible===!1)return;if(de.layers.test(Le.layers)){if(de.isGroup)We=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(Le);else if(de.isLight)D.pushLight(de),de.castShadow&&D.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||Cn.intersectsSprite(de)){Xe&&gn.setFromMatrixPosition(de.matrixWorld).applyMatrix4(Ft);const rn=_n.update(de),It=de.material;It.visible&&z.push(de,rn,It,We,gn.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(!de.frustumCulled||Cn.intersectsObject(de))){const rn=_n.update(de),It=de.material;if(Xe&&(de.boundingSphere!==void 0?(de.boundingSphere===null&&de.computeBoundingSphere(),gn.copy(de.boundingSphere.center)):(rn.boundingSphere===null&&rn.computeBoundingSphere(),gn.copy(rn.boundingSphere.center)),gn.applyMatrix4(de.matrixWorld).applyMatrix4(Ft)),Array.isArray(It)){const Qt=rn.groups;for(let Sn=0,Xt=Qt.length;Sn<Xt;Sn++){const Fn=Qt[Sn],Er=It[Fn.materialIndex];Er&&Er.visible&&z.push(de,rn,Er,We,gn.z,Fn)}}else It.visible&&z.push(de,rn,It,We,gn.z,null)}}const Pt=de.children;for(let rn=0,It=Pt.length;rn<It;rn++)Re(Pt[rn],Le,We,Xe)}function $e(de,Le,We,Xe){const Ze=de.opaque,Pt=de.transmissive,rn=de.transparent;D.setupLightsView(We),nt===!0&&an.setGlobalState(B.clippingPlanes,We),Pt.length>0&&Ye(Ze,Pt,Le,We),Xe&&Yt.viewport(Q.copy(Xe)),Ze.length>0&&Ge(Ze,Le,We),Pt.length>0&&Ge(Pt,Le,We),rn.length>0&&Ge(rn,Le,We),Yt.buffers.depth.setTest(!0),Yt.buffers.depth.setMask(!0),Yt.buffers.color.setMask(!0),Yt.setPolygonOffset(!1)}function Ye(de,Le,We,Xe){if((We.isScene===!0?We.overrideMaterial:null)!==null)return;if(D.state.transmissionRenderTarget===null){D.state.transmissionRenderTarget=new rh(1,1,{generateMipmaps:!0,type:yn.has("EXT_color_buffer_half_float")||yn.has("EXT_color_buffer_float")?Cy:Hc,minFilter:Wu,samples:4,stencilBuffer:o});const Sn=re.get(D.state.transmissionRenderTarget);Sn.__isTransmissionRenderTarget=!0}const Pt=D.state.transmissionRenderTarget;B.getDrawingBufferSize(At),Pt.setSize(At.x,At.y);const rn=B.getRenderTarget();B.setRenderTarget(Pt),B.getClearColor(Ae),Ve=B.getClearAlpha(),Ve<1&&B.setClearColor(16777215,.5),B.clear();const It=B.toneMapping;B.toneMapping=Vc,Ge(de,We,Xe),le.updateMultisampleRenderTarget(Pt),le.updateRenderTargetMipmap(Pt);let Qt=!1;for(let Sn=0,Xt=Le.length;Sn<Xt;Sn++){const Fn=Le[Sn],Er=Fn.object,gr=Fn.geometry,cr=Fn.material,Da=Fn.group;if(cr.side===Ao&&Er.layers.test(Xe.layers)){const Wn=cr.side;cr.side=$a,cr.needsUpdate=!0,Ct(Er,We,Xe,gr,cr,Da),cr.side=Wn,cr.needsUpdate=!0,Qt=!0}}Qt===!0&&(le.updateMultisampleRenderTarget(Pt),le.updateRenderTargetMipmap(Pt)),B.setRenderTarget(rn),B.setClearColor(Ae,Ve),B.toneMapping=It}function Ge(de,Le,We){const Xe=Le.isScene===!0?Le.overrideMaterial:null;for(let Ze=0,Pt=de.length;Ze<Pt;Ze++){const rn=de[Ze],It=rn.object,Qt=rn.geometry,Sn=Xe===null?rn.material:Xe,Xt=rn.group;It.layers.test(We.layers)&&Ct(It,Le,We,Qt,Sn,Xt)}}function Ct(de,Le,We,Xe,Ze,Pt){de.onBeforeRender(B,Le,We,Xe,Ze,Pt),de.modelViewMatrix.multiplyMatrices(We.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),Ze.onBeforeRender(B,Le,We,Xe,de,Pt),Ze.transparent===!0&&Ze.side===Ao&&Ze.forceSinglePass===!1?(Ze.side=$a,Ze.needsUpdate=!0,B.renderBufferDirect(We,Le,Xe,Ze,de,Pt),Ze.side=Wc,Ze.needsUpdate=!0,B.renderBufferDirect(We,Le,Xe,Ze,de,Pt),Ze.side=Ao):B.renderBufferDirect(We,Le,Xe,Ze,de,Pt),de.onAfterRender(B,Le,We,Xe,Ze,Pt)}function nn(de,Le,We){Le.isScene!==!0&&(Le=En);const Xe=re.get(de),Ze=D.state.lights,Pt=D.state.shadowsArray,rn=Ze.state.version,It=Mt.getParameters(de,Ze.state,Pt,Le,We),Qt=Mt.getProgramCacheKey(It);let Sn=Xe.programs;Xe.environment=de.isMeshStandardMaterial?Le.environment:null,Xe.fog=Le.fog,Xe.envMap=(de.isMeshStandardMaterial?it:st).get(de.envMap||Xe.environment),Xe.envMapRotation=Xe.environment!==null&&de.envMap===null?Le.environmentRotation:de.envMapRotation,Sn===void 0&&(de.addEventListener("dispose",ce),Sn=new Map,Xe.programs=Sn);let Xt=Sn.get(Qt);if(Xt!==void 0){if(Xe.currentProgram===Xt&&Xe.lightsStateVersion===rn)return bn(de,It),Xt}else It.uniforms=Mt.getUniforms(de),de.onBuild(We,It,B),de.onBeforeCompile(It,B),Xt=Mt.acquireProgram(It,Qt),Sn.set(Qt,Xt),Xe.uniforms=It.uniforms;const Fn=Xe.uniforms;return(!de.isShaderMaterial&&!de.isRawShaderMaterial||de.clipping===!0)&&(Fn.clippingPlanes=an.uniform),bn(de,It),Xe.needsLights=er(de),Xe.lightsStateVersion=rn,Xe.needsLights&&(Fn.ambientLightColor.value=Ze.state.ambient,Fn.lightProbe.value=Ze.state.probe,Fn.directionalLights.value=Ze.state.directional,Fn.directionalLightShadows.value=Ze.state.directionalShadow,Fn.spotLights.value=Ze.state.spot,Fn.spotLightShadows.value=Ze.state.spotShadow,Fn.rectAreaLights.value=Ze.state.rectArea,Fn.ltc_1.value=Ze.state.rectAreaLTC1,Fn.ltc_2.value=Ze.state.rectAreaLTC2,Fn.pointLights.value=Ze.state.point,Fn.pointLightShadows.value=Ze.state.pointShadow,Fn.hemisphereLights.value=Ze.state.hemi,Fn.directionalShadowMap.value=Ze.state.directionalShadowMap,Fn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Fn.spotShadowMap.value=Ze.state.spotShadowMap,Fn.spotLightMatrix.value=Ze.state.spotLightMatrix,Fn.spotLightMap.value=Ze.state.spotLightMap,Fn.pointShadowMap.value=Ze.state.pointShadowMap,Fn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),Xe.currentProgram=Xt,Xe.uniformsList=null,Xt}function on(de){if(de.uniformsList===null){const Le=de.currentProgram.getUniforms();de.uniformsList=X1.seqWithValue(Le.seq,de.uniforms)}return de.uniformsList}function bn(de,Le){const We=re.get(de);We.outputColorSpace=Le.outputColorSpace,We.batching=Le.batching,We.instancing=Le.instancing,We.instancingColor=Le.instancingColor,We.instancingMorph=Le.instancingMorph,We.skinning=Le.skinning,We.morphTargets=Le.morphTargets,We.morphNormals=Le.morphNormals,We.morphColors=Le.morphColors,We.morphTargetsCount=Le.morphTargetsCount,We.numClippingPlanes=Le.numClippingPlanes,We.numIntersection=Le.numClipIntersection,We.vertexAlphas=Le.vertexAlphas,We.vertexTangents=Le.vertexTangents,We.toneMapping=Le.toneMapping}function wn(de,Le,We,Xe,Ze){Le.isScene!==!0&&(Le=En),le.resetTextureUnits();const Pt=Le.fog,rn=Xe.isMeshStandardMaterial?Le.environment:null,It=ee===null?B.outputColorSpace:ee.isXRRenderTarget===!0?ee.texture.colorSpace:eu,Qt=(Xe.isMeshStandardMaterial?it:st).get(Xe.envMap||rn),Sn=Xe.vertexColors===!0&&!!We.attributes.color&&We.attributes.color.itemSize===4,Xt=!!We.attributes.tangent&&(!!Xe.normalMap||Xe.anisotropy>0),Fn=!!We.morphAttributes.position,Er=!!We.morphAttributes.normal,gr=!!We.morphAttributes.color;let cr=Vc;Xe.toneMapped&&(ee===null||ee.isXRRenderTarget===!0)&&(cr=B.toneMapping);const Da=We.morphAttributes.position||We.morphAttributes.normal||We.morphAttributes.color,Wn=Da!==void 0?Da.length:0,Pn=re.get(Xe),Ol=D.state.lights;if(nt===!0&&(wt===!0||de!==ie)){const Lr=de===ie&&Xe.id===be;an.setState(Xe,de,Lr)}let or=!1;Xe.version===Pn.__version?(Pn.needsLights&&Pn.lightsStateVersion!==Ol.state.version||Pn.outputColorSpace!==It||Ze.isBatchedMesh&&Pn.batching===!1||!Ze.isBatchedMesh&&Pn.batching===!0||Ze.isInstancedMesh&&Pn.instancing===!1||!Ze.isInstancedMesh&&Pn.instancing===!0||Ze.isSkinnedMesh&&Pn.skinning===!1||!Ze.isSkinnedMesh&&Pn.skinning===!0||Ze.isInstancedMesh&&Pn.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&Pn.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&Pn.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&Pn.instancingMorph===!1&&Ze.morphTexture!==null||Pn.envMap!==Qt||Xe.fog===!0&&Pn.fog!==Pt||Pn.numClippingPlanes!==void 0&&(Pn.numClippingPlanes!==an.numPlanes||Pn.numIntersection!==an.numIntersection)||Pn.vertexAlphas!==Sn||Pn.vertexTangents!==Xt||Pn.morphTargets!==Fn||Pn.morphNormals!==Er||Pn.morphColors!==gr||Pn.toneMapping!==cr||Pn.morphTargetsCount!==Wn)&&(or=!0):(or=!0,Pn.__version=Xe.version);let fr=Pn.currentProgram;or===!0&&(fr=nn(Xe,Le,Ze));let uo=!1,da=!1,xr=!1;const Rr=fr.getUniforms(),Jr=Pn.uniforms;if(Yt.useProgram(fr.program)&&(uo=!0,da=!0,xr=!0),Xe.id!==be&&(be=Xe.id,da=!0),uo||ie!==de){Rr.setValue(je,"projectionMatrix",de.projectionMatrix),Rr.setValue(je,"viewMatrix",de.matrixWorldInverse);const Lr=Rr.map.cameraPosition;Lr!==void 0&&Lr.setValue(je,gn.setFromMatrixPosition(de.matrixWorld)),Qn.logarithmicDepthBuffer&&Rr.setValue(je,"logDepthBufFC",2/(Math.log(de.far+1)/Math.LN2)),(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial)&&Rr.setValue(je,"isOrthographic",de.isOrthographicCamera===!0),ie!==de&&(ie=de,da=!0,xr=!0)}if(Ze.isSkinnedMesh){Rr.setOptional(je,Ze,"bindMatrix"),Rr.setOptional(je,Ze,"bindMatrixInverse");const Lr=Ze.skeleton;Lr&&(Lr.boneTexture===null&&Lr.computeBoneTexture(),Rr.setValue(je,"boneTexture",Lr.boneTexture,le))}Ze.isBatchedMesh&&(Rr.setOptional(je,Ze,"batchingTexture"),Rr.setValue(je,"batchingTexture",Ze._matricesTexture,le));const ho=We.morphAttributes;if((ho.position!==void 0||ho.normal!==void 0||ho.color!==void 0)&&Kt.update(Ze,We,fr),(da||Pn.receiveShadow!==Ze.receiveShadow)&&(Pn.receiveShadow=Ze.receiveShadow,Rr.setValue(je,"receiveShadow",Ze.receiveShadow)),Xe.isMeshGouraudMaterial&&Xe.envMap!==null&&(Jr.envMap.value=Qt,Jr.flipEnvMap.value=Qt.isCubeTexture&&Qt.isRenderTargetTexture===!1?-1:1),Xe.isMeshStandardMaterial&&Xe.envMap===null&&Le.environment!==null&&(Jr.envMapIntensity.value=Le.environmentIntensity),da&&(Rr.setValue(je,"toneMappingExposure",B.toneMappingExposure),Pn.needsLights&&lr(Jr,xr),Pt&&Xe.fog===!0&&hn.refreshFogUniforms(Jr,Pt),hn.refreshMaterialUniforms(Jr,Xe,pt,ut,D.state.transmissionRenderTarget),X1.upload(je,on(Pn),Jr,le)),Xe.isShaderMaterial&&Xe.uniformsNeedUpdate===!0&&(X1.upload(je,on(Pn),Jr,le),Xe.uniformsNeedUpdate=!1),Xe.isSpriteMaterial&&Rr.setValue(je,"center",Ze.center),Rr.setValue(je,"modelViewMatrix",Ze.modelViewMatrix),Rr.setValue(je,"normalMatrix",Ze.normalMatrix),Rr.setValue(je,"modelMatrix",Ze.matrixWorld),Xe.isShaderMaterial||Xe.isRawShaderMaterial){const Lr=Xe.uniformsGroups;for(let Ho=0,fo=Lr.length;Ho<fo;Ho++){const rr=Lr[Ho];jt.update(rr,fr),jt.bind(rr,fr)}}return fr}function lr(de,Le){de.ambientLightColor.needsUpdate=Le,de.lightProbe.needsUpdate=Le,de.directionalLights.needsUpdate=Le,de.directionalLightShadows.needsUpdate=Le,de.pointLights.needsUpdate=Le,de.pointLightShadows.needsUpdate=Le,de.spotLights.needsUpdate=Le,de.spotLightShadows.needsUpdate=Le,de.rectAreaLights.needsUpdate=Le,de.hemisphereLights.needsUpdate=Le}function er(de){return de.isMeshLambertMaterial||de.isMeshToonMaterial||de.isMeshPhongMaterial||de.isMeshStandardMaterial||de.isShadowMaterial||de.isShaderMaterial&&de.lights===!0}this.getActiveCubeFace=function(){return ue},this.getActiveMipmapLevel=function(){return Z},this.getRenderTarget=function(){return ee},this.setRenderTargetTextures=function(de,Le,We){re.get(de.texture).__webglTexture=Le,re.get(de.depthTexture).__webglTexture=We;const Xe=re.get(de);Xe.__hasExternalTextures=!0,Xe.__autoAllocateDepthBuffer=We===void 0,Xe.__autoAllocateDepthBuffer||yn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xe.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(de,Le){const We=re.get(de);We.__webglFramebuffer=Le,We.__useDefaultFramebuffer=Le===void 0},this.setRenderTarget=function(de,Le=0,We=0){ee=de,ue=Le,Z=We;let Xe=!0,Ze=null,Pt=!1,rn=!1;if(de){const Qt=re.get(de);Qt.__useDefaultFramebuffer!==void 0?(Yt.bindFramebuffer(je.FRAMEBUFFER,null),Xe=!1):Qt.__webglFramebuffer===void 0?le.setupRenderTarget(de):Qt.__hasExternalTextures&&le.rebindTextures(de,re.get(de.texture).__webglTexture,re.get(de.depthTexture).__webglTexture);const Sn=de.texture;(Sn.isData3DTexture||Sn.isDataArrayTexture||Sn.isCompressedArrayTexture)&&(rn=!0);const Xt=re.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(Array.isArray(Xt[Le])?Ze=Xt[Le][We]:Ze=Xt[Le],Pt=!0):de.samples>0&&le.useMultisampledRTT(de)===!1?Ze=re.get(de).__webglMultisampledFramebuffer:Array.isArray(Xt)?Ze=Xt[We]:Ze=Xt,Q.copy(de.viewport),Ee.copy(de.scissor),Fe=de.scissorTest}else Q.copy(tt).multiplyScalar(pt).floor(),Ee.copy(_t).multiplyScalar(pt).floor(),Fe=Lt;if(Yt.bindFramebuffer(je.FRAMEBUFFER,Ze)&&Xe&&Yt.drawBuffers(de,Ze),Yt.viewport(Q),Yt.scissor(Ee),Yt.setScissorTest(Fe),Pt){const Qt=re.get(de.texture);je.framebufferTexture2D(je.FRAMEBUFFER,je.COLOR_ATTACHMENT0,je.TEXTURE_CUBE_MAP_POSITIVE_X+Le,Qt.__webglTexture,We)}else if(rn){const Qt=re.get(de.texture),Sn=Le||0;je.framebufferTextureLayer(je.FRAMEBUFFER,je.COLOR_ATTACHMENT0,Qt.__webglTexture,We||0,Sn)}be=-1},this.readRenderTargetPixels=function(de,Le,We,Xe,Ze,Pt,rn){if(!(de&&de.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let It=re.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&rn!==void 0&&(It=It[rn]),It){Yt.bindFramebuffer(je.FRAMEBUFFER,It);try{const Qt=de.texture,Sn=Qt.format,Xt=Qt.type;if(Sn!==Ro&&dt.convert(Sn)!==je.getParameter(je.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Fn=Xt===Cy&&(yn.has("EXT_color_buffer_half_float")||yn.has("EXT_color_buffer_float"));if(Xt!==Hc&&dt.convert(Xt)!==je.getParameter(je.IMPLEMENTATION_COLOR_READ_TYPE)&&Xt!==Rc&&!Fn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Le>=0&&Le<=de.width-Xe&&We>=0&&We<=de.height-Ze&&je.readPixels(Le,We,Xe,Ze,dt.convert(Sn),dt.convert(Xt),Pt)}finally{const Qt=ee!==null?re.get(ee).__webglFramebuffer:null;Yt.bindFramebuffer(je.FRAMEBUFFER,Qt)}}},this.copyFramebufferToTexture=function(de,Le,We=0){const Xe=Math.pow(2,-We),Ze=Math.floor(Le.image.width*Xe),Pt=Math.floor(Le.image.height*Xe);le.setTexture2D(Le,0),je.copyTexSubImage2D(je.TEXTURE_2D,We,0,0,de.x,de.y,Ze,Pt),Yt.unbindTexture()},this.copyTextureToTexture=function(de,Le,We,Xe=0){const Ze=Le.image.width,Pt=Le.image.height,rn=dt.convert(We.format),It=dt.convert(We.type);le.setTexture2D(We,0),je.pixelStorei(je.UNPACK_FLIP_Y_WEBGL,We.flipY),je.pixelStorei(je.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),je.pixelStorei(je.UNPACK_ALIGNMENT,We.unpackAlignment),Le.isDataTexture?je.texSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,Ze,Pt,rn,It,Le.image.data):Le.isCompressedTexture?je.compressedTexSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,Le.mipmaps[0].width,Le.mipmaps[0].height,rn,Le.mipmaps[0].data):je.texSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,rn,It,Le.image),Xe===0&&We.generateMipmaps&&je.generateMipmap(je.TEXTURE_2D),Yt.unbindTexture()},this.copyTextureToTexture3D=function(de,Le,We,Xe,Ze=0){const Pt=Math.round(de.max.x-de.min.x),rn=Math.round(de.max.y-de.min.y),It=de.max.z-de.min.z+1,Qt=dt.convert(Xe.format),Sn=dt.convert(Xe.type);let Xt;if(Xe.isData3DTexture)le.setTexture3D(Xe,0),Xt=je.TEXTURE_3D;else if(Xe.isDataArrayTexture||Xe.isCompressedArrayTexture)le.setTexture2DArray(Xe,0),Xt=je.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}je.pixelStorei(je.UNPACK_FLIP_Y_WEBGL,Xe.flipY),je.pixelStorei(je.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),je.pixelStorei(je.UNPACK_ALIGNMENT,Xe.unpackAlignment);const Fn=je.getParameter(je.UNPACK_ROW_LENGTH),Er=je.getParameter(je.UNPACK_IMAGE_HEIGHT),gr=je.getParameter(je.UNPACK_SKIP_PIXELS),cr=je.getParameter(je.UNPACK_SKIP_ROWS),Da=je.getParameter(je.UNPACK_SKIP_IMAGES),Wn=We.isCompressedTexture?We.mipmaps[Ze]:We.image;je.pixelStorei(je.UNPACK_ROW_LENGTH,Wn.width),je.pixelStorei(je.UNPACK_IMAGE_HEIGHT,Wn.height),je.pixelStorei(je.UNPACK_SKIP_PIXELS,de.min.x),je.pixelStorei(je.UNPACK_SKIP_ROWS,de.min.y),je.pixelStorei(je.UNPACK_SKIP_IMAGES,de.min.z),We.isDataTexture||We.isData3DTexture?je.texSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Sn,Wn.data):Xe.isCompressedArrayTexture?je.compressedTexSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Wn.data):je.texSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Sn,Wn),je.pixelStorei(je.UNPACK_ROW_LENGTH,Fn),je.pixelStorei(je.UNPACK_IMAGE_HEIGHT,Er),je.pixelStorei(je.UNPACK_SKIP_PIXELS,gr),je.pixelStorei(je.UNPACK_SKIP_ROWS,cr),je.pixelStorei(je.UNPACK_SKIP_IMAGES,Da),Ze===0&&Xe.generateMipmaps&&je.generateMipmap(Xt),Yt.unbindTexture()},this.initTexture=function(de){de.isCubeTexture?le.setTextureCube(de,0):de.isData3DTexture?le.setTexture3D(de,0):de.isDataArrayTexture||de.isCompressedArrayTexture?le.setTexture2DArray(de,0):le.setTexture2D(de,0),Yt.unbindTexture()},this.resetState=function(){ue=0,Z=0,ee=null,Yt.reset(),Ht.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return bl}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===l4?"display-p3":"srgb",t.unpackColorSpace=Mr.workingColorSpace===Sv?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class Aj extends hs{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new Il,this.environmentIntensity=1,this.environmentRotation=new Il,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class Mp extends tu{constructor(e=1,t=32,r=16,i=0,o=Math.PI*2,u=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:o,thetaStart:u,thetaLength:l},t=Math.max(3,Math.floor(t)),r=Math.max(2,Math.floor(r));const p=Math.min(u+l,Math.PI);let v=0;const x=[],M=new rt,w=new rt,A=[],k=[],z=[],D=[];for(let C=0;C<=r;C++){const U=[],B=C/r;let K=0;C===0&&u===0?K=.5/t:C===r&&p===Math.PI&&(K=-.5/t);for(let ue=0;ue<=t;ue++){const Z=ue/t;M.x=-e*Math.cos(i+Z*o)*Math.sin(u+B*l),M.y=e*Math.cos(u+B*l),M.z=e*Math.sin(i+Z*o)*Math.sin(u+B*l),k.push(M.x,M.y,M.z),w.copy(M).normalize(),z.push(w.x,w.y,w.z),D.push(Z+K,1-B),U.push(v++)}x.push(U)}for(let C=0;C<r;C++)for(let U=0;U<t;U++){const B=x[C][U+1],K=x[C][U],ue=x[C+1][U],Z=x[C+1][U+1];(C!==0||u>0)&&A.push(B,K,Z),(C!==r-1||p<Math.PI)&&A.push(K,ue,Z)}this.setIndex(A),this.setAttribute("position",new zo(k,3)),this.setAttribute("normal",new zo(z,3)),this.setAttribute("uv",new zo(D,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Mp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const OT={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class Cj{constructor(e,t,r){const i=this;let o=!1,u=0,l=0,p;const v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(x){l++,o===!1&&i.onStart!==void 0&&i.onStart(x,u,l),o=!0},this.itemEnd=function(x){u++,i.onProgress!==void 0&&i.onProgress(x,u,l),u===l&&(o=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(x){i.onError!==void 0&&i.onError(x)},this.resolveURL=function(x){return p?p(x):x},this.setURLModifier=function(x){return p=x,this},this.addHandler=function(x,M){return v.push(x,M),this},this.removeHandler=function(x){const M=v.indexOf(x);return M!==-1&&v.splice(M,2),this},this.getHandler=function(x){for(let M=0,w=v.length;M<w;M+=2){const A=v[M],k=v[M+1];if(A.global&&(A.lastIndex=0),A.test(x))return k}return null}}}const Pj=new Cj;class d4{constructor(e){this.manager=e!==void 0?e:Pj,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const r=this;return new Promise(function(i,o){r.load(e,i,t,o)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}d4.DEFAULT_MATERIAL_NAME="__DEFAULT";class Rj extends d4{constructor(e){super(e)}load(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const o=this,u=OT.get(e);if(u!==void 0)return o.manager.itemStart(e),setTimeout(function(){t&&t(u),o.manager.itemEnd(e)},0),u;const l=Kp("img");function p(){x(),OT.add(e,this),t&&t(this),o.manager.itemEnd(e)}function v(M){x(),i&&i(M),o.manager.itemError(e),o.manager.itemEnd(e)}function x(){l.removeEventListener("load",p,!1),l.removeEventListener("error",v,!1)}return l.addEventListener("load",p,!1),l.addEventListener("error",v,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),o.manager.itemStart(e),l.src=e,l}}class Ij extends d4{constructor(e){super(e)}load(e,t,r,i){const o=new Ca,u=new Rj(this.manager);return u.setCrossOrigin(this.crossOrigin),u.setPath(this.path),u.load(e,function(l){o.image=l,o.needsUpdate=!0,t!==void 0&&t(o)},r,i),o}}class BT{constructor(e=1,t=0,r=0){return this.radius=e,this.phi=t,this.theta=r,this}set(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(ua(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:o4}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=o4);const UT={type:"change"},t2={type:"start"},VT={type:"end"},v1=new F7,HT=new Mc,Dj=Math.cos(70*mB.DEG2RAD);class kj extends ch{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new rt,this.cursor=new rt,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:td.ROTATE,MIDDLE:td.DOLLY,RIGHT:td.PAN},this.touches={ONE:nd.ROTATE,TWO:nd.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return l.phi},this.getAzimuthalAngle=function(){return l.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(X){X.addEventListener("keydown",an),this._domElementKeyEvents=X},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",an),this._domElementKeyEvents=null},this.saveState=function(){r.target0.copy(r.target),r.position0.copy(r.object.position),r.zoom0=r.object.zoom},this.reset=function(){r.target.copy(r.target0),r.object.position.copy(r.position0),r.object.zoom=r.zoom0,r.object.updateProjectionMatrix(),r.dispatchEvent(UT),r.update(),o=i.NONE},this.update=function(){const X=new rt,Be=new ih().setFromUnitVectors(e.up,new rt(0,1,0)),ft=Be.clone().invert(),kt=new rt,ce=new ih,O=new rt,V=2*Math.PI;return function(ne=null){const me=r.object.position;X.copy(me).sub(r.target),X.applyQuaternion(Be),l.setFromVector3(X),r.autoRotate&&o===i.NONE&&Fe(Q(ne)),r.enableDamping?(l.theta+=p.theta*r.dampingFactor,l.phi+=p.phi*r.dampingFactor):(l.theta+=p.theta,l.phi+=p.phi);let Se=r.minAzimuthAngle,Te=r.maxAzimuthAngle;isFinite(Se)&&isFinite(Te)&&(Se<-Math.PI?Se+=V:Se>Math.PI&&(Se-=V),Te<-Math.PI?Te+=V:Te>Math.PI&&(Te-=V),Se<=Te?l.theta=Math.max(Se,Math.min(Te,l.theta)):l.theta=l.theta>(Se+Te)/2?Math.max(Se,l.theta):Math.min(Te,l.theta)),l.phi=Math.max(r.minPolarAngle,Math.min(r.maxPolarAngle,l.phi)),l.makeSafe(),r.enableDamping===!0?r.target.addScaledVector(x,r.dampingFactor):r.target.add(x),r.target.sub(r.cursor),r.target.clampLength(r.minTargetRadius,r.maxTargetRadius),r.target.add(r.cursor);let ye=!1;if(r.zoomToCursor&&Z||r.object.isOrthographicCamera)l.radius=tt(l.radius);else{const Re=l.radius;l.radius=tt(l.radius*v),ye=Re!=l.radius}if(X.setFromSpherical(l),X.applyQuaternion(ft),me.copy(r.target).add(X),r.object.lookAt(r.target),r.enableDamping===!0?(p.theta*=1-r.dampingFactor,p.phi*=1-r.dampingFactor,x.multiplyScalar(1-r.dampingFactor)):(p.set(0,0,0),x.set(0,0,0)),r.zoomToCursor&&Z){let Re=null;if(r.object.isPerspectiveCamera){const $e=X.length();Re=tt($e*v);const Ye=$e-Re;r.object.position.addScaledVector(K,Ye),r.object.updateMatrixWorld(),ye=!!Ye}else if(r.object.isOrthographicCamera){const $e=new rt(ue.x,ue.y,0);$e.unproject(r.object);const Ye=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/v)),r.object.updateProjectionMatrix(),ye=Ye!==r.object.zoom;const Ge=new rt(ue.x,ue.y,0);Ge.unproject(r.object),r.object.position.sub(Ge).add($e),r.object.updateMatrixWorld(),Re=X.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),r.zoomToCursor=!1;Re!==null&&(this.screenSpacePanning?r.target.set(0,0,-1).transformDirection(r.object.matrix).multiplyScalar(Re).add(r.object.position):(v1.origin.copy(r.object.position),v1.direction.set(0,0,-1).transformDirection(r.object.matrix),Math.abs(r.object.up.dot(v1.direction))<Dj?e.lookAt(r.target):(HT.setFromNormalAndCoplanarPoint(r.object.up,r.target),v1.intersectPlane(HT,r.target))))}else if(r.object.isOrthographicCamera){const Re=r.object.zoom;r.object.zoom=Math.max(r.minZoom,Math.min(r.maxZoom,r.object.zoom/v)),Re!==r.object.zoom&&(r.object.updateProjectionMatrix(),ye=!0)}return v=1,Z=!1,ye||kt.distanceToSquared(r.object.position)>u||8*(1-ce.dot(r.object.quaternion))>u||O.distanceToSquared(r.target)>u?(r.dispatchEvent(UT),kt.copy(r.object.position),ce.copy(r.object.quaternion),O.copy(r.target),!0):!1}}(),this.dispose=function(){r.domElement.removeEventListener("contextmenu",Kt),r.domElement.removeEventListener("pointerdown",st),r.domElement.removeEventListener("pointercancel",mt),r.domElement.removeEventListener("wheel",Mt),r.domElement.removeEventListener("pointermove",it),r.domElement.removeEventListener("pointerup",mt),r.domElement.getRootNode().removeEventListener("keydown",xn,{capture:!0}),r._domElementKeyEvents!==null&&(r._domElementKeyEvents.removeEventListener("keydown",an),r._domElementKeyEvents=null)};const r=this,i={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let o=i.NONE;const u=1e-6,l=new BT,p=new BT;let v=1;const x=new rt,M=new qn,w=new qn,A=new qn,k=new qn,z=new qn,D=new qn,C=new qn,U=new qn,B=new qn,K=new rt,ue=new qn;let Z=!1;const ee=[],be={};let ie=!1;function Q(X){return X!==null?2*Math.PI/60*r.autoRotateSpeed*X:2*Math.PI/60/60*r.autoRotateSpeed}function Ee(X){const Be=Math.abs(X*.01);return Math.pow(.95,r.zoomSpeed*Be)}function Fe(X){p.theta-=X}function Ae(X){p.phi-=X}const Ve=function(){const X=new rt;return function(ft,kt){X.setFromMatrixColumn(kt,0),X.multiplyScalar(-ft),x.add(X)}}(),lt=function(){const X=new rt;return function(ft,kt){r.screenSpacePanning===!0?X.setFromMatrixColumn(kt,1):(X.setFromMatrixColumn(kt,0),X.crossVectors(r.object.up,X)),X.multiplyScalar(ft),x.add(X)}}(),ut=function(){const X=new rt;return function(ft,kt){const ce=r.domElement;if(r.object.isPerspectiveCamera){const O=r.object.position;X.copy(O).sub(r.target);let V=X.length();V*=Math.tan(r.object.fov/2*Math.PI/180),Ve(2*ft*V/ce.clientHeight,r.object.matrix),lt(2*kt*V/ce.clientHeight,r.object.matrix)}else r.object.isOrthographicCamera?(Ve(ft*(r.object.right-r.object.left)/r.object.zoom/ce.clientWidth,r.object.matrix),lt(kt*(r.object.top-r.object.bottom)/r.object.zoom/ce.clientHeight,r.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),r.enablePan=!1)}}();function pt(X){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?v/=X:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function ke(X){r.object.isPerspectiveCamera||r.object.isOrthographicCamera?v*=X:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),r.enableZoom=!1)}function Je(X,Be){if(!r.zoomToCursor)return;Z=!0;const ft=r.domElement.getBoundingClientRect(),kt=X-ft.left,ce=Be-ft.top,O=ft.width,V=ft.height;ue.x=kt/O*2-1,ue.y=-(ce/V)*2+1,K.set(ue.x,ue.y,1).unproject(r.object).sub(r.object.position).normalize()}function tt(X){return Math.max(r.minDistance,Math.min(r.maxDistance,X))}function _t(X){M.set(X.clientX,X.clientY)}function Lt(X){Je(X.clientX,X.clientX),C.set(X.clientX,X.clientY)}function Cn(X){k.set(X.clientX,X.clientY)}function nt(X){w.set(X.clientX,X.clientY),A.subVectors(w,M).multiplyScalar(r.rotateSpeed);const Be=r.domElement;Fe(2*Math.PI*A.x/Be.clientHeight),Ae(2*Math.PI*A.y/Be.clientHeight),M.copy(w),r.update()}function wt(X){U.set(X.clientX,X.clientY),B.subVectors(U,C),B.y>0?pt(Ee(B.y)):B.y<0&&ke(Ee(B.y)),C.copy(U),r.update()}function Ft(X){z.set(X.clientX,X.clientY),D.subVectors(z,k).multiplyScalar(r.panSpeed),ut(D.x,D.y),k.copy(z),r.update()}function At(X){Je(X.clientX,X.clientY),X.deltaY<0?ke(Ee(X.deltaY)):X.deltaY>0&&pt(Ee(X.deltaY)),r.update()}function gn(X){let Be=!1;switch(X.code){case r.keys.UP:X.ctrlKey||X.metaKey||X.shiftKey?Ae(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):ut(0,r.keyPanSpeed),Be=!0;break;case r.keys.BOTTOM:X.ctrlKey||X.metaKey||X.shiftKey?Ae(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):ut(0,-r.keyPanSpeed),Be=!0;break;case r.keys.LEFT:X.ctrlKey||X.metaKey||X.shiftKey?Fe(2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):ut(r.keyPanSpeed,0),Be=!0;break;case r.keys.RIGHT:X.ctrlKey||X.metaKey||X.shiftKey?Fe(-2*Math.PI*r.rotateSpeed/r.domElement.clientHeight):ut(-r.keyPanSpeed,0),Be=!0;break}Be&&(X.preventDefault(),r.update())}function En(X){if(ee.length===1)M.set(X.pageX,X.pageY);else{const Be=jt(X),ft=.5*(X.pageX+Be.x),kt=.5*(X.pageY+Be.y);M.set(ft,kt)}}function In(X){if(ee.length===1)k.set(X.pageX,X.pageY);else{const Be=jt(X),ft=.5*(X.pageX+Be.x),kt=.5*(X.pageY+Be.y);k.set(ft,kt)}}function je(X){const Be=jt(X),ft=X.pageX-Be.x,kt=X.pageY-Be.y,ce=Math.sqrt(ft*ft+kt*kt);C.set(0,ce)}function An(X){r.enableZoom&&je(X),r.enablePan&&In(X)}function yn(X){r.enableZoom&&je(X),r.enableRotate&&En(X)}function Qn(X){if(ee.length==1)w.set(X.pageX,X.pageY);else{const ft=jt(X),kt=.5*(X.pageX+ft.x),ce=.5*(X.pageY+ft.y);w.set(kt,ce)}A.subVectors(w,M).multiplyScalar(r.rotateSpeed);const Be=r.domElement;Fe(2*Math.PI*A.x/Be.clientHeight),Ae(2*Math.PI*A.y/Be.clientHeight),M.copy(w)}function Yt(X){if(ee.length===1)z.set(X.pageX,X.pageY);else{const Be=jt(X),ft=.5*(X.pageX+Be.x),kt=.5*(X.pageY+Be.y);z.set(ft,kt)}D.subVectors(z,k).multiplyScalar(r.panSpeed),ut(D.x,D.y),k.copy(z)}function Gn(X){const Be=jt(X),ft=X.pageX-Be.x,kt=X.pageY-Be.y,ce=Math.sqrt(ft*ft+kt*kt);U.set(0,ce),B.set(0,Math.pow(U.y/C.y,r.zoomSpeed)),pt(B.y),C.copy(U);const O=(X.pageX+Be.x)*.5,V=(X.pageY+Be.y)*.5;Je(O,V)}function re(X){r.enableZoom&&Gn(X),r.enablePan&&Yt(X)}function le(X){r.enableZoom&&Gn(X),r.enableRotate&&Qn(X)}function st(X){r.enabled!==!1&&(ee.length===0&&(r.domElement.setPointerCapture(X.pointerId),r.domElement.addEventListener("pointermove",it),r.domElement.addEventListener("pointerup",mt)),!dt(X)&&(Bn(X),X.pointerType==="touch"?at(X):St(X)))}function it(X){r.enabled!==!1&&(X.pointerType==="touch"?tn(X):_n(X))}function mt(X){switch(Un(X),ee.length){case 0:r.domElement.releasePointerCapture(X.pointerId),r.domElement.removeEventListener("pointermove",it),r.domElement.removeEventListener("pointerup",mt),r.dispatchEvent(VT),o=i.NONE;break;case 1:const Be=ee[0],ft=be[Be];at({pointerId:Be,pageX:ft.x,pageY:ft.y});break}}function St(X){let Be;switch(X.button){case 0:Be=r.mouseButtons.LEFT;break;case 1:Be=r.mouseButtons.MIDDLE;break;case 2:Be=r.mouseButtons.RIGHT;break;default:Be=-1}switch(Be){case td.DOLLY:if(r.enableZoom===!1)return;Lt(X),o=i.DOLLY;break;case td.ROTATE:if(X.ctrlKey||X.metaKey||X.shiftKey){if(r.enablePan===!1)return;Cn(X),o=i.PAN}else{if(r.enableRotate===!1)return;_t(X),o=i.ROTATE}break;case td.PAN:if(X.ctrlKey||X.metaKey||X.shiftKey){if(r.enableRotate===!1)return;_t(X),o=i.ROTATE}else{if(r.enablePan===!1)return;Cn(X),o=i.PAN}break;default:o=i.NONE}o!==i.NONE&&r.dispatchEvent(t2)}function _n(X){switch(o){case i.ROTATE:if(r.enableRotate===!1)return;nt(X);break;case i.DOLLY:if(r.enableZoom===!1)return;wt(X);break;case i.PAN:if(r.enablePan===!1)return;Ft(X);break}}function Mt(X){r.enabled===!1||r.enableZoom===!1||o!==i.NONE||(X.preventDefault(),r.dispatchEvent(t2),At(hn(X)),r.dispatchEvent(VT))}function hn(X){const Be=X.deltaMode,ft={clientX:X.clientX,clientY:X.clientY,deltaY:X.deltaY};switch(Be){case 1:ft.deltaY*=16;break;case 2:ft.deltaY*=100;break}return X.ctrlKey&&!ie&&(ft.deltaY*=10),ft}function xn(X){X.key==="Control"&&(ie=!0,r.domElement.getRootNode().addEventListener("keyup",Nt,{passive:!0,capture:!0}))}function Nt(X){X.key==="Control"&&(ie=!1,r.domElement.getRootNode().removeEventListener("keyup",Nt,{passive:!0,capture:!0}))}function an(X){r.enabled===!1||r.enablePan===!1||gn(X)}function at(X){switch(Ht(X),ee.length){case 1:switch(r.touches.ONE){case nd.ROTATE:if(r.enableRotate===!1)return;En(X),o=i.TOUCH_ROTATE;break;case nd.PAN:if(r.enablePan===!1)return;In(X),o=i.TOUCH_PAN;break;default:o=i.NONE}break;case 2:switch(r.touches.TWO){case nd.DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;An(X),o=i.TOUCH_DOLLY_PAN;break;case nd.DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;yn(X),o=i.TOUCH_DOLLY_ROTATE;break;default:o=i.NONE}break;default:o=i.NONE}o!==i.NONE&&r.dispatchEvent(t2)}function tn(X){switch(Ht(X),o){case i.TOUCH_ROTATE:if(r.enableRotate===!1)return;Qn(X),r.update();break;case i.TOUCH_PAN:if(r.enablePan===!1)return;Yt(X),r.update();break;case i.TOUCH_DOLLY_PAN:if(r.enableZoom===!1&&r.enablePan===!1)return;re(X),r.update();break;case i.TOUCH_DOLLY_ROTATE:if(r.enableZoom===!1&&r.enableRotate===!1)return;le(X),r.update();break;default:o=i.NONE}}function Kt(X){r.enabled!==!1&&X.preventDefault()}function Bn(X){ee.push(X.pointerId)}function Un(X){delete be[X.pointerId];for(let Be=0;Be<ee.length;Be++)if(ee[Be]==X.pointerId){ee.splice(Be,1);return}}function dt(X){for(let Be=0;Be<ee.length;Be++)if(ee[Be]==X.pointerId)return!0;return!1}function Ht(X){let Be=be[X.pointerId];Be===void 0&&(Be=new qn,be[X.pointerId]=Be),Be.set(X.pageX,X.pageY)}function jt(X){const Be=X.pointerId===ee[0]?ee[1]:ee[0];return be[Be]}r.domElement.addEventListener("contextmenu",Kt),r.domElement.addEventListener("pointerdown",st),r.domElement.addEventListener("pointercancel",mt),r.domElement.addEventListener("wheel",Mt,{passive:!1}),r.domElement.getRootNode().addEventListener("keydown",xn,{passive:!0,capture:!0}),this.update()}}const Lj=`uniform float radius;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vPosWorld;
varying vec3 vLightPos;


void main() {
    vec3 sun = vLightPos;

    vec3 pos2sun = sun - vPos;
    float dist2sun = length(pos2sun) / (10.0 * radius);
    dist2sun *= dist2sun * dist2sun;
    float diffuseLightness = 1.0 - dist2sun - 0.2;

    float distanceFromCenter = length(vPosWorld - vec3(0)) / radius;

    float a = 0.0;
    float taperStart = 0.9;
    if (distanceFromCenter > taperStart) {
        float decline = 1.0 / (1.0 - taperStart);
        float offset = distanceFromCenter - taperStart;
        a = offset * decline;
    }
    float alpha = 1.0 - a;

    gl_FragColor = vec4(0.6, 0.7, 0.8, alpha - 0.2);
    gl_FragColor.w *= diffuseLightness;

    if (distanceFromCenter >= 1.0) {
        gl_FragColor = vec4(0);
    }
    // gl_FragColor = vec4(1. - a);
    // gl_FragColor = vec4(1);
    // gl_FragColor = vec4(1. - dist2sun);
}`,zj=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
varying vec3 vPosWorld;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vPosWorld = (modelMatrix * vec4(position, 1)).xyz;  // world-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}
`,Fj=`varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
uniform sampler2D cloudTex;


void main() {
    vec3 lightPos = vLightPos;
    vec3 lightDir = normalize(lightPos - vPos);
    float lightness = dot(lightDir, vNormal);
    vec4 cloudColor = texture(cloudTex, vUv);
    gl_FragColor = cloudColor;
    gl_FragColor.xyz *= lightness;
    // gl_FragColor.w = 1.0;
}
`,Nj=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`,Oj=`uniform sampler2D dayTexture;
uniform sampler2D nightTexture;
uniform sampler2D displacementMap;
uniform sampler2D normalMap;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vLightPos;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    // texture data
    vec3 normalColor = texture(normalMap, vUv).xyz;
    vec3 landColor = texture(dayTexture, vUv).xyz;
    vec3 nightColor = texture(nightTexture, vUv).xyz;

    // derived data
    vec3 sun = vLightPos;
    vec3 normal = normalize(vNormal + normalColor);
    vec3 posToSun = normalize(sun - vPos);
    float diffuseLightness = dot(posToSun, normal) + 0.6;

    // mixing
    landColor = brighten(landColor, diffuseLightness);
    nightColor = brighten(nightColor, 1.0 - diffuseLightness);
    vec3 outColor = mix(nightColor, landColor, diffuseLightness);

    gl_FragColor = vec4(outColor, 1.0);
}`,Bj=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
uniform sampler2D displacementMap;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 heightColor = texture(displacementMap, uv);
  vec3 displacedPosition = position * (1.0 + 0.1 * heightColor.x);
  vec4 newPosCamSpace = modelViewMatrix * vec4(displacedPosition, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}`,Uj=`varying vec2 vUv;           // texture-space
varying vec3 vNormal;       // cam-space
varying vec3 vPos;          // cam-space
varying vec3 vLightPos;     // cam-space
uniform float time;
uniform sampler2D landDistance;
uniform sampler2D heightMap;
uniform sampler2D groundTexture;
uniform sampler2D waterNormal1;
uniform sampler2D waterNormal2;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    float landHeight = 0.5;

    // texture data
    float distFromShore = texture(landDistance, vUv).x;
    vec3 groundColor    = texture(groundTexture, vUv).xyz;
    float height        = texture(heightMap, vUv).x;
    vec3 normal1        = texture(waterNormal1, 2.0 * vUv + vec2(0.01, -0.01) * time).xyz;
    vec3 normal2        = texture(waterNormal2, 4.0 * vUv + vec2(-0.01, 0.01) * time).xyz;

    // derived values
    vec3 normal = normalize(vNormal +  0.1 * normal1 + 0.2 * normal2);
    vec3 pos = vPos;
    vec3 sun = vLightPos;
    vec3 pos2cam = vec3(0) - pos;
    vec3 pos2sun = sun - pos;
    float nScale = dot(normal, pos2sun);
    vec3 sunReflected = 2.0 * nScale * normal - sun;
    vec3 pos2reflection = sunReflected - pos;

    // 1. diffuse
    float sunNormalAlignment = dot(normalize(pos2sun), normal);
    float diffuseLightness = sunNormalAlignment;
    
    // 2. specular
    float m = 0.15;
    float pi = 3.14159265359;
    float specAngle = acos(dot(normalize(pos2cam), normalize(pos2reflection)));
    float specularLightness = exp(-(specAngle / m) * (specAngle / m));
    
    // 3. surf
    float surf = 0.0;
    float maxDistFromShore = 0.2;
    if (distFromShore < maxDistFromShore && height < landHeight) {
        surf = sin(distFromShore * 400.0 + time * 5.0) * (1.0 - distFromShore / maxDistFromShore);
    } 

    // 4. combine
    vec3 outColor = groundColor * 0.5                // night color
                  + groundColor * diffuseLightness   // diffuse sunlit color
                  + vec3(surf)  * 0.2                // surf
                  + vec3(1.0)   * specularLightness; // specular

    gl_FragColor = vec4(outColor, 1.0);

    // if (height >= landHeight) {
    //     gl_FragColor = vec4(0);
    // }
}`,Vj=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`;async function Hj(n){const e=new Ij,t={},r=[];for(const[i,o]of Object.entries(n)){const u=e.loadAsync(o).then(l=>t[i]=l);r.push(u)}return await Promise.all(r),t}class Gj{constructor(e,t){ct(this,"water");ct(this,"sky");ct(this,"earth");ct(this,"renderer");ct(this,"camera");ct(this,"scene");ct(this,"controls");ct(this,"atmosphere");const{stars:r,earthDay:i,earthNight:o,earthNormal:u,earthHeight:l,landDistance:p,waterNormal1:v,waterNormal2:x,clouds:M}=t,w=100,A=new Ej({canvas:e,antialias:!0,failIfMajorPerformanceCaveat:!0}),k=new Aj;k.background=r;const z=new Cs(50,e.clientWidth/e.clientHeight,.1*w,6*w);z.position.set(0,0,-3*w),z.lookAt(k.position);const D=new rt(1e3,0,0),C=new kj(z,e);C.enableZoom=!1;const U=new lp;U.position.set(0,0,0),k.add(U);const B=new cs(new Mp(w,500,250),new Ds({vertexShader:Bj,fragmentShader:Oj,uniforms:{lightPos:{value:D},dayTexture:{value:i},nightTexture:{value:o},normalMap:{value:u},displacementMap:{value:l}}}));U.add(B);const K=new cs(new Mp(w+5,200,100),new Ds({vertexShader:Vj,fragmentShader:Uj,uniforms:{lightPos:{value:D},time:{value:0},groundTexture:{value:i},heightMap:{value:l},landDistance:{value:p},waterNormal1:{value:v},waterNormal2:{value:x}}}));U.add(K);const ue=new cs(new Mp(w+9),new Ds({vertexShader:Nj,fragmentShader:Fj,uniforms:{lightPos:{value:D},cloudTex:{value:M}},transparent:!0,side:Ao}));U.add(ue),ue.renderOrder=.5;const Z=30,ee=new cs(new _m(2*(w+Z),2*(w+Z)),new Ds({fragmentShader:Lj,vertexShader:zj,uniforms:{radius:{value:w+Z},lightPos:{value:D}},transparent:!0}));k.add(ee),ee.renderOrder=.1,this.water=K,this.sky=ue,this.atmosphere=ee,this.earth=U,this.renderer=A,this.camera=z,this.scene=k,this.controls=C}step(e){this.water.material.uniforms.time.value=e.time,this.atmosphere.lookAt(this.camera.position),this.sky.rotateY(.001),this.earth.rotateY(.001),this.renderer.render(this.scene,this.camera),this.controls.update()}destroy(e){const t=r=>{r.dispose();for(const i of Object.keys(r)){const o=r[i];o&&typeof o=="object"&&"minFilter"in o&&o.dispose()}};this.renderer.dispose(),this.scene.traverse(r=>{if(r.isMesh)if(r.geometry.dispose(),r.material.isMaterial)t(r.material);else for(const i of r.material)t(i)})}}class jj{constructor(){ct(this,"destroyed",!1);ct(this,"loop");ct(this,"rp")}async init(e){e.width=e.clientWidth,e.height=e.clientHeight;const{earthDay:t,earthNight:r,earthHeight:i,earthNormal:o,landDistance:u,waterNormal1:l,waterNormal2:p,clouds:v,stars:x}=await Hj({earthDay:"/earth.jpg",earthNight:"/earth_night.jpg",earthHeight:"/earth_height.jpg",earthNormal:"/earth_normal.jpg",landDistance:"/land_distance.jpg",waterNormal1:"/water-normal2.jpg",waterNormal2:"/water-normal3.jpg",clouds:"/earth_clouds.png",stars:"/stars.jpg"});if(l.wrapS=Bd,l.wrapT=Bd,p.wrapS=Bd,p.wrapT=Bd,this.destroyed)return;const M=new Gj(e,{earthDay:t,earthNight:r,earthHeight:i,earthNormal:o,landDistance:u,waterNormal1:l,waterNormal2:p,clouds:v,stars:x});this.loop=new hm(30,w=>{M.step({time:w/1e3})}),this.rp=M}startLoop(){var e;(e=this.loop)==null||e.startLoop()}destroy(){var e,t;(e=this.loop)==null||e.stopLoop(),(t=this.rp)==null||t.destroy(!0),this.destroyed=!0}}function Wj(){const n=yt.useRef(null);return yt.useEffect(()=>{const e=new jj;return n.current&&e.init(n.current).then(()=>e.startLoop()),()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}function $j(){return ge.jsxs(wf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"8rem",background:"linear-gradient(180deg, var(--primary4) 0%, var(--primary3) 100%)"},children:ge.jsx(fv,{heroBackground:ge.jsx(Wj,{}),title:"Resources",subtitle:"Software and media used in creating this site"})}),children:[ge.jsx("h1",{children:"Software"}),ge.jsxs("ul",{children:[ge.jsx("li",{children:"d3-ease"}),ge.jsx("li",{children:"d3-scale"}),ge.jsx("li",{children:"d3-selection"}),ge.jsx("li",{children:"d3-shape"}),ge.jsx("li",{children:"d3-transition"}),ge.jsx("li",{children:"katex"}),ge.jsx("li",{children:"maplibre-gl"}),ge.jsx("li",{children:"react"}),ge.jsx("li",{children:"react-dom"}),ge.jsx("li",{children:"react-router-dom"}),ge.jsx("li",{children:"three"})]}),ge.jsx("h1",{children:"Media"}),ge.jsxs("ul",{children:[ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/de-de/foto/weisse-windmuhle-unter-blauem-und-weissem-himmel-tagsuber-112846/",children:"Photo by musicFactory lehmannsound on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/aerial-photography-of-rocks-beside-body-of-water-3575654/",children:"Photo by Luciann Photography on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/body-of-water-near-green-mountain-931018/",children:"Photo by Oliver Sjstrm on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/close-up-shot-of-a-person-writing-on-a-contract-7841506/",children:"Photo by RDNE Stock project on Pexels"})})]})]})}function Z1(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function qj(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function Q7(n){let e,t,r;n.length!==2?(e=Z1,t=(l,p)=>Z1(n(l),p),r=(l,p)=>n(l)-p):(e=n===Z1||n===qj?n:Xj,t=n,r=n);function i(l,p,v=0,x=l.length){if(v<x){if(e(p,p)!==0)return x;do{const M=v+x>>>1;t(l[M],p)<0?v=M+1:x=M}while(v<x)}return v}function o(l,p,v=0,x=l.length){if(v<x){if(e(p,p)!==0)return x;do{const M=v+x>>>1;t(l[M],p)<=0?v=M+1:x=M}while(v<x)}return v}function u(l,p,v=0,x=l.length){const M=i(l,p,v,x-1);return M>v&&r(l[M-1],p)>-r(l[M],p)?M-1:M}return{left:i,center:u,right:o}}function Xj(){return 0}function Zj(n){return n===null?NaN:+n}const Yj=Q7(Z1),Kj=Yj.right;Q7(Zj).center;const Jj=Math.sqrt(50),Qj=Math.sqrt(10),eW=Math.sqrt(2);function ky(n,e,t){const r=(e-n)/Math.max(0,t),i=Math.floor(Math.log10(r)),o=r/Math.pow(10,i),u=o>=Jj?10:o>=Qj?5:o>=eW?2:1;let l,p,v;return i<0?(v=Math.pow(10,-i)/u,l=Math.round(n*v),p=Math.round(e*v),l/v<n&&++l,p/v>e&&--p,v=-v):(v=Math.pow(10,i)*u,l=Math.round(n/v),p=Math.round(e/v),l*v<n&&++l,p*v>e&&--p),p<l&&.5<=t&&t<2?ky(n,e,t*2):[l,p,v]}function tW(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const r=e<n,[i,o,u]=r?ky(e,n,t):ky(n,e,t);if(!(o>=i))return[];const l=o-i+1,p=new Array(l);if(r)if(u<0)for(let v=0;v<l;++v)p[v]=(o-v)/-u;else for(let v=0;v<l;++v)p[v]=(o-v)*u;else if(u<0)for(let v=0;v<l;++v)p[v]=(i+v)/-u;else for(let v=0;v<l;++v)p[v]=(i+v)*u;return p}function Rb(n,e,t){return e=+e,n=+n,t=+t,ky(n,e,t)[2]}function nW(n,e,t){e=+e,n=+n,t=+t;const r=e<n,i=r?Rb(e,n,t):Rb(n,e,t);return(r?-1:1)*(i<0?1/-i:i)}function rW(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function f4(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function eC(n,e){var t=Object.create(n.prototype);for(var r in e)t[r]=e[r];return t}function xm(){}var Jp=.7,Ly=1/Jp,Jd="\\s*([+-]?\\d+)\\s*",Qp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",Fo="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",iW=/^#([0-9a-f]{3,8})$/,aW=new RegExp(`^rgb\\(${Jd},${Jd},${Jd}\\)$`),sW=new RegExp(`^rgb\\(${Fo},${Fo},${Fo}\\)$`),oW=new RegExp(`^rgba\\(${Jd},${Jd},${Jd},${Qp}\\)$`),lW=new RegExp(`^rgba\\(${Fo},${Fo},${Fo},${Qp}\\)$`),cW=new RegExp(`^hsl\\(${Qp},${Fo},${Fo}\\)$`),uW=new RegExp(`^hsla\\(${Qp},${Fo},${Fo},${Qp}\\)$`),GT={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};f4(xm,ah,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:jT,formatHex:jT,formatHex8:hW,formatHsl:dW,formatRgb:WT,toString:WT});function jT(){return this.rgb().formatHex()}function hW(){return this.rgb().formatHex8()}function dW(){return tC(this).formatHsl()}function WT(){return this.rgb().formatRgb()}function ah(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=iW.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?$T(e):t===3?new Ha(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?_1(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?_1(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=aW.exec(n))?new Ha(e[1],e[2],e[3],1):(e=sW.exec(n))?new Ha(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=oW.exec(n))?_1(e[1],e[2],e[3],e[4]):(e=lW.exec(n))?_1(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=cW.exec(n))?ZT(e[1],e[2]/100,e[3]/100,1):(e=uW.exec(n))?ZT(e[1],e[2]/100,e[3]/100,e[4]):GT.hasOwnProperty(n)?$T(GT[n]):n==="transparent"?new Ha(NaN,NaN,NaN,0):null}function $T(n){return new Ha(n>>16&255,n>>8&255,n&255,1)}function _1(n,e,t,r){return r<=0&&(n=e=t=NaN),new Ha(n,e,t,r)}function fW(n){return n instanceof xm||(n=ah(n)),n?(n=n.rgb(),new Ha(n.r,n.g,n.b,n.opacity)):new Ha}function Ib(n,e,t,r){return arguments.length===1?fW(n):new Ha(n,e,t,r??1)}function Ha(n,e,t,r){this.r=+n,this.g=+e,this.b=+t,this.opacity=+r}f4(Ha,Ib,eC(xm,{brighter(n){return n=n==null?Ly:Math.pow(Ly,n),new Ha(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Jp:Math.pow(Jp,n),new Ha(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new Ha(Zu(this.r),Zu(this.g),Zu(this.b),zy(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qT,formatHex:qT,formatHex8:pW,formatRgb:XT,toString:XT}));function qT(){return`#${$u(this.r)}${$u(this.g)}${$u(this.b)}`}function pW(){return`#${$u(this.r)}${$u(this.g)}${$u(this.b)}${$u((isNaN(this.opacity)?1:this.opacity)*255)}`}function XT(){const n=zy(this.opacity);return`${n===1?"rgb(":"rgba("}${Zu(this.r)}, ${Zu(this.g)}, ${Zu(this.b)}${n===1?")":`, ${n})`}`}function zy(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Zu(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function $u(n){return n=Zu(n),(n<16?"0":"")+n.toString(16)}function ZT(n,e,t,r){return r<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new ao(n,e,t,r)}function tC(n){if(n instanceof ao)return new ao(n.h,n.s,n.l,n.opacity);if(n instanceof xm||(n=ah(n)),!n)return new ao;if(n instanceof ao)return n;n=n.rgb();var e=n.r/255,t=n.g/255,r=n.b/255,i=Math.min(e,t,r),o=Math.max(e,t,r),u=NaN,l=o-i,p=(o+i)/2;return l?(e===o?u=(t-r)/l+(t<r)*6:t===o?u=(r-e)/l+2:u=(e-t)/l+4,l/=p<.5?o+i:2-o-i,u*=60):l=p>0&&p<1?0:u,new ao(u,l,p,n.opacity)}function mW(n,e,t,r){return arguments.length===1?tC(n):new ao(n,e,t,r??1)}function ao(n,e,t,r){this.h=+n,this.s=+e,this.l=+t,this.opacity=+r}f4(ao,mW,eC(xm,{brighter(n){return n=n==null?Ly:Math.pow(Ly,n),new ao(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Jp:Math.pow(Jp,n),new ao(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,r=t+(t<.5?t:1-t)*e,i=2*t-r;return new Ha(n2(n>=240?n-240:n+120,i,r),n2(n,i,r),n2(n<120?n+240:n-120,i,r),this.opacity)},clamp(){return new ao(YT(this.h),x1(this.s),x1(this.l),zy(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=zy(this.opacity);return`${n===1?"hsl(":"hsla("}${YT(this.h)}, ${x1(this.s)*100}%, ${x1(this.l)*100}%${n===1?")":`, ${n})`}`}}));function YT(n){return n=(n||0)%360,n<0?n+360:n}function x1(n){return Math.max(0,Math.min(1,n||0))}function n2(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const p4=n=>()=>n;function gW(n,e){return function(t){return n+t*e}}function yW(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(r){return Math.pow(n+r*e,t)}}function vW(n){return(n=+n)==1?nC:function(e,t){return t-e?yW(e,t,n):p4(isNaN(e)?t:e)}}function nC(n,e){var t=e-n;return t?gW(n,t):p4(isNaN(n)?e:n)}const Fy=function n(e){var t=vW(e);function r(i,o){var u=t((i=Ib(i)).r,(o=Ib(o)).r),l=t(i.g,o.g),p=t(i.b,o.b),v=nC(i.opacity,o.opacity);return function(x){return i.r=u(x),i.g=l(x),i.b=p(x),i.opacity=v(x),i+""}}return r.gamma=n,r}(1);function _W(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,r=e.slice(),i;return function(o){for(i=0;i<t;++i)r[i]=n[i]*(1-o)+e[i]*o;return r}}function xW(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function bW(n,e){var t=e?e.length:0,r=n?Math.min(t,n.length):0,i=new Array(r),o=new Array(t),u;for(u=0;u<r;++u)i[u]=m4(n[u],e[u]);for(;u<t;++u)o[u]=e[u];return function(l){for(u=0;u<r;++u)o[u]=i[u](l);return o}}function wW(n,e){var t=new Date;return n=+n,e=+e,function(r){return t.setTime(n*(1-r)+e*r),t}}function ro(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function SW(n,e){var t={},r={},i;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(i in e)i in n?t[i]=m4(n[i],e[i]):r[i]=e[i];return function(o){for(i in t)r[i]=t[i](o);return r}}var Db=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,r2=new RegExp(Db.source,"g");function MW(n){return function(){return n}}function TW(n){return function(e){return n(e)+""}}function rC(n,e){var t=Db.lastIndex=r2.lastIndex=0,r,i,o,u=-1,l=[],p=[];for(n=n+"",e=e+"";(r=Db.exec(n))&&(i=r2.exec(e));)(o=i.index)>t&&(o=e.slice(t,o),l[u]?l[u]+=o:l[++u]=o),(r=r[0])===(i=i[0])?l[u]?l[u]+=i:l[++u]=i:(l[++u]=null,p.push({i:u,x:ro(r,i)})),t=r2.lastIndex;return t<e.length&&(o=e.slice(t),l[u]?l[u]+=o:l[++u]=o),l.length<2?p[0]?TW(p[0].x):MW(e):(e=p.length,function(v){for(var x=0,M;x<e;++x)l[(M=p[x]).i]=M.x(v);return l.join("")})}function m4(n,e){var t=typeof e,r;return e==null||t==="boolean"?p4(e):(t==="number"?ro:t==="string"?(r=ah(e))?(e=r,Fy):rC:e instanceof ah?Fy:e instanceof Date?wW:xW(e)?_W:Array.isArray(e)?bW:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?SW:ro)(n,e)}function EW(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var KT=180/Math.PI,kb={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function iC(n,e,t,r,i,o){var u,l,p;return(u=Math.sqrt(n*n+e*e))&&(n/=u,e/=u),(p=n*t+e*r)&&(t-=n*p,r-=e*p),(l=Math.sqrt(t*t+r*r))&&(t/=l,r/=l,p/=l),n*r<e*t&&(n=-n,e=-e,p=-p,u=-u),{translateX:i,translateY:o,rotate:Math.atan2(e,n)*KT,skewX:Math.atan(p)*KT,scaleX:u,scaleY:l}}var b1;function AW(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?kb:iC(e.a,e.b,e.c,e.d,e.e,e.f)}function CW(n){return n==null||(b1||(b1=document.createElementNS("http://www.w3.org/2000/svg","g")),b1.setAttribute("transform",n),!(n=b1.transform.baseVal.consolidate()))?kb:(n=n.matrix,iC(n.a,n.b,n.c,n.d,n.e,n.f))}function aC(n,e,t,r){function i(v){return v.length?v.pop()+" ":""}function o(v,x,M,w,A,k){if(v!==M||x!==w){var z=A.push("translate(",null,e,null,t);k.push({i:z-4,x:ro(v,M)},{i:z-2,x:ro(x,w)})}else(M||w)&&A.push("translate("+M+e+w+t)}function u(v,x,M,w){v!==x?(v-x>180?x+=360:x-v>180&&(v+=360),w.push({i:M.push(i(M)+"rotate(",null,r)-2,x:ro(v,x)})):x&&M.push(i(M)+"rotate("+x+r)}function l(v,x,M,w){v!==x?w.push({i:M.push(i(M)+"skewX(",null,r)-2,x:ro(v,x)}):x&&M.push(i(M)+"skewX("+x+r)}function p(v,x,M,w,A,k){if(v!==M||x!==w){var z=A.push(i(A)+"scale(",null,",",null,")");k.push({i:z-4,x:ro(v,M)},{i:z-2,x:ro(x,w)})}else(M!==1||w!==1)&&A.push(i(A)+"scale("+M+","+w+")")}return function(v,x){var M=[],w=[];return v=n(v),x=n(x),o(v.translateX,v.translateY,x.translateX,x.translateY,M,w),u(v.rotate,x.rotate,M,w),l(v.skewX,x.skewX,M,w),p(v.scaleX,v.scaleY,x.scaleX,x.scaleY,M,w),v=x=null,function(A){for(var k=-1,z=w.length,D;++k<z;)M[(D=w[k]).i]=D.x(A);return M.join("")}}}var PW=aC(AW,"px, ","px)","deg)"),RW=aC(CW,", ",")",")");function IW(n){return function(){return n}}function DW(n){return+n}var JT=[0,1];function Vd(n){return n}function Lb(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:IW(isNaN(e)?NaN:.5)}function kW(n,e){var t;return n>e&&(t=n,n=e,e=t),function(r){return Math.max(n,Math.min(e,r))}}function LW(n,e,t){var r=n[0],i=n[1],o=e[0],u=e[1];return i<r?(r=Lb(i,r),o=t(u,o)):(r=Lb(r,i),o=t(o,u)),function(l){return o(r(l))}}function zW(n,e,t){var r=Math.min(n.length,e.length)-1,i=new Array(r),o=new Array(r),u=-1;for(n[r]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++u<r;)i[u]=Lb(n[u],n[u+1]),o[u]=t(e[u],e[u+1]);return function(l){var p=Kj(n,l,1,r)-1;return o[p](i[p](l))}}function FW(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function NW(){var n=JT,e=JT,t=m4,r,i,o,u=Vd,l,p,v;function x(){var w=Math.min(n.length,e.length);return u!==Vd&&(u=kW(n[0],n[w-1])),l=w>2?zW:LW,p=v=null,M}function M(w){return w==null||isNaN(w=+w)?o:(p||(p=l(n.map(r),e,t)))(r(u(w)))}return M.invert=function(w){return u(i((v||(v=l(e,n.map(r),ro)))(w)))},M.domain=function(w){return arguments.length?(n=Array.from(w,DW),x()):n.slice()},M.range=function(w){return arguments.length?(e=Array.from(w),x()):e.slice()},M.rangeRound=function(w){return e=Array.from(w),t=EW,x()},M.clamp=function(w){return arguments.length?(u=w?!0:Vd,x()):u!==Vd},M.interpolate=function(w){return arguments.length?(t=w,x()):t},M.unknown=function(w){return arguments.length?(o=w,M):o},function(w,A){return r=w,i=A,x()}}function OW(){return NW()(Vd,Vd)}function BW(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function Ny(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,r=n.slice(0,t);return[r.length>1?r[0]+r.slice(2):r,+n.slice(t+1)]}function pf(n){return n=Ny(Math.abs(n)),n?n[1]:NaN}function UW(n,e){return function(t,r){for(var i=t.length,o=[],u=0,l=n[0],p=0;i>0&&l>0&&(p+l+1>r&&(l=Math.max(1,r-p)),o.push(t.substring(i-=l,i+l)),!((p+=l+1)>r));)l=n[u=(u+1)%n.length];return o.reverse().join(e)}}function VW(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var HW=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function Oy(n){if(!(e=HW.exec(n)))throw new Error("invalid format: "+n);var e;return new g4({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}Oy.prototype=g4.prototype;function g4(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}g4.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function GW(n){e:for(var e=n.length,t=1,r=-1,i;t<e;++t)switch(n[t]){case".":r=i=t;break;case"0":r===0&&(r=t),i=t;break;default:if(!+n[t])break e;r>0&&(r=0);break}return r>0?n.slice(0,r)+n.slice(i+1):n}var sC;function jW(n,e){var t=Ny(n,e);if(!t)return n+"";var r=t[0],i=t[1],o=i-(sC=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,u=r.length;return o===u?r:o>u?r+new Array(o-u+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+Ny(n,Math.max(0,e+o-1))[0]}function QT(n,e){var t=Ny(n,e);if(!t)return n+"";var r=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}const e6={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:BW,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>QT(n*100,e),r:QT,s:jW,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function t6(n){return n}var n6=Array.prototype.map,r6=["y","z","a","f","p","n","","m","","k","M","G","T","P","E","Z","Y"];function WW(n){var e=n.grouping===void 0||n.thousands===void 0?t6:UW(n6.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",r=n.currency===void 0?"":n.currency[1]+"",i=n.decimal===void 0?".":n.decimal+"",o=n.numerals===void 0?t6:VW(n6.call(n.numerals,String)),u=n.percent===void 0?"%":n.percent+"",l=n.minus===void 0?"":n.minus+"",p=n.nan===void 0?"NaN":n.nan+"";function v(M){M=Oy(M);var w=M.fill,A=M.align,k=M.sign,z=M.symbol,D=M.zero,C=M.width,U=M.comma,B=M.precision,K=M.trim,ue=M.type;ue==="n"?(U=!0,ue="g"):e6[ue]||(B===void 0&&(B=12),K=!0,ue="g"),(D||w==="0"&&A==="=")&&(D=!0,w="0",A="=");var Z=z==="$"?t:z==="#"&&/[boxX]/.test(ue)?"0"+ue.toLowerCase():"",ee=z==="$"?r:/[%p]/.test(ue)?u:"",be=e6[ue],ie=/[defgprs%]/.test(ue);B=B===void 0?6:/[gprs]/.test(ue)?Math.max(1,Math.min(21,B)):Math.max(0,Math.min(20,B));function Q(Ee){var Fe=Z,Ae=ee,Ve,lt,ut;if(ue==="c")Ae=be(Ee)+Ae,Ee="";else{Ee=+Ee;var pt=Ee<0||1/Ee<0;if(Ee=isNaN(Ee)?p:be(Math.abs(Ee),B),K&&(Ee=GW(Ee)),pt&&+Ee==0&&k!=="+"&&(pt=!1),Fe=(pt?k==="("?k:l:k==="-"||k==="("?"":k)+Fe,Ae=(ue==="s"?r6[8+sC/3]:"")+Ae+(pt&&k==="("?")":""),ie){for(Ve=-1,lt=Ee.length;++Ve<lt;)if(ut=Ee.charCodeAt(Ve),48>ut||ut>57){Ae=(ut===46?i+Ee.slice(Ve+1):Ee.slice(Ve))+Ae,Ee=Ee.slice(0,Ve);break}}}U&&!D&&(Ee=e(Ee,1/0));var ke=Fe.length+Ee.length+Ae.length,Je=ke<C?new Array(C-ke+1).join(w):"";switch(U&&D&&(Ee=e(Je+Ee,Je.length?C-Ae.length:1/0),Je=""),A){case"<":Ee=Fe+Ee+Ae+Je;break;case"=":Ee=Fe+Je+Ee+Ae;break;case"^":Ee=Je.slice(0,ke=Je.length>>1)+Fe+Ee+Ae+Je.slice(ke);break;default:Ee=Je+Fe+Ee+Ae;break}return o(Ee)}return Q.toString=function(){return M+""},Q}function x(M,w){var A=v((M=Oy(M),M.type="f",M)),k=Math.max(-8,Math.min(8,Math.floor(pf(w)/3)))*3,z=Math.pow(10,-k),D=r6[8+k/3];return function(C){return A(z*C)+D}}return{format:v,formatPrefix:x}}var w1,oC,lC;$W({thousands:",",grouping:[3],currency:["$",""]});function $W(n){return w1=WW(n),oC=w1.format,lC=w1.formatPrefix,w1}function qW(n){return Math.max(0,-pf(Math.abs(n)))}function XW(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(pf(e)/3)))*3-pf(Math.abs(n)))}function ZW(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,pf(e)-pf(n))+1}function YW(n,e,t,r){var i=nW(n,e,t),o;switch(r=Oy(r??",f"),r.type){case"s":{var u=Math.max(Math.abs(n),Math.abs(e));return r.precision==null&&!isNaN(o=XW(i,u))&&(r.precision=o),lC(r,u)}case"":case"e":case"g":case"p":case"r":{r.precision==null&&!isNaN(o=ZW(i,Math.max(Math.abs(n),Math.abs(e))))&&(r.precision=o-(r.type==="e"));break}case"f":case"%":{r.precision==null&&!isNaN(o=qW(i))&&(r.precision=o-(r.type==="%")*2);break}}return oC(r)}function KW(n){var e=n.domain;return n.ticks=function(t){var r=e();return tW(r[0],r[r.length-1],t??10)},n.tickFormat=function(t,r){var i=e();return YW(i[0],i[i.length-1],t??10,r)},n.nice=function(t){t==null&&(t=10);var r=e(),i=0,o=r.length-1,u=r[i],l=r[o],p,v,x=10;for(l<u&&(v=u,u=l,l=v,v=i,i=o,o=v);x-- >0;){if(v=Rb(u,l,t),v===p)return r[i]=u,r[o]=l,e(r);if(v>0)u=Math.floor(u/v)*v,l=Math.ceil(l/v)*v;else if(v<0)u=Math.ceil(u*v)/v,l=Math.floor(l*v)/v;else break;p=v}return n},n}function em(){var n=OW();return n.copy=function(){return FW(n,em())},rW.apply(n,arguments),KW(n)}var zb="http://www.w3.org/1999/xhtml";const i6={svg:"http://www.w3.org/2000/svg",xhtml:zb,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ev(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),i6.hasOwnProperty(e)?{space:i6[e],local:n}:n}function JW(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===zb&&e.documentElement.namespaceURI===zb?e.createElement(n):e.createElementNS(t,n)}}function QW(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function cC(n){var e=Ev(n);return(e.local?QW:JW)(e)}function e$(){}function y4(n){return n==null?e$:function(){return this.querySelector(n)}}function t$(n){typeof n!="function"&&(n=y4(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var o=e[i],u=o.length,l=r[i]=new Array(u),p,v,x=0;x<u;++x)(p=o[x])&&(v=n.call(p,p.__data__,x,o))&&("__data__"in p&&(v.__data__=p.__data__),l[x]=v);return new fs(r,this._parents)}function n$(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function r$(){return[]}function uC(n){return n==null?r$:function(){return this.querySelectorAll(n)}}function i$(n){return function(){return n$(n.apply(this,arguments))}}function a$(n){typeof n=="function"?n=i$(n):n=uC(n);for(var e=this._groups,t=e.length,r=[],i=[],o=0;o<t;++o)for(var u=e[o],l=u.length,p,v=0;v<l;++v)(p=u[v])&&(r.push(n.call(p,p.__data__,v,u)),i.push(p));return new fs(r,i)}function hC(n){return function(){return this.matches(n)}}function dC(n){return function(e){return e.matches(n)}}var s$=Array.prototype.find;function o$(n){return function(){return s$.call(this.children,n)}}function l$(){return this.firstElementChild}function c$(n){return this.select(n==null?l$:o$(typeof n=="function"?n:dC(n)))}var u$=Array.prototype.filter;function h$(){return Array.from(this.children)}function d$(n){return function(){return u$.call(this.children,n)}}function f$(n){return this.selectAll(n==null?h$:d$(typeof n=="function"?n:dC(n)))}function p$(n){typeof n!="function"&&(n=hC(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var o=e[i],u=o.length,l=r[i]=[],p,v=0;v<u;++v)(p=o[v])&&n.call(p,p.__data__,v,o)&&l.push(p);return new fs(r,this._parents)}function fC(n){return new Array(n.length)}function m$(){return new fs(this._enter||this._groups.map(fC),this._parents)}function By(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}By.prototype={constructor:By,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function g$(n){return function(){return n}}function y$(n,e,t,r,i,o){for(var u=0,l,p=e.length,v=o.length;u<v;++u)(l=e[u])?(l.__data__=o[u],r[u]=l):t[u]=new By(n,o[u]);for(;u<p;++u)(l=e[u])&&(i[u]=l)}function v$(n,e,t,r,i,o,u){var l,p,v=new Map,x=e.length,M=o.length,w=new Array(x),A;for(l=0;l<x;++l)(p=e[l])&&(w[l]=A=u.call(p,p.__data__,l,e)+"",v.has(A)?i[l]=p:v.set(A,p));for(l=0;l<M;++l)A=u.call(n,o[l],l,o)+"",(p=v.get(A))?(r[l]=p,p.__data__=o[l],v.delete(A)):t[l]=new By(n,o[l]);for(l=0;l<x;++l)(p=e[l])&&v.get(w[l])===p&&(i[l]=p)}function _$(n){return n.__data__}function x$(n,e){if(!arguments.length)return Array.from(this,_$);var t=e?v$:y$,r=this._parents,i=this._groups;typeof n!="function"&&(n=g$(n));for(var o=i.length,u=new Array(o),l=new Array(o),p=new Array(o),v=0;v<o;++v){var x=r[v],M=i[v],w=M.length,A=b$(n.call(x,x&&x.__data__,v,r)),k=A.length,z=l[v]=new Array(k),D=u[v]=new Array(k),C=p[v]=new Array(w);t(x,M,z,D,C,A,e);for(var U=0,B=0,K,ue;U<k;++U)if(K=z[U]){for(U>=B&&(B=U+1);!(ue=D[B])&&++B<k;);K._next=ue||null}}return u=new fs(u,r),u._enter=l,u._exit=p,u}function b$(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function w$(){return new fs(this._exit||this._groups.map(fC),this._parents)}function S$(n,e,t){var r=this.enter(),i=this,o=this.exit();return typeof n=="function"?(r=n(r),r&&(r=r.selection())):r=r.append(n+""),e!=null&&(i=e(i),i&&(i=i.selection())),t==null?o.remove():t(o),r&&i?r.merge(i).order():i}function M$(n){for(var e=n.selection?n.selection():n,t=this._groups,r=e._groups,i=t.length,o=r.length,u=Math.min(i,o),l=new Array(i),p=0;p<u;++p)for(var v=t[p],x=r[p],M=v.length,w=l[p]=new Array(M),A,k=0;k<M;++k)(A=v[k]||x[k])&&(w[k]=A);for(;p<i;++p)l[p]=t[p];return new fs(l,this._parents)}function T$(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var r=n[e],i=r.length-1,o=r[i],u;--i>=0;)(u=r[i])&&(o&&u.compareDocumentPosition(o)^4&&o.parentNode.insertBefore(u,o),o=u);return this}function E$(n){n||(n=A$);function e(M,w){return M&&w?n(M.__data__,w.__data__):!M-!w}for(var t=this._groups,r=t.length,i=new Array(r),o=0;o<r;++o){for(var u=t[o],l=u.length,p=i[o]=new Array(l),v,x=0;x<l;++x)(v=u[x])&&(p[x]=v);p.sort(e)}return new fs(i,this._parents).order()}function A$(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function C$(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function P$(){return Array.from(this)}function R$(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,o=r.length;i<o;++i){var u=r[i];if(u)return u}return null}function I$(){let n=0;for(const e of this)++n;return n}function D$(){return!this.node()}function k$(n){for(var e=this._groups,t=0,r=e.length;t<r;++t)for(var i=e[t],o=0,u=i.length,l;o<u;++o)(l=i[o])&&n.call(l,l.__data__,o,i);return this}function L$(n){return function(){this.removeAttribute(n)}}function z$(n){return function(){this.removeAttributeNS(n.space,n.local)}}function F$(n,e){return function(){this.setAttribute(n,e)}}function N$(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function O$(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function B$(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function U$(n,e){var t=Ev(n);if(arguments.length<2){var r=this.node();return t.local?r.getAttributeNS(t.space,t.local):r.getAttribute(t)}return this.each((e==null?t.local?z$:L$:typeof e=="function"?t.local?B$:O$:t.local?N$:F$)(t,e))}function pC(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function V$(n){return function(){this.style.removeProperty(n)}}function H$(n,e,t){return function(){this.style.setProperty(n,e,t)}}function G$(n,e,t){return function(){var r=e.apply(this,arguments);r==null?this.style.removeProperty(n):this.style.setProperty(n,r,t)}}function j$(n,e,t){return arguments.length>1?this.each((e==null?V$:typeof e=="function"?G$:H$)(n,e,t??"")):mf(this.node(),n)}function mf(n,e){return n.style.getPropertyValue(e)||pC(n).getComputedStyle(n,null).getPropertyValue(e)}function W$(n){return function(){delete this[n]}}function $$(n,e){return function(){this[n]=e}}function q$(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function X$(n,e){return arguments.length>1?this.each((e==null?W$:typeof e=="function"?q$:$$)(n,e)):this.node()[n]}function mC(n){return n.trim().split(/^|\s+/)}function v4(n){return n.classList||new gC(n)}function gC(n){this._node=n,this._names=mC(n.getAttribute("class")||"")}gC.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function yC(n,e){for(var t=v4(n),r=-1,i=e.length;++r<i;)t.add(e[r])}function vC(n,e){for(var t=v4(n),r=-1,i=e.length;++r<i;)t.remove(e[r])}function Z$(n){return function(){yC(this,n)}}function Y$(n){return function(){vC(this,n)}}function K$(n,e){return function(){(e.apply(this,arguments)?yC:vC)(this,n)}}function J$(n,e){var t=mC(n+"");if(arguments.length<2){for(var r=v4(this.node()),i=-1,o=t.length;++i<o;)if(!r.contains(t[i]))return!1;return!0}return this.each((typeof e=="function"?K$:e?Z$:Y$)(t,e))}function Q$(){this.textContent=""}function eq(n){return function(){this.textContent=n}}function tq(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function nq(n){return arguments.length?this.each(n==null?Q$:(typeof n=="function"?tq:eq)(n)):this.node().textContent}function rq(){this.innerHTML=""}function iq(n){return function(){this.innerHTML=n}}function aq(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function sq(n){return arguments.length?this.each(n==null?rq:(typeof n=="function"?aq:iq)(n)):this.node().innerHTML}function oq(){this.nextSibling&&this.parentNode.appendChild(this)}function lq(){return this.each(oq)}function cq(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function uq(){return this.each(cq)}function hq(n){var e=typeof n=="function"?n:cC(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function dq(){return null}function fq(n,e){var t=typeof n=="function"?n:cC(n),r=e==null?dq:typeof e=="function"?e:y4(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),r.apply(this,arguments)||null)})}function pq(){var n=this.parentNode;n&&n.removeChild(this)}function mq(){return this.each(pq)}function gq(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function yq(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function vq(n){return this.select(n?yq:gq)}function _q(n){return arguments.length?this.property("__data__",n):this.node().__data__}function xq(n){return function(e){n.call(this,e,this.__data__)}}function bq(n){return n.trim().split(/^|\s+/).map(function(e){var t="",r=e.indexOf(".");return r>=0&&(t=e.slice(r+1),e=e.slice(0,r)),{type:e,name:t}})}function wq(n){return function(){var e=this.__on;if(e){for(var t=0,r=-1,i=e.length,o;t<i;++t)o=e[t],(!n.type||o.type===n.type)&&o.name===n.name?this.removeEventListener(o.type,o.listener,o.options):e[++r]=o;++r?e.length=r:delete this.__on}}}function Sq(n,e,t){return function(){var r=this.__on,i,o=xq(e);if(r){for(var u=0,l=r.length;u<l;++u)if((i=r[u]).type===n.type&&i.name===n.name){this.removeEventListener(i.type,i.listener,i.options),this.addEventListener(i.type,i.listener=o,i.options=t),i.value=e;return}}this.addEventListener(n.type,o,t),i={type:n.type,name:n.name,value:e,listener:o,options:t},r?r.push(i):this.__on=[i]}}function Mq(n,e,t){var r=bq(n+""),i,o=r.length,u;if(arguments.length<2){var l=this.node().__on;if(l){for(var p=0,v=l.length,x;p<v;++p)for(i=0,x=l[p];i<o;++i)if((u=r[i]).type===x.type&&u.name===x.name)return x.value}return}for(l=e?Sq:wq,i=0;i<o;++i)this.each(l(r[i],e,t));return this}function _C(n,e,t){var r=pC(n),i=r.CustomEvent;typeof i=="function"?i=new i(e,t):(i=r.document.createEvent("Event"),t?(i.initEvent(e,t.bubbles,t.cancelable),i.detail=t.detail):i.initEvent(e,!1,!1)),n.dispatchEvent(i)}function Tq(n,e){return function(){return _C(this,n,e)}}function Eq(n,e){return function(){return _C(this,n,e.apply(this,arguments))}}function Aq(n,e){return this.each((typeof e=="function"?Eq:Tq)(n,e))}function*Cq(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var r=n[e],i=0,o=r.length,u;i<o;++i)(u=r[i])&&(yield u)}var xC=[null];function fs(n,e){this._groups=n,this._parents=e}function Tf(){return new fs([[document.documentElement]],xC)}function Pq(){return this}fs.prototype=Tf.prototype={constructor:fs,select:t$,selectAll:a$,selectChild:c$,selectChildren:f$,filter:p$,data:x$,enter:m$,exit:w$,join:S$,merge:M$,selection:Pq,order:T$,sort:E$,call:C$,nodes:P$,node:R$,size:I$,empty:D$,each:k$,attr:U$,style:j$,property:X$,classed:J$,text:nq,html:sq,raise:lq,lower:uq,append:hq,insert:fq,remove:mq,clone:vq,datum:_q,on:Mq,dispatch:Aq,[Symbol.iterator]:Cq};function bC(n){return typeof n=="string"?new fs([[document.querySelector(n)]],[document.documentElement]):new fs([[n]],xC)}function xd(n){return function(){return n}}const Fb=Math.PI,Nb=2*Fb,Fu=1e-6,Rq=Nb-Fu;function wC(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}function Iq(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return wC;const t=10**e;return function(r){this._+=r[0];for(let i=1,o=r.length;i<o;++i)this._+=Math.round(arguments[i]*t)/t+r[i]}}let Dq=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?wC:Iq(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,r,i){this._append`Q${+e},${+t},${this._x1=+r},${this._y1=+i}`}bezierCurveTo(e,t,r,i,o,u){this._append`C${+e},${+t},${+r},${+i},${this._x1=+o},${this._y1=+u}`}arcTo(e,t,r,i,o){if(e=+e,t=+t,r=+r,i=+i,o=+o,o<0)throw new Error(`negative radius: ${o}`);let u=this._x1,l=this._y1,p=r-e,v=i-t,x=u-e,M=l-t,w=x*x+M*M;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(w>Fu)if(!(Math.abs(M*p-v*x)>Fu)||!o)this._append`L${this._x1=e},${this._y1=t}`;else{let A=r-u,k=i-l,z=p*p+v*v,D=A*A+k*k,C=Math.sqrt(z),U=Math.sqrt(w),B=o*Math.tan((Fb-Math.acos((z+w-D)/(2*C*U)))/2),K=B/U,ue=B/C;Math.abs(K-1)>Fu&&this._append`L${e+K*x},${t+K*M}`,this._append`A${o},${o},0,0,${+(M*A>x*k)},${this._x1=e+ue*p},${this._y1=t+ue*v}`}}arc(e,t,r,i,o,u){if(e=+e,t=+t,r=+r,u=!!u,r<0)throw new Error(`negative radius: ${r}`);let l=r*Math.cos(i),p=r*Math.sin(i),v=e+l,x=t+p,M=1^u,w=u?i-o:o-i;this._x1===null?this._append`M${v},${x}`:(Math.abs(this._x1-v)>Fu||Math.abs(this._y1-x)>Fu)&&this._append`L${v},${x}`,r&&(w<0&&(w=w%Nb+Nb),w>Rq?this._append`A${r},${r},0,1,${M},${e-l},${t-p}A${r},${r},0,1,${M},${this._x1=v},${this._y1=x}`:w>Fu&&this._append`A${r},${r},0,${+(w>=Fb)},${M},${this._x1=e+r*Math.cos(o)},${this._y1=t+r*Math.sin(o)}`)}rect(e,t,r,i){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${r=+r}v${+i}h${-r}Z`}toString(){return this._}};function kq(n){let e=3;return n.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const r=Math.floor(t);if(!(r>=0))throw new RangeError(`invalid digits: ${t}`);e=r}return n},()=>new Dq(e)}function Lq(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function SC(n){this._context=n}SC.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function zq(n){return new SC(n)}function Fq(n){return n[0]}function Nq(n){return n[1]}function Oq(n,e){var t=xd(!0),r=null,i=zq,o=null,u=kq(l);n=typeof n=="function"?n:n===void 0?Fq:xd(n),e=typeof e=="function"?e:e===void 0?Nq:xd(e);function l(p){var v,x=(p=Lq(p)).length,M,w=!1,A;for(r==null&&(o=i(A=u())),v=0;v<=x;++v)!(v<x&&t(M=p[v],v,p))===w&&((w=!w)?o.lineStart():o.lineEnd()),w&&o.point(+n(M,v,p),+e(M,v,p));if(A)return o=null,A+""||null}return l.x=function(p){return arguments.length?(n=typeof p=="function"?p:xd(+p),l):n},l.y=function(p){return arguments.length?(e=typeof p=="function"?p:xd(+p),l):e},l.defined=function(p){return arguments.length?(t=typeof p=="function"?p:xd(!!p),l):t},l.curve=function(p){return arguments.length?(i=p,r!=null&&(o=i(r)),l):i},l.context=function(p){return arguments.length?(p==null?r=o=null:o=i(r=p),l):r},l}var Bq={value:()=>{}};function MC(){for(var n=0,e=arguments.length,t={},r;n<e;++n){if(!(r=arguments[n]+"")||r in t||/[\s.]/.test(r))throw new Error("illegal type: "+r);t[r]=[]}return new Y1(t)}function Y1(n){this._=n}function Uq(n,e){return n.trim().split(/^|\s+/).map(function(t){var r="",i=t.indexOf(".");if(i>=0&&(r=t.slice(i+1),t=t.slice(0,i)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:r}})}Y1.prototype=MC.prototype={constructor:Y1,on:function(n,e){var t=this._,r=Uq(n+"",t),i,o=-1,u=r.length;if(arguments.length<2){for(;++o<u;)if((i=(n=r[o]).type)&&(i=Vq(t[i],n.name)))return i;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++o<u;)if(i=(n=r[o]).type)t[i]=a6(t[i],n.name,e);else if(e==null)for(i in t)t[i]=a6(t[i],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new Y1(n)},call:function(n,e){if((i=arguments.length-2)>0)for(var t=new Array(i),r=0,i,o;r<i;++r)t[r]=arguments[r+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(o=this._[n],r=0,i=o.length;r<i;++r)o[r].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var r=this._[n],i=0,o=r.length;i<o;++i)r[i].value.apply(e,t)}};function Vq(n,e){for(var t=0,r=n.length,i;t<r;++t)if((i=n[t]).name===e)return i.value}function a6(n,e,t){for(var r=0,i=n.length;r<i;++r)if(n[r].name===e){n[r]=Bq,n=n.slice(0,r).concat(n.slice(r+1));break}return t!=null&&n.push({name:e,value:t}),n}var gf=0,cp=0,tp=0,TC=1e3,Uy,up,Vy=0,sh=0,Av=0,tm=typeof performance=="object"&&performance.now?performance:Date,EC=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function _4(){return sh||(EC(Hq),sh=tm.now()+Av)}function Hq(){sh=0}function Hy(){this._call=this._time=this._next=null}Hy.prototype=AC.prototype={constructor:Hy,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?_4():+t)+(e==null?0:+e),!this._next&&up!==this&&(up?up._next=this:Uy=this,up=this),this._call=n,this._time=t,Ob()},stop:function(){this._call&&(this._call=null,this._time=1/0,Ob())}};function AC(n,e,t){var r=new Hy;return r.restart(n,e,t),r}function Gq(){_4(),++gf;for(var n=Uy,e;n;)(e=sh-n._time)>=0&&n._call.call(void 0,e),n=n._next;--gf}function s6(){sh=(Vy=tm.now())+Av,gf=cp=0;try{Gq()}finally{gf=0,Wq(),sh=0}}function jq(){var n=tm.now(),e=n-Vy;e>TC&&(Av-=e,Vy=n)}function Wq(){for(var n,e=Uy,t,r=1/0;e;)e._call?(r>e._time&&(r=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:Uy=t);up=n,Ob(r)}function Ob(n){if(!gf){cp&&(cp=clearTimeout(cp));var e=n-sh;e>24?(n<1/0&&(cp=setTimeout(s6,n-tm.now()-Av)),tp&&(tp=clearInterval(tp))):(tp||(Vy=tm.now(),tp=setInterval(jq,TC)),gf=1,EC(s6))}}function o6(n,e,t){var r=new Hy;return e=e==null?0:+e,r.restart(i=>{r.stop(),n(i+e)},e,t),r}var $q=MC("start","end","cancel","interrupt"),qq=[],CC=0,l6=1,Bb=2,K1=3,c6=4,Ub=5,J1=6;function Cv(n,e,t,r,i,o){var u=n.__transition;if(!u)n.__transition={};else if(t in u)return;Xq(n,t,{name:e,index:r,group:i,on:$q,tween:qq,time:o.time,delay:o.delay,duration:o.duration,ease:o.ease,timer:null,state:CC})}function x4(n,e){var t=co(n,e);if(t.state>CC)throw new Error("too late; already scheduled");return t}function Oo(n,e){var t=co(n,e);if(t.state>K1)throw new Error("too late; already running");return t}function co(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function Xq(n,e,t){var r=n.__transition,i;r[e]=t,t.timer=AC(o,0,t.time);function o(v){t.state=l6,t.timer.restart(u,t.delay,t.time),t.delay<=v&&u(v-t.delay)}function u(v){var x,M,w,A;if(t.state!==l6)return p();for(x in r)if(A=r[x],A.name===t.name){if(A.state===K1)return o6(u);A.state===c6?(A.state=J1,A.timer.stop(),A.on.call("interrupt",n,n.__data__,A.index,A.group),delete r[x]):+x<e&&(A.state=J1,A.timer.stop(),A.on.call("cancel",n,n.__data__,A.index,A.group),delete r[x])}if(o6(function(){t.state===K1&&(t.state=c6,t.timer.restart(l,t.delay,t.time),l(v))}),t.state=Bb,t.on.call("start",n,n.__data__,t.index,t.group),t.state===Bb){for(t.state=K1,i=new Array(w=t.tween.length),x=0,M=-1;x<w;++x)(A=t.tween[x].value.call(n,n.__data__,t.index,t.group))&&(i[++M]=A);i.length=M+1}}function l(v){for(var x=v<t.duration?t.ease.call(null,v/t.duration):(t.timer.restart(p),t.state=Ub,1),M=-1,w=i.length;++M<w;)i[M].call(n,x);t.state===Ub&&(t.on.call("end",n,n.__data__,t.index,t.group),p())}function p(){t.state=J1,t.timer.stop(),delete r[e];for(var v in r)return;delete n.__transition}}function Zq(n,e){var t=n.__transition,r,i,o=!0,u;if(t){e=e==null?null:e+"";for(u in t){if((r=t[u]).name!==e){o=!1;continue}i=r.state>Bb&&r.state<Ub,r.state=J1,r.timer.stop(),r.on.call(i?"interrupt":"cancel",n,n.__data__,r.index,r.group),delete t[u]}o&&delete n.__transition}}function Yq(n){return this.each(function(){Zq(this,n)})}function Kq(n,e){var t,r;return function(){var i=Oo(this,n),o=i.tween;if(o!==t){r=t=o;for(var u=0,l=r.length;u<l;++u)if(r[u].name===e){r=r.slice(),r.splice(u,1);break}}i.tween=r}}function Jq(n,e,t){var r,i;if(typeof t!="function")throw new Error;return function(){var o=Oo(this,n),u=o.tween;if(u!==r){i=(r=u).slice();for(var l={name:e,value:t},p=0,v=i.length;p<v;++p)if(i[p].name===e){i[p]=l;break}p===v&&i.push(l)}o.tween=i}}function Qq(n,e){var t=this._id;if(n+="",arguments.length<2){for(var r=co(this.node(),t).tween,i=0,o=r.length,u;i<o;++i)if((u=r[i]).name===n)return u.value;return null}return this.each((e==null?Kq:Jq)(t,n,e))}function b4(n,e,t){var r=n._id;return n.each(function(){var i=Oo(this,r);(i.value||(i.value={}))[e]=t.apply(this,arguments)}),function(i){return co(i,r).value[e]}}function PC(n,e){var t;return(typeof e=="number"?ro:e instanceof ah?Fy:(t=ah(e))?(e=t,Fy):rC)(n,e)}function eX(n){return function(){this.removeAttribute(n)}}function tX(n){return function(){this.removeAttributeNS(n.space,n.local)}}function nX(n,e,t){var r,i=t+"",o;return function(){var u=this.getAttribute(n);return u===i?null:u===r?o:o=e(r=u,t)}}function rX(n,e,t){var r,i=t+"",o;return function(){var u=this.getAttributeNS(n.space,n.local);return u===i?null:u===r?o:o=e(r=u,t)}}function iX(n,e,t){var r,i,o;return function(){var u,l=t(this),p;return l==null?void this.removeAttribute(n):(u=this.getAttribute(n),p=l+"",u===p?null:u===r&&p===i?o:(i=p,o=e(r=u,l)))}}function aX(n,e,t){var r,i,o;return function(){var u,l=t(this),p;return l==null?void this.removeAttributeNS(n.space,n.local):(u=this.getAttributeNS(n.space,n.local),p=l+"",u===p?null:u===r&&p===i?o:(i=p,o=e(r=u,l)))}}function sX(n,e){var t=Ev(n),r=t==="transform"?RW:PC;return this.attrTween(n,typeof e=="function"?(t.local?aX:iX)(t,r,b4(this,"attr."+n,e)):e==null?(t.local?tX:eX)(t):(t.local?rX:nX)(t,r,e))}function oX(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function lX(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function cX(n,e){var t,r;function i(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&lX(n,o)),t}return i._value=e,i}function uX(n,e){var t,r;function i(){var o=e.apply(this,arguments);return o!==r&&(t=(r=o)&&oX(n,o)),t}return i._value=e,i}function hX(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var r=Ev(n);return this.tween(t,(r.local?cX:uX)(r,e))}function dX(n,e){return function(){x4(this,n).delay=+e.apply(this,arguments)}}function fX(n,e){return e=+e,function(){x4(this,n).delay=e}}function pX(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?dX:fX)(e,n)):co(this.node(),e).delay}function mX(n,e){return function(){Oo(this,n).duration=+e.apply(this,arguments)}}function gX(n,e){return e=+e,function(){Oo(this,n).duration=e}}function yX(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?mX:gX)(e,n)):co(this.node(),e).duration}function vX(n,e){if(typeof e!="function")throw new Error;return function(){Oo(this,n).ease=e}}function _X(n){var e=this._id;return arguments.length?this.each(vX(e,n)):co(this.node(),e).ease}function xX(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Oo(this,n).ease=t}}function bX(n){if(typeof n!="function")throw new Error;return this.each(xX(this._id,n))}function wX(n){typeof n!="function"&&(n=hC(n));for(var e=this._groups,t=e.length,r=new Array(t),i=0;i<t;++i)for(var o=e[i],u=o.length,l=r[i]=[],p,v=0;v<u;++v)(p=o[v])&&n.call(p,p.__data__,v,o)&&l.push(p);return new Dl(r,this._parents,this._name,this._id)}function SX(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,r=e.length,i=t.length,o=Math.min(r,i),u=new Array(r),l=0;l<o;++l)for(var p=e[l],v=t[l],x=p.length,M=u[l]=new Array(x),w,A=0;A<x;++A)(w=p[A]||v[A])&&(M[A]=w);for(;l<r;++l)u[l]=e[l];return new Dl(u,this._parents,this._name,this._id)}function MX(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function TX(n,e,t){var r,i,o=MX(e)?x4:Oo;return function(){var u=o(this,n),l=u.on;l!==r&&(i=(r=l).copy()).on(e,t),u.on=i}}function EX(n,e){var t=this._id;return arguments.length<2?co(this.node(),t).on.on(n):this.each(TX(t,n,e))}function AX(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function CX(){return this.on("end.remove",AX(this._id))}function PX(n){var e=this._name,t=this._id;typeof n!="function"&&(n=y4(n));for(var r=this._groups,i=r.length,o=new Array(i),u=0;u<i;++u)for(var l=r[u],p=l.length,v=o[u]=new Array(p),x,M,w=0;w<p;++w)(x=l[w])&&(M=n.call(x,x.__data__,w,l))&&("__data__"in x&&(M.__data__=x.__data__),v[w]=M,Cv(v[w],e,t,w,v,co(x,t)));return new Dl(o,this._parents,e,t)}function RX(n){var e=this._name,t=this._id;typeof n!="function"&&(n=uC(n));for(var r=this._groups,i=r.length,o=[],u=[],l=0;l<i;++l)for(var p=r[l],v=p.length,x,M=0;M<v;++M)if(x=p[M]){for(var w=n.call(x,x.__data__,M,p),A,k=co(x,t),z=0,D=w.length;z<D;++z)(A=w[z])&&Cv(A,e,t,z,w,k);o.push(w),u.push(x)}return new Dl(o,u,e,t)}var IX=Tf.prototype.constructor;function DX(){return new IX(this._groups,this._parents)}function kX(n,e){var t,r,i;return function(){var o=mf(this,n),u=(this.style.removeProperty(n),mf(this,n));return o===u?null:o===t&&u===r?i:i=e(t=o,r=u)}}function RC(n){return function(){this.style.removeProperty(n)}}function LX(n,e,t){var r,i=t+"",o;return function(){var u=mf(this,n);return u===i?null:u===r?o:o=e(r=u,t)}}function zX(n,e,t){var r,i,o;return function(){var u=mf(this,n),l=t(this),p=l+"";return l==null&&(p=l=(this.style.removeProperty(n),mf(this,n))),u===p?null:u===r&&p===i?o:(i=p,o=e(r=u,l))}}function FX(n,e){var t,r,i,o="style."+e,u="end."+o,l;return function(){var p=Oo(this,n),v=p.on,x=p.value[o]==null?l||(l=RC(e)):void 0;(v!==t||i!==x)&&(r=(t=v).copy()).on(u,i=x),p.on=r}}function NX(n,e,t){var r=(n+="")=="transform"?PW:PC;return e==null?this.styleTween(n,kX(n,r)).on("end.style."+n,RC(n)):typeof e=="function"?this.styleTween(n,zX(n,r,b4(this,"style."+n,e))).each(FX(this._id,n)):this.styleTween(n,LX(n,r,e),t).on("end.style."+n,null)}function OX(n,e,t){return function(r){this.style.setProperty(n,e.call(this,r),t)}}function BX(n,e,t){var r,i;function o(){var u=e.apply(this,arguments);return u!==i&&(r=(i=u)&&OX(n,u,t)),r}return o._value=e,o}function UX(n,e,t){var r="style."+(n+="");if(arguments.length<2)return(r=this.tween(r))&&r._value;if(e==null)return this.tween(r,null);if(typeof e!="function")throw new Error;return this.tween(r,BX(n,e,t??""))}function VX(n){return function(){this.textContent=n}}function HX(n){return function(){var e=n(this);this.textContent=e??""}}function GX(n){return this.tween("text",typeof n=="function"?HX(b4(this,"text",n)):VX(n==null?"":n+""))}function jX(n){return function(e){this.textContent=n.call(this,e)}}function WX(n){var e,t;function r(){var i=n.apply(this,arguments);return i!==t&&(e=(t=i)&&jX(i)),e}return r._value=n,r}function $X(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,WX(n))}function qX(){for(var n=this._name,e=this._id,t=IC(),r=this._groups,i=r.length,o=0;o<i;++o)for(var u=r[o],l=u.length,p,v=0;v<l;++v)if(p=u[v]){var x=co(p,e);Cv(p,n,t,v,u,{time:x.time+x.delay+x.duration,delay:0,duration:x.duration,ease:x.ease})}return new Dl(r,this._parents,n,t)}function XX(){var n,e,t=this,r=t._id,i=t.size();return new Promise(function(o,u){var l={value:u},p={value:function(){--i===0&&o()}};t.each(function(){var v=Oo(this,r),x=v.on;x!==n&&(e=(n=x).copy(),e._.cancel.push(l),e._.interrupt.push(l),e._.end.push(p)),v.on=e}),i===0&&o()})}var ZX=0;function Dl(n,e,t,r){this._groups=n,this._parents=e,this._name=t,this._id=r}function Gy(n){return Tf().transition(n)}function IC(){return++ZX}var dl=Tf.prototype;Dl.prototype=Gy.prototype={constructor:Dl,select:PX,selectAll:RX,selectChild:dl.selectChild,selectChildren:dl.selectChildren,filter:wX,merge:SX,selection:DX,transition:qX,call:dl.call,nodes:dl.nodes,node:dl.node,size:dl.size,empty:dl.empty,each:dl.each,on:EX,attr:sX,attrTween:hX,style:NX,styleTween:UX,text:GX,textTween:$X,remove:CX,tween:Qq,delay:pX,duration:yX,ease:_X,easeVarying:bX,end:XX,[Symbol.iterator]:dl[Symbol.iterator]};const u6=n=>+n;function YX(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var KX={time:null,delay:0,duration:250,ease:YX};function JX(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function QX(n){var e,t;n instanceof Dl?(e=n._id,n=n._name):(e=IC(),(t=KX).time=_4(),n=n==null?null:n+"");for(var r=this._groups,i=r.length,o=0;o<i;++o)for(var u=r[o],l=u.length,p,v=0;v<l;++v)(p=u[v])&&Cv(p,n,e,v,u,t||JX(p,e));return new Dl(r,this._parents,n,e)}Tf.prototype.interrupt=Yq;Tf.prototype.transition=QX;class os{constructor(e,t,r){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=r}static range(e,t){return t?!e||!e.loc||!t.loc||e.loc.lexer!==t.loc.lexer?null:new os(e.loc.lexer,e.loc.start,t.loc.end):e&&e.loc}}class zs{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new zs(t,os.range(this,e))}}class Ut{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var r="KaTeX parse error: "+e,i,o,u=t&&t.loc;if(u&&u.start<=u.end){var l=u.lexer.input;i=u.start,o=u.end,i===l.length?r+=" at end of input: ":r+=" at position "+(i+1)+": ";var p=l.slice(i,o).replace(/[^]/g,"$&"),v;i>15?v=""+l.slice(i-15,i):v=l.slice(0,i);var x;o+15<l.length?x=l.slice(o,o+15)+"":x=l.slice(o),r+=v+p+x}var M=new Error(r);return M.name="ParseError",M.__proto__=Ut.prototype,M.position=i,i!=null&&o!=null&&(M.length=o-i),M.rawMessage=e,M}}Ut.prototype.__proto__=Error.prototype;var eZ=function(e,t){return e.indexOf(t)!==-1},tZ=function(e,t){return e===void 0?t:e},nZ=/([A-Z])/g,rZ=function(e){return e.replace(nZ,"-$1").toLowerCase()},iZ={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},aZ=/[&><"']/g;function sZ(n){return String(n).replace(aZ,e=>iZ[e])}var DC=function n(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?n(e.body[0]):e:e.type==="font"?n(e.body):e},oZ=function(e){var t=DC(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},lZ=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},cZ=function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?t[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?null:t[1].toLowerCase():"_relative"},Dn={contains:eZ,deflt:tZ,escape:sZ,hyphenate:rZ,getBaseElem:DC,isCharacterBox:oZ,protocolFromUrl:cZ},Q1={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:n=>"#"+n},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(n,e)=>(e.push(n),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:n=>Math.max(0,n),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:n=>Math.max(0,n),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:n=>Math.max(0,n),cli:"-e, --max-expand <n>",cliProcessor:n=>n==="Infinity"?1/0:parseInt(n)},globalGroup:{type:"boolean",cli:!1}};function uZ(n){if(n.default)return n.default;var e=n.type,t=Array.isArray(e)?e[0]:e;if(typeof t!="string")return t.enum[0];switch(t){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class w4{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var t in Q1)if(Q1.hasOwnProperty(t)){var r=Q1[t];this[t]=e[t]!==void 0?r.processor?r.processor(e[t]):e[t]:uZ(r)}}reportNonstrict(e,t,r){var i=this.strict;if(typeof i=="function"&&(i=i(e,t,r)),!(!i||i==="ignore")){if(i===!0||i==="error")throw new Ut("LaTeX-incompatible input and strict mode is set to 'error': "+(t+" ["+e+"]"),r);i==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+t+" ["+e+"]"))}}useStrictBehavior(e,t,r){var i=this.strict;if(typeof i=="function")try{i=i(e,t,r)}catch{i="error"}return!i||i==="ignore"?!1:i===!0||i==="error"?!0:i==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+i+"': "+t+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var t=Dn.protocolFromUrl(e.url);if(t==null)return!1;e.protocol=t}var r=typeof this.trust=="function"?this.trust(e):this.trust;return!!r}}class vc{constructor(e,t,r){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=r}sup(){return Mo[hZ[this.id]]}sub(){return Mo[dZ[this.id]]}fracNum(){return Mo[fZ[this.id]]}fracDen(){return Mo[pZ[this.id]]}cramp(){return Mo[mZ[this.id]]}text(){return Mo[gZ[this.id]]}isTight(){return this.size>=2}}var S4=0,jy=1,Qd=2,Ml=3,nm=4,ks=5,yf=6,Ea=7,Mo=[new vc(S4,0,!1),new vc(jy,0,!0),new vc(Qd,1,!1),new vc(Ml,1,!0),new vc(nm,2,!1),new vc(ks,2,!0),new vc(yf,3,!1),new vc(Ea,3,!0)],hZ=[nm,ks,nm,ks,yf,Ea,yf,Ea],dZ=[ks,ks,ks,ks,Ea,Ea,Ea,Ea],fZ=[Qd,Ml,nm,ks,yf,Ea,yf,Ea],pZ=[Ml,Ml,ks,ks,Ea,Ea,Ea,Ea],mZ=[jy,jy,Ml,Ml,ks,ks,Ea,Ea],gZ=[S4,jy,Qd,Ml,Qd,Ml,Qd,Ml],Ln={DISPLAY:Mo[S4],TEXT:Mo[Qd],SCRIPT:Mo[nm],SCRIPTSCRIPT:Mo[yf]},Vb=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function yZ(n){for(var e=0;e<Vb.length;e++)for(var t=Vb[e],r=0;r<t.blocks.length;r++){var i=t.blocks[r];if(n>=i[0]&&n<=i[1])return t.name}return null}var ey=[];Vb.forEach(n=>n.blocks.forEach(e=>ey.push(...e)));function kC(n){for(var e=0;e<ey.length;e+=2)if(n>=ey[e]&&n<=ey[e+1])return!0;return!1}var bd=80,vZ=function(e,t){return"M95,"+(622+e+t)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},_Z=function(e,t){return"M263,"+(601+e+t)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},xZ=function(e,t){return"M983 "+(10+e+t)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},bZ=function(e,t){return"M424,"+(2398+e+t)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+t+`
h400000v`+(40+e)+"h-400000z"},wZ=function(e,t){return"M473,"+(2713+e+t)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"},SZ=function(e){var t=e/2;return"M400000 "+e+" H0 L"+t+" 0 l65 45 L145 "+(e-80)+" H400000z"},MZ=function(e,t,r){var i=r-54-t-e;return"M702 "+(e+t)+"H400000"+(40+e)+`
H742v`+i+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+t+"H400000v"+(40+e)+"H742z"},TZ=function(e,t,r){t=1e3*t;var i="";switch(e){case"sqrtMain":i=vZ(t,bd);break;case"sqrtSize1":i=_Z(t,bd);break;case"sqrtSize2":i=xZ(t,bd);break;case"sqrtSize3":i=bZ(t,bd);break;case"sqrtSize4":i=wZ(t,bd);break;case"sqrtTall":i=MZ(t,bd,r)}return i},EZ=function(e,t){switch(e){case"":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z"+("M367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z");case"":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257z"+("M478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z");default:return""}},h6={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},AZ=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+` v585 h43z
M367 15 v585 v`+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v602 h84z
M403 1759 V0 H319 V1759 v`+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v602 h84z
M347 1759 V0 h-84 V1759 v`+t+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(t+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(t+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(t+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(t+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class bm{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return Dn.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){var e=t=>t.toText();return this.children.map(e).join("")}}var Io={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},S1={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},d6={:"A",:"D",:"o",:"a",:"d",:"o",:"A",:"B",:"B",:"F",:"A",:"E",:"K",:"3",:"N",:"N",:"K",:"N",:"M",:"H",:"O",:"N",:"P",:"C",:"T",:"y",:"O",:"X",:"U",:"h",:"W",:"W",:"B",:"X",:"B",:"3",:"X",:"R",:"a",:"b",:"a",:"r",:"y",:"e",:"m",:"e",:"n",:"n",:"n",:"n",:"m",:"n",:"o",:"n",:"p",:"c",:"o",:"y",:"b",:"x",:"n",:"n",:"w",:"w",:"a",:"m",:"a",:"e",:"m",:"r"};function CZ(n,e){Io[n]=e}function M4(n,e,t){if(!Io[e])throw new Error("Font metrics not found for font: "+e+".");var r=n.charCodeAt(0),i=Io[e][r];if(!i&&n[0]in d6&&(r=d6[n[0]].charCodeAt(0),i=Io[e][r]),!i&&t==="text"&&kC(r)&&(i=Io[e][77]),i)return{depth:i[0],height:i[1],italic:i[2],skew:i[3],width:i[4]}}var i2={};function PZ(n){var e;if(n>=5?e=0:n>=3?e=1:e=2,!i2[e]){var t=i2[e]={cssEmPerMu:S1.quad[e]/18};for(var r in S1)S1.hasOwnProperty(r)&&(t[r]=S1[r][e])}return i2[e]}var RZ=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],f6=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],p6=function(e,t){return t.size<2?e:RZ[e-1][t.size-1]};class vl{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||vl.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=f6[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return new vl(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:p6(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:f6[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=p6(vl.BASESIZE,e);return this.size===t&&this.textSize===vl.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==vl.BASESIZE?["sizing","reset-size"+this.size,"size"+vl.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=PZ(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}vl.BASESIZE=6;var Hb={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},IZ={ex:!0,em:!0,mu:!0},LC=function(e){return typeof e!="string"&&(e=e.unit),e in Hb||e in IZ||e==="ex"},Zr=function(e,t){var r;if(e.unit in Hb)r=Hb[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if(e.unit==="mu")r=t.fontMetrics().cssEmPerMu;else{var i;if(t.style.isTight()?i=t.havingStyle(t.style.text()):i=t,e.unit==="ex")r=i.fontMetrics().xHeight;else if(e.unit==="em")r=i.fontMetrics().quad;else throw new Ut("Invalid unit: '"+e.unit+"'");i!==t&&(r*=i.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*r,t.maxSize)},qt=function(e){return+e.toFixed(4)+"em"},$c=function(e){return e.filter(t=>t).join(" ")},zC=function(e,t,r){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=r||{},t){t.style.isTight()&&this.classes.push("mtight");var i=t.getColor();i&&(this.style.color=i)}},FC=function(e){var t=document.createElement(e);t.className=$c(this.classes);for(var r in this.style)this.style.hasOwnProperty(r)&&(t.style[r]=this.style[r]);for(var i in this.attributes)this.attributes.hasOwnProperty(i)&&t.setAttribute(i,this.attributes[i]);for(var o=0;o<this.children.length;o++)t.appendChild(this.children[o].toNode());return t},NC=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+Dn.escape($c(this.classes))+'"');var r="";for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=Dn.hyphenate(i)+":"+this.style[i]+";");r&&(t+=' style="'+Dn.escape(r)+'"');for(var o in this.attributes)this.attributes.hasOwnProperty(o)&&(t+=" "+o+'="'+Dn.escape(this.attributes[o])+'"');t+=">";for(var u=0;u<this.children.length;u++)t+=this.children[u].toMarkup();return t+="</"+e+">",t};class wm{constructor(e,t,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,zC.call(this,e,r,i),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Dn.contains(this.classes,e)}toNode(){return FC.call(this,"span")}toMarkup(){return NC.call(this,"span")}}class T4{constructor(e,t,r,i){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,zC.call(this,t,i),this.children=r||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return Dn.contains(this.classes,e)}toNode(){return FC.call(this,"a")}toMarkup(){return NC.call(this,"a")}}class DZ{constructor(e,t,r){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=r}hasClass(e){return Dn.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var t in this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+Dn.escape(this.src)+'"'+(' alt="'+Dn.escape(this.alt)+'"'),t="";for(var r in this.style)this.style.hasOwnProperty(r)&&(t+=Dn.hyphenate(r)+":"+this.style[r]+";");return t&&(e+=' style="'+Dn.escape(t)+'"'),e+="'/>",e}}var kZ={:"",:"",:"",:""};class Os{constructor(e,t,r,i,o,u,l,p){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=r||0,this.italic=i||0,this.skew=o||0,this.width=u||0,this.classes=l||[],this.style=p||{},this.maxFontSize=0;var v=yZ(this.text.charCodeAt(0));v&&this.classes.push(v+"_fallback"),/[]/.test(this.text)&&(this.text=kZ[this.text])}hasClass(e){return Dn.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;this.italic>0&&(t=document.createElement("span"),t.style.marginRight=qt(this.italic)),this.classes.length>0&&(t=t||document.createElement("span"),t.className=$c(this.classes));for(var r in this.style)this.style.hasOwnProperty(r)&&(t=t||document.createElement("span"),t.style[r]=this.style[r]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=Dn.escape($c(this.classes)),t+='"');var r="";this.italic>0&&(r+="margin-right:"+this.italic+"em;");for(var i in this.style)this.style.hasOwnProperty(i)&&(r+=Dn.hyphenate(i)+":"+this.style[i]+";");r&&(e=!0,t+=' style="'+Dn.escape(r)+'"');var o=Dn.escape(this.text);return e?(t+=">",t+=o,t+="</span>",t):o}}class kl{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);for(var i=0;i<this.children.length;i++)t.appendChild(this.children[i].toNode());return t}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Dn.escape(this.attributes[t])+'"');e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</svg>",e}}class qc{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"path");return this.alternate?t.setAttribute("d",this.alternate):t.setAttribute("d",h6[this.pathName]),t}toMarkup(){return this.alternate?'<path d="'+Dn.escape(this.alternate)+'"/>':'<path d="'+Dn.escape(h6[this.pathName])+'"/>'}}class Gb{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"line");for(var r in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,r)&&t.setAttribute(r,this.attributes[r]);return t}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+Dn.escape(this.attributes[t])+'"');return e+="/>",e}}function m6(n){if(n instanceof Os)return n;throw new Error("Expected symbolNode but got "+String(n)+".")}function LZ(n){if(n instanceof wm)return n;throw new Error("Expected span<HtmlDomNode> but got "+String(n)+".")}var zZ={bin:1,close:1,inner:1,open:1,punct:1,rel:1},FZ={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},kr={math:{},text:{}};function N(n,e,t,r,i,o){kr[n][i]={font:e,group:t,replace:r},o&&r&&(kr[n][r]=kr[n][i])}var G="math",Et="text",te="main",Ce="ams",Gr="accent-token",fn="bin",Ia="close",Ef="inner",kn="mathord",xi="op-token",gs="open",Pv="punct",Ie="rel",Nl="spacing",Ue="textord";N(G,te,Ie,"","\\equiv",!0);N(G,te,Ie,"","\\prec",!0);N(G,te,Ie,"","\\succ",!0);N(G,te,Ie,"","\\sim",!0);N(G,te,Ie,"","\\perp");N(G,te,Ie,"","\\preceq",!0);N(G,te,Ie,"","\\succeq",!0);N(G,te,Ie,"","\\simeq",!0);N(G,te,Ie,"","\\mid",!0);N(G,te,Ie,"","\\ll",!0);N(G,te,Ie,"","\\gg",!0);N(G,te,Ie,"","\\asymp",!0);N(G,te,Ie,"","\\parallel");N(G,te,Ie,"","\\bowtie",!0);N(G,te,Ie,"","\\smile",!0);N(G,te,Ie,"","\\sqsubseteq",!0);N(G,te,Ie,"","\\sqsupseteq",!0);N(G,te,Ie,"","\\doteq",!0);N(G,te,Ie,"","\\frown",!0);N(G,te,Ie,"","\\ni",!0);N(G,te,Ie,"","\\propto",!0);N(G,te,Ie,"","\\vdash",!0);N(G,te,Ie,"","\\dashv",!0);N(G,te,Ie,"","\\owns");N(G,te,Pv,".","\\ldotp");N(G,te,Pv,"","\\cdotp");N(G,te,Ue,"#","\\#");N(Et,te,Ue,"#","\\#");N(G,te,Ue,"&","\\&");N(Et,te,Ue,"&","\\&");N(G,te,Ue,"","\\aleph",!0);N(G,te,Ue,"","\\forall",!0);N(G,te,Ue,"","\\hbar",!0);N(G,te,Ue,"","\\exists",!0);N(G,te,Ue,"","\\nabla",!0);N(G,te,Ue,"","\\flat",!0);N(G,te,Ue,"","\\ell",!0);N(G,te,Ue,"","\\natural",!0);N(G,te,Ue,"","\\clubsuit",!0);N(G,te,Ue,"","\\wp",!0);N(G,te,Ue,"","\\sharp",!0);N(G,te,Ue,"","\\diamondsuit",!0);N(G,te,Ue,"","\\Re",!0);N(G,te,Ue,"","\\heartsuit",!0);N(G,te,Ue,"","\\Im",!0);N(G,te,Ue,"","\\spadesuit",!0);N(G,te,Ue,"","\\S",!0);N(Et,te,Ue,"","\\S");N(G,te,Ue,"","\\P",!0);N(Et,te,Ue,"","\\P");N(G,te,Ue,"","\\dag");N(Et,te,Ue,"","\\dag");N(Et,te,Ue,"","\\textdagger");N(G,te,Ue,"","\\ddag");N(Et,te,Ue,"","\\ddag");N(Et,te,Ue,"","\\textdaggerdbl");N(G,te,Ia,"","\\rmoustache",!0);N(G,te,gs,"","\\lmoustache",!0);N(G,te,Ia,"","\\rgroup",!0);N(G,te,gs,"","\\lgroup",!0);N(G,te,fn,"","\\mp",!0);N(G,te,fn,"","\\ominus",!0);N(G,te,fn,"","\\uplus",!0);N(G,te,fn,"","\\sqcap",!0);N(G,te,fn,"","\\ast");N(G,te,fn,"","\\sqcup",!0);N(G,te,fn,"","\\bigcirc",!0);N(G,te,fn,"","\\bullet",!0);N(G,te,fn,"","\\ddagger");N(G,te,fn,"","\\wr",!0);N(G,te,fn,"","\\amalg");N(G,te,fn,"&","\\And");N(G,te,Ie,"","\\longleftarrow",!0);N(G,te,Ie,"","\\Leftarrow",!0);N(G,te,Ie,"","\\Longleftarrow",!0);N(G,te,Ie,"","\\longrightarrow",!0);N(G,te,Ie,"","\\Rightarrow",!0);N(G,te,Ie,"","\\Longrightarrow",!0);N(G,te,Ie,"","\\leftrightarrow",!0);N(G,te,Ie,"","\\longleftrightarrow",!0);N(G,te,Ie,"","\\Leftrightarrow",!0);N(G,te,Ie,"","\\Longleftrightarrow",!0);N(G,te,Ie,"","\\mapsto",!0);N(G,te,Ie,"","\\longmapsto",!0);N(G,te,Ie,"","\\nearrow",!0);N(G,te,Ie,"","\\hookleftarrow",!0);N(G,te,Ie,"","\\hookrightarrow",!0);N(G,te,Ie,"","\\searrow",!0);N(G,te,Ie,"","\\leftharpoonup",!0);N(G,te,Ie,"","\\rightharpoonup",!0);N(G,te,Ie,"","\\swarrow",!0);N(G,te,Ie,"","\\leftharpoondown",!0);N(G,te,Ie,"","\\rightharpoondown",!0);N(G,te,Ie,"","\\nwarrow",!0);N(G,te,Ie,"","\\rightleftharpoons",!0);N(G,Ce,Ie,"","\\nless",!0);N(G,Ce,Ie,"","\\@nleqslant");N(G,Ce,Ie,"","\\@nleqq");N(G,Ce,Ie,"","\\lneq",!0);N(G,Ce,Ie,"","\\lneqq",!0);N(G,Ce,Ie,"","\\@lvertneqq");N(G,Ce,Ie,"","\\lnsim",!0);N(G,Ce,Ie,"","\\lnapprox",!0);N(G,Ce,Ie,"","\\nprec",!0);N(G,Ce,Ie,"","\\npreceq",!0);N(G,Ce,Ie,"","\\precnsim",!0);N(G,Ce,Ie,"","\\precnapprox",!0);N(G,Ce,Ie,"","\\nsim",!0);N(G,Ce,Ie,"","\\@nshortmid");N(G,Ce,Ie,"","\\nmid",!0);N(G,Ce,Ie,"","\\nvdash",!0);N(G,Ce,Ie,"","\\nvDash",!0);N(G,Ce,Ie,"","\\ntriangleleft");N(G,Ce,Ie,"","\\ntrianglelefteq",!0);N(G,Ce,Ie,"","\\subsetneq",!0);N(G,Ce,Ie,"","\\@varsubsetneq");N(G,Ce,Ie,"","\\subsetneqq",!0);N(G,Ce,Ie,"","\\@varsubsetneqq");N(G,Ce,Ie,"","\\ngtr",!0);N(G,Ce,Ie,"","\\@ngeqslant");N(G,Ce,Ie,"","\\@ngeqq");N(G,Ce,Ie,"","\\gneq",!0);N(G,Ce,Ie,"","\\gneqq",!0);N(G,Ce,Ie,"","\\@gvertneqq");N(G,Ce,Ie,"","\\gnsim",!0);N(G,Ce,Ie,"","\\gnapprox",!0);N(G,Ce,Ie,"","\\nsucc",!0);N(G,Ce,Ie,"","\\nsucceq",!0);N(G,Ce,Ie,"","\\succnsim",!0);N(G,Ce,Ie,"","\\succnapprox",!0);N(G,Ce,Ie,"","\\ncong",!0);N(G,Ce,Ie,"","\\@nshortparallel");N(G,Ce,Ie,"","\\nparallel",!0);N(G,Ce,Ie,"","\\nVDash",!0);N(G,Ce,Ie,"","\\ntriangleright");N(G,Ce,Ie,"","\\ntrianglerighteq",!0);N(G,Ce,Ie,"","\\@nsupseteqq");N(G,Ce,Ie,"","\\supsetneq",!0);N(G,Ce,Ie,"","\\@varsupsetneq");N(G,Ce,Ie,"","\\supsetneqq",!0);N(G,Ce,Ie,"","\\@varsupsetneqq");N(G,Ce,Ie,"","\\nVdash",!0);N(G,Ce,Ie,"","\\precneqq",!0);N(G,Ce,Ie,"","\\succneqq",!0);N(G,Ce,Ie,"","\\@nsubseteqq");N(G,Ce,fn,"","\\unlhd");N(G,Ce,fn,"","\\unrhd");N(G,Ce,Ie,"","\\nleftarrow",!0);N(G,Ce,Ie,"","\\nrightarrow",!0);N(G,Ce,Ie,"","\\nLeftarrow",!0);N(G,Ce,Ie,"","\\nRightarrow",!0);N(G,Ce,Ie,"","\\nleftrightarrow",!0);N(G,Ce,Ie,"","\\nLeftrightarrow",!0);N(G,Ce,Ie,"","\\vartriangle");N(G,Ce,Ue,"","\\hslash");N(G,Ce,Ue,"","\\triangledown");N(G,Ce,Ue,"","\\lozenge");N(G,Ce,Ue,"","\\circledS");N(G,Ce,Ue,"","\\circledR");N(Et,Ce,Ue,"","\\circledR");N(G,Ce,Ue,"","\\measuredangle",!0);N(G,Ce,Ue,"","\\nexists");N(G,Ce,Ue,"","\\mho");N(G,Ce,Ue,"","\\Finv",!0);N(G,Ce,Ue,"","\\Game",!0);N(G,Ce,Ue,"","\\backprime");N(G,Ce,Ue,"","\\blacktriangle");N(G,Ce,Ue,"","\\blacktriangledown");N(G,Ce,Ue,"","\\blacksquare");N(G,Ce,Ue,"","\\blacklozenge");N(G,Ce,Ue,"","\\bigstar");N(G,Ce,Ue,"","\\sphericalangle",!0);N(G,Ce,Ue,"","\\complement",!0);N(G,Ce,Ue,"","\\eth",!0);N(Et,te,Ue,"","");N(G,Ce,Ue,"","\\diagup");N(G,Ce,Ue,"","\\diagdown");N(G,Ce,Ue,"","\\square");N(G,Ce,Ue,"","\\Box");N(G,Ce,Ue,"","\\Diamond");N(G,Ce,Ue,"","\\yen",!0);N(Et,Ce,Ue,"","\\yen",!0);N(G,Ce,Ue,"","\\checkmark",!0);N(Et,Ce,Ue,"","\\checkmark");N(G,Ce,Ue,"","\\beth",!0);N(G,Ce,Ue,"","\\daleth",!0);N(G,Ce,Ue,"","\\gimel",!0);N(G,Ce,Ue,"","\\digamma",!0);N(G,Ce,Ue,"","\\varkappa");N(G,Ce,gs,"","\\@ulcorner",!0);N(G,Ce,Ia,"","\\@urcorner",!0);N(G,Ce,gs,"","\\@llcorner",!0);N(G,Ce,Ia,"","\\@lrcorner",!0);N(G,Ce,Ie,"","\\leqq",!0);N(G,Ce,Ie,"","\\leqslant",!0);N(G,Ce,Ie,"","\\eqslantless",!0);N(G,Ce,Ie,"","\\lesssim",!0);N(G,Ce,Ie,"","\\lessapprox",!0);N(G,Ce,Ie,"","\\approxeq",!0);N(G,Ce,fn,"","\\lessdot");N(G,Ce,Ie,"","\\lll",!0);N(G,Ce,Ie,"","\\lessgtr",!0);N(G,Ce,Ie,"","\\lesseqgtr",!0);N(G,Ce,Ie,"","\\lesseqqgtr",!0);N(G,Ce,Ie,"","\\doteqdot");N(G,Ce,Ie,"","\\risingdotseq",!0);N(G,Ce,Ie,"","\\fallingdotseq",!0);N(G,Ce,Ie,"","\\backsim",!0);N(G,Ce,Ie,"","\\backsimeq",!0);N(G,Ce,Ie,"","\\subseteqq",!0);N(G,Ce,Ie,"","\\Subset",!0);N(G,Ce,Ie,"","\\sqsubset",!0);N(G,Ce,Ie,"","\\preccurlyeq",!0);N(G,Ce,Ie,"","\\curlyeqprec",!0);N(G,Ce,Ie,"","\\precsim",!0);N(G,Ce,Ie,"","\\precapprox",!0);N(G,Ce,Ie,"","\\vartriangleleft");N(G,Ce,Ie,"","\\trianglelefteq");N(G,Ce,Ie,"","\\vDash",!0);N(G,Ce,Ie,"","\\Vvdash",!0);N(G,Ce,Ie,"","\\smallsmile");N(G,Ce,Ie,"","\\smallfrown");N(G,Ce,Ie,"","\\bumpeq",!0);N(G,Ce,Ie,"","\\Bumpeq",!0);N(G,Ce,Ie,"","\\geqq",!0);N(G,Ce,Ie,"","\\geqslant",!0);N(G,Ce,Ie,"","\\eqslantgtr",!0);N(G,Ce,Ie,"","\\gtrsim",!0);N(G,Ce,Ie,"","\\gtrapprox",!0);N(G,Ce,fn,"","\\gtrdot");N(G,Ce,Ie,"","\\ggg",!0);N(G,Ce,Ie,"","\\gtrless",!0);N(G,Ce,Ie,"","\\gtreqless",!0);N(G,Ce,Ie,"","\\gtreqqless",!0);N(G,Ce,Ie,"","\\eqcirc",!0);N(G,Ce,Ie,"","\\circeq",!0);N(G,Ce,Ie,"","\\triangleq",!0);N(G,Ce,Ie,"","\\thicksim");N(G,Ce,Ie,"","\\thickapprox");N(G,Ce,Ie,"","\\supseteqq",!0);N(G,Ce,Ie,"","\\Supset",!0);N(G,Ce,Ie,"","\\sqsupset",!0);N(G,Ce,Ie,"","\\succcurlyeq",!0);N(G,Ce,Ie,"","\\curlyeqsucc",!0);N(G,Ce,Ie,"","\\succsim",!0);N(G,Ce,Ie,"","\\succapprox",!0);N(G,Ce,Ie,"","\\vartriangleright");N(G,Ce,Ie,"","\\trianglerighteq");N(G,Ce,Ie,"","\\Vdash",!0);N(G,Ce,Ie,"","\\shortmid");N(G,Ce,Ie,"","\\shortparallel");N(G,Ce,Ie,"","\\between",!0);N(G,Ce,Ie,"","\\pitchfork",!0);N(G,Ce,Ie,"","\\varpropto");N(G,Ce,Ie,"","\\blacktriangleleft");N(G,Ce,Ie,"","\\therefore",!0);N(G,Ce,Ie,"","\\backepsilon");N(G,Ce,Ie,"","\\blacktriangleright");N(G,Ce,Ie,"","\\because",!0);N(G,Ce,Ie,"","\\llless");N(G,Ce,Ie,"","\\gggtr");N(G,Ce,fn,"","\\lhd");N(G,Ce,fn,"","\\rhd");N(G,Ce,Ie,"","\\eqsim",!0);N(G,te,Ie,"","\\Join");N(G,Ce,Ie,"","\\Doteq",!0);N(G,Ce,fn,"","\\dotplus",!0);N(G,Ce,fn,"","\\smallsetminus");N(G,Ce,fn,"","\\Cap",!0);N(G,Ce,fn,"","\\Cup",!0);N(G,Ce,fn,"","\\doublebarwedge",!0);N(G,Ce,fn,"","\\boxminus",!0);N(G,Ce,fn,"","\\boxplus",!0);N(G,Ce,fn,"","\\divideontimes",!0);N(G,Ce,fn,"","\\ltimes",!0);N(G,Ce,fn,"","\\rtimes",!0);N(G,Ce,fn,"","\\leftthreetimes",!0);N(G,Ce,fn,"","\\rightthreetimes",!0);N(G,Ce,fn,"","\\curlywedge",!0);N(G,Ce,fn,"","\\curlyvee",!0);N(G,Ce,fn,"","\\circleddash",!0);N(G,Ce,fn,"","\\circledast",!0);N(G,Ce,fn,"","\\centerdot");N(G,Ce,fn,"","\\intercal",!0);N(G,Ce,fn,"","\\doublecap");N(G,Ce,fn,"","\\doublecup");N(G,Ce,fn,"","\\boxtimes",!0);N(G,Ce,Ie,"","\\dashrightarrow",!0);N(G,Ce,Ie,"","\\dashleftarrow",!0);N(G,Ce,Ie,"","\\leftleftarrows",!0);N(G,Ce,Ie,"","\\leftrightarrows",!0);N(G,Ce,Ie,"","\\Lleftarrow",!0);N(G,Ce,Ie,"","\\twoheadleftarrow",!0);N(G,Ce,Ie,"","\\leftarrowtail",!0);N(G,Ce,Ie,"","\\looparrowleft",!0);N(G,Ce,Ie,"","\\leftrightharpoons",!0);N(G,Ce,Ie,"","\\curvearrowleft",!0);N(G,Ce,Ie,"","\\circlearrowleft",!0);N(G,Ce,Ie,"","\\Lsh",!0);N(G,Ce,Ie,"","\\upuparrows",!0);N(G,Ce,Ie,"","\\upharpoonleft",!0);N(G,Ce,Ie,"","\\downharpoonleft",!0);N(G,te,Ie,"","\\origof",!0);N(G,te,Ie,"","\\imageof",!0);N(G,Ce,Ie,"","\\multimap",!0);N(G,Ce,Ie,"","\\leftrightsquigarrow",!0);N(G,Ce,Ie,"","\\rightrightarrows",!0);N(G,Ce,Ie,"","\\rightleftarrows",!0);N(G,Ce,Ie,"","\\twoheadrightarrow",!0);N(G,Ce,Ie,"","\\rightarrowtail",!0);N(G,Ce,Ie,"","\\looparrowright",!0);N(G,Ce,Ie,"","\\curvearrowright",!0);N(G,Ce,Ie,"","\\circlearrowright",!0);N(G,Ce,Ie,"","\\Rsh",!0);N(G,Ce,Ie,"","\\downdownarrows",!0);N(G,Ce,Ie,"","\\upharpoonright",!0);N(G,Ce,Ie,"","\\downharpoonright",!0);N(G,Ce,Ie,"","\\rightsquigarrow",!0);N(G,Ce,Ie,"","\\leadsto");N(G,Ce,Ie,"","\\Rrightarrow",!0);N(G,Ce,Ie,"","\\restriction");N(G,te,Ue,"","`");N(G,te,Ue,"$","\\$");N(Et,te,Ue,"$","\\$");N(Et,te,Ue,"$","\\textdollar");N(G,te,Ue,"%","\\%");N(Et,te,Ue,"%","\\%");N(G,te,Ue,"_","\\_");N(Et,te,Ue,"_","\\_");N(Et,te,Ue,"_","\\textunderscore");N(G,te,Ue,"","\\angle",!0);N(G,te,Ue,"","\\infty",!0);N(G,te,Ue,"","\\prime");N(G,te,Ue,"","\\triangle");N(G,te,Ue,"","\\Gamma",!0);N(G,te,Ue,"","\\Delta",!0);N(G,te,Ue,"","\\Theta",!0);N(G,te,Ue,"","\\Lambda",!0);N(G,te,Ue,"","\\Xi",!0);N(G,te,Ue,"","\\Pi",!0);N(G,te,Ue,"","\\Sigma",!0);N(G,te,Ue,"","\\Upsilon",!0);N(G,te,Ue,"","\\Phi",!0);N(G,te,Ue,"","\\Psi",!0);N(G,te,Ue,"","\\Omega",!0);N(G,te,Ue,"A","");N(G,te,Ue,"B","");N(G,te,Ue,"E","");N(G,te,Ue,"Z","");N(G,te,Ue,"H","");N(G,te,Ue,"I","");N(G,te,Ue,"K","");N(G,te,Ue,"M","");N(G,te,Ue,"N","");N(G,te,Ue,"O","");N(G,te,Ue,"P","");N(G,te,Ue,"T","");N(G,te,Ue,"X","");N(G,te,Ue,"","\\neg",!0);N(G,te,Ue,"","\\lnot");N(G,te,Ue,"","\\top");N(G,te,Ue,"","\\bot");N(G,te,Ue,"","\\emptyset");N(G,Ce,Ue,"","\\varnothing");N(G,te,kn,"","\\alpha",!0);N(G,te,kn,"","\\beta",!0);N(G,te,kn,"","\\gamma",!0);N(G,te,kn,"","\\delta",!0);N(G,te,kn,"","\\epsilon",!0);N(G,te,kn,"","\\zeta",!0);N(G,te,kn,"","\\eta",!0);N(G,te,kn,"","\\theta",!0);N(G,te,kn,"","\\iota",!0);N(G,te,kn,"","\\kappa",!0);N(G,te,kn,"","\\lambda",!0);N(G,te,kn,"","\\mu",!0);N(G,te,kn,"","\\nu",!0);N(G,te,kn,"","\\xi",!0);N(G,te,kn,"","\\omicron",!0);N(G,te,kn,"","\\pi",!0);N(G,te,kn,"","\\rho",!0);N(G,te,kn,"","\\sigma",!0);N(G,te,kn,"","\\tau",!0);N(G,te,kn,"","\\upsilon",!0);N(G,te,kn,"","\\phi",!0);N(G,te,kn,"","\\chi",!0);N(G,te,kn,"","\\psi",!0);N(G,te,kn,"","\\omega",!0);N(G,te,kn,"","\\varepsilon",!0);N(G,te,kn,"","\\vartheta",!0);N(G,te,kn,"","\\varpi",!0);N(G,te,kn,"","\\varrho",!0);N(G,te,kn,"","\\varsigma",!0);N(G,te,kn,"","\\varphi",!0);N(G,te,fn,"","*",!0);N(G,te,fn,"+","+");N(G,te,fn,"","-",!0);N(G,te,fn,"","\\cdot",!0);N(G,te,fn,"","\\circ",!0);N(G,te,fn,"","\\div",!0);N(G,te,fn,"","\\pm",!0);N(G,te,fn,"","\\times",!0);N(G,te,fn,"","\\cap",!0);N(G,te,fn,"","\\cup",!0);N(G,te,fn,"","\\setminus",!0);N(G,te,fn,"","\\land");N(G,te,fn,"","\\lor");N(G,te,fn,"","\\wedge",!0);N(G,te,fn,"","\\vee",!0);N(G,te,Ue,"","\\surd");N(G,te,gs,"","\\langle",!0);N(G,te,gs,"","\\lvert");N(G,te,gs,"","\\lVert");N(G,te,Ia,"?","?");N(G,te,Ia,"!","!");N(G,te,Ia,"","\\rangle",!0);N(G,te,Ia,"","\\rvert");N(G,te,Ia,"","\\rVert");N(G,te,Ie,"=","=");N(G,te,Ie,":",":");N(G,te,Ie,"","\\approx",!0);N(G,te,Ie,"","\\cong",!0);N(G,te,Ie,"","\\ge");N(G,te,Ie,"","\\geq",!0);N(G,te,Ie,"","\\gets");N(G,te,Ie,">","\\gt",!0);N(G,te,Ie,"","\\in",!0);N(G,te,Ie,"","\\@not");N(G,te,Ie,"","\\subset",!0);N(G,te,Ie,"","\\supset",!0);N(G,te,Ie,"","\\subseteq",!0);N(G,te,Ie,"","\\supseteq",!0);N(G,Ce,Ie,"","\\nsubseteq",!0);N(G,Ce,Ie,"","\\nsupseteq",!0);N(G,te,Ie,"","\\models");N(G,te,Ie,"","\\leftarrow",!0);N(G,te,Ie,"","\\le");N(G,te,Ie,"","\\leq",!0);N(G,te,Ie,"<","\\lt",!0);N(G,te,Ie,"","\\rightarrow",!0);N(G,te,Ie,"","\\to");N(G,Ce,Ie,"","\\ngeq",!0);N(G,Ce,Ie,"","\\nleq",!0);N(G,te,Nl,"","\\ ");N(G,te,Nl,"","\\space");N(G,te,Nl,"","\\nobreakspace");N(Et,te,Nl,"","\\ ");N(Et,te,Nl,""," ");N(Et,te,Nl,"","\\space");N(Et,te,Nl,"","\\nobreakspace");N(G,te,Nl,null,"\\nobreak");N(G,te,Nl,null,"\\allowbreak");N(G,te,Pv,",",",");N(G,te,Pv,";",";");N(G,Ce,fn,"","\\barwedge",!0);N(G,Ce,fn,"","\\veebar",!0);N(G,te,fn,"","\\odot",!0);N(G,te,fn,"","\\oplus",!0);N(G,te,fn,"","\\otimes",!0);N(G,te,Ue,"","\\partial",!0);N(G,te,fn,"","\\oslash",!0);N(G,Ce,fn,"","\\circledcirc",!0);N(G,Ce,fn,"","\\boxdot",!0);N(G,te,fn,"","\\bigtriangleup");N(G,te,fn,"","\\bigtriangledown");N(G,te,fn,"","\\dagger");N(G,te,fn,"","\\diamond");N(G,te,fn,"","\\star");N(G,te,fn,"","\\triangleleft");N(G,te,fn,"","\\triangleright");N(G,te,gs,"{","\\{");N(Et,te,Ue,"{","\\{");N(Et,te,Ue,"{","\\textbraceleft");N(G,te,Ia,"}","\\}");N(Et,te,Ue,"}","\\}");N(Et,te,Ue,"}","\\textbraceright");N(G,te,gs,"{","\\lbrace");N(G,te,Ia,"}","\\rbrace");N(G,te,gs,"[","\\lbrack",!0);N(Et,te,Ue,"[","\\lbrack",!0);N(G,te,Ia,"]","\\rbrack",!0);N(Et,te,Ue,"]","\\rbrack",!0);N(G,te,gs,"(","\\lparen",!0);N(G,te,Ia,")","\\rparen",!0);N(Et,te,Ue,"<","\\textless",!0);N(Et,te,Ue,">","\\textgreater",!0);N(G,te,gs,"","\\lfloor",!0);N(G,te,Ia,"","\\rfloor",!0);N(G,te,gs,"","\\lceil",!0);N(G,te,Ia,"","\\rceil",!0);N(G,te,Ue,"\\","\\backslash");N(G,te,Ue,"","|");N(G,te,Ue,"","\\vert");N(Et,te,Ue,"|","\\textbar",!0);N(G,te,Ue,"","\\|");N(G,te,Ue,"","\\Vert");N(Et,te,Ue,"","\\textbardbl");N(Et,te,Ue,"~","\\textasciitilde");N(Et,te,Ue,"\\","\\textbackslash");N(Et,te,Ue,"^","\\textasciicircum");N(G,te,Ie,"","\\uparrow",!0);N(G,te,Ie,"","\\Uparrow",!0);N(G,te,Ie,"","\\downarrow",!0);N(G,te,Ie,"","\\Downarrow",!0);N(G,te,Ie,"","\\updownarrow",!0);N(G,te,Ie,"","\\Updownarrow",!0);N(G,te,xi,"","\\coprod");N(G,te,xi,"","\\bigvee");N(G,te,xi,"","\\bigwedge");N(G,te,xi,"","\\biguplus");N(G,te,xi,"","\\bigcap");N(G,te,xi,"","\\bigcup");N(G,te,xi,"","\\int");N(G,te,xi,"","\\intop");N(G,te,xi,"","\\iint");N(G,te,xi,"","\\iiint");N(G,te,xi,"","\\prod");N(G,te,xi,"","\\sum");N(G,te,xi,"","\\bigotimes");N(G,te,xi,"","\\bigoplus");N(G,te,xi,"","\\bigodot");N(G,te,xi,"","\\oint");N(G,te,xi,"","\\oiint");N(G,te,xi,"","\\oiiint");N(G,te,xi,"","\\bigsqcup");N(G,te,xi,"","\\smallint");N(Et,te,Ef,"","\\textellipsis");N(G,te,Ef,"","\\mathellipsis");N(Et,te,Ef,"","\\ldots",!0);N(G,te,Ef,"","\\ldots",!0);N(G,te,Ef,"","\\@cdots",!0);N(G,te,Ef,"","\\ddots",!0);N(G,te,Ue,"","\\varvdots");N(G,te,Gr,"","\\acute");N(G,te,Gr,"","\\grave");N(G,te,Gr,"","\\ddot");N(G,te,Gr,"~","\\tilde");N(G,te,Gr,"","\\bar");N(G,te,Gr,"","\\breve");N(G,te,Gr,"","\\check");N(G,te,Gr,"^","\\hat");N(G,te,Gr,"","\\vec");N(G,te,Gr,"","\\dot");N(G,te,Gr,"","\\mathring");N(G,te,kn,"","\\@imath");N(G,te,kn,"","\\@jmath");N(G,te,Ue,"","");N(G,te,Ue,"","");N(Et,te,Ue,"","\\i",!0);N(Et,te,Ue,"","\\j",!0);N(Et,te,Ue,"","\\ss",!0);N(Et,te,Ue,"","\\ae",!0);N(Et,te,Ue,"","\\oe",!0);N(Et,te,Ue,"","\\o",!0);N(Et,te,Ue,"","\\AE",!0);N(Et,te,Ue,"","\\OE",!0);N(Et,te,Ue,"","\\O",!0);N(Et,te,Gr,"","\\'");N(Et,te,Gr,"","\\`");N(Et,te,Gr,"","\\^");N(Et,te,Gr,"","\\~");N(Et,te,Gr,"","\\=");N(Et,te,Gr,"","\\u");N(Et,te,Gr,"","\\.");N(Et,te,Gr,"","\\c");N(Et,te,Gr,"","\\r");N(Et,te,Gr,"","\\v");N(Et,te,Gr,"",'\\"');N(Et,te,Gr,"","\\H");N(Et,te,Gr,"","\\textcircled");var OC={"--":!0,"---":!0,"``":!0,"''":!0};N(Et,te,Ue,"","--",!0);N(Et,te,Ue,"","\\textendash");N(Et,te,Ue,"","---",!0);N(Et,te,Ue,"","\\textemdash");N(Et,te,Ue,"","`",!0);N(Et,te,Ue,"","\\textquoteleft");N(Et,te,Ue,"","'",!0);N(Et,te,Ue,"","\\textquoteright");N(Et,te,Ue,"","``",!0);N(Et,te,Ue,"","\\textquotedblleft");N(Et,te,Ue,"","''",!0);N(Et,te,Ue,"","\\textquotedblright");N(G,te,Ue,"","\\degree",!0);N(Et,te,Ue,"","\\degree");N(Et,te,Ue,"","\\textdegree",!0);N(G,te,Ue,"","\\pounds");N(G,te,Ue,"","\\mathsterling",!0);N(Et,te,Ue,"","\\pounds");N(Et,te,Ue,"","\\textsterling",!0);N(G,Ce,Ue,"","\\maltese");N(Et,Ce,Ue,"","\\maltese");var g6='0123456789/@."';for(var a2=0;a2<g6.length;a2++){var y6=g6.charAt(a2);N(G,te,Ue,y6,y6)}var v6='0123456789!@*()-=+";:?/.,';for(var s2=0;s2<v6.length;s2++){var _6=v6.charAt(s2);N(Et,te,Ue,_6,_6)}var Wy="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var o2=0;o2<Wy.length;o2++){var M1=Wy.charAt(o2);N(G,te,kn,M1,M1),N(Et,te,Ue,M1,M1)}N(G,Ce,Ue,"C","");N(Et,Ce,Ue,"C","");N(G,Ce,Ue,"H","");N(Et,Ce,Ue,"H","");N(G,Ce,Ue,"N","");N(Et,Ce,Ue,"N","");N(G,Ce,Ue,"P","");N(Et,Ce,Ue,"P","");N(G,Ce,Ue,"Q","");N(Et,Ce,Ue,"Q","");N(G,Ce,Ue,"R","");N(Et,Ce,Ue,"R","");N(G,Ce,Ue,"Z","");N(Et,Ce,Ue,"Z","");N(G,te,kn,"h","");N(Et,te,kn,"h","");var On="";for(var wa=0;wa<Wy.length;wa++){var ti=Wy.charAt(wa);On=String.fromCharCode(55349,56320+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56372+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56424+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56580+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56684+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56736+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56788+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56840+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56944+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),wa<26&&(On=String.fromCharCode(55349,56632+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On),On=String.fromCharCode(55349,56476+wa),N(G,te,kn,ti,On),N(Et,te,Ue,ti,On))}On="";N(G,te,kn,"k",On);N(Et,te,Ue,"k",On);for(var Ru=0;Ru<10;Ru++){var _c=Ru.toString();On=String.fromCharCode(55349,57294+Ru),N(G,te,kn,_c,On),N(Et,te,Ue,_c,On),On=String.fromCharCode(55349,57314+Ru),N(G,te,kn,_c,On),N(Et,te,Ue,_c,On),On=String.fromCharCode(55349,57324+Ru),N(G,te,kn,_c,On),N(Et,te,Ue,_c,On),On=String.fromCharCode(55349,57334+Ru),N(G,te,kn,_c,On),N(Et,te,Ue,_c,On)}var jb="";for(var l2=0;l2<jb.length;l2++){var T1=jb.charAt(l2);N(G,te,kn,T1,T1),N(Et,te,Ue,T1,T1)}var E1=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],x6=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],NZ=function(e,t){var r=e.charCodeAt(0),i=e.charCodeAt(1),o=(r-55296)*1024+(i-56320)+65536,u=t==="math"?0:1;if(119808<=o&&o<120484){var l=Math.floor((o-119808)/26);return[E1[l][2],E1[l][u]]}else if(120782<=o&&o<=120831){var p=Math.floor((o-120782)/10);return[x6[p][2],x6[p][u]]}else{if(o===120485||o===120486)return[E1[0][2],E1[0][u]];if(120486<o&&o<120782)return["",""];throw new Ut("Unsupported character: "+e)}},Rv=function(e,t,r){return kr[r][e]&&kr[r][e].replace&&(e=kr[r][e].replace),{value:e,metrics:M4(e,t,r)}},to=function(e,t,r,i,o){var u=Rv(e,t,r),l=u.metrics;e=u.value;var p;if(l){var v=l.italic;(r==="text"||i&&i.font==="mathit")&&(v=0),p=new Os(e,l.height,l.depth,v,l.skew,l.width,o)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+t+"' and mode '"+r+"'")),p=new Os(e,0,0,0,0,0,o);if(i){p.maxFontSize=i.sizeMultiplier,i.style.isTight()&&p.classes.push("mtight");var x=i.getColor();x&&(p.style.color=x)}return p},OZ=function(e,t,r,i){return i===void 0&&(i=[]),r.font==="boldsymbol"&&Rv(e,"Main-Bold",t).metrics?to(e,"Main-Bold",t,r,i.concat(["mathbf"])):e==="\\"||kr[t][e].font==="main"?to(e,"Main-Regular",t,r,i):to(e,"AMS-Regular",t,r,i.concat(["amsrm"]))},BZ=function(e,t,r,i,o){return o!=="textord"&&Rv(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},UZ=function(e,t,r){var i=e.mode,o=e.text,u=["mord"],l=i==="math"||i==="text"&&t.font,p=l?t.font:t.fontFamily,v="",x="";if(o.charCodeAt(0)===55349&&([v,x]=NZ(o,i)),v.length>0)return to(o,v,i,t,u.concat(x));if(p){var M,w;if(p==="boldsymbol"){var A=BZ(o,i,t,u,r);M=A.fontName,w=[A.fontClass]}else l?(M=VC[p].fontName,w=[p]):(M=A1(p,t.fontWeight,t.fontShape),w=[p,t.fontWeight,t.fontShape]);if(Rv(o,M,i).metrics)return to(o,M,i,t,u.concat(w));if(OC.hasOwnProperty(o)&&M.slice(0,10)==="Typewriter"){for(var k=[],z=0;z<o.length;z++)k.push(to(o[z],M,i,t,u.concat(w)));return UC(k)}}if(r==="mathord")return to(o,"Math-Italic",i,t,u.concat(["mathnormal"]));if(r==="textord"){var D=kr[i][o]&&kr[i][o].font;if(D==="ams"){var C=A1("amsrm",t.fontWeight,t.fontShape);return to(o,C,i,t,u.concat("amsrm",t.fontWeight,t.fontShape))}else if(D==="main"||!D){var U=A1("textrm",t.fontWeight,t.fontShape);return to(o,U,i,t,u.concat(t.fontWeight,t.fontShape))}else{var B=A1(D,t.fontWeight,t.fontShape);return to(o,B,i,t,u.concat(B,t.fontWeight,t.fontShape))}}else throw new Error("unexpected type: "+r+" in makeOrd")},VZ=(n,e)=>{if($c(n.classes)!==$c(e.classes)||n.skew!==e.skew||n.maxFontSize!==e.maxFontSize)return!1;if(n.classes.length===1){var t=n.classes[0];if(t==="mbin"||t==="mord")return!1}for(var r in n.style)if(n.style.hasOwnProperty(r)&&n.style[r]!==e.style[r])return!1;for(var i in e.style)if(e.style.hasOwnProperty(i)&&n.style[i]!==e.style[i])return!1;return!0},HZ=n=>{for(var e=0;e<n.length-1;e++){var t=n[e],r=n[e+1];t instanceof Os&&r instanceof Os&&VZ(t,r)&&(t.text+=r.text,t.height=Math.max(t.height,r.height),t.depth=Math.max(t.depth,r.depth),t.italic=r.italic,n.splice(e+1,1),e--)}return n},E4=function(e){for(var t=0,r=0,i=0,o=0;o<e.children.length;o++){var u=e.children[o];u.height>t&&(t=u.height),u.depth>r&&(r=u.depth),u.maxFontSize>i&&(i=u.maxFontSize)}e.height=t,e.depth=r,e.maxFontSize=i},Oa=function(e,t,r,i){var o=new wm(e,t,r,i);return E4(o),o},BC=(n,e,t,r)=>new wm(n,e,t,r),GZ=function(e,t,r){var i=Oa([e],[],t);return i.height=Math.max(r||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),i.style.borderBottomWidth=qt(i.height),i.maxFontSize=1,i},jZ=function(e,t,r,i){var o=new T4(e,t,r,i);return E4(o),o},UC=function(e){var t=new bm(e);return E4(t),t},WZ=function(e,t){return e instanceof bm?Oa([],[e],t):e},$Z=function(e){if(e.positionType==="individualShift"){for(var t=e.children,r=[t[0]],i=-t[0].shift-t[0].elem.depth,o=i,u=1;u<t.length;u++){var l=-t[u].shift-o-t[u].elem.depth,p=l-(t[u-1].elem.height+t[u-1].elem.depth);o=o+l,r.push({type:"kern",size:p}),r.push(t[u])}return{children:r,depth:i}}var v;if(e.positionType==="top"){for(var x=e.positionData,M=0;M<e.children.length;M++){var w=e.children[M];x-=w.type==="kern"?w.size:w.elem.height+w.elem.depth}v=x}else if(e.positionType==="bottom")v=-e.positionData;else{var A=e.children[0];if(A.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")v=-A.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")v=-A.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:v}},qZ=function(e,t){for(var{children:r,depth:i}=$Z(e),o=0,u=0;u<r.length;u++){var l=r[u];if(l.type==="elem"){var p=l.elem;o=Math.max(o,p.maxFontSize,p.height)}}o+=2;var v=Oa(["pstrut"],[]);v.style.height=qt(o);for(var x=[],M=i,w=i,A=i,k=0;k<r.length;k++){var z=r[k];if(z.type==="kern")A+=z.size;else{var D=z.elem,C=z.wrapperClasses||[],U=z.wrapperStyle||{},B=Oa(C,[v,D],void 0,U);B.style.top=qt(-o-A-D.depth),z.marginLeft&&(B.style.marginLeft=z.marginLeft),z.marginRight&&(B.style.marginRight=z.marginRight),x.push(B),A+=D.height+D.depth}M=Math.min(M,A),w=Math.max(w,A)}var K=Oa(["vlist"],x);K.style.height=qt(w);var ue;if(M<0){var Z=Oa([],[]),ee=Oa(["vlist"],[Z]);ee.style.height=qt(-M);var be=Oa(["vlist-s"],[new Os("")]);ue=[Oa(["vlist-r"],[K,be]),Oa(["vlist-r"],[ee])]}else ue=[Oa(["vlist-r"],[K])];var ie=Oa(["vlist-t"],ue);return ue.length===2&&ie.classes.push("vlist-t2"),ie.height=w,ie.depth=-M,ie},XZ=(n,e)=>{var t=Oa(["mspace"],[],e),r=Zr(n,e);return t.style.marginRight=qt(r),t},A1=function(e,t,r){var i="";switch(e){case"amsrm":i="AMS";break;case"textrm":i="Main";break;case"textsf":i="SansSerif";break;case"texttt":i="Typewriter";break;default:i=e}var o;return t==="textbf"&&r==="textit"?o="BoldItalic":t==="textbf"?o="Bold":t==="textit"?o="Italic":o="Regular",i+"-"+o},VC={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},HC={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},ZZ=function(e,t){var[r,i,o]=HC[e],u=new qc(r),l=new kl([u],{width:qt(i),height:qt(o),style:"width:"+qt(i),viewBox:"0 0 "+1e3*i+" "+1e3*o,preserveAspectRatio:"xMinYMin"}),p=BC(["overlay"],[l],t);return p.height=o,p.style.height=qt(o),p.style.width=qt(i),p},et={fontMap:VC,makeSymbol:to,mathsym:OZ,makeSpan:Oa,makeSvgSpan:BC,makeLineSpan:GZ,makeAnchor:jZ,makeFragment:UC,wrapFragment:WZ,makeVList:qZ,makeOrd:UZ,makeGlue:XZ,staticSvg:ZZ,svgData:HC,tryCombineChars:HZ},qr={number:3,unit:"mu"},Iu={number:4,unit:"mu"},fl={number:5,unit:"mu"},YZ={mord:{mop:qr,mbin:Iu,mrel:fl,minner:qr},mop:{mord:qr,mop:qr,mrel:fl,minner:qr},mbin:{mord:Iu,mop:Iu,mopen:Iu,minner:Iu},mrel:{mord:fl,mop:fl,mopen:fl,minner:fl},mopen:{},mclose:{mop:qr,mbin:Iu,mrel:fl,minner:qr},mpunct:{mord:qr,mop:qr,mrel:fl,mopen:qr,mclose:qr,mpunct:qr,minner:qr},minner:{mord:qr,mop:qr,mbin:Iu,mrel:fl,mopen:qr,mpunct:qr,minner:qr}},KZ={mord:{mop:qr},mop:{mord:qr,mop:qr},mbin:{},mrel:{},mopen:{},mclose:{mop:qr},mpunct:{},minner:{mop:qr}},GC={},$y={},qy={};function cn(n){for(var{type:e,names:t,props:r,handler:i,htmlBuilder:o,mathmlBuilder:u}=n,l={type:e,numArgs:r.numArgs,argTypes:r.argTypes,allowedInArgument:!!r.allowedInArgument,allowedInText:!!r.allowedInText,allowedInMath:r.allowedInMath===void 0?!0:r.allowedInMath,numOptionalArgs:r.numOptionalArgs||0,infix:!!r.infix,primitive:!!r.primitive,handler:i},p=0;p<t.length;++p)GC[t[p]]=l;e&&(o&&($y[e]=o),u&&(qy[e]=u))}function uh(n){var{type:e,htmlBuilder:t,mathmlBuilder:r}=n;cn({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:t,mathmlBuilder:r})}var Xy=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},mi=function(e){return e.type==="ordgroup"?e.body:[e]},Ll=et.makeSpan,JZ=["leftmost","mbin","mopen","mrel","mop","mpunct"],QZ=["rightmost","mrel","mclose","mpunct"],eY={display:Ln.DISPLAY,text:Ln.TEXT,script:Ln.SCRIPT,scriptscript:Ln.SCRIPTSCRIPT},tY={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Ci=function(e,t,r,i){i===void 0&&(i=[null,null]);for(var o=[],u=0;u<e.length;u++){var l=hr(e[u],t);if(l instanceof bm){var p=l.children;o.push(...p)}else o.push(l)}if(et.tryCombineChars(o),!r)return o;var v=t;if(e.length===1){var x=e[0];x.type==="sizing"?v=t.havingSize(x.size):x.type==="styling"&&(v=t.havingStyle(eY[x.style]))}var M=Ll([i[0]||"leftmost"],[],t),w=Ll([i[1]||"rightmost"],[],t),A=r==="root";return b6(o,(k,z)=>{var D=z.classes[0],C=k.classes[0];D==="mbin"&&Dn.contains(QZ,C)?z.classes[0]="mord":C==="mbin"&&Dn.contains(JZ,D)&&(k.classes[0]="mord")},{node:M},w,A),b6(o,(k,z)=>{var D=Wb(z),C=Wb(k),U=D&&C?k.hasClass("mtight")?KZ[D][C]:YZ[D][C]:null;if(U)return et.makeGlue(U,v)},{node:M},w,A),o},b6=function n(e,t,r,i,o){i&&e.push(i);for(var u=0;u<e.length;u++){var l=e[u],p=jC(l);if(p){n(p.children,t,r,null,o);continue}var v=!l.hasClass("mspace");if(v){var x=t(l,r.node);x&&(r.insertAfter?r.insertAfter(x):(e.unshift(x),u++))}v?r.node=l:o&&l.hasClass("newline")&&(r.node=Ll(["leftmost"])),r.insertAfter=(M=>w=>{e.splice(M+1,0,w),u++})(u)}i&&e.pop()},jC=function(e){return e instanceof bm||e instanceof T4||e instanceof wm&&e.hasClass("enclosing")?e:null},nY=function n(e,t){var r=jC(e);if(r){var i=r.children;if(i.length){if(t==="right")return n(i[i.length-1],"right");if(t==="left")return n(i[0],"left")}}return e},Wb=function(e,t){return e?(t&&(e=nY(e,t)),tY[e.classes[0]]||null):null},rm=function(e,t){var r=["nulldelimiter"].concat(e.baseSizingClasses());return Ll(t.concat(r))},hr=function(e,t,r){if(!e)return Ll();if($y[e.type]){var i=$y[e.type](e,t);if(r&&t.size!==r.size){i=Ll(t.sizingClasses(r),[i],t);var o=t.sizeMultiplier/r.sizeMultiplier;i.height*=o,i.depth*=o}return i}else throw new Ut("Got group of unknown type: '"+e.type+"'")};function C1(n,e){var t=Ll(["base"],n,e),r=Ll(["strut"]);return r.style.height=qt(t.height+t.depth),t.depth&&(r.style.verticalAlign=qt(-t.depth)),t.children.unshift(r),t}function $b(n,e){var t=null;n.length===1&&n[0].type==="tag"&&(t=n[0].tag,n=n[0].body);var r=Ci(n,e,"root"),i;r.length===2&&r[1].hasClass("tag")&&(i=r.pop());for(var o=[],u=[],l=0;l<r.length;l++)if(u.push(r[l]),r[l].hasClass("mbin")||r[l].hasClass("mrel")||r[l].hasClass("allowbreak")){for(var p=!1;l<r.length-1&&r[l+1].hasClass("mspace")&&!r[l+1].hasClass("newline");)l++,u.push(r[l]),r[l].hasClass("nobreak")&&(p=!0);p||(o.push(C1(u,e)),u=[])}else r[l].hasClass("newline")&&(u.pop(),u.length>0&&(o.push(C1(u,e)),u=[]),o.push(r[l]));u.length>0&&o.push(C1(u,e));var v;t?(v=C1(Ci(t,e,!0)),v.classes=["tag"],o.push(v)):i&&o.push(i);var x=Ll(["katex-html"],o);if(x.setAttribute("aria-hidden","true"),v){var M=v.children[0];M.style.height=qt(x.height+x.depth),x.depth&&(M.style.verticalAlign=qt(-x.depth))}return x}function WC(n){return new bm(n)}class Ps{constructor(e,t,r){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=r||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=$c(this.classes));for(var r=0;r<this.children.length;r++)e.appendChild(this.children[r].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=Dn.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+Dn.escape($c(this.classes))+'"'),e+=">";for(var r=0;r<this.children.length;r++)e+=this.children[r].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class Tp{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return Dn.escape(this.toText())}toText(){return this.text}}class rY{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character="":e>=.1666&&e<=.1667?this.character="":e>=.2222&&e<=.2223?this.character="":e>=.2777&&e<=.2778?this.character="":e>=-.05556&&e<=-.05555?this.character="":e>=-.1667&&e<=-.1666?this.character="":e>=-.2223&&e<=-.2222?this.character="":e>=-.2778&&e<=-.2777?this.character="":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",qt(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+qt(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var Dt={MathNode:Ps,TextNode:Tp,SpaceNode:rY,newDocumentFragment:WC},Bs=function(e,t,r){return kr[t][e]&&kr[t][e].replace&&e.charCodeAt(0)!==55349&&!(OC.hasOwnProperty(e)&&r&&(r.fontFamily&&r.fontFamily.slice(4,6)==="tt"||r.font&&r.font.slice(4,6)==="tt"))&&(e=kr[t][e].replace),new Dt.TextNode(e)},A4=function(e){return e.length===1?e[0]:new Dt.MathNode("mrow",e)},C4=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";var r=t.font;if(!r||r==="mathnormal")return null;var i=e.mode;if(r==="mathit")return"italic";if(r==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(r==="mathbf")return"bold";if(r==="mathbb")return"double-struck";if(r==="mathfrak")return"fraktur";if(r==="mathscr"||r==="mathcal")return"script";if(r==="mathsf")return"sans-serif";if(r==="mathtt")return"monospace";var o=e.text;if(Dn.contains(["\\imath","\\jmath"],o))return null;kr[i][o]&&kr[i][o].replace&&(o=kr[i][o].replace);var u=et.fontMap[r].fontName;return M4(o,u,i)?et.fontMap[r].variant:null},qa=function(e,t,r){if(e.length===1){var i=Pr(e[0],t);return r&&i instanceof Ps&&i.type==="mo"&&(i.setAttribute("lspace","0em"),i.setAttribute("rspace","0em")),[i]}for(var o=[],u,l=0;l<e.length;l++){var p=Pr(e[l],t);if(p instanceof Ps&&u instanceof Ps){if(p.type==="mtext"&&u.type==="mtext"&&p.getAttribute("mathvariant")===u.getAttribute("mathvariant")){u.children.push(...p.children);continue}else if(p.type==="mn"&&u.type==="mn"){u.children.push(...p.children);continue}else if(p.type==="mi"&&p.children.length===1&&u.type==="mn"){var v=p.children[0];if(v instanceof Tp&&v.text==="."){u.children.push(...p.children);continue}}else if(u.type==="mi"&&u.children.length===1){var x=u.children[0];if(x instanceof Tp&&x.text===""&&(p.type==="mo"||p.type==="mi"||p.type==="mn")){var M=p.children[0];M instanceof Tp&&M.text.length>0&&(M.text=M.text.slice(0,1)+""+M.text.slice(1),o.pop())}}}o.push(p),u=p}return o},Xc=function(e,t,r){return A4(qa(e,t,r))},Pr=function(e,t){if(!e)return new Dt.MathNode("mrow");if(qy[e.type]){var r=qy[e.type](e,t);return r}else throw new Ut("Got group of unknown type: '"+e.type+"'")};function w6(n,e,t,r,i){var o=qa(n,t),u;o.length===1&&o[0]instanceof Ps&&Dn.contains(["mrow","mtable"],o[0].type)?u=o[0]:u=new Dt.MathNode("mrow",o);var l=new Dt.MathNode("annotation",[new Dt.TextNode(e)]);l.setAttribute("encoding","application/x-tex");var p=new Dt.MathNode("semantics",[u,l]),v=new Dt.MathNode("math",[p]);v.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),r&&v.setAttribute("display","block");var x=i?"katex":"katex-mathml";return et.makeSpan([x],[v])}var $C=function(e){return new vl({style:e.displayMode?Ln.DISPLAY:Ln.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},qC=function(e,t){if(t.displayMode){var r=["katex-display"];t.leqno&&r.push("leqno"),t.fleqn&&r.push("fleqn"),e=et.makeSpan(r,[e])}return e},iY=function(e,t,r){var i=$C(r),o;if(r.output==="mathml")return w6(e,t,i,r.displayMode,!0);if(r.output==="html"){var u=$b(e,i);o=et.makeSpan(["katex"],[u])}else{var l=w6(e,t,i,r.displayMode,!1),p=$b(e,i);o=et.makeSpan(["katex"],[l,p])}return qC(o,r)},aY=function(e,t,r){var i=$C(r),o=$b(e,i),u=et.makeSpan(["katex"],[o]);return qC(u,r)},sY={widehat:"^",widecheck:"",widetilde:"~",utilde:"~",overleftarrow:"",underleftarrow:"",xleftarrow:"",overrightarrow:"",underrightarrow:"",xrightarrow:"",underbrace:"",overbrace:"",overgroup:"",undergroup:"",overleftrightarrow:"",underleftrightarrow:"",xleftrightarrow:"",Overrightarrow:"",xRightarrow:"",overleftharpoon:"",xleftharpoonup:"",overrightharpoon:"",xrightharpoonup:"",xLeftarrow:"",xLeftrightarrow:"",xhookleftarrow:"",xhookrightarrow:"",xmapsto:"",xrightharpoondown:"",xleftharpoondown:"",xrightleftharpoons:"",xleftrightharpoons:"",xtwoheadleftarrow:"",xtwoheadrightarrow:"",xlongequal:"=",xtofrom:"",xrightleftarrows:"",xrightequilibrium:"",xleftequilibrium:"","\\cdrightarrow":"","\\cdleftarrow":"","\\cdlongequal":"="},oY=function(e){var t=new Dt.MathNode("mo",[new Dt.TextNode(sY[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},lY={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},cY=function(e){return e.type==="ordgroup"?e.body.length:1},uY=function(e,t){function r(){var l=4e5,p=e.label.slice(1);if(Dn.contains(["widehat","widecheck","widetilde","utilde"],p)){var v=e,x=cY(v.base),M,w,A;if(x>5)p==="widehat"||p==="widecheck"?(M=420,l=2364,A=.42,w=p+"4"):(M=312,l=2340,A=.34,w="tilde4");else{var k=[1,1,2,2,3,3][x];p==="widehat"||p==="widecheck"?(l=[0,1062,2364,2364,2364][k],M=[0,239,300,360,420][k],A=[0,.24,.3,.3,.36,.42][k],w=p+k):(l=[0,600,1033,2339,2340][k],M=[0,260,286,306,312][k],A=[0,.26,.286,.3,.306,.34][k],w="tilde"+k)}var z=new qc(w),D=new kl([z],{width:"100%",height:qt(A),viewBox:"0 0 "+l+" "+M,preserveAspectRatio:"none"});return{span:et.makeSvgSpan([],[D],t),minWidth:0,height:A}}else{var C=[],U=lY[p],[B,K,ue]=U,Z=ue/1e3,ee=B.length,be,ie;if(ee===1){var Q=U[3];be=["hide-tail"],ie=[Q]}else if(ee===2)be=["halfarrow-left","halfarrow-right"],ie=["xMinYMin","xMaxYMin"];else if(ee===3)be=["brace-left","brace-center","brace-right"],ie=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+ee+" children.");for(var Ee=0;Ee<ee;Ee++){var Fe=new qc(B[Ee]),Ae=new kl([Fe],{width:"400em",height:qt(Z),viewBox:"0 0 "+l+" "+ue,preserveAspectRatio:ie[Ee]+" slice"}),Ve=et.makeSvgSpan([be[Ee]],[Ae],t);if(ee===1)return{span:Ve,minWidth:K,height:Z};Ve.style.height=qt(Z),C.push(Ve)}return{span:et.makeSpan(["stretchy"],C,t),minWidth:K,height:Z}}}var{span:i,minWidth:o,height:u}=r();return i.height=u,i.style.height=qt(u),o>0&&(i.style.minWidth=qt(o)),i},hY=function(e,t,r,i,o){var u,l=e.height+e.depth+r+i;if(/fbox|color|angl/.test(t)){if(u=et.makeSpan(["stretchy",t],[],o),t==="fbox"){var p=o.color&&o.getColor();p&&(u.style.borderColor=p)}}else{var v=[];/^[bx]cancel$/.test(t)&&v.push(new Gb({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&v.push(new Gb({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var x=new kl(v,{width:"100%",height:qt(l)});u=et.makeSvgSpan([],[x],o)}return u.height=l,u.style.height=qt(l),u},zl={encloseSpan:hY,mathMLnode:oY,svgSpan:uY};function Yn(n,e){if(!n||n.type!==e)throw new Error("Expected node of type "+e+", but got "+(n?"node of type "+n.type:String(n)));return n}function P4(n){var e=Iv(n);if(!e)throw new Error("Expected node of symbol group type, but got "+(n?"node of type "+n.type:String(n)));return e}function Iv(n){return n&&(n.type==="atom"||FZ.hasOwnProperty(n.type))?n:null}var R4=(n,e)=>{var t,r,i;n&&n.type==="supsub"?(r=Yn(n.base,"accent"),t=r.base,n.base=t,i=LZ(hr(n,e)),n.base=r):(r=Yn(n,"accent"),t=r.base);var o=hr(t,e.havingCrampedStyle()),u=r.isShifty&&Dn.isCharacterBox(t),l=0;if(u){var p=Dn.getBaseElem(t),v=hr(p,e.havingCrampedStyle());l=m6(v).skew}var x=r.label==="\\c",M=x?o.height+o.depth:Math.min(o.height,e.fontMetrics().xHeight),w;if(r.isStretchy)w=zl.svgSpan(r,e),w=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"elem",elem:w,wrapperClasses:["svg-align"],wrapperStyle:l>0?{width:"calc(100% - "+qt(2*l)+")",marginLeft:qt(2*l)}:void 0}]},e);else{var A,k;r.label==="\\vec"?(A=et.staticSvg("vec",e),k=et.svgData.vec[1]):(A=et.makeOrd({mode:r.mode,text:r.label},e,"textord"),A=m6(A),A.italic=0,k=A.width,x&&(M+=A.depth)),w=et.makeSpan(["accent-body"],[A]);var z=r.label==="\\textcircled";z&&(w.classes.push("accent-full"),M=o.height);var D=l;z||(D-=k/2),w.style.left=qt(D),r.label==="\\textcircled"&&(w.style.top=".2em"),w=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:-M},{type:"elem",elem:w}]},e)}var C=et.makeSpan(["mord","accent"],[w],e);return i?(i.children[0]=C,i.height=Math.max(C.height,i.height),i.classes[0]="mord",i):C},XC=(n,e)=>{var t=n.isStretchy?zl.mathMLnode(n.label):new Dt.MathNode("mo",[Bs(n.label,n.mode)]),r=new Dt.MathNode("mover",[Pr(n.base,e),t]);return r.setAttribute("accent","true"),r},dY=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(n=>"\\"+n).join("|"));cn({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(n,e)=>{var t=Xy(e[0]),r=!dY.test(n.funcName),i=!r||n.funcName==="\\widehat"||n.funcName==="\\widetilde"||n.funcName==="\\widecheck";return{type:"accent",mode:n.parser.mode,label:n.funcName,isStretchy:r,isShifty:i,base:t}},htmlBuilder:R4,mathmlBuilder:XC});cn({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(n,e)=>{var t=e[0],r=n.parser.mode;return r==="math"&&(n.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+n.funcName+" works only in text mode"),r="text"),{type:"accent",mode:r,label:n.funcName,isStretchy:!1,isShifty:!0,base:t}},htmlBuilder:R4,mathmlBuilder:XC});cn({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"accentUnder",mode:t.mode,label:r,base:i}},htmlBuilder:(n,e)=>{var t=hr(n.base,e),r=zl.svgSpan(n,e),i=n.label==="\\utilde"?.12:0,o=et.makeVList({positionType:"top",positionData:t.height,children:[{type:"elem",elem:r,wrapperClasses:["svg-align"]},{type:"kern",size:i},{type:"elem",elem:t}]},e);return et.makeSpan(["mord","accentunder"],[o],e)},mathmlBuilder:(n,e)=>{var t=zl.mathMLnode(n.label),r=new Dt.MathNode("munder",[Pr(n.base,e),t]);return r.setAttribute("accentunder","true"),r}});var P1=n=>{var e=new Dt.MathNode("mpadded",n?[n]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};cn({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r,funcName:i}=n;return{type:"xArrow",mode:r.mode,label:i,body:e[0],below:t[0]}},htmlBuilder(n,e){var t=e.style,r=e.havingStyle(t.sup()),i=et.wrapFragment(hr(n.body,r,e),e),o=n.label.slice(0,2)==="\\x"?"x":"cd";i.classes.push(o+"-arrow-pad");var u;n.below&&(r=e.havingStyle(t.sub()),u=et.wrapFragment(hr(n.below,r,e),e),u.classes.push(o+"-arrow-pad"));var l=zl.svgSpan(n,e),p=-e.fontMetrics().axisHeight+.5*l.height,v=-e.fontMetrics().axisHeight-.5*l.height-.111;(i.depth>.25||n.label==="\\xleftequilibrium")&&(v-=i.depth);var x;if(u){var M=-e.fontMetrics().axisHeight+u.height+.5*l.height+.111;x=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:v},{type:"elem",elem:l,shift:p},{type:"elem",elem:u,shift:M}]},e)}else x=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:i,shift:v},{type:"elem",elem:l,shift:p}]},e);return x.children[0].children[0].children[1].classes.push("svg-align"),et.makeSpan(["mrel","x-arrow"],[x],e)},mathmlBuilder(n,e){var t=zl.mathMLnode(n.label);t.setAttribute("minsize",n.label.charAt(0)==="x"?"1.75em":"3.0em");var r;if(n.body){var i=P1(Pr(n.body,e));if(n.below){var o=P1(Pr(n.below,e));r=new Dt.MathNode("munderover",[t,o,i])}else r=new Dt.MathNode("mover",[t,i])}else if(n.below){var u=P1(Pr(n.below,e));r=new Dt.MathNode("munder",[t,u])}else r=P1(),r=new Dt.MathNode("mover",[t,r]);return r}});var fY=et.makeSpan;function ZC(n,e){var t=Ci(n.body,e,!0);return fY([n.mclass],t,e)}function YC(n,e){var t,r=qa(n.body,e);return n.mclass==="minner"?t=new Dt.MathNode("mpadded",r):n.mclass==="mord"?n.isCharacterBox?(t=r[0],t.type="mi"):t=new Dt.MathNode("mi",r):(n.isCharacterBox?(t=r[0],t.type="mo"):t=new Dt.MathNode("mo",r),n.mclass==="mbin"?(t.attributes.lspace="0.22em",t.attributes.rspace="0.22em"):n.mclass==="mpunct"?(t.attributes.lspace="0em",t.attributes.rspace="0.17em"):n.mclass==="mopen"||n.mclass==="mclose"?(t.attributes.lspace="0em",t.attributes.rspace="0em"):n.mclass==="minner"&&(t.attributes.lspace="0.0556em",t.attributes.width="+0.1111em")),t}cn({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"mclass",mode:t.mode,mclass:"m"+r.slice(5),body:mi(i),isCharacterBox:Dn.isCharacterBox(i)}},htmlBuilder:ZC,mathmlBuilder:YC});var Dv=n=>{var e=n.type==="ordgroup"&&n.body.length?n.body[0]:n;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};cn({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(n,e){var{parser:t}=n;return{type:"mclass",mode:t.mode,mclass:Dv(e[0]),body:mi(e[1]),isCharacterBox:Dn.isCharacterBox(e[1])}}});cn({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(n,e){var{parser:t,funcName:r}=n,i=e[1],o=e[0],u;r!=="\\stackrel"?u=Dv(i):u="mrel";var l={type:"op",mode:i.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:r!=="\\stackrel",body:mi(i)},p={type:"supsub",mode:o.mode,base:l,sup:r==="\\underset"?null:o,sub:r==="\\underset"?o:null};return{type:"mclass",mode:t.mode,mclass:u,body:[p],isCharacterBox:Dn.isCharacterBox(p)}},htmlBuilder:ZC,mathmlBuilder:YC});cn({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"pmb",mode:t.mode,mclass:Dv(e[0]),body:mi(e[0])}},htmlBuilder(n,e){var t=Ci(n.body,e,!0),r=et.makeSpan([n.mclass],t,e);return r.style.textShadow="0.02em 0.01em 0.04px",r},mathmlBuilder(n,e){var t=qa(n.body,e),r=new Dt.MathNode("mstyle",t);return r.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),r}});var pY={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},S6=()=>({type:"styling",body:[],mode:"math",style:"display"}),M6=n=>n.type==="textord"&&n.text==="@",mY=(n,e)=>(n.type==="mathord"||n.type==="atom")&&n.text===e;function gY(n,e,t){var r=pY[n];switch(r){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return t.callFunction(r,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var i=t.callFunction("\\\\cdleft",[e[0]],[]),o={type:"atom",text:r,mode:"math",family:"rel"},u=t.callFunction("\\Big",[o],[]),l=t.callFunction("\\\\cdright",[e[1]],[]),p={type:"ordgroup",mode:"math",body:[i,u,l]};return t.callFunction("\\\\cdparent",[p],[])}case"\\\\cdlongequal":return t.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var v={type:"textord",text:"\\Vert",mode:"math"};return t.callFunction("\\Big",[v],[])}default:return{type:"textord",text:" ",mode:"math"}}}function yY(n){var e=[];for(n.gullet.beginGroup(),n.gullet.macros.set("\\cr","\\\\\\relax"),n.gullet.beginGroup();;){e.push(n.parseExpression(!1,"\\\\")),n.gullet.endGroup(),n.gullet.beginGroup();var t=n.fetch().text;if(t==="&"||t==="\\\\")n.consume();else if(t==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new Ut("Expected \\\\ or \\cr or \\end",n.nextToken)}for(var r=[],i=[r],o=0;o<e.length;o++){for(var u=e[o],l=S6(),p=0;p<u.length;p++)if(!M6(u[p]))l.body.push(u[p]);else{r.push(l),p+=1;var v=P4(u[p]).text,x=new Array(2);if(x[0]={type:"ordgroup",mode:"math",body:[]},x[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(v)>-1))if("<>AV".indexOf(v)>-1)for(var M=0;M<2;M++){for(var w=!0,A=p+1;A<u.length;A++){if(mY(u[A],v)){w=!1,p=A;break}if(M6(u[A]))throw new Ut("Missing a "+v+" character to complete a CD arrow.",u[A]);x[M].body.push(u[A])}if(w)throw new Ut("Missing a "+v+" character to complete a CD arrow.",u[p])}else throw new Ut('Expected one of "<>AV=|." after @',u[p]);var k=gY(v,x,n),z={type:"styling",body:[k],mode:"math",style:"display"};r.push(z),l=S6()}o%2===0?r.push(l):r.shift(),r=[],i.push(r)}n.gullet.endGroup(),n.gullet.endGroup();var D=new Array(i[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:i,arraystretch:1,addJot:!0,rowGaps:[null],cols:D,colSeparationType:"CD",hLinesBeforeRow:new Array(i.length+1).fill([])}}cn({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"cdlabel",mode:t.mode,side:r.slice(4),label:e[0]}},htmlBuilder(n,e){var t=e.havingStyle(e.style.sup()),r=et.wrapFragment(hr(n.label,t,e),e);return r.classes.push("cd-label-"+n.side),r.style.bottom=qt(.8-r.depth),r.height=0,r.depth=0,r},mathmlBuilder(n,e){var t=new Dt.MathNode("mrow",[Pr(n.label,e)]);return t=new Dt.MathNode("mpadded",[t]),t.setAttribute("width","0"),n.side==="left"&&t.setAttribute("lspace","-1width"),t.setAttribute("voffset","0.7em"),t=new Dt.MathNode("mstyle",[t]),t.setAttribute("displaystyle","false"),t.setAttribute("scriptlevel","1"),t}});cn({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(n,e){var{parser:t}=n;return{type:"cdlabelparent",mode:t.mode,fragment:e[0]}},htmlBuilder(n,e){var t=et.wrapFragment(hr(n.fragment,e),e);return t.classes.push("cd-vert-arrow"),t},mathmlBuilder(n,e){return new Dt.MathNode("mrow",[Pr(n.fragment,e)])}});cn({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(n,e){for(var{parser:t}=n,r=Yn(e[0],"ordgroup"),i=r.body,o="",u=0;u<i.length;u++){var l=Yn(i[u],"textord");o+=l.text}var p=parseInt(o),v;if(isNaN(p))throw new Ut("\\@char has non-numeric argument "+o);if(p<0||p>=1114111)throw new Ut("\\@char with invalid code point "+o);return p<=65535?v=String.fromCharCode(p):(p-=65536,v=String.fromCharCode((p>>10)+55296,(p&1023)+56320)),{type:"textord",mode:t.mode,text:v}}});var KC=(n,e)=>{var t=Ci(n.body,e.withColor(n.color),!1);return et.makeFragment(t)},JC=(n,e)=>{var t=qa(n.body,e.withColor(n.color)),r=new Dt.MathNode("mstyle",t);return r.setAttribute("mathcolor",n.color),r};cn({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(n,e){var{parser:t}=n,r=Yn(e[0],"color-token").color,i=e[1];return{type:"color",mode:t.mode,color:r,body:mi(i)}},htmlBuilder:KC,mathmlBuilder:JC});cn({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(n,e){var{parser:t,breakOnTokenText:r}=n,i=Yn(e[0],"color-token").color;t.gullet.macros.set("\\current@color",i);var o=t.parseExpression(!0,r);return{type:"color",mode:t.mode,color:i,body:o}},htmlBuilder:KC,mathmlBuilder:JC});cn({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(n,e,t){var{parser:r}=n,i=r.gullet.future().text==="["?r.parseSizeGroup(!0):null,o=!r.settings.displayMode||!r.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:r.mode,newLine:o,size:i&&Yn(i,"size").value}},htmlBuilder(n,e){var t=et.makeSpan(["mspace"],[],e);return n.newLine&&(t.classes.push("newline"),n.size&&(t.style.marginTop=qt(Zr(n.size,e)))),t},mathmlBuilder(n,e){var t=new Dt.MathNode("mspace");return n.newLine&&(t.setAttribute("linebreak","newline"),n.size&&t.setAttribute("height",qt(Zr(n.size,e)))),t}});var qb={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},QC=n=>{var e=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new Ut("Expected a control sequence",n);return e},vY=n=>{var e=n.gullet.popToken();return e.text==="="&&(e=n.gullet.popToken(),e.text===" "&&(e=n.gullet.popToken())),e},eP=(n,e,t,r)=>{var i=n.gullet.macros.get(t.text);i==null&&(t.noexpand=!0,i={tokens:[t],numArgs:0,unexpandable:!n.gullet.isExpandable(t.text)}),n.gullet.macros.set(e,i,r)};cn({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e,funcName:t}=n;e.consumeSpaces();var r=e.fetch();if(qb[r.text])return(t==="\\global"||t==="\\\\globallong")&&(r.text=qb[r.text]),Yn(e.parseFunction(),"internal");throw new Ut("Invalid token after macro prefix",r)}});cn({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=e.gullet.popToken(),i=r.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(i))throw new Ut("Expected a control sequence",r);for(var o=0,u,l=[[]];e.gullet.future().text!=="{";)if(r=e.gullet.popToken(),r.text==="#"){if(e.gullet.future().text==="{"){u=e.gullet.future(),l[o].push("{");break}if(r=e.gullet.popToken(),!/^[1-9]$/.test(r.text))throw new Ut('Invalid argument number "'+r.text+'"');if(parseInt(r.text)!==o+1)throw new Ut('Argument number "'+r.text+'" out of order');o++,l.push([])}else{if(r.text==="EOF")throw new Ut("Expected a macro definition");l[o].push(r.text)}var{tokens:p}=e.gullet.consumeArg();return u&&p.unshift(u),(t==="\\edef"||t==="\\xdef")&&(p=e.gullet.expandTokens(p),p.reverse()),e.gullet.macros.set(i,{tokens:p,numArgs:o,delimiters:l},t===qb[t]),{type:"internal",mode:e.mode}}});cn({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=QC(e.gullet.popToken());e.gullet.consumeSpaces();var i=vY(e);return eP(e,r,i,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});cn({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,r=QC(e.gullet.popToken()),i=e.gullet.popToken(),o=e.gullet.popToken();return eP(e,r,o,t==="\\\\globalfuture"),e.gullet.pushToken(o),e.gullet.pushToken(i),{type:"internal",mode:e.mode}}});var hp=function(e,t,r){var i=kr.math[e]&&kr.math[e].replace,o=M4(i||e,t,r);if(!o)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return o},I4=function(e,t,r,i){var o=r.havingBaseStyle(t),u=et.makeSpan(i.concat(o.sizingClasses(r)),[e],r),l=o.sizeMultiplier/r.sizeMultiplier;return u.height*=l,u.depth*=l,u.maxFontSize=o.sizeMultiplier,u},tP=function(e,t,r){var i=t.havingBaseStyle(r),o=(1-t.sizeMultiplier/i.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=qt(o),e.height-=o,e.depth+=o},_Y=function(e,t,r,i,o,u){var l=et.makeSymbol(e,"Main-Regular",o,i),p=I4(l,t,i,u);return r&&tP(p,i,t),p},xY=function(e,t,r,i){return et.makeSymbol(e,"Size"+t+"-Regular",r,i)},nP=function(e,t,r,i,o,u){var l=xY(e,t,o,i),p=I4(et.makeSpan(["delimsizing","size"+t],[l],i),Ln.TEXT,i,u);return r&&tP(p,i,Ln.TEXT),p},c2=function(e,t,r){var i;t==="Size1-Regular"?i="delim-size1":i="delim-size4";var o=et.makeSpan(["delimsizinginner",i],[et.makeSpan([],[et.makeSymbol(e,t,r)])]);return{type:"elem",elem:o}},u2=function(e,t,r){var i=Io["Size4-Regular"][e.charCodeAt(0)]?Io["Size4-Regular"][e.charCodeAt(0)][4]:Io["Size1-Regular"][e.charCodeAt(0)][4],o=new qc("inner",EZ(e,Math.round(1e3*t))),u=new kl([o],{width:qt(i),height:qt(t),style:"width:"+qt(i),viewBox:"0 0 "+1e3*i+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),l=et.makeSvgSpan([],[u],r);return l.height=t,l.style.height=qt(t),l.style.width=qt(i),{type:"elem",elem:l}},Xb=.008,R1={type:"kern",size:-1*Xb},bY=["|","\\lvert","\\rvert","\\vert"],wY=["\\|","\\lVert","\\rVert","\\Vert"],rP=function(e,t,r,i,o,u){var l,p,v,x,M="",w=0;l=v=x=e,p=null;var A="Size1-Regular";e==="\\uparrow"?v=x="":e==="\\Uparrow"?v=x="":e==="\\downarrow"?l=v="":e==="\\Downarrow"?l=v="":e==="\\updownarrow"?(l="\\uparrow",v="",x="\\downarrow"):e==="\\Updownarrow"?(l="\\Uparrow",v="",x="\\Downarrow"):Dn.contains(bY,e)?(v="",M="vert",w=333):Dn.contains(wY,e)?(v="",M="doublevert",w=556):e==="["||e==="\\lbrack"?(l="",v="",x="",A="Size4-Regular",M="lbrack",w=667):e==="]"||e==="\\rbrack"?(l="",v="",x="",A="Size4-Regular",M="rbrack",w=667):e==="\\lfloor"||e===""?(v=l="",x="",A="Size4-Regular",M="lfloor",w=667):e==="\\lceil"||e===""?(l="",v=x="",A="Size4-Regular",M="lceil",w=667):e==="\\rfloor"||e===""?(v=l="",x="",A="Size4-Regular",M="rfloor",w=667):e==="\\rceil"||e===""?(l="",v=x="",A="Size4-Regular",M="rceil",w=667):e==="("||e==="\\lparen"?(l="",v="",x="",A="Size4-Regular",M="lparen",w=875):e===")"||e==="\\rparen"?(l="",v="",x="",A="Size4-Regular",M="rparen",w=875):e==="\\{"||e==="\\lbrace"?(l="",p="",x="",v="",A="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(l="",p="",x="",v="",A="Size4-Regular"):e==="\\lgroup"||e===""?(l="",x="",v="",A="Size4-Regular"):e==="\\rgroup"||e===""?(l="",x="",v="",A="Size4-Regular"):e==="\\lmoustache"||e===""?(l="",x="",v="",A="Size4-Regular"):(e==="\\rmoustache"||e==="")&&(l="",x="",v="",A="Size4-Regular");var k=hp(l,A,o),z=k.height+k.depth,D=hp(v,A,o),C=D.height+D.depth,U=hp(x,A,o),B=U.height+U.depth,K=0,ue=1;if(p!==null){var Z=hp(p,A,o);K=Z.height+Z.depth,ue=2}var ee=z+B+K,be=Math.max(0,Math.ceil((t-ee)/(ue*C))),ie=ee+be*ue*C,Q=i.fontMetrics().axisHeight;r&&(Q*=i.sizeMultiplier);var Ee=ie/2-Q,Fe=[];if(M.length>0){var Ae=ie-z-B,Ve=Math.round(ie*1e3),lt=AZ(M,Math.round(Ae*1e3)),ut=new qc(M,lt),pt=(w/1e3).toFixed(3)+"em",ke=(Ve/1e3).toFixed(3)+"em",Je=new kl([ut],{width:pt,height:ke,viewBox:"0 0 "+w+" "+Ve}),tt=et.makeSvgSpan([],[Je],i);tt.height=Ve/1e3,tt.style.width=pt,tt.style.height=ke,Fe.push({type:"elem",elem:tt})}else{if(Fe.push(c2(x,A,o)),Fe.push(R1),p===null){var _t=ie-z-B+2*Xb;Fe.push(u2(v,_t,i))}else{var Lt=(ie-z-B-K)/2+2*Xb;Fe.push(u2(v,Lt,i)),Fe.push(R1),Fe.push(c2(p,A,o)),Fe.push(R1),Fe.push(u2(v,Lt,i))}Fe.push(R1),Fe.push(c2(l,A,o))}var Cn=i.havingBaseStyle(Ln.TEXT),nt=et.makeVList({positionType:"bottom",positionData:Ee,children:Fe},Cn);return I4(et.makeSpan(["delimsizing","mult"],[nt],Cn),Ln.TEXT,i,u)},h2=80,d2=.08,f2=function(e,t,r,i,o){var u=TZ(e,i,r),l=new qc(e,u),p=new kl([l],{width:"400em",height:qt(t),viewBox:"0 0 400000 "+r,preserveAspectRatio:"xMinYMin slice"});return et.makeSvgSpan(["hide-tail"],[p],o)},SY=function(e,t){var r=t.havingBaseSizing(),i=oP("\\surd",e*r.sizeMultiplier,sP,r),o=r.sizeMultiplier,u=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),l,p=0,v=0,x=0,M;return i.type==="small"?(x=1e3+1e3*u+h2,e<1?o=1:e<1.4&&(o=.7),p=(1+u+d2)/o,v=(1+u)/o,l=f2("sqrtMain",p,x,u,t),l.style.minWidth="0.853em",M=.833/o):i.type==="large"?(x=(1e3+h2)*Ep[i.size],v=(Ep[i.size]+u)/o,p=(Ep[i.size]+u+d2)/o,l=f2("sqrtSize"+i.size,p,x,u,t),l.style.minWidth="1.02em",M=1/o):(p=e+u+d2,v=e+u,x=Math.floor(1e3*e+u)+h2,l=f2("sqrtTall",p,x,u,t),l.style.minWidth="0.742em",M=1.056),l.height=v,l.style.height=qt(p),{span:l,advanceWidth:M,ruleWidth:(t.fontMetrics().sqrtRuleThickness+u)*o}},iP=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","\\surd"],MY=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","",""],aP=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],Ep=[0,1.2,1.8,2.4,3],TY=function(e,t,r,i,o){if(e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle"),Dn.contains(iP,e)||Dn.contains(aP,e))return nP(e,t,!1,r,i,o);if(Dn.contains(MY,e))return rP(e,Ep[t],!1,r,i,o);throw new Ut("Illegal delimiter: '"+e+"'")},EY=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],AY=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"stack"}],sP=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],CY=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},oP=function(e,t,r,i){for(var o=Math.min(2,3-i.style.size),u=o;u<r.length&&r[u].type!=="stack";u++){var l=hp(e,CY(r[u]),"math"),p=l.height+l.depth;if(r[u].type==="small"){var v=i.havingBaseStyle(r[u].style);p*=v.sizeMultiplier}if(p>t)return r[u]}return r[r.length-1]},lP=function(e,t,r,i,o,u){e==="<"||e==="\\lt"||e===""?e="\\langle":(e===">"||e==="\\gt"||e==="")&&(e="\\rangle");var l;Dn.contains(aP,e)?l=EY:Dn.contains(iP,e)?l=sP:l=AY;var p=oP(e,t,l,i);return p.type==="small"?_Y(e,p.style,r,i,o,u):p.type==="large"?nP(e,p.size,r,i,o,u):rP(e,t,r,i,o,u)},PY=function(e,t,r,i,o,u){var l=i.fontMetrics().axisHeight*i.sizeMultiplier,p=901,v=5/i.fontMetrics().ptPerEm,x=Math.max(t-l,r+l),M=Math.max(x/500*p,2*x-v);return lP(e,M,!0,i,o,u)},Tl={sqrtImage:SY,sizedDelim:TY,sizeToMaxHeight:Ep,customSizedDelim:lP,leftRightDelim:PY},T6={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},RY=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","","","\\lceil","\\rceil","","","<",">","\\langle","","\\rangle","","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","","","\\lmoustache","\\rmoustache","","","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function kv(n,e){var t=Iv(n);if(t&&Dn.contains(RY,t.text))return t;throw t?new Ut("Invalid delimiter '"+t.text+"' after '"+e.funcName+"'",n):new Ut("Invalid delimiter type '"+n.type+"'",n)}cn({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(n,e)=>{var t=kv(e[0],n);return{type:"delimsizing",mode:n.parser.mode,size:T6[n.funcName].size,mclass:T6[n.funcName].mclass,delim:t.text}},htmlBuilder:(n,e)=>n.delim==="."?et.makeSpan([n.mclass]):Tl.sizedDelim(n.delim,n.size,e,n.mode,[n.mclass]),mathmlBuilder:n=>{var e=[];n.delim!=="."&&e.push(Bs(n.delim,n.mode));var t=new Dt.MathNode("mo",e);n.mclass==="mopen"||n.mclass==="mclose"?t.setAttribute("fence","true"):t.setAttribute("fence","false"),t.setAttribute("stretchy","true");var r=qt(Tl.sizeToMaxHeight[n.size]);return t.setAttribute("minsize",r),t.setAttribute("maxsize",r),t}});function E6(n){if(!n.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}cn({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=n.parser.gullet.macros.get("\\current@color");if(t&&typeof t!="string")throw new Ut("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:n.parser.mode,delim:kv(e[0],n).text,color:t}}});cn({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=kv(e[0],n),r=n.parser;++r.leftrightDepth;var i=r.parseExpression(!1);--r.leftrightDepth,r.expect("\\right",!1);var o=Yn(r.parseFunction(),"leftright-right");return{type:"leftright",mode:r.mode,body:i,left:t.text,right:o.delim,rightColor:o.color}},htmlBuilder:(n,e)=>{E6(n);for(var t=Ci(n.body,e,!0,["mopen","mclose"]),r=0,i=0,o=!1,u=0;u<t.length;u++)t[u].isMiddle?o=!0:(r=Math.max(t[u].height,r),i=Math.max(t[u].depth,i));r*=e.sizeMultiplier,i*=e.sizeMultiplier;var l;if(n.left==="."?l=rm(e,["mopen"]):l=Tl.leftRightDelim(n.left,r,i,e,n.mode,["mopen"]),t.unshift(l),o)for(var p=1;p<t.length;p++){var v=t[p],x=v.isMiddle;x&&(t[p]=Tl.leftRightDelim(x.delim,r,i,x.options,n.mode,[]))}var M;if(n.right===".")M=rm(e,["mclose"]);else{var w=n.rightColor?e.withColor(n.rightColor):e;M=Tl.leftRightDelim(n.right,r,i,w,n.mode,["mclose"])}return t.push(M),et.makeSpan(["minner"],t,e)},mathmlBuilder:(n,e)=>{E6(n);var t=qa(n.body,e);if(n.left!=="."){var r=new Dt.MathNode("mo",[Bs(n.left,n.mode)]);r.setAttribute("fence","true"),t.unshift(r)}if(n.right!=="."){var i=new Dt.MathNode("mo",[Bs(n.right,n.mode)]);i.setAttribute("fence","true"),n.rightColor&&i.setAttribute("mathcolor",n.rightColor),t.push(i)}return A4(t)}});cn({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=kv(e[0],n);if(!n.parser.leftrightDepth)throw new Ut("\\middle without preceding \\left",t);return{type:"middle",mode:n.parser.mode,delim:t.text}},htmlBuilder:(n,e)=>{var t;if(n.delim===".")t=rm(e,[]);else{t=Tl.sizedDelim(n.delim,1,e,n.mode,[]);var r={delim:n.delim,options:e};t.isMiddle=r}return t},mathmlBuilder:(n,e)=>{var t=n.delim==="\\vert"||n.delim==="|"?Bs("|","text"):Bs(n.delim,n.mode),r=new Dt.MathNode("mo",[t]);return r.setAttribute("fence","true"),r.setAttribute("lspace","0.05em"),r.setAttribute("rspace","0.05em"),r}});var D4=(n,e)=>{var t=et.wrapFragment(hr(n.body,e),e),r=n.label.slice(1),i=e.sizeMultiplier,o,u=0,l=Dn.isCharacterBox(n.body);if(r==="sout")o=et.makeSpan(["stretchy","sout"]),o.height=e.fontMetrics().defaultRuleThickness/i,u=-.5*e.fontMetrics().xHeight;else if(r==="phase"){var p=Zr({number:.6,unit:"pt"},e),v=Zr({number:.35,unit:"ex"},e),x=e.havingBaseSizing();i=i/x.sizeMultiplier;var M=t.height+t.depth+p+v;t.style.paddingLeft=qt(M/2+p);var w=Math.floor(1e3*M*i),A=SZ(w),k=new kl([new qc("phase",A)],{width:"400em",height:qt(w/1e3),viewBox:"0 0 400000 "+w,preserveAspectRatio:"xMinYMin slice"});o=et.makeSvgSpan(["hide-tail"],[k],e),o.style.height=qt(M),u=t.depth+p+v}else{/cancel/.test(r)?l||t.classes.push("cancel-pad"):r==="angl"?t.classes.push("anglpad"):t.classes.push("boxpad");var z=0,D=0,C=0;/box/.test(r)?(C=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),z=e.fontMetrics().fboxsep+(r==="colorbox"?0:C),D=z):r==="angl"?(C=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),z=4*C,D=Math.max(0,.25-t.depth)):(z=l?.2:0,D=z),o=zl.encloseSpan(t,r,z,D,e),/fbox|boxed|fcolorbox/.test(r)?(o.style.borderStyle="solid",o.style.borderWidth=qt(C)):r==="angl"&&C!==.049&&(o.style.borderTopWidth=qt(C),o.style.borderRightWidth=qt(C)),u=t.depth+D,n.backgroundColor&&(o.style.backgroundColor=n.backgroundColor,n.borderColor&&(o.style.borderColor=n.borderColor))}var U;if(n.backgroundColor)U=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:o,shift:u},{type:"elem",elem:t,shift:0}]},e);else{var B=/cancel|phase/.test(r)?["svg-align"]:[];U=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:t,shift:0},{type:"elem",elem:o,shift:u,wrapperClasses:B}]},e)}return/cancel/.test(r)&&(U.height=t.height,U.depth=t.depth),/cancel/.test(r)&&!l?et.makeSpan(["mord","cancel-lap"],[U],e):et.makeSpan(["mord"],[U],e)},k4=(n,e)=>{var t=0,r=new Dt.MathNode(n.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Pr(n.body,e)]);switch(n.label){case"\\cancel":r.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":r.setAttribute("notation","downdiagonalstrike");break;case"\\phase":r.setAttribute("notation","phasorangle");break;case"\\sout":r.setAttribute("notation","horizontalstrike");break;case"\\fbox":r.setAttribute("notation","box");break;case"\\angl":r.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(t=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,r.setAttribute("width","+"+2*t+"pt"),r.setAttribute("height","+"+2*t+"pt"),r.setAttribute("lspace",t+"pt"),r.setAttribute("voffset",t+"pt"),n.label==="\\fcolorbox"){var i=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);r.setAttribute("style","border: "+i+"em solid "+String(n.borderColor))}break;case"\\xcancel":r.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return n.backgroundColor&&r.setAttribute("mathbackground",n.backgroundColor),r};cn({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(n,e,t){var{parser:r,funcName:i}=n,o=Yn(e[0],"color-token").color,u=e[1];return{type:"enclose",mode:r.mode,label:i,backgroundColor:o,body:u}},htmlBuilder:D4,mathmlBuilder:k4});cn({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(n,e,t){var{parser:r,funcName:i}=n,o=Yn(e[0],"color-token").color,u=Yn(e[1],"color-token").color,l=e[2];return{type:"enclose",mode:r.mode,label:i,backgroundColor:u,borderColor:o,body:l}},htmlBuilder:D4,mathmlBuilder:k4});cn({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\fbox",body:e[0]}}});cn({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"enclose",mode:t.mode,label:r,body:i}},htmlBuilder:D4,mathmlBuilder:k4});cn({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\angl",body:e[0]}}});var cP={};function Bo(n){for(var{type:e,names:t,props:r,handler:i,htmlBuilder:o,mathmlBuilder:u}=n,l={type:e,numArgs:r.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:i},p=0;p<t.length;++p)cP[t[p]]=l;o&&($y[e]=o),u&&(qy[e]=u)}var uP={};function he(n,e){uP[n]=e}function A6(n){var e=[];n.consumeSpaces();var t=n.fetch().text;for(t==="\\relax"&&(n.consume(),n.consumeSpaces(),t=n.fetch().text);t==="\\hline"||t==="\\hdashline";)n.consume(),e.push(t==="\\hdashline"),n.consumeSpaces(),t=n.fetch().text;return e}var Lv=n=>{var e=n.parser.settings;if(!e.displayMode)throw new Ut("{"+n.envName+"} can be used only in display mode.")};function L4(n){if(n.indexOf("ed")===-1)return n.indexOf("*")===-1}function nu(n,e,t){var{hskipBeforeAndAfter:r,addJot:i,cols:o,arraystretch:u,colSeparationType:l,autoTag:p,singleRow:v,emptySingleRow:x,maxNumCols:M,leqno:w}=e;if(n.gullet.beginGroup(),v||n.gullet.macros.set("\\cr","\\\\\\relax"),!u){var A=n.gullet.expandMacroAsText("\\arraystretch");if(A==null)u=1;else if(u=parseFloat(A),!u||u<0)throw new Ut("Invalid \\arraystretch: "+A)}n.gullet.beginGroup();var k=[],z=[k],D=[],C=[],U=p!=null?[]:void 0;function B(){p&&n.gullet.macros.set("\\@eqnsw","1",!0)}function K(){U&&(n.gullet.macros.get("\\df@tag")?(U.push(n.subparse([new zs("\\df@tag")])),n.gullet.macros.set("\\df@tag",void 0,!0)):U.push(!!p&&n.gullet.macros.get("\\@eqnsw")==="1"))}for(B(),C.push(A6(n));;){var ue=n.parseExpression(!1,v?"\\end":"\\\\");n.gullet.endGroup(),n.gullet.beginGroup(),ue={type:"ordgroup",mode:n.mode,body:ue},t&&(ue={type:"styling",mode:n.mode,style:t,body:[ue]}),k.push(ue);var Z=n.fetch().text;if(Z==="&"){if(M&&k.length===M){if(v||l)throw new Ut("Too many tab characters: &",n.nextToken);n.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}n.consume()}else if(Z==="\\end"){K(),k.length===1&&ue.type==="styling"&&ue.body[0].body.length===0&&(z.length>1||!x)&&z.pop(),C.length<z.length+1&&C.push([]);break}else if(Z==="\\\\"){n.consume();var ee=void 0;n.gullet.future().text!==" "&&(ee=n.parseSizeGroup(!0)),D.push(ee?ee.value:null),K(),C.push(A6(n)),k=[],z.push(k),B()}else throw new Ut("Expected & or \\\\ or \\cr or \\end",n.nextToken)}return n.gullet.endGroup(),n.gullet.endGroup(),{type:"array",mode:n.mode,addJot:i,arraystretch:u,body:z,cols:o,rowGaps:D,hskipBeforeAndAfter:r,hLinesBeforeRow:C,colSeparationType:l,tags:U,leqno:w}}function z4(n){return n.slice(0,1)==="d"?"display":"text"}var Uo=function(e,t){var r,i,o=e.body.length,u=e.hLinesBeforeRow,l=0,p=new Array(o),v=[],x=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),M=1/t.fontMetrics().ptPerEm,w=5*M;if(e.colSeparationType&&e.colSeparationType==="small"){var A=t.havingStyle(Ln.SCRIPT).sizeMultiplier;w=.2778*(A/t.sizeMultiplier)}var k=e.colSeparationType==="CD"?Zr({number:3,unit:"ex"},t):12*M,z=3*M,D=e.arraystretch*k,C=.7*D,U=.3*D,B=0;function K(le){for(var st=0;st<le.length;++st)st>0&&(B+=.25),v.push({pos:B,isDashed:le[st]})}for(K(u[0]),r=0;r<e.body.length;++r){var ue=e.body[r],Z=C,ee=U;l<ue.length&&(l=ue.length);var be=new Array(ue.length);for(i=0;i<ue.length;++i){var ie=hr(ue[i],t);ee<ie.depth&&(ee=ie.depth),Z<ie.height&&(Z=ie.height),be[i]=ie}var Q=e.rowGaps[r],Ee=0;Q&&(Ee=Zr(Q,t),Ee>0&&(Ee+=U,ee<Ee&&(ee=Ee),Ee=0)),e.addJot&&(ee+=z),be.height=Z,be.depth=ee,B+=Z,be.pos=B,B+=ee+Ee,p[r]=be,K(u[r+1])}var Fe=B/2+t.fontMetrics().axisHeight,Ae=e.cols||[],Ve=[],lt,ut,pt=[];if(e.tags&&e.tags.some(le=>le))for(r=0;r<o;++r){var ke=p[r],Je=ke.pos-Fe,tt=e.tags[r],_t=void 0;tt===!0?_t=et.makeSpan(["eqn-num"],[],t):tt===!1?_t=et.makeSpan([],[],t):_t=et.makeSpan([],Ci(tt,t,!0),t),_t.depth=ke.depth,_t.height=ke.height,pt.push({type:"elem",elem:_t,shift:Je})}for(i=0,ut=0;i<l||ut<Ae.length;++i,++ut){for(var Lt=Ae[ut]||{},Cn=!0;Lt.type==="separator";){if(Cn||(lt=et.makeSpan(["arraycolsep"],[]),lt.style.width=qt(t.fontMetrics().doubleRuleSep),Ve.push(lt)),Lt.separator==="|"||Lt.separator===":"){var nt=Lt.separator==="|"?"solid":"dashed",wt=et.makeSpan(["vertical-separator"],[],t);wt.style.height=qt(B),wt.style.borderRightWidth=qt(x),wt.style.borderRightStyle=nt,wt.style.margin="0 "+qt(-x/2);var Ft=B-Fe;Ft&&(wt.style.verticalAlign=qt(-Ft)),Ve.push(wt)}else throw new Ut("Invalid separator type: "+Lt.separator);ut++,Lt=Ae[ut]||{},Cn=!1}if(!(i>=l)){var At=void 0;(i>0||e.hskipBeforeAndAfter)&&(At=Dn.deflt(Lt.pregap,w),At!==0&&(lt=et.makeSpan(["arraycolsep"],[]),lt.style.width=qt(At),Ve.push(lt)));var gn=[];for(r=0;r<o;++r){var En=p[r],In=En[i];if(In){var je=En.pos-Fe;In.depth=En.depth,In.height=En.height,gn.push({type:"elem",elem:In,shift:je})}}gn=et.makeVList({positionType:"individualShift",children:gn},t),gn=et.makeSpan(["col-align-"+(Lt.align||"c")],[gn]),Ve.push(gn),(i<l-1||e.hskipBeforeAndAfter)&&(At=Dn.deflt(Lt.postgap,w),At!==0&&(lt=et.makeSpan(["arraycolsep"],[]),lt.style.width=qt(At),Ve.push(lt)))}}if(p=et.makeSpan(["mtable"],Ve),v.length>0){for(var An=et.makeLineSpan("hline",t,x),yn=et.makeLineSpan("hdashline",t,x),Qn=[{type:"elem",elem:p,shift:0}];v.length>0;){var Yt=v.pop(),Gn=Yt.pos-Fe;Yt.isDashed?Qn.push({type:"elem",elem:yn,shift:Gn}):Qn.push({type:"elem",elem:An,shift:Gn})}p=et.makeVList({positionType:"individualShift",children:Qn},t)}if(pt.length===0)return et.makeSpan(["mord"],[p],t);var re=et.makeVList({positionType:"individualShift",children:pt},t);return re=et.makeSpan(["tag"],[re],t),et.makeFragment([p,re])},IY={c:"center ",l:"left ",r:"right "},Vo=function(e,t){for(var r=[],i=new Dt.MathNode("mtd",[],["mtr-glue"]),o=new Dt.MathNode("mtd",[],["mml-eqn-num"]),u=0;u<e.body.length;u++){for(var l=e.body[u],p=[],v=0;v<l.length;v++)p.push(new Dt.MathNode("mtd",[Pr(l[v],t)]));e.tags&&e.tags[u]&&(p.unshift(i),p.push(i),e.leqno?p.unshift(o):p.push(o)),r.push(new Dt.MathNode("mtr",p))}var x=new Dt.MathNode("mtable",r),M=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);x.setAttribute("rowspacing",qt(M));var w="",A="";if(e.cols&&e.cols.length>0){var k=e.cols,z="",D=!1,C=0,U=k.length;k[0].type==="separator"&&(w+="top ",C=1),k[k.length-1].type==="separator"&&(w+="bottom ",U-=1);for(var B=C;B<U;B++)k[B].type==="align"?(A+=IY[k[B].align],D&&(z+="none "),D=!0):k[B].type==="separator"&&D&&(z+=k[B].separator==="|"?"solid ":"dashed ",D=!1);x.setAttribute("columnalign",A.trim()),/[sd]/.test(z)&&x.setAttribute("columnlines",z.trim())}if(e.colSeparationType==="align"){for(var K=e.cols||[],ue="",Z=1;Z<K.length;Z++)ue+=Z%2?"0em ":"1em ";x.setAttribute("columnspacing",ue.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?x.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?x.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?x.setAttribute("columnspacing","0.5em"):x.setAttribute("columnspacing","1em");var ee="",be=e.hLinesBeforeRow;w+=be[0].length>0?"left ":"",w+=be[be.length-1].length>0?"right ":"";for(var ie=1;ie<be.length-1;ie++)ee+=be[ie].length===0?"none ":be[ie][0]?"dashed ":"solid ";return/[sd]/.test(ee)&&x.setAttribute("rowlines",ee.trim()),w!==""&&(x=new Dt.MathNode("menclose",[x]),x.setAttribute("notation",w.trim())),e.arraystretch&&e.arraystretch<1&&(x=new Dt.MathNode("mstyle",[x]),x.setAttribute("scriptlevel","1")),x},hP=function(e,t){e.envName.indexOf("ed")===-1&&Lv(e);var r=[],i=e.envName.indexOf("at")>-1?"alignat":"align",o=e.envName==="split",u=nu(e.parser,{cols:r,addJot:!0,autoTag:o?void 0:L4(e.envName),emptySingleRow:!0,colSeparationType:i,maxNumCols:o?2:void 0,leqno:e.parser.settings.leqno},"display"),l,p=0,v={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&t[0].type==="ordgroup"){for(var x="",M=0;M<t[0].body.length;M++){var w=Yn(t[0].body[M],"textord");x+=w.text}l=Number(x),p=l*2}var A=!p;u.body.forEach(function(C){for(var U=1;U<C.length;U+=2){var B=Yn(C[U],"styling"),K=Yn(B.body[0],"ordgroup");K.body.unshift(v)}if(A)p<C.length&&(p=C.length);else{var ue=C.length/2;if(l<ue)throw new Ut("Too many math in a row: "+("expected "+l+", but got "+ue),C[0])}});for(var k=0;k<p;++k){var z="r",D=0;k%2===1?z="l":k>0&&A&&(D=1),r[k]={type:"align",align:z,pregap:D,postgap:0}}return u.colSeparationType=A?"align":"alignat",u};Bo({type:"array",names:["array","darray"],props:{numArgs:1},handler(n,e){var t=Iv(e[0]),r=t?[e[0]]:Yn(e[0],"ordgroup").body,i=r.map(function(u){var l=P4(u),p=l.text;if("lcr".indexOf(p)!==-1)return{type:"align",align:p};if(p==="|")return{type:"separator",separator:"|"};if(p===":")return{type:"separator",separator:":"};throw new Ut("Unknown column alignment: "+p,u)}),o={cols:i,hskipBeforeAndAfter:!0,maxNumCols:i.length};return nu(n.parser,o,z4(n.envName))},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(n){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[n.envName.replace("*","")],t="c",r={hskipBeforeAndAfter:!1,cols:[{type:"align",align:t}]};if(n.envName.charAt(n.envName.length-1)==="*"){var i=n.parser;if(i.consumeSpaces(),i.fetch().text==="["){if(i.consume(),i.consumeSpaces(),t=i.fetch().text,"lcr".indexOf(t)===-1)throw new Ut("Expected l or c or r",i.nextToken);i.consume(),i.consumeSpaces(),i.expect("]"),i.consume(),r.cols=[{type:"align",align:t}]}}var o=nu(n.parser,r,z4(n.envName)),u=Math.max(0,...o.body.map(l=>l.length));return o.cols=new Array(u).fill({type:"align",align:t}),e?{type:"leftright",mode:n.mode,body:[o],left:e[0],right:e[1],rightColor:void 0}:o},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(n){var e={arraystretch:.5},t=nu(n.parser,e,"script");return t.colSeparationType="small",t},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["subarray"],props:{numArgs:1},handler(n,e){var t=Iv(e[0]),r=t?[e[0]]:Yn(e[0],"ordgroup").body,i=r.map(function(u){var l=P4(u),p=l.text;if("lc".indexOf(p)!==-1)return{type:"align",align:p};throw new Ut("Unknown column alignment: "+p,u)});if(i.length>1)throw new Ut("{subarray} can contain only one column");var o={cols:i,hskipBeforeAndAfter:!1,arraystretch:.5};if(o=nu(n.parser,o,"script"),o.body.length>0&&o.body[0].length>1)throw new Ut("{subarray} can contain only one column");return o},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(n){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},t=nu(n.parser,e,z4(n.envName));return{type:"leftright",mode:n.mode,body:[t],left:n.envName.indexOf("r")>-1?".":"\\{",right:n.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:hP,htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(n){Dn.contains(["gather","gather*"],n.envName)&&Lv(n);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:L4(n.envName),emptySingleRow:!0,leqno:n.parser.settings.leqno};return nu(n.parser,e,"display")},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:hP,htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(n){Lv(n);var e={autoTag:L4(n.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:n.parser.settings.leqno};return nu(n.parser,e,"display")},htmlBuilder:Uo,mathmlBuilder:Vo});Bo({type:"array",names:["CD"],props:{numArgs:0},handler(n){return Lv(n),yY(n.parser)},htmlBuilder:Uo,mathmlBuilder:Vo});he("\\nonumber","\\gdef\\@eqnsw{0}");he("\\notag","\\nonumber");cn({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(n,e){throw new Ut(n.funcName+" valid only within array environment")}});var C6=cP;cn({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];if(i.type!=="ordgroup")throw new Ut("Invalid environment name",i);for(var o="",u=0;u<i.body.length;++u)o+=Yn(i.body[u],"textord").text;if(r==="\\begin"){if(!C6.hasOwnProperty(o))throw new Ut("No such environment: "+o,i);var l=C6[o],{args:p,optArgs:v}=t.parseArguments("\\begin{"+o+"}",l),x={mode:t.mode,envName:o,parser:t},M=l.handler(x,p,v);t.expect("\\end",!1);var w=t.nextToken,A=Yn(t.parseFunction(),"environment");if(A.name!==o)throw new Ut("Mismatch: \\begin{"+o+"} matched by \\end{"+A.name+"}",w);return M}return{type:"environment",mode:t.mode,name:o,nameGroup:i}}});var dP=(n,e)=>{var t=n.font,r=e.withFont(t);return hr(n.body,r)},fP=(n,e)=>{var t=n.font,r=e.withFont(t);return Pr(n.body,r)},P6={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};cn({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=Xy(e[0]),o=r;return o in P6&&(o=P6[o]),{type:"font",mode:t.mode,font:o.slice(1),body:i}},htmlBuilder:dP,mathmlBuilder:fP});cn({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(n,e)=>{var{parser:t}=n,r=e[0],i=Dn.isCharacterBox(r);return{type:"mclass",mode:t.mode,mclass:Dv(r),body:[{type:"font",mode:t.mode,font:"boldsymbol",body:r}],isCharacterBox:i}}});cn({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,breakOnTokenText:i}=n,{mode:o}=t,u=t.parseExpression(!0,i),l="math"+r.slice(1);return{type:"font",mode:o,font:l,body:{type:"ordgroup",mode:t.mode,body:u}}},htmlBuilder:dP,mathmlBuilder:fP});var pP=(n,e)=>{var t=e;return n==="display"?t=t.id>=Ln.SCRIPT.id?t.text():Ln.DISPLAY:n==="text"&&t.size===Ln.DISPLAY.size?t=Ln.TEXT:n==="script"?t=Ln.SCRIPT:n==="scriptscript"&&(t=Ln.SCRIPTSCRIPT),t},F4=(n,e)=>{var t=pP(n.size,e.style),r=t.fracNum(),i=t.fracDen(),o;o=e.havingStyle(r);var u=hr(n.numer,o,e);if(n.continued){var l=8.5/e.fontMetrics().ptPerEm,p=3.5/e.fontMetrics().ptPerEm;u.height=u.height<l?l:u.height,u.depth=u.depth<p?p:u.depth}o=e.havingStyle(i);var v=hr(n.denom,o,e),x,M,w;n.hasBarLine?(n.barSize?(M=Zr(n.barSize,e),x=et.makeLineSpan("frac-line",e,M)):x=et.makeLineSpan("frac-line",e),M=x.height,w=x.height):(x=null,M=0,w=e.fontMetrics().defaultRuleThickness);var A,k,z;t.size===Ln.DISPLAY.size||n.size==="display"?(A=e.fontMetrics().num1,M>0?k=3*w:k=7*w,z=e.fontMetrics().denom1):(M>0?(A=e.fontMetrics().num2,k=w):(A=e.fontMetrics().num3,k=3*w),z=e.fontMetrics().denom2);var D;if(x){var U=e.fontMetrics().axisHeight;A-u.depth-(U+.5*M)<k&&(A+=k-(A-u.depth-(U+.5*M))),U-.5*M-(v.height-z)<k&&(z+=k-(U-.5*M-(v.height-z)));var B=-(U-.5*M);D=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:v,shift:z},{type:"elem",elem:x,shift:B},{type:"elem",elem:u,shift:-A}]},e)}else{var C=A-u.depth-(v.height-z);C<k&&(A+=.5*(k-C),z+=.5*(k-C)),D=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:v,shift:z},{type:"elem",elem:u,shift:-A}]},e)}o=e.havingStyle(t),D.height*=o.sizeMultiplier/e.sizeMultiplier,D.depth*=o.sizeMultiplier/e.sizeMultiplier;var K;t.size===Ln.DISPLAY.size?K=e.fontMetrics().delim1:t.size===Ln.SCRIPTSCRIPT.size?K=e.havingStyle(Ln.SCRIPT).fontMetrics().delim2:K=e.fontMetrics().delim2;var ue,Z;return n.leftDelim==null?ue=rm(e,["mopen"]):ue=Tl.customSizedDelim(n.leftDelim,K,!0,e.havingStyle(t),n.mode,["mopen"]),n.continued?Z=et.makeSpan([]):n.rightDelim==null?Z=rm(e,["mclose"]):Z=Tl.customSizedDelim(n.rightDelim,K,!0,e.havingStyle(t),n.mode,["mclose"]),et.makeSpan(["mord"].concat(o.sizingClasses(e)),[ue,et.makeSpan(["mfrac"],[D]),Z],e)},N4=(n,e)=>{var t=new Dt.MathNode("mfrac",[Pr(n.numer,e),Pr(n.denom,e)]);if(!n.hasBarLine)t.setAttribute("linethickness","0px");else if(n.barSize){var r=Zr(n.barSize,e);t.setAttribute("linethickness",qt(r))}var i=pP(n.size,e.style);if(i.size!==e.style.size){t=new Dt.MathNode("mstyle",[t]);var o=i.size===Ln.DISPLAY.size?"true":"false";t.setAttribute("displaystyle",o),t.setAttribute("scriptlevel","0")}if(n.leftDelim!=null||n.rightDelim!=null){var u=[];if(n.leftDelim!=null){var l=new Dt.MathNode("mo",[new Dt.TextNode(n.leftDelim.replace("\\",""))]);l.setAttribute("fence","true"),u.push(l)}if(u.push(t),n.rightDelim!=null){var p=new Dt.MathNode("mo",[new Dt.TextNode(n.rightDelim.replace("\\",""))]);p.setAttribute("fence","true"),u.push(p)}return A4(u)}return t};cn({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],o=e[1],u,l=null,p=null,v="auto";switch(r){case"\\dfrac":case"\\frac":case"\\tfrac":u=!0;break;case"\\\\atopfrac":u=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":u=!1,l="(",p=")";break;case"\\\\bracefrac":u=!1,l="\\{",p="\\}";break;case"\\\\brackfrac":u=!1,l="[",p="]";break;default:throw new Error("Unrecognized genfrac command")}switch(r){case"\\dfrac":case"\\dbinom":v="display";break;case"\\tfrac":case"\\tbinom":v="text";break}return{type:"genfrac",mode:t.mode,continued:!1,numer:i,denom:o,hasBarLine:u,leftDelim:l,rightDelim:p,size:v,barSize:null}},htmlBuilder:F4,mathmlBuilder:N4});cn({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],o=e[1];return{type:"genfrac",mode:t.mode,continued:!0,numer:i,denom:o,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});cn({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(n){var{parser:e,funcName:t,token:r}=n,i;switch(t){case"\\over":i="\\frac";break;case"\\choose":i="\\binom";break;case"\\atop":i="\\\\atopfrac";break;case"\\brace":i="\\\\bracefrac";break;case"\\brack":i="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:i,token:r}}});var R6=["display","text","script","scriptscript"],I6=function(e){var t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};cn({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(n,e){var{parser:t}=n,r=e[4],i=e[5],o=Xy(e[0]),u=o.type==="atom"&&o.family==="open"?I6(o.text):null,l=Xy(e[1]),p=l.type==="atom"&&l.family==="close"?I6(l.text):null,v=Yn(e[2],"size"),x,M=null;v.isBlank?x=!0:(M=v.value,x=M.number>0);var w="auto",A=e[3];if(A.type==="ordgroup"){if(A.body.length>0){var k=Yn(A.body[0],"textord");w=R6[Number(k.text)]}}else A=Yn(A,"textord"),w=R6[Number(A.text)];return{type:"genfrac",mode:t.mode,numer:r,denom:i,continued:!1,hasBarLine:x,barSize:M,leftDelim:u,rightDelim:p,size:w}},htmlBuilder:F4,mathmlBuilder:N4});cn({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(n,e){var{parser:t,funcName:r,token:i}=n;return{type:"infix",mode:t.mode,replaceWith:"\\\\abovefrac",size:Yn(e[0],"size").value,token:i}}});cn({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0],o=lZ(Yn(e[1],"infix").size),u=e[2],l=o.number>0;return{type:"genfrac",mode:t.mode,numer:i,denom:u,continued:!1,hasBarLine:l,barSize:o,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:F4,mathmlBuilder:N4});var mP=(n,e)=>{var t=e.style,r,i;n.type==="supsub"?(r=n.sup?hr(n.sup,e.havingStyle(t.sup()),e):hr(n.sub,e.havingStyle(t.sub()),e),i=Yn(n.base,"horizBrace")):i=Yn(n,"horizBrace");var o=hr(i.base,e.havingBaseStyle(Ln.DISPLAY)),u=zl.svgSpan(i,e),l;if(i.isOver?(l=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:o},{type:"kern",size:.1},{type:"elem",elem:u}]},e),l.children[0].children[0].children[1].classes.push("svg-align")):(l=et.makeVList({positionType:"bottom",positionData:o.depth+.1+u.height,children:[{type:"elem",elem:u},{type:"kern",size:.1},{type:"elem",elem:o}]},e),l.children[0].children[0].children[0].classes.push("svg-align")),r){var p=et.makeSpan(["mord",i.isOver?"mover":"munder"],[l],e);i.isOver?l=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:p},{type:"kern",size:.2},{type:"elem",elem:r}]},e):l=et.makeVList({positionType:"bottom",positionData:p.depth+.2+r.height+r.depth,children:[{type:"elem",elem:r},{type:"kern",size:.2},{type:"elem",elem:p}]},e)}return et.makeSpan(["mord",i.isOver?"mover":"munder"],[l],e)},DY=(n,e)=>{var t=zl.mathMLnode(n.label);return new Dt.MathNode(n.isOver?"mover":"munder",[Pr(n.base,e),t])};cn({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:r}=n;return{type:"horizBrace",mode:t.mode,label:r,isOver:/^\\over/.test(r),base:e[0]}},htmlBuilder:mP,mathmlBuilder:DY});cn({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[1],i=Yn(e[0],"url").url;return t.settings.isTrusted({command:"\\href",url:i})?{type:"href",mode:t.mode,href:i,body:mi(r)}:t.formatUnsupportedCmd("\\href")},htmlBuilder:(n,e)=>{var t=Ci(n.body,e,!1);return et.makeAnchor(n.href,[],t,e)},mathmlBuilder:(n,e)=>{var t=Xc(n.body,e);return t instanceof Ps||(t=new Ps("mrow",[t])),t.setAttribute("href",n.href),t}});cn({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=Yn(e[0],"url").url;if(!t.settings.isTrusted({command:"\\url",url:r}))return t.formatUnsupportedCmd("\\url");for(var i=[],o=0;o<r.length;o++){var u=r[o];u==="~"&&(u="\\textasciitilde"),i.push({type:"textord",mode:"text",text:u})}var l={type:"text",mode:t.mode,font:"\\texttt",body:i};return{type:"href",mode:t.mode,href:r,body:mi(l)}}});cn({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(n,e){var{parser:t}=n;return{type:"hbox",mode:t.mode,body:mi(e[0])}},htmlBuilder(n,e){var t=Ci(n.body,e,!1);return et.makeFragment(t)},mathmlBuilder(n,e){return new Dt.MathNode("mrow",qa(n.body,e))}});cn({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r,token:i}=n,o=Yn(e[0],"raw").string,u=e[1];t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var l,p={};switch(r){case"\\htmlClass":p.class=o,l={command:"\\htmlClass",class:o};break;case"\\htmlId":p.id=o,l={command:"\\htmlId",id:o};break;case"\\htmlStyle":p.style=o,l={command:"\\htmlStyle",style:o};break;case"\\htmlData":{for(var v=o.split(","),x=0;x<v.length;x++){var M=v[x].split("=");if(M.length!==2)throw new Ut("Error parsing key-value for \\htmlData");p["data-"+M[0].trim()]=M[1].trim()}l={command:"\\htmlData",attributes:p};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(l)?{type:"html",mode:t.mode,attributes:p,body:mi(u)}:t.formatUnsupportedCmd(r)},htmlBuilder:(n,e)=>{var t=Ci(n.body,e,!1),r=["enclosing"];n.attributes.class&&r.push(...n.attributes.class.trim().split(/\s+/));var i=et.makeSpan(r,t,e);for(var o in n.attributes)o!=="class"&&n.attributes.hasOwnProperty(o)&&i.setAttribute(o,n.attributes[o]);return i},mathmlBuilder:(n,e)=>Xc(n.body,e)});cn({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"htmlmathml",mode:t.mode,html:mi(e[0]),mathml:mi(e[1])}},htmlBuilder:(n,e)=>{var t=Ci(n.html,e,!1);return et.makeFragment(t)},mathmlBuilder:(n,e)=>Xc(n.mathml,e)});var p2=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new Ut("Invalid size: '"+e+"' in \\includegraphics");var r={number:+(t[1]+t[2]),unit:t[3]};if(!LC(r))throw new Ut("Invalid unit: '"+r.unit+"' in \\includegraphics.");return r};cn({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(n,e,t)=>{var{parser:r}=n,i={number:0,unit:"em"},o={number:.9,unit:"em"},u={number:0,unit:"em"},l="";if(t[0])for(var p=Yn(t[0],"raw").string,v=p.split(","),x=0;x<v.length;x++){var M=v[x].split("=");if(M.length===2){var w=M[1].trim();switch(M[0].trim()){case"alt":l=w;break;case"width":i=p2(w);break;case"height":o=p2(w);break;case"totalheight":u=p2(w);break;default:throw new Ut("Invalid key: '"+M[0]+"' in \\includegraphics.")}}}var A=Yn(e[0],"url").url;return l===""&&(l=A,l=l.replace(/^.*[\\/]/,""),l=l.substring(0,l.lastIndexOf("."))),r.settings.isTrusted({command:"\\includegraphics",url:A})?{type:"includegraphics",mode:r.mode,alt:l,width:i,height:o,totalheight:u,src:A}:r.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(n,e)=>{var t=Zr(n.height,e),r=0;n.totalheight.number>0&&(r=Zr(n.totalheight,e)-t);var i=0;n.width.number>0&&(i=Zr(n.width,e));var o={height:qt(t+r)};i>0&&(o.width=qt(i)),r>0&&(o.verticalAlign=qt(-r));var u=new DZ(n.src,n.alt,o);return u.height=t,u.depth=r,u},mathmlBuilder:(n,e)=>{var t=new Dt.MathNode("mglyph",[]);t.setAttribute("alt",n.alt);var r=Zr(n.height,e),i=0;if(n.totalheight.number>0&&(i=Zr(n.totalheight,e)-r,t.setAttribute("valign",qt(-i))),t.setAttribute("height",qt(r+i)),n.width.number>0){var o=Zr(n.width,e);t.setAttribute("width",qt(o))}return t.setAttribute("src",n.src),t}});cn({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,i=Yn(e[0],"size");if(t.settings.strict){var o=r[1]==="m",u=i.value.unit==="mu";o?(u||t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" supports only mu units, "+("not "+i.value.unit+" units")),t.mode!=="math"&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" works only in math mode")):u&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+r+" doesn't support mu units")}return{type:"kern",mode:t.mode,dimension:i.value}},htmlBuilder(n,e){return et.makeGlue(n.dimension,e)},mathmlBuilder(n,e){var t=Zr(n.dimension,e);return new Dt.SpaceNode(t)}});cn({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"lap",mode:t.mode,alignment:r.slice(5),body:i}},htmlBuilder:(n,e)=>{var t;n.alignment==="clap"?(t=et.makeSpan([],[hr(n.body,e)]),t=et.makeSpan(["inner"],[t],e)):t=et.makeSpan(["inner"],[hr(n.body,e)]);var r=et.makeSpan(["fix"],[]),i=et.makeSpan([n.alignment],[t,r],e),o=et.makeSpan(["strut"]);return o.style.height=qt(i.height+i.depth),i.depth&&(o.style.verticalAlign=qt(-i.depth)),i.children.unshift(o),i=et.makeSpan(["thinbox"],[i],e),et.makeSpan(["mord","vbox"],[i],e)},mathmlBuilder:(n,e)=>{var t=new Dt.MathNode("mpadded",[Pr(n.body,e)]);if(n.alignment!=="rlap"){var r=n.alignment==="llap"?"-1":"-0.5";t.setAttribute("lspace",r+"width")}return t.setAttribute("width","0px"),t}});cn({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){var{funcName:t,parser:r}=n,i=r.mode;r.switchMode("math");var o=t==="\\("?"\\)":"$",u=r.parseExpression(!1,o);return r.expect(o),r.switchMode(i),{type:"styling",mode:r.mode,style:"text",body:u}}});cn({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){throw new Ut("Mismatched "+n.funcName)}});var D6=(n,e)=>{switch(e.style.size){case Ln.DISPLAY.size:return n.display;case Ln.TEXT.size:return n.text;case Ln.SCRIPT.size:return n.script;case Ln.SCRIPTSCRIPT.size:return n.scriptscript;default:return n.text}};cn({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"mathchoice",mode:t.mode,display:mi(e[0]),text:mi(e[1]),script:mi(e[2]),scriptscript:mi(e[3])}},htmlBuilder:(n,e)=>{var t=D6(n,e),r=Ci(t,e,!1);return et.makeFragment(r)},mathmlBuilder:(n,e)=>{var t=D6(n,e);return Xc(t,e)}});var gP=(n,e,t,r,i,o,u)=>{n=et.makeSpan([],[n]);var l=t&&Dn.isCharacterBox(t),p,v;if(e){var x=hr(e,r.havingStyle(i.sup()),r);v={elem:x,kern:Math.max(r.fontMetrics().bigOpSpacing1,r.fontMetrics().bigOpSpacing3-x.depth)}}if(t){var M=hr(t,r.havingStyle(i.sub()),r);p={elem:M,kern:Math.max(r.fontMetrics().bigOpSpacing2,r.fontMetrics().bigOpSpacing4-M.height)}}var w;if(v&&p){var A=r.fontMetrics().bigOpSpacing5+p.elem.height+p.elem.depth+p.kern+n.depth+u;w=et.makeVList({positionType:"bottom",positionData:A,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:p.elem,marginLeft:qt(-o)},{type:"kern",size:p.kern},{type:"elem",elem:n},{type:"kern",size:v.kern},{type:"elem",elem:v.elem,marginLeft:qt(o)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else if(p){var k=n.height-u;w=et.makeVList({positionType:"top",positionData:k,children:[{type:"kern",size:r.fontMetrics().bigOpSpacing5},{type:"elem",elem:p.elem,marginLeft:qt(-o)},{type:"kern",size:p.kern},{type:"elem",elem:n}]},r)}else if(v){var z=n.depth+u;w=et.makeVList({positionType:"bottom",positionData:z,children:[{type:"elem",elem:n},{type:"kern",size:v.kern},{type:"elem",elem:v.elem,marginLeft:qt(o)},{type:"kern",size:r.fontMetrics().bigOpSpacing5}]},r)}else return n;var D=[w];if(p&&o!==0&&!l){var C=et.makeSpan(["mspace"],[],r);C.style.marginRight=qt(o),D.unshift(C)}return et.makeSpan(["mop","op-limits"],D,r)},yP=["\\smallint"],Af=(n,e)=>{var t,r,i=!1,o;n.type==="supsub"?(t=n.sup,r=n.sub,o=Yn(n.base,"op"),i=!0):o=Yn(n,"op");var u=e.style,l=!1;u.size===Ln.DISPLAY.size&&o.symbol&&!Dn.contains(yP,o.name)&&(l=!0);var p;if(o.symbol){var v=l?"Size2-Regular":"Size1-Regular",x="";if((o.name==="\\oiint"||o.name==="\\oiiint")&&(x=o.name.slice(1),o.name=x==="oiint"?"\\iint":"\\iiint"),p=et.makeSymbol(o.name,v,"math",e,["mop","op-symbol",l?"large-op":"small-op"]),x.length>0){var M=p.italic,w=et.staticSvg(x+"Size"+(l?"2":"1"),e);p=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:p,shift:0},{type:"elem",elem:w,shift:l?.08:0}]},e),o.name="\\"+x,p.classes.unshift("mop"),p.italic=M}}else if(o.body){var A=Ci(o.body,e,!0);A.length===1&&A[0]instanceof Os?(p=A[0],p.classes[0]="mop"):p=et.makeSpan(["mop"],A,e)}else{for(var k=[],z=1;z<o.name.length;z++)k.push(et.mathsym(o.name[z],o.mode,e));p=et.makeSpan(["mop"],k,e)}var D=0,C=0;return(p instanceof Os||o.name==="\\oiint"||o.name==="\\oiiint")&&!o.suppressBaseShift&&(D=(p.height-p.depth)/2-e.fontMetrics().axisHeight,C=p.italic),i?gP(p,t,r,e,u,C,D):(D&&(p.style.position="relative",p.style.top=qt(D)),p)},Sm=(n,e)=>{var t;if(n.symbol)t=new Ps("mo",[Bs(n.name,n.mode)]),Dn.contains(yP,n.name)&&t.setAttribute("largeop","false");else if(n.body)t=new Ps("mo",qa(n.body,e));else{t=new Ps("mi",[new Tp(n.name.slice(1))]);var r=new Ps("mo",[Bs("","text")]);n.parentIsSupSub?t=new Ps("mrow",[t,r]):t=WC([t,r])}return t},kY={"":"\\prod","":"\\coprod","":"\\sum","":"\\bigwedge","":"\\bigvee","":"\\bigcap","":"\\bigcup","":"\\bigodot","":"\\bigoplus","":"\\bigotimes","":"\\biguplus","":"\\bigsqcup"};cn({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","","","","","","","","","","","",""],props:{numArgs:0},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=r;return i.length===1&&(i=kY[i]),{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:Af,mathmlBuilder:Sm});cn({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:mi(r)}},htmlBuilder:Af,mathmlBuilder:Sm});var LY={"":"\\int","":"\\iint","":"\\iiint","":"\\oint","":"\\oiint","":"\\oiiint"};cn({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:Af,mathmlBuilder:Sm});cn({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:Af,mathmlBuilder:Sm});cn({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","","","","","",""],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n,r=t;return r.length===1&&(r=LY[r]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:Af,mathmlBuilder:Sm});var vP=(n,e)=>{var t,r,i=!1,o;n.type==="supsub"?(t=n.sup,r=n.sub,o=Yn(n.base,"operatorname"),i=!0):o=Yn(n,"operatorname");var u;if(o.body.length>0){for(var l=o.body.map(M=>{var w=M.text;return typeof w=="string"?{type:"textord",mode:M.mode,text:w}:M}),p=Ci(l,e.withFont("mathrm"),!0),v=0;v<p.length;v++){var x=p[v];x instanceof Os&&(x.text=x.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}u=et.makeSpan(["mop"],p,e)}else u=et.makeSpan(["mop"],[],e);return i?gP(u,t,r,e,e.style,0,0):u},zY=(n,e)=>{for(var t=qa(n.body,e.withFont("mathrm")),r=!0,i=0;i<t.length;i++){var o=t[i];if(!(o instanceof Dt.SpaceNode))if(o instanceof Dt.MathNode)switch(o.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var u=o.children[0];o.children.length===1&&u instanceof Dt.TextNode?u.text=u.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):r=!1;break}default:r=!1}else r=!1}if(r){var l=t.map(x=>x.toText()).join("");t=[new Dt.TextNode(l)]}var p=new Dt.MathNode("mi",t);p.setAttribute("mathvariant","normal");var v=new Dt.MathNode("mo",[Bs("","text")]);return n.parentIsSupSub?new Dt.MathNode("mrow",[p,v]):Dt.newDocumentFragment([p,v])};cn({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:r}=n,i=e[0];return{type:"operatorname",mode:t.mode,body:mi(i),alwaysHandleSupSub:r==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:vP,mathmlBuilder:zY});he("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");uh({type:"ordgroup",htmlBuilder(n,e){return n.semisimple?et.makeFragment(Ci(n.body,e,!1)):et.makeSpan(["mord"],Ci(n.body,e,!0),e)},mathmlBuilder(n,e){return Xc(n.body,e,!0)}});cn({type:"overline",names:["\\overline"],props:{numArgs:1},handler(n,e){var{parser:t}=n,r=e[0];return{type:"overline",mode:t.mode,body:r}},htmlBuilder(n,e){var t=hr(n.body,e.havingCrampedStyle()),r=et.makeLineSpan("overline-line",e),i=e.fontMetrics().defaultRuleThickness,o=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t},{type:"kern",size:3*i},{type:"elem",elem:r},{type:"kern",size:i}]},e);return et.makeSpan(["mord","overline"],[o],e)},mathmlBuilder(n,e){var t=new Dt.MathNode("mo",[new Dt.TextNode("")]);t.setAttribute("stretchy","true");var r=new Dt.MathNode("mover",[Pr(n.body,e),t]);return r.setAttribute("accent","true"),r}});cn({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"phantom",mode:t.mode,body:mi(r)}},htmlBuilder:(n,e)=>{var t=Ci(n.body,e.withPhantom(),!1);return et.makeFragment(t)},mathmlBuilder:(n,e)=>{var t=qa(n.body,e);return new Dt.MathNode("mphantom",t)}});cn({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"hphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=et.makeSpan([],[hr(n.body,e.withPhantom())]);if(t.height=0,t.depth=0,t.children)for(var r=0;r<t.children.length;r++)t.children[r].height=0,t.children[r].depth=0;return t=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e),et.makeSpan(["mord"],[t],e)},mathmlBuilder:(n,e)=>{var t=qa(mi(n.body),e),r=new Dt.MathNode("mphantom",t),i=new Dt.MathNode("mpadded",[r]);return i.setAttribute("height","0px"),i.setAttribute("depth","0px"),i}});cn({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,r=e[0];return{type:"vphantom",mode:t.mode,body:r}},htmlBuilder:(n,e)=>{var t=et.makeSpan(["inner"],[hr(n.body,e.withPhantom())]),r=et.makeSpan(["fix"],[]);return et.makeSpan(["mord","rlap"],[t,r],e)},mathmlBuilder:(n,e)=>{var t=qa(mi(n.body),e),r=new Dt.MathNode("mphantom",t),i=new Dt.MathNode("mpadded",[r]);return i.setAttribute("width","0px"),i}});cn({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n,r=Yn(e[0],"size").value,i=e[1];return{type:"raisebox",mode:t.mode,dy:r,body:i}},htmlBuilder(n,e){var t=hr(n.body,e),r=Zr(n.dy,e);return et.makeVList({positionType:"shift",positionData:-r,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){var t=new Dt.MathNode("mpadded",[Pr(n.body,e)]),r=n.dy.number+n.dy.unit;return t.setAttribute("voffset",r),t}});cn({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e}=n;return{type:"internal",mode:e.mode}}});cn({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler(n,e,t){var{parser:r}=n,i=t[0],o=Yn(e[0],"size"),u=Yn(e[1],"size");return{type:"rule",mode:r.mode,shift:i&&Yn(i,"size").value,width:o.value,height:u.value}},htmlBuilder(n,e){var t=et.makeSpan(["mord","rule"],[],e),r=Zr(n.width,e),i=Zr(n.height,e),o=n.shift?Zr(n.shift,e):0;return t.style.borderRightWidth=qt(r),t.style.borderTopWidth=qt(i),t.style.bottom=qt(o),t.width=r,t.height=i+o,t.depth=-o,t.maxFontSize=i*1.125*e.sizeMultiplier,t},mathmlBuilder(n,e){var t=Zr(n.width,e),r=Zr(n.height,e),i=n.shift?Zr(n.shift,e):0,o=e.color&&e.getColor()||"black",u=new Dt.MathNode("mspace");u.setAttribute("mathbackground",o),u.setAttribute("width",qt(t)),u.setAttribute("height",qt(r));var l=new Dt.MathNode("mpadded",[u]);return i>=0?l.setAttribute("height",qt(i)):(l.setAttribute("height",qt(i)),l.setAttribute("depth",qt(-i))),l.setAttribute("voffset",qt(i)),l}});function _P(n,e,t){for(var r=Ci(n,e,!1),i=e.sizeMultiplier/t.sizeMultiplier,o=0;o<r.length;o++){var u=r[o].classes.indexOf("sizing");u<0?Array.prototype.push.apply(r[o].classes,e.sizingClasses(t)):r[o].classes[u+1]==="reset-size"+e.size&&(r[o].classes[u+1]="reset-size"+t.size),r[o].height*=i,r[o].depth*=i}return et.makeFragment(r)}var k6=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],FY=(n,e)=>{var t=e.havingSize(n.size);return _P(n.body,t,e)};cn({type:"sizing",names:k6,props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{breakOnTokenText:t,funcName:r,parser:i}=n,o=i.parseExpression(!1,t);return{type:"sizing",mode:i.mode,size:k6.indexOf(r)+1,body:o}},htmlBuilder:FY,mathmlBuilder:(n,e)=>{var t=e.havingSize(n.size),r=qa(n.body,t),i=new Dt.MathNode("mstyle",r);return i.setAttribute("mathsize",qt(t.sizeMultiplier)),i}});cn({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(n,e,t)=>{var{parser:r}=n,i=!1,o=!1,u=t[0]&&Yn(t[0],"ordgroup");if(u)for(var l="",p=0;p<u.body.length;++p){var v=u.body[p];if(l=v.text,l==="t")i=!0;else if(l==="b")o=!0;else{i=!1,o=!1;break}}else i=!0,o=!0;var x=e[0];return{type:"smash",mode:r.mode,body:x,smashHeight:i,smashDepth:o}},htmlBuilder:(n,e)=>{var t=et.makeSpan([],[hr(n.body,e)]);if(!n.smashHeight&&!n.smashDepth)return t;if(n.smashHeight&&(t.height=0,t.children))for(var r=0;r<t.children.length;r++)t.children[r].height=0;if(n.smashDepth&&(t.depth=0,t.children))for(var i=0;i<t.children.length;i++)t.children[i].depth=0;var o=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e);return et.makeSpan(["mord"],[o],e)},mathmlBuilder:(n,e)=>{var t=new Dt.MathNode("mpadded",[Pr(n.body,e)]);return n.smashHeight&&t.setAttribute("height","0px"),n.smashDepth&&t.setAttribute("depth","0px"),t}});cn({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:r}=n,i=t[0],o=e[0];return{type:"sqrt",mode:r.mode,body:o,index:i}},htmlBuilder(n,e){var t=hr(n.body,e.havingCrampedStyle());t.height===0&&(t.height=e.fontMetrics().xHeight),t=et.wrapFragment(t,e);var r=e.fontMetrics(),i=r.defaultRuleThickness,o=i;e.style.id<Ln.TEXT.id&&(o=e.fontMetrics().xHeight);var u=i+o/4,l=t.height+t.depth+u+i,{span:p,ruleWidth:v,advanceWidth:x}=Tl.sqrtImage(l,e),M=p.height-v;M>t.height+t.depth+u&&(u=(u+M-t.height-t.depth)/2);var w=p.height-t.height-u-v;t.style.paddingLeft=qt(x);var A=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t,wrapperClasses:["svg-align"]},{type:"kern",size:-(t.height+w)},{type:"elem",elem:p},{type:"kern",size:v}]},e);if(n.index){var k=e.havingStyle(Ln.SCRIPTSCRIPT),z=hr(n.index,k,e),D=.6*(A.height-A.depth),C=et.makeVList({positionType:"shift",positionData:-D,children:[{type:"elem",elem:z}]},e),U=et.makeSpan(["root"],[C]);return et.makeSpan(["mord","sqrt"],[U,A],e)}else return et.makeSpan(["mord","sqrt"],[A],e)},mathmlBuilder(n,e){var{body:t,index:r}=n;return r?new Dt.MathNode("mroot",[Pr(t,e),Pr(r,e)]):new Dt.MathNode("msqrt",[Pr(t,e)])}});var L6={display:Ln.DISPLAY,text:Ln.TEXT,script:Ln.SCRIPT,scriptscript:Ln.SCRIPTSCRIPT};cn({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n,e){var{breakOnTokenText:t,funcName:r,parser:i}=n,o=i.parseExpression(!0,t),u=r.slice(1,r.length-5);return{type:"styling",mode:i.mode,style:u,body:o}},htmlBuilder(n,e){var t=L6[n.style],r=e.havingStyle(t).withFont("");return _P(n.body,r,e)},mathmlBuilder(n,e){var t=L6[n.style],r=e.havingStyle(t),i=qa(n.body,r),o=new Dt.MathNode("mstyle",i),u={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},l=u[n.style];return o.setAttribute("scriptlevel",l[0]),o.setAttribute("displaystyle",l[1]),o}});var NY=function(e,t){var r=e.base;if(r)if(r.type==="op"){var i=r.limits&&(t.style.size===Ln.DISPLAY.size||r.alwaysHandleSupSub);return i?Af:null}else if(r.type==="operatorname"){var o=r.alwaysHandleSupSub&&(t.style.size===Ln.DISPLAY.size||r.limits);return o?vP:null}else{if(r.type==="accent")return Dn.isCharacterBox(r.base)?R4:null;if(r.type==="horizBrace"){var u=!e.sub;return u===r.isOver?mP:null}else return null}else return null};uh({type:"supsub",htmlBuilder(n,e){var t=NY(n,e);if(t)return t(n,e);var{base:r,sup:i,sub:o}=n,u=hr(r,e),l,p,v=e.fontMetrics(),x=0,M=0,w=r&&Dn.isCharacterBox(r);if(i){var A=e.havingStyle(e.style.sup());l=hr(i,A,e),w||(x=u.height-A.fontMetrics().supDrop*A.sizeMultiplier/e.sizeMultiplier)}if(o){var k=e.havingStyle(e.style.sub());p=hr(o,k,e),w||(M=u.depth+k.fontMetrics().subDrop*k.sizeMultiplier/e.sizeMultiplier)}var z;e.style===Ln.DISPLAY?z=v.sup1:e.style.cramped?z=v.sup3:z=v.sup2;var D=e.sizeMultiplier,C=qt(.5/v.ptPerEm/D),U=null;if(p){var B=n.base&&n.base.type==="op"&&n.base.name&&(n.base.name==="\\oiint"||n.base.name==="\\oiiint");(u instanceof Os||B)&&(U=qt(-u.italic))}var K;if(l&&p){x=Math.max(x,z,l.depth+.25*v.xHeight),M=Math.max(M,v.sub2);var ue=v.defaultRuleThickness,Z=4*ue;if(x-l.depth-(p.height-M)<Z){M=Z-(x-l.depth)+p.height;var ee=.8*v.xHeight-(x-l.depth);ee>0&&(x+=ee,M-=ee)}var be=[{type:"elem",elem:p,shift:M,marginRight:C,marginLeft:U},{type:"elem",elem:l,shift:-x,marginRight:C}];K=et.makeVList({positionType:"individualShift",children:be},e)}else if(p){M=Math.max(M,v.sub1,p.height-.8*v.xHeight);var ie=[{type:"elem",elem:p,marginLeft:U,marginRight:C}];K=et.makeVList({positionType:"shift",positionData:M,children:ie},e)}else if(l)x=Math.max(x,z,l.depth+.25*v.xHeight),K=et.makeVList({positionType:"shift",positionData:-x,children:[{type:"elem",elem:l,marginRight:C}]},e);else throw new Error("supsub must have either sup or sub.");var Q=Wb(u,"right")||"mord";return et.makeSpan([Q],[u,et.makeSpan(["msupsub"],[K])],e)},mathmlBuilder(n,e){var t=!1,r,i;n.base&&n.base.type==="horizBrace"&&(i=!!n.sup,i===n.base.isOver&&(t=!0,r=n.base.isOver)),n.base&&(n.base.type==="op"||n.base.type==="operatorname")&&(n.base.parentIsSupSub=!0);var o=[Pr(n.base,e)];n.sub&&o.push(Pr(n.sub,e)),n.sup&&o.push(Pr(n.sup,e));var u;if(t)u=r?"mover":"munder";else if(n.sub)if(n.sup){var v=n.base;v&&v.type==="op"&&v.limits&&e.style===Ln.DISPLAY||v&&v.type==="operatorname"&&v.alwaysHandleSupSub&&(e.style===Ln.DISPLAY||v.limits)?u="munderover":u="msubsup"}else{var p=n.base;p&&p.type==="op"&&p.limits&&(e.style===Ln.DISPLAY||p.alwaysHandleSupSub)||p&&p.type==="operatorname"&&p.alwaysHandleSupSub&&(p.limits||e.style===Ln.DISPLAY)?u="munder":u="msub"}else{var l=n.base;l&&l.type==="op"&&l.limits&&(e.style===Ln.DISPLAY||l.alwaysHandleSupSub)||l&&l.type==="operatorname"&&l.alwaysHandleSupSub&&(l.limits||e.style===Ln.DISPLAY)?u="mover":u="msup"}return new Dt.MathNode(u,o)}});uh({type:"atom",htmlBuilder(n,e){return et.mathsym(n.text,n.mode,e,["m"+n.family])},mathmlBuilder(n,e){var t=new Dt.MathNode("mo",[Bs(n.text,n.mode)]);if(n.family==="bin"){var r=C4(n,e);r==="bold-italic"&&t.setAttribute("mathvariant",r)}else n.family==="punct"?t.setAttribute("separator","true"):(n.family==="open"||n.family==="close")&&t.setAttribute("stretchy","false");return t}});var xP={mi:"italic",mn:"normal",mtext:"normal"};uh({type:"mathord",htmlBuilder(n,e){return et.makeOrd(n,e,"mathord")},mathmlBuilder(n,e){var t=new Dt.MathNode("mi",[Bs(n.text,n.mode,e)]),r=C4(n,e)||"italic";return r!==xP[t.type]&&t.setAttribute("mathvariant",r),t}});uh({type:"textord",htmlBuilder(n,e){return et.makeOrd(n,e,"textord")},mathmlBuilder(n,e){var t=Bs(n.text,n.mode,e),r=C4(n,e)||"normal",i;return n.mode==="text"?i=new Dt.MathNode("mtext",[t]):/[0-9]/.test(n.text)?i=new Dt.MathNode("mn",[t]):n.text==="\\prime"?i=new Dt.MathNode("mo",[t]):i=new Dt.MathNode("mi",[t]),r!==xP[i.type]&&i.setAttribute("mathvariant",r),i}});var m2={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},g2={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};uh({type:"spacing",htmlBuilder(n,e){if(g2.hasOwnProperty(n.text)){var t=g2[n.text].className||"";if(n.mode==="text"){var r=et.makeOrd(n,e,"textord");return r.classes.push(t),r}else return et.makeSpan(["mspace",t],[et.mathsym(n.text,n.mode,e)],e)}else{if(m2.hasOwnProperty(n.text))return et.makeSpan(["mspace",m2[n.text]],[],e);throw new Ut('Unknown type of space "'+n.text+'"')}},mathmlBuilder(n,e){var t;if(g2.hasOwnProperty(n.text))t=new Dt.MathNode("mtext",[new Dt.TextNode("")]);else{if(m2.hasOwnProperty(n.text))return new Dt.MathNode("mspace");throw new Ut('Unknown type of space "'+n.text+'"')}return t}});var z6=()=>{var n=new Dt.MathNode("mtd",[]);return n.setAttribute("width","50%"),n};uh({type:"tag",mathmlBuilder(n,e){var t=new Dt.MathNode("mtable",[new Dt.MathNode("mtr",[z6(),new Dt.MathNode("mtd",[Xc(n.body,e)]),z6(),new Dt.MathNode("mtd",[Xc(n.tag,e)])])]);return t.setAttribute("width","100%"),t}});var F6={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},N6={"\\textbf":"textbf","\\textmd":"textmd"},OY={"\\textit":"textit","\\textup":"textup"},O6=(n,e)=>{var t=n.font;return t?F6[t]?e.withTextFontFamily(F6[t]):N6[t]?e.withTextFontWeight(N6[t]):e.withTextFontShape(OY[t]):e};cn({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:r}=n,i=e[0];return{type:"text",mode:t.mode,body:mi(i),font:r}},htmlBuilder(n,e){var t=O6(n,e),r=Ci(n.body,t,!0);return et.makeSpan(["mord","text"],r,t)},mathmlBuilder(n,e){var t=O6(n,e);return Xc(n.body,t)}});cn({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"underline",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=hr(n.body,e),r=et.makeLineSpan("underline-line",e),i=e.fontMetrics().defaultRuleThickness,o=et.makeVList({positionType:"top",positionData:t.height,children:[{type:"kern",size:i},{type:"elem",elem:r},{type:"kern",size:3*i},{type:"elem",elem:t}]},e);return et.makeSpan(["mord","underline"],[o],e)},mathmlBuilder(n,e){var t=new Dt.MathNode("mo",[new Dt.TextNode("")]);t.setAttribute("stretchy","true");var r=new Dt.MathNode("munder",[Pr(n.body,e),t]);return r.setAttribute("accentunder","true"),r}});cn({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"vcenter",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=hr(n.body,e),r=e.fontMetrics().axisHeight,i=.5*(t.height-r-(t.depth+r));return et.makeVList({positionType:"shift",positionData:i,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){return new Dt.MathNode("mpadded",[Pr(n.body,e)],["vcenter"])}});cn({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(n,e,t){throw new Ut("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(n,e){for(var t=B6(n),r=[],i=e.havingStyle(e.style.text()),o=0;o<t.length;o++){var u=t[o];u==="~"&&(u="\\textasciitilde"),r.push(et.makeSymbol(u,"Typewriter-Regular",n.mode,i,["mord","texttt"]))}return et.makeSpan(["mord","text"].concat(i.sizingClasses(e)),et.tryCombineChars(r),i)},mathmlBuilder(n,e){var t=new Dt.TextNode(B6(n)),r=new Dt.MathNode("mtext",[t]);return r.setAttribute("mathvariant","monospace"),r}});var B6=n=>n.body.replace(/ /g,n.star?"":""),Ic=GC,bP=`[ \r
	]`,BY="\\\\[a-zA-Z@]+",UY="\\\\[^\uD800-\uDFFF]",VY="("+BY+")"+bP+"*",HY=`\\\\(
|[ \r	]+
?)[ \r	]*`,Zb="[-]",GY=new RegExp(Zb+"+$"),jY="("+bP+"+)|"+(HY+"|")+"([!-\\[\\]---]"+(Zb+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(Zb+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+VY)+("|"+UY+")");class U6{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(jY,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new zs("EOF",new os(this,t,t));var r=this.tokenRegex.exec(e);if(r===null||r.index!==t)throw new Ut("Unexpected character: '"+e[t]+"'",new zs(e[t],new os(this,t,t+1)));var i=r[6]||r[3]||(r[2]?"\\ ":" ");if(this.catcodes[i]===14){var o=e.indexOf(`
`,this.tokenRegex.lastIndex);return o===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=o+1,this.lex()}return new zs(i,new os(this,t,this.tokenRegex.lastIndex))}}class WY{constructor(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new Ut("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(e[t]==null?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,r){if(r===void 0&&(r=!1),r){for(var i=0;i<this.undefStack.length;i++)delete this.undefStack[i][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var o=this.undefStack[this.undefStack.length-1];o&&!o.hasOwnProperty(e)&&(o[e]=this.current[e])}t==null?delete this.current[e]:this.current[e]=t}}var $Y=uP;he("\\noexpand",function(n){var e=n.popToken();return n.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});he("\\expandafter",function(n){var e=n.popToken();return n.expandOnce(!0),{tokens:[e],numArgs:0}});he("\\@firstoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[0],numArgs:0}});he("\\@secondoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[1],numArgs:0}});he("\\@ifnextchar",function(n){var e=n.consumeArgs(3);n.consumeSpaces();var t=n.future();return e[0].length===1&&e[0][0].text===t.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});he("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");he("\\TextOrMath",function(n){var e=n.consumeArgs(2);return n.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var V6={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};he("\\char",function(n){var e=n.popToken(),t,r="";if(e.text==="'")t=8,e=n.popToken();else if(e.text==='"')t=16,e=n.popToken();else if(e.text==="`")if(e=n.popToken(),e.text[0]==="\\")r=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new Ut("\\char` missing argument");r=e.text.charCodeAt(0)}else t=10;if(t){if(r=V6[e.text],r==null||r>=t)throw new Ut("Invalid base-"+t+" digit "+e.text);for(var i;(i=V6[n.future().text])!=null&&i<t;)r*=t,r+=i,n.popToken()}return"\\@char{"+r+"}"});var O4=(n,e,t)=>{var r=n.consumeArg().tokens;if(r.length!==1)throw new Ut("\\newcommand's first argument must be a macro name");var i=r[0].text,o=n.isDefined(i);if(o&&!e)throw new Ut("\\newcommand{"+i+"} attempting to redefine "+(i+"; use \\renewcommand"));if(!o&&!t)throw new Ut("\\renewcommand{"+i+"} when command "+i+" does not yet exist; use \\newcommand");var u=0;if(r=n.consumeArg().tokens,r.length===1&&r[0].text==="["){for(var l="",p=n.expandNextToken();p.text!=="]"&&p.text!=="EOF";)l+=p.text,p=n.expandNextToken();if(!l.match(/^\s*[0-9]+\s*$/))throw new Ut("Invalid number of arguments: "+l);u=parseInt(l),r=n.consumeArg().tokens}return n.macros.set(i,{tokens:r,numArgs:u}),""};he("\\newcommand",n=>O4(n,!1,!0));he("\\renewcommand",n=>O4(n,!0,!1));he("\\providecommand",n=>O4(n,!0,!0));he("\\message",n=>{var e=n.consumeArgs(1)[0];return console.log(e.reverse().map(t=>t.text).join("")),""});he("\\errmessage",n=>{var e=n.consumeArgs(1)[0];return console.error(e.reverse().map(t=>t.text).join("")),""});he("\\show",n=>{var e=n.popToken(),t=e.text;return console.log(e,n.macros.get(t),Ic[t],kr.math[t],kr.text[t]),""});he("\\bgroup","{");he("\\egroup","}");he("~","\\nobreakspace");he("\\lq","`");he("\\rq","'");he("\\aa","\\r a");he("\\AA","\\r A");he("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`}");he("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");he("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`}");he("","\\mathscr{B}");he("","\\mathscr{E}");he("","\\mathscr{F}");he("","\\mathscr{H}");he("","\\mathscr{I}");he("","\\mathscr{L}");he("","\\mathscr{M}");he("","\\mathscr{R}");he("","\\mathfrak{C}");he("","\\mathfrak{H}");he("","\\mathfrak{Z}");he("\\Bbbk","\\Bbb{k}");he("","\\cdotp");he("\\llap","\\mathllap{\\textrm{#1}}");he("\\rlap","\\mathrlap{\\textrm{#1}}");he("\\clap","\\mathclap{\\textrm{#1}}");he("\\mathstrut","\\vphantom{(}");he("\\underbar","\\underline{\\text{#1}}");he("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');he("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`}}");he("\\ne","\\neq");he("","\\neq");he("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`}}");he("","\\notin");he("","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`}}");he("","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`}}");he("","\\perp");he("","\\mathclose{!\\mkern-0.8mu!}");he("","\\notni");he("","\\ulcorner");he("","\\urcorner");he("","\\llcorner");he("","\\lrcorner");he("","\\copyright");he("","\\textregistered");he("","\\textregistered");he("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');he("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');he("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');he("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');he("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}");he("","\\vdots");he("\\varGamma","\\mathit{\\Gamma}");he("\\varDelta","\\mathit{\\Delta}");he("\\varTheta","\\mathit{\\Theta}");he("\\varLambda","\\mathit{\\Lambda}");he("\\varXi","\\mathit{\\Xi}");he("\\varPi","\\mathit{\\Pi}");he("\\varSigma","\\mathit{\\Sigma}");he("\\varUpsilon","\\mathit{\\Upsilon}");he("\\varPhi","\\mathit{\\Phi}");he("\\varPsi","\\mathit{\\Psi}");he("\\varOmega","\\mathit{\\Omega}");he("\\substack","\\begin{subarray}{c}#1\\end{subarray}");he("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");he("\\boxed","\\fbox{$\\displaystyle{#1}$}");he("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");he("\\implies","\\DOTSB\\;\\Longrightarrow\\;");he("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var H6={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};he("\\dots",function(n){var e="\\dotso",t=n.expandAfterFuture().text;return t in H6?e=H6[t]:(t.slice(0,4)==="\\not"||t in kr.math&&Dn.contains(["bin","rel"],kr.math[t].group))&&(e="\\dotsb"),e});var B4={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};he("\\dotso",function(n){var e=n.future().text;return e in B4?"\\ldots\\,":"\\ldots"});he("\\dotsc",function(n){var e=n.future().text;return e in B4&&e!==","?"\\ldots\\,":"\\ldots"});he("\\cdots",function(n){var e=n.future().text;return e in B4?"\\@cdots\\,":"\\@cdots"});he("\\dotsb","\\cdots");he("\\dotsm","\\cdots");he("\\dotsi","\\!\\cdots");he("\\dotsx","\\ldots\\,");he("\\DOTSI","\\relax");he("\\DOTSB","\\relax");he("\\DOTSX","\\relax");he("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");he("\\,","\\tmspace+{3mu}{.1667em}");he("\\thinspace","\\,");he("\\>","\\mskip{4mu}");he("\\:","\\tmspace+{4mu}{.2222em}");he("\\medspace","\\:");he("\\;","\\tmspace+{5mu}{.2777em}");he("\\thickspace","\\;");he("\\!","\\tmspace-{3mu}{.1667em}");he("\\negthinspace","\\!");he("\\negmedspace","\\tmspace-{4mu}{.2222em}");he("\\negthickspace","\\tmspace-{5mu}{.277em}");he("\\enspace","\\kern.5em ");he("\\enskip","\\hskip.5em\\relax");he("\\quad","\\hskip1em\\relax");he("\\qquad","\\hskip2em\\relax");he("\\tag","\\@ifstar\\tag@literal\\tag@paren");he("\\tag@paren","\\tag@literal{({#1})}");he("\\tag@literal",n=>{if(n.macros.get("\\df@tag"))throw new Ut("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});he("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");he("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");he("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");he("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");he("\\newline","\\\\\\relax");he("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var wP=qt(Io["Main-Regular"][84][1]-.7*Io["Main-Regular"][65][1]);he("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+wP+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");he("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+wP+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");he("\\hspace","\\@ifstar\\@hspacer\\@hspace");he("\\@hspace","\\hskip #1\\relax");he("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");he("\\ordinarycolon",":");he("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");he("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');he("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');he("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');he("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');he("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');he("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');he("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');he("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');he("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');he("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');he("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');he("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');he("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');he("","\\dblcolon");he("","\\eqcolon");he("","\\coloneqq");he("","\\eqqcolon");he("","\\Coloneqq");he("\\ratio","\\vcentcolon");he("\\coloncolon","\\dblcolon");he("\\colonequals","\\coloneqq");he("\\coloncolonequals","\\Coloneqq");he("\\equalscolon","\\eqqcolon");he("\\equalscoloncolon","\\Eqqcolon");he("\\colonminus","\\coloneq");he("\\coloncolonminus","\\Coloneq");he("\\minuscolon","\\eqcolon");he("\\minuscoloncolon","\\Eqcolon");he("\\coloncolonapprox","\\Colonapprox");he("\\coloncolonsim","\\Colonsim");he("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");he("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");he("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");he("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");he("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`}}");he("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");he("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");he("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");he("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");he("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");he("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");he("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");he("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");he("\\gvertneqq","\\html@mathml{\\@gvertneqq}{}");he("\\lvertneqq","\\html@mathml{\\@lvertneqq}{}");he("\\ngeqq","\\html@mathml{\\@ngeqq}{}");he("\\ngeqslant","\\html@mathml{\\@ngeqslant}{}");he("\\nleqq","\\html@mathml{\\@nleqq}{}");he("\\nleqslant","\\html@mathml{\\@nleqslant}{}");he("\\nshortmid","\\html@mathml{\\@nshortmid}{}");he("\\nshortparallel","\\html@mathml{\\@nshortparallel}{}");he("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{}");he("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{}");he("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{}");he("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{}");he("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{}");he("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{}");he("\\imath","\\html@mathml{\\@imath}{}");he("\\jmath","\\html@mathml{\\@jmath}{}");he("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`}}");he("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`}}");he("","\\llbracket");he("","\\rrbracket");he("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`}}");he("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`}}");he("","\\lBrace");he("","\\rBrace");he("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`}}");he("","\\minuso");he("\\darr","\\downarrow");he("\\dArr","\\Downarrow");he("\\Darr","\\Downarrow");he("\\lang","\\langle");he("\\rang","\\rangle");he("\\uarr","\\uparrow");he("\\uArr","\\Uparrow");he("\\Uarr","\\Uparrow");he("\\N","\\mathbb{N}");he("\\R","\\mathbb{R}");he("\\Z","\\mathbb{Z}");he("\\alef","\\aleph");he("\\alefsym","\\aleph");he("\\Alpha","\\mathrm{A}");he("\\Beta","\\mathrm{B}");he("\\bull","\\bullet");he("\\Chi","\\mathrm{X}");he("\\clubs","\\clubsuit");he("\\cnums","\\mathbb{C}");he("\\Complex","\\mathbb{C}");he("\\Dagger","\\ddagger");he("\\diamonds","\\diamondsuit");he("\\empty","\\emptyset");he("\\Epsilon","\\mathrm{E}");he("\\Eta","\\mathrm{H}");he("\\exist","\\exists");he("\\harr","\\leftrightarrow");he("\\hArr","\\Leftrightarrow");he("\\Harr","\\Leftrightarrow");he("\\hearts","\\heartsuit");he("\\image","\\Im");he("\\infin","\\infty");he("\\Iota","\\mathrm{I}");he("\\isin","\\in");he("\\Kappa","\\mathrm{K}");he("\\larr","\\leftarrow");he("\\lArr","\\Leftarrow");he("\\Larr","\\Leftarrow");he("\\lrarr","\\leftrightarrow");he("\\lrArr","\\Leftrightarrow");he("\\Lrarr","\\Leftrightarrow");he("\\Mu","\\mathrm{M}");he("\\natnums","\\mathbb{N}");he("\\Nu","\\mathrm{N}");he("\\Omicron","\\mathrm{O}");he("\\plusmn","\\pm");he("\\rarr","\\rightarrow");he("\\rArr","\\Rightarrow");he("\\Rarr","\\Rightarrow");he("\\real","\\Re");he("\\reals","\\mathbb{R}");he("\\Reals","\\mathbb{R}");he("\\Rho","\\mathrm{P}");he("\\sdot","\\cdot");he("\\sect","\\S");he("\\spades","\\spadesuit");he("\\sub","\\subset");he("\\sube","\\subseteq");he("\\supe","\\supseteq");he("\\Tau","\\mathrm{T}");he("\\thetasym","\\vartheta");he("\\weierp","\\wp");he("\\Zeta","\\mathrm{Z}");he("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");he("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");he("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");he("\\bra","\\mathinner{\\langle{#1}|}");he("\\ket","\\mathinner{|{#1}\\rangle}");he("\\braket","\\mathinner{\\langle{#1}\\rangle}");he("\\Bra","\\left\\langle#1\\right|");he("\\Ket","\\left|#1\\right\\rangle");var SP=n=>e=>{var t=e.consumeArg().tokens,r=e.consumeArg().tokens,i=e.consumeArg().tokens,o=e.consumeArg().tokens,u=e.macros.get("|"),l=e.macros.get("\\|");e.macros.beginGroup();var p=M=>w=>{n&&(w.macros.set("|",u),i.length&&w.macros.set("\\|",l));var A=M;if(!M&&i.length){var k=w.future();k.text==="|"&&(w.popToken(),A=!0)}return{tokens:A?i:r,numArgs:0}};e.macros.set("|",p(!1)),i.length&&e.macros.set("\\|",p(!0));var v=e.consumeArg().tokens,x=e.expandTokens([...o,...v,...t]);return e.macros.endGroup(),{tokens:x.reverse(),numArgs:0}};he("\\bra@ket",SP(!1));he("\\bra@set",SP(!0));he("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");he("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");he("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");he("\\angln","{\\angl n}");he("\\blue","\\textcolor{##6495ed}{#1}");he("\\orange","\\textcolor{##ffa500}{#1}");he("\\pink","\\textcolor{##ff00af}{#1}");he("\\red","\\textcolor{##df0030}{#1}");he("\\green","\\textcolor{##28ae7b}{#1}");he("\\gray","\\textcolor{gray}{#1}");he("\\purple","\\textcolor{##9d38bd}{#1}");he("\\blueA","\\textcolor{##ccfaff}{#1}");he("\\blueB","\\textcolor{##80f6ff}{#1}");he("\\blueC","\\textcolor{##63d9ea}{#1}");he("\\blueD","\\textcolor{##11accd}{#1}");he("\\blueE","\\textcolor{##0c7f99}{#1}");he("\\tealA","\\textcolor{##94fff5}{#1}");he("\\tealB","\\textcolor{##26edd5}{#1}");he("\\tealC","\\textcolor{##01d1c1}{#1}");he("\\tealD","\\textcolor{##01a995}{#1}");he("\\tealE","\\textcolor{##208170}{#1}");he("\\greenA","\\textcolor{##b6ffb0}{#1}");he("\\greenB","\\textcolor{##8af281}{#1}");he("\\greenC","\\textcolor{##74cf70}{#1}");he("\\greenD","\\textcolor{##1fab54}{#1}");he("\\greenE","\\textcolor{##0d923f}{#1}");he("\\goldA","\\textcolor{##ffd0a9}{#1}");he("\\goldB","\\textcolor{##ffbb71}{#1}");he("\\goldC","\\textcolor{##ff9c39}{#1}");he("\\goldD","\\textcolor{##e07d10}{#1}");he("\\goldE","\\textcolor{##a75a05}{#1}");he("\\redA","\\textcolor{##fca9a9}{#1}");he("\\redB","\\textcolor{##ff8482}{#1}");he("\\redC","\\textcolor{##f9685d}{#1}");he("\\redD","\\textcolor{##e84d39}{#1}");he("\\redE","\\textcolor{##bc2612}{#1}");he("\\maroonA","\\textcolor{##ffbde0}{#1}");he("\\maroonB","\\textcolor{##ff92c6}{#1}");he("\\maroonC","\\textcolor{##ed5fa6}{#1}");he("\\maroonD","\\textcolor{##ca337c}{#1}");he("\\maroonE","\\textcolor{##9e034e}{#1}");he("\\purpleA","\\textcolor{##ddd7ff}{#1}");he("\\purpleB","\\textcolor{##c6b9fc}{#1}");he("\\purpleC","\\textcolor{##aa87ff}{#1}");he("\\purpleD","\\textcolor{##7854ab}{#1}");he("\\purpleE","\\textcolor{##543b78}{#1}");he("\\mintA","\\textcolor{##f5f9e8}{#1}");he("\\mintB","\\textcolor{##edf2df}{#1}");he("\\mintC","\\textcolor{##e0e5cc}{#1}");he("\\grayA","\\textcolor{##f6f7f7}{#1}");he("\\grayB","\\textcolor{##f0f1f2}{#1}");he("\\grayC","\\textcolor{##e3e5e6}{#1}");he("\\grayD","\\textcolor{##d6d8da}{#1}");he("\\grayE","\\textcolor{##babec2}{#1}");he("\\grayF","\\textcolor{##888d93}{#1}");he("\\grayG","\\textcolor{##626569}{#1}");he("\\grayH","\\textcolor{##3b3e40}{#1}");he("\\grayI","\\textcolor{##21242c}{#1}");he("\\kaBlue","\\textcolor{##314453}{#1}");he("\\kaGreen","\\textcolor{##71B307}{#1}");var MP={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class qY{constructor(e,t,r){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new WY($Y,t.macros),this.mode=r,this.stack=[]}feed(e){this.lexer=new U6(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,r,i;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;t=this.popToken(),{tokens:i,end:r}=this.consumeArg(["]"])}else({tokens:i,start:t,end:r}=this.consumeArg());return this.pushToken(new zs("EOF",r.loc)),this.pushTokens(i),t.range(r,"")}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var t=[],r=e&&e.length>0;r||this.consumeSpaces();var i=this.future(),o,u=0,l=0;do{if(o=this.popToken(),t.push(o),o.text==="{")++u;else if(o.text==="}"){if(--u,u===-1)throw new Ut("Extra }",o)}else if(o.text==="EOF")throw new Ut("Unexpected end of input in a macro argument, expected '"+(e&&r?e[l]:"}")+"'",o);if(e&&r)if((u===0||u===1&&e[l]==="{")&&o.text===e[l]){if(++l,l===e.length){t.splice(-l,l);break}}else l=0}while(u!==0||r);return i.text==="{"&&t[t.length-1].text==="}"&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:i,end:o}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new Ut("The length of delimiters doesn't match the number of args!");for(var r=t[0],i=0;i<r.length;i++){var o=this.popToken();if(r[i]!==o.text)throw new Ut("Use of the macro doesn't match its definition",o)}}for(var u=[],l=0;l<e;l++)u.push(this.consumeArg(t&&t[l+1]).tokens);return u}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new Ut("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),r=t.text,i=t.noexpand?null:this._getExpansion(r);if(i==null||e&&i.unexpandable){if(e&&i==null&&r[0]==="\\"&&!this.isDefined(r))throw new Ut("Undefined control sequence: "+r);return this.pushToken(t),!1}this.countExpansion(1);var o=i.tokens,u=this.consumeArgs(i.numArgs,i.delimiters);if(i.numArgs){o=o.slice();for(var l=o.length-1;l>=0;--l){var p=o[l];if(p.text==="#"){if(l===0)throw new Ut("Incomplete placeholder at end of macro body",p);if(p=o[--l],p.text==="#")o.splice(l+1,1);else if(/^[1-9]$/.test(p.text))o.splice(l,2,...u[+p.text-1]);else throw new Ut("Not a valid argument number",p)}}}return this.pushTokens(o),o.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new zs(e)]):void 0}expandTokens(e){var t=[],r=this.stack.length;for(this.pushTokens(e);this.stack.length>r;)if(this.expandOnce(!0)===!1){var i=this.stack.pop();i.treatAsRelax&&(i.noexpand=!1,i.treatAsRelax=!1),t.push(i)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t&&t.map(r=>r.text).join("")}_getExpansion(e){var t=this.macros.get(e);if(t==null)return t;if(e.length===1){var r=this.lexer.catcodes[e];if(r!=null&&r!==13)return}var i=typeof t=="function"?t(this):t;if(typeof i=="string"){var o=0;if(i.indexOf("#")!==-1)for(var u=i.replace(/##/g,"");u.indexOf("#"+(o+1))!==-1;)++o;for(var l=new U6(i,this.settings),p=[],v=l.lex();v.text!=="EOF";)p.push(v),v=l.lex();p.reverse();var x={tokens:p,numArgs:o};return x}return i}isDefined(e){return this.macros.has(e)||Ic.hasOwnProperty(e)||kr.math.hasOwnProperty(e)||kr.text.hasOwnProperty(e)||MP.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return t!=null?typeof t=="string"||typeof t=="function"||!t.unexpandable:Ic.hasOwnProperty(e)&&!Ic[e].primitive}}var G6=/^[]/,I1=Object.freeze({"":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"a","":"e","":"h","":"i","":"j","":"k","":"l","":"m","":"n","":"o","":"p","":"r","":"s","":"t","":"u","":"v","":"x","":"","":"","":"","":"","":"","":"+","":"-","":"=","":"(","":")","":"0","":"1","":"2","":"3","":"4","":"5","":"6","":"7","":"8","":"9","":"A","":"B","":"D","":"E","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"P","":"R","":"T","":"U","":"V","":"W","":"a","":"b","":"c","":"d","":"e","":"f","":"g",:"h","":"i",:"j","":"k",:"l","":"m",:"n","":"o","":"p",:"r",:"s","":"t","":"u","":"v",:"w",:"x",:"y","":"z","":"","":"","":"","":"","":"","":""}),y2={"":{text:"\\'",math:"\\acute"},"":{text:"\\`",math:"\\grave"},"":{text:'\\"',math:"\\ddot"},"":{text:"\\~",math:"\\tilde"},"":{text:"\\=",math:"\\bar"},"":{text:"\\u",math:"\\breve"},"":{text:"\\v",math:"\\check"},"":{text:"\\^",math:"\\hat"},"":{text:"\\.",math:"\\dot"},"":{text:"\\r",math:"\\mathring"},"":{text:"\\H"},"":{text:"\\c"}},j6={:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"a",:"b",:"c",:"c",:"c",:"c",:"c",:"c",:"d",:"d",:"d",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"e",:"f",:"g",:"g",:"g",:"g",:"g",:"g",:"g",:"h",:"h",:"h",:"h",:"h",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"i",:"j",:"j",:"k",:"k",:"k",:"l",:"l",:"l",:"m",:"m",:"n",:"n",:"n",:"n",:"n",:"n",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"o",:"p",:"p",:"r",:"r",:"r",:"r",:"s",:"s",:"s",:"s",:"s",:"s",:"s",:"t",:"t",:"t",:"t",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"u",:"v",:"w",:"w",:"w",:"w",:"w",:"w",:"x",:"x",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"y",:"z",:"z",:"z",:"z",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"A",:"B",:"C",:"C",:"C",:"C",:"C",:"C",:"D",:"D",:"D",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"E",:"F",:"G",:"G",:"G",:"G",:"G",:"G",:"G",:"H",:"H",:"H",:"H",:"H",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"I",:"J",:"K",:"K",:"K",:"L",:"L",:"L",:"M",:"M",:"N",:"N",:"N",:"N",:"N",:"N",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"O",:"P",:"P",:"R",:"R",:"R",:"R",:"S",:"S",:"S",:"S",:"S",:"S",:"S",:"T",:"T",:"T",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"U",:"V",:"W",:"W",:"W",:"W",:"W",:"X",:"X",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Y",:"Z",:"Z",:"Z",:"Z",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:"",:""};class zv{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new qY(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(t===void 0&&(t=!0),this.fetch().text!==e)throw new Ut("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new zs("}")),this.gullet.pushTokens(e);var r=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,r}parseExpression(e,t){for(var r=[];;){this.mode==="math"&&this.consumeSpaces();var i=this.fetch();if(zv.endOfExpression.indexOf(i.text)!==-1||t&&i.text===t||e&&Ic[i.text]&&Ic[i.text].infix)break;var o=this.parseAtom(t);if(o){if(o.type==="internal")continue}else break;r.push(o)}return this.mode==="text"&&this.formLigatures(r),this.handleInfixNodes(r)}handleInfixNodes(e){for(var t=-1,r,i=0;i<e.length;i++)if(e[i].type==="infix"){if(t!==-1)throw new Ut("only one infix operator per group",e[i].token);t=i,r=e[i].replaceWith}if(t!==-1&&r){var o,u,l=e.slice(0,t),p=e.slice(t+1);l.length===1&&l[0].type==="ordgroup"?o=l[0]:o={type:"ordgroup",mode:this.mode,body:l},p.length===1&&p[0].type==="ordgroup"?u=p[0]:u={type:"ordgroup",mode:this.mode,body:p};var v;return r==="\\\\abovefrac"?v=this.callFunction(r,[o,e[t],u],[]):v=this.callFunction(r,[o,u],[]),[v]}else return e}handleSupSubscript(e){var t=this.fetch(),r=t.text;this.consume(),this.consumeSpaces();var i=this.parseGroup(e);if(!i)throw new Ut("Expected group after '"+r+"'",t);return i}formatUnsupportedCmd(e){for(var t=[],r=0;r<e.length;r++)t.push({type:"textord",mode:"text",text:e[r]});var i={type:"text",mode:this.mode,body:t},o={type:"color",mode:this.mode,color:this.settings.errorColor,body:[i]};return o}parseAtom(e){var t=this.parseGroup("atom",e);if(this.mode==="text")return t;for(var r,i;;){this.consumeSpaces();var o=this.fetch();if(o.text==="\\limits"||o.text==="\\nolimits"){if(t&&t.type==="op"){var u=o.text==="\\limits";t.limits=u,t.alwaysHandleSupSub=!0}else if(t&&t.type==="operatorname")t.alwaysHandleSupSub&&(t.limits=o.text==="\\limits");else throw new Ut("Limit controls must follow a math operator",o);this.consume()}else if(o.text==="^"){if(r)throw new Ut("Double superscript",o);r=this.handleSupSubscript("superscript")}else if(o.text==="_"){if(i)throw new Ut("Double subscript",o);i=this.handleSupSubscript("subscript")}else if(o.text==="'"){if(r)throw new Ut("Double superscript",o);var l={type:"textord",mode:this.mode,text:"\\prime"},p=[l];for(this.consume();this.fetch().text==="'";)p.push(l),this.consume();this.fetch().text==="^"&&p.push(this.handleSupSubscript("superscript")),r={type:"ordgroup",mode:this.mode,body:p}}else if(I1[o.text]){var v=G6.test(o.text),x=[];for(x.push(new zs(I1[o.text])),this.consume();;){var M=this.fetch().text;if(!I1[M]||G6.test(M)!==v)break;x.unshift(new zs(I1[M])),this.consume()}var w=this.subparse(x);v?i={type:"ordgroup",mode:"math",body:w}:r={type:"ordgroup",mode:"math",body:w}}else break}return r||i?{type:"supsub",mode:this.mode,base:t,sup:r,sub:i}:t}parseFunction(e,t){var r=this.fetch(),i=r.text,o=Ic[i];if(!o)return null;if(this.consume(),t&&t!=="atom"&&!o.allowedInArgument)throw new Ut("Got function '"+i+"' with no arguments"+(t?" as "+t:""),r);if(this.mode==="text"&&!o.allowedInText)throw new Ut("Can't use function '"+i+"' in text mode",r);if(this.mode==="math"&&o.allowedInMath===!1)throw new Ut("Can't use function '"+i+"' in math mode",r);var{args:u,optArgs:l}=this.parseArguments(i,o);return this.callFunction(i,u,l,r,e)}callFunction(e,t,r,i,o){var u={funcName:e,parser:this,token:i,breakOnTokenText:o},l=Ic[e];if(l&&l.handler)return l.handler(u,t,r);throw new Ut("No function handler for "+e)}parseArguments(e,t){var r=t.numArgs+t.numOptionalArgs;if(r===0)return{args:[],optArgs:[]};for(var i=[],o=[],u=0;u<r;u++){var l=t.argTypes&&t.argTypes[u],p=u<t.numOptionalArgs;(t.primitive&&l==null||t.type==="sqrt"&&u===1&&o[0]==null)&&(l="primitive");var v=this.parseGroupOfType("argument to '"+e+"'",l,p);if(p)o.push(v);else if(v!=null)i.push(v);else throw new Ut("Null argument, please report this as a bug")}return{args:i,optArgs:o}}parseGroupOfType(e,t,r){switch(t){case"color":return this.parseColorGroup(r);case"size":return this.parseSizeGroup(r);case"url":return this.parseUrlGroup(r);case"math":case"text":return this.parseArgumentGroup(r,t);case"hbox":{var i=this.parseArgumentGroup(r,"text");return i!=null?{type:"styling",mode:i.mode,body:[i],style:"text"}:null}case"raw":{var o=this.parseStringGroup("raw",r);return o!=null?{type:"raw",mode:"text",string:o.text}:null}case"primitive":{if(r)throw new Ut("A primitive argument cannot be optional");var u=this.parseGroup(e);if(u==null)throw new Ut("Expected group as "+e,this.fetch());return u}case"original":case null:case void 0:return this.parseArgumentGroup(r);default:throw new Ut("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,t){var r=this.gullet.scanArgument(t);if(r==null)return null;for(var i="",o;(o=this.fetch()).text!=="EOF";)i+=o.text,this.consume();return this.consume(),r.text=i,r}parseRegexGroup(e,t){for(var r=this.fetch(),i=r,o="",u;(u=this.fetch()).text!=="EOF"&&e.test(o+u.text);)i=u,o+=i.text,this.consume();if(o==="")throw new Ut("Invalid "+t+": '"+r.text+"'",r);return r.range(i,o)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(t==null)return null;var r=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!r)throw new Ut("Invalid color: '"+t.text+"'",t);var i=r[0];return/^[0-9a-f]{6}$/i.test(i)&&(i="#"+i),{type:"color-token",mode:this.mode,color:i}}parseSizeGroup(e){var t,r=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?t=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):t=this.parseStringGroup("size",e),!t)return null;!e&&t.text.length===0&&(t.text="0pt",r=!0);var i=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!i)throw new Ut("Invalid size: '"+t.text+"'",t);var o={number:+(i[1]+i[2]),unit:i[3]};if(!LC(o))throw new Ut("Invalid unit: '"+o.unit+"'",t);return{type:"size",mode:this.mode,value:o,isBlank:r}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),t==null)return null;var r=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:r}}parseArgumentGroup(e,t){var r=this.gullet.scanArgument(e);if(r==null)return null;var i=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var o=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var u={type:"ordgroup",mode:this.mode,loc:r.loc,body:o};return t&&this.switchMode(i),u}parseGroup(e,t){var r=this.fetch(),i=r.text,o;if(i==="{"||i==="\\begingroup"){this.consume();var u=i==="{"?"}":"\\endgroup";this.gullet.beginGroup();var l=this.parseExpression(!1,u),p=this.fetch();this.expect(u),this.gullet.endGroup(),o={type:"ordgroup",mode:this.mode,loc:os.range(r,p),body:l,semisimple:i==="\\begingroup"||void 0}}else if(o=this.parseFunction(t,e)||this.parseSymbol(),o==null&&i[0]==="\\"&&!MP.hasOwnProperty(i)){if(this.settings.throwOnError)throw new Ut("Undefined control sequence: "+i,r);o=this.formatUnsupportedCmd(i),this.consume()}return o}formLigatures(e){for(var t=e.length-1,r=0;r<t;++r){var i=e[r],o=i.text;o==="-"&&e[r+1].text==="-"&&(r+1<t&&e[r+2].text==="-"?(e.splice(r,3,{type:"textord",mode:"text",loc:os.range(i,e[r+2]),text:"---"}),t-=2):(e.splice(r,2,{type:"textord",mode:"text",loc:os.range(i,e[r+1]),text:"--"}),t-=1)),(o==="'"||o==="`")&&e[r+1].text===o&&(e.splice(r,2,{type:"textord",mode:"text",loc:os.range(i,e[r+1]),text:o+o}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var r=t.slice(5),i=r.charAt(0)==="*";if(i&&(r=r.slice(1)),r.length<2||r.charAt(0)!==r.slice(-1))throw new Ut(`\\verb assertion failed --
                    please report what input caused this bug`);return r=r.slice(1,-1),{type:"verb",mode:"text",body:r,star:i}}j6.hasOwnProperty(t[0])&&!kr[this.mode][t[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=j6[t[0]]+t.slice(1));var o=GY.exec(t);o&&(t=t.substring(0,o.index),t==="i"?t="":t==="j"&&(t=""));var u;if(kr[this.mode][t]){this.settings.strict&&this.mode==="math"&&jb.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var l=kr[this.mode][t].group,p=os.range(e),v;if(zZ.hasOwnProperty(l)){var x=l;v={type:"atom",mode:this.mode,family:x,loc:p,text:t}}else v={type:l,mode:this.mode,loc:p,text:t};u=v}else if(t.charCodeAt(0)>=128)this.settings.strict&&(kC(t.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'"'+(" ("+t.charCodeAt(0)+")"),e)),u={type:"textord",mode:"text",loc:os.range(e),text:t};else return null;if(this.consume(),o)for(var M=0;M<o[0].length;M++){var w=o[0][M];if(!y2[w])throw new Ut("Unknown accent ' "+w+"'",e);var A=y2[w][this.mode]||y2[w].text;if(!A)throw new Ut("Accent "+w+" unsupported in "+this.mode+" mode",e);u={type:"accent",mode:this.mode,loc:os.range(e),label:A,isStretchy:!1,isShifty:!0,base:u}}return u}}zv.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var U4=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var r=new zv(e,t);delete r.gullet.macros.current["\\df@tag"];var i=r.parse();if(delete r.gullet.macros.current["\\current@color"],delete r.gullet.macros.current["\\color"],r.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new Ut("\\tag works only in display equations");i=[{type:"tag",mode:"text",body:i,tag:r.subparse([new zs("\\df@tag")])}]}return i},TP=function(e,t,r){t.textContent="";var i=V4(e,r).toNode();t.appendChild(i)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),TP=function(){throw new Ut("KaTeX doesn't work in quirks mode.")});var XY=function(e,t){var r=V4(e,t).toMarkup();return r},ZY=function(e,t){var r=new w4(t);return U4(e,r)},EP=function(e,t,r){if(r.throwOnError||!(e instanceof Ut))throw e;var i=et.makeSpan(["katex-error"],[new Os(t)]);return i.setAttribute("title",e.toString()),i.setAttribute("style","color:"+r.errorColor),i},V4=function(e,t){var r=new w4(t);try{var i=U4(e,r);return iY(i,e,r)}catch(o){return EP(o,e,r)}},YY=function(e,t){var r=new w4(t);try{var i=U4(e,r);return aY(i,e,r)}catch(o){return EP(o,e,r)}},AP={version:"0.16.10",render:TP,renderToString:XY,ParseError:Ut,SETTINGS_SCHEMA:Q1,__parse:ZY,__renderToDomTree:V4,__renderToHTMLTree:YY,__setFontMetrics:CZ,__defineSymbol:N,__defineFunction:cn,__defineMacro:he,__domTree:{Span:wm,Anchor:T4,SymbolNode:Os,SvgNode:kl,PathNode:qc,LineNode:Gb}};function KY(n,e,t,r){const i=n.node().width.baseVal.value,o=n.node().height.baseVal.value,u=em().domain([0,1]).range([0,i]),l=em().domain([0,1]).range([o,0]),p=w=>e.nodes.find(A=>A.id===w),v=Gy().duration(t).ease(u6),x=n.selectAll("line.edge").data(e.edges,w=>w.id1+" "+w.id2);x.enter().append("line").attr("class","edge").attr("x1",w=>u(p(w.id1).x)).attr("y1",w=>l(p(w.id1).y)).attr("x2",w=>u(p(w.id2).x)).attr("y2",w=>l(p(w.id2).y)).attr("stroke-width",0).transition(v).attr("stroke-width",1).attr("stroke",r),x.transition(v).attr("x1",w=>u(p(w.id1).x)).attr("y1",w=>l(p(w.id1).y)).attr("x2",w=>u(p(w.id2).x)).attr("y2",w=>l(p(w.id2).y)),x.exit().transition(Gy().duration(150).ease(u6)).remove();const M=n.selectAll("circle.node").data(e.nodes,w=>w.id);M.enter().append("circle").attr("class","node").attr("fill",r).attr("cx",w=>u(w.x)).attr("cy",w=>l(w.y)).attr("r",0).transition(v).attr("r",5),M.transition(v).attr("cx",w=>u(w.x)).attr("cy",w=>l(w.y)),M.exit().transition(v).remove()}function CP(n,e){const t=n.x-e.x,r=n.y-e.y;return Math.sqrt(t*t+r*r)}function JY(n,e,t){const r={nodes:[],edges:[]};for(let i=0;i<n;i++)r.nodes.push({id:i,x:Math.random(),y:Math.random()});for(const i of r.nodes)for(const o of r.nodes){if(i.id===o.id)continue;const u=CP(i,o);e<u&&u<t&&r.edges.push({id1:i.id,id2:o.id})}return r}class QY{constructor(){ct(this,"t");ct(this,"a");ct(this,"b");ct(this,"sa");ct(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const t=this.sa*Math.sin(this.a*this.t),r=this.sb*Math.sin(this.b*this.t),i=.5+t,o=.5+r;return{x:i,y:o}}}function eK(n,e,t,r,i){for(let o=0;o<n.nodes.length;o++){const u=n.nodes[o],l=e[o],{x:p,y:v}=l.advance(t);u.x=p,u.y=v}n.edges=[];for(let o=0;o<n.nodes.length;o++)for(let u=o+1;u<n.nodes.length;u++){const l=n.nodes[o],p=n.nodes[u],v=CP(l,p);r<v&&v<i&&n.edges.push({id1:l.id,id2:p.id})}return n}let tK=class{constructor(e="rgba(10, 10, 10, 0.125)",t=50,r=.15,i=.18,o=1e3,u=.02){ct(this,"paths",[]);ct(this,"graph");ct(this,"svg");ct(this,"handle");this.color=e,this.N=t,this.dMin=r,this.dMax=i,this.loopTime=o,this.dt=u}setContainer(e){const t=e.getBoundingClientRect(),i=bC(e).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,t.width,t.height]);let o=JY(this.N,this.dMin,this.dMax);const u=Array.apply(null,Array(o.nodes.length)).map(()=>new QY);this.svg=i,this.graph=o,this.paths=u,this.loop()}loop(){!this.graph||!this.svg||(this.graph=eK(this.graph,this.paths,this.dt,this.dMin,this.dMax),KY(this.svg,this.graph,this.loopTime,this.color),this.handle=setTimeout(()=>this.loop(),this.loopTime))}destroy(){var e;clearTimeout(this.handle),(e=this.svg)==null||e.remove()}};function nK(n){const e=yt.useRef(null);return yt.useEffect(()=>{const t=new tK(n.color);return e.current&&t.setContainer(e.current),()=>t.destroy()},[e.current]),ge.jsx("div",{ref:e,style:{width:"100%",height:"100%"}})}class rK{constructor(e){ct(this,"svg");ct(this,"sinData");ct(this,"gradData");ct(this,"approxData");ct(this,"betterApproxData");ct(this,"xScale");ct(this,"yScale");ct(this,"focussedStep",-1);this.container=e;const t=this.container.getBoundingClientRect(),i=bC(this.container).append("svg").attr("width",t.width).attr("height",t.height).attr("viewBox",[0,0,t.width,t.height]);this.svg=i,this.sinData=[];for(let w=0;w<100;w++){const A=w/10,k=Math.sin(A);this.sinData.push({x:A,y:k})}this.gradData=[];for(let w=0;w<100;w++){const A=w/10,k=Math.sin(A),z=Math.cos(A);this.gradData.push({x:A,y:k,dydx:z})}let o=this.sinData[0].x;const u=this.sinData[this.sinData.length-1].x;let l=this.sinData[0].y;const p=10,v=(u-o)/p;this.approxData=[{x:o,y:l}];for(let w=1;w<p;w++){const A=Math.round((this.sinData.length-1)*(w-1)/p),k=this.gradData[A].dydx,z=o+v,D=l+k*v;this.approxData.push({x:z,y:D}),o=z,l=D}o=this.sinData[0].x,l=this.sinData[0].y,this.betterApproxData=[{x:o,y:l}];for(let w=1;w<p;w++){const A=Math.round((this.sinData.length-1)*(w-1)/p),k=this.gradData[A].dydx,z=Math.round((this.sinData.length-1)*w/p),D=this.gradData[z].dydx,C=o+v,U=l+(k+D)*v/2;this.betterApproxData.push({x:C,y:U}),o=C,l=U}const x=em().domain([-1,11]).range([0,parseFloat(this.svg.attr("width"))]),M=em().domain([-2,2]).range([parseFloat(this.svg.attr("height")),0]);this.xScale=x,this.yScale=M}destroy(){this.svg.remove()}stepHasFocus(e){const t=Math.round(e);t!==this.focussedStep&&(this.focussedStep=t,t<=1.5?this.plot({sinData:this.sinData,gradients:[],approxData:[]}):t<=2.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,1)}):t<=3.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,2)}):t<=4.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,2)}):t<=5.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,3)}):t<=6.1?this.plot({sinData:this.sinData,gradients:[],approxData:this.approxData}):t<=7.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:[this.approxData[0]]}):t<=8.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)]],approxData:this.approxData.slice(0,2)}):t<=9.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.betterApproxData.slice(0,2)}):t<=10.1&&this.plot({sinData:this.sinData,gradients:[],approxData:this.betterApproxData}))}plot(e){const t=Oq(p=>this.xScale(p.x),p=>this.yScale(p.y)),r=Gy("simple appear").duration(1e3),i=parseInt(this.svg.attr("width"))*3.14;this.svg.selectAll("path.rawData").data([e.sinData],p=>p.length).enter().append("path").attr("class","rawData").attr("d",t).attr("fill","none").attr("stroke","gray").attr("stroke-dasharray",i+" "+i).attr("stroke-dashoffset",i).transition(r).attr("stroke-dashoffset",0).attr("stroke-dasharray","10 10");const u=this.svg.selectAll("line.gradient").data(e.gradients,p=>p.x);u.enter().append("line").attr("class","gradient").attr("x1",p=>this.xScale(p.x-10)).attr("x2",p=>this.xScale(p.x+10)).attr("y1",p=>this.yScale(p.y-10*p.dydx)).attr("y2",p=>this.yScale(p.y+10*p.dydx)).transition(r).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5 5"),u.exit().transition(r).remove();const l=this.svg.selectAll("path.simData").data([e.approxData],p=>p.map(v=>v.y).join(" "));l.enter().append("path").attr("class","simData").attr("stroke","black").attr("fill","none").attr("stroke-width",4).attr("d",t).attr("stroke-dasharray",i+" "+i).attr("stroke-dashoffset",i).transition(r).attr("stroke-dashoffset",0),l.transition(r).attr("d",t),l.exit().transition(r).attr("stroke-dashoffset",i).remove()}approxIndexToRealIndex(e){return Math.round(this.sinData.length*e/this.approxData.length)}}class iK{constructor(){ct(this,"container");ct(this,"contents");ct(this,"slider");ct(this,"graphMgmt");ct(this,"onScroll",e=>{var p,v;if(!this.container||!this.contents||!this.slider)return;const t=window.innerHeight/2,r=this.slider.getBoundingClientRect(),i=(p=this.container)==null?void 0:p.getBoundingClientRect(),o=i.y,u=i.height,l=Math.min(Math.max(t-o,0),u-r.height);if(this.slider.style.setProperty("top",`${l}px`),this.contents){const x={};let M=0;for(const A of this.contents){const k=A.getBoundingClientRect(),z=k.height,C=k.y+z/2,U=parseInt(A.dataset.stepnr),B=Math.sqrt((C-t)*(C-t));x[U]=1/B,B>i.height/2&&(x[U]=0),B>window.innerHeight/2&&(x[U]=0),M+=x[U]}let w=0;for(const[A,k]of Object.entries(x))w+=parseInt(A)*k/M;(v=this.graphMgmt)==null||v.stepHasFocus(w)}})}setContainer(e){this.container=e,this.contents=Array.from(e.querySelectorAll(".content")),this.slider=e.querySelector(".slider"),document.addEventListener("scroll",this.onScroll),this.graphMgmt=new rK(this.slider),this.onScroll({})}destroy(){var e;document.removeEventListener("scroll",this.onScroll),(e=this.graphMgmt)==null||e.destroy()}}function Ks(n){return ge.jsx("span",{dangerouslySetInnerHTML:{__html:AP.renderToString(n.katexString)}})}function v2(n){return ge.jsx("div",{dangerouslySetInnerHTML:{__html:AP.renderToString(n.katexString)}})}function aK(){const n=yt.useRef(null);return yt.useEffect(()=>{const e=new iK;return n.current&&e.setContainer(n.current),()=>e.destroy()},[n.current]),ge.jsxs(wf,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px",background:"linear-gradient(180deg, var(--darkGray) 0%,  var(--black) 100%)"},children:ge.jsx(fv,{title:"Math animations",subtitle:"Explaining math visually",heroBackground:ge.jsx(nK,{color:"rgba(10,10,10,0.125)"})})}),children:[ge.jsxs("p",{children:["This section showcases math text-formatting and animations. As an example, we give a brief introduction into"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Euler_method",target:"_blank",children:"Euler's method"})," ","for numerically solving differential equations, and show how it can be improved upon."]}),ge.jsxs("div",{ref:n,className:"container",children:[ge.jsxs("div",{className:"leftCol",children:[ge.jsx("div",{className:"content","data-stepnr":"1",children:ge.jsxs("p",{children:["Let's assume there is some function ",ge.jsx(Ks,{katexString:"y(t)"})," that we want to approximate. We don't know the analytical form of the function, but at each point we can evaluate its gradient as ",ge.jsx(Ks,{katexString:"f(t, y)"}),"."]})}),ge.jsx("div",{className:"content","data-stepnr":"2",children:ge.jsxs("p",{children:["So we start at the first point, ",ge.jsx(Ks,{katexString:"t_0, y_0"}),", and calculate the gradient ",ge.jsx(Ks,{katexString:"f(t_0, y_0)"})," there (shown here as a blue tangent)."]})}),ge.jsxs("div",{className:"content","data-stepnr":"3",children:[ge.jsxs("p",{children:["We then simply follow along that gradient for some distance ",ge.jsx(Ks,{katexString:"h"}),":"]}),ge.jsx(v2,{katexString:"y_1 = y_0 + h f(t_0, y_0)"}),ge.jsx("p",{children:"Note that we've already made a small approximation error: we've ended up a bit higher than the true curve."})]}),ge.jsx("div",{className:"content","data-stepnr":"4",children:ge.jsxs("p",{children:["Undeterred, we soldier on: we again evaluate the gradient of the function, but now at the new position"," ",ge.jsx(Ks,{katexString:"t_1, y_1"}),"."]})}),ge.jsx("div",{className:"content","data-stepnr":"5",children:ge.jsx("p",{children:"And again we take another step along that gradient."})}),ge.jsx("div",{className:"content","data-stepnr":"6",children:ge.jsx("p",{children:"We can repeat this process as long as required. As we do so, however, we continue to make small errors, causing our approximation to diverge quite a bit from the real function."})}),ge.jsx("div",{className:"content","data-stepnr":"7",children:ge.jsxs("p",{children:["One way to reduce those errors is in realizing that the functions gradient will change between the current and the next step. We can better approximate this effect by accounting for both the gradient at"," ",ge.jsx(Ks,{katexString:"x_0, y_0"})," and at"," ",ge.jsx(Ks,{katexString:"x_1, y_1"}),". This insight is known as the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Trapezoidal_rule",target:"_blank",children:"trapezoidal rule"}),"."]})}),ge.jsxs("div",{className:"content","data-stepnr":"8",children:[ge.jsxs("p",{children:["So we switch to a two-step-process. We begin with a first estimate of the function value, starting from"," ",ge.jsx(Ks,{katexString:"x_0, y_0"}),":"," "]}),ge.jsx(v2,{katexString:"\\tilde{y}_1 = y_0 + h f(t_0, y_0)"}),ge.jsx("p",{children:"This is identical to what we've already done before."})]}),ge.jsxs("div",{className:"content","data-stepnr":"9",children:[ge.jsxs("p",{children:["In a second step, however, we refine our prediction by taking the mean of the gradient at"," ",ge.jsx(Ks,{katexString:"t_0, y_0"})," and the gradient at"," ",ge.jsx(Ks,{katexString:"t_1, y_1"})," (both shown here as blue tangents):"]}),ge.jsx(v2,{katexString:"y_1 = y_0 + \\frac{h}{2} f(t_0, y_0) + \\frac{h}{2} f(t_1, \\tilde{y}_1)"})]}),ge.jsx("div",{className:"content","data-stepnr":"10",style:{marginBottom:"15rem",marginTop:"20rem"},children:ge.jsxs("p",{children:["Using this schema, known as"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Heun%27s_method",target:"_blank",children:"Heun's method"}),", we get a much better function approximation."]})})]}),ge.jsx("div",{className:"rightCol",children:ge.jsx("div",{className:"slider"})})]}),ge.jsx("div",{children:ge.jsxs("p",{children:["This simple method is surprisingly useful for approximating the solution to differential equations. Fairly straightforward refinements are the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"general Runge-Kutta"})," ","and"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Predictor%E2%80%93corrector_method",target:"_blank",children:"predictor-corrector"})," ","methods, which we use, for example, in our ",ge.jsx(Ey,{to:"/swe",children:"shallow water simulation"}),"."]})})]})}class sK{constructor(e,t,r,i,o,u,l=[1,1,1,1]){ct(this,"differentialGraph");ct(this,"summarizeGraph");ct(this,"dataTexture1");ct(this,"dataTexture2");ct(this,"k0Texture");ct(this,"k1Texture");ct(this,"k2Texture");ct(this,"k3Texture");ct(this,"k4Texture");ct(this,"gs");ct(this,"debugGraph");ct(this,"i",0);const p=e.gl,v={};for(const be of o)v[be.name]={type:be.type,value:be.value};const x={};for(const be of u)x[be.name]=be.value;const M=mv(0,0,2,2),w=new Po(p,{data:new Float32Array(M.flat()),changesOften:!1}),A=new W5(p,{data:r,t:"float4",edges:"clamp",interpolate:"none"}),k=new W5(p,{data:r,t:"float4",edges:"clamp",interpolate:"none"}),z=A.width,D=A.height,C=new Eo(p,{width:z,height:D,type:"float4",edges:"clamp",interpolate:"none"}),U=new Eo(p,{width:z,height:D,type:"float4",edges:"clamp",interpolate:"none"}),B=new Eo(p,{width:z,height:D,type:"float4",edges:"clamp",interpolate:"none"}),K=new Eo(p,{width:z,height:D,type:"float4",edges:"clamp",interpolate:"none"}),ue=new Eo(p,{width:z,height:D,type:"float4",edges:"clamp",interpolate:"none"}),Z=new Ua(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          uniform vec2 textureSize;
          uniform sampler2D dataTexture;
          uniform sampler2D kTexture;
          uniform float kFactor;
          uniform float dt;
          ${o.map(be=>`uniform ${be.type} ${be.name}; 
`)}
          ${u.map(be=>`uniform sampler2D ${be.name}; 
`)}
          in vec2 uv;
          out vec4 fragColor;
  
          void main() {
  
              vec2 deltaX = vec2(1.0 / textureSize.x, 0.0);
              vec2 deltaY = vec2(0.0, 1.0 / textureSize.y);
              vec4 data    = texture(dataTexture, uv          ) + dt * kFactor * texture(kTexture, uv          );
              vec4 data_px = texture(dataTexture, uv + deltaX ) + dt * kFactor * texture(kTexture, uv + deltaX );
              vec4 data_mx = texture(dataTexture, uv - deltaX ) + dt * kFactor * texture(kTexture, uv - deltaX );
              vec4 data_py = texture(dataTexture, uv + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaY );
              vec4 data_my = texture(dataTexture, uv - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaY );
  
              //-----------------------------------------------------------
              // Insert here shader code that takes "data", "data_px", ...
              // and fills "fragColor" with df/dt
              ${t}
              //-----------------------------------------------------------
  
          }`},inputs:{attributes:{pos:{buffer:w,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{...x,dataTexture:A,kTexture:C},uniforms:{...v,textureSize:{type:"vec2",value:[z,D]},kFactor:{type:"float",value:[0]},dt:{type:"float",value:[i]}}},outputs:{frameBuffer:{textures:[U]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,z,D]}}),ee=new Ua(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          in vec2 uv;
          uniform sampler2D dataTexture;
          uniform sampler2D k1Texture;
          uniform sampler2D k2Texture;
          uniform sampler2D k3Texture;
          uniform sampler2D k4Texture;
          uniform float dt;
          uniform vec4 dampingFactor;
          out vec4 fragColor;
  
          void main() {
              vec4 data = texture(dataTexture, uv);
              vec4 k1   = texture(k1Texture,   uv);
              vec4 k2   = texture(k2Texture,   uv);
              vec4 k3   = texture(k3Texture,   uv);
              vec4 k4   = texture(k4Texture,   uv);
  
              vec4 weightedAverage = data + dt * (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0;
              weightedAverage *= dampingFactor;
  
              fragColor = weightedAverage;
          }`},inputs:{attributes:{pos:{buffer:w,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{dt:{type:"float",value:[i]},dampingFactor:{type:"vec4",value:l}},textures:{dataTexture:A,k1Texture:U,k2Texture:B,k3Texture:K,k4Texture:ue}},outputs:{frameBuffer:{textures:[k]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,z,D]}});this.debugGraph=new Ua(e,{program:{vertexSource:`#version 300 es
              in vec2 pos;
              out vec2 uv;
              void main() {
                  gl_Position = vec4(pos.xy, 0, 1);
                  uv = (pos + 1.0) / 2.0;
              }`,fragmentSource:`#version 300 es
              precision highp float;
              in vec2 uv;
              uniform sampler2D drawTexture;
              out vec4 fragColor;
              void main() {
                  vec4 tex = texture(drawTexture, uv);
                  float h = (tex.x - 0.5) * 2.0;
                  fragColor = vec4(tex.x, tex.x, tex.x, 1.0);
              }`},inputs:{attributes:{pos:{buffer:w,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{drawTexture:k}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,z,D]}}),this.gs=e,this.differentialGraph=Z,this.summarizeGraph=ee,this.dataTexture1=A,this.dataTexture2=k,this.k0Texture=C,this.k1Texture=U,this.k2Texture=B,this.k3Texture=K,this.k4Texture=ue}loop(e){const t=this.differentialGraph,r=this.summarizeGraph;let i=this.dataTexture1,o=this.dataTexture2;if(this.i%2!==0&&(i=this.dataTexture2,o=this.dataTexture1),e)for(const u of e)t.updateUniform(u.name,u.value);return t.updateUniform("kFactor",[0]),t.updateTexture("dataTexture",i),t.updateTexture("kTexture",this.k0Texture),t.updateFramebuffer({textures:[this.k1Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k1Texture),t.updateFramebuffer({textures:[this.k2Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k2Texture),t.updateFramebuffer({textures:[this.k3Texture]}),t.draw(),t.updateUniform("kFactor",[1]),t.updateTexture("kTexture",this.k3Texture),t.updateFramebuffer({textures:[this.k4Texture]}),t.draw(),r.updateTexture("dataTexture",i),r.updateFramebuffer({textures:[o]}),r.draw(),this.i+=1,o}destroy(e=!1){this.debugGraph.destroy(e),this.summarizeGraph.destroy(e),this.differentialGraph.destroy(e)}}let oK=class{constructor(e,t){ct(this,"rk");ct(this,"displayGraph");const r=e.getContext("webgl2"),i=5e-4,o=500,u=500;e.width=e.clientWidth,e.height=e.clientHeight;const l=kL(()=>[0,0,0,1],o,u),p=mv(0,0,2,2),v=new Po(r,{data:new Float32Array(p.flat()),changesOften:!1}),x=new zi(r,{image:t.bgImg}),M=new zi(r,{image:t.hImg}),w=new pv(r,{}),A=`

      // assuming a 6 x 6 m^2 field
      float dx = deltaX.x * 6.0;
      float dy = deltaY.y * 6.0;

      float h = data.x;
      float u = data.y;
      float v = data.z;
      float hPX = data_px.x;
      float uPX = data_px.y;
      float vPX = data_px.z;
      float hMX = data_mx.x;
      float uMX = data_mx.y;
      float vMX = data_mx.z;
      float hPY = data_py.x;
      float uPY = data_py.y;
      float vPY = data_py.z;
      float hMY = data_my.x;
      float uMY = data_my.y;
      float vMY = data_my.z;

      // finite differences
      vec2 uvTex = vec2(uv.x, 1.0 - uv.y);
      float H = texture(hTex, uvTex).x * 5.0; // 10.0;
      float f = 0.001;   // coriolis coefficient
      float b = 0.003;   // viscous drag
      float g = 9.831;   // fall acceleration

      float dudx = (uPX - uMX) / (2.0 * dx);
      float dvdy = (vPY - vMY) / (2.0 * dy);
      float dhdx = (hPX - hMX) / (2.0 * dx);
      float dhdy = (hPY - hMY) / (2.0 * dy);

      // user-interaction
      if (mousePos.w > 0.5) {
        float d = distance(mousePos.xy, uv);
        if (d < 0.01) {
          dhdx += mousePos.z;
          dhdy += mousePos.z;
        }
      }

      // edge conditions
      float x = gl_FragCoord.x;
      if (x < 2.0 || x > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dudx = 0.0;
        dhdx = 0.0; 
      }
      float y = gl_FragCoord.y;
      if (y < 2.0 || y > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dvdy = 0.0;
        dhdy = 0.0;
      }

      float dhdt =      - H * ( dudx + dvdy );
      float dudt = ( + f*v - b*u - g * dhdx );
      float dvdt = ( - f*u - b*v - g * dhdy );

      if (H < 0.1) {
        dhdt = 0.0;
        dudt = 0.0;
        dvdt = 0.0;
      }

      // detect and eliminate checkerboard pattern
      vec4 data_px_py = texture(dataTexture, uv + deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX + deltaY);
      vec4 data_px_my = texture(dataTexture, uv + deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX - deltaY);
      vec4 data_mx_py = texture(dataTexture, uv - deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX + deltaY);
      vec4 data_mx_my = texture(dataTexture, uv - deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX - deltaY);
      float neighborhoodSize = sqrt(
          data_mx_py.x * data_mx_py.x +  data_py.x * data_py.x + data_px_py.x * data_px_py.x
        + data_mx.x * data_mx.x       +  data.x * data.x       + data_px.x * data_px.x
        + data_mx_my.x * data_mx_my.x +  data_my.x * data_my.x + data_px_my.x * data_px_my.x
      );
      float h_norm       = data.x / neighborhoodSize;
      float h_mx_norm    = data_mx.x / neighborhoodSize;
      float h_px_norm    = data_px.x / neighborhoodSize;
      float h_my_norm    = data_my.x / neighborhoodSize;
      float h_py_norm    = data_py.x / neighborhoodSize;
      float h_mx_py_norm = data_mx_py.x / neighborhoodSize;
      float h_mx_my_norm = data_mx_my.x / neighborhoodSize;
      float h_px_py_norm = data_px_py.x / neighborhoodSize;
      float h_px_my_norm = data_px_my.x / neighborhoodSize;
      float signedSimilarity = (0.333 * h_mx_py_norm - 0.333 * h_py_norm  + 0.333 * h_px_py_norm  
                              - 0.333 * h_mx_norm    + 0.333 * h_norm     - 0.333 * h_px_norm  
                              + 0.333 * h_mx_my_norm - 0.333 * h_my_norm  + 0.333 * h_px_my_norm ) / 9.0;
      float similarityThreshold = 0.75;
      float nudgeStrength = 0.2;
      if (abs(signedSimilarity) > similarityThreshold) {
        float meanH = ( data_mx_py.x + data_py.x + data_px_py.x
                      + data_mx.x    + data.x    + data_px.x
                      + data_mx_my.x + data_my.x + data_px_my.x) / 9.0;
        float deltaHTarget = (meanH - data.x);
        float deltaHTrue = dhdt;
        float delta = deltaHTarget - deltaHTrue;
        dhdt += delta * nudgeStrength; 
      }

      fragColor = vec4(dhdt, dudt, dvdt, 1.0);
  `,k=new sK(w,A,l,i,[{name:"mousePos",type:"vec4",value:[0,0,0,0]}],[{name:"hTex",value:M}],[.995,.995,.995,1]),z=k.loop(),D=new Ua(w,{program:{vertexSource:`#version 300 es
        in vec2 pos;
        out vec2 uv;
        void main() {
            gl_Position = vec4(pos.xy, 0, 1);
            uv = (pos + 1.0) / 2.0;
        }`,fragmentSource:`#version 300 es
        precision highp float;
        in vec2 uv;
        uniform vec2 textureSize;
        uniform sampler2D tex;
        uniform sampler2D bgTex;
        out vec4 fragColor;

        float antiRound(float x) {
          float f = fract(x);
          if (f > 0.5) return floor(x);
          return ceil(x);
        }

        float prox(vec2 a, vec2 b) {
          float dx = a.x - b.x;
          float dy = a.y - b.y;
          float dist = sqrt(dx*dx + dy*dy);
          return 1. - dist;
        }

        // our data-texture allows no interpolation.
        // if we chose a low resolution R,C < 200, then the user can see individual pixels.
        // so we do interpolated sampling in software here.
        vec4 textureInterpolated(sampler2D tex, vec2 uv, vec2 textureSize) {
          vec2 rc = uv * textureSize;
          
          vec2 rcPicked = round(rc);
          float wPicked = prox(rc, rcPicked);

          vec2 rcAntiRow = vec2(antiRound(rc.x), rcPicked.y);
          float wAntiRow = prox(rc, rcAntiRow);

          vec2 rcAntiCol = vec2(rcPicked.x, antiRound(rc.y));
          float wAntiCol = prox(rc, rcAntiCol);

          float wTot = wPicked + wAntiRow + wAntiCol;
          wPicked    = wPicked  / wTot;
          wAntiRow   = wAntiRow / wTot;
          wAntiCol   = wAntiCol / wTot;

          vec4 valPicked  = texture(tex, rcPicked  / textureSize);
          vec4 valAntiRow = texture(tex, rcAntiRow / textureSize);
          vec4 valAntiCol = texture(tex, rcAntiCol / textureSize);

          vec4 valInterpol = valPicked * wPicked + valAntiRow * wAntiRow + valAntiCol * wAntiCol;
          return valInterpol;
        }

        void main() {
            // vec4 tex = texture(tex, uv);
            vec4 tex = textureInterpolated(tex, uv, textureSize);
            vec2 uvBg = vec2(uv.x, 1.0 - uv.y);
            uvBg += vec2(tex.x, tex.x) * 0.02;
            vec4 bg = texture(bgTex, uvBg);
            fragColor = bg;
        }`},inputs:{attributes:{pos:{buffer:v,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{textureSize:{type:"vec2",value:[u,o]}},textures:{tex:z,bgTex:x}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:p.length,viewport:[0,0,e.width,e.height]}});this.rk=k,this.displayGraph=D}step(e){const{userX:t,userY:r,userStrength:i,userMoving:o}=e,u=this.rk.loop([{name:"mousePos",type:"vec4",value:[t,r,i,o]}]);this.displayGraph.updateTexture("tex",u),this.displayGraph.draw()}destroy(e){this.rk.destroy(e),this.displayGraph.destroy(e)}};function PP(n){return ge.jsx(wf,{hero:ge.jsx(d7,{backgroundImage:n.bgImg,title:n.title,subtitle:n.subTitle}),logo:n.logo,footerContent:ge.jsx(A8,{}),children:n.children})}class lK{constructor(){ct(this,"looper");ct(this,"swe");ct(this,"canvas");ct(this,"mouseListener",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.userX=(e.clientX-t.left)/this.canvas.clientWidth,this.userY=1-(e.clientY-t.top)/this.canvas.clientHeight,this.userMoving=1});ct(this,"userX",0);ct(this,"userY",0);ct(this,"userMoving",0);ct(this,"destroyed",!1)}async init(e){this.canvas=e,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight;const t=await zi.loadImage("/swe_bg.jpg"),r=await zi.loadImage("/swe_h2.jpg");this.destroyed||(this.swe=new oK(e,{bgImg:t,hImg:r}),this.looper=new hm(10,()=>{var i;(i=this.swe)==null||i.step({userX:this.userX,userY:this.userY,userMoving:this.userMoving,userStrength:1e3}),this.userMoving=0}),this.canvas.addEventListener("mousemove",this.mouseListener),this.startLoop())}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){var e,t;this.stopLoop(),this.mouseListener&&((e=this.canvas)==null||e.removeEventListener("mousemove",this.mouseListener)),(t=this.swe)==null||t.destroy(!0),this.swe=void 0,this.canvas=void 0,this.destroyed=!0}}function cK(){const n=yt.useRef(null);return yt.useEffect(()=>{const e=new lK;return n.current&&e.init(n.current),()=>e.destroy()},[n.current]),ge.jsxs(PP,{bgImg:"/swe_bg.jpg",title:"Wave simulations",subTitle:"using the shallow water equations",logo:ge.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 5 4",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"squiggle",d:`M 0 0 
              C 0.5 0 0.5 0.5 1.0 0.5 
              S       1.5 0.0 2.0 0.0
              S       2.5 0.5 3.0 0.5
              S       3.5 0.0 4.0 0.0`,stroke:"black",strokeWidth:"0.2",strokeLinejoin:"round",fill:"none"})}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"1.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"2.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"3.0"})]}),children:[ge.jsxs("p",{style:{margin:"2rem"},children:["Water-surface-movement can be simulated accurately with the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Shallow_water_equations",target:"_blank",children:"shallow water equations"}),". To augment the numerical stability of that simulation, approximation methods like"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"Runge-Kutta"})," ","can be used."]}),ge.jsxs("p",{style:{margin:"2rem"},children:["The image below contains an implementation of this method. ",ge.jsx("b",{children:"Move your mouse over the water"})," to make waves!"]}),ge.jsx("canvas",{ref:n,style:{width:"100%",aspectRatio:"3/2"}}),ge.jsx("p",{style:{margin:"2rem"},children:"This method can be adjusted to be included in maps, 3d-scenes etc."})]})}var W6=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function uK(){var n=new W6(16);return W6!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function hK(n,e){var t=e[0],r=e[1],i=e[2],o=e[3],u=e[4],l=e[5],p=e[6],v=e[7],x=e[8],M=e[9],w=e[10],A=e[11],k=e[12],z=e[13],D=e[14],C=e[15],U=t*l-r*u,B=t*p-i*u,K=t*v-o*u,ue=r*p-i*l,Z=r*v-o*l,ee=i*v-o*p,be=x*z-M*k,ie=x*D-w*k,Q=x*C-A*k,Ee=M*D-w*z,Fe=M*C-A*z,Ae=w*C-A*D,Ve=U*Ae-B*Fe+K*Ee+ue*Q-Z*ie+ee*be;return Ve?(Ve=1/Ve,n[0]=(l*Ae-p*Fe+v*Ee)*Ve,n[1]=(i*Fe-r*Ae-o*Ee)*Ve,n[2]=(z*ee-D*Z+C*ue)*Ve,n[3]=(w*Z-M*ee-A*ue)*Ve,n[4]=(p*Q-u*Ae-v*ie)*Ve,n[5]=(t*Ae-i*Q+o*ie)*Ve,n[6]=(D*K-k*ee-C*B)*Ve,n[7]=(x*ee-w*K+A*B)*Ve,n[8]=(u*Fe-l*Q+v*be)*Ve,n[9]=(r*Q-t*Fe-o*be)*Ve,n[10]=(k*Z-z*K+C*U)*Ve,n[11]=(M*K-x*Z-A*U)*Ve,n[12]=(l*ie-u*Ee-p*be)*Ve,n[13]=(t*Ee-r*ie+i*be)*Ve,n[14]=(z*B-k*ue-D*U)*Ve,n[15]=(x*ue-M*B+w*U)*Ve,n):null}var RP={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(n,e){(function(t,r){n.exports=r()})(D1,function(){var t={},r={};function i(u,l,p){if(r[u]=p,u==="index"){var v="var sharedModule = {}; ("+r.shared+")(sharedModule); ("+r.worker+")(sharedModule);",x={};return r.shared(x),r.index(t,x),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}i("shared",["exports"],function(u){function l(c,a,h,f){return new(h||(h=Promise))(function(y,S){function T(F){try{I(f.next(F))}catch(j){S(j)}}function E(F){try{I(f.throw(F))}catch(j){S(j)}}function I(F){var j;F.done?y(F.value):(j=F.value,j instanceof h?j:new h(function(W){W(j)})).then(T,E)}I((f=f.apply(c,a||[])).next())})}function p(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var v=x;function x(c,a){this.x=c,this.y=a}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,h=c.y-this.y;return a*a+h*h},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),h=Math.sin(c),f=h*this.x+a*this.y;return this.x=a*this.x-h*this.y,this.y=f,this},_rotateAround:function(c,a){var h=Math.cos(c),f=Math.sin(c),y=a.y+f*(this.x-a.x)+h*(this.y-a.y);return this.x=a.x+h*(this.x-a.x)-f*(this.y-a.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(c){return c instanceof x?c:Array.isArray(c)?new x(c[0],c[1]):c};var M=p(v),w=A;function A(c,a,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=h,this.p2y=f}A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var y=this.sampleCurveX(h)-c;if(Math.abs(y)<a)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=y/S}var T=0,E=1;for(h=c,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-c)<a));f++)c>y?T=h:E=h,h=.5*(E-T)+T;return h},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var k=p(w);let z,D;function C(){return z==null&&(z=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),z}function U(){if(D==null&&(D=!1,C())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let f=0;f<5*5;f++){const y=4*f;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(f%5,Math.floor(f/5),1,1)}const h=a.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&h[f]!==f){D=!0;break}}}return D||!1}function B(c,a,h,f){const y=new k(c,a,h,f);return function(S){return y.solve(S)}}const K=B(.25,.1,.25,1);function ue(c,a,h){return Math.min(h,Math.max(a,c))}function Z(c,a,h){const f=h-a,y=((c-a)%f+f)%f+a;return y===a?h:y}function ee(c,...a){for(const h of a)for(const f in h)c[f]=h[f];return c}let be=1;function ie(c,a,h){const f={};for(const y in c)f[y]=a.call(h||this,c[y],y,c);return f}function Q(c,a,h){const f={};for(const y in c)a.call(h||this,c[y],y,c)&&(f[y]=c[y]);return f}function Ee(c){return Array.isArray(c)?c.map(Ee):typeof c=="object"&&c?ie(c,Ee):c}const Fe={};function Ae(c){Fe[c]||(typeof console<"u"&&console.warn(c),Fe[c]=!0)}function Ve(c,a,h){return(h.y-c.y)*(a.x-c.x)>(a.y-c.y)*(h.x-c.x)}function lt(c){let a=0;for(let h,f,y=0,S=c.length,T=S-1;y<S;T=y++)h=c[y],f=c[T],a+=(f.x-h.x)*(h.y+f.y);return a}function ut(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let pt=null;function ke(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function tt(c,a,h,f,y){return l(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const S=new VideoFrame(c,{timestamp:0});try{const T=S==null?void 0:S.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const E=T.startsWith("BGR"),I=new Uint8ClampedArray(f*y*4);if(yield S.copyTo(I,function(F,j,W,J,ae){const oe=4*Math.max(-j,0),pe=(Math.max(0,W)-W)*J*4+oe,xe=4*J,Pe=Math.max(0,j),He=Math.max(0,W);return{rect:{x:Pe,y:He,width:Math.min(F.width,j+J)-Pe,height:Math.min(F.height,W+ae)-He},layout:[{offset:pe,stride:xe}]}}(c,a,h,f,y)),E)for(let F=0;F<I.length;F+=4){const j=I[F];I[F]=I[F+2],I[F+2]=j}return I}finally{S.close()}})}let _t,Lt;const Cn="AbortError";function nt(){return new Error(Cn)}const wt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ft(c){return wt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const At="global-dispatcher";class gn extends Error{constructor(a,h,f,y){super(`AJAXError: ${h} (${a}): ${f}`),this.status=a,this.statusText=h,this.url=f,this.body=y}}const En=()=>ut(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,In=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=Ft(c.url);if(f)return f(c,a);if(ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,targetMapId:At},a)}if(!(/^file:/.test(h=c.url)||/^file:/.test(En())&&!/^\w+:/.test(h))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,y){return l(this,void 0,void 0,function*(){const S=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:En(),signal:y.signal});f.type==="json"&&S.headers.set("Accept","application/json");const T=yield fetch(S);if(!T.ok){const F=yield T.blob();throw new gn(T.status,T.statusText,f.url,F)}let E;E=f.type==="arrayBuffer"||f.type==="image"?T.arrayBuffer():f.type==="json"?T.json():T.text();const I=yield E;if(y.signal.aborted)throw nt();return{data:I,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,a);if(ut(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,mustQueue:!0,targetMapId:At},a)}var h;return function(f,y){return new Promise((S,T)=>{const E=new XMLHttpRequest;E.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(E.responseType="arraybuffer");for(const I in f.headers)E.setRequestHeader(I,f.headers[I]);f.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=f.credentials==="include",E.onerror=()=>{T(new Error(E.statusText))},E.onload=()=>{if(!y.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(f.type==="json")try{I=JSON.parse(E.response)}catch(F){return void T(F)}S({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});T(new gn(E.status,E.statusText,f.url,I))}},y.signal.addEventListener("abort",()=>{E.abort(),T(nt())}),E.send(f.body)})}(c,a)};function je(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),h=window.location;return a.protocol===h.protocol&&a.host===h.host}function An(c,a,h){h[c]&&h[c].indexOf(a)!==-1||(h[c]=h[c]||[],h[c].push(a))}function yn(c,a,h){if(h&&h[c]){const f=h[c].indexOf(a);f!==-1&&h[c].splice(f,1)}}class Qn{constructor(a,h={}){ee(this,h),this.type=a}}class Yt extends Qn{constructor(a,h={}){super("error",ee({error:a},h))}}class Gn{on(a,h){return this._listeners=this._listeners||{},An(a,h,this._listeners),this}off(a,h){return yn(a,h,this._listeners),yn(a,h,this._oneTimeListeners),this}once(a,h){return h?(this._oneTimeListeners=this._oneTimeListeners||{},An(a,h,this._oneTimeListeners),this):new Promise(f=>this.once(a,f))}fire(a,h){typeof a=="string"&&(a=new Qn(a,h||{}));const f=a.type;if(this.listens(f)){a.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of y)E.call(this,a);const S=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of S)yn(f,E,this._oneTimeListeners),E.call(this,a);const T=this._eventedParent;T&&(ee(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof Yt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,h){return this._eventedParent=a,this._eventedParentData=h,this}}var re={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const le=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function st(c,a){const h={};for(const f in c)f!=="ref"&&(h[f]=c[f]);return le.forEach(f=>{f in a&&(h[f]=a[f])}),h}function it(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let h=0;h<c.length;h++)if(!it(c[h],a[h]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const h in c)if(!it(c[h],a[h]))return!1;return!0}return c===a}function mt(c,a){c.push(a)}function St(c,a,h){mt(h,{command:"addSource",args:[c,a[c]]})}function _n(c,a,h){mt(a,{command:"removeSource",args:[c]}),h[c]=!0}function Mt(c,a,h,f){_n(c,h,f),St(c,a,h)}function hn(c,a,h){let f;for(f in c[h])if(Object.prototype.hasOwnProperty.call(c[h],f)&&f!=="data"&&!it(c[h][f],a[h][f]))return!1;for(f in a[h])if(Object.prototype.hasOwnProperty.call(a[h],f)&&f!=="data"&&!it(c[h][f],a[h][f]))return!1;return!0}function xn(c,a,h,f,y,S){c=c||{},a=a||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(it(c[T],a[T])||h.push({command:S,args:[f,T,a[T],y]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(it(c[T],a[T])||h.push({command:S,args:[f,T,a[T],y]}))}function Nt(c){return c.id}function an(c,a){return c[a.id]=a,c}class at{constructor(a,h,f,y){this.message=(a?`${a}: `:"")+f,y&&(this.identifier=y),h!=null&&h.__line__&&(this.line=h.__line__)}}function tn(c,...a){for(const h of a)for(const f in h)c[f]=h[f];return c}class Kt extends Error{constructor(a,h){super(h),this.message=h,this.key=a}}class Bn{constructor(a,h=[]){this.parent=a,this.bindings={};for(const[f,y]of h)this.bindings[f]=y}concat(a){return new Bn(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Un={kind:"null"},dt={kind:"number"},Ht={kind:"string"},jt={kind:"boolean"},Jt={kind:"color"},X={kind:"object"},Be={kind:"value"},ft={kind:"collator"},kt={kind:"formatted"},ce={kind:"padding"},O={kind:"resolvedImage"},V={kind:"variableAnchorOffsetCollection"};function $(c,a){return{kind:"array",itemType:c,N:a}}function ne(c){if(c.kind==="array"){const a=ne(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const me=[Un,dt,Ht,jt,Jt,kt,X,$(Be),ce,O,V];function Se(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Se(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const h of me)if(!Se(h,a))return null}}return`Expected ${ne(c)} but found ${ne(a)} instead.`}function Te(c,a){return a.some(h=>h.kind===c.kind)}function ye(c,a){return a.some(h=>h==="null"?c===null:h==="array"?Array.isArray(c):h==="object"?c&&!Array.isArray(c)&&typeof c=="object":h===typeof c)}function Re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const $e=.96422,Ye=.82521,Ge=4/29,Ct=6/29,nn=3*Ct*Ct,on=Ct*Ct*Ct,bn=Math.PI/180,wn=180/Math.PI;function lr(c){return(c%=360)<0&&(c+=360),c}function er([c,a,h,f]){let y,S;const T=Le((.2225045*(c=de(c))+.7168786*(a=de(a))+.0606169*(h=de(h)))/1);c===a&&a===h?y=S=T:(y=Le((.4360747*c+.3850649*a+.1430804*h)/$e),S=Le((.0139322*c+.0971045*a+.7141733*h)/Ye));const E=116*T-16;return[E<0?0:E,500*(y-T),200*(T-S),f]}function de(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Le(c){return c>on?Math.pow(c,1/3):c/nn+Ge}function We([c,a,h,f]){let y=(c+16)/116,S=isNaN(a)?y:y+a/500,T=isNaN(h)?y:y-h/200;return y=1*Ze(y),S=$e*Ze(S),T=Ye*Ze(T),[Xe(3.1338561*S-1.6168667*y-.4906146*T),Xe(-.9787684*S+1.9161415*y+.033454*T),Xe(.0719453*S-.2289914*y+1.4052427*T),f]}function Xe(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ze(c){return c>Ct?c*c*c:nn*(c-Ge)}function Pt(c){return parseInt(c.padEnd(2,c),16)/255}function rn(c,a){return It(a?c/100:c,0,1)}function It(c,a,h){return Math.min(Math.max(a,c),h)}function Qt(c){return!c.some(Number.isNaN)}const Sn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Xt{constructor(a,h,f,y=1,S=!0){this.r=a,this.g=h,this.b=f,this.a=y,S||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,h,f,y]))}static parse(a){if(a instanceof Xt)return a;if(typeof a!="string")return;const h=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Sn[f];if(y){const[T,E,I]=y;return[T/255,E/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const T=f.length<6?1:2;let E=1;return[Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+T)||"ff")]}if(f.startsWith("rgb")){const T=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,I,F,j,W,J,ae,oe,pe,xe,Pe,He]=T,De=[j||" ",ae||" ",xe].join("");if(De==="  "||De==="  /"||De===",,"||De===",,,"){const Ne=[F,J,pe].join(""),ht=Ne==="%%%"?100:Ne===""?255:0;if(ht){const gt=[It(+I/ht,0,1),It(+W/ht,0,1),It(+oe/ht,0,1),Pe?rn(+Pe,He):1];if(Qt(gt))return gt}}return}}const S=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(S){const[T,E,I,F,j,W,J,ae,oe]=S,pe=[I||" ",j||" ",J].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const xe=[+E,It(+F,0,100),It(+W,0,100),ae?rn(+ae,oe):1];if(Qt(xe))return function([Pe,He,De,Ne]){function ht(gt){const Wt=(gt+Pe/30)%12,un=He*Math.min(De,1-De);return De-un*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return Pe=lr(Pe),He/=100,De/=100,[ht(0),ht(8),ht(4),Ne]}(xe)}}}(a);return h?new Xt(...h,!1):void 0}get rgb(){const{r:a,g:h,b:f,a:y}=this,S=y||1/0;return this.overwriteGetter("rgb",[a/S,h/S,f/S,y])}get hcl(){return this.overwriteGetter("hcl",function(a){const[h,f,y,S]=er(a),T=Math.sqrt(f*f+y*y);return[Math.round(1e4*T)?lr(Math.atan2(y,f)*wn):NaN,T,h,S]}(this.rgb))}get lab(){return this.overwriteGetter("lab",er(this.rgb))}overwriteGetter(a,h){return Object.defineProperty(this,a,{value:h}),h}toString(){const[a,h,f,y]=this.rgb;return`rgba(${[a,h,f].map(S=>Math.round(255*S)).join(",")},${y})`}}Xt.black=new Xt(0,0,0,1),Xt.white=new Xt(1,1,1,1),Xt.transparent=new Xt(0,0,0,0),Xt.red=new Xt(1,0,0,1);class Fn{constructor(a,h,f){this.sensitivity=a?h?"variant":"case":h?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,h){return this.collator.compare(a,h)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Er{constructor(a,h,f,y,S){this.text=a,this.image=h,this.scale=f,this.fontStack=y,this.textColor=S}}class gr{constructor(a){this.sections=a}static fromString(a){return new gr([new Er(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof gr?a:gr.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class cr{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof cr)return a;if(typeof a=="number")return new cr([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const h of a)if(typeof h!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new cr(a)}}toString(){return JSON.stringify(this.values)}}const Da=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Wn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Wn)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let h=0;h<a.length;h+=2){const f=a[h],y=a[h+1];if(typeof f!="string"||!Da.has(f)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Wn(a)}}toString(){return JSON.stringify(this.values)}}class Pn{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Pn({name:a,available:!1}):null}}function Ol(c,a,h,f){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof h=="number"&&h>=0&&h<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,a,h,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,a,h,f]:[c,a,h]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function or(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Xt||c instanceof Fn||c instanceof gr||c instanceof cr||c instanceof Wn||c instanceof Pn)return!0;if(Array.isArray(c)){for(const a of c)if(!or(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!or(c[a]))return!1;return!0}return!1}function fr(c){if(c===null)return Un;if(typeof c=="string")return Ht;if(typeof c=="boolean")return jt;if(typeof c=="number")return dt;if(c instanceof Xt)return Jt;if(c instanceof Fn)return ft;if(c instanceof gr)return kt;if(c instanceof cr)return ce;if(c instanceof Wn)return V;if(c instanceof Pn)return O;if(Array.isArray(c)){const a=c.length;let h;for(const f of c){const y=fr(f);if(h){if(h===y)continue;h=Be;break}h=y}return $(h||Be,a)}return X}function uo(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof Xt||c instanceof gr||c instanceof cr||c instanceof Wn||c instanceof Pn?c.toString():JSON.stringify(c)}class da{constructor(a,h){this.type=a,this.value=h}static parse(a,h){if(a.length!==2)return h.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!or(a[1]))return h.error("invalid value");const f=a[1];let y=fr(f);const S=h.expectedType;return y.kind!=="array"||y.N!==0||!S||S.kind!=="array"||typeof S.N=="number"&&S.N!==0||(y=S),new da(y,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xr{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Rr={string:Ht,number:dt,boolean:jt,object:X};class Jr{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");let f,y=1;const S=a[0];if(S==="array"){let E,I;if(a.length>2){const F=a[1];if(typeof F!="string"||!(F in Rr)||F==="object")return h.error('The item type argument of "array" must be one of string, number, boolean',1);E=Rr[F],y++}else E=Be;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return h.error('The length argument to "array" must be a positive integer literal',2);I=a[2],y++}f=$(E,I)}else{if(!Rr[S])throw new Error(`Types doesn't contain name = ${S}`);f=Rr[S]}const T=[];for(;y<a.length;y++){const E=h.parse(a[y],y,Be);if(!E)return null;T.push(E)}return new Jr(f,T)}evaluate(a){for(let h=0;h<this.args.length;h++){const f=this.args[h].evaluate(a);if(!Se(this.type,fr(f)))return f;if(h===this.args.length-1)throw new xr(`Expected value to be of type ${ne(this.type)}, but found ${ne(fr(f))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const ho={"to-boolean":jt,"to-color":Jt,"to-number":dt,"to-string":Ht};class Lr{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const f=a[0];if(!ho[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&a.length!==2)return h.error("Expected one argument.");const y=ho[f],S=[];for(let T=1;T<a.length;T++){const E=h.parse(a[T],T,Be);if(!E)return null;S.push(E)}return new Lr(y,S)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let h,f;for(const y of this.args){if(h=y.evaluate(a),f=null,h instanceof Xt)return h;if(typeof h=="string"){const S=a.parseColor(h);if(S)return S}else if(Array.isArray(h)&&(f=h.length<3||h.length>4?`Invalid rbga value ${JSON.stringify(h)}: expected an array containing either three or four numeric values.`:Ol(h[0],h[1],h[2],h[3]),!f))return new Xt(h[0]/255,h[1]/255,h[2]/255,h[3])}throw new xr(f||`Could not parse color from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"padding":{let h;for(const f of this.args){h=f.evaluate(a);const y=cr.parse(h);if(y)return y}throw new xr(`Could not parse padding from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"variableAnchorOffsetCollection":{let h;for(const f of this.args){h=f.evaluate(a);const y=Wn.parse(h);if(y)return y}throw new xr(`Could not parse variableAnchorOffsetCollection from value '${typeof h=="string"?h:JSON.stringify(h)}'`)}case"number":{let h=null;for(const f of this.args){if(h=f.evaluate(a),h===null)return 0;const y=Number(h);if(!isNaN(y))return y}throw new xr(`Could not convert ${JSON.stringify(h)} to number.`)}case"formatted":return gr.fromString(uo(this.args[0].evaluate(a)));case"resolvedImage":return Pn.fromString(uo(this.args[0].evaluate(a)));default:return uo(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Ho=["Unknown","Point","LineString","Polygon"];class fo{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ho[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let h=this._parseColorCache[a];return h||(h=this._parseColorCache[a]=Xt.parse(a)),h}}class rr{constructor(a,h,f=[],y,S=new Bn,T=[]){this.registry=a,this.path=f,this.key=f.map(E=>`[${E}]`).join(""),this.scope=S,this.errors=T,this.expectedType=y,this._isConstant=h}parse(a,h,f,y,S={}){return h?this.concat(h,f,y)._parse(a,S):this._parse(a,S)}_parse(a,h){function f(y,S,T){return T==="assert"?new Jr(S,[y]):T==="coerce"?new Lr(S,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const S=this.registry[y];if(S){let T=S.parse(a,this);if(!T)return null;if(this.expectedType){const E=this.expectedType,I=T.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||I.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(E.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(E,I))return null}else T=f(T,E,h.typeAnnotation||"coerce");else T=f(T,E,h.typeAnnotation||"coerce");else T=f(T,E,h.typeAnnotation||"coerce");else T=f(T,E,h.typeAnnotation||"assert")}if(!(T instanceof da)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const E=new fo;try{T=new da(T.type,T.evaluate(E))}catch(I){return this.error(I.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,h,f){const y=typeof a=="number"?this.path.concat(a):this.path,S=f?this.scope.concat(f):this.scope;return new rr(this.registry,this._isConstant,y,h||null,S,this.errors)}error(a,...h){const f=`${this.key}${h.map(y=>`[${y}]`).join("")}`;this.errors.push(new Kt(f,a))}checkSubtype(a,h){const f=Se(a,h);return f&&this.error(f),f}}class hh{constructor(a,h,f){this.type=ft,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=h}static parse(a,h){if(a.length!==2)return h.error("Expected one argument.");const f=a[1];if(typeof f!="object"||Array.isArray(f))return h.error("Collator options argument must be an object.");const y=h.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,jt);if(!y)return null;const S=h.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,jt);if(!S)return null;let T=null;return f.locale&&(T=h.parse(f.locale,1,Ht),!T)?null:new hh(y,S,T)}evaluate(a){return new Fn(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const ys=8192;function Cf(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function ru(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function Mm(c,a){const h=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(h*y*ys),Math.round(f*y*ys)]}function Fv(c,a,h){const f=c[0]-a[0],y=c[1]-a[1],S=c[0]-h[0],T=c[1]-h[1];return f*T-S*y==0&&f*S<=0&&y*T<=0}function dh(c,a){let h=!1;for(let T=0,E=a.length;T<E;T++){const I=a[T];for(let F=0,j=I.length;F<j-1;F++){if(Fv(c,I[F],I[F+1]))return!1;(y=I[F])[1]>(f=c)[1]!=(S=I[F+1])[1]>f[1]&&f[0]<(S[0]-y[0])*(f[1]-y[1])/(S[1]-y[1])+y[0]&&(h=!h)}}var f,y,S;return h}function Tm(c,a){for(let h=0;h<a.length;h++)if(dh(c,a[h]))return!0;return!1}function Em(c,a,h,f){const y=f[0]-h[0],S=f[1]-h[1],T=(c[0]-h[0])*S-y*(c[1]-h[1]),E=(a[0]-h[0])*S-y*(a[1]-h[1]);return T>0&&E<0||T<0&&E>0}function Nv(c,a,h){for(const F of h)for(let j=0;j<F.length-1;++j)if((E=[(T=F[j+1])[0]-(S=F[j])[0],T[1]-S[1]])[0]*(I=[(y=a)[0]-(f=c)[0],y[1]-f[1]])[1]-E[1]*I[0]!=0&&Em(f,y,S,T)&&Em(S,T,f,y))return!0;var f,y,S,T,E,I;return!1}function Am(c,a){for(let h=0;h<c.length;++h)if(!dh(c[h],a))return!1;for(let h=0;h<c.length-1;++h)if(Nv(c[h],c[h+1],a))return!1;return!0}function Ov(c,a){for(let h=0;h<a.length;h++)if(Am(c,a[h]))return!0;return!1}function fh(c,a,h){const f=[];for(let y=0;y<c.length;y++){const S=[];for(let T=0;T<c[y].length;T++){const E=Mm(c[y][T],h);Cf(a,E),S.push(E)}f.push(S)}return f}function Pf(c,a,h){const f=[];for(let y=0;y<c.length;y++){const S=fh(c[y],a,h);f.push(S)}return f}function Cm(c,a,h,f){if(c[0]<h[0]||c[0]>h[2]){const y=.5*f;let S=c[0]-h[0]>y?-f:h[0]-c[0]>y?f:0;S===0&&(S=c[0]-h[2]>y?-f:h[2]-c[0]>y?f:0),c[0]+=S}Cf(a,c)}function Pm(c,a,h,f){const y=Math.pow(2,f.z)*ys,S=[f.x*ys,f.y*ys],T=[];for(const E of c)for(const I of E){const F=[I.x+S[0],I.y+S[1]];Cm(F,a,h,y),T.push(F)}return T}function ph(c,a,h,f){const y=Math.pow(2,f.z)*ys,S=[f.x*ys,f.y*ys],T=[];for(const I of c){const F=[];for(const j of I){const W=[j.x+S[0],j.y+S[1]];Cf(a,W),F.push(W)}T.push(F)}if(a[2]-a[0]<=y/2){(E=a)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const I of T)for(const F of I)Cm(F,a,h,y)}var E;return T}class Go{constructor(a,h){this.type=jt,this.geojson=a,this.geometries=h}static parse(a,h){if(a.length!==2)return h.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(or(a[1])){const f=a[1];if(f.type==="FeatureCollection"){const y=[];for(const S of f.features){const{type:T,coordinates:E}=S.geometry;T==="Polygon"&&y.push(E),T==="MultiPolygon"&&y.push(...E)}if(y.length)return new Go(f,{type:"MultiPolygon",coordinates:y})}else if(f.type==="Feature"){const y=f.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Go(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new Go(f,f)}return h.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(h,f){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(f.type==="Polygon"){const E=fh(f.coordinates,S,T),I=Pm(h.geometry(),y,S,T);if(!ru(y,S))return!1;for(const F of I)if(!dh(F,E))return!1}if(f.type==="MultiPolygon"){const E=Pf(f.coordinates,S,T),I=Pm(h.geometry(),y,S,T);if(!ru(y,S))return!1;for(const F of I)if(!Tm(F,E))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(h,f){const y=[1/0,1/0,-1/0,-1/0],S=[1/0,1/0,-1/0,-1/0],T=h.canonicalID();if(f.type==="Polygon"){const E=fh(f.coordinates,S,T),I=ph(h.geometry(),y,S,T);if(!ru(y,S))return!1;for(const F of I)if(!Am(F,E))return!1}if(f.type==="MultiPolygon"){const E=Pf(f.coordinates,S,T),I=ph(h.geometry(),y,S,T);if(!ru(y,S))return!1;for(const F of I)if(!Ov(F,E))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class mh{constructor(a,h){this.type=h.type,this.name=a,this.boundExpression=h}static parse(a,h){if(a.length!==2||typeof a[1]!="string")return h.error("'var' expression requires exactly one string literal argument.");const f=a[1];return h.scope.has(f)?new mh(f,h.scope.get(f)):h.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class ka{constructor(a,h,f,y){this.name=a,this.type=h,this._evaluate=f,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,h){const f=a[0],y=ka.definitions[f];if(!y)return h.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const S=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,E=T.filter(([F])=>!Array.isArray(F)||F.length===a.length-1);let I=null;for(const[F,j]of E){I=new rr(h.registry,iu,h.path,null,h.scope);const W=[];let J=!1;for(let ae=1;ae<a.length;ae++){const oe=a[ae],pe=Array.isArray(F)?F[ae-1]:F.type,xe=I.parse(oe,1+W.length,pe);if(!xe){J=!0;break}W.push(xe)}if(!J)if(Array.isArray(F)&&F.length!==W.length)I.error(`Expected ${F.length} arguments, but found ${W.length} instead.`);else{for(let ae=0;ae<W.length;ae++){const oe=Array.isArray(F)?F[ae]:F.type,pe=W[ae];I.concat(ae+1).checkSubtype(oe,pe.type)}if(I.errors.length===0)return new ka(f,S,j,W)}}if(E.length===1)h.errors.push(...I.errors);else{const F=(E.length?E:T).map(([W])=>{return J=W,Array.isArray(J)?`(${J.map(ne).join(", ")})`:`(${ne(J.type)}...)`;var J}).join(" | "),j=[];for(let W=1;W<a.length;W++){const J=h.parse(a[W],1+j.length);if(!J)return null;j.push(ne(J.type))}h.error(`Expected arguments of type ${F}, but found (${j.join(", ")}) instead.`)}return null}static register(a,h){ka.definitions=h;for(const f in h)a[f]=ka}}function iu(c){if(c instanceof mh)return iu(c.boundExpression);if(c instanceof ka&&c.name==="error"||c instanceof hh||c instanceof Go)return!1;const a=c instanceof Lr||c instanceof Jr;let h=!0;return c.eachChild(f=>{h=a?h&&iu(f):h&&f instanceof da}),!!h&&au(c)&&gh(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function au(c){if(c instanceof ka&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof Go)return!1;let a=!0;return c.eachChild(h=>{a&&!au(h)&&(a=!1)}),a}function su(c){if(c instanceof ka&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(h=>{a&&!su(h)&&(a=!1)}),a}function gh(c,a){if(c instanceof ka&&a.indexOf(c.name)>=0)return!1;let h=!0;return c.eachChild(f=>{h&&!gh(f,a)&&(h=!1)}),h}function ou(c,a){const h=c.length-1;let f,y,S=0,T=h,E=0;for(;S<=T;)if(E=Math.floor((S+T)/2),f=c[E],y=c[E+1],f<=a){if(E===h||a<y)return E;S=E+1}else{if(!(f>a))throw new xr("Input is not a number.");T=E-1}return 0}class Bl{constructor(a,h,f){this.type=a,this.input=h,this.labels=[],this.outputs=[];for(const[y,S]of f)this.labels.push(y),this.outputs.push(S)}static parse(a,h){if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");const f=h.parse(a[1],1,dt);if(!f)return null;const y=[];let S=null;h.expectedType&&h.expectedType.kind!=="value"&&(S=h.expectedType);for(let T=1;T<a.length;T+=2){const E=T===1?-1/0:a[T],I=a[T+1],F=T,j=T+1;if(typeof E!="number")return h.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(y.length&&y[y.length-1][0]>=E)return h.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',F);const W=h.parse(I,j,S);if(!W)return null;S=S||W.type,y.push([E,W])}return new Bl(S,f,y)}evaluate(a){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=h[0])return f[0].evaluate(a);const S=h.length;return y>=h[S-1]?f[S-1].evaluate(a):f[ou(h,y)].evaluate(a)}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Bv(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var Uv=Rm;function Rm(c,a,h,f){this.cx=3*c,this.bx=3*(h-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=h,this.p2y=f}Rm.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var h=c,f=0;f<8;f++){var y=this.sampleCurveX(h)-c;if(Math.abs(y)<a)return h;var S=this.sampleCurveDerivativeX(h);if(Math.abs(S)<1e-6)break;h-=y/S}var T=0,E=1;for(h=c,f=0;f<20&&(y=this.sampleCurveX(h),!(Math.abs(y-c)<a));f++)c>y?T=h:E=h,h=.5*(E-T)+T;return h},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var Vv=Bv(Uv);function jo(c,a,h){return c+h*(a-c)}function yh(c,a,h){return c.map((f,y)=>jo(f,a[y],h))}const fa={number:jo,color:function(c,a,h,f="rgb"){switch(f){case"rgb":{const[y,S,T,E]=yh(c.rgb,a.rgb,h);return new Xt(y,S,T,E,!1)}case"hcl":{const[y,S,T,E]=c.hcl,[I,F,j,W]=a.hcl;let J,ae;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?J=NaN:(J=I,T!==1&&T!==0||(ae=F)):(J=y,j!==1&&j!==0||(ae=S));else{let He=I-y;I>y&&He>180?He-=360:I<y&&y-I>180&&(He+=360),J=y+h*He}const[oe,pe,xe,Pe]=function([He,De,Ne,ht]){return He=isNaN(He)?0:He*bn,We([Ne,Math.cos(He)*De,Math.sin(He)*De,ht])}([J,ae??jo(S,F,h),jo(T,j,h),jo(E,W,h)]);return new Xt(oe,pe,xe,Pe,!1)}case"lab":{const[y,S,T,E]=We(yh(c.lab,a.lab,h));return new Xt(y,S,T,E,!1)}}},array:yh,padding:function(c,a,h){return new cr(yh(c.values,a.values,h))},variableAnchorOffsetCollection:function(c,a,h){const f=c.values,y=a.values;if(f.length!==y.length)throw new xr(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const S=[];for(let T=0;T<f.length;T+=2){if(f[T]!==y[T])throw new xr(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${f[T]}, to[${T}]: ${y[T]}`);S.push(f[T]);const[E,I]=f[T+1],[F,j]=y[T+1];S.push([jo(E,F,h),jo(I,j,h)])}return new Wn(S)}};class Ni{constructor(a,h,f,y,S){this.type=a,this.operator=h,this.interpolation=f,this.input=y,this.labels=[],this.outputs=[];for(const[T,E]of S)this.labels.push(T),this.outputs.push(E)}static interpolationFactor(a,h,f,y){let S=0;if(a.name==="exponential")S=Ul(h,a.base,f,y);else if(a.name==="linear")S=Ul(h,1,f,y);else if(a.name==="cubic-bezier"){const T=a.controlPoints;S=new Vv(T[0],T[1],T[2],T[3]).solve(Ul(h,1,f,y))}return S}static parse(a,h){let[f,y,S,...T]=a;if(!Array.isArray(y)||y.length===0)return h.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const F=y[1];if(typeof F!="number")return h.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:F}}else{if(y[0]!=="cubic-bezier")return h.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const F=y.slice(1);if(F.length!==4||F.some(j=>typeof j!="number"||j<0||j>1))return h.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:F}}}if(a.length-1<4)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return h.error("Expected an even number of arguments.");if(S=h.parse(S,2,dt),!S)return null;const E=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Jt:h.expectedType&&h.expectedType.kind!=="value"&&(I=h.expectedType);for(let F=0;F<T.length;F+=2){const j=T[F],W=T[F+1],J=F+3,ae=F+4;if(typeof j!="number")return h.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',J);if(E.length&&E[E.length-1][0]>=j)return h.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',J);const oe=h.parse(W,ae,I);if(!oe)return null;I=I||oe.type,E.push([j,oe])}return Re(I,dt)||Re(I,Jt)||Re(I,ce)||Re(I,V)||Re(I,$(dt))?new Ni(I,f,y,S,E):h.error(`Type ${ne(I)} is not interpolatable.`)}evaluate(a){const h=this.labels,f=this.outputs;if(h.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=h[0])return f[0].evaluate(a);const S=h.length;if(y>=h[S-1])return f[S-1].evaluate(a);const T=ou(h,y),E=Ni.interpolationFactor(this.interpolation,y,h[T],h[T+1]),I=f[T].evaluate(a),F=f[T+1].evaluate(a);switch(this.operator){case"interpolate":return fa[this.type.kind](I,F,E);case"interpolate-hcl":return fa.color(I,F,E,"hcl");case"interpolate-lab":return fa.color(I,F,E,"lab")}}eachChild(a){a(this.input);for(const h of this.outputs)a(h)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Ul(c,a,h,f){const y=f-h,S=c-h;return y===0?0:a===1?S/y:(Math.pow(a,S)-1)/(Math.pow(a,y)-1)}class ir{constructor(a,h){this.type=a,this.args=h}static parse(a,h){if(a.length<2)return h.error("Expectected at least one argument.");let f=null;const y=h.expectedType;y&&y.kind!=="value"&&(f=y);const S=[];for(const E of a.slice(1)){const I=h.parse(E,1+S.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,S.push(I)}if(!f)throw new Error("No output type");const T=y&&S.some(E=>Se(y,E.type));return new ir(T?Be:f,S)}evaluate(a){let h,f=null,y=0;for(const S of this.args)if(y++,f=S.evaluate(a),f&&f instanceof Pn&&!f.available&&(h||(h=f.name),f=null,y===this.args.length&&(f=h)),f!==null)break;return f}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class vh{constructor(a,h){this.type=h.type,this.bindings=[].concat(a),this.result=h}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const h of this.bindings)a(h[1]);a(this.result)}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const f=[];for(let S=1;S<a.length-1;S+=2){const T=a[S];if(typeof T!="string")return h.error(`Expected string, but found ${typeof T} instead.`,S);if(/[^a-zA-Z0-9_]/.test(T))return h.error("Variable names must contain only alphanumeric characters or '_'.",S);const E=h.parse(a[S+1],S+1);if(!E)return null;f.push([T,E])}const y=h.parse(a[a.length-1],a.length-1,h.expectedType,f);return y?new vh(f,y):null}outputDefined(){return this.result.outputDefined()}}class Rf{constructor(a,h,f){this.type=a,this.index=h,this.input=f}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=h.parse(a[1],1,dt),y=h.parse(a[2],2,$(h.expectedType||Be));return f&&y?new Rf(y.type.itemType,f,y):null}evaluate(a){const h=this.index.evaluate(a),f=this.input.evaluate(a);if(h<0)throw new xr(`Array index out of bounds: ${h} < 0.`);if(h>=f.length)throw new xr(`Array index out of bounds: ${h} > ${f.length-1}.`);if(h!==Math.floor(h))throw new xr(`Array index must be an integer, but found ${h} instead.`);return f[h]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class If{constructor(a,h){this.type=jt,this.needle=a,this.haystack=h}static parse(a,h){if(a.length!==3)return h.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=h.parse(a[1],1,Be),y=h.parse(a[2],2,Be);return f&&y?Te(f.type,[jt,Ht,dt,Un,Be])?new If(f,y):h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`):null}evaluate(a){const h=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!f)return!1;if(!ye(h,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${ne(fr(h))} instead.`);if(!ye(f,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${ne(fr(f))} instead.`);return f.indexOf(h)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class _h{constructor(a,h,f){this.type=dt,this.needle=a,this.haystack=h,this.fromIndex=f}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=h.parse(a[1],1,Be),y=h.parse(a[2],2,Be);if(!f||!y)return null;if(!Te(f.type,[jt,Ht,dt,Un,Be]))return h.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`);if(a.length===4){const S=h.parse(a[3],3,dt);return S?new _h(f,y,S):null}return new _h(f,y)}evaluate(a){const h=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!ye(h,["boolean","string","number","null"]))throw new xr(`Expected first argument to be of type boolean, string, number or null, but found ${ne(fr(h))} instead.`);if(!ye(f,["string","array"]))throw new xr(`Expected second argument to be of type array or string, but found ${ne(fr(f))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(a);return f.indexOf(h,y)}return f.indexOf(h)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class Df{constructor(a,h,f,y,S,T){this.inputType=a,this.type=h,this.input=f,this.cases=y,this.outputs=S,this.otherwise=T}static parse(a,h){if(a.length<5)return h.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return h.error("Expected an even number of arguments.");let f,y;h.expectedType&&h.expectedType.kind!=="value"&&(y=h.expectedType);const S={},T=[];for(let F=2;F<a.length-1;F+=2){let j=a[F];const W=a[F+1];Array.isArray(j)||(j=[j]);const J=h.concat(F);if(j.length===0)return J.error("Expected at least one branch label.");for(const oe of j){if(typeof oe!="number"&&typeof oe!="string")return J.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return J.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return J.error("Numeric branch labels must be integer values.");if(f){if(J.checkSubtype(f,fr(oe)))return null}else f=fr(oe);if(S[String(oe)]!==void 0)return J.error("Branch labels must be unique.");S[String(oe)]=T.length}const ae=h.parse(W,F,y);if(!ae)return null;y=y||ae.type,T.push(ae)}const E=h.parse(a[1],1,Be);if(!E)return null;const I=h.parse(a[a.length-1],a.length-1,y);return I?E.type.kind!=="value"&&h.concat(1).checkSubtype(f,E.type)?null:new Df(f,y,E,S,T,I):null}evaluate(a){const h=this.input.evaluate(a);return(fr(h)===this.inputType&&this.outputs[this.cases[h]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class kf{constructor(a,h,f){this.type=a,this.branches=h,this.otherwise=f}static parse(a,h){if(a.length<4)return h.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return h.error("Expected an odd number of arguments.");let f;h.expectedType&&h.expectedType.kind!=="value"&&(f=h.expectedType);const y=[];for(let T=1;T<a.length-1;T+=2){const E=h.parse(a[T],T,jt);if(!E)return null;const I=h.parse(a[T+1],T+1,f);if(!I)return null;y.push([E,I]),f=f||I.type}const S=h.parse(a[a.length-1],a.length-1,f);if(!S)return null;if(!f)throw new Error("Can't infer output type");return new kf(f,y,S)}evaluate(a){for(const[h,f]of this.branches)if(h.evaluate(a))return f.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[h,f]of this.branches)a(h),a(f);a(this.otherwise)}outputDefined(){return this.branches.every(([a,h])=>h.outputDefined())&&this.otherwise.outputDefined()}}class xh{constructor(a,h,f,y){this.type=a,this.input=h,this.beginIndex=f,this.endIndex=y}static parse(a,h){if(a.length<=2||a.length>=5)return h.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=h.parse(a[1],1,Be),y=h.parse(a[2],2,dt);if(!f||!y)return null;if(!Te(f.type,[$(Be),Ht,Be]))return h.error(`Expected first argument to be of type array or string, but found ${ne(f.type)} instead`);if(a.length===4){const S=h.parse(a[3],3,dt);return S?new xh(f.type,f,y,S):null}return new xh(f.type,f,y)}evaluate(a){const h=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!ye(h,["string","array"]))throw new xr(`Expected first argument to be of type array or string, but found ${ne(fr(h))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(a);return h.slice(f,y)}return h.slice(f)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function Im(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function Dm(c,a,h,f){return f.compare(a,h)===0}function Vl(c,a,h){const f=c!=="=="&&c!=="!=";return class IP{constructor(S,T,E){this.type=jt,this.lhs=S,this.rhs=T,this.collator=E,this.hasUntypedArgument=S.type.kind==="value"||T.type.kind==="value"}static parse(S,T){if(S.length!==3&&S.length!==4)return T.error("Expected two or three arguments.");const E=S[0];let I=T.parse(S[1],1,Be);if(!I)return null;if(!Im(E,I.type))return T.concat(1).error(`"${E}" comparisons are not supported for type '${ne(I.type)}'.`);let F=T.parse(S[2],2,Be);if(!F)return null;if(!Im(E,F.type))return T.concat(2).error(`"${E}" comparisons are not supported for type '${ne(F.type)}'.`);if(I.type.kind!==F.type.kind&&I.type.kind!=="value"&&F.type.kind!=="value")return T.error(`Cannot compare types '${ne(I.type)}' and '${ne(F.type)}'.`);f&&(I.type.kind==="value"&&F.type.kind!=="value"?I=new Jr(F.type,[I]):I.type.kind!=="value"&&F.type.kind==="value"&&(F=new Jr(I.type,[F])));let j=null;if(S.length===4){if(I.type.kind!=="string"&&F.type.kind!=="string"&&I.type.kind!=="value"&&F.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(j=T.parse(S[3],3,ft),!j)return null}return new IP(I,F,j)}evaluate(S){const T=this.lhs.evaluate(S),E=this.rhs.evaluate(S);if(f&&this.hasUntypedArgument){const I=fr(T),F=fr(E);if(I.kind!==F.kind||I.kind!=="string"&&I.kind!=="number")throw new xr(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${I.kind}, ${F.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=fr(T),F=fr(E);if(I.kind!=="string"||F.kind!=="string")return a(S,T,E)}return this.collator?h(S,T,E,this.collator.evaluate(S)):a(S,T,E)}eachChild(S){S(this.lhs),S(this.rhs),this.collator&&S(this.collator)}outputDefined(){return!0}}}const Hv=Vl("==",function(c,a,h){return a===h},Dm),Gv=Vl("!=",function(c,a,h){return a!==h},function(c,a,h,f){return!Dm(0,a,h,f)}),jv=Vl("<",function(c,a,h){return a<h},function(c,a,h,f){return f.compare(a,h)<0}),Wv=Vl(">",function(c,a,h){return a>h},function(c,a,h,f){return f.compare(a,h)>0}),$v=Vl("<=",function(c,a,h){return a<=h},function(c,a,h,f){return f.compare(a,h)<=0}),qv=Vl(">=",function(c,a,h){return a>=h},function(c,a,h,f){return f.compare(a,h)>=0});class Lf{constructor(a,h,f,y,S){this.type=Ht,this.number=a,this.locale=h,this.currency=f,this.minFractionDigits=y,this.maxFractionDigits=S}static parse(a,h){if(a.length!==3)return h.error("Expected two arguments.");const f=h.parse(a[1],1,dt);if(!f)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return h.error("NumberFormat options argument must be an object.");let S=null;if(y.locale&&(S=h.parse(y.locale,1,Ht),!S))return null;let T=null;if(y.currency&&(T=h.parse(y.currency,1,Ht),!T))return null;let E=null;if(y["min-fraction-digits"]&&(E=h.parse(y["min-fraction-digits"],1,dt),!E))return null;let I=null;return y["max-fraction-digits"]&&(I=h.parse(y["max-fraction-digits"],1,dt),!I)?null:new Lf(f,S,T,E,I)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class bh{constructor(a){this.type=kt,this.sections=a}static parse(a,h){if(a.length<2)return h.error("Expected at least one argument.");const f=a[1];if(!Array.isArray(f)&&typeof f=="object")return h.error("First argument must be an image or text section.");const y=[];let S=!1;for(let T=1;T<=a.length-1;++T){const E=a[T];if(S&&typeof E=="object"&&!Array.isArray(E)){S=!1;let I=null;if(E["font-scale"]&&(I=h.parse(E["font-scale"],1,dt),!I))return null;let F=null;if(E["text-font"]&&(F=h.parse(E["text-font"],1,$(Ht)),!F))return null;let j=null;if(E["text-color"]&&(j=h.parse(E["text-color"],1,Jt),!j))return null;const W=y[y.length-1];W.scale=I,W.font=F,W.textColor=j}else{const I=h.parse(a[T],1,Be);if(!I)return null;const F=I.type.kind;if(F!=="string"&&F!=="value"&&F!=="null"&&F!=="resolvedImage")return h.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");S=!0,y.push({content:I,scale:null,font:null,textColor:null})}}return new bh(y)}evaluate(a){return new gr(this.sections.map(h=>{const f=h.content.evaluate(a);return fr(f)===O?new Er("",f,null,null,null):new Er(uo(f),null,h.scale?h.scale.evaluate(a):null,h.font?h.font.evaluate(a).join(","):null,h.textColor?h.textColor.evaluate(a):null)}))}eachChild(a){for(const h of this.sections)a(h.content),h.scale&&a(h.scale),h.font&&a(h.font),h.textColor&&a(h.textColor)}outputDefined(){return!1}}class zf{constructor(a){this.type=O,this.input=a}static parse(a,h){if(a.length!==2)return h.error("Expected two arguments.");const f=h.parse(a[1],1,Ht);return f?new zf(f):h.error("No image name provided.")}evaluate(a){const h=this.input.evaluate(a),f=Pn.fromString(h);return f&&a.availableImages&&(f.available=a.availableImages.indexOf(h)>-1),f}eachChild(a){a(this.input)}outputDefined(){return!1}}class Ff{constructor(a){this.type=dt,this.input=a}static parse(a,h){if(a.length!==2)return h.error(`Expected 1 argument, but found ${a.length-1} instead.`);const f=h.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?h.error(`Expected argument of type string or array, but found ${ne(f.type)} instead.`):new Ff(f):null}evaluate(a){const h=this.input.evaluate(a);if(typeof h=="string"||Array.isArray(h))return h.length;throw new xr(`Expected value to be of type string or array, but found ${ne(fr(h))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const Hl={"==":Hv,"!=":Gv,">":Wv,"<":jv,">=":qv,"<=":$v,array:Jr,at:Rf,boolean:Jr,case:kf,coalesce:ir,collator:hh,format:bh,image:zf,in:If,"index-of":_h,interpolate:Ni,"interpolate-hcl":Ni,"interpolate-lab":Ni,length:Ff,let:vh,literal:da,match:Df,number:Jr,"number-format":Lf,object:Jr,slice:xh,step:Bl,string:Jr,"to-boolean":Lr,"to-color":Lr,"to-number":Lr,"to-string":Lr,var:mh,within:Go};function km(c,[a,h,f,y]){a=a.evaluate(c),h=h.evaluate(c),f=f.evaluate(c);const S=y?y.evaluate(c):1,T=Ol(a,h,f,S);if(T)throw new xr(T);return new Xt(a/255,h/255,f/255,S,!1)}function Lm(c,a){return c in a}function Nf(c,a){const h=a[c];return h===void 0?null:h}function Wo(c){return{type:c}}function zm(c){return{result:"success",value:c}}function Gl(c){return{result:"error",value:c}}function jl(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function Fm(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Of(c){return!!c.expression&&c.expression.interpolated}function ar(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Wl(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function Xv(c){return c}function Nm(c,a){const h=a.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",y=f||!(f||c.property!==void 0),S=c.type||(Of(a)?"exponential":"interval");if(h||a.type==="padding"){const j=h?Xt.parse:cr.parse;(c=tn({},c)).stops&&(c.stops=c.stops.map(W=>[W[0],j(W[1])])),c.default=j(c.default?c.default:a.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let E,I,F;if(S==="exponential")E=Om;else if(S==="interval")E=jr;else if(S==="categorical"){E=Zv,I=Object.create(null);for(const j of c.stops)I[j[0]]=j[1];F=typeof c.stops[0][0]}else{if(S!=="identity")throw new Error(`Unknown function type "${S}"`);E=tr}if(f){const j={},W=[];for(let oe=0;oe<c.stops.length;oe++){const pe=c.stops[oe],xe=pe[0].zoom;j[xe]===void 0&&(j[xe]={zoom:xe,type:c.type,property:c.property,default:c.default,stops:[]},W.push(xe)),j[xe].stops.push([pe[0].value,pe[1]])}const J=[];for(const oe of W)J.push([j[oe].zoom,Nm(j[oe],a)]);const ae={name:"linear"};return{kind:"composite",interpolationType:ae,interpolationFactor:Ni.interpolationFactor.bind(void 0,ae),zoomStops:J.map(oe=>oe[0]),evaluate:({zoom:oe},pe)=>Om({stops:J,base:c.base},a,oe).evaluate(oe,pe)}}if(y){const j=S==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:Ni.interpolationFactor.bind(void 0,j),zoomStops:c.stops.map(W=>W[0]),evaluate:({zoom:W})=>E(c,a,W,I,F)}}return{kind:"source",evaluate(j,W){const J=W&&W.properties?W.properties[c.property]:void 0;return J===void 0?lu(c.default,a.default):E(c,a,J,I,F)}}}function lu(c,a,h){return c!==void 0?c:a!==void 0?a:h!==void 0?h:void 0}function Zv(c,a,h,f,y){return lu(typeof h===y?f[h]:void 0,c.default,a.default)}function jr(c,a,h){if(ar(h)!=="number")return lu(c.default,a.default);const f=c.stops.length;if(f===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[f-1][0])return c.stops[f-1][1];const y=ou(c.stops.map(S=>S[0]),h);return c.stops[y][1]}function Om(c,a,h){const f=c.base!==void 0?c.base:1;if(ar(h)!=="number")return lu(c.default,a.default);const y=c.stops.length;if(y===1||h<=c.stops[0][0])return c.stops[0][1];if(h>=c.stops[y-1][0])return c.stops[y-1][1];const S=ou(c.stops.map(j=>j[0]),h),T=function(j,W,J,ae){const oe=ae-J,pe=j-J;return oe===0?0:W===1?pe/oe:(Math.pow(W,pe)-1)/(Math.pow(W,oe)-1)}(h,f,c.stops[S][0],c.stops[S+1][0]),E=c.stops[S][1],I=c.stops[S+1][1],F=fa[a.type]||Xv;return typeof E.evaluate=="function"?{evaluate(...j){const W=E.evaluate.apply(void 0,j),J=I.evaluate.apply(void 0,j);if(W!==void 0&&J!==void 0)return F(W,J,T,c.colorSpace)}}:F(E,I,T,c.colorSpace)}function tr(c,a,h){switch(a.type){case"color":h=Xt.parse(h);break;case"formatted":h=gr.fromString(h.toString());break;case"resolvedImage":h=Pn.fromString(h.toString());break;case"padding":h=cr.parse(h);break;default:ar(h)===a.type||a.type==="enum"&&a.values[h]||(h=void 0)}return lu(h,c.default,a.default)}ka.register(Hl,{error:[{kind:"error"},[Ht],(c,[a])=>{throw new xr(a.evaluate(c))}],typeof:[Ht,[Be],(c,[a])=>ne(fr(a.evaluate(c)))],"to-rgba":[$(dt,4),[Jt],(c,[a])=>{const[h,f,y,S]=a.evaluate(c).rgb;return[255*h,255*f,255*y,S]}],rgb:[Jt,[dt,dt,dt],km],rgba:[Jt,[dt,dt,dt,dt],km],has:{type:jt,overloads:[[[Ht],(c,[a])=>Lm(a.evaluate(c),c.properties())],[[Ht,X],(c,[a,h])=>Lm(a.evaluate(c),h.evaluate(c))]]},get:{type:Be,overloads:[[[Ht],(c,[a])=>Nf(a.evaluate(c),c.properties())],[[Ht,X],(c,[a,h])=>Nf(a.evaluate(c),h.evaluate(c))]]},"feature-state":[Be,[Ht],(c,[a])=>Nf(a.evaluate(c),c.featureState||{})],properties:[X,[],c=>c.properties()],"geometry-type":[Ht,[],c=>c.geometryType()],id:[Be,[],c=>c.id()],zoom:[dt,[],c=>c.globals.zoom],"heatmap-density":[dt,[],c=>c.globals.heatmapDensity||0],"line-progress":[dt,[],c=>c.globals.lineProgress||0],accumulated:[Be,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[dt,Wo(dt),(c,a)=>{let h=0;for(const f of a)h+=f.evaluate(c);return h}],"*":[dt,Wo(dt),(c,a)=>{let h=1;for(const f of a)h*=f.evaluate(c);return h}],"-":{type:dt,overloads:[[[dt,dt],(c,[a,h])=>a.evaluate(c)-h.evaluate(c)],[[dt],(c,[a])=>-a.evaluate(c)]]},"/":[dt,[dt,dt],(c,[a,h])=>a.evaluate(c)/h.evaluate(c)],"%":[dt,[dt,dt],(c,[a,h])=>a.evaluate(c)%h.evaluate(c)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(c,[a,h])=>Math.pow(a.evaluate(c),h.evaluate(c))],sqrt:[dt,[dt],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))],log2:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[dt,[dt],(c,[a])=>Math.sin(a.evaluate(c))],cos:[dt,[dt],(c,[a])=>Math.cos(a.evaluate(c))],tan:[dt,[dt],(c,[a])=>Math.tan(a.evaluate(c))],asin:[dt,[dt],(c,[a])=>Math.asin(a.evaluate(c))],acos:[dt,[dt],(c,[a])=>Math.acos(a.evaluate(c))],atan:[dt,[dt],(c,[a])=>Math.atan(a.evaluate(c))],min:[dt,Wo(dt),(c,a)=>Math.min(...a.map(h=>h.evaluate(c)))],max:[dt,Wo(dt),(c,a)=>Math.max(...a.map(h=>h.evaluate(c)))],abs:[dt,[dt],(c,[a])=>Math.abs(a.evaluate(c))],round:[dt,[dt],(c,[a])=>{const h=a.evaluate(c);return h<0?-Math.round(-h):Math.round(h)}],floor:[dt,[dt],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[dt,[dt],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[jt,[Ht,Be],(c,[a,h])=>c.properties()[a.value]===h.value],"filter-id-==":[jt,[Be],(c,[a])=>c.id()===a.value],"filter-type-==":[jt,[Ht],(c,[a])=>c.geometryType()===a.value],"filter-<":[jt,[Ht,Be],(c,[a,h])=>{const f=c.properties()[a.value],y=h.value;return typeof f==typeof y&&f<y}],"filter-id-<":[jt,[Be],(c,[a])=>{const h=c.id(),f=a.value;return typeof h==typeof f&&h<f}],"filter->":[jt,[Ht,Be],(c,[a,h])=>{const f=c.properties()[a.value],y=h.value;return typeof f==typeof y&&f>y}],"filter-id->":[jt,[Be],(c,[a])=>{const h=c.id(),f=a.value;return typeof h==typeof f&&h>f}],"filter-<=":[jt,[Ht,Be],(c,[a,h])=>{const f=c.properties()[a.value],y=h.value;return typeof f==typeof y&&f<=y}],"filter-id-<=":[jt,[Be],(c,[a])=>{const h=c.id(),f=a.value;return typeof h==typeof f&&h<=f}],"filter->=":[jt,[Ht,Be],(c,[a,h])=>{const f=c.properties()[a.value],y=h.value;return typeof f==typeof y&&f>=y}],"filter-id->=":[jt,[Be],(c,[a])=>{const h=c.id(),f=a.value;return typeof h==typeof f&&h>=f}],"filter-has":[jt,[Be],(c,[a])=>a.value in c.properties()],"filter-has-id":[jt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[jt,[$(Ht)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[jt,[$(Be)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[jt,[Ht,$(Be)],(c,[a,h])=>h.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[jt,[Ht,$(Be)],(c,[a,h])=>function(f,y,S,T){for(;S<=T;){const E=S+T>>1;if(y[E]===f)return!0;y[E]>f?T=E-1:S=E+1}return!1}(c.properties()[a.value],h.value,0,h.value.length-1)],all:{type:jt,overloads:[[[jt,jt],(c,[a,h])=>a.evaluate(c)&&h.evaluate(c)],[Wo(jt),(c,a)=>{for(const h of a)if(!h.evaluate(c))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],(c,[a,h])=>a.evaluate(c)||h.evaluate(c)],[Wo(jt),(c,a)=>{for(const h of a)if(h.evaluate(c))return!0;return!1}]]},"!":[jt,[jt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[jt,[Ht],(c,[a])=>{const h=c.globals&&c.globals.isSupportedScript;return!h||h(a.evaluate(c))}],upcase:[Ht,[Ht],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[Ht,[Ht],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[Ht,Wo(Be),(c,a)=>a.map(h=>uo(h.evaluate(c))).join("")],"resolved-locale":[Ht,[ft],(c,[a])=>a.evaluate(c).resolvedLocale()]});class cu{constructor(a,h){var f;this.expression=a,this._warningHistory={},this._evaluator=new fo,this._defaultValue=h?(f=h).type==="color"&&Wl(f.default)?new Xt(0,0,0,0):f.type==="color"?Xt.parse(f.default)||null:f.type==="padding"?cr.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Wn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=h&&h.type==="enum"?h.values:null}evaluateWithoutErrorHandling(a,h,f,y,S,T){return this._evaluator.globals=a,this._evaluator.feature=h,this._evaluator.featureState=f,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,h,f,y,S,T){this._evaluator.globals=a,this._evaluator.feature=h||null,this._evaluator.featureState=f||null,this._evaluator.canonical=y,this._evaluator.availableImages=S||null,this._evaluator.formattedSection=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new xr(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function yr(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Hl}function pr(c,a){const h=new rr(Hl,iu,[],a?function(y){const S={color:Jt,string:Ht,number:dt,enum:Ht,boolean:jt,formatted:kt,padding:ce,resolvedImage:O,variableAnchorOffsetCollection:V};return y.type==="array"?$(S[y.value]||Be,y.length):S[y.type]}(a):void 0),f=h.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?zm(new cu(f,a)):Gl(h.errors)}class $l{constructor(a,h){this.kind=a,this._styleExpression=h,this.isStateDependent=a!=="constant"&&!su(h.expression)}evaluateWithoutErrorHandling(a,h,f,y,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,h,f,y,S,T)}evaluate(a,h,f,y,S,T){return this._styleExpression.evaluate(a,h,f,y,S,T)}}class wh{constructor(a,h,f,y){this.kind=a,this.zoomStops=f,this._styleExpression=h,this.isStateDependent=a!=="camera"&&!su(h.expression),this.interpolationType=y}evaluateWithoutErrorHandling(a,h,f,y,S,T){return this._styleExpression.evaluateWithoutErrorHandling(a,h,f,y,S,T)}evaluate(a,h,f,y,S,T){return this._styleExpression.evaluate(a,h,f,y,S,T)}interpolationFactor(a,h,f){return this.interpolationType?Ni.interpolationFactor(this.interpolationType,a,h,f):0}}function Bm(c,a){const h=pr(c,a);if(h.result==="error")return h;const f=h.value.expression,y=au(f);if(!y&&!jl(a))return Gl([new Kt("","data expressions not supported")]);const S=gh(f,["zoom"]);if(!S&&!Fm(a))return Gl([new Kt("","zoom expressions not supported")]);const T=Mh(f);return T||S?T instanceof Kt?Gl([T]):T instanceof Ni&&!Of(a)?Gl([new Kt("",'"interpolate" expressions cannot be used with this property')]):zm(T?new wh(y?"camera":"composite",h.value,T.labels,T instanceof Ni?T.interpolation:void 0):new $l(y?"constant":"source",h.value)):Gl([new Kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Sh{constructor(a,h){this._parameters=a,this._specification=h,tn(this,Nm(this._parameters,this._specification))}static deserialize(a){return new Sh(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function Mh(c){let a=null;if(c instanceof vh)a=Mh(c.result);else if(c instanceof ir){for(const h of c.args)if(a=Mh(h),a)break}else(c instanceof Bl||c instanceof Ni)&&c.input instanceof ka&&c.input.name==="zoom"&&(a=c);return a instanceof Kt||c.eachChild(h=>{const f=Mh(h);f instanceof Kt?a=f:!a&&f?a=new Kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&f&&a!==f&&(a=new Kt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function Bf(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!Bf(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const Um={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Th(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Bf(c)||(c=ql(c));const a=pr(c,Um);if(a.result==="error")throw new Error(a.value.map(h=>`${h.key}: ${h.message}`).join(", "));return{filter:(h,f,y)=>a.value.evaluate(h,f,{},y),needGeometry:Uf(c)}}function Vm(c,a){return c<a?-1:c>a?1:0}function Uf(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(Uf(c[a]))return!0;return!1}function ql(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?Vf(c[1],c[2],"=="):a==="!="?Eh(Vf(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Vf(c[1],c[2],a):a==="any"?(h=c.slice(1),["any"].concat(h.map(ql))):a==="all"?["all"].concat(c.slice(1).map(ql)):a==="none"?["all"].concat(c.slice(1).map(ql).map(Eh)):a==="in"?Hm(c[1],c.slice(2)):a==="!in"?Eh(Hm(c[1],c.slice(2))):a==="has"?Gm(c[1]):a==="!has"?Eh(Gm(c[1])):a!=="within"||c;var h}function Vf(c,a,h){switch(c){case"$type":return[`filter-type-${h}`,a];case"$id":return[`filter-id-${h}`,a];default:return[`filter-${h}`,c,a]}}function Hm(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(h=>typeof h!=typeof a[0])?["filter-in-large",c,["literal",a.sort(Vm)]]:["filter-in-small",c,["literal",a]]}}function Gm(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function Eh(c){return["!",c]}function Hf(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let y="[";for(const S of c)y+=`${Hf(S)},`;return`${y}]`}const h=Object.keys(c).sort();let f="{";for(let y=0;y<h.length;y++)f+=`${JSON.stringify(h[y])}:${Hf(c[h[y]])},`;return`${f}}`}function Yv(c){let a="";for(const h of le)a+=`/${Hf(c[h])}`;return a}function jm(c){const a=c.value;return a?[new at(c.key,a,"constants have been deprecated as of v8")]:[]}function Ur(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function po(c){if(Array.isArray(c))return c.map(po);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const h in c)a[h]=po(c[h]);return a}return Ur(c)}function pa(c){const a=c.key,h=c.value,f=c.valueSpec||{},y=c.objectElementValidators||{},S=c.style,T=c.styleSpec,E=c.validateSpec;let I=[];const F=ar(h);if(F!=="object")return[new at(a,h,`object expected, ${F} found`)];for(const j in h){const W=j.split(".")[0],J=f[W]||f["*"];let ae;if(y[W])ae=y[W];else if(f[W])ae=E;else if(y["*"])ae=y["*"];else{if(!f["*"]){I.push(new at(a,h[j],`unknown property "${j}"`));continue}ae=E}I=I.concat(ae({key:(a&&`${a}.`)+j,value:h[j],valueSpec:J,style:S,styleSpec:T,object:h,objectKey:j,validateSpec:E},h))}for(const j in f)y[j]||f[j].required&&f[j].default===void 0&&h[j]===void 0&&I.push(new at(a,h,`missing required property "${j}"`));return I}function Xl(c){const a=c.value,h=c.valueSpec,f=c.style,y=c.styleSpec,S=c.key,T=c.arrayElementValidator||c.validateSpec;if(ar(a)!=="array")return[new at(S,a,`array expected, ${ar(a)} found`)];if(h.length&&a.length!==h.length)return[new at(S,a,`array length ${h.length} expected, length ${a.length} found`)];if(h["min-length"]&&a.length<h["min-length"])return[new at(S,a,`array length at least ${h["min-length"]} expected, length ${a.length} found`)];let E={type:h.value,values:h.values};y.$version<7&&(E.function=h.function),ar(h.value)==="object"&&(E=h.value);let I=[];for(let F=0;F<a.length;F++)I=I.concat(T({array:a,arrayIndex:F,value:a[F],valueSpec:E,validateSpec:c.validateSpec,style:f,styleSpec:y,key:`${S}[${F}]`}));return I}function Gf(c){const a=c.key,h=c.value,f=c.valueSpec;let y=ar(h);return y==="number"&&h!=h&&(y="NaN"),y!=="number"?[new at(a,h,`number expected, ${y} found`)]:"minimum"in f&&h<f.minimum?[new at(a,h,`${h} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&h>f.maximum?[new at(a,h,`${h} is greater than the maximum value ${f.maximum}`)]:[]}function jf(c){const a=c.valueSpec,h=Ur(c.value.type);let f,y,S,T={};const E=h!=="categorical"&&c.value.property===void 0,I=!E,F=ar(c.value.stops)==="array"&&ar(c.value.stops[0])==="array"&&ar(c.value.stops[0][0])==="object",j=pa({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ae){if(h==="identity")return[new at(ae.key,ae.value,'identity function may not have a "stops" property')];let oe=[];const pe=ae.value;return oe=oe.concat(Xl({key:ae.key,value:pe,valueSpec:ae.valueSpec,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:W})),ar(pe)==="array"&&pe.length===0&&oe.push(new at(ae.key,pe,"array must have at least one stop")),oe},default:function(ae){return ae.validateSpec({key:ae.key,value:ae.value,valueSpec:a,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec})}}});return h==="identity"&&E&&j.push(new at(c.key,c.value,'missing required property "property"')),h==="identity"||c.value.stops||j.push(new at(c.key,c.value,'missing required property "stops"')),h==="exponential"&&c.valueSpec.expression&&!Of(c.valueSpec)&&j.push(new at(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(I&&!jl(c.valueSpec)?j.push(new at(c.key,c.value,"property functions not supported")):E&&!Fm(c.valueSpec)&&j.push(new at(c.key,c.value,"zoom functions not supported"))),h!=="categorical"&&!F||c.value.property!==void 0||j.push(new at(c.key,c.value,'"property" property is required')),j;function W(ae){let oe=[];const pe=ae.value,xe=ae.key;if(ar(pe)!=="array")return[new at(xe,pe,`array expected, ${ar(pe)} found`)];if(pe.length!==2)return[new at(xe,pe,`array length 2 expected, length ${pe.length} found`)];if(F){if(ar(pe[0])!=="object")return[new at(xe,pe,`object expected, ${ar(pe[0])} found`)];if(pe[0].zoom===void 0)return[new at(xe,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new at(xe,pe,"object stop key must have value")];if(S&&S>Ur(pe[0].zoom))return[new at(xe,pe[0].zoom,"stop zoom values must appear in ascending order")];Ur(pe[0].zoom)!==S&&(S=Ur(pe[0].zoom),y=void 0,T={}),oe=oe.concat(pa({key:`${xe}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:Gf,value:J}}))}else oe=oe.concat(J({key:`${xe}[0]`,value:pe[0],valueSpec:{},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec},pe));return yr(po(pe[1]))?oe.concat([new at(`${xe}[1]`,pe[1],"expressions are not allowed in function stops.")]):oe.concat(ae.validateSpec({key:`${xe}[1]`,value:pe[1],valueSpec:a,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec}))}function J(ae,oe){const pe=ar(ae.value),xe=Ur(ae.value),Pe=ae.value!==null?ae.value:oe;if(f){if(pe!==f)return[new at(ae.key,Pe,`${pe} stop domain type must match previous stop domain type ${f}`)]}else f=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new at(ae.key,Pe,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&h!=="categorical"){let He=`number expected, ${pe} found`;return jl(a)&&h===void 0&&(He+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(ae.key,Pe,He)]}return h!=="categorical"||pe!=="number"||isFinite(xe)&&Math.floor(xe)===xe?h!=="categorical"&&pe==="number"&&y!==void 0&&xe<y?[new at(ae.key,Pe,"stop domain values must appear in ascending order")]:(y=xe,h==="categorical"&&xe in T?[new at(ae.key,Pe,"stop domain values must be unique")]:(T[xe]=!0,[])):[new at(ae.key,Pe,`integer expected, found ${xe}`)]}}function Zl(c){const a=(c.expressionContext==="property"?Bm:pr)(po(c.value),c.valueSpec);if(a.result==="error")return a.value.map(f=>new at(`${c.key}${f.key}`,c.value,f.message));const h=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!h.outputDefined())return[new at(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!su(h))return[new at(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!su(h))return[new at(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!gh(h,["zoom","feature-state"]))return[new at(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!au(h))return[new at(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function $o(c){const a=c.key,h=c.value,f=c.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(Ur(h))===-1&&y.push(new at(a,h,`expected one of [${f.values.join(", ")}], ${JSON.stringify(h)} found`)):Object.keys(f.values).indexOf(Ur(h))===-1&&y.push(new at(a,h,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(h)} found`)),y}function Yl(c){return Bf(po(c.value))?Zl(tn({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):uu(c)}function uu(c){const a=c.value,h=c.key;if(ar(a)!=="array")return[new at(h,a,`array expected, ${ar(a)} found`)];const f=c.styleSpec;let y,S=[];if(a.length<1)return[new at(h,a,"filter array must have at least 1 element")];switch(S=S.concat($o({key:`${h}[0]`,value:a[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ur(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Ur(a[1])==="$type"&&S.push(new at(h,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&S.push(new at(h,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=ar(a[1]),y!=="string"&&S.push(new at(`${h}[1]`,a[1],`string expected, ${y} found`)));for(let T=2;T<a.length;T++)y=ar(a[T]),Ur(a[1])==="$type"?S=S.concat($o({key:`${h}[${T}]`,value:a[T],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&S.push(new at(`${h}[${T}]`,a[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)S=S.concat(uu({key:`${h}[${T}]`,value:a[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":y=ar(a[1]),a.length!==2?S.push(new at(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&S.push(new at(`${h}[1]`,a[1],`string expected, ${y} found`));break;case"within":y=ar(a[1]),a.length!==2?S.push(new at(h,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="object"&&S.push(new at(`${h}[1]`,a[1],`object expected, ${y} found`))}return S}function Wf(c,a){const h=c.key,f=c.validateSpec,y=c.style,S=c.styleSpec,T=c.value,E=c.objectKey,I=S[`${a}_${c.layerType}`];if(!I)return[];const F=E.match(/^(.*)-transition$/);if(a==="paint"&&F&&I[F[1]]&&I[F[1]].transition)return f({key:h,value:T,valueSpec:S.transition,style:y,styleSpec:S});const j=c.valueSpec||I[E];if(!j)return[new at(h,T,`unknown property "${E}"`)];let W;if(ar(T)==="string"&&jl(j)&&!j.tokens&&(W=/^{([^}]+)}$/.exec(T)))return[new at(h,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const J=[];return c.layerType==="symbol"&&(E==="text-field"&&y&&!y.glyphs&&J.push(new at(h,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Wl(po(T))&&Ur(T.type)==="identity"&&J.push(new at(h,T,'"text-font" does not support identity functions'))),J.concat(f({key:c.key,value:T,valueSpec:j,style:y,styleSpec:S,expressionContext:"property",propertyType:a,propertyKey:E}))}function Ah(c){return Wf(c,"paint")}function $f(c){return Wf(c,"layout")}function qf(c){let a=[];const h=c.value,f=c.key,y=c.style,S=c.styleSpec;h.type||h.ref||a.push(new at(f,h,'either "type" or "ref" is required'));let T=Ur(h.type);const E=Ur(h.ref);if(h.id){const I=Ur(h.id);for(let F=0;F<c.arrayIndex;F++){const j=y.layers[F];Ur(j.id)===I&&a.push(new at(f,h.id,`duplicate layer id "${h.id}", previously used at line ${j.id.__line__}`))}}if("ref"in h){let I;["type","source","source-layer","filter","layout"].forEach(F=>{F in h&&a.push(new at(f,h[F],`"${F}" is prohibited for ref layers`))}),y.layers.forEach(F=>{Ur(F.id)===E&&(I=F)}),I?I.ref?a.push(new at(f,h.ref,"ref cannot reference another ref layer")):T=Ur(I.type):a.push(new at(f,h.ref,`ref layer "${E}" not found`))}else if(T!=="background")if(h.source){const I=y.sources&&y.sources[h.source],F=I&&Ur(I.type);I?F==="vector"&&T==="raster"?a.push(new at(f,h.source,`layer "${h.id}" requires a raster source`)):F!=="raster-dem"&&T==="hillshade"?a.push(new at(f,h.source,`layer "${h.id}" requires a raster-dem source`)):F==="raster"&&T!=="raster"?a.push(new at(f,h.source,`layer "${h.id}" requires a vector source`)):F!=="vector"||h["source-layer"]?F==="raster-dem"&&T!=="hillshade"?a.push(new at(f,h.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!h.paint||!h.paint["line-gradient"]||F==="geojson"&&I.lineMetrics||a.push(new at(f,h,`layer "${h.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new at(f,h,`layer "${h.id}" must specify a "source-layer"`)):a.push(new at(f,h.source,`source "${h.source}" not found`))}else a.push(new at(f,h,'missing required property "source"'));return a=a.concat(pa({key:f,value:h,valueSpec:S.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:h.type,valueSpec:S.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:h,objectKey:"type"}),filter:Yl,layout:I=>pa({layer:h,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":F=>$f(tn({layerType:T},F))}}),paint:I=>pa({layer:h,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":F=>Ah(tn({layerType:T},F))}})}})),a}function vs(c){const a=c.value,h=c.key,f=ar(a);return f!=="string"?[new at(h,a,`string expected, ${f} found`)]:[]}const Wm={promoteId:function({key:c,value:a}){if(ar(a)==="string")return vs({key:c,value:a});{const h=[];for(const f in a)h.push(...vs({key:`${c}.${f}`,value:a[f]}));return h}}};function $m(c){const a=c.value,h=c.key,f=c.styleSpec,y=c.style,S=c.validateSpec;if(!a.type)return[new at(h,a,'"type" is required')];const T=Ur(a.type);let E;switch(T){case"vector":case"raster":return E=pa({key:h,value:a,valueSpec:f[`source_${T.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:Wm,validateSpec:S}),E;case"raster-dem":return E=function(I){var F;const j=(F=I.sourceName)!==null&&F!==void 0?F:"",W=I.value,J=I.styleSpec,ae=J.source_raster_dem,oe=I.style;let pe=[];const xe=ar(W);if(W===void 0)return pe;if(xe!=="object")return pe.push(new at("source_raster_dem",W,`object expected, ${xe} found`)),pe;const Pe=Ur(W.encoding)==="custom",He=["redFactor","greenFactor","blueFactor","baseShift"],De=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const Ne in W)!Pe&&He.includes(Ne)?pe.push(new at(Ne,W[Ne],`In "${j}": "${Ne}" is only valid when "encoding" is set to "custom". ${De} encoding found`)):ae[Ne]?pe=pe.concat(I.validateSpec({key:Ne,value:W[Ne],valueSpec:ae[Ne],validateSpec:I.validateSpec,style:oe,styleSpec:J})):pe.push(new at(Ne,W[Ne],`unknown property "${Ne}"`));return pe}({sourceName:h,value:a,style:c.style,styleSpec:f,validateSpec:S}),E;case"geojson":if(E=pa({key:h,value:a,valueSpec:f.source_geojson,style:y,styleSpec:f,validateSpec:S,objectElementValidators:Wm}),a.cluster)for(const I in a.clusterProperties){const[F,j]=a.clusterProperties[I],W=typeof F=="string"?[F,["accumulated"],["get",I]]:F;E.push(...Zl({key:`${h}.${I}.map`,value:j,validateSpec:S,expressionContext:"cluster-map"})),E.push(...Zl({key:`${h}.${I}.reduce`,value:W,validateSpec:S,expressionContext:"cluster-reduce"}))}return E;case"video":return pa({key:h,value:a,valueSpec:f.source_video,style:y,validateSpec:S,styleSpec:f});case"image":return pa({key:h,value:a,valueSpec:f.source_image,style:y,validateSpec:S,styleSpec:f});case"canvas":return[new at(h,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return $o({key:`${h}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,validateSpec:S,styleSpec:f})}}function qm(c){const a=c.value,h=c.styleSpec,f=h.light,y=c.style;let S=[];const T=ar(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new at("light",a,`object expected, ${T} found`)]),S;for(const E in a){const I=E.match(/^(.*)-transition$/);S=S.concat(I&&f[I[1]]&&f[I[1]].transition?c.validateSpec({key:E,value:a[E],valueSpec:h.transition,validateSpec:c.validateSpec,style:y,styleSpec:h}):f[E]?c.validateSpec({key:E,value:a[E],valueSpec:f[E],validateSpec:c.validateSpec,style:y,styleSpec:h}):[new at(E,a[E],`unknown property "${E}"`)])}return S}function Xm(c){const a=c.value,h=c.styleSpec,f=h.sky,y=c.style,S=ar(a);if(a===void 0)return[];if(S!=="object")return[new at("sky",a,`object expected, ${S} found`)];let T=[];for(const E in a)T=T.concat(f[E]?gi({key:E,value:a[E],valueSpec:f[E],style:y,styleSpec:h}):[new at(E,a[E],`unknown property "${E}"`)]);return T}function Zm(c){const a=c.value,h=c.styleSpec,f=h.terrain,y=c.style;let S=[];const T=ar(a);if(a===void 0)return S;if(T!=="object")return S=S.concat([new at("terrain",a,`object expected, ${T} found`)]),S;for(const E in a)S=S.concat(f[E]?c.validateSpec({key:E,value:a[E],valueSpec:f[E],validateSpec:c.validateSpec,style:y,styleSpec:h}):[new at(E,a[E],`unknown property "${E}"`)]);return S}function hu(c){let a=[];const h=c.value,f=c.key;if(Array.isArray(h)){const y=[],S=[];for(const T in h)h[T].id&&y.includes(h[T].id)&&a.push(new at(f,h,`all the sprites' ids must be unique, but ${h[T].id} is duplicated`)),y.push(h[T].id),h[T].url&&S.includes(h[T].url)&&a.push(new at(f,h,`all the sprites' URLs must be unique, but ${h[T].url} is duplicated`)),S.push(h[T].url),a=a.concat(pa({key:`${f}[${T}]`,value:h[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return vs({key:f,value:h})}const du={"*":()=>[],array:Xl,boolean:function(c){const a=c.value,h=c.key,f=ar(a);return f!=="boolean"?[new at(h,a,`boolean expected, ${f} found`)]:[]},number:Gf,color:function(c){const a=c.key,h=c.value,f=ar(h);return f!=="string"?[new at(a,h,`color expected, ${f} found`)]:Xt.parse(String(h))?[]:[new at(a,h,`color expected, "${h}" found`)]},constants:jm,enum:$o,filter:Yl,function:jf,layer:qf,object:pa,source:$m,light:qm,sky:Xm,terrain:Zm,string:vs,formatted:function(c){return vs(c).length===0?[]:Zl(c)},resolvedImage:function(c){return vs(c).length===0?[]:Zl(c)},padding:function(c){const a=c.key,h=c.value;if(ar(h)==="array"){if(h.length<1||h.length>4)return[new at(a,h,`padding requires 1 to 4 values; ${h.length} values found`)];const f={type:"number"};let y=[];for(let S=0;S<h.length;S++)y=y.concat(c.validateSpec({key:`${a}[${S}]`,value:h[S],validateSpec:c.validateSpec,valueSpec:f}));return y}return Gf({key:a,value:h,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,h=c.value,f=ar(h),y=c.styleSpec;if(f!=="array"||h.length<1||h.length%2!=0)return[new at(a,h,"variableAnchorOffsetCollection requires a non-empty array of even length")];let S=[];for(let T=0;T<h.length;T+=2)S=S.concat($o({key:`${a}[${T}]`,value:h[T],valueSpec:y.layout_symbol["text-anchor"]})),S=S.concat(Xl({key:`${a}[${T+1}]`,value:h[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:y}));return S},sprite:hu};function gi(c){const a=c.value,h=c.valueSpec,f=c.styleSpec;return c.validateSpec=gi,h.expression&&Wl(Ur(a))?jf(c):h.expression&&yr(po(a))?Zl(c):h.type&&du[h.type]?du[h.type](c):pa(tn({},c,{valueSpec:h.type?f[h.type]:h}))}function Kl(c){const a=c.value,h=c.key,f=vs(c);return f.length||(a.indexOf("{fontstack}")===-1&&f.push(new at(h,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&f.push(new at(h,a,'"glyphs" url must include a "{range}" token'))),f}function La(c,a=re){let h=[];return h=h.concat(gi({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:gi,objectElementValidators:{glyphs:Kl,"*":()=>[]}})),c.constants&&(h=h.concat(jm({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:gi}))),Ym(h)}function _s(c){return function(a){return c({...a,validateSpec:gi})}}function Ym(c){return[].concat(c).sort((a,h)=>a.line-h.line)}function Zi(c){return function(...a){return Ym(c.apply(this,a))}}La.source=Zi(_s($m)),La.sprite=Zi(_s(hu)),La.glyphs=Zi(_s(Kl)),La.light=Zi(_s(qm)),La.sky=Zi(_s(Xm)),La.terrain=Zi(_s(Zm)),La.layer=Zi(_s(qf)),La.filter=Zi(_s(Yl)),La.paintProperty=Zi(_s(Ah)),La.layoutProperty=Zi(_s($f));const Jl=La,Xf=Jl.light,Kv=Jl.paintProperty,Zf=Jl.layoutProperty;function Km(c,a){let h=!1;if(a&&a.length)for(const f of a)c.fire(new Yt(new Error(f.message))),h=!0;return h}class Us{constructor(a,h,f){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(h=T[1])+2*(f=T[2]);for(let I=0;I<this.d*this.d;I++){const F=T[3+I],j=T[3+I+1];y.push(F===j?null:T.subarray(F,j))}const E=T[3+y.length+1];this.keys=T.subarray(T[3+y.length],E),this.bboxes=T.subarray(E),this.insert=this._insertReadonly}else{this.d=h+2*f;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=h,this.extent=a,this.padding=f,this.scale=h/a,this.uid=0;const S=f/h*a;this.min=-S,this.max=a+S}insert(a,h,f,y,S){this._forEachCell(h,f,y,S,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(h),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(S)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,h,f,y,S,T){this.cells[S].push(T)}query(a,h,f,y,S){const T=this.min,E=this.max;if(a<=T&&h<=T&&E<=f&&E<=y&&!S)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(a,h,f,y,this._queryCell,I,{},S),I}}_queryCell(a,h,f,y,S,T,E,I){const F=this.cells[S];if(F!==null){const j=this.keys,W=this.bboxes;for(let J=0;J<F.length;J++){const ae=F[J];if(E[ae]===void 0){const oe=4*ae;(I?I(W[oe+0],W[oe+1],W[oe+2],W[oe+3]):a<=W[oe+2]&&h<=W[oe+3]&&f>=W[oe+0]&&y>=W[oe+1])?(E[ae]=!0,T.push(j[ae])):E[ae]=!1}}}}_forEachCell(a,h,f,y,S,T,E,I){const F=this._convertToCellCoord(a),j=this._convertToCellCoord(h),W=this._convertToCellCoord(f),J=this._convertToCellCoord(y);for(let ae=F;ae<=W;ae++)for(let oe=j;oe<=J;oe++){const pe=this.d*oe+ae;if((!I||I(this._convertFromCellCoord(ae),this._convertFromCellCoord(oe),this._convertFromCellCoord(ae+1),this._convertFromCellCoord(oe+1)))&&S.call(this,a,h,f,y,pe,T,E,I))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,h=3+this.cells.length+1+1;let f=0;for(let T=0;T<this.cells.length;T++)f+=this.cells[T].length;const y=new Int32Array(h+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let S=h;for(let T=0;T<a.length;T++){const E=a[T];y[3+T]=S,y.set(E,S),S+=E.length}return y[3+a.length]=S,y.set(this.keys,S),S+=this.keys.length,y[3+a.length+1]=S,y.set(this.bboxes,S),S+=this.bboxes.length,y.buffer}static serialize(a,h){const f=a.toArrayBuffer();return h&&h.push(f),{buffer:f}}static deserialize(a){return new Us(a.buffer)}}const mo={};function en(c,a,h={}){if(mo[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),mo[c]={klass:a,omit:h.omit||[],shallow:h.shallow||[]}}en("Object",Object),en("TransferableGridIndex",Us),en("Color",Xt),en("Error",Error),en("AJAXError",gn),en("ResolvedImage",Pn),en("StylePropertyFunction",Sh),en("StyleExpression",cu,{omit:["_evaluator"]}),en("ZoomDependentExpression",wh),en("ZoomConstantExpression",$l),en("CompoundExpression",ka,{omit:["_evaluate"]});for(const c in Hl)Hl[c]._classRegistryKey||en(`Expression_${c}`,Hl[c]);function Yf(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function qo(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(Yf(c)||ke(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const h=c;return a&&a.push(h.buffer),h}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const h=[];for(const f of c)h.push(qo(f,a));return h}if(typeof c=="object"){const h=c.constructor,f=h._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${h.name}`);if(!mo[f])throw new Error(`${f} is not registered.`);const y=h.serialize?h.serialize(c,a):{};if(h.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const S in c){if(!c.hasOwnProperty(S)||mo[f].omit.indexOf(S)>=0)continue;const T=c[S];y[S]=mo[f].shallow.indexOf(S)>=0?T:qo(T,a)}c instanceof Error&&(y.message=c.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(y.$name=f),y}throw new Error("can't serialize object of type "+typeof c)}function Ql(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||Yf(c)||ke(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Ql);if(typeof c=="object"){const a=c.$name||"Object";if(!mo[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:h}=mo[a];if(!h)throw new Error(`can't deserialize unregistered class ${a}`);if(h.deserialize)return h.deserialize(c);const f=Object.create(h.prototype);for(const y of Object.keys(c)){if(y==="$name")continue;const S=c[y];f[y]=mo[a].shallow.indexOf(y)>=0?S:Ql(S)}return f}throw new Error("can't deserialize object of type "+typeof c)}class Kf{constructor(){this.first=!0}update(a,h){const f=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=h):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=h),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=f,!0))}}const $t={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function fu(c){for(const a of c)if(Ph(a.charCodeAt(0)))return!0;return!1}function Ch(c){for(const a of c)if(!Jm(a.charCodeAt(0)))return!1;return!0}function Jm(c){return!($t.Arabic(c)||$t["Arabic Supplement"](c)||$t["Arabic Extended-A"](c)||$t["Arabic Presentation Forms-A"](c)||$t["Arabic Presentation Forms-B"](c))}function Ph(c){return!(c!==746&&c!==747&&(c<4352||!($t["Bopomofo Extended"](c)||$t.Bopomofo(c)||$t["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||$t["CJK Compatibility Ideographs"](c)||$t["CJK Compatibility"](c)||$t["CJK Radicals Supplement"](c)||$t["CJK Strokes"](c)||!(!$t["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||$t["CJK Unified Ideographs Extension A"](c)||$t["CJK Unified Ideographs"](c)||$t["Enclosed CJK Letters and Months"](c)||$t["Hangul Compatibility Jamo"](c)||$t["Hangul Jamo Extended-A"](c)||$t["Hangul Jamo Extended-B"](c)||$t["Hangul Jamo"](c)||$t["Hangul Syllables"](c)||$t.Hiragana(c)||$t["Ideographic Description Characters"](c)||$t.Kanbun(c)||$t["Kangxi Radicals"](c)||$t["Katakana Phonetic Extensions"](c)||$t.Katakana(c)&&c!==12540||!(!$t["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!$t["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||$t["Unified Canadian Aboriginal Syllabics"](c)||$t["Unified Canadian Aboriginal Syllabics Extended"](c)||$t["Vertical Forms"](c)||$t["Yijing Hexagram Symbols"](c)||$t["Yi Syllables"](c)||$t["Yi Radicals"](c))))}function Jf(c){return!(Ph(c)||function(a){return!!($t["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||$t["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||$t["Letterlike Symbols"](a)||$t["Number Forms"](a)||$t["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||$t["Control Pictures"](a)&&a!==9251||$t["Optical Character Recognition"](a)||$t["Enclosed Alphanumerics"](a)||$t["Geometric Shapes"](a)||$t["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||$t["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||$t["CJK Symbols and Punctuation"](a)||$t.Katakana(a)||$t["Private Use Area"](a)||$t["CJK Compatibility Forms"](a)||$t["Small Form Variants"](a)||$t["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function Qf(c){return c>=1424&&c<=2303||$t["Arabic Presentation Forms-A"](c)||$t["Arabic Presentation Forms-B"](c)}function e0(c,a){return!(!a&&Qf(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||$t.Khmer(c))}function Qm(c){for(const a of c)if(Qf(a.charCodeAt(0)))return!0;return!1}const Xo=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class br{constructor(a,h){this.zoom=a,h?(this.now=h.now,this.fadeDuration=h.fadeDuration,this.zoomHistory=h.zoomHistory,this.transition=h.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Kf,this.transition={})}isSupportedScript(a){return function(h,f){for(const y of h)if(!e0(y.charCodeAt(0),f))return!1;return!0}(a,Xo.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,h=a-Math.floor(a),f=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:h+(1-h)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*h}}}class Rh{constructor(a,h){this.property=a,this.value=h,this.expression=function(f,y){if(Wl(f))return new Sh(f,y);if(yr(f)){const S=Bm(f,y);if(S.result==="error")throw new Error(S.value.map(T=>`${T.key}: ${T.message}`).join(", "));return S.value}{let S=f;return y.type==="color"&&typeof f=="string"?S=Xt.parse(f):y.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(S=Wn.parse(f)):S=cr.parse(f),{kind:"constant",evaluate:()=>S}}}(h===void 0?a.specification.default:h,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,h,f){return this.property.possiblyEvaluate(this,a,h,f)}}class Ih{constructor(a){this.property=a,this.value=new Rh(a,void 0)}transitioned(a,h){return new n0(this.property,this.value,h,ee({},a.transition,this.transition),a.now)}untransitioned(){return new n0(this.property,this.value,null,{},0)}}class t0{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return Ee(this._values[a].value.value)}setValue(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Ih(this._values[a].property)),this._values[a].value=new Rh(this._values[a].property,h===null?void 0:Ee(h))}getTransition(a){return Ee(this._values[a].transition)}setTransition(a,h){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new Ih(this._values[a].property)),this._values[a].transition=Ee(h)||void 0}serialize(){const a={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(a[h]=f);const y=this.getTransition(h);y!==void 0&&(a[`${h}-transition`]=y)}return a}transitioned(a,h){const f=new eg(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].transitioned(a,h._values[y]);return f}untransitioned(){const a=new eg(this._properties);for(const h of Object.keys(this._values))a._values[h]=this._values[h].untransitioned();return a}}class n0{constructor(a,h,f,y,S){this.property=a,this.value=h,this.begin=S+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=f)}possiblyEvaluate(a,h,f){const y=a.now||0,S=this.value.possiblyEvaluate(a,h,f),T=this.prior;if(T){if(y>this.end)return this.prior=null,S;if(this.value.isDataDriven())return this.prior=null,S;if(y<this.begin)return T.possiblyEvaluate(a,h,f);{const E=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,h,f),S,function(I){if(I<=0)return 0;if(I>=1)return 1;const F=I*I,j=F*I;return 4*(I<.5?j:3*(I-F)+j-.75)}(E))}}return S}}class eg{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,h,f){const y=new pu(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,h,f);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Jv{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return Ee(this._values[a].value)}setValue(a,h){this._values[a]=new Rh(this._values[a].property,h===null?void 0:Ee(h))}serialize(){const a={};for(const h of Object.keys(this._values)){const f=this.getValue(h);f!==void 0&&(a[h]=f)}return a}possiblyEvaluate(a,h,f){const y=new pu(this._properties);for(const S of Object.keys(this._values))y._values[S]=this._values[S].possiblyEvaluate(a,h,f);return y}}class Xa{constructor(a,h,f){this.property=a,this.value=h,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,h,f,y){return this.property.evaluate(this.value,this.parameters,a,h,f,y)}}class pu{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class pn{constructor(a){this.specification=a}possiblyEvaluate(a,h){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(h)}interpolate(a,h,f){const y=fa[this.specification.type];return y?y(a,h,f):a}}class Mn{constructor(a,h){this.specification=a,this.overrides=h}possiblyEvaluate(a,h,f,y){return new Xa(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(h,null,{},f,y)}:a.expression,h)}interpolate(a,h,f){if(a.value.kind!=="constant"||h.value.kind!=="constant")return a;if(a.value.value===void 0||h.value.value===void 0)return new Xa(this,{kind:"constant",value:void 0},a.parameters);const y=fa[this.specification.type];if(y){const S=y(a.value.value,h.value.value,f);return new Xa(this,{kind:"constant",value:S},a.parameters)}return a}evaluate(a,h,f,y,S,T){return a.kind==="constant"?a.value:a.evaluate(h,f,y,S,T)}}class Zo extends Mn{possiblyEvaluate(a,h,f,y){if(a.value===void 0)return new Xa(this,{kind:"constant",value:void 0},h);if(a.expression.kind==="constant"){const S=a.expression.evaluate(h,null,{},f,y),T=a.property.specification.type==="resolvedImage"&&typeof S!="string"?S.name:S,E=this._calculate(T,T,T,h);return new Xa(this,{kind:"constant",value:E},h)}if(a.expression.kind==="camera"){const S=this._calculate(a.expression.evaluate({zoom:h.zoom-1}),a.expression.evaluate({zoom:h.zoom}),a.expression.evaluate({zoom:h.zoom+1}),h);return new Xa(this,{kind:"constant",value:S},h)}return new Xa(this,a.expression,h)}evaluate(a,h,f,y,S,T){if(a.kind==="source"){const E=a.evaluate(h,f,y,S,T);return this._calculate(E,E,E,h)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(h.zoom)-1},f,y),a.evaluate({zoom:Math.floor(h.zoom)},f,y),a.evaluate({zoom:Math.floor(h.zoom)+1},f,y),h):a.value}_calculate(a,h,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:f,to:h}}interpolate(a){return a}}class r0{constructor(a){this.specification=a}possiblyEvaluate(a,h,f,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const S=a.expression.evaluate(h,null,{},f,y);return this._calculate(S,S,S,h)}return this._calculate(a.expression.evaluate(new br(Math.floor(h.zoom-1),h)),a.expression.evaluate(new br(Math.floor(h.zoom),h)),a.expression.evaluate(new br(Math.floor(h.zoom+1),h)),h)}}_calculate(a,h,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:h}:{from:f,to:h}}interpolate(a){return a}}class mu{constructor(a){this.specification=a}possiblyEvaluate(a,h,f,y){return!!a.expression.evaluate(h,null,{},f,y)}interpolate(){return!1}}class Yi{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const h in a){const f=a[h];f.specification.overridable&&this.overridableProperties.push(h);const y=this.defaultPropertyValues[h]=new Rh(f,void 0),S=this.defaultTransitionablePropertyValues[h]=new Ih(f);this.defaultTransitioningPropertyValues[h]=S.untransitioned(),this.defaultPossiblyEvaluatedValues[h]=y.possiblyEvaluate({})}}}en("DataDrivenProperty",Mn),en("DataConstantProperty",pn),en("CrossFadedDataDrivenProperty",Zo),en("CrossFadedProperty",r0),en("ColorRampProperty",mu);const tg="-transition";class Za extends Gn{constructor(a,h){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),h.layout&&(this._unevaluatedLayout=new Jv(h.layout)),h.paint)){this._transitionablePaint=new t0(h.paint);for(const f in a.paint)this.setPaintProperty(f,a.paint[f],{validate:!1});for(const f in a.layout)this.setLayoutProperty(f,a.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new pu(h.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,h,f={}){h!=null&&this._validate(Zf,`layers.${this.id}.layout.${a}`,a,h,f)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,h):this.visibility=h)}getPaintProperty(a){return a.endsWith(tg)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,h,f={}){if(h!=null&&this._validate(Kv,`layers.${this.id}.paint.${a}`,a,h,f))return!1;if(a.endsWith(tg))return this._transitionablePaint.setTransition(a.slice(0,-11),h||void 0),!1;{const y=this._transitionablePaint._values[a],S=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),E=y.value;this._transitionablePaint.setValue(a,h),this._handleSpecialPaintPropertyUpdate(a);const I=this._transitionablePaint._values[a].value;return I.isDataDriven()||T||S||this._handleOverridablePaintPropertyUpdate(a,E,I)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,h,f){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,h){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,h)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,h)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),Q(a,(h,f)=>!(h===void 0||f==="layout"&&!Object.keys(h).length||f==="paint"&&!Object.keys(h).length))}_validate(a,h,f,y,S={}){return(!S||S.validate!==!1)&&Km(this,a.call(Jl,{key:h,layerType:this.type,objectKey:f,value:y,styleSpec:re,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const h=this.paint.get(a);if(h instanceof Xa&&jl(h.property.specification)&&(h.value.kind==="source"||h.value.kind==="composite")&&h.value.isStateDependent)return!0}return!1}}const ng={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ec{constructor(a,h){this._structArray=a,this._pos1=h*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zr{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,h){return a._trim(),h&&(a.isTransferred=!0,h.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const h=Object.create(this.prototype);return h.arrayBuffer=a.arrayBuffer,h.length=a.length,h.capacity=a.arrayBuffer.byteLength/h.bytesPerElement,h._refreshViews(),h}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const h=this.uint8;this._refreshViews(),h&&this.uint8.set(h)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wr(c,a=1){let h=0,f=0;return{members:c.map(y=>{const S=ng[y.type].BYTES_PER_ELEMENT,T=h=rg(h,Math.max(a,S)),E=y.components||1;return f=Math.max(f,S),h+=S*E,{name:y.name,type:y.type,components:E,offset:T}}),size:rg(h,Math.max(f,a)),alignment:a}}function rg(c,a){return Math.ceil(c/a)*a}class gu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h){const f=this.length;return this.resize(f+1),this.emplace(f,a,h)}emplace(a,h,f){const y=2*a;return this.int16[y+0]=h,this.int16[y+1]=f,a}}gu.prototype.bytesPerElement=4,en("StructArrayLayout2i4",gu);class Dh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,h,f)}emplace(a,h,f,y){const S=3*a;return this.int16[S+0]=h,this.int16[S+1]=f,this.int16[S+2]=y,a}}Dh.prototype.bytesPerElement=6,en("StructArrayLayout3i6",Dh);class go extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,h,f,y)}emplace(a,h,f,y,S){const T=4*a;return this.int16[T+0]=h,this.int16[T+1]=f,this.int16[T+2]=y,this.int16[T+3]=S,a}}go.prototype.bytesPerElement=8,en("StructArrayLayout4i8",go);class i0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,h,f,y,S,T)}emplace(a,h,f,y,S,T,E){const I=6*a;return this.int16[I+0]=h,this.int16[I+1]=f,this.int16[I+2]=y,this.int16[I+3]=S,this.int16[I+4]=T,this.int16[I+5]=E,a}}i0.prototype.bytesPerElement=12,en("StructArrayLayout2i4i12",i0);class a0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,h,f,y,S,T)}emplace(a,h,f,y,S,T,E){const I=4*a,F=8*a;return this.int16[I+0]=h,this.int16[I+1]=f,this.uint8[F+4]=y,this.uint8[F+5]=S,this.uint8[F+6]=T,this.uint8[F+7]=E,a}}a0.prototype.bytesPerElement=8,en("StructArrayLayout2i4ub8",a0);class yu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h){const f=this.length;return this.resize(f+1),this.emplace(f,a,h)}emplace(a,h,f){const y=2*a;return this.float32[y+0]=h,this.float32[y+1]=f,a}}yu.prototype.bytesPerElement=8,en("StructArrayLayout2f8",yu);class s0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T,E,I,F,j){const W=this.length;return this.resize(W+1),this.emplace(W,a,h,f,y,S,T,E,I,F,j)}emplace(a,h,f,y,S,T,E,I,F,j,W){const J=10*a;return this.uint16[J+0]=h,this.uint16[J+1]=f,this.uint16[J+2]=y,this.uint16[J+3]=S,this.uint16[J+4]=T,this.uint16[J+5]=E,this.uint16[J+6]=I,this.uint16[J+7]=F,this.uint16[J+8]=j,this.uint16[J+9]=W,a}}s0.prototype.bytesPerElement=20,en("StructArrayLayout10ui20",s0);class kh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T,E,I,F,j,W,J){const ae=this.length;return this.resize(ae+1),this.emplace(ae,a,h,f,y,S,T,E,I,F,j,W,J)}emplace(a,h,f,y,S,T,E,I,F,j,W,J,ae){const oe=12*a;return this.int16[oe+0]=h,this.int16[oe+1]=f,this.int16[oe+2]=y,this.int16[oe+3]=S,this.uint16[oe+4]=T,this.uint16[oe+5]=E,this.uint16[oe+6]=I,this.uint16[oe+7]=F,this.int16[oe+8]=j,this.int16[oe+9]=W,this.int16[oe+10]=J,this.int16[oe+11]=ae,a}}kh.prototype.bytesPerElement=24,en("StructArrayLayout4i4ui4i24",kh);class o0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,h,f)}emplace(a,h,f,y){const S=3*a;return this.float32[S+0]=h,this.float32[S+1]=f,this.float32[S+2]=y,a}}o0.prototype.bytesPerElement=12,en("StructArrayLayout3f12",o0);class l0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint32[1*a+0]=h,a}}l0.prototype.bytesPerElement=4,en("StructArrayLayout1ul4",l0);class Vs extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T,E,I,F){const j=this.length;return this.resize(j+1),this.emplace(j,a,h,f,y,S,T,E,I,F)}emplace(a,h,f,y,S,T,E,I,F,j){const W=10*a,J=5*a;return this.int16[W+0]=h,this.int16[W+1]=f,this.int16[W+2]=y,this.int16[W+3]=S,this.int16[W+4]=T,this.int16[W+5]=E,this.uint32[J+3]=I,this.uint16[W+8]=F,this.uint16[W+9]=j,a}}Vs.prototype.bytesPerElement=20,en("StructArrayLayout6i1ul2ui20",Vs);class Lh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,h,f,y,S,T)}emplace(a,h,f,y,S,T,E){const I=6*a;return this.int16[I+0]=h,this.int16[I+1]=f,this.int16[I+2]=y,this.int16[I+3]=S,this.int16[I+4]=T,this.int16[I+5]=E,a}}Lh.prototype.bytesPerElement=12,en("StructArrayLayout2i2i2i12",Lh);class vu extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S){const T=this.length;return this.resize(T+1),this.emplace(T,a,h,f,y,S)}emplace(a,h,f,y,S,T){const E=4*a,I=8*a;return this.float32[E+0]=h,this.float32[E+1]=f,this.float32[E+2]=y,this.int16[I+6]=S,this.int16[I+7]=T,a}}vu.prototype.bytesPerElement=16,en("StructArrayLayout2f1f2i16",vu);class zh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,h,f,y)}emplace(a,h,f,y,S){const T=12*a,E=3*a;return this.uint8[T+0]=h,this.uint8[T+1]=f,this.float32[E+1]=y,this.float32[E+2]=S,a}}zh.prototype.bytesPerElement=12,en("StructArrayLayout2ub2f12",zh);class tc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,h,f)}emplace(a,h,f,y){const S=3*a;return this.uint16[S+0]=h,this.uint16[S+1]=f,this.uint16[S+2]=y,a}}tc.prototype.bytesPerElement=6,en("StructArrayLayout3ui6",tc);class c0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe){const He=this.length;return this.resize(He+1),this.emplace(He,a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe)}emplace(a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe,He){const De=24*a,Ne=12*a,ht=48*a;return this.int16[De+0]=h,this.int16[De+1]=f,this.uint16[De+2]=y,this.uint16[De+3]=S,this.uint32[Ne+2]=T,this.uint32[Ne+3]=E,this.uint32[Ne+4]=I,this.uint16[De+10]=F,this.uint16[De+11]=j,this.uint16[De+12]=W,this.float32[Ne+7]=J,this.float32[Ne+8]=ae,this.uint8[ht+36]=oe,this.uint8[ht+37]=pe,this.uint8[ht+38]=xe,this.uint32[Ne+10]=Pe,this.int16[De+22]=He,a}}c0.prototype.bytesPerElement=48,en("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",c0);class nc extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe,He,De,Ne,ht,gt,Wt,un,Gt,Vt,Rt,sn){const Bt=this.length;return this.resize(Bt+1),this.emplace(Bt,a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe,He,De,Ne,ht,gt,Wt,un,Gt,Vt,Rt,sn)}emplace(a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe,xe,Pe,He,De,Ne,ht,gt,Wt,un,Gt,Vt,Rt,sn,Bt){const Tt=32*a,vn=16*a;return this.int16[Tt+0]=h,this.int16[Tt+1]=f,this.int16[Tt+2]=y,this.int16[Tt+3]=S,this.int16[Tt+4]=T,this.int16[Tt+5]=E,this.int16[Tt+6]=I,this.int16[Tt+7]=F,this.uint16[Tt+8]=j,this.uint16[Tt+9]=W,this.uint16[Tt+10]=J,this.uint16[Tt+11]=ae,this.uint16[Tt+12]=oe,this.uint16[Tt+13]=pe,this.uint16[Tt+14]=xe,this.uint16[Tt+15]=Pe,this.uint16[Tt+16]=He,this.uint16[Tt+17]=De,this.uint16[Tt+18]=Ne,this.uint16[Tt+19]=ht,this.uint16[Tt+20]=gt,this.uint16[Tt+21]=Wt,this.uint16[Tt+22]=un,this.uint32[vn+12]=Gt,this.float32[vn+13]=Vt,this.float32[vn+14]=Rt,this.uint16[Tt+30]=sn,this.uint16[Tt+31]=Bt,a}}nc.prototype.bytesPerElement=64,en("StructArrayLayout8i15ui1ul2f2ui64",nc);class yo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.float32[1*a+0]=h,a}}yo.prototype.bytesPerElement=4,en("StructArrayLayout1f4",yo);class u0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,h,f)}emplace(a,h,f,y){const S=3*a;return this.uint16[6*a+0]=h,this.float32[S+1]=f,this.float32[S+2]=y,a}}u0.prototype.bytesPerElement=12,en("StructArrayLayout1ui2f12",u0);class Fh extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,h,f)}emplace(a,h,f,y){const S=4*a;return this.uint32[2*a+0]=h,this.uint16[S+2]=f,this.uint16[S+3]=y,a}}Fh.prototype.bytesPerElement=8,en("StructArrayLayout1ul2ui8",Fh);class Yo extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,h){const f=this.length;return this.resize(f+1),this.emplace(f,a,h)}emplace(a,h,f){const y=2*a;return this.uint16[y+0]=h,this.uint16[y+1]=f,a}}Yo.prototype.bytesPerElement=4,en("StructArrayLayout2ui4",Yo);class h0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const h=this.length;return this.resize(h+1),this.emplace(h,a)}emplace(a,h){return this.uint16[1*a+0]=h,a}}h0.prototype.bytesPerElement=2,en("StructArrayLayout1ui2",h0);class d0 extends zr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,h,f,y){const S=this.length;return this.resize(S+1),this.emplace(S,a,h,f,y)}emplace(a,h,f,y,S){const T=4*a;return this.float32[T+0]=h,this.float32[T+1]=f,this.float32[T+2]=y,this.float32[T+3]=S,a}}d0.prototype.bytesPerElement=16,en("StructArrayLayout4f16",d0);class f0 extends ec{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}f0.prototype.size=20;class ig extends Vs{get(a){return new f0(this,a)}}en("CollisionBoxArray",ig);class _ extends ec{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class s extends c0{get(a){return new _(this,a)}}en("PlacedSymbolArray",s);class d extends ec{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class m extends nc{get(a){return new d(this,a)}}en("SymbolInstanceArray",m);class g extends yo{getoffsetX(a){return this.float32[1*a+0]}}en("GlyphOffsetArray",g);class b extends Dh{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}en("SymbolLineVertexArray",b);class P extends ec{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}P.prototype.size=12;class R extends u0{get(a){return new P(this,a)}}en("TextAnchorOffsetArray",R);class L extends ec{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}L.prototype.size=8;class H extends Fh{get(a){return new L(this,a)}}en("FeatureIndexArray",H);class q extends gu{}class Y extends gu{}class se extends gu{}class _e extends i0{}class ve extends a0{}class we extends yu{}class fe extends s0{}class ze extends kh{}class qe extends o0{}class Me extends l0{}class Oe extends Lh{}class Ke extends zh{}class Qe extends tc{}class ot extends Yo{}const bt=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:vt}=bt;class xt{constructor(a=[]){this.segments=a}prepareSegment(a,h,f,y){let S=this.segments[this.segments.length-1];return a>xt.MAX_VERTEX_ARRAY_LENGTH&&Ae(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!S||S.vertexLength+a>xt.MAX_VERTEX_ARRAY_LENGTH||S.sortKey!==y)&&(S={vertexOffset:h.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},y!==void 0&&(S.sortKey=y),this.segments.push(S)),S}get(){return this.segments}destroy(){for(const a of this.segments)for(const h in a.vaos)a.vaos[h].destroy()}static simpleSegment(a,h,f,y){return new xt([{vertexOffset:a,primitiveOffset:h,vertexLength:f,primitiveLength:y,vaos:{},sortKey:0}])}}function Zt(c,a){return 256*(c=ue(Math.floor(c),0,255))+ue(Math.floor(a),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,en("SegmentVector",xt);const zn=Wr([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Ot={exports:{}},Tn={exports:{}};Tn.exports=function(c,a){var h,f,y,S,T,E,I,F;for(f=c.length-(h=3&c.length),y=a,T=3432918353,E=461845907,F=0;F<f;)I=255&c.charCodeAt(F)|(255&c.charCodeAt(++F))<<8|(255&c.charCodeAt(++F))<<16|(255&c.charCodeAt(++F))<<24,++F,y=27492+(65535&(S=5*(65535&(y=(y^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(I=0,h){case 3:I^=(255&c.charCodeAt(F+2))<<16;case 2:I^=(255&c.charCodeAt(F+1))<<8;case 1:y^=I=(65535&(I=(I=(65535&(I^=255&c.charCodeAt(F)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295}return y^=c.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var Nn=Tn.exports,Xn={exports:{}};Xn.exports=function(c,a){for(var h,f=c.length,y=a^f,S=0;f>=4;)h=1540483477*(65535&(h=255&c.charCodeAt(S)|(255&c.charCodeAt(++S))<<8|(255&c.charCodeAt(++S))<<16|(255&c.charCodeAt(++S))<<24))+((1540483477*(h>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),f-=4,++S;switch(f){case 3:y^=(255&c.charCodeAt(S+2))<<16;case 2:y^=(255&c.charCodeAt(S+1))<<8;case 1:y=1540483477*(65535&(y^=255&c.charCodeAt(S)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Rn=Nn,Vn=Xn.exports;Ot.exports=Rn,Ot.exports.murmur3=Rn,Ot.exports.murmur2=Vn;var Hn=p(Ot.exports);class Ir{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,h,f,y){this.ids.push(mr(a)),this.positions.push(h,f,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const h=mr(a);let f=0,y=this.ids.length-1;for(;f<y;){const T=f+y>>1;this.ids[T]>=h?y=T:f=T+1}const S=[];for(;this.ids[f]===h;)S.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return S}static serialize(a,h){const f=new Float64Array(a.ids),y=new Uint32Array(a.positions);return Ki(f,y,0,f.length-1),h&&h.push(f.buffer,y.buffer),{ids:f,positions:y}}static deserialize(a){const h=new Ir;return h.ids=a.ids,h.positions=a.positions,h.indexed=!0,h}}function mr(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Hn(String(c))}function Ki(c,a,h,f){for(;h<f;){const y=c[h+f>>1];let S=h-1,T=f+1;for(;;){do S++;while(c[S]<y);do T--;while(c[T]>y);if(S>=T)break;Qr(c,S,T),Qr(a,3*S,3*T),Qr(a,3*S+1,3*T+1),Qr(a,3*S+2,3*T+2)}T-h<f-T?(Ki(c,a,h,T),h=T+1):(Ki(c,a,T+1,f),f=T)}}function Qr(c,a,h){const f=c[a];c[a]=c[h],c[h]=f}en("FeaturePositionMap",Ir);class vr{constructor(a,h){this.gl=a.gl,this.location=h}}class Pi extends vr{constructor(a,h){super(a,h),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ya extends vr{constructor(a,h){super(a,h),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class xs extends vr{constructor(a,h){super(a,h),this.current=Xt.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Ko=new Float32Array(16);function Jo(c){return[Zt(255*c.r,255*c.g),Zt(255*c.b,255*c.a)]}class bs{constructor(a,h,f){this.value=a,this.uniformNames=h.map(y=>`u_${y}`),this.type=f}setUniform(a,h,f){a.set(f.constantOr(this.value))}getBinding(a,h,f){return this.type==="color"?new xs(a,h):new Pi(a,h)}}class Ka{constructor(a,h){this.uniformNames=h.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,h){this.pixelRatioFrom=h.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=h.tlbr,this.patternTo=a.tlbr}setUniform(a,h,f,y){const S=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;S&&a.set(S)}getBinding(a,h,f){return f.substr(0,9)==="u_pattern"?new Ya(a,h):new Pi(a,h)}}class Fr{constructor(a,h,f,y){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=h.map(S=>({name:`a_${S}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(a,h,f,y,S){const T=this.paintVertexArray.length,E=this.expression.evaluate(new br(0),h,{},y,[],S);this.paintVertexArray.resize(a),this._setPaintValue(T,a,E)}updatePaintArray(a,h,f,y){const S=this.expression.evaluate({zoom:0},f,y);this._setPaintValue(a,h,S)}_setPaintValue(a,h,f){if(this.type==="color"){const y=Jo(f);for(let S=a;S<h;S++)this.paintVertexArray.emplace(S,y[0],y[1])}else{for(let y=a;y<h;y++)this.paintVertexArray.emplace(y,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wr{constructor(a,h,f,y,S,T){this.expression=a,this.uniformNames=h.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=y,this.zoom=S,this.maxValue=0,this.paintVertexAttributes=h.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(a,h,f,y,S){const T=this.expression.evaluate(new br(this.zoom),h,{},y,[],S),E=this.expression.evaluate(new br(this.zoom+1),h,{},y,[],S),I=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(I,a,T,E)}updatePaintArray(a,h,f,y){const S=this.expression.evaluate({zoom:this.zoom},f,y),T=this.expression.evaluate({zoom:this.zoom+1},f,y);this._setPaintValue(a,h,S,T)}_setPaintValue(a,h,f,y){if(this.type==="color"){const S=Jo(f),T=Jo(y);for(let E=a;E<h;E++)this.paintVertexArray.emplace(E,S[0],S[1],T[0],T[1])}else{for(let S=a;S<h;S++)this.paintVertexArray.emplace(S,f,y);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,h){const f=this.useIntegerZoom?Math.floor(h.zoom):h.zoom,y=ue(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,h,f){return new Pi(a,h)}}class Vr{constructor(a,h,f,y,S,T){this.expression=a,this.type=h,this.useIntegerZoom=f,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new S,this.zoomOutPaintVertexArray=new S}populatePaintArray(a,h,f){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,h.patterns&&h.patterns[this.layerId],f)}updatePaintArray(a,h,f,y,S){this._setPaintValues(a,h,f.patterns&&f.patterns[this.layerId],S)}_setPaintValues(a,h,f,y){if(!y||!f)return;const{min:S,mid:T,max:E}=f,I=y[S],F=y[T],j=y[E];if(I&&F&&j)for(let W=a;W<h;W++)this.zoomInPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],F.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,F.tl[0],F.tl[1],F.br[0],F.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],F.pixelRatio,j.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,zn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,zn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class rc{constructor(a,h,f){this.binders={},this._buffers=[];const y=[];for(const S in a.paint._values){if(!f(S))continue;const T=a.paint.get(S);if(!(T instanceof Xa&&jl(T.property.specification)))continue;const E=yi(S,a.type),I=T.value,F=T.property.specification.type,j=T.property.useIntegerZoom,W=T.property.specification["property-type"],J=W==="cross-faded"||W==="cross-faded-data-driven";if(I.kind==="constant")this.binders[S]=J?new Ka(I.value,E):new bs(I.value,E,F),y.push(`/u_${S}`);else if(I.kind==="source"||J){const ae=ma(S,F,"source");this.binders[S]=J?new Vr(I,F,j,h,ae,a.id):new Fr(I,E,F,ae),y.push(`/a_${S}`)}else{const ae=ma(S,F,"composite");this.binders[S]=new wr(I,E,F,j,h,ae),y.push(`/z_${S}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const h=this.binders[a];return h instanceof Fr||h instanceof wr?h.maxValue:0}populatePaintArrays(a,h,f,y,S){for(const T in this.binders){const E=this.binders[T];(E instanceof Fr||E instanceof wr||E instanceof Vr)&&E.populatePaintArray(a,h,f,y,S)}}setConstantPatternPositions(a,h){for(const f in this.binders){const y=this.binders[f];y instanceof Ka&&y.setConstantPatternPositions(a,h)}}updatePaintArrays(a,h,f,y,S){let T=!1;for(const E in a){const I=h.getPositions(E);for(const F of I){const j=f.feature(F.index);for(const W in this.binders){const J=this.binders[W];if((J instanceof Fr||J instanceof wr||J instanceof Vr)&&J.expression.isStateDependent===!0){const ae=y.paint.get(W);J.expression=ae.value,J.updatePaintArray(F.start,F.end,j,a[E],S),T=!0}}}}return T}defines(){const a=[];for(const h in this.binders){const f=this.binders[h];(f instanceof bs||f instanceof Ka)&&a.push(...f.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return a}getBinderAttributes(){const a=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof Fr||f instanceof wr)for(let y=0;y<f.paintVertexAttributes.length;y++)a.push(f.paintVertexAttributes[y].name);else if(f instanceof Vr)for(let y=0;y<zn.members.length;y++)a.push(zn.members[y].name)}return a}getBinderUniforms(){const a=[];for(const h in this.binders){const f=this.binders[h];if(f instanceof bs||f instanceof Ka||f instanceof wr)for(const y of f.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,h){const f=[];for(const y in this.binders){const S=this.binders[y];if(S instanceof bs||S instanceof Ka||S instanceof wr){for(const T of S.uniformNames)if(h[T]){const E=S.getBinding(a,h[T],T);f.push({name:T,property:y,binding:E})}}}return f}setUniforms(a,h,f,y){for(const{name:S,property:T,binding:E}of h)this.binders[T].setUniform(E,y,f.get(T),S)}updatePaintBuffers(a){this._buffers=[];for(const h in this.binders){const f=this.binders[h];if(a&&f instanceof Vr){const y=a.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(f instanceof Fr||f instanceof wr)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(a){for(const h in this.binders){const f=this.binders[h];(f instanceof Fr||f instanceof wr||f instanceof Vr)&&f.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const h=this.binders[a];(h instanceof Fr||h instanceof wr||h instanceof Vr)&&h.destroy()}}}class Ar{constructor(a,h,f=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new rc(y,h,f);this.needsUpload=!1,this._featureMap=new Ir,this._bufferOffset=0}populatePaintArrays(a,h,f,y,S,T){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,h,y,S,T);h.id!==void 0&&this._featureMap.add(h.id,f,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,h,f,y){for(const S of f)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(a,this._featureMap,h,S,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const h in this.programConfigurations)this.programConfigurations[h].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function yi(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function ma(c,a,h){const f={color:{source:yu,composite:d0},number:{source:yo,composite:yu}},y=function(S){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[S]}(c);return y&&y[h]||f[a][h]}en("ConstantBinder",bs),en("CrossFadedConstantBinder",Ka),en("SourceExpressionBinder",Fr),en("CrossFadedCompositeBinder",Vr),en("CompositeExpressionBinder",wr),en("ProgramConfiguration",rc,{omit:["_buffers"]}),en("ProgramConfigurationSet",Ar);const $n=8192,p0=Math.pow(2,14)-1,ag=-p0-1;function Qo(c){const a=$n/c.extent,h=c.loadGeometry();for(let f=0;f<h.length;f++){const y=h[f];for(let S=0;S<y.length;S++){const T=y[S],E=Math.round(T.x*a),I=Math.round(T.y*a);T.x=ue(E,ag,p0),T.y=ue(I,ag,p0),(E<T.x||E>T.x+1||I<T.y||I>T.y+1)&&Ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return h}function el(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Qo(c):[]}}function Nh(c,a,h,f,y){c.emplaceBack(2*a+(f+1)/2,2*h+(y+1)/2)}class m0{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Y,this.indexArray=new Qe,this.segments=new xt,this.programConfigurations=new Ar(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,f){const y=this.layers[0],S=[];let T=null,E=!1;y.type==="circle"&&(T=y.layout.get("circle-sort-key"),E=!T.isConstant());for(const{feature:I,id:F,index:j,sourceLayerIndex:W}of a){const J=this.layers[0]._featureFilter.needGeometry,ae=el(I,J);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),ae,f))continue;const oe=E?T.evaluate(ae,{},f):void 0,pe={id:F,properties:I.properties,type:I.type,sourceLayerIndex:W,index:j,geometry:J?ae.geometry:Qo(I),patterns:{},sortKey:oe};S.push(pe)}E&&S.sort((I,F)=>I.sortKey-F.sortKey);for(const I of S){const{geometry:F,index:j,sourceLayerIndex:W}=I,J=a[j].feature;this.addFeature(I,F,j,f),h.featureIndex.insert(J,F,j,W,this.index)}}update(a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,vt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,h,f,y){for(const S of h)for(const T of S){const E=T.x,I=T.y;if(E<0||E>=$n||I<0||I>=$n)continue;const F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),j=F.vertexLength;Nh(this.layoutVertexArray,E,I,-1,-1),Nh(this.layoutVertexArray,E,I,1,-1),Nh(this.layoutVertexArray,E,I,1,1),Nh(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),F.vertexLength+=4,F.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},y)}}function tl(c,a){for(let h=0;h<c.length;h++)if(Oh(a,c[h]))return!0;for(let h=0;h<a.length;h++)if(Oh(c,a[h]))return!0;return!!_u(c,a)}function sg(c,a,h){return!!Oh(c,a)||!!xu(a,c,h)}function g0(c,a){if(c.length===1)return G4(a,c[0]);for(let h=0;h<a.length;h++){const f=a[h];for(let y=0;y<f.length;y++)if(Oh(c,f[y]))return!0}for(let h=0;h<c.length;h++)if(G4(a,c[h]))return!0;for(let h=0;h<a.length;h++)if(_u(c,a[h]))return!0;return!1}function og(c,a,h){if(c.length>1){if(_u(c,a))return!0;for(let f=0;f<a.length;f++)if(xu(a[f],c,h))return!0}for(let f=0;f<c.length;f++)if(xu(c[f],a,h))return!0;return!1}function _u(c,a){if(c.length===0||a.length===0)return!1;for(let h=0;h<c.length-1;h++){const f=c[h],y=c[h+1];for(let S=0;S<a.length-1;S++)if(lg(f,y,a[S],a[S+1]))return!0}return!1}function lg(c,a,h,f){return Ve(c,h,f)!==Ve(a,h,f)&&Ve(c,a,h)!==Ve(c,a,f)}function xu(c,a,h){const f=h*h;if(a.length===1)return c.distSqr(a[0])<f;for(let y=1;y<a.length;y++)if(H4(c,a[y-1],a[y])<f)return!0;return!1}function H4(c,a,h){const f=a.distSqr(h);if(f===0)return c.distSqr(a);const y=((c.x-a.x)*(h.x-a.x)+(c.y-a.y)*(h.y-a.y))/f;return c.distSqr(y<0?a:y>1?h:h.sub(a)._mult(y)._add(a))}function G4(c,a){let h,f,y,S=!1;for(let T=0;T<c.length;T++){h=c[T];for(let E=0,I=h.length-1;E<h.length;I=E++)f=h[E],y=h[I],f.y>a.y!=y.y>a.y&&a.x<(y.x-f.x)*(a.y-f.y)/(y.y-f.y)+f.x&&(S=!S)}return S}function Oh(c,a){let h=!1;for(let f=0,y=c.length-1;f<c.length;y=f++){const S=c[f],T=c[y];S.y>a.y!=T.y>a.y&&a.x<(T.x-S.x)*(a.y-S.y)/(T.y-S.y)+S.x&&(h=!h)}return h}function DP(c,a,h){const f=h[0],y=h[2];if(c.x<f.x&&a.x<f.x||c.x>y.x&&a.x>y.x||c.y<f.y&&a.y<f.y||c.y>y.y&&a.y>y.y)return!1;const S=Ve(c,a,h[0]);return S!==Ve(c,a,h[1])||S!==Ve(c,a,h[2])||S!==Ve(c,a,h[3])}function y0(c,a,h){const f=a.paint.get(c).value;return f.kind==="constant"?f.value:h.programConfigurations.get(a.id).getMaxValue(c)}function cg(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function ug(c,a,h,f,y){if(!a[0]&&!a[1])return c;const S=M.convert(a)._mult(y);h==="viewport"&&S._rotate(-f);const T=[];for(let E=0;E<c.length;E++)T.push(c[E].sub(S));return T}let j4,W4;en("CircleBucket",m0,{omit:["layers"]});var kP={get paint(){return W4=W4||new Yi({"circle-radius":new Mn(re.paint_circle["circle-radius"]),"circle-color":new Mn(re.paint_circle["circle-color"]),"circle-blur":new Mn(re.paint_circle["circle-blur"]),"circle-opacity":new Mn(re.paint_circle["circle-opacity"]),"circle-translate":new pn(re.paint_circle["circle-translate"]),"circle-translate-anchor":new pn(re.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pn(re.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pn(re.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mn(re.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mn(re.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mn(re.paint_circle["circle-stroke-opacity"])})},get layout(){return j4=j4||new Yi({"circle-sort-key":new Mn(re.layout_circle["circle-sort-key"])})}},Ji=1e-6,Bh=typeof Float32Array<"u"?Float32Array:Array;function Qv(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function $4(c,a,h){var f=a[0],y=a[1],S=a[2],T=a[3],E=a[4],I=a[5],F=a[6],j=a[7],W=a[8],J=a[9],ae=a[10],oe=a[11],pe=a[12],xe=a[13],Pe=a[14],He=a[15],De=h[0],Ne=h[1],ht=h[2],gt=h[3];return c[0]=De*f+Ne*E+ht*W+gt*pe,c[1]=De*y+Ne*I+ht*J+gt*xe,c[2]=De*S+Ne*F+ht*ae+gt*Pe,c[3]=De*T+Ne*j+ht*oe+gt*He,c[4]=(De=h[4])*f+(Ne=h[5])*E+(ht=h[6])*W+(gt=h[7])*pe,c[5]=De*y+Ne*I+ht*J+gt*xe,c[6]=De*S+Ne*F+ht*ae+gt*Pe,c[7]=De*T+Ne*j+ht*oe+gt*He,c[8]=(De=h[8])*f+(Ne=h[9])*E+(ht=h[10])*W+(gt=h[11])*pe,c[9]=De*y+Ne*I+ht*J+gt*xe,c[10]=De*S+Ne*F+ht*ae+gt*Pe,c[11]=De*T+Ne*j+ht*oe+gt*He,c[12]=(De=h[12])*f+(Ne=h[13])*E+(ht=h[14])*W+(gt=h[15])*pe,c[13]=De*y+Ne*I+ht*J+gt*xe,c[14]=De*S+Ne*F+ht*ae+gt*Pe,c[15]=De*T+Ne*j+ht*oe+gt*He,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var v0,LP=$4;function hg(c,a,h){var f=a[0],y=a[1],S=a[2],T=a[3];return c[0]=h[0]*f+h[4]*y+h[8]*S+h[12]*T,c[1]=h[1]*f+h[5]*y+h[9]*S+h[13]*T,c[2]=h[2]*f+h[6]*y+h[10]*S+h[14]*T,c[3]=h[3]*f+h[7]*y+h[11]*S+h[15]*T,c}v0=new Bh(4),Bh!=Float32Array&&(v0[0]=0,v0[1]=0,v0[2]=0,v0[3]=0);class zP extends Za{constructor(a){super(a,kP)}createBucket(a){return new m0(a)}queryRadius(a){const h=a;return y0("circle-radius",this,h)+y0("circle-stroke-width",this,h)+cg(this.paint.get("circle-translate"))}queryIntersectsFeature(a,h,f,y,S,T,E,I){const F=ug(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,E),j=this.paint.get("circle-radius").evaluate(h,f)+this.paint.get("circle-stroke-width").evaluate(h,f),W=this.paint.get("circle-pitch-alignment")==="map",J=W?F:function(oe,pe){return oe.map(xe=>q4(xe,pe))}(F,I),ae=W?j*E:j;for(const oe of y)for(const pe of oe){const xe=W?pe:q4(pe,I);let Pe=ae;const He=hg([],[pe.x,pe.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=He[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=T.cameraToCenterDistance/He[3]),sg(J,xe,Pe))return!0}return!1}}function q4(c,a){const h=hg([],[c.x,c.y,0,1],a);return new M(h[0]/h[3],h[1]/h[3])}class X4 extends m0{}let Z4;en("HeatmapBucket",X4,{omit:["layers"]});var FP={get paint(){return Z4=Z4||new Yi({"heatmap-radius":new Mn(re.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mn(re.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pn(re.paint_heatmap["heatmap-intensity"]),"heatmap-color":new mu(re.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pn(re.paint_heatmap["heatmap-opacity"])})}};function e_(c,{width:a,height:h},f,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*h*f)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*h*f}`)}else y=new Uint8Array(a*h*f);return c.width=a,c.height=h,c.data=y,c}function Y4(c,{width:a,height:h},f){if(a===c.width&&h===c.height)return;const y=e_({},{width:a,height:h},f);t_(c,y,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,h)},f),c.width=a,c.height=h,c.data=y.data}function t_(c,a,h,f,y,S){if(y.width===0||y.height===0)return a;if(y.width>c.width||y.height>c.height||h.x>c.width-y.width||h.y>c.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||f.x>a.width-y.width||f.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,E=a.data;if(T===E)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<y.height;I++){const F=((h.y+I)*c.width+h.x)*S,j=((f.y+I)*a.width+f.x)*S;for(let W=0;W<y.width*S;W++)E[j+W]=T[F+W]}return a}class _0{constructor(a,h){e_(this,a,1,h)}resize(a){Y4(this,a,1)}clone(){return new _0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,f,y,S){t_(a,h,f,y,S,1)}}class Ja{constructor(a,h){e_(this,a,4,h)}resize(a){Y4(this,a,4)}replace(a,h){h?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Ja({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,h,f,y,S){t_(a,h,f,y,S,4)}}function K4(c){const a={},h=c.resolution||256,f=c.clips?c.clips.length:1,y=c.image||new Ja({width:h,height:f});if(Math.log(h)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${h}`);const S=(T,E,I)=>{a[c.evaluationKey]=I;const F=c.expression.evaluate(a);y.data[T+E+0]=Math.floor(255*F.r/F.a),y.data[T+E+1]=Math.floor(255*F.g/F.a),y.data[T+E+2]=Math.floor(255*F.b/F.a),y.data[T+E+3]=Math.floor(255*F.a)};if(c.clips)for(let T=0,E=0;T<f;++T,E+=4*h)for(let I=0,F=0;I<h;I++,F+=4){const j=I/(h-1),{start:W,end:J}=c.clips[T];S(E,F,W*(1-j)+J*j)}else for(let T=0,E=0;T<h;T++,E+=4)S(0,E,T/(h-1));return y}en("AlphaImage",_0),en("RGBAImage",Ja);class NP extends Za{createBucket(a){return new X4(a)}constructor(a){super(a,FP),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=K4({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let J4;var OP={get paint(){return J4=J4||new Yi({"hillshade-illumination-direction":new pn(re.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pn(re.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pn(re.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pn(re.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pn(re.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pn(re.paint_hillshade["hillshade-accent-color"])})}};class BP extends Za{constructor(a){super(a,OP)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const UP=Wr([{name:"a_pos",components:2,type:"Int16"}],4),{members:VP}=UP;var n_={exports:{}};function dg(c,a,h){h=h||2;var f,y,S,T,E,I,F,j=a&&a.length,W=j?a[0]*h:c.length,J=Q4(c,0,W,h,!0),ae=[];if(!J||J.next===J.prev)return ae;if(j&&(J=function(pe,xe,Pe,He){var De,Ne,ht,gt=[];for(De=0,Ne=xe.length;De<Ne;De++)(ht=Q4(pe,xe[De]*He,De<Ne-1?xe[De+1]*He:pe.length,He,!1))===ht.next&&(ht.steiner=!0),gt.push(ZP(ht));for(gt.sort($P),De=0;De<gt.length;De++)Pe=qP(gt[De],Pe);return Pe}(c,a,J,h)),c.length>80*h){f=S=c[0],y=T=c[1];for(var oe=h;oe<W;oe+=h)(E=c[oe])<f&&(f=E),(I=c[oe+1])<y&&(y=I),E>S&&(S=E),I>T&&(T=I);F=(F=Math.max(S-f,T-y))!==0?32767/F:0}return x0(J,ae,h,f,y,F,0),ae}function Q4(c,a,h,f,y){var S,T;if(y===a_(c,a,h,f)>0)for(S=a;S<h;S+=f)T=n3(S,c[S],c[S+1],T);else for(S=h-f;S>=a;S-=f)T=n3(S,c[S],c[S+1],T);return T&&fg(T,T.next)&&(w0(T),T=T.next),T}function bu(c,a){if(!c)return c;a||(a=c);var h,f=c;do if(h=!1,f.steiner||!fg(f,f.next)&&$r(f.prev,f,f.next)!==0)f=f.next;else{if(w0(f),(f=a=f.prev)===f.next)break;h=!0}while(h||f!==a);return a}function x0(c,a,h,f,y,S,T){if(c){!T&&S&&function(j,W,J,ae){var oe=j;do oe.z===0&&(oe.z=r_(oe.x,oe.y,W,J,ae)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==j);oe.prevZ.nextZ=null,oe.prevZ=null,function(pe){var xe,Pe,He,De,Ne,ht,gt,Wt,un=1;do{for(Pe=pe,pe=null,Ne=null,ht=0;Pe;){for(ht++,He=Pe,gt=0,xe=0;xe<un&&(gt++,He=He.nextZ);xe++);for(Wt=un;gt>0||Wt>0&&He;)gt!==0&&(Wt===0||!He||Pe.z<=He.z)?(De=Pe,Pe=Pe.nextZ,gt--):(De=He,He=He.nextZ,Wt--),Ne?Ne.nextZ=De:pe=De,De.prevZ=Ne,Ne=De;Pe=He}Ne.nextZ=null,un*=2}while(ht>1)}(oe)}(c,f,y,S);for(var E,I,F=c;c.prev!==c.next;)if(E=c.prev,I=c.next,S?GP(c,f,y,S):HP(c))a.push(E.i/h|0),a.push(c.i/h|0),a.push(I.i/h|0),w0(c),c=I.next,F=I.next;else if((c=I)===F){T?T===1?x0(c=jP(bu(c),a,h),a,h,f,y,S,2):T===2&&WP(c,a,h,f,y,S):x0(bu(c),a,h,f,y,S,1);break}}}function HP(c){var a=c.prev,h=c,f=c.next;if($r(a,h,f)>=0)return!1;for(var y=a.x,S=h.x,T=f.x,E=a.y,I=h.y,F=f.y,j=y<S?y<T?y:T:S<T?S:T,W=E<I?E<F?E:F:I<F?I:F,J=y>S?y>T?y:T:S>T?S:T,ae=E>I?E>F?E:F:I>F?I:F,oe=f.next;oe!==a;){if(oe.x>=j&&oe.x<=J&&oe.y>=W&&oe.y<=ae&&Uh(y,E,S,I,T,F,oe.x,oe.y)&&$r(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function GP(c,a,h,f){var y=c.prev,S=c,T=c.next;if($r(y,S,T)>=0)return!1;for(var E=y.x,I=S.x,F=T.x,j=y.y,W=S.y,J=T.y,ae=E<I?E<F?E:F:I<F?I:F,oe=j<W?j<J?j:J:W<J?W:J,pe=E>I?E>F?E:F:I>F?I:F,xe=j>W?j>J?j:J:W>J?W:J,Pe=r_(ae,oe,a,h,f),He=r_(pe,xe,a,h,f),De=c.prevZ,Ne=c.nextZ;De&&De.z>=Pe&&Ne&&Ne.z<=He;){if(De.x>=ae&&De.x<=pe&&De.y>=oe&&De.y<=xe&&De!==y&&De!==T&&Uh(E,j,I,W,F,J,De.x,De.y)&&$r(De.prev,De,De.next)>=0||(De=De.prevZ,Ne.x>=ae&&Ne.x<=pe&&Ne.y>=oe&&Ne.y<=xe&&Ne!==y&&Ne!==T&&Uh(E,j,I,W,F,J,Ne.x,Ne.y)&&$r(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;De&&De.z>=Pe;){if(De.x>=ae&&De.x<=pe&&De.y>=oe&&De.y<=xe&&De!==y&&De!==T&&Uh(E,j,I,W,F,J,De.x,De.y)&&$r(De.prev,De,De.next)>=0)return!1;De=De.prevZ}for(;Ne&&Ne.z<=He;){if(Ne.x>=ae&&Ne.x<=pe&&Ne.y>=oe&&Ne.y<=xe&&Ne!==y&&Ne!==T&&Uh(E,j,I,W,F,J,Ne.x,Ne.y)&&$r(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function jP(c,a,h){var f=c;do{var y=f.prev,S=f.next.next;!fg(y,S)&&e3(y,f,f.next,S)&&b0(y,S)&&b0(S,y)&&(a.push(y.i/h|0),a.push(f.i/h|0),a.push(S.i/h|0),w0(f),w0(f.next),f=c=S),f=f.next}while(f!==c);return bu(f)}function WP(c,a,h,f,y,S){var T=c;do{for(var E=T.next.next;E!==T.prev;){if(T.i!==E.i&&YP(T,E)){var I=t3(T,E);return T=bu(T,T.next),I=bu(I,I.next),x0(T,a,h,f,y,S,0),void x0(I,a,h,f,y,S,0)}E=E.next}T=T.next}while(T!==c)}function $P(c,a){return c.x-a.x}function qP(c,a){var h=function(y,S){var T,E=S,I=y.x,F=y.y,j=-1/0;do{if(F<=E.y&&F>=E.next.y&&E.next.y!==E.y){var W=E.x+(F-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(W<=I&&W>j&&(j=W,T=E.x<E.next.x?E:E.next,W===I))return T}E=E.next}while(E!==S);if(!T)return null;var J,ae=T,oe=T.x,pe=T.y,xe=1/0;E=T;do I>=E.x&&E.x>=oe&&I!==E.x&&Uh(F<pe?I:j,F,oe,pe,F<pe?j:I,F,E.x,E.y)&&(J=Math.abs(F-E.y)/(I-E.x),b0(E,y)&&(J<xe||J===xe&&(E.x>T.x||E.x===T.x&&XP(T,E)))&&(T=E,xe=J)),E=E.next;while(E!==ae);return T}(c,a);if(!h)return a;var f=t3(h,c);return bu(f,f.next),bu(h,h.next)}function XP(c,a){return $r(c.prev,c,a.prev)<0&&$r(a.next,c,c.next)<0}function r_(c,a,h,f,y){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-h)*y|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-f)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function ZP(c){var a=c,h=c;do(a.x<h.x||a.x===h.x&&a.y<h.y)&&(h=a),a=a.next;while(a!==c);return h}function Uh(c,a,h,f,y,S,T,E){return(y-T)*(a-E)>=(c-T)*(S-E)&&(c-T)*(f-E)>=(h-T)*(a-E)&&(h-T)*(S-E)>=(y-T)*(f-E)}function YP(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(h,f){var y=h;do{if(y.i!==h.i&&y.next.i!==h.i&&y.i!==f.i&&y.next.i!==f.i&&e3(y,y.next,h,f))return!0;y=y.next}while(y!==h);return!1}(c,a)&&(b0(c,a)&&b0(a,c)&&function(h,f){var y=h,S=!1,T=(h.x+f.x)/2,E=(h.y+f.y)/2;do y.y>E!=y.next.y>E&&y.next.y!==y.y&&T<(y.next.x-y.x)*(E-y.y)/(y.next.y-y.y)+y.x&&(S=!S),y=y.next;while(y!==h);return S}(c,a)&&($r(c.prev,c,a.prev)||$r(c,a.prev,a))||fg(c,a)&&$r(c.prev,c,c.next)>0&&$r(a.prev,a,a.next)>0)}function $r(c,a,h){return(a.y-c.y)*(h.x-a.x)-(a.x-c.x)*(h.y-a.y)}function fg(c,a){return c.x===a.x&&c.y===a.y}function e3(c,a,h,f){var y=mg($r(c,a,h)),S=mg($r(c,a,f)),T=mg($r(h,f,c)),E=mg($r(h,f,a));return y!==S&&T!==E||!(y!==0||!pg(c,h,a))||!(S!==0||!pg(c,f,a))||!(T!==0||!pg(h,c,f))||!(E!==0||!pg(h,a,f))}function pg(c,a,h){return a.x<=Math.max(c.x,h.x)&&a.x>=Math.min(c.x,h.x)&&a.y<=Math.max(c.y,h.y)&&a.y>=Math.min(c.y,h.y)}function mg(c){return c>0?1:c<0?-1:0}function b0(c,a){return $r(c.prev,c,c.next)<0?$r(c,a,c.next)>=0&&$r(c,c.prev,a)>=0:$r(c,a,c.prev)<0||$r(c,c.next,a)<0}function t3(c,a){var h=new i_(c.i,c.x,c.y),f=new i_(a.i,a.x,a.y),y=c.next,S=a.prev;return c.next=a,a.prev=c,h.next=y,y.prev=h,f.next=h,h.prev=f,S.next=f,f.prev=S,f}function n3(c,a,h,f){var y=new i_(c,a,h);return f?(y.next=f.next,y.prev=f,f.next.prev=y,f.next=y):(y.prev=y,y.next=y),y}function w0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function i_(c,a,h){this.i=c,this.x=a,this.y=h,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function a_(c,a,h,f){for(var y=0,S=a,T=h-f;S<h;S+=f)y+=(c[T]-c[S])*(c[S+1]+c[T+1]),T=S;return y}n_.exports=dg,n_.exports.default=dg,dg.deviation=function(c,a,h,f){var y=a&&a.length,S=Math.abs(a_(c,0,y?a[0]*h:c.length,h));if(y)for(var T=0,E=a.length;T<E;T++)S-=Math.abs(a_(c,a[T]*h,T<E-1?a[T+1]*h:c.length,h));var I=0;for(T=0;T<f.length;T+=3){var F=f[T]*h,j=f[T+1]*h,W=f[T+2]*h;I+=Math.abs((c[F]-c[W])*(c[j+1]-c[F+1])-(c[F]-c[j])*(c[W+1]-c[F+1]))}return S===0&&I===0?0:Math.abs((I-S)/S)},dg.flatten=function(c){for(var a=c[0][0].length,h={vertices:[],holes:[],dimensions:a},f=0,y=0;y<c.length;y++){for(var S=0;S<c[y].length;S++)for(var T=0;T<a;T++)h.vertices.push(c[y][S][T]);y>0&&h.holes.push(f+=c[y-1].length)}return h};var r3=p(n_.exports);function KP(c,a,h,f,y){i3(c,a,h||0,f||c.length-1,y||JP)}function i3(c,a,h,f,y){for(;f>h;){if(f-h>600){var S=f-h+1,T=a-h+1,E=Math.log(S),I=.5*Math.exp(2*E/3),F=.5*Math.sqrt(E*I*(S-I)/S)*(T-S/2<0?-1:1);i3(c,a,Math.max(h,Math.floor(a-T*I/S+F)),Math.min(f,Math.floor(a+(S-T)*I/S+F)),y)}var j=c[a],W=h,J=f;for(S0(c,h,a),y(c[f],j)>0&&S0(c,h,f);W<J;){for(S0(c,W,J),W++,J--;y(c[W],j)<0;)W++;for(;y(c[J],j)>0;)J--}y(c[h],j)===0?S0(c,h,J):S0(c,++J,f),J<=a&&(h=J+1),a<=J&&(f=J-1)}}function S0(c,a,h){var f=c[a];c[a]=c[h],c[h]=f}function JP(c,a){return c<a?-1:c>a?1:0}function s_(c,a){const h=c.length;if(h<=1)return[c];const f=[];let y,S;for(let T=0;T<h;T++){const E=lt(c[T]);E!==0&&(c[T].area=Math.abs(E),S===void 0&&(S=E<0),S===E<0?(y&&f.push(y),y=[c[T]]):y.push(c[T]))}if(y&&f.push(y),a>1)for(let T=0;T<f.length;T++)f[T].length<=a||(KP(f[T],a,1,f[T].length-1,QP),f[T]=f[T].slice(0,a));return f}function QP(c,a){return a.area-c.area}function o_(c,a,h){const f=h.patternDependencies;let y=!1;for(const S of a){const T=S.paint.get(`${c}-pattern`);T.isConstant()||(y=!0);const E=T.constantOr(null);E&&(y=!0,f[E.to]=!0,f[E.from]=!0)}return y}function l_(c,a,h,f,y){const S=y.patternDependencies;for(const T of a){const E=T.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:f-1},h,{},y.availableImages),F=E.evaluate({zoom:f},h,{},y.availableImages),j=E.evaluate({zoom:f+1},h,{},y.availableImages);I=I&&I.name?I.name:I,F=F&&F.name?F.name:F,j=j&&j.name?j.name:j,S[I]=!0,S[F]=!0,S[j]=!0,h.patterns[T.id]={min:I,mid:F,max:j}}}return h}class c_{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new se,this.indexArray=new Qe,this.indexArray2=new ot,this.programConfigurations=new Ar(a.layers,a.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,f){this.hasPattern=o_("fill",this.layers,h);const y=this.layers[0].layout.get("fill-sort-key"),S=!y.isConstant(),T=[];for(const{feature:E,id:I,index:F,sourceLayerIndex:j}of a){const W=this.layers[0]._featureFilter.needGeometry,J=el(E,W);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),J,f))continue;const ae=S?y.evaluate(J,{},f,h.availableImages):void 0,oe={id:I,properties:E.properties,type:E.type,sourceLayerIndex:j,index:F,geometry:W?J.geometry:Qo(E),patterns:{},sortKey:ae};T.push(oe)}S&&T.sort((E,I)=>E.sortKey-I.sortKey);for(const E of T){const{geometry:I,index:F,sourceLayerIndex:j}=E;if(this.hasPattern){const W=l_("fill",this.layers,E,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(E,I,F,f,{});h.featureIndex.insert(a[F].feature,I,F,j,this.index)}}update(a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,f)}addFeatures(a,h,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,VP),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,h,f,y,S){for(const T of s_(h,500)){let E=0;for(const ae of T)E+=ae.length;const I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),F=I.vertexLength,j=[],W=[];for(const ae of T){if(ae.length===0)continue;ae!==T[0]&&W.push(j.length/2);const oe=this.segments2.prepareSegment(ae.length,this.layoutVertexArray,this.indexArray2),pe=oe.vertexLength;this.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),this.indexArray2.emplaceBack(pe+ae.length-1,pe),j.push(ae[0].x),j.push(ae[0].y);for(let xe=1;xe<ae.length;xe++)this.layoutVertexArray.emplaceBack(ae[xe].x,ae[xe].y),this.indexArray2.emplaceBack(pe+xe-1,pe+xe),j.push(ae[xe].x),j.push(ae[xe].y);oe.vertexLength+=ae.length,oe.primitiveLength+=ae.length}const J=r3(j,W);for(let ae=0;ae<J.length;ae+=3)this.indexArray.emplaceBack(F+J[ae],F+J[ae+1],F+J[ae+2]);I.vertexLength+=E,I.primitiveLength+=J.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}}let a3,s3;en("FillBucket",c_,{omit:["layers","patternFeatures"]});var eR={get paint(){return s3=s3||new Yi({"fill-antialias":new pn(re.paint_fill["fill-antialias"]),"fill-opacity":new Mn(re.paint_fill["fill-opacity"]),"fill-color":new Mn(re.paint_fill["fill-color"]),"fill-outline-color":new Mn(re.paint_fill["fill-outline-color"]),"fill-translate":new pn(re.paint_fill["fill-translate"]),"fill-translate-anchor":new pn(re.paint_fill["fill-translate-anchor"]),"fill-pattern":new Zo(re.paint_fill["fill-pattern"])})},get layout(){return a3=a3||new Yi({"fill-sort-key":new Mn(re.layout_fill["fill-sort-key"])})}};class tR extends Za{constructor(a){super(a,eR)}recalculate(a,h){super.recalculate(a,h);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new c_(a)}queryRadius(){return cg(this.paint.get("fill-translate"))}queryIntersectsFeature(a,h,f,y,S,T,E){return g0(ug(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,E),y)}isTileClipped(){return!0}}const nR=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),rR=Wr([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iR}=nR;var ic={},aR=v,o3=Vh;function Vh(c,a,h,f,y){this.properties={},this.extent=h,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=y,c.readFields(sR,this,a)}function sR(c,a,h){c==1?a.id=h.readVarint():c==2?function(f,y){for(var S=f.readVarint()+f.pos;f.pos<S;){var T=y._keys[f.readVarint()],E=y._values[f.readVarint()];y.properties[T]=E}}(h,a):c==3?a.type=h.readVarint():c==4&&(a._geometry=h.pos)}function oR(c){for(var a,h,f=0,y=0,S=c.length,T=S-1;y<S;T=y++)f+=((h=c[T]).x-(a=c[y]).x)*(a.y+h.y);return f}Vh.types=["Unknown","Point","LineString","Polygon"],Vh.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,h=c.readVarint()+c.pos,f=1,y=0,S=0,T=0,E=[];c.pos<h;){if(y<=0){var I=c.readVarint();f=7&I,y=I>>3}if(y--,f===1||f===2)S+=c.readSVarint(),T+=c.readSVarint(),f===1&&(a&&E.push(a),a=[]),a.push(new aR(S,T));else{if(f!==7)throw new Error("unknown command "+f);a&&a.push(a[0].clone())}}return a&&E.push(a),E},Vh.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,h=1,f=0,y=0,S=0,T=1/0,E=-1/0,I=1/0,F=-1/0;c.pos<a;){if(f<=0){var j=c.readVarint();h=7&j,f=j>>3}if(f--,h===1||h===2)(y+=c.readSVarint())<T&&(T=y),y>E&&(E=y),(S+=c.readSVarint())<I&&(I=S),S>F&&(F=S);else if(h!==7)throw new Error("unknown command "+h)}return[T,I,E,F]},Vh.prototype.toGeoJSON=function(c,a,h){var f,y,S=this.extent*Math.pow(2,h),T=this.extent*c,E=this.extent*a,I=this.loadGeometry(),F=Vh.types[this.type];function j(ae){for(var oe=0;oe<ae.length;oe++){var pe=ae[oe];ae[oe]=[360*(pe.x+T)/S-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+E)/S)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(f=0;f<I.length;f++)W[f]=I[f][0];j(I=W);break;case 2:for(f=0;f<I.length;f++)j(I[f]);break;case 3:for(I=function(ae){var oe=ae.length;if(oe<=1)return[ae];for(var pe,xe,Pe=[],He=0;He<oe;He++){var De=oR(ae[He]);De!==0&&(xe===void 0&&(xe=De<0),xe===De<0?(pe&&Pe.push(pe),pe=[ae[He]]):pe.push(ae[He]))}return pe&&Pe.push(pe),Pe}(I),f=0;f<I.length;f++)for(y=0;y<I[f].length;y++)j(I[f][y])}I.length===1?I=I[0]:F="Multi"+F;var J={type:"Feature",geometry:{type:F,coordinates:I},properties:this.properties};return"id"in this&&(J.id=this.id),J};var lR=o3,l3=c3;function c3(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(cR,this,a),this.length=this._features.length}function cR(c,a,h){c===15?a.version=h.readVarint():c===1?a.name=h.readString():c===5?a.extent=h.readVarint():c===2?a._features.push(h.pos):c===3?a._keys.push(h.readString()):c===4&&a._values.push(function(f){for(var y=null,S=f.readVarint()+f.pos;f.pos<S;){var T=f.readVarint()>>3;y=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}return y}(h))}c3.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new lR(this._pbf,a,this.extent,this._keys,this._values)};var uR=l3;function hR(c,a,h){if(c===3){var f=new uR(h,h.readVarint()+h.pos);f.length&&(a[f.name]=f)}}ic.VectorTile=function(c,a){this.layers=c.readFields(hR,{},a)},ic.VectorTileFeature=o3,ic.VectorTileLayer=l3;const dR=ic.VectorTileFeature.types,u_=Math.pow(2,13);function M0(c,a,h,f,y,S,T,E){c.emplaceBack(a,h,2*Math.floor(f*u_)+T,y*u_*2,S*u_*2,Math.round(E))}class h_{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.centroidVertexArray=new q,this.indexArray=new Qe,this.programConfigurations=new Ar(a.layers,a.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,f){this.features=[],this.hasPattern=o_("fill-extrusion",this.layers,h);for(const{feature:y,id:S,index:T,sourceLayerIndex:E}of a){const I=this.layers[0]._featureFilter.needGeometry,F=el(y,I);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),F,f))continue;const j={id:S,sourceLayerIndex:E,index:T,geometry:I?F.geometry:Qo(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(l_("fill-extrusion",this.layers,j,this.zoom,h)):this.addFeature(j,j.geometry,T,f,{}),h.featureIndex.insert(y,j.geometry,T,E,this.index,!0)}}addFeatures(a,h,f){for(const y of this.features){const{geometry:S}=y;this.addFeature(y,S,y.index,h,f)}}update(a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,iR),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,rR.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,h,f,y,S){const T={x:0,y:0,vertexCount:0};for(const E of s_(h,500)){let I=0;for(const oe of E)I+=oe.length;let F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const oe of E){if(oe.length===0||pR(oe))continue;let pe=0;for(let xe=0;xe<oe.length;xe++){const Pe=oe[xe];if(xe>=1){const He=oe[xe-1];if(!fR(Pe,He)){F.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const De=Pe.sub(He)._perp()._unit(),Ne=He.dist(Pe);pe+Ne>32768&&(pe=0),M0(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,0,pe),M0(this.layoutVertexArray,Pe.x,Pe.y,De.x,De.y,0,1,pe),T.x+=2*Pe.x,T.y+=2*Pe.y,T.vertexCount+=2,pe+=Ne,M0(this.layoutVertexArray,He.x,He.y,De.x,De.y,0,0,pe),M0(this.layoutVertexArray,He.x,He.y,De.x,De.y,0,1,pe),T.x+=2*He.x,T.y+=2*He.y,T.vertexCount+=2;const ht=F.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),F.vertexLength+=4,F.primitiveLength+=2}}}}if(F.vertexLength+I>xt.MAX_VERTEX_ARRAY_LENGTH&&(F=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),dR[a.type]!=="Polygon")continue;const j=[],W=[],J=F.vertexLength;for(const oe of E)if(oe.length!==0){oe!==E[0]&&W.push(j.length/2);for(let pe=0;pe<oe.length;pe++){const xe=oe[pe];M0(this.layoutVertexArray,xe.x,xe.y,0,0,1,1,0),T.x+=xe.x,T.y+=xe.y,T.vertexCount+=1,j.push(xe.x),j.push(xe.y)}}const ae=r3(j,W);for(let oe=0;oe<ae.length;oe+=3)this.indexArray.emplaceBack(J+ae[oe],J+ae[oe+2],J+ae[oe+1]);F.primitiveLength+=ae.length/3,F.vertexLength+=I}for(let E=0;E<T.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}}function fR(c,a){return c.x===a.x&&(c.x<0||c.x>$n)||c.y===a.y&&(c.y<0||c.y>$n)}function pR(c){return c.every(a=>a.x<0)||c.every(a=>a.x>$n)||c.every(a=>a.y<0)||c.every(a=>a.y>$n)}let u3;en("FillExtrusionBucket",h_,{omit:["layers","features"]});var mR={get paint(){return u3=u3||new Yi({"fill-extrusion-opacity":new pn(re["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mn(re["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pn(re["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pn(re["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Zo(re["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mn(re["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mn(re["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pn(re["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class gR extends Za{constructor(a){super(a,mR)}createBucket(a){return new h_(a)}queryRadius(){return cg(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,h,f,y,S,T,E,I){const F=ug(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,E),j=this.paint.get("fill-extrusion-height").evaluate(h,f),W=this.paint.get("fill-extrusion-base").evaluate(h,f),J=function(oe,pe,xe,Pe){const He=[];for(const De of oe){const Ne=[De.x,De.y,0,1];hg(Ne,Ne,pe),He.push(new M(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return He}(F,I),ae=function(oe,pe,xe,Pe){const He=[],De=[],Ne=Pe[8]*pe,ht=Pe[9]*pe,gt=Pe[10]*pe,Wt=Pe[11]*pe,un=Pe[8]*xe,Gt=Pe[9]*xe,Vt=Pe[10]*xe,Rt=Pe[11]*xe;for(const sn of oe){const Bt=[],Tt=[];for(const vn of sn){const dn=vn.x,jn=vn.y,Sr=Pe[0]*dn+Pe[4]*jn+Pe[12],Cr=Pe[1]*dn+Pe[5]*jn+Pe[13],si=Pe[2]*dn+Pe[6]*jn+Pe[14],za=Pe[3]*dn+Pe[7]*jn+Pe[15],Qi=si+gt,ei=za+Wt,bi=Sr+un,Ii=Cr+Gt,ea=si+Vt,ta=za+Rt,oi=new M((Sr+Ne)/ei,(Cr+ht)/ei);oi.z=Qi/ei,Bt.push(oi);const li=new M(bi/ta,Ii/ta);li.z=ea/ta,Tt.push(li)}He.push(Bt),De.push(Tt)}return[He,De]}(y,W,j,I);return function(oe,pe,xe){let Pe=1/0;g0(xe,pe)&&(Pe=h3(xe,pe[0]));for(let He=0;He<pe.length;He++){const De=pe[He],Ne=oe[He];for(let ht=0;ht<De.length-1;ht++){const gt=De[ht],Wt=[gt,De[ht+1],Ne[ht+1],Ne[ht],gt];tl(xe,Wt)&&(Pe=Math.min(Pe,h3(xe,Wt)))}}return Pe!==1/0&&Pe}(ae[0],ae[1],J)}}function T0(c,a){return c.x*a.x+c.y*a.y}function h3(c,a){if(c.length===1){let h=0;const f=a[h++];let y;for(;!y||f.equals(y);)if(y=a[h++],!y)return 1/0;for(;h<a.length;h++){const S=a[h],T=c[0],E=y.sub(f),I=S.sub(f),F=T.sub(f),j=T0(E,E),W=T0(E,I),J=T0(I,I),ae=T0(F,E),oe=T0(F,I),pe=j*J-W*W,xe=(J*ae-W*oe)/pe,Pe=(j*oe-W*ae)/pe,He=f.z*(1-xe-Pe)+y.z*xe+S.z*Pe;if(isFinite(He))return He}return 1/0}{let h=1/0;for(const f of a)h=Math.min(h,f.z);return h}}const yR=Wr([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:vR}=yR,_R=Wr([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:xR}=_R,bR=ic.VectorTileFeature.types,wR=Math.cos(Math.PI/180*37.5),d3=Math.pow(2,14)/.5;class d_{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(h=>h.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(h=>{this.gradients[h.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new we,this.indexArray=new Qe,this.programConfigurations=new Ar(a.layers,a.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(h=>h.isStateDependent()).map(h=>h.id)}populate(a,h,f){this.hasPattern=o_("line",this.layers,h);const y=this.layers[0].layout.get("line-sort-key"),S=!y.isConstant(),T=[];for(const{feature:E,id:I,index:F,sourceLayerIndex:j}of a){const W=this.layers[0]._featureFilter.needGeometry,J=el(E,W);if(!this.layers[0]._featureFilter.filter(new br(this.zoom),J,f))continue;const ae=S?y.evaluate(J,{},f):void 0,oe={id:I,properties:E.properties,type:E.type,sourceLayerIndex:j,index:F,geometry:W?J.geometry:Qo(E),patterns:{},sortKey:ae};T.push(oe)}S&&T.sort((E,I)=>E.sortKey-I.sortKey);for(const E of T){const{geometry:I,index:F,sourceLayerIndex:j}=E;if(this.hasPattern){const W=l_("line",this.layers,E,this.zoom,h);this.patternFeatures.push(W)}else this.addFeature(E,I,F,f,{});h.featureIndex.insert(a[F].feature,I,F,j,this.index)}}update(a,h,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,h,this.stateDependentLayers,f)}addFeatures(a,h,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,h,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,xR)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,vR),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,h,f,y,S){const T=this.layers[0].layout,E=T.get("line-join").evaluate(a,{}),I=T.get("line-cap"),F=T.get("line-miter-limit"),j=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const W of h)this.addLine(W,a,E,I,F,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,S,y)}addLine(a,h,f,y,S,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=bR[h.type]==="Polygon";let I=a.length;for(;I>=2&&a[I-1].equals(a[I-2]);)I--;let F=0;for(;F<I-1&&a[F].equals(a[F+1]);)F++;if(I<(E?3:2))return;f==="bevel"&&(S=1.05);const j=this.overscaling<=16?15*$n/(512*this.overscaling):0,W=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let J,ae,oe,pe,xe;this.e1=this.e2=-1,E&&(J=a[I-2],xe=a[F].sub(J)._unit()._perp());for(let Pe=F;Pe<I;Pe++){if(oe=Pe===I-1?E?a[F+1]:void 0:a[Pe+1],oe&&a[Pe].equals(oe))continue;xe&&(pe=xe),J&&(ae=J),J=a[Pe],xe=oe?oe.sub(J)._unit()._perp():pe,pe=pe||xe;let He=pe.add(xe);He.x===0&&He.y===0||He._unit();const De=pe.x*xe.x+pe.y*xe.y,Ne=He.x*xe.x+He.y*xe.y,ht=Ne!==0?1/Ne:1/0,gt=2*Math.sqrt(2-2*Ne),Wt=Ne<wR&&ae&&oe,un=pe.x*xe.y-pe.y*xe.x>0;if(Wt&&Pe>F){const Rt=J.dist(ae);if(Rt>2*j){const sn=J.sub(J.sub(ae)._mult(j/Rt)._round());this.updateDistance(ae,sn),this.addCurrentVertex(sn,pe,0,0,W),ae=sn}}const Gt=ae&&oe;let Vt=Gt?f:E?"butt":y;if(Gt&&Vt==="round"&&(ht<T?Vt="miter":ht<=2&&(Vt="fakeround")),Vt==="miter"&&ht>S&&(Vt="bevel"),Vt==="bevel"&&(ht>2&&(Vt="flipbevel"),ht<S&&(Vt="miter")),ae&&this.updateDistance(ae,J),Vt==="miter")He._mult(ht),this.addCurrentVertex(J,He,0,0,W);else if(Vt==="flipbevel"){if(ht>100)He=xe.mult(-1);else{const Rt=ht*pe.add(xe).mag()/pe.sub(xe).mag();He._perp()._mult(Rt*(un?-1:1))}this.addCurrentVertex(J,He,0,0,W),this.addCurrentVertex(J,He.mult(-1),0,0,W)}else if(Vt==="bevel"||Vt==="fakeround"){const Rt=-Math.sqrt(ht*ht-1),sn=un?Rt:0,Bt=un?0:Rt;if(ae&&this.addCurrentVertex(J,pe,sn,Bt,W),Vt==="fakeround"){const Tt=Math.round(180*gt/Math.PI/20);for(let vn=1;vn<Tt;vn++){let dn=vn/Tt;if(dn!==.5){const Sr=dn-.5;dn+=dn*Sr*(dn-1)*((1.0904+De*(De*(3.55645-1.43519*De)-3.2452))*Sr*Sr+(.848013+De*(.215638*De-1.06021)))}const jn=xe.sub(pe)._mult(dn)._add(pe)._unit()._mult(un?-1:1);this.addHalfVertex(J,jn.x,jn.y,!1,un,0,W)}}oe&&this.addCurrentVertex(J,xe,-sn,-Bt,W)}else if(Vt==="butt")this.addCurrentVertex(J,He,0,0,W);else if(Vt==="square"){const Rt=ae?1:-1;this.addCurrentVertex(J,He,Rt,Rt,W)}else Vt==="round"&&(ae&&(this.addCurrentVertex(J,pe,0,0,W),this.addCurrentVertex(J,pe,1,1,W,!0)),oe&&(this.addCurrentVertex(J,xe,-1,-1,W,!0),this.addCurrentVertex(J,xe,0,0,W)));if(Wt&&Pe<I-1){const Rt=J.dist(oe);if(Rt>2*j){const sn=J.add(oe.sub(J)._mult(j/Rt)._round());this.updateDistance(J,sn),this.addCurrentVertex(sn,xe,0,0,W),J=sn}}}}addCurrentVertex(a,h,f,y,S,T=!1){const E=h.y*y-h.x,I=-h.y-h.x*y;this.addHalfVertex(a,h.x+h.y*f,h.y-h.x*f,T,!1,f,S),this.addHalfVertex(a,E,I,T,!0,-y,S),this.distance>d3/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,h,f,y,S,T))}addHalfVertex({x:a,y:h},f,y,S,T,E,I){const F=.5*(this.lineClips?this.scaledDistance*(d3-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(S?1:0),(h<<1)+(T?1:0),Math.round(63*f)+128,Math.round(63*y)+128,1+(E===0?0:E<0?-1:1)|(63&F)<<2,F>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),I.primitiveLength++),T?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,h){this.distance+=a.dist(h),this.updateScaledDistance()}}let f3,p3;en("LineBucket",d_,{omit:["layers","patternFeatures"]});var m3={get paint(){return p3=p3||new Yi({"line-opacity":new Mn(re.paint_line["line-opacity"]),"line-color":new Mn(re.paint_line["line-color"]),"line-translate":new pn(re.paint_line["line-translate"]),"line-translate-anchor":new pn(re.paint_line["line-translate-anchor"]),"line-width":new Mn(re.paint_line["line-width"]),"line-gap-width":new Mn(re.paint_line["line-gap-width"]),"line-offset":new Mn(re.paint_line["line-offset"]),"line-blur":new Mn(re.paint_line["line-blur"]),"line-dasharray":new r0(re.paint_line["line-dasharray"]),"line-pattern":new Zo(re.paint_line["line-pattern"]),"line-gradient":new mu(re.paint_line["line-gradient"])})},get layout(){return f3=f3||new Yi({"line-cap":new pn(re.layout_line["line-cap"]),"line-join":new Mn(re.layout_line["line-join"]),"line-miter-limit":new pn(re.layout_line["line-miter-limit"]),"line-round-limit":new pn(re.layout_line["line-round-limit"]),"line-sort-key":new Mn(re.layout_line["line-sort-key"])})}};class SR extends Mn{possiblyEvaluate(a,h){return h=new br(Math.floor(h.zoom),{now:h.now,fadeDuration:h.fadeDuration,zoomHistory:h.zoomHistory,transition:h.transition}),super.possiblyEvaluate(a,h)}evaluate(a,h,f,y){return h=ee({},h,{zoom:Math.floor(h.zoom)}),super.evaluate(a,h,f,y)}}let gg;class MR extends Za{constructor(a){super(a,m3),this.gradientVersion=0,gg||(gg=new SR(m3.paint.properties["line-width"].specification),gg.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const h=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(h)&&h._styleExpression.expression instanceof Bl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,h){super.recalculate(a,h),this.paint._values["line-floorwidth"]=gg.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new d_(a)}queryRadius(a){const h=a,f=g3(y0("line-width",this,h),y0("line-gap-width",this,h)),y=y0("line-offset",this,h);return f/2+Math.abs(y)+cg(this.paint.get("line-translate"))}queryIntersectsFeature(a,h,f,y,S,T,E){const I=ug(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,E),F=E/2*g3(this.paint.get("line-width").evaluate(h,f),this.paint.get("line-gap-width").evaluate(h,f)),j=this.paint.get("line-offset").evaluate(h,f);return j&&(y=function(W,J){const ae=[];for(let oe=0;oe<W.length;oe++){const pe=W[oe],xe=[];for(let Pe=0;Pe<pe.length;Pe++){const He=pe[Pe-1],De=pe[Pe],Ne=pe[Pe+1],ht=Pe===0?new M(0,0):De.sub(He)._unit()._perp(),gt=Pe===pe.length-1?new M(0,0):Ne.sub(De)._unit()._perp(),Wt=ht._add(gt)._unit(),un=Wt.x*gt.x+Wt.y*gt.y;un!==0&&Wt._mult(1/un),xe.push(Wt._mult(J)._add(De))}ae.push(xe)}return ae}(y,j*E)),function(W,J,ae){for(let oe=0;oe<J.length;oe++){const pe=J[oe];if(W.length>=3){for(let xe=0;xe<pe.length;xe++)if(Oh(W,pe[xe]))return!0}if(og(W,pe,ae))return!0}return!1}(I,y,F)}isTileClipped(){return!0}}function g3(c,a){return a>0?a+2*c:c}const TR=Wr([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),ER=Wr([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wr([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const AR=Wr([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wr([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const y3=Wr([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),CR=Wr([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function PR(c,a,h){return c.sections.forEach(f=>{f.text=function(y,S,T){const E=S.layout.get("text-transform").evaluate(T,{});return E==="uppercase"?y=y.toLocaleUpperCase():E==="lowercase"&&(y=y.toLocaleLowerCase()),Xo.applyArabicShaping&&(y=Xo.applyArabicShaping(y)),y}(f.text,a,h)}),c}Wr([{name:"triangle",components:3,type:"Uint16"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wr([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wr([{type:"Float32",name:"offsetX"}]),Wr([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wr([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const E0={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var ai=24,v3=dr,_3=function(c,a,h,f,y){var S,T,E=8*y-f-1,I=(1<<E)-1,F=I>>1,j=-7,W=h?y-1:0,J=h?-1:1,ae=c[a+W];for(W+=J,S=ae&(1<<-j)-1,ae>>=-j,j+=E;j>0;S=256*S+c[a+W],W+=J,j-=8);for(T=S&(1<<-j)-1,S>>=-j,j+=f;j>0;T=256*T+c[a+W],W+=J,j-=8);if(S===0)S=1-F;else{if(S===I)return T?NaN:1/0*(ae?-1:1);T+=Math.pow(2,f),S-=F}return(ae?-1:1)*T*Math.pow(2,S-f)},x3=function(c,a,h,f,y,S){var T,E,I,F=8*S-y-1,j=(1<<F)-1,W=j>>1,J=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=f?0:S-1,oe=f?1:-1,pe=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(E=isNaN(a)?1:0,T=j):(T=Math.floor(Math.log(a)/Math.LN2),a*(I=Math.pow(2,-T))<1&&(T--,I*=2),(a+=T+W>=1?J/I:J*Math.pow(2,1-W))*I>=2&&(T++,I/=2),T+W>=j?(E=0,T=j):T+W>=1?(E=(a*I-1)*Math.pow(2,y),T+=W):(E=a*Math.pow(2,W-1)*Math.pow(2,y),T=0));y>=8;c[h+ae]=255&E,ae+=oe,E/=256,y-=8);for(T=T<<y|E,F+=y;F>0;c[h+ae]=255&T,ae+=oe,T/=256,F-=8);c[h+ae-oe]|=128*pe};function dr(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}dr.Varint=0,dr.Fixed64=1,dr.Bytes=2,dr.Fixed32=5;var f_=4294967296,b3=1/f_,w3=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function nl(c){return c.type===dr.Bytes?c.readVarint()+c.pos:c.pos+1}function Hh(c,a,h){return h?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function S3(c,a,h){var f=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));h.realloc(f);for(var y=h.pos-1;y>=c;y--)h.buf[y+f]=h.buf[y]}function RR(c,a){for(var h=0;h<c.length;h++)a.writeVarint(c[h])}function IR(c,a){for(var h=0;h<c.length;h++)a.writeSVarint(c[h])}function DR(c,a){for(var h=0;h<c.length;h++)a.writeFloat(c[h])}function kR(c,a){for(var h=0;h<c.length;h++)a.writeDouble(c[h])}function LR(c,a){for(var h=0;h<c.length;h++)a.writeBoolean(c[h])}function zR(c,a){for(var h=0;h<c.length;h++)a.writeFixed32(c[h])}function FR(c,a){for(var h=0;h<c.length;h++)a.writeSFixed32(c[h])}function NR(c,a){for(var h=0;h<c.length;h++)a.writeFixed64(c[h])}function OR(c,a){for(var h=0;h<c.length;h++)a.writeSFixed64(c[h])}function yg(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function Gh(c,a,h){c[h]=a,c[h+1]=a>>>8,c[h+2]=a>>>16,c[h+3]=a>>>24}function M3(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}dr.prototype={destroy:function(){this.buf=null},readFields:function(c,a,h){for(h=h||this.length;this.pos<h;){var f=this.readVarint(),y=f>>3,S=this.pos;this.type=7&f,c(y,a,this),this.pos===S&&this.skip(f)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=yg(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=M3(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=yg(this.buf,this.pos)+yg(this.buf,this.pos+4)*f_;return this.pos+=8,c},readSFixed64:function(){var c=yg(this.buf,this.pos)+M3(this.buf,this.pos+4)*f_;return this.pos+=8,c},readFloat:function(){var c=_3(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=_3(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,h,f=this.buf;return a=127&(h=f[this.pos++]),h<128?a:(a|=(127&(h=f[this.pos++]))<<7,h<128?a:(a|=(127&(h=f[this.pos++]))<<14,h<128?a:(a|=(127&(h=f[this.pos++]))<<21,h<128?a:function(y,S,T){var E,I,F=T.buf;if(E=(112&(I=F[T.pos++]))>>4,I<128||(E|=(127&(I=F[T.pos++]))<<3,I<128)||(E|=(127&(I=F[T.pos++]))<<10,I<128)||(E|=(127&(I=F[T.pos++]))<<17,I<128)||(E|=(127&(I=F[T.pos++]))<<24,I<128)||(E|=(1&(I=F[T.pos++]))<<31,I<128))return Hh(y,E,S);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(h=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&w3?function(h,f,y){return w3.decode(h.subarray(f,y))}(this.buf,a,c):function(h,f,y){for(var S="",T=f;T<y;){var E,I,F,j=h[T],W=null,J=j>239?4:j>223?3:j>191?2:1;if(T+J>y)break;J===1?j<128&&(W=j):J===2?(192&(E=h[T+1]))==128&&(W=(31&j)<<6|63&E)<=127&&(W=null):J===3?(I=h[T+2],(192&(E=h[T+1]))==128&&(192&I)==128&&((W=(15&j)<<12|(63&E)<<6|63&I)<=2047||W>=55296&&W<=57343)&&(W=null)):J===4&&(I=h[T+2],F=h[T+3],(192&(E=h[T+1]))==128&&(192&I)==128&&(192&F)==128&&((W=(15&j)<<18|(63&E)<<12|(63&I)<<6|63&F)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,J=1):W>65535&&(W-=65536,S+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),S+=String.fromCharCode(W),T+=J}return S}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==dr.Bytes)return c.push(this.readVarint(a));var h=nl(this);for(c=c||[];this.pos<h;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==dr.Bytes)return c.push(this.readSVarint());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==dr.Bytes)return c.push(this.readBoolean());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==dr.Bytes)return c.push(this.readFloat());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==dr.Bytes)return c.push(this.readDouble());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed32());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed32());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readFixed64());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==dr.Bytes)return c.push(this.readSFixed64());var a=nl(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===dr.Varint)for(;this.buf[this.pos++]>127;);else if(a===dr.Bytes)this.pos=this.readVarint()+this.pos;else if(a===dr.Fixed32)this.pos+=4;else{if(a!==dr.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var h=new Uint8Array(a);h.set(this.buf),this.buf=h,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),Gh(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),Gh(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),Gh(this.buf,-1&c,this.pos),Gh(this.buf,Math.floor(c*b3),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),Gh(this.buf,-1&c,this.pos),Gh(this.buf,Math.floor(c*b3),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,h){var f,y;if(a>=0?(f=a%4294967296|0,y=a/4294967296|0):(y=~(-a/4294967296),4294967295^(f=~(-a%4294967296))?f=f+1|0:(f=0,y=y+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");h.realloc(10),function(S,T,E){E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,S>>>=7,E.buf[E.pos++]=127&S|128,E.buf[E.pos]=127&(S>>>=7)}(f,0,h),function(S,T){var E=(7&S)<<4;T.buf[T.pos++]|=E|((S>>>=3)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S|((S>>>=7)?128:0),S&&(T.buf[T.pos++]=127&S)))))}(y,h)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(f,y,S){for(var T,E,I=0;I<y.length;I++){if((T=y.charCodeAt(I))>55295&&T<57344){if(!E){T>56319||I+1===y.length?(f[S++]=239,f[S++]=191,f[S++]=189):E=T;continue}if(T<56320){f[S++]=239,f[S++]=191,f[S++]=189,E=T;continue}T=E-55296<<10|T-56320|65536,E=null}else E&&(f[S++]=239,f[S++]=191,f[S++]=189,E=null);T<128?f[S++]=T:(T<2048?f[S++]=T>>6|192:(T<65536?f[S++]=T>>12|224:(f[S++]=T>>18|240,f[S++]=T>>12&63|128),f[S++]=T>>6&63|128),f[S++]=63&T|128)}return S}(this.buf,c,this.pos);var h=this.pos-a;h>=128&&S3(a,h,this),this.pos=a-1,this.writeVarint(h),this.pos+=h},writeFloat:function(c){this.realloc(4),x3(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),x3(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var h=0;h<a;h++)this.buf[this.pos++]=c[h]},writeRawMessage:function(c,a){this.pos++;var h=this.pos;c(a,this);var f=this.pos-h;f>=128&&S3(h,f,this),this.pos=h-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,a,h){this.writeTag(c,dr.Bytes),this.writeRawMessage(a,h)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,RR,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,IR,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,LR,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,DR,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,kR,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,zR,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,FR,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,NR,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,OR,a)},writeBytesField:function(c,a){this.writeTag(c,dr.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,dr.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,dr.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,dr.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,dr.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,dr.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,dr.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var p_=p(v3);const m_=3;function BR(c,a,h){c===1&&h.readMessage(UR,a)}function UR(c,a,h){if(c===3){const{id:f,bitmap:y,width:S,height:T,left:E,top:I,advance:F}=h.readMessage(VR,{});a.push({id:f,bitmap:new _0({width:S+2*m_,height:T+2*m_},y),metrics:{width:S,height:T,left:E,top:I,advance:F}})}}function VR(c,a,h){c===1?a.id=h.readVarint():c===2?a.bitmap=h.readBytes():c===3?a.width=h.readVarint():c===4?a.height=h.readVarint():c===5?a.left=h.readSVarint():c===6?a.top=h.readSVarint():c===7&&(a.advance=h.readVarint())}const T3=m_;function E3(c){let a=0,h=0;for(const T of c)a+=T.w*T.h,h=Math.max(h,T.w);c.sort((T,E)=>E.h-T.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),h),h:1/0}];let y=0,S=0;for(const T of c)for(let E=f.length-1;E>=0;E--){const I=f[E];if(!(T.w>I.w||T.h>I.h)){if(T.x=I.x,T.y=I.y,S=Math.max(S,T.y+T.h),y=Math.max(y,T.x+T.w),T.w===I.w&&T.h===I.h){const F=f.pop();E<f.length&&(f[E]=F)}else T.h===I.h?(I.x+=T.w,I.w-=T.w):T.w===I.w?(I.y+=T.h,I.h-=T.h):(f.push({x:I.x+T.w,y:I.y,w:I.w-T.w,h:T.h}),I.y+=T.h,I.h-=T.h);break}}return{w:y,h:S,fill:a/(y*S)||0}}const ga=1;class g_{constructor(a,{pixelRatio:h,version:f,stretchX:y,stretchY:S,content:T}){this.paddedRect=a,this.pixelRatio=h,this.stretchX=y,this.stretchY=S,this.content=T,this.version=f}get tl(){return[this.paddedRect.x+ga,this.paddedRect.y+ga]}get br(){return[this.paddedRect.x+this.paddedRect.w-ga,this.paddedRect.y+this.paddedRect.h-ga]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ga)/this.pixelRatio,(this.paddedRect.h-2*ga)/this.pixelRatio]}}class A3{constructor(a,h){const f={},y={};this.haveRenderCallbacks=[];const S=[];this.addImages(a,f,S),this.addImages(h,y,S);const{w:T,h:E}=E3(S),I=new Ja({width:T||1,height:E||1});for(const F in a){const j=a[F],W=f[F].paddedRect;Ja.copy(j.data,I,{x:0,y:0},{x:W.x+ga,y:W.y+ga},j.data)}for(const F in h){const j=h[F],W=y[F].paddedRect,J=W.x+ga,ae=W.y+ga,oe=j.data.width,pe=j.data.height;Ja.copy(j.data,I,{x:0,y:0},{x:J,y:ae},j.data),Ja.copy(j.data,I,{x:0,y:pe-1},{x:J,y:ae-1},{width:oe,height:1}),Ja.copy(j.data,I,{x:0,y:0},{x:J,y:ae+pe},{width:oe,height:1}),Ja.copy(j.data,I,{x:oe-1,y:0},{x:J-1,y:ae},{width:1,height:pe}),Ja.copy(j.data,I,{x:0,y:0},{x:J+oe,y:ae},{width:1,height:pe})}this.image=I,this.iconPositions=f,this.patternPositions=y}addImages(a,h,f){for(const y in a){const S=a[y],T={x:0,y:0,w:S.data.width+2*ga,h:S.data.height+2*ga};f.push(T),h[y]=new g_(T,S),S.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,h){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in a.updatedImages)this.patchUpdatedImage(this.iconPositions[f],a.getImage(f),h),this.patchUpdatedImage(this.patternPositions[f],a.getImage(f),h)}patchUpdatedImage(a,h,f){if(!a||!h||a.version===h.version)return;a.version=h.version;const[y,S]=a.tl;f.update(h.data,void 0,{x:y,y:S})}}var ac;en("ImagePosition",g_),en("ImageAtlas",A3),u.ah=void 0,(ac=u.ah||(u.ah={}))[ac.none=0]="none",ac[ac.horizontal=1]="horizontal",ac[ac.vertical=2]="vertical",ac[ac.horizontalOnly=3]="horizontalOnly";const A0=-17;class C0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,h){const f=new C0;return f.scale=a||1,f.fontStack=h,f}static forImage(a){const h=new C0;return h.imageName=a,h}}class jh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,h){const f=new jh;for(let y=0;y<a.sections.length;y++){const S=a.sections[y];S.image?f.addImageSection(S):f.addTextSection(S,h)}return f}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let h="";for(let f=0;f<a.length;f++){const y=a.charCodeAt(f+1)||null,S=a.charCodeAt(f-1)||null;h+=y&&Jf(y)&&!E0[a[f+1]]||S&&Jf(S)&&!E0[a[f-1]]||!E0[a[f]]?a[f]:E0[a[f]]}return h}(this.text)}trim(){let a=0;for(let f=0;f<this.text.length&&_g[this.text.charCodeAt(f)];f++)a++;let h=this.text.length;for(let f=this.text.length-1;f>=0&&f>=a&&_g[this.text.charCodeAt(f)];f--)h--;this.text=this.text.substring(a,h),this.sectionIndex=this.sectionIndex.slice(a,h)}substring(a,h){const f=new jh;return f.text=this.text.substring(a,h),f.sectionIndex=this.sectionIndex.slice(a,h),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,h)=>Math.max(a,this.sections[h].scale),0)}addTextSection(a,h){this.text+=a.text,this.sections.push(C0.forText(a.scale,a.fontStack||h));const f=this.sections.length-1;for(let y=0;y<a.text.length;++y)this.sectionIndex.push(f)}addImageSection(a){const h=a.image?a.image.name:"";if(h.length===0)return void Ae("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(C0.forImage(h)),this.sectionIndex.push(this.sections.length-1)):Ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function vg(c,a,h,f,y,S,T,E,I,F,j,W,J,ae,oe,pe){const xe=jh.fromFeature(c,y);let Pe;W===u.ah.vertical&&xe.verticalizePunctuation();const{processBidirectionalText:He,processStyledBidirectionalText:De}=Xo;if(He&&xe.sections.length===1){Pe=[];const gt=He(xe.toString(),y_(xe,F,S,a,f,ae,oe));for(const Wt of gt){const un=new jh;un.text=Wt,un.sections=xe.sections;for(let Gt=0;Gt<Wt.length;Gt++)un.sectionIndex.push(0);Pe.push(un)}}else if(De){Pe=[];const gt=De(xe.text,xe.sectionIndex,y_(xe,F,S,a,f,ae,oe));for(const Wt of gt){const un=new jh;un.text=Wt[0],un.sectionIndex=Wt[1],un.sections=xe.sections,Pe.push(un)}}else Pe=function(gt,Wt){const un=[],Gt=gt.text;let Vt=0;for(const Rt of Wt)un.push(gt.substring(Vt,Rt)),Vt=Rt;return Vt<Gt.length&&un.push(gt.substring(Vt,Gt.length)),un}(xe,y_(xe,F,S,a,f,ae,oe));const Ne=[],ht={positionedLines:Ne,text:xe.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(gt,Wt,un,Gt,Vt,Rt,sn,Bt,Tt,vn,dn,jn){let Sr=0,Cr=A0,si=0,za=0;const Qi=Bt==="right"?1:Bt==="left"?0:.5;let ei=0;for(const oi of Vt){oi.trim();const li=oi.getMaxScale(),Oi=(li-1)*ai,na={positionedGlyphs:[],lineOffset:0};gt.positionedLines[ei]=na;const Bi=na.positionedGlyphs;let ya=0;if(!oi.length()){Cr+=Rt,++ei;continue}for(let ci=0;ci<oi.length();ci++){const Zn=oi.getSection(ci),Ui=oi.getSectionIndex(ci),Di=oi.getCharCode(ci);let ui=0,ws=null,Hs=null,Gs=null,rl=ai;const Ss=!(Tt===u.ah.horizontal||!dn&&!Ph(Di)||dn&&(_g[Di]||(bi=Di,$t.Arabic(bi)||$t["Arabic Supplement"](bi)||$t["Arabic Extended-A"](bi)||$t["Arabic Presentation Forms-A"](bi)||$t["Arabic Presentation Forms-B"](bi))));if(Zn.imageName){const es=Gt[Zn.imageName];if(!es)continue;Gs=Zn.imageName,gt.iconsInText=gt.iconsInText||!0,Hs=es.paddedRect;const _a=es.displaySize;Zn.scale=Zn.scale*ai/jn,ws={width:_a[0],height:_a[1],left:ga,top:-T3,advance:Ss?_a[1]:_a[0]},ui=Oi+(ai-_a[1]*Zn.scale),rl=ws.advance;const il=Ss?_a[0]*Zn.scale-ai*li:_a[1]*Zn.scale-ai*li;il>0&&il>ya&&(ya=il)}else{const es=un[Zn.fontStack],_a=es&&es[Di];if(_a&&_a.rect)Hs=_a.rect,ws=_a.metrics;else{const il=Wt[Zn.fontStack],k0=il&&il[Di];if(!k0)continue;ws=k0.metrics}ui=(li-Zn.scale)*ai}Ss?(gt.verticalizable=!0,Bi.push({glyph:Di,imageName:Gs,x:Sr,y:Cr+ui,vertical:Ss,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Ui,metrics:ws,rect:Hs}),Sr+=rl*Zn.scale+vn):(Bi.push({glyph:Di,imageName:Gs,x:Sr,y:Cr+ui,vertical:Ss,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Ui,metrics:ws,rect:Hs}),Sr+=ws.advance*Zn.scale+vn)}Bi.length!==0&&(si=Math.max(Sr-vn,si),jR(Bi,0,Bi.length-1,Qi,ya)),Sr=0;const va=Rt*li+ya;na.lineOffset=Math.max(ya,Oi),Cr+=va,za=Math.max(va,za),++ei}var bi;const Ii=Cr-A0,{horizontalAlign:ea,verticalAlign:ta}=v_(sn);(function(oi,li,Oi,na,Bi,ya,va,ci,Zn){const Ui=(li-Oi)*Bi;let Di=0;Di=ya!==va?-ci*na-A0:(-na*Zn+.5)*va;for(const ui of oi)for(const ws of ui.positionedGlyphs)ws.x+=Ui,ws.y+=Di})(gt.positionedLines,Qi,ea,ta,si,za,Rt,Ii,Vt.length),gt.top+=-ta*Ii,gt.bottom=gt.top+Ii,gt.left+=-ea*si,gt.right=gt.left+si}(ht,a,h,f,Pe,T,E,I,W,F,J,pe),!function(gt){for(const Wt of gt)if(Wt.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ht}const _g={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},HR={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function C3(c,a,h,f,y,S){if(a.imageName){const T=f[a.imageName];return T?T.displaySize[0]*a.scale*ai/S+y:0}{const T=h[a.fontStack],E=T&&T[c];return E?E.metrics.advance*a.scale+y:0}}function P3(c,a,h,f){const y=Math.pow(c-a,2);return f?c<a?y/2:2*y:y+Math.abs(h)*h}function GR(c,a,h){let f=0;return c===10&&(f-=1e4),h&&(f+=150),c!==40&&c!==65288||(f+=50),a!==41&&a!==65289||(f+=50),f}function R3(c,a,h,f,y,S){let T=null,E=P3(a,h,y,S);for(const I of f){const F=P3(a-I.x,h,y,S)+I.badness;F<=E&&(T=I,E=F)}return{index:c,x:a,priorBreak:T,badness:E}}function I3(c){return c?I3(c.priorBreak).concat(c.index):[]}function y_(c,a,h,f,y,S,T){if(S!=="point")return[];if(!c)return[];const E=[],I=function(J,ae,oe,pe,xe,Pe){let He=0;for(let De=0;De<J.length();De++){const Ne=J.getSection(De);He+=C3(J.getCharCode(De),Ne,pe,xe,ae,Pe)}return He/Math.max(1,Math.ceil(He/oe))}(c,a,h,f,y,T),F=c.text.indexOf("")>=0;let j=0;for(let J=0;J<c.length();J++){const ae=c.getSection(J),oe=c.getCharCode(J);if(_g[oe]||(j+=C3(oe,ae,f,y,a,T)),J<c.length()-1){const pe=!((W=oe)<11904||!($t["Bopomofo Extended"](W)||$t.Bopomofo(W)||$t["CJK Compatibility Forms"](W)||$t["CJK Compatibility Ideographs"](W)||$t["CJK Compatibility"](W)||$t["CJK Radicals Supplement"](W)||$t["CJK Strokes"](W)||$t["CJK Symbols and Punctuation"](W)||$t["CJK Unified Ideographs Extension A"](W)||$t["CJK Unified Ideographs"](W)||$t["Enclosed CJK Letters and Months"](W)||$t["Halfwidth and Fullwidth Forms"](W)||$t.Hiragana(W)||$t["Ideographic Description Characters"](W)||$t["Kangxi Radicals"](W)||$t["Katakana Phonetic Extensions"](W)||$t.Katakana(W)||$t["Vertical Forms"](W)||$t["Yi Radicals"](W)||$t["Yi Syllables"](W)));(HR[oe]||pe||ae.imageName)&&E.push(R3(J+1,j,I,E,GR(oe,c.getCharCode(J+1),pe&&F),!1))}}var W;return I3(R3(c.length(),j,I,E,0,!0))}function v_(c){let a=.5,h=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":h=1;break;case"top":case"top-right":case"top-left":h=0}return{horizontalAlign:a,verticalAlign:h}}function jR(c,a,h,f,y){if(!f&&!y)return;const S=c[h],T=(c[h].x+S.metrics.advance*S.scale)*f;for(let E=a;E<=h;E++)c[E].x-=T,c[E].y+=y}function WR(c,a,h){const{horizontalAlign:f,verticalAlign:y}=v_(h),S=a[0]-c.displaySize[0]*f,T=a[1]-c.displaySize[1]*y;return{image:c,top:T,bottom:T+c.displaySize[1],left:S,right:S+c.displaySize[0]}}function D3(c,a,h,f,y,S){const T=c.image;let E;if(T.content){const xe=T.content,Pe=T.pixelRatio||1;E=[xe[0]/Pe,xe[1]/Pe,T.displaySize[0]-xe[2]/Pe,T.displaySize[1]-xe[3]/Pe]}const I=a.left*S,F=a.right*S;let j,W,J,ae;h==="width"||h==="both"?(ae=y[0]+I-f[3],W=y[0]+F+f[1]):(ae=y[0]+(I+F-T.displaySize[0])/2,W=ae+T.displaySize[0]);const oe=a.top*S,pe=a.bottom*S;return h==="height"||h==="both"?(j=y[1]+oe-f[0],J=y[1]+pe+f[2]):(j=y[1]+(oe+pe-T.displaySize[1])/2,J=j+T.displaySize[1]),{image:T,top:j,right:W,bottom:J,left:ae,collisionPadding:E}}const P0=255,vo=128,sc=P0*vo;function k3(c,a){const{expression:h}=a;if(h.kind==="constant")return{kind:"constant",layoutSize:h.evaluate(new br(c+1))};if(h.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=h;let S=0;for(;S<f.length&&f[S]<=c;)S++;S=Math.max(0,S-1);let T=S;for(;T<f.length&&f[T]<c+1;)T++;T=Math.min(f.length-1,T);const E=f[S],I=f[T];return h.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:I,interpolationType:y}:{kind:"camera",minZoom:E,maxZoom:I,minSize:h.evaluate(new br(E)),maxSize:h.evaluate(new br(I)),interpolationType:y}}}function __(c,a,h){let f="never";const y=c.get(a);return y?f=y:c.get(h)&&(f="always"),f}const $R=ic.VectorTileFeature.types,qR=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xg(c,a,h,f,y,S,T,E,I,F,j,W,J){const ae=E?Math.min(sc,Math.round(E[0])):0,oe=E?Math.min(sc,Math.round(E[1])):0;c.emplaceBack(a,h,Math.round(32*f),Math.round(32*y),S,T,(ae<<1)+(I?1:0),oe,16*F,16*j,256*W,256*J)}function x_(c,a,h){c.emplaceBack(a.x,a.y,h),c.emplaceBack(a.x,a.y,h),c.emplaceBack(a.x,a.y,h),c.emplaceBack(a.x,a.y,h)}function XR(c){for(const a of c.sections)if(Qm(a.text))return!0;return!1}class b_{constructor(a){this.layoutVertexArray=new ze,this.indexArray=new Qe,this.programConfigurations=a,this.segments=new xt,this.dynamicLayoutVertexArray=new qe,this.opacityVertexArray=new Me,this.hasVisibleVertices=!1,this.placedSymbolArray=new s}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,h,f,y){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,TR.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,h),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,ER.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,qR,!0),this.opacityVertexBuffer.itemSize=1),(f||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}en("SymbolBuffers",b_);class w_{constructor(a,h,f){this.layoutVertexArray=new a,this.layoutAttributes=h,this.indexArray=new f,this.segments=new xt,this.collisionVertexArray=new Ke}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,AR.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}en("CollisionBuffers",w_);class Wh{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(T=>T.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Qv([]),this.placementViewportMatrix=Qv([]);const h=this.layers[0]._unevaluatedLayout._values;this.textSizeData=k3(this.zoom,h["text-size"]),this.iconSizeData=k3(this.zoom,h["icon-size"]);const f=this.layers[0].layout,y=f.get("symbol-sort-key"),S=f.get("symbol-z-order");this.canOverlap=__(f,"text-overlap","text-allow-overlap")!=="never"||__(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=S!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(S==="viewport-y"||S==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(T=>u.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=a.sourceID}createArrays(){this.text=new b_(new Ar(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new b_(new Ar(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new g,this.lineVertexArray=new b,this.symbolInstances=new m,this.textAnchorOffsets=new R}calculateGlyphDependencies(a,h,f,y,S){for(let T=0;T<a.length;T++)if(h[a.charCodeAt(T)]=!0,(f||y)&&S){const E=E0[a.charAt(T)];E&&(h[E.charCodeAt(0)]=!0)}}populate(a,h,f){const y=this.layers[0],S=y.layout,T=S.get("text-font"),E=S.get("text-field"),I=S.get("icon-image"),F=(E.value.kind!=="constant"||E.value.value instanceof gr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),j=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,W=S.get("symbol-sort-key");if(this.features=[],!F&&!j)return;const J=h.iconDependencies,ae=h.glyphDependencies,oe=h.availableImages,pe=new br(this.zoom);for(const{feature:xe,id:Pe,index:He,sourceLayerIndex:De}of a){const Ne=y._featureFilter.needGeometry,ht=el(xe,Ne);if(!y._featureFilter.filter(pe,ht,f))continue;let gt,Wt;if(Ne||(ht.geometry=Qo(xe)),F){const Gt=y.getValueAndResolveTokens("text-field",ht,f,oe),Vt=gr.factory(Gt),Rt=this.hasRTLText=this.hasRTLText||XR(Vt);(!Rt||Xo.getRTLTextPluginStatus()==="unavailable"||Rt&&Xo.isParsed())&&(gt=PR(Vt,y,ht))}if(j){const Gt=y.getValueAndResolveTokens("icon-image",ht,f,oe);Wt=Gt instanceof Pn?Gt:Pn.fromString(Gt)}if(!gt&&!Wt)continue;const un=this.sortFeaturesByKey?W.evaluate(ht,{},f):void 0;if(this.features.push({id:Pe,text:gt,icon:Wt,index:He,sourceLayerIndex:De,geometry:ht.geometry,properties:xe.properties,type:$R[xe.type],sortKey:un}),Wt&&(J[Wt.name]=!0),gt){const Gt=T.evaluate(ht,{},f).join(","),Vt=S.get("text-rotation-alignment")!=="viewport"&&S.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.ah.vertical)>=0;for(const Rt of gt.sections)if(Rt.image)J[Rt.image.name]=!0;else{const sn=fu(gt.toString()),Bt=Rt.fontStack||Gt,Tt=ae[Bt]=ae[Bt]||{};this.calculateGlyphDependencies(Rt.text,Tt,Vt,this.allowVerticalPlacement,sn)}}}S.get("symbol-placement")==="line"&&(this.features=function(xe){const Pe={},He={},De=[];let Ne=0;function ht(Gt){De.push(xe[Gt]),Ne++}function gt(Gt,Vt,Rt){const sn=He[Gt];return delete He[Gt],He[Vt]=sn,De[sn].geometry[0].pop(),De[sn].geometry[0]=De[sn].geometry[0].concat(Rt[0]),sn}function Wt(Gt,Vt,Rt){const sn=Pe[Vt];return delete Pe[Vt],Pe[Gt]=sn,De[sn].geometry[0].shift(),De[sn].geometry[0]=Rt[0].concat(De[sn].geometry[0]),sn}function un(Gt,Vt,Rt){const sn=Rt?Vt[0][Vt[0].length-1]:Vt[0][0];return`${Gt}:${sn.x}:${sn.y}`}for(let Gt=0;Gt<xe.length;Gt++){const Vt=xe[Gt],Rt=Vt.geometry,sn=Vt.text?Vt.text.toString():null;if(!sn){ht(Gt);continue}const Bt=un(sn,Rt),Tt=un(sn,Rt,!0);if(Bt in He&&Tt in Pe&&He[Bt]!==Pe[Tt]){const vn=Wt(Bt,Tt,Rt),dn=gt(Bt,Tt,De[vn].geometry);delete Pe[Bt],delete He[Tt],He[un(sn,De[dn].geometry,!0)]=dn,De[vn].geometry=null}else Bt in He?gt(Bt,Tt,Rt):Tt in Pe?Wt(Bt,Tt,Rt):(ht(Gt),Pe[Bt]=Ne-1,He[Tt]=Ne-1)}return De.filter(Gt=>Gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((xe,Pe)=>xe.sortKey-Pe.sortKey)}update(a,h,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,h,this.layers,f),this.icon.programConfigurations.updatePaintArrays(a,h,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,h){const f=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(h[a.segment+1]),S=a.dist(h[a.segment]);const T={};for(let E=a.segment+1;E<h.length;E++)T[E]={x:h[E].x,y:h[E].y,tileUnitDistanceFromAnchor:y},E<h.length-1&&(y+=h[E+1].dist(h[E]));for(let E=a.segment||0;E>=0;E--)T[E]={x:h[E].x,y:h[E].y,tileUnitDistanceFromAnchor:S},E>0&&(S+=h[E-1].dist(h[E]));for(let E=0;E<h.length;E++){const I=T[E];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(a,h,f,y,S,T,E,I,F,j,W,J){const ae=a.indexArray,oe=a.layoutVertexArray,pe=a.segments.prepareSegment(4*h.length,oe,ae,this.canOverlap?T.sortKey:void 0),xe=this.glyphOffsetArray.length,Pe=pe.vertexLength,He=this.allowVerticalPlacement&&E===u.ah.vertical?Math.PI/2:0,De=T.text&&T.text.sections;for(let Ne=0;Ne<h.length;Ne++){const{tl:ht,tr:gt,bl:Wt,br:un,tex:Gt,pixelOffsetTL:Vt,pixelOffsetBR:Rt,minFontScaleX:sn,minFontScaleY:Bt,glyphOffset:Tt,isSDF:vn,sectionIndex:dn}=h[Ne],jn=pe.vertexLength,Sr=Tt[1];xg(oe,I.x,I.y,ht.x,Sr+ht.y,Gt.x,Gt.y,f,vn,Vt.x,Vt.y,sn,Bt),xg(oe,I.x,I.y,gt.x,Sr+gt.y,Gt.x+Gt.w,Gt.y,f,vn,Rt.x,Vt.y,sn,Bt),xg(oe,I.x,I.y,Wt.x,Sr+Wt.y,Gt.x,Gt.y+Gt.h,f,vn,Vt.x,Rt.y,sn,Bt),xg(oe,I.x,I.y,un.x,Sr+un.y,Gt.x+Gt.w,Gt.y+Gt.h,f,vn,Rt.x,Rt.y,sn,Bt),x_(a.dynamicLayoutVertexArray,I,He),ae.emplaceBack(jn,jn+1,jn+2),ae.emplaceBack(jn+1,jn+2,jn+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Ne!==h.length-1&&dn===h[Ne+1].sectionIndex||a.programConfigurations.populatePaintArrays(oe.length,T,T.index,{},J,De&&De[dn])}a.placedSymbolArray.emplaceBack(I.x,I.y,xe,this.glyphOffsetArray.length-xe,Pe,F,j,I.segment,f?f[0]:0,f?f[1]:0,y[0],y[1],E,0,!1,0,W)}_addCollisionDebugVertex(a,h,f,y,S,T){return h.emplaceBack(0,0),a.emplaceBack(f.x,f.y,y,S,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,h,f,y,S,T,E){const I=S.segments.prepareSegment(4,S.layoutVertexArray,S.indexArray),F=I.vertexLength,j=S.layoutVertexArray,W=S.collisionVertexArray,J=E.anchorX,ae=E.anchorY;this._addCollisionDebugVertex(j,W,T,J,ae,new M(a,h)),this._addCollisionDebugVertex(j,W,T,J,ae,new M(f,h)),this._addCollisionDebugVertex(j,W,T,J,ae,new M(f,y)),this._addCollisionDebugVertex(j,W,T,J,ae,new M(a,y)),I.vertexLength+=4;const oe=S.indexArray;oe.emplaceBack(F,F+1),oe.emplaceBack(F+1,F+2),oe.emplaceBack(F+2,F+3),oe.emplaceBack(F+3,F),I.primitiveLength+=4}addDebugCollisionBoxes(a,h,f,y){for(let S=a;S<h;S++){const T=this.collisionBoxArray.get(S);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new w_(Oe,y3.members,ot),this.iconCollisionBox=new w_(Oe,y3.members,ot);for(let a=0;a<this.symbolInstances.length;a++){const h=this.symbolInstances.get(a);this.addDebugCollisionBoxes(h.textBoxStartIndex,h.textBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.verticalTextBoxStartIndex,h.verticalTextBoxEndIndex,h,!0),this.addDebugCollisionBoxes(h.iconBoxStartIndex,h.iconBoxEndIndex,h,!1),this.addDebugCollisionBoxes(h.verticalIconBoxStartIndex,h.verticalIconBoxEndIndex,h,!1)}}_deserializeCollisionBoxesForSymbol(a,h,f,y,S,T,E,I,F){const j={};for(let W=h;W<f;W++){const J=a.get(W);j.textBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.textFeatureIndex=J.featureIndex;break}for(let W=y;W<S;W++){const J=a.get(W);j.verticalTextBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.verticalTextFeatureIndex=J.featureIndex;break}for(let W=T;W<E;W++){const J=a.get(W);j.iconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.iconFeatureIndex=J.featureIndex;break}for(let W=I;W<F;W++){const J=a.get(W);j.verticalIconBox={x1:J.x1,y1:J.y1,x2:J.x2,y2:J.y2,anchorPointX:J.anchorPointX,anchorPointY:J.anchorPointY},j.verticalIconFeatureIndex=J.featureIndex;break}return j}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let h=0;h<this.symbolInstances.length;h++){const f=this.symbolInstances.get(h);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,h){const f=a.placedSymbolArray.get(h),y=f.vertexStartIndex+4*f.numGlyphs;for(let S=f.vertexStartIndex;S<y;S+=4)a.indexArray.emplaceBack(S,S+1,S+2),a.indexArray.emplaceBack(S+1,S+2,S+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const h=Math.sin(a),f=Math.cos(a),y=[],S=[],T=[];for(let E=0;E<this.symbolInstances.length;++E){T.push(E);const I=this.symbolInstances.get(E);y.push(0|Math.round(h*I.anchorX+f*I.anchorY)),S.push(I.featureIndex)}return T.sort((E,I)=>y[E]-y[I]||S[I]-S[E]),T}addToSortKeyRanges(a,h){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===h?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:h,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const h of this.symbolInstanceIndexes){const f=this.symbolInstances.get(h);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((y,S,T)=>{y>=0&&T.indexOf(y)===S&&this.addIndicesForPlacedSymbol(this.text,y)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let L3,z3;en("SymbolBucket",Wh,{omit:["layers","collisionBoxArray","features","compareText"]}),Wh.MAX_GLYPHS=65535,Wh.addDynamicAttributes=x_;var S_={get paint(){return z3=z3||new Yi({"icon-opacity":new Mn(re.paint_symbol["icon-opacity"]),"icon-color":new Mn(re.paint_symbol["icon-color"]),"icon-halo-color":new Mn(re.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mn(re.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mn(re.paint_symbol["icon-halo-blur"]),"icon-translate":new pn(re.paint_symbol["icon-translate"]),"icon-translate-anchor":new pn(re.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mn(re.paint_symbol["text-opacity"]),"text-color":new Mn(re.paint_symbol["text-color"],{runtimeType:Jt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Mn(re.paint_symbol["text-halo-color"]),"text-halo-width":new Mn(re.paint_symbol["text-halo-width"]),"text-halo-blur":new Mn(re.paint_symbol["text-halo-blur"]),"text-translate":new pn(re.paint_symbol["text-translate"]),"text-translate-anchor":new pn(re.paint_symbol["text-translate-anchor"])})},get layout(){return L3=L3||new Yi({"symbol-placement":new pn(re.layout_symbol["symbol-placement"]),"symbol-spacing":new pn(re.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pn(re.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mn(re.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pn(re.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pn(re.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pn(re.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pn(re.layout_symbol["icon-ignore-placement"]),"icon-optional":new pn(re.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pn(re.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mn(re.layout_symbol["icon-size"]),"icon-text-fit":new pn(re.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pn(re.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mn(re.layout_symbol["icon-image"]),"icon-rotate":new Mn(re.layout_symbol["icon-rotate"]),"icon-padding":new Mn(re.layout_symbol["icon-padding"]),"icon-keep-upright":new pn(re.layout_symbol["icon-keep-upright"]),"icon-offset":new Mn(re.layout_symbol["icon-offset"]),"icon-anchor":new Mn(re.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pn(re.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pn(re.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pn(re.layout_symbol["text-rotation-alignment"]),"text-field":new Mn(re.layout_symbol["text-field"]),"text-font":new Mn(re.layout_symbol["text-font"]),"text-size":new Mn(re.layout_symbol["text-size"]),"text-max-width":new Mn(re.layout_symbol["text-max-width"]),"text-line-height":new pn(re.layout_symbol["text-line-height"]),"text-letter-spacing":new Mn(re.layout_symbol["text-letter-spacing"]),"text-justify":new Mn(re.layout_symbol["text-justify"]),"text-radial-offset":new Mn(re.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pn(re.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mn(re.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mn(re.layout_symbol["text-anchor"]),"text-max-angle":new pn(re.layout_symbol["text-max-angle"]),"text-writing-mode":new pn(re.layout_symbol["text-writing-mode"]),"text-rotate":new Mn(re.layout_symbol["text-rotate"]),"text-padding":new pn(re.layout_symbol["text-padding"]),"text-keep-upright":new pn(re.layout_symbol["text-keep-upright"]),"text-transform":new Mn(re.layout_symbol["text-transform"]),"text-offset":new Mn(re.layout_symbol["text-offset"]),"text-allow-overlap":new pn(re.layout_symbol["text-allow-overlap"]),"text-overlap":new pn(re.layout_symbol["text-overlap"]),"text-ignore-placement":new pn(re.layout_symbol["text-ignore-placement"]),"text-optional":new pn(re.layout_symbol["text-optional"])})}};class F3{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Un,this.defaultValue=a}evaluate(a){if(a.formattedSection){const h=this.defaultValue.property.overrides;if(h&&h.hasOverride(a.formattedSection))return h.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}en("FormatSectionOverride",F3,{omit:["defaultValue"]});class bg extends Za{constructor(a){super(a,S_)}recalculate(a,h){if(super.recalculate(a,h),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const y=[];for(const S of f)y.indexOf(S)<0&&y.push(S);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,h,f,y){const S=this.layout.get(a).evaluate(h,{},f,y),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||yr(T.value)||!S?S:function(E,I){return I.replace(/{([^{}]+)}/g,(F,j)=>E&&j in E?String(E[j]):"")}(h.properties,S)}createBucket(a){return new Wh(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of S_.paint.overridableProperties){if(!bg.hasPaintOverride(this.layout,a))continue;const h=this.paint.get(a),f=new F3(h),y=new cu(f,h.property.specification);let S=null;S=h.value.kind==="constant"||h.value.kind==="source"?new $l("source",y):new wh("composite",y,h.value.zoomStops),this.paint._values[a]=new Xa(h.property,S,h.parameters)}}_handleOverridablePaintPropertyUpdate(a,h,f){return!(!this.layout||h.isDataDriven()||f.isDataDriven())&&bg.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,h){const f=a.get("text-field"),y=S_.paint.properties[h];let S=!1;const T=E=>{for(const I of E)if(y.overrides&&y.overrides.hasOverride(I))return void(S=!0)};if(f.value.kind==="constant"&&f.value.value instanceof gr)T(f.value.value.sections);else if(f.value.kind==="source"){const E=F=>{S||(F instanceof da&&fr(F.value)===kt?T(F.value.sections):F instanceof bh?T(F.sections):F.eachChild(E))},I=f.value;I._styleExpression&&E(I._styleExpression.expression)}return S}}let N3;var ZR={get paint(){return N3=N3||new Yi({"background-color":new pn(re.paint_background["background-color"]),"background-pattern":new r0(re.paint_background["background-pattern"]),"background-opacity":new pn(re.paint_background["background-opacity"])})}};class YR extends Za{constructor(a){super(a,ZR)}}let O3;var KR={get paint(){return O3=O3||new Yi({"raster-opacity":new pn(re.paint_raster["raster-opacity"]),"raster-hue-rotate":new pn(re.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pn(re.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pn(re.paint_raster["raster-brightness-max"]),"raster-saturation":new pn(re.paint_raster["raster-saturation"]),"raster-contrast":new pn(re.paint_raster["raster-contrast"]),"raster-resampling":new pn(re.paint_raster["raster-resampling"]),"raster-fade-duration":new pn(re.paint_raster["raster-fade-duration"])})}};class JR extends Za{constructor(a){super(a,KR)}}class QR extends Za{constructor(a){super(a,{}),this.onAdd=h=>{this.implementation.onAdd&&this.implementation.onAdd(h,h.painter.context.gl)},this.onRemove=h=>{this.implementation.onRemove&&this.implementation.onRemove(h,h.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class e9{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const M_=63710088e-1;class oc{constructor(a,h){if(isNaN(a)||isNaN(h))throw new Error(`Invalid LngLat object: (${a}, ${h})`);if(this.lng=+a,this.lat=+h,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new oc(Z(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const h=Math.PI/180,f=this.lat*h,y=a.lat*h,S=Math.sin(f)*Math.sin(y)+Math.cos(f)*Math.cos(y)*Math.cos((a.lng-this.lng)*h);return M_*Math.acos(Math.min(S,1))}static convert(a){if(a instanceof oc)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new oc(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new oc(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const B3=2*Math.PI*M_;function U3(c){return B3*Math.cos(c*Math.PI/180)}function V3(c){return(180+c)/360}function H3(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function G3(c,a){return c/U3(a)}function T_(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class wg{constructor(a,h,f=0){this.x=+a,this.y=+h,this.z=+f}static fromLngLat(a,h=0){const f=oc.convert(a);return new wg(V3(f.lng),H3(f.lat),G3(h,f.lat))}toLngLat(){return new oc(360*this.x-180,T_(this.y))}toAltitude(){return this.z*U3(T_(this.y))}meterInMercatorCoordinateUnits(){return 1/B3*(a=T_(this.y),1/Math.cos(a*Math.PI/180));var a}}function j3(c,a,h){var f=2*Math.PI*6378137/256/Math.pow(2,h);return[c*f-2*Math.PI*6378137/2,a*f-2*Math.PI*6378137/2]}class E_{constructor(a,h,f){if(a<0||a>25||f<0||f>=Math.pow(2,a)||h<0||h>=Math.pow(2,a))throw new Error(`x=${h}, y=${f}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=h,this.y=f,this.key=R0(0,a,a,h,f)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,h,f){const y=(T=this.y,E=this.z,I=j3(256*(S=this.x),256*(T=Math.pow(2,E)-T-1),E),F=j3(256*(S+1),256*(T+1),E),I[0]+","+I[1]+","+F[0]+","+F[1]);var S,T,E,I,F;const j=function(W,J,ae){let oe,pe="";for(let xe=W;xe>0;xe--)oe=1<<xe-1,pe+=(J&oe?1:0)+(ae&oe?2:0);return pe}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,h>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const h=this.z-a.z;return h>0&&a.x===this.x>>h&&a.y===this.y>>h}getTilePoint(a){const h=Math.pow(2,this.z);return new M((a.x*h-this.x)*$n,(a.y*h-this.y)*$n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class W3{constructor(a,h){this.wrap=a,this.canonical=h,this.key=R0(a,h.z,h.z,h.x,h.y)}}class Qa{constructor(a,h,f,y,S){if(a<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${f}`);this.overscaledZ=a,this.wrap=h,this.canonical=new E_(f,+y,+S),this.key=R0(h,a,f,y,S)}clone(){return new Qa(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const h=this.canonical.z-a;return a>this.canonical.z?new Qa(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Qa(a,this.wrap,a,this.canonical.x>>h,this.canonical.y>>h)}calculateScaledKey(a,h){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?R0(this.wrap*+h,a,this.canonical.z,this.canonical.x,this.canonical.y):R0(this.wrap*+h,a,a,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const h=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>h&&a.canonical.y===this.canonical.y>>h}children(a){if(this.overscaledZ>=a)return[new Qa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const h=this.canonical.z+1,f=2*this.canonical.x,y=2*this.canonical.y;return[new Qa(h,this.wrap,h,f,y),new Qa(h,this.wrap,h,f+1,y),new Qa(h,this.wrap,h,f,y+1),new Qa(h,this.wrap,h,f+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Qa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Qa(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new W3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new wg(a.x-this.wrap,a.y))}}function R0(c,a,h,f,y){(c*=2)<0&&(c=-1*c-1);const S=1<<h;return(S*S*c+S*y+f).toString(36)+h.toString(36)+a.toString(36)}en("CanonicalTileID",E_),en("OverscaledTileID",Qa,{omit:["posMatrix"]});class $3{constructor(a,h,f,y=1,S=1,T=1,E=0){if(this.uid=a,h.height!==h.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ae(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=h.height;const I=this.dim=h.height-2;switch(this.data=new Uint32Array(h.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=S,this.blueFactor=T,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let F=0;F<I;F++)this.data[this._idx(-1,F)]=this.data[this._idx(0,F)],this.data[this._idx(I,F)]=this.data[this._idx(I-1,F)],this.data[this._idx(F,-1)]=this.data[this._idx(F,0)],this.data[this._idx(F,I)]=this.data[this._idx(F,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let F=0;F<I;F++)for(let j=0;j<I;j++){const W=this.get(F,j);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(a,h){const f=new Uint8Array(this.data.buffer),y=4*this._idx(a,h);return this.unpack(f[y],f[y+1],f[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,h){if(a<-1||a>=this.dim+1||h<-1||h>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(h+1)*this.stride+(a+1)}unpack(a,h,f){return a*this.redFactor+h*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Ja({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,h,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=h*this.dim,S=h*this.dim+this.dim,T=f*this.dim,E=f*this.dim+this.dim;switch(h){case-1:y=S-1;break;case 1:S=y+1}switch(f){case-1:T=E-1;break;case 1:E=T+1}const I=-h*this.dim,F=-f*this.dim;for(let j=T;j<E;j++)for(let W=y;W<S;W++)this.data[this._idx(W,j)]=a.data[this._idx(W+I,j+F)]}}en("DEMData",$3);class q3{constructor(a){this._stringToNumber={},this._numberToString=[];for(let h=0;h<a.length;h++){const f=a[h];this._stringToNumber[f]=h,this._numberToString[h]=f}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class X3{constructor(a,h,f,y,S){this.type="Feature",this._vectorTileFeature=a,a._z=h,a._x=f,a._y=y,this.properties=a.properties,this.id=S}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const h in this)h!=="_geometry"&&h!=="_vectorTileFeature"&&(a[h]=this[h]);return a}}class Z3{constructor(a,h){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Us($n,16,0),this.grid3D=new Us($n,16,0),this.featureIndexArray=new H,this.promoteId=h}insert(a,h,f,y,S,T){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,y,S);const I=T?this.grid3D:this.grid;for(let F=0;F<h.length;F++){const j=h[F],W=[1/0,1/0,-1/0,-1/0];for(let J=0;J<j.length;J++){const ae=j[J];W[0]=Math.min(W[0],ae.x),W[1]=Math.min(W[1],ae.y),W[2]=Math.max(W[2],ae.x),W[3]=Math.max(W[3],ae.y)}W[0]<$n&&W[1]<$n&&W[2]>=0&&W[3]>=0&&I.insert(E,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new ic.VectorTile(new p_(this.rawTileData)).layers,this.sourceLayerCoder=new q3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,h,f,y){this.loadVTLayers();const S=a.params||{},T=$n/a.tileSize/a.scale,E=Th(S.filter),I=a.queryGeometry,F=a.queryPadding*T,j=K3(I),W=this.grid.query(j.minX-F,j.minY-F,j.maxX+F,j.maxY+F),J=K3(a.cameraQueryGeometry),ae=this.grid3D.query(J.minX-F,J.minY-F,J.maxX+F,J.maxY+F,(xe,Pe,He,De)=>function(Ne,ht,gt,Wt,un){for(const Vt of Ne)if(ht<=Vt.x&&gt<=Vt.y&&Wt>=Vt.x&&un>=Vt.y)return!0;const Gt=[new M(ht,gt),new M(ht,un),new M(Wt,un),new M(Wt,gt)];if(Ne.length>2){for(const Vt of Gt)if(Oh(Ne,Vt))return!0}for(let Vt=0;Vt<Ne.length-1;Vt++)if(DP(Ne[Vt],Ne[Vt+1],Gt))return!0;return!1}(a.cameraQueryGeometry,xe-F,Pe-F,He+F,De+F));for(const xe of ae)W.push(xe);W.sort(t9);const oe={};let pe;for(let xe=0;xe<W.length;xe++){const Pe=W[xe];if(Pe===pe)continue;pe=Pe;const He=this.featureIndexArray.get(Pe);let De=null;this.loadMatchingFeature(oe,He.bucketIndex,He.sourceLayerIndex,He.featureIndex,E,S.layers,S.availableImages,h,f,y,(Ne,ht,gt)=>(De||(De=Qo(Ne)),ht.queryIntersectsFeature(I,Ne,gt,De,this.z,a.transform,T,a.pixelPosMatrix)))}return oe}loadMatchingFeature(a,h,f,y,S,T,E,I,F,j,W){const J=this.bucketLayerIDs[h];if(T&&!function(xe,Pe){for(let He=0;He<xe.length;He++)if(Pe.indexOf(xe[He])>=0)return!0;return!1}(T,J))return;const ae=this.sourceLayerCoder.decode(f),oe=this.vtLayers[ae].feature(y);if(S.needGeometry){const xe=el(oe,!0);if(!S.filter(new br(this.tileID.overscaledZ),xe,this.tileID.canonical))return}else if(!S.filter(new br(this.tileID.overscaledZ),oe))return;const pe=this.getId(oe,ae);for(let xe=0;xe<J.length;xe++){const Pe=J[xe];if(T&&T.indexOf(Pe)<0)continue;const He=I[Pe];if(!He)continue;let De={};pe&&j&&(De=j.getState(He.sourceLayer||"_geojsonTileLayer",pe));const Ne=ee({},F[Pe]);Ne.paint=Y3(Ne.paint,He.paint,oe,De,E),Ne.layout=Y3(Ne.layout,He.layout,oe,De,E);const ht=!W||W(oe,He,De);if(!ht)continue;const gt=new X3(oe,this.z,this.x,this.y,pe);gt.layer=Ne;let Wt=a[Pe];Wt===void 0&&(Wt=a[Pe]=[]),Wt.push({featureIndex:y,feature:gt,intersectionZ:ht})}}lookupSymbolFeatures(a,h,f,y,S,T,E,I){const F={};this.loadVTLayers();const j=Th(S);for(const W of a)this.loadMatchingFeature(F,f,y,W,j,T,E,I,h);return F}hasLayer(a){for(const h of this.bucketLayerIDs)for(const f of h)if(a===f)return!0;return!1}getId(a,h){let f=a.id;return this.promoteId&&(f=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[h]],typeof f=="boolean"&&(f=Number(f))),f}}function Y3(c,a,h,f,y){return ie(c,(S,T)=>{const E=a instanceof pu?a.get(T):null;return E&&E.evaluate?E.evaluate(h,f,y):E})}function K3(c){let a=1/0,h=1/0,f=-1/0,y=-1/0;for(const S of c)a=Math.min(a,S.x),h=Math.min(h,S.y),f=Math.max(f,S.x),y=Math.max(y,S.y);return{minX:a,minY:h,maxX:f,maxY:y}}function t9(c,a){return a-c}function J3(c,a,h,f,y){const S=[];for(let T=0;T<c.length;T++){const E=c[T];let I;for(let F=0;F<E.length-1;F++){let j=E[F],W=E[F+1];j.x<a&&W.x<a||(j.x<a?j=new M(a,j.y+(a-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<a&&(W=new M(a,j.y+(a-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<h&&W.y<h||(j.y<h?j=new M(j.x+(h-j.y)/(W.y-j.y)*(W.x-j.x),h)._round():W.y<h&&(W=new M(j.x+(h-j.y)/(W.y-j.y)*(W.x-j.x),h)._round()),j.x>=f&&W.x>=f||(j.x>=f?j=new M(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=f&&(W=new M(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=y&&W.y>=y||(j.y>=y?j=new M(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round():W.y>=y&&(W=new M(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round()),I&&j.equals(I[I.length-1])||(I=[j],S.push(I)),I.push(W)))))}}return S}en("FeatureIndex",Z3,{omit:["rawTileData","sourceLayerCoder"]});class lc extends M{constructor(a,h,f,y){super(a,h),this.angle=f,y!==void 0&&(this.segment=y)}clone(){return new lc(this.x,this.y,this.angle,this.segment)}}function Q3(c,a,h,f,y){if(a.segment===void 0||h===0)return!0;let S=a,T=a.segment+1,E=0;for(;E>-h/2;){if(T--,T<0)return!1;E-=c[T].dist(S),S=c[T]}E+=c[T].dist(c[T+1]),T++;const I=[];let F=0;for(;E<h/2;){const j=c[T],W=c[T+1];if(!W)return!1;let J=c[T-1].angleTo(j)-j.angleTo(W);for(J=Math.abs((J+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:E,angleDelta:J}),F+=J;E-I[0].distance>f;)F-=I.shift().angleDelta;if(F>y)return!1;T++,E+=j.dist(W)}return!0}function eS(c){let a=0;for(let h=0;h<c.length-1;h++)a+=c[h].dist(c[h+1]);return a}function tS(c,a,h){return c?.6*a*h:0}function nS(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function n9(c,a,h,f,y,S){const T=tS(h,y,S),E=nS(h,f)*S;let I=0;const F=eS(c)/2;for(let j=0;j<c.length-1;j++){const W=c[j],J=c[j+1],ae=W.dist(J);if(I+ae>F){const oe=(F-I)/ae,pe=fa.number(W.x,J.x,oe),xe=fa.number(W.y,J.y,oe),Pe=new lc(pe,xe,J.angleTo(W),j);return Pe._round(),!T||Q3(c,Pe,E,T,a)?Pe:void 0}I+=ae}}function r9(c,a,h,f,y,S,T,E,I){const F=tS(f,S,T),j=nS(f,y),W=j*T,J=c[0].x===0||c[0].x===I||c[0].y===0||c[0].y===I;return a-W<a/4&&(a=W+a/4),rS(c,J?a/2*E%a:(j/2+2*S)*T*E%a,a,F,h,W,J,!1,I)}function rS(c,a,h,f,y,S,T,E,I){const F=S/2,j=eS(c);let W=0,J=a-h,ae=[];for(let oe=0;oe<c.length-1;oe++){const pe=c[oe],xe=c[oe+1],Pe=pe.dist(xe),He=xe.angleTo(pe);for(;J+h<W+Pe;){J+=h;const De=(J-W)/Pe,Ne=fa.number(pe.x,xe.x,De),ht=fa.number(pe.y,xe.y,De);if(Ne>=0&&Ne<I&&ht>=0&&ht<I&&J-F>=0&&J+F<=j){const gt=new lc(Ne,ht,He,oe);gt._round(),f&&!Q3(c,gt,S,f,y)||ae.push(gt)}}W+=Pe}return E||ae.length||T||(ae=rS(c,W/2,h,f,y,S,T,!0,I)),ae}en("Anchor",lc);const $h=ga;function iS(c,a,h,f){const y=[],S=c.image,T=S.pixelRatio,E=S.paddedRect.w-2*$h,I=S.paddedRect.h-2*$h,F=c.right-c.left,j=c.bottom-c.top,W=S.stretchX||[[0,E]],J=S.stretchY||[[0,I]],ae=(Rt,sn)=>Rt+sn[1]-sn[0],oe=W.reduce(ae,0),pe=J.reduce(ae,0),xe=E-oe,Pe=I-pe;let He=0,De=oe,Ne=0,ht=pe,gt=0,Wt=xe,un=0,Gt=Pe;if(S.content&&f){const Rt=S.content;He=Sg(W,0,Rt[0]),Ne=Sg(J,0,Rt[1]),De=Sg(W,Rt[0],Rt[2]),ht=Sg(J,Rt[1],Rt[3]),gt=Rt[0]-He,un=Rt[1]-Ne,Wt=Rt[2]-Rt[0]-De,Gt=Rt[3]-Rt[1]-ht}const Vt=(Rt,sn,Bt,Tt)=>{const vn=Mg(Rt.stretch-He,De,F,c.left),dn=Tg(Rt.fixed-gt,Wt,Rt.stretch,oe),jn=Mg(sn.stretch-Ne,ht,j,c.top),Sr=Tg(sn.fixed-un,Gt,sn.stretch,pe),Cr=Mg(Bt.stretch-He,De,F,c.left),si=Tg(Bt.fixed-gt,Wt,Bt.stretch,oe),za=Mg(Tt.stretch-Ne,ht,j,c.top),Qi=Tg(Tt.fixed-un,Gt,Tt.stretch,pe),ei=new M(vn,jn),bi=new M(Cr,jn),Ii=new M(Cr,za),ea=new M(vn,za),ta=new M(dn/T,Sr/T),oi=new M(si/T,Qi/T),li=a*Math.PI/180;if(li){const Bi=Math.sin(li),ya=Math.cos(li),va=[ya,-Bi,Bi,ya];ei._matMult(va),bi._matMult(va),ea._matMult(va),Ii._matMult(va)}const Oi=Rt.stretch+Rt.fixed,na=sn.stretch+sn.fixed;return{tl:ei,tr:bi,bl:ea,br:Ii,tex:{x:S.paddedRect.x+$h+Oi,y:S.paddedRect.y+$h+na,w:Bt.stretch+Bt.fixed-Oi,h:Tt.stretch+Tt.fixed-na},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ta,pixelOffsetBR:oi,minFontScaleX:Wt/T/F,minFontScaleY:Gt/T/j,isSDF:h}};if(f&&(S.stretchX||S.stretchY)){const Rt=aS(W,xe,oe),sn=aS(J,Pe,pe);for(let Bt=0;Bt<Rt.length-1;Bt++){const Tt=Rt[Bt],vn=Rt[Bt+1];for(let dn=0;dn<sn.length-1;dn++)y.push(Vt(Tt,sn[dn],vn,sn[dn+1]))}}else y.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return y}function Sg(c,a,h){let f=0;for(const y of c)f+=Math.max(a,Math.min(h,y[1]))-Math.max(a,Math.min(h,y[0]));return f}function aS(c,a,h){const f=[{fixed:-$h,stretch:0}];for(const[y,S]of c){const T=f[f.length-1];f.push({fixed:y-T.stretch,stretch:T.stretch}),f.push({fixed:y-T.stretch,stretch:T.stretch+(S-y)})}return f.push({fixed:a+$h,stretch:h}),f}function Mg(c,a,h,f){return c/a*h+f}function Tg(c,a,h,f){return c-a*h/f}class Eg{constructor(a,h,f,y,S,T,E,I,F,j){if(this.boxStartIndex=a.length,F){let W=T.top,J=T.bottom;const ae=T.collisionPadding;ae&&(W-=ae[1],J+=ae[3]);let oe=J-W;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{let W=T.top*E-I[0],J=T.bottom*E+I[2],ae=T.left*E-I[3],oe=T.right*E+I[1];const pe=T.collisionPadding;if(pe&&(ae-=pe[0]*E,W-=pe[1]*E,oe+=pe[2]*E,J+=pe[3]*E),j){const xe=new M(ae,W),Pe=new M(oe,W),He=new M(ae,J),De=new M(oe,J),Ne=j*Math.PI/180;xe._rotate(Ne),Pe._rotate(Ne),He._rotate(Ne),De._rotate(Ne),ae=Math.min(xe.x,Pe.x,He.x,De.x),oe=Math.max(xe.x,Pe.x,He.x,De.x),W=Math.min(xe.y,Pe.y,He.y,De.y),J=Math.max(xe.y,Pe.y,He.y,De.y)}a.emplaceBack(h.x,h.y,ae,W,oe,J,f,y,S)}this.boxEndIndex=a.length}}class i9{constructor(a=[],h=a9){if(this.data=a,this.length=this.data.length,this.compare=h,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],h=this.data.pop();return this.length--,this.length>0&&(this.data[0]=h,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:h,compare:f}=this,y=h[a];for(;a>0;){const S=a-1>>1,T=h[S];if(f(y,T)>=0)break;h[a]=T,a=S}h[a]=y}_down(a){const{data:h,compare:f}=this,y=this.length>>1,S=h[a];for(;a<y;){let T=1+(a<<1),E=h[T];const I=T+1;if(I<this.length&&f(h[I],E)<0&&(T=I,E=h[I]),f(E,S)>=0)break;h[a]=E,a=T}h[a]=S}}function a9(c,a){return c<a?-1:c>a?1:0}function s9(c,a=1,h=!1){let f=1/0,y=1/0,S=-1/0,T=-1/0;const E=c[0];for(let ae=0;ae<E.length;ae++){const oe=E[ae];(!ae||oe.x<f)&&(f=oe.x),(!ae||oe.y<y)&&(y=oe.y),(!ae||oe.x>S)&&(S=oe.x),(!ae||oe.y>T)&&(T=oe.y)}const I=Math.min(S-f,T-y);let F=I/2;const j=new i9([],o9);if(I===0)return new M(f,y);for(let ae=f;ae<S;ae+=I)for(let oe=y;oe<T;oe+=I)j.push(new qh(ae+F,oe+F,F,c));let W=function(ae){let oe=0,pe=0,xe=0;const Pe=ae[0];for(let He=0,De=Pe.length,Ne=De-1;He<De;Ne=He++){const ht=Pe[He],gt=Pe[Ne],Wt=ht.x*gt.y-gt.x*ht.y;pe+=(ht.x+gt.x)*Wt,xe+=(ht.y+gt.y)*Wt,oe+=3*Wt}return new qh(pe/oe,xe/oe,0,ae)}(c),J=j.length;for(;j.length;){const ae=j.pop();(ae.d>W.d||!W.d)&&(W=ae,h&&console.log("found best %d after %d probes",Math.round(1e4*ae.d)/1e4,J)),ae.max-W.d<=a||(F=ae.h/2,j.push(new qh(ae.p.x-F,ae.p.y-F,F,c)),j.push(new qh(ae.p.x+F,ae.p.y-F,F,c)),j.push(new qh(ae.p.x-F,ae.p.y+F,F,c)),j.push(new qh(ae.p.x+F,ae.p.y+F,F,c)),J+=4)}return h&&(console.log(`num probes: ${J}`),console.log(`best distance: ${W.d}`)),W.p}function o9(c,a){return a.max-c.max}function qh(c,a,h,f){this.p=new M(c,a),this.h=h,this.d=function(y,S){let T=!1,E=1/0;for(let I=0;I<S.length;I++){const F=S[I];for(let j=0,W=F.length,J=W-1;j<W;J=j++){const ae=F[j],oe=F[J];ae.y>y.y!=oe.y>y.y&&y.x<(oe.x-ae.x)*(y.y-ae.y)/(oe.y-ae.y)+ae.x&&(T=!T),E=Math.min(E,H4(y,ae,oe))}}return(T?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Ri;u.ap=void 0,(Ri=u.ap||(u.ap={}))[Ri.center=1]="center",Ri[Ri.left=2]="left",Ri[Ri.right=3]="right",Ri[Ri.top=4]="top",Ri[Ri.bottom=5]="bottom",Ri[Ri["top-left"]=6]="top-left",Ri[Ri["top-right"]=7]="top-right",Ri[Ri["bottom-left"]=8]="bottom-left",Ri[Ri["bottom-right"]=9]="bottom-right";const cc=7,A_=Number.POSITIVE_INFINITY;function sS(c,a){return a[1]!==A_?function(h,f,y){let S=0,T=0;switch(f=Math.abs(f),y=Math.abs(y),h){case"top-right":case"top-left":case"top":T=y-cc;break;case"bottom-right":case"bottom-left":case"bottom":T=-y+cc}switch(h){case"top-right":case"bottom-right":case"right":S=-f;break;case"top-left":case"bottom-left":case"left":S=f}return[S,T]}(c,a[0],a[1]):function(h,f){let y=0,S=0;f<0&&(f=0);const T=f/Math.SQRT2;switch(h){case"top-right":case"top-left":S=T-cc;break;case"bottom-right":case"bottom-left":S=-T+cc;break;case"bottom":S=-f+cc;break;case"top":S=f-cc}switch(h){case"top-right":case"bottom-right":y=-T;break;case"top-left":case"bottom-left":y=T;break;case"left":y=f;break;case"right":y=-f}return[y,S]}(c,a[0])}function oS(c,a,h){var f;const y=c.layout,S=(f=y.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(a,{},h);if(S){const E=S.values,I=[];for(let F=0;F<E.length;F+=2){const j=I[F]=E[F],W=E[F+1].map(J=>J*ai);j.startsWith("top")?W[1]-=cc:j.startsWith("bottom")&&(W[1]+=cc),I[F+1]=W}return new Wn(I)}const T=y.get("text-variable-anchor");if(T){let E;E=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},h)*ai,A_]:y.get("text-offset").evaluate(a,{},h).map(F=>F*ai);const I=[];for(const F of T)I.push(F,sS(F,E));return new Wn(I)}return null}function C_(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function l9(c,a,h,f,y,S,T,E,I,F,j){let W=S.textMaxSize.evaluate(a,{});W===void 0&&(W=T);const J=c.layers[0].layout,ae=J.get("icon-offset").evaluate(a,{},j),oe=cS(h.horizontal),pe=T/24,xe=c.tilePixelRatio*pe,Pe=c.tilePixelRatio*W/24,He=c.tilePixelRatio*E,De=c.tilePixelRatio*J.get("symbol-spacing"),Ne=J.get("text-padding")*c.tilePixelRatio,ht=function(Tt,vn,dn,jn=1){const Sr=Tt.get("icon-padding").evaluate(vn,{},dn),Cr=Sr&&Sr.values;return[Cr[0]*jn,Cr[1]*jn,Cr[2]*jn,Cr[3]*jn]}(J,a,j,c.tilePixelRatio),gt=J.get("text-max-angle")/180*Math.PI,Wt=J.get("text-rotation-alignment")!=="viewport"&&J.get("symbol-placement")!=="point",un=J.get("icon-rotation-alignment")==="map"&&J.get("symbol-placement")!=="point",Gt=J.get("symbol-placement"),Vt=De/2,Rt=J.get("icon-text-fit");let sn;f&&Rt!=="none"&&(c.allowVerticalPlacement&&h.vertical&&(sn=D3(f,h.vertical,Rt,J.get("icon-text-fit-padding"),ae,pe)),oe&&(f=D3(f,oe,Rt,J.get("icon-text-fit-padding"),ae,pe)));const Bt=(Tt,vn)=>{vn.x<0||vn.x>=$n||vn.y<0||vn.y>=$n||function(dn,jn,Sr,Cr,si,za,Qi,ei,bi,Ii,ea,ta,oi,li,Oi,na,Bi,ya,va,ci,Zn,Ui,Di,ui,ws){const Hs=dn.addToLineVertexArray(jn,Sr);let Gs,rl,Ss,es,_a=0,il=0,k0=0,fS=0,F_=-1,N_=-1;const al={};let pS=Hn("");if(dn.allowVerticalPlacement&&Cr.vertical){const Vi=ei.layout.get("text-rotate").evaluate(Zn,{},ui)+90;Ss=new Eg(bi,jn,Ii,ea,ta,Cr.vertical,oi,li,Oi,Vi),Qi&&(es=new Eg(bi,jn,Ii,ea,ta,Qi,Bi,ya,Oi,Vi))}if(si){const Vi=ei.layout.get("icon-rotate").evaluate(Zn,{}),ts=ei.layout.get("icon-text-fit")!=="none",wu=iS(si,Vi,Di,ts),Ws=Qi?iS(Qi,Vi,Di,ts):void 0;rl=new Eg(bi,jn,Ii,ea,ta,si,Bi,ya,!1,Vi),_a=4*wu.length;const Su=dn.iconSizeData;let _o=null;Su.kind==="source"?(_o=[vo*ei.layout.get("icon-size").evaluate(Zn,{})],_o[0]>sc&&Ae(`${dn.layerIds[0]}: Value for "icon-size" is >= ${P0}. Reduce your "icon-size".`)):Su.kind==="composite"&&(_o=[vo*Ui.compositeIconSizes[0].evaluate(Zn,{},ui),vo*Ui.compositeIconSizes[1].evaluate(Zn,{},ui)],(_o[0]>sc||_o[1]>sc)&&Ae(`${dn.layerIds[0]}: Value for "icon-size" is >= ${P0}. Reduce your "icon-size".`)),dn.addSymbols(dn.icon,wu,_o,ci,va,Zn,u.ah.none,jn,Hs.lineStartIndex,Hs.lineLength,-1,ui),F_=dn.icon.placedSymbolArray.length-1,Ws&&(il=4*Ws.length,dn.addSymbols(dn.icon,Ws,_o,ci,va,Zn,u.ah.vertical,jn,Hs.lineStartIndex,Hs.lineLength,-1,ui),N_=dn.icon.placedSymbolArray.length-1)}const mS=Object.keys(Cr.horizontal);for(const Vi of mS){const ts=Cr.horizontal[Vi];if(!Gs){pS=Hn(ts.text);const Ws=ei.layout.get("text-rotate").evaluate(Zn,{},ui);Gs=new Eg(bi,jn,Ii,ea,ta,ts,oi,li,Oi,Ws)}const wu=ts.positionedLines.length===1;if(k0+=lS(dn,jn,ts,za,ei,Oi,Zn,na,Hs,Cr.vertical?u.ah.horizontal:u.ah.horizontalOnly,wu?mS:[Vi],al,F_,Ui,ui),wu)break}Cr.vertical&&(fS+=lS(dn,jn,Cr.vertical,za,ei,Oi,Zn,na,Hs,u.ah.vertical,["vertical"],al,N_,Ui,ui));const h9=Gs?Gs.boxStartIndex:dn.collisionBoxArray.length,d9=Gs?Gs.boxEndIndex:dn.collisionBoxArray.length,f9=Ss?Ss.boxStartIndex:dn.collisionBoxArray.length,p9=Ss?Ss.boxEndIndex:dn.collisionBoxArray.length,m9=rl?rl.boxStartIndex:dn.collisionBoxArray.length,g9=rl?rl.boxEndIndex:dn.collisionBoxArray.length,y9=es?es.boxStartIndex:dn.collisionBoxArray.length,v9=es?es.boxEndIndex:dn.collisionBoxArray.length;let js=-1;const Cg=(Vi,ts)=>Vi&&Vi.circleDiameter?Math.max(Vi.circleDiameter,ts):ts;js=Cg(Gs,js),js=Cg(Ss,js),js=Cg(rl,js),js=Cg(es,js);const gS=js>-1?1:0;gS&&(js*=ws/ai),dn.glyphOffsetArray.length>=Wh.MAX_GLYPHS&&Ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&dn.addToSortKeyRanges(dn.symbolInstances.length,Zn.sortKey);const _9=oS(ei,Zn,ui),[x9,b9]=function(Vi,ts){const wu=Vi.length,Ws=ts==null?void 0:ts.values;if((Ws==null?void 0:Ws.length)>0)for(let Su=0;Su<Ws.length;Su+=2){const _o=Ws[Su+1];Vi.emplaceBack(u.ap[Ws[Su]],_o[0],_o[1])}return[wu,Vi.length]}(dn.textAnchorOffsets,_9);dn.symbolInstances.emplaceBack(jn.x,jn.y,al.right>=0?al.right:-1,al.center>=0?al.center:-1,al.left>=0?al.left:-1,al.vertical||-1,F_,N_,pS,h9,d9,f9,p9,m9,g9,y9,v9,Ii,k0,fS,_a,il,gS,0,oi,js,x9,b9)}(c,vn,Tt,h,f,y,sn,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,xe,[Ne,Ne,Ne,Ne],Wt,I,He,ht,un,ae,a,S,F,j,T)};if(Gt==="line")for(const Tt of J3(a.geometry,0,0,$n,$n)){const vn=r9(Tt,De,gt,h.vertical||oe,f,24,Pe,c.overscaling,$n);for(const dn of vn)oe&&c9(c,oe.text,Vt,dn)||Bt(Tt,dn)}else if(Gt==="line-center"){for(const Tt of a.geometry)if(Tt.length>1){const vn=n9(Tt,gt,h.vertical||oe,f,24,Pe);vn&&Bt(Tt,vn)}}else if(a.type==="Polygon")for(const Tt of s_(a.geometry,0)){const vn=s9(Tt,16);Bt(Tt[0],new lc(vn.x,vn.y,0))}else if(a.type==="LineString")for(const Tt of a.geometry)Bt(Tt,new lc(Tt[0].x,Tt[0].y,0));else if(a.type==="Point")for(const Tt of a.geometry)for(const vn of Tt)Bt([vn],new lc(vn.x,vn.y,0))}function lS(c,a,h,f,y,S,T,E,I,F,j,W,J,ae,oe){const pe=function(He,De,Ne,ht,gt,Wt,un,Gt){const Vt=ht.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,Rt=[];for(const sn of De.positionedLines)for(const Bt of sn.positionedGlyphs){if(!Bt.rect)continue;const Tt=Bt.rect||{};let vn=T3+1,dn=!0,jn=1,Sr=0;const Cr=(gt||Gt)&&Bt.vertical,si=Bt.metrics.advance*Bt.scale/2;if(Gt&&De.verticalizable&&(Sr=sn.lineOffset/2-(Bt.imageName?-(ai-Bt.metrics.width*Bt.scale)/2:(Bt.scale-1)*ai)),Bt.imageName){const ci=un[Bt.imageName];dn=ci.sdf,jn=ci.pixelRatio,vn=ga/jn}const za=gt?[Bt.x+si,Bt.y]:[0,0];let Qi=gt?[0,0]:[Bt.x+si+Ne[0],Bt.y+Ne[1]-Sr],ei=[0,0];Cr&&(ei=Qi,Qi=[0,0]);const bi=Bt.metrics.isDoubleResolution?2:1,Ii=(Bt.metrics.left-vn)*Bt.scale-si+Qi[0],ea=(-Bt.metrics.top-vn)*Bt.scale+Qi[1],ta=Ii+Tt.w/bi*Bt.scale/jn,oi=ea+Tt.h/bi*Bt.scale/jn,li=new M(Ii,ea),Oi=new M(ta,ea),na=new M(Ii,oi),Bi=new M(ta,oi);if(Cr){const ci=new M(-si,si-A0),Zn=-Math.PI/2,Ui=ai/2-si,Di=new M(5-A0-Ui,-(Bt.imageName?Ui:0)),ui=new M(...ei);li._rotateAround(Zn,ci)._add(Di)._add(ui),Oi._rotateAround(Zn,ci)._add(Di)._add(ui),na._rotateAround(Zn,ci)._add(Di)._add(ui),Bi._rotateAround(Zn,ci)._add(Di)._add(ui)}if(Vt){const ci=Math.sin(Vt),Zn=Math.cos(Vt),Ui=[Zn,-ci,ci,Zn];li._matMult(Ui),Oi._matMult(Ui),na._matMult(Ui),Bi._matMult(Ui)}const ya=new M(0,0),va=new M(0,0);Rt.push({tl:li,tr:Oi,bl:na,br:Bi,tex:Tt,writingMode:De.writingMode,glyphOffset:za,sectionIndex:Bt.sectionIndex,isSDF:dn,pixelOffsetTL:ya,pixelOffsetBR:va,minFontScaleX:0,minFontScaleY:0})}return Rt}(0,h,E,y,S,T,f,c.allowVerticalPlacement),xe=c.textSizeData;let Pe=null;xe.kind==="source"?(Pe=[vo*y.layout.get("text-size").evaluate(T,{})],Pe[0]>sc&&Ae(`${c.layerIds[0]}: Value for "text-size" is >= ${P0}. Reduce your "text-size".`)):xe.kind==="composite"&&(Pe=[vo*ae.compositeTextSizes[0].evaluate(T,{},oe),vo*ae.compositeTextSizes[1].evaluate(T,{},oe)],(Pe[0]>sc||Pe[1]>sc)&&Ae(`${c.layerIds[0]}: Value for "text-size" is >= ${P0}. Reduce your "text-size".`)),c.addSymbols(c.text,pe,Pe,E,S,T,F,a,I.lineStartIndex,I.lineLength,J,oe);for(const He of j)W[He]=c.text.placedSymbolArray.length-1;return 4*pe.length}function cS(c){for(const a in c)return c[a];return null}function c9(c,a,h,f){const y=c.compareText;if(a in y){const S=y[a];for(let T=S.length-1;T>=0;T--)if(f.dist(S[T])<h)return!0}else y[a]=[];return y[a].push(f),!1}const uS=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class P_{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[h,f]=new Uint8Array(a,0,2);if(h!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=f>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const S=uS[15&f];if(!S)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[E]=new Uint32Array(a,4,1);return new P_(E,T,S,a)}constructor(a,h=64,f=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+h,2),65535),this.ArrayType=f,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const S=uS.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,E=a*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-E%8)%8;if(S<0)throw new Error(`Unexpected typed array class: ${f}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+I,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+E+I),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+I,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+S]),new Uint16Array(this.data,2,1)[0]=h,new Uint32Array(this.data,4,1)[0]=a)}add(a,h){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=a,this.coords[this._pos++]=h,f}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return R_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,h,f,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:S,coords:T,nodeSize:E}=this,I=[0,S.length-1,0],F=[];for(;I.length;){const j=I.pop()||0,W=I.pop()||0,J=I.pop()||0;if(W-J<=E){for(let xe=J;xe<=W;xe++){const Pe=T[2*xe],He=T[2*xe+1];Pe>=a&&Pe<=f&&He>=h&&He<=y&&F.push(S[xe])}continue}const ae=J+W>>1,oe=T[2*ae],pe=T[2*ae+1];oe>=a&&oe<=f&&pe>=h&&pe<=y&&F.push(S[ae]),(j===0?a<=oe:h<=pe)&&(I.push(J),I.push(ae-1),I.push(1-j)),(j===0?f>=oe:y>=pe)&&(I.push(ae+1),I.push(W),I.push(1-j))}return F}within(a,h,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:S,nodeSize:T}=this,E=[0,y.length-1,0],I=[],F=f*f;for(;E.length;){const j=E.pop()||0,W=E.pop()||0,J=E.pop()||0;if(W-J<=T){for(let xe=J;xe<=W;xe++)dS(S[2*xe],S[2*xe+1],a,h)<=F&&I.push(y[xe]);continue}const ae=J+W>>1,oe=S[2*ae],pe=S[2*ae+1];dS(oe,pe,a,h)<=F&&I.push(y[ae]),(j===0?a-f<=oe:h-f<=pe)&&(E.push(J),E.push(ae-1),E.push(1-j)),(j===0?a+f>=oe:h+f>=pe)&&(E.push(ae+1),E.push(W),E.push(1-j))}return I}}function R_(c,a,h,f,y,S){if(y-f<=h)return;const T=f+y>>1;hS(c,a,T,f,y,S),R_(c,a,h,f,T-1,1-S),R_(c,a,h,T+1,y,1-S)}function hS(c,a,h,f,y,S){for(;y>f;){if(y-f>600){const F=y-f+1,j=h-f+1,W=Math.log(F),J=.5*Math.exp(2*W/3),ae=.5*Math.sqrt(W*J*(F-J)/F)*(j-F/2<0?-1:1);hS(c,a,h,Math.max(f,Math.floor(h-j*J/F+ae)),Math.min(y,Math.floor(h+(F-j)*J/F+ae)),S)}const T=a[2*h+S];let E=f,I=y;for(I0(c,a,f,h),a[2*y+S]>T&&I0(c,a,f,y);E<I;){for(I0(c,a,E,I),E++,I--;a[2*E+S]<T;)E++;for(;a[2*I+S]>T;)I--}a[2*f+S]===T?I0(c,a,f,I):(I++,I0(c,a,I,y)),I<=h&&(f=I+1),h<=I&&(y=I-1)}}function I0(c,a,h,f){I_(c,h,f),I_(a,2*h,2*f),I_(a,2*h+1,2*f+1)}function I_(c,a,h){const f=c[a];c[a]=c[h],c[h]=f}function dS(c,a,h,f){const y=c-h,S=a-f;return y*y+S*S}var D_;u.bd=void 0,(D_=u.bd||(u.bd={})).create="create",D_.load="load",D_.fullLoad="fullLoad";let Ag=null,D0=[];const k_=1e3/60,L_="loadTime",z_="fullLoadTime",u9={mark(c){performance.mark(c)},frame(c){const a=c;Ag!=null&&D0.push(a-Ag),Ag=a},clearMetrics(){Ag=null,D0=[],performance.clearMeasures(L_),performance.clearMeasures(z_);for(const c in u.bd)performance.clearMarks(u.bd[c])},getPerformanceMetrics(){performance.measure(L_,u.bd.create,u.bd.load),performance.measure(z_,u.bd.create,u.bd.fullLoad);const c=performance.getEntriesByName(L_)[0].duration,a=performance.getEntriesByName(z_)[0].duration,h=D0.length,f=1/(D0.reduce((S,T)=>S+T,0)/h/1e3),y=D0.filter(S=>S>k_).reduce((S,T)=>S+(T-k_)/k_,0);return{loadTime:c,fullLoadTime:a,fps:f,percentDroppedFrames:y/(h+y)*100,totalFrames:h}}};u.$=xt,u.A=Bh,u.B=function(c){if(pt==null){const a=c.navigator?c.navigator.userAgent:null;pt=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return pt},u.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new e9(()=>this.process()),this.subscription=function(h,f,y,S){return h.addEventListener(f,y,!1),{unsubscribe:()=>{h.removeEventListener(f,y,!1)}}}(this.target,"message",h=>this.receive(h)),this.globalScope=ut(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((h,f)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[y]={resolve:h,reject:f},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[y];const E={id:y,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const S=[],T=Object.assign(Object.assign({},c),{id:y,sourceMapId:this.mapId,origin:location.origin,data:qo(c.data,S)});this.target.postMessage(T,{transfer:S})})}receive(c){const a=c.data,h=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[h];const f=this.abortControllers[h];return delete this.abortControllers[h],void(f&&f.abort())}if(ut(self)||a.mustQueue)return this.tasks[h]=a,this.taskQueue.push(h),void this.invoker.trigger();this.processTask(h,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return l(this,void 0,void 0,function*(){if(a.type==="<response>"){const y=this.resolveRejects[c];return delete this.resolveRejects[c],y?void(a.error?y.reject(Ql(a.error)):y.resolve(Ql(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const h=Ql(a.data),f=new AbortController;this.abortControllers[c]=f;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,h,f);this.completeTask(c,null,y)}catch(y){this.completeTask(c,y)}})}completeTask(c,a,h){const f=[];delete this.abortControllers[c];const y={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?qo(a):null,data:qo(h,f)};this.target.postMessage(y,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},u.D=pn,u.E=Gn,u.F=function(){var c=new Bh(16);return Bh!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},u.G=At,u.H=function(c,a,h){var f,y,S,T,E,I,F,j,W,J,ae,oe,pe=h[0],xe=h[1],Pe=h[2];return a===c?(c[12]=a[0]*pe+a[4]*xe+a[8]*Pe+a[12],c[13]=a[1]*pe+a[5]*xe+a[9]*Pe+a[13],c[14]=a[2]*pe+a[6]*xe+a[10]*Pe+a[14],c[15]=a[3]*pe+a[7]*xe+a[11]*Pe+a[15]):(y=a[1],S=a[2],T=a[3],E=a[4],I=a[5],F=a[6],j=a[7],W=a[8],J=a[9],ae=a[10],oe=a[11],c[0]=f=a[0],c[1]=y,c[2]=S,c[3]=T,c[4]=E,c[5]=I,c[6]=F,c[7]=j,c[8]=W,c[9]=J,c[10]=ae,c[11]=oe,c[12]=f*pe+E*xe+W*Pe+a[12],c[13]=y*pe+I*xe+J*Pe+a[13],c[14]=S*pe+F*xe+ae*Pe+a[14],c[15]=T*pe+j*xe+oe*Pe+a[15]),c},u.I=g_,u.J=function(c,a,h){var f=h[0],y=h[1],S=h[2];return c[0]=a[0]*f,c[1]=a[1]*f,c[2]=a[2]*f,c[3]=a[3]*f,c[4]=a[4]*y,c[5]=a[5]*y,c[6]=a[6]*y,c[7]=a[7]*y,c[8]=a[8]*S,c[9]=a[9]*S,c[10]=a[10]*S,c[11]=a[11]*S,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.K=$4,u.L=function(c,a){const h={};for(let f=0;f<a.length;f++){const y=a[f];y in c&&(h[y]=c[y])}return h},u.M=oc,u.N=V3,u.O=H3,u.P=M,u.Q=Qa,u.R=Ja,u.S=C,u.T=t0,u.U=U,u.V=tt,u.W=$n,u.X=Wr,u.Y=wg,u.Z=class extends go{},u._=l,u.a=wt,u.a$=function(c,a,h){return c[0]=a[0]*h[0],c[1]=a[1]*h[1],c[2]=a[2]*h[2],c[3]=a[3]*h[3],c},u.a0=E_,u.a1=at,u.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(h=>{a.onloadstart=()=>{h(a)};for(const f of c){const y=window.document.createElement("source");je(f)||(a.crossOrigin="Anonymous"),y.src=f,a.appendChild(y)}})},u.a3=function(){return be++},u.a4=ig,u.a5=Wh,u.a6=Th,u.a7=el,u.a8=br,u.a9=X3,u.aA=Ee,u.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let h=[];try{if(!it(c.version,a.version))return[{command:"setStyle",args:[a]}];it(c.center,a.center)||h.push({command:"setCenter",args:[a.center]}),it(c.zoom,a.zoom)||h.push({command:"setZoom",args:[a.zoom]}),it(c.bearing,a.bearing)||h.push({command:"setBearing",args:[a.bearing]}),it(c.pitch,a.pitch)||h.push({command:"setPitch",args:[a.pitch]}),it(c.sprite,a.sprite)||h.push({command:"setSprite",args:[a.sprite]}),it(c.glyphs,a.glyphs)||h.push({command:"setGlyphs",args:[a.glyphs]}),it(c.transition,a.transition)||h.push({command:"setTransition",args:[a.transition]}),it(c.light,a.light)||h.push({command:"setLight",args:[a.light]}),it(c.terrain,a.terrain)||h.push({command:"setTerrain",args:[a.terrain]}),it(c.sky,a.sky)||h.push({command:"setSky",args:[a.sky]});const f={},y=[];(function(T,E,I,F){let j;for(j in E=E||{},T=T||{})Object.prototype.hasOwnProperty.call(T,j)&&(Object.prototype.hasOwnProperty.call(E,j)||_n(j,I,F));for(j in E)Object.prototype.hasOwnProperty.call(E,j)&&(Object.prototype.hasOwnProperty.call(T,j)?it(T[j],E[j])||(T[j].type==="geojson"&&E[j].type==="geojson"&&hn(T,E,j)?mt(I,{command:"setGeoJSONSourceData",args:[j,E[j].data]}):Mt(j,E,I,F)):St(j,E,I))})(c.sources,a.sources,y,f);const S=[];c.layers&&c.layers.forEach(T=>{"source"in T&&f[T.source]?h.push({command:"removeLayer",args:[T.id]}):S.push(T)}),h=h.concat(y),function(T,E,I){E=E||[];const F=(T=T||[]).map(Nt),j=E.map(Nt),W=T.reduce(an,{}),J=E.reduce(an,{}),ae=F.slice(),oe=Object.create(null);let pe,xe,Pe,He,De;for(let Ne=0,ht=0;Ne<F.length;Ne++)pe=F[Ne],Object.prototype.hasOwnProperty.call(J,pe)?ht++:(mt(I,{command:"removeLayer",args:[pe]}),ae.splice(ae.indexOf(pe,ht),1));for(let Ne=0,ht=0;Ne<j.length;Ne++)pe=j[j.length-1-Ne],ae[ae.length-1-Ne]!==pe&&(Object.prototype.hasOwnProperty.call(W,pe)?(mt(I,{command:"removeLayer",args:[pe]}),ae.splice(ae.lastIndexOf(pe,ae.length-ht),1)):ht++,He=ae[ae.length-Ne],mt(I,{command:"addLayer",args:[J[pe],He]}),ae.splice(ae.length-Ne,0,pe),oe[pe]=!0);for(let Ne=0;Ne<j.length;Ne++)if(pe=j[Ne],xe=W[pe],Pe=J[pe],!oe[pe]&&!it(xe,Pe))if(it(xe.source,Pe.source)&&it(xe["source-layer"],Pe["source-layer"])&&it(xe.type,Pe.type)){for(De in xn(xe.layout,Pe.layout,I,pe,null,"setLayoutProperty"),xn(xe.paint,Pe.paint,I,pe,null,"setPaintProperty"),it(xe.filter,Pe.filter)||mt(I,{command:"setFilter",args:[pe,Pe.filter]}),it(xe.minzoom,Pe.minzoom)&&it(xe.maxzoom,Pe.maxzoom)||mt(I,{command:"setLayerZoomRange",args:[pe,Pe.minzoom,Pe.maxzoom]}),xe)Object.prototype.hasOwnProperty.call(xe,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?xn(xe[De],Pe[De],I,pe,De.slice(6),"setPaintProperty"):it(xe[De],Pe[De])||mt(I,{command:"setLayerProperty",args:[pe,De,Pe[De]]}));for(De in Pe)Object.prototype.hasOwnProperty.call(Pe,De)&&!Object.prototype.hasOwnProperty.call(xe,De)&&De!=="layout"&&De!=="paint"&&De!=="filter"&&De!=="metadata"&&De!=="minzoom"&&De!=="maxzoom"&&(De.indexOf("paint.")===0?xn(xe[De],Pe[De],I,pe,De.slice(6),"setPaintProperty"):it(xe[De],Pe[De])||mt(I,{command:"setLayerProperty",args:[pe,De,Pe[De]]}))}else mt(I,{command:"removeLayer",args:[pe]}),He=ae[ae.lastIndexOf(pe)+1],mt(I,{command:"addLayer",args:[Pe,He]})}(S,a.layers,h)}catch(f){console.warn("Unable to compute style diff:",f),h=[{command:"setStyle",args:[a]}]}return h},u.aC=function(c){const a=[],h=c.id;return h===void 0&&a.push({message:`layers.${h}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${h}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${h}: property "renderingMode" must be either "2d" or "3d"`}),a},u.aD=function c(a,h){if(Array.isArray(a)){if(!Array.isArray(h)||a.length!==h.length)return!1;for(let f=0;f<a.length;f++)if(!c(a[f],h[f]))return!1;return!0}if(typeof a=="object"&&a!==null&&h!==null){if(typeof h!="object"||Object.keys(a).length!==Object.keys(h).length)return!1;for(const f in a)if(!c(a[f],h[f]))return!1;return!0}return a===h},u.aE=ie,u.aF=Q,u.aG=class extends vr{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},u.aH=Pi,u.aI=class extends vr{constructor(c,a){super(c,a),this.current=Ko}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},u.aJ=Ya,u.aK=class extends vr{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},u.aL=class extends vr{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},u.aM=xs,u.aN=function(c,a,h,f,y,S,T){var E=1/(a-h),I=1/(f-y),F=1/(S-T);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*I,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*F,c[11]=0,c[12]=(a+h)*E,c[13]=(y+f)*I,c[14]=(T+S)*F,c[15]=1,c},u.aO=Xt,u.aP=LP,u.aQ=class extends vu{},u.aR=CR,u.aS=class extends tc{},u.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},u.aU=K4,u.aV=q,u.aW=class extends h0{},u.aX=Qe,u.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},u.aZ=function(c,a){var h=c[0],f=c[1],y=c[2],S=c[3],T=c[4],E=c[5],I=c[6],F=c[7],j=c[8],W=c[9],J=c[10],ae=c[11],oe=c[12],pe=c[13],xe=c[14],Pe=c[15],He=a[0],De=a[1],Ne=a[2],ht=a[3],gt=a[4],Wt=a[5],un=a[6],Gt=a[7],Vt=a[8],Rt=a[9],sn=a[10],Bt=a[11],Tt=a[12],vn=a[13],dn=a[14],jn=a[15];return Math.abs(h-He)<=Ji*Math.max(1,Math.abs(h),Math.abs(He))&&Math.abs(f-De)<=Ji*Math.max(1,Math.abs(f),Math.abs(De))&&Math.abs(y-Ne)<=Ji*Math.max(1,Math.abs(y),Math.abs(Ne))&&Math.abs(S-ht)<=Ji*Math.max(1,Math.abs(S),Math.abs(ht))&&Math.abs(T-gt)<=Ji*Math.max(1,Math.abs(T),Math.abs(gt))&&Math.abs(E-Wt)<=Ji*Math.max(1,Math.abs(E),Math.abs(Wt))&&Math.abs(I-un)<=Ji*Math.max(1,Math.abs(I),Math.abs(un))&&Math.abs(F-Gt)<=Ji*Math.max(1,Math.abs(F),Math.abs(Gt))&&Math.abs(j-Vt)<=Ji*Math.max(1,Math.abs(j),Math.abs(Vt))&&Math.abs(W-Rt)<=Ji*Math.max(1,Math.abs(W),Math.abs(Rt))&&Math.abs(J-sn)<=Ji*Math.max(1,Math.abs(J),Math.abs(sn))&&Math.abs(ae-Bt)<=Ji*Math.max(1,Math.abs(ae),Math.abs(Bt))&&Math.abs(oe-Tt)<=Ji*Math.max(1,Math.abs(oe),Math.abs(Tt))&&Math.abs(pe-vn)<=Ji*Math.max(1,Math.abs(pe),Math.abs(vn))&&Math.abs(xe-dn)<=Ji*Math.max(1,Math.abs(xe),Math.abs(dn))&&Math.abs(Pe-jn)<=Ji*Math.max(1,Math.abs(Pe),Math.abs(jn))},u.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},u.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(h,f,y,S)=>{const T=y||S;return a[f]=!T||T.toLowerCase(),""}),a["max-age"]){const h=parseInt(a["max-age"],10);isNaN(h)?delete a["max-age"]:a["max-age"]=h}return a},u.ab=function(c,a){const h=[];for(const f in c)f in a||h.push(f);return h},u.ac=ue,u.ad=function(c,a,h){var f=Math.sin(h),y=Math.cos(h),S=a[0],T=a[1],E=a[2],I=a[3],F=a[4],j=a[5],W=a[6],J=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=S*y+F*f,c[1]=T*y+j*f,c[2]=E*y+W*f,c[3]=I*y+J*f,c[4]=F*y-S*f,c[5]=j*y-T*f,c[6]=W*y-E*f,c[7]=J*y-I*f,c},u.ae=function(c){var a=new Bh(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},u.af=hg,u.ag=function(c,a){let h=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:y,minZoom:S,maxZoom:T}=c,E=y?ue(Ni.interpolationFactor(y,a,S,T),0,1):0;c.kind==="camera"?f=fa.number(c.minSize,c.maxSize,E):h=E}return{uSizeT:h,uSize:f}},u.ai=function(c,{uSize:a,uSizeT:h},{lowerSize:f,upperSize:y}){return c.kind==="source"?f/vo:c.kind==="composite"?fa.number(f/vo,y/vo,h):a},u.aj=x_,u.ak=function(c,a,h,f){const y=a.y-c.y,S=a.x-c.x,T=f.y-h.y,E=f.x-h.x,I=T*S-E*y;if(I===0)return null;const F=(E*(c.y-h.y)-T*(c.x-h.x))/I;return new M(c.x+F*S,c.y+F*y)},u.al=J3,u.am=tl,u.an=Qv,u.ao=ai,u.aq=__,u.ar=function(c,a){var h=a[0],f=a[1],y=a[2],S=a[3],T=a[4],E=a[5],I=a[6],F=a[7],j=a[8],W=a[9],J=a[10],ae=a[11],oe=a[12],pe=a[13],xe=a[14],Pe=a[15],He=h*E-f*T,De=h*I-y*T,Ne=h*F-S*T,ht=f*I-y*E,gt=f*F-S*E,Wt=y*F-S*I,un=j*pe-W*oe,Gt=j*xe-J*oe,Vt=j*Pe-ae*oe,Rt=W*xe-J*pe,sn=W*Pe-ae*pe,Bt=J*Pe-ae*xe,Tt=He*Bt-De*sn+Ne*Rt+ht*Vt-gt*Gt+Wt*un;return Tt?(c[0]=(E*Bt-I*sn+F*Rt)*(Tt=1/Tt),c[1]=(y*sn-f*Bt-S*Rt)*Tt,c[2]=(pe*Wt-xe*gt+Pe*ht)*Tt,c[3]=(J*gt-W*Wt-ae*ht)*Tt,c[4]=(I*Vt-T*Bt-F*Gt)*Tt,c[5]=(h*Bt-y*Vt+S*Gt)*Tt,c[6]=(xe*Ne-oe*Wt-Pe*De)*Tt,c[7]=(j*Wt-J*Ne+ae*De)*Tt,c[8]=(T*sn-E*Vt+F*un)*Tt,c[9]=(f*Vt-h*sn-S*un)*Tt,c[10]=(oe*gt-pe*Ne+Pe*He)*Tt,c[11]=(W*Ne-j*gt-ae*He)*Tt,c[12]=(E*Gt-T*Rt-I*un)*Tt,c[13]=(h*Rt-f*Gt+y*un)*Tt,c[14]=(pe*De-oe*ht-xe*He)*Tt,c[15]=(j*ht-W*De+J*He)*Tt,c):null},u.as=C_,u.at=v_,u.au=P_,u.av=function(){const c={},a=re.$version;for(const h in re.$root){const f=re.$root[h];if(f.required){let y=null;y=h==="version"?a:f.type==="array"?[]:{},y!=null&&(c[h]=y)}}return c},u.aw=Kf,u.ax=En,u.ay=function(c){c=c.slice();const a=Object.create(null);for(let h=0;h<c.length;h++)a[c[h].id]=c[h];for(let h=0;h<c.length;h++)"ref"in c[h]&&(c[h]=st(c[h],a[c[h].ref]));return c},u.az=function(c){if(c.type==="custom")return new QR(c);switch(c.type){case"background":return new YR(c);case"circle":return new zP(c);case"fill":return new tR(c);case"fill-extrusion":return new gR(c);case"heatmap":return new NP(c);case"hillshade":return new BP(c);case"line":return new MR(c);case"raster":return new JR(c);case"symbol":return new bg(c)}},u.b=ke,u.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},u.b1=Z,u.b2=W3,u.b3=G3,u.b4=function(c,a,h,f,y){var S,T=1/Math.tan(a/2);return c[0]=T/h,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,y!=null&&y!==1/0?(c[10]=(y+f)*(S=1/(f-y)),c[14]=2*y*f*S):(c[10]=-1,c[14]=-2*f),c},u.b5=function(c,a,h){var f=Math.sin(h),y=Math.cos(h),S=a[4],T=a[5],E=a[6],I=a[7],F=a[8],j=a[9],W=a[10],J=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=S*y+F*f,c[5]=T*y+j*f,c[6]=E*y+W*f,c[7]=I*y+J*f,c[8]=F*y-S*f,c[9]=j*y-T*f,c[10]=W*y-E*f,c[11]=J*y-I*f,c},u.b6=B,u.b7=K,u.b8=function(c){return c*Math.PI/180},u.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},u.bA=Xo,u.ba=class extends Dh{},u.bb=M_,u.bc=u9,u.be=gn,u.bf=function(c,a){wt.REGISTERED_PROTOCOLS[c]=a},u.bg=function(c){delete wt.REGISTERED_PROTOCOLS[c]},u.bh=function(c,a){const h={};for(let y=0;y<c.length;y++){const S=a&&a[c[y].id]||Yv(c[y]);a&&(a[c[y].id]=S);let T=h[S];T||(T=h[S]=[]),T.push(c[y])}const f=[];for(const y in h)f.push(h[y]);return f},u.bi=en,u.bj=q3,u.bk=Z3,u.bl=A3,u.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=$n/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],h=a.layout,f=a._unevaluatedLayout._values,y={layoutIconSize:f["icon-size"].possiblyEvaluate(new br(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new br(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new br(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=c.bucket.textSizeData;y.compositeTextSizes=[f["text-size"].possiblyEvaluate(new br(F),c.canonical),f["text-size"].possiblyEvaluate(new br(j),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:F,maxZoom:j}=c.bucket.iconSizeData;y.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new br(F),c.canonical),f["icon-size"].possiblyEvaluate(new br(j),c.canonical)]}const S=h.get("text-line-height")*ai,T=h.get("text-rotation-alignment")!=="viewport"&&h.get("symbol-placement")!=="point",E=h.get("text-keep-upright"),I=h.get("text-size");for(const F of c.bucket.features){const j=h.get("text-font").evaluate(F,{},c.canonical).join(","),W=I.evaluate(F,{},c.canonical),J=y.layoutTextSize.evaluate(F,{},c.canonical),ae=y.layoutIconSize.evaluate(F,{},c.canonical),oe={horizontal:{},vertical:void 0},pe=F.text;let xe,Pe=[0,0];if(pe){const Ne=pe.toString(),ht=h.get("text-letter-spacing").evaluate(F,{},c.canonical)*ai,gt=Ch(Ne)?ht:0,Wt=h.get("text-anchor").evaluate(F,{},c.canonical),un=oS(a,F,c.canonical);if(!un){const Bt=h.get("text-radial-offset").evaluate(F,{},c.canonical);Pe=Bt?sS(Wt,[Bt*ai,A_]):h.get("text-offset").evaluate(F,{},c.canonical).map(Tt=>Tt*ai)}let Gt=T?"center":h.get("text-justify").evaluate(F,{},c.canonical);const Vt=h.get("symbol-placement"),Rt=Vt==="point"?h.get("text-max-width").evaluate(F,{},c.canonical)*ai:0,sn=()=>{c.bucket.allowVerticalPlacement&&fu(Ne)&&(oe.vertical=vg(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,S,Wt,"left",gt,Pe,u.ah.vertical,!0,Vt,J,W))};if(!T&&un){const Bt=new Set;if(Gt==="auto")for(let vn=0;vn<un.values.length;vn+=2)Bt.add(C_(un.values[vn]));else Bt.add(Gt);let Tt=!1;for(const vn of Bt)if(!oe.horizontal[vn])if(Tt)oe.horizontal[vn]=oe.horizontal[0];else{const dn=vg(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,S,"center",vn,gt,Pe,u.ah.horizontal,!1,Vt,J,W);dn&&(oe.horizontal[vn]=dn,Tt=dn.positionedLines.length===1)}sn()}else{Gt==="auto"&&(Gt=C_(Wt));const Bt=vg(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,S,Wt,Gt,gt,Pe,u.ah.horizontal,!1,Vt,J,W);Bt&&(oe.horizontal[Gt]=Bt),sn(),fu(Ne)&&T&&E&&(oe.vertical=vg(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,S,Wt,Gt,gt,Pe,u.ah.vertical,!1,Vt,J,W))}}let He=!1;if(F.icon&&F.icon.name){const Ne=c.imageMap[F.icon.name];Ne&&(xe=WR(c.imagePositions[F.icon.name],h.get("icon-offset").evaluate(F,{},c.canonical),h.get("icon-anchor").evaluate(F,{},c.canonical)),He=!!Ne.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=He:c.bucket.sdfIcons!==He&&Ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==c.bucket.pixelRatio||h.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const De=cS(oe.horizontal)||oe.vertical;c.bucket.iconsInText=!!De&&De.iconsInText,(De||xe)&&l9(c.bucket,F,oe,xe,c.imageMap,y,J,ae,Pe,He,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},u.bn=d_,u.bo=c_,u.bp=h_,u.bq=ic,u.br=p_,u.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},u.bt=function(c,a,h,f,y){return l(this,void 0,void 0,function*(){if(U())try{return yield tt(c,a,h,f,y)}catch{}return function(S,T,E,I,F){const j=S.width,W=S.height;_t&&Lt||(_t=new OffscreenCanvas(j,W),Lt=_t.getContext("2d",{willReadFrequently:!0})),_t.width=j,_t.height=W,Lt.drawImage(S,0,0,j,W);const J=Lt.getImageData(T,E,I,F);return Lt.clearRect(0,0,j,W),J.data}(c,a,h,f,y)})},u.bu=$3,u.bv=p,u.bw=v,u.bx=v3,u.by=pr,u.bz=function(c){return c.message===Cn},u.c=nt,u.d=c=>l(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(h){throw new Error(`Could not load image because of ${h.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),u.e=ee,u.f=c=>new Promise((a,h)=>{const f=new Image;f.onload=()=>{a(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Je})},f.onerror=()=>h(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(y):Je}),u.g=Ft,u.h=(c,a)=>In(ee(c,{type:"json"}),a),u.i=ut,u.j=Yt,u.k=Qn,u.l=(c,a)=>In(ee(c,{type:"arrayBuffer"}),a),u.m=In,u.n=function(c){return new p_(c).readFields(BR,[])},u.o=_0,u.p=E3,u.q=Yi,u.r=Xf,u.s=je,u.t=Km,u.u=$t,u.v=re,u.w=Ae,u.x=Jl,u.y=function([c,a,h]){return a+=90,a*=Math.PI/180,h*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(h),y:c*Math.sin(a)*Math.sin(h),z:c*Math.cos(h)}},u.z=fa}),i("worker",["./shared"],function(u){class l{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,V){for(const ne of O){this._layerConfigs[ne.id]=ne;const me=this._layers[ne.id]=u.az(ne);me._featureFilter=u.a6(me.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of V)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const $=u.bh(Object.values(this._layerConfigs),this.keyCache);for(const ne of $){const me=ne.map(Ye=>this._layers[Ye.id]),Se=me[0];if(Se.visibility==="none")continue;const Te=Se.source||"";let ye=this.familiesBySource[Te];ye||(ye=this.familiesBySource[Te]={});const Re=Se.sourceLayer||"_geojsonTileLayer";let $e=ye[Re];$e||($e=ye[Re]=[]),$e.push(me)}}}class p{constructor(O){const V={},$=[];for(const Te in O){const ye=O[Te],Re=V[Te]={};for(const $e in ye){const Ye=ye[+$e];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ge={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};$.push(Ge),Re[$e]={rect:Ge,metrics:Ye.metrics}}}const{w:ne,h:me}=u.p($),Se=new u.o({width:ne||1,height:me||1});for(const Te in O){const ye=O[Te];for(const Re in ye){const $e=ye[+Re];if(!$e||$e.bitmap.width===0||$e.bitmap.height===0)continue;const Ye=V[Te][Re].rect;u.o.copy($e.bitmap,Se,{x:0,y:0},{x:Ye.x+1,y:Ye.y+1},$e.bitmap)}}this.image=Se,this.positions=V}}u.bi("GlyphAtlas",p);class v{constructor(O){this.tileID=new u.Q(O.tileID.overscaledZ,O.tileID.wrap,O.tileID.canonical.z,O.tileID.canonical.x,O.tileID.canonical.y),this.uid=O.uid,this.zoom=O.zoom,this.pixelRatio=O.pixelRatio,this.tileSize=O.tileSize,this.source=O.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=O.showCollisionBoxes,this.collectResourceTiming=!!O.collectResourceTiming,this.returnDependencies=!!O.returnDependencies,this.promoteId=O.promoteId,this.inFlightDependencies=[]}parse(O,V,$,ne){return u._(this,void 0,void 0,function*(){this.status="parsing",this.data=O,this.collisionBoxArray=new u.a4;const me=new u.bj(Object.keys(O.layers).sort()),Se=new u.bk(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const Te={},ye={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},Re=V.familiesBySource[this.source];for(const Le in Re){const We=O.layers[Le];if(!We)continue;We.version===1&&u.w(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xe=me.encode(Le),Ze=[];for(let Pt=0;Pt<We.length;Pt++){const rn=We.feature(Pt),It=Se.getId(rn,Le);Ze.push({feature:rn,id:It,index:Pt,sourceLayerIndex:Xe})}for(const Pt of Re[Le]){const rn=Pt[0];rn.source!==this.source&&u.w(`layer.source = ${rn.source} does not equal this.source = ${this.source}`),rn.minzoom&&this.zoom<Math.floor(rn.minzoom)||rn.maxzoom&&this.zoom>=rn.maxzoom||rn.visibility!=="none"&&(x(Pt,this.zoom,$),(Te[rn.id]=rn.createBucket({index:Se.bucketLayerIDs.length,layers:Pt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xe,sourceID:this.source})).populate(Ze,ye,this.tileID.canonical),Se.bucketLayerIDs.push(Pt.map(It=>It.id)))}}const $e=u.aE(ye.glyphDependencies,Le=>Object.keys(Le).map(Number));this.inFlightDependencies.forEach(Le=>Le==null?void 0:Le.abort()),this.inFlightDependencies=[];let Ye=Promise.resolve({});if(Object.keys($e).length){const Le=new AbortController;this.inFlightDependencies.push(Le),Ye=ne.sendAsync({type:"getGlyphs",data:{stacks:$e,source:this.source,tileID:this.tileID,type:"glyphs"}},Le)}const Ge=Object.keys(ye.iconDependencies);let Ct=Promise.resolve({});if(Ge.length){const Le=new AbortController;this.inFlightDependencies.push(Le),Ct=ne.sendAsync({type:"getImages",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},Le)}const nn=Object.keys(ye.patternDependencies);let on=Promise.resolve({});if(nn.length){const Le=new AbortController;this.inFlightDependencies.push(Le),on=ne.sendAsync({type:"getImages",data:{icons:nn,source:this.source,tileID:this.tileID,type:"patterns"}},Le)}const[bn,wn,lr]=yield Promise.all([Ye,Ct,on]),er=new p(bn),de=new u.bl(wn,lr);for(const Le in Te){const We=Te[Le];We instanceof u.a5?(x(We.layers,this.zoom,$),u.bm({bucket:We,glyphMap:bn,glyphPositions:er.positions,imageMap:wn,imagePositions:de.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):We.hasPattern&&(We instanceof u.bn||We instanceof u.bo||We instanceof u.bp)&&(x(We.layers,this.zoom,$),We.addFeatures(ye,this.tileID.canonical,de.patternPositions))}return this.status="done",{buckets:Object.values(Te).filter(Le=>!Le.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:er.image,imageAtlas:de,glyphMap:this.returnDependencies?bn:null,iconMap:this.returnDependencies?wn:null,glyphPositions:this.returnDependencies?er.positions:null}})}}function x(ce,O,V){const $=new u.a8(O);for(const ne of ce)ne.recalculate($,V)}class M{constructor(O,V,$){this.actor=O,this.layerIndex=V,this.availableImages=$,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(O,V){return u._(this,void 0,void 0,function*(){const $=yield u.l(O.request,V);try{return{vectorTile:new u.bq.VectorTile(new u.br($.data)),rawData:$.data,cacheControl:$.cacheControl,expires:$.expires}}catch(ne){const me=new Uint8Array($.data);let Se=`Unable to parse the tile at ${O.request.url}, `;throw Se+=me[0]===31&&me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.messge}`,new Error(Se)}})}loadTile(O){return u._(this,void 0,void 0,function*(){const V=O.uid,$=!!(O&&O.request&&O.request.collectResourceTiming)&&new u.bs(O.request),ne=new v(O);this.loading[V]=ne;const me=new AbortController;ne.abort=me;try{const Se=yield this.loadVectorTile(O,me);if(delete this.loading[V],!Se)return null;const Te=Se.rawData,ye={};Se.expires&&(ye.expires=Se.expires),Se.cacheControl&&(ye.cacheControl=Se.cacheControl);const Re={};if($){const Ye=$.finish();Ye&&(Re.resourceTiming=JSON.parse(JSON.stringify(Ye)))}ne.vectorTile=Se.vectorTile;const $e=ne.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[V]=ne,this.fetching[V]={rawTileData:Te,cacheControl:ye,resourceTiming:Re};try{const Ye=yield $e;return u.e({rawTileData:Te.slice(0)},Ye,ye,Re)}finally{delete this.fetching[V]}}catch(Se){throw delete this.loading[V],ne.status="done",this.loaded[V]=ne,Se}})}reloadTile(O){return u._(this,void 0,void 0,function*(){const V=O.uid;if(!this.loaded||!this.loaded[V])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const $=this.loaded[V];if($.showCollisionBoxes=O.showCollisionBoxes,$.status==="parsing"){const ne=yield $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor);let me;if(this.fetching[V]){const{rawTileData:Se,cacheControl:Te,resourceTiming:ye}=this.fetching[V];delete this.fetching[V],me=u.e({rawTileData:Se.slice(0)},ne,Te,ye)}else me=ne;return me}if($.status==="done"&&$.vectorTile)return $.parse($.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(O){return u._(this,void 0,void 0,function*(){const V=this.loading,$=O.uid;V&&V[$]&&V[$].abort&&(V[$].abort.abort(),delete V[$])})}removeTile(O){return u._(this,void 0,void 0,function*(){this.loaded&&this.loaded[O.uid]&&delete this.loaded[O.uid]})}}class w{constructor(){this.loaded={}}loadTile(O){return u._(this,void 0,void 0,function*(){const{uid:V,encoding:$,rawImageData:ne,redFactor:me,greenFactor:Se,blueFactor:Te,baseShift:ye}=O,Re=ne.width+2,$e=ne.height+2,Ye=u.b(ne)?new u.R({width:Re,height:$e},yield u.bt(ne,-1,-1,Re,$e)):ne,Ge=new u.bu(V,Ye,$,me,Se,Te,ye);return this.loaded=this.loaded||{},this.loaded[V]=Ge,Ge})}removeTile(O){const V=this.loaded,$=O.uid;V&&V[$]&&delete V[$]}}function A(ce,O){if(ce.length!==0){k(ce[0],O);for(var V=1;V<ce.length;V++)k(ce[V],!O)}}function k(ce,O){for(var V=0,$=0,ne=0,me=ce.length,Se=me-1;ne<me;Se=ne++){var Te=(ce[ne][0]-ce[Se][0])*(ce[Se][1]+ce[ne][1]),ye=V+Te;$+=Math.abs(V)>=Math.abs(Te)?V-ye+Te:Te-ye+V,V=ye}V+$>=0!=!!O&&ce.reverse()}var z=u.bv(function ce(O,V){var $,ne=O&&O.type;if(ne==="FeatureCollection")for($=0;$<O.features.length;$++)ce(O.features[$],V);else if(ne==="GeometryCollection")for($=0;$<O.geometries.length;$++)ce(O.geometries[$],V);else if(ne==="Feature")ce(O.geometry,V);else if(ne==="Polygon")A(O.coordinates,V);else if(ne==="MultiPolygon")for($=0;$<O.coordinates.length;$++)A(O.coordinates[$],V);return O});const D=u.bq.VectorTileFeature.prototype.toGeoJSON;var C={exports:{}},U=u.bw,B=u.bq.VectorTileFeature,K=ue;function ue(ce,O){this.options=O||{},this.features=ce,this.length=ce.length}function Z(ce,O){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=O||4096}ue.prototype.feature=function(ce){return new Z(this.features[ce],this.options.extent)},Z.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var O=0;O<ce.length;O++){for(var V=ce[O],$=[],ne=0;ne<V.length;ne++)$.push(new U(V[ne][0],V[ne][1]));this.geometry.push($)}return this.geometry},Z.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,O=1/0,V=-1/0,$=1/0,ne=-1/0,me=0;me<ce.length;me++)for(var Se=ce[me],Te=0;Te<Se.length;Te++){var ye=Se[Te];O=Math.min(O,ye.x),V=Math.max(V,ye.x),$=Math.min($,ye.y),ne=Math.max(ne,ye.y)}return[O,$,V,ne]},Z.prototype.toGeoJSON=B.prototype.toGeoJSON;var ee=u.bx,be=K;function ie(ce){var O=new ee;return function(V,$){for(var ne in V.layers)$.writeMessage(3,Q,V.layers[ne])}(ce,O),O.finish()}function Q(ce,O){var V;O.writeVarintField(15,ce.version||1),O.writeStringField(1,ce.name||""),O.writeVarintField(5,ce.extent||4096);var $={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<ce.length;V++)$.feature=ce.feature(V),O.writeMessage(2,Ee,$);var ne=$.keys;for(V=0;V<ne.length;V++)O.writeStringField(3,ne[V]);var me=$.values;for(V=0;V<me.length;V++)O.writeMessage(4,ut,me[V])}function Ee(ce,O){var V=ce.feature;V.id!==void 0&&O.writeVarintField(1,V.id),O.writeMessage(2,Fe,ce),O.writeVarintField(3,V.type),O.writeMessage(4,lt,V)}function Fe(ce,O){var V=ce.feature,$=ce.keys,ne=ce.values,me=ce.keycache,Se=ce.valuecache;for(var Te in V.properties){var ye=V.properties[Te],Re=me[Te];if(ye!==null){Re===void 0&&($.push(Te),me[Te]=Re=$.length-1),O.writeVarint(Re);var $e=typeof ye;$e!=="string"&&$e!=="boolean"&&$e!=="number"&&(ye=JSON.stringify(ye));var Ye=$e+":"+ye,Ge=Se[Ye];Ge===void 0&&(ne.push(ye),Se[Ye]=Ge=ne.length-1),O.writeVarint(Ge)}}}function Ae(ce,O){return(O<<3)+(7&ce)}function Ve(ce){return ce<<1^ce>>31}function lt(ce,O){for(var V=ce.loadGeometry(),$=ce.type,ne=0,me=0,Se=V.length,Te=0;Te<Se;Te++){var ye=V[Te],Re=1;$===1&&(Re=ye.length),O.writeVarint(Ae(1,Re));for(var $e=$===3?ye.length-1:ye.length,Ye=0;Ye<$e;Ye++){Ye===1&&$!==1&&O.writeVarint(Ae(2,$e-1));var Ge=ye[Ye].x-ne,Ct=ye[Ye].y-me;O.writeVarint(Ve(Ge)),O.writeVarint(Ve(Ct)),ne+=Ge,me+=Ct}$===3&&O.writeVarint(Ae(7,1))}}function ut(ce,O){var V=typeof ce;V==="string"?O.writeStringField(1,ce):V==="boolean"?O.writeBooleanField(7,ce):V==="number"&&(ce%1!=0?O.writeDoubleField(3,ce):ce<0?O.writeSVarintField(6,ce):O.writeVarintField(5,ce))}C.exports=ie,C.exports.fromVectorTileJs=ie,C.exports.fromGeojsonVt=function(ce,O){O=O||{};var V={};for(var $ in ce)V[$]=new be(ce[$].features,O),V[$].name=$,V[$].version=O.version,V[$].extent=O.extent;return ie({layers:V})},C.exports.GeoJSONWrapper=be;var pt=u.bv(C.exports);const ke={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Je=Math.fround||(tt=new Float32Array(1),ce=>(tt[0]=+ce,tt[0]));var tt;const _t=3,Lt=5,Cn=6;class nt{constructor(O){this.options=Object.assign(Object.create(ke),O),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(O){const{log:V,minZoom:$,maxZoom:ne}=this.options;V&&console.time("total time");const me=`prepare ${O.length} points`;V&&console.time(me),this.points=O;const Se=[];for(let ye=0;ye<O.length;ye++){const Re=O[ye];if(!Re.geometry)continue;const[$e,Ye]=Re.geometry.coordinates,Ge=Je(At($e)),Ct=Je(gn(Ye));Se.push(Ge,Ct,1/0,ye,-1,1),this.options.reduce&&Se.push(0)}let Te=this.trees[ne+1]=this._createTree(Se);V&&console.timeEnd(me);for(let ye=ne;ye>=$;ye--){const Re=+Date.now();Te=this.trees[ye]=this._createTree(this._cluster(Te,ye)),V&&console.log("z%d: %d clusters in %dms",ye,Te.numItems,+Date.now()-Re)}return V&&console.timeEnd("total time"),this}getClusters(O,V){let $=((O[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,O[1]));let me=O[2]===180?180:((O[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)$=-180,me=180;else if($>me){const Ye=this.getClusters([$,ne,180,Se],V),Ge=this.getClusters([-180,ne,me,Se],V);return Ye.concat(Ge)}const Te=this.trees[this._limitZoom(V)],ye=Te.range(At($),gn(Se),At(me),gn(ne)),Re=Te.data,$e=[];for(const Ye of ye){const Ge=this.stride*Ye;$e.push(Re[Ge+Lt]>1?wt(Re,Ge,this.clusterProps):this.points[Re[Ge+_t]])}return $e}getChildren(O){const V=this._getOriginId(O),$=this._getOriginZoom(O),ne="No cluster with the specified id.",me=this.trees[$];if(!me)throw new Error(ne);const Se=me.data;if(V*this.stride>=Se.length)throw new Error(ne);const Te=this.options.radius/(this.options.extent*Math.pow(2,$-1)),ye=me.within(Se[V*this.stride],Se[V*this.stride+1],Te),Re=[];for(const $e of ye){const Ye=$e*this.stride;Se[Ye+4]===O&&Re.push(Se[Ye+Lt]>1?wt(Se,Ye,this.clusterProps):this.points[Se[Ye+_t]])}if(Re.length===0)throw new Error(ne);return Re}getLeaves(O,V,$){const ne=[];return this._appendLeaves(ne,O,V=V||10,$=$||0,0),ne}getTile(O,V,$){const ne=this.trees[this._limitZoom(O)],me=Math.pow(2,O),{extent:Se,radius:Te}=this.options,ye=Te/Se,Re=($-ye)/me,$e=($+1+ye)/me,Ye={features:[]};return this._addTileFeatures(ne.range((V-ye)/me,Re,(V+1+ye)/me,$e),ne.data,V,$,me,Ye),V===0&&this._addTileFeatures(ne.range(1-ye/me,Re,1,$e),ne.data,me,$,me,Ye),V===me-1&&this._addTileFeatures(ne.range(0,Re,ye/me,$e),ne.data,-1,$,me,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(O){let V=this._getOriginZoom(O)-1;for(;V<=this.options.maxZoom;){const $=this.getChildren(O);if(V++,$.length!==1)break;O=$[0].properties.cluster_id}return V}_appendLeaves(O,V,$,ne,me){const Se=this.getChildren(V);for(const Te of Se){const ye=Te.properties;if(ye&&ye.cluster?me+ye.point_count<=ne?me+=ye.point_count:me=this._appendLeaves(O,ye.cluster_id,$,ne,me):me<ne?me++:O.push(Te),O.length===$)break}return me}_createTree(O){const V=new u.au(O.length/this.stride|0,this.options.nodeSize,Float32Array);for(let $=0;$<O.length;$+=this.stride)V.add(O[$],O[$+1]);return V.finish(),V.data=O,V}_addTileFeatures(O,V,$,ne,me,Se){for(const Te of O){const ye=Te*this.stride,Re=V[ye+Lt]>1;let $e,Ye,Ge;if(Re)$e=Ft(V,ye,this.clusterProps),Ye=V[ye],Ge=V[ye+1];else{const on=this.points[V[ye+_t]];$e=on.properties;const[bn,wn]=on.geometry.coordinates;Ye=At(bn),Ge=gn(wn)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Ye*me-$)),Math.round(this.options.extent*(Ge*me-ne))]],tags:$e};let nn;nn=Re||this.options.generateId?V[ye+_t]:this.points[V[ye+_t]].id,nn!==void 0&&(Ct.id=nn),Se.features.push(Ct)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(Math.floor(+O),this.options.maxZoom+1))}_cluster(O,V){const{radius:$,extent:ne,reduce:me,minPoints:Se}=this.options,Te=$/(ne*Math.pow(2,V)),ye=O.data,Re=[],$e=this.stride;for(let Ye=0;Ye<ye.length;Ye+=$e){if(ye[Ye+2]<=V)continue;ye[Ye+2]=V;const Ge=ye[Ye],Ct=ye[Ye+1],nn=O.within(ye[Ye],ye[Ye+1],Te),on=ye[Ye+Lt];let bn=on;for(const wn of nn){const lr=wn*$e;ye[lr+2]>V&&(bn+=ye[lr+Lt])}if(bn>on&&bn>=Se){let wn,lr=Ge*on,er=Ct*on,de=-1;const Le=((Ye/$e|0)<<5)+(V+1)+this.points.length;for(const We of nn){const Xe=We*$e;if(ye[Xe+2]<=V)continue;ye[Xe+2]=V;const Ze=ye[Xe+Lt];lr+=ye[Xe]*Ze,er+=ye[Xe+1]*Ze,ye[Xe+4]=Le,me&&(wn||(wn=this._map(ye,Ye,!0),de=this.clusterProps.length,this.clusterProps.push(wn)),me(wn,this._map(ye,Xe)))}ye[Ye+4]=Le,Re.push(lr/bn,er/bn,1/0,Le,-1,bn),me&&Re.push(de)}else{for(let wn=0;wn<$e;wn++)Re.push(ye[Ye+wn]);if(bn>1)for(const wn of nn){const lr=wn*$e;if(!(ye[lr+2]<=V)){ye[lr+2]=V;for(let er=0;er<$e;er++)Re.push(ye[lr+er])}}}}return Re}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,V,$){if(O[V+Lt]>1){const Se=this.clusterProps[O[V+Cn]];return $?Object.assign({},Se):Se}const ne=this.points[O[V+_t]].properties,me=this.options.map(ne);return $&&me===ne?Object.assign({},me):me}}function wt(ce,O,V){return{type:"Feature",id:ce[O+_t],properties:Ft(ce,O,V),geometry:{type:"Point",coordinates:[($=ce[O],360*($-.5)),En(ce[O+1])]}};var $}function Ft(ce,O,V){const $=ce[O+Lt],ne=$>=1e4?`${Math.round($/1e3)}k`:$>=1e3?Math.round($/100)/10+"k":$,me=ce[O+Cn],Se=me===-1?{}:Object.assign({},V[me]);return Object.assign(Se,{cluster:!0,cluster_id:ce[O+_t],point_count:$,point_count_abbreviated:ne})}function At(ce){return ce/360+.5}function gn(ce){const O=Math.sin(ce*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function En(ce){const O=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function In(ce,O,V,$){for(var ne,me=$,Se=V-O>>1,Te=V-O,ye=ce[O],Re=ce[O+1],$e=ce[V],Ye=ce[V+1],Ge=O+3;Ge<V;Ge+=3){var Ct=je(ce[Ge],ce[Ge+1],ye,Re,$e,Ye);if(Ct>me)ne=Ge,me=Ct;else if(Ct===me){var nn=Math.abs(Ge-Se);nn<Te&&(ne=Ge,Te=nn)}}me>$&&(ne-O>3&&In(ce,O,ne,$),ce[ne+2]=me,V-ne>3&&In(ce,ne,V,$))}function je(ce,O,V,$,ne,me){var Se=ne-V,Te=me-$;if(Se!==0||Te!==0){var ye=((ce-V)*Se+(O-$)*Te)/(Se*Se+Te*Te);ye>1?(V=ne,$=me):ye>0&&(V+=Se*ye,$+=Te*ye)}return(Se=ce-V)*Se+(Te=O-$)*Te}function An(ce,O,V,$){var ne={id:ce===void 0?null:ce,type:O,geometry:V,tags:$,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Se=me.geometry,Te=me.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")yn(me,Se);else if(Te==="Polygon"||Te==="MultiLineString")for(var ye=0;ye<Se.length;ye++)yn(me,Se[ye]);else if(Te==="MultiPolygon")for(ye=0;ye<Se.length;ye++)for(var Re=0;Re<Se[ye].length;Re++)yn(me,Se[ye][Re])}(ne),ne}function yn(ce,O){for(var V=0;V<O.length;V+=3)ce.minX=Math.min(ce.minX,O[V]),ce.minY=Math.min(ce.minY,O[V+1]),ce.maxX=Math.max(ce.maxX,O[V]),ce.maxY=Math.max(ce.maxY,O[V+1])}function Qn(ce,O,V,$){if(O.geometry){var ne=O.geometry.coordinates,me=O.geometry.type,Se=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),Te=[],ye=O.id;if(V.promoteId?ye=O.properties[V.promoteId]:V.generateId&&(ye=$||0),me==="Point")Yt(ne,Te);else if(me==="MultiPoint")for(var Re=0;Re<ne.length;Re++)Yt(ne[Re],Te);else if(me==="LineString")Gn(ne,Te,Se,!1);else if(me==="MultiLineString"){if(V.lineMetrics){for(Re=0;Re<ne.length;Re++)Gn(ne[Re],Te=[],Se,!1),ce.push(An(ye,"LineString",Te,O.properties));return}re(ne,Te,Se,!1)}else if(me==="Polygon")re(ne,Te,Se,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Re=0;Re<O.geometry.geometries.length;Re++)Qn(ce,{id:ye,geometry:O.geometry.geometries[Re],properties:O.properties},V,$);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<ne.length;Re++){var $e=[];re(ne[Re],$e,Se,!0),Te.push($e)}}ce.push(An(ye,me,Te,O.properties))}}function Yt(ce,O){O.push(le(ce[0])),O.push(st(ce[1])),O.push(0)}function Gn(ce,O,V,$){for(var ne,me,Se=0,Te=0;Te<ce.length;Te++){var ye=le(ce[Te][0]),Re=st(ce[Te][1]);O.push(ye),O.push(Re),O.push(0),Te>0&&(Se+=$?(ne*Re-ye*me)/2:Math.sqrt(Math.pow(ye-ne,2)+Math.pow(Re-me,2))),ne=ye,me=Re}var $e=O.length-3;O[2]=1,In(O,0,$e,V),O[$e+2]=1,O.size=Math.abs(Se),O.start=0,O.end=O.size}function re(ce,O,V,$){for(var ne=0;ne<ce.length;ne++){var me=[];Gn(ce[ne],me,V,$),O.push(me)}}function le(ce){return ce/360+.5}function st(ce){var O=Math.sin(ce*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function it(ce,O,V,$,ne,me,Se,Te){if($/=O,me>=(V/=O)&&Se<$)return ce;if(Se<V||me>=$)return null;for(var ye=[],Re=0;Re<ce.length;Re++){var $e=ce[Re],Ye=$e.geometry,Ge=$e.type,Ct=ne===0?$e.minX:$e.minY,nn=ne===0?$e.maxX:$e.maxY;if(Ct>=V&&nn<$)ye.push($e);else if(!(nn<V||Ct>=$)){var on=[];if(Ge==="Point"||Ge==="MultiPoint")mt(Ye,on,V,$,ne);else if(Ge==="LineString")St(Ye,on,V,$,ne,!1,Te.lineMetrics);else if(Ge==="MultiLineString")Mt(Ye,on,V,$,ne,!1);else if(Ge==="Polygon")Mt(Ye,on,V,$,ne,!0);else if(Ge==="MultiPolygon")for(var bn=0;bn<Ye.length;bn++){var wn=[];Mt(Ye[bn],wn,V,$,ne,!0),wn.length&&on.push(wn)}if(on.length){if(Te.lineMetrics&&Ge==="LineString"){for(bn=0;bn<on.length;bn++)ye.push(An($e.id,Ge,on[bn],$e.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(on.length===1?(Ge="LineString",on=on[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=on.length===3?"Point":"MultiPoint"),ye.push(An($e.id,Ge,on,$e.tags))}}}return ye.length?ye:null}function mt(ce,O,V,$,ne){for(var me=0;me<ce.length;me+=3){var Se=ce[me+ne];Se>=V&&Se<=$&&(O.push(ce[me]),O.push(ce[me+1]),O.push(ce[me+2]))}}function St(ce,O,V,$,ne,me,Se){for(var Te,ye,Re=_n(ce),$e=ne===0?xn:Nt,Ye=ce.start,Ge=0;Ge<ce.length-3;Ge+=3){var Ct=ce[Ge],nn=ce[Ge+1],on=ce[Ge+2],bn=ce[Ge+3],wn=ce[Ge+4],lr=ne===0?Ct:nn,er=ne===0?bn:wn,de=!1;Se&&(Te=Math.sqrt(Math.pow(Ct-bn,2)+Math.pow(nn-wn,2))),lr<V?er>V&&(ye=$e(Re,Ct,nn,bn,wn,V),Se&&(Re.start=Ye+Te*ye)):lr>$?er<$&&(ye=$e(Re,Ct,nn,bn,wn,$),Se&&(Re.start=Ye+Te*ye)):hn(Re,Ct,nn,on),er<V&&lr>=V&&(ye=$e(Re,Ct,nn,bn,wn,V),de=!0),er>$&&lr<=$&&(ye=$e(Re,Ct,nn,bn,wn,$),de=!0),!me&&de&&(Se&&(Re.end=Ye+Te*ye),O.push(Re),Re=_n(ce)),Se&&(Ye+=Te)}var Le=ce.length-3;Ct=ce[Le],nn=ce[Le+1],on=ce[Le+2],(lr=ne===0?Ct:nn)>=V&&lr<=$&&hn(Re,Ct,nn,on),Le=Re.length-3,me&&Le>=3&&(Re[Le]!==Re[0]||Re[Le+1]!==Re[1])&&hn(Re,Re[0],Re[1],Re[2]),Re.length&&O.push(Re)}function _n(ce){var O=[];return O.size=ce.size,O.start=ce.start,O.end=ce.end,O}function Mt(ce,O,V,$,ne,me){for(var Se=0;Se<ce.length;Se++)St(ce[Se],O,V,$,ne,me,!1)}function hn(ce,O,V,$){ce.push(O),ce.push(V),ce.push($)}function xn(ce,O,V,$,ne,me){var Se=(me-O)/($-O);return ce.push(me),ce.push(V+(ne-V)*Se),ce.push(1),Se}function Nt(ce,O,V,$,ne,me){var Se=(me-V)/(ne-V);return ce.push(O+($-O)*Se),ce.push(me),ce.push(1),Se}function an(ce,O){for(var V=[],$=0;$<ce.length;$++){var ne,me=ce[$],Se=me.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ne=at(me.geometry,O);else if(Se==="MultiLineString"||Se==="Polygon"){ne=[];for(var Te=0;Te<me.geometry.length;Te++)ne.push(at(me.geometry[Te],O))}else if(Se==="MultiPolygon")for(ne=[],Te=0;Te<me.geometry.length;Te++){for(var ye=[],Re=0;Re<me.geometry[Te].length;Re++)ye.push(at(me.geometry[Te][Re],O));ne.push(ye)}V.push(An(me.id,Se,ne,me.tags))}return V}function at(ce,O){var V=[];V.size=ce.size,ce.start!==void 0&&(V.start=ce.start,V.end=ce.end);for(var $=0;$<ce.length;$+=3)V.push(ce[$]+O,ce[$+1],ce[$+2]);return V}function tn(ce,O){if(ce.transformed)return ce;var V,$,ne,me=1<<ce.z,Se=ce.x,Te=ce.y;for(V=0;V<ce.features.length;V++){var ye=ce.features[V],Re=ye.geometry,$e=ye.type;if(ye.geometry=[],$e===1)for($=0;$<Re.length;$+=2)ye.geometry.push(Kt(Re[$],Re[$+1],O,me,Se,Te));else for($=0;$<Re.length;$++){var Ye=[];for(ne=0;ne<Re[$].length;ne+=2)Ye.push(Kt(Re[$][ne],Re[$][ne+1],O,me,Se,Te));ye.geometry.push(Ye)}}return ce.transformed=!0,ce}function Kt(ce,O,V,$,ne,me){return[Math.round(V*(ce*$-ne)),Math.round(V*(O*$-me))]}function Bn(ce,O,V,$,ne){for(var me=O===ne.maxZoom?0:ne.tolerance/((1<<O)*ne.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:$,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Te=0;Te<ce.length;Te++){Se.numFeatures++,Un(Se,ce[Te],me,ne);var ye=ce[Te].minX,Re=ce[Te].minY,$e=ce[Te].maxX,Ye=ce[Te].maxY;ye<Se.minX&&(Se.minX=ye),Re<Se.minY&&(Se.minY=Re),$e>Se.maxX&&(Se.maxX=$e),Ye>Se.maxY&&(Se.maxY=Ye)}return Se}function Un(ce,O,V,$){var ne=O.geometry,me=O.type,Se=[];if(me==="Point"||me==="MultiPoint")for(var Te=0;Te<ne.length;Te+=3)Se.push(ne[Te]),Se.push(ne[Te+1]),ce.numPoints++,ce.numSimplified++;else if(me==="LineString")dt(Se,ne,ce,V,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(Te=0;Te<ne.length;Te++)dt(Se,ne[Te],ce,V,me==="Polygon",Te===0);else if(me==="MultiPolygon")for(var ye=0;ye<ne.length;ye++){var Re=ne[ye];for(Te=0;Te<Re.length;Te++)dt(Se,Re[Te],ce,V,!0,Te===0)}if(Se.length){var $e=O.tags||null;if(me==="LineString"&&$.lineMetrics){for(var Ye in $e={},O.tags)$e[Ye]=O.tags[Ye];$e.mapbox_clip_start=ne.start/ne.size,$e.mapbox_clip_end=ne.end/ne.size}var Ge={geometry:Se,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:$e};O.id!==null&&(Ge.id=O.id),ce.features.push(Ge)}}function dt(ce,O,V,$,ne,me){var Se=$*$;if($>0&&O.size<(ne?Se:$))V.numPoints+=O.length/3;else{for(var Te=[],ye=0;ye<O.length;ye+=3)($===0||O[ye+2]>Se)&&(V.numSimplified++,Te.push(O[ye]),Te.push(O[ye+1])),V.numPoints++;ne&&function(Re,$e){for(var Ye=0,Ge=0,Ct=Re.length,nn=Ct-2;Ge<Ct;nn=Ge,Ge+=2)Ye+=(Re[Ge]-Re[nn])*(Re[Ge+1]+Re[nn+1]);if(Ye>0===$e)for(Ge=0,Ct=Re.length;Ge<Ct/2;Ge+=2){var on=Re[Ge],bn=Re[Ge+1];Re[Ge]=Re[Ct-2-Ge],Re[Ge+1]=Re[Ct-1-Ge],Re[Ct-2-Ge]=on,Re[Ct-1-Ge]=bn}}(Te,me),ce.push(Te)}}function Ht(ce,O){var V=(O=this.options=function(ne,me){for(var Se in me)ne[Se]=me[Se];return ne}(Object.create(this.options),O)).debug;if(V&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var $=function(ne,me){var Se=[];if(ne.type==="FeatureCollection")for(var Te=0;Te<ne.features.length;Te++)Qn(Se,ne.features[Te],me,Te);else Qn(Se,ne.type==="Feature"?ne:{geometry:ne},me);return Se}(ce,O);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),$=function(ne,me){var Se=me.buffer/me.extent,Te=ne,ye=it(ne,1,-1-Se,Se,0,-1,2,me),Re=it(ne,1,1-Se,2+Se,0,-1,2,me);return(ye||Re)&&(Te=it(ne,1,-Se,1+Se,0,-1,2,me)||[],ye&&(Te=an(ye,1).concat(Te)),Re&&(Te=Te.concat(an(Re,-1)))),Te}($,O),$.length&&this.splitTile($,0,0,0),V&&($.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jt(ce,O,V){return 32*((1<<ce)*V+O)+ce}function Jt(ce,O){return O?ce.properties[O]:ce.id}function X(ce,O){if(ce==null)return!0;if(ce.type==="Feature")return Jt(ce,O)!=null;if(ce.type==="FeatureCollection"){const V=new Set;for(const $ of ce.features){const ne=Jt($,O);if(ne==null||V.has(ne))return!1;V.add(ne)}return!0}return!1}function Be(ce,O){const V=new Map;if(ce!=null)if(ce.type==="Feature")V.set(Jt(ce,O),ce);else for(const $ of ce.features)V.set(Jt($,O),$);return V}Ht.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ht.prototype.splitTile=function(ce,O,V,$,ne,me,Se){for(var Te=[ce,O,V,$],ye=this.options,Re=ye.debug;Te.length;){$=Te.pop(),V=Te.pop(),O=Te.pop(),ce=Te.pop();var $e=1<<O,Ye=jt(O,V,$),Ge=this.tiles[Ye];if(!Ge&&(Re>1&&console.time("creation"),Ge=this.tiles[Ye]=Bn(ce,O,V,$,ye),this.tileCoords.push({z:O,x:V,y:$}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,V,$,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Ct="z"+O;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(Ge.source=ce,ne){if(O===ye.maxZoom||O===ne)continue;var nn=1<<ne-O;if(V!==Math.floor(me/nn)||$!==Math.floor(Se/nn))continue}else if(O===ye.indexMaxZoom||Ge.numPoints<=ye.indexMaxPoints)continue;if(Ge.source=null,ce.length!==0){Re>1&&console.time("clipping");var on,bn,wn,lr,er,de,Le=.5*ye.buffer/ye.extent,We=.5-Le,Xe=.5+Le,Ze=1+Le;on=bn=wn=lr=null,er=it(ce,$e,V-Le,V+Xe,0,Ge.minX,Ge.maxX,ye),de=it(ce,$e,V+We,V+Ze,0,Ge.minX,Ge.maxX,ye),ce=null,er&&(on=it(er,$e,$-Le,$+Xe,1,Ge.minY,Ge.maxY,ye),bn=it(er,$e,$+We,$+Ze,1,Ge.minY,Ge.maxY,ye),er=null),de&&(wn=it(de,$e,$-Le,$+Xe,1,Ge.minY,Ge.maxY,ye),lr=it(de,$e,$+We,$+Ze,1,Ge.minY,Ge.maxY,ye),de=null),Re>1&&console.timeEnd("clipping"),Te.push(on||[],O+1,2*V,2*$),Te.push(bn||[],O+1,2*V,2*$+1),Te.push(wn||[],O+1,2*V+1,2*$),Te.push(lr||[],O+1,2*V+1,2*$+1)}}},Ht.prototype.getTile=function(ce,O,V){var $=this.options,ne=$.extent,me=$.debug;if(ce<0||ce>24)return null;var Se=1<<ce,Te=jt(ce,O=(O%Se+Se)%Se,V);if(this.tiles[Te])return tn(this.tiles[Te],ne);me>1&&console.log("drilling down to z%d-%d-%d",ce,O,V);for(var ye,Re=ce,$e=O,Ye=V;!ye&&Re>0;)Re--,$e=Math.floor($e/2),Ye=Math.floor(Ye/2),ye=this.tiles[jt(Re,$e,Ye)];return ye&&ye.source?(me>1&&console.log("found parent tile z%d-%d-%d",Re,$e,Ye),me>1&&console.time("drilling down"),this.splitTile(ye.source,Re,$e,Ye,ce,O,V),me>1&&console.timeEnd("drilling down"),this.tiles[Te]?tn(this.tiles[Te],ne):null):null};class ft extends M{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(O,V){return u._(this,void 0,void 0,function*(){const $=O.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ne)return null;const me=new class{constructor(Te){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.W,this.length=Te.length,this._features=Te}feature(Te){return new class{constructor(ye){this._feature=ye,this.extent=u.W,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const Re of this._feature.geometry)ye.push([new u.P(Re[0],Re[1])]);return ye}{const ye=[];for(const Re of this._feature.geometry){const $e=[];for(const Ye of Re)$e.push(new u.P(Ye[0],Ye[1]));ye.push($e)}return ye}}toGeoJSON(ye,Re,$e){return D.call(this,ye,Re,$e)}}(this._features[Te])}}(ne.features);let Se=pt(me);return Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),{vectorTile:me,rawData:Se.buffer}})}loadData(O){return u._(this,void 0,void 0,function*(){var V;(V=this._pendingRequest)===null||V===void 0||V.abort();const $=!!(O&&O.request&&O.request.collectResourceTiming)&&new u.bs(O.request);this._pendingRequest=new AbortController;try{let ne=yield this.loadGeoJSON(O,this._pendingRequest);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(z(ne,!0),O.filter){const Se=u.by(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(ye=>Se.value.evaluate({zoom:0},ye))}}this._geoJSONIndex=O.cluster?new nt(function({superclusterOptions:Se,clusterProperties:Te}){if(!Te||!Se)return Se;const ye={},Re={},$e={accumulated:null,zoom:0},Ye={properties:null},Ge=Object.keys(Te);for(const Ct of Ge){const[nn,on]=Te[Ct],bn=u.by(on),wn=u.by(typeof nn=="string"?[nn,["accumulated"],["get",Ct]]:nn);ye[Ct]=bn.value,Re[Ct]=wn.value}return Se.map=Ct=>{Ye.properties=Ct;const nn={};for(const on of Ge)nn[on]=ye[on].evaluate($e,Ye);return nn},Se.reduce=(Ct,nn)=>{Ye.properties=nn;for(const on of Ge)$e.accumulated=Ct[on],Ct[on]=Re[on].evaluate($e,Ye)},Se}(O)).load(ne.features):function(Se,Te){return new Ht(Se,Te)}(ne,O.geojsonVtOptions),this.loaded={};const me={};if($){const Se=$.finish();Se&&(me.resourceTiming={},me.resourceTiming[O.source]=JSON.parse(JSON.stringify(Se)))}return me}catch(ne){if(delete this._pendingRequest,u.bz(ne))return{abandoned:!0};throw ne}})}reloadTile(O){const V=this.loaded;return V&&V[O.uid]?super.reloadTile(O):this.loadTile(O)}loadGeoJSON(O,V){return u._(this,void 0,void 0,function*(){const{promoteId:$}=O;if(O.request){const ne=yield u.h(O.request,V);return this._dataUpdateable=X(ne.data,$)?Be(ne.data,$):void 0,ne.data}if(typeof O.data=="string")try{const ne=JSON.parse(O.data);return this._dataUpdateable=X(ne,$)?Be(ne,$):void 0,ne}catch{throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`)}if(!O.dataDiff)throw new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${O.source}`);return function(ne,me,Se){var Te,ye,Re,$e;if(me.removeAll&&ne.clear(),me.remove)for(const Ye of me.remove)ne.delete(Ye);if(me.add)for(const Ye of me.add){const Ge=Jt(Ye,Se);Ge!=null&&ne.set(Ge,Ye)}if(me.update)for(const Ye of me.update){let Ge=ne.get(Ye.id);if(Ge==null)continue;const Ct=!Ye.removeAllProperties&&(((Te=Ye.removeProperties)===null||Te===void 0?void 0:Te.length)>0||((ye=Ye.addOrUpdateProperties)===null||ye===void 0?void 0:ye.length)>0);if((Ye.newGeometry||Ye.removeAllProperties||Ct)&&(Ge=Object.assign({},Ge),ne.set(Ye.id,Ge),Ct&&(Ge.properties=Object.assign({},Ge.properties))),Ye.newGeometry&&(Ge.geometry=Ye.newGeometry),Ye.removeAllProperties)Ge.properties={};else if(((Re=Ye.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const nn of Ye.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,nn)&&delete Ge.properties[nn];if((($e=Ye.addOrUpdateProperties)===null||$e===void 0?void 0:$e.length)>0)for(const{key:nn,value:on}of Ye.addOrUpdateProperties)Ge.properties[nn]=on}}(this._dataUpdateable,O.dataDiff,$),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(O){return u._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(O){return this._geoJSONIndex.getClusterExpansionZoom(O.clusterId)}getClusterChildren(O){return this._geoJSONIndex.getChildren(O.clusterId)}getClusterLeaves(O){return this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset)}}class kt{constructor(O){this.self=O,this.actor=new u.C(O),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(V,$)=>{if(this.externalWorkerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.externalWorkerSourceTypes[V]=$},this.self.addProtocol=u.bf,this.self.removeProtocol=u.bg,this.self.registerRTLTextPlugin=V=>{if(u.bA.isParsed())throw new Error("RTL text plugin already registered.");u.bA.setMethods(V)},this.actor.registerMessageHandler("loadDEMTile",(V,$)=>this._getDEMWorkerSource(V,$.source).loadTile($)),this.actor.registerMessageHandler("removeDEMTile",(V,$)=>u._(this,void 0,void 0,function*(){this._getDEMWorkerSource(V,$.source).removeTile($)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(V,$)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(V,$.type,$.source).getClusterExpansionZoom($)})),this.actor.registerMessageHandler("getClusterChildren",(V,$)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(V,$.type,$.source).getClusterChildren($)})),this.actor.registerMessageHandler("getClusterLeaves",(V,$)=>u._(this,void 0,void 0,function*(){return this._getWorkerSource(V,$.type,$.source).getClusterLeaves($)})),this.actor.registerMessageHandler("loadData",(V,$)=>this._getWorkerSource(V,$.type,$.source).loadData($)),this.actor.registerMessageHandler("loadTile",(V,$)=>this._getWorkerSource(V,$.type,$.source).loadTile($)),this.actor.registerMessageHandler("reloadTile",(V,$)=>this._getWorkerSource(V,$.type,$.source).reloadTile($)),this.actor.registerMessageHandler("abortTile",(V,$)=>this._getWorkerSource(V,$.type,$.source).abortTile($)),this.actor.registerMessageHandler("removeTile",(V,$)=>this._getWorkerSource(V,$.type,$.source).removeTile($)),this.actor.registerMessageHandler("removeSource",(V,$)=>u._(this,void 0,void 0,function*(){if(!this.workerSources[V]||!this.workerSources[V][$.type]||!this.workerSources[V][$.type][$.source])return;const ne=this.workerSources[V][$.type][$.source];delete this.workerSources[V][$.type][$.source],ne.removeSource!==void 0&&ne.removeSource($)})),this.actor.registerMessageHandler("removeMap",V=>u._(this,void 0,void 0,function*(){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V]})),this.actor.registerMessageHandler("setReferrer",(V,$)=>u._(this,void 0,void 0,function*(){this.referrer=$})),this.actor.registerMessageHandler("syncRTLPluginState",(V,$)=>this._syncRTLPluginState(V,$)),this.actor.registerMessageHandler("importScript",(V,$)=>u._(this,void 0,void 0,function*(){this.self.importScripts($)})),this.actor.registerMessageHandler("setImages",(V,$)=>this._setImages(V,$)),this.actor.registerMessageHandler("updateLayers",(V,$)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(V).update($.layers,$.removedIds)})),this.actor.registerMessageHandler("setLayers",(V,$)=>u._(this,void 0,void 0,function*(){this._getLayerIndex(V).replace($)}))}_setImages(O,V){return u._(this,void 0,void 0,function*(){this.availableImages[O]=V;for(const $ in this.workerSources[O]){const ne=this.workerSources[O][$];for(const me in ne)ne[me].availableImages=V}})}_syncRTLPluginState(O,V){return u._(this,void 0,void 0,function*(){if(u.bA.isParsed())return u.bA.getState();if(V.pluginStatus!=="loading")return u.bA.setState(V),V;const $=V.pluginURL;if(this.self.importScripts($),u.bA.isParsed()){const ne={pluginStatus:"loaded",pluginURL:$};return u.bA.setState(ne),ne}throw u.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${$}`)})}_getAvailableImages(O){let V=this.availableImages[O];return V||(V=[]),V}_getLayerIndex(O){let V=this.layerIndexes[O];return V||(V=this.layerIndexes[O]=new l),V}_getWorkerSource(O,V,$){if(this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][V]||(this.workerSources[O][V]={}),!this.workerSources[O][V][$]){const ne={sendAsync:(me,Se)=>(me.targetMapId=O,this.actor.sendAsync(me,Se))};switch(V){case"vector":this.workerSources[O][V][$]=new M(ne,this._getLayerIndex(O),this._getAvailableImages(O));break;case"geojson":this.workerSources[O][V][$]=new ft(ne,this._getLayerIndex(O),this._getAvailableImages(O));break;default:this.workerSources[O][V][$]=new this.externalWorkerSourceTypes[V](ne,this._getLayerIndex(O),this._getAvailableImages(O))}}return this.workerSources[O][V][$]}_getDEMWorkerSource(O,V){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][V]||(this.demWorkerSources[O][V]=new w),this.demWorkerSources[O][V]}}return u.i(self)&&(self.worker=new kt(self)),kt}),i("index",["exports","./shared"],function(u,l){var p="4.1.2";let v,x;const M={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise((s,d)=>{const m=requestAnimationFrame(s);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(l.c())})}),getImageData(_,s=0){return this.getImageCanvasContext(_).getImageData(-s,-s,_.width+2*s,_.height+2*s)},getImageCanvasContext(_){const s=window.document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return s.width=_.width,s.height=_.height,d.drawImage(_,0,0,_.width,_.height),d},resolveURL:_=>(v||(v=document.createElement("a")),v.href=_,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class w{static testProp(s){if(!w.docStyle)return s[0];for(let d=0;d<s.length;d++)if(s[d]in w.docStyle)return s[d];return s[0]}static create(s,d,m){const g=window.document.createElement(s);return d!==void 0&&(g.className=d),m&&m.appendChild(g),g}static createNS(s,d){return window.document.createElementNS(s,d)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(s,d){s.style[w.transformProp]=d}static addEventListener(s,d,m,g={}){s.addEventListener(d,m,"passive"in g?g:g.capture)}static removeEventListener(s,d,m,g={}){s.removeEventListener(d,m,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static getScale(s){const d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}static getPoint(s,d,m){const g=d.boundingClientRect;return new l.P((m.clientX-g.left)/d.x-s.clientLeft,(m.clientY-g.top)/d.y-s.clientTop)}static mousePos(s,d){const m=w.getScale(s);return w.getPoint(s,m,d)}static touchPos(s,d){const m=[],g=w.getScale(s);for(let b=0;b<d.length;b++)m.push(w.getPoint(s,g,d[b]));return m}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const A={supported:!1,testSupport:function(_){!D&&z&&(C?U(_):k=_)}};let k,z,D=!1,C=!1;function U(_){const s=_.createTexture();_.bindTexture(_.TEXTURE_2D,s);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,z),_.isContextLost())return;A.supported=!0}catch{}_.deleteTexture(s),D=!0}var B,K;typeof document<"u"&&(z=document.createElement("img"),z.onload=function(){k&&U(k),k=null,C=!0},z.onerror=function(){D=!0,k=null},z.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let s,d,m,g;_.resetRequestQueue=()=>{s=[],d=0,m=0,g={}},_.addThrottleControl=L=>{const H=m++;return g[H]=L,H},_.removeThrottleControl=L=>{delete g[L],P()},_.getImage=(L,H,q=!0)=>new Promise((Y,se)=>{A.supported&&(L.headers||(L.headers={}),L.headers.accept="image/webp,*/*"),l.e(L,{type:"image"}),s.push({abortController:H,requestParameters:L,supportImageRefresh:q,state:"queued",onError:_e=>{se(_e)},onSuccess:_e=>{Y(_e)}}),P()});const b=L=>l._(this,void 0,void 0,function*(){L.state="running";const{requestParameters:H,supportImageRefresh:q,onError:Y,onSuccess:se,abortController:_e}=L,ve=q===!1&&!l.i(self)&&!l.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((ze,qe)=>ze&&qe==="accept",!0));d++;const we=ve?R(H,_e):l.m(H,_e);try{const ze=yield we;delete L.abortController,L.state="completed",ze.data instanceof HTMLImageElement||l.b(ze.data)?se(ze):ze.data&&se({data:yield(fe=ze.data,typeof createImageBitmap=="function"?l.d(fe):l.f(fe)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete L.abortController,Y(ze)}finally{d--,P()}var fe}),P=()=>{const L=(()=>{for(const H of Object.keys(g))if(g[H]())return!0;return!1})()?l.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:l.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=d;H<L&&s.length>0;H++){const q=s.shift();q.abortController.signal.aborted?H--:b(q)}},R=(L,H)=>new Promise((q,Y)=>{const se=new Image,_e=L.url,ve=L.credentials;ve&&ve==="include"?se.crossOrigin="use-credentials":(ve&&ve==="same-origin"||!l.s(_e))&&(se.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{se.src="",Y(l.c())}),se.fetchPriority="high",se.onload=()=>{se.onerror=se.onload=null,q({data:se})},se.onerror=()=>{se.onerror=se.onload=null,H.signal.aborted||Y(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},se.src=_e})}(B||(B={})),B.resetRequestQueue(),function(_){_.Glyphs="Glyphs",_.Image="Image",_.Source="Source",_.SpriteImage="SpriteImage",_.SpriteJSON="SpriteJSON",_.Style="Style",_.Tile="Tile",_.Unknown="Unknown"}(K||(K={}));class ue{constructor(s){this._transformRequestFn=s}transformRequest(s,d){return this._transformRequestFn&&this._transformRequestFn(s,d)||{url:s}}normalizeSpriteURL(s,d,m){const g=function(b){const P=b.match(Z);if(!P)throw new Error(`Unable to parse URL "${b}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(s);return g.path+=`${d}${m}`,function(b){const P=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${P}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const Z=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ee(_){var s=new l.A(3);return s[0]=_[0],s[1]=_[1],s[2]=_[2],s}var be,ie=function(_,s,d){return _[0]=s[0]-d[0],_[1]=s[1]-d[1],_[2]=s[2]-d[2],_};be=new l.A(3),l.A!=Float32Array&&(be[0]=0,be[1]=0,be[2]=0);var Q=function(_){var s=_[0],d=_[1];return s*s+d*d};function Ee(_){const s=[];if(typeof _=="string")s.push({id:"default",url:_});else if(_&&_.length>0){const d=[];for(const{id:m,url:g}of _){const b=`${m}${g}`;d.indexOf(b)===-1&&(d.push(b),s.push({id:m,url:g}))}}return s}(function(){var _=new l.A(2);l.A!=Float32Array&&(_[0]=0,_[1]=0)})();class Fe{constructor(s,d,m,g){this.context=s,this.format=m,this.texture=s.gl.createTexture(),this.update(d,g)}update(s,d,m){const{width:g,height:b}=s,P=!(this.size&&this.size[0]===g&&this.size[1]===b||m),{context:R}=this,{gl:L}=R;if(this.useMipmap=!!(d&&d.useMipmap),L.bindTexture(L.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===L.RGBA&&(!d||d.premultiply!==!1)),P)this.size=[g,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?L.texImage2D(L.TEXTURE_2D,0,this.format,this.format,L.UNSIGNED_BYTE,s):L.texImage2D(L.TEXTURE_2D,0,this.format,g,b,0,this.format,L.UNSIGNED_BYTE,s.data);else{const{x:H,y:q}=m||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||l.b(s)?L.texSubImage2D(L.TEXTURE_2D,0,H,q,L.RGBA,L.UNSIGNED_BYTE,s):L.texSubImage2D(L.TEXTURE_2D,0,H,q,g,b,L.RGBA,L.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&L.generateMipmap(L.TEXTURE_2D)}bind(s,d,m){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),m!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,m||s),this.filter=s),d!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Ae(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class Ve extends l.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new l.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(s){const d=this.images[s];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new l.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(s,d){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let m=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new l.j(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,d){if(!s)return!0;let m=0;for(const g of s){if(g[0]<m||g[1]<g[0]||d<g[1])return!1;m=g[1]}return!0}_validateContent(s,d){if(!s)return!0;if(s.length!==4)return!1;const m=d.spriteData,g=m&&m.width||d.data.width,b=m&&m.height||d.data.height;return!(s[0]<0||g<s[0]||s[1]<0||b<s[1]||s[2]<0||g<s[2]||s[3]<0||b<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,d,m=!0){const g=this.getImage(s);if(m&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((d,m)=>{let g=!0;if(!this.isLoaded())for(const b of s)this.images[b]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:d})})}_getImagesForIds(s){const d={};for(const m of s){let g=this.getImage(m);g||(this.fire(new l.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?d[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:l.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],m=this.getImage(s);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new l.I(g,m);this.patterns[s]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:d,h:m}=l.p(s),g=this.atlasImage;g.resize({width:d||1,height:m||1});for(const b in this.patterns){const{bin:P}=this.patterns[b],R=P.x+1,L=P.y+1,H=this.getImage(b).data,q=H.width,Y=H.height;l.R.copy(H,g,{x:0,y:0},{x:R,y:L},{width:q,height:Y}),l.R.copy(H,g,{x:0,y:Y-1},{x:R,y:L-1},{width:q,height:1}),l.R.copy(H,g,{x:0,y:0},{x:R,y:L+Y},{width:q,height:1}),l.R.copy(H,g,{x:q-1,y:0},{x:R-1,y:L},{width:1,height:Y}),l.R.copy(H,g,{x:0,y:0},{x:R+q,y:L},{width:1,height:Y})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||l.w(`Image with ID: "${d}" was not found`),Ae(m)&&this.updateImage(d,m)}}}const lt=1e20;function ut(_,s,d,m,g,b,P,R,L){for(let H=s;H<s+m;H++)pt(_,d*b+H,b,g,P,R,L);for(let H=d;H<d+g;H++)pt(_,H*b+s,1,m,P,R,L)}function pt(_,s,d,m,g,b,P){b[0]=0,P[0]=-lt,P[1]=lt,g[0]=_[s];for(let R=1,L=0,H=0;R<m;R++){g[R]=_[s+R*d];const q=R*R;do{const Y=b[L];H=(g[R]-g[Y]+q-Y*Y)/(R-Y)/2}while(H<=P[L]&&--L>-1);L++,b[L]=R,P[L]=H,P[L+1]=lt}for(let R=0,L=0;R<m;R++){for(;P[L+1]<R;)L++;const H=b[L],q=R-H;_[s+R*d]=g[H]+q*q}}class ke{constructor(s,d){this.requestManager=s,this.localIdeographFontFamily=d,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return l._(this,void 0,void 0,function*(){const d=[];for(const b in s)for(const P of s[b])d.push(this._getAndCacheGlyphsPromise(b,P));const m=yield Promise.all(d),g={};for(const{stack:b,id:P,glyph:R}of m)g[b]||(g[b]={}),g[b][P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return g})}_getAndCacheGlyphsPromise(s,d){return l._(this,void 0,void 0,function*(){let m=this.entries[s];m||(m=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[d];if(g!==void 0)return{stack:s,id:d,glyph:g};if(g=this._tinySDF(m,s,d),g)return m.glyphs[d]=g,{stack:s,id:d,glyph:g};const b=Math.floor(d/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[b])return{stack:s,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[b]){const R=ke.loadGlyphRange(s,b,this.url,this.requestManager);m.requests[b]=R}const P=yield m.requests[b];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=P[+R]);return m.ranges[b]=!0,{stack:s,id:d,glyph:P[d]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(l.u["CJK Unified Ideographs"](s)||l.u["Hangul Syllables"](s)||l.u.Hiragana(s)||l.u.Katakana(s))}_tinySDF(s,d,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let b=s.tinySDF;if(!b){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),b=s.tinySDF=new ke.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:R})}const P=b.draw(String.fromCharCode(m));return{id:m,bitmap:new l.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}ke.loadGlyphRange=function(_,s,d,m){return l._(this,void 0,void 0,function*(){const g=256*s,b=g+255,P=m.transformRequest(d.replace("{fontstack}",_).replace("{range}",`${g}-${b}`),K.Glyphs),R=yield l.l(P,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${b}`);const L={};for(const H of l.n(R.data))L[H.id]=H;return L})},ke.TinySDF=class{constructor({fontSize:_=24,buffer:s=3,radius:d=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:P="normal"}={}){this.buffer=s,this.cutoff=m,this.radius=d;const R=this.size=_+4*s,L=this._createCanvas(R),H=this.ctx=L.getContext("2d",{willReadFrequently:!0});H.font=`${P} ${b} ${_}px ${g}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(_){const s=document.createElement("canvas");return s.width=s.height=_,s}draw(_){const{width:s,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(_),P=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),L=Math.min(this.size-this.buffer,P+Math.ceil(m)),H=R+2*this.buffer,q=L+2*this.buffer,Y=Math.max(H*q,0),se=new Uint8ClampedArray(Y),_e={data:se,width:H,height:q,glyphWidth:R,glyphHeight:L,glyphTop:P,glyphLeft:0,glyphAdvance:s};if(R===0||L===0)return _e;const{ctx:ve,buffer:we,gridInner:fe,gridOuter:ze}=this;ve.clearRect(we,we,R,L),ve.fillText(_,we,we+P);const qe=ve.getImageData(we,we,R,L);ze.fill(lt,0,Y),fe.fill(0,0,Y);for(let Me=0;Me<L;Me++)for(let Oe=0;Oe<R;Oe++){const Ke=qe.data[4*(Me*R+Oe)+3]/255;if(Ke===0)continue;const Qe=(Me+we)*H+Oe+we;if(Ke===1)ze[Qe]=0,fe[Qe]=lt;else{const ot=.5-Ke;ze[Qe]=ot>0?ot*ot:0,fe[Qe]=ot<0?ot*ot:0}}ut(ze,0,0,H,q,H,this.f,this.v,this.z),ut(fe,we,we,R,L,H,this.f,this.v,this.z);for(let Me=0;Me<Y;Me++){const Oe=Math.sqrt(ze[Me])-Math.sqrt(fe[Me]);se[Me]=Math.round(255-255*(Oe/this.radius+this.cutoff))}return _e}};class Je{constructor(){this.specification=l.v.light.position}possiblyEvaluate(s,d){return l.y(s.expression.evaluate(d))}interpolate(s,d,m){return{x:l.z.number(s.x,d.x,m),y:l.z.number(s.y,d.y,m),z:l.z.number(s.z,d.z,m)}}}let tt;class _t extends l.E{constructor(s){super(),tt=tt||new l.q({anchor:new l.D(l.v.light.anchor),position:new Je,color:new l.D(l.v.light.color),intensity:new l.D(l.v.light.intensity)}),this._transitionable=new l.T(tt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(l.r,s,d))for(const m in s){const g=s[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,m){return(!m||m.validate!==!1)&&l.t(this,s.call(l.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:l.v}))}}class Lt{constructor(s,d){this.width=s,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,d){const m=s.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(s,d)),this.dashEntry[m]}getDashRanges(s,d,m){const g=[];let b=s.length%2==1?-s[s.length-1]*m:0,P=s[0]*m,R=!0;g.push({left:b,right:P,isDash:R,zeroLength:s[0]===0});let L=s[0];for(let H=1;H<s.length;H++){R=!R;const q=s[H];b=L*m,L+=q,P=L*m,g.push({left:b,right:P,isDash:R,zeroLength:q===0})}return g}addRoundDash(s,d,m){const g=d/2;for(let b=-m;b<=m;b++){const P=this.width*(this.nextRow+m+b);let R=0,L=s[R];for(let H=0;H<this.width;H++){H/L.right>1&&(L=s[++R]);const q=Math.abs(H-L.left),Y=Math.abs(H-L.right),se=Math.min(q,Y);let _e;const ve=b/m*(g+1);if(L.isDash){const we=g-Math.abs(ve);_e=Math.sqrt(se*se+we*we)}else _e=g-Math.sqrt(se*se+ve*ve);this.data[P+H]=Math.max(0,Math.min(255,_e+128))}}}addRegularDash(s){for(let R=s.length-1;R>=0;--R){const L=s[R],H=s[R+1];L.zeroLength?s.splice(R,1):H&&H.isDash===L.isDash&&(H.left=L.left,s.splice(R,1))}const d=s[0],m=s[s.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const g=this.width*this.nextRow;let b=0,P=s[b];for(let R=0;R<this.width;R++){R/P.right>1&&(P=s[++b]);const L=Math.abs(R-P.left),H=Math.abs(R-P.right),q=Math.min(L,H);this.data[g+R]=Math.max(0,Math.min(255,(P.isDash?q:-q)+128))}}addDash(s,d){const m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return l.w("LineAtlas out of space"),null;let b=0;for(let R=0;R<s.length;R++)b+=s[R];if(b!==0){const R=this.width/b,L=this.getDashRanges(s,this.width,R);d?this.addRoundDash(L,R,m):this.addRegularDash(L)}const P={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:b};return this.nextRow+=g,this.dirty=!0,P}bind(s){const d=s.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Cn="maplibre_preloaded_worker_pool";class nt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<nt.workerCount;)this.workers.push(new Worker(l.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cn]}numActive(){return Object.keys(this.active).length}}const wt=Math.floor(M.hardwareConcurrency/2);let Ft,At;function gn(){return Ft||(Ft=new nt),Ft}nt.workerCount=l.B(globalThis)?Math.max(Math.min(wt,3),1):1;class En{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let g=0;g<m.length;g++){const b=new l.C(m[g],d);b.name=`Worker ${g}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,d){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:s,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,d){for(const m of this.actors)m.registerMessageHandler(s,d)}}function In(){return At||(At=new En(gn(),l.G),At.registerMessageHandler("getResource",(_,s,d)=>l.m(s,d))),At}function je(_,s){const d=l.F();return l.H(d,d,[1,1,0]),l.J(d,d,[.5*_.width,.5*_.height,1]),l.K(d,d,_.calculatePosMatrix(s.toUnwrapped()))}function An(_,s,d,m,g,b){const P=function(Y,se,_e){if(Y)for(const ve of Y){const we=se[ve];if(we&&we.source===_e&&we.type==="fill-extrusion")return!0}else for(const ve in se){const we=se[ve];if(we.source===_e&&we.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,_.id),R=b.maxPitchScaleFactor(),L=_.tilesIn(m,R,P);L.sort(yn);const H=[];for(const Y of L)H.push({wrappedTileID:Y.tileID.wrapped().key,queryResults:Y.tile.queryRenderedFeatures(s,d,_._state,Y.queryGeometry,Y.cameraQueryGeometry,Y.scale,g,b,R,je(_.transform,Y.tileID))});const q=function(Y){const se={},_e={};for(const ve of Y){const we=ve.queryResults,fe=ve.wrappedTileID,ze=_e[fe]=_e[fe]||{};for(const qe in we){const Me=we[qe],Oe=ze[qe]=ze[qe]||{},Ke=se[qe]=se[qe]||[];for(const Qe of Me)Oe[Qe.featureIndex]||(Oe[Qe.featureIndex]=!0,Ke.push(Qe))}}return se}(H);for(const Y in q)q[Y].forEach(se=>{const _e=se.feature,ve=_.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ve});return q}function yn(_,s){const d=_.tileID,m=s.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Qn(_,s,d){return l._(this,void 0,void 0,function*(){let m=_;if(_.url?m=(yield l.h(s.transformRequest(_.url,K.Source),d)).data:yield M.frameAsync(d),!m)return null;const g=l.L(l.e(m,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(b=>b.id)),g})}class Yt{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof l.M?new l.M(s.lng,s.lat):l.M.convert(s),this}setSouthWest(s){return this._sw=s instanceof l.M?new l.M(s.lng,s.lat):l.M.convert(s),this}extend(s){const d=this._sw,m=this._ne;let g,b;if(s instanceof l.M)g=s,b=s;else{if(!(s instanceof Yt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Yt.convert(s)):this.extend(l.M.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(l.M.convert(s)):this;if(g=s._sw,b=s._ne,!g||!b)return this}return d||m?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),m.lng=Math.max(b.lng,m.lng),m.lat=Math.max(b.lat,m.lat)):(this._sw=new l.M(g.lng,g.lat),this._ne=new l.M(b.lng,b.lat)),this}getCenter(){return new l.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new l.M(this.getWest(),this.getNorth())}getSouthEast(){return new l.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:m}=l.M.convert(s);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(s){return s instanceof Yt?s:s&&new Yt(s)}static fromLngLat(s,d=0){const m=360*d/40075017,g=m/Math.cos(Math.PI/180*s.lat);return new Yt(new l.M(s.lng-g,s.lat-m),new l.M(s.lng+g,s.lat+m))}}class Gn{constructor(s,d,m){this.bounds=Yt.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),m=Math.floor(l.N(this.bounds.getWest())*d),g=Math.floor(l.O(this.bounds.getNorth())*d),b=Math.ceil(l.N(this.bounds.getEast())*d),P=Math.ceil(l.O(this.bounds.getSouth())*d);return s.x>=m&&s.x<b&&s.y>=g&&s.y<P}}class re extends l.E{constructor(s,d,m,g){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,l.e(this,l.L(d,["url","scheme","tileSize","promoteId"])),this._options=l.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return l.e({},this._options)}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,K.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((b,P)=>{s.reloadPromise={resolve:b,reject:P}})}else s.actor=this.dispatcher.getActor(),g="loadTile";s.abortController=new AbortController;try{const b=yield s.actor.sendAsync({type:g,data:m},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,b)}catch(b){if(delete s.abortController,s.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,d){if(d&&d.resourceTiming&&(s.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&s.setExpiryData(d),s.loadVectorData(d,this.map.painter),s.reloadPromise){const m=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(m.resolve).catch(m.reject)}}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"abortTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class le extends l.E{constructor(s,d,m,g){super(),this.id=s,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=l.e({type:"raster"},d),l.e(this,l.L(d,["url","scheme","tileSize"]))}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(l.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new l.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return l.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const m=yield B.getImage(this.map._requestManager.transformRequest(d,K.Tile),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,b=g.gl,P=m.data;s.texture=this.map.painter.getTileTexture(P.width),s.texture?s.texture.update(P,{useMipmap:!0}):(s.texture=new Fe(g,P,b.RGBA,{useMipmap:!0}),s.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),s.state="loaded"}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class st extends le{constructor(s,d,m,g){super(s,d,m,g),this.type="raster-dem",this.maxzoom=22,this._options=l.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,K.Tile);s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield B.getImage(m,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const b=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const P=l.b(b)&&l.S()?b:yield this.readImageNow(b),R={type:this.type,uid:s.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const L=yield s.actor.sendAsync({type:"loadDEMTile",data:R});s.dem=L,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return l._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&l.U()){const d=s.width+2,m=s.height+2;try{return new l.R({width:d,height:m},yield l.V(s,-1,-1,d,m))}catch{}}return M.getImageData(s,1)})}_getNeighboringTiles(s){const d=s.canonical,m=Math.pow(2,d.z),g=(d.x-1+m)%m,b=d.x===0?s.wrap-1:s.wrap,P=(d.x+1+m)%m,R=d.x+1===m?s.wrap+1:s.wrap,L={};return L[new l.Q(s.overscaledZ,b,d.z,g,d.y).key]={backfilled:!1},L[new l.Q(s.overscaledZ,R,d.z,P,d.y).key]={backfilled:!1},d.y>0&&(L[new l.Q(s.overscaledZ,b,d.z,g,d.y-1).key]={backfilled:!1},L[new l.Q(s.overscaledZ,s.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},L[new l.Q(s.overscaledZ,R,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<m&&(L[new l.Q(s.overscaledZ,b,d.z,g,d.y+1).key]={backfilled:!1},L[new l.Q(s.overscaledZ,s.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},L[new l.Q(s.overscaledZ,R,d.z,P,d.y+1).key]={backfilled:!1}),L}unloadTile(s){return l._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class it extends l.E{constructor(s,d,m,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=d.data,this._options=l.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const b=l.W/this.tileSize;this.workerOptions=l.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*b,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*b,extent:l.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:l.W,radius:(d.clusterRadius||50)*b,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return l._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,d,m){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:s,limit:d,offset:m}})}_updateWorkerData(s){return l._(this,void 0,void 0,function*(){const d=l.e({type:this.type},this.workerOptions);s?d.dataDiff=s:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(M.resolveURL(this._data),K.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new l.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new l.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&l.e(b,{resourceTiming:g}),this.fire(new l.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new l.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new l.k("dataabort",{dataType:"source"}));this.fire(new l.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(s){return l._(this,void 0,void 0,function*(){const d=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const m={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:m},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,d==="reloadTile")})}abortTile(s){return l._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return l._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return l.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var mt=l.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class St extends l.E{constructor(s,d,m,g){super(),this.id=s,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(s){return l._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new l.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield B.getImage(this.map._requestManager.transformRequest(this.url,K.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,s&&(this.coordinates=s),this._finishLoading())}catch(d){this._request=null,this.fire(new l.j(d))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new l.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const d=s.map(l.Y.fromLngLat);this.tileID=function(g){let b=1/0,P=1/0,R=-1/0,L=-1/0;for(const se of g)b=Math.min(b,se.x),P=Math.min(P,se.y),R=Math.max(R,se.x),L=Math.max(L,se.y);const H=Math.max(R-b,L-P),q=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),Y=Math.pow(2,q);return new l.a0(q,Math.floor((b+R)/2*Y),Math.floor((P+L)/2*Y))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new l.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,l.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,l.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,l.W,l.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new l.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return l._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class _n extends St{constructor(s,d,m,g){super(s,d,m,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return l._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const d of s.urls)this.urls.push(this.map._requestManager.transformRequest(d,K.Source).url);try{const d=yield l.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new l.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const d=this.video.seekable;s<d.start(0)||s>d.end(0)?this.fire(new l.j(new l.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(s,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mt extends St{constructor(s,d,m,g){super(s,d,m,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(P=>typeof P!="number"))||this.fire(new l.j(new l.a1(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new l.j(new l.a1(`sources.${s}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new l.j(new l.a1(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new l.j(new l.a1(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new l.j(new l.a1(`sources.${s}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return l._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new l.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=l.$.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(d,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const b in this.tiles){const P=this.tiles[b];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,g=!0)}g&&this.fire(new l.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const hn={},xn=_=>{switch(_){case"geojson":return it;case"image":return St;case"raster":return le;case"raster-dem":return st;case"vector":return re;case"video":return _n;case"canvas":return Mt}return hn[_]},Nt="RTLPluginLoaded";class an extends l.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=In()}_syncState(s){return this.status=s,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return l._(this,arguments,void 0,function*(d,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=M.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return l._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new l.k(Nt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let at=null;function tn(){return at||(at=new an),at}class Kt{constructor(s,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=l.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const d=s+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,b){const P={};if(!b)return P;for(const R of g){const L=R.layerIds.map(H=>b.getLayer(H)).filter(Boolean);if(L.length!==0){R.layers=L,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(H=>L.filter(q=>q.id===H)[0]));for(const H of L)P[H.id]=R}}return P}(s.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof l.a5){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof l.a5&&b.hasRTLText){this.hasRTLText=!0,tn().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(b))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new l.a4}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(s)}const d=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(s,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(s,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,d,m,g,b,P,R,L,H,q){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:P,tileSize:this.tileSize,pixelPosMatrix:q,transform:L,params:R,queryPadding:this.queryPadding*H},s,d,m):{}}querySourceFeatures(s,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),b=d&&d.sourceLayer?d.sourceLayer:"",P=g._geojsonTileLayer||g[b];if(!P)return;const R=l.a6(d&&d.filter),{z:L,x:H,y:q}=this.tileID.canonical,Y={z:L,x:H,y:q};for(let se=0;se<P.length;se++){const _e=P.feature(se);if(R.needGeometry){const fe=l.a7(_e,!0);if(!R.filter(new l.a8(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!R.filter(new l.a8(this.tileID.overscaledZ),_e))continue;const ve=m.getId(_e,b),we=new l.a9(_e,L,H,q,ve);we.tile=Y,s.push(we)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const d=this.expirationTime;if(s.cacheControl){const m=l.aa(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const b=this.expirationTime-d;b?this.expirationTime=m+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const b=this.buckets[g],P=b.layers[0].sourceLayer||"_geojsonTileLayer",R=m[P],L=s[P];if(!R||!L||Object.keys(L).length===0)continue;b.update(L,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=d&&d.style&&d.style.getLayer(g);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=M.now()+s}setDependencies(s,d){const m={};for(const g of d)m[g]=!0;this.dependencies[s]=m}hasDependency(s,d){for(const m of s){const g=this.dependencies[m];if(g){for(const b of d)if(g[b])return!0}}return!1}}class Bn{constructor(s,d){this.max=s,this.onRemove=d,this.reset()}reset(){for(const s in this.data)for(const d of this.data[s])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(s,d,m){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:d,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(s,b)},m)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const d=this.data[s].shift();return d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),d.value}getByKey(s){const d=this.data[s];return d?d[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,d){if(!this.has(s))return this;const m=s.wrapped().key,g=d===void 0?0:this.data[m].indexOf(d),b=this.data[m][g];return this.data[m].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(s){const d=[];for(const m in this.data)for(const g of this.data[m])s(g.value)||d.push(g);for(const m of d)this.remove(m.value.tileID,m)}}class Un{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,d,m){const g=String(d);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},l.e(this.stateChanges[s][g],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const b in this.state[s])b!==g&&(this.deletedStates[s][b]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const b in this.state[s][g])m[b]||(this.deletedStates[s][g][b]=null)}else for(const b in m)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][b]===null&&delete this.deletedStates[s][g][b]}removeFeatureState(s,d,m){if(this.deletedStates[s]===null)return;const g=String(d);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&d!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][m]=null);else if(d!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(m in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][m]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,d){const m=String(d),g=l.e({},(this.state[s]||{})[m],(this.stateChanges[s]||{})[m]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const b=this.deletedStates[s][d];if(b===null)return{};for(const P in b)delete g[P]}return g}initializeTileState(s,d){s.setFeatureState(this.state,d)}coalesceChanges(s,d){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const P in this.stateChanges[g])this.state[g][P]||(this.state[g][P]={}),l.e(this.state[g][P],this.stateChanges[g][P]),b[P]=this.state[g][P];m[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const P in this.state[g])b[P]={},this.state[g][P]={};else for(const P in this.deletedStates[g]){if(this.deletedStates[g][P]===null)this.state[g][P]={};else for(const R of Object.keys(this.deletedStates[g][P]))delete this.state[g][P][R];b[P]=this.state[g][P]}m[g]=m[g]||{},l.e(m[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in s)s[g].setFeatureState(m,d)}}class dt extends l.E{constructor(s,d,m){super(),this.id=s,this.dispatcher=m,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,P,R)=>{const L=new(xn(b.type))(g,b,P,R);if(L.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${L.id}`);return L})(s,d,m,this),this._tiles={},this._cache=new Bn(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Un,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const d=this._tiles[s];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,d,m){return l._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,d,m)}catch(g){s.state="errored",g.status!==404?this._source.fire(new l.j(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new l.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(s),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Ht).map(s=>s.key)}getRenderableIds(s){const d=[];for(const m in this._tiles)this._isIdRenderable(m,s)&&d.push(this._tiles[m]);return s?d.sort((m,g)=>{const b=m.tileID,P=g.tileID,R=new l.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),L=new l.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-P.overscaledZ||L.y-R.y||L.x-R.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(Ht).map(m=>m.key)}hasRenderableParent(s){const d=this.findLoadedParent(s,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(s,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(d||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,d){return l._(this,void 0,void 0,function*(){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,s,d))})}_tileLoaded(s,d,m){s.timeAdded=M.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(d,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new l.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const b=d[g];if(s.neighboringTiles&&s.neighboringTiles[b]){const P=this.getTileByID(b);m(s,P),m(P,s)}}function m(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let P=b.tileID.canonical.x-g.tileID.canonical.x;const R=b.tileID.canonical.y-g.tileID.canonical.y,L=Math.pow(2,g.tileID.canonical.z),H=b.tileID.key;P===0&&R===0||Math.abs(R)>1||(Math.abs(P)>1&&(Math.abs(P+L)===1?P+=L:Math.abs(P-L)===1&&(P-=L)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,P,R),g.neighboringTiles&&g.neighboringTiles[H]&&(g.neighboringTiles[H].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,d,m,g){for(const b in this._tiles){let P=this._tiles[b];if(g[b]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>m)continue;let R=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const H=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[H.key],P&&P.hasData()&&(R=H)}let L=R;for(;L.overscaledZ>d;)if(L=L.scaledTo(L.overscaledZ-1),s[L.key]){g[R.key]=R;break}}}findLoadedParent(s,d){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=s.overscaledZ-1;m>=d;m--){const g=s.scaledTo(m),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(s){const d=this._tiles[s.key];return d&&d.hasData()?d:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const d=Math.ceil(s.width/this._source.tileSize)+1,m=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?l.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(s){const d=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,d){const m={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),m[b.tileID.key]=b}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,d){if(this.transform=s,this.terrain=d,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=s.getVisibleUnwrappedCoordinates(this._source.tileID).map(q=>new l.Q(q.canonical.z,q.wrap,q.canonical.z,q.canonical.x,q.canonical.y)):(m=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter(q=>this._source.hasTile(q)))):m=[];const g=s.coveringZoomLevel(this._source),b=Math.max(g-dt.maxOverzooming,this._source.minzoom),P=Math.max(g+dt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const q={};for(const Y of m)if(Y.canonical.z>this._source.minzoom){const se=Y.scaledTo(Y.canonical.z-1);q[se.key]=se;const _e=Y.scaledTo(Math.max(this._source.minzoom,Math.min(Y.canonical.z,5)));q[_e.key]=_e}m=m.concat(Object.values(q))}const R=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new l.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const L=this._updateRetainedTiles(m,g);if(jt(this._source.type)){const q={},Y={},se=Object.keys(L),_e=M.now();for(const ve of se){const we=L[ve],fe=this._tiles[ve];if(!fe||fe.fadeEndTime!==0&&fe.fadeEndTime<=_e)continue;const ze=this.findLoadedParent(we,b);ze&&(this._addTile(ze.tileID),q[ze.tileID.key]=ze.tileID),Y[ve]=we}this._retainLoadedChildren(Y,g,P,L);for(const ve in q)L[ve]||(this._coveredTiles[ve]=!0,L[ve]=q[ve]);if(d){const ve={},we={};for(const fe of m)this._tiles[fe.key].hasData()?ve[fe.key]=fe:we[fe.key]=fe;for(const fe in we){const ze=we[fe].children(this._source.maxzoom);this._tiles[ze[0].key]&&this._tiles[ze[1].key]&&this._tiles[ze[2].key]&&this._tiles[ze[3].key]&&(ve[ze[0].key]=L[ze[0].key]=ze[0],ve[ze[1].key]=L[ze[1].key]=ze[1],ve[ze[2].key]=L[ze[2].key]=ze[2],ve[ze[3].key]=L[ze[3].key]=ze[3],delete we[fe])}for(const fe in we){const ze=this.findLoadedParent(we[fe],this._source.minzoom);if(ze){ve[ze.tileID.key]=L[ze.tileID.key]=ze.tileID;for(const qe in ve)ve[qe].isChildOf(ze.tileID)&&delete ve[qe]}}for(const fe in this._tiles)ve[fe]||(this._coveredTiles[fe]=!0)}}for(const q in L)this._tiles[q].clearFadeHold();const H=l.ab(this._tiles,L);for(const q of H){const Y=this._tiles[q];Y.hasSymbolBuckets&&!Y.holdingForFade()?Y.setHoldDuration(this.map._fadeDuration):Y.hasSymbolBuckets&&!Y.symbolFadeFinished()||this._removeTile(q)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,d){const m={},g={},b=Math.max(d-dt.maxOverzooming,this._source.minzoom),P=Math.max(d+dt.maxUnderzooming,this._source.minzoom),R={};for(const L of s){const H=this._addTile(L);m[L.key]=L,H.hasData()||d<this._source.maxzoom&&(R[L.key]=L)}this._retainLoadedChildren(R,d,P,m);for(const L of s){let H=this._tiles[L.key];if(H.hasData())continue;if(d+1>this._source.maxzoom){const Y=L.children(this._source.maxzoom)[0],se=this.getTile(Y);if(se&&se.hasData()){m[Y.key]=Y;continue}}else{const Y=L.children(this._source.maxzoom);if(m[Y[0].key]&&m[Y[1].key]&&m[Y[2].key]&&m[Y[3].key])continue}let q=H.wasRequested();for(let Y=L.overscaledZ-1;Y>=b;--Y){const se=L.scaledTo(Y);if(g[se.key])break;if(g[se.key]=!0,H=this.getTile(se),!H&&q&&(H=this._addTile(se)),H){const _e=H.hasData();if((q||_e)&&(m[se.key]=se),q=H.wasRequested(),_e)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const d=[];let m,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}d.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;g=b}for(const b of d)this._loadedParentTiles[b]=m}}_addTile(s){let d=this._tiles[s.key];if(d)return d;d=this._cache.getAndRemove(s),d&&(this._setTileReloadTimer(s.key,d),d.tileID=s,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,d)));const m=d;return d||(d=new Kt(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(d,s.key,d.state)),d.uses++,this._tiles[s.key]=d,m||this._source.fire(new l.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(s,d){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=d.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const d=this._tiles[s];d&&(d.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,d,m){const g=[],b=this.transform;if(!b)return g;const P=m?b.getCameraQueryGeometry(s):s,R=s.map(ve=>b.pointCoordinate(ve,this.terrain)),L=P.map(ve=>b.pointCoordinate(ve,this.terrain)),H=this.getIds();let q=1/0,Y=1/0,se=-1/0,_e=-1/0;for(const ve of L)q=Math.min(q,ve.x),Y=Math.min(Y,ve.y),se=Math.max(se,ve.x),_e=Math.max(_e,ve.y);for(let ve=0;ve<H.length;ve++){const we=this._tiles[H[ve]];if(we.holdingForFade())continue;const fe=we.tileID,ze=Math.pow(2,b.zoom-we.tileID.overscaledZ),qe=d*we.queryPadding*l.W/we.tileSize/ze,Me=[fe.getTilePoint(new l.Y(q,Y)),fe.getTilePoint(new l.Y(se,_e))];if(Me[0].x-qe<l.W&&Me[0].y-qe<l.W&&Me[1].x+qe>=0&&Me[1].y+qe>=0){const Oe=R.map(Qe=>fe.getTilePoint(Qe)),Ke=L.map(Qe=>fe.getTilePoint(Qe));g.push({tile:we,tileID:fe,queryGeometry:Oe,cameraQueryGeometry:Ke,scale:ze})}}return g}getVisibleCoordinates(s){const d=this.getRenderableIds(s).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const s=M.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=s)return!0}return!1}setFeatureState(s,d,m){this._state.updateState(s=s||"_geojsonTileLayer",d,m)}removeFeatureState(s,d,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",d,m)}getFeatureState(s,d){return this._state.getState(s=s||"_geojsonTileLayer",d)}setDependencies(s,d,m){const g=this._tiles[s];g&&g.setDependencies(d,m)}reloadTilesForDependencies(s,d){for(const m in this._tiles)this._tiles[m].hasDependency(s,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(s,d))}}function Ht(_,s){const d=Math.abs(2*_.wrap)-+(_.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||m-d||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function jt(_){return _==="raster"||_==="image"||_==="video"}dt.maxOverzooming=10,dt.maxUnderzooming=3;class Jt{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=l.ac(s,0,1);let d=1,m=this._distances[d];const g=s*this.paddedLength+this.padding;for(;m<g&&d<this._distances.length;)m=this._distances[++d];const b=d-1,P=this._distances[b],R=m-P,L=R>0?(g-P)/R:0;return this.points[b].mult(1-L).add(this.points[d].mult(L))}}function X(_,s){let d=!0;return _==="always"||_!=="never"&&s!=="never"||(d=!1),d}class Be{constructor(s,d,m){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(d/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,m,g,b){this._forEachCell(d,m,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(s,d,m,g){this._forEachCell(d-g,m-g,d+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(m),this.circles.push(g)}_insertBoxCell(s,d,m,g,b,P){this.boxCells[b].push(P)}_insertCircleCell(s,d,m,g,b,P){this.circleCells[b].push(P)}_query(s,d,m,g,b,P,R){if(m<0||s>this.width||g<0||d>this.height)return[];const L=[];if(s<=0&&d<=0&&this.width<=m&&this.height<=g){if(b)return[{key:null,x1:s,y1:d,x2:m,y2:g}];for(let H=0;H<this.boxKeys.length;H++)L.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const q=this.circles[3*H],Y=this.circles[3*H+1],se=this.circles[3*H+2];L.push({key:this.circleKeys[H],x1:q-se,y1:Y-se,x2:q+se,y2:Y+se})}}else this._forEachCell(s,d,m,g,this._queryCell,L,{hitTest:b,overlapMode:P,seenUids:{box:{},circle:{}}},R);return L}query(s,d,m,g){return this._query(s,d,m,g,!1,null)}hitTest(s,d,m,g,b,P){return this._query(s,d,m,g,!0,b,P).length>0}hitTestCircle(s,d,m,g,b){const P=s-m,R=s+m,L=d-m,H=d+m;if(R<0||P>this.width||H<0||L>this.height)return!1;const q=[];return this._forEachCell(P,L,R,H,this._queryCellCircle,q,{hitTest:!0,overlapMode:g,circle:{x:s,y:d,radius:m},seenUids:{box:{},circle:{}}},b),q.length>0}_queryCell(s,d,m,g,b,P,R,L){const{seenUids:H,hitTest:q,overlapMode:Y}=R,se=this.boxCells[b];if(se!==null){const ve=this.bboxes;for(const we of se)if(!H.box[we]){H.box[we]=!0;const fe=4*we,ze=this.boxKeys[we];if(s<=ve[fe+2]&&d<=ve[fe+3]&&m>=ve[fe+0]&&g>=ve[fe+1]&&(!L||L(ze))&&(!q||!X(Y,ze.overlapMode))&&(P.push({key:ze,x1:ve[fe],y1:ve[fe+1],x2:ve[fe+2],y2:ve[fe+3]}),q))return!0}}const _e=this.circleCells[b];if(_e!==null){const ve=this.circles;for(const we of _e)if(!H.circle[we]){H.circle[we]=!0;const fe=3*we,ze=this.circleKeys[we];if(this._circleAndRectCollide(ve[fe],ve[fe+1],ve[fe+2],s,d,m,g)&&(!L||L(ze))&&(!q||!X(Y,ze.overlapMode))){const qe=ve[fe],Me=ve[fe+1],Oe=ve[fe+2];if(P.push({key:ze,x1:qe-Oe,y1:Me-Oe,x2:qe+Oe,y2:Me+Oe}),q)return!0}}}return!1}_queryCellCircle(s,d,m,g,b,P,R,L){const{circle:H,seenUids:q,overlapMode:Y}=R,se=this.boxCells[b];if(se!==null){const ve=this.bboxes;for(const we of se)if(!q.box[we]){q.box[we]=!0;const fe=4*we,ze=this.boxKeys[we];if(this._circleAndRectCollide(H.x,H.y,H.radius,ve[fe+0],ve[fe+1],ve[fe+2],ve[fe+3])&&(!L||L(ze))&&!X(Y,ze.overlapMode))return P.push(!0),!0}}const _e=this.circleCells[b];if(_e!==null){const ve=this.circles;for(const we of _e)if(!q.circle[we]){q.circle[we]=!0;const fe=3*we,ze=this.circleKeys[we];if(this._circlesCollide(ve[fe],ve[fe+1],ve[fe+2],H.x,H.y,H.radius)&&(!L||L(ze))&&!X(Y,ze.overlapMode))return P.push(!0),!0}}}_forEachCell(s,d,m,g,b,P,R,L){const H=this._convertToXCellCoord(s),q=this._convertToYCellCoord(d),Y=this._convertToXCellCoord(m),se=this._convertToYCellCoord(g);for(let _e=H;_e<=Y;_e++)for(let ve=q;ve<=se;ve++)if(b.call(this,s,d,m,g,this.xCellCount*ve+_e,P,R,L))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,m,g,b,P){const R=g-s,L=b-d,H=m+P;return H*H>R*R+L*L}_circleAndRectCollide(s,d,m,g,b,P,R){const L=(P-g)/2,H=Math.abs(s-(g+L));if(H>L+m)return!1;const q=(R-b)/2,Y=Math.abs(d-(b+q));if(Y>q+m)return!1;if(H<=L||Y<=q)return!0;const se=H-L,_e=Y-q;return se*se+_e*_e<=m*m}}function ft(_,s,d,m,g){const b=l.F();return s?(l.J(b,b,[1/g,1/g,1]),d||l.ad(b,b,m.angle)):l.K(b,m.labelPlaneMatrix,_),b}function kt(_,s,d,m,g){if(s){const b=l.ae(_);return l.J(b,b,[g,g,1]),d||l.ad(b,b,-m.angle),b}return m.glCoordMatrix}function ce(_,s,d){let m;d?(m=[_.x,_.y,d(_.x,_.y),1],l.af(m,m,s)):(m=[_.x,_.y,0,1],nn(m,m,s));const g=m[3];return{point:new l.P(m[0]/g,m[1]/g),signedDistanceFromCamera:g}}function O(_,s){return .5+_/s*.5}function V(_,s){const d=_[0]/_[3],m=_[1]/_[3];return d>=-s[0]&&d<=s[0]&&m>=-s[1]&&m<=s[1]}function $(_,s,d,m,g,b,P,R,L,H){const q=m?_.textSizeData:_.iconSizeData,Y=l.ag(q,d.transform.zoom),se=[256/d.width*2+1,256/d.height*2+1],_e=m?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;_e.clear();const ve=_.lineVertexArray,we=m?_.text.placedSymbolArray:_.icon.placedSymbolArray,fe=d.transform.width/d.transform.height;let ze=!1;for(let qe=0;qe<we.length;qe++){const Me=we.get(qe);if(Me.hidden||Me.writingMode===l.ah.vertical&&!ze){Ct(Me.numGlyphs,_e);continue}let Oe;if(ze=!1,H?(Oe=[Me.anchorX,Me.anchorY,H(Me.anchorX,Me.anchorY),1],l.af(Oe,Oe,s)):(Oe=[Me.anchorX,Me.anchorY,0,1],nn(Oe,Oe,s)),!V(Oe,se)){Ct(Me.numGlyphs,_e);continue}const Ke=O(d.transform.cameraToCenterDistance,Oe[3]),Qe=l.ai(q,Y,Me),ot=P?Qe/Ke:Qe*Ke,bt=new l.P(Me.anchorX,Me.anchorY),vt=ce(bt,g,H).point,xt={projections:{},offsets:{}},Zt=Se(Me,ot,!1,R,s,g,b,_.glyphOffsetArray,ve,_e,vt,bt,xt,fe,L,H);ze=Zt.useVertical,(Zt.notEnoughRoom||ze||Zt.needsFlipping&&Se(Me,ot,!0,R,s,g,b,_.glyphOffsetArray,ve,_e,vt,bt,xt,fe,L,H).notEnoughRoom)&&Ct(Me.numGlyphs,_e)}m?_.text.dynamicLayoutVertexBuffer.updateData(_e):_.icon.dynamicLayoutVertexBuffer.updateData(_e)}function ne(_,s,d,m,g,b,P,R,L,H,q,Y,se){const _e=R.glyphStartIndex+R.numGlyphs,ve=R.lineStartIndex,we=R.lineStartIndex+R.lineLength,fe=s.getoffsetX(R.glyphStartIndex),ze=s.getoffsetX(_e-1),qe=Ye(_*fe,d,m,g,b,P,R.segment,ve,we,L,H,q,Y,se);if(!qe)return null;const Me=Ye(_*ze,d,m,g,b,P,R.segment,ve,we,L,H,q,Y,se);return Me?{first:qe,last:Me}:null}function me(_,s,d,m){return _===l.ah.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*m?{useVertical:!0}:(_===l.ah.vertical?s.y<d.y:s.x>d.x)?{needsFlipping:!0}:null}function Se(_,s,d,m,g,b,P,R,L,H,q,Y,se,_e,ve,we){const fe=s/24,ze=_.lineOffsetX*fe,qe=_.lineOffsetY*fe;let Me;if(_.numGlyphs>1){const Oe=_.glyphStartIndex+_.numGlyphs,Ke=_.lineStartIndex,Qe=_.lineStartIndex+_.lineLength,ot=ne(fe,R,ze,qe,d,q,Y,_,L,b,se,ve,we);if(!ot)return{notEnoughRoom:!0};const bt=ce(ot.first.point,P,we).point,vt=ce(ot.last.point,P,we).point;if(m&&!d){const xt=me(_.writingMode,bt,vt,_e);if(xt)return xt}Me=[ot.first];for(let xt=_.glyphStartIndex+1;xt<Oe-1;xt++)Me.push(Ye(fe*R.getoffsetX(xt),ze,qe,d,q,Y,_.segment,Ke,Qe,L,b,se,ve,we));Me.push(ot.last)}else{if(m&&!d){const Ke=ce(Y,g,we).point,Qe=_.lineStartIndex+_.segment+1,ot=new l.P(L.getx(Qe),L.gety(Qe)),bt=ce(ot,g,we),vt=bt.signedDistanceFromCamera>0?bt.point:Te(Y,ot,Ke,1,g,we),xt=me(_.writingMode,Ke,vt,_e);if(xt)return xt}const Oe=Ye(fe*R.getoffsetX(_.glyphStartIndex),ze,qe,d,q,Y,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,L,b,se,ve,we);if(!Oe)return{notEnoughRoom:!0};Me=[Oe]}for(const Oe of Me)l.aj(H,Oe.point,Oe.angle);return{}}function Te(_,s,d,m,g,b){const P=ce(_.add(_.sub(s)._unit()),g,b).point,R=d.sub(P);return d.add(R._mult(m/R.mag()))}function ye(_,s){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:P,getElevation:R,previousVertex:L,direction:H,absOffsetX:q}=s;if(d.projections[_])return d.projections[_];const Y=new l.P(m.getx(_),m.gety(_)),se=ce(Y,g,R);if(se.signedDistanceFromCamera>0)return d.projections[_]=se.point,se.point;const _e=_-H;return Te(P===0?b:new l.P(m.getx(_e),m.gety(_e)),Y,L,q-P+1,g,R)}function Re(_,s,d){return _._unit()._perp()._mult(s*d)}function $e(_,s,d,m,g,b,P,R){const{projectionCache:L,direction:H}=R;if(L.offsets[_])return L.offsets[_];const q=d.add(s);if(_+H<m||_+H>=g)return L.offsets[_]=q,q;const Y=ye(_+H,R),se=Re(Y.sub(d),P,H),_e=d.add(se),ve=Y.add(se);return L.offsets[_]=l.ak(b,q,_e,ve)||q,L.offsets[_]}function Ye(_,s,d,m,g,b,P,R,L,H,q,Y,se,_e){const ve=m?_-s:_+s;let we=ve>0?1:-1,fe=0;m&&(we*=-1,fe=Math.PI),we<0&&(fe+=Math.PI);let ze,qe,Me=we>0?R+P:R+P+1,Oe=g,Ke=g,Qe=0,ot=0;const bt=Math.abs(ve),vt=[];let xt;for(;Qe+ot<=bt;){if(Me+=we,Me<R||Me>=L)return null;Qe+=ot,Ke=Oe,qe=ze;const Ot={projectionCache:Y,lineVertexArray:H,labelPlaneMatrix:q,tileAnchorPoint:b,distanceFromAnchor:Qe,getElevation:_e,previousVertex:Ke,direction:we,absOffsetX:bt};if(Oe=ye(Me,Ot),d===0)vt.push(Ke),xt=Oe.sub(Ke);else{let Tn;const Nn=Oe.sub(Ke);Tn=Nn.mag()===0?Re(ye(Me+we,Ot).sub(Oe),d,we):Re(Nn,d,we),qe||(qe=Ke.add(Tn)),ze=$e(Me,Tn,Oe,R,L,qe,d,Ot),vt.push(qe),xt=ze.sub(qe)}ot=xt.mag()}const Zt=xt._mult((bt-Qe)/ot)._add(qe||Ke),zn=fe+Math.atan2(Oe.y-Ke.y,Oe.x-Ke.x);return vt.push(Zt),{point:Zt,angle:se?zn:0,path:vt}}const Ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(_,s){for(let d=0;d<_;d++){const m=s.length;s.resize(m+4),s.float32.set(Ge,3*m)}}function nn(_,s,d){const m=s[0],g=s[1];return _[0]=d[0]*m+d[4]*g+d[12],_[1]=d[1]*m+d[5]*g+d[13],_[3]=d[3]*m+d[7]*g+d[15],_}const on=100;class bn{constructor(s,d=new Be(s.width+200,s.height+200,25),m=new Be(s.width+200,s.height+200,25)){this.transform=s,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+on,this.screenBottomBoundary=s.height+on,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,d,m,g,b,P){const R=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,P),L=m*R.perspectiveRatio,H=s.x1*L+R.point.x,q=s.y1*L+R.point.y,Y=s.x2*L+R.point.x,se=s.y2*L+R.point.y;return!this.isInsideGrid(H,q,Y,se)||d!=="always"&&this.grid.hitTest(H,q,Y,se,d,b)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[H,q,Y,se],offscreen:this.isOffscreen(H,q,Y,se)}}placeCollisionCircles(s,d,m,g,b,P,R,L,H,q,Y,se,_e,ve){const we=[],fe=new l.P(d.anchorX,d.anchorY),ze=ce(fe,P,ve),qe=O(this.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),Me=(q?b/qe:b*qe)/l.ao,Oe=ce(fe,R,ve).point,Ke=ne(Me,g,d.lineOffsetX*Me,d.lineOffsetY*Me,!1,Oe,fe,d,m,R,{projections:{},offsets:{}},!1,ve);let Qe=!1,ot=!1,bt=!0;if(Ke){const vt=.5*se*qe+_e,xt=new l.P(-100,-100),Zt=new l.P(this.screenRightBoundary,this.screenBottomBoundary),zn=new Jt,Ot=Ke.first,Tn=Ke.last;let Nn=[];for(let Vn=Ot.path.length-1;Vn>=1;Vn--)Nn.push(Ot.path[Vn]);for(let Vn=1;Vn<Tn.path.length;Vn++)Nn.push(Tn.path[Vn]);const Xn=2.5*vt;if(L){const Vn=Nn.map(Hn=>ce(Hn,L,ve));Nn=Vn.some(Hn=>Hn.signedDistanceFromCamera<=0)?[]:Vn.map(Hn=>Hn.point)}let Rn=[];if(Nn.length>0){const Vn=Nn[0].clone(),Hn=Nn[0].clone();for(let Ir=1;Ir<Nn.length;Ir++)Vn.x=Math.min(Vn.x,Nn[Ir].x),Vn.y=Math.min(Vn.y,Nn[Ir].y),Hn.x=Math.max(Hn.x,Nn[Ir].x),Hn.y=Math.max(Hn.y,Nn[Ir].y);Rn=Vn.x>=xt.x&&Hn.x<=Zt.x&&Vn.y>=xt.y&&Hn.y<=Zt.y?[Nn]:Hn.x<xt.x||Vn.x>Zt.x||Hn.y<xt.y||Vn.y>Zt.y?[]:l.al([Nn],xt.x,xt.y,Zt.x,Zt.y)}for(const Vn of Rn){zn.reset(Vn,.25*vt);let Hn=0;Hn=zn.length<=.5*vt?1:Math.ceil(zn.paddedLength/Xn)+1;for(let Ir=0;Ir<Hn;Ir++){const mr=Ir/Math.max(Hn-1,1),Ki=zn.lerp(mr),Qr=Ki.x+on,vr=Ki.y+on;we.push(Qr,vr,vt,0);const Pi=Qr-vt,Ya=vr-vt,xs=Qr+vt,Ko=vr+vt;if(bt=bt&&this.isOffscreen(Pi,Ya,xs,Ko),ot=ot||this.isInsideGrid(Pi,Ya,xs,Ko),s!=="always"&&this.grid.hitTestCircle(Qr,vr,vt,s,Y)&&(Qe=!0,!H))return{circles:[],offscreen:!1,collisionDetected:Qe}}}}return{circles:!H&&Qe||!ot||qe<this.perspectiveRatioCutoff?[]:we,offscreen:bt,collisionDetected:Qe}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,g=1/0,b=-1/0,P=-1/0;for(const q of s){const Y=new l.P(q.x+on,q.y+on);m=Math.min(m,Y.x),g=Math.min(g,Y.y),b=Math.max(b,Y.x),P=Math.max(P,Y.y),d.push(Y)}const R=this.grid.query(m,g,b,P).concat(this.ignoredGrid.query(m,g,b,P)),L={},H={};for(const q of R){const Y=q.key;if(L[Y.bucketInstanceId]===void 0&&(L[Y.bucketInstanceId]={}),L[Y.bucketInstanceId][Y.featureIndex])continue;const se=[new l.P(q.x1,q.y1),new l.P(q.x2,q.y1),new l.P(q.x2,q.y2),new l.P(q.x1,q.y2)];l.am(d,se)&&(L[Y.bucketInstanceId][Y.featureIndex]=!0,H[Y.bucketInstanceId]===void 0&&(H[Y.bucketInstanceId]=[]),H[Y.bucketInstanceId].push(Y.featureIndex))}return H}insertCollisionBox(s,d,m,g,b,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:P,overlapMode:d},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,m,g,b,P){const R=m?this.ignoredGrid:this.grid,L={bucketInstanceId:g,featureIndex:b,collisionGroupID:P,overlapMode:d};for(let H=0;H<s.length;H+=4)R.insertCircle(L,s[H],s[H+1],s[H+2])}projectAndGetPerspectiveRatio(s,d,m,g){let b;return g?(b=[d,m,g(d,m),1],l.af(b,b,s)):(b=[d,m,0,1],nn(b,b,s)),{point:new l.P((b[0]/b[3]+1)/2*this.transform.width+on,(-b[1]/b[3]+1)/2*this.transform.height+on),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(s,d,m,g){return m<on||s>=this.screenRightBoundary||g<on||d>this.screenBottomBoundary}isInsideGrid(s,d,m,g){return m>=0&&s<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=l.an([]);return l.H(s,s,[-100,-100,0]),s}}function wn(_,s,d){return s*(l.W/(_.tileSize*Math.pow(2,d-_.tileID.overscaledZ)))}class lr{constructor(s,d,m,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class er{constructor(s,d,m,g,b){this.text=new lr(s?s.text:null,d,m,b),this.icon=new lr(s?s.icon:null,d,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class de{constructor(s,d,m){this.text=s,this.icon=d,this.skipFade=m}}class Le{constructor(){this.invProjMatrix=l.F(),this.viewportMatrix=l.F(),this.circles=[]}}class We{constructor(s,d,m,g,b){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=b}}class Xe{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[s]}}function Ze(_,s,d,m,g){const{horizontalAlign:b,verticalAlign:P}=l.at(_);return new l.P(-(b-.5)*s+m[0]*g,-(P-.5)*d+m[1]*g)}function Pt(_,s,d,m,g,b){const{x1:P,x2:R,y1:L,y2:H,anchorPointX:q,anchorPointY:Y}=_,se=new l.P(s,d);return m&&se._rotate(g?b:-b),{x1:P+se.x,y1:L+se.y,x2:R+se.x,y2:H+se.y,anchorPointX:q,anchorPointY:Y}}class rn{constructor(s,d,m,g,b){this.transform=s.clone(),this.terrain=d,this.collisionIndex=new bn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Xe(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,d,m,g){const b=m.getBucket(d),P=m.latestFeatureIndex;if(!b||!P||d.id!==b.layerIds[0])return;const R=m.collisionBoxArray,L=b.layers[0].layout,H=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),q=m.tileSize/l.W,Y=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),se=L.get("text-pitch-alignment")==="map",_e=L.get("text-rotation-alignment")==="map",ve=wn(m,1,this.transform.zoom),we=ft(Y,se,_e,this.transform,ve);let fe=null;if(se){const qe=kt(Y,se,_e,this.transform,ve);fe=l.K([],this.transform.labelPlaneMatrix,qe)}this.retainedQueryData[b.bucketInstanceId]=new We(b.bucketInstanceId,P,b.sourceLayerIndex,b.index,m.tileID);const ze={bucket:b,layout:L,posMatrix:Y,textLabelPlaneMatrix:we,labelToScreenMatrix:fe,scale:H,textPixelRatio:q,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:l.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const qe of b.sortKeyRanges){const{sortKey:Me,symbolInstanceStart:Oe,symbolInstanceEnd:Ke}=qe;s.push({sortKey:Me,symbolInstanceStart:Oe,symbolInstanceEnd:Ke,parameters:ze})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(s,d,m,g,b,P,R,L,H,q,Y,se,_e,ve,we,fe){const ze=l.ap[s.textAnchor],qe=[s.textOffset0,s.textOffset1],Me=Ze(ze,m,g,qe,b),Oe=this.collisionIndex.placeCollisionBox(Pt(d,Me.x,Me.y,P,R,this.transform.angle),Y,L,H,q.predicate,fe);if((!we||this.collisionIndex.placeCollisionBox(Pt(we,Me.x,Me.y,P,R,this.transform.angle),Y,L,H,q.predicate,fe).box.length!==0)&&Oe.box.length>0){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:qe,width:m,height:g,anchor:ze,textBoxScale:b,prevAnchor:Ke},this.markUsedJustification(_e,ze,se,ve),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,ve,se),this.placedOrientations[se.crossTileID]=ve),{shift:Me,placedGlyphBoxes:Oe}}}placeLayerBucketPart(s,d,m){const{bucket:g,layout:b,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:L,textPixelRatio:H,holdingForFade:q,collisionBoxArray:Y,partiallyEvaluatedTextSize:se,collisionGroup:_e}=s.parameters,ve=b.get("text-optional"),we=b.get("icon-optional"),fe=l.aq(b,"text-overlap","text-allow-overlap"),ze=fe==="always",qe=l.aq(b,"icon-overlap","icon-allow-overlap"),Me=qe==="always",Oe=b.get("text-rotation-alignment")==="map",Ke=b.get("text-pitch-alignment")==="map",Qe=b.get("icon-text-fit")!=="none",ot=b.get("symbol-z-order")==="viewport-y",bt=ze&&(Me||!g.hasIconData()||we),vt=Me&&(ze||!g.hasTextData()||ve);!g.collisionArrays&&Y&&g.deserializeCollisionBoxes(Y);const xt=this.retainedQueryData[g.bucketInstanceId].tileID,Zt=this.terrain?(Ot,Tn)=>this.terrain.getElevation(xt,Ot,Tn):null,zn=(Ot,Tn)=>{var Nn,Xn;if(d[Ot.crossTileID])return;if(q)return void(this.placements[Ot.crossTileID]=new de(!1,!1,!1));let Rn=!1,Vn=!1,Hn=!0,Ir=null,mr={box:null,offscreen:null},Ki={box:null,offscreen:null},Qr=null,vr=null,Pi=null,Ya=0,xs=0,Ko=0;Tn.textFeatureIndex?Ya=Tn.textFeatureIndex:Ot.useRuntimeCollisionCircles&&(Ya=Ot.featureIndex),Tn.verticalTextFeatureIndex&&(xs=Tn.verticalTextFeatureIndex);const Jo=Tn.textBox;if(Jo){const Fr=Ar=>{let yi=l.ah.horizontal;if(g.allowVerticalPlacement&&!Ar&&this.prevPlacement){const ma=this.prevPlacement.placedOrientations[Ot.crossTileID];ma&&(this.placedOrientations[Ot.crossTileID]=ma,yi=ma,this.markUsedOrientation(g,yi,Ot))}return yi},wr=(Ar,yi)=>{if(g.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&Tn.verticalTextBox){for(const ma of g.writingModes)if(ma===l.ah.vertical?(mr=yi(),Ki=mr):mr=Ar(),mr&&mr.box&&mr.box.length)break}else mr=Ar()},Vr=Ot.textAnchorOffsetStartIndex,rc=Ot.textAnchorOffsetEndIndex;if(rc===Vr){const Ar=(yi,ma)=>{const $n=this.collisionIndex.placeCollisionBox(yi,fe,H,P,_e.predicate,Zt);return $n&&$n.box&&$n.box.length&&(this.markUsedOrientation(g,ma,Ot),this.placedOrientations[Ot.crossTileID]=ma),$n};wr(()=>Ar(Jo,l.ah.horizontal),()=>{const yi=Tn.verticalTextBox;return g.allowVerticalPlacement&&Ot.numVerticalGlyphVertices>0&&yi?Ar(yi,l.ah.vertical):{box:null,offscreen:null}}),Fr(mr&&mr.box&&mr.box.length)}else{let Ar=l.ap[(Xn=(Nn=this.prevPlacement)===null||Nn===void 0?void 0:Nn.variableOffsets[Ot.crossTileID])===null||Xn===void 0?void 0:Xn.anchor];const yi=($n,p0,ag)=>{const Qo=$n.x2-$n.x1,el=$n.y2-$n.y1,Nh=Ot.textBoxScale,m0=Qe&&qe==="never"?p0:null;let tl={box:[],offscreen:!1},sg=fe==="never"?1:2,g0="never";Ar&&sg++;for(let og=0;og<sg;og++){for(let _u=Vr;_u<rc;_u++){const lg=g.textAnchorOffsets.get(_u);if(Ar&&lg.textAnchor!==Ar)continue;const xu=this.attemptAnchorPlacement(lg,$n,Qo,el,Nh,Oe,Ke,H,P,_e,g0,Ot,g,ag,m0,Zt);if(xu&&(tl=xu.placedGlyphBoxes,tl&&tl.box&&tl.box.length))return Rn=!0,Ir=xu.shift,tl}Ar?Ar=null:g0=fe}return tl};wr(()=>yi(Jo,Tn.iconBox,l.ah.horizontal),()=>{const $n=Tn.verticalTextBox;return g.allowVerticalPlacement&&!(mr&&mr.box&&mr.box.length)&&Ot.numVerticalGlyphVertices>0&&$n?yi($n,Tn.verticalIconBox,l.ah.vertical):{box:null,offscreen:null}}),mr&&(Rn=mr.box,Hn=mr.offscreen);const ma=Fr(mr&&mr.box);if(!Rn&&this.prevPlacement){const $n=this.prevPlacement.variableOffsets[Ot.crossTileID];$n&&(this.variableOffsets[Ot.crossTileID]=$n,this.markUsedJustification(g,$n.anchor,Ot,ma))}}}if(Qr=mr,Rn=Qr&&Qr.box&&Qr.box.length>0,Hn=Qr&&Qr.offscreen,Ot.useRuntimeCollisionCircles){const Fr=g.text.placedSymbolArray.get(Ot.centerJustifiedTextSymbolIndex),wr=l.ai(g.textSizeData,se,Fr),Vr=b.get("text-padding");vr=this.collisionIndex.placeCollisionCircles(fe,Fr,g.lineVertexArray,g.glyphOffsetArray,wr,P,R,L,m,Ke,_e.predicate,Ot.collisionCircleDiameter,Vr,Zt),vr.circles.length&&vr.collisionDetected&&!m&&l.w("Collisions detected, but collision boxes are not shown"),Rn=ze||vr.circles.length>0&&!vr.collisionDetected,Hn=Hn&&vr.offscreen}if(Tn.iconFeatureIndex&&(Ko=Tn.iconFeatureIndex),Tn.iconBox){const Fr=wr=>{const Vr=Qe&&Ir?Pt(wr,Ir.x,Ir.y,Oe,Ke,this.transform.angle):wr;return this.collisionIndex.placeCollisionBox(Vr,qe,H,P,_e.predicate,Zt)};Ki&&Ki.box&&Ki.box.length&&Tn.verticalIconBox?(Pi=Fr(Tn.verticalIconBox),Vn=Pi.box.length>0):(Pi=Fr(Tn.iconBox),Vn=Pi.box.length>0),Hn=Hn&&Pi.offscreen}const bs=ve||Ot.numHorizontalGlyphVertices===0&&Ot.numVerticalGlyphVertices===0,Ka=we||Ot.numIconVertices===0;if(bs||Ka?Ka?bs||(Vn=Vn&&Rn):Rn=Vn&&Rn:Vn=Rn=Vn&&Rn,Rn&&Qr&&Qr.box&&this.collisionIndex.insertCollisionBox(Qr.box,fe,b.get("text-ignore-placement"),g.bucketInstanceId,Ki&&Ki.box&&xs?xs:Ya,_e.ID),Vn&&Pi&&this.collisionIndex.insertCollisionBox(Pi.box,qe,b.get("icon-ignore-placement"),g.bucketInstanceId,Ko,_e.ID),vr&&(Rn&&this.collisionIndex.insertCollisionCircles(vr.circles,fe,b.get("text-ignore-placement"),g.bucketInstanceId,Ya,_e.ID),m)){const Fr=g.bucketInstanceId;let wr=this.collisionCircleArrays[Fr];wr===void 0&&(wr=this.collisionCircleArrays[Fr]=new Le);for(let Vr=0;Vr<vr.circles.length;Vr+=4)wr.circles.push(vr.circles[Vr+0]),wr.circles.push(vr.circles[Vr+1]),wr.circles.push(vr.circles[Vr+2]),wr.circles.push(vr.collisionDetected?1:0)}if(Ot.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Ot.crossTileID]=new de(Rn||bt,Vn||vt,Hn||g.justReloaded),d[Ot.crossTileID]=!0};if(ot){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Ot=g.getSortedSymbolIndexes(this.transform.angle);for(let Tn=Ot.length-1;Tn>=0;--Tn){const Nn=Ot[Tn];zn(g.symbolInstances.get(Nn),g.collisionArrays[Nn])}}else for(let Ot=s.symbolInstanceStart;Ot<s.symbolInstanceEnd;Ot++)zn(g.symbolInstances.get(Ot),g.collisionArrays[Ot]);if(m&&g.bucketInstanceId in this.collisionCircleArrays){const Ot=this.collisionCircleArrays[g.bucketInstanceId];l.ar(Ot.invProjMatrix,P),Ot.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,d,m,g){let b;b=g===l.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[l.as(d)];const P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of P)R>=0&&(s.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:m.crossTileID)}markUsedOrientation(s,d,m){const g=d===l.ah.horizontal||d===l.ah.horizontalOnly?d:0,b=d===l.ah.vertical?d:0,P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of P)s.text.placedSymbolArray.get(R).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(s):1,b=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const L in this.placements){const H=this.placements[L],q=b[L];q?(this.opacities[L]=new er(q,g,H.text,H.icon),m=m||H.text!==q.text.placed||H.icon!==q.icon.placed):(this.opacities[L]=new er(null,g,H.text,H.icon,H.skipFade),m=m||H.text||H.icon)}for(const L in b){const H=b[L];if(!this.opacities[L]){const q=new er(H,g,!1,!1);q.isHidden()||(this.opacities[L]=q,m=m||H.text.placed||H.icon.placed)}}for(const L in P)this.variableOffsets[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.variableOffsets[L]=P[L]);for(const L in R)this.placedOrientations[L]||!this.opacities[L]||this.opacities[L].isHidden()||(this.placedOrientations[L]=R[L]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const m={};for(const g of d){const b=g.getBucket(s);b&&g.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,g.collisionBoxArray)}}updateBucketOpacities(s,d,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],b=g.layout,P=new er(null,0,!1,!1,!0),R=b.get("text-allow-overlap"),L=b.get("icon-allow-overlap"),H=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),q=b.get("text-rotation-alignment")==="map",Y=b.get("text-pitch-alignment")==="map",se=b.get("icon-text-fit")!=="none",_e=new er(null,0,R&&(L||!s.hasIconData()||b.get("icon-optional")),L&&(R||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const ve=(we,fe,ze)=>{for(let qe=0;qe<fe/4;qe++)we.opacityVertexArray.emplaceBack(ze);we.hasVisibleVertices=we.hasVisibleVertices||ze!==Wn};for(let we=0;we<s.symbolInstances.length;we++){const fe=s.symbolInstances.get(we),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:qe,crossTileID:Me}=fe;let Oe=this.opacities[Me];d[Me]?Oe=P:Oe||(Oe=_e,this.opacities[Me]=Oe),d[Me]=!0;const Ke=fe.numIconVertices>0,Qe=this.placedOrientations[fe.crossTileID],ot=Qe===l.ah.vertical,bt=Qe===l.ah.horizontal||Qe===l.ah.horizontalOnly;if(ze>0||qe>0){const vt=Da(Oe.text);ve(s.text,ze,ot?Wn:vt),ve(s.text,qe,bt?Wn:vt);const xt=Oe.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(Ot=>{Ot>=0&&(s.text.placedSymbolArray.get(Ot).hidden=xt||ot?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=xt||bt?1:0);const Zt=this.variableOffsets[fe.crossTileID];Zt&&this.markUsedJustification(s,Zt.anchor,fe,Qe);const zn=this.placedOrientations[fe.crossTileID];zn&&(this.markUsedJustification(s,"left",fe,zn),this.markUsedOrientation(s,zn,fe))}if(Ke){const vt=Da(Oe.icon),xt=!(se&&fe.verticalPlacedIconSymbolIndex&&ot);fe.placedIconSymbolIndex>=0&&(ve(s.icon,fe.numIconVertices,xt?vt:Wn),s.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Oe.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(ve(s.icon,fe.numVerticalIconVertices,xt?Wn:vt),s.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Oe.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const vt=s.collisionArrays[we];if(vt){let xt=new l.P(0,0);if(vt.textBox||vt.verticalTextBox){let zn=!0;if(H){const Ot=this.variableOffsets[Me];Ot?(xt=Ze(Ot.anchor,Ot.width,Ot.height,Ot.textOffset,Ot.textBoxScale),q&&xt._rotate(Y?this.transform.angle:-this.transform.angle)):zn=!1}vt.textBox&&It(s.textCollisionBox.collisionVertexArray,Oe.text.placed,!zn||ot,xt.x,xt.y),vt.verticalTextBox&&It(s.textCollisionBox.collisionVertexArray,Oe.text.placed,!zn||bt,xt.x,xt.y)}const Zt=!!(!bt&&vt.verticalIconBox);vt.iconBox&&It(s.iconCollisionBox.collisionVertexArray,Oe.icon.placed,Zt,se?xt.x:0,se?xt.y:0),vt.verticalIconBox&&It(s.iconCollisionBox.collisionVertexArray,Oe.icon.placed,!Zt,se?xt.x:0,se?xt.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=we.invProjMatrix,s.placementViewportMatrix=we.viewportMatrix,s.collisionCircleArray=we.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function It(_,s,d,m,g){_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0)}const Qt=Math.pow(2,25),Sn=Math.pow(2,24),Xt=Math.pow(2,17),Fn=Math.pow(2,16),Er=Math.pow(2,9),gr=Math.pow(2,8),cr=Math.pow(2,1);function Da(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,d=Math.floor(127*_.opacity);return d*Qt+s*Sn+d*Xt+s*Fn+d*Er+s*gr+d*cr+s}const Wn=0;class Pn{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,m,g,b){const P=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(P,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((R,L)=>R.sortKey-L.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,b())return!0;return!1}}class Ol{constructor(s,d,m,g,b,P,R,L){this.placement=new rn(s,d,P,R,L),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,d,m){const g=M.now(),b=()=>!this._forceFullPlacement&&M.now()-g>2;for(;this._currentPlacementIndex>=0;){const P=d[s[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Pn(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const or=512/l.W/2;class fr{constructor(s,d,m){this.tileID=s,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let b=0;b<d.length;b++){const P=d.get(b),R=P.key,L=g.get(R);L?L.push(P):g.set(R,[P])}for(const[b,P]of g){const R={positions:P.map(L=>({x:Math.floor(L.anchorX*or),y:Math.floor(L.anchorY*or)})),crossTileIDs:P.map(L=>L.crossTileID)};if(R.positions.length>128){const L=new l.au(R.positions.length,16,Uint16Array);for(const{x:H,y:q}of R.positions)L.add(H,q);L.finish(),delete R.positions,R.index=L}this._symbolsByKey[b]=R}}getScaledCoordinates(s,d){const{x:m,y:g,z:b}=this.tileID.canonical,{x:P,y:R,z:L}=d.canonical,H=or/Math.pow(2,L-b),q=(R*l.W+s.anchorY)*H,Y=g*l.W*or;return{x:Math.floor((P*l.W+s.anchorX)*H-m*l.W*or),y:Math.floor(q-Y)}}findMatches(s,d,m){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let b=0;b<s.length;b++){const P=s.get(b);if(P.crossTileID)continue;const R=this._symbolsByKey[P.key];if(!R)continue;const L=this.getScaledCoordinates(P,d);if(R.index){const H=R.index.range(L.x-g,L.y-g,L.x+g,L.y+g).sort();for(const q of H){const Y=R.crossTileIDs[q];if(!m[Y]){m[Y]=!0,P.crossTileID=Y;break}}}else if(R.positions)for(let H=0;H<R.positions.length;H++){const q=R.positions[H],Y=R.crossTileIDs[H];if(Math.abs(q.x-L.x)<=g&&Math.abs(q.y-L.y)<=g&&!m[Y]){m[Y]=!0,P.crossTileID=Y;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class uo{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class da{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(d!==0)for(const m in this.indexes){const g=this.indexes[m],b={};for(const P in g){const R=g[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),b[R.tileID.key]=R}this.indexes[m]=b}this.lng=s}addBucket(s,d,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const P=this.indexes[b];if(Number(b)>s.overscaledZ)for(const R in P){const L=P[R];L.tileID.isChildOf(s)&&L.findMatches(d.symbolInstances,s,g)}else{const R=P[s.scaledTo(Number(b)).key];R&&R.findMatches(d.symbolInstances,s,g)}}for(let b=0;b<d.symbolInstances.length;b++){const P=d.symbolInstances.get(b);P.crossTileID||(P.crossTileID=m.generate(),g[P.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new fr(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const m of d.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let d=!1;for(const m in this.indexes){const g=this.indexes[m];for(const b in g)s[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[b]),delete g[b],d=!0)}return d}}class xr{constructor(){this.layerIndexes={},this.crossTileIDs=new uo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,m){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new da);let b=!1;const P={};g.handleWrapJump(m);for(const R of d){const L=R.getBucket(s);L&&s.id===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(R.tileID,L,this.crossTileIDs)&&(b=!0),P[L.bucketInstanceId]=!0)}return g.removeStaleBuckets(P)&&(b=!0),b}pruneUnusedLayers(s){const d={};s.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const Rr=(_,s)=>l.t(_,s&&s.filter(d=>d.identifier!=="source.canvas")),Jr=l.av();class ho extends l.E{constructor(s,d={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=s,this.dispatcher=new En(gn(),s._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("getImages",(m,g)=>this.getImages(m,g)),this.imageManager=new Ve,this.imageManager.setEventedParent(this),this.glyphManager=new ke(s._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Lt(256,512),this.crossTileSymbolIndex=new xr,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new l.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",l.ax()),tn().on(Nt,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const b=g.getSource();if(b&&b.vectorLayerIds)for(const P in this._layers){const R=this._layers[P];R.source===b.id&&this._validateLayer(R)}})}loadURL(s,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(s,K.Style);this._loadStyleRequest=new AbortController,l.h(g,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,d,m)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new l.j(b))})}loadJSON(s,d={},m){this.fire(new l.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(s,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new l.k("dataloading",{dataType:"style"})),this._load(Jr,{validate:!1})}_load(s,d,m){var g;const b=d.transformStyle?d.transformStyle(m,s):s;if(!d.validate||!Rr(this,l.x(b))){this._loaded=!0,this.stylesheet=b;for(const P in b.sources)this.addSource(P,b.sources[P],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new _t(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new l.k("data",{dataType:"style"})),this.fire(new l.k("style.load"))}}_createLayers(){const s=l.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of s){const m=l.az(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(s,d=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,P,R,L){return l._(this,void 0,void 0,function*(){const H=Ee(b),q=R>1?"@2x":"",Y={},se={};for(const{id:_e,url:ve}of H){const we=P.transformRequest(P.normalizeSpriteURL(ve,q,".json"),K.SpriteJSON);Y[_e]=l.h(we,L);const fe=P.transformRequest(P.normalizeSpriteURL(ve,q,".png"),K.SpriteImage);se[_e]=B.getImage(fe,L)}return yield Promise.all([...Object.values(Y),...Object.values(se)]),function(_e,ve){return l._(this,void 0,void 0,function*(){const we={};for(const fe in _e){we[fe]={};const ze=M.getImageCanvasContext((yield ve[fe]).data),qe=(yield _e[fe]).data;for(const Me in qe){const{width:Oe,height:Ke,x:Qe,y:ot,sdf:bt,pixelRatio:vt,stretchX:xt,stretchY:Zt,content:zn}=qe[Me];we[fe][Me]={data:null,pixelRatio:vt,sdf:bt,stretchX:xt,stretchY:Zt,content:zn,spriteData:{width:Oe,height:Ke,x:Qe,y:ot,context:ze}}}}return we})}(Y,se)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const P in b){this._spritesImagesIds[P]=[];const R=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(L=>!(L in b)):[];for(const L of R)this.imageManager.removeImage(L),this._changedImages[L]=!0;for(const L in b[P]){const H=P==="default"?L:`${P}:${L}`;this._spritesImagesIds[P].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,b[P][L],!1):this.imageManager.addImage(H,b[P][L]),d&&(this._changedImages[H]=!0)}}}).catch(b=>{this._spriteRequest=null,g=b,this.fire(new l.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}_validateLayer(s){const d=this.sourceCaches[s.source];if(!d)return;const m=s.sourceLayer;if(!m)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new l.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const d=this._serializedAllLayers();if(!s||s.length===0)return Object.values(d);const m=[];for(const g of s)d[g]&&m.push(d[g]);return m}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const g=this._layers[m];g.type!=="custom"&&(s[m]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const P in this._updatedSources){const R=this._updatedSources[P];if(R==="reload")this._reloadSource(P);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];m[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in m){const b=this.sourceCaches[g];m[g]!==b.used&&b.fire(new l.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,d&&this.fire(new l.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,d={}){var m;this._checkLoaded();const g=this.serialize();if(s=d.transformStyle?d.transformStyle(g,s):s,((m=d.validate)===null||m===void 0||m)&&Rr(this,l.x(s)))return!1;(s=l.aA(s)).layers=l.ay(s.layers);const b=l.aB(g,s),P=this._getOperationsToPerform(b);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const R of P.operations)R();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const d=[],m=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:m.push(g.command)}return{operations:d,unimplemented:m}}addImage(s,d){if(this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new l.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,d,m={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(l.x.source,`sources.${s}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[s]=new dt(s,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===s)return this.fire(new l.j(new Error(`Source "${s}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],d.fire(new l.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const m=this.sourceCaches[s].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,d,m={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new l.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(s.type==="custom"){if(Rr(this,l.aC(s)))return;b=l.az(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=l.aA(s),s=l.e(s,{source:g})),this._validate(l.x.layer,`layers.${g}`,s,{arrayIndex:-1},m))return;b=l.az(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const P=d?this._order.indexOf(d):this._order.length;if(d&&P===-1)this.fire(new l.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const R=this._removedLayers[g];delete this._removedLayers[g],R.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new l.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const m=this._order.indexOf(s);this._order.splice(m,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new l.j(new Error(`Cannot move layer "${s}" before non-existing layer "${d}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new l.j(new Error(`Cannot remove non-existing layer "${s}".`)));d.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,d,m){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===d&&g.maxzoom===m||(d!=null&&(g.minzoom=d),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new l.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,d,m={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!l.aD(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(l.x.filter,`layers.${g.id}.filter`,d,null,m)||(g.filter=l.aA(d),this._updateLayer(g)))}else this.fire(new l.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return l.aA(this.getLayer(s).filter)}setLayoutProperty(s,d,m,g={}){this._checkLoaded();const b=this.getLayer(s);b?l.aD(b.getLayoutProperty(d),m)||(b.setLayoutProperty(d,m,g),this._updateLayer(b)):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,d){const m=this.getLayer(s);if(m)return m.getLayoutProperty(d);this.fire(new l.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,d,m,g={}){this._checkLoaded();const b=this.getLayer(s);b?l.aD(b.getPaintProperty(d),m)||(b.setPaintProperty(d,m,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new l.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const m=s.source,g=s.sourceLayer,b=this.sourceCaches[m];if(b===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const P=b.getSource().type;P==="geojson"&&g?this.fire(new l.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||g?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,s.id,d)):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,d){this._checkLoaded();const m=s.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new l.j(new Error(`The source '${m}' does not exist in the map's style.`)));const b=g.getSource().type,P=b==="vector"?s.sourceLayer:void 0;b!=="vector"||P?d&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new l.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(P,s.id,d):this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const d=s.source,m=s.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||m?(s.id===void 0&&this.fire(new l.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,s.id)):void this.fire(new l.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new l.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return l.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=l.aE(this.sourceCaches,b=>b.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,g=this.stylesheet;return l.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:d,terrain:m},b=>b!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const d=P=>this._layers[P].type==="fill-extrusion",m={},g=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(d(R)){m[R]=P;for(const L of s){const H=L[R];if(H)for(const q of H)g.push(q)}}}g.sort((P,R)=>R.intersectionZ-P.intersectionZ);const b=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(d(R))for(let L=g.length-1;L>=0;L--){const H=g[L].feature;if(m[H.layer.id]<P)break;b.push(H),g.pop()}else for(const L of s){const H=L[R];if(H)for(const q of H)b.push(q.feature)}}return b}queryRenderedFeatures(s,d,m){d&&d.filter&&this._validate(l.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new l.j(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const L=this._layers[R];if(!L)return this.fire(new l.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];g[L.source]=!0}}const b=[];d.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const R in this.sourceCaches)d.layers&&!g[R]||b.push(An(this.sourceCaches[R],this._layers,P,s,d,m));return this.placement&&b.push(function(R,L,H,q,Y,se,_e){const ve={},we=se.queryRenderedSymbols(q),fe=[];for(const ze of Object.keys(we).map(Number))fe.push(_e[ze]);fe.sort(yn);for(const ze of fe){const qe=ze.featureIndex.lookupSymbolFeatures(we[ze.bucketInstanceId],L,ze.bucketIndex,ze.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,R);for(const Me in qe){const Oe=ve[Me]=ve[Me]||[],Ke=qe[Me];Ke.sort((Qe,ot)=>{const bt=ze.featureSortOrder;if(bt){const vt=bt.indexOf(Qe.featureIndex);return bt.indexOf(ot.featureIndex)-vt}return ot.featureIndex-Qe.featureIndex});for(const Qe of Ke)Oe.push(Qe)}}for(const ze in ve)ve[ze].forEach(qe=>{const Me=qe.feature,Oe=H[R[ze].source].getFeatureState(Me.layer["source-layer"],Me.id);Me.source=Me.layer.source,Me.layer["source-layer"]&&(Me.sourceLayer=Me.layer["source-layer"]),Me.state=Oe});return ve}(this._layers,P,this.sourceCaches,s,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,d){d&&d.filter&&this._validate(l.x.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[s];return m?function(g,b){const P=g.getRenderableIds().map(H=>g.getTileByID(H)),R=[],L={};for(let H=0;H<P.length;H++){const q=P[H],Y=q.tileID.canonical.key;L[Y]||(L[Y]=!0,q.querySourceFeatures(R,b))}return R}(m,d):[]}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const P in s)if(!l.aD(s[P],m[P])){g=!0;break}if(!g)return;const b={now:M.now(),transition:l.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(b)}_validate(s,d,m,g,b={}){return(!b||b.validate!==!1)&&Rr(this,s.call(l.x,l.e({key:d,style:this.serialize(),value:m,styleSpec:l.v},g)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),tn().off(Nt,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const d in this.sourceCaches)this.sourceCaches[d].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,d,m,g,b=!1){let P=!1,R=!1;const L={};for(const H of this._order){const q=this._layers[H];if(q.type!=="symbol")continue;if(!L[q.source]){const se=this.sourceCaches[q.source];L[q.source]=se.getRenderableIds(!0).map(_e=>se.getTileByID(_e)).sort((_e,ve)=>ve.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(ve.tileID)?-1:1))}const Y=this.crossTileSymbolIndex.addLayer(q,L[q.source],s.center.lng);P=P||Y}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.now(),s.zoom))&&(this.pauseablePlacement=new Ol(s,this.map.terrain,this._order,b,d,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,L),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const H of this._order){const q=this._layers[H];q.type==="symbol"&&this.placement.updateLayerOpacities(q,L[q.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d){return l._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(s,d){return l._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,d={}){this._checkLoaded(),s&&this._validate(l.x.glyphs,"glyphs",s,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,d,m={},g){this._checkLoaded();const b=[{id:s,url:d}],P=[...Ee(this.stylesheet.sprite),...b];this._validate(l.x.sprite,"sprite",P,null,m)||(this.stylesheet.sprite=P,this._loadSprite(b,!0,g))}removeSprite(s){this._checkLoaded();const d=Ee(this.stylesheet.sprite);if(d.find(m=>m.id===s)){if(this._spritesImagesIds[s])for(const m of this._spritesImagesIds[s])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===s),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new l.k("data",{dataType:"style"}))}else this.fire(new l.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Ee(this.stylesheet.sprite)}setSprite(s,d={},m){this._checkLoaded(),s&&this._validate(l.x.sprite,"sprite",s,null,d)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,m):(this._unloadSprite(),m&&m(null)))}}var Lr=l.X([{name:"a_pos",type:"Int16",components:2}]),Ho="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const fo={prelude:rr(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:rr(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:rr(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:rr(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:rr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:rr(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:rr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:rr("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:rr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:rr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:rr(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:rr(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:rr(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:rr(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:rr(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:rr(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:rr(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:rr(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:rr(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:rr(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:rr(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:rr(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:rr(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:rr("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ho),terrainDepth:rr("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ho),terrainCoords:rr("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ho)};function rr(_,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute ([\w]+) ([\w]+)/g),g=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(g):g,R={};return{fragmentSource:_=_.replace(d,(L,H,q,Y,se)=>(R[se]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
varying ${q} ${Y} ${se};
#else
uniform ${q} ${Y} u_${se};
#endif
`:`
#ifdef HAS_UNIFORM_u_${se}
    ${q} ${Y} ${se} = u_${se};
#endif
`)),vertexSource:s=s.replace(d,(L,H,q,Y,se)=>{const _e=Y==="float"?"vec2":"vec4",ve=se.match(/color/)?"color":_e;return R[se]?H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
attribute ${q} ${_e} a_${se};
varying ${q} ${Y} ${se};
#else
uniform ${q} ${Y} u_${se};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = a_${se};
#else
    ${q} ${Y} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = unpack_mix_${ve}(a_${se}, u_${se}_t);
#else
    ${q} ${Y} ${se} = u_${se};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
attribute ${q} ${_e} a_${se};
#else
uniform ${q} ${Y} u_${se};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${q} ${Y} ${se} = a_${se};
#else
    ${q} ${Y} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${q} ${Y} ${se} = unpack_mix_${ve}(a_${se}, u_${se}_t);
#else
    ${q} ${Y} ${se} = u_${se};
#endif
`}),staticAttributes:m,staticUniforms:P}}class hh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,m,g,b,P,R,L,H){this.context=s;let q=this.boundPaintVertexBuffers.length!==g.length;for(let Y=0;!q&&Y<g.length;Y++)this.boundPaintVertexBuffers[Y]!==g[Y]&&(q=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||q||this.boundIndexBuffer!==b||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==L||this.boundDynamicVertexBuffer3!==H?this.freshBind(d,m,g,b,P,R,L,H):(s.bindVertexArray.set(this.vao),R&&R.bind(),b&&b.dynamicDraw&&b.bind(),L&&L.bind(),H&&H.bind())}freshBind(s,d,m,g,b,P,R,L){const H=s.numAttributes,q=this.context,Y=q.gl;this.vao&&this.destroy(),this.vao=q.createVertexArray(),q.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=L,d.enableAttributes(Y,s);for(const se of m)se.enableAttributes(Y,s);P&&P.enableAttributes(Y,s),R&&R.enableAttributes(Y,s),L&&L.enableAttributes(Y,s),d.bind(),d.setVertexAttribPointers(Y,s,b);for(const se of m)se.bind(),se.setVertexAttribPointers(Y,s,b);P&&(P.bind(),P.setVertexAttribPointers(Y,s,b)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(Y,s,b)),L&&(L.bind(),L.setVertexAttribPointers(Y,s,b)),q.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ys(_){const s=[];for(let d=0;d<_.length;d++){if(_[d]===null)continue;const m=_[d].split(" ");s.push(m.pop())}return s}class Cf{constructor(s,d,m,g,b,P){const R=s.gl;this.program=R.createProgram();const L=ys(d.staticAttributes),H=m?m.getBinderAttributes():[],q=L.concat(H),Y=fo.prelude.staticUniforms?ys(fo.prelude.staticUniforms):[],se=d.staticUniforms?ys(d.staticUniforms):[],_e=m?m.getBinderUniforms():[],ve=Y.concat(se).concat(_e),we=[];for(const Qe of ve)we.indexOf(Qe)<0&&we.push(Qe);const fe=m?m.defines():[];b&&fe.push("#define OVERDRAW_INSPECTOR;"),P&&fe.push("#define TERRAIN3D;");const ze=fe.concat(fo.prelude.fragmentSource,d.fragmentSource).join(`
`),qe=fe.concat(fo.prelude.vertexSource,d.vertexSource).join(`
`),Me=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Me,ze),R.compileShader(Me),!R.getShaderParameter(Me,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(Me)}`);R.attachShader(this.program,Me);const Oe=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Oe,qe),R.compileShader(Oe),!R.getShaderParameter(Oe,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Oe)}`);R.attachShader(this.program,Oe),this.attributes={};const Ke={};this.numAttributes=q.length;for(let Qe=0;Qe<this.numAttributes;Qe++)q[Qe]&&(R.bindAttribLocation(this.program,Qe,q[Qe]),this.attributes[q[Qe]]=Qe);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Oe),R.deleteShader(Me);for(let Qe=0;Qe<we.length;Qe++){const ot=we[Qe];if(ot&&!Ke[ot]){const bt=R.getUniformLocation(this.program,ot);bt&&(Ke[ot]=bt)}}this.fixedUniforms=g(s,Ke),this.terrainUniforms=((Qe,ot)=>({u_depth:new l.aG(Qe,ot.u_depth),u_terrain:new l.aG(Qe,ot.u_terrain),u_terrain_dim:new l.aH(Qe,ot.u_terrain_dim),u_terrain_matrix:new l.aI(Qe,ot.u_terrain_matrix),u_terrain_unpack:new l.aJ(Qe,ot.u_terrain_unpack),u_terrain_exaggeration:new l.aH(Qe,ot.u_terrain_exaggeration)}))(s,Ke),this.binderUniforms=m?m.getUniforms(s,Ke):[]}draw(s,d,m,g,b,P,R,L,H,q,Y,se,_e,ve,we,fe,ze,qe){const Me=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(g),s.setColorMode(b),s.setCullFace(P),L){s.activeTexture.set(Me.TEXTURE2),Me.bindTexture(Me.TEXTURE_2D,L.depthTexture),s.activeTexture.set(Me.TEXTURE3),Me.bindTexture(Me.TEXTURE_2D,L.texture);for(const Ke in this.terrainUniforms)this.terrainUniforms[Ke].set(L[Ke])}for(const Ke in this.fixedUniforms)this.fixedUniforms[Ke].set(R[Ke]);we&&we.setUniforms(s,this.binderUniforms,_e,{zoom:ve});let Oe=0;switch(d){case Me.LINES:Oe=2;break;case Me.TRIANGLES:Oe=3;break;case Me.LINE_STRIP:Oe=1}for(const Ke of se.get()){const Qe=Ke.vaos||(Ke.vaos={});(Qe[H]||(Qe[H]=new hh)).bind(s,this,q,we?we.getPaintVertexBuffers():[],Y,Ke.vertexOffset,fe,ze,qe),Me.drawElements(d,Ke.primitiveLength*Oe,Me.UNSIGNED_SHORT,Ke.primitiveOffset*Oe*2)}}}function ru(_,s,d){const m=1/wn(d,1,s.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),b=d.tileSize*Math.pow(2,s.transform.tileZoom)/g,P=b*(d.tileID.canonical.x+d.tileID.wrap*g),R=b*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[P>>16,R>>16],u_pixel_coord_lower:[65535&P,65535&R]}}const Mm=(_,s,d,m)=>{const g=s.style.light,b=g.properties.get("position"),P=[b.x,b.y,b.z],R=function(){var H=new l.A(9);return l.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();g.properties.get("anchor")==="viewport"&&function(H,q){var Y=Math.sin(q),se=Math.cos(q);H[0]=se,H[1]=Y,H[2]=0,H[3]=-Y,H[4]=se,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(R,-s.transform.angle),function(H,q,Y){var se=q[0],_e=q[1],ve=q[2];H[0]=se*Y[0]+_e*Y[3]+ve*Y[6],H[1]=se*Y[1]+_e*Y[4]+ve*Y[7],H[2]=se*Y[2]+_e*Y[5]+ve*Y[8]}(P,P,R);const L=g.properties.get("color");return{u_matrix:_,u_lightpos:P,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[L.r,L.g,L.b],u_vertical_gradient:+d,u_opacity:m}},Fv=(_,s,d,m,g,b,P)=>l.e(Mm(_,s,d,m),ru(b,s,P),{u_height_factor:-Math.pow(2,g.overscaledZ)/P.tileSize/8}),dh=_=>({u_matrix:_}),Tm=(_,s,d,m)=>l.e(dh(_),ru(d,s,m)),Em=(_,s)=>({u_matrix:_,u_world:s}),Nv=(_,s,d,m,g)=>l.e(Tm(_,s,d,m),{u_world:g}),Am=(_,s,d,m)=>{const g=_.transform;let b,P;if(m.paint.get("circle-pitch-alignment")==="map"){const R=wn(d,1,g.zoom);b=!0,P=[R,R]}else b=!1,P=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(s.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:P}},Ov=(_,s,d)=>{const m=wn(d,1,s.zoom),g=Math.pow(2,s.zoom-d.tileID.overscaledZ),b=d.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[s.pixelsToGLUnits[0]/(m*g),s.pixelsToGLUnits[1]/(m*g)],u_overscale_factor:b}},fh=(_,s,d=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:d}),Pf=_=>({u_matrix:_}),Cm=(_,s,d,m)=>({u_matrix:_,u_extrude_scale:wn(s,1,d),u_intensity:m});function Pm(_,s){const d=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new l.Y(0,m/d).toLngLat().lat,new l.Y(0,(m+1)/d).toLngLat().lat]}const ph=(_,s,d,m)=>{const g=_.transform;return{u_matrix:au(_,s,d,m),u_ratio:1/wn(s,1,g.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Go=(_,s,d,m,g)=>l.e(ph(_,s,d,g),{u_image:0,u_image_height:m}),mh=(_,s,d,m,g)=>{const b=_.transform,P=iu(s,b);return{u_matrix:au(_,s,d,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/wn(s,1,b.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},ka=(_,s,d,m,g,b)=>{const P=_.lineAtlas,R=iu(s,_.transform),L=d.layout.get("line-cap")==="round",H=P.getDash(m.from,L),q=P.getDash(m.to,L),Y=H.width*g.fromScale,se=q.width*g.toScale;return l.e(ph(_,s,d,b),{u_patternscale_a:[R/Y,-H.height/2],u_patternscale_b:[R/se,-q.height/2],u_sdfgamma:P.width/(256*Math.min(Y,se)*_.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:q.y,u_mix:g.t})};function iu(_,s){return 1/wn(_,1,s.tileZoom)}function au(_,s,d,m){return _.translatePosMatrix(m?m.posMatrix:s.tileID.posMatrix,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const su=(_,s,d,m,g)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(P=g.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:gh(g.paint.get("raster-hue-rotate"))};var b,P};function gh(_){_*=Math.PI/180;const s=Math.sin(_),d=Math.cos(_);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const ou=(_,s,d,m,g,b,P,R,L,H)=>{const q=g.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:q.cameraToCenterDistance,u_pitch:q.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:q.width/q.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+L,u_pitch_with_map:+m,u_texsize:H,u_texture:0}},Bl=(_,s,d,m,g,b,P,R,L,H,q)=>{const Y=g.transform;return l.e(ou(_,s,d,m,g,b,P,R,L,H),{u_gamma_scale:m?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+q})},Bv=(_,s,d,m,g,b,P,R,L,H)=>l.e(Bl(_,s,d,m,g,b,P,R,!0,L,!0),{u_texsize_icon:H,u_texture_icon:1}),Uv=(_,s,d)=>({u_matrix:_,u_opacity:s,u_color:d}),Rm=(_,s,d,m,g,b)=>l.e(function(P,R,L,H){const q=L.imageManager.getPattern(P.from.toString()),Y=L.imageManager.getPattern(P.to.toString()),{width:se,height:_e}=L.imageManager.getPixelSize(),ve=Math.pow(2,H.tileID.overscaledZ),we=H.tileSize*Math.pow(2,L.transform.tileZoom)/ve,fe=we*(H.tileID.canonical.x+H.tileID.wrap*ve),ze=we*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:q.tl,u_pattern_br_a:q.br,u_pattern_tl_b:Y.tl,u_pattern_br_b:Y.br,u_texsize:[se,_e],u_mix:R.t,u_pattern_size_a:q.displaySize,u_pattern_size_b:Y.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/wn(H,1,L.transform.tileZoom),u_pixel_coord_upper:[fe>>16,ze>>16],u_pixel_coord_lower:[65535&fe,65535&ze]}}(m,b,d,g),{u_matrix:_,u_opacity:s}),Vv={fillExtrusion:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_lightpos:new l.aK(_,s.u_lightpos),u_lightintensity:new l.aH(_,s.u_lightintensity),u_lightcolor:new l.aK(_,s.u_lightcolor),u_vertical_gradient:new l.aH(_,s.u_vertical_gradient),u_opacity:new l.aH(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_lightpos:new l.aK(_,s.u_lightpos),u_lightintensity:new l.aH(_,s.u_lightintensity),u_lightcolor:new l.aK(_,s.u_lightcolor),u_vertical_gradient:new l.aH(_,s.u_vertical_gradient),u_height_factor:new l.aH(_,s.u_height_factor),u_image:new l.aG(_,s.u_image),u_texsize:new l.aL(_,s.u_texsize),u_pixel_coord_upper:new l.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(_,s.u_pixel_coord_lower),u_scale:new l.aK(_,s.u_scale),u_fade:new l.aH(_,s.u_fade),u_opacity:new l.aH(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_image:new l.aG(_,s.u_image),u_texsize:new l.aL(_,s.u_texsize),u_pixel_coord_upper:new l.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(_,s.u_pixel_coord_lower),u_scale:new l.aK(_,s.u_scale),u_fade:new l.aH(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_world:new l.aL(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_world:new l.aL(_,s.u_world),u_image:new l.aG(_,s.u_image),u_texsize:new l.aL(_,s.u_texsize),u_pixel_coord_upper:new l.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(_,s.u_pixel_coord_lower),u_scale:new l.aK(_,s.u_scale),u_fade:new l.aH(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_scale_with_map:new l.aG(_,s.u_scale_with_map),u_pitch_with_map:new l.aG(_,s.u_pitch_with_map),u_extrude_scale:new l.aL(_,s.u_extrude_scale),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_matrix:new l.aI(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_pixels_to_tile_units:new l.aH(_,s.u_pixels_to_tile_units),u_extrude_scale:new l.aL(_,s.u_extrude_scale),u_overscale_factor:new l.aH(_,s.u_overscale_factor)}),collisionCircle:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_inv_matrix:new l.aI(_,s.u_inv_matrix),u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_viewport_size:new l.aL(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new l.aM(_,s.u_color),u_matrix:new l.aI(_,s.u_matrix),u_overlay:new l.aG(_,s.u_overlay),u_overlay_scale:new l.aH(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new l.aH(_,s.u_extrude_scale),u_intensity:new l.aH(_,s.u_intensity),u_matrix:new l.aI(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_world:new l.aL(_,s.u_world),u_image:new l.aG(_,s.u_image),u_color_ramp:new l.aG(_,s.u_color_ramp),u_opacity:new l.aH(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_image:new l.aG(_,s.u_image),u_latrange:new l.aL(_,s.u_latrange),u_light:new l.aL(_,s.u_light),u_shadow:new l.aM(_,s.u_shadow),u_highlight:new l.aM(_,s.u_highlight),u_accent:new l.aM(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_image:new l.aG(_,s.u_image),u_dimension:new l.aL(_,s.u_dimension),u_zoom:new l.aH(_,s.u_zoom),u_unpack:new l.aJ(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_ratio:new l.aH(_,s.u_ratio),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aL(_,s.u_units_to_pixels)}),lineGradient:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_ratio:new l.aH(_,s.u_ratio),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aL(_,s.u_units_to_pixels),u_image:new l.aG(_,s.u_image),u_image_height:new l.aH(_,s.u_image_height)}),linePattern:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_texsize:new l.aL(_,s.u_texsize),u_ratio:new l.aH(_,s.u_ratio),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_image:new l.aG(_,s.u_image),u_units_to_pixels:new l.aL(_,s.u_units_to_pixels),u_scale:new l.aK(_,s.u_scale),u_fade:new l.aH(_,s.u_fade)}),lineSDF:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_ratio:new l.aH(_,s.u_ratio),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new l.aL(_,s.u_units_to_pixels),u_patternscale_a:new l.aL(_,s.u_patternscale_a),u_patternscale_b:new l.aL(_,s.u_patternscale_b),u_sdfgamma:new l.aH(_,s.u_sdfgamma),u_image:new l.aG(_,s.u_image),u_tex_y_a:new l.aH(_,s.u_tex_y_a),u_tex_y_b:new l.aH(_,s.u_tex_y_b),u_mix:new l.aH(_,s.u_mix)}),raster:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_tl_parent:new l.aL(_,s.u_tl_parent),u_scale_parent:new l.aH(_,s.u_scale_parent),u_buffer_scale:new l.aH(_,s.u_buffer_scale),u_fade_t:new l.aH(_,s.u_fade_t),u_opacity:new l.aH(_,s.u_opacity),u_image0:new l.aG(_,s.u_image0),u_image1:new l.aG(_,s.u_image1),u_brightness_low:new l.aH(_,s.u_brightness_low),u_brightness_high:new l.aH(_,s.u_brightness_high),u_saturation_factor:new l.aH(_,s.u_saturation_factor),u_contrast_factor:new l.aH(_,s.u_contrast_factor),u_spin_weights:new l.aK(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new l.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(_,s.u_is_size_feature_constant),u_size_t:new l.aH(_,s.u_size_t),u_size:new l.aH(_,s.u_size),u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_pitch:new l.aH(_,s.u_pitch),u_rotate_symbol:new l.aG(_,s.u_rotate_symbol),u_aspect_ratio:new l.aH(_,s.u_aspect_ratio),u_fade_change:new l.aH(_,s.u_fade_change),u_matrix:new l.aI(_,s.u_matrix),u_label_plane_matrix:new l.aI(_,s.u_label_plane_matrix),u_coord_matrix:new l.aI(_,s.u_coord_matrix),u_is_text:new l.aG(_,s.u_is_text),u_pitch_with_map:new l.aG(_,s.u_pitch_with_map),u_texsize:new l.aL(_,s.u_texsize),u_texture:new l.aG(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new l.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(_,s.u_is_size_feature_constant),u_size_t:new l.aH(_,s.u_size_t),u_size:new l.aH(_,s.u_size),u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_pitch:new l.aH(_,s.u_pitch),u_rotate_symbol:new l.aG(_,s.u_rotate_symbol),u_aspect_ratio:new l.aH(_,s.u_aspect_ratio),u_fade_change:new l.aH(_,s.u_fade_change),u_matrix:new l.aI(_,s.u_matrix),u_label_plane_matrix:new l.aI(_,s.u_label_plane_matrix),u_coord_matrix:new l.aI(_,s.u_coord_matrix),u_is_text:new l.aG(_,s.u_is_text),u_pitch_with_map:new l.aG(_,s.u_pitch_with_map),u_texsize:new l.aL(_,s.u_texsize),u_texture:new l.aG(_,s.u_texture),u_gamma_scale:new l.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_is_halo:new l.aG(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new l.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new l.aG(_,s.u_is_size_feature_constant),u_size_t:new l.aH(_,s.u_size_t),u_size:new l.aH(_,s.u_size),u_camera_to_center_distance:new l.aH(_,s.u_camera_to_center_distance),u_pitch:new l.aH(_,s.u_pitch),u_rotate_symbol:new l.aG(_,s.u_rotate_symbol),u_aspect_ratio:new l.aH(_,s.u_aspect_ratio),u_fade_change:new l.aH(_,s.u_fade_change),u_matrix:new l.aI(_,s.u_matrix),u_label_plane_matrix:new l.aI(_,s.u_label_plane_matrix),u_coord_matrix:new l.aI(_,s.u_coord_matrix),u_is_text:new l.aG(_,s.u_is_text),u_pitch_with_map:new l.aG(_,s.u_pitch_with_map),u_texsize:new l.aL(_,s.u_texsize),u_texsize_icon:new l.aL(_,s.u_texsize_icon),u_texture:new l.aG(_,s.u_texture),u_texture_icon:new l.aG(_,s.u_texture_icon),u_gamma_scale:new l.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new l.aH(_,s.u_device_pixel_ratio),u_is_halo:new l.aG(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_opacity:new l.aH(_,s.u_opacity),u_color:new l.aM(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_opacity:new l.aH(_,s.u_opacity),u_image:new l.aG(_,s.u_image),u_pattern_tl_a:new l.aL(_,s.u_pattern_tl_a),u_pattern_br_a:new l.aL(_,s.u_pattern_br_a),u_pattern_tl_b:new l.aL(_,s.u_pattern_tl_b),u_pattern_br_b:new l.aL(_,s.u_pattern_br_b),u_texsize:new l.aL(_,s.u_texsize),u_mix:new l.aH(_,s.u_mix),u_pattern_size_a:new l.aL(_,s.u_pattern_size_a),u_pattern_size_b:new l.aL(_,s.u_pattern_size_b),u_scale_a:new l.aH(_,s.u_scale_a),u_scale_b:new l.aH(_,s.u_scale_b),u_pixel_coord_upper:new l.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new l.aL(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new l.aH(_,s.u_tile_units_to_pixels)}),terrain:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_texture:new l.aG(_,s.u_texture),u_ele_delta:new l.aH(_,s.u_ele_delta)}),terrainDepth:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_ele_delta:new l.aH(_,s.u_ele_delta)}),terrainCoords:(_,s)=>({u_matrix:new l.aI(_,s.u_matrix),u_texture:new l.aG(_,s.u_texture),u_terrain_coords_id:new l.aH(_,s.u_terrain_coords_id),u_ele_delta:new l.aH(_,s.u_ele_delta)})};class jo{constructor(s,d,m){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const yh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fa{constructor(s,d,m,g){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let m=0;m<this.attributes.length;m++){const g=d.attributes[this.attributes[m].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,d,m){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],P=d.attributes[b.name];P!==void 0&&s.vertexAttribPointer(P,b.components,s[yh[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ni=new WeakMap;function Ul(_){var s;if(Ni.has(_))return Ni.get(_);{const d=(s=_.getParameter(_.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Ni.set(_,d),d}}class ir{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class vh extends ir{getDefault(){return l.aO.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class Rf extends ir{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class If extends ir{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class _h extends ir{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Df extends ir{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class kf extends ir{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class xh extends ir{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class Im extends ir{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class Dm extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class Vl extends ir{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class Hv extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class Gv extends ir{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class jv extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class Wv extends ir{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class $v extends ir{getDefault(){return l.aO.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class qv extends ir{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class Lf extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class bh extends ir{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class zf extends ir{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class Ff extends ir{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Hl extends ir{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class km extends ir{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class Lm extends ir{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class Nf extends ir{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Wo extends ir{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class zm extends ir{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Gl extends ir{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class jl extends ir{getDefault(){return null}set(s){var d;if(s===this.current&&!this.dirty)return;const m=this.gl;Ul(m)?m.bindVertexArray(s):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class Fm extends ir{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Of extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ar extends ir{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Wl extends ir{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class Xv extends Wl{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class Nm extends Wl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class lu extends Wl{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Zv{constructor(s,d,m,g,b){this.context=s,this.width=d,this.height=m;const P=s.gl,R=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new Xv(s,R),g)this.depthAttachment=b?new lu(s,R):new Nm(s,R);else if(b)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class jr{constructor(s,d,m){this.blendFunction=s,this.blendColor=d,this.mask=m}}jr.Replace=[1,0],jr.disabled=new jr(jr.Replace,l.aO.transparent,[!1,!1,!1,!1]),jr.unblended=new jr(jr.Replace,l.aO.transparent,[!0,!0,!0,!0]),jr.alphaBlended=new jr([1,771],l.aO.transparent,[!0,!0,!0,!0]);class Om{constructor(s){var d,m;if(this.gl=s,this.clearColor=new vh(this),this.clearDepth=new Rf(this),this.clearStencil=new If(this),this.colorMask=new _h(this),this.depthMask=new Df(this),this.stencilMask=new kf(this),this.stencilFunc=new xh(this),this.stencilOp=new Im(this),this.stencilTest=new Dm(this),this.depthRange=new Vl(this),this.depthTest=new Hv(this),this.depthFunc=new Gv(this),this.blend=new jv(this),this.blendFunc=new Wv(this),this.blendColor=new $v(this),this.blendEquation=new qv(this),this.cullFace=new Lf(this),this.cullFaceSide=new bh(this),this.frontFace=new zf(this),this.program=new Ff(this),this.activeTexture=new Hl(this),this.viewport=new km(this),this.bindFramebuffer=new Lm(this),this.bindRenderbuffer=new Nf(this),this.bindTexture=new Wo(this),this.bindVertexBuffer=new zm(this),this.bindElementBuffer=new Gl(this),this.bindVertexArray=new jl(this),this.pixelStoreUnpack=new Fm(this),this.pixelStoreUnpackPremultiplyAlpha=new Of(this),this.pixelStoreUnpackFlipY=new ar(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Ul(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=s.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=s.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new jo(this,s,d)}createVertexBuffer(s,d,m){return new fa(this,s,d,m)}createRenderbuffer(s,d,m){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,s,d,m),this.bindRenderbuffer.set(null),b}createFramebuffer(s,d,m,g){return new Zv(this,s,d,m,g)}clear({color:s,depth:d,stencil:m}){const g=this.gl;let b=0;s&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),m!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){l.aD(s.blendFunction,jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Ul(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var d;return Ul(this.gl)?this.gl.deleteVertexArray(s):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class tr{constructor(s,d,m){this.func=s,this.mask=d,this.range=m}}tr.ReadOnly=!1,tr.ReadWrite=!0,tr.disabled=new tr(519,tr.ReadOnly,[0,1]);const cu=7680;class yr{constructor(s,d,m,g,b,P){this.test=s,this.ref=d,this.mask=m,this.fail=g,this.depthFail=b,this.pass=P}}yr.disabled=new yr({func:519,mask:0},0,0,cu,cu,cu);class pr{constructor(s,d,m){this.enable=s,this.mode=d,this.frontFace=m}}let $l;function wh(_,s,d,m,g,b,P){const R=_.context,L=R.gl,H=_.useProgram("collisionBox"),q=[];let Y=0,se=0;for(let Me=0;Me<m.length;Me++){const Oe=m[Me],Ke=s.getTile(Oe),Qe=Ke.getBucket(d);if(!Qe)continue;let ot=Oe.posMatrix;g[0]===0&&g[1]===0||(ot=_.translatePosMatrix(Oe.posMatrix,Ke,g,b));const bt=P?Qe.textCollisionBox:Qe.iconCollisionBox,vt=Qe.collisionCircleArray;if(vt.length>0){const xt=l.F(),Zt=ot;l.aP(xt,Qe.placementInvProjMatrix,_.transform.glCoordMatrix),l.aP(xt,xt,Qe.placementViewportMatrix),q.push({circleArray:vt,circleOffset:se,transform:Zt,invTransform:xt,coord:Oe}),Y+=vt.length/4,se=Y}bt&&H.draw(R,L.LINES,tr.disabled,yr.disabled,_.colorModeForRenderPass(),pr.disabled,Ov(ot,_.transform,Ke),_.style.map.terrain&&_.style.map.terrain.getTerrainData(Oe),d.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,_.transform.zoom,null,null,bt.collisionVertexBuffer)}if(!P||!q.length)return;const _e=_.useProgram("collisionCircle"),ve=new l.aQ;ve.resize(4*Y),ve._trim();let we=0;for(const Me of q)for(let Oe=0;Oe<Me.circleArray.length/4;Oe++){const Ke=4*Oe,Qe=Me.circleArray[Ke+0],ot=Me.circleArray[Ke+1],bt=Me.circleArray[Ke+2],vt=Me.circleArray[Ke+3];ve.emplace(we++,Qe,ot,bt,vt,0),ve.emplace(we++,Qe,ot,bt,vt,1),ve.emplace(we++,Qe,ot,bt,vt,2),ve.emplace(we++,Qe,ot,bt,vt,3)}(!$l||$l.length<2*Y)&&($l=function(Me){const Oe=2*Me,Ke=new l.aS;Ke.resize(Oe),Ke._trim();for(let Qe=0;Qe<Oe;Qe++){const ot=6*Qe;Ke.uint16[ot+0]=4*Qe+0,Ke.uint16[ot+1]=4*Qe+1,Ke.uint16[ot+2]=4*Qe+2,Ke.uint16[ot+3]=4*Qe+2,Ke.uint16[ot+4]=4*Qe+3,Ke.uint16[ot+5]=4*Qe+0}return Ke}(Y));const fe=R.createIndexBuffer($l,!0),ze=R.createVertexBuffer(ve,l.aR.members,!0);for(const Me of q){const Oe={u_matrix:Me.transform,u_inv_matrix:Me.invTransform,u_camera_to_center_distance:(qe=_.transform).cameraToCenterDistance,u_viewport_size:[qe.width,qe.height]};_e.draw(R,L.TRIANGLES,tr.disabled,yr.disabled,_.colorModeForRenderPass(),pr.disabled,Oe,_.style.map.terrain&&_.style.map.terrain.getTerrainData(Me.coord),d.id,ze,fe,l.$.simpleSegment(0,2*Me.circleOffset,Me.circleArray.length,Me.circleArray.length/2),null,_.transform.zoom,null,null,null)}var qe;ze.destroy(),fe.destroy()}pr.disabled=new pr(!1,1029,2305),pr.backCCW=new pr(!0,1029,2305);const Bm=l.an(new Float32Array(16));function Sh(_,s,d,m,g,b){const{horizontalAlign:P,verticalAlign:R}=l.at(_);return new l.P((-(P-.5)*s/g+m[0])*b,(-(R-.5)*d/g+m[1])*b)}function Mh(_,s,d,m,g,b,P,R,L,H,q){const Y=_.text.placedSymbolArray,se=_.text.dynamicLayoutVertexArray,_e=_.icon.dynamicLayoutVertexArray,ve={};se.clear();for(let we=0;we<Y.length;we++){const fe=Y.get(we),ze=fe.hidden||!fe.crossTileID||_.allowVerticalPlacement&&!fe.placedOrientation?null:m[fe.crossTileID];if(ze){const qe=new l.P(fe.anchorX,fe.anchorY),Me=ce(qe,d?P:b,q),Oe=O(g.cameraToCenterDistance,Me.signedDistanceFromCamera);let Ke=l.ai(_.textSizeData,L,fe)*Oe/l.ao;d&&(Ke*=_.tilePixelRatio/R);const{width:Qe,height:ot,anchor:bt,textOffset:vt,textBoxScale:xt}=ze,Zt=Sh(bt,Qe,ot,vt,xt,Ke),zn=d?ce(qe.add(Zt),b,q).point:Me.point.add(s?Zt.rotate(-g.angle):Zt),Ot=_.allowVerticalPlacement&&fe.placedOrientation===l.ah.vertical?Math.PI/2:0;for(let Tn=0;Tn<fe.numGlyphs;Tn++)l.aj(se,zn,Ot);H&&fe.associatedIconIndex>=0&&(ve[fe.associatedIconIndex]={shiftedAnchor:zn,angle:Ot})}else Ct(fe.numGlyphs,se)}if(H){_e.clear();const we=_.icon.placedSymbolArray;for(let fe=0;fe<we.length;fe++){const ze=we.get(fe);if(ze.hidden)Ct(ze.numGlyphs,_e);else{const qe=ve[fe];if(qe)for(let Me=0;Me<ze.numGlyphs;Me++)l.aj(_e,qe.shiftedAnchor,qe.angle);else Ct(ze.numGlyphs,_e)}}_.icon.dynamicLayoutVertexBuffer.updateData(_e)}_.text.dynamicLayoutVertexBuffer.updateData(se)}function Bf(_,s,d){return d.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function Um(_,s,d,m,g,b,P,R,L,H,q,Y){const se=_.context,_e=se.gl,ve=_.transform,we=R==="map",fe=L==="map",ze=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",qe=we&&!fe&&!ze,Me=!d.layout.get("symbol-sort-key").isConstant();let Oe=!1;const Ke=_.depthModeForSublayer(0,tr.ReadOnly),Qe=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),ot=[];for(const bt of m){const vt=s.getTile(bt),xt=vt.getBucket(d);if(!xt)continue;const Zt=g?xt.text:xt.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const zn=Zt.programConfigurations.get(d.id),Ot=g||xt.sdfIcons,Tn=g?xt.textSizeData:xt.iconSizeData,Nn=fe||ve.pitch!==0,Xn=_.useProgram(Bf(Ot,g,xt),zn),Rn=l.ag(Tn,ve.zoom),Vn=_.style.map.terrain&&_.style.map.terrain.getTerrainData(bt);let Hn,Ir,mr,Ki,Qr=[0,0],vr=null;if(g)Ir=vt.glyphAtlasTexture,mr=_e.LINEAR,Hn=vt.glyphAtlasTexture.size,xt.iconsInText&&(Qr=vt.imageAtlasTexture.size,vr=vt.imageAtlasTexture,Ki=Nn||_.options.rotating||_.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?_e.LINEAR:_e.NEAREST);else{const Ar=d.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Ir=vt.imageAtlasTexture,mr=Ot||_.options.rotating||_.options.zooming||Ar||Nn?_e.LINEAR:_e.NEAREST,Hn=vt.imageAtlasTexture.size}const Pi=wn(vt,1,_.transform.zoom),Ya=ft(bt.posMatrix,fe,we,_.transform,Pi),xs=kt(bt.posMatrix,fe,we,_.transform,Pi),Ko=Qe&&xt.hasTextData(),Jo=d.layout.get("icon-text-fit")!=="none"&&Ko&&xt.hasIconData();if(ze){const Ar=_.style.map.terrain?(ma,$n)=>_.style.map.terrain.getElevation(bt,ma,$n):null,yi=d.layout.get("text-rotation-alignment")==="map";$(xt,bt.posMatrix,_,g,Ya,xs,fe,H,yi,Ar)}const bs=_.translatePosMatrix(bt.posMatrix,vt,b,P),Ka=ze||g&&Qe||Jo?Bm:Ya,Fr=_.translatePosMatrix(xs,vt,b,P,!0),wr=Ot&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vr;Vr=Ot?xt.iconsInText?Bv(Tn.kind,Rn,qe,fe,_,bs,Ka,Fr,Hn,Qr):Bl(Tn.kind,Rn,qe,fe,_,bs,Ka,Fr,g,Hn,!0):ou(Tn.kind,Rn,qe,fe,_,bs,Ka,Fr,g,Hn);const rc={program:Xn,buffers:Zt,uniformValues:Vr,atlasTexture:Ir,atlasTextureIcon:vr,atlasInterpolation:mr,atlasInterpolationIcon:Ki,isSDF:Ot,hasHalo:wr};if(Me&&xt.canOverlap){Oe=!0;const Ar=Zt.segments.get();for(const yi of Ar)ot.push({segments:new l.$([yi]),sortKey:yi.sortKey,state:rc,terrainData:Vn})}else ot.push({segments:Zt.segments,sortKey:0,state:rc,terrainData:Vn})}Oe&&ot.sort((bt,vt)=>bt.sortKey-vt.sortKey);for(const bt of ot){const vt=bt.state;if(se.activeTexture.set(_e.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,_e.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(se.activeTexture.set(_e.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE)),vt.isSDF){const xt=vt.uniformValues;vt.hasHalo&&(xt.u_is_halo=1,Th(vt.buffers,bt.segments,d,_,vt.program,Ke,q,Y,xt,bt.terrainData)),xt.u_is_halo=0}Th(vt.buffers,bt.segments,d,_,vt.program,Ke,q,Y,vt.uniformValues,bt.terrainData)}}function Th(_,s,d,m,g,b,P,R,L,H){const q=m.context;g.draw(q,q.gl.TRIANGLES,b,P,R,pr.disabled,L,H,d.id,_.layoutVertexBuffer,_.indexBuffer,s,d.paint,m.transform.zoom,_.programConfigurations.get(d.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function Vm(_,s,d,m,g){if(!d||!m||!m.imageAtlas)return;const b=m.imageAtlas.patternPositions;let P=b[d.to.toString()],R=b[d.from.toString()];if(!P&&R&&(P=R),!R&&P&&(R=P),!P||!R){const L=g.getPaintProperty(s);P=b[L],R=b[L]}P&&R&&_.setConstantPatternPositions(P,R)}function Uf(_,s,d,m,g,b,P){const R=_.context.gl,L="fill-pattern",H=d.paint.get(L),q=H&&H.constantOr(1),Y=d.getCrossfadeParameters();let se,_e,ve,we,fe;P?(_e=q&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",se=R.LINES):(_e=q?"fillPattern":"fill",se=R.TRIANGLES);const ze=H.constantOr(null);for(const qe of m){const Me=s.getTile(qe);if(q&&!Me.patternsLoaded())continue;const Oe=Me.getBucket(d);if(!Oe)continue;const Ke=Oe.programConfigurations.get(d.id),Qe=_.useProgram(_e,Ke),ot=_.style.map.terrain&&_.style.map.terrain.getTerrainData(qe);q&&(_.context.activeTexture.set(R.TEXTURE0),Me.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ke.updatePaintBuffers(Y)),Vm(Ke,L,ze,Me,d);const bt=ot?qe:null,vt=_.translatePosMatrix(bt?bt.posMatrix:qe.posMatrix,Me,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){we=Oe.indexBuffer2,fe=Oe.segments2;const xt=[R.drawingBufferWidth,R.drawingBufferHeight];ve=_e==="fillOutlinePattern"&&q?Nv(vt,_,Y,Me,xt):Em(vt,xt)}else we=Oe.indexBuffer,fe=Oe.segments,ve=q?Tm(vt,_,Y,Me):dh(vt);Qe.draw(_.context,se,g,_.stencilModeForClipping(qe),b,pr.disabled,ve,ot,d.id,Oe.layoutVertexBuffer,we,fe,d.paint,_.transform.zoom,Ke)}}function ql(_,s,d,m,g,b,P){const R=_.context,L=R.gl,H="fill-extrusion-pattern",q=d.paint.get(H),Y=q.constantOr(1),se=d.getCrossfadeParameters(),_e=d.paint.get("fill-extrusion-opacity"),ve=q.constantOr(null);for(const we of m){const fe=s.getTile(we),ze=fe.getBucket(d);if(!ze)continue;const qe=_.style.map.terrain&&_.style.map.terrain.getTerrainData(we),Me=ze.programConfigurations.get(d.id),Oe=_.useProgram(Y?"fillExtrusionPattern":"fillExtrusion",Me);Y&&(_.context.activeTexture.set(L.TEXTURE0),fe.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),Me.updatePaintBuffers(se)),Vm(Me,H,ve,fe,d);const Ke=_.translatePosMatrix(we.posMatrix,fe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Qe=d.paint.get("fill-extrusion-vertical-gradient"),ot=Y?Fv(Ke,_,Qe,_e,we,se,fe):Mm(Ke,_,Qe,_e);Oe.draw(R,R.gl.TRIANGLES,g,b,P,pr.backCCW,ot,qe,d.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,d.paint,_.transform.zoom,Me,_.style.map.terrain&&ze.centroidVertexBuffer)}}function Vf(_,s,d,m,g,b,P){const R=_.context,L=R.gl,H=d.fbo;if(!H)return;const q=_.useProgram("hillshade"),Y=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,H.colorAttachment.get()),q.draw(R,L.TRIANGLES,g,b,P,pr.disabled,((se,_e,ve,we)=>{const fe=ve.paint.get("hillshade-shadow-color"),ze=ve.paint.get("hillshade-highlight-color"),qe=ve.paint.get("hillshade-accent-color");let Me=ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(Me-=se.transform.angle);const Oe=!se.options.moving;return{u_matrix:we?we.posMatrix:se.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),Oe),u_image:0,u_latrange:Pm(0,_e.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Me],u_shadow:fe,u_highlight:ze,u_accent:qe}})(_,d,m,Y?s:null),Y,m.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function Hm(_,s,d,m,g,b){const P=_.context,R=P.gl,L=s.dem;if(L&&L.data){const H=L.dim,q=L.stride,Y=L.getPixels();if(P.activeTexture.set(R.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture(q),s.demTexture){const _e=s.demTexture;_e.update(Y,{premultiply:!1}),_e.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else s.demTexture=new Fe(P,Y,R.RGBA,{premultiply:!1}),s.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);P.activeTexture.set(R.TEXTURE0);let se=s.fbo;if(!se){const _e=new Fe(P,{width:H,height:H,data:null},R.RGBA);_e.bind(R.LINEAR,R.CLAMP_TO_EDGE),se=s.fbo=P.createFramebuffer(H,H,!0,!1),se.colorAttachment.set(_e.texture)}P.bindFramebuffer.set(se.framebuffer),P.viewport.set([0,0,H,H]),_.useProgram("hillshadePrepare").draw(P,R.TRIANGLES,m,g,b,pr.disabled,((_e,ve)=>{const we=ve.stride,fe=l.F();return l.aN(fe,0,l.W,-l.W,0,0,1),l.H(fe,fe,[0,-l.W,0]),{u_matrix:fe,u_image:1,u_dimension:[we,we],u_zoom:_e.overscaledZ,u_unpack:ve.getUnpackVector()}})(s.tileID,L),null,d.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function Gm(_,s,d,m,g,b){const P=m.paint.get("raster-fade-duration");if(!b&&P>0){const R=M.now(),L=(R-_.timeAdded)/P,H=s?(R-s.timeAdded)/P:-1,q=d.getSource(),Y=g.coveringZoomLevel({tileSize:q.tileSize,roundZoom:q.roundZoom}),se=!s||Math.abs(s.tileID.overscaledZ-Y)>Math.abs(_.tileID.overscaledZ-Y),_e=se&&_.refreshedUponExpiration?1:l.ac(se?L:1-H,0,1);return _.refreshedUponExpiration&&L>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}const Eh=new l.aO(1,0,0,1),Hf=new l.aO(0,1,0,1),Yv=new l.aO(0,0,1,1),jm=new l.aO(1,0,1,1),Ur=new l.aO(0,1,1,1);function po(_,s,d,m){Xl(_,0,s+d/2,_.transform.width,d,m)}function pa(_,s,d,m){Xl(_,s-d/2,0,d,_.transform.height,m)}function Xl(_,s,d,m,g,b){const P=_.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*_.pixelRatio,d*_.pixelRatio,m*_.pixelRatio,g*_.pixelRatio),P.clear({color:b}),R.disable(R.SCISSOR_TEST)}function Gf(_,s,d){const m=_.context,g=m.gl,b=d.posMatrix,P=_.useProgram("debug"),R=tr.disabled,L=yr.disabled,H=_.colorModeForRenderPass(),q="$debug",Y=_.style.map.terrain&&_.style.map.terrain.getTerrainData(d);m.activeTexture.set(g.TEXTURE0);const se=s.getTileByID(d.key).latestRawTileData,_e=Math.floor((se&&se.byteLength||0)/1024),ve=s.getTile(d).tileSize,we=512/Math.min(ve,512)*(d.overscaledZ/_.transform.zoom)*.5;let fe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(fe+=` => ${d.overscaledZ}`),function(ze,qe){ze.initDebugOverlayCanvas();const Me=ze.debugOverlayCanvas,Oe=ze.context.gl,Ke=ze.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Me.width,Me.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(qe,5,5),Ke.strokeText(qe,5,5),ze.debugOverlayTexture.update(Me),ze.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)}(_,`${fe} ${_e}kB`),P.draw(m,g.TRIANGLES,R,L,jr.alphaBlended,pr.disabled,fh(b,l.aO.transparent,we),null,q,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),P.draw(m,g.LINE_STRIP,R,L,H,pr.disabled,fh(b,l.aO.red),Y,q,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function jf(_,s,d){const m=_.context,g=m.gl,b=_.colorModeForRenderPass(),P=new tr(g.LEQUAL,tr.ReadWrite,_.depthRangeFor3D),R=_.useProgram("terrain"),L=s.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,_.width,_.height]);for(const H of d){const q=_.renderToTexture.getTexture(H),Y=s.getTerrainData(H.tileID);m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,q.texture);const se={u_matrix:_.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(_.transform.zoom)};R.draw(m,g.TRIANGLES,P,yr.disabled,b,pr.backCCW,se,Y,"terrain",L.vertexBuffer,L.indexBuffer,L.segments)}}class Zl{constructor(s,d){this.context=new Om(s),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:l.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=dt.maxUnderzooming+dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xr}resize(s,d,m){if(this.width=Math.floor(s*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,d=new l.aV;d.emplaceBack(0,0),d.emplaceBack(l.W,0),d.emplaceBack(0,l.W),d.emplaceBack(l.W,l.W),this.tileExtentBuffer=s.createVertexBuffer(d,Lr.members),this.tileExtentSegments=l.$.simpleSegment(0,0,4,2);const m=new l.aV;m.emplaceBack(0,0),m.emplaceBack(l.W,0),m.emplaceBack(0,l.W),m.emplaceBack(l.W,l.W),this.debugBuffer=s.createVertexBuffer(m,Lr.members),this.debugSegments=l.$.simpleSegment(0,0,4,5);const g=new l.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(l.W,0,l.W,0),g.emplaceBack(0,l.W,0,l.W),g.emplaceBack(l.W,l.W,l.W,l.W),this.rasterBoundsBuffer=s.createVertexBuffer(g,mt.members),this.rasterBoundsSegments=l.$.simpleSegment(0,0,4,2);const b=new l.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,Lr.members),this.viewportSegments=l.$.simpleSegment(0,0,4,2);const P=new l.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(P);const R=new l.aX;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(R);const L=this.context.gl;this.stencilClearMode=new yr({func:L.ALWAYS,mask:0},0,255,L.ZERO,L.ZERO,L.ZERO)}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=l.F();l.aN(m,0,this.width,this.height,0,0,1),l.J(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,d.TRIANGLES,tr.disabled,this.stencilClearMode,jr.disabled,pr.disabled,Pf(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d){if(this.currentStencilSource===s.source||!s.isTileClipped()||!d||!d.length)return;this.currentStencilSource=s.source;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(jr.disabled),m.setDepthMode(tr.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const R=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,L=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);b.draw(m,g.TRIANGLES,tr.disabled,new yr({func:g.ALWAYS,mask:0},R,255,g.KEEP,g.KEEP,g.REPLACE),jr.disabled,pr.disabled,Pf(P.posMatrix),L,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new yr({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){const d=this.context.gl;return new yr({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(s){const d=this.context.gl,m=s.sort((P,R)=>R.overscaledZ-P.overscaledZ),g=m[m.length-1].overscaledZ,b=m[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const P={};for(let R=0;R<b;R++)P[R+g]=new yr({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[P,m]}return[{[g]:yr.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new jr([s.CONSTANT_COLOR,s.ONE],new l.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?jr.unblended:jr.alphaBlended}depthModeForSublayer(s,d,m){if(!this.opaquePassEnabledForLayer())return tr.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new tr(m||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(M.now()),this.imageManager.beginFrame();const m=this.style._order,g=this.style.sourceCaches,b={},P={},R={};for(const L in g){const H=g[L];H.used&&H.prepare(this.context),b[L]=H.getVisibleCoordinates(),P[L]=b[L].slice().reverse(),R[L]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let L=0;L<m.length;L++)if(this.style._layers[m[L]].is3D()){this.opaquePassCutoff=L;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const L of m){const H=this.style._layers[L];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const q=P[H.source];(H.type==="custom"||q.length)&&this.renderLayer(this,g[H.source],H,q)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?l.aO.black:l.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const L=this.style._layers[m[this.currentLayer]],H=g[L.source],q=b[L.source];this._renderTileClippingMasks(L,q),this.renderLayer(this,H,L,q)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const L=this.style._layers[m[this.currentLayer]],H=g[L.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(L))continue;const q=(L.type==="symbol"?R:P)[L.source];this._renderTileClippingMasks(L,b[L.source]),this.renderLayer(this,H,L,q)}if(this.options.showTileBoundaries){const L=function(H,q){let Y=null;const se=Object.values(H._layers).flatMap(fe=>fe.source&&!fe.isHidden(q)?[H.sourceCaches[fe.source]]:[]),_e=se.filter(fe=>fe.getSource().type==="vector"),ve=se.filter(fe=>fe.getSource().type!=="vector"),we=fe=>{(!Y||Y.getSource().maxzoom<fe.getSource().maxzoom)&&(Y=fe)};return _e.forEach(fe=>we(fe)),Y||ve.forEach(fe=>we(fe)),Y}(this.style,this.transform.zoom);L&&function(H,q,Y){for(let se=0;se<Y.length;se++)Gf(H,q,Y[se])}(this,L,L.getVisibleCoordinates())}this.options.showPadding&&function(L){const H=L.transform.padding;po(L,L.transform.height-(H.top||0),3,Eh),po(L,H.bottom||0,3,Hf),pa(L,H.left||0,3,Yv),pa(L,L.transform.width-(H.right||0),3,jm);const q=L.transform.centerPoint;(function(Y,se,_e,ve){Xl(Y,se-1,_e-10,2,20,ve),Xl(Y,se-10,_e-1,20,2,ve)})(L,q.x,L.transform.height-q.y,Ur)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=s?!l.aY(d,m):!l.aZ(d,m)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(l.a_(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,P){const R=b.context,L=R.gl,H=jr.unblended,q=new tr(L.LEQUAL,tr.ReadWrite,[0,1]),Y=P.getTerrainMesh(),se=P.sourceCache.getRenderableTiles(),_e=b.useProgram("terrainDepth");R.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:l.aO.transparent,depth:1});for(const ve of se){const we=P.getTerrainData(ve.tileID),fe={u_matrix:b.transform.calculatePosMatrix(ve.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(b.transform.zoom)};_e.draw(R,L.TRIANGLES,q,yr.disabled,H,pr.backCCW,fe,we,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,P){const R=b.context,L=R.gl,H=jr.unblended,q=new tr(L.LEQUAL,tr.ReadWrite,[0,1]),Y=P.getTerrainMesh(),se=P.getCoordsTexture(),_e=P.sourceCache.getRenderableTiles(),ve=b.useProgram("terrainCoords");R.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:l.aO.transparent,depth:1}),P.coordsIndex=[];for(const we of _e){const fe=P.getTerrainData(we.tileID);R.activeTexture.set(L.TEXTURE0),L.bindTexture(L.TEXTURE_2D,se.texture);const ze={u_matrix:b.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(b.transform.zoom)};ve.draw(R,L.TRIANGLES,q,yr.disabled,H,pr.backCCW,ze,fe,"terrain",Y.vertexBuffer,Y.indexBuffer,Y.segments),P.coordsIndex.push(we.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(s,d,m,g){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(g||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(b,P,R,L,H){if(b.renderPass!=="translucent")return;const q=yr.disabled,Y=b.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,_e,ve,we,fe,ze,qe){const Me=_e.transform,Oe=fe==="map",Ke=ze==="map";for(const Qe of se){const ot=we.getTile(Qe),bt=ot.getBucket(ve);if(!bt||!bt.text||!bt.text.segments.get().length)continue;const vt=l.ag(bt.textSizeData,Me.zoom),xt=wn(ot,1,_e.transform.zoom),Zt=ft(Qe.posMatrix,Ke,Oe,_e.transform,xt),zn=ve.layout.get("icon-text-fit")!=="none"&&bt.hasIconData();if(vt){const Ot=Math.pow(2,Me.zoom-ot.tileID.overscaledZ);Mh(bt,Oe,Ke,qe,Me,Zt,Qe.posMatrix,Ot,vt,zn,_e.style.map.terrain?(Tn,Nn)=>_e.style.map.terrain.getElevation(Qe,Tn,Nn):null)}}}(L,b,R,P,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),H),R.paint.get("icon-opacity").constantOr(1)!==0&&Um(b,P,R,L,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),q,Y),R.paint.get("text-opacity").constantOr(1)!==0&&Um(b,P,R,L,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),q,Y),P.map.showCollisionBoxes&&(wh(b,P,R,L,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),!0),wh(b,P,R,L,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),!1))})(s,d,m,g,this.style.placement.variableOffsets);break;case"circle":(function(b,P,R,L){if(b.renderPass!=="translucent")return;const H=R.paint.get("circle-opacity"),q=R.paint.get("circle-stroke-width"),Y=R.paint.get("circle-stroke-opacity"),se=!R.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&(q.constantOr(1)===0||Y.constantOr(1)===0))return;const _e=b.context,ve=_e.gl,we=b.depthModeForSublayer(0,tr.ReadOnly),fe=yr.disabled,ze=b.colorModeForRenderPass(),qe=[];for(let Me=0;Me<L.length;Me++){const Oe=L[Me],Ke=P.getTile(Oe),Qe=Ke.getBucket(R);if(!Qe)continue;const ot=Qe.programConfigurations.get(R.id),bt=b.useProgram("circle",ot),vt=Qe.layoutVertexBuffer,xt=Qe.indexBuffer,Zt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Oe),zn={programConfiguration:ot,program:bt,layoutVertexBuffer:vt,indexBuffer:xt,uniformValues:Am(b,Oe,Ke,R),terrainData:Zt};if(se){const Ot=Qe.segments.get();for(const Tn of Ot)qe.push({segments:new l.$([Tn]),sortKey:Tn.sortKey,state:zn})}else qe.push({segments:Qe.segments,sortKey:0,state:zn})}se&&qe.sort((Me,Oe)=>Me.sortKey-Oe.sortKey);for(const Me of qe){const{programConfiguration:Oe,program:Ke,layoutVertexBuffer:Qe,indexBuffer:ot,uniformValues:bt,terrainData:vt}=Me.state;Ke.draw(_e,ve.TRIANGLES,we,fe,ze,pr.disabled,bt,vt,R.id,Qe,ot,Me.segments,R.paint,b.transform.zoom,Oe)}})(s,d,m,g);break;case"heatmap":(function(b,P,R,L){if(R.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const H=b.context,q=H.gl,Y=yr.disabled,se=new jr([q.ONE,q.ONE],l.aO.transparent,[!0,!0,!0,!0]);(function(_e,ve,we){const fe=_e.gl;_e.activeTexture.set(fe.TEXTURE1),_e.viewport.set([0,0,ve.width/4,ve.height/4]);let ze=we.heatmapFbo;if(ze)fe.bindTexture(fe.TEXTURE_2D,ze.colorAttachment.get()),_e.bindFramebuffer.set(ze.framebuffer);else{const qe=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,qe),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),ze=we.heatmapFbo=_e.createFramebuffer(ve.width/4,ve.height/4,!1,!1),function(Me,Oe,Ke,Qe){var ot,bt;const vt=Me.gl,xt=(ot=Me.HALF_FLOAT)!==null&&ot!==void 0?ot:vt.UNSIGNED_BYTE,Zt=(bt=Me.RGBA16F)!==null&&bt!==void 0?bt:vt.RGBA;vt.texImage2D(vt.TEXTURE_2D,0,Zt,Oe.width/4,Oe.height/4,0,vt.RGBA,xt,null),Qe.colorAttachment.set(Ke)}(_e,ve,qe,ze)}})(H,b,R),H.clear({color:l.aO.transparent});for(let _e=0;_e<L.length;_e++){const ve=L[_e];if(P.hasRenderableParent(ve))continue;const we=P.getTile(ve),fe=we.getBucket(R);if(!fe)continue;const ze=fe.programConfigurations.get(R.id),qe=b.useProgram("heatmap",ze),{zoom:Me}=b.transform;qe.draw(H,q.TRIANGLES,tr.disabled,Y,se,pr.disabled,Cm(ve.posMatrix,we,Me,R.paint.get("heatmap-intensity")),null,R.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,R.paint,b.transform.zoom,ze)}H.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(H,q){const Y=H.context,se=Y.gl,_e=q.heatmapFbo;if(!_e)return;Y.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,_e.colorAttachment.get()),Y.activeTexture.set(se.TEXTURE1);let ve=q.colorRampTexture;ve||(ve=q.colorRampTexture=new Fe(Y,q.colorRamp,se.RGBA)),ve.bind(se.LINEAR,se.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(Y,se.TRIANGLES,tr.disabled,yr.disabled,H.colorModeForRenderPass(),pr.disabled,((we,fe,ze,qe)=>{const Me=l.F();l.aN(Me,0,we.width,we.height,0,0,1);const Oe=we.context.gl;return{u_matrix:Me,u_world:[Oe.drawingBufferWidth,Oe.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fe.paint.get("heatmap-opacity")}})(H,q),null,q.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,q.paint,H.transform.zoom)}(b,R))})(s,d,m,g);break;case"line":(function(b,P,R,L){if(b.renderPass!=="translucent")return;const H=R.paint.get("line-opacity"),q=R.paint.get("line-width");if(H.constantOr(1)===0||q.constantOr(1)===0)return;const Y=b.depthModeForSublayer(0,tr.ReadOnly),se=b.colorModeForRenderPass(),_e=R.paint.get("line-dasharray"),ve=R.paint.get("line-pattern"),we=ve.constantOr(1),fe=R.paint.get("line-gradient"),ze=R.getCrossfadeParameters(),qe=we?"linePattern":_e?"lineSDF":fe?"lineGradient":"line",Me=b.context,Oe=Me.gl;let Ke=!0;for(const Qe of L){const ot=P.getTile(Qe);if(we&&!ot.patternsLoaded())continue;const bt=ot.getBucket(R);if(!bt)continue;const vt=bt.programConfigurations.get(R.id),xt=b.context.program.get(),Zt=b.useProgram(qe,vt),zn=Ke||Zt.program!==xt,Ot=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Qe),Tn=ve.constantOr(null);if(Tn&&ot.imageAtlas){const Rn=ot.imageAtlas,Vn=Rn.patternPositions[Tn.to.toString()],Hn=Rn.patternPositions[Tn.from.toString()];Vn&&Hn&&vt.setConstantPatternPositions(Vn,Hn)}const Nn=Ot?Qe:null,Xn=we?mh(b,ot,R,ze,Nn):_e?ka(b,ot,R,_e,ze,Nn):fe?Go(b,ot,R,bt.lineClipsArray.length,Nn):ph(b,ot,R,Nn);if(we)Me.activeTexture.set(Oe.TEXTURE0),ot.imageAtlasTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE),vt.updatePaintBuffers(ze);else if(_e&&(zn||b.lineAtlas.dirty))Me.activeTexture.set(Oe.TEXTURE0),b.lineAtlas.bind(Me);else if(fe){const Rn=bt.gradients[R.id];let Vn=Rn.texture;if(R.gradientVersion!==Rn.version){let Hn=256;if(R.stepInterpolant){const Ir=P.getSource().maxzoom,mr=Qe.canonical.z===Ir?Math.ceil(1<<b.transform.maxZoom-Qe.canonical.z):1;Hn=l.ac(l.aT(bt.maxLineLength/l.W*1024*mr),256,Me.maxTextureSize)}Rn.gradient=l.aU({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:Hn,image:Rn.gradient||void 0,clips:bt.lineClipsArray}),Rn.texture?Rn.texture.update(Rn.gradient):Rn.texture=new Fe(Me,Rn.gradient,Oe.RGBA),Rn.version=R.gradientVersion,Vn=Rn.texture}Me.activeTexture.set(Oe.TEXTURE0),Vn.bind(R.stepInterpolant?Oe.NEAREST:Oe.LINEAR,Oe.CLAMP_TO_EDGE)}Zt.draw(Me,Oe.TRIANGLES,Y,b.stencilModeForClipping(Qe),se,pr.disabled,Xn,Ot,R.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,R.paint,b.transform.zoom,vt,bt.layoutVertexBuffer2),Ke=!1}})(s,d,m,g);break;case"fill":(function(b,P,R,L){const H=R.paint.get("fill-color"),q=R.paint.get("fill-opacity");if(q.constantOr(1)===0)return;const Y=b.colorModeForRenderPass(),se=R.paint.get("fill-pattern"),_e=b.opaquePassEnabledForLayer()&&!se.constantOr(1)&&H.constantOr(l.aO.transparent).a===1&&q.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===_e){const ve=b.depthModeForSublayer(1,b.renderPass==="opaque"?tr.ReadWrite:tr.ReadOnly);Uf(b,P,R,L,ve,Y,!1)}if(b.renderPass==="translucent"&&R.paint.get("fill-antialias")){const ve=b.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,tr.ReadOnly);Uf(b,P,R,L,ve,Y,!0)}})(s,d,m,g);break;case"fill-extrusion":(function(b,P,R,L){const H=R.paint.get("fill-extrusion-opacity");if(H!==0&&b.renderPass==="translucent"){const q=new tr(b.context.gl.LEQUAL,tr.ReadWrite,b.depthRangeFor3D);if(H!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))ql(b,P,R,L,q,yr.disabled,jr.disabled),ql(b,P,R,L,q,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const Y=b.colorModeForRenderPass();ql(b,P,R,L,q,yr.disabled,Y)}}})(s,d,m,g);break;case"hillshade":(function(b,P,R,L){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const H=b.context,q=b.depthModeForSublayer(0,tr.ReadOnly),Y=b.colorModeForRenderPass(),[se,_e]=b.renderPass==="translucent"?b.stencilConfigForOverlap(L):[{},L];for(const ve of _e){const we=P.getTile(ve);we.needsHillshadePrepare!==void 0&&we.needsHillshadePrepare&&b.renderPass==="offscreen"?Hm(b,we,R,q,yr.disabled,Y):b.renderPass==="translucent"&&Vf(b,ve,we,R,q,se[ve.overscaledZ],Y)}H.viewport.set([0,0,b.width,b.height])})(s,d,m,g);break;case"raster":(function(b,P,R,L){if(b.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!L.length)return;const H=b.context,q=H.gl,Y=P.getSource(),se=b.useProgram("raster"),_e=b.colorModeForRenderPass(),[ve,we]=Y instanceof St?[{},L]:b.stencilConfigForOverlap(L),fe=we[we.length-1].overscaledZ,ze=!b.options.moving;for(const qe of we){const Me=b.depthModeForSublayer(qe.overscaledZ-fe,R.paint.get("raster-opacity")===1?tr.ReadWrite:tr.ReadOnly,q.LESS),Oe=P.getTile(qe);Oe.registerFadeDuration(R.paint.get("raster-fade-duration"));const Ke=P.findLoadedParent(qe,0),Qe=Gm(Oe,Ke,P,R,b.transform,b.style.map.terrain);let ot,bt;const vt=R.paint.get("raster-resampling")==="nearest"?q.NEAREST:q.LINEAR;H.activeTexture.set(q.TEXTURE0),Oe.texture.bind(vt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),H.activeTexture.set(q.TEXTURE1),Ke?(Ke.texture.bind(vt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST),ot=Math.pow(2,Ke.tileID.overscaledZ-Oe.tileID.overscaledZ),bt=[Oe.tileID.canonical.x*ot%1,Oe.tileID.canonical.y*ot%1]):Oe.texture.bind(vt,q.CLAMP_TO_EDGE,q.LINEAR_MIPMAP_NEAREST);const xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(qe),Zt=xt?qe:null,zn=Zt?Zt.posMatrix:b.transform.calculatePosMatrix(qe.toUnwrapped(),ze),Ot=su(zn,bt||[0,0],ot||1,Qe,R);Y instanceof St?se.draw(H,q.TRIANGLES,Me,yr.disabled,_e,pr.disabled,Ot,xt,R.id,Y.boundsBuffer,b.quadTriangleIndexBuffer,Y.boundsSegments):se.draw(H,q.TRIANGLES,Me,ve[qe.overscaledZ],_e,pr.disabled,Ot,xt,R.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(s,d,m,g);break;case"background":(function(b,P,R,L){const H=R.paint.get("background-color"),q=R.paint.get("background-opacity");if(q===0)return;const Y=b.context,se=Y.gl,_e=b.transform,ve=_e.tileSize,we=R.paint.get("background-pattern");if(b.isPatternMissing(we))return;const fe=!we&&H.a===1&&q===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==fe)return;const ze=yr.disabled,qe=b.depthModeForSublayer(0,fe==="opaque"?tr.ReadWrite:tr.ReadOnly),Me=b.colorModeForRenderPass(),Oe=b.useProgram(we?"backgroundPattern":"background"),Ke=L||_e.coveringTiles({tileSize:ve,terrain:b.style.map.terrain});we&&(Y.activeTexture.set(se.TEXTURE0),b.imageManager.bind(b.context));const Qe=R.getCrossfadeParameters();for(const ot of Ke){const bt=L?ot.posMatrix:b.transform.calculatePosMatrix(ot.toUnwrapped()),vt=we?Rm(bt,q,b,we,{tileID:ot,tileSize:ve},Qe):Uv(bt,q,H),xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(ot);Oe.draw(Y,se.TRIANGLES,qe,ze,Me,pr.disabled,vt,xt,R.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(s,0,m,g);break;case"custom":(function(b,P,R){const L=b.context,H=R.implementation;if(b.renderPass==="offscreen"){const q=H.prerender;q&&(b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),q.call(H,L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),L.setColorMode(b.colorModeForRenderPass()),L.setStencilMode(yr.disabled);const q=H.renderingMode==="3d"?new tr(b.context.gl.LEQUAL,tr.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,tr.ReadOnly);L.setDepthMode(q),H.render(L.gl,b.transform.customLayerMatrix()),L.setDirty(),b.setBaseState(),L.bindFramebuffer.set(null)}})(s,0,m)}}translatePosMatrix(s,d,m,g,b){if(!m[0]&&!m[1])return s;const P=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(P){const H=Math.sin(P),q=Math.cos(P);m=[m[0]*q-m[1]*H,m[0]*H+m[1]*q]}const R=[b?m[0]:wn(d,m[0],this.transform.zoom),b?m[1]:wn(d,m[1],this.transform.zoom),0],L=new Float32Array(16);return l.H(L,s,R),L}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),m=this.imageManager.getPattern(s.to.toString());return!d||!m}useProgram(s,d){this.cache=this.cache||{};const m=s+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new Cf(this.context,fo[s],d,Vv[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:d}=this.context.gl;return this.width!==s||this.height!==d}}class $o{constructor(s,d){this.points=s,this.planes=d}static fromInvProjectionMatrix(s,d,m){const g=Math.pow(2,m),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const L=1/(R=l.af([],R,s))[3]/d*g;return l.a$(R,R,[L,L,1/R[3],L])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const L=function(se,_e){var ve=_e[0],we=_e[1],fe=_e[2],ze=ve*ve+we*we+fe*fe;return ze>0&&(ze=1/Math.sqrt(ze)),se[0]=_e[0]*ze,se[1]=_e[1]*ze,se[2]=_e[2]*ze,se}([],function(se,_e,ve){var we=_e[0],fe=_e[1],ze=_e[2],qe=ve[0],Me=ve[1],Oe=ve[2];return se[0]=fe*Oe-ze*Me,se[1]=ze*qe-we*Oe,se[2]=we*Me-fe*qe,se}([],ie([],b[R[0]],b[R[1]]),ie([],b[R[2]],b[R[1]]))),H=-((q=L)[0]*(Y=b[R[1]])[0]+q[1]*Y[1]+q[2]*Y[2]);var q,Y;return L.concat(H)});return new $o(b,P)}}class Yl{constructor(s,d){this.min=s,this.max=d,this.center=function(m,g,b){return m[0]=.5*g[0],m[1]=.5*g[1],m[2]=.5*g[2],m}([],function(m,g,b){return m[0]=g[0]+b[0],m[1]=g[1]+b[1],m[2]=g[2]+b[2],m}([],this.min,this.max))}quadrant(s){const d=[s%2==0,s<2],m=ee(this.min),g=ee(this.max);for(let b=0;b<d.length;b++)m[b]=d[b]?this.min[b]:this.center[b],g[b]=d[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new Yl(m,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let g=0;g<s.planes.length;g++){const b=s.planes[g];let P=0;for(let R=0;R<d.length;R++)l.b0(b,d[R])>=0&&P++;if(P===0)return 0;P!==d.length&&(m=!1)}if(m)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let R=0;R<s.points.length;R++){const L=s.points[R][g]-this.min[g];b=Math.min(b,L),P=Math.max(P,L)}if(P<0||b>this.max[g]-this.min[g])return 0}return 1}}class uu{constructor(s=0,d=0,m=0,g=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=m,this.right=g}interpolate(s,d,m){return d.top!=null&&s.top!=null&&(this.top=l.z.number(s.top,d.top,m)),d.bottom!=null&&s.bottom!=null&&(this.bottom=l.z.number(s.bottom,d.bottom,m)),d.left!=null&&s.left!=null&&(this.left=l.z.number(s.left,d.left,m)),d.right!=null&&s.right!=null&&(this.right=l.z.number(s.right,d.right,m)),this}getCenter(s,d){const m=l.ac((this.left+s-this.right)/2,0,s),g=l.ac((this.top+d-this.bottom)/2,0,d);return new l.P(m,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new uu(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Wf=85.051129;class Ah{constructor(s,d,m,g,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=s||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new l.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new uu,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new Ah(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new l.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const d=-l.b1(s,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new l.A(4);return l.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,g,b){var P=g[0],R=g[1],L=g[2],H=g[3],q=Math.sin(b),Y=Math.cos(b);m[0]=P*Y+L*q,m[1]=R*Y+H*q,m[2]=P*-q+L*Y,m[3]=R*-q+H*Y}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const d=l.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const d=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,m){this._unmodified=!1,this._edgeInsets.interpolate(s,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const d=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(s){const d=[new l.b2(0,s)];if(this._renderWorldCopies){const m=this.pointCoordinate(new l.P(0,0)),g=this.pointCoordinate(new l.P(this.width,0)),b=this.pointCoordinate(new l.P(this.width,this.height)),P=this.pointCoordinate(new l.P(0,this.height)),R=Math.floor(Math.min(m.x,g.x,b.x,P.x)),L=Math.floor(Math.max(m.x,g.x,b.x,P.x)),H=1;for(let q=R-H;q<=L+H;q++)q!==0&&d.push(new l.b2(q,s))}return d}coveringTiles(s){var d,m;let g=this.coveringZoomLevel(s);const b=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),R=l.Y.fromLngLat(this.center),L=Math.pow(2,g),H=[L*P.x,L*P.y,0],q=[L*R.x,L*R.y,0],Y=$o.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let se=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(se=g);const _e=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ve=Me=>({aabb:new Yl([Me*L,0,0],[(Me+1)*L,L,0]),zoom:0,x:0,y:0,wrap:Me,fullyVisible:!1}),we=[],fe=[],ze=g,qe=s.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let Me=1;Me<=3;Me++)we.push(ve(-Me)),we.push(ve(Me));for(we.push(ve(0));we.length>0;){const Me=we.pop(),Oe=Me.x,Ke=Me.y;let Qe=Me.fullyVisible;if(!Qe){const Zt=Me.aabb.intersects(Y);if(Zt===0)continue;Qe=Zt===2}const ot=s.terrain?H:q,bt=Me.aabb.distanceX(ot),vt=Me.aabb.distanceY(ot),xt=Math.max(Math.abs(bt),Math.abs(vt));if(Me.zoom===ze||xt>_e+(1<<ze-Me.zoom)-2&&Me.zoom>=se){const Zt=ze-Me.zoom,zn=H[0]-.5-(Oe<<Zt),Ot=H[1]-.5-(Ke<<Zt);fe.push({tileID:new l.Q(Me.zoom===ze?qe:Me.zoom,Me.wrap,Me.zoom,Oe,Ke),distanceSq:Q([q[0]-.5-Oe,q[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(zn*zn+Ot*Ot)})}else for(let Zt=0;Zt<4;Zt++){const zn=(Oe<<1)+Zt%2,Ot=(Ke<<1)+(Zt>>1),Tn=Me.zoom+1;let Nn=Me.aabb.quadrant(Zt);if(s.terrain){const Xn=new l.Q(Tn,Me.wrap,Tn,zn,Ot),Rn=s.terrain.getMinMaxElevation(Xn),Vn=(d=Rn.minElevation)!==null&&d!==void 0?d:this.elevation,Hn=(m=Rn.maxElevation)!==null&&m!==void 0?m:this.elevation;Nn=new Yl([Nn.min[0],Nn.min[1],Vn],[Nn.max[0],Nn.max[1],Hn])}we.push({aabb:Nn,zoom:Tn,x:zn,y:Ot,wrap:Me.wrap,fullyVisible:Qe})}}return fe.sort((Me,Oe)=>Me.distanceSq-Oe.distanceSq).map(Me=>Me.tileID)}resize(s,d){this.width=s,this.height=d,this.pixelsToGLUnits=[2/s,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const d=l.ac(s.lat,-85.051129,Wf);return new l.P(l.N(s.lng)*this.worldSize,l.O(d)*this.worldSize)}unproject(s){return new l.Y(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,s),b=s.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-b))return;const P=m+d-b,R=Math.cos(this._pitch)*this.cameraToCenterDistance/P/l.b3(1,g.lat),L=this.scaleZoom(R/this.tileSize);this._elevation=b,this._center=g,this.zoom=L}setLocationAtPoint(s,d){const m=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(s),P=new l.Y(b.x-(m.x-g.x),b.y-(m.y-g.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,d){return d?this.coordinatePoint(this.locationCoordinate(s),d.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,d){return this.coordinateLocation(this.pointCoordinate(s,d))}locationCoordinate(s){return l.Y.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,d){if(d){const se=d.pointCoordinate(s);if(se!=null)return se}const m=[s.x,s.y,0,1],g=[s.x,s.y,1,1];l.af(m,m,this.pixelMatrixInverse),l.af(g,g,this.pixelMatrixInverse);const b=m[3],P=g[3],R=m[1]/b,L=g[1]/P,H=m[2]/b,q=g[2]/P,Y=H===q?0:(0-H)/(q-H);return new l.Y(l.z.number(m[0]/b,g[0]/P,Y)/this.worldSize,l.z.number(R,L,Y)/this.worldSize)}coordinatePoint(s,d=0,m=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,d,1];return l.af(g,g,m),new l.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Yt().extend(this.pointLocation(new l.P(0,s))).extend(this.pointLocation(new l.P(this.width,s))).extend(this.pointLocation(new l.P(this.width,this.height))).extend(this.pointLocation(new l.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Yt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Wf])}calculatePosMatrix(s,d=!1){const m=s.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[m])return g[m];const b=s.canonical,P=this.worldSize/this.zoomScale(b.z),R=b.x+Math.pow(2,b.z)*s.wrap,L=l.an(new Float64Array(16));return l.H(L,L,[R*P,b.y*P,0]),l.J(L,L,[P/l.W,P/l.W,1]),l.K(L,d?this.alignedProjMatrix:this.projMatrix,L),g[m]=new Float32Array(L),g[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,d){d=l.ac(+d,this.minZoom,this.maxZoom);const m={center:new l.M(s.lng,s.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const Me=179.9999999999;g=[-Me,Me]}const b=this.tileSize*this.zoomScale(m.zoom);let P=0,R=b,L=0,H=b,q=0,Y=0;const{x:se,y:_e}=this.size;if(this.latRange){const Me=this.latRange;P=l.O(Me[1])*b,R=l.O(Me[0])*b,R-P<_e&&(q=_e/(R-P))}g&&(L=l.b1(l.N(g[0])*b,0,b),H=l.b1(l.N(g[1])*b,0,b),H<L&&(H+=b),H-L<se&&(Y=se/(H-L)));const{x:ve,y:we}=this.project.call({worldSize:b},s);let fe,ze;const qe=Math.max(Y||0,q||0);if(qe){const Me=new l.P(Y?(H+L)/2:ve,q?(R+P)/2:we);return m.center=this.unproject.call({worldSize:b},Me).wrap(),m.zoom+=this.scaleZoom(qe),m}if(this.latRange){const Me=_e/2;we-Me<P&&(ze=P+Me),we+Me>R&&(ze=R-Me)}if(g){const Me=(L+H)/2;let Oe=ve;this._renderWorldCopies&&(Oe=l.b1(ve,Me-b/2,Me+b/2));const Ke=se/2;Oe-Ke<L&&(fe=L+Ke),Oe+Ke>H&&(fe=H-Ke)}if(fe!==void 0||ze!==void 0){const Me=new l.P(fe??ve,ze??we);m.center=this.unproject.call({worldSize:b},Me).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=l.b3(1,this.center.lat)*this.worldSize;let g=l.an(new Float64Array(16));l.J(g,g,[this.width/2,-this.height/2,1]),l.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=l.an(new Float64Array(16)),l.J(g,g,[1,-1,1]),l.H(g,g,[-1,-1,0]),l.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),R=b-P*this._pixelPerMeter/Math.cos(this._pitch),L=P<0?R:b,H=Math.PI/2+this._pitch,q=this._fov*(.5+s.y/this.height),Y=Math.sin(q)*L/Math.sin(l.ac(Math.PI-H-q,.01,Math.PI-.01)),se=this.getHorizon(),_e=2*Math.atan(se/this.cameraToCenterDistance)*(.5+s.y/(2*se)),ve=Math.sin(_e)*L/Math.sin(l.ac(Math.PI-H-_e,.01,Math.PI-.01)),we=Math.min(Y,ve),fe=1.01*(Math.cos(Math.PI/2-this._pitch)*we+L),ze=this.height/50;g=new Float64Array(16),l.b4(g,this._fov,this.width/this.height,ze,fe),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,l.J(g,g,[1,-1,1]),l.H(g,g,[0,0,-this.cameraToCenterDistance]),l.b5(g,g,this._pitch),l.ad(g,g,this.angle),l.H(g,g,[-d,-m,0]),this.mercatorMatrix=l.J([],g,[this.worldSize,this.worldSize,this.worldSize]),l.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=l.K(new Float64Array(16),this.labelPlaneMatrix,g),l.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=l.ar([],g),this.pixelMatrix3D=l.K(new Float64Array(16),this.labelPlaneMatrix,g);const qe=this.width%2/2,Me=this.height%2/2,Oe=Math.cos(this.angle),Ke=Math.sin(this.angle),Qe=d-Math.round(d)+Oe*qe+Ke*Me,ot=m-Math.round(m)+Oe*Me+Ke*qe,bt=new Float64Array(g);if(l.H(bt,bt,[Qe>.5?Qe-1:Qe,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=bt,g=l.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new l.P(0,0)),d=[s.x*this.worldSize,s.y*this.worldSize,0,1];return l.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new l.P(0,s))}getCameraQueryGeometry(s){const d=this.getCameraPoint();if(s.length===1)return[s[0],d];{let m=d.x,g=d.y,b=d.x,P=d.y;for(const R of s)m=Math.min(m,R.x),g=Math.min(g,R.y),b=Math.max(b,R.x),P=Math.max(P,R.y);return[new l.P(m,g),new l.P(b,g),new l.P(b,P),new l.P(m,P),new l.P(m,g)]}}lngLatToCameraDepth(s,d){const m=this.locationCoordinate(s),g=[m.x*this.worldSize,m.y*this.worldSize,d,1];return l.af(g,g,this.projMatrix),g[2]/g[3]}}function $f(_,s){let d,m=!1,g=null,b=null;const P=()=>{g=null,m&&(_.apply(b,d),g=setTimeout(P,s),m=!1)};return(...R)=>(m=!0,b=this,d=R,g||P(),g)}class qf{constructor(s){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=$f(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),P=Math.round(d.lng*b)/b,R=Math.round(d.lat*b)/b,L=this._map.getBearing(),H=this._map.getPitch();let q="";if(q+=s?`/${P}/${R}/${m}`:`${m}/${R}/${P}`,(L||H)&&(q+="/"+Math.round(10*L)/10),H&&(q+=`/${Math.round(H)}`),this._hashName){const Y=this._hashName;let se=!1;const _e=window.location.hash.slice(1).split("&").map(ve=>{const we=ve.split("=")[0];return we===Y?(se=!0,`${we}=${q}`):ve}).filter(ve=>ve);return se||_e.push(`${Y}=${q}`),`#${_e.join("&")}`}return`#${q}`}}const vs={linearity:.3,easing:l.b6(0,0,.3,1)},Wm=l.e({deceleration:2500,maxSpeed:1400},vs),$m=l.e({deceleration:20,maxSpeed:1400},vs),qm=l.e({deceleration:1e3,maxSpeed:360},vs),Xm=l.e({deceleration:1e3,maxSpeed:90},vs);class Zm{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=M.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new l.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const b=du(d.pan.mag(),m,l.e({},Wm,s||{}));g.offset=d.pan.mult(b.amount/d.pan.mag()),g.center=this._map.transform.center,hu(g,b)}if(d.zoom){const b=du(d.zoom,m,$m);g.zoom=this._map.transform.zoom+b.amount,hu(g,b)}if(d.bearing){const b=du(d.bearing,m,qm);g.bearing=this._map.transform.bearing+l.ac(b.amount,-179,179),hu(g,b)}if(d.pitch){const b=du(d.pitch,m,Xm);g.pitch=this._map.transform.pitch+b.amount,hu(g,b)}if(g.zoom||g.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),l.e(g,{noMoveStart:!0})}}function hu(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function du(_,s,d){const{maxSpeed:m,linearity:g,deceleration:b}=d,P=l.ac(_*g/(s/1e3),-m,m),R=Math.abs(P)/(b*g);return{easing:d.easing,duration:1e3*R,amount:P*(R/2)}}class gi extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m,g={}){const b=w.mousePos(d.getCanvas(),m),P=d.unproject(b);super(s,l.e({point:b,lngLat:P,originalEvent:m},g)),this._defaultPrevented=!1,this.target=d}}class Kl extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m){const g=s==="touchend"?m.changedTouches:m.touches,b=w.touchPos(d.getCanvasContainer(),g),P=b.map(L=>d.unproject(L)),R=b.reduce((L,H,q,Y)=>L.add(H.div(Y.length)),new l.P(0,0));super(s,{points:b,point:R,lngLats:P,lngLat:d.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class La extends l.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class _s{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new La(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new gi(s.type,this._map,s))}mouseup(s){this._map.fire(new gi(s.type,this._map,s))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new gi(s.type,this._map,s))}dblclick(s){return this._firePreventable(new gi(s.type,this._map,s))}mouseover(s){this._map.fire(new gi(s.type,this._map,s))}mouseout(s){this._map.fire(new gi(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Kl(s.type,this._map,s))}touchmove(s){this._map.fire(new Kl(s.type,this._map,s))}touchend(s){this._map.fire(new Kl(s.type,this._map,s))}touchcancel(s){this._map.fire(new Kl(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ym{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new gi(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gi("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new gi(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Zi{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(l.P.convert(s),this._map.terrain)}}class Jl{constructor(s,d){this._map=s,this._tr=new Zi(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&s.button===0&&(w.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(g.x,m.x),P=Math.max(g.x,m.x),R=Math.min(g.y,m.y),L=Math.max(g.y,m.y);w.setTransform(this._box,`translate(${b}px,${R}px)`),this._box.style.width=P-b+"px",this._box.style.height=L-R+"px"}mouseupWindow(s,d){if(!this._active||s.button!==0)return;const m=this._startPos,g=d;if(this.reset(),w.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new l.k("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new l.k(s,{originalEvent:d}))}}function Xf(_,s){if(_.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${s.length}`);const d={};for(let m=0;m<_.length;m++)d[_[m].identifier]=s[m];return d}class Kv{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const b=new l.P(0,0);for(const P of g)b._add(P);return b.div(g.length)}(d),this.touches=Xf(m,d)))}touchmove(s,d,m){if(this.aborted||!this.centroid)return;const g=Xf(m,d);for(const b in this.touches){const P=g[b];(!P||P.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,d,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Zf{constructor(s){this.singleTap=new Kv(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,m){this.singleTap.touchstart(s,d,m)}touchmove(s,d,m){this.singleTap.touchmove(s,d,m)}touchend(s,d,m){const g=this.singleTap.touchend(s,d,m);if(g){const b=s.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(g)<30;if(b&&P||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Km{constructor(s){this._tr=new Zi(s),this._zoomIn=new Zf({numTouches:1,numTaps:2}),this._zoomOut=new Zf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,m){this._zoomIn.touchstart(s,d,m),this._zoomOut.touchstart(s,d,m)}touchmove(s,d,m){this._zoomIn.touchmove(s,d,m),this._zoomOut.touchmove(s,d,m)}touchend(s,d,m){const g=this._zoomIn.touchend(s,d,m),b=this._zoomOut.touchend(s,d,m),P=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(g)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Us{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const d=this._moveFunction(...s);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(s,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=d.length?d[0]:d;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&w.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const mo={0:1,2:2};class en{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const d=w.mouseButton(s);this._eventButton=d}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(d,m){const g=mo[m];return d.buttons===void 0||(d.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return w.mouseButton(s)===this._eventButton}}class Yf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const qo=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(s){s.preventDefault()}},Ql=({enable:_,clickTolerance:s,bearingDegreesPerPixelMoved:d=.8})=>{const m=new en({checkCorrectEvent:g=>w.mouseButton(g)===0&&g.ctrlKey||w.mouseButton(g)===2});return new Us({clickTolerance:s,move:(g,b)=>({bearingDelta:(b.x-g.x)*d}),moveStateManager:m,enable:_,assignEvents:qo})},Kf=({enable:_,clickTolerance:s,pitchDegreesPerPixelMoved:d=-.5})=>{const m=new en({checkCorrectEvent:g=>w.mouseButton(g)===0&&g.ctrlKey||w.mouseButton(g)===2});return new Us({clickTolerance:s,move:(g,b)=>({pitchDelta:(b.y-g.y)*d}),moveStateManager:m,enable:_,assignEvents:qo})};class $t{constructor(s,d){this._clickTolerance=s.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new l.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,d,m){return this._calculateTransform(s,d,m)}touchmove(s,d,m){if(this._active&&!(m.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,d,m)}touchend(s,d,m){this._calculateTransform(s,d,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,m){m.length>0&&(this._active=!0);const g=Xf(m,d),b=new l.P(0,0),P=new l.P(0,0);let R=0;for(const H in g){const q=g[H],Y=this._touches[H];Y&&(b._add(q),P._add(q.sub(Y)),R++,g[H]=q)}if(this._touches=g,R<this.minTouchs()||!P.mag())return;const L=P.div(R);return this._sum._add(L),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(R),panDelta:L}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,m){if(!this._firstTwoTouches)return;s.preventDefault();const[g,b]=this._firstTwoTouches,P=Ch(m,d,g),R=Ch(m,d,b);if(!P||!R)return;const L=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],L,s)}touchend(s,d,m){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,P=Ch(m,d,g),R=Ch(m,d,b);P&&R||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Ch(_,s,d){for(let m=0;m<_.length;m++)if(_[m].identifier===d)return s[m]}function Jm(_,s){return Math.log(_/s)/Math.LN2}class Ph extends fu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Jm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jm(this._distance,m),pinchAround:d}}}function Jf(_,s){return 180*_.angleWith(s)/Math.PI}class Qf extends fu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d,m){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Jf(this._vector,g),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,m=Jf(s,this._startVector);return Math.abs(m)<d}}function e0(_){return Math.abs(_.y)>Math.abs(_.x)}class Qm extends fu{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,d,m){super.touchstart(s,d,m),this._currentTouchCount=m.length}_start(s){this._lastPoints=s,e0(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),b=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,m.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(s,d,m){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,b=d.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=s.y>0==d.y>0;return e0(s)&&e0(d)&&P}}const Xo={panStep:100,bearingStep:15,pitchStep:10};class br{constructor(s){this._tr=new Zi(s);const d=Xo;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,m=0,g=0,b=0,P=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),P=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:R=>{const L=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:Rh,zoom:d?Math.round(L.zoom)+d*(s.shiftKey?2:1):L.zoom,bearing:L.bearing+m*this._bearingStep,pitch:L.pitch+g*this._pitchStep,offset:[-b*this._panStep,-P*this._panStep],center:L.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Rh(_){return _*(2-_)}const Ih=4.000244140625;class t0{constructor(s,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=s,this._tr=new Zi(s),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!s[this._map.cooperativeGestures._bypassKey])return;let d=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=M.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%Ih==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=w.mousePos(this._map.getCanvas(),s),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?l.M.convert(this._aroundCenter?m.center:m.unproject(d)):l.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>Ih?this._wheelZoomRate:this._defaultZoomRate;let L=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&L!==0&&(L=1/L);const H=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(H*L))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,m=this._startZoom,g=this._easing;let b,P=!1;if(this._type==="wheel"&&m&&g){const R=Math.min((M.now()-this._lastWheelEventTime)/200,1),L=g(R);b=l.z.number(m,d,L),R<1?this._frameId||(this._frameId=!0):P=!0}else b=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=l.b7;if(this._prevEase){const m=this._prevEase,g=(M.now()-m.start)/m.duration,b=m.easing(g+.01)-m.easing(g),P=.27/Math.sqrt(b*b+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=l.b6(P,R,.25,1)}return this._prevEase={start:M.now(),duration:s,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class n0{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class eg{constructor(s){this._tr=new Zi(s),this.reset()}reset(){this._active=!1}dblclick(s,d){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jv{constructor(){this._tap=new Zf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,d,m){if(!this._swipePoint)if(this._tapTime){const g=d[0],b=s.timeStamp-this._tapTime<500,P=this._tapPoint.dist(g)<30;b&&P?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(s,d,m)}touchmove(s,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=d[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,d,m)}touchend(s,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(s,d,m);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Xa{constructor(s,d,m){this._el=s,this._mousePan=d,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class pu{constructor(s,d,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pn{constructor(s,d,m,g){this._el=s,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mn{constructor(s,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=w.create("div","maplibregl-cooperative-gesture-screen",s);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=m,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(w.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Zo=_=>_.zoom||_.drag||_.pitch||_.rotate;class r0 extends l.k{}function mu(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Yi{constructor(s,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=g.type==="renderFrame"?void 0:g,R={needsRenderFrame:!1},L={},H={},q=g.touches,Y=q?this._getMapTouches(q):void 0,se=Y?w.touchPos(this._map.getCanvas(),Y):w.mousePos(this._map.getCanvas(),g);for(const{handlerName:we,handler:fe,allowed:ze}of this._handlers){if(!fe.isEnabled())continue;let qe;this._blockedByActive(H,ze,we)?fe.reset():fe[b||g.type]&&(qe=fe[b||g.type](g,se,Y),this.mergeHandlerResult(R,L,qe,we,P),qe&&qe.needsRenderFrame&&this._triggerRenderFrame()),(qe||fe.isActive())&&(H[we]=fe)}const _e={};for(const we in this._previousActiveHandlers)H[we]||(_e[we]=P);this._previousActiveHandlers=H,(Object.keys(_e).length||mu(R))&&(this._changes.push([R,L,_e]),this._triggerRenderFrame()),(Object.keys(H).length||mu(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ve}=R;ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zm(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,P]of this._listeners)w.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[s,d,m]of this._listeners)w.removeEventListener(s,d,s===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new _s(d,s));const g=d.boxZoom=new Jl(d,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const b=d.cooperativeGestures=new Mn(d,s.cooperativeGestures);this._add("cooperativeGestures",b),s.cooperativeGestures&&b.enable();const P=new Km(d),R=new eg(d);d.doubleClickZoom=new n0(R,P),this._add("tapZoom",P),this._add("clickZoom",R),s.interactive&&s.doubleClickZoom&&d.doubleClickZoom.enable();const L=new Jv;this._add("tapDragZoom",L);const H=d.touchPitch=new Qm(d);this._add("touchPitch",H),s.interactive&&s.touchPitch&&d.touchPitch.enable(s.touchPitch);const q=Ql(s),Y=Kf(s);d.dragRotate=new pu(s,q,Y),this._add("mouseRotate",q,["mousePitch"]),this._add("mousePitch",Y,["mouseRotate"]),s.interactive&&s.dragRotate&&d.dragRotate.enable();const se=(({enable:qe,clickTolerance:Me})=>{const Oe=new en({checkCorrectEvent:Ke=>w.mouseButton(Ke)===0&&!Ke.ctrlKey});return new Us({clickTolerance:Me,move:(Ke,Qe)=>({around:Qe,panDelta:Qe.sub(Ke)}),activateOnStart:!0,moveStateManager:Oe,enable:qe,assignEvents:qo})})(s),_e=new $t(s,d);d.dragPan=new Xa(m,se,_e),this._add("mousePan",se),this._add("touchPan",_e,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&d.dragPan.enable(s.dragPan);const ve=new Qf,we=new Ph;d.touchZoomRotate=new pn(m,we,ve,L),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&d.touchZoomRotate.enable(s.touchZoomRotate);const fe=d.scrollZoom=new t0(d,()=>this._triggerRenderFrame());this._add("scrollZoom",fe,["mousePan"]),s.interactive&&s.scrollZoom&&d.scrollZoom.enable(s.scrollZoom);const ze=d.keyboard=new br(d);this._add("keyboard",ze),s.interactive&&s.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Ym(d))}_add(s,d,m){this._handlers.push({handlerName:s,handler:d,allowed:m}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Zo(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,d,m){for(const g in s)if(g!==m&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const d=[];for(const m of s)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(s,d,m,g,b){if(!m)return;l.e(s,m);const P={handlerName:g,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(d.zoom=P),m.panDelta!==void 0&&(d.drag=P),m.pitchDelta!==void 0&&(d.pitch=P),m.bearingDelta!==void 0&&(d.rotate=P)}_applyChanges(){const s={},d={},m={};for(const[g,b,P]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new l.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),l.e(d,b),l.e(m,P);this._updateMapTransform(s,d,m),this._changes=[]}_updateMapTransform(s,d,m){const g=this._map,b=g._getTransformForUpdate(),P=g.terrain;if(!(mu(s)||P&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:R,zoomDelta:L,bearingDelta:H,pitchDelta:q,around:Y,pinchAround:se}=s;se!==void 0&&(Y=se),g._stop(!0),Y=Y||g.transform.centerPoint;const _e=b.pointLocation(R?Y.sub(R):Y);H&&(b.bearing+=H),q&&(b.pitch+=q),L&&(b.zoom+=L),P?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(R)):b.setLocationAtPoint(_e,Y):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(_e,Y),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(_e,Y),g._applyUpdatedTransform(b),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,m,!0)}_fireEvents(s,d,m){const g=Zo(this._eventsInProgress),b=Zo(s),P={};for(const q in s){const{originalEvent:Y}=s[q];this._eventsInProgress[q]||(P[`${q}start`]=Y),this._eventsInProgress[q]=s[q]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const q in P)this._fireEvent(q,P[q]);b&&this._fireEvent("move",b.originalEvent);for(const q in s){const{originalEvent:Y}=s[q];this._fireEvent(q,Y)}const R={};let L;for(const q in this._eventsInProgress){const{handlerName:Y,originalEvent:se}=this._eventsInProgress[q];this._handlersById[Y].isActive()||(delete this._eventsInProgress[q],L=d[Y]||se,R[`${q}end`]=L)}for(const q in R)this._fireEvent(q,R[q]);const H=Zo(this._eventsInProgress);if(m&&(g||b)&&!H){this._updatingCamera=!0;const q=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Y=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!q||!q.essential&&M.prefersReducedMotion?(this._map.fire(new l.k("moveend",{originalEvent:L})),Y(this._map.getBearing())&&this._map.resetNorth()):(Y(q.bearing||this._map.getBearing())&&(q.bearing=0),q.freezeElevation=!0,this._map.easeTo(q,{originalEvent:L})),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new l.k(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new r0("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class tg extends l.E{constructor(s,d){super(),this._renderFrameCallback=()=>{const m=Math.min((M.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new l.M(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}panBy(s,d,m){return s=l.P.convert(s).mult(-1),this.panTo(this.transform.center,l.e({offset:s},d),m)}panTo(s,d,m){return this.easeTo(l.e({center:s},d),m)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,m){return this.easeTo(l.e({zoom:s},d),m)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,m){return this.easeTo(l.e({bearing:s},d),m)}resetNorth(s,d){return this.rotateTo(0,l.e({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(l.e({bearing:0,pitch:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}cameraForBounds(s,d){s=Yt.convert(s);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),m,d)}_cameraForBoxAndBearing(s,d,m,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=l.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Zt=g.padding;g.padding={top:Zt,bottom:Zt,right:Zt,left:Zt}}g.padding=l.e(b,g.padding);const P=this.transform,R=P.padding,L=new Yt(s,d),H=P.project(L.getNorthWest()),q=P.project(L.getNorthEast()),Y=P.project(L.getSouthEast()),se=P.project(L.getSouthWest()),_e=l.b8(-m),ve=H.rotate(_e),we=q.rotate(_e),fe=Y.rotate(_e),ze=se.rotate(_e),qe=new l.P(Math.max(ve.x,we.x,ze.x,fe.x),Math.max(ve.y,we.y,ze.y,fe.y)),Me=new l.P(Math.min(ve.x,we.x,ze.x,fe.x),Math.min(ve.y,we.y,ze.y,fe.y)),Oe=qe.sub(Me),Ke=(P.width-(R.left+R.right+g.padding.left+g.padding.right))/Oe.x,Qe=(P.height-(R.top+R.bottom+g.padding.top+g.padding.bottom))/Oe.y;if(Qe<0||Ke<0)return void l.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ot=Math.min(P.scaleZoom(P.scale*Math.min(Ke,Qe)),g.maxZoom),bt=l.P.convert(g.offset),vt=new l.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(l.b8(m)),xt=bt.add(vt).mult(P.scale/P.zoomScale(ot));return{center:P.unproject(H.add(Y).div(2).sub(xt)),zoom:ot,bearing:m}}fitBounds(s,d,m){return this._fitInternal(this.cameraForBounds(s,d),d,m)}fitScreenCoordinates(s,d,m,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(l.P.convert(s)),this.transform.pointLocation(l.P.convert(d)),m,g),g,b)}_fitInternal(s,d,m){return s?(delete(d=l.e(s,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(s,d){this.stop();const m=this._getTransformForUpdate();let g=!1,b=!1,P=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(g=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=l.M.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(b=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(P=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),this._applyUpdatedTransform(m),this.fire(new l.k("movestart",d)).fire(new l.k("move",d)),g&&this.fire(new l.k("zoomstart",d)).fire(new l.k("zoom",d)).fire(new l.k("zoomend",d)),b&&this.fire(new l.k("rotatestart",d)).fire(new l.k("rotate",d)).fire(new l.k("rotateend",d)),P&&this.fire(new l.k("pitchstart",d)).fire(new l.k("pitch",d)).fire(new l.k("pitchend",d)),this.fire(new l.k("moveend",d))}calculateCameraOptionsFromTo(s,d,m,g=0){const b=l.Y.fromLngLat(s,d),P=l.Y.fromLngLat(m,g),R=P.x-b.x,L=P.y-b.y,H=P.z-b.z,q=Math.hypot(R,L,H);if(q===0)throw new Error("Can't calculate camera options with same From and To");const Y=Math.hypot(R,L),se=this.transform.scaleZoom(this.transform.cameraToCenterDistance/q/this.transform.tileSize),_e=180*Math.atan2(R,-L)/Math.PI;let ve=180*Math.acos(Y/q)/Math.PI;return ve=H<0?90-ve:90+ve,{center:P.toLngLat(),zoom:se,pitch:ve,bearing:_e}}easeTo(s,d){var m;this._stop(!1,s.easeId),((s=l.e({offset:[0,0],duration:500,easing:l.b7},s)).animate===!1||!s.essential&&M.prefersReducedMotion)&&(s.duration=0);const g=this._getTransformForUpdate(),b=this.getZoom(),P=this.getBearing(),R=this.getPitch(),L=this.getPadding(),H="bearing"in s?this._normalizeBearing(s.bearing,P):P,q="pitch"in s?+s.pitch:R,Y="padding"in s?s.padding:g.padding,se=l.P.convert(s.offset);let _e=g.centerPoint.add(se);const ve=g.pointLocation(_e),{center:we,zoom:fe}=g.getConstrained(l.M.convert(s.center||ve),(m=s.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(we);const ze=g.project(ve),qe=g.project(we).sub(ze),Me=g.zoomScale(fe-b);let Oe,Ke;s.around&&(Oe=l.M.convert(s.around),Ke=g.locationPoint(Oe));const Qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||fe!==b,this._rotating=this._rotating||P!==H,this._pitching=this._pitching||q!==R,this._padding=!g.isPaddingEqual(Y),this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,Qe),this.terrain&&this._prepareElevation(we),this._ease(ot=>{if(this._zooming&&(g.zoom=l.z.number(b,fe,ot)),this._rotating&&(g.bearing=l.z.number(P,H,ot)),this._pitching&&(g.pitch=l.z.number(R,q,ot)),this._padding&&(g.interpolatePadding(L,Y,ot),_e=g.centerPoint.add(se)),this.terrain&&!s.freezeElevation&&this._updateElevation(ot),Oe)g.setLocationAtPoint(Oe,Ke);else{const bt=g.zoomScale(g.zoom-b),vt=fe>b?Math.min(2,Me):Math.max(.5,Me),xt=Math.pow(vt,1-ot),Zt=g.unproject(ze.add(qe.mult(ot*xt)).mult(bt));g.setLocationAtPoint(g.renderWorldCopies?Zt.wrap():Zt,_e)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},ot=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,ot)},s),this}_prepareEase(s,d,m={}){this._moving=!0,d||m.moving||this.fire(new l.k("movestart",s)),this._zooming&&!m.zooming&&this.fire(new l.k("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new l.k("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new l.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(m-(d-(m*s+this._elevationStart))/(1-s)),this._elevationTarget=d}this.transform.elevation=l.z.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const d=s.clone(),{center:m,zoom:g,pitch:b,bearing:P,elevation:R}=this.transformCameraUpdate(d);m&&(d.center=m),g!==void 0&&(d.zoom=g),b!==void 0&&(d.pitch=b),P!==void 0&&(d.bearing=P),R!==void 0&&(d.elevation=R),this.transform.apply(d)}_fireMoveEvents(s){this.fire(new l.k("move",s)),this._zooming&&this.fire(new l.k("zoom",s)),this._rotating&&this.fire(new l.k("rotate",s)),this._pitching&&this.fire(new l.k("pitch",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new l.k("zoomend",s)),g&&this.fire(new l.k("rotateend",s)),b&&this.fire(new l.k("pitchend",s)),this.fire(new l.k("moveend",s))}flyTo(s,d){var m;if(!s.essential&&M.prefersReducedMotion){const Xn=l.L(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xn,d)}this.stop(),s=l.e({offset:[0,0],speed:1.2,curve:1.42,easing:l.b7},s);const g=this._getTransformForUpdate(),b=this.getZoom(),P=this.getBearing(),R=this.getPitch(),L=this.getPadding(),H="bearing"in s?this._normalizeBearing(s.bearing,P):P,q="pitch"in s?+s.pitch:R,Y="padding"in s?s.padding:g.padding,se=l.P.convert(s.offset);let _e=g.centerPoint.add(se);const ve=g.pointLocation(_e),{center:we,zoom:fe}=g.getConstrained(l.M.convert(s.center||ve),(m=s.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(we);const ze=g.zoomScale(fe-b),qe=g.project(ve),Me=g.project(we).sub(qe);let Oe=s.curve;const Ke=Math.max(g.width,g.height),Qe=Ke/ze,ot=Me.mag();if("minZoom"in s){const Xn=l.ac(Math.min(s.minZoom,b,fe),g.minZoom,g.maxZoom),Rn=Ke/g.zoomScale(Xn-b);Oe=Math.sqrt(Rn/ot*2)}const bt=Oe*Oe;function vt(Xn){const Rn=(Qe*Qe-Ke*Ke+(Xn?-1:1)*bt*bt*ot*ot)/(2*(Xn?Qe:Ke)*bt*ot);return Math.log(Math.sqrt(Rn*Rn+1)-Rn)}function xt(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function Zt(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}const zn=vt(!1);let Ot=function(Xn){return Zt(zn)/Zt(zn+Oe*Xn)},Tn=function(Xn){return Ke*((Zt(zn)*(xt(Rn=zn+Oe*Xn)/Zt(Rn))-xt(zn))/bt)/ot;var Rn},Nn=(vt(!0)-zn)/Oe;if(Math.abs(ot)<1e-6||!isFinite(Nn)){if(Math.abs(Ke-Qe)<1e-6)return this.easeTo(s,d);const Xn=Qe<Ke?-1:1;Nn=Math.abs(Math.log(Qe/Ke))/Oe,Tn=function(){return 0},Ot=function(Rn){return Math.exp(Xn*Oe*Rn)}}return s.duration="duration"in s?+s.duration:1e3*Nn/("screenSpeed"in s?+s.screenSpeed/Oe:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=P!==H,this._pitching=q!==R,this._padding=!g.isPaddingEqual(Y),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(we),this._ease(Xn=>{const Rn=Xn*Nn,Vn=1/Ot(Rn);g.zoom=Xn===1?fe:b+g.scaleZoom(Vn),this._rotating&&(g.bearing=l.z.number(P,H,Xn)),this._pitching&&(g.pitch=l.z.number(R,q,Xn)),this._padding&&(g.interpolatePadding(L,Y,Xn),_e=g.centerPoint.add(se)),this.terrain&&!s.freezeElevation&&this._updateElevation(Xn);const Hn=Xn===1?we:g.unproject(qe.add(Me.mult(Tn(Rn))).mult(Vn));g.setLocationAtPoint(g.renderWorldCopies?Hn.wrap():Hn,_e),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,d,m){m.animate===!1||m.duration===0?(s(1),d()):(this._easeStart=M.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,d){s=l.b1(s,-180,180);const m=Math.abs(s-d);return Math.abs(s-360-d)<m&&(s-=360),Math.abs(s+360-d)<m&&(s+=360),s}_normalizeCenter(s){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=s.lng-d.center.lng;s.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(l.M.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const Za={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class ng{constructor(s=Za){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const m=this._map._getUIString(`AttributionControl.${d}`);s.title=m,s.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const b=d[g];if(b.used||b.usedForTerrain){const P=b.getSource();P.attribution&&s.indexOf(P.attribution)<0&&s.push(P.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,b)=>g.length-b.length),s=s.filter((g,b)=>{for(let P=b+1;P<s.length;P++)if(s[P].indexOf(g)>=0)return!1;return!0});const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class ec{constructor(s={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const d=w.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zr{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const g of m)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Wr=l.X([{name:"a_pos3d",type:"Int16",components:3}]);class rg extends l.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,d){this.sourceCache.update(s,d),this._renderableTilesKeys=[];const m={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),l.aN(g.posMatrix,0,l.W,0,l.W,0,1),this._tiles[g.key]=new Kt(g,this.tileSize));for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(s){for(const d in this._tiles){const m=this._tiles[d];(!s||m.tileID.equals(s)||m.tileID.isChildOf(s)||s.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const d={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID;if(g.canonical.equals(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16),l.aN(b.posMatrix,0,l.W,0,l.W,0,1),d[m]=b}else if(g.canonical.isChildOf(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const P=g.canonical.z-s.canonical.z,R=g.canonical.x-(g.canonical.x>>P<<P),L=g.canonical.y-(g.canonical.y>>P<<P),H=l.W>>P;l.aN(b.posMatrix,0,H,0,H,0,1),l.H(b.posMatrix,b.posMatrix,[-R*H,-L*H,0]),d[m]=b}else if(s.canonical.isChildOf(g.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const P=s.canonical.z-g.canonical.z,R=s.canonical.x-(s.canonical.x>>P<<P),L=s.canonical.y-(s.canonical.y>>P<<P),H=l.W>>P;l.aN(b.posMatrix,0,l.W,0,l.W,0,1),l.H(b.posMatrix,b.posMatrix,[R*H,L*H,0]),l.J(b.posMatrix,b.posMatrix,[1/2**P,1/2**P,0]),d[m]=b}}return d}getSourceTile(s,d){const m=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!b||!b.dem)&&d)for(;g>=m.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(s.scaledTo(g--).key);return b}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=s)}}class gu{constructor(s,d,m){this.painter=s,this.sourceCache=new rg(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,d,m,g=l.W){var b;if(!(d>=0&&d<g&&m>=0&&m<g))return 0;const P=this.getTerrainData(s),R=(b=P.tile)===null||b===void 0?void 0:b.dem;if(!R)return 0;const L=function(ve,we,fe){var ze=we[0],qe=we[1];return ve[0]=fe[0]*ze+fe[4]*qe+fe[12],ve[1]=fe[1]*ze+fe[5]*qe+fe[13],ve}([],[d/g*l.W,m/g*l.W],P.u_terrain_matrix),H=[L[0]*R.dim,L[1]*R.dim],q=Math.floor(H[0]),Y=Math.floor(H[1]),se=H[0]-q,_e=H[1]-Y;return R.get(q,Y)*(1-se)*(1-_e)+R.get(q+1,Y)*se*(1-_e)+R.get(q,Y+1)*(1-se)*_e+R.get(q+1,Y+1)*se*_e}getElevationForLngLatZoom(s,d){const{tileID:m,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(s,d);return this.getElevation(m,g%l.W,b%l.W,l.W)}getElevation(s,d,m,g=l.W){return this.getDEMElevation(s,d,m,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,b=new l.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(g,new l.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=l.an([])}const d=this.sourceCache.getSourceTile(s,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Fe(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+s.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=s.canonical.z-d.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?b=s.canonical.z-g:l.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=s.canonical.x-(s.canonical.x>>b<<b),R=s.canonical.y-(s.canonical.y>>b<<b),L=l.b9(new Float64Array(16),[1/(l.W<<b),1/(l.W<<b),0]);l.H(L,L,[P*l.W,R*l.W,0]),this._demMatrixCache[s.key]={matrix:L,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(s){const d=this.painter,m=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,P=0;b<this._coordsTextureSize;b++)for(let R=0;R<this._coordsTextureSize;R++,P+=4)d[P+0]=255&R,d[P+1]=255&b,d[P+2]=R>>8<<4|b>>8,d[P+3]=0;const m=new l.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new Fe(s,m,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,g=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const b=d[0]+(d[2]>>4<<8),P=d[1]+((15&d[2])<<8),R=this.coordsIndex[255-d[3]],L=R&&this.sourceCache.getTileByID(R);if(!L)return null;const H=this._coordsTextureSize,q=(1<<L.tileID.canonical.z)*H;return new l.Y((L.tileID.canonical.x*H+b)/q+L.tileID.wrap,(L.tileID.canonical.y*H+P)/q,this.getElevation(L.tileID,b,P,H))}depthAtPoint(s){const d=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,d=new l.ba,m=new l.aX,g=this.meshSize,b=l.W/g,P=g*g;for(let Y=0;Y<=g;Y++)for(let se=0;se<=g;se++)d.emplaceBack(se*b,Y*b,0);for(let Y=0;Y<P;Y+=g+1)for(let se=0;se<g;se++)m.emplaceBack(se+Y,g+se+Y+1,g+se+Y+2),m.emplaceBack(se+Y,g+se+Y+2,se+Y+1);const R=d.length,L=R+2*(g+1);for(const Y of[0,1])for(let se=0;se<=g;se++)for(const _e of[0,1])d.emplaceBack(se*b,Y*l.W,_e);for(let Y=0;Y<2*g;Y+=2)m.emplaceBack(L+Y,L+Y+1,L+Y+3),m.emplaceBack(L+Y,L+Y+3,L+Y+2),m.emplaceBack(R+Y,R+Y+3,R+Y+1),m.emplaceBack(R+Y,R+Y+2,R+Y+3);const H=d.length,q=H+2*(g+1);for(const Y of[0,1])for(let se=0;se<=g;se++)for(const _e of[0,1])d.emplaceBack(Y*l.W,se*b,_e);for(let Y=0;Y<2*g;Y+=2)m.emplaceBack(H+Y,H+Y+1,H+Y+3),m.emplaceBack(H+Y,H+Y+3,H+Y+2),m.emplaceBack(q+Y,q+Y+3,q+Y+1),m.emplaceBack(q+Y,q+Y+2,q+Y+3);return this._mesh={indexBuffer:s.createIndexBuffer(m),vertexBuffer:s.createVertexBuffer(d,Wr.members),segments:l.$.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*l.bb/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,d){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,d);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(s){const d=this.getTerrainData(s).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(s,d){const m=l.Y.fromLngLat(s.wrap()),g=(1<<d)*l.W,b=m.x*g,P=m.y*g,R=Math.floor(b/l.W),L=Math.floor(P/l.W);return{tileID:new l.Q(d,0,d,R,L),mercatorX:b,mercatorY:P}}}class Dh{constructor(s,d,m){this._context=s,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new Fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:s,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>s.id!==d),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const go={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class i0{constructor(s,d){this.painter=s,this.terrain=d,this.pool=new Dh(s.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(m=>!s._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in s.sourceCaches){this._coordsDescendingInv[m]={};const g=s.sourceCaches[m].getVisibleCoordinates();for(const b of g){const P=this.terrain.sourceCache.getTerrainCoords(b);for(const R in P)this._coordsDescendingInv[m][R]||(this._coordsDescendingInv[m][R]=[]),this._coordsDescendingInv[m][R].push(P[R])}}this._coordsDescendingInvStr={};for(const m of s._order){const g=s._layers[m],b=g.source;if(go[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const P in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][P]=this._coordsDescendingInv[b][P].map(R=>R.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][m.tileID.key];b&&b!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const d=s.type,m=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(go[d]&&(this._prevType&&go[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(go[this._prevType]||go[d]&&g){this._prevType=d;const b=this._stacks.length-1,P=this._stacks[b]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(jf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[b]){const H=this.pool.getObjectForId(R.rtt[b].id);if(H.stamp===R.rtt[b].stamp){this.pool.useObject(H);continue}}const L=this.pool.getOrCreateFreeObject();this.pool.useObject(L),this.pool.stampObject(L),R.rtt[b]={id:L.id,stamp:L.stamp},m.context.bindFramebuffer.set(L.fbo.framebuffer),m.context.clear({color:l.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let H=0;H<P.length;H++){const q=m.style._layers[P[H]],Y=q.source?this._coordsDescendingInv[q.source][R.tileID.key]:[R.tileID];m.context.viewport.set([0,0,L.fbo.width,L.fbo.height]),m._renderTileClippingMasks(q,Y),m.renderLayer(m,m.style.sourceCaches[q.source],q,Y),q.source&&(R.rttCoords[q.source]=this._coordsDescendingInvStr[q.source][R.tileID.key])}}return jf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),go[d]}return!1}}const a0={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},yu=p,s0={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Za,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:l.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},kh=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},o0={showCompass:!0,showZoom:!0,visualizePitch:!1};class l0{constructor(s,d,m=!1){this.mousedown=P=>{this.startMouse(l.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),w.mousePos(this.element,P)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,w.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),b=s.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Ql({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:R,bearingDegreesPerPixelMoved:L=.8})=>{const H=new Yf;return new Us({clickTolerance:R,move:(q,Y)=>({bearingDelta:(Y.x-q.x)*L}),moveStateManager:H,enable:P,assignEvents:kh})})({clickTolerance:g,enable:!0}),this.map=s,m&&(this.mousePitch=Kf({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:R,pitchDegreesPerPixelMoved:L=-.5})=>{const H=new Yf;return new Us({clickTolerance:R,move:(q,Y)=>({pitchDelta:(Y.y-q.y)*L}),moveStateManager:H,enable:P,assignEvents:kh})})({clickTolerance:b,enable:!0})),w.addEventListener(d,"mousedown",this.mousedown),w.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(d,"touchcancel",this.reset)}startMouse(s,d){this.mouseRotate.dragStart(s,d),this.mousePitch&&this.mousePitch.dragStart(s,d),w.disableDrag()}startTouch(s,d){this.touchRotate.dragStart(s,d),this.touchPitch&&this.touchPitch.dragStart(s,d),w.disableDrag()}moveMouse(s,d){const m=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(s,d)||{};b&&m.setPitch(m.getPitch()+b)}}moveTouch(s,d){const m=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(s,d)||{};b&&m.setPitch(m.getPitch()+b)}}off(){const s=this.element;w.removeEventListener(s,"mousedown",this.mousedown),w.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}}let Vs;function Lh(_,s,d){const m=new l.M(_.lng,_.lat);if(_=new l.M(_.lng,_.lat),s){const g=new l.M(_.lng-360,_.lat),b=new l.M(_.lng+360,_.lat),P=d.locationPoint(_).distSqr(s);d.locationPoint(g).distSqr(s)<P?_=g:d.locationPoint(b).distSqr(s)<P&&(_=b)}for(;Math.abs(_.lng-d.center.lng)>180;){const g=d.locationPoint(_);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;_.lng>d.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&d.locationPoint(_).y>d.height/2-d.getHorizon()?_:m}const vu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function zh(_,s,d){const m=_.classList;for(const g in vu)m.remove(`maplibregl-${d}-anchor-${g}`);m.add(`maplibregl-${d}-anchor-${s}`)}class tc extends l.E{constructor(s){if(super(),this._onKeyPress=d=>{const m=d.code,g=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Lh(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${vu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${b}`),M.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new l.k("dragstart"))),this.fire(new l.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new l.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=l.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const d=w.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const b=w.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const P=w.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const R=w.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const L=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of L){const qe=w.createNS("http://www.w3.org/2000/svg","ellipse");qe.setAttributeNS(null,"opacity","0.04"),qe.setAttributeNS(null,"cx","10.5"),qe.setAttributeNS(null,"cy","5.80029008"),qe.setAttributeNS(null,"rx",ze.rx),qe.setAttributeNS(null,"ry",ze.ry),R.appendChild(qe)}const H=w.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const q=w.createNS("http://www.w3.org/2000/svg","path");q.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild(q);const Y=w.createNS("http://www.w3.org/2000/svg","g");Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"fill","#000000");const se=w.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Y.appendChild(se);const _e=w.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");const ve=w.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");const we=w.createNS("http://www.w3.org/2000/svg","circle");we.setAttributeNS(null,"fill","#000000"),we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"cx","5.5"),we.setAttributeNS(null,"cy","5.5"),we.setAttributeNS(null,"r","5.4999962");const fe=w.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),ve.appendChild(we),ve.appendChild(fe),P.appendChild(R),P.appendChild(H),P.appendChild(Y),P.appendChild(_e),P.appendChild(ve),d.appendChild(P),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=l.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),zh(this._element,this._anchor,"marker"),s&&s.className)for(const d of s.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=l.M.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,b=g.terrain.depthAtPoint(this._pos),P=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,P)-b<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/g.transform._pixelPerMeter,L=Math.sin(g.getPitch()*Math.PI/180)*R,H=g.terrain.depthAtPoint(new l.P(this._pos.x,this._pos.y-this._offset.y)),q=g.transform.lngLatToCameraDepth(this._lngLat,P+L)-H>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&q&&this._popup.remove(),this._element.style.opacity=q?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=l.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,d){return s===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const c0={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let nc=0,yo=!1;const u0={maxWidth:100,unit:"metric"};function Fh(_,s,d){const m=d&&d.maxWidth||100,g=_._container.clientHeight/2,b=_.unproject([0,g]),P=_.unproject([m,g]),R=b.distanceTo(P);if(d&&d.unit==="imperial"){const L=3.2808*R;L>5280?Yo(s,m,L/5280,_._getUIString("ScaleControl.Miles")):Yo(s,m,L,_._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Yo(s,m,R/1852,_._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Yo(s,m,R/1e3,_._getUIString("ScaleControl.Kilometers")):Yo(s,m,R,_._getUIString("ScaleControl.Meters"))}function Yo(_,s,d,m){const g=function(b){const P=Math.pow(10,`${Math.floor(b)}`.length-1);let R=b/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(L){const H=Math.pow(10,Math.ceil(-Math.log(L)/Math.LN10));return Math.round(L*H)/H}(R),P*R}(d);_.style.width=s*(g/d)+"px",_.innerHTML=`${g}&nbsp;${m}`}const h0={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},d0=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function f0(_){if(_){if(typeof _=="number"){const s=Math.round(Math.abs(_)/Math.SQRT2);return{center:new l.P(0,0),top:new l.P(0,_),"top-left":new l.P(s,s),"top-right":new l.P(-s,s),bottom:new l.P(0,-_),"bottom-left":new l.P(s,-s),"bottom-right":new l.P(-s,-s),left:new l.P(_,0),right:new l.P(-_,0)}}if(_ instanceof l.P||Array.isArray(_)){const s=l.P.convert(_);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:l.P.convert(_.center||[0,0]),top:l.P.convert(_.top||[0,0]),"top-left":l.P.convert(_["top-left"]||[0,0]),"top-right":l.P.convert(_["top-right"]||[0,0]),bottom:l.P.convert(_.bottom||[0,0]),"bottom-left":l.P.convert(_["bottom-left"]||[0,0]),"bottom-right":l.P.convert(_["bottom-right"]||[0,0]),left:l.P.convert(_.left||[0,0]),right:l.P.convert(_.right||[0,0])}}return f0(new l.P(0,0))}const ig=p;u.AJAXError=l.be,u.Evented=l.E,u.LngLat=l.M,u.MercatorCoordinate=l.Y,u.Point=l.P,u.addProtocol=l.bf,u.config=l.a,u.removeProtocol=l.bg,u.AttributionControl=ng,u.BoxZoomHandler=Jl,u.CanvasSource=Mt,u.CooperativeGesturesHandler=Mn,u.DoubleClickZoomHandler=n0,u.DragPanHandler=Xa,u.DragRotateHandler=pu,u.EdgeInsets=uu,u.FullscreenControl=class extends l.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var s;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=d==null?void 0:d.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:l.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new l.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new l.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},u.GeoJSONSource=it,u.GeolocateControl=class extends l.E{constructor(_){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new l.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new l.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const d=new l.M(s.coords.longitude,s.coords.latitude),m=s.coords.accuracy,g=this._map.getBearing(),b=l.e({bearing:g},this.options.fitBoundsOptions),P=Yt.fromLngLat(d,m);this._map.fitBounds(P,b,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const d=new l.M(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&yo)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new l.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){l.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new tc({element:this._dotElement}),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new tc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new l.k("trackuserlocationend")))})}},this.options=l.e({},c0,_)}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return l._(this,arguments,void 0,function*(s=!1){if(Vs!==void 0&&!s)return Vs;if(window.navigator.permissions===void 0)return Vs=!!window.navigator.geolocation,Vs;try{Vs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Vs=!!window.navigator.geolocation}return Vs})}().then(s=>this._setupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,nc=0,yo=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),d=_.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),s=_.getSouthEast(),d=_.getNorthEast(),m=s.distanceTo(d),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return l.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new l.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":nc--,yo=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new l.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new l.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),nc++,nc>1?(_={maximumAge:6e5,timeout:0},yo=!0):(_=this.options.positionOptions,yo=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},u.Hash=qf,u.ImageSource=St,u.KeyboardHandler=br,u.LngLatBounds=Yt,u.LogoControl=ec,u.Map=class extends tg{constructor(_){if(l.bc.mark(l.bd.create),(_=l.e({},s0,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Ah(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new l.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new l.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new zr,this._controls=[],this._mapId=l.a3(),this._locale=l.e({},a0,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=B.addThrottleControl(()=>this.isMoving()),this._requestManager=new ue(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const d=$f(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{s?d(m):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Yi(this,_),this._hash=_.hash&&new qf(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,l.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new ng(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new ec,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new l.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new l.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new l.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new l.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=_.onAdd(this);this._controls.push(_);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new l.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,s,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,s,d,m)}resize(_){var s;const d=this._containerDimensions(),m=d[0],g=d[1],b=this._getClampedPixelRatio(m,g);if(this._resizeCanvas(m,g,b),this.painter.resize(m,g,b),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const L=this._getClampedPixelRatio(m,g);this._resizeCanvas(m,g,L),this.painter.resize(m,g,L)}this.transform.resize(m,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(m,g);const P=!this._moving;return P&&(this.stop(),this.fire(new l.k("movestart",_)).fire(new l.k("move",_))),this.fire(new l.k("resize",_)),P&&this.fire(new l.k("moveend",_)),this}_getClampedPixelRatio(_,s){const{0:d,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),b=_*g,P=s*g;return Math.min(b>d?d/b:1,P>m?m/P:1)*g}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Yt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(l.M.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(l.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,s,d){if(_==="mouseenter"||_==="mouseover"){let m=!1;return{layer:s,listener:d,delegates:{mousemove:b=>{const P=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];P.length?m||(m=!0,d.call(this,new gi(_,this,b.originalEvent,{features:P}))):m=!1},mouseout:()=>{m=!1}}}}if(_==="mouseleave"||_==="mouseout"){let m=!1;return{layer:s,listener:d,delegates:{mousemove:P=>{(this.getLayer(s)?this.queryRenderedFeatures(P.point,{layers:[s]}):[]).length?m=!0:m&&(m=!1,d.call(this,new gi(_,this,P.originalEvent)))},mouseout:P=>{m&&(m=!1,d.call(this,new gi(_,this,P.originalEvent)))}}}}{const m=g=>{const b=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];b.length&&(g.features=b,d.call(this,g),delete g.features)};return{layer:s,listener:d,delegates:{[_]:m}}}}on(_,s,d){if(d===void 0)return super.on(_,s);const m=this._createDelegatedListener(_,s,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(_,s,d){if(d===void 0)return super.once(_,s);const m=this._createDelegatedListener(_,s,d);for(const g in m.delegates)this.once(g,m.delegates[g]);return this}off(_,s,d){return d===void 0?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(m=>{const g=this._delegatedListeners[_];for(let b=0;b<g.length;b++){const P=g[b];if(P.layer===s&&P.listener===d){for(const R in P.delegates)this.off(R,P.delegates[R]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(_,s){if(!this.style)return[];let d;const m=_ instanceof l.P||Array.isArray(_),g=m?_:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(m?{}:_)||{},g instanceof l.P||typeof g[0]=="number")d=[l.P.convert(g)];else{const b=l.P.convert(g[0]),P=l.P.convert(g[1]);d=[b,new l.P(P.x,b.y),P,new l.P(b.x,P.y),b]}return this.style.queryRenderedFeatures(d,s,this.transform)}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}setStyle(_,s){return(s=l.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(_,s))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,s));const d=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new ho(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,s,d):this.style.loadJSON(_,s,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ho(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if(typeof _=="string"){const d=this._requestManager.transformRequest(_,K.Style);l.h(d,new AbortController).then(m=>{this._updateDiff(m.data,s)}).catch(m=>{m&&this.fire(new l.j(m))})}else typeof _=="object"&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_,s)&&this._update(!0)}catch(d){l.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():l.w("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style.sourceCaches[_];if(s!==void 0)return s.loaded();this.fire(new l.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const s=this.style.sourceCaches[_.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&s.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===_.source&&l.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new gu(this.painter,s,_),this.painter.renderToTexture=new i0(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new l.k("terrain",{terrain:_})),this}getTerrain(){var _,s;return(s=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const s in _){const d=_[s]._tiles;for(const m in d){const g=d[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,d={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:b,stretchY:P,content:R}=d;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||l.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:L,height:H,data:q}=s,Y=s;return this.style.addImage(_,{data:new l.R({width:L,height:H},new Uint8Array(q)),pixelRatio:m,stretchX:b,stretchY:P,content:R,sdf:g,version:0,userImage:Y}),Y.onAdd&&Y.onAdd(this,_),this}}{const{width:L,height:H,data:q}=M.getImageData(s);this.style.addImage(_,{data:new l.R({width:L,height:H},q),pixelRatio:m,stretchX:b,stretchY:P,content:R,sdf:g,version:0})}}updateImage(_,s){const d=this.style.getImage(_);if(!d)return this.fire(new l.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof HTMLImageElement||l.b(s)?M.getImageData(s):s,{width:g,height:b,data:P}=m;if(g===void 0||b===void 0)return this.fire(new l.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||b!==d.data.height)return this.fire(new l.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(s instanceof HTMLImageElement||l.b(s));return d.data.replace(P,R),this.style.updateImage(_,d),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new l.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return B.getImage(this._requestManager.transformRequest(_,K.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,s,d){return this.style.setLayerZoomRange(_,s,d),this._update(!0)}setFilter(_,s,d={}){return this.style.setFilter(_,s,d),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,d,m={}){return this.style.setPaintProperty(_,s,d,m),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,d,m={}){return this.style.setLayoutProperty(_,s,d,m),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setGlyphs(_,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,s,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,s,d,m=>{m||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,s,d=>{d||this._update(!0)}),this}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.clientWidth||400,s=this._container.clientHeight||300),[_,s]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const s=this._canvasContainer=w.create("div","maplibregl-canvas-container",_);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const g=this._controlContainer=w.create("div","maplibregl-control-container",_),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{b[P]=w.create("div",`maplibregl-ctrl-${P} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s,d){this._canvas.width=Math.floor(d*_),this._canvas.height=Math.floor(d*s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{s={requestedAttributes:_},m&&(s.statusMessage=m.statusMessage,s.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!d){const m="Failed to initialize WebGL";throw s?(s.message=m,new Error(JSON.stringify(s))):new Error(m)}this.painter=new Zl(d,this.transform),A.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=M.now();this.style.zoomHistory.update(g,b);const P=new l.a8(g,{now:b,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=P.crossFadingFactor();R===1&&R===this._crossFadingFactor||(d=!0,this._crossFadingFactor=R),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new l.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,l.bc.mark(l.bd.load),this.fire(new l.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new l.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,l.bc.mark(l.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),B.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),l.bc.clearMetrics(),this._removed=!0,this.fire(new l.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(_=>{l.bc.frame(_),this._frameRequest=null,this._render(_)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return yu}getCameraTargetElevation(){return this.transform.elevation}},u.MapMouseEvent=gi,u.MapTouchEvent=Kl,u.MapWheelEvent=La,u.Marker=tc,u.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const s=this._map.getZoom(),d=s===this._map.getMaxZoom(),m=s===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);s.title=m,s.setAttribute("aria-label",m)},this.options=l.e({},o0,_),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new l0(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const d=w.create("button",_,this._container);return d.type="button",d.addEventListener("click",s),d}},u.Popup=class extends l.E{constructor(_){super(),this.remove=()=>(this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new l.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Lh(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!s)return;const m=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const b=f0(this.options.offset);if(!g){const R=this._container.offsetWidth,L=this._container.offsetHeight;let H;H=m.y+b.bottom.y<L?["top"]:m.y>this._map.transform.height-L?["bottom"]:[],m.x<R/2?H.push("left"):m.x>this._map.transform.width-R/2&&H.push("right"),g=H.length===0?"bottom":H.join("-")}let P=m.add(b[g]);this.options.subpixelPositioning||(P=P.round()),w.setTransform(this._container,`${vu[g]} translate(${P.x}px,${P.y}px)`),zh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=l.e(Object.create(h0),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new l.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=l.M.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=_;m=d.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(d0);_&&_.focus()}},u.RasterDEMTileSource=st,u.RasterTileSource=le,u.ScaleControl=class{constructor(_){this._onMove=()=>{Fh(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Fh(this._map,this._container,this.options)},this.options=l.e({},u0,_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},u.ScrollZoomHandler=t0,u.Style=ho,u.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},u.TwoFingersTouchPitchHandler=Qm,u.TwoFingersTouchRotateHandler=Qf,u.TwoFingersTouchZoomHandler=Ph,u.TwoFingersTouchZoomRotateHandler=pn,u.VectorTileSource=re,u.VideoSource=_n,u.addSourceType=(_,s)=>l._(void 0,void 0,void 0,function*(){if(xn(_))throw new Error(`A source type called "${_}" already exists.`);((d,m)=>{hn[d]=m})(_,s)}),u.clearPrewarmedResources=function(){const _=Ft;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Cn),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},u.getMaxParallelImageRequests=function(){return l.a.MAX_PARALLEL_IMAGE_REQUESTS},u.getRTLTextPluginStatus=function(){return tn().getRTLTextPluginStatus()},u.getVersion=function(){return ig},u.getWorkerCount=function(){return nt.workerCount},u.getWorkerUrl=function(){return l.a.WORKER_URL},u.importScriptInWorkers=function(_){return In().broadcast("importScript",_)},u.prewarm=function(){gn().acquire(Cn)},u.setMaxParallelImageRequests=function(_){l.a.MAX_PARALLEL_IMAGE_REQUESTS=_},u.setRTLTextPlugin=function(_,s){return tn().setRTLTextPlugin(_,s)},u.setWorkerCount=function(_){nt.workerCount=_},u.setWorkerUrl=function(_){l.a.WORKER_URL=_}});var o=t;return o})})(RP);var Du=RP.exports;function dK(n,e){const t=[];for(let r=0;r<n;r++)t.push(e(r));return t}let fK=class{constructor(e,t){ct(this,"canvas");ct(this,"gl");ct(this,"windGraph1");ct(this,"windGraph2");ct(this,"smudgeGraph1");ct(this,"smudgeGraph2");ct(this,"outGraph1");ct(this,"outGraph2");ct(this,"i",0);e.width=e.clientWidth,e.height=e.clientHeight;let r=e.getContext("webgl2");const i=new pv(r,{allowAlpha:!0}),o=e.width,u=e.height,l=2e3,p=dK(l,Ve=>[Math.random(),Math.random(),Math.random()]),v=new Po(r,{data:new Float32Array(p.flat()),changesOften:!0}),x=structuredClone(p),M=new Po(r,{data:new Float32Array(x.flat()),changesOften:!0}),w=[[1,1,0,1],[1,-1,0,1],[-1,1,0,1],[-1,1,0,1],[1,-1,0,1],[-1,-1,0,1]],A=new Po(r,{data:new Float32Array(w.flat()),changesOften:!1}),[k,z,D,C]=[t.tlMerc.x,t.tlMerc.y,t.brMerc.x,t.brMerc.y],U=[[D,C,0,1],[D,z,0,1],[k,C,0,1],[k,C,0,1],[D,z,0,1],[k,z,0,1]],B=new Po(r,{data:new Float32Array(U.flat()),changesOften:!1}),K=new Eo(r,{width:o,height:u,type:"ubyte4",interpolate:"linear",edges:"clamp"}),ue=new Eo(r,{width:o,height:u,type:"ubyte4",interpolate:"linear",edges:"clamp"}),Z=new Eo(r,{width:o,height:u,type:"ubyte4",interpolate:"linear",edges:"clamp"}),ee=new zi(r,{image:t.speedImage}),be=new Ua(i,{program:{vertexSource:`#version 300 es
                      in vec3 particles;              // [mercator.x, mercator.y, lifetime]
                      out vec3 particlesNew;          // [mercator.x, mercator.y, lifetime]
                      uniform mat4 projMatrix;        // mercator to clip-space
                      uniform mat4 projMatrixInv;     // clip-space to mercator
                      uniform sampler2D speedTexture;
                      uniform float time;
                      uniform float zoom;
                      uniform vec4 bbox;
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }
        
                      float rand(vec2 co) {
                        return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
                      }
        
                      float zClipFromInverse(float xClip, float yClip) {
                        mat4 M = projMatrixInv;
                        return (- M[0][2] * xClip - M[1][2] * yClip - M[3][2]) / M[2][2];
                      }
        
                      // Or more generally, if zMerc !== 0:
                      float zClipFromInverseWithHeight(float xClip, float yClip, float zMerc) {
                        mat4 M = projMatrixInv;
                        float a = M[0][2] * xClip + M[1][2] * yClip + M[3][2]; 
                        float b = zMerc * ( M[0][3] * xClip + M[1][3] * yClip + M[3][3] );
                        float c = zMerc * M[2][3] - M[2][2];
                        return (a - b) / c;
                      }
        
                      void main() {
                          vec2 positionMerc = particles.xy;
                          float lifeTime = particles.z - 0.005;
                          
                          if (lifeTime < 0.0) {
                            float clipX = (rand(particles.xy) * 2.0 - 1.0) * 1.05;
                            float clipY = (rand(particles.yx) * 2.0 - 1.0) * 1.05;
                            float clipZ = zClipFromInverse(clipX, clipY);
                            vec4 randPointClip = vec4(clipX, clipY, clipZ, 1.0);
        
                            vec4 randPointMerc = projMatrixInv * randPointClip;
                            positionMerc.xy = randPointMerc.xy / randPointMerc.w;
                            lifeTime = 1.0;
                          }
        
                          gl_PointSize = 2.0;
                          vec4 speedMerc =  2.0 * texture(speedTexture, merc2uv(positionMerc.xy)) - 1.0;
                          vec4 updatedPositionMerc = vec4(positionMerc.xy, 0, 1) + 0.1 * speedMerc / (50.0 * zoom * zoom * zoom);
                          gl_Position = projMatrix * updatedPositionMerc;
                          particlesNew = vec3(updatedPositionMerc.xy, lifeTime);
                          // gl_Position = vec4(updatedPositionMerc.xy, 0, 1); <-- nothing
                          // gl_Position = vec4(positionMerc.xy, 0, 1); <-- something drawn before matrix is available, but fading.
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      out vec4 fragColor;
                      void main() {
                          fragColor = vec4(1, 0, 0, 1);
                      }
                  `},inputs:{attributes:{particles:{buffer:v,config:{type:"vec3",normalize:!1,nrInstances:0}}},textures:{speedTexture:ee},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},projMatrixInv:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},time:{type:"float",value:[0]},zoom:{type:"float",value:[0]},bbox:{type:"vec4",value:[k,z,D,C]}}},outputs:{transformFeedback:{data:{particlesNew:M},runFragmentShader:!0},frameBuffer:{textures:[K]}},settings:{drawingMode:"points",instanced:!1,nrVertices:l,viewport:[0,0,o,u]}}),ie=new Ua(i,{...be.config,program:be.program,inputs:{...be.config.inputs,attributes:{particles:{buffer:M,config:{type:"vec3",normalize:!1,nrInstances:0}}}},outputs:{...be.config.outputs,transformFeedback:{data:{particlesNew:v},runFragmentShader:!0}}}),Q=new Ua(i,{program:{vertexSource:`#version 300 es
                in vec4 tposition;
                void main() {
                  gl_Position = vec4(tposition.x, tposition.y, 0, 1);
                }
              `,fragmentSource:`#version 300 es
                precision highp float;
                uniform sampler2D particlesTexture;
                uniform sampler2D smudgeTextureLast;
                uniform vec2 texSize;
                uniform bool isMoving;
                out vec4 fragColor;
                void main() {
                  vec2 uv = vec2(
                      gl_FragCoord.x / texSize.x, 
                      gl_FragCoord.y / texSize.y
                  );
                  vec4 lastColor = texture(smudgeTextureLast, uv);
                  lastColor *= 0.95;
                  vec4 particleColor = texture(particlesTexture, uv);
                  fragColor = particleColor + lastColor;
                  if (isMoving) fragColor = vec4(0,0,0,0);
                }
              `},inputs:{attributes:{tposition:{buffer:A,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{particlesTexture:K,smudgeTextureLast:ue},uniforms:{isMoving:{type:"bool",value:[0]},texSize:{type:"vec2",value:[o,u]}}},outputs:{frameBuffer:{textures:[Z]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:w.length,viewport:[0,0,o,u]}}),Ee=new Ua(i,{...Q.config,program:Q.program,inputs:{...Q.config.inputs,textures:{particlesTexture:K,smudgeTextureLast:Z}},outputs:{...Q.config.outputs,frameBuffer:{textures:[ue]}}}),Fe=new Ua(i,{program:{vertexSource:`#version 300 es
                      in vec4 bboxPosMerc;
                      uniform mat4 projMatrix;
                      out vec2 positionMerc;
                      void main() {
                          gl_Position = projMatrix * vec4(bboxPosMerc.xy, 0, 1);  
                          positionMerc = bboxPosMerc.xy;
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      uniform sampler2D smudgedTexture;
                      uniform sampler2D speedTexture;
                      uniform vec4 bbox;
                      uniform vec2 texSize;
                      in vec2 positionMerc;
                      out highp vec4 fragColor;
        
                      vec2 currentClipUv() {
                        float u = gl_FragCoord.x / texSize.x;
                        float v = gl_FragCoord.y / texSize.y;
                        return vec2(u, v);
                      }
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }

                      vec3 colorRamp1 = vec3(0.07890625, 0.25546875, 0.4);
                      vec3 colorRamp2 = vec3(0.36015625, 0.2984375,  0.56015625);
                      vec3 colorRamp3 = vec3(0.653125,   0.18125,    0.29453125);

                      vec3 colorScale(float h) {
                        if (h < 0.5) {
                          float deg = 2.0 * h;
                          return mix(colorRamp1, colorRamp2, deg);
                        }
                        else {
                          float deg = (h - 0.5) * 2.0;
                          return mix(colorRamp2, colorRamp3, deg);
                        }
                      }
        
                      void main() {
                          vec2 uvSmudge = currentClipUv();
                          vec4 currentSmudge = texture(smudgedTexture, uvSmudge);
                          float p = currentSmudge.x;
                          vec3 particleColor = vec3(p);
                          
                          vec2 uvSpeed = merc2uv(positionMerc);
                          vec4 currentSpeed = texture(speedTexture, uvSpeed);
                          float magSpeed = length(currentSpeed) / 1.732; // 1.732: sqrt(1+1+1)
                          vec3 speedColor = colorScale(magSpeed);

                          fragColor = vec4(
                            max(particleColor.x, speedColor.x),
                            max(particleColor.y, speedColor.y),
                            max(particleColor.z, speedColor.z),
                            max(p, 0.3)
                          );

                          // if (p > 0.1) {
                          //   fragColor = vec4(particleColor.xyz, 1.0);
                          // } else {
                          //   fragColor = vec4(speedColor.xyz, 0.6);
                          // }
                          // fragColor = max(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0)
                          // );
                          // fragColor = mix(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0),
                          //   p
                          // );
                          // fragColor = max(vec4(currentSmudge.x), vec4(magSpeed, 1.0 - magSpeed, 1.0 - magSpeed, 0.4));
                          // fragColor = vec4(currentSmudge.x) + vec4(0.1, 0.1, 0.1, 0.4);
                          // fragColor = vec4(currentSmudge.x) + currentSpeed;
                      }
              `},inputs:{attributes:{bboxPosMerc:{buffer:B,config:{type:"vec4",normalize:!1,nrInstances:0}}},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},bbox:{type:"vec4",value:[k,z,D,C]},texSize:{type:"vec2",value:[o,u]}},textures:{smudgedTexture:Z,speedTexture:ee}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:U.length,viewport:[0,0,o,u]}}),Ae=new Ua(i,{...Fe.config,program:Fe.program,inputs:{...Fe.config.inputs,textures:{smudgedTexture:ue,speedTexture:ee}}});this.canvas=e,this.gl=r,this.windGraph1=be,this.windGraph2=ie,this.smudgeGraph1=Q,this.smudgeGraph2=Ee,this.outGraph1=Fe,this.outGraph2=Ae}step(e){this.i%2===0?(this.windGraph1.updateUniform("projMatrix",e.matrix),this.windGraph1.updateUniform("projMatrixInv",e.invMatrix),this.windGraph1.updateUniform("time",[new Date().getTime()]),this.windGraph1.updateUniform("zoom",[e.zoom]),this.smudgeGraph1.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph1.updateUniform("projMatrix",e.matrix),this.outGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph1.draw([0,0,0,1]),this.smudgeGraph1.draw([0,0,0,1]),this.outGraph1.draw()):(this.windGraph2.updateUniform("projMatrix",e.matrix),this.windGraph2.updateUniform("projMatrixInv",e.invMatrix),this.windGraph2.updateUniform("time",[new Date().getTime()]),this.windGraph2.updateUniform("zoom",[e.zoom]),this.smudgeGraph2.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph2.updateUniform("projMatrix",e.matrix),this.outGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph2.draw([0,0,0,1]),this.smudgeGraph2.draw([0,0,0,1]),this.outGraph2.draw()),this.i+=1}destroy(e){var t,r,i,o,u,l;(t=this.windGraph1)==null||t.destroy(e),(r=this.windGraph2)==null||r.destroy(e),(i=this.smudgeGraph1)==null||i.destroy(e),(o=this.smudgeGraph2)==null||o.destroy(e),(u=this.outGraph1)==null||u.destroy(e),(l=this.outGraph2)==null||l.destroy(e)}};const pK=8,mK="Dark Matter DLR",gK={"mapbox:autocomposite":!1,"mapbox:groups":{"101da9f13b64a08fa4b6ac1168e89e5f":{collapsed:!1,name:"Places"},a14c9607bc7954ba1df7205bf660433f:{name:"Boundaries"},b6371a3f2f5a9932464fa3867530a2e5:{collapsed:!1,name:"Transportation"}},"mapbox:type":"template","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t","openmaptiles:version":"3.x","maputnik:renderer":"mlgljs"},yK={openmaptiles:{type:"vector",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"],minZoom:0,maxZoom:14}},vK="https://openmaptiles.github.io/dark-matter-gl-style/sprite",_K="https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf",xK=[{id:"background",type:"background",paint:{"background-color":"rgb(12,12,12)"}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-antialias":!1,"fill-color":"rgb(27 ,27 ,29)"}},{id:"landcover_ice_shelf",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","ice_shelf"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(12,12,12)","fill-opacity":.7}},{id:"landcover_glacier",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","glacier"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 1%, 2%)","fill-opacity":{base:1,stops:[[0,1],[8,.5]]}}},{id:"landuse_residential",type:"fill",source:"openmaptiles","source-layer":"landuse",maxzoom:9,filter:["all",["==","$type","Polygon"],["==","class","residential"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 2%, 5%)","fill-opacity":.4}},{id:"landcover_wood",type:"fill",source:"openmaptiles","source-layer":"landcover",minzoom:10,filter:["all",["==","$type","Polygon"],["==","class","wood"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)","fill-opacity":{base:.3,stops:[[8,0],[10,.8],[13,.4]]},"fill-pattern":"wood-pattern","fill-translate":[0,0]}},{id:"landuse_park",type:"fill",source:"openmaptiles","source-layer":"landuse",filter:["all",["==","$type","Polygon"],["==","class","park"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)"}},{id:"waterway",type:"line",source:"openmaptiles","source-layer":"waterway",filter:["==","$type","LineString"],layout:{visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)"}},{id:"water_name",type:"symbol",source:"openmaptiles","source-layer":"water_name",filter:["==","$type","LineString"],layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Condensed Italic"],"text-rotation-alignment":"map","text-size":12},paint:{"text-color":"hsla(0, 0%, 0%, 0.7)","text-halo-color":"hsl(0, 0%, 27%)"}},{id:"building",type:"fill",source:"openmaptiles","source-layer":"building",minzoom:12,filter:["==","$type","Polygon"],paint:{"fill-antialias":!0,"fill-color":"rgb(10,10,10)","fill-outline-color":"rgb(27 ,27 ,29)"}},{id:"aeroway-taxiway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":1,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"aeroway-runway-casing",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-opacity":1,"line-width":{base:1.5,stops:[[11,5],[17,55]]}}},{id:"aeroway-area",type:"fill",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],layout:{visibility:"visible"},paint:{"fill-color":"#000","fill-opacity":1}},{id:"aeroway-runway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#000","line-opacity":1,"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"road_area_pier",type:"fill",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","Polygon"],["==","class","pier"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"rgb(12,12,12)"}},{id:"road_pier",type:"line",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["in","class","pier"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(12,12,12)","line-width":{base:1.2,stops:[[15,1],[17,4]]}}},{id:"highway_path",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["==","class","path"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)","line-dasharray":[1.5,1.5],"line-opacity":.9,"line-width":{base:1.2,stops:[[13,1],[20,10]]}}},{id:"highway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:8,filter:["all",["==","$type","LineString"],["in","class","minor","service","track"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":.9,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"highway_major_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[12,0],"line-width":{base:1.3,stops:[[10,3],[20,23]]}}},{id:"highway_major_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"hsl(0, 0%, 7%)","line-width":{base:1.3,stops:[[10,2],[20,20]]}}},{id:"highway_major_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,maxzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#2a2a2a","line-width":{stops:[[6,0],[8,2]]}}},{id:"highway_motorway_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[2,0],"line-opacity":1,"line-width":{base:1.4,stops:[[5.8,0],[6,3],[20,40]]}}},{id:"highway_motorway_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":{base:1,stops:[[5.8,"hsla(0, 0%, 85%, 0.53)"],[6,"#000"]]},"line-width":{base:1.4,stops:[[4,2],[6,1.3],[20,30]]}}},{id:"road_oneway",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":0,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"road_oneway_opposite",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",-1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":180,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"highway_motorway_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",maxzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-width":{base:1.4,stops:[[4,2],[6,1.3]]}}},{id:"railway_transit",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_transit_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_minor_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":{base:1.3,stops:[[16,3],[20,7]]}}},{id:"railway_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":{base:1.3,stops:[[16,2],[20,6]]}}},{id:"highway_name_other",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["!=","class","motorway"],["==","$type","LineString"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{name:latin} {name:nonlatin}","text-font":["Roboto Regular"],"text-max-angle":30,"text-pitch-alignment":"viewport","text-rotation-alignment":"map","text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgba(80, 78, 78, 1)","text-halo-blur":0,"text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":1,"text-translate":[0,0]}},{id:"highway_name_motorway",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{ref}","text-font":["Roboto Light"],"text-pitch-alignment":"viewport","text-rotation-alignment":"viewport","text-size":10,visibility:"visible"},paint:{"text-color":"hsl(0, 0%, 37%)","text-translate":[0,2]}},{id:"boundary_state",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",filter:["==","admin_level",4],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-blur":.4,"line-color":"hsl(0, 0%, 21%)","line-dasharray":[2,2],"line-opacity":1,"line-width":{base:1.3,stops:[[3,1],[22,15]]}}},{id:"boundary_country_z0-4",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",maxzoom:5,filter:["all",["==","admin_level",2],["!has","claimed_by"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"boundary_country_z5-",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",minzoom:5,filter:["==","admin_level",2],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"place_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["in","class","hamlet","isolated_dwelling","neighbourhood"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_suburb",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","suburb"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_village",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","village"]],layout:{"icon-size":.4,"text-anchor":"left","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_town",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","town"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","city"],[">","rank",3]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city_large",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["<=","rank",3],["==","class","city"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":14,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_state",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["==","class","state"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_country_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Condensed Italic"],"text-size":{base:1,stops:[[0,9],[1,11]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_minor",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],[">=","rank",2],["has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1,stops:[[0,10],[6,12]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_major",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:6,filter:["all",["==","$type","Point"],["<=","rank",1],["==","class","country"],["has","iso_a2"]],layout:{"text-anchor":"center","text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1.4,stops:[[0,10],[3,12],[4,14]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}}],bK="dark-matter",wK={version:pK,name:mK,metadata:gK,sources:yK,sprite:vK,glyphs:_K,layers:xK,id:bK};class SK{constructor(){ct(this,"container");ct(this,"overlay");ct(this,"looper");ct(this,"ws");ct(this,"map");ct(this,"destroyed",!1);ct(this,"zoom",1);ct(this,"movingTimeout");ct(this,"isMoving",!1);ct(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);ct(this,"invMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}async init(e,t){t.width=t.clientWidth,t.height=t.clientHeight,this.container=e,this.overlay=t;const r=52.99489512738211,i=55.20539216798002,o=6.787129861958135,u=12.989942944851833;this.map=new Du.Map({container:e,style:wK,center:new Du.LngLat((u-o)/2+o,(i-r)/2+r),maxZoom:11,minZoom:6,maxBounds:new Du.LngLatBounds(new Du.LngLat(o-1,r-1),new Du.LngLat(u+1,i+1)),zoom:8,bearing:15,pitch:30});const l=new Du.LngLat(o,i),p=new Du.LngLat(u,r),v=this.map.transform.locationCoordinate(l),x=this.map.transform.locationCoordinate(p),M=await zi.loadImage("/wind_map.jpg");this.ws=new fK(t,{tlMerc:v,brMerc:x,speedImage:M}),this.looper=new hm(30,()=>{var w;(w=this.ws)==null||w.step({zoom:this.zoom,isMoving:this.isMoving,matrix:this.matrix,invMatrix:this.invMatrix})}),this.map.addLayer({id:"windSim",type:"custom",render:(w,A)=>{this.matrix=Array.from(A),this.invMatrix=Array.from(hK(uK(),A)),this.map&&(this.zoom=this.map.getZoom()),this.isMoving=!0,this.movingTimeout&&(clearTimeout(this.movingTimeout),this.movingTimeout=void 0),this.movingTimeout=setTimeout(()=>this.isMoving=!1,100)}}),this.startLoop()}startLoop(){var e;!this.container||!this.overlay||(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){this.stopLoop(),this.ws&&this.ws.destroy(!0),this.map&&this.map.remove(),this.overlay=void 0,this.container=void 0,this.destroyed=!0}}function MK(){const n=yt.useRef(null),e=yt.useRef(null);return yt.useEffect(()=>{const t=new SK;return n.current&&e.current&&t.init(n.current,e.current),()=>t.destroy()},[n.current,e.current]),ge.jsx("div",{ref:n,style:{width:"100%",height:"100%"},children:ge.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",position:"absolute",zIndex:1,top:0,left:0,pointerEvents:"none"}})})}function TK(){return ge.jsxs(PP,{bgImg:"/turbine_img.jpg",title:"Wind visualization",subTitle:"Scaling to thousands of points",logo:ge.jsxs("svg",{id:"fullBuilding",width:"100%",height:"100%",viewBox:"0 0 100 200",children:[ge.jsx("rect",{x:"47.5",y:"70",width:"5",height:"100",fill:"black"}),ge.jsx("rect",{x:"45",y:"70",width:"10",height:"8",fill:"black"}),ge.jsxs("svg",{id:"fullRotor",x:"0",y:"20",width:"100",height:"100",viewBox:"0 0 100 100",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"blade",d:"M 0,50 C 9,40, 0,30, 0,0 Z",fill:"black"})}),ge.jsxs("g",{transform:"rotate(10 50 50)",children:[ge.jsx("svg",{x:"45",y:"45",width:"10",height:"10",viewBox:"0 0 100 100",children:ge.jsx("g",{transform:"rotate(15 50 50)",children:ge.jsx("path",{d:"M 50 0 L 93.3 75 L 6.7 75 Z",fill:"black"})})}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:""}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(120 50 50)"}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(240 50 50)"}),ge.jsx("circle",{cx:"50",cy:"50",r:"2.5",fill:"black"})]})]})]}),children:[ge.jsx("p",{style:{margin:"2rem"},children:"Using particles is a highly readable and intuitive way of displaying wind speed and development. Such a visualization has the highest impact only with many hundreds or thousands of individual particles - which is not realistically possible on standard CPUs."}),ge.jsx("p",{style:{margin:"2rem"},children:"Here we've build custom glsl-shaders to simulate thousands of particles at a time. This way, your main site remains responsive, while the heavy lifting has been outsourced to the GPU."}),ge.jsx("div",{style:{width:"100%",aspectRatio:"3/2"},children:ge.jsx(MK,{})}),ge.jsx("p",{style:{margin:"2rem"},children:"The above example has been written for use in maplibre, but can be adjusted for other mapping libraries such as openlayers."})]})}const EK=hL([{path:"/",element:ge.jsx(TN,{}),errorElement:ge.jsx(KL,{}),children:[{path:"/",element:ge.jsx(wN,{})},{path:"/contact",element:ge.jsx(YL,{})},{path:"/swe",element:ge.jsx(cK,{})},{path:"/wind",element:ge.jsx(TK,{})},{path:"/imprint",element:ge.jsx(EN,{})},{path:"/resources",element:ge.jsx($j,{})},{path:"/math",element:ge.jsx(aK,{})}]}]);_2.createRoot(document.getElementById("root")).render(ge.jsx(nE.StrictMode,{children:ge.jsx(_L,{router:EK})}));export{Na as _,Yb as g,Kz as p,yt as r,yv as u};
