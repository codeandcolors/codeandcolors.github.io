var VP=Object.defineProperty;var HP=(n,e,t)=>e in n?VP(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var ut=(n,e,t)=>(HP(n,typeof e!="symbol"?e+"":e,t),t);function XT(n,e){for(var t=0;t<e.length;t++){const i=e[t];if(typeof i!="string"&&!Array.isArray(i)){for(const r in i)if(r!=="default"&&!(r in n)){const l=Object.getOwnPropertyDescriptor(i,r);l&&Object.defineProperty(n,r,l.get?l:{enumerable:!0,get:()=>i[r]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const l of r)if(l.type==="childList")for(const h of l.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&i(h)}).observe(document,{childList:!0,subtree:!0});function t(r){const l={};return r.integrity&&(l.integrity=r.integrity),r.referrerPolicy&&(l.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?l.credentials="include":r.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function i(r){if(r.ep)return;r.ep=!0;const l=t(r);fetch(r.href,l)}})();var GP=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZT(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var YT={exports:{}},Ty={},KT={exports:{}},si={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Op=Symbol.for("react.element"),jP=Symbol.for("react.portal"),WP=Symbol.for("react.fragment"),qP=Symbol.for("react.strict_mode"),$P=Symbol.for("react.profiler"),XP=Symbol.for("react.provider"),ZP=Symbol.for("react.context"),YP=Symbol.for("react.forward_ref"),KP=Symbol.for("react.suspense"),JP=Symbol.for("react.memo"),QP=Symbol.for("react.lazy"),C3=Symbol.iterator;function eR(n){return n===null||typeof n!="object"?null:(n=C3&&n[C3]||n["@@iterator"],typeof n=="function"?n:null)}var JT={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},QT=Object.assign,e6={};function nf(n,e,t){this.props=n,this.context=e,this.refs=e6,this.updater=t||JT}nf.prototype.isReactComponent={};nf.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")};nf.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function t6(){}t6.prototype=nf.prototype;function pb(n,e,t){this.props=n,this.context=e,this.refs=e6,this.updater=t||JT}var mb=pb.prototype=new t6;mb.constructor=pb;QT(mb,nf.prototype);mb.isPureReactComponent=!0;var P3=Array.isArray,n6=Object.prototype.hasOwnProperty,gb={current:null},i6={key:!0,ref:!0,__self:!0,__source:!0};function r6(n,e,t){var i,r={},l=null,h=null;if(e!=null)for(i in e.ref!==void 0&&(h=e.ref),e.key!==void 0&&(l=""+e.key),e)n6.call(e,i)&&!i6.hasOwnProperty(i)&&(r[i]=e[i]);var o=arguments.length-2;if(o===1)r.children=t;else if(1<o){for(var p=Array(o),v=0;v<o;v++)p[v]=arguments[v+2];r.children=p}if(n&&n.defaultProps)for(i in o=n.defaultProps,o)r[i]===void 0&&(r[i]=o[i]);return{$$typeof:Op,type:n,key:l,ref:h,props:r,_owner:gb.current}}function tR(n,e){return{$$typeof:Op,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function yb(n){return typeof n=="object"&&n!==null&&n.$$typeof===Op}function nR(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var R3=/\/+/g;function c_(n,e){return typeof n=="object"&&n!==null&&n.key!=null?nR(""+n.key):e.toString(36)}function u1(n,e,t,i,r){var l=typeof n;(l==="undefined"||l==="boolean")&&(n=null);var h=!1;if(n===null)h=!0;else switch(l){case"string":case"number":h=!0;break;case"object":switch(n.$$typeof){case Op:case jP:h=!0}}if(h)return h=n,r=r(h),n=i===""?"."+c_(h,0):i,P3(r)?(t="",n!=null&&(t=n.replace(R3,"$&/")+"/"),u1(r,e,t,"",function(v){return v})):r!=null&&(yb(r)&&(r=tR(r,t+(!r.key||h&&h.key===r.key?"":(""+r.key).replace(R3,"$&/")+"/")+n)),e.push(r)),1;if(h=0,i=i===""?".":i+":",P3(n))for(var o=0;o<n.length;o++){l=n[o];var p=i+c_(l,o);h+=u1(l,e,t,p,r)}else if(p=eR(n),typeof p=="function")for(n=p.call(n),o=0;!(l=n.next()).done;)l=l.value,p=i+c_(l,o++),h+=u1(l,e,t,p,r);else if(l==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return h}function og(n,e,t){if(n==null)return n;var i=[],r=0;return u1(n,i,"","",function(l){return e.call(t,l,r++)}),i}function iR(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var ba={current:null},h1={transition:null},rR={ReactCurrentDispatcher:ba,ReactCurrentBatchConfig:h1,ReactCurrentOwner:gb};si.Children={map:og,forEach:function(n,e,t){og(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return og(n,function(){e++}),e},toArray:function(n){return og(n,function(e){return e})||[]},only:function(n){if(!yb(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};si.Component=nf;si.Fragment=WP;si.Profiler=$P;si.PureComponent=pb;si.StrictMode=qP;si.Suspense=KP;si.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=rR;si.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var i=QT({},n.props),r=n.key,l=n.ref,h=n._owner;if(e!=null){if(e.ref!==void 0&&(l=e.ref,h=gb.current),e.key!==void 0&&(r=""+e.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(p in e)n6.call(e,p)&&!i6.hasOwnProperty(p)&&(i[p]=e[p]===void 0&&o!==void 0?o[p]:e[p])}var p=arguments.length-2;if(p===1)i.children=t;else if(1<p){o=Array(p);for(var v=0;v<p;v++)o[v]=arguments[v+2];i.children=o}return{$$typeof:Op,type:n.type,key:r,ref:l,props:i,_owner:h}};si.createContext=function(n){return n={$$typeof:ZP,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:XP,_context:n},n.Consumer=n};si.createElement=r6;si.createFactory=function(n){var e=r6.bind(null,n);return e.type=n,e};si.createRef=function(){return{current:null}};si.forwardRef=function(n){return{$$typeof:YP,render:n}};si.isValidElement=yb;si.lazy=function(n){return{$$typeof:QP,_payload:{_status:-1,_result:n},_init:iR}};si.memo=function(n,e){return{$$typeof:JP,type:n,compare:e===void 0?null:e}};si.startTransition=function(n){var e=h1.transition;h1.transition={};try{n()}finally{h1.transition=e}};si.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};si.useCallback=function(n,e){return ba.current.useCallback(n,e)};si.useContext=function(n){return ba.current.useContext(n)};si.useDebugValue=function(){};si.useDeferredValue=function(n){return ba.current.useDeferredValue(n)};si.useEffect=function(n,e){return ba.current.useEffect(n,e)};si.useId=function(){return ba.current.useId()};si.useImperativeHandle=function(n,e,t){return ba.current.useImperativeHandle(n,e,t)};si.useInsertionEffect=function(n,e){return ba.current.useInsertionEffect(n,e)};si.useLayoutEffect=function(n,e){return ba.current.useLayoutEffect(n,e)};si.useMemo=function(n,e){return ba.current.useMemo(n,e)};si.useReducer=function(n,e,t){return ba.current.useReducer(n,e,t)};si.useRef=function(n){return ba.current.useRef(n)};si.useState=function(n){return ba.current.useState(n)};si.useSyncExternalStore=function(n,e,t){return ba.current.useSyncExternalStore(n,e,t)};si.useTransition=function(){return ba.current.useTransition()};si.version="18.2.0";KT.exports=si;var gt=KT.exports;const a6=ZT(gt),aR=XT({__proto__:null,default:a6},[gt]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var sR=gt,oR=Symbol.for("react.element"),lR=Symbol.for("react.fragment"),cR=Object.prototype.hasOwnProperty,uR=sR.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,hR={key:!0,ref:!0,__self:!0,__source:!0};function s6(n,e,t){var i,r={},l=null,h=null;t!==void 0&&(l=""+t),e.key!==void 0&&(l=""+e.key),e.ref!==void 0&&(h=e.ref);for(i in e)cR.call(e,i)&&!hR.hasOwnProperty(i)&&(r[i]=e[i]);if(n&&n.defaultProps)for(i in e=n.defaultProps,e)r[i]===void 0&&(r[i]=e[i]);return{$$typeof:oR,type:n,key:l,ref:h,props:r,_owner:uR.current}}Ty.Fragment=lR;Ty.jsx=s6;Ty.jsxs=s6;YT.exports=Ty;var ge=YT.exports,Vx={},o6={exports:{}},is={},l6={exports:{}},c6={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function e(De,Je){var tt=De.length;De.push(Je);e:for(;0<tt;){var _t=tt-1>>>1,Lt=De[_t];if(0<r(Lt,Je))De[_t]=Je,De[tt]=Lt,tt=_t;else break e}}function t(De){return De.length===0?null:De[0]}function i(De){if(De.length===0)return null;var Je=De[0],tt=De.pop();if(tt!==Je){De[0]=tt;e:for(var _t=0,Lt=De.length,Cn=Lt>>>1;_t<Cn;){var nt=2*(_t+1)-1,wt=De[nt],Ft=nt+1,At=De[Ft];if(0>r(wt,tt))Ft<Lt&&0>r(At,wt)?(De[_t]=At,De[Ft]=tt,_t=Ft):(De[_t]=wt,De[nt]=tt,_t=nt);else if(Ft<Lt&&0>r(At,tt))De[_t]=At,De[Ft]=tt,_t=Ft;else break e}}return Je}function r(De,Je){var tt=De.sortIndex-Je.sortIndex;return tt!==0?tt:De.id-Je.id}if(typeof performance=="object"&&typeof performance.now=="function"){var l=performance;n.unstable_now=function(){return l.now()}}else{var h=Date,o=h.now();n.unstable_now=function(){return h.now()-o}}var p=[],v=[],x=1,M=null,S=3,A=!1,L=!1,F=!1,k=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,V=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function O(De){for(var Je=t(v);Je!==null;){if(Je.callback===null)i(v);else if(Je.startTime<=De)i(v),Je.sortIndex=Je.expirationTime,e(p,Je);else break;Je=t(v)}}function J(De){if(F=!1,O(De),!L)if(t(p)!==null)L=!0,ft(ue);else{var Je=t(v);Je!==null&&ct(J,Je.startTime-De)}}function ue(De,Je){L=!1,F&&(F=!1,C(xe),xe=-1),A=!0;var tt=S;try{for(O(Je),M=t(p);M!==null&&(!(M.expirationTime>Je)||De&&!Me());){var _t=M.callback;if(typeof _t=="function"){M.callback=null,S=M.priorityLevel;var Lt=_t(M.expirationTime<=Je);Je=n.unstable_now(),typeof Lt=="function"?M.callback=Lt:M===t(p)&&i(p),O(Je)}else i(p);M=t(p)}if(M!==null)var Cn=!0;else{var nt=t(v);nt!==null&&ct(J,nt.startTime-Je),Cn=!1}return Cn}finally{M=null,S=tt,A=!1}}var Y=!1,Q=null,xe=-1,re=5,ee=-1;function Me(){return!(n.unstable_now()-ee<re)}function Fe(){if(Q!==null){var De=n.unstable_now();ee=De;var Je=!0;try{Je=Q(!0,De)}finally{Je?Ae():(Y=!1,Q=null)}}else Y=!1}var Ae;if(typeof V=="function")Ae=function(){V(Fe)};else if(typeof MessageChannel<"u"){var He=new MessageChannel,ot=He.port2;He.port1.onmessage=Fe,Ae=function(){ot.postMessage(null)}}else Ae=function(){k(Fe,0)};function ft(De){Q=De,Y||(Y=!0,Ae())}function ct(De,Je){xe=k(function(){De(n.unstable_now())},Je)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(De){De.callback=null},n.unstable_continueExecution=function(){L||A||(L=!0,ft(ue))},n.unstable_forceFrameRate=function(De){0>De||125<De?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<De?Math.floor(1e3/De):5},n.unstable_getCurrentPriorityLevel=function(){return S},n.unstable_getFirstCallbackNode=function(){return t(p)},n.unstable_next=function(De){switch(S){case 1:case 2:case 3:var Je=3;break;default:Je=S}var tt=S;S=Je;try{return De()}finally{S=tt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(De,Je){switch(De){case 1:case 2:case 3:case 4:case 5:break;default:De=3}var tt=S;S=De;try{return Je()}finally{S=tt}},n.unstable_scheduleCallback=function(De,Je,tt){var _t=n.unstable_now();switch(typeof tt=="object"&&tt!==null?(tt=tt.delay,tt=typeof tt=="number"&&0<tt?_t+tt:_t):tt=_t,De){case 1:var Lt=-1;break;case 2:Lt=250;break;case 5:Lt=1073741823;break;case 4:Lt=1e4;break;default:Lt=5e3}return Lt=tt+Lt,De={id:x++,callback:Je,priorityLevel:De,startTime:tt,expirationTime:Lt,sortIndex:-1},tt>_t?(De.sortIndex=tt,e(v,De),t(p)===null&&De===t(v)&&(F?(C(xe),xe=-1):F=!0,ct(J,tt-_t))):(De.sortIndex=Lt,e(p,De),L||A||(L=!0,ft(ue))),De},n.unstable_shouldYield=Me,n.unstable_wrapCallback=function(De){var Je=S;return function(){var tt=S;S=Je;try{return De.apply(this,arguments)}finally{S=tt}}}})(c6);l6.exports=c6;var dR=l6.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var u6=gt,ts=dR;function zt(n){for(var e="https://reactjs.org/docs/error-decoder.html?invariant="+n,t=1;t<arguments.length;t++)e+="&args[]="+encodeURIComponent(arguments[t]);return"Minified React error #"+n+"; visit "+e+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var h6=new Set,cp={};function Yu(n,e){Ud(n,e),Ud(n+"Capture",e)}function Ud(n,e){for(cp[n]=e,n=0;n<e.length;n++)h6.add(e[n])}var ml=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Hx=Object.prototype.hasOwnProperty,fR=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,I3={},k3={};function pR(n){return Hx.call(k3,n)?!0:Hx.call(I3,n)?!1:fR.test(n)?k3[n]=!0:(I3[n]=!0,!1)}function mR(n,e,t,i){if(t!==null&&t.type===0)return!1;switch(typeof e){case"function":case"symbol":return!0;case"boolean":return i?!1:t!==null?!t.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function gR(n,e,t,i){if(e===null||typeof e>"u"||mR(n,e,t,i))return!0;if(i)return!1;if(t!==null)switch(t.type){case 3:return!e;case 4:return e===!1;case 5:return isNaN(e);case 6:return isNaN(e)||1>e}return!1}function wa(n,e,t,i,r,l,h){this.acceptsBooleans=e===2||e===3||e===4,this.attributeName=i,this.attributeNamespace=r,this.mustUseProperty=t,this.propertyName=n,this.type=e,this.sanitizeURL=l,this.removeEmptyString=h}var Hr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){Hr[n]=new wa(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var e=n[0];Hr[e]=new wa(e,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){Hr[n]=new wa(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){Hr[n]=new wa(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){Hr[n]=new wa(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){Hr[n]=new wa(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){Hr[n]=new wa(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){Hr[n]=new wa(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){Hr[n]=new wa(n,5,!1,n.toLowerCase(),null,!1,!1)});var vb=/[\-:]([a-z])/g;function _b(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var e=n.replace(vb,_b);Hr[e]=new wa(e,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var e=n.replace(vb,_b);Hr[e]=new wa(e,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var e=n.replace(vb,_b);Hr[e]=new wa(e,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){Hr[n]=new wa(n,1,!1,n.toLowerCase(),null,!1,!1)});Hr.xlinkHref=new wa("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){Hr[n]=new wa(n,1,!1,n.toLowerCase(),null,!0,!0)});function xb(n,e,t,i){var r=Hr.hasOwnProperty(e)?Hr[e]:null;(r!==null?r.type!==0:i||!(2<e.length)||e[0]!=="o"&&e[0]!=="O"||e[1]!=="n"&&e[1]!=="N")&&(gR(e,t,r,i)&&(t=null),i||r===null?pR(e)&&(t===null?n.removeAttribute(e):n.setAttribute(e,""+t)):r.mustUseProperty?n[r.propertyName]=t===null?r.type===3?!1:"":t:(e=r.attributeName,i=r.attributeNamespace,t===null?n.removeAttribute(e):(r=r.type,t=r===3||r===4&&t===!0?"":""+t,i?n.setAttributeNS(i,e,t):n.setAttribute(e,t))))}var Tl=u6.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,lg=Symbol.for("react.element"),ud=Symbol.for("react.portal"),hd=Symbol.for("react.fragment"),bb=Symbol.for("react.strict_mode"),Gx=Symbol.for("react.profiler"),d6=Symbol.for("react.provider"),f6=Symbol.for("react.context"),wb=Symbol.for("react.forward_ref"),jx=Symbol.for("react.suspense"),Wx=Symbol.for("react.suspense_list"),Sb=Symbol.for("react.memo"),hc=Symbol.for("react.lazy"),p6=Symbol.for("react.offscreen"),D3=Symbol.iterator;function _0(n){return n===null||typeof n!="object"?null:(n=D3&&n[D3]||n["@@iterator"],typeof n=="function"?n:null)}var Ki=Object.assign,u_;function O0(n){if(u_===void 0)try{throw Error()}catch(t){var e=t.stack.trim().match(/\n( *(at )?)/);u_=e&&e[1]||""}return`
`+u_+n}var h_=!1;function d_(n,e){if(!n||h_)return"";h_=!0;var t=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(e)if(e=function(){throw Error()},Object.defineProperty(e.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(e,[])}catch(v){var i=v}Reflect.construct(n,[],e)}else{try{e.call()}catch(v){i=v}n.call(e.prototype)}else{try{throw Error()}catch(v){i=v}n()}}catch(v){if(v&&i&&typeof v.stack=="string"){for(var r=v.stack.split(`
`),l=i.stack.split(`
`),h=r.length-1,o=l.length-1;1<=h&&0<=o&&r[h]!==l[o];)o--;for(;1<=h&&0<=o;h--,o--)if(r[h]!==l[o]){if(h!==1||o!==1)do if(h--,o--,0>o||r[h]!==l[o]){var p=`
`+r[h].replace(" at new "," at ");return n.displayName&&p.includes("<anonymous>")&&(p=p.replace("<anonymous>",n.displayName)),p}while(1<=h&&0<=o);break}}}finally{h_=!1,Error.prepareStackTrace=t}return(n=n?n.displayName||n.name:"")?O0(n):""}function yR(n){switch(n.tag){case 5:return O0(n.type);case 16:return O0("Lazy");case 13:return O0("Suspense");case 19:return O0("SuspenseList");case 0:case 2:case 15:return n=d_(n.type,!1),n;case 11:return n=d_(n.type.render,!1),n;case 1:return n=d_(n.type,!0),n;default:return""}}function qx(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case hd:return"Fragment";case ud:return"Portal";case Gx:return"Profiler";case bb:return"StrictMode";case jx:return"Suspense";case Wx:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case f6:return(n.displayName||"Context")+".Consumer";case d6:return(n._context.displayName||"Context")+".Provider";case wb:var e=n.render;return n=n.displayName,n||(n=e.displayName||e.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Sb:return e=n.displayName||null,e!==null?e:qx(n.type)||"Memo";case hc:e=n._payload,n=n._init;try{return qx(n(e))}catch{}}return null}function vR(n){var e=n.type;switch(n.tag){case 24:return"Cache";case 9:return(e.displayName||"Context")+".Consumer";case 10:return(e._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=e.render,n=n.displayName||n.name||"",e.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return e;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return qx(e);case 8:return e===bb?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e}return null}function kc(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function m6(n){var e=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(e==="checkbox"||e==="radio")}function _R(n){var e=m6(n)?"checked":"value",t=Object.getOwnPropertyDescriptor(n.constructor.prototype,e),i=""+n[e];if(!n.hasOwnProperty(e)&&typeof t<"u"&&typeof t.get=="function"&&typeof t.set=="function"){var r=t.get,l=t.set;return Object.defineProperty(n,e,{configurable:!0,get:function(){return r.call(this)},set:function(h){i=""+h,l.call(this,h)}}),Object.defineProperty(n,e,{enumerable:t.enumerable}),{getValue:function(){return i},setValue:function(h){i=""+h},stopTracking:function(){n._valueTracker=null,delete n[e]}}}}function cg(n){n._valueTracker||(n._valueTracker=_R(n))}function g6(n){if(!n)return!1;var e=n._valueTracker;if(!e)return!0;var t=e.getValue(),i="";return n&&(i=m6(n)?n.checked?"true":"false":n.value),n=i,n!==t?(e.setValue(n),!0):!1}function I1(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function $x(n,e){var t=e.checked;return Ki({},e,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:t??n._wrapperState.initialChecked})}function L3(n,e){var t=e.defaultValue==null?"":e.defaultValue,i=e.checked!=null?e.checked:e.defaultChecked;t=kc(e.value!=null?e.value:t),n._wrapperState={initialChecked:i,initialValue:t,controlled:e.type==="checkbox"||e.type==="radio"?e.checked!=null:e.value!=null}}function y6(n,e){e=e.checked,e!=null&&xb(n,"checked",e,!1)}function Xx(n,e){y6(n,e);var t=kc(e.value),i=e.type;if(t!=null)i==="number"?(t===0&&n.value===""||n.value!=t)&&(n.value=""+t):n.value!==""+t&&(n.value=""+t);else if(i==="submit"||i==="reset"){n.removeAttribute("value");return}e.hasOwnProperty("value")?Zx(n,e.type,t):e.hasOwnProperty("defaultValue")&&Zx(n,e.type,kc(e.defaultValue)),e.checked==null&&e.defaultChecked!=null&&(n.defaultChecked=!!e.defaultChecked)}function z3(n,e,t){if(e.hasOwnProperty("value")||e.hasOwnProperty("defaultValue")){var i=e.type;if(!(i!=="submit"&&i!=="reset"||e.value!==void 0&&e.value!==null))return;e=""+n._wrapperState.initialValue,t||e===n.value||(n.value=e),n.defaultValue=e}t=n.name,t!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,t!==""&&(n.name=t)}function Zx(n,e,t){(e!=="number"||I1(n.ownerDocument)!==n)&&(t==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+t&&(n.defaultValue=""+t))}var U0=Array.isArray;function Cd(n,e,t,i){if(n=n.options,e){e={};for(var r=0;r<t.length;r++)e["$"+t[r]]=!0;for(t=0;t<n.length;t++)r=e.hasOwnProperty("$"+n[t].value),n[t].selected!==r&&(n[t].selected=r),r&&i&&(n[t].defaultSelected=!0)}else{for(t=""+kc(t),e=null,r=0;r<n.length;r++){if(n[r].value===t){n[r].selected=!0,i&&(n[r].defaultSelected=!0);return}e!==null||n[r].disabled||(e=n[r])}e!==null&&(e.selected=!0)}}function Yx(n,e){if(e.dangerouslySetInnerHTML!=null)throw Error(zt(91));return Ki({},e,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function F3(n,e){var t=e.value;if(t==null){if(t=e.children,e=e.defaultValue,t!=null){if(e!=null)throw Error(zt(92));if(U0(t)){if(1<t.length)throw Error(zt(93));t=t[0]}e=t}e==null&&(e=""),t=e}n._wrapperState={initialValue:kc(t)}}function v6(n,e){var t=kc(e.value),i=kc(e.defaultValue);t!=null&&(t=""+t,t!==n.value&&(n.value=t),e.defaultValue==null&&n.defaultValue!==t&&(n.defaultValue=t)),i!=null&&(n.defaultValue=""+i)}function N3(n){var e=n.textContent;e===n._wrapperState.initialValue&&e!==""&&e!==null&&(n.value=e)}function _6(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kx(n,e){return n==null||n==="http://www.w3.org/1999/xhtml"?_6(e):n==="http://www.w3.org/2000/svg"&&e==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var ug,x6=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(e,t,i,r){MSApp.execUnsafeLocalFunction(function(){return n(e,t,i,r)})}:n}(function(n,e){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=e;else{for(ug=ug||document.createElement("div"),ug.innerHTML="<svg>"+e.valueOf().toString()+"</svg>",e=ug.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;e.firstChild;)n.appendChild(e.firstChild)}});function up(n,e){if(e){var t=n.firstChild;if(t&&t===n.lastChild&&t.nodeType===3){t.nodeValue=e;return}}n.textContent=e}var X0={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},xR=["Webkit","ms","Moz","O"];Object.keys(X0).forEach(function(n){xR.forEach(function(e){e=e+n.charAt(0).toUpperCase()+n.substring(1),X0[e]=X0[n]})});function b6(n,e,t){return e==null||typeof e=="boolean"||e===""?"":t||typeof e!="number"||e===0||X0.hasOwnProperty(n)&&X0[n]?(""+e).trim():e+"px"}function w6(n,e){n=n.style;for(var t in e)if(e.hasOwnProperty(t)){var i=t.indexOf("--")===0,r=b6(t,e[t],i);t==="float"&&(t="cssFloat"),i?n.setProperty(t,r):n[t]=r}}var bR=Ki({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Jx(n,e){if(e){if(bR[n]&&(e.children!=null||e.dangerouslySetInnerHTML!=null))throw Error(zt(137,n));if(e.dangerouslySetInnerHTML!=null){if(e.children!=null)throw Error(zt(60));if(typeof e.dangerouslySetInnerHTML!="object"||!("__html"in e.dangerouslySetInnerHTML))throw Error(zt(61))}if(e.style!=null&&typeof e.style!="object")throw Error(zt(62))}}function Qx(n,e){if(n.indexOf("-")===-1)return typeof e.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var e2=null;function Mb(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var t2=null,Pd=null,Rd=null;function B3(n){if(n=Hp(n)){if(typeof t2!="function")throw Error(zt(280));var e=n.stateNode;e&&(e=Ry(e),t2(n.stateNode,n.type,e))}}function S6(n){Pd?Rd?Rd.push(n):Rd=[n]:Pd=n}function M6(){if(Pd){var n=Pd,e=Rd;if(Rd=Pd=null,B3(n),e)for(n=0;n<e.length;n++)B3(e[n])}}function T6(n,e){return n(e)}function E6(){}var f_=!1;function A6(n,e,t){if(f_)return n(e,t);f_=!0;try{return T6(n,e,t)}finally{f_=!1,(Pd!==null||Rd!==null)&&(E6(),M6())}}function hp(n,e){var t=n.stateNode;if(t===null)return null;var i=Ry(t);if(i===null)return null;t=i[e];e:switch(e){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(i=!i.disabled)||(n=n.type,i=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!i;break e;default:n=!1}if(n)return null;if(t&&typeof t!="function")throw Error(zt(231,e,typeof t));return t}var n2=!1;if(ml)try{var x0={};Object.defineProperty(x0,"passive",{get:function(){n2=!0}}),window.addEventListener("test",x0,x0),window.removeEventListener("test",x0,x0)}catch{n2=!1}function wR(n,e,t,i,r,l,h,o,p){var v=Array.prototype.slice.call(arguments,3);try{e.apply(t,v)}catch(x){this.onError(x)}}var Z0=!1,k1=null,D1=!1,i2=null,SR={onError:function(n){Z0=!0,k1=n}};function MR(n,e,t,i,r,l,h,o,p){Z0=!1,k1=null,wR.apply(SR,arguments)}function TR(n,e,t,i,r,l,h,o,p){if(MR.apply(this,arguments),Z0){if(Z0){var v=k1;Z0=!1,k1=null}else throw Error(zt(198));D1||(D1=!0,i2=v)}}function Ku(n){var e=n,t=n;if(n.alternate)for(;e.return;)e=e.return;else{n=e;do e=n,e.flags&4098&&(t=e.return),n=e.return;while(n)}return e.tag===3?t:null}function C6(n){if(n.tag===13){var e=n.memoizedState;if(e===null&&(n=n.alternate,n!==null&&(e=n.memoizedState)),e!==null)return e.dehydrated}return null}function O3(n){if(Ku(n)!==n)throw Error(zt(188))}function ER(n){var e=n.alternate;if(!e){if(e=Ku(n),e===null)throw Error(zt(188));return e!==n?null:n}for(var t=n,i=e;;){var r=t.return;if(r===null)break;var l=r.alternate;if(l===null){if(i=r.return,i!==null){t=i;continue}break}if(r.child===l.child){for(l=r.child;l;){if(l===t)return O3(r),n;if(l===i)return O3(r),e;l=l.sibling}throw Error(zt(188))}if(t.return!==i.return)t=r,i=l;else{for(var h=!1,o=r.child;o;){if(o===t){h=!0,t=r,i=l;break}if(o===i){h=!0,i=r,t=l;break}o=o.sibling}if(!h){for(o=l.child;o;){if(o===t){h=!0,t=l,i=r;break}if(o===i){h=!0,i=l,t=r;break}o=o.sibling}if(!h)throw Error(zt(189))}}if(t.alternate!==i)throw Error(zt(190))}if(t.tag!==3)throw Error(zt(188));return t.stateNode.current===t?n:e}function P6(n){return n=ER(n),n!==null?R6(n):null}function R6(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var e=R6(n);if(e!==null)return e;n=n.sibling}return null}var I6=ts.unstable_scheduleCallback,U3=ts.unstable_cancelCallback,AR=ts.unstable_shouldYield,CR=ts.unstable_requestPaint,dr=ts.unstable_now,PR=ts.unstable_getCurrentPriorityLevel,Tb=ts.unstable_ImmediatePriority,k6=ts.unstable_UserBlockingPriority,L1=ts.unstable_NormalPriority,RR=ts.unstable_LowPriority,D6=ts.unstable_IdlePriority,Ey=null,bo=null;function IR(n){if(bo&&typeof bo.onCommitFiberRoot=="function")try{bo.onCommitFiberRoot(Ey,n,void 0,(n.current.flags&128)===128)}catch{}}var Zs=Math.clz32?Math.clz32:LR,kR=Math.log,DR=Math.LN2;function LR(n){return n>>>=0,n===0?32:31-(kR(n)/DR|0)|0}var hg=64,dg=4194304;function V0(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function z1(n,e){var t=n.pendingLanes;if(t===0)return 0;var i=0,r=n.suspendedLanes,l=n.pingedLanes,h=t&268435455;if(h!==0){var o=h&~r;o!==0?i=V0(o):(l&=h,l!==0&&(i=V0(l)))}else h=t&~r,h!==0?i=V0(h):l!==0&&(i=V0(l));if(i===0)return 0;if(e!==0&&e!==i&&!(e&r)&&(r=i&-i,l=e&-e,r>=l||r===16&&(l&4194240)!==0))return e;if(i&4&&(i|=t&16),e=n.entangledLanes,e!==0)for(n=n.entanglements,e&=i;0<e;)t=31-Zs(e),r=1<<t,i|=n[t],e&=~r;return i}function zR(n,e){switch(n){case 1:case 2:case 4:return e+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function FR(n,e){for(var t=n.suspendedLanes,i=n.pingedLanes,r=n.expirationTimes,l=n.pendingLanes;0<l;){var h=31-Zs(l),o=1<<h,p=r[h];p===-1?(!(o&t)||o&i)&&(r[h]=zR(o,e)):p<=e&&(n.expiredLanes|=o),l&=~o}}function r2(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function L6(){var n=hg;return hg<<=1,!(hg&4194240)&&(hg=64),n}function p_(n){for(var e=[],t=0;31>t;t++)e.push(n);return e}function Up(n,e,t){n.pendingLanes|=e,e!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,e=31-Zs(e),n[e]=t}function NR(n,e){var t=n.pendingLanes&~e;n.pendingLanes=e,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=e,n.mutableReadLanes&=e,n.entangledLanes&=e,e=n.entanglements;var i=n.eventTimes;for(n=n.expirationTimes;0<t;){var r=31-Zs(t),l=1<<r;e[r]=0,i[r]=-1,n[r]=-1,t&=~l}}function Eb(n,e){var t=n.entangledLanes|=e;for(n=n.entanglements;t;){var i=31-Zs(t),r=1<<i;r&e|n[i]&e&&(n[i]|=e),t&=~r}}var _i=0;function z6(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var F6,Ab,N6,B6,O6,a2=!1,fg=[],bc=null,wc=null,Sc=null,dp=new Map,fp=new Map,pc=[],BR="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function V3(n,e){switch(n){case"focusin":case"focusout":bc=null;break;case"dragenter":case"dragleave":wc=null;break;case"mouseover":case"mouseout":Sc=null;break;case"pointerover":case"pointerout":dp.delete(e.pointerId);break;case"gotpointercapture":case"lostpointercapture":fp.delete(e.pointerId)}}function b0(n,e,t,i,r,l){return n===null||n.nativeEvent!==l?(n={blockedOn:e,domEventName:t,eventSystemFlags:i,nativeEvent:l,targetContainers:[r]},e!==null&&(e=Hp(e),e!==null&&Ab(e)),n):(n.eventSystemFlags|=i,e=n.targetContainers,r!==null&&e.indexOf(r)===-1&&e.push(r),n)}function OR(n,e,t,i,r){switch(e){case"focusin":return bc=b0(bc,n,e,t,i,r),!0;case"dragenter":return wc=b0(wc,n,e,t,i,r),!0;case"mouseover":return Sc=b0(Sc,n,e,t,i,r),!0;case"pointerover":var l=r.pointerId;return dp.set(l,b0(dp.get(l)||null,n,e,t,i,r)),!0;case"gotpointercapture":return l=r.pointerId,fp.set(l,b0(fp.get(l)||null,n,e,t,i,r)),!0}return!1}function U6(n){var e=Cu(n.target);if(e!==null){var t=Ku(e);if(t!==null){if(e=t.tag,e===13){if(e=C6(t),e!==null){n.blockedOn=e,O6(n.priority,function(){N6(t)});return}}else if(e===3&&t.stateNode.current.memoizedState.isDehydrated){n.blockedOn=t.tag===3?t.stateNode.containerInfo:null;return}}}n.blockedOn=null}function d1(n){if(n.blockedOn!==null)return!1;for(var e=n.targetContainers;0<e.length;){var t=s2(n.domEventName,n.eventSystemFlags,e[0],n.nativeEvent);if(t===null){t=n.nativeEvent;var i=new t.constructor(t.type,t);e2=i,t.target.dispatchEvent(i),e2=null}else return e=Hp(t),e!==null&&Ab(e),n.blockedOn=t,!1;e.shift()}return!0}function H3(n,e,t){d1(n)&&t.delete(e)}function UR(){a2=!1,bc!==null&&d1(bc)&&(bc=null),wc!==null&&d1(wc)&&(wc=null),Sc!==null&&d1(Sc)&&(Sc=null),dp.forEach(H3),fp.forEach(H3)}function w0(n,e){n.blockedOn===e&&(n.blockedOn=null,a2||(a2=!0,ts.unstable_scheduleCallback(ts.unstable_NormalPriority,UR)))}function pp(n){function e(r){return w0(r,n)}if(0<fg.length){w0(fg[0],n);for(var t=1;t<fg.length;t++){var i=fg[t];i.blockedOn===n&&(i.blockedOn=null)}}for(bc!==null&&w0(bc,n),wc!==null&&w0(wc,n),Sc!==null&&w0(Sc,n),dp.forEach(e),fp.forEach(e),t=0;t<pc.length;t++)i=pc[t],i.blockedOn===n&&(i.blockedOn=null);for(;0<pc.length&&(t=pc[0],t.blockedOn===null);)U6(t),t.blockedOn===null&&pc.shift()}var Id=Tl.ReactCurrentBatchConfig,F1=!0;function VR(n,e,t,i){var r=_i,l=Id.transition;Id.transition=null;try{_i=1,Cb(n,e,t,i)}finally{_i=r,Id.transition=l}}function HR(n,e,t,i){var r=_i,l=Id.transition;Id.transition=null;try{_i=4,Cb(n,e,t,i)}finally{_i=r,Id.transition=l}}function Cb(n,e,t,i){if(F1){var r=s2(n,e,t,i);if(r===null)M_(n,e,i,N1,t),V3(n,i);else if(OR(r,n,e,t,i))i.stopPropagation();else if(V3(n,i),e&4&&-1<BR.indexOf(n)){for(;r!==null;){var l=Hp(r);if(l!==null&&F6(l),l=s2(n,e,t,i),l===null&&M_(n,e,i,N1,t),l===r)break;r=l}r!==null&&i.stopPropagation()}else M_(n,e,i,null,t)}}var N1=null;function s2(n,e,t,i){if(N1=null,n=Mb(i),n=Cu(n),n!==null)if(e=Ku(n),e===null)n=null;else if(t=e.tag,t===13){if(n=C6(e),n!==null)return n;n=null}else if(t===3){if(e.stateNode.current.memoizedState.isDehydrated)return e.tag===3?e.stateNode.containerInfo:null;n=null}else e!==n&&(n=null);return N1=n,null}function V6(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(PR()){case Tb:return 1;case k6:return 4;case L1:case RR:return 16;case D6:return 536870912;default:return 16}default:return 16}}var yc=null,Pb=null,f1=null;function H6(){if(f1)return f1;var n,e=Pb,t=e.length,i,r="value"in yc?yc.value:yc.textContent,l=r.length;for(n=0;n<t&&e[n]===r[n];n++);var h=t-n;for(i=1;i<=h&&e[t-i]===r[l-i];i++);return f1=r.slice(n,1<i?1-i:void 0)}function p1(n){var e=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&e===13&&(n=13)):n=e,n===10&&(n=13),32<=n||n===13?n:0}function pg(){return!0}function G3(){return!1}function rs(n){function e(t,i,r,l,h){this._reactName=t,this._targetInst=r,this.type=i,this.nativeEvent=l,this.target=h,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(t=n[o],this[o]=t?t(l):l[o]);return this.isDefaultPrevented=(l.defaultPrevented!=null?l.defaultPrevented:l.returnValue===!1)?pg:G3,this.isPropagationStopped=G3,this}return Ki(e.prototype,{preventDefault:function(){this.defaultPrevented=!0;var t=this.nativeEvent;t&&(t.preventDefault?t.preventDefault():typeof t.returnValue!="unknown"&&(t.returnValue=!1),this.isDefaultPrevented=pg)},stopPropagation:function(){var t=this.nativeEvent;t&&(t.stopPropagation?t.stopPropagation():typeof t.cancelBubble!="unknown"&&(t.cancelBubble=!0),this.isPropagationStopped=pg)},persist:function(){},isPersistent:pg}),e}var rf={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Rb=rs(rf),Vp=Ki({},rf,{view:0,detail:0}),GR=rs(Vp),m_,g_,S0,Ay=Ki({},Vp,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Ib,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==S0&&(S0&&n.type==="mousemove"?(m_=n.screenX-S0.screenX,g_=n.screenY-S0.screenY):g_=m_=0,S0=n),m_)},movementY:function(n){return"movementY"in n?n.movementY:g_}}),j3=rs(Ay),jR=Ki({},Ay,{dataTransfer:0}),WR=rs(jR),qR=Ki({},Vp,{relatedTarget:0}),y_=rs(qR),$R=Ki({},rf,{animationName:0,elapsedTime:0,pseudoElement:0}),XR=rs($R),ZR=Ki({},rf,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),YR=rs(ZR),KR=Ki({},rf,{data:0}),W3=rs(KR),JR={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},QR={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},e9={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function t9(n){var e=this.nativeEvent;return e.getModifierState?e.getModifierState(n):(n=e9[n])?!!e[n]:!1}function Ib(){return t9}var n9=Ki({},Vp,{key:function(n){if(n.key){var e=JR[n.key]||n.key;if(e!=="Unidentified")return e}return n.type==="keypress"?(n=p1(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?QR[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Ib,charCode:function(n){return n.type==="keypress"?p1(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?p1(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),i9=rs(n9),r9=Ki({},Ay,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),q3=rs(r9),a9=Ki({},Vp,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Ib}),s9=rs(a9),o9=Ki({},rf,{propertyName:0,elapsedTime:0,pseudoElement:0}),l9=rs(o9),c9=Ki({},Ay,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),u9=rs(c9),h9=[9,13,27,32],kb=ml&&"CompositionEvent"in window,Y0=null;ml&&"documentMode"in document&&(Y0=document.documentMode);var d9=ml&&"TextEvent"in window&&!Y0,G6=ml&&(!kb||Y0&&8<Y0&&11>=Y0),$3=" ",X3=!1;function j6(n,e){switch(n){case"keyup":return h9.indexOf(e.keyCode)!==-1;case"keydown":return e.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function W6(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var dd=!1;function f9(n,e){switch(n){case"compositionend":return W6(e);case"keypress":return e.which!==32?null:(X3=!0,$3);case"textInput":return n=e.data,n===$3&&X3?null:n;default:return null}}function p9(n,e){if(dd)return n==="compositionend"||!kb&&j6(n,e)?(n=H6(),f1=Pb=yc=null,dd=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(e.ctrlKey||e.altKey||e.metaKey)||e.ctrlKey&&e.altKey){if(e.char&&1<e.char.length)return e.char;if(e.which)return String.fromCharCode(e.which)}return null;case"compositionend":return G6&&e.locale!=="ko"?null:e.data;default:return null}}var m9={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Z3(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e==="input"?!!m9[n.type]:e==="textarea"}function q6(n,e,t,i){S6(i),e=B1(e,"onChange"),0<e.length&&(t=new Rb("onChange","change",null,t,i),n.push({event:t,listeners:e}))}var K0=null,mp=null;function g9(n){iE(n,0)}function Cy(n){var e=md(n);if(g6(e))return n}function y9(n,e){if(n==="change")return e}var $6=!1;if(ml){var v_;if(ml){var __="oninput"in document;if(!__){var Y3=document.createElement("div");Y3.setAttribute("oninput","return;"),__=typeof Y3.oninput=="function"}v_=__}else v_=!1;$6=v_&&(!document.documentMode||9<document.documentMode)}function K3(){K0&&(K0.detachEvent("onpropertychange",X6),mp=K0=null)}function X6(n){if(n.propertyName==="value"&&Cy(mp)){var e=[];q6(e,mp,n,Mb(n)),A6(g9,e)}}function v9(n,e,t){n==="focusin"?(K3(),K0=e,mp=t,K0.attachEvent("onpropertychange",X6)):n==="focusout"&&K3()}function _9(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Cy(mp)}function x9(n,e){if(n==="click")return Cy(e)}function b9(n,e){if(n==="input"||n==="change")return Cy(e)}function w9(n,e){return n===e&&(n!==0||1/n===1/e)||n!==n&&e!==e}var Ks=typeof Object.is=="function"?Object.is:w9;function gp(n,e){if(Ks(n,e))return!0;if(typeof n!="object"||n===null||typeof e!="object"||e===null)return!1;var t=Object.keys(n),i=Object.keys(e);if(t.length!==i.length)return!1;for(i=0;i<t.length;i++){var r=t[i];if(!Hx.call(e,r)||!Ks(n[r],e[r]))return!1}return!0}function J3(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function Q3(n,e){var t=J3(n);n=0;for(var i;t;){if(t.nodeType===3){if(i=n+t.textContent.length,n<=e&&i>=e)return{node:t,offset:e-n};n=i}e:{for(;t;){if(t.nextSibling){t=t.nextSibling;break e}t=t.parentNode}t=void 0}t=J3(t)}}function Z6(n,e){return n&&e?n===e?!0:n&&n.nodeType===3?!1:e&&e.nodeType===3?Z6(n,e.parentNode):"contains"in n?n.contains(e):n.compareDocumentPosition?!!(n.compareDocumentPosition(e)&16):!1:!1}function Y6(){for(var n=window,e=I1();e instanceof n.HTMLIFrameElement;){try{var t=typeof e.contentWindow.location.href=="string"}catch{t=!1}if(t)n=e.contentWindow;else break;e=I1(n.document)}return e}function Db(n){var e=n&&n.nodeName&&n.nodeName.toLowerCase();return e&&(e==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||e==="textarea"||n.contentEditable==="true")}function S9(n){var e=Y6(),t=n.focusedElem,i=n.selectionRange;if(e!==t&&t&&t.ownerDocument&&Z6(t.ownerDocument.documentElement,t)){if(i!==null&&Db(t)){if(e=i.start,n=i.end,n===void 0&&(n=e),"selectionStart"in t)t.selectionStart=e,t.selectionEnd=Math.min(n,t.value.length);else if(n=(e=t.ownerDocument||document)&&e.defaultView||window,n.getSelection){n=n.getSelection();var r=t.textContent.length,l=Math.min(i.start,r);i=i.end===void 0?l:Math.min(i.end,r),!n.extend&&l>i&&(r=i,i=l,l=r),r=Q3(t,l);var h=Q3(t,i);r&&h&&(n.rangeCount!==1||n.anchorNode!==r.node||n.anchorOffset!==r.offset||n.focusNode!==h.node||n.focusOffset!==h.offset)&&(e=e.createRange(),e.setStart(r.node,r.offset),n.removeAllRanges(),l>i?(n.addRange(e),n.extend(h.node,h.offset)):(e.setEnd(h.node,h.offset),n.addRange(e)))}}for(e=[],n=t;n=n.parentNode;)n.nodeType===1&&e.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof t.focus=="function"&&t.focus(),t=0;t<e.length;t++)n=e[t],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var M9=ml&&"documentMode"in document&&11>=document.documentMode,fd=null,o2=null,J0=null,l2=!1;function eS(n,e,t){var i=t.window===t?t.document:t.nodeType===9?t:t.ownerDocument;l2||fd==null||fd!==I1(i)||(i=fd,"selectionStart"in i&&Db(i)?i={start:i.selectionStart,end:i.selectionEnd}:(i=(i.ownerDocument&&i.ownerDocument.defaultView||window).getSelection(),i={anchorNode:i.anchorNode,anchorOffset:i.anchorOffset,focusNode:i.focusNode,focusOffset:i.focusOffset}),J0&&gp(J0,i)||(J0=i,i=B1(o2,"onSelect"),0<i.length&&(e=new Rb("onSelect","select",null,e,t),n.push({event:e,listeners:i}),e.target=fd)))}function mg(n,e){var t={};return t[n.toLowerCase()]=e.toLowerCase(),t["Webkit"+n]="webkit"+e,t["Moz"+n]="moz"+e,t}var pd={animationend:mg("Animation","AnimationEnd"),animationiteration:mg("Animation","AnimationIteration"),animationstart:mg("Animation","AnimationStart"),transitionend:mg("Transition","TransitionEnd")},x_={},K6={};ml&&(K6=document.createElement("div").style,"AnimationEvent"in window||(delete pd.animationend.animation,delete pd.animationiteration.animation,delete pd.animationstart.animation),"TransitionEvent"in window||delete pd.transitionend.transition);function Py(n){if(x_[n])return x_[n];if(!pd[n])return n;var e=pd[n],t;for(t in e)if(e.hasOwnProperty(t)&&t in K6)return x_[n]=e[t];return n}var J6=Py("animationend"),Q6=Py("animationiteration"),eE=Py("animationstart"),tE=Py("transitionend"),nE=new Map,tS="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Bc(n,e){nE.set(n,e),Yu(e,[n])}for(var b_=0;b_<tS.length;b_++){var w_=tS[b_],T9=w_.toLowerCase(),E9=w_[0].toUpperCase()+w_.slice(1);Bc(T9,"on"+E9)}Bc(J6,"onAnimationEnd");Bc(Q6,"onAnimationIteration");Bc(eE,"onAnimationStart");Bc("dblclick","onDoubleClick");Bc("focusin","onFocus");Bc("focusout","onBlur");Bc(tE,"onTransitionEnd");Ud("onMouseEnter",["mouseout","mouseover"]);Ud("onMouseLeave",["mouseout","mouseover"]);Ud("onPointerEnter",["pointerout","pointerover"]);Ud("onPointerLeave",["pointerout","pointerover"]);Yu("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Yu("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Yu("onBeforeInput",["compositionend","keypress","textInput","paste"]);Yu("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Yu("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Yu("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var H0="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),A9=new Set("cancel close invalid load scroll toggle".split(" ").concat(H0));function nS(n,e,t){var i=n.type||"unknown-event";n.currentTarget=t,TR(i,e,void 0,n),n.currentTarget=null}function iE(n,e){e=(e&4)!==0;for(var t=0;t<n.length;t++){var i=n[t],r=i.event;i=i.listeners;e:{var l=void 0;if(e)for(var h=i.length-1;0<=h;h--){var o=i[h],p=o.instance,v=o.currentTarget;if(o=o.listener,p!==l&&r.isPropagationStopped())break e;nS(r,o,v),l=p}else for(h=0;h<i.length;h++){if(o=i[h],p=o.instance,v=o.currentTarget,o=o.listener,p!==l&&r.isPropagationStopped())break e;nS(r,o,v),l=p}}}if(D1)throw n=i2,D1=!1,i2=null,n}function Ni(n,e){var t=e[f2];t===void 0&&(t=e[f2]=new Set);var i=n+"__bubble";t.has(i)||(rE(e,n,2,!1),t.add(i))}function S_(n,e,t){var i=0;e&&(i|=4),rE(t,n,i,e)}var gg="_reactListening"+Math.random().toString(36).slice(2);function yp(n){if(!n[gg]){n[gg]=!0,h6.forEach(function(t){t!=="selectionchange"&&(A9.has(t)||S_(t,!1,n),S_(t,!0,n))});var e=n.nodeType===9?n:n.ownerDocument;e===null||e[gg]||(e[gg]=!0,S_("selectionchange",!1,e))}}function rE(n,e,t,i){switch(V6(e)){case 1:var r=VR;break;case 4:r=HR;break;default:r=Cb}t=r.bind(null,e,t,n),r=void 0,!n2||e!=="touchstart"&&e!=="touchmove"&&e!=="wheel"||(r=!0),i?r!==void 0?n.addEventListener(e,t,{capture:!0,passive:r}):n.addEventListener(e,t,!0):r!==void 0?n.addEventListener(e,t,{passive:r}):n.addEventListener(e,t,!1)}function M_(n,e,t,i,r){var l=i;if(!(e&1)&&!(e&2)&&i!==null)e:for(;;){if(i===null)return;var h=i.tag;if(h===3||h===4){var o=i.stateNode.containerInfo;if(o===r||o.nodeType===8&&o.parentNode===r)break;if(h===4)for(h=i.return;h!==null;){var p=h.tag;if((p===3||p===4)&&(p=h.stateNode.containerInfo,p===r||p.nodeType===8&&p.parentNode===r))return;h=h.return}for(;o!==null;){if(h=Cu(o),h===null)return;if(p=h.tag,p===5||p===6){i=l=h;continue e}o=o.parentNode}}i=i.return}A6(function(){var v=l,x=Mb(t),M=[];e:{var S=nE.get(n);if(S!==void 0){var A=Rb,L=n;switch(n){case"keypress":if(p1(t)===0)break e;case"keydown":case"keyup":A=i9;break;case"focusin":L="focus",A=y_;break;case"focusout":L="blur",A=y_;break;case"beforeblur":case"afterblur":A=y_;break;case"click":if(t.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":A=j3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":A=WR;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":A=s9;break;case J6:case Q6:case eE:A=XR;break;case tE:A=l9;break;case"scroll":A=GR;break;case"wheel":A=u9;break;case"copy":case"cut":case"paste":A=YR;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":A=q3}var F=(e&4)!==0,k=!F&&n==="scroll",C=F?S!==null?S+"Capture":null:S;F=[];for(var V=v,O;V!==null;){O=V;var J=O.stateNode;if(O.tag===5&&J!==null&&(O=J,C!==null&&(J=hp(V,C),J!=null&&F.push(vp(V,J,O)))),k)break;V=V.return}0<F.length&&(S=new A(S,L,null,t,x),M.push({event:S,listeners:F}))}}if(!(e&7)){e:{if(S=n==="mouseover"||n==="pointerover",A=n==="mouseout"||n==="pointerout",S&&t!==e2&&(L=t.relatedTarget||t.fromElement)&&(Cu(L)||L[gl]))break e;if((A||S)&&(S=x.window===x?x:(S=x.ownerDocument)?S.defaultView||S.parentWindow:window,A?(L=t.relatedTarget||t.toElement,A=v,L=L?Cu(L):null,L!==null&&(k=Ku(L),L!==k||L.tag!==5&&L.tag!==6)&&(L=null)):(A=null,L=v),A!==L)){if(F=j3,J="onMouseLeave",C="onMouseEnter",V="mouse",(n==="pointerout"||n==="pointerover")&&(F=q3,J="onPointerLeave",C="onPointerEnter",V="pointer"),k=A==null?S:md(A),O=L==null?S:md(L),S=new F(J,V+"leave",A,t,x),S.target=k,S.relatedTarget=O,J=null,Cu(x)===v&&(F=new F(C,V+"enter",L,t,x),F.target=O,F.relatedTarget=k,J=F),k=J,A&&L)t:{for(F=A,C=L,V=0,O=F;O;O=Nh(O))V++;for(O=0,J=C;J;J=Nh(J))O++;for(;0<V-O;)F=Nh(F),V--;for(;0<O-V;)C=Nh(C),O--;for(;V--;){if(F===C||C!==null&&F===C.alternate)break t;F=Nh(F),C=Nh(C)}F=null}else F=null;A!==null&&iS(M,S,A,F,!1),L!==null&&k!==null&&iS(M,k,L,F,!0)}}e:{if(S=v?md(v):window,A=S.nodeName&&S.nodeName.toLowerCase(),A==="select"||A==="input"&&S.type==="file")var ue=y9;else if(Z3(S))if($6)ue=b9;else{ue=_9;var Y=v9}else(A=S.nodeName)&&A.toLowerCase()==="input"&&(S.type==="checkbox"||S.type==="radio")&&(ue=x9);if(ue&&(ue=ue(n,v))){q6(M,ue,t,x);break e}Y&&Y(n,S,v),n==="focusout"&&(Y=S._wrapperState)&&Y.controlled&&S.type==="number"&&Zx(S,"number",S.value)}switch(Y=v?md(v):window,n){case"focusin":(Z3(Y)||Y.contentEditable==="true")&&(fd=Y,o2=v,J0=null);break;case"focusout":J0=o2=fd=null;break;case"mousedown":l2=!0;break;case"contextmenu":case"mouseup":case"dragend":l2=!1,eS(M,t,x);break;case"selectionchange":if(M9)break;case"keydown":case"keyup":eS(M,t,x)}var Q;if(kb)e:{switch(n){case"compositionstart":var xe="onCompositionStart";break e;case"compositionend":xe="onCompositionEnd";break e;case"compositionupdate":xe="onCompositionUpdate";break e}xe=void 0}else dd?j6(n,t)&&(xe="onCompositionEnd"):n==="keydown"&&t.keyCode===229&&(xe="onCompositionStart");xe&&(G6&&t.locale!=="ko"&&(dd||xe!=="onCompositionStart"?xe==="onCompositionEnd"&&dd&&(Q=H6()):(yc=x,Pb="value"in yc?yc.value:yc.textContent,dd=!0)),Y=B1(v,xe),0<Y.length&&(xe=new W3(xe,n,null,t,x),M.push({event:xe,listeners:Y}),Q?xe.data=Q:(Q=W6(t),Q!==null&&(xe.data=Q)))),(Q=d9?f9(n,t):p9(n,t))&&(v=B1(v,"onBeforeInput"),0<v.length&&(x=new W3("onBeforeInput","beforeinput",null,t,x),M.push({event:x,listeners:v}),x.data=Q))}iE(M,e)})}function vp(n,e,t){return{instance:n,listener:e,currentTarget:t}}function B1(n,e){for(var t=e+"Capture",i=[];n!==null;){var r=n,l=r.stateNode;r.tag===5&&l!==null&&(r=l,l=hp(n,t),l!=null&&i.unshift(vp(n,l,r)),l=hp(n,e),l!=null&&i.push(vp(n,l,r))),n=n.return}return i}function Nh(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function iS(n,e,t,i,r){for(var l=e._reactName,h=[];t!==null&&t!==i;){var o=t,p=o.alternate,v=o.stateNode;if(p!==null&&p===i)break;o.tag===5&&v!==null&&(o=v,r?(p=hp(t,l),p!=null&&h.unshift(vp(t,p,o))):r||(p=hp(t,l),p!=null&&h.push(vp(t,p,o)))),t=t.return}h.length!==0&&n.push({event:e,listeners:h})}var C9=/\r\n?/g,P9=/\u0000|\uFFFD/g;function rS(n){return(typeof n=="string"?n:""+n).replace(C9,`
`).replace(P9,"")}function yg(n,e,t){if(e=rS(e),rS(n)!==e&&t)throw Error(zt(425))}function O1(){}var c2=null,u2=null;function h2(n,e){return n==="textarea"||n==="noscript"||typeof e.children=="string"||typeof e.children=="number"||typeof e.dangerouslySetInnerHTML=="object"&&e.dangerouslySetInnerHTML!==null&&e.dangerouslySetInnerHTML.__html!=null}var d2=typeof setTimeout=="function"?setTimeout:void 0,R9=typeof clearTimeout=="function"?clearTimeout:void 0,aS=typeof Promise=="function"?Promise:void 0,I9=typeof queueMicrotask=="function"?queueMicrotask:typeof aS<"u"?function(n){return aS.resolve(null).then(n).catch(k9)}:d2;function k9(n){setTimeout(function(){throw n})}function T_(n,e){var t=e,i=0;do{var r=t.nextSibling;if(n.removeChild(t),r&&r.nodeType===8)if(t=r.data,t==="/$"){if(i===0){n.removeChild(r),pp(e);return}i--}else t!=="$"&&t!=="$?"&&t!=="$!"||i++;t=r}while(t);pp(e)}function Mc(n){for(;n!=null;n=n.nextSibling){var e=n.nodeType;if(e===1||e===3)break;if(e===8){if(e=n.data,e==="$"||e==="$!"||e==="$?")break;if(e==="/$")return null}}return n}function sS(n){n=n.previousSibling;for(var e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="$"||t==="$!"||t==="$?"){if(e===0)return n;e--}else t==="/$"&&e++}n=n.previousSibling}return null}var af=Math.random().toString(36).slice(2),po="__reactFiber$"+af,_p="__reactProps$"+af,gl="__reactContainer$"+af,f2="__reactEvents$"+af,D9="__reactListeners$"+af,L9="__reactHandles$"+af;function Cu(n){var e=n[po];if(e)return e;for(var t=n.parentNode;t;){if(e=t[gl]||t[po]){if(t=e.alternate,e.child!==null||t!==null&&t.child!==null)for(n=sS(n);n!==null;){if(t=n[po])return t;n=sS(n)}return e}n=t,t=n.parentNode}return null}function Hp(n){return n=n[po]||n[gl],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function md(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(zt(33))}function Ry(n){return n[_p]||null}var p2=[],gd=-1;function Oc(n){return{current:n}}function Oi(n){0>gd||(n.current=p2[gd],p2[gd]=null,gd--)}function ki(n,e){gd++,p2[gd]=n.current,n.current=e}var Dc={},aa=Oc(Dc),Da=Oc(!1),Ou=Dc;function Vd(n,e){var t=n.type.contextTypes;if(!t)return Dc;var i=n.stateNode;if(i&&i.__reactInternalMemoizedUnmaskedChildContext===e)return i.__reactInternalMemoizedMaskedChildContext;var r={},l;for(l in t)r[l]=e[l];return i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=e,n.__reactInternalMemoizedMaskedChildContext=r),r}function La(n){return n=n.childContextTypes,n!=null}function U1(){Oi(Da),Oi(aa)}function oS(n,e,t){if(aa.current!==Dc)throw Error(zt(168));ki(aa,e),ki(Da,t)}function aE(n,e,t){var i=n.stateNode;if(e=e.childContextTypes,typeof i.getChildContext!="function")return t;i=i.getChildContext();for(var r in i)if(!(r in e))throw Error(zt(108,vR(n)||"Unknown",r));return Ki({},t,i)}function V1(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Dc,Ou=aa.current,ki(aa,n),ki(Da,Da.current),!0}function lS(n,e,t){var i=n.stateNode;if(!i)throw Error(zt(169));t?(n=aE(n,e,Ou),i.__reactInternalMemoizedMergedChildContext=n,Oi(Da),Oi(aa),ki(aa,n)):Oi(Da),ki(Da,t)}var al=null,Iy=!1,E_=!1;function sE(n){al===null?al=[n]:al.push(n)}function z9(n){Iy=!0,sE(n)}function Uc(){if(!E_&&al!==null){E_=!0;var n=0,e=_i;try{var t=al;for(_i=1;n<t.length;n++){var i=t[n];do i=i(!0);while(i!==null)}al=null,Iy=!1}catch(r){throw al!==null&&(al=al.slice(n+1)),I6(Tb,Uc),r}finally{_i=e,E_=!1}}return null}var yd=[],vd=0,H1=null,G1=0,ms=[],gs=0,Uu=null,ll=1,cl="";function wu(n,e){yd[vd++]=G1,yd[vd++]=H1,H1=n,G1=e}function oE(n,e,t){ms[gs++]=ll,ms[gs++]=cl,ms[gs++]=Uu,Uu=n;var i=ll;n=cl;var r=32-Zs(i)-1;i&=~(1<<r),t+=1;var l=32-Zs(e)+r;if(30<l){var h=r-r%5;l=(i&(1<<h)-1).toString(32),i>>=h,r-=h,ll=1<<32-Zs(e)+r|t<<r|i,cl=l+n}else ll=1<<l|t<<r|i,cl=n}function Lb(n){n.return!==null&&(wu(n,1),oE(n,1,0))}function zb(n){for(;n===H1;)H1=yd[--vd],yd[vd]=null,G1=yd[--vd],yd[vd]=null;for(;n===Uu;)Uu=ms[--gs],ms[gs]=null,cl=ms[--gs],ms[gs]=null,ll=ms[--gs],ms[gs]=null}var Qa=null,Ka=null,Hi=!1,Ws=null;function lE(n,e){var t=_s(5,null,null,0);t.elementType="DELETED",t.stateNode=e,t.return=n,e=n.deletions,e===null?(n.deletions=[t],n.flags|=16):e.push(t)}function cS(n,e){switch(n.tag){case 5:var t=n.type;return e=e.nodeType!==1||t.toLowerCase()!==e.nodeName.toLowerCase()?null:e,e!==null?(n.stateNode=e,Qa=n,Ka=Mc(e.firstChild),!0):!1;case 6:return e=n.pendingProps===""||e.nodeType!==3?null:e,e!==null?(n.stateNode=e,Qa=n,Ka=null,!0):!1;case 13:return e=e.nodeType!==8?null:e,e!==null?(t=Uu!==null?{id:ll,overflow:cl}:null,n.memoizedState={dehydrated:e,treeContext:t,retryLane:1073741824},t=_s(18,null,null,0),t.stateNode=e,t.return=n,n.child=t,Qa=n,Ka=null,!0):!1;default:return!1}}function m2(n){return(n.mode&1)!==0&&(n.flags&128)===0}function g2(n){if(Hi){var e=Ka;if(e){var t=e;if(!cS(n,e)){if(m2(n))throw Error(zt(418));e=Mc(t.nextSibling);var i=Qa;e&&cS(n,e)?lE(i,t):(n.flags=n.flags&-4097|2,Hi=!1,Qa=n)}}else{if(m2(n))throw Error(zt(418));n.flags=n.flags&-4097|2,Hi=!1,Qa=n}}}function uS(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Qa=n}function vg(n){if(n!==Qa)return!1;if(!Hi)return uS(n),Hi=!0,!1;var e;if((e=n.tag!==3)&&!(e=n.tag!==5)&&(e=n.type,e=e!=="head"&&e!=="body"&&!h2(n.type,n.memoizedProps)),e&&(e=Ka)){if(m2(n))throw cE(),Error(zt(418));for(;e;)lE(n,e),e=Mc(e.nextSibling)}if(uS(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(zt(317));e:{for(n=n.nextSibling,e=0;n;){if(n.nodeType===8){var t=n.data;if(t==="/$"){if(e===0){Ka=Mc(n.nextSibling);break e}e--}else t!=="$"&&t!=="$!"&&t!=="$?"||e++}n=n.nextSibling}Ka=null}}else Ka=Qa?Mc(n.stateNode.nextSibling):null;return!0}function cE(){for(var n=Ka;n;)n=Mc(n.nextSibling)}function Hd(){Ka=Qa=null,Hi=!1}function Fb(n){Ws===null?Ws=[n]:Ws.push(n)}var F9=Tl.ReactCurrentBatchConfig;function Vs(n,e){if(n&&n.defaultProps){e=Ki({},e),n=n.defaultProps;for(var t in n)e[t]===void 0&&(e[t]=n[t]);return e}return e}var j1=Oc(null),W1=null,_d=null,Nb=null;function Bb(){Nb=_d=W1=null}function Ob(n){var e=j1.current;Oi(j1),n._currentValue=e}function y2(n,e,t){for(;n!==null;){var i=n.alternate;if((n.childLanes&e)!==e?(n.childLanes|=e,i!==null&&(i.childLanes|=e)):i!==null&&(i.childLanes&e)!==e&&(i.childLanes|=e),n===t)break;n=n.return}}function kd(n,e){W1=n,Nb=_d=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&e&&(Ia=!0),n.firstContext=null)}function Ts(n){var e=n._currentValue;if(Nb!==n)if(n={context:n,memoizedValue:e,next:null},_d===null){if(W1===null)throw Error(zt(308));_d=n,W1.dependencies={lanes:0,firstContext:n}}else _d=_d.next=n;return e}var Pu=null;function Ub(n){Pu===null?Pu=[n]:Pu.push(n)}function uE(n,e,t,i){var r=e.interleaved;return r===null?(t.next=t,Ub(e)):(t.next=r.next,r.next=t),e.interleaved=t,yl(n,i)}function yl(n,e){n.lanes|=e;var t=n.alternate;for(t!==null&&(t.lanes|=e),t=n,n=n.return;n!==null;)n.childLanes|=e,t=n.alternate,t!==null&&(t.childLanes|=e),t=n,n=n.return;return t.tag===3?t.stateNode:null}var dc=!1;function Vb(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function hE(n,e){n=n.updateQueue,e.updateQueue===n&&(e.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function hl(n,e){return{eventTime:n,lane:e,tag:0,payload:null,callback:null,next:null}}function Tc(n,e,t){var i=n.updateQueue;if(i===null)return null;if(i=i.shared,ui&2){var r=i.pending;return r===null?e.next=e:(e.next=r.next,r.next=e),i.pending=e,yl(n,t)}return r=i.interleaved,r===null?(e.next=e,Ub(i)):(e.next=r.next,r.next=e),i.interleaved=e,yl(n,t)}function m1(n,e,t){if(e=e.updateQueue,e!==null&&(e=e.shared,(t&4194240)!==0)){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Eb(n,t)}}function hS(n,e){var t=n.updateQueue,i=n.alternate;if(i!==null&&(i=i.updateQueue,t===i)){var r=null,l=null;if(t=t.firstBaseUpdate,t!==null){do{var h={eventTime:t.eventTime,lane:t.lane,tag:t.tag,payload:t.payload,callback:t.callback,next:null};l===null?r=l=h:l=l.next=h,t=t.next}while(t!==null);l===null?r=l=e:l=l.next=e}else r=l=e;t={baseState:i.baseState,firstBaseUpdate:r,lastBaseUpdate:l,shared:i.shared,effects:i.effects},n.updateQueue=t;return}n=t.lastBaseUpdate,n===null?t.firstBaseUpdate=e:n.next=e,t.lastBaseUpdate=e}function q1(n,e,t,i){var r=n.updateQueue;dc=!1;var l=r.firstBaseUpdate,h=r.lastBaseUpdate,o=r.shared.pending;if(o!==null){r.shared.pending=null;var p=o,v=p.next;p.next=null,h===null?l=v:h.next=v,h=p;var x=n.alternate;x!==null&&(x=x.updateQueue,o=x.lastBaseUpdate,o!==h&&(o===null?x.firstBaseUpdate=v:o.next=v,x.lastBaseUpdate=p))}if(l!==null){var M=r.baseState;h=0,x=v=p=null,o=l;do{var S=o.lane,A=o.eventTime;if((i&S)===S){x!==null&&(x=x.next={eventTime:A,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var L=n,F=o;switch(S=e,A=t,F.tag){case 1:if(L=F.payload,typeof L=="function"){M=L.call(A,M,S);break e}M=L;break e;case 3:L.flags=L.flags&-65537|128;case 0:if(L=F.payload,S=typeof L=="function"?L.call(A,M,S):L,S==null)break e;M=Ki({},M,S);break e;case 2:dc=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,S=r.effects,S===null?r.effects=[o]:S.push(o))}else A={eventTime:A,lane:S,tag:o.tag,payload:o.payload,callback:o.callback,next:null},x===null?(v=x=A,p=M):x=x.next=A,h|=S;if(o=o.next,o===null){if(o=r.shared.pending,o===null)break;S=o,o=S.next,S.next=null,r.lastBaseUpdate=S,r.shared.pending=null}}while(!0);if(x===null&&(p=M),r.baseState=p,r.firstBaseUpdate=v,r.lastBaseUpdate=x,e=r.shared.interleaved,e!==null){r=e;do h|=r.lane,r=r.next;while(r!==e)}else l===null&&(r.shared.lanes=0);Hu|=h,n.lanes=h,n.memoizedState=M}}function dS(n,e,t){if(n=e.effects,e.effects=null,n!==null)for(e=0;e<n.length;e++){var i=n[e],r=i.callback;if(r!==null){if(i.callback=null,i=t,typeof r!="function")throw Error(zt(191,r));r.call(i)}}}var dE=new u6.Component().refs;function v2(n,e,t,i){e=n.memoizedState,t=t(i,e),t=t==null?e:Ki({},e,t),n.memoizedState=t,n.lanes===0&&(n.updateQueue.baseState=t)}var ky={isMounted:function(n){return(n=n._reactInternals)?Ku(n)===n:!1},enqueueSetState:function(n,e,t){n=n._reactInternals;var i=_a(),r=Ac(n),l=hl(i,r);l.payload=e,t!=null&&(l.callback=t),e=Tc(n,l,r),e!==null&&(Ys(e,n,r,i),m1(e,n,r))},enqueueReplaceState:function(n,e,t){n=n._reactInternals;var i=_a(),r=Ac(n),l=hl(i,r);l.tag=1,l.payload=e,t!=null&&(l.callback=t),e=Tc(n,l,r),e!==null&&(Ys(e,n,r,i),m1(e,n,r))},enqueueForceUpdate:function(n,e){n=n._reactInternals;var t=_a(),i=Ac(n),r=hl(t,i);r.tag=2,e!=null&&(r.callback=e),e=Tc(n,r,i),e!==null&&(Ys(e,n,i,t),m1(e,n,i))}};function fS(n,e,t,i,r,l,h){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(i,l,h):e.prototype&&e.prototype.isPureReactComponent?!gp(t,i)||!gp(r,l):!0}function fE(n,e,t){var i=!1,r=Dc,l=e.contextType;return typeof l=="object"&&l!==null?l=Ts(l):(r=La(e)?Ou:aa.current,i=e.contextTypes,l=(i=i!=null)?Vd(n,r):Dc),e=new e(t,l),n.memoizedState=e.state!==null&&e.state!==void 0?e.state:null,e.updater=ky,n.stateNode=e,e._reactInternals=n,i&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=l),e}function pS(n,e,t,i){n=e.state,typeof e.componentWillReceiveProps=="function"&&e.componentWillReceiveProps(t,i),typeof e.UNSAFE_componentWillReceiveProps=="function"&&e.UNSAFE_componentWillReceiveProps(t,i),e.state!==n&&ky.enqueueReplaceState(e,e.state,null)}function _2(n,e,t,i){var r=n.stateNode;r.props=t,r.state=n.memoizedState,r.refs=dE,Vb(n);var l=e.contextType;typeof l=="object"&&l!==null?r.context=Ts(l):(l=La(e)?Ou:aa.current,r.context=Vd(n,l)),r.state=n.memoizedState,l=e.getDerivedStateFromProps,typeof l=="function"&&(v2(n,e,l,t),r.state=n.memoizedState),typeof e.getDerivedStateFromProps=="function"||typeof r.getSnapshotBeforeUpdate=="function"||typeof r.UNSAFE_componentWillMount!="function"&&typeof r.componentWillMount!="function"||(e=r.state,typeof r.componentWillMount=="function"&&r.componentWillMount(),typeof r.UNSAFE_componentWillMount=="function"&&r.UNSAFE_componentWillMount(),e!==r.state&&ky.enqueueReplaceState(r,r.state,null),q1(n,t,r,i),r.state=n.memoizedState),typeof r.componentDidMount=="function"&&(n.flags|=4194308)}function M0(n,e,t){if(n=t.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(t._owner){if(t=t._owner,t){if(t.tag!==1)throw Error(zt(309));var i=t.stateNode}if(!i)throw Error(zt(147,n));var r=i,l=""+n;return e!==null&&e.ref!==null&&typeof e.ref=="function"&&e.ref._stringRef===l?e.ref:(e=function(h){var o=r.refs;o===dE&&(o=r.refs={}),h===null?delete o[l]:o[l]=h},e._stringRef=l,e)}if(typeof n!="string")throw Error(zt(284));if(!t._owner)throw Error(zt(290,n))}return n}function _g(n,e){throw n=Object.prototype.toString.call(e),Error(zt(31,n==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":n))}function mS(n){var e=n._init;return e(n._payload)}function pE(n){function e(C,V){if(n){var O=C.deletions;O===null?(C.deletions=[V],C.flags|=16):O.push(V)}}function t(C,V){if(!n)return null;for(;V!==null;)e(C,V),V=V.sibling;return null}function i(C,V){for(C=new Map;V!==null;)V.key!==null?C.set(V.key,V):C.set(V.index,V),V=V.sibling;return C}function r(C,V){return C=Cc(C,V),C.index=0,C.sibling=null,C}function l(C,V,O){return C.index=O,n?(O=C.alternate,O!==null?(O=O.index,O<V?(C.flags|=2,V):O):(C.flags|=2,V)):(C.flags|=1048576,V)}function h(C){return n&&C.alternate===null&&(C.flags|=2),C}function o(C,V,O,J){return V===null||V.tag!==6?(V=D_(O,C.mode,J),V.return=C,V):(V=r(V,O),V.return=C,V)}function p(C,V,O,J){var ue=O.type;return ue===hd?x(C,V,O.props.children,J,O.key):V!==null&&(V.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===hc&&mS(ue)===V.type)?(J=r(V,O.props),J.ref=M0(C,V,O),J.return=C,J):(J=b1(O.type,O.key,O.props,null,C.mode,J),J.ref=M0(C,V,O),J.return=C,J)}function v(C,V,O,J){return V===null||V.tag!==4||V.stateNode.containerInfo!==O.containerInfo||V.stateNode.implementation!==O.implementation?(V=L_(O,C.mode,J),V.return=C,V):(V=r(V,O.children||[]),V.return=C,V)}function x(C,V,O,J,ue){return V===null||V.tag!==7?(V=Nu(O,C.mode,J,ue),V.return=C,V):(V=r(V,O),V.return=C,V)}function M(C,V,O){if(typeof V=="string"&&V!==""||typeof V=="number")return V=D_(""+V,C.mode,O),V.return=C,V;if(typeof V=="object"&&V!==null){switch(V.$$typeof){case lg:return O=b1(V.type,V.key,V.props,null,C.mode,O),O.ref=M0(C,null,V),O.return=C,O;case ud:return V=L_(V,C.mode,O),V.return=C,V;case hc:var J=V._init;return M(C,J(V._payload),O)}if(U0(V)||_0(V))return V=Nu(V,C.mode,O,null),V.return=C,V;_g(C,V)}return null}function S(C,V,O,J){var ue=V!==null?V.key:null;if(typeof O=="string"&&O!==""||typeof O=="number")return ue!==null?null:o(C,V,""+O,J);if(typeof O=="object"&&O!==null){switch(O.$$typeof){case lg:return O.key===ue?p(C,V,O,J):null;case ud:return O.key===ue?v(C,V,O,J):null;case hc:return ue=O._init,S(C,V,ue(O._payload),J)}if(U0(O)||_0(O))return ue!==null?null:x(C,V,O,J,null);_g(C,O)}return null}function A(C,V,O,J,ue){if(typeof J=="string"&&J!==""||typeof J=="number")return C=C.get(O)||null,o(V,C,""+J,ue);if(typeof J=="object"&&J!==null){switch(J.$$typeof){case lg:return C=C.get(J.key===null?O:J.key)||null,p(V,C,J,ue);case ud:return C=C.get(J.key===null?O:J.key)||null,v(V,C,J,ue);case hc:var Y=J._init;return A(C,V,O,Y(J._payload),ue)}if(U0(J)||_0(J))return C=C.get(O)||null,x(V,C,J,ue,null);_g(V,J)}return null}function L(C,V,O,J){for(var ue=null,Y=null,Q=V,xe=V=0,re=null;Q!==null&&xe<O.length;xe++){Q.index>xe?(re=Q,Q=null):re=Q.sibling;var ee=S(C,Q,O[xe],J);if(ee===null){Q===null&&(Q=re);break}n&&Q&&ee.alternate===null&&e(C,Q),V=l(ee,V,xe),Y===null?ue=ee:Y.sibling=ee,Y=ee,Q=re}if(xe===O.length)return t(C,Q),Hi&&wu(C,xe),ue;if(Q===null){for(;xe<O.length;xe++)Q=M(C,O[xe],J),Q!==null&&(V=l(Q,V,xe),Y===null?ue=Q:Y.sibling=Q,Y=Q);return Hi&&wu(C,xe),ue}for(Q=i(C,Q);xe<O.length;xe++)re=A(Q,C,xe,O[xe],J),re!==null&&(n&&re.alternate!==null&&Q.delete(re.key===null?xe:re.key),V=l(re,V,xe),Y===null?ue=re:Y.sibling=re,Y=re);return n&&Q.forEach(function(Me){return e(C,Me)}),Hi&&wu(C,xe),ue}function F(C,V,O,J){var ue=_0(O);if(typeof ue!="function")throw Error(zt(150));if(O=ue.call(O),O==null)throw Error(zt(151));for(var Y=ue=null,Q=V,xe=V=0,re=null,ee=O.next();Q!==null&&!ee.done;xe++,ee=O.next()){Q.index>xe?(re=Q,Q=null):re=Q.sibling;var Me=S(C,Q,ee.value,J);if(Me===null){Q===null&&(Q=re);break}n&&Q&&Me.alternate===null&&e(C,Q),V=l(Me,V,xe),Y===null?ue=Me:Y.sibling=Me,Y=Me,Q=re}if(ee.done)return t(C,Q),Hi&&wu(C,xe),ue;if(Q===null){for(;!ee.done;xe++,ee=O.next())ee=M(C,ee.value,J),ee!==null&&(V=l(ee,V,xe),Y===null?ue=ee:Y.sibling=ee,Y=ee);return Hi&&wu(C,xe),ue}for(Q=i(C,Q);!ee.done;xe++,ee=O.next())ee=A(Q,C,xe,ee.value,J),ee!==null&&(n&&ee.alternate!==null&&Q.delete(ee.key===null?xe:ee.key),V=l(ee,V,xe),Y===null?ue=ee:Y.sibling=ee,Y=ee);return n&&Q.forEach(function(Fe){return e(C,Fe)}),Hi&&wu(C,xe),ue}function k(C,V,O,J){if(typeof O=="object"&&O!==null&&O.type===hd&&O.key===null&&(O=O.props.children),typeof O=="object"&&O!==null){switch(O.$$typeof){case lg:e:{for(var ue=O.key,Y=V;Y!==null;){if(Y.key===ue){if(ue=O.type,ue===hd){if(Y.tag===7){t(C,Y.sibling),V=r(Y,O.props.children),V.return=C,C=V;break e}}else if(Y.elementType===ue||typeof ue=="object"&&ue!==null&&ue.$$typeof===hc&&mS(ue)===Y.type){t(C,Y.sibling),V=r(Y,O.props),V.ref=M0(C,Y,O),V.return=C,C=V;break e}t(C,Y);break}else e(C,Y);Y=Y.sibling}O.type===hd?(V=Nu(O.props.children,C.mode,J,O.key),V.return=C,C=V):(J=b1(O.type,O.key,O.props,null,C.mode,J),J.ref=M0(C,V,O),J.return=C,C=J)}return h(C);case ud:e:{for(Y=O.key;V!==null;){if(V.key===Y)if(V.tag===4&&V.stateNode.containerInfo===O.containerInfo&&V.stateNode.implementation===O.implementation){t(C,V.sibling),V=r(V,O.children||[]),V.return=C,C=V;break e}else{t(C,V);break}else e(C,V);V=V.sibling}V=L_(O,C.mode,J),V.return=C,C=V}return h(C);case hc:return Y=O._init,k(C,V,Y(O._payload),J)}if(U0(O))return L(C,V,O,J);if(_0(O))return F(C,V,O,J);_g(C,O)}return typeof O=="string"&&O!==""||typeof O=="number"?(O=""+O,V!==null&&V.tag===6?(t(C,V.sibling),V=r(V,O),V.return=C,C=V):(t(C,V),V=D_(O,C.mode,J),V.return=C,C=V),h(C)):t(C,V)}return k}var Gd=pE(!0),mE=pE(!1),Gp={},wo=Oc(Gp),xp=Oc(Gp),bp=Oc(Gp);function Ru(n){if(n===Gp)throw Error(zt(174));return n}function Hb(n,e){switch(ki(bp,e),ki(xp,n),ki(wo,Gp),n=e.nodeType,n){case 9:case 11:e=(e=e.documentElement)?e.namespaceURI:Kx(null,"");break;default:n=n===8?e.parentNode:e,e=n.namespaceURI||null,n=n.tagName,e=Kx(e,n)}Oi(wo),ki(wo,e)}function jd(){Oi(wo),Oi(xp),Oi(bp)}function gE(n){Ru(bp.current);var e=Ru(wo.current),t=Kx(e,n.type);e!==t&&(ki(xp,n),ki(wo,t))}function Gb(n){xp.current===n&&(Oi(wo),Oi(xp))}var Xi=Oc(0);function $1(n){for(var e=n;e!==null;){if(e.tag===13){var t=e.memoizedState;if(t!==null&&(t=t.dehydrated,t===null||t.data==="$?"||t.data==="$!"))return e}else if(e.tag===19&&e.memoizedProps.revealOrder!==void 0){if(e.flags&128)return e}else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return null;e=e.return}e.sibling.return=e.return,e=e.sibling}return null}var A_=[];function jb(){for(var n=0;n<A_.length;n++)A_[n]._workInProgressVersionPrimary=null;A_.length=0}var g1=Tl.ReactCurrentDispatcher,C_=Tl.ReactCurrentBatchConfig,Vu=0,Yi=null,xr=null,Ir=null,X1=!1,Q0=!1,wp=0,N9=0;function Jr(){throw Error(zt(321))}function Wb(n,e){if(e===null)return!1;for(var t=0;t<e.length&&t<n.length;t++)if(!Ks(n[t],e[t]))return!1;return!0}function qb(n,e,t,i,r,l){if(Vu=l,Yi=e,e.memoizedState=null,e.updateQueue=null,e.lanes=0,g1.current=n===null||n.memoizedState===null?V9:H9,n=t(i,r),Q0){l=0;do{if(Q0=!1,wp=0,25<=l)throw Error(zt(301));l+=1,Ir=xr=null,e.updateQueue=null,g1.current=G9,n=t(i,r)}while(Q0)}if(g1.current=Z1,e=xr!==null&&xr.next!==null,Vu=0,Ir=xr=Yi=null,X1=!1,e)throw Error(zt(300));return n}function $b(){var n=wp!==0;return wp=0,n}function co(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Ir===null?Yi.memoizedState=Ir=n:Ir=Ir.next=n,Ir}function Es(){if(xr===null){var n=Yi.alternate;n=n!==null?n.memoizedState:null}else n=xr.next;var e=Ir===null?Yi.memoizedState:Ir.next;if(e!==null)Ir=e,xr=n;else{if(n===null)throw Error(zt(310));xr=n,n={memoizedState:xr.memoizedState,baseState:xr.baseState,baseQueue:xr.baseQueue,queue:xr.queue,next:null},Ir===null?Yi.memoizedState=Ir=n:Ir=Ir.next=n}return Ir}function Sp(n,e){return typeof e=="function"?e(n):e}function P_(n){var e=Es(),t=e.queue;if(t===null)throw Error(zt(311));t.lastRenderedReducer=n;var i=xr,r=i.baseQueue,l=t.pending;if(l!==null){if(r!==null){var h=r.next;r.next=l.next,l.next=h}i.baseQueue=r=l,t.pending=null}if(r!==null){l=r.next,i=i.baseState;var o=h=null,p=null,v=l;do{var x=v.lane;if((Vu&x)===x)p!==null&&(p=p.next={lane:0,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null}),i=v.hasEagerState?v.eagerState:n(i,v.action);else{var M={lane:x,action:v.action,hasEagerState:v.hasEagerState,eagerState:v.eagerState,next:null};p===null?(o=p=M,h=i):p=p.next=M,Yi.lanes|=x,Hu|=x}v=v.next}while(v!==null&&v!==l);p===null?h=i:p.next=o,Ks(i,e.memoizedState)||(Ia=!0),e.memoizedState=i,e.baseState=h,e.baseQueue=p,t.lastRenderedState=i}if(n=t.interleaved,n!==null){r=n;do l=r.lane,Yi.lanes|=l,Hu|=l,r=r.next;while(r!==n)}else r===null&&(t.lanes=0);return[e.memoizedState,t.dispatch]}function R_(n){var e=Es(),t=e.queue;if(t===null)throw Error(zt(311));t.lastRenderedReducer=n;var i=t.dispatch,r=t.pending,l=e.memoizedState;if(r!==null){t.pending=null;var h=r=r.next;do l=n(l,h.action),h=h.next;while(h!==r);Ks(l,e.memoizedState)||(Ia=!0),e.memoizedState=l,e.baseQueue===null&&(e.baseState=l),t.lastRenderedState=l}return[l,i]}function yE(){}function vE(n,e){var t=Yi,i=Es(),r=e(),l=!Ks(i.memoizedState,r);if(l&&(i.memoizedState=r,Ia=!0),i=i.queue,Xb(bE.bind(null,t,i,n),[n]),i.getSnapshot!==e||l||Ir!==null&&Ir.memoizedState.tag&1){if(t.flags|=2048,Mp(9,xE.bind(null,t,i,r,e),void 0,null),Dr===null)throw Error(zt(349));Vu&30||_E(t,e,r)}return r}function _E(n,e,t){n.flags|=16384,n={getSnapshot:e,value:t},e=Yi.updateQueue,e===null?(e={lastEffect:null,stores:null},Yi.updateQueue=e,e.stores=[n]):(t=e.stores,t===null?e.stores=[n]:t.push(n))}function xE(n,e,t,i){e.value=t,e.getSnapshot=i,wE(e)&&SE(n)}function bE(n,e,t){return t(function(){wE(e)&&SE(n)})}function wE(n){var e=n.getSnapshot;n=n.value;try{var t=e();return!Ks(n,t)}catch{return!0}}function SE(n){var e=yl(n,1);e!==null&&Ys(e,n,1,-1)}function gS(n){var e=co();return typeof n=="function"&&(n=n()),e.memoizedState=e.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Sp,lastRenderedState:n},e.queue=n,n=n.dispatch=U9.bind(null,Yi,n),[e.memoizedState,n]}function Mp(n,e,t,i){return n={tag:n,create:e,destroy:t,deps:i,next:null},e=Yi.updateQueue,e===null?(e={lastEffect:null,stores:null},Yi.updateQueue=e,e.lastEffect=n.next=n):(t=e.lastEffect,t===null?e.lastEffect=n.next=n:(i=t.next,t.next=n,n.next=i,e.lastEffect=n)),n}function ME(){return Es().memoizedState}function y1(n,e,t,i){var r=co();Yi.flags|=n,r.memoizedState=Mp(1|e,t,void 0,i===void 0?null:i)}function Dy(n,e,t,i){var r=Es();i=i===void 0?null:i;var l=void 0;if(xr!==null){var h=xr.memoizedState;if(l=h.destroy,i!==null&&Wb(i,h.deps)){r.memoizedState=Mp(e,t,l,i);return}}Yi.flags|=n,r.memoizedState=Mp(1|e,t,l,i)}function yS(n,e){return y1(8390656,8,n,e)}function Xb(n,e){return Dy(2048,8,n,e)}function TE(n,e){return Dy(4,2,n,e)}function EE(n,e){return Dy(4,4,n,e)}function AE(n,e){if(typeof e=="function")return n=n(),e(n),function(){e(null)};if(e!=null)return n=n(),e.current=n,function(){e.current=null}}function CE(n,e,t){return t=t!=null?t.concat([n]):null,Dy(4,4,AE.bind(null,e,n),t)}function Zb(){}function PE(n,e){var t=Es();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Wb(e,i[1])?i[0]:(t.memoizedState=[n,e],n)}function RE(n,e){var t=Es();e=e===void 0?null:e;var i=t.memoizedState;return i!==null&&e!==null&&Wb(e,i[1])?i[0]:(n=n(),t.memoizedState=[n,e],n)}function IE(n,e,t){return Vu&21?(Ks(t,e)||(t=L6(),Yi.lanes|=t,Hu|=t,n.baseState=!0),e):(n.baseState&&(n.baseState=!1,Ia=!0),n.memoizedState=t)}function B9(n,e){var t=_i;_i=t!==0&&4>t?t:4,n(!0);var i=C_.transition;C_.transition={};try{n(!1),e()}finally{_i=t,C_.transition=i}}function kE(){return Es().memoizedState}function O9(n,e,t){var i=Ac(n);if(t={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null},DE(n))LE(e,t);else if(t=uE(n,e,t,i),t!==null){var r=_a();Ys(t,n,i,r),zE(t,e,i)}}function U9(n,e,t){var i=Ac(n),r={lane:i,action:t,hasEagerState:!1,eagerState:null,next:null};if(DE(n))LE(e,r);else{var l=n.alternate;if(n.lanes===0&&(l===null||l.lanes===0)&&(l=e.lastRenderedReducer,l!==null))try{var h=e.lastRenderedState,o=l(h,t);if(r.hasEagerState=!0,r.eagerState=o,Ks(o,h)){var p=e.interleaved;p===null?(r.next=r,Ub(e)):(r.next=p.next,p.next=r),e.interleaved=r;return}}catch{}finally{}t=uE(n,e,r,i),t!==null&&(r=_a(),Ys(t,n,i,r),zE(t,e,i))}}function DE(n){var e=n.alternate;return n===Yi||e!==null&&e===Yi}function LE(n,e){Q0=X1=!0;var t=n.pending;t===null?e.next=e:(e.next=t.next,t.next=e),n.pending=e}function zE(n,e,t){if(t&4194240){var i=e.lanes;i&=n.pendingLanes,t|=i,e.lanes=t,Eb(n,t)}}var Z1={readContext:Ts,useCallback:Jr,useContext:Jr,useEffect:Jr,useImperativeHandle:Jr,useInsertionEffect:Jr,useLayoutEffect:Jr,useMemo:Jr,useReducer:Jr,useRef:Jr,useState:Jr,useDebugValue:Jr,useDeferredValue:Jr,useTransition:Jr,useMutableSource:Jr,useSyncExternalStore:Jr,useId:Jr,unstable_isNewReconciler:!1},V9={readContext:Ts,useCallback:function(n,e){return co().memoizedState=[n,e===void 0?null:e],n},useContext:Ts,useEffect:yS,useImperativeHandle:function(n,e,t){return t=t!=null?t.concat([n]):null,y1(4194308,4,AE.bind(null,e,n),t)},useLayoutEffect:function(n,e){return y1(4194308,4,n,e)},useInsertionEffect:function(n,e){return y1(4,2,n,e)},useMemo:function(n,e){var t=co();return e=e===void 0?null:e,n=n(),t.memoizedState=[n,e],n},useReducer:function(n,e,t){var i=co();return e=t!==void 0?t(e):e,i.memoizedState=i.baseState=e,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:e},i.queue=n,n=n.dispatch=O9.bind(null,Yi,n),[i.memoizedState,n]},useRef:function(n){var e=co();return n={current:n},e.memoizedState=n},useState:gS,useDebugValue:Zb,useDeferredValue:function(n){return co().memoizedState=n},useTransition:function(){var n=gS(!1),e=n[0];return n=B9.bind(null,n[1]),co().memoizedState=n,[e,n]},useMutableSource:function(){},useSyncExternalStore:function(n,e,t){var i=Yi,r=co();if(Hi){if(t===void 0)throw Error(zt(407));t=t()}else{if(t=e(),Dr===null)throw Error(zt(349));Vu&30||_E(i,e,t)}r.memoizedState=t;var l={value:t,getSnapshot:e};return r.queue=l,yS(bE.bind(null,i,l,n),[n]),i.flags|=2048,Mp(9,xE.bind(null,i,l,t,e),void 0,null),t},useId:function(){var n=co(),e=Dr.identifierPrefix;if(Hi){var t=cl,i=ll;t=(i&~(1<<32-Zs(i)-1)).toString(32)+t,e=":"+e+"R"+t,t=wp++,0<t&&(e+="H"+t.toString(32)),e+=":"}else t=N9++,e=":"+e+"r"+t.toString(32)+":";return n.memoizedState=e},unstable_isNewReconciler:!1},H9={readContext:Ts,useCallback:PE,useContext:Ts,useEffect:Xb,useImperativeHandle:CE,useInsertionEffect:TE,useLayoutEffect:EE,useMemo:RE,useReducer:P_,useRef:ME,useState:function(){return P_(Sp)},useDebugValue:Zb,useDeferredValue:function(n){var e=Es();return IE(e,xr.memoizedState,n)},useTransition:function(){var n=P_(Sp)[0],e=Es().memoizedState;return[n,e]},useMutableSource:yE,useSyncExternalStore:vE,useId:kE,unstable_isNewReconciler:!1},G9={readContext:Ts,useCallback:PE,useContext:Ts,useEffect:Xb,useImperativeHandle:CE,useInsertionEffect:TE,useLayoutEffect:EE,useMemo:RE,useReducer:R_,useRef:ME,useState:function(){return R_(Sp)},useDebugValue:Zb,useDeferredValue:function(n){var e=Es();return xr===null?e.memoizedState=n:IE(e,xr.memoizedState,n)},useTransition:function(){var n=R_(Sp)[0],e=Es().memoizedState;return[n,e]},useMutableSource:yE,useSyncExternalStore:vE,useId:kE,unstable_isNewReconciler:!1};function Wd(n,e){try{var t="",i=e;do t+=yR(i),i=i.return;while(i);var r=t}catch(l){r=`
Error generating stack: `+l.message+`
`+l.stack}return{value:n,source:e,stack:r,digest:null}}function I_(n,e,t){return{value:n,source:null,stack:t??null,digest:e??null}}function x2(n,e){try{console.error(e.value)}catch(t){setTimeout(function(){throw t})}}var j9=typeof WeakMap=="function"?WeakMap:Map;function FE(n,e,t){t=hl(-1,t),t.tag=3,t.payload={element:null};var i=e.value;return t.callback=function(){K1||(K1=!0,R2=i),x2(n,e)},t}function NE(n,e,t){t=hl(-1,t),t.tag=3;var i=n.type.getDerivedStateFromError;if(typeof i=="function"){var r=e.value;t.payload=function(){return i(r)},t.callback=function(){x2(n,e)}}var l=n.stateNode;return l!==null&&typeof l.componentDidCatch=="function"&&(t.callback=function(){x2(n,e),typeof i!="function"&&(Ec===null?Ec=new Set([this]):Ec.add(this));var h=e.stack;this.componentDidCatch(e.value,{componentStack:h!==null?h:""})}),t}function vS(n,e,t){var i=n.pingCache;if(i===null){i=n.pingCache=new j9;var r=new Set;i.set(e,r)}else r=i.get(e),r===void 0&&(r=new Set,i.set(e,r));r.has(t)||(r.add(t),n=rI.bind(null,n,e,t),e.then(n,n))}function _S(n){do{var e;if((e=n.tag===13)&&(e=n.memoizedState,e=e!==null?e.dehydrated!==null:!0),e)return n;n=n.return}while(n!==null);return null}function xS(n,e,t,i,r){return n.mode&1?(n.flags|=65536,n.lanes=r,n):(n===e?n.flags|=65536:(n.flags|=128,t.flags|=131072,t.flags&=-52805,t.tag===1&&(t.alternate===null?t.tag=17:(e=hl(-1,1),e.tag=2,Tc(t,e,1))),t.lanes|=1),n)}var W9=Tl.ReactCurrentOwner,Ia=!1;function ya(n,e,t,i){e.child=n===null?mE(e,null,t,i):Gd(e,n.child,t,i)}function bS(n,e,t,i,r){t=t.render;var l=e.ref;return kd(e,r),i=qb(n,e,t,i,l,r),t=$b(),n!==null&&!Ia?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,vl(n,e,r)):(Hi&&t&&Lb(e),e.flags|=1,ya(n,e,i,r),e.child)}function wS(n,e,t,i,r){if(n===null){var l=t.type;return typeof l=="function"&&!iw(l)&&l.defaultProps===void 0&&t.compare===null&&t.defaultProps===void 0?(e.tag=15,e.type=l,BE(n,e,l,i,r)):(n=b1(t.type,null,i,e,e.mode,r),n.ref=e.ref,n.return=e,e.child=n)}if(l=n.child,!(n.lanes&r)){var h=l.memoizedProps;if(t=t.compare,t=t!==null?t:gp,t(h,i)&&n.ref===e.ref)return vl(n,e,r)}return e.flags|=1,n=Cc(l,i),n.ref=e.ref,n.return=e,e.child=n}function BE(n,e,t,i,r){if(n!==null){var l=n.memoizedProps;if(gp(l,i)&&n.ref===e.ref)if(Ia=!1,e.pendingProps=i=l,(n.lanes&r)!==0)n.flags&131072&&(Ia=!0);else return e.lanes=n.lanes,vl(n,e,r)}return b2(n,e,t,i,r)}function OE(n,e,t){var i=e.pendingProps,r=i.children,l=n!==null?n.memoizedState:null;if(i.mode==="hidden")if(!(e.mode&1))e.memoizedState={baseLanes:0,cachePool:null,transitions:null},ki(bd,Za),Za|=t;else{if(!(t&1073741824))return n=l!==null?l.baseLanes|t:t,e.lanes=e.childLanes=1073741824,e.memoizedState={baseLanes:n,cachePool:null,transitions:null},e.updateQueue=null,ki(bd,Za),Za|=n,null;e.memoizedState={baseLanes:0,cachePool:null,transitions:null},i=l!==null?l.baseLanes:t,ki(bd,Za),Za|=i}else l!==null?(i=l.baseLanes|t,e.memoizedState=null):i=t,ki(bd,Za),Za|=i;return ya(n,e,r,t),e.child}function UE(n,e){var t=e.ref;(n===null&&t!==null||n!==null&&n.ref!==t)&&(e.flags|=512,e.flags|=2097152)}function b2(n,e,t,i,r){var l=La(t)?Ou:aa.current;return l=Vd(e,l),kd(e,r),t=qb(n,e,t,i,l,r),i=$b(),n!==null&&!Ia?(e.updateQueue=n.updateQueue,e.flags&=-2053,n.lanes&=~r,vl(n,e,r)):(Hi&&i&&Lb(e),e.flags|=1,ya(n,e,t,r),e.child)}function SS(n,e,t,i,r){if(La(t)){var l=!0;V1(e)}else l=!1;if(kd(e,r),e.stateNode===null)v1(n,e),fE(e,t,i),_2(e,t,i,r),i=!0;else if(n===null){var h=e.stateNode,o=e.memoizedProps;h.props=o;var p=h.context,v=t.contextType;typeof v=="object"&&v!==null?v=Ts(v):(v=La(t)?Ou:aa.current,v=Vd(e,v));var x=t.getDerivedStateFromProps,M=typeof x=="function"||typeof h.getSnapshotBeforeUpdate=="function";M||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(o!==i||p!==v)&&pS(e,h,i,v),dc=!1;var S=e.memoizedState;h.state=S,q1(e,i,h,r),p=e.memoizedState,o!==i||S!==p||Da.current||dc?(typeof x=="function"&&(v2(e,t,x,i),p=e.memoizedState),(o=dc||fS(e,t,o,i,S,p,v))?(M||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(e.flags|=4194308)):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),e.memoizedProps=i,e.memoizedState=p),h.props=i,h.state=p,h.context=v,i=o):(typeof h.componentDidMount=="function"&&(e.flags|=4194308),i=!1)}else{h=e.stateNode,hE(n,e),o=e.memoizedProps,v=e.type===e.elementType?o:Vs(e.type,o),h.props=v,M=e.pendingProps,S=h.context,p=t.contextType,typeof p=="object"&&p!==null?p=Ts(p):(p=La(t)?Ou:aa.current,p=Vd(e,p));var A=t.getDerivedStateFromProps;(x=typeof A=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(o!==M||S!==p)&&pS(e,h,i,p),dc=!1,S=e.memoizedState,h.state=S,q1(e,i,h,r);var L=e.memoizedState;o!==M||S!==L||Da.current||dc?(typeof A=="function"&&(v2(e,t,A,i),L=e.memoizedState),(v=dc||fS(e,t,v,i,S,L,p)||!1)?(x||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(i,L,p),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(i,L,p)),typeof h.componentDidUpdate=="function"&&(e.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(e.flags|=1024)):(typeof h.componentDidUpdate!="function"||o===n.memoizedProps&&S===n.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&S===n.memoizedState||(e.flags|=1024),e.memoizedProps=i,e.memoizedState=L),h.props=i,h.state=L,h.context=p,i=v):(typeof h.componentDidUpdate!="function"||o===n.memoizedProps&&S===n.memoizedState||(e.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&S===n.memoizedState||(e.flags|=1024),i=!1)}return w2(n,e,t,i,l,r)}function w2(n,e,t,i,r,l){UE(n,e);var h=(e.flags&128)!==0;if(!i&&!h)return r&&lS(e,t,!1),vl(n,e,l);i=e.stateNode,W9.current=e;var o=h&&typeof t.getDerivedStateFromError!="function"?null:i.render();return e.flags|=1,n!==null&&h?(e.child=Gd(e,n.child,null,l),e.child=Gd(e,null,o,l)):ya(n,e,o,l),e.memoizedState=i.state,r&&lS(e,t,!0),e.child}function VE(n){var e=n.stateNode;e.pendingContext?oS(n,e.pendingContext,e.pendingContext!==e.context):e.context&&oS(n,e.context,!1),Hb(n,e.containerInfo)}function MS(n,e,t,i,r){return Hd(),Fb(r),e.flags|=256,ya(n,e,t,i),e.child}var S2={dehydrated:null,treeContext:null,retryLane:0};function M2(n){return{baseLanes:n,cachePool:null,transitions:null}}function HE(n,e,t){var i=e.pendingProps,r=Xi.current,l=!1,h=(e.flags&128)!==0,o;if((o=h)||(o=n!==null&&n.memoizedState===null?!1:(r&2)!==0),o?(l=!0,e.flags&=-129):(n===null||n.memoizedState!==null)&&(r|=1),ki(Xi,r&1),n===null)return g2(e),n=e.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(e.mode&1?n.data==="$!"?e.lanes=8:e.lanes=1073741824:e.lanes=1,null):(h=i.children,n=i.fallback,l?(i=e.mode,l=e.child,h={mode:"hidden",children:h},!(i&1)&&l!==null?(l.childLanes=0,l.pendingProps=h):l=Fy(h,i,0,null),n=Nu(n,i,t,null),l.return=e,n.return=e,l.sibling=n,e.child=l,e.child.memoizedState=M2(t),e.memoizedState=S2,n):Yb(e,h));if(r=n.memoizedState,r!==null&&(o=r.dehydrated,o!==null))return q9(n,e,h,i,o,r,t);if(l){l=i.fallback,h=e.mode,r=n.child,o=r.sibling;var p={mode:"hidden",children:i.children};return!(h&1)&&e.child!==r?(i=e.child,i.childLanes=0,i.pendingProps=p,e.deletions=null):(i=Cc(r,p),i.subtreeFlags=r.subtreeFlags&14680064),o!==null?l=Cc(o,l):(l=Nu(l,h,t,null),l.flags|=2),l.return=e,i.return=e,i.sibling=l,e.child=i,i=l,l=e.child,h=n.child.memoizedState,h=h===null?M2(t):{baseLanes:h.baseLanes|t,cachePool:null,transitions:h.transitions},l.memoizedState=h,l.childLanes=n.childLanes&~t,e.memoizedState=S2,i}return l=n.child,n=l.sibling,i=Cc(l,{mode:"visible",children:i.children}),!(e.mode&1)&&(i.lanes=t),i.return=e,i.sibling=null,n!==null&&(t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)),e.child=i,e.memoizedState=null,i}function Yb(n,e){return e=Fy({mode:"visible",children:e},n.mode,0,null),e.return=n,n.child=e}function xg(n,e,t,i){return i!==null&&Fb(i),Gd(e,n.child,null,t),n=Yb(e,e.pendingProps.children),n.flags|=2,e.memoizedState=null,n}function q9(n,e,t,i,r,l,h){if(t)return e.flags&256?(e.flags&=-257,i=I_(Error(zt(422))),xg(n,e,h,i)):e.memoizedState!==null?(e.child=n.child,e.flags|=128,null):(l=i.fallback,r=e.mode,i=Fy({mode:"visible",children:i.children},r,0,null),l=Nu(l,r,h,null),l.flags|=2,i.return=e,l.return=e,i.sibling=l,e.child=i,e.mode&1&&Gd(e,n.child,null,h),e.child.memoizedState=M2(h),e.memoizedState=S2,l);if(!(e.mode&1))return xg(n,e,h,null);if(r.data==="$!"){if(i=r.nextSibling&&r.nextSibling.dataset,i)var o=i.dgst;return i=o,l=Error(zt(419)),i=I_(l,i,void 0),xg(n,e,h,i)}if(o=(h&n.childLanes)!==0,Ia||o){if(i=Dr,i!==null){switch(h&-h){case 4:r=2;break;case 16:r=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:r=32;break;case 536870912:r=268435456;break;default:r=0}r=r&(i.suspendedLanes|h)?0:r,r!==0&&r!==l.retryLane&&(l.retryLane=r,yl(n,r),Ys(i,n,r,-1))}return nw(),i=I_(Error(zt(421))),xg(n,e,h,i)}return r.data==="$?"?(e.flags|=128,e.child=n.child,e=aI.bind(null,n),r._reactRetry=e,null):(n=l.treeContext,Ka=Mc(r.nextSibling),Qa=e,Hi=!0,Ws=null,n!==null&&(ms[gs++]=ll,ms[gs++]=cl,ms[gs++]=Uu,ll=n.id,cl=n.overflow,Uu=e),e=Yb(e,i.children),e.flags|=4096,e)}function TS(n,e,t){n.lanes|=e;var i=n.alternate;i!==null&&(i.lanes|=e),y2(n.return,e,t)}function k_(n,e,t,i,r){var l=n.memoizedState;l===null?n.memoizedState={isBackwards:e,rendering:null,renderingStartTime:0,last:i,tail:t,tailMode:r}:(l.isBackwards=e,l.rendering=null,l.renderingStartTime=0,l.last=i,l.tail=t,l.tailMode=r)}function GE(n,e,t){var i=e.pendingProps,r=i.revealOrder,l=i.tail;if(ya(n,e,i.children,t),i=Xi.current,i&2)i=i&1|2,e.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=e.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&TS(n,t,e);else if(n.tag===19)TS(n,t,e);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===e)break e;for(;n.sibling===null;){if(n.return===null||n.return===e)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}i&=1}if(ki(Xi,i),!(e.mode&1))e.memoizedState=null;else switch(r){case"forwards":for(t=e.child,r=null;t!==null;)n=t.alternate,n!==null&&$1(n)===null&&(r=t),t=t.sibling;t=r,t===null?(r=e.child,e.child=null):(r=t.sibling,t.sibling=null),k_(e,!1,r,t,l);break;case"backwards":for(t=null,r=e.child,e.child=null;r!==null;){if(n=r.alternate,n!==null&&$1(n)===null){e.child=r;break}n=r.sibling,r.sibling=t,t=r,r=n}k_(e,!0,t,null,l);break;case"together":k_(e,!1,null,null,void 0);break;default:e.memoizedState=null}return e.child}function v1(n,e){!(e.mode&1)&&n!==null&&(n.alternate=null,e.alternate=null,e.flags|=2)}function vl(n,e,t){if(n!==null&&(e.dependencies=n.dependencies),Hu|=e.lanes,!(t&e.childLanes))return null;if(n!==null&&e.child!==n.child)throw Error(zt(153));if(e.child!==null){for(n=e.child,t=Cc(n,n.pendingProps),e.child=t,t.return=e;n.sibling!==null;)n=n.sibling,t=t.sibling=Cc(n,n.pendingProps),t.return=e;t.sibling=null}return e.child}function $9(n,e,t){switch(e.tag){case 3:VE(e),Hd();break;case 5:gE(e);break;case 1:La(e.type)&&V1(e);break;case 4:Hb(e,e.stateNode.containerInfo);break;case 10:var i=e.type._context,r=e.memoizedProps.value;ki(j1,i._currentValue),i._currentValue=r;break;case 13:if(i=e.memoizedState,i!==null)return i.dehydrated!==null?(ki(Xi,Xi.current&1),e.flags|=128,null):t&e.child.childLanes?HE(n,e,t):(ki(Xi,Xi.current&1),n=vl(n,e,t),n!==null?n.sibling:null);ki(Xi,Xi.current&1);break;case 19:if(i=(t&e.childLanes)!==0,n.flags&128){if(i)return GE(n,e,t);e.flags|=128}if(r=e.memoizedState,r!==null&&(r.rendering=null,r.tail=null,r.lastEffect=null),ki(Xi,Xi.current),i)break;return null;case 22:case 23:return e.lanes=0,OE(n,e,t)}return vl(n,e,t)}var jE,T2,WE,qE;jE=function(n,e){for(var t=e.child;t!==null;){if(t.tag===5||t.tag===6)n.appendChild(t.stateNode);else if(t.tag!==4&&t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return;t=t.return}t.sibling.return=t.return,t=t.sibling}};T2=function(){};WE=function(n,e,t,i){var r=n.memoizedProps;if(r!==i){n=e.stateNode,Ru(wo.current);var l=null;switch(t){case"input":r=$x(n,r),i=$x(n,i),l=[];break;case"select":r=Ki({},r,{value:void 0}),i=Ki({},i,{value:void 0}),l=[];break;case"textarea":r=Yx(n,r),i=Yx(n,i),l=[];break;default:typeof r.onClick!="function"&&typeof i.onClick=="function"&&(n.onclick=O1)}Jx(t,i);var h;t=null;for(v in r)if(!i.hasOwnProperty(v)&&r.hasOwnProperty(v)&&r[v]!=null)if(v==="style"){var o=r[v];for(h in o)o.hasOwnProperty(h)&&(t||(t={}),t[h]="")}else v!=="dangerouslySetInnerHTML"&&v!=="children"&&v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(cp.hasOwnProperty(v)?l||(l=[]):(l=l||[]).push(v,null));for(v in i){var p=i[v];if(o=r!=null?r[v]:void 0,i.hasOwnProperty(v)&&p!==o&&(p!=null||o!=null))if(v==="style")if(o){for(h in o)!o.hasOwnProperty(h)||p&&p.hasOwnProperty(h)||(t||(t={}),t[h]="");for(h in p)p.hasOwnProperty(h)&&o[h]!==p[h]&&(t||(t={}),t[h]=p[h])}else t||(l||(l=[]),l.push(v,t)),t=p;else v==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,o=o?o.__html:void 0,p!=null&&o!==p&&(l=l||[]).push(v,p)):v==="children"?typeof p!="string"&&typeof p!="number"||(l=l||[]).push(v,""+p):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&(cp.hasOwnProperty(v)?(p!=null&&v==="onScroll"&&Ni("scroll",n),l||o===p||(l=[])):(l=l||[]).push(v,p))}t&&(l=l||[]).push("style",t);var v=l;(e.updateQueue=v)&&(e.flags|=4)}};qE=function(n,e,t,i){t!==i&&(e.flags|=4)};function T0(n,e){if(!Hi)switch(n.tailMode){case"hidden":e=n.tail;for(var t=null;e!==null;)e.alternate!==null&&(t=e),e=e.sibling;t===null?n.tail=null:t.sibling=null;break;case"collapsed":t=n.tail;for(var i=null;t!==null;)t.alternate!==null&&(i=t),t=t.sibling;i===null?e||n.tail===null?n.tail=null:n.tail.sibling=null:i.sibling=null}}function Qr(n){var e=n.alternate!==null&&n.alternate.child===n.child,t=0,i=0;if(e)for(var r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags&14680064,i|=r.flags&14680064,r.return=n,r=r.sibling;else for(r=n.child;r!==null;)t|=r.lanes|r.childLanes,i|=r.subtreeFlags,i|=r.flags,r.return=n,r=r.sibling;return n.subtreeFlags|=i,n.childLanes=t,e}function X9(n,e,t){var i=e.pendingProps;switch(zb(e),e.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Qr(e),null;case 1:return La(e.type)&&U1(),Qr(e),null;case 3:return i=e.stateNode,jd(),Oi(Da),Oi(aa),jb(),i.pendingContext&&(i.context=i.pendingContext,i.pendingContext=null),(n===null||n.child===null)&&(vg(e)?e.flags|=4:n===null||n.memoizedState.isDehydrated&&!(e.flags&256)||(e.flags|=1024,Ws!==null&&(D2(Ws),Ws=null))),T2(n,e),Qr(e),null;case 5:Gb(e);var r=Ru(bp.current);if(t=e.type,n!==null&&e.stateNode!=null)WE(n,e,t,i,r),n.ref!==e.ref&&(e.flags|=512,e.flags|=2097152);else{if(!i){if(e.stateNode===null)throw Error(zt(166));return Qr(e),null}if(n=Ru(wo.current),vg(e)){i=e.stateNode,t=e.type;var l=e.memoizedProps;switch(i[po]=e,i[_p]=l,n=(e.mode&1)!==0,t){case"dialog":Ni("cancel",i),Ni("close",i);break;case"iframe":case"object":case"embed":Ni("load",i);break;case"video":case"audio":for(r=0;r<H0.length;r++)Ni(H0[r],i);break;case"source":Ni("error",i);break;case"img":case"image":case"link":Ni("error",i),Ni("load",i);break;case"details":Ni("toggle",i);break;case"input":L3(i,l),Ni("invalid",i);break;case"select":i._wrapperState={wasMultiple:!!l.multiple},Ni("invalid",i);break;case"textarea":F3(i,l),Ni("invalid",i)}Jx(t,l),r=null;for(var h in l)if(l.hasOwnProperty(h)){var o=l[h];h==="children"?typeof o=="string"?i.textContent!==o&&(l.suppressHydrationWarning!==!0&&yg(i.textContent,o,n),r=["children",o]):typeof o=="number"&&i.textContent!==""+o&&(l.suppressHydrationWarning!==!0&&yg(i.textContent,o,n),r=["children",""+o]):cp.hasOwnProperty(h)&&o!=null&&h==="onScroll"&&Ni("scroll",i)}switch(t){case"input":cg(i),z3(i,l,!0);break;case"textarea":cg(i),N3(i);break;case"select":case"option":break;default:typeof l.onClick=="function"&&(i.onclick=O1)}i=r,e.updateQueue=i,i!==null&&(e.flags|=4)}else{h=r.nodeType===9?r:r.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=_6(t)),n==="http://www.w3.org/1999/xhtml"?t==="script"?(n=h.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof i.is=="string"?n=h.createElement(t,{is:i.is}):(n=h.createElement(t),t==="select"&&(h=n,i.multiple?h.multiple=!0:i.size&&(h.size=i.size))):n=h.createElementNS(n,t),n[po]=e,n[_p]=i,jE(n,e,!1,!1),e.stateNode=n;e:{switch(h=Qx(t,i),t){case"dialog":Ni("cancel",n),Ni("close",n),r=i;break;case"iframe":case"object":case"embed":Ni("load",n),r=i;break;case"video":case"audio":for(r=0;r<H0.length;r++)Ni(H0[r],n);r=i;break;case"source":Ni("error",n),r=i;break;case"img":case"image":case"link":Ni("error",n),Ni("load",n),r=i;break;case"details":Ni("toggle",n),r=i;break;case"input":L3(n,i),r=$x(n,i),Ni("invalid",n);break;case"option":r=i;break;case"select":n._wrapperState={wasMultiple:!!i.multiple},r=Ki({},i,{value:void 0}),Ni("invalid",n);break;case"textarea":F3(n,i),r=Yx(n,i),Ni("invalid",n);break;default:r=i}Jx(t,r),o=r;for(l in o)if(o.hasOwnProperty(l)){var p=o[l];l==="style"?w6(n,p):l==="dangerouslySetInnerHTML"?(p=p?p.__html:void 0,p!=null&&x6(n,p)):l==="children"?typeof p=="string"?(t!=="textarea"||p!=="")&&up(n,p):typeof p=="number"&&up(n,""+p):l!=="suppressContentEditableWarning"&&l!=="suppressHydrationWarning"&&l!=="autoFocus"&&(cp.hasOwnProperty(l)?p!=null&&l==="onScroll"&&Ni("scroll",n):p!=null&&xb(n,l,p,h))}switch(t){case"input":cg(n),z3(n,i,!1);break;case"textarea":cg(n),N3(n);break;case"option":i.value!=null&&n.setAttribute("value",""+kc(i.value));break;case"select":n.multiple=!!i.multiple,l=i.value,l!=null?Cd(n,!!i.multiple,l,!1):i.defaultValue!=null&&Cd(n,!!i.multiple,i.defaultValue,!0);break;default:typeof r.onClick=="function"&&(n.onclick=O1)}switch(t){case"button":case"input":case"select":case"textarea":i=!!i.autoFocus;break e;case"img":i=!0;break e;default:i=!1}}i&&(e.flags|=4)}e.ref!==null&&(e.flags|=512,e.flags|=2097152)}return Qr(e),null;case 6:if(n&&e.stateNode!=null)qE(n,e,n.memoizedProps,i);else{if(typeof i!="string"&&e.stateNode===null)throw Error(zt(166));if(t=Ru(bp.current),Ru(wo.current),vg(e)){if(i=e.stateNode,t=e.memoizedProps,i[po]=e,(l=i.nodeValue!==t)&&(n=Qa,n!==null))switch(n.tag){case 3:yg(i.nodeValue,t,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&yg(i.nodeValue,t,(n.mode&1)!==0)}l&&(e.flags|=4)}else i=(t.nodeType===9?t:t.ownerDocument).createTextNode(i),i[po]=e,e.stateNode=i}return Qr(e),null;case 13:if(Oi(Xi),i=e.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(Hi&&Ka!==null&&e.mode&1&&!(e.flags&128))cE(),Hd(),e.flags|=98560,l=!1;else if(l=vg(e),i!==null&&i.dehydrated!==null){if(n===null){if(!l)throw Error(zt(318));if(l=e.memoizedState,l=l!==null?l.dehydrated:null,!l)throw Error(zt(317));l[po]=e}else Hd(),!(e.flags&128)&&(e.memoizedState=null),e.flags|=4;Qr(e),l=!1}else Ws!==null&&(D2(Ws),Ws=null),l=!0;if(!l)return e.flags&65536?e:null}return e.flags&128?(e.lanes=t,e):(i=i!==null,i!==(n!==null&&n.memoizedState!==null)&&i&&(e.child.flags|=8192,e.mode&1&&(n===null||Xi.current&1?br===0&&(br=3):nw())),e.updateQueue!==null&&(e.flags|=4),Qr(e),null);case 4:return jd(),T2(n,e),n===null&&yp(e.stateNode.containerInfo),Qr(e),null;case 10:return Ob(e.type._context),Qr(e),null;case 17:return La(e.type)&&U1(),Qr(e),null;case 19:if(Oi(Xi),l=e.memoizedState,l===null)return Qr(e),null;if(i=(e.flags&128)!==0,h=l.rendering,h===null)if(i)T0(l,!1);else{if(br!==0||n!==null&&n.flags&128)for(n=e.child;n!==null;){if(h=$1(n),h!==null){for(e.flags|=128,T0(l,!1),i=h.updateQueue,i!==null&&(e.updateQueue=i,e.flags|=4),e.subtreeFlags=0,i=t,t=e.child;t!==null;)l=t,n=i,l.flags&=14680066,h=l.alternate,h===null?(l.childLanes=0,l.lanes=n,l.child=null,l.subtreeFlags=0,l.memoizedProps=null,l.memoizedState=null,l.updateQueue=null,l.dependencies=null,l.stateNode=null):(l.childLanes=h.childLanes,l.lanes=h.lanes,l.child=h.child,l.subtreeFlags=0,l.deletions=null,l.memoizedProps=h.memoizedProps,l.memoizedState=h.memoizedState,l.updateQueue=h.updateQueue,l.type=h.type,n=h.dependencies,l.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),t=t.sibling;return ki(Xi,Xi.current&1|2),e.child}n=n.sibling}l.tail!==null&&dr()>qd&&(e.flags|=128,i=!0,T0(l,!1),e.lanes=4194304)}else{if(!i)if(n=$1(h),n!==null){if(e.flags|=128,i=!0,t=n.updateQueue,t!==null&&(e.updateQueue=t,e.flags|=4),T0(l,!0),l.tail===null&&l.tailMode==="hidden"&&!h.alternate&&!Hi)return Qr(e),null}else 2*dr()-l.renderingStartTime>qd&&t!==1073741824&&(e.flags|=128,i=!0,T0(l,!1),e.lanes=4194304);l.isBackwards?(h.sibling=e.child,e.child=h):(t=l.last,t!==null?t.sibling=h:e.child=h,l.last=h)}return l.tail!==null?(e=l.tail,l.rendering=e,l.tail=e.sibling,l.renderingStartTime=dr(),e.sibling=null,t=Xi.current,ki(Xi,i?t&1|2:t&1),e):(Qr(e),null);case 22:case 23:return tw(),i=e.memoizedState!==null,n!==null&&n.memoizedState!==null!==i&&(e.flags|=8192),i&&e.mode&1?Za&1073741824&&(Qr(e),e.subtreeFlags&6&&(e.flags|=8192)):Qr(e),null;case 24:return null;case 25:return null}throw Error(zt(156,e.tag))}function Z9(n,e){switch(zb(e),e.tag){case 1:return La(e.type)&&U1(),n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 3:return jd(),Oi(Da),Oi(aa),jb(),n=e.flags,n&65536&&!(n&128)?(e.flags=n&-65537|128,e):null;case 5:return Gb(e),null;case 13:if(Oi(Xi),n=e.memoizedState,n!==null&&n.dehydrated!==null){if(e.alternate===null)throw Error(zt(340));Hd()}return n=e.flags,n&65536?(e.flags=n&-65537|128,e):null;case 19:return Oi(Xi),null;case 4:return jd(),null;case 10:return Ob(e.type._context),null;case 22:case 23:return tw(),null;case 24:return null;default:return null}}var bg=!1,ia=!1,Y9=typeof WeakSet=="function"?WeakSet:Set,mn=null;function xd(n,e){var t=n.ref;if(t!==null)if(typeof t=="function")try{t(null)}catch(i){ir(n,e,i)}else t.current=null}function E2(n,e,t){try{t()}catch(i){ir(n,e,i)}}var ES=!1;function K9(n,e){if(c2=F1,n=Y6(),Db(n)){if("selectionStart"in n)var t={start:n.selectionStart,end:n.selectionEnd};else e:{t=(t=n.ownerDocument)&&t.defaultView||window;var i=t.getSelection&&t.getSelection();if(i&&i.rangeCount!==0){t=i.anchorNode;var r=i.anchorOffset,l=i.focusNode;i=i.focusOffset;try{t.nodeType,l.nodeType}catch{t=null;break e}var h=0,o=-1,p=-1,v=0,x=0,M=n,S=null;t:for(;;){for(var A;M!==t||r!==0&&M.nodeType!==3||(o=h+r),M!==l||i!==0&&M.nodeType!==3||(p=h+i),M.nodeType===3&&(h+=M.nodeValue.length),(A=M.firstChild)!==null;)S=M,M=A;for(;;){if(M===n)break t;if(S===t&&++v===r&&(o=h),S===l&&++x===i&&(p=h),(A=M.nextSibling)!==null)break;M=S,S=M.parentNode}M=A}t=o===-1||p===-1?null:{start:o,end:p}}else t=null}t=t||{start:0,end:0}}else t=null;for(u2={focusedElem:n,selectionRange:t},F1=!1,mn=e;mn!==null;)if(e=mn,n=e.child,(e.subtreeFlags&1028)!==0&&n!==null)n.return=e,mn=n;else for(;mn!==null;){e=mn;try{var L=e.alternate;if(e.flags&1024)switch(e.tag){case 0:case 11:case 15:break;case 1:if(L!==null){var F=L.memoizedProps,k=L.memoizedState,C=e.stateNode,V=C.getSnapshotBeforeUpdate(e.elementType===e.type?F:Vs(e.type,F),k);C.__reactInternalSnapshotBeforeUpdate=V}break;case 3:var O=e.stateNode.containerInfo;O.nodeType===1?O.textContent="":O.nodeType===9&&O.documentElement&&O.removeChild(O.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(zt(163))}}catch(J){ir(e,e.return,J)}if(n=e.sibling,n!==null){n.return=e.return,mn=n;break}mn=e.return}return L=ES,ES=!1,L}function ep(n,e,t){var i=e.updateQueue;if(i=i!==null?i.lastEffect:null,i!==null){var r=i=i.next;do{if((r.tag&n)===n){var l=r.destroy;r.destroy=void 0,l!==void 0&&E2(e,t,l)}r=r.next}while(r!==i)}}function Ly(n,e){if(e=e.updateQueue,e=e!==null?e.lastEffect:null,e!==null){var t=e=e.next;do{if((t.tag&n)===n){var i=t.create;t.destroy=i()}t=t.next}while(t!==e)}}function A2(n){var e=n.ref;if(e!==null){var t=n.stateNode;switch(n.tag){case 5:n=t;break;default:n=t}typeof e=="function"?e(n):e.current=n}}function $E(n){var e=n.alternate;e!==null&&(n.alternate=null,$E(e)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(e=n.stateNode,e!==null&&(delete e[po],delete e[_p],delete e[f2],delete e[D9],delete e[L9])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function XE(n){return n.tag===5||n.tag===3||n.tag===4}function AS(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||XE(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function C2(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.nodeType===8?t.parentNode.insertBefore(n,e):t.insertBefore(n,e):(t.nodeType===8?(e=t.parentNode,e.insertBefore(n,t)):(e=t,e.appendChild(n)),t=t._reactRootContainer,t!=null||e.onclick!==null||(e.onclick=O1));else if(i!==4&&(n=n.child,n!==null))for(C2(n,e,t),n=n.sibling;n!==null;)C2(n,e,t),n=n.sibling}function P2(n,e,t){var i=n.tag;if(i===5||i===6)n=n.stateNode,e?t.insertBefore(n,e):t.appendChild(n);else if(i!==4&&(n=n.child,n!==null))for(P2(n,e,t),n=n.sibling;n!==null;)P2(n,e,t),n=n.sibling}var Or=null,Hs=!1;function Ql(n,e,t){for(t=t.child;t!==null;)ZE(n,e,t),t=t.sibling}function ZE(n,e,t){if(bo&&typeof bo.onCommitFiberUnmount=="function")try{bo.onCommitFiberUnmount(Ey,t)}catch{}switch(t.tag){case 5:ia||xd(t,e);case 6:var i=Or,r=Hs;Or=null,Ql(n,e,t),Or=i,Hs=r,Or!==null&&(Hs?(n=Or,t=t.stateNode,n.nodeType===8?n.parentNode.removeChild(t):n.removeChild(t)):Or.removeChild(t.stateNode));break;case 18:Or!==null&&(Hs?(n=Or,t=t.stateNode,n.nodeType===8?T_(n.parentNode,t):n.nodeType===1&&T_(n,t),pp(n)):T_(Or,t.stateNode));break;case 4:i=Or,r=Hs,Or=t.stateNode.containerInfo,Hs=!0,Ql(n,e,t),Or=i,Hs=r;break;case 0:case 11:case 14:case 15:if(!ia&&(i=t.updateQueue,i!==null&&(i=i.lastEffect,i!==null))){r=i=i.next;do{var l=r,h=l.destroy;l=l.tag,h!==void 0&&(l&2||l&4)&&E2(t,e,h),r=r.next}while(r!==i)}Ql(n,e,t);break;case 1:if(!ia&&(xd(t,e),i=t.stateNode,typeof i.componentWillUnmount=="function"))try{i.props=t.memoizedProps,i.state=t.memoizedState,i.componentWillUnmount()}catch(o){ir(t,e,o)}Ql(n,e,t);break;case 21:Ql(n,e,t);break;case 22:t.mode&1?(ia=(i=ia)||t.memoizedState!==null,Ql(n,e,t),ia=i):Ql(n,e,t);break;default:Ql(n,e,t)}}function CS(n){var e=n.updateQueue;if(e!==null){n.updateQueue=null;var t=n.stateNode;t===null&&(t=n.stateNode=new Y9),e.forEach(function(i){var r=sI.bind(null,n,i);t.has(i)||(t.add(i),i.then(r,r))})}}function zs(n,e){var t=e.deletions;if(t!==null)for(var i=0;i<t.length;i++){var r=t[i];try{var l=n,h=e,o=h;e:for(;o!==null;){switch(o.tag){case 5:Or=o.stateNode,Hs=!1;break e;case 3:Or=o.stateNode.containerInfo,Hs=!0;break e;case 4:Or=o.stateNode.containerInfo,Hs=!0;break e}o=o.return}if(Or===null)throw Error(zt(160));ZE(l,h,r),Or=null,Hs=!1;var p=r.alternate;p!==null&&(p.return=null),r.return=null}catch(v){ir(r,e,v)}}if(e.subtreeFlags&12854)for(e=e.child;e!==null;)YE(e,n),e=e.sibling}function YE(n,e){var t=n.alternate,i=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(zs(e,n),lo(n),i&4){try{ep(3,n,n.return),Ly(3,n)}catch(F){ir(n,n.return,F)}try{ep(5,n,n.return)}catch(F){ir(n,n.return,F)}}break;case 1:zs(e,n),lo(n),i&512&&t!==null&&xd(t,t.return);break;case 5:if(zs(e,n),lo(n),i&512&&t!==null&&xd(t,t.return),n.flags&32){var r=n.stateNode;try{up(r,"")}catch(F){ir(n,n.return,F)}}if(i&4&&(r=n.stateNode,r!=null)){var l=n.memoizedProps,h=t!==null?t.memoizedProps:l,o=n.type,p=n.updateQueue;if(n.updateQueue=null,p!==null)try{o==="input"&&l.type==="radio"&&l.name!=null&&y6(r,l),Qx(o,h);var v=Qx(o,l);for(h=0;h<p.length;h+=2){var x=p[h],M=p[h+1];x==="style"?w6(r,M):x==="dangerouslySetInnerHTML"?x6(r,M):x==="children"?up(r,M):xb(r,x,M,v)}switch(o){case"input":Xx(r,l);break;case"textarea":v6(r,l);break;case"select":var S=r._wrapperState.wasMultiple;r._wrapperState.wasMultiple=!!l.multiple;var A=l.value;A!=null?Cd(r,!!l.multiple,A,!1):S!==!!l.multiple&&(l.defaultValue!=null?Cd(r,!!l.multiple,l.defaultValue,!0):Cd(r,!!l.multiple,l.multiple?[]:"",!1))}r[_p]=l}catch(F){ir(n,n.return,F)}}break;case 6:if(zs(e,n),lo(n),i&4){if(n.stateNode===null)throw Error(zt(162));r=n.stateNode,l=n.memoizedProps;try{r.nodeValue=l}catch(F){ir(n,n.return,F)}}break;case 3:if(zs(e,n),lo(n),i&4&&t!==null&&t.memoizedState.isDehydrated)try{pp(e.containerInfo)}catch(F){ir(n,n.return,F)}break;case 4:zs(e,n),lo(n);break;case 13:zs(e,n),lo(n),r=n.child,r.flags&8192&&(l=r.memoizedState!==null,r.stateNode.isHidden=l,!l||r.alternate!==null&&r.alternate.memoizedState!==null||(Qb=dr())),i&4&&CS(n);break;case 22:if(x=t!==null&&t.memoizedState!==null,n.mode&1?(ia=(v=ia)||x,zs(e,n),ia=v):zs(e,n),lo(n),i&8192){if(v=n.memoizedState!==null,(n.stateNode.isHidden=v)&&!x&&n.mode&1)for(mn=n,x=n.child;x!==null;){for(M=mn=x;mn!==null;){switch(S=mn,A=S.child,S.tag){case 0:case 11:case 14:case 15:ep(4,S,S.return);break;case 1:xd(S,S.return);var L=S.stateNode;if(typeof L.componentWillUnmount=="function"){i=S,t=S.return;try{e=i,L.props=e.memoizedProps,L.state=e.memoizedState,L.componentWillUnmount()}catch(F){ir(i,t,F)}}break;case 5:xd(S,S.return);break;case 22:if(S.memoizedState!==null){RS(M);continue}}A!==null?(A.return=S,mn=A):RS(M)}x=x.sibling}e:for(x=null,M=n;;){if(M.tag===5){if(x===null){x=M;try{r=M.stateNode,v?(l=r.style,typeof l.setProperty=="function"?l.setProperty("display","none","important"):l.display="none"):(o=M.stateNode,p=M.memoizedProps.style,h=p!=null&&p.hasOwnProperty("display")?p.display:null,o.style.display=b6("display",h))}catch(F){ir(n,n.return,F)}}}else if(M.tag===6){if(x===null)try{M.stateNode.nodeValue=v?"":M.memoizedProps}catch(F){ir(n,n.return,F)}}else if((M.tag!==22&&M.tag!==23||M.memoizedState===null||M===n)&&M.child!==null){M.child.return=M,M=M.child;continue}if(M===n)break e;for(;M.sibling===null;){if(M.return===null||M.return===n)break e;x===M&&(x=null),M=M.return}x===M&&(x=null),M.sibling.return=M.return,M=M.sibling}}break;case 19:zs(e,n),lo(n),i&4&&CS(n);break;case 21:break;default:zs(e,n),lo(n)}}function lo(n){var e=n.flags;if(e&2){try{e:{for(var t=n.return;t!==null;){if(XE(t)){var i=t;break e}t=t.return}throw Error(zt(160))}switch(i.tag){case 5:var r=i.stateNode;i.flags&32&&(up(r,""),i.flags&=-33);var l=AS(n);P2(n,l,r);break;case 3:case 4:var h=i.stateNode.containerInfo,o=AS(n);C2(n,o,h);break;default:throw Error(zt(161))}}catch(p){ir(n,n.return,p)}n.flags&=-3}e&4096&&(n.flags&=-4097)}function J9(n,e,t){mn=n,KE(n)}function KE(n,e,t){for(var i=(n.mode&1)!==0;mn!==null;){var r=mn,l=r.child;if(r.tag===22&&i){var h=r.memoizedState!==null||bg;if(!h){var o=r.alternate,p=o!==null&&o.memoizedState!==null||ia;o=bg;var v=ia;if(bg=h,(ia=p)&&!v)for(mn=r;mn!==null;)h=mn,p=h.child,h.tag===22&&h.memoizedState!==null?IS(r):p!==null?(p.return=h,mn=p):IS(r);for(;l!==null;)mn=l,KE(l),l=l.sibling;mn=r,bg=o,ia=v}PS(n)}else r.subtreeFlags&8772&&l!==null?(l.return=r,mn=l):PS(n)}}function PS(n){for(;mn!==null;){var e=mn;if(e.flags&8772){var t=e.alternate;try{if(e.flags&8772)switch(e.tag){case 0:case 11:case 15:ia||Ly(5,e);break;case 1:var i=e.stateNode;if(e.flags&4&&!ia)if(t===null)i.componentDidMount();else{var r=e.elementType===e.type?t.memoizedProps:Vs(e.type,t.memoizedProps);i.componentDidUpdate(r,t.memoizedState,i.__reactInternalSnapshotBeforeUpdate)}var l=e.updateQueue;l!==null&&dS(e,l,i);break;case 3:var h=e.updateQueue;if(h!==null){if(t=null,e.child!==null)switch(e.child.tag){case 5:t=e.child.stateNode;break;case 1:t=e.child.stateNode}dS(e,h,t)}break;case 5:var o=e.stateNode;if(t===null&&e.flags&4){t=o;var p=e.memoizedProps;switch(e.type){case"button":case"input":case"select":case"textarea":p.autoFocus&&t.focus();break;case"img":p.src&&(t.src=p.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(e.memoizedState===null){var v=e.alternate;if(v!==null){var x=v.memoizedState;if(x!==null){var M=x.dehydrated;M!==null&&pp(M)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(zt(163))}ia||e.flags&512&&A2(e)}catch(S){ir(e,e.return,S)}}if(e===n){mn=null;break}if(t=e.sibling,t!==null){t.return=e.return,mn=t;break}mn=e.return}}function RS(n){for(;mn!==null;){var e=mn;if(e===n){mn=null;break}var t=e.sibling;if(t!==null){t.return=e.return,mn=t;break}mn=e.return}}function IS(n){for(;mn!==null;){var e=mn;try{switch(e.tag){case 0:case 11:case 15:var t=e.return;try{Ly(4,e)}catch(p){ir(e,t,p)}break;case 1:var i=e.stateNode;if(typeof i.componentDidMount=="function"){var r=e.return;try{i.componentDidMount()}catch(p){ir(e,r,p)}}var l=e.return;try{A2(e)}catch(p){ir(e,l,p)}break;case 5:var h=e.return;try{A2(e)}catch(p){ir(e,h,p)}}}catch(p){ir(e,e.return,p)}if(e===n){mn=null;break}var o=e.sibling;if(o!==null){o.return=e.return,mn=o;break}mn=e.return}}var Q9=Math.ceil,Y1=Tl.ReactCurrentDispatcher,Kb=Tl.ReactCurrentOwner,Ss=Tl.ReactCurrentBatchConfig,ui=0,Dr=null,yr=null,Vr=0,Za=0,bd=Oc(0),br=0,Tp=null,Hu=0,zy=0,Jb=0,tp=null,Pa=null,Qb=0,qd=1/0,rl=null,K1=!1,R2=null,Ec=null,wg=!1,vc=null,J1=0,np=0,I2=null,_1=-1,x1=0;function _a(){return ui&6?dr():_1!==-1?_1:_1=dr()}function Ac(n){return n.mode&1?ui&2&&Vr!==0?Vr&-Vr:F9.transition!==null?(x1===0&&(x1=L6()),x1):(n=_i,n!==0||(n=window.event,n=n===void 0?16:V6(n.type)),n):1}function Ys(n,e,t,i){if(50<np)throw np=0,I2=null,Error(zt(185));Up(n,t,i),(!(ui&2)||n!==Dr)&&(n===Dr&&(!(ui&2)&&(zy|=t),br===4&&mc(n,Vr)),za(n,i),t===1&&ui===0&&!(e.mode&1)&&(qd=dr()+500,Iy&&Uc()))}function za(n,e){var t=n.callbackNode;FR(n,e);var i=z1(n,n===Dr?Vr:0);if(i===0)t!==null&&U3(t),n.callbackNode=null,n.callbackPriority=0;else if(e=i&-i,n.callbackPriority!==e){if(t!=null&&U3(t),e===1)n.tag===0?z9(kS.bind(null,n)):sE(kS.bind(null,n)),I9(function(){!(ui&6)&&Uc()}),t=null;else{switch(z6(i)){case 1:t=Tb;break;case 4:t=k6;break;case 16:t=L1;break;case 536870912:t=D6;break;default:t=L1}t=aA(t,JE.bind(null,n))}n.callbackPriority=e,n.callbackNode=t}}function JE(n,e){if(_1=-1,x1=0,ui&6)throw Error(zt(327));var t=n.callbackNode;if(Dd()&&n.callbackNode!==t)return null;var i=z1(n,n===Dr?Vr:0);if(i===0)return null;if(i&30||i&n.expiredLanes||e)e=Q1(n,i);else{e=i;var r=ui;ui|=2;var l=eA();(Dr!==n||Vr!==e)&&(rl=null,qd=dr()+500,Fu(n,e));do try{nI();break}catch(o){QE(n,o)}while(!0);Bb(),Y1.current=l,ui=r,yr!==null?e=0:(Dr=null,Vr=0,e=br)}if(e!==0){if(e===2&&(r=r2(n),r!==0&&(i=r,e=k2(n,r))),e===1)throw t=Tp,Fu(n,0),mc(n,i),za(n,dr()),t;if(e===6)mc(n,i);else{if(r=n.current.alternate,!(i&30)&&!eI(r)&&(e=Q1(n,i),e===2&&(l=r2(n),l!==0&&(i=l,e=k2(n,l))),e===1))throw t=Tp,Fu(n,0),mc(n,i),za(n,dr()),t;switch(n.finishedWork=r,n.finishedLanes=i,e){case 0:case 1:throw Error(zt(345));case 2:Su(n,Pa,rl);break;case 3:if(mc(n,i),(i&130023424)===i&&(e=Qb+500-dr(),10<e)){if(z1(n,0)!==0)break;if(r=n.suspendedLanes,(r&i)!==i){_a(),n.pingedLanes|=n.suspendedLanes&r;break}n.timeoutHandle=d2(Su.bind(null,n,Pa,rl),e);break}Su(n,Pa,rl);break;case 4:if(mc(n,i),(i&4194240)===i)break;for(e=n.eventTimes,r=-1;0<i;){var h=31-Zs(i);l=1<<h,h=e[h],h>r&&(r=h),i&=~l}if(i=r,i=dr()-i,i=(120>i?120:480>i?480:1080>i?1080:1920>i?1920:3e3>i?3e3:4320>i?4320:1960*Q9(i/1960))-i,10<i){n.timeoutHandle=d2(Su.bind(null,n,Pa,rl),i);break}Su(n,Pa,rl);break;case 5:Su(n,Pa,rl);break;default:throw Error(zt(329))}}}return za(n,dr()),n.callbackNode===t?JE.bind(null,n):null}function k2(n,e){var t=tp;return n.current.memoizedState.isDehydrated&&(Fu(n,e).flags|=256),n=Q1(n,e),n!==2&&(e=Pa,Pa=t,e!==null&&D2(e)),n}function D2(n){Pa===null?Pa=n:Pa.push.apply(Pa,n)}function eI(n){for(var e=n;;){if(e.flags&16384){var t=e.updateQueue;if(t!==null&&(t=t.stores,t!==null))for(var i=0;i<t.length;i++){var r=t[i],l=r.getSnapshot;r=r.value;try{if(!Ks(l(),r))return!1}catch{return!1}}}if(t=e.child,e.subtreeFlags&16384&&t!==null)t.return=e,e=t;else{if(e===n)break;for(;e.sibling===null;){if(e.return===null||e.return===n)return!0;e=e.return}e.sibling.return=e.return,e=e.sibling}}return!0}function mc(n,e){for(e&=~Jb,e&=~zy,n.suspendedLanes|=e,n.pingedLanes&=~e,n=n.expirationTimes;0<e;){var t=31-Zs(e),i=1<<t;n[t]=-1,e&=~i}}function kS(n){if(ui&6)throw Error(zt(327));Dd();var e=z1(n,0);if(!(e&1))return za(n,dr()),null;var t=Q1(n,e);if(n.tag!==0&&t===2){var i=r2(n);i!==0&&(e=i,t=k2(n,i))}if(t===1)throw t=Tp,Fu(n,0),mc(n,e),za(n,dr()),t;if(t===6)throw Error(zt(345));return n.finishedWork=n.current.alternate,n.finishedLanes=e,Su(n,Pa,rl),za(n,dr()),null}function ew(n,e){var t=ui;ui|=1;try{return n(e)}finally{ui=t,ui===0&&(qd=dr()+500,Iy&&Uc())}}function Gu(n){vc!==null&&vc.tag===0&&!(ui&6)&&Dd();var e=ui;ui|=1;var t=Ss.transition,i=_i;try{if(Ss.transition=null,_i=1,n)return n()}finally{_i=i,Ss.transition=t,ui=e,!(ui&6)&&Uc()}}function tw(){Za=bd.current,Oi(bd)}function Fu(n,e){n.finishedWork=null,n.finishedLanes=0;var t=n.timeoutHandle;if(t!==-1&&(n.timeoutHandle=-1,R9(t)),yr!==null)for(t=yr.return;t!==null;){var i=t;switch(zb(i),i.tag){case 1:i=i.type.childContextTypes,i!=null&&U1();break;case 3:jd(),Oi(Da),Oi(aa),jb();break;case 5:Gb(i);break;case 4:jd();break;case 13:Oi(Xi);break;case 19:Oi(Xi);break;case 10:Ob(i.type._context);break;case 22:case 23:tw()}t=t.return}if(Dr=n,yr=n=Cc(n.current,null),Vr=Za=e,br=0,Tp=null,Jb=zy=Hu=0,Pa=tp=null,Pu!==null){for(e=0;e<Pu.length;e++)if(t=Pu[e],i=t.interleaved,i!==null){t.interleaved=null;var r=i.next,l=t.pending;if(l!==null){var h=l.next;l.next=r,i.next=h}t.pending=i}Pu=null}return n}function QE(n,e){do{var t=yr;try{if(Bb(),g1.current=Z1,X1){for(var i=Yi.memoizedState;i!==null;){var r=i.queue;r!==null&&(r.pending=null),i=i.next}X1=!1}if(Vu=0,Ir=xr=Yi=null,Q0=!1,wp=0,Kb.current=null,t===null||t.return===null){br=1,Tp=e,yr=null;break}e:{var l=n,h=t.return,o=t,p=e;if(e=Vr,o.flags|=32768,p!==null&&typeof p=="object"&&typeof p.then=="function"){var v=p,x=o,M=x.tag;if(!(x.mode&1)&&(M===0||M===11||M===15)){var S=x.alternate;S?(x.updateQueue=S.updateQueue,x.memoizedState=S.memoizedState,x.lanes=S.lanes):(x.updateQueue=null,x.memoizedState=null)}var A=_S(h);if(A!==null){A.flags&=-257,xS(A,h,o,l,e),A.mode&1&&vS(l,v,e),e=A,p=v;var L=e.updateQueue;if(L===null){var F=new Set;F.add(p),e.updateQueue=F}else L.add(p);break e}else{if(!(e&1)){vS(l,v,e),nw();break e}p=Error(zt(426))}}else if(Hi&&o.mode&1){var k=_S(h);if(k!==null){!(k.flags&65536)&&(k.flags|=256),xS(k,h,o,l,e),Fb(Wd(p,o));break e}}l=p=Wd(p,o),br!==4&&(br=2),tp===null?tp=[l]:tp.push(l),l=h;do{switch(l.tag){case 3:l.flags|=65536,e&=-e,l.lanes|=e;var C=FE(l,p,e);hS(l,C);break e;case 1:o=p;var V=l.type,O=l.stateNode;if(!(l.flags&128)&&(typeof V.getDerivedStateFromError=="function"||O!==null&&typeof O.componentDidCatch=="function"&&(Ec===null||!Ec.has(O)))){l.flags|=65536,e&=-e,l.lanes|=e;var J=NE(l,o,e);hS(l,J);break e}}l=l.return}while(l!==null)}nA(t)}catch(ue){e=ue,yr===t&&t!==null&&(yr=t=t.return);continue}break}while(!0)}function eA(){var n=Y1.current;return Y1.current=Z1,n===null?Z1:n}function nw(){(br===0||br===3||br===2)&&(br=4),Dr===null||!(Hu&268435455)&&!(zy&268435455)||mc(Dr,Vr)}function Q1(n,e){var t=ui;ui|=2;var i=eA();(Dr!==n||Vr!==e)&&(rl=null,Fu(n,e));do try{tI();break}catch(r){QE(n,r)}while(!0);if(Bb(),ui=t,Y1.current=i,yr!==null)throw Error(zt(261));return Dr=null,Vr=0,br}function tI(){for(;yr!==null;)tA(yr)}function nI(){for(;yr!==null&&!AR();)tA(yr)}function tA(n){var e=rA(n.alternate,n,Za);n.memoizedProps=n.pendingProps,e===null?nA(n):yr=e,Kb.current=null}function nA(n){var e=n;do{var t=e.alternate;if(n=e.return,e.flags&32768){if(t=Z9(t,e),t!==null){t.flags&=32767,yr=t;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{br=6,yr=null;return}}else if(t=X9(t,e,Za),t!==null){yr=t;return}if(e=e.sibling,e!==null){yr=e;return}yr=e=n}while(e!==null);br===0&&(br=5)}function Su(n,e,t){var i=_i,r=Ss.transition;try{Ss.transition=null,_i=1,iI(n,e,t,i)}finally{Ss.transition=r,_i=i}return null}function iI(n,e,t,i){do Dd();while(vc!==null);if(ui&6)throw Error(zt(327));t=n.finishedWork;var r=n.finishedLanes;if(t===null)return null;if(n.finishedWork=null,n.finishedLanes=0,t===n.current)throw Error(zt(177));n.callbackNode=null,n.callbackPriority=0;var l=t.lanes|t.childLanes;if(NR(n,l),n===Dr&&(yr=Dr=null,Vr=0),!(t.subtreeFlags&2064)&&!(t.flags&2064)||wg||(wg=!0,aA(L1,function(){return Dd(),null})),l=(t.flags&15990)!==0,t.subtreeFlags&15990||l){l=Ss.transition,Ss.transition=null;var h=_i;_i=1;var o=ui;ui|=4,Kb.current=null,K9(n,t),YE(t,n),S9(u2),F1=!!c2,u2=c2=null,n.current=t,J9(t),CR(),ui=o,_i=h,Ss.transition=l}else n.current=t;if(wg&&(wg=!1,vc=n,J1=r),l=n.pendingLanes,l===0&&(Ec=null),IR(t.stateNode),za(n,dr()),e!==null)for(i=n.onRecoverableError,t=0;t<e.length;t++)r=e[t],i(r.value,{componentStack:r.stack,digest:r.digest});if(K1)throw K1=!1,n=R2,R2=null,n;return J1&1&&n.tag!==0&&Dd(),l=n.pendingLanes,l&1?n===I2?np++:(np=0,I2=n):np=0,Uc(),null}function Dd(){if(vc!==null){var n=z6(J1),e=Ss.transition,t=_i;try{if(Ss.transition=null,_i=16>n?16:n,vc===null)var i=!1;else{if(n=vc,vc=null,J1=0,ui&6)throw Error(zt(331));var r=ui;for(ui|=4,mn=n.current;mn!==null;){var l=mn,h=l.child;if(mn.flags&16){var o=l.deletions;if(o!==null){for(var p=0;p<o.length;p++){var v=o[p];for(mn=v;mn!==null;){var x=mn;switch(x.tag){case 0:case 11:case 15:ep(8,x,l)}var M=x.child;if(M!==null)M.return=x,mn=M;else for(;mn!==null;){x=mn;var S=x.sibling,A=x.return;if($E(x),x===v){mn=null;break}if(S!==null){S.return=A,mn=S;break}mn=A}}}var L=l.alternate;if(L!==null){var F=L.child;if(F!==null){L.child=null;do{var k=F.sibling;F.sibling=null,F=k}while(F!==null)}}mn=l}}if(l.subtreeFlags&2064&&h!==null)h.return=l,mn=h;else e:for(;mn!==null;){if(l=mn,l.flags&2048)switch(l.tag){case 0:case 11:case 15:ep(9,l,l.return)}var C=l.sibling;if(C!==null){C.return=l.return,mn=C;break e}mn=l.return}}var V=n.current;for(mn=V;mn!==null;){h=mn;var O=h.child;if(h.subtreeFlags&2064&&O!==null)O.return=h,mn=O;else e:for(h=V;mn!==null;){if(o=mn,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Ly(9,o)}}catch(ue){ir(o,o.return,ue)}if(o===h){mn=null;break e}var J=o.sibling;if(J!==null){J.return=o.return,mn=J;break e}mn=o.return}}if(ui=r,Uc(),bo&&typeof bo.onPostCommitFiberRoot=="function")try{bo.onPostCommitFiberRoot(Ey,n)}catch{}i=!0}return i}finally{_i=t,Ss.transition=e}}return!1}function DS(n,e,t){e=Wd(t,e),e=FE(n,e,1),n=Tc(n,e,1),e=_a(),n!==null&&(Up(n,1,e),za(n,e))}function ir(n,e,t){if(n.tag===3)DS(n,n,t);else for(;e!==null;){if(e.tag===3){DS(e,n,t);break}else if(e.tag===1){var i=e.stateNode;if(typeof e.type.getDerivedStateFromError=="function"||typeof i.componentDidCatch=="function"&&(Ec===null||!Ec.has(i))){n=Wd(t,n),n=NE(e,n,1),e=Tc(e,n,1),n=_a(),e!==null&&(Up(e,1,n),za(e,n));break}}e=e.return}}function rI(n,e,t){var i=n.pingCache;i!==null&&i.delete(e),e=_a(),n.pingedLanes|=n.suspendedLanes&t,Dr===n&&(Vr&t)===t&&(br===4||br===3&&(Vr&130023424)===Vr&&500>dr()-Qb?Fu(n,0):Jb|=t),za(n,e)}function iA(n,e){e===0&&(n.mode&1?(e=dg,dg<<=1,!(dg&130023424)&&(dg=4194304)):e=1);var t=_a();n=yl(n,e),n!==null&&(Up(n,e,t),za(n,t))}function aI(n){var e=n.memoizedState,t=0;e!==null&&(t=e.retryLane),iA(n,t)}function sI(n,e){var t=0;switch(n.tag){case 13:var i=n.stateNode,r=n.memoizedState;r!==null&&(t=r.retryLane);break;case 19:i=n.stateNode;break;default:throw Error(zt(314))}i!==null&&i.delete(e),iA(n,t)}var rA;rA=function(n,e,t){if(n!==null)if(n.memoizedProps!==e.pendingProps||Da.current)Ia=!0;else{if(!(n.lanes&t)&&!(e.flags&128))return Ia=!1,$9(n,e,t);Ia=!!(n.flags&131072)}else Ia=!1,Hi&&e.flags&1048576&&oE(e,G1,e.index);switch(e.lanes=0,e.tag){case 2:var i=e.type;v1(n,e),n=e.pendingProps;var r=Vd(e,aa.current);kd(e,t),r=qb(null,e,i,n,r,t);var l=$b();return e.flags|=1,typeof r=="object"&&r!==null&&typeof r.render=="function"&&r.$$typeof===void 0?(e.tag=1,e.memoizedState=null,e.updateQueue=null,La(i)?(l=!0,V1(e)):l=!1,e.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,Vb(e),r.updater=ky,e.stateNode=r,r._reactInternals=e,_2(e,i,n,t),e=w2(null,e,i,!0,l,t)):(e.tag=0,Hi&&l&&Lb(e),ya(null,e,r,t),e=e.child),e;case 16:i=e.elementType;e:{switch(v1(n,e),n=e.pendingProps,r=i._init,i=r(i._payload),e.type=i,r=e.tag=lI(i),n=Vs(i,n),r){case 0:e=b2(null,e,i,n,t);break e;case 1:e=SS(null,e,i,n,t);break e;case 11:e=bS(null,e,i,n,t);break e;case 14:e=wS(null,e,i,Vs(i.type,n),t);break e}throw Error(zt(306,i,""))}return e;case 0:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vs(i,r),b2(n,e,i,r,t);case 1:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vs(i,r),SS(n,e,i,r,t);case 3:e:{if(VE(e),n===null)throw Error(zt(387));i=e.pendingProps,l=e.memoizedState,r=l.element,hE(n,e),q1(e,i,null,t);var h=e.memoizedState;if(i=h.element,l.isDehydrated)if(l={element:i,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},e.updateQueue.baseState=l,e.memoizedState=l,e.flags&256){r=Wd(Error(zt(423)),e),e=MS(n,e,i,t,r);break e}else if(i!==r){r=Wd(Error(zt(424)),e),e=MS(n,e,i,t,r);break e}else for(Ka=Mc(e.stateNode.containerInfo.firstChild),Qa=e,Hi=!0,Ws=null,t=mE(e,null,i,t),e.child=t;t;)t.flags=t.flags&-3|4096,t=t.sibling;else{if(Hd(),i===r){e=vl(n,e,t);break e}ya(n,e,i,t)}e=e.child}return e;case 5:return gE(e),n===null&&g2(e),i=e.type,r=e.pendingProps,l=n!==null?n.memoizedProps:null,h=r.children,h2(i,r)?h=null:l!==null&&h2(i,l)&&(e.flags|=32),UE(n,e),ya(n,e,h,t),e.child;case 6:return n===null&&g2(e),null;case 13:return HE(n,e,t);case 4:return Hb(e,e.stateNode.containerInfo),i=e.pendingProps,n===null?e.child=Gd(e,null,i,t):ya(n,e,i,t),e.child;case 11:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vs(i,r),bS(n,e,i,r,t);case 7:return ya(n,e,e.pendingProps,t),e.child;case 8:return ya(n,e,e.pendingProps.children,t),e.child;case 12:return ya(n,e,e.pendingProps.children,t),e.child;case 10:e:{if(i=e.type._context,r=e.pendingProps,l=e.memoizedProps,h=r.value,ki(j1,i._currentValue),i._currentValue=h,l!==null)if(Ks(l.value,h)){if(l.children===r.children&&!Da.current){e=vl(n,e,t);break e}}else for(l=e.child,l!==null&&(l.return=e);l!==null;){var o=l.dependencies;if(o!==null){h=l.child;for(var p=o.firstContext;p!==null;){if(p.context===i){if(l.tag===1){p=hl(-1,t&-t),p.tag=2;var v=l.updateQueue;if(v!==null){v=v.shared;var x=v.pending;x===null?p.next=p:(p.next=x.next,x.next=p),v.pending=p}}l.lanes|=t,p=l.alternate,p!==null&&(p.lanes|=t),y2(l.return,t,e),o.lanes|=t;break}p=p.next}}else if(l.tag===10)h=l.type===e.type?null:l.child;else if(l.tag===18){if(h=l.return,h===null)throw Error(zt(341));h.lanes|=t,o=h.alternate,o!==null&&(o.lanes|=t),y2(h,t,e),h=l.sibling}else h=l.child;if(h!==null)h.return=l;else for(h=l;h!==null;){if(h===e){h=null;break}if(l=h.sibling,l!==null){l.return=h.return,h=l;break}h=h.return}l=h}ya(n,e,r.children,t),e=e.child}return e;case 9:return r=e.type,i=e.pendingProps.children,kd(e,t),r=Ts(r),i=i(r),e.flags|=1,ya(n,e,i,t),e.child;case 14:return i=e.type,r=Vs(i,e.pendingProps),r=Vs(i.type,r),wS(n,e,i,r,t);case 15:return BE(n,e,e.type,e.pendingProps,t);case 17:return i=e.type,r=e.pendingProps,r=e.elementType===i?r:Vs(i,r),v1(n,e),e.tag=1,La(i)?(n=!0,V1(e)):n=!1,kd(e,t),fE(e,i,r),_2(e,i,r,t),w2(null,e,i,!0,n,t);case 19:return GE(n,e,t);case 22:return OE(n,e,t)}throw Error(zt(156,e.tag))};function aA(n,e){return I6(n,e)}function oI(n,e,t,i){this.tag=n,this.key=t,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=e,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=i,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function _s(n,e,t,i){return new oI(n,e,t,i)}function iw(n){return n=n.prototype,!(!n||!n.isReactComponent)}function lI(n){if(typeof n=="function")return iw(n)?1:0;if(n!=null){if(n=n.$$typeof,n===wb)return 11;if(n===Sb)return 14}return 2}function Cc(n,e){var t=n.alternate;return t===null?(t=_s(n.tag,e,n.key,n.mode),t.elementType=n.elementType,t.type=n.type,t.stateNode=n.stateNode,t.alternate=n,n.alternate=t):(t.pendingProps=e,t.type=n.type,t.flags=0,t.subtreeFlags=0,t.deletions=null),t.flags=n.flags&14680064,t.childLanes=n.childLanes,t.lanes=n.lanes,t.child=n.child,t.memoizedProps=n.memoizedProps,t.memoizedState=n.memoizedState,t.updateQueue=n.updateQueue,e=n.dependencies,t.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext},t.sibling=n.sibling,t.index=n.index,t.ref=n.ref,t}function b1(n,e,t,i,r,l){var h=2;if(i=n,typeof n=="function")iw(n)&&(h=1);else if(typeof n=="string")h=5;else e:switch(n){case hd:return Nu(t.children,r,l,e);case bb:h=8,r|=8;break;case Gx:return n=_s(12,t,e,r|2),n.elementType=Gx,n.lanes=l,n;case jx:return n=_s(13,t,e,r),n.elementType=jx,n.lanes=l,n;case Wx:return n=_s(19,t,e,r),n.elementType=Wx,n.lanes=l,n;case p6:return Fy(t,r,l,e);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case d6:h=10;break e;case f6:h=9;break e;case wb:h=11;break e;case Sb:h=14;break e;case hc:h=16,i=null;break e}throw Error(zt(130,n==null?n:typeof n,""))}return e=_s(h,t,e,r),e.elementType=n,e.type=i,e.lanes=l,e}function Nu(n,e,t,i){return n=_s(7,n,i,e),n.lanes=t,n}function Fy(n,e,t,i){return n=_s(22,n,i,e),n.elementType=p6,n.lanes=t,n.stateNode={isHidden:!1},n}function D_(n,e,t){return n=_s(6,n,null,e),n.lanes=t,n}function L_(n,e,t){return e=_s(4,n.children!==null?n.children:[],n.key,e),e.lanes=t,e.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},e}function cI(n,e,t,i,r){this.tag=e,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=p_(0),this.expirationTimes=p_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=p_(0),this.identifierPrefix=i,this.onRecoverableError=r,this.mutableSourceEagerHydrationData=null}function rw(n,e,t,i,r,l,h,o,p){return n=new cI(n,e,t,o,p),e===1?(e=1,l===!0&&(e|=8)):e=0,l=_s(3,null,null,e),n.current=l,l.stateNode=n,l.memoizedState={element:i,isDehydrated:t,cache:null,transitions:null,pendingSuspenseBoundaries:null},Vb(l),n}function uI(n,e,t){var i=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ud,key:i==null?null:""+i,children:n,containerInfo:e,implementation:t}}function sA(n){if(!n)return Dc;n=n._reactInternals;e:{if(Ku(n)!==n||n.tag!==1)throw Error(zt(170));var e=n;do{switch(e.tag){case 3:e=e.stateNode.context;break e;case 1:if(La(e.type)){e=e.stateNode.__reactInternalMemoizedMergedChildContext;break e}}e=e.return}while(e!==null);throw Error(zt(171))}if(n.tag===1){var t=n.type;if(La(t))return aE(n,t,e)}return e}function oA(n,e,t,i,r,l,h,o,p){return n=rw(t,i,!0,n,r,l,h,o,p),n.context=sA(null),t=n.current,i=_a(),r=Ac(t),l=hl(i,r),l.callback=e??null,Tc(t,l,r),n.current.lanes=r,Up(n,r,i),za(n,i),n}function Ny(n,e,t,i){var r=e.current,l=_a(),h=Ac(r);return t=sA(t),e.context===null?e.context=t:e.pendingContext=t,e=hl(l,h),e.payload={element:n},i=i===void 0?null:i,i!==null&&(e.callback=i),n=Tc(r,e,h),n!==null&&(Ys(n,r,h,l),m1(n,r,h)),h}function ey(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function LS(n,e){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var t=n.retryLane;n.retryLane=t!==0&&t<e?t:e}}function aw(n,e){LS(n,e),(n=n.alternate)&&LS(n,e)}function hI(){return null}var lA=typeof reportError=="function"?reportError:function(n){console.error(n)};function sw(n){this._internalRoot=n}By.prototype.render=sw.prototype.render=function(n){var e=this._internalRoot;if(e===null)throw Error(zt(409));Ny(n,e,null,null)};By.prototype.unmount=sw.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var e=n.containerInfo;Gu(function(){Ny(null,n,null,null)}),e[gl]=null}};function By(n){this._internalRoot=n}By.prototype.unstable_scheduleHydration=function(n){if(n){var e=B6();n={blockedOn:null,target:n,priority:e};for(var t=0;t<pc.length&&e!==0&&e<pc[t].priority;t++);pc.splice(t,0,n),t===0&&U6(n)}};function ow(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Oy(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function zS(){}function dI(n,e,t,i,r){if(r){if(typeof i=="function"){var l=i;i=function(){var v=ey(h);l.call(v)}}var h=oA(e,i,n,0,null,!1,!1,"",zS);return n._reactRootContainer=h,n[gl]=h.current,yp(n.nodeType===8?n.parentNode:n),Gu(),h}for(;r=n.lastChild;)n.removeChild(r);if(typeof i=="function"){var o=i;i=function(){var v=ey(p);o.call(v)}}var p=rw(n,0,!1,null,null,!1,!1,"",zS);return n._reactRootContainer=p,n[gl]=p.current,yp(n.nodeType===8?n.parentNode:n),Gu(function(){Ny(e,p,t,i)}),p}function Uy(n,e,t,i,r){var l=t._reactRootContainer;if(l){var h=l;if(typeof r=="function"){var o=r;r=function(){var p=ey(h);o.call(p)}}Ny(e,h,n,r)}else h=dI(t,e,n,r,i);return ey(h)}F6=function(n){switch(n.tag){case 3:var e=n.stateNode;if(e.current.memoizedState.isDehydrated){var t=V0(e.pendingLanes);t!==0&&(Eb(e,t|1),za(e,dr()),!(ui&6)&&(qd=dr()+500,Uc()))}break;case 13:Gu(function(){var i=yl(n,1);if(i!==null){var r=_a();Ys(i,n,1,r)}}),aw(n,1)}};Ab=function(n){if(n.tag===13){var e=yl(n,134217728);if(e!==null){var t=_a();Ys(e,n,134217728,t)}aw(n,134217728)}};N6=function(n){if(n.tag===13){var e=Ac(n),t=yl(n,e);if(t!==null){var i=_a();Ys(t,n,e,i)}aw(n,e)}};B6=function(){return _i};O6=function(n,e){var t=_i;try{return _i=n,e()}finally{_i=t}};t2=function(n,e,t){switch(e){case"input":if(Xx(n,t),e=t.name,t.type==="radio"&&e!=null){for(t=n;t.parentNode;)t=t.parentNode;for(t=t.querySelectorAll("input[name="+JSON.stringify(""+e)+'][type="radio"]'),e=0;e<t.length;e++){var i=t[e];if(i!==n&&i.form===n.form){var r=Ry(i);if(!r)throw Error(zt(90));g6(i),Xx(i,r)}}}break;case"textarea":v6(n,t);break;case"select":e=t.value,e!=null&&Cd(n,!!t.multiple,e,!1)}};T6=ew;E6=Gu;var fI={usingClientEntryPoint:!1,Events:[Hp,md,Ry,S6,M6,ew]},E0={findFiberByHostInstance:Cu,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},pI={bundleType:E0.bundleType,version:E0.version,rendererPackageName:E0.rendererPackageName,rendererConfig:E0.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Tl.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=P6(n),n===null?null:n.stateNode},findFiberByHostInstance:E0.findFiberByHostInstance||hI,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Sg=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Sg.isDisabled&&Sg.supportsFiber)try{Ey=Sg.inject(pI),bo=Sg}catch{}}is.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fI;is.createPortal=function(n,e){var t=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!ow(e))throw Error(zt(200));return uI(n,e,null,t)};is.createRoot=function(n,e){if(!ow(n))throw Error(zt(299));var t=!1,i="",r=lA;return e!=null&&(e.unstable_strictMode===!0&&(t=!0),e.identifierPrefix!==void 0&&(i=e.identifierPrefix),e.onRecoverableError!==void 0&&(r=e.onRecoverableError)),e=rw(n,1,!1,null,null,t,!1,i,r),n[gl]=e.current,yp(n.nodeType===8?n.parentNode:n),new sw(e)};is.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var e=n._reactInternals;if(e===void 0)throw typeof n.render=="function"?Error(zt(188)):(n=Object.keys(n).join(","),Error(zt(268,n)));return n=P6(e),n=n===null?null:n.stateNode,n};is.flushSync=function(n){return Gu(n)};is.hydrate=function(n,e,t){if(!Oy(e))throw Error(zt(200));return Uy(null,n,e,!0,t)};is.hydrateRoot=function(n,e,t){if(!ow(n))throw Error(zt(405));var i=t!=null&&t.hydratedSources||null,r=!1,l="",h=lA;if(t!=null&&(t.unstable_strictMode===!0&&(r=!0),t.identifierPrefix!==void 0&&(l=t.identifierPrefix),t.onRecoverableError!==void 0&&(h=t.onRecoverableError)),e=oA(e,null,n,1,t??null,r,!1,l,h),n[gl]=e.current,yp(n),i)for(n=0;n<i.length;n++)t=i[n],r=t._getVersion,r=r(t._source),e.mutableSourceEagerHydrationData==null?e.mutableSourceEagerHydrationData=[t,r]:e.mutableSourceEagerHydrationData.push(t,r);return new By(e)};is.render=function(n,e,t){if(!Oy(e))throw Error(zt(200));return Uy(null,n,e,!1,t)};is.unmountComponentAtNode=function(n){if(!Oy(n))throw Error(zt(40));return n._reactRootContainer?(Gu(function(){Uy(null,null,n,!1,function(){n._reactRootContainer=null,n[gl]=null})}),!0):!1};is.unstable_batchedUpdates=ew;is.unstable_renderSubtreeIntoContainer=function(n,e,t,i){if(!Oy(t))throw Error(zt(200));if(n==null||n._reactInternals===void 0)throw Error(zt(38));return Uy(n,e,t,!1,i)};is.version="18.2.0-next-9e3b772b8-20220608";function cA(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(cA)}catch(n){console.error(n)}}cA(),o6.exports=is;var lw=o6.exports;const mI=ZT(lw),gI=XT({__proto__:null,default:mI},[lw]);var FS=lw;Vx.createRoot=FS.createRoot,Vx.hydrateRoot=FS.hydrateRoot;/**
 * @remix-run/router v1.15.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function rr(){return rr=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},rr.apply(this,arguments)}var hr;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(hr||(hr={}));const NS="popstate";function yI(n){n===void 0&&(n={});function e(r,l){let{pathname:h="/",search:o="",hash:p=""}=Eo(r.location.hash.substr(1));return!h.startsWith("/")&&!h.startsWith(".")&&(h="/"+h),Ep("",{pathname:h,search:o,hash:p},l.state&&l.state.usr||null,l.state&&l.state.key||"default")}function t(r,l){let h=r.document.querySelector("base"),o="";if(h&&h.getAttribute("href")){let p=r.location.href,v=p.indexOf("#");o=v===-1?p:p.slice(0,v)}return o+"#"+(typeof l=="string"?l:Wu(l))}function i(r,l){ju(r.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(l)+")")}return _I(e,t,i,n)}function ni(n,e){if(n===!1||n===null||typeof n>"u")throw new Error(e)}function ju(n,e){if(!n){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function vI(){return Math.random().toString(36).substr(2,8)}function BS(n,e){return{usr:n.state,key:n.key,idx:e}}function Ep(n,e,t,i){return t===void 0&&(t=null),rr({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof e=="string"?Eo(e):e,{state:t,key:e&&e.key||i||vI()})}function Wu(n){let{pathname:e="/",search:t="",hash:i=""}=n;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),i&&i!=="#"&&(e+=i.charAt(0)==="#"?i:"#"+i),e}function Eo(n){let e={};if(n){let t=n.indexOf("#");t>=0&&(e.hash=n.substr(t),n=n.substr(0,t));let i=n.indexOf("?");i>=0&&(e.search=n.substr(i),n=n.substr(0,i)),n&&(e.pathname=n)}return e}function _I(n,e,t,i){i===void 0&&(i={});let{window:r=document.defaultView,v5Compat:l=!1}=i,h=r.history,o=hr.Pop,p=null,v=x();v==null&&(v=0,h.replaceState(rr({},h.state,{idx:v}),""));function x(){return(h.state||{idx:null}).idx}function M(){o=hr.Pop;let k=x(),C=k==null?null:k-v;v=k,p&&p({action:o,location:F.location,delta:C})}function S(k,C){o=hr.Push;let V=Ep(F.location,k,C);t&&t(V,k),v=x()+1;let O=BS(V,v),J=F.createHref(V);try{h.pushState(O,"",J)}catch(ue){if(ue instanceof DOMException&&ue.name==="DataCloneError")throw ue;r.location.assign(J)}l&&p&&p({action:o,location:F.location,delta:1})}function A(k,C){o=hr.Replace;let V=Ep(F.location,k,C);t&&t(V,k),v=x();let O=BS(V,v),J=F.createHref(V);h.replaceState(O,"",J),l&&p&&p({action:o,location:F.location,delta:0})}function L(k){let C=r.location.origin!=="null"?r.location.origin:r.location.href,V=typeof k=="string"?k:Wu(k);return V=V.replace(/ $/,"%20"),ni(C,"No window.location.(origin|href) available to create URL for href: "+V),new URL(V,C)}let F={get action(){return o},get location(){return n(r,h)},listen(k){if(p)throw new Error("A history only accepts one active listener");return r.addEventListener(NS,M),p=k,()=>{r.removeEventListener(NS,M),p=null}},createHref(k){return e(r,k)},createURL:L,encodeLocation(k){let C=L(k);return{pathname:C.pathname,search:C.search,hash:C.hash}},push:S,replace:A,go(k){return h.go(k)}};return F}var nr;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(nr||(nr={}));const xI=new Set(["lazy","caseSensitive","path","id","index","children"]);function bI(n){return n.index===!0}function L2(n,e,t,i){return t===void 0&&(t=[]),i===void 0&&(i={}),n.map((r,l)=>{let h=[...t,l],o=typeof r.id=="string"?r.id:h.join("-");if(ni(r.index!==!0||!r.children,"Cannot specify children on an index route"),ni(!i[o],'Found a route id collision on id "'+o+`".  Route id's must be globally unique within Data Router usages`),bI(r)){let p=rr({},r,e(r),{id:o});return i[o]=p,p}else{let p=rr({},r,e(r),{id:o,children:void 0});return i[o]=p,r.children&&(p.children=L2(r.children,e,h,i)),p}})}function wd(n,e,t){t===void 0&&(t="/");let i=typeof e=="string"?Eo(e):e,r=_l(i.pathname||"/",t);if(r==null)return null;let l=uA(n);SI(l);let h=null;for(let o=0;h==null&&o<l.length;++o){let p=LI(r);h=kI(l[o],p)}return h}function wI(n,e){let{route:t,pathname:i,params:r}=n;return{id:t.id,pathname:i,params:r,data:e[t.id],handle:t.handle}}function uA(n,e,t,i){e===void 0&&(e=[]),t===void 0&&(t=[]),i===void 0&&(i="");let r=(l,h,o)=>{let p={relativePath:o===void 0?l.path||"":o,caseSensitive:l.caseSensitive===!0,childrenIndex:h,route:l};p.relativePath.startsWith("/")&&(ni(p.relativePath.startsWith(i),'Absolute route path "'+p.relativePath+'" nested under path '+('"'+i+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),p.relativePath=p.relativePath.slice(i.length));let v=dl([i,p.relativePath]),x=t.concat(p);l.children&&l.children.length>0&&(ni(l.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+v+'".')),uA(l.children,e,x,v)),!(l.path==null&&!l.index)&&e.push({path:v,score:RI(v,l.index),routesMeta:x})};return n.forEach((l,h)=>{var o;if(l.path===""||!((o=l.path)!=null&&o.includes("?")))r(l,h);else for(let p of hA(l.path))r(l,h,p)}),e}function hA(n){let e=n.split("/");if(e.length===0)return[];let[t,...i]=e,r=t.endsWith("?"),l=t.replace(/\?$/,"");if(i.length===0)return r?[l,""]:[l];let h=hA(i.join("/")),o=[];return o.push(...h.map(p=>p===""?l:[l,p].join("/"))),r&&o.push(...h),o.map(p=>n.startsWith("/")&&p===""?"/":p)}function SI(n){n.sort((e,t)=>e.score!==t.score?t.score-e.score:II(e.routesMeta.map(i=>i.childrenIndex),t.routesMeta.map(i=>i.childrenIndex)))}const MI=/^:[\w-]+$/,TI=3,EI=2,AI=1,CI=10,PI=-2,OS=n=>n==="*";function RI(n,e){let t=n.split("/"),i=t.length;return t.some(OS)&&(i+=PI),e&&(i+=EI),t.filter(r=>!OS(r)).reduce((r,l)=>r+(MI.test(l)?TI:l===""?AI:CI),i)}function II(n,e){return n.length===e.length&&n.slice(0,-1).every((i,r)=>i===e[r])?n[n.length-1]-e[e.length-1]:0}function kI(n,e){let{routesMeta:t}=n,i={},r="/",l=[];for(let h=0;h<t.length;++h){let o=t[h],p=h===t.length-1,v=r==="/"?e:e.slice(r.length)||"/",x=z2({path:o.relativePath,caseSensitive:o.caseSensitive,end:p},v);if(!x)return null;Object.assign(i,x.params);let M=o.route;l.push({params:i,pathname:dl([r,x.pathname]),pathnameBase:NI(dl([r,x.pathnameBase])),route:M}),x.pathnameBase!=="/"&&(r=dl([r,x.pathnameBase]))}return l}function z2(n,e){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[t,i]=DI(n.path,n.caseSensitive,n.end),r=e.match(t);if(!r)return null;let l=r[0],h=l.replace(/(.)\/+$/,"$1"),o=r.slice(1);return{params:i.reduce((v,x,M)=>{let{paramName:S,isOptional:A}=x;if(S==="*"){let F=o[M]||"";h=l.slice(0,l.length-F.length).replace(/(.)\/+$/,"$1")}const L=o[M];return A&&!L?v[S]=void 0:v[S]=(L||"").replace(/%2F/g,"/"),v},{}),pathname:l,pathnameBase:h,pattern:n}}function DI(n,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),ju(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let i=[],r="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(h,o,p)=>(i.push({paramName:o,isOptional:p!=null}),p?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(i.push({paramName:"*"}),r+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":n!==""&&n!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),i]}function LI(n){try{return n.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ju(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),n}}function _l(n,e){if(e==="/")return n;if(!n.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,i=n.charAt(t);return i&&i!=="/"?null:n.slice(t)||"/"}function zI(n,e){e===void 0&&(e="/");let{pathname:t,search:i="",hash:r=""}=typeof n=="string"?Eo(n):n;return{pathname:t?t.startsWith("/")?t:FI(t,e):e,search:BI(i),hash:OI(r)}}function FI(n,e){let t=e.replace(/\/+$/,"").split("/");return n.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function z_(n,e,t,i){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(i)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function dA(n){return n.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function cw(n,e){let t=dA(n);return e?t.map((i,r)=>r===n.length-1?i.pathname:i.pathnameBase):t.map(i=>i.pathnameBase)}function uw(n,e,t,i){i===void 0&&(i=!1);let r;typeof n=="string"?r=Eo(n):(r=rr({},n),ni(!r.pathname||!r.pathname.includes("?"),z_("?","pathname","search",r)),ni(!r.pathname||!r.pathname.includes("#"),z_("#","pathname","hash",r)),ni(!r.search||!r.search.includes("#"),z_("#","search","hash",r)));let l=n===""||r.pathname==="",h=l?"/":r.pathname,o;if(h==null)o=t;else{let M=e.length-1;if(!i&&h.startsWith("..")){let S=h.split("/");for(;S[0]==="..";)S.shift(),M-=1;r.pathname=S.join("/")}o=M>=0?e[M]:"/"}let p=zI(r,o),v=h&&h!=="/"&&h.endsWith("/"),x=(l||h===".")&&t.endsWith("/");return!p.pathname.endsWith("/")&&(v||x)&&(p.pathname+="/"),p}const dl=n=>n.join("/").replace(/\/\/+/g,"/"),NI=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),BI=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,OI=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;class hw{constructor(e,t,i,r){r===void 0&&(r=!1),this.status=e,this.statusText=t||"",this.internal=r,i instanceof Error?(this.data=i.toString(),this.error=i):this.data=i}}function fA(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const pA=["post","put","patch","delete"],UI=new Set(pA),VI=["get",...pA],HI=new Set(VI),GI=new Set([301,302,303,307,308]),jI=new Set([307,308]),F_={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},WI={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0},A0={state:"unblocked",proceed:void 0,reset:void 0,location:void 0},mA=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,qI=n=>({hasErrorBoundary:!!n.hasErrorBoundary}),gA="remix-router-transitions";function $I(n){const e=n.window?n.window:typeof window<"u"?window:void 0,t=typeof e<"u"&&typeof e.document<"u"&&typeof e.document.createElement<"u",i=!t;ni(n.routes.length>0,"You must provide a non-empty routes array to createRouter");let r;if(n.mapRouteProperties)r=n.mapRouteProperties;else if(n.detectErrorBoundary){let B=n.detectErrorBoundary;r=U=>({hasErrorBoundary:B(U)})}else r=qI;let l={},h=L2(n.routes,r,void 0,l),o,p=n.basename||"/",v=rr({v7_fetcherPersist:!1,v7_normalizeFormMethod:!1,v7_partialHydration:!1,v7_prependBasename:!1,v7_relativeSplatPath:!1},n.future),x=null,M=new Set,S=null,A=null,L=null,F=n.hydrationData!=null,k=wd(h,n.history.location,p),C=null;if(k==null){let B=ps(404,{pathname:n.history.location.pathname}),{matches:U,route:q}=$S(h);k=U,C={[q.id]:B}}let V,O=k.some(B=>B.route.lazy),J=k.some(B=>B.route.loader);if(O)V=!1;else if(!J)V=!0;else if(v.v7_partialHydration){let B=n.hydrationData?n.hydrationData.loaderData:null,U=n.hydrationData?n.hydrationData.errors:null,q=ne=>ne.route.loader?ne.route.loader.hydrate===!0?!1:B&&B[ne.route.id]!==void 0||U&&U[ne.route.id]!==void 0:!0;if(U){let ne=k.findIndex(me=>U[me.route.id]!==void 0);V=k.slice(0,ne+1).every(q)}else V=k.every(q)}else V=n.hydrationData!=null;let ue,Y={historyAction:n.history.action,location:n.history.location,matches:k,initialized:V,navigation:F_,restoreScrollPosition:n.hydrationData!=null?!1:null,preventScrollReset:!1,revalidation:"idle",loaderData:n.hydrationData&&n.hydrationData.loaderData||{},actionData:n.hydrationData&&n.hydrationData.actionData||null,errors:n.hydrationData&&n.hydrationData.errors||C,fetchers:new Map,blockers:new Map},Q=hr.Pop,xe=!1,re,ee=!1,Me=new Map,Fe=null,Ae=!1,He=!1,ot=[],ft=[],ct=new Map,De=0,Je=-1,tt=new Map,_t=new Set,Lt=new Map,Cn=new Map,nt=new Set,wt=new Map,Ft=new Map,At=!1;function gn(){if(x=n.history.listen(B=>{let{action:U,location:q,delta:ne}=B;if(At){At=!1;return}ju(Ft.size===0||ne!=null,"You are trying to use a blocker on a POP navigation to a location that was not created by @remix-run/router. This will fail silently in production. This can happen if you are navigating outside the router via `window.history.pushState`/`window.location.hash` instead of using router navigation APIs.  This can also happen if you are using createHashRouter and the user manually changes the URL.");let me=jt({currentLocation:Y.location,nextLocation:q,historyAction:U});if(me&&ne!=null){At=!0,n.history.go(ne*-1),Ht(me,{state:"blocked",location:q,proceed(){Ht(me,{state:"proceeding",proceed:void 0,reset:void 0,location:q}),n.history.go(ne)},reset(){let Se=new Map(Y.blockers);Se.set(me,A0),je({blockers:Se})}});return}return Yt(U,q)}),t){rk(e,Me);let B=()=>ak(e,Me);e.addEventListener("pagehide",B),Fe=()=>e.removeEventListener("pagehide",B)}return Y.initialized||Yt(hr.Pop,Y.location,{initialHydration:!0}),ue}function En(){x&&x(),Fe&&Fe(),M.clear(),re&&re.abort(),Y.fetchers.forEach((B,U)=>Nt(U)),Y.blockers.forEach((B,U)=>dt(U))}function In(B){return M.add(B),()=>M.delete(B)}function je(B,U){U===void 0&&(U={}),Y=rr({},Y,B);let q=[],ne=[];v.v7_fetcherPersist&&Y.fetchers.forEach((me,Se)=>{me.state==="idle"&&(nt.has(Se)?ne.push(Se):q.push(Se))}),[...M].forEach(me=>me(Y,{deletedFetchers:ne,unstable_viewTransitionOpts:U.viewTransitionOpts,unstable_flushSync:U.flushSync===!0})),v.v7_fetcherPersist&&(q.forEach(me=>Y.fetchers.delete(me)),ne.forEach(me=>Nt(me)))}function An(B,U,q){var ne,me;let{flushSync:Se}=q===void 0?{}:q,Ee=Y.actionData!=null&&Y.navigation.formMethod!=null&&Gs(Y.navigation.formMethod)&&Y.navigation.state==="loading"&&((ne=B.state)==null?void 0:ne._isRedirect)!==!0,ye;U.actionData?Object.keys(U.actionData).length>0?ye=U.actionData:ye=null:Ee?ye=Y.actionData:ye=null;let Re=U.loaderData?qS(Y.loaderData,U.loaderData,U.matches||[],U.errors):Y.loaderData,qe=Y.blockers;qe.size>0&&(qe=new Map(qe),qe.forEach((Ct,nn)=>qe.set(nn,A0)));let Ye=xe===!0||Y.navigation.formMethod!=null&&Gs(Y.navigation.formMethod)&&((me=B.state)==null?void 0:me._isRedirect)!==!0;o&&(h=o,o=void 0),Ae||Q===hr.Pop||(Q===hr.Push?n.history.push(B,B.state):Q===hr.Replace&&n.history.replace(B,B.state));let Ge;if(Q===hr.Pop){let Ct=Me.get(Y.location.pathname);Ct&&Ct.has(B.pathname)?Ge={currentLocation:Y.location,nextLocation:B}:Me.has(B.pathname)&&(Ge={currentLocation:B,nextLocation:Y.location})}else if(ee){let Ct=Me.get(Y.location.pathname);Ct?Ct.add(B.pathname):(Ct=new Set([B.pathname]),Me.set(Y.location.pathname,Ct)),Ge={currentLocation:Y.location,nextLocation:B}}je(rr({},U,{actionData:ye,loaderData:Re,historyAction:Q,location:B,initialized:!0,navigation:F_,revalidation:"idle",restoreScrollPosition:Dt(B,U.matches||Y.matches),preventScrollReset:Ye,blockers:qe}),{viewTransitionOpts:Ge,flushSync:Se===!0}),Q=hr.Pop,xe=!1,ee=!1,Ae=!1,He=!1,ot=[],ft=[]}async function yn(B,U){if(typeof B=="number"){n.history.go(B);return}let q=F2(Y.location,Y.matches,p,v.v7_prependBasename,B,v.v7_relativeSplatPath,U==null?void 0:U.fromRouteId,U==null?void 0:U.relative),{path:ne,submission:me,error:Se}=US(v.v7_normalizeFormMethod,!1,q,U),Ee=Y.location,ye=Ep(Y.location,ne,U&&U.state);ye=rr({},ye,n.history.encodeLocation(ye));let Re=U&&U.replace!=null?U.replace:void 0,qe=hr.Push;Re===!0?qe=hr.Replace:Re===!1||me!=null&&Gs(me.formMethod)&&me.formAction===Y.location.pathname+Y.location.search&&(qe=hr.Replace);let Ye=U&&"preventScrollReset"in U?U.preventScrollReset===!0:void 0,Ge=(U&&U.unstable_flushSync)===!0,Ct=jt({currentLocation:Ee,nextLocation:ye,historyAction:qe});if(Ct){Ht(Ct,{state:"blocked",location:ye,proceed(){Ht(Ct,{state:"proceeding",proceed:void 0,reset:void 0,location:ye}),yn(B,U)},reset(){let nn=new Map(Y.blockers);nn.set(Ct,A0),je({blockers:nn})}});return}return await Yt(qe,ye,{submission:me,pendingError:Se,preventScrollReset:Ye,replace:U&&U.replace,enableViewTransition:U&&U.unstable_viewTransition,flushSync:Ge})}function Qn(){if(_n(),je({revalidation:"loading"}),Y.navigation.state!=="submitting"){if(Y.navigation.state==="idle"){Yt(Y.historyAction,Y.location,{startUninterruptedRevalidation:!0});return}Yt(Q||Y.historyAction,Y.navigation.location,{overrideNavigation:Y.navigation})}}async function Yt(B,U,q){re&&re.abort(),re=null,Q=B,Ae=(q&&q.startUninterruptedRevalidation)===!0,pt(Y.location,Y.matches),xe=(q&&q.preventScrollReset)===!0,ee=(q&&q.enableViewTransition)===!0;let ne=o||h,me=q&&q.overrideNavigation,Se=wd(ne,U,p),Ee=(q&&q.flushSync)===!0;if(!Se){let nn=ps(404,{pathname:U.pathname}),{matches:on,route:bn}=$S(ne);Jt(),An(U,{matches:on,loaderData:{},errors:{[bn.id]:nn}},{flushSync:Ee});return}if(Y.initialized&&!He&&JI(Y.location,U)&&!(q&&q.submission&&Gs(q.submission.formMethod))){An(U,{matches:Se},{flushSync:Ee});return}re=new AbortController;let ye=P0(n.history,U,re.signal,q&&q.submission),Re,qe;if(q&&q.pendingError)qe={[ip(Se).route.id]:q.pendingError};else if(q&&q.submission&&Gs(q.submission.formMethod)){let nn=await Gn(ye,U,q.submission,Se,{replace:q.replace,flushSync:Ee});if(nn.shortCircuited)return;Re=nn.pendingActionData,qe=nn.pendingActionError,me=N_(U,q.submission),Ee=!1,ye=new Request(ye.url,{signal:ye.signal})}let{shortCircuited:Ye,loaderData:Ge,errors:Ct}=await ie(ye,U,Se,me,q&&q.submission,q&&q.fetcherSubmission,q&&q.replace,q&&q.initialHydration===!0,Ee,Re,qe);Ye||(re=null,An(U,rr({matches:Se},Re?{actionData:Re}:{},{loaderData:Ge,errors:Ct})))}async function Gn(B,U,q,ne,me){me===void 0&&(me={}),_n();let Se=nk(U,q);je({navigation:Se},{flushSync:me.flushSync===!0});let Ee,ye=B2(ne,U);if(!ye.route.action&&!ye.route.lazy)Ee={type:nr.error,error:ps(405,{method:B.method,pathname:U.pathname,routeId:ye.route.id})};else if(Ee=await C0("action",B,ye,ne,l,r,p,v.v7_relativeSplatPath),B.signal.aborted)return{shortCircuited:!0};if(ku(Ee)){let Re;return me&&me.replace!=null?Re=me.replace:Re=Ee.location===Y.location.pathname+Y.location.search,await mt(Y,Ee,{submission:q,replace:Re}),{shortCircuited:!0}}if(Sd(Ee)){let Re=ip(ne,ye.route.id);return(me&&me.replace)!==!0&&(Q=hr.Push),{pendingActionData:{},pendingActionError:{[Re.route.id]:Ee.error}}}if(Iu(Ee))throw ps(400,{type:"defer-action"});return{pendingActionData:{[ye.route.id]:Ee.data}}}async function ie(B,U,q,ne,me,Se,Ee,ye,Re,qe,Ye){let Ge=ne||N_(U,me),Ct=me||Se||YS(Ge),nn=o||h,[on,bn]=VS(n.history,Y,q,Ct,U,v.v7_partialHydration&&ye===!0,He,ot,ft,nt,Lt,_t,nn,p,qe,Ye);if(Jt(It=>!(q&&q.some(Qt=>Qt.route.id===It))||on&&on.some(Qt=>Qt.route.id===It)),Je=++De,on.length===0&&bn.length===0){let It=Kt();return An(U,rr({matches:q,loaderData:{},errors:Ye||null},qe?{actionData:qe}:{},It?{fetchers:new Map(Y.fetchers)}:{}),{flushSync:Re}),{shortCircuited:!0}}if(!Ae&&(!v.v7_partialHydration||!ye)){bn.forEach(Qt=>{let Sn=Y.fetchers.get(Qt.key),Xt=R0(void 0,Sn?Sn.data:void 0);Y.fetchers.set(Qt.key,Xt)});let It=qe||Y.actionData;je(rr({navigation:Ge},It?Object.keys(It).length===0?{actionData:null}:{actionData:It}:{},bn.length>0?{fetchers:new Map(Y.fetchers)}:{}),{flushSync:Re})}bn.forEach(It=>{ct.has(It.key)&&at(It.key),It.controller&&ct.set(It.key,It.controller)});let wn=()=>bn.forEach(It=>at(It.key));re&&re.signal.addEventListener("abort",wn);let{results:li,loaderResults:ei,fetcherResults:de}=await St(Y.matches,q,on,bn,B);if(B.signal.aborted)return{shortCircuited:!0};re&&re.signal.removeEventListener("abort",wn),bn.forEach(It=>ct.delete(It.key));let Le=XS(li);if(Le){if(Le.idx>=on.length){let It=bn[Le.idx-on.length].key;_t.add(It)}return await mt(Y,Le.result,{replace:Ee}),{shortCircuited:!0}}let{loaderData:We,errors:Xe}=WS(Y,q,on,ei,Ye,bn,de,wt);wt.forEach((It,Qt)=>{It.subscribe(Sn=>{(Sn||It.done)&&wt.delete(Qt)})}),v.v7_partialHydration&&ye&&Y.errors&&Object.entries(Y.errors).filter(It=>{let[Qt]=It;return!on.some(Sn=>Sn.route.id===Qt)}).forEach(It=>{let[Qt,Sn]=It;Xe=Object.assign(Xe||{},{[Qt]:Sn})});let Ze=Kt(),Pt=On(Je),rn=Ze||Pt||bn.length>0;return rr({loaderData:We,errors:Xe},rn?{fetchers:new Map(Y.fetchers)}:{})}function le(B,U,q,ne){if(i)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");ct.has(B)&&at(B);let me=(ne&&ne.unstable_flushSync)===!0,Se=o||h,Ee=F2(Y.location,Y.matches,p,v.v7_prependBasename,q,v.v7_relativeSplatPath,U,ne==null?void 0:ne.relative),ye=wd(Se,Ee,p);if(!ye){hn(B,U,ps(404,{pathname:Ee}),{flushSync:me});return}let{path:Re,submission:qe,error:Ye}=US(v.v7_normalizeFormMethod,!0,Ee,ne);if(Ye){hn(B,U,Ye,{flushSync:me});return}let Ge=B2(ye,Re);if(xe=(ne&&ne.preventScrollReset)===!0,qe&&Gs(qe.formMethod)){st(B,U,Re,Ge,ye,me,qe);return}Lt.set(B,{routeId:U,path:Re}),rt(B,U,Re,Ge,ye,me,qe)}async function st(B,U,q,ne,me,Se,Ee){if(_n(),Lt.delete(B),!ne.route.action&&!ne.route.lazy){let Qt=ps(405,{method:Ee.formMethod,pathname:q,routeId:U});hn(B,U,Qt,{flushSync:Se});return}let ye=Y.fetchers.get(B);Mt(B,ik(Ee,ye),{flushSync:Se});let Re=new AbortController,qe=P0(n.history,q,Re.signal,Ee);ct.set(B,Re);let Ye=De,Ge=await C0("action",qe,ne,me,l,r,p,v.v7_relativeSplatPath);if(qe.signal.aborted){ct.get(B)===Re&&ct.delete(B);return}if(v.v7_fetcherPersist&&nt.has(B)){if(ku(Ge)||Sd(Ge)){Mt(B,cc(void 0));return}}else{if(ku(Ge))if(ct.delete(B),Je>Ye){Mt(B,cc(void 0));return}else return _t.add(B),Mt(B,R0(Ee)),mt(Y,Ge,{fetcherSubmission:Ee});if(Sd(Ge)){hn(B,U,Ge.error);return}}if(Iu(Ge))throw ps(400,{type:"defer-action"});let Ct=Y.navigation.location||Y.location,nn=P0(n.history,Ct,Re.signal),on=o||h,bn=Y.navigation.state!=="idle"?wd(on,Y.navigation.location,p):Y.matches;ni(bn,"Didn't find any matches after fetcher action");let wn=++De;tt.set(B,wn);let li=R0(Ee,Ge.data);Y.fetchers.set(B,li);let[ei,de]=VS(n.history,Y,bn,Ee,Ct,!1,He,ot,ft,nt,Lt,_t,on,p,{[ne.route.id]:Ge.data},void 0);de.filter(Qt=>Qt.key!==B).forEach(Qt=>{let Sn=Qt.key,Xt=Y.fetchers.get(Sn),Fn=R0(void 0,Xt?Xt.data:void 0);Y.fetchers.set(Sn,Fn),ct.has(Sn)&&at(Sn),Qt.controller&&ct.set(Sn,Qt.controller)}),je({fetchers:new Map(Y.fetchers)});let Le=()=>de.forEach(Qt=>at(Qt.key));Re.signal.addEventListener("abort",Le);let{results:We,loaderResults:Xe,fetcherResults:Ze}=await St(Y.matches,bn,ei,de,nn);if(Re.signal.aborted)return;Re.signal.removeEventListener("abort",Le),tt.delete(B),ct.delete(B),de.forEach(Qt=>ct.delete(Qt.key));let Pt=XS(We);if(Pt){if(Pt.idx>=ei.length){let Qt=de[Pt.idx-ei.length].key;_t.add(Qt)}return mt(Y,Pt.result)}let{loaderData:rn,errors:It}=WS(Y,Y.matches,ei,Xe,void 0,de,Ze,wt);if(Y.fetchers.has(B)){let Qt=cc(Ge.data);Y.fetchers.set(B,Qt)}On(wn),Y.navigation.state==="loading"&&wn>Je?(ni(Q,"Expected pending action"),re&&re.abort(),An(Y.navigation.location,{matches:bn,loaderData:rn,errors:It,fetchers:new Map(Y.fetchers)})):(je({errors:It,loaderData:qS(Y.loaderData,rn,bn,It),fetchers:new Map(Y.fetchers)}),He=!1)}async function rt(B,U,q,ne,me,Se,Ee){let ye=Y.fetchers.get(B);Mt(B,R0(Ee,ye?ye.data:void 0),{flushSync:Se});let Re=new AbortController,qe=P0(n.history,q,Re.signal);ct.set(B,Re);let Ye=De,Ge=await C0("loader",qe,ne,me,l,r,p,v.v7_relativeSplatPath);if(Iu(Ge)&&(Ge=await _A(Ge,qe.signal,!0)||Ge),ct.get(B)===Re&&ct.delete(B),!qe.signal.aborted){if(nt.has(B)){Mt(B,cc(void 0));return}if(ku(Ge))if(Je>Ye){Mt(B,cc(void 0));return}else{_t.add(B),await mt(Y,Ge);return}if(Sd(Ge)){hn(B,U,Ge.error);return}ni(!Iu(Ge),"Unhandled fetcher deferred data"),Mt(B,cc(Ge.data))}}async function mt(B,U,q){let{submission:ne,fetcherSubmission:me,replace:Se}=q===void 0?{}:q;U.revalidate&&(He=!0);let Ee=Ep(B.location,U.location,{_isRedirect:!0});if(ni(Ee,"Expected a location on the redirect navigation"),t){let Ct=!1;if(U.reloadDocument)Ct=!0;else if(mA.test(U.location)){const nn=n.history.createURL(U.location);Ct=nn.origin!==e.location.origin||_l(nn.pathname,p)==null}if(Ct){Se?e.location.replace(U.location):e.location.assign(U.location);return}}re=null;let ye=Se===!0?hr.Replace:hr.Push,{formMethod:Re,formAction:qe,formEncType:Ye}=B.navigation;!ne&&!me&&Re&&qe&&Ye&&(ne=YS(B.navigation));let Ge=ne||me;if(jI.has(U.status)&&Ge&&Gs(Ge.formMethod))await Yt(ye,Ee,{submission:rr({},Ge,{formAction:U.location}),preventScrollReset:xe});else{let Ct=N_(Ee,ne);await Yt(ye,Ee,{overrideNavigation:Ct,fetcherSubmission:me,preventScrollReset:xe})}}async function St(B,U,q,ne,me){let Se=await Promise.all([...q.map(Re=>C0("loader",me,Re,U,l,r,p,v.v7_relativeSplatPath)),...ne.map(Re=>Re.matches&&Re.match&&Re.controller?C0("loader",P0(n.history,Re.path,Re.controller.signal),Re.match,Re.matches,l,r,p,v.v7_relativeSplatPath):{type:nr.error,error:ps(404,{pathname:Re.path})})]),Ee=Se.slice(0,q.length),ye=Se.slice(q.length);return await Promise.all([ZS(B,q,Ee,Ee.map(()=>me.signal),!1,Y.loaderData),ZS(B,ne.map(Re=>Re.match),ye,ne.map(Re=>Re.controller?Re.controller.signal:null),!0)]),{results:Se,loaderResults:Ee,fetcherResults:ye}}function _n(){He=!0,ot.push(...Jt()),Lt.forEach((B,U)=>{ct.has(U)&&(ft.push(U),at(U))})}function Mt(B,U,q){q===void 0&&(q={}),Y.fetchers.set(B,U),je({fetchers:new Map(Y.fetchers)},{flushSync:(q&&q.flushSync)===!0})}function hn(B,U,q,ne){ne===void 0&&(ne={});let me=ip(Y.matches,U);Nt(B),je({errors:{[me.route.id]:q},fetchers:new Map(Y.fetchers)},{flushSync:(ne&&ne.flushSync)===!0})}function xn(B){return v.v7_fetcherPersist&&(Cn.set(B,(Cn.get(B)||0)+1),nt.has(B)&&nt.delete(B)),Y.fetchers.get(B)||WI}function Nt(B){let U=Y.fetchers.get(B);ct.has(B)&&!(U&&U.state==="loading"&&tt.has(B))&&at(B),Lt.delete(B),tt.delete(B),_t.delete(B),nt.delete(B),Y.fetchers.delete(B)}function an(B){if(v.v7_fetcherPersist){let U=(Cn.get(B)||0)-1;U<=0?(Cn.delete(B),nt.add(B)):Cn.set(B,U)}else Nt(B);je({fetchers:new Map(Y.fetchers)})}function at(B){let U=ct.get(B);ni(U,"Expected fetch controller: "+B),U.abort(),ct.delete(B)}function tn(B){for(let U of B){let q=xn(U),ne=cc(q.data);Y.fetchers.set(U,ne)}}function Kt(){let B=[],U=!1;for(let q of _t){let ne=Y.fetchers.get(q);ni(ne,"Expected fetcher: "+q),ne.state==="loading"&&(_t.delete(q),B.push(q),U=!0)}return tn(B),U}function On(B){let U=[];for(let[q,ne]of tt)if(ne<B){let me=Y.fetchers.get(q);ni(me,"Expected fetcher: "+q),me.state==="loading"&&(at(q),tt.delete(q),U.push(q))}return tn(U),U.length>0}function Un(B,U){let q=Y.blockers.get(B)||A0;return Ft.get(B)!==U&&Ft.set(B,U),q}function dt(B){Y.blockers.delete(B),Ft.delete(B)}function Ht(B,U){let q=Y.blockers.get(B)||A0;ni(q.state==="unblocked"&&U.state==="blocked"||q.state==="blocked"&&U.state==="blocked"||q.state==="blocked"&&U.state==="proceeding"||q.state==="blocked"&&U.state==="unblocked"||q.state==="proceeding"&&U.state==="unblocked","Invalid blocker state transition: "+q.state+" -> "+U.state);let ne=new Map(Y.blockers);ne.set(B,U),je({blockers:ne})}function jt(B){let{currentLocation:U,nextLocation:q,historyAction:ne}=B;if(Ft.size===0)return;Ft.size>1&&ju(!1,"A router only supports one blocker at a time");let me=Array.from(Ft.entries()),[Se,Ee]=me[me.length-1],ye=Y.blockers.get(Se);if(!(ye&&ye.state==="proceeding")&&Ee({currentLocation:U,nextLocation:q,historyAction:ne}))return Se}function Jt(B){let U=[];return wt.forEach((q,ne)=>{(!B||B(ne))&&(q.cancel(),U.push(ne),wt.delete(ne))}),U}function X(B,U,q){if(S=B,L=U,A=q||null,!F&&Y.navigation===F_){F=!0;let ne=Dt(Y.location,Y.matches);ne!=null&&je({restoreScrollPosition:ne})}return()=>{S=null,L=null,A=null}}function Oe(B,U){return A&&A(B,U.map(ne=>wI(ne,Y.loaderData)))||B.key}function pt(B,U){if(S&&L){let q=Oe(B,U);S[q]=L()}}function Dt(B,U){if(S){let q=Oe(B,U),ne=S[q];if(typeof ne=="number")return ne}return null}function ce(B){l={},o=L2(B,r,void 0,l)}return ue={get basename(){return p},get future(){return v},get state(){return Y},get routes(){return h},get window(){return e},initialize:gn,subscribe:In,enableScrollRestoration:X,navigate:yn,fetch:le,revalidate:Qn,createHref:B=>n.history.createHref(B),encodeLocation:B=>n.history.encodeLocation(B),getFetcher:xn,deleteFetcher:an,dispose:En,getBlocker:Un,deleteBlocker:dt,_internalFetchControllers:ct,_internalActiveDeferreds:wt,_internalSetRoutes:ce},ue}function XI(n){return n!=null&&("formData"in n&&n.formData!=null||"body"in n&&n.body!==void 0)}function F2(n,e,t,i,r,l,h,o){let p,v;if(h){p=[];for(let M of e)if(p.push(M),M.route.id===h){v=M;break}}else p=e,v=e[e.length-1];let x=uw(r||".",cw(p,l),_l(n.pathname,t)||n.pathname,o==="path");return r==null&&(x.search=n.search,x.hash=n.hash),(r==null||r===""||r===".")&&v&&v.route.index&&!dw(x.search)&&(x.search=x.search?x.search.replace(/^\?/,"?index&"):"?index"),i&&t!=="/"&&(x.pathname=x.pathname==="/"?t:dl([t,x.pathname])),Wu(x)}function US(n,e,t,i){if(!i||!XI(i))return{path:t};if(i.formMethod&&!tk(i.formMethod))return{path:t,error:ps(405,{method:i.formMethod})};let r=()=>({path:t,error:ps(400,{type:"invalid-body"})}),l=i.formMethod||"get",h=n?l.toUpperCase():l.toLowerCase(),o=vA(t);if(i.body!==void 0){if(i.formEncType==="text/plain"){if(!Gs(h))return r();let S=typeof i.body=="string"?i.body:i.body instanceof FormData||i.body instanceof URLSearchParams?Array.from(i.body.entries()).reduce((A,L)=>{let[F,k]=L;return""+A+F+"="+k+`
`},""):String(i.body);return{path:t,submission:{formMethod:h,formAction:o,formEncType:i.formEncType,formData:void 0,json:void 0,text:S}}}else if(i.formEncType==="application/json"){if(!Gs(h))return r();try{let S=typeof i.body=="string"?JSON.parse(i.body):i.body;return{path:t,submission:{formMethod:h,formAction:o,formEncType:i.formEncType,formData:void 0,json:S,text:void 0}}}catch{return r()}}}ni(typeof FormData=="function","FormData is not available in this environment");let p,v;if(i.formData)p=N2(i.formData),v=i.formData;else if(i.body instanceof FormData)p=N2(i.body),v=i.body;else if(i.body instanceof URLSearchParams)p=i.body,v=jS(p);else if(i.body==null)p=new URLSearchParams,v=new FormData;else try{p=new URLSearchParams(i.body),v=jS(p)}catch{return r()}let x={formMethod:h,formAction:o,formEncType:i&&i.formEncType||"application/x-www-form-urlencoded",formData:v,json:void 0,text:void 0};if(Gs(x.formMethod))return{path:t,submission:x};let M=Eo(t);return e&&M.search&&dw(M.search)&&p.append("index",""),M.search="?"+p,{path:Wu(M),submission:x}}function ZI(n,e){let t=n;if(e){let i=n.findIndex(r=>r.route.id===e);i>=0&&(t=n.slice(0,i))}return t}function VS(n,e,t,i,r,l,h,o,p,v,x,M,S,A,L,F){let k=F?Object.values(F)[0]:L?Object.values(L)[0]:void 0,C=n.createURL(e.location),V=n.createURL(r),O=F?Object.keys(F)[0]:void 0,ue=ZI(t,O).filter((Q,xe)=>{let{route:re}=Q;if(re.lazy)return!0;if(re.loader==null)return!1;if(l)return re.loader.hydrate?!0:e.loaderData[re.id]===void 0&&(!e.errors||e.errors[re.id]===void 0);if(YI(e.loaderData,e.matches[xe],Q)||o.some(Fe=>Fe===Q.route.id))return!0;let ee=e.matches[xe],Me=Q;return HS(Q,rr({currentUrl:C,currentParams:ee.params,nextUrl:V,nextParams:Me.params},i,{actionResult:k,defaultShouldRevalidate:h||C.pathname+C.search===V.pathname+V.search||C.search!==V.search||yA(ee,Me)}))}),Y=[];return x.forEach((Q,xe)=>{if(l||!t.some(Ae=>Ae.route.id===Q.routeId)||v.has(xe))return;let re=wd(S,Q.path,A);if(!re){Y.push({key:xe,routeId:Q.routeId,path:Q.path,matches:null,match:null,controller:null});return}let ee=e.fetchers.get(xe),Me=B2(re,Q.path),Fe=!1;M.has(xe)?Fe=!1:p.includes(xe)?Fe=!0:ee&&ee.state!=="idle"&&ee.data===void 0?Fe=h:Fe=HS(Me,rr({currentUrl:C,currentParams:e.matches[e.matches.length-1].params,nextUrl:V,nextParams:t[t.length-1].params},i,{actionResult:k,defaultShouldRevalidate:h})),Fe&&Y.push({key:xe,routeId:Q.routeId,path:Q.path,matches:re,match:Me,controller:new AbortController})}),[ue,Y]}function YI(n,e,t){let i=!e||t.route.id!==e.route.id,r=n[t.route.id]===void 0;return i||r}function yA(n,e){let t=n.route.path;return n.pathname!==e.pathname||t!=null&&t.endsWith("*")&&n.params["*"]!==e.params["*"]}function HS(n,e){if(n.route.shouldRevalidate){let t=n.route.shouldRevalidate(e);if(typeof t=="boolean")return t}return e.defaultShouldRevalidate}async function GS(n,e,t){if(!n.lazy)return;let i=await n.lazy();if(!n.lazy)return;let r=t[n.id];ni(r,"No route found in manifest");let l={};for(let h in i){let p=r[h]!==void 0&&h!=="hasErrorBoundary";ju(!p,'Route "'+r.id+'" has a static property "'+h+'" defined but its lazy function is also returning a value for this property. '+('The lazy route property "'+h+'" will be ignored.')),!p&&!xI.has(h)&&(l[h]=i[h])}Object.assign(r,l),Object.assign(r,rr({},e(r),{lazy:void 0}))}async function C0(n,e,t,i,r,l,h,o,p){p===void 0&&(p={});let v,x,M,S=F=>{let k,C=new Promise((V,O)=>k=O);return M=()=>k(),e.signal.addEventListener("abort",M),Promise.race([F({request:e,params:t.params,context:p.requestContext}),C])};try{let F=t.route[n];if(t.route.lazy)if(F){let k,C=await Promise.all([S(F).catch(V=>{k=V}),GS(t.route,l,r)]);if(k)throw k;x=C[0]}else if(await GS(t.route,l,r),F=t.route[n],F)x=await S(F);else if(n==="action"){let k=new URL(e.url),C=k.pathname+k.search;throw ps(405,{method:e.method,pathname:C,routeId:t.route.id})}else return{type:nr.data,data:void 0};else if(F)x=await S(F);else{let k=new URL(e.url),C=k.pathname+k.search;throw ps(404,{pathname:C})}ni(x!==void 0,"You defined "+(n==="action"?"an action":"a loader")+" for route "+('"'+t.route.id+"\" but didn't return anything from your `"+n+"` ")+"function. Please return a value or `null`.")}catch(F){v=nr.error,x=F}finally{M&&e.signal.removeEventListener("abort",M)}if(ek(x)){let F=x.status;if(GI.has(F)){let C=x.headers.get("Location");if(ni(C,"Redirects returned/thrown from loaders/actions must have a Location header"),!mA.test(C))C=F2(new URL(e.url),i.slice(0,i.indexOf(t)+1),h,!0,C,o);else if(!p.isStaticRequest){let V=new URL(e.url),O=C.startsWith("//")?new URL(V.protocol+C):new URL(C),J=_l(O.pathname,h)!=null;O.origin===V.origin&&J&&(C=O.pathname+O.search+O.hash)}if(p.isStaticRequest)throw x.headers.set("Location",C),x;return{type:nr.redirect,status:F,location:C,revalidate:x.headers.get("X-Remix-Revalidate")!==null,reloadDocument:x.headers.get("X-Remix-Reload-Document")!==null}}if(p.isRouteRequest)throw{type:v===nr.error?nr.error:nr.data,response:x};let k;try{let C=x.headers.get("Content-Type");C&&/\bapplication\/json\b/.test(C)?x.body==null?k=null:k=await x.json():k=await x.text()}catch(C){return{type:nr.error,error:C}}return v===nr.error?{type:v,error:new hw(F,x.statusText,k),headers:x.headers}:{type:nr.data,data:k,statusCode:x.status,headers:x.headers}}if(v===nr.error)return{type:v,error:x};if(QI(x)){var A,L;return{type:nr.deferred,deferredData:x,statusCode:(A=x.init)==null?void 0:A.status,headers:((L=x.init)==null?void 0:L.headers)&&new Headers(x.init.headers)}}return{type:nr.data,data:x}}function P0(n,e,t,i){let r=n.createURL(vA(e)).toString(),l={signal:t};if(i&&Gs(i.formMethod)){let{formMethod:h,formEncType:o}=i;l.method=h.toUpperCase(),o==="application/json"?(l.headers=new Headers({"Content-Type":o}),l.body=JSON.stringify(i.json)):o==="text/plain"?l.body=i.text:o==="application/x-www-form-urlencoded"&&i.formData?l.body=N2(i.formData):l.body=i.formData}return new Request(r,l)}function N2(n){let e=new URLSearchParams;for(let[t,i]of n.entries())e.append(t,typeof i=="string"?i:i.name);return e}function jS(n){let e=new FormData;for(let[t,i]of n.entries())e.append(t,i);return e}function KI(n,e,t,i,r){let l={},h=null,o,p=!1,v={};return t.forEach((x,M)=>{let S=e[M].route.id;if(ni(!ku(x),"Cannot handle redirect results in processLoaderData"),Sd(x)){let A=ip(n,S),L=x.error;i&&(L=Object.values(i)[0],i=void 0),h=h||{},h[A.route.id]==null&&(h[A.route.id]=L),l[S]=void 0,p||(p=!0,o=fA(x.error)?x.error.status:500),x.headers&&(v[S]=x.headers)}else Iu(x)?(r.set(S,x.deferredData),l[S]=x.deferredData.data):l[S]=x.data,x.statusCode!=null&&x.statusCode!==200&&!p&&(o=x.statusCode),x.headers&&(v[S]=x.headers)}),i&&(h=i,l[Object.keys(i)[0]]=void 0),{loaderData:l,errors:h,statusCode:o||200,loaderHeaders:v}}function WS(n,e,t,i,r,l,h,o){let{loaderData:p,errors:v}=KI(e,t,i,r,o);for(let x=0;x<l.length;x++){let{key:M,match:S,controller:A}=l[x];ni(h!==void 0&&h[x]!==void 0,"Did not find corresponding fetcher result");let L=h[x];if(!(A&&A.signal.aborted))if(Sd(L)){let F=ip(n.matches,S==null?void 0:S.route.id);v&&v[F.route.id]||(v=rr({},v,{[F.route.id]:L.error})),n.fetchers.delete(M)}else if(ku(L))ni(!1,"Unhandled fetcher revalidation redirect");else if(Iu(L))ni(!1,"Unhandled fetcher deferred data");else{let F=cc(L.data);n.fetchers.set(M,F)}}return{loaderData:p,errors:v}}function qS(n,e,t,i){let r=rr({},e);for(let l of t){let h=l.route.id;if(e.hasOwnProperty(h)?e[h]!==void 0&&(r[h]=e[h]):n[h]!==void 0&&l.route.loader&&(r[h]=n[h]),i&&i.hasOwnProperty(h))break}return r}function ip(n,e){return(e?n.slice(0,n.findIndex(i=>i.route.id===e)+1):[...n]).reverse().find(i=>i.route.hasErrorBoundary===!0)||n[0]}function $S(n){let e=n.length===1?n[0]:n.find(t=>t.index||!t.path||t.path==="/")||{id:"__shim-error-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:e}],route:e}}function ps(n,e){let{pathname:t,routeId:i,method:r,type:l}=e===void 0?{}:e,h="Unknown Server Error",o="Unknown @remix-run/router error";return n===400?(h="Bad Request",r&&t&&i?o="You made a "+r+' request to "'+t+'" but '+('did not provide a `loader` for route "'+i+'", ')+"so there is no way to handle the request.":l==="defer-action"?o="defer() is not supported in actions":l==="invalid-body"&&(o="Unable to encode submission body")):n===403?(h="Forbidden",o='Route "'+i+'" does not match URL "'+t+'"'):n===404?(h="Not Found",o='No route matches URL "'+t+'"'):n===405&&(h="Method Not Allowed",r&&t&&i?o="You made a "+r.toUpperCase()+' request to "'+t+'" but '+('did not provide an `action` for route "'+i+'", ')+"so there is no way to handle the request.":r&&(o='Invalid request method "'+r.toUpperCase()+'"')),new hw(n||500,h,new Error(o),!0)}function XS(n){for(let e=n.length-1;e>=0;e--){let t=n[e];if(ku(t))return{result:t,idx:e}}}function vA(n){let e=typeof n=="string"?Eo(n):n;return Wu(rr({},e,{hash:""}))}function JI(n,e){return n.pathname!==e.pathname||n.search!==e.search?!1:n.hash===""?e.hash!=="":n.hash===e.hash?!0:e.hash!==""}function Iu(n){return n.type===nr.deferred}function Sd(n){return n.type===nr.error}function ku(n){return(n&&n.type)===nr.redirect}function QI(n){let e=n;return e&&typeof e=="object"&&typeof e.data=="object"&&typeof e.subscribe=="function"&&typeof e.cancel=="function"&&typeof e.resolveData=="function"}function ek(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.headers=="object"&&typeof n.body<"u"}function tk(n){return HI.has(n.toLowerCase())}function Gs(n){return UI.has(n.toLowerCase())}async function ZS(n,e,t,i,r,l){for(let h=0;h<t.length;h++){let o=t[h],p=e[h];if(!p)continue;let v=n.find(M=>M.route.id===p.route.id),x=v!=null&&!yA(v,p)&&(l&&l[p.route.id])!==void 0;if(Iu(o)&&(r||x)){let M=i[h];ni(M,"Expected an AbortSignal for revalidating fetcher deferred result"),await _A(o,M,r).then(S=>{S&&(t[h]=S||t[h])})}}}async function _A(n,e,t){if(t===void 0&&(t=!1),!await n.deferredData.resolveData(e)){if(t)try{return{type:nr.data,data:n.deferredData.unwrappedData}}catch(r){return{type:nr.error,error:r}}return{type:nr.data,data:n.deferredData.data}}}function dw(n){return new URLSearchParams(n).getAll("index").some(e=>e==="")}function B2(n,e){let t=typeof e=="string"?Eo(e).search:e.search;if(n[n.length-1].route.index&&dw(t||""))return n[n.length-1];let i=dA(n);return i[i.length-1]}function YS(n){let{formMethod:e,formAction:t,formEncType:i,text:r,formData:l,json:h}=n;if(!(!e||!t||!i)){if(r!=null)return{formMethod:e,formAction:t,formEncType:i,formData:void 0,json:void 0,text:r};if(l!=null)return{formMethod:e,formAction:t,formEncType:i,formData:l,json:void 0,text:void 0};if(h!==void 0)return{formMethod:e,formAction:t,formEncType:i,formData:void 0,json:h,text:void 0}}}function N_(n,e){return e?{state:"loading",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}:{state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0}}function nk(n,e){return{state:"submitting",location:n,formMethod:e.formMethod,formAction:e.formAction,formEncType:e.formEncType,formData:e.formData,json:e.json,text:e.text}}function R0(n,e){return n?{state:"loading",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e}:{state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:e}}function ik(n,e){return{state:"submitting",formMethod:n.formMethod,formAction:n.formAction,formEncType:n.formEncType,formData:n.formData,json:n.json,text:n.text,data:e?e.data:void 0}}function cc(n){return{state:"idle",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,json:void 0,text:void 0,data:n}}function rk(n,e){try{let t=n.sessionStorage.getItem(gA);if(t){let i=JSON.parse(t);for(let[r,l]of Object.entries(i||{}))l&&Array.isArray(l)&&e.set(r,new Set(l||[]))}}catch{}}function ak(n,e){if(e.size>0){let t={};for(let[i,r]of e)t[i]=[...r];try{n.sessionStorage.setItem(gA,JSON.stringify(t))}catch(i){ju(!1,"Failed to save applied view transitions in sessionStorage ("+i+").")}}}/**
 * React Router v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ap(){return Ap=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},Ap.apply(this,arguments)}const jp=gt.createContext(null),fw=gt.createContext(null),Vc=gt.createContext(null),Vy=gt.createContext(null),Hc=gt.createContext({outlet:null,matches:[],isDataRoute:!1}),xA=gt.createContext(null);function sk(n,e){let{relative:t}=e===void 0?{}:e;Wp()||ni(!1);let{basename:i,navigator:r}=gt.useContext(Vc),{hash:l,pathname:h,search:o}=Hy(n,{relative:t}),p=h;return i!=="/"&&(p=h==="/"?i:dl([i,h])),r.createHref({pathname:p,search:o,hash:l})}function Wp(){return gt.useContext(Vy)!=null}function sf(){return Wp()||ni(!1),gt.useContext(Vy).location}function bA(n){gt.useContext(Vc).static||gt.useLayoutEffect(n)}function pw(){let{isDataRoute:n}=gt.useContext(Hc);return n?xk():ok()}function ok(){Wp()||ni(!1);let n=gt.useContext(jp),{basename:e,future:t,navigator:i}=gt.useContext(Vc),{matches:r}=gt.useContext(Hc),{pathname:l}=sf(),h=JSON.stringify(cw(r,t.v7_relativeSplatPath)),o=gt.useRef(!1);return bA(()=>{o.current=!0}),gt.useCallback(function(v,x){if(x===void 0&&(x={}),!o.current)return;if(typeof v=="number"){i.go(v);return}let M=uw(v,JSON.parse(h),l,x.relative==="path");n==null&&e!=="/"&&(M.pathname=M.pathname==="/"?e:dl([e,M.pathname])),(x.replace?i.replace:i.push)(M,x.state,x)},[e,i,h,l,n])}const lk=gt.createContext(null);function ck(n){let e=gt.useContext(Hc).outlet;return e&&gt.createElement(lk.Provider,{value:n},e)}function Hy(n,e){let{relative:t}=e===void 0?{}:e,{future:i}=gt.useContext(Vc),{matches:r}=gt.useContext(Hc),{pathname:l}=sf(),h=JSON.stringify(cw(r,i.v7_relativeSplatPath));return gt.useMemo(()=>uw(n,JSON.parse(h),l,t==="path"),[n,h,l,t])}function uk(n,e,t,i){Wp()||ni(!1);let{navigator:r}=gt.useContext(Vc),{matches:l}=gt.useContext(Hc),h=l[l.length-1],o=h?h.params:{};h&&h.pathname;let p=h?h.pathnameBase:"/";h&&h.route;let v=sf(),x;if(e){var M;let k=typeof e=="string"?Eo(e):e;p==="/"||(M=k.pathname)!=null&&M.startsWith(p)||ni(!1),x=k}else x=v;let S=x.pathname||"/",A=S;if(p!=="/"){let k=p.replace(/^\//,"").split("/");A="/"+S.replace(/^\//,"").split("/").slice(k.length).join("/")}let L=wd(n,{pathname:A}),F=mk(L&&L.map(k=>Object.assign({},k,{params:Object.assign({},o,k.params),pathname:dl([p,r.encodeLocation?r.encodeLocation(k.pathname).pathname:k.pathname]),pathnameBase:k.pathnameBase==="/"?p:dl([p,r.encodeLocation?r.encodeLocation(k.pathnameBase).pathname:k.pathnameBase])})),l,t,i);return e&&F?gt.createElement(Vy.Provider,{value:{location:Ap({pathname:"/",search:"",hash:"",state:null,key:"default"},x),navigationType:hr.Pop}},F):F}function hk(){let n=_k(),e=fA(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),t=n instanceof Error?n.stack:null,r={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return gt.createElement(gt.Fragment,null,gt.createElement("h2",null,"Unexpected Application Error!"),gt.createElement("h3",{style:{fontStyle:"italic"}},e),t?gt.createElement("pre",{style:r},t):null,null)}const dk=gt.createElement(hk,null);class fk extends gt.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?gt.createElement(Hc.Provider,{value:this.props.routeContext},gt.createElement(xA.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function pk(n){let{routeContext:e,match:t,children:i}=n,r=gt.useContext(jp);return r&&r.static&&r.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(r.staticContext._deepestRenderedBoundaryId=t.route.id),gt.createElement(Hc.Provider,{value:e},i)}function mk(n,e,t,i){var r;if(e===void 0&&(e=[]),t===void 0&&(t=null),i===void 0&&(i=null),n==null){var l;if((l=t)!=null&&l.errors)n=t.matches;else return null}let h=n,o=(r=t)==null?void 0:r.errors;if(o!=null){let x=h.findIndex(M=>M.route.id&&(o==null?void 0:o[M.route.id]));x>=0||ni(!1),h=h.slice(0,Math.min(h.length,x+1))}let p=!1,v=-1;if(t&&i&&i.v7_partialHydration)for(let x=0;x<h.length;x++){let M=h[x];if((M.route.HydrateFallback||M.route.hydrateFallbackElement)&&(v=x),M.route.id){let{loaderData:S,errors:A}=t,L=M.route.loader&&S[M.route.id]===void 0&&(!A||A[M.route.id]===void 0);if(M.route.lazy||L){p=!0,v>=0?h=h.slice(0,v+1):h=[h[0]];break}}}return h.reduceRight((x,M,S)=>{let A,L=!1,F=null,k=null;t&&(A=o&&M.route.id?o[M.route.id]:void 0,F=M.route.errorElement||dk,p&&(v<0&&S===0?(bk("route-fallback",!1),L=!0,k=null):v===S&&(L=!0,k=M.route.hydrateFallbackElement||null)));let C=e.concat(h.slice(0,S+1)),V=()=>{let O;return A?O=F:L?O=k:M.route.Component?O=gt.createElement(M.route.Component,null):M.route.element?O=M.route.element:O=x,gt.createElement(pk,{match:M,routeContext:{outlet:x,matches:C,isDataRoute:t!=null},children:O})};return t&&(M.route.ErrorBoundary||M.route.errorElement||S===0)?gt.createElement(fk,{location:t.location,revalidation:t.revalidation,component:F,error:A,children:V(),routeContext:{outlet:null,matches:C,isDataRoute:!0}}):V()},null)}var wA=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(wA||{}),ty=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(ty||{});function gk(n){let e=gt.useContext(jp);return e||ni(!1),e}function yk(n){let e=gt.useContext(fw);return e||ni(!1),e}function vk(n){let e=gt.useContext(Hc);return e||ni(!1),e}function SA(n){let e=vk(),t=e.matches[e.matches.length-1];return t.route.id||ni(!1),t.route.id}function _k(){var n;let e=gt.useContext(xA),t=yk(ty.UseRouteError),i=SA(ty.UseRouteError);return e!==void 0?e:(n=t.errors)==null?void 0:n[i]}function xk(){let{router:n}=gk(wA.UseNavigateStable),e=SA(ty.UseNavigateStable),t=gt.useRef(!1);return bA(()=>{t.current=!0}),gt.useCallback(function(r,l){l===void 0&&(l={}),t.current&&(typeof r=="number"?n.navigate(r):n.navigate(r,Ap({fromRouteId:e},l)))},[n,e])}const KS={};function bk(n,e,t){!e&&!KS[n]&&(KS[n]=!0)}function wk(n){return ck(n.context)}function Sk(n){let{basename:e="/",children:t=null,location:i,navigationType:r=hr.Pop,navigator:l,static:h=!1,future:o}=n;Wp()&&ni(!1);let p=e.replace(/^\/*/,"/"),v=gt.useMemo(()=>({basename:p,navigator:l,static:h,future:Ap({v7_relativeSplatPath:!1},o)}),[p,o,l,h]);typeof i=="string"&&(i=Eo(i));let{pathname:x="/",search:M="",hash:S="",state:A=null,key:L="default"}=i,F=gt.useMemo(()=>{let k=_l(x,p);return k==null?null:{location:{pathname:k,search:M,hash:S,state:A,key:L},navigationType:r}},[p,x,M,S,A,L,r]);return F==null?null:gt.createElement(Vc.Provider,{value:v},gt.createElement(Vy.Provider,{children:t,value:F}))}new Promise(()=>{});function Mk(n){let e={hasErrorBoundary:n.ErrorBoundary!=null||n.errorElement!=null};return n.Component&&Object.assign(e,{element:gt.createElement(n.Component),Component:void 0}),n.HydrateFallback&&Object.assign(e,{hydrateFallbackElement:gt.createElement(n.HydrateFallback),HydrateFallback:void 0}),n.ErrorBoundary&&Object.assign(e,{errorElement:gt.createElement(n.ErrorBoundary),ErrorBoundary:void 0}),e}/**
 * React Router DOM v6.22.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function $d(){return $d=Object.assign?Object.assign.bind():function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(n[i]=t[i])}return n},$d.apply(this,arguments)}function MA(n,e){if(n==null)return{};var t={},i=Object.keys(n),r,l;for(l=0;l<i.length;l++)r=i[l],!(e.indexOf(r)>=0)&&(t[r]=n[r]);return t}function Tk(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function Ek(n,e){return n.button===0&&(!e||e==="_self")&&!Tk(n)}const Ak=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","unstable_viewTransition"],Ck=["aria-current","caseSensitive","className","end","style","to","unstable_viewTransition","children"],Pk="6";try{window.__reactRouterVersion=Pk}catch{}function Rk(n,e){return $I({basename:e==null?void 0:e.basename,future:$d({},e==null?void 0:e.future,{v7_prependBasename:!0}),history:yI({window:e==null?void 0:e.window}),hydrationData:(e==null?void 0:e.hydrationData)||Ik(),routes:n,mapRouteProperties:Mk,window:e==null?void 0:e.window}).initialize()}function Ik(){var n;let e=(n=window)==null?void 0:n.__staticRouterHydrationData;return e&&e.errors&&(e=$d({},e,{errors:kk(e.errors)})),e}function kk(n){if(!n)return null;let e=Object.entries(n),t={};for(let[i,r]of e)if(r&&r.__type==="RouteErrorResponse")t[i]=new hw(r.status,r.statusText,r.data,r.internal===!0);else if(r&&r.__type==="Error"){if(r.__subType){let l=window[r.__subType];if(typeof l=="function")try{let h=new l(r.message);h.stack="",t[i]=h}catch{}}if(t[i]==null){let l=new Error(r.message);l.stack="",t[i]=l}}else t[i]=r;return t}const TA=gt.createContext({isTransitioning:!1}),Dk=gt.createContext(new Map),Lk="startTransition",JS=aR[Lk],zk="flushSync",QS=gI[zk];function Fk(n){JS?JS(n):n()}function I0(n){QS?QS(n):n()}class Nk{constructor(){this.status="pending",this.promise=new Promise((e,t)=>{this.resolve=i=>{this.status==="pending"&&(this.status="resolved",e(i))},this.reject=i=>{this.status==="pending"&&(this.status="rejected",t(i))}})}}function Bk(n){let{fallbackElement:e,router:t,future:i}=n,[r,l]=gt.useState(t.state),[h,o]=gt.useState(),[p,v]=gt.useState({isTransitioning:!1}),[x,M]=gt.useState(),[S,A]=gt.useState(),[L,F]=gt.useState(),k=gt.useRef(new Map),{v7_startTransition:C}=i||{},V=gt.useCallback(Q=>{C?Fk(Q):Q()},[C]),O=gt.useCallback((Q,xe)=>{let{deletedFetchers:re,unstable_flushSync:ee,unstable_viewTransitionOpts:Me}=xe;re.forEach(Ae=>k.current.delete(Ae)),Q.fetchers.forEach((Ae,He)=>{Ae.data!==void 0&&k.current.set(He,Ae.data)});let Fe=t.window==null||typeof t.window.document.startViewTransition!="function";if(!Me||Fe){ee?I0(()=>l(Q)):V(()=>l(Q));return}if(ee){I0(()=>{S&&(x&&x.resolve(),S.skipTransition()),v({isTransitioning:!0,flushSync:!0,currentLocation:Me.currentLocation,nextLocation:Me.nextLocation})});let Ae=t.window.document.startViewTransition(()=>{I0(()=>l(Q))});Ae.finished.finally(()=>{I0(()=>{M(void 0),A(void 0),o(void 0),v({isTransitioning:!1})})}),I0(()=>A(Ae));return}S?(x&&x.resolve(),S.skipTransition(),F({state:Q,currentLocation:Me.currentLocation,nextLocation:Me.nextLocation})):(o(Q),v({isTransitioning:!0,flushSync:!1,currentLocation:Me.currentLocation,nextLocation:Me.nextLocation}))},[t.window,S,x,k,V]);gt.useLayoutEffect(()=>t.subscribe(O),[t,O]),gt.useEffect(()=>{p.isTransitioning&&!p.flushSync&&M(new Nk)},[p]),gt.useEffect(()=>{if(x&&h&&t.window){let Q=h,xe=x.promise,re=t.window.document.startViewTransition(async()=>{V(()=>l(Q)),await xe});re.finished.finally(()=>{M(void 0),A(void 0),o(void 0),v({isTransitioning:!1})}),A(re)}},[V,h,x,t.window]),gt.useEffect(()=>{x&&h&&r.location.key===h.location.key&&x.resolve()},[x,S,r.location,h]),gt.useEffect(()=>{!p.isTransitioning&&L&&(o(L.state),v({isTransitioning:!0,flushSync:!1,currentLocation:L.currentLocation,nextLocation:L.nextLocation}),F(void 0))},[p.isTransitioning,L]),gt.useEffect(()=>{},[]);let J=gt.useMemo(()=>({createHref:t.createHref,encodeLocation:t.encodeLocation,go:Q=>t.navigate(Q),push:(Q,xe,re)=>t.navigate(Q,{state:xe,preventScrollReset:re==null?void 0:re.preventScrollReset}),replace:(Q,xe,re)=>t.navigate(Q,{replace:!0,state:xe,preventScrollReset:re==null?void 0:re.preventScrollReset})}),[t]),ue=t.basename||"/",Y=gt.useMemo(()=>({router:t,navigator:J,static:!1,basename:ue}),[t,J,ue]);return gt.createElement(gt.Fragment,null,gt.createElement(jp.Provider,{value:Y},gt.createElement(fw.Provider,{value:r},gt.createElement(Dk.Provider,{value:k.current},gt.createElement(TA.Provider,{value:p},gt.createElement(Sk,{basename:ue,location:r.location,navigationType:r.historyAction,navigator:J,future:{v7_relativeSplatPath:t.future.v7_relativeSplatPath}},r.initialized||t.future.v7_partialHydration?gt.createElement(Ok,{routes:t.routes,future:t.future,state:r}):e))))),null)}function Ok(n){let{routes:e,future:t,state:i}=n;return uk(e,void 0,i,t)}const Uk=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",Vk=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,ny=gt.forwardRef(function(e,t){let{onClick:i,relative:r,reloadDocument:l,replace:h,state:o,target:p,to:v,preventScrollReset:x,unstable_viewTransition:M}=e,S=MA(e,Ak),{basename:A}=gt.useContext(Vc),L,F=!1;if(typeof v=="string"&&Vk.test(v)&&(L=v,Uk))try{let O=new URL(window.location.href),J=v.startsWith("//")?new URL(O.protocol+v):new URL(v),ue=_l(J.pathname,A);J.origin===O.origin&&ue!=null?v=ue+J.search+J.hash:F=!0}catch{}let k=sk(v,{relative:r}),C=Gk(v,{replace:h,state:o,target:p,preventScrollReset:x,relative:r,unstable_viewTransition:M});function V(O){i&&i(O),O.defaultPrevented||C(O)}return gt.createElement("a",$d({},S,{href:L||k,onClick:F||l?i:V,ref:t,target:p}))}),k0=gt.forwardRef(function(e,t){let{"aria-current":i="page",caseSensitive:r=!1,className:l="",end:h=!1,style:o,to:p,unstable_viewTransition:v,children:x}=e,M=MA(e,Ck),S=Hy(p,{relative:M.relative}),A=sf(),L=gt.useContext(fw),{navigator:F,basename:k}=gt.useContext(Vc),C=L!=null&&jk(S)&&v===!0,V=F.encodeLocation?F.encodeLocation(S).pathname:S.pathname,O=A.pathname,J=L&&L.navigation&&L.navigation.location?L.navigation.location.pathname:null;r||(O=O.toLowerCase(),J=J?J.toLowerCase():null,V=V.toLowerCase()),J&&k&&(J=_l(J,k)||J);const ue=V!=="/"&&V.endsWith("/")?V.length-1:V.length;let Y=O===V||!h&&O.startsWith(V)&&O.charAt(ue)==="/",Q=J!=null&&(J===V||!h&&J.startsWith(V)&&J.charAt(V.length)==="/"),xe={isActive:Y,isPending:Q,isTransitioning:C},re=Y?i:void 0,ee;typeof l=="function"?ee=l(xe):ee=[l,Y?"active":null,Q?"pending":null,C?"transitioning":null].filter(Boolean).join(" ");let Me=typeof o=="function"?o(xe):o;return gt.createElement(ny,$d({},M,{"aria-current":re,className:ee,ref:t,style:Me,to:p,unstable_viewTransition:v}),typeof x=="function"?x(xe):x)});var O2;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(O2||(O2={}));var e5;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(e5||(e5={}));function Hk(n){let e=gt.useContext(jp);return e||ni(!1),e}function Gk(n,e){let{target:t,replace:i,state:r,preventScrollReset:l,relative:h,unstable_viewTransition:o}=e===void 0?{}:e,p=pw(),v=sf(),x=Hy(n,{relative:h});return gt.useCallback(M=>{if(Ek(M,t)){M.preventDefault();let S=i!==void 0?i:Wu(v)===Wu(x);p(n,{replace:S,state:r,preventScrollReset:l,relative:h,unstable_viewTransition:o})}},[v,p,x,i,r,t,n,l,h,o])}function jk(n,e){e===void 0&&(e={});let t=gt.useContext(TA);t==null&&ni(!1);let{basename:i}=Hk(O2.useViewTransitionState),r=Hy(n,{relative:e.relative});if(!t.isTransitioning)return!1;let l=_l(t.currentLocation.pathname,i)||t.currentLocation.pathname,h=_l(t.nextLocation.pathname,i)||t.nextLocation.pathname;return z2(r.pathname,h)!=null||z2(r.pathname,l)!=null}function EA(n){return ge.jsx("div",{className:"body",children:n.children})}function Gy(n){return ge.jsxs("div",{style:{width:"100%",height:"100%",position:"relative"},children:[ge.jsx("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:n.heroBackground}),ge.jsxs("div",{style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",color:"var(--white)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",pointerEvents:"none",textAlign:"center"},children:[ge.jsx("h1",{children:n.title}),ge.jsx("h3",{children:n.subtitle})]})]})}const Cp=7;function Wk(n,e){switch(e){case n.FLOAT:return 4;case n.UNSIGNED_BYTE:return 1;case n.BYTE:case n.SHORT:case n.UNSIGNED_SHORT:default:throw new Error(`Unknown type ${e}`)}}class t5{constructor(e,t){ut(this,"program");this.gl=e,this.config=t;const i=e.createShader(e.VERTEX_SHADER);if(e.shaderSource(i,t.vertexSource),e.compileShader(i),!e.getShaderParameter(i,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(i));const r=e.createShader(e.FRAGMENT_SHADER);if(e.shaderSource(r,t.fragmentSource),e.compileShader(r),!e.getShaderParameter(r,e.COMPILE_STATUS))throw new Error(e.getShaderInfoLog(r));const l=e.createProgram();if(e.attachShader(l,i),e.attachShader(l,r),t.transformFeedbackVaryings&&e.transformFeedbackVaryings(l,t.transformFeedbackVaryings,e.SEPARATE_ATTRIBS),e.linkProgram(l),!e.getProgramParameter(l,e.LINK_STATUS))throw new Error(e.getProgramInfoLog(l));e.detachShader(l,i),e.deleteShader(i),e.detachShader(l,r),e.deleteShader(r),this.program=l}getAttributeLocation(e){return this.gl.getAttribLocation(this.program,e)}getUniformLocation(e){return this.gl.getUniformLocation(this.program,e)}setUniformValue(e,t,i){const r=this.gl,l=this.getUniformLocation(e);switch(t){case"bool":r.uniform1i(l,i[0]);break;case"bvec2":r.uniform2i(l,i[0],i[1]);break;case"bvec3":r.uniform3i(l,i[0],i[1],i[2]);break;case"bvec4":r.uniform4i(l,i[0],i[1],i[2],i[3]);break;case"bool[]":r.uniform1iv(l,i);break;case"bvec2[]":r.uniform2iv(l,i);break;case"bvec3[]":r.uniform3iv(l,i);break;case"bvec4[]":r.uniform4iv(l,i);break;case"int":r.uniform1i(l,i[0]);break;case"ivec2":r.uniform2i(l,i[0],i[1]);break;case"ivec3":r.uniform3i(l,i[0],i[1],i[2]);break;case"ivec4":r.uniform4i(l,i[0],i[1],i[2],i[3]);break;case"int[]":r.uniform1iv(l,i);break;case"ivec2[]":r.uniform2iv(l,i);break;case"ivec3[]":r.uniform3iv(l,i);break;case"ivec4[]":r.uniform4iv(l,i);break;case"float":r.uniform1f(l,i[0]);break;case"vec2":r.uniform2f(l,i[0],i[1]);break;case"vec3":r.uniform3f(l,i[0],i[1],i[2]);break;case"vec4":r.uniform4f(l,i[0],i[1],i[2],i[3]);break;case"float[]":r.uniform1fv(l,i);break;case"vec2[]":r.uniform2fv(l,i);break;case"vec3[]":r.uniform3fv(l,i);break;case"vec4[]":r.uniform4fv(l,i);break;case"mat2":r.uniformMatrix2fv(l,!1,i);break;case"mat3":r.uniformMatrix3fv(l,!1,i);break;case"mat4":r.uniformMatrix4fv(l,!1,i);break;default:throw Error(`Type ${t} not implemented.`)}}destroy(){this.gl.deleteProgram(this.program)}}class vo{constructor(e,t){ut(this,"buffer");ut(this,"dataPointType");this.gl=e,this.config=t;const i=e.createBuffer();if(e.bindBuffer(e.ARRAY_BUFFER,i),e.bufferData(e.ARRAY_BUFFER,t.data,t.changesOften?e.DYNAMIC_DRAW:e.STATIC_DRAW),e.bindBuffer(e.ARRAY_BUFFER,null),this.buffer=i,t.data.BYTES_PER_ELEMENT===4)this.dataPointType=e.FLOAT;else if(t.data.BYTES_PER_ELEMENT===2)this.dataPointType=e.UNSIGNED_SHORT;else if(t.data.BYTES_PER_ELEMENT===1)this.dataPointType=e.UNSIGNED_BYTE;else throw new Error("Buffer data may be Float32Array(gl.FLOAT), UInt16Array(gl.UNSIGNED_SHORT) or UInt8Array(gl.UNSIGNED_BYTE)")}updateData(e){const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,this.buffer),t.bufferData(t.ARRAY_BUFFER,e,this.config.changesOften?t.DYNAMIC_DRAW:t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),this.config.data=e}destroy(){this.gl.deleteBuffer(this.buffer)}getBufferContent(){const e=this.gl,t=this.config.data.length;let i;if(this.config.data instanceof Float32Array&&(i=new Float32Array(t)),this.config.data instanceof Uint16Array&&(i=new Uint16Array(t)),this.config.data instanceof Uint8Array)i=new Uint8Array(t);else throw Error("This should not have happened: this buffer does not seem to have a numeric array as data.");return e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,this.buffer),e.getBufferSubData(e.TRANSFORM_FEEDBACK_BUFFER,0,i),e.bindBuffer(e.TRANSFORM_FEEDBACK_BUFFER,null),i}}let Pp=class{constructor(e,t,i,r,l,h,o,p,v,x){this.gl=e,this.textureType=t,this.texture=i,this.level=r,this.internalformat=l,this.format=h,this.type=o,this.width=p,this.height=v,this.border=x}static getTextureParas(e,t,i){switch(t){case"ubyte1":return{internalFormat:e.LUMINANCE,format:e.LUMINANCE,type:e.UNSIGNED_BYTE,binData:new Uint8Array(i),allowsInterpolation:!0,allowsRenderingTo:!0};case"ubyte4":return{internalFormat:e.RGBA,format:e.RGBA,type:e.UNSIGNED_BYTE,binData:new Uint8Array(i),allowsInterpolation:!0,allowsRenderingTo:!0};case"byte32":return{internalFormat:e.RGBA32I,format:e.RGBA_INTEGER,type:e.INT,binData:new Int32Array(i),allowsInterpolation:!1,allowsRenderingTo:!0};case"float1":return{internalFormat:e.R32F,format:e.RED,type:e.FLOAT,binData:new Float32Array(i),allowsInterpolation:!1,allowsRenderingTo:!1};case"float4":return{internalFormat:e.RGBA32F,format:e.RGBA,type:e.FLOAT,binData:new Float32Array(i),allowsInterpolation:!1,allowsRenderingTo:!1}}}destroy(){this.gl.deleteTexture(this.texture)}getCurrentPixels(e){const t=this.gl,i=this.format,r=this.type;let l;if(r===t.UNSIGNED_BYTE)l=new Uint8Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(r===t.UNSIGNED_SHORT_5_6_5||r===t.UNSIGNED_SHORT_4_4_4_4||r===t.UNSIGNED_SHORT_5_5_5_1)l=new Uint16Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else if(r===t.FLOAT)l=new Float32Array(t.drawingBufferWidth*t.drawingBufferHeight*4);else throw new Error(`Did not understand pixel data type ${r} for format ${i}`);if(t.bindFramebuffer(t.FRAMEBUFFER,e),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,this.texture,0),t.checkFramebufferStatus(t.FRAMEBUFFER)==t.FRAMEBUFFER_COMPLETE)return t.bindFramebuffer(t.FRAMEBUFFER,e),t.readPixels(0,0,this.width,this.height,i,r,l),t.bindFramebuffer(t.FRAMEBUFFER,null),l}};class kr extends Pp{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none"),t.mipmaps||(t.mipmaps=!1);const i=e.createTexture();if(!i)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+Cp),e.bindTexture(e.TEXTURE_2D,i);const r=0,l=e.RGBA,h=e.RGBA,o=e.UNSIGNED_BYTE;e.texImage2D(e.TEXTURE_2D,r,l,h,o,t.image),t.mipmaps&&e.generateMipmap(e.TEXTURE_2D),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"?(t.mipmaps?e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST_MIPMAP_LINEAR):e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)):t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST)),e.bindTexture(e.TEXTURE_2D,null);let p,v;t.image instanceof HTMLImageElement?(p=t.image.naturalWidth,v=t.image.naturalHeight):(p=t.image.width,v=t.image.height),super(e,"ubyte4",i,r,l,h,o,p,v,0),this.config=t}static async loadImage(e){const t=new Image;return t.src=e,await t.decode(),t}}class n5 extends Pp{constructor(e,t){t.edges||(t.edges="clamp"),t.interpolate||(t.interpolate="none");const{data:i,t:r}=t,l=e.createTexture();if(!l)throw new Error("No texture was created");e.activeTexture(e.TEXTURE0+Cp),e.bindTexture(e.TEXTURE_2D,l);let h=0,o=0,p=0,v=[];Array.isArray(i)?(h=i.length,o=i[0].length,p=i[0][0].length,v=i.flat().flat()):(h=i.height,o=i.width,p=i.channels,v=Array.from(i.data));const x=0,M=0,S=Pp.getTextureParas(e,r,v);if(p!==4&&e.pixelStorei(e.UNPACK_ALIGNMENT,1),e.texImage2D(e.TEXTURE_2D,x,S.internalFormat,o,h,M,S.format,S.type,S.binData),t.edges==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):t.edges==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),t.interpolate==="linear"){if(!S.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else t.interpolate==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,r,l,x,S.internalFormat,S.format,S.type,o,h,M),this.config=t}}class mo extends Pp{constructor(e,t){const{width:i,height:r,type:l,edges:h,interpolate:o}=t;if(i<=0||r<=0)throw new Error("Width and height must be positive.");const p=e.createTexture();if(!p)throw new Error("No texture was created");const v=Pp.getTextureParas(e,l,[]);if(e.activeTexture(e.TEXTURE0+Cp),e.bindTexture(e.TEXTURE_2D,p),e.texImage2D(e.TEXTURE_2D,0,v.internalFormat,i,r,0,v.format,v.type,null),h==="clamp"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)):h==="repeat"?(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT)):(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.MIRRORED_REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.MIRRORED_REPEAT)),o==="linear"){if(!v.allowsInterpolation)throw new Error('Float-data-textures can not be interpolated; chose "none" instead.');e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR)}else o==="none"&&(e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST));e.bindTexture(e.TEXTURE_2D,null),super(e,l,p,0,v.internalFormat,v.format,v.type,i,r,0),this.config=t}}class AA{constructor(e){ut(this,"attachedBuffers",{});ut(this,"indexBuffer");this.gl=e}attachBuffer(e,t){const i=this.gl,r=Wk(i,e.dataPointType),l=t.location,h=t.nrInstances,o=t.normalize;switch(t.type){case"float":i.enableVertexAttribArray(l),i.vertexAttribPointer(l,1,e.dataPointType,o,1*r,0),h&&i.vertexAttribDivisor(l,h);break;case"vec2":i.enableVertexAttribArray(l),i.vertexAttribPointer(l,2,e.dataPointType,o,2*r,0),h&&i.vertexAttribDivisor(l,h);break;case"vec3":i.enableVertexAttribArray(l),i.vertexAttribPointer(l,3,e.dataPointType,o,3*r,0),h&&i.vertexAttribDivisor(l,h);break;case"vec4":i.enableVertexAttribArray(l),i.vertexAttribPointer(l,4,e.dataPointType,o,4*r,0),h&&i.vertexAttribDivisor(l,h);break;case"mat2":i.enableVertexAttribArray(l+0),i.vertexAttribPointer(l+0,2,e.dataPointType,o,4*r,0*2*r),h&&i.vertexAttribDivisor(l,h),i.enableVertexAttribArray(l+1),i.vertexAttribPointer(l+1,2,e.dataPointType,o,4*r,1*2*r),h&&i.vertexAttribDivisor(l+1,h);break;case"mat3":i.enableVertexAttribArray(l+0),i.vertexAttribPointer(l+0,3,e.dataPointType,o,9*r,0*3*r),h&&i.vertexAttribDivisor(l,h),i.enableVertexAttribArray(l+1),i.vertexAttribPointer(l+1,3,e.dataPointType,o,9*r,1*3*r),h&&i.vertexAttribDivisor(l+1,h),i.enableVertexAttribArray(l+2),i.vertexAttribPointer(l+2,3,e.dataPointType,o,9*r,2*3*r),h&&i.vertexAttribDivisor(l+2,h);break;case"mat4":i.enableVertexAttribArray(l+0),i.vertexAttribPointer(l+0,4,e.dataPointType,o,16*r,0*4*r),h&&i.vertexAttribDivisor(l,h),i.enableVertexAttribArray(l+1),i.vertexAttribPointer(l+1,4,e.dataPointType,o,16*r,1*4*r),h&&i.vertexAttribDivisor(l+1,h),i.enableVertexAttribArray(l+2),i.vertexAttribPointer(l+2,4,e.dataPointType,o,16*r,2*4*r),h&&i.vertexAttribDivisor(l+2,h),i.enableVertexAttribArray(l+3),i.vertexAttribPointer(l+3,4,e.dataPointType,o,16*r,3*4*r),h&&i.vertexAttribDivisor(l+3,h);break}this.attachedBuffers[t.location]={buffer:e,config:t}}detachBuffer(e){for(const[t,i]of Object.entries(this.attachedBuffers))i.buffer===e&&this.gl.disableVertexAttribArray(i.config.location)}attachIndexBuffer(e){const t=this.gl,i=t.createBuffer();t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,i),t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW),this.indexBuffer=i}}class qk extends AA{constructor(t,i){super(t);ut(this,"vertexArray");this.config=i;const r=t.createVertexArray();this.vertexArray=r}destroy(t=!1){if(t){for(const[i,r]of Object.entries(this.attachedBuffers))this.detachBuffer(r.buffer),r.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}this.gl.deleteVertexArray(this.vertexArray)}}class $k extends AA{constructor(e,t){super(e),this.config=t}destroy(e=!1){if(e){for(const[t,i]of Object.entries(this.attachedBuffers))this.detachBuffer(i.buffer),i.buffer.destroy();this.indexBuffer&&this.gl.deleteBuffer(this.indexBuffer)}}}class CA{constructor(e){ut(this,"boundBuffers",[]);this.gl=e}attachBuffer(e,t){const i=t??this.boundBuffers.length;this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,i,e.buffer)}detachBuffer(e){const t=this.boundBuffers.indexOf(e);this.gl.bindBufferBase(this.gl.TRANSFORM_FEEDBACK_BUFFER,t,null)}}class Xk extends CA{constructor(t,i){super(t);ut(this,"transformFeedback");this.config=i;const r=t.createTransformFeedback();this.transformFeedback=r}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,this.transformFeedback)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(t=!1){if(t)for(const i of this.boundBuffers)this.detachBuffer(i),i.destroy();this.gl.deleteTransformFeedback(this.transformFeedback)}}class Zk extends CA{constructor(e,t){super(e),this.config=t}bind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}unbind(){this.gl.bindTransformFeedback(this.gl.TRANSFORM_FEEDBACK,null)}destroy(e=!1){if(e)for(const t of this.boundBuffers)this.detachBuffer(t),t.destroy()}}class i5{constructor(e,t){ut(this,"frameBuffer");ut(this,"boundTextures",[]);ut(this,"boundDepthRenderBuffer");this.gl=e,this.config=t;const i=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,i),this.frameBuffer=i}bind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,this.frameBuffer),this.gl.drawBuffers(this.getBufferNames())}unbind(){this.gl.bindFramebuffer(this.gl.FRAMEBUFFER,null)}attachTexture(e,t=0){const i=this.gl;i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+t,i.TEXTURE_2D,e.texture,0),this.boundTextures[t]=e}attachDepthRenderBuffer(e){const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,t.DEPTH_ATTACHMENT,t.RENDERBUFFER,e.renderBuffer),this.boundDepthRenderBuffer=e}getBufferNames(){const e=[];for(let t=0;t<this.boundTextures.length;t++)t===0&&e.push(this.gl.COLOR_ATTACHMENT0),t===1&&e.push(this.gl.COLOR_ATTACHMENT1),t===2&&e.push(this.gl.COLOR_ATTACHMENT2),t===3&&e.push(this.gl.COLOR_ATTACHMENT3),t===4&&e.push(this.gl.COLOR_ATTACHMENT4),t===5&&e.push(this.gl.COLOR_ATTACHMENT5),t===6&&e.push(this.gl.COLOR_ATTACHMENT6),t===7&&e.push(this.gl.COLOR_ATTACHMENT7);return e}destroy(e=!1){if(e){for(const t of this.boundTextures)t.destroy();this.boundDepthRenderBuffer&&this.boundDepthRenderBuffer.destroy()}this.gl.deleteFramebuffer(this.frameBuffer)}}class jy{constructor(e,t){ut(this,"boundProgram");ut(this,"boundVertexArray");ut(this,"defaultVertexArray");ut(this,"boundBuffer");ut(this,"boundTextures",[]);ut(this,"boundFrameBuffer");ut(this,"boundTransformFeedback");ut(this,"defaultTransformFeedback");this.gl=e,this.config=t,t.viewport&&e.viewport(...t.viewport),t.depthTest&&(e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL)),t.cullFace&&e.enable(e.CULL_FACE),t.allowAlpha&&(e.enable(e.BLEND),e.blendEquation(e.FUNC_ADD),e.blendFunc(e.SRC_ALPHA,e.ONE_MINUS_SRC_ALPHA)),(t.colorBufferFloat===void 0||t.colorBufferFloat===!0)&&(e.getExtension("EXT_color_buffer_float")||console.error(`Could not load extension "EXT_color_buffer_float". Won't be able to render to f32 textures!`)),this.defaultVertexArray=new $k(e,{}),this.boundVertexArray=this.defaultVertexArray,this.defaultTransformFeedback=new Zk(e,{}),this.boundTransformFeedback=this.defaultTransformFeedback}setViewPort(e){this.config.viewport=e,this.gl.viewport(...this.config.viewport)}bindProgram(e,t=!0){t&&e===this.boundProgram||(this.gl.useProgram(e.program),this.boundProgram=e)}bindVertexArray(e,t=!0){t&&e===this.boundVertexArray||(this.gl.bindVertexArray(e.vertexArray),this.boundVertexArray=e)}unbindVertexArray(){this.boundVertexArray!==this.defaultVertexArray&&(this.gl.bindVertexArray(null),this.boundVertexArray=this.defaultVertexArray)}bindBuffer(e){e!==this.boundBuffer&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,e.buffer),this.boundBuffer=e)}unbindBuffer(){this.boundBuffer!==void 0&&(this.gl.bindBuffer(this.gl.ARRAY_BUFFER,null),this.boundBuffer=void 0)}bindFramebuffer(e){this.boundFrameBuffer!==e&&(e.bind(),this.boundFrameBuffer=e,e.boundTextures.length>0&&this.setViewPort([0,0,e.boundTextures[0].width,e.boundTextures[0].height]))}unbindFramebuffer(){this.boundFrameBuffer!==void 0&&(this.boundFrameBuffer.unbind(),this.boundFrameBuffer=void 0,this.setViewPort([0,0,this.gl.canvas.width,this.gl.canvas.height]))}bindBufferToDefaultVertexArray(e,t){this.unbindVertexArray(),this.bindBuffer(e),this.defaultVertexArray.attachBuffer(e,t),this.unbindBuffer()}bindBufferToVertexArray(e,t,i){this.bindVertexArray(e),this.bindBuffer(t),e.attachBuffer(t,i),this.unbindBuffer()}bindIndexToVertexArray(e,t){this.bindVertexArray(e),e.attachIndexBuffer(t)}bindTextureToFramebuffer(e,t,i=0){this.bindFramebuffer(e),e.attachTexture(t,i),t.type===this.gl.FLOAT&&this.config.colorBufferFloat===!1&&console.warn(`You're trying to add a float-texture to a framebuffer.
        WebGL cannot render to float-textures - this won't work.
        https://registry.khronos.org/OpenGL/specs/es/3.0/es_spec_3.0.pdf#page=143&zoom=100,168,666`),e===this.boundFrameBuffer&&this.setViewPort([0,0,t.width,t.height])}bindDepthToFramebuffer(e,t){this.bindFramebuffer(e),e.attachDepthRenderBuffer(t)}getUniformLocation(e,t){return e.getUniformLocation(t)}setUniformValue(e,t,i,r){this.bindProgram(e),e.setUniformValue(t,i,r)}bindTextureToSlot(e,t){const i=this.gl,r=e.texture,l=t??this.boundTextures.length;if(l>i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${i.getParameter(i.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${l}.`);return l===Cp&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${Cp}).
                            If after this call another texture is built, your shader will now use that new texture instead of this one!
                            Consider using another bind point.`),i.activeTexture(i.TEXTURE0+l),i.bindTexture(i.TEXTURE_2D,r),this.boundTextures[l]=e,l}bindTexUniformToSlot(e,t,i){this.bindProgram(e);const r=e.getUniformLocation(t);this.gl.uniform1i(r,i)}updateVideoTexture(e){for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]===e&&e.update(t)}bindTextureToUniform(e,t,i,r){const l=this.bindTextureToSlot(i,r);this.bindTexUniformToSlot(e,t,l)}bindTransformFeedback(e){this.boundTransformFeedback!==e&&(this.boundTransformFeedback=e,e.bind())}unbindTransformFeedback(){this.boundTransformFeedback!==this.defaultTransformFeedback&&(this.boundTransformFeedback.unbind(),this.boundTransformFeedback,this.defaultTransformFeedback)}bindBufferToTransformFeedback(e,t,i){var r;this.bindTransformFeedback(e),(r=this.boundTransformFeedback)==null||r.attachBuffer(t,i)}clearScreen(e,t){t?this.bindFramebuffer(t):this.unbindFramebuffer(),this.gl.clearColor(...e),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}drawArrays(e,t,i,r){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer();const l=uc(this.gl,i);this.gl.drawArrays(l,0,r)}drawArraysInstanced(e,t,i,r,l){this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const h=uc(this.gl,i);this.gl.drawArraysInstanced(h,0,r,l)}drawArraysToFramebuffer(e,t,i,r,l){l?this.bindFramebuffer(l):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const h=uc(this.gl,i);this.gl.drawArrays(h,0,r)}drawArraysInstancedToFramebuffer(e,t,i,r,l,h){h?this.bindFramebuffer(h):this.unbindFramebuffer(),this.bindProgram(e),t?this.bindVertexArray(t):this.unbindVertexArray();const o=uc(this.gl,i);this.gl.drawArraysInstanced(o,0,r,l)}drawArraysToTransformFeedback(e,t,i,r,l,h){const o=this.gl,p=uc(this.gl,i);this.bindProgram(e),h||o.enable(o.RASTERIZER_DISCARD),this.bindTransformFeedback(l),o.beginTransformFeedback(p),t?this.bindVertexArray(t):this.unbindVertexArray(),this.unbindFramebuffer(),this.gl.drawArrays(p,0,r),o.endTransformFeedback(),this.unbindTransformFeedback(),h||o.disable(o.RASTERIZER_DISCARD)}drawArraysToFramebufferAndTransformFeedback(e,t,i,r,l,h){const o=this.gl;h?this.bindFramebuffer(h):this.unbindFramebuffer();const p=uc(this.gl,i);this.bindProgram(e),this.bindTransformFeedback(l),o.beginTransformFeedback(p),t?this.bindVertexArray(t):this.unbindVertexArray(),this.gl.drawArrays(p,0,r),o.endTransformFeedback(),this.unbindTransformFeedback()}drawElements(e,t,i,r,l){if(this.bindProgram(e),this.bindVertexArray(t),!t.indexBuffer)throw new Error("VertexArray has no index buffer attached. Cannot draw elements");l?this.bindFramebuffer(l):this.unbindFramebuffer();let h=uc(this.gl,i);this.gl.drawElements(h,r,this.gl.UNSIGNED_SHORT,0)}destroy(e=!1){var t;this.boundTransformFeedback.destroy(e),this.boundFrameBuffer&&((t=this.boundFrameBuffer)==null||t.destroy(e));for(const i of this.boundTextures)i.destroy();this.boundBuffer&&this.boundBuffer.destroy(),this.boundVertexArray.destroy(e),this.boundProgram&&this.boundProgram.destroy()}}function uc(n,e){switch(e){case"triangles":return n.TRIANGLES;case"lines":return n.LINES;case"points":return n.POINTS}}function Yk(n){var i;const e=n.program.vertexSource,t=n.program.fragmentSource;for(const[r,l]of Object.entries(n.inputs.attributes)){const h=`in ${l.config.type} ${r};`;!e.includes(h)&&!t.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[r,l]of Object.entries(n.inputs.uniforms)){const h=`uniform ${l.type} ${r};`;!e.includes(h)&&!t.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[r,l]of Object.entries(n.inputs.textures)){const h=`uniform sampler2D ${r};`;!e.includes(h)&&!t.includes(h)&&console.error(`Neither vertex nor fragment shader contain the string: ${h}`)}for(const[r,l]of Object.entries(((i=n.outputs.transformFeedback)==null?void 0:i.data)??{})){const h=` ${r};`;e.includes(h)||console.error(`Vertex source doesn't contain the string ${h}`)}}class Ra{constructor(e,t){ut(this,"program");ut(this,"vao");ut(this,"fb");ut(this,"tf");ut(this,"unboundFramebuffer");var i;this.gs=e,this.config=t,t.program instanceof t5?this.program=t.program:(Yk(t),this.program=new t5(e.gl,{...t.program,transformFeedbackVaryings:Object.keys(((i=t.outputs.transformFeedback)==null?void 0:i.data)??[])})),this.vao=new qk(e.gl,{});for(const[r,l]of Object.entries(t.inputs.attributes)){const h=this.program.getAttributeLocation(r);this.gs.bindBufferToVertexArray(this.vao,l.buffer,{...l.config,location:h})}if(t.inputs.index&&this.gs.bindIndexToVertexArray(this.vao,t.inputs.index),this.config.outputs.frameBuffer){const r=this.config.outputs.frameBuffer;this.fb=new i5(e.gl,{});let l=0;for(const h of r.textures)e.bindTextureToFramebuffer(this.fb,h,l),l+=1;r.depth&&e.bindDepthToFramebuffer(this.fb,r.depth),this.fb.bind()}if(this.config.outputs.transformFeedback){this.tf=new Xk(e.gl,{});let r=0;for(const[l,h]of Object.entries(this.config.outputs.transformFeedback.data))e.bindBufferToTransformFeedback(this.tf,h,r),r+=1}}activate(){this.gs.bindProgram(this.program),this.gs.bindVertexArray(this.vao);let e=0;for(const[t,i]of Object.entries(this.config.inputs.textures))this.gs.bindTextureToSlot(i,e),this.gs.bindTexUniformToSlot(this.program,t,e),e+=1;for(const[t,i]of Object.entries(this.config.inputs.uniforms))this.gs.setUniformValue(this.program,t,i.type,i.value);this.fb?this.gs.bindFramebuffer(this.fb):this.gs.unbindFramebuffer(),this.tf?this.gs.bindTransformFeedback(this.tf):this.gs.unbindTransformFeedback(),this.gs.setViewPort(this.config.settings.viewport)}updateUniform(e,t){const i=this.config.inputs.uniforms[e].type;this.config.inputs.uniforms[e].value=t,this.gs.setUniformValue(this.program,e,i,t)}updateTexture(e,t){let i=0;for(const[r,l]of Object.entries(this.config.inputs.textures))if(r===e){this.gs.bindTextureToUniform(this.program,e,l,i);break}else i+=1;this.config.inputs.textures[e]=t}updateViewport(e){this.gs.setViewPort(e),this.config.settings.viewport=e}updateFramebuffer(e){if(this.config.outputs.frameBuffer=e,e===void 0)this.gs.unbindFramebuffer(),this.unboundFramebuffer=this.fb,this.fb=void 0;else{const t=e;this.fb||(this.fb=this.unboundFramebuffer),this.fb||(console.warn("having to create new fb - is this on purpose?"),this.fb=new i5(this.gs.gl,{}));let i=0;for(const r of t.textures)this.gs.bindTextureToFramebuffer(this.fb,r,i),i+=1;t.depth&&this.gs.bindDepthToFramebuffer(this.fb,t.depth)}}draw(e){var r,l;e&&this.gs.clearScreen(e,this.fb??void 0);const t=this.gs.gl,i=this.config.settings;this.activate(),this.tf&&(this.gs.gl.beginTransformFeedback(uc(t,i.drawingMode)),((r=this.config.outputs.transformFeedback)==null?void 0:r.runFragmentShader)===!1&&t.enable(t.RASTERIZER_DISCARD)),this.config.inputs.index?this.fb?this.gs.drawElements(this.program,this.vao,i.drawingMode,this.config.inputs.index.length,this.fb):this.gs.drawElements(this.program,this.vao,i.drawingMode,this.config.inputs.index.length):this.fb?i.instanced?this.gs.drawArraysInstancedToFramebuffer(this.program,this.vao,i.drawingMode,i.nrVertices,i.instanced,this.fb):this.gs.drawArraysToFramebuffer(this.program,this.vao,i.drawingMode,i.nrVertices,this.fb):i.instanced?this.gs.drawArraysInstanced(this.program,this.vao,i.drawingMode,i.nrVertices,i.instanced):this.gs.drawArrays(this.program,this.vao,i.drawingMode,i.nrVertices),this.tf&&(t.endTransformFeedback(),((l=this.config.outputs.transformFeedback)==null?void 0:l.runFragmentShader)===!1&&t.disable(t.RASTERIZER_DISCARD))}destroy(e=!1){this.tf&&this.tf.destroy(e),this.fb&&this.fb.destroy(e),this.vao.destroy(e),this.program.destroy()}}function Kk(n,e){const t=[];for(let i=0;i<e;i++)t.push(n(i));return t}function Jk(n,e,t){const i=[];for(let r=0;r<e;r++){const l=[];for(let h=0;h<t;h++)l.push(n(r,h));i.push(l)}return i}function Wy(n,e,t,i){const r=n-t/2,l=n+t/2,h=e+i/2,o=e-i/2;return[[r,h],[r,o],[l,o],[r,h],[l,o],[l,h]]}function r5(n,e,t=1,i=0){const r=n.gl.canvas,l=Wy(0,0,2,2),h=new vo(n.gl,{data:new Float32Array(l.flat()),changesOften:!1});return new Ra(n,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos + 1.0) / 2.0;
                uv.y = 1.0 - uv.y;
            }`,fragmentSource:`#version 300 es
            precision highp float;
            in vec2 uv;
            uniform float blur;
            uniform vec2 texSize;
            uniform sampler2D tex;
            out vec4 fragColor;
            void main() {
                vec4 color = texture(tex, uv);

                if (blur > 0.0) {
                  vec2 dX = blur * vec2(1.0 / texSize.x, 0);
                  vec2 dY = blur * vec2(0, 1.0 / texSize.y);
                  color *= 0.4;
                  color += 0.6 / 4.0 * texture(tex, uv + dX);
                  color += 0.6 / 4.0 * texture(tex, uv - dX);
                  color += 0.6 / 4.0 * texture(tex, uv + dY);
                  color += 0.6 / 4.0 * texture(tex, uv - dY);
                }

                fragColor = vec4(color.xyz, ${t});
            }`},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{texSize:{type:"vec2",value:[e.width,e.height]},blur:{type:"float",value:[i]}},textures:{tex:e}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:l.length,viewport:[0,0,r.width,r.height]}})}class qp{constructor(e,t){ut(this,"doesLoop",!1);ut(this,"lastRenderStart",+document.timeline.currentTime);this.loopTime=e,this.callback=t}setLoopTime(e){this.loopTime=e}getLoopTime(){return this.loopTime}loop(){const e=+document.timeline.currentTime;this.loopTime-(e-this.lastRenderStart)<0&&(this.lastRenderStart=e,this.callback(e)),this.doesLoop&&requestAnimationFrame(()=>this.loop())}startLoop(){this.doesLoop=!0,this.loop()}stopLoop(){this.doesLoop=!1}}class Qk{constructor(e,t){ut(this,"movement1");ut(this,"movement2");ut(this,"pt1");ut(this,"pt2");ut(this,"i",0);const i=e.canvas,r=new jy(e,{allowAlpha:!0}),l=t.nrParticles,h=new kr(e,{image:t.sdfImg,interpolate:"linear",edges:"clamp",mipmaps:!0}),o=Kk(()=>[(Math.random()*2-1)*.8,(Math.random()*2-1)*.8,0,0],l),p=new vo(e,{data:new Float32Array(o.flat()),changesOften:!1}),v=new vo(e,{data:new Float32Array(o.flat()),changesOften:!1}),x=new mo(e,{width:i.width,height:i.height,type:"float4",interpolate:"none",edges:"clamp"}),M=new mo(e,{width:i.width,height:i.height,type:"float4",interpolate:"none",edges:"clamp"}),S=new Ra(r,{program:{vertexSource:`#version 300 es
            in vec4 offset;
            uniform vec3 pointerPos;
            uniform vec2 lastPosTexSize;
            uniform vec2 sdfTextureSize;
            uniform sampler2D lastPosTex;
            uniform sampler2D sdfTexture;
            out vec4 offsetNew;

            float particleSize = 10.0;
            vec2 dxdyPos() {
                return vec2(particleSize / lastPosTexSize.x, particleSize / lastPosTexSize.y);
            }
            vec2 dxdySdf() {
              return vec2(1.0 / sdfTextureSize.x, 1.0 / sdfTextureSize.y);
            }

            vec4 sampleQuadrant(vec2 uv, vec2 dPrimary, vec2 dSecondary, sampler2D tex, int level) {
                vec4 data = vec4(0);

                if (level > -2) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.0 * dSecondary);
                }
                if (level > -1) {
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary + 0.1 * dSecondary);
                  data += 0.13 * texture(tex, uv + 0.1 * dPrimary - 0.1 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.0 * dSecondary);
                }
                if (level > 0) {
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary + 0.3 * dSecondary);
                  data += 0.25 * texture(tex, uv + 0.3 * dPrimary - 0.3 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.0 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary + 0.5 * dSecondary);
                  data += 0.50 * texture(tex, uv + 0.5 * dPrimary - 0.5 * dSecondary);
                }
                if (level > 1) {
                  data += 1.00 * texture(tex, uv + 1.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.72 * texture(tex, uv + 1.0 * dPrimary - 1.0 * dSecondary);
                }
                if (level > 2) {
                  data += 0.50 * texture(tex, uv + 2.0 * dPrimary + 0.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary + 1.0 * dSecondary);
                  data += 0.30 * texture(tex, uv + 2.0 * dPrimary - 1.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary + 2.0 * dSecondary);
                  data += 0.10 * texture(tex, uv + 2.0 * dPrimary - 2.0 * dSecondary);
                }
                if (level > 3) {
                  data += 0.25 * texture(tex, uv + 3.0 * dPrimary + 0.0 * dSecondary);
                }
                return data;
            }

            vec4 sampleRight(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(dx, 0.0);
                vec2 dSecondary = vec2(0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleLeft(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(-dx, 0.0);
                vec2 dSecondary = vec2( 0.0, dy);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleTop(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            vec4 sampleBottom(vec2 uv, vec2 dxdy, sampler2D tex, int level) {
                float dx = dxdy.x;
                float dy = dxdy.y;
                vec2 dPrimary   = vec2(0.0, -dy);
                vec2 dSecondary = vec2(dx, 0.0);
                return sampleQuadrant(uv, dPrimary, dSecondary, tex, level);
            }

            void main() {

                vec2 pos = offset.xy;
                vec2 speed = offset.zw;
                vec2 uv = (pos + 1.0) / 2.0;

                vec2 uvSdf = vec2(uv.x, uv.y);
                float dxSdf = dxdySdf().x;
                float dySdf = dxdySdf().y;
                float dist    = texture(sdfTexture, uvSdf).x;
                float dist_px = sampleRight (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_mx = sampleLeft  (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_py = sampleTop   (uvSdf, dxdySdf(), sdfTexture, 3).x;
                float dist_my = sampleBottom(uvSdf, dxdySdf(), sdfTexture, 3).x;
    
                float dDistdx = (dist_px - dist_mx) / (2.0 * dxSdf);
                float dDistdy = (dist_py - dist_my) / (2.0 * dySdf);
                float sign = 1.0;
                // if (dist >= 0.7) {
                //   sign *= -1.0;
                // }
                vec2 textAttractionForce = sign * vec2(dDistdx, dDistdy);



                float dxPos = dxdyPos().x;
                float dyPos = dxdyPos().y;
                vec4 presenceRight  = sampleRight (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceLeft   = sampleLeft  (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceTop    = sampleTop   (uv, dxdyPos(), lastPosTex, 4);
                vec4 presenceBottom = sampleBottom(uv, dxdyPos(), lastPosTex, 4);
                float pr = presenceRight.x * presenceRight.w;
                float pl = presenceLeft.x * presenceLeft.w;
                float pt = presenceTop.x * presenceTop.w;
                float pb = presenceBottom.x * presenceBottom.w;
                float dpdx = (pr - pl) / (2.0 * dxPos);
                float dpdy = (pt - pb) / (2.0 * dyPos);
                vec2 particleRepulsionForce = -0.0001 * vec2(dpdx, dpdy);



                vec2 mouseRepulsionForce = vec2(0);
                if (pointerPos.z > 0.5) {
                  vec2 mousePos = pointerPos.xy;
                  vec2 mouseDir = mousePos - pos;
                  float mouseDist = length(mouseDir);
                  if (mouseDist < 0.7) {
                    float mouseProx = (0.7 - mouseDist) / 0.7;
                    mouseRepulsionForce = -1.0 * (mouseProx * mouseProx) * mouseDir;
                  }
                }

                

                vec2 newSpeed = 0.800 * speed 
                              + 0.800 * particleRepulsionForce 
                              + 0.005 * textAttractionForce
                              + 2.0 * mouseRepulsionForce;
                vec2 newPos = pos + 0.04 * newSpeed;


                if (newPos.x < -1.0) {
                  newPos.x = 1.0 - (-1.0 - newPos.x);
                }
                if (newPos.x > 1.0) {
                  newPos.x = -1.0 + (1.0 - newPos.x);
                }
                if (newPos.y < -1.0) {
                  newPos.y = 1.0 - (-1.0 - newPos.y);
                }
                if (newPos.y > 1.0) {
                  newPos.y = -1.0 + (1.0 - newPos.y);
                }

                gl_Position = vec4(newPos, 0, 1);
                gl_PointSize = particleSize;
                offsetNew = vec4(newPos, newSpeed);
            }`,fragmentSource:`#version 300 es
            precision highp float;
            out vec4 fragColor;
            void main() {
                fragColor = vec4(1, 1, 1, 0.8);
            }`},inputs:{attributes:{offset:{buffer:p,config:{normalize:!1,nrInstances:0,type:"vec4"}}},uniforms:{lastPosTexSize:{type:"vec2",value:[x.width,x.height]},sdfTextureSize:{type:"vec2",value:[h.width,h.height]},pointerPos:{type:"vec3",value:[0,0,0]}},textures:{sdfTexture:h,lastPosTex:x}},outputs:{transformFeedback:{data:{offsetNew:v},runFragmentShader:!0},frameBuffer:{textures:[M]}},settings:{drawingMode:"points",instanced:!1,nrVertices:l,viewport:[0,0,i.width,i.height]}}),A=new Ra(r,{...S.config,program:S.program,inputs:{...S.config.inputs,attributes:{...S.config.inputs.attributes,offset:{buffer:v,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{...S.config.inputs.textures,lastPosTex:M}},outputs:{...S.config.outputs,transformFeedback:{data:{offsetNew:p},runFragmentShader:!0},frameBuffer:{textures:[x]}}}),L=r5(r,M,t.opacity,t.blur),F=r5(r,x,t.opacity,t.blur);this.movement1=S,this.movement2=A,this.pt1=L,this.pt2=F}step(e){this.i%2===0?(this.movement1.updateUniform("pointerPos",e.pointerPos),this.movement1.draw([0,0,0,0]),this.pt1.draw()):(this.movement2.updateUniform("pointerPos",e.pointerPos),this.movement2.draw([0,0,0,0]),this.pt2.draw()),this.i++}destroy(e){this.pt2.destroy(e),this.pt1.destroy(e),this.movement2.destroy(e),this.movement1.destroy(e)}}class eD{constructor(){ut(this,"looper");ut(this,"p");ut(this,"canvas");ut(this,"destroyed",!1);ut(this,"pointerPos",[0,0,0]);ut(this,"onMouseMove",e=>{var l;if(!this.canvas)return;(l=this.looper)==null||l.setLoopTime(30);const t=this.canvas.getBoundingClientRect(),i=(e.clientX-t.left)/this.canvas.clientWidth,r=(e.clientY-t.top)/this.canvas.clientHeight;this.pointerPos[0]=(i-.5)*2,this.pointerPos[1]=(r-.5)*2,this.pointerPos[2]=1});ut(this,"timeout");ut(this,"onDevMove",e=>{var r;(r=this.looper)==null||r.setLoopTime(30);let t=0;e.gamma&&(t=e.gamma/90);let i=0;e.beta&&(i=e.beta/180),this.pointerPos[0]=t,this.pointerPos[1]=i,this.pointerPos[2]=1,this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.pointerPos[2]=0,60)})}async init(e){const t=await kr.loadImage("/c_c_fat_sdf.jpg");if(this.destroyed)return;const i=e.getContext("webgl2");this.p=new Qk(i,{sdfImg:t,nrParticles:Math.max(e.width*3,3e3),opacity:.1,blur:0}),this.looper=new qp(30,()=>{var r,l;(r=this.p)==null||r.step({pointerPos:this.pointerPos}),this.pointerPos[2]=0,(l=this.looper)==null||l.setLoopTime(this.looper.getLoopTime()+1)}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove)}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,i;(e=this.looper)==null||e.stopLoop(),(t=this.p)==null||t.destroy(!0),this.p=void 0,(i=this.canvas)==null||i.removeEventListener("mousemove",this.onMouseMove),this.canvas=void 0,this.destroyed=!0}}function tD(){const n=gt.useRef(null);return gt.useEffect(()=>{const e=new eD;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(180deg, var(--white) 0%, var(--primary4) 100%)",position:"relative"},children:ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"all"}})})}function Md(n){return ge.jsx("div",{style:{height:n.height??"0",width:n.width??"0"}})}function nD(n){return ge.jsx("div",{style:{width:"100%",height:"100%",borderRadius:"100%",padding:"0.25rem",position:"relative",background:"var(--primary2)"},children:ge.jsx("div",{style:{borderRadius:"100%",position:"absolute",width:"calc(100% - 2 * 0.25rem)",height:"calc(100% - 2 * 0.25rem)",overflow:"hidden",background:"var(--white)"},children:n.children})})}function iD(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`M 0 0 
  L 1 0
  L 1 0.9 
  C 0.8 -1.1   0.2 1.0   0 0.9
  Z`})})}function rD(n){return ge.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1 1",preserveAspectRatio:"none",style:{width:"100%",height:"100%"},children:ge.jsx("path",{fill:n.fill,fillOpacity:"1",d:`
        M 0 0 
        C 0.3 1.8    0.5 0.5    1 0 
        L 1 1 
        L 0 1
        Z`})})}function aD(){return ge.jsx("div",{style:{minHeight:"5rem"},children:ge.jsxs("div",{style:{position:"relative",padding:"2rem",display:"flex",flexWrap:"wrap",flexDirection:"row",alignContent:"space-around",justifyContent:"space-around",width:"100%"},children:[ge.jsx("div",{children:"Site made by codeandcolors"}),ge.jsx("div",{children:ge.jsx(ny,{to:"/imprint",children:"Imprint"})}),ge.jsx("div",{children:ge.jsx(ny,{to:"/resources",children:"Resources"})})]})})}function sD(n){if(n.hasAttribute("width"))return{x:+n.getAttribute("width"),y:+n.getAttribute("height")};if(n.getBBox){const e=n.getBBox();return{x:e.width,y:e.height}}else return console.warn("Could not determine dimensions of svg-element ",n),{x:0,y:0}}function a5(n){var i;if((i=n.viewBox)!=null&&i.baseVal){const r=n.viewBox.baseVal;return{x:r.x+r.width/2,y:r.y+r.height/2}}const e=PA(n),t=sD(n);return{x:e.x+t.x/2,y:e.y+t.y/2}}function PA(n){return{x:+n.getAttribute("x"),y:+n.getAttribute("y")}}function oD(n,e){return{x:n.x-e.x,y:n.y-e.y}}function lD(n,e){return{x:n.x+e.x,y:n.y+e.y}}function cD(n,e){return{x:n.x*e,y:n.y*e}}class uD{constructor(){ut(this,"svg");ut(this,"io");ut(this,"doesLoop",!1)}init(e){this.doesLoop=!0,this.io=new IntersectionObserver((t,i)=>{for(const r of t)if(r.intersectionRatio>.7){const l=r.target;this.doesLoop&&(this.implode(l),i.unobserve(r.target))}}),this.io.observe(e)}delete(){var e,t;this.svg&&((e=this.io)==null||e.unobserve(this.svg)),(t=this.io)==null||t.disconnect(),this.doesLoop=!1}implode(e){const t=a5(e),i=[],r=Array.from(e.childNodes).filter(o=>!["defs"].includes(o.tagName));if(r.length<=0)return;for(const o of r){const p=PA(o);let v=a5(o);v.x===0&&v.y===0&&(v=structuredClone(t)),i.push({childTL:p,childCenter:v}),this.implode(o)}let l=30;const h=o=>{o<0||(r.map((p,v)=>{const{childTL:x,childCenter:M}=i[v],S=oD(M,t),A=lD(x,cD(S,o/l));p.setAttribute("x",A.x+""),p.setAttribute("y",A.y+"")}),this.doesLoop&&setTimeout(()=>requestAnimationFrame(()=>h(o-1)),30))};h(l)}}function hD(n){const e=gt.useRef(null);return gt.useEffect(()=>{const t=new uD;if(e.current){const r=e.current.firstChild;t.init(r)}return()=>t.delete()},[e.current]),ge.jsx("div",{ref:e,style:{width:"100%",height:"100%"},children:n.children})}let dD=class{constructor(){ut(this,"t");ut(this,"a");ut(this,"b");ut(this,"sa");ut(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const t=this.sa*Math.sin(this.a*this.t),i=this.sb*Math.sin(this.b*this.t),r=.5+t/2,l=.5+i/2;return{x:r,y:l}}};class fD{constructor(e=[]){ut(this,"balls",[]);ut(this,"paths",[]);ut(this,"dt",.02);ut(this,"loopHandle");ut(this,"j",0);this.circles=e;for(const t of this.circles)this.balls.push({pos:{x:+t.getAttribute("cx"),y:+t.getAttribute("cy")},r:+t.getAttribute("r")}),this.paths.push(new dD)}loop(){const e=this.circles,t=this.balls,i=this.paths,r=this.dt;for(let h=0;h<e.length;h++){const o=t[h],p=e[h],v=i[h],{x,y:M}=v.advance(r);o.pos.x=x,o.pos.y=M,p.setAttribute("cx",o.pos.x+""),p.setAttribute("cy",o.pos.y+""),p.setAttribute("r",o.r+"")}const l=setTimeout(()=>requestAnimationFrame(()=>this.loop()),100);this.loopHandle=l,this.j+=1}cancelLoop(){clearTimeout(this.loopHandle)}}function pD(n){const e=gt.useRef(null);return gt.useEffect(()=>{let t;if(e.current){const i=e.current.querySelectorAll("circle");t=new fD(Array.from(i)),t.loop()}return()=>t==null?void 0:t.cancelLoop()},[e.current]),ge.jsxs("div",{style:{position:"relative",background:"var(--white)"},children:[ge.jsxs("svg",{ref:e,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0},viewBox:"0 0 1 1",preserveAspectRatio:"none",children:[ge.jsx("defs",{children:ge.jsx("filter",{id:"bbblurry-filter",children:ge.jsx("feGaussianBlur",{stdDeviation:"0.008",in:"SourceGraphic",edgeMode:"none",result:"blur"})})}),ge.jsxs("g",{filter:"url(#bbblurry-filter)",children:[ge.jsx("rect",{x:"-100",y:"-100",width:"200",height:"200",fill:"none"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--primary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--secondary4)",opacity:"0.3"}),ge.jsx("circle",{cx:Math.random(),cy:Math.random(),r:Math.random()*.85,fill:"var(--tertiary4)",opacity:"0.3"})]})]}),ge.jsx("div",{style:{position:"relative"},children:n.children})]})}function of(n){return ge.jsxs("div",{style:{position:"relative"},children:[n.hero,ge.jsxs("div",{style:{zIndex:1,position:"relative",marginTop:"-5rem",marginBottom:"-5rem"},children:[n.logo&&ge.jsx("div",{style:{zIndex:1,position:"absolute",width:"max(10%, 75px)",left:"max(5%, 1rem)",aspectRatio:"1/1"},children:ge.jsx(nD,{children:ge.jsx(hD,{children:n.logo})})}),ge.jsx("div",{style:{width:"100%",height:"5.1rem"},children:ge.jsx(rD,{fill:"var(--white)"})}),ge.jsxs("div",{children:[ge.jsx(Md,{height:"5rem"}),ge.jsx(EA,{children:n.children}),ge.jsx(Md,{height:"5rem"})]}),ge.jsx("div",{style:{width:"100%",height:"5.1rem"},children:ge.jsx(iD,{fill:"var(--white)"})})]}),ge.jsxs("div",{style:{position:"relative"},children:[ge.jsxs(pD,{children:[ge.jsx(Md,{height:"5rem"}),n.footerContent,ge.jsx(Md,{height:"5rem"}),ge.jsx(aD,{})]}),ge.jsx("div",{style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,pointerEvents:"none",background:"linear-gradient(0deg, var(--primary2-transparent25) 0%, rgba(0,0,0,0) 20%, rgba(0,0,0,0) 90%, var(--primary2-transparent25) 100%)",opacity:.5}})]})]})}function mD(){return ge.jsxs(of,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(Gy,{title:"",subtitle:"",heroBackground:ge.jsx(tD,{})})}),logo:ge.jsx("svg",{width:"100%",height:"100%",viewBox:"0 0 1 1",children:ge.jsxs("svg",{x:"0.1",y:"0.25",width:"0.8",height:"0.5",viewBox:"0 0 1 1",children:[ge.jsxs("defs",{children:[ge.jsx("path",{id:"envelopA",d:"M 0 0 L 1 0 L 1 0.2 L 0.5 0.6 L 0 0.2 Z",fill:"black"}),ge.jsx("path",{id:"envelopB",d:"M 0 0.2 L 0.5 0.6 L 1 0.2 L 1 1 L 0 1 Z",fill:"black"})]}),ge.jsx("use",{href:"#envelopA",x:"0",y:"0.0"}),ge.jsx("use",{href:"#envelopB",x:"0",y:"0.2"})]})}),footerContent:ge.jsxs(EA,{children:[ge.jsx("h2",{children:"See you soon!"}),ge.jsx(Md,{height:"5rem"})]}),children:[ge.jsx("h1",{children:"Contact us!"}),ge.jsx("p",{children:"We'll be happy to answer all your requests."}),ge.jsx("div",{className:"ctaContainer",children:ge.jsx("a",{href:"mailto:michael.langbein@codeandcolors.net",children:ge.jsx("button",{type:"button",className:"ctaButton",children:"Send Email"})})})]})}function gD(){return ge.jsx("div",{children:ge.jsx("h1",{children:"Error"})})}function RA(){const n=pw();return ge.jsx("div",{className:"ctaContainer",children:ge.jsxs("div",{className:"CTA",children:[ge.jsx("div",{children:ge.jsx("h2",{children:"Let's build something great together!"})}),ge.jsx("button",{className:"ctaButton",onClick:()=>n("/contact"),children:"Contact us"})]})})}class yD{constructor(e,t){ut(this,"graph");const i=e.getContext("webgl2"),r=new jy(i,{colorBufferFloat:!1,allowAlpha:!0}),l=Wy(0,0,2,2),h=new vo(i,{data:new Float32Array(l.flat()),changesOften:!1}),o=new kr(i,{image:t.heightImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),p=new kr(i,{image:t.rgbImage,interpolate:"linear",edges:"mirror",mipmaps:!0}),v=new kr(i,{image:t.waterNormal1,interpolate:"linear",edges:"repeat",mipmaps:!0}),x=new kr(i,{image:t.waterNormal2,interpolate:"linear",edges:"repeat",mipmaps:!0}),M=new kr(i,{image:t.clouds,interpolate:"linear",edges:"mirror"}),S=new Ra(r,{program:{vertexSource:`#version 300 es
            in vec2 pos;
            out vec2 uv;
            void main() {
                gl_Position = vec4(pos.xy, 0, 1);
                uv = (pos - 1.0) / 2.0;
                uv.x = 1.0 - uv.x;
            }
        `,fragmentSource:`#version 300 es
            precision mediump float;
            in vec2 uv;
            uniform sampler2D imageTex;
            uniform sampler2D heightTex;
            uniform sampler2D waterNormalTexture1;
            uniform sampler2D waterNormalTexture2;
            uniform sampler2D cloudTexture;
            uniform float mousex;
            uniform float mousey;
            uniform float time;
            uniform vec2 textureSize;
            out vec4 fragColor;

            vec4 lighten(vec4 baseColor, vec4 lightenWith, float degree) {
              vec4 distance = lightenWith - baseColor;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 darken(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x -= degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y -= degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z -= degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            vec4 glow(vec4 baseColor, vec4 darkenWith, float degree) {
              vec4 distance = baseColor - darkenWith;
              float x = baseColor.x;
              if (distance.x > 0.0) { x += degree * distance.x; }
              float y = baseColor.y;
              if (distance.y > 0.0) { y += degree * distance.y; }
              float z = baseColor.z;
              if (distance.z > 0.0) { z += degree * distance.z; }
              float w = baseColor.w;
              return vec4(x, y, z, w);
            }

            void main() {
                float waterLine = ${t.waterLine};
                float dx = 1.0 / textureSize.x;
                float dy = 1.0 / textureSize.y;

                // 0. data

                vec2 sunPos = normalize(vec2(mousex * 2.0 - 1.0, mousey * 2.0 - 1.0));
                vec2 water1point = uv * 3.0 + 0.02 * time * vec2(0.1, 0.2);
                vec2 water2point = uv * 3.0 + 0.02 * time * vec2(-0.3, 0.1);
                vec4 waterNorm1 = 2.0 * (texture(waterNormalTexture1,  water1point) - 0.5);
                vec4 waterNorm2 = 2.0 * (texture(waterNormalTexture2,  water2point) - 0.5);
                vec4 waterNorm = mix(waterNorm1, waterNorm2, 0.5);
                vec2 waterNormXY = waterNorm.rg;

                // 1. perspective

                vec4 landColor = vec4(0);
                float height = texture(heightTex, uv).x;
                if (height >= waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + height * ${t.strength} * mouse;
                  landColor = texture(imageTex, queryPoint);
                }

                // 2. water reflection

                vec4 reflectionColor = vec4(0);
                float waveHeight = waterNorm.z;
                float reflection = dot(waterNormXY, sunPos);
                reflection *= reflection;
                if (height < waterLine) {
                  float proxToCenter = 0.25 - length(uv - vec2(0.5));
                  reflectionColor = vec4(reflection);
                }

                // 3. surf

                vec4 surfColor = vec4(0);
                float distFromShore = waterLine - height;
                float surf = sin(distFromShore * 200.0 + time * 1.0);
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  surfColor = vec4(surf, surf, surf, 1);
                }


                // 4. water refraction

                vec4 refractionColor = vec4(0);
                if (height < waterLine) {
                  vec2 mouse = vec2(mousex, mousey);
                  vec2 queryPoint = uv + (height + surf + waveHeight * 0.5) * ${t.strength} * mouse;
                  refractionColor = texture(imageTex, queryPoint);
                }


                // 5. clouds

                vec2 cloudUv = uv * 0.2;
                vec2 cloudTimeOffset = vec2(-0.005 * time, 0);
                vec2 cloudHeightOffset = 0.005 * vec2(mousex, mousey);
                vec4 cloudColor = texture(cloudTexture, cloudUv + cloudTimeOffset + cloudHeightOffset);

                
                // 6. mixing

                vec4 baseColor = landColor + refractionColor;
                vec4 combinedColor = baseColor;
                if (height < waterLine) {
                  // combinedColor = mix(combinedColor, reflectionColor, reflection);
                  // combinedColor = lighten(combinedColor, vec4(1.0), reflection);
                  combinedColor = darken(combinedColor, vec4(0.0), reflection);
                  // combinedColor = lighten(combinedColor, surfColor, 1.0 - distFromShore / 0.1);
                }
                if (distFromShore > 0.0 && distFromShore < 0.1) {
                  combinedColor.xyz *= (1.0 + surf * 0.25);
                }
                // combinedColor = mix(combinedColor, vec4(0), cloudColor.w * cloudColor.w * 0.2);
                combinedColor = glow(combinedColor, vec4(0), cloudColor.w * cloudColor.w * cloudColor.w * 2.0);

                fragColor = combinedColor;
            }
        `},inputs:{attributes:{pos:{buffer:h,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{heightTex:o,imageTex:p,waterNormalTexture1:v,waterNormalTexture2:x,cloudTexture:M},uniforms:{mousex:{type:"float",value:[0]},mousey:{type:"float",value:[0]},time:{type:"float",value:[0]},textureSize:{type:"vec2",value:[p.width,p.height]}}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:l.length,viewport:[0,0,e.width,e.height]}});this.graph=S}step(e){this.graph.updateUniform("mousex",[e.mousex]),this.graph.updateUniform("mousey",[e.mousey]),this.graph.updateUniform("time",[e.time]),this.graph.draw()}destroy(e){var t;(t=this.graph)==null||t.destroy(e)}}class vD{constructor(){ut(this,"looper");ut(this,"islands");ut(this,"canvas");ut(this,"destroyed",!1);ut(this,"mousex",0);ut(this,"mousey",0);ut(this,"onMouseMove",e=>{if(!this.canvas)return;const t=e.clientX/this.canvas.clientWidth,i=1-e.clientY/this.canvas.clientHeight;this.mousex=t,this.mousey=i});ut(this,"onDevMove",e=>{let t=0;e.gamma&&(t=e.gamma/90);let i=0;e.beta&&(i=e.beta/180);const r=Math.max(-1,Math.min(t*3,1)),l=Math.max(-1,Math.min(i*3,1));this.mousex=(r+1)/2,this.mousey=(l+1)/2})}async init(e){const t=await kr.loadImage("/hawaii_depth.jpg"),i=await kr.loadImage("/hawaii_bg2.jpg"),r=await kr.loadImage("/water-normal.png"),l=await kr.loadImage("/water-normal2.png"),h=await kr.loadImage("/clouds.png");this.destroyed||(this.islands=new yD(e,{heightImage:t,rgbImage:i,strength:.004,waterLine:.83,waterNormal1:r,waterNormal2:l,clouds:h}),this.looper=new qp(30,o=>{var p;(p=this.islands)==null||p.step({mousex:this.mousex,mousey:this.mousey,time:o/1e3})}),this.canvas=e,this.canvas.addEventListener("mousemove",this.onMouseMove))}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}destroy(){var e,t,i;(e=this.looper)==null||e.stopLoop(),(t=this.islands)==null||t.destroy(!0),this.islands=void 0,(i=this.canvas)==null||i.removeEventListener("mousemove",this.onMouseMove),window.removeEventListener("deviceorientationabsolute",this.onDevMove),this.canvas=void 0,this.destroyed=!0}}function _D(){const n=gt.useRef(null);return gt.useEffect(()=>{const e=new vD;if(n.current){const t=n.current;t.width=t.clientWidth,t.height=t.clientHeight,t.width<600&&(t.width=t.clientWidth*devicePixelRatio,t.height=t.clientHeight*devicePixelRatio),e.init(t).then(()=>e.startLoop())}return()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}function xD(n){const e=gt.useRef(null);return gt.useEffect(()=>{const t=r=>{for(const l of r)l.isIntersecting&&l.target.classList.add("viewed")},i=new IntersectionObserver(t,{rootMargin:"-10%"});return e.current&&i.observe(e.current),()=>{e.current&&i.unobserve(e.current),i.disconnect}},[e.current]),ge.jsx("div",{ref:e,className:"animatedBlock","data-animationtype":n.direction,children:n.children})}function s5(n){const e=gt.Children.count(n.children);function t(i){return i<=0?"fromLeft":i>=e-1?"fromRight":"fromBottom"}return ge.jsx("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",flexWrap:"wrap"},children:n.children&&gt.Children.map(n.children,(i,r)=>ge.jsx("div",{style:{flex:"1 0 50%"},children:ge.jsx(xD,{direction:t(r),children:i},r)}))})}function bD(n){var t,i;const e=gt.useRef(null);return n.playing?(t=e.current)==null||t.play():(i=e.current)==null||i.pause(),gt.useEffect(()=>{e.current&&(n.playing?e.current.play():e.current.pause())},[e.current]),ge.jsx("video",{ref:e,src:n.videoUrl,poster:n.posterUrl,preload:"auto",loop:!0,autoPlay:n.playing,muted:!0,volume:0,style:{width:"100%",objectFit:"cover",transform:"scale(1.1)"}})}function B_(n){let e={margin:"2rem",padding:"1rem"};n.active&&(e={...e,boxShadow:"0px 5px 15px 5px rgba(0, 0, 0, 0.09)",borderRadius:"1rem"});const t=ge.jsx("div",{style:{borderRadius:"1rem",overflow:"hidden",width:"100%"},children:ge.jsx(bD,{playing:n.active,videoUrl:n.videoUrl,posterUrl:n.posterUrl})});return n.direction==="left"?ge.jsx("div",{style:e,children:ge.jsxs(s5,{children:[ge.jsx("div",{style:{margin:"2rem 1rem 2rem 0"},children:n.children}),t]})}):ge.jsx("div",{style:e,children:ge.jsxs(s5,{children:[t,ge.jsx("div",{style:{margin:"2rem 0 2rem 1rem"},children:n.children})]})})}let wD=class{constructor(e){ut(this,"io");this.callback=e}set(e){this.io=new IntersectionObserver((i,r)=>{i.forEach(l=>{if(l.isIntersecting){const h=l.target,o=parseInt(h.dataset.rownr);this.callback(o)}})},{rootMargin:"-50% 0px -50% 0px"}),Array.from(e.querySelectorAll(".mainContentRow")).map(i=>{var r;return(r=this.io)==null?void 0:r.observe(i)})}destroy(){var e;(e=this.io)==null||e.disconnect()}};function SD(){const n=gt.useRef(null);gt.useEffect(()=>{const r=new wD(l=>i(l));return n.current&&r.set(n.current),()=>r.destroy()},[n.current]);const e=pw(),[t,i]=gt.useState(0);return ge.jsxs("div",{ref:n,className:"mainContentContainer",children:[ge.jsx("div",{style:{margin:"3rem"},children:ge.jsx("h1",{children:"Visualization gallery"})}),ge.jsx("div",{className:"mainContentRow","data-rownr":"1",onMouseEnter:()=>i(1),onMouseLeave:()=>i(0),onClick:()=>e("/swe"),children:ge.jsxs(B_,{active:t===1,videoUrl:"/water_small.mp4",posterUrl:"/water_firstframe.jpg",direction:"right",children:[ge.jsx("h4",{children:"Fluid simulations"}),ge.jsx("p",{children:"See how we use scientifically accurate fluid simulations to build immersive landscapes."})]})}),ge.jsx("div",{className:"mainContentRow","data-rownr":"2",onMouseEnter:()=>i(2),onMouseLeave:()=>i(0),onClick:()=>e("/wind"),children:ge.jsxs(B_,{active:t===2,videoUrl:"/wind_small.mp4",posterUrl:"/wind_firstframe.png",direction:"left",children:[ge.jsx("h4",{children:"Wind visualizations"}),ge.jsx("p",{children:"Integrate our dynamic wind visualizations into your maps."})]})}),ge.jsx("div",{className:"mainContentRow","data-rownr":"3",onMouseEnter:()=>i(3),onMouseLeave:()=>i(0),onClick:()=>e("/math"),children:ge.jsxs(B_,{active:t===3,videoUrl:"/math_smaller.mp4",posterUrl:"/math_firstframe.png",direction:"right",children:[ge.jsx("h4",{children:"Math visualizations"}),ge.jsx("p",{children:"Explaining mathematics visually."})]})})]})}function MD(){return ge.jsx(of,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px"},children:ge.jsx(Gy,{title:"Code and Colors",subtitle:"Scientific data visualizations",heroBackground:ge.jsx(_D,{})})}),footerContent:ge.jsx(RA,{}),children:ge.jsx(SD,{})})}function TD(){const[n,e]=gt.useState("burger-bar unclicked"),[t,i]=gt.useState("menu hidden"),[r,l]=gt.useState(!1),h=()=>{r?(e("burger-bar unclicked"),i("menu hidden")):(e("burger-bar clicked"),i("menu visible")),l(!r)};return ge.jsxs("div",{style:{width:"100%"},children:[ge.jsx("nav",{children:ge.jsxs("div",{className:"burger-menu",onClick:h,children:[ge.jsx("div",{className:n}),ge.jsx("div",{className:n}),ge.jsx("div",{className:n})]})}),ge.jsxs("div",{className:t,children:[ge.jsx(Md,{height:"3rem"}),ge.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[ge.jsx(k0,{className:({isActive:o})=>o?"navLink active":"navLink",to:"/",onClick:h,children:"Home"}),ge.jsx(k0,{className:({isActive:o})=>o?"navLink active":"navLink",to:"/contact",onClick:h,children:"Contact"}),ge.jsx(k0,{className:({isActive:o})=>o?"navLink active":"navLink",to:"/swe",onClick:h,children:"SWE"}),ge.jsx(k0,{className:({isActive:o})=>o?"navLink active":"navLink",to:"/wind",onClick:h,children:"Wind"}),ge.jsx(k0,{className:({isActive:o})=>o?"navLink active":"navLink",to:"/math",onClick:h,children:"Math"})]})]})]})}function ED(){const{pathname:n}=sf();return gt.useEffect(()=>{window.scrollTo(0,0)},[n]),null}function AD(){return ge.jsxs("div",{style:{width:"100%",position:"relative"},children:[ge.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,zIndex:2},children:ge.jsx(TD,{})}),ge.jsx(ED,{}),ge.jsx(wk,{})]})}const IA=({backgroundImage:n,logo:e,title:t,subtitle:i})=>ge.jsx("div",{className:"hero",style:{backgroundImage:`url(${n})`},children:ge.jsxs("div",{className:"hero-content",children:[e&&ge.jsx("div",{className:"hero-logo",children:e}),ge.jsxs("div",{className:"hero-text-content",children:[ge.jsx("h1",{className:"hero-title",children:t}),ge.jsx("h3",{className:"hero-subtitle",children:i})]})]})});function CD(){return ge.jsx(of,{hero:ge.jsx(IA,{backgroundImage:"/legal.jpg",title:"Imprint",subtitle:""}),children:ge.jsxs("div",{className:"impressum",children:[ge.jsx("h1",{children:"Legal Notice"}),ge.jsxs("div",{className:"section",style:{marginBottom:"2rem"},children:[ge.jsx("p",{children:"code and colors"}),ge.jsx("p",{children:" Bahnhofstr. 1, 82205 Gilching "}),ge.jsx("p",{children:"+49 152 6799543"}),ge.jsx("p",{children:"michael.langbein [at] codeandcolors.net"}),ge.jsx("p",{children:"Represented by: Michael Langbein"}),ge.jsx("p",{children:"Responsible for Content: Michael Lanbgein"}),ge.jsx("p",{children:"VAT ID: TBD"}),ge.jsx("p",{children:"Regulatory Authority: TBD"}),ge.jsx("p",{children:"Online Dispute Resolution: TBD"}),ge.jsx("p",{children:"This Legal Notice complies with the German laws under § 5 TMG and § 55 RStV."})]}),ge.jsx("h2",{children:"Liability for Content"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"The contents of our website have been created with the greatest possible care. However, we cannot guarantee the contents' accuracy, completeness, or topicality. According to Section 7, paragraph 1 of the TMG (Telemediengesetz - German Telemedia Act), we as service providers are liable for our content on these pages by general laws. However, according to Sections 8 to 10 of the TMG, we service providers are not obliged to monitor external information transmitted or stored or investigate circumstances pointing to illegal activity. Obligations to remove or block the use of information under general laws remain unaffected. However, a liability in this regard is only possible from the moment of knowledge of a specific infringement. Upon notification of such violations, we will remove the content immediately."})}),ge.jsx("h2",{children:"Liability for Links"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"Our website contains links to external websites, over whose contents we have no control. Therefore, we cannot accept any liability for these external contents. The respective provider or operator of the websites is always responsible for the contents of the linked pages. The linked pages were checked for possible legal violations at the time of linking. Illegal contents were not identified at the time of linking. However, permanent monitoring of the contents of the linked pages is not reasonable without specific indications of a violation. Upon notification of violations, we will remove such links immediately."})}),ge.jsx("h2",{children:"Copyright"}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"The contents and works on these pages created by the site operator are subject to German copyright law. The duplication, processing, distribution, and any kind of utilization outside the limits of copyright require the written consent of the respective author or creator. Downloads and copies of these pages are only permitted for private, non-commercial use. In so far as the contents on this site were not created by the operator, the copyrights of third parties are respected. In particular, third-party content is marked as such. Should you become aware of a copyright infringement, please inform us accordingly. Upon notification of violations, we will remove such contents immediately."})}),ge.jsx("div",{className:"section",style:{marginBottom:"2rem"},children:ge.jsx("p",{children:"Last Updated: May 03, 2024"})})]})})}/**
 * @license
 * Copyright 2010-2024 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const kA="164",DA=300,Td=1e3,Mg=1001,o5=1002,l5=1003,PD=1006,RD=1008,ID=1009,kD=1014,DD=1020,LD=1023,O_=1026,c5=1027,zD="",FD=515,Tg=2e3,u5=2001;let LA=class{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const l=r.indexOf(t);l!==-1&&r.splice(l,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let l=0,h=r.length;l<h;l++)r[l].call(this,e);e.target=null}}};const ea=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function mw(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ea[n&255]+ea[n>>8&255]+ea[n>>16&255]+ea[n>>24&255]+"-"+ea[e&255]+ea[e>>8&255]+"-"+ea[e>>16&15|64]+ea[e>>24&255]+"-"+ea[t&63|128]+ea[t>>8&255]+"-"+ea[t>>16&255]+ea[t>>24&255]+ea[i&255]+ea[i>>8&255]+ea[i>>16&255]+ea[i>>24&255]).toLowerCase()}function sl(n,e,t){return Math.max(e,Math.min(t,n))}let U_=class zA{constructor(e=0,t=0){zA.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(sl(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),l=this.x-e.x,h=this.y-e.y;return this.x=l*i-h*r+e.x,this.y=l*r+h*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}},gw=class FA{constructor(e,t,i,r,l,h,o,p,v){FA.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,l,h,o,p,v)}set(e,t,i,r,l,h,o,p,v){const x=this.elements;return x[0]=e,x[1]=r,x[2]=o,x[3]=t,x[4]=l,x[5]=p,x[6]=i,x[7]=h,x[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,l=this.elements,h=i[0],o=i[3],p=i[6],v=i[1],x=i[4],M=i[7],S=i[2],A=i[5],L=i[8],F=r[0],k=r[3],C=r[6],V=r[1],O=r[4],J=r[7],ue=r[2],Y=r[5],Q=r[8];return l[0]=h*F+o*V+p*ue,l[3]=h*k+o*O+p*Y,l[6]=h*C+o*J+p*Q,l[1]=v*F+x*V+M*ue,l[4]=v*k+x*O+M*Y,l[7]=v*C+x*J+M*Q,l[2]=S*F+A*V+L*ue,l[5]=S*k+A*O+L*Y,l[8]=S*C+A*J+L*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8];return t*h*x-t*o*v-i*l*x+i*o*p+r*l*v-r*h*p}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8],M=x*h-o*v,S=o*p-x*l,A=v*l-h*p,L=t*M+i*S+r*A;if(L===0)return this.set(0,0,0,0,0,0,0,0,0);const F=1/L;return e[0]=M*F,e[1]=(r*v-x*i)*F,e[2]=(o*i-r*h)*F,e[3]=S*F,e[4]=(x*t-r*p)*F,e[5]=(r*l-o*t)*F,e[6]=A*F,e[7]=(i*p-v*t)*F,e[8]=(h*t-i*l)*F,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,l,h,o){const p=Math.cos(l),v=Math.sin(l);return this.set(i*p,i*v,-i*(p*h+v*o)+h+e,-r*v,r*p,-r*(-v*h+p*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(V_.makeScale(e,t)),this}rotate(e){return this.premultiply(V_.makeRotation(-e)),this}translate(e,t){return this.premultiply(V_.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}};const V_=new gw;function h5(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function H_(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}let Bh,ND=class{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Bh===void 0&&(Bh=h5("canvas")),Bh.width=e.width,Bh.height=e.height;const i=Bh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Bh}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=h5("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),l=r.data;for(let h=0;h<l.length;h++)l[h]=H_(l[h]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(H_(t[i]/255)*255):t[i]=H_(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}},BD=0,OD=class{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:BD++}),this.uuid=mw(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let l;if(Array.isArray(r)){l=[];for(let h=0,o=r.length;h<o;h++)r[h].isDataTexture?l.push(G_(r[h].image)):l.push(G_(r[h]))}else l=G_(r);i.url=l}return t||(e.images[this.uuid]=i),i}};function G_(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?ND.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let UD=0,qy=class w1 extends LA{constructor(e=w1.DEFAULT_IMAGE,t=w1.DEFAULT_MAPPING,i=Mg,r=Mg,l=PD,h=RD,o=LD,p=ID,v=w1.DEFAULT_ANISOTROPY,x=zD){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:UD++}),this.uuid=mw(),this.name="",this.source=new OD(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=l,this.minFilter=h,this.anisotropy=v,this.format=o,this.internalFormat=null,this.type=p,this.offset=new U_(0,0),this.repeat=new U_(1,1),this.center=new U_(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new gw,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==DA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case Td:e.x=e.x-Math.floor(e.x);break;case Mg:e.x=e.x<0?0:1;break;case o5:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case Td:e.y=e.y-Math.floor(e.y);break;case Mg:e.y=e.y<0?0:1;break;case o5:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}};qy.DEFAULT_IMAGE=null;qy.DEFAULT_MAPPING=DA;qy.DEFAULT_ANISOTROPY=1;let $p=class{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,l,h,o){let p=i[r+0],v=i[r+1],x=i[r+2],M=i[r+3];const S=l[h+0],A=l[h+1],L=l[h+2],F=l[h+3];if(o===0){e[t+0]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M;return}if(o===1){e[t+0]=S,e[t+1]=A,e[t+2]=L,e[t+3]=F;return}if(M!==F||p!==S||v!==A||x!==L){let k=1-o;const C=p*S+v*A+x*L+M*F,V=C>=0?1:-1,O=1-C*C;if(O>Number.EPSILON){const ue=Math.sqrt(O),Y=Math.atan2(ue,C*V);k=Math.sin(k*Y)/ue,o=Math.sin(o*Y)/ue}const J=o*V;if(p=p*k+S*J,v=v*k+A*J,x=x*k+L*J,M=M*k+F*J,k===1-o){const ue=1/Math.sqrt(p*p+v*v+x*x+M*M);p*=ue,v*=ue,x*=ue,M*=ue}}e[t]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M}static multiplyQuaternionsFlat(e,t,i,r,l,h){const o=i[r],p=i[r+1],v=i[r+2],x=i[r+3],M=l[h],S=l[h+1],A=l[h+2],L=l[h+3];return e[t]=o*L+x*M+p*A-v*S,e[t+1]=p*L+x*S+v*M-o*A,e[t+2]=v*L+x*A+o*S-p*M,e[t+3]=x*L-o*M-p*S-v*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,l=e._z,h=e._order,o=Math.cos,p=Math.sin,v=o(i/2),x=o(r/2),M=o(l/2),S=p(i/2),A=p(r/2),L=p(l/2);switch(h){case"XYZ":this._x=S*x*M+v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M-S*A*L;break;case"YXZ":this._x=S*x*M+v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M+S*A*L;break;case"ZXY":this._x=S*x*M-v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M-S*A*L;break;case"ZYX":this._x=S*x*M-v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M+S*A*L;break;case"YZX":this._x=S*x*M+v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M-S*A*L;break;case"XZY":this._x=S*x*M-v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M+S*A*L;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],l=t[8],h=t[1],o=t[5],p=t[9],v=t[2],x=t[6],M=t[10],S=i+o+M;if(S>0){const A=.5/Math.sqrt(S+1);this._w=.25/A,this._x=(x-p)*A,this._y=(l-v)*A,this._z=(h-r)*A}else if(i>o&&i>M){const A=2*Math.sqrt(1+i-o-M);this._w=(x-p)/A,this._x=.25*A,this._y=(r+h)/A,this._z=(l+v)/A}else if(o>M){const A=2*Math.sqrt(1+o-i-M);this._w=(l-v)/A,this._x=(r+h)/A,this._y=.25*A,this._z=(p+x)/A}else{const A=2*Math.sqrt(1+M-i-o);this._w=(h-r)/A,this._x=(l+v)/A,this._y=(p+x)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(sl(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,l=e._z,h=e._w,o=t._x,p=t._y,v=t._z,x=t._w;return this._x=i*x+h*o+r*v-l*p,this._y=r*x+h*p+l*o-i*v,this._z=l*x+h*v+i*p-r*o,this._w=h*x-i*o-r*p-l*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,l=this._z,h=this._w;let o=h*e._w+i*e._x+r*e._y+l*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=h,this._x=i,this._y=r,this._z=l,this;const p=1-o*o;if(p<=Number.EPSILON){const A=1-t;return this._w=A*h+t*this._w,this._x=A*i+t*this._x,this._y=A*r+t*this._y,this._z=A*l+t*this._z,this.normalize(),this}const v=Math.sqrt(p),x=Math.atan2(v,o),M=Math.sin((1-t)*x)/v,S=Math.sin(t*x)/v;return this._w=h*M+this._w*S,this._x=i*M+this._x*S,this._y=r*M+this._y*S,this._z=l*M+this._z*S,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),l=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),l*Math.sin(t),l*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}},Gr=class NA{constructor(e=0,t=0,i=0){NA.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(d5.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(d5.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,l=e.elements;return this.x=l[0]*t+l[3]*i+l[6]*r,this.y=l[1]*t+l[4]*i+l[7]*r,this.z=l[2]*t+l[5]*i+l[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,l=e.elements,h=1/(l[3]*t+l[7]*i+l[11]*r+l[15]);return this.x=(l[0]*t+l[4]*i+l[8]*r+l[12])*h,this.y=(l[1]*t+l[5]*i+l[9]*r+l[13])*h,this.z=(l[2]*t+l[6]*i+l[10]*r+l[14])*h,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,l=e.x,h=e.y,o=e.z,p=e.w,v=2*(h*r-o*i),x=2*(o*t-l*r),M=2*(l*i-h*t);return this.x=t+p*v+h*M-o*x,this.y=i+p*x+o*v-l*M,this.z=r+p*M+l*x-h*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*r,this.y=l[1]*t+l[5]*i+l[9]*r,this.z=l[2]*t+l[6]*i+l[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,l=e.z,h=t.x,o=t.y,p=t.z;return this.x=r*p-l*o,this.y=l*h-i*p,this.z=i*o-r*h,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return j_.copy(this).projectOnVector(e),this.sub(j_)}reflect(e){return this.sub(j_.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(sl(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}};const j_=new Gr,d5=new $p;let Ld=class U2{constructor(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k){U2.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k)}set(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k){const C=this.elements;return C[0]=e,C[4]=t,C[8]=i,C[12]=r,C[1]=l,C[5]=h,C[9]=o,C[13]=p,C[2]=v,C[6]=x,C[10]=M,C[14]=S,C[3]=A,C[7]=L,C[11]=F,C[15]=k,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new U2().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Oh.setFromMatrixColumn(e,0).length(),l=1/Oh.setFromMatrixColumn(e,1).length(),h=1/Oh.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*l,t[5]=i[5]*l,t[6]=i[6]*l,t[7]=0,t[8]=i[8]*h,t[9]=i[9]*h,t[10]=i[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,l=e.z,h=Math.cos(i),o=Math.sin(i),p=Math.cos(r),v=Math.sin(r),x=Math.cos(l),M=Math.sin(l);if(e.order==="XYZ"){const S=h*x,A=h*M,L=o*x,F=o*M;t[0]=p*x,t[4]=-p*M,t[8]=v,t[1]=A+L*v,t[5]=S-F*v,t[9]=-o*p,t[2]=F-S*v,t[6]=L+A*v,t[10]=h*p}else if(e.order==="YXZ"){const S=p*x,A=p*M,L=v*x,F=v*M;t[0]=S+F*o,t[4]=L*o-A,t[8]=h*v,t[1]=h*M,t[5]=h*x,t[9]=-o,t[2]=A*o-L,t[6]=F+S*o,t[10]=h*p}else if(e.order==="ZXY"){const S=p*x,A=p*M,L=v*x,F=v*M;t[0]=S-F*o,t[4]=-h*M,t[8]=L+A*o,t[1]=A+L*o,t[5]=h*x,t[9]=F-S*o,t[2]=-h*v,t[6]=o,t[10]=h*p}else if(e.order==="ZYX"){const S=h*x,A=h*M,L=o*x,F=o*M;t[0]=p*x,t[4]=L*v-A,t[8]=S*v+F,t[1]=p*M,t[5]=F*v+S,t[9]=A*v-L,t[2]=-v,t[6]=o*p,t[10]=h*p}else if(e.order==="YZX"){const S=h*p,A=h*v,L=o*p,F=o*v;t[0]=p*x,t[4]=F-S*M,t[8]=L*M+A,t[1]=M,t[5]=h*x,t[9]=-o*x,t[2]=-v*x,t[6]=A*M+L,t[10]=S-F*M}else if(e.order==="XZY"){const S=h*p,A=h*v,L=o*p,F=o*v;t[0]=p*x,t[4]=-M,t[8]=v*x,t[1]=S*M+F,t[5]=h*x,t[9]=A*M-L,t[2]=L*M-A,t[6]=o*x,t[10]=F*M+S}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(VD,e,HD)}lookAt(e,t,i){const r=this.elements;return qa.subVectors(e,t),qa.lengthSq()===0&&(qa.z=1),qa.normalize(),ec.crossVectors(i,qa),ec.lengthSq()===0&&(Math.abs(i.z)===1?qa.x+=1e-4:qa.z+=1e-4,qa.normalize(),ec.crossVectors(i,qa)),ec.normalize(),Eg.crossVectors(qa,ec),r[0]=ec.x,r[4]=Eg.x,r[8]=qa.x,r[1]=ec.y,r[5]=Eg.y,r[9]=qa.y,r[2]=ec.z,r[6]=Eg.z,r[10]=qa.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,l=this.elements,h=i[0],o=i[4],p=i[8],v=i[12],x=i[1],M=i[5],S=i[9],A=i[13],L=i[2],F=i[6],k=i[10],C=i[14],V=i[3],O=i[7],J=i[11],ue=i[15],Y=r[0],Q=r[4],xe=r[8],re=r[12],ee=r[1],Me=r[5],Fe=r[9],Ae=r[13],He=r[2],ot=r[6],ft=r[10],ct=r[14],De=r[3],Je=r[7],tt=r[11],_t=r[15];return l[0]=h*Y+o*ee+p*He+v*De,l[4]=h*Q+o*Me+p*ot+v*Je,l[8]=h*xe+o*Fe+p*ft+v*tt,l[12]=h*re+o*Ae+p*ct+v*_t,l[1]=x*Y+M*ee+S*He+A*De,l[5]=x*Q+M*Me+S*ot+A*Je,l[9]=x*xe+M*Fe+S*ft+A*tt,l[13]=x*re+M*Ae+S*ct+A*_t,l[2]=L*Y+F*ee+k*He+C*De,l[6]=L*Q+F*Me+k*ot+C*Je,l[10]=L*xe+F*Fe+k*ft+C*tt,l[14]=L*re+F*Ae+k*ct+C*_t,l[3]=V*Y+O*ee+J*He+ue*De,l[7]=V*Q+O*Me+J*ot+ue*Je,l[11]=V*xe+O*Fe+J*ft+ue*tt,l[15]=V*re+O*Ae+J*ct+ue*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],l=e[12],h=e[1],o=e[5],p=e[9],v=e[13],x=e[2],M=e[6],S=e[10],A=e[14],L=e[3],F=e[7],k=e[11],C=e[15];return L*(+l*p*M-r*v*M-l*o*S+i*v*S+r*o*A-i*p*A)+F*(+t*p*A-t*v*S+l*h*S-r*h*A+r*v*x-l*p*x)+k*(+t*v*M-t*o*A-l*h*M+i*h*A+l*o*x-i*v*x)+C*(-r*o*x-t*p*M+t*o*S+r*h*M-i*h*S+i*p*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8],M=e[9],S=e[10],A=e[11],L=e[12],F=e[13],k=e[14],C=e[15],V=M*k*v-F*S*v+F*p*A-o*k*A-M*p*C+o*S*C,O=L*S*v-x*k*v-L*p*A+h*k*A+x*p*C-h*S*C,J=x*F*v-L*M*v+L*o*A-h*F*A-x*o*C+h*M*C,ue=L*M*p-x*F*p-L*o*S+h*F*S+x*o*k-h*M*k,Y=t*V+i*O+r*J+l*ue;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Q=1/Y;return e[0]=V*Q,e[1]=(F*S*l-M*k*l-F*r*A+i*k*A+M*r*C-i*S*C)*Q,e[2]=(o*k*l-F*p*l+F*r*v-i*k*v-o*r*C+i*p*C)*Q,e[3]=(M*p*l-o*S*l-M*r*v+i*S*v+o*r*A-i*p*A)*Q,e[4]=O*Q,e[5]=(x*k*l-L*S*l+L*r*A-t*k*A-x*r*C+t*S*C)*Q,e[6]=(L*p*l-h*k*l-L*r*v+t*k*v+h*r*C-t*p*C)*Q,e[7]=(h*S*l-x*p*l+x*r*v-t*S*v-h*r*A+t*p*A)*Q,e[8]=J*Q,e[9]=(L*M*l-x*F*l-L*i*A+t*F*A+x*i*C-t*M*C)*Q,e[10]=(h*F*l-L*o*l+L*i*v-t*F*v-h*i*C+t*o*C)*Q,e[11]=(x*o*l-h*M*l-x*i*v+t*M*v+h*i*A-t*o*A)*Q,e[12]=ue*Q,e[13]=(x*F*r-L*M*r+L*i*S-t*F*S-x*i*k+t*M*k)*Q,e[14]=(L*o*r-h*F*r-L*i*p+t*F*p+h*i*k-t*o*k)*Q,e[15]=(h*M*r-x*o*r+x*i*p-t*M*p-h*i*S+t*o*S)*Q,this}scale(e){const t=this.elements,i=e.x,r=e.y,l=e.z;return t[0]*=i,t[4]*=r,t[8]*=l,t[1]*=i,t[5]*=r,t[9]*=l,t[2]*=i,t[6]*=r,t[10]*=l,t[3]*=i,t[7]*=r,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),l=1-i,h=e.x,o=e.y,p=e.z,v=l*h,x=l*o;return this.set(v*h+i,v*o-r*p,v*p+r*o,0,v*o+r*p,x*o+i,x*p-r*h,0,v*p-r*o,x*p+r*h,l*p*p+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,l,h){return this.set(1,i,l,0,e,1,h,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,l=t._x,h=t._y,o=t._z,p=t._w,v=l+l,x=h+h,M=o+o,S=l*v,A=l*x,L=l*M,F=h*x,k=h*M,C=o*M,V=p*v,O=p*x,J=p*M,ue=i.x,Y=i.y,Q=i.z;return r[0]=(1-(F+C))*ue,r[1]=(A+J)*ue,r[2]=(L-O)*ue,r[3]=0,r[4]=(A-J)*Y,r[5]=(1-(S+C))*Y,r[6]=(k+V)*Y,r[7]=0,r[8]=(L+O)*Q,r[9]=(k-V)*Q,r[10]=(1-(S+F))*Q,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let l=Oh.set(r[0],r[1],r[2]).length();const h=Oh.set(r[4],r[5],r[6]).length(),o=Oh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(l=-l),e.x=r[12],e.y=r[13],e.z=r[14],Fs.copy(this);const v=1/l,x=1/h,M=1/o;return Fs.elements[0]*=v,Fs.elements[1]*=v,Fs.elements[2]*=v,Fs.elements[4]*=x,Fs.elements[5]*=x,Fs.elements[6]*=x,Fs.elements[8]*=M,Fs.elements[9]*=M,Fs.elements[10]*=M,t.setFromRotationMatrix(Fs),i.x=l,i.y=h,i.z=o,this}makePerspective(e,t,i,r,l,h,o=Tg){const p=this.elements,v=2*l/(t-e),x=2*l/(i-r),M=(t+e)/(t-e),S=(i+r)/(i-r);let A,L;if(o===Tg)A=-(h+l)/(h-l),L=-2*h*l/(h-l);else if(o===u5)A=-h/(h-l),L=-h*l/(h-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return p[0]=v,p[4]=0,p[8]=M,p[12]=0,p[1]=0,p[5]=x,p[9]=S,p[13]=0,p[2]=0,p[6]=0,p[10]=A,p[14]=L,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(e,t,i,r,l,h,o=Tg){const p=this.elements,v=1/(t-e),x=1/(i-r),M=1/(h-l),S=(t+e)*v,A=(i+r)*x;let L,F;if(o===Tg)L=(h+l)*M,F=-2*M;else if(o===u5)L=l*M,F=-1*M;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return p[0]=2*v,p[4]=0,p[8]=0,p[12]=-S,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-A,p[2]=0,p[6]=0,p[10]=F,p[14]=-L,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}};const Oh=new Gr,Fs=new Ld,VD=new Gr(0,0,0),HD=new Gr(1,1,1),ec=new Gr,Eg=new Gr,qa=new Gr,f5=new Ld,p5=new $p;let BA=class OA{constructor(e=0,t=0,i=0,r=OA.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,l=r[0],h=r[4],o=r[8],p=r[1],v=r[5],x=r[9],M=r[2],S=r[6],A=r[10];switch(t){case"XYZ":this._y=Math.asin(sl(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-x,A),this._z=Math.atan2(-h,l)):(this._x=Math.atan2(S,v),this._z=0);break;case"YXZ":this._x=Math.asin(-sl(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(o,A),this._z=Math.atan2(p,v)):(this._y=Math.atan2(-M,l),this._z=0);break;case"ZXY":this._x=Math.asin(sl(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(-M,A),this._z=Math.atan2(-h,v)):(this._y=0,this._z=Math.atan2(p,l));break;case"ZYX":this._y=Math.asin(-sl(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(S,A),this._z=Math.atan2(p,l)):(this._x=0,this._z=Math.atan2(-h,v));break;case"YZX":this._z=Math.asin(sl(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,v),this._y=Math.atan2(-M,l)):(this._x=0,this._y=Math.atan2(o,A));break;case"XZY":this._z=Math.asin(-sl(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(S,v),this._y=Math.atan2(o,l)):(this._x=Math.atan2(-x,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return f5.makeRotationFromQuaternion(e),this.setFromRotationMatrix(f5,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return p5.setFromEuler(this),this.setFromQuaternion(p5,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}};BA.DEFAULT_ORDER="XYZ";let GD=class{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}},jD=0;const m5=new Gr,Uh=new $p,Zo=new Ld,Ag=new Gr,D0=new Gr,WD=new Gr,qD=new $p,g5=new Gr(1,0,0),y5=new Gr(0,1,0),v5=new Gr(0,0,1),_5={type:"added"},$D={type:"removed"},Vh={type:"childadded",child:null},W_={type:"childremoved",child:null};let yw=class S1 extends LA{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:jD++}),this.uuid=mw(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=S1.DEFAULT_UP.clone();const e=new Gr,t=new BA,i=new $p,r=new Gr(1,1,1);function l(){i.setFromEuler(t,!1)}function h(){t.setFromQuaternion(i,void 0,!1)}t._onChange(l),i._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new Ld},normalMatrix:{value:new gw}}),this.matrix=new Ld,this.matrixWorld=new Ld,this.matrixAutoUpdate=S1.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=S1.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new GD,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Uh.setFromAxisAngle(e,t),this.quaternion.multiply(Uh),this}rotateOnWorldAxis(e,t){return Uh.setFromAxisAngle(e,t),this.quaternion.premultiply(Uh),this}rotateX(e){return this.rotateOnAxis(g5,e)}rotateY(e){return this.rotateOnAxis(y5,e)}rotateZ(e){return this.rotateOnAxis(v5,e)}translateOnAxis(e,t){return m5.copy(e).applyQuaternion(this.quaternion),this.position.add(m5.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(g5,e)}translateY(e){return this.translateOnAxis(y5,e)}translateZ(e){return this.translateOnAxis(v5,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Zo.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Ag.copy(e):Ag.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),D0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Zo.lookAt(D0,Ag,this.up):Zo.lookAt(Ag,D0,this.up),this.quaternion.setFromRotationMatrix(Zo),r&&(Zo.extractRotation(r.matrixWorld),Uh.setFromRotationMatrix(Zo),this.quaternion.premultiply(Uh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(_5),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent($D),W_.child=e,this.dispatchEvent(W_),W_.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Zo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Zo.multiply(e.parent.matrixWorld)),e.applyMatrix4(Zo),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(_5),Vh.child=e,this.dispatchEvent(Vh),Vh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const h=this.children[i].getObjectByProperty(e,t);if(h!==void 0)return h}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let l=0,h=r.length;l<h;l++)r[l].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(D0,e,WD),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(D0,qD,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const l=t[i];(l.matrixWorldAutoUpdate===!0||e===!0)&&l.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let l=0,h=r.length;l<h;l++){const o=r[l];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function l(o,p){return o[p.uuid]===void 0&&(o[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=l(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const p=o.shapes;if(Array.isArray(p))for(let v=0,x=p.length;v<x;v++){const M=p[v];l(e.shapes,M)}else l(e.shapes,p)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let p=0,v=this.material.length;p<v;p++)o.push(l(e.materials,this.material[p]));r.material=o}else r.material=l(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const p=this.animations[o];r.animations.push(l(e.animations,p))}}if(t){const o=h(e.geometries),p=h(e.materials),v=h(e.textures),x=h(e.images),M=h(e.shapes),S=h(e.skeletons),A=h(e.animations),L=h(e.nodes);o.length>0&&(i.geometries=o),p.length>0&&(i.materials=p),v.length>0&&(i.textures=v),x.length>0&&(i.images=x),M.length>0&&(i.shapes=M),S.length>0&&(i.skeletons=S),A.length>0&&(i.animations=A),L.length>0&&(i.nodes=L)}return i.object=r,i;function h(o){const p=[];for(const v in o){const x=o[v];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}};yw.DEFAULT_UP=new Gr(0,1,0);yw.DEFAULT_MATRIX_AUTO_UPDATE=!0;yw.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;let XD=class extends qy{constructor(e,t,i,r,l,h,o,p,v,x){if(x=x!==void 0?x:O_,x!==O_&&x!==c5)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===O_&&(i=kD),i===void 0&&x===c5&&(i=DD),super(null,r,l,h,o,p,x,i,v),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:l5,this.minFilter=p!==void 0?p:l5,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}};const ZD=new XD(1,1);ZD.compareFunction=FD;typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:kA}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=kA);/**
 * @license
 * Copyright 2010-2023 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const vw="163",Hh={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Gh={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},YD=0,x5=1,KD=2,UA=1,JD=2,il=3,Lc=0,Fa=1,go=2,Pc=0,zd=1,b5=2,w5=3,S5=4,QD=5,Eu=100,eL=101,tL=102,nL=103,iL=104,rL=200,aL=201,sL=202,oL=203,V2=204,H2=205,lL=206,cL=207,uL=208,hL=209,dL=210,fL=211,pL=212,mL=213,gL=214,yL=0,vL=1,_L=2,iy=3,xL=4,bL=5,wL=6,SL=7,VA=0,ML=1,TL=2,Rc=0,EL=1,AL=2,CL=3,PL=4,RL=5,IL=6,kL=7,HA=300,Xd=301,Zd=302,G2=303,j2=304,$y=306,W2=1e3,Du=1001,q2=1002,xs=1003,DL=1004,Cg=1005,$s=1006,q_=1007,Lu=1008,Ic=1009,LL=1010,zL=1011,GA=1012,jA=1013,Yd=1014,_c=1015,ry=1016,WA=1017,qA=1018,Xp=1020,FL=35902,NL=1021,BL=1022,_o=1023,OL=1024,UL=1025,Fd=1026,Rp=1027,VL=1028,$A=1029,HL=1030,XA=1031,ZA=1033,$_=33776,X_=33777,Z_=33778,Y_=33779,M5=35840,T5=35841,E5=35842,A5=35843,YA=36196,C5=37492,P5=37496,R5=37808,I5=37809,k5=37810,D5=37811,L5=37812,z5=37813,F5=37814,N5=37815,B5=37816,O5=37817,U5=37818,V5=37819,H5=37820,G5=37821,K_=36492,j5=36494,W5=36495,GL=36283,q5=36284,$5=36285,X5=36286,jL=3200,WL=3201,qL=0,$L=1,gc="",uo="srgb",Gc="srgb-linear",_w="display-p3",Xy="display-p3-linear",ay="linear",Bi="srgb",sy="rec709",oy="p3",jh=7680,Z5=519,XL=512,ZL=513,YL=514,KA=515,KL=516,JL=517,QL=518,ez=519,Y5=35044,K5="300 es",ul=2e3,ly=2001;class Ju{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const i=this._listeners;i[e]===void 0&&(i[e]=[]),i[e].indexOf(t)===-1&&i[e].push(t)}hasEventListener(e,t){if(this._listeners===void 0)return!1;const i=this._listeners;return i[e]!==void 0&&i[e].indexOf(t)!==-1}removeEventListener(e,t){if(this._listeners===void 0)return;const r=this._listeners[e];if(r!==void 0){const l=r.indexOf(t);l!==-1&&r.splice(l,1)}}dispatchEvent(e){if(this._listeners===void 0)return;const i=this._listeners[e.type];if(i!==void 0){e.target=this;const r=i.slice(0);for(let l=0,h=r.length;l<h;l++)r[l].call(this,e);e.target=null}}}const ta=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let J5=1234567;const rp=Math.PI/180,Ip=180/Math.PI;function lf(){const n=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,i=Math.random()*4294967295|0;return(ta[n&255]+ta[n>>8&255]+ta[n>>16&255]+ta[n>>24&255]+"-"+ta[e&255]+ta[e>>8&255]+"-"+ta[e>>16&15|64]+ta[e>>24&255]+"-"+ta[t&63|128]+ta[t>>8&255]+"-"+ta[t>>16&255]+ta[t>>24&255]+ta[i&255]+ta[i>>8&255]+ta[i>>16&255]+ta[i>>24&255]).toLowerCase()}function ra(n,e,t){return Math.max(e,Math.min(t,n))}function xw(n,e){return(n%e+e)%e}function tz(n,e,t,i,r){return i+(n-e)*(r-i)/(t-e)}function nz(n,e,t){return n!==e?(t-n)/(e-n):0}function ap(n,e,t){return(1-t)*n+t*e}function iz(n,e,t,i){return ap(n,e,1-Math.exp(-t*i))}function rz(n,e=1){return e-Math.abs(xw(n,e*2)-e)}function az(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*(3-2*n))}function sz(n,e,t){return n<=e?0:n>=t?1:(n=(n-e)/(t-e),n*n*n*(n*(n*6-15)+10))}function oz(n,e){return n+Math.floor(Math.random()*(e-n+1))}function lz(n,e){return n+Math.random()*(e-n)}function cz(n){return n*(.5-Math.random())}function uz(n){n!==void 0&&(J5=n);let e=J5+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function hz(n){return n*rp}function dz(n){return n*Ip}function fz(n){return(n&n-1)===0&&n!==0}function pz(n){return Math.pow(2,Math.ceil(Math.log(n)/Math.LN2))}function mz(n){return Math.pow(2,Math.floor(Math.log(n)/Math.LN2))}function gz(n,e,t,i,r){const l=Math.cos,h=Math.sin,o=l(t/2),p=h(t/2),v=l((e+i)/2),x=h((e+i)/2),M=l((e-i)/2),S=h((e-i)/2),A=l((i-e)/2),L=h((i-e)/2);switch(r){case"XYX":n.set(o*x,p*M,p*S,o*v);break;case"YZY":n.set(p*S,o*x,p*M,o*v);break;case"ZXZ":n.set(p*M,p*S,o*x,o*v);break;case"XZX":n.set(o*x,p*L,p*A,o*v);break;case"YXY":n.set(p*A,o*x,p*L,o*v);break;case"ZYZ":n.set(p*L,p*A,o*x,o*v);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+r)}}function cd(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return n/4294967295;case Uint16Array:return n/65535;case Uint8Array:return n/255;case Int32Array:return Math.max(n/2147483647,-1);case Int16Array:return Math.max(n/32767,-1);case Int8Array:return Math.max(n/127,-1);default:throw new Error("Invalid component type.")}}function ma(n,e){switch(e.constructor){case Float32Array:return n;case Uint32Array:return Math.round(n*4294967295);case Uint16Array:return Math.round(n*65535);case Uint8Array:return Math.round(n*255);case Int32Array:return Math.round(n*2147483647);case Int16Array:return Math.round(n*32767);case Int8Array:return Math.round(n*127);default:throw new Error("Invalid component type.")}}const yz={DEG2RAD:rp,RAD2DEG:Ip,generateUUID:lf,clamp:ra,euclideanModulo:xw,mapLinear:tz,inverseLerp:nz,lerp:ap,damp:iz,pingpong:rz,smoothstep:az,smootherstep:sz,randInt:oz,randFloat:lz,randFloatSpread:cz,seededRandom:uz,degToRad:hz,radToDeg:dz,isPowerOfTwo:fz,ceilPowerOfTwo:pz,floorPowerOfTwo:mz,setQuaternionFromProperEuler:gz,normalize:ma,denormalize:cd};class $n{constructor(e=0,t=0){$n.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,i=this.y,r=e.elements;return this.x=r[0]*t+r[3]*i+r[6],this.y=r[1]*t+r[4]*i+r[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ra(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y;return t*t+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const i=Math.cos(t),r=Math.sin(t),l=this.x-e.x,h=this.y-e.y;return this.x=l*i-h*r+e.x,this.y=l*r+h*i+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Jn{constructor(e,t,i,r,l,h,o,p,v){Jn.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,i,r,l,h,o,p,v)}set(e,t,i,r,l,h,o,p,v){const x=this.elements;return x[0]=e,x[1]=r,x[2]=o,x[3]=t,x[4]=l,x[5]=p,x[6]=i,x[7]=h,x[8]=v,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],this}extractBasis(e,t,i){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),i.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,l=this.elements,h=i[0],o=i[3],p=i[6],v=i[1],x=i[4],M=i[7],S=i[2],A=i[5],L=i[8],F=r[0],k=r[3],C=r[6],V=r[1],O=r[4],J=r[7],ue=r[2],Y=r[5],Q=r[8];return l[0]=h*F+o*V+p*ue,l[3]=h*k+o*O+p*Y,l[6]=h*C+o*J+p*Q,l[1]=v*F+x*V+M*ue,l[4]=v*k+x*O+M*Y,l[7]=v*C+x*J+M*Q,l[2]=S*F+A*V+L*ue,l[5]=S*k+A*O+L*Y,l[8]=S*C+A*J+L*Q,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8];return t*h*x-t*o*v-i*l*x+i*o*p+r*l*v-r*h*p}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8],M=x*h-o*v,S=o*p-x*l,A=v*l-h*p,L=t*M+i*S+r*A;if(L===0)return this.set(0,0,0,0,0,0,0,0,0);const F=1/L;return e[0]=M*F,e[1]=(r*v-x*i)*F,e[2]=(o*i-r*h)*F,e[3]=S*F,e[4]=(x*t-r*p)*F,e[5]=(r*l-o*t)*F,e[6]=A*F,e[7]=(i*p-v*t)*F,e[8]=(h*t-i*l)*F,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,i,r,l,h,o){const p=Math.cos(l),v=Math.sin(l);return this.set(i*p,i*v,-i*(p*h+v*o)+h+e,-r*v,r*p,-r*(-v*h+p*o)+o+t,0,0,1),this}scale(e,t){return this.premultiply(J_.makeScale(e,t)),this}rotate(e){return this.premultiply(J_.makeRotation(-e)),this}translate(e,t){return this.premultiply(J_.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,i,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<9;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<9;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const J_=new Jn;function JA(n){for(let e=n.length-1;e>=0;--e)if(n[e]>=65535)return!0;return!1}function kp(n){return document.createElementNS("http://www.w3.org/1999/xhtml",n)}function vz(){const n=kp("canvas");return n.style.display="block",n}const Q5={};function _z(n){n in Q5||(Q5[n]=!0,console.warn(n))}const eM=new Jn().set(.8224621,.177538,0,.0331941,.9668058,0,.0170827,.0723974,.9105199),tM=new Jn().set(1.2249401,-.2249404,0,-.0420569,1.0420571,0,-.0196376,-.0786361,1.0982735),Pg={[Gc]:{transfer:ay,primaries:sy,toReference:n=>n,fromReference:n=>n},[uo]:{transfer:Bi,primaries:sy,toReference:n=>n.convertSRGBToLinear(),fromReference:n=>n.convertLinearToSRGB()},[Xy]:{transfer:ay,primaries:oy,toReference:n=>n.applyMatrix3(tM),fromReference:n=>n.applyMatrix3(eM)},[_w]:{transfer:Bi,primaries:oy,toReference:n=>n.convertSRGBToLinear().applyMatrix3(tM),fromReference:n=>n.applyMatrix3(eM).convertLinearToSRGB()}},xz=new Set([Gc,Xy]),Mi={enabled:!0,_workingColorSpace:Gc,get workingColorSpace(){return this._workingColorSpace},set workingColorSpace(n){if(!xz.has(n))throw new Error(`Unsupported working color space, "${n}".`);this._workingColorSpace=n},convert:function(n,e,t){if(this.enabled===!1||e===t||!e||!t)return n;const i=Pg[e].toReference,r=Pg[t].fromReference;return r(i(n))},fromWorkingColorSpace:function(n,e){return this.convert(n,this._workingColorSpace,e)},toWorkingColorSpace:function(n,e){return this.convert(n,e,this._workingColorSpace)},getPrimaries:function(n){return Pg[n].primaries},getTransfer:function(n){return n===gc?ay:Pg[n].transfer}};function Nd(n){return n<.04045?n*.0773993808:Math.pow(n*.9478672986+.0521327014,2.4)}function Q_(n){return n<.0031308?n*12.92:1.055*Math.pow(n,.41666)-.055}let Wh;class bz{static getDataURL(e){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let t;if(e instanceof HTMLCanvasElement)t=e;else{Wh===void 0&&(Wh=kp("canvas")),Wh.width=e.width,Wh.height=e.height;const i=Wh.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),t=Wh}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=kp("canvas");t.width=e.width,t.height=e.height;const i=t.getContext("2d");i.drawImage(e,0,0,e.width,e.height);const r=i.getImageData(0,0,e.width,e.height),l=r.data;for(let h=0;h<l.length;h++)l[h]=Nd(l[h]/255)*255;return i.putImageData(r,0,0),t}else if(e.data){const t=e.data.slice(0);for(let i=0;i<t.length;i++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[i]=Math.floor(Nd(t[i]/255)*255):t[i]=Nd(t[i]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let wz=0;class QA{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:wz++}),this.uuid=lf(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const i={uuid:this.uuid,url:""},r=this.data;if(r!==null){let l;if(Array.isArray(r)){l=[];for(let h=0,o=r.length;h<o;h++)r[h].isDataTexture?l.push(ex(r[h].image)):l.push(ex(r[h]))}else l=ex(r);i.url=l}return t||(e.images[this.uuid]=i),i}}function ex(n){return typeof HTMLImageElement<"u"&&n instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&n instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&n instanceof ImageBitmap?bz.getDataURL(n):n.data?{data:Array.from(n.data),width:n.width,height:n.height,type:n.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Sz=0;class xa extends Ju{constructor(e=xa.DEFAULT_IMAGE,t=xa.DEFAULT_MAPPING,i=Du,r=Du,l=$s,h=Lu,o=_o,p=Ic,v=xa.DEFAULT_ANISOTROPY,x=gc){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Sz++}),this.uuid=lf(),this.name="",this.source=new QA(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=i,this.wrapT=r,this.magFilter=l,this.minFilter=h,this.anisotropy=v,this.format=o,this.internalFormat=null,this.type=p,this.offset=new $n(0,0),this.repeat=new $n(1,1),this.center=new $n(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Jn,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=x,this.userData={},this.version=0,this.onUpdate=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const i={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(i.userData=this.userData),t||(e.textures[this.uuid]=i),i}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==HA)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case W2:e.x=e.x-Math.floor(e.x);break;case Du:e.x=e.x<0?0:1;break;case q2:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case W2:e.y=e.y-Math.floor(e.y);break;case Du:e.y=e.y<0?0:1;break;case q2:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}xa.DEFAULT_IMAGE=null;xa.DEFAULT_MAPPING=HA;xa.DEFAULT_ANISOTROPY=1;class Ur{constructor(e=0,t=0,i=0,r=1){Ur.prototype.isVector4=!0,this.x=e,this.y=t,this.z=i,this.w=r}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,i,r){return this.x=e,this.y=t,this.z=i,this.w=r,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,l=this.w,h=e.elements;return this.x=h[0]*t+h[4]*i+h[8]*r+h[12]*l,this.y=h[1]*t+h[5]*i+h[9]*r+h[13]*l,this.z=h[2]*t+h[6]*i+h[10]*r+h[14]*l,this.w=h[3]*t+h[7]*i+h[11]*r+h[15]*l,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,i,r,l;const p=e.elements,v=p[0],x=p[4],M=p[8],S=p[1],A=p[5],L=p[9],F=p[2],k=p[6],C=p[10];if(Math.abs(x-S)<.01&&Math.abs(M-F)<.01&&Math.abs(L-k)<.01){if(Math.abs(x+S)<.1&&Math.abs(M+F)<.1&&Math.abs(L+k)<.1&&Math.abs(v+A+C-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const O=(v+1)/2,J=(A+1)/2,ue=(C+1)/2,Y=(x+S)/4,Q=(M+F)/4,xe=(L+k)/4;return O>J&&O>ue?O<.01?(i=0,r=.707106781,l=.707106781):(i=Math.sqrt(O),r=Y/i,l=Q/i):J>ue?J<.01?(i=.707106781,r=0,l=.707106781):(r=Math.sqrt(J),i=Y/r,l=xe/r):ue<.01?(i=.707106781,r=.707106781,l=0):(l=Math.sqrt(ue),i=Q/l,r=xe/l),this.set(i,r,l,t),this}let V=Math.sqrt((k-L)*(k-L)+(M-F)*(M-F)+(S-x)*(S-x));return Math.abs(V)<.001&&(V=1),this.x=(k-L)/V,this.y=(M-F)/V,this.z=(S-x)/V,this.w=Math.acos((v+A+C-1)/2),this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this.w=e.w+(t.w-e.w)*i,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class Mz extends Ju{constructor(e=1,t=1,i={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ur(0,0,e,t),this.scissorTest=!1,this.viewport=new Ur(0,0,e,t);const r={width:e,height:t,depth:1};i=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:$s,depthBuffer:!0,stencilBuffer:!1,depthTexture:null,samples:0,count:1},i);const l=new xa(r,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.colorSpace);l.flipY=!1,l.generateMipmaps=i.generateMipmaps,l.internalFormat=i.internalFormat,this.textures=[];const h=i.count;for(let o=0;o<h;o++)this.textures[o]=l.clone(),this.textures[o].isRenderTargetTexture=!0;this.depthBuffer=i.depthBuffer,this.stencilBuffer=i.stencilBuffer,this.depthTexture=i.depthTexture,this.samples=i.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}setSize(e,t,i=1){if(this.width!==e||this.height!==t||this.depth!==i){this.width=e,this.height=t,this.depth=i;for(let r=0,l=this.textures.length;r<l;r++)this.textures[r].image.width=e,this.textures[r].image.height=t,this.textures[r].image.depth=i;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let i=0,r=e.textures.length;i<r;i++)this.textures[i]=e.textures[i].clone(),this.textures[i].isRenderTargetTexture=!0;const t=Object.assign({},e.texture.image);return this.texture.source=new QA(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class qu extends Mz{constructor(e=1,t=1,i={}){super(e,t,i),this.isWebGLRenderTarget=!0}}class e8 extends xa{constructor(e=null,t=1,i=1,r=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xs,this.minFilter=xs,this.wrapR=Du,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class Tz extends xa{constructor(e=null,t=1,i=1,r=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:i,depth:r},this.magFilter=xs,this.minFilter=xs,this.wrapR=Du,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class $u{constructor(e=0,t=0,i=0,r=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=i,this._w=r}static slerpFlat(e,t,i,r,l,h,o){let p=i[r+0],v=i[r+1],x=i[r+2],M=i[r+3];const S=l[h+0],A=l[h+1],L=l[h+2],F=l[h+3];if(o===0){e[t+0]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M;return}if(o===1){e[t+0]=S,e[t+1]=A,e[t+2]=L,e[t+3]=F;return}if(M!==F||p!==S||v!==A||x!==L){let k=1-o;const C=p*S+v*A+x*L+M*F,V=C>=0?1:-1,O=1-C*C;if(O>Number.EPSILON){const ue=Math.sqrt(O),Y=Math.atan2(ue,C*V);k=Math.sin(k*Y)/ue,o=Math.sin(o*Y)/ue}const J=o*V;if(p=p*k+S*J,v=v*k+A*J,x=x*k+L*J,M=M*k+F*J,k===1-o){const ue=1/Math.sqrt(p*p+v*v+x*x+M*M);p*=ue,v*=ue,x*=ue,M*=ue}}e[t]=p,e[t+1]=v,e[t+2]=x,e[t+3]=M}static multiplyQuaternionsFlat(e,t,i,r,l,h){const o=i[r],p=i[r+1],v=i[r+2],x=i[r+3],M=l[h],S=l[h+1],A=l[h+2],L=l[h+3];return e[t]=o*L+x*M+p*A-v*S,e[t+1]=p*L+x*S+v*M-o*A,e[t+2]=v*L+x*A+o*S-p*M,e[t+3]=x*L-o*M-p*S-v*A,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,i,r){return this._x=e,this._y=t,this._z=i,this._w=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const i=e._x,r=e._y,l=e._z,h=e._order,o=Math.cos,p=Math.sin,v=o(i/2),x=o(r/2),M=o(l/2),S=p(i/2),A=p(r/2),L=p(l/2);switch(h){case"XYZ":this._x=S*x*M+v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M-S*A*L;break;case"YXZ":this._x=S*x*M+v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M+S*A*L;break;case"ZXY":this._x=S*x*M-v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M-S*A*L;break;case"ZYX":this._x=S*x*M-v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M+S*A*L;break;case"YZX":this._x=S*x*M+v*A*L,this._y=v*A*M+S*x*L,this._z=v*x*L-S*A*M,this._w=v*x*M-S*A*L;break;case"XZY":this._x=S*x*M-v*A*L,this._y=v*A*M-S*x*L,this._z=v*x*L+S*A*M,this._w=v*x*M+S*A*L;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+h)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const i=t/2,r=Math.sin(i);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(i),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,i=t[0],r=t[4],l=t[8],h=t[1],o=t[5],p=t[9],v=t[2],x=t[6],M=t[10],S=i+o+M;if(S>0){const A=.5/Math.sqrt(S+1);this._w=.25/A,this._x=(x-p)*A,this._y=(l-v)*A,this._z=(h-r)*A}else if(i>o&&i>M){const A=2*Math.sqrt(1+i-o-M);this._w=(x-p)/A,this._x=.25*A,this._y=(r+h)/A,this._z=(l+v)/A}else if(o>M){const A=2*Math.sqrt(1+o-i-M);this._w=(l-v)/A,this._x=(r+h)/A,this._y=.25*A,this._z=(p+x)/A}else{const A=2*Math.sqrt(1+M-i-o);this._w=(h-r)/A,this._x=(l+v)/A,this._y=(p+x)/A,this._z=.25*A}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let i=e.dot(t)+1;return i<Number.EPSILON?(i=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=i):(this._x=0,this._y=-e.z,this._z=e.y,this._w=i)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=i),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(ra(this.dot(e),-1,1)))}rotateTowards(e,t){const i=this.angleTo(e);if(i===0)return this;const r=Math.min(1,t/i);return this.slerp(e,r),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const i=e._x,r=e._y,l=e._z,h=e._w,o=t._x,p=t._y,v=t._z,x=t._w;return this._x=i*x+h*o+r*v-l*p,this._y=r*x+h*p+l*o-i*v,this._z=l*x+h*v+i*p-r*o,this._w=h*x-i*o-r*p-l*v,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const i=this._x,r=this._y,l=this._z,h=this._w;let o=h*e._w+i*e._x+r*e._y+l*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=h,this._x=i,this._y=r,this._z=l,this;const p=1-o*o;if(p<=Number.EPSILON){const A=1-t;return this._w=A*h+t*this._w,this._x=A*i+t*this._x,this._y=A*r+t*this._y,this._z=A*l+t*this._z,this.normalize(),this}const v=Math.sqrt(p),x=Math.atan2(v,o),M=Math.sin((1-t)*x)/v,S=Math.sin(t*x)/v;return this._w=h*M+this._w*S,this._x=i*M+this._x*S,this._y=r*M+this._y*S,this._z=l*M+this._z*S,this._onChangeCallback(),this}slerpQuaternions(e,t,i){return this.copy(e).slerp(t,i)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),i=Math.random(),r=Math.sqrt(1-i),l=Math.sqrt(i);return this.set(r*Math.sin(e),r*Math.cos(e),l*Math.sin(t),l*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class it{constructor(e=0,t=0,i=0){it.prototype.isVector3=!0,this.x=e,this.y=t,this.z=i}set(e,t,i){return i===void 0&&(i=this.z),this.x=e,this.y=t,this.z=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(nM.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(nM.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,i=this.y,r=this.z,l=e.elements;return this.x=l[0]*t+l[3]*i+l[6]*r,this.y=l[1]*t+l[4]*i+l[7]*r,this.z=l[2]*t+l[5]*i+l[8]*r,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,i=this.y,r=this.z,l=e.elements,h=1/(l[3]*t+l[7]*i+l[11]*r+l[15]);return this.x=(l[0]*t+l[4]*i+l[8]*r+l[12])*h,this.y=(l[1]*t+l[5]*i+l[9]*r+l[13])*h,this.z=(l[2]*t+l[6]*i+l[10]*r+l[14])*h,this}applyQuaternion(e){const t=this.x,i=this.y,r=this.z,l=e.x,h=e.y,o=e.z,p=e.w,v=2*(h*r-o*i),x=2*(o*t-l*r),M=2*(l*i-h*t);return this.x=t+p*v+h*M-o*x,this.y=i+p*x+o*v-l*M,this.z=r+p*M+l*x-h*v,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,i=this.y,r=this.z,l=e.elements;return this.x=l[0]*t+l[4]*i+l[8]*r,this.y=l[1]*t+l[5]*i+l[9]*r,this.z=l[2]*t+l[6]*i+l[10]*r,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}clampScalar(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}clampLength(e,t){const i=this.length();return this.divideScalar(i||1).multiplyScalar(Math.max(e,Math.min(t,i)))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,i){return this.x=e.x+(t.x-e.x)*i,this.y=e.y+(t.y-e.y)*i,this.z=e.z+(t.z-e.z)*i,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const i=e.x,r=e.y,l=e.z,h=t.x,o=t.y,p=t.z;return this.x=r*p-l*o,this.y=l*h-i*p,this.z=i*o-r*h,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const i=e.dot(this)/t;return this.copy(e).multiplyScalar(i)}projectOnPlane(e){return tx.copy(this).projectOnVector(e),this.sub(tx)}reflect(e){return this.sub(tx.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const i=this.dot(e)/t;return Math.acos(ra(i,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,i=this.y-e.y,r=this.z-e.z;return t*t+i*i+r*r}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,i){const r=Math.sin(t)*e;return this.x=r*Math.sin(i),this.y=Math.cos(t)*e,this.z=r*Math.cos(i),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,i){return this.x=e*Math.sin(t),this.y=i,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),i=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=i,this.z=r,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,i=Math.sqrt(1-t*t);return this.x=i*Math.cos(e),this.y=t,this.z=i*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const tx=new it,nM=new $u;class Zp{constructor(e=new it(1/0,1/0,1/0),t=new it(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t+=3)this.expandByPoint(Ns.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,i=e.count;t<i;t++)this.expandByPoint(Ns.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,i=e.length;t<i;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const i=Ns.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(i),this.max.copy(e).add(i),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const i=e.geometry;if(i!==void 0){const l=i.getAttribute("position");if(t===!0&&l!==void 0&&e.isInstancedMesh!==!0)for(let h=0,o=l.count;h<o;h++)e.isMesh===!0?e.getVertexPosition(h,Ns):Ns.fromBufferAttribute(l,h),Ns.applyMatrix4(e.matrixWorld),this.expandByPoint(Ns);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),Rg.copy(e.boundingBox)):(i.boundingBox===null&&i.computeBoundingBox(),Rg.copy(i.boundingBox)),Rg.applyMatrix4(e.matrixWorld),this.union(Rg)}const r=e.children;for(let l=0,h=r.length;l<h;l++)this.expandByObject(r[l],t);return this}containsPoint(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}intersectsSphere(e){return this.clampPoint(e.center,Ns),Ns.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,i;return e.normal.x>0?(t=e.normal.x*this.min.x,i=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,i=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,i+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,i+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,i+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,i+=e.normal.z*this.min.z),t<=-e.constant&&i>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(L0),Ig.subVectors(this.max,L0),qh.subVectors(e.a,L0),$h.subVectors(e.b,L0),Xh.subVectors(e.c,L0),tc.subVectors($h,qh),nc.subVectors(Xh,$h),fu.subVectors(qh,Xh);let t=[0,-tc.z,tc.y,0,-nc.z,nc.y,0,-fu.z,fu.y,tc.z,0,-tc.x,nc.z,0,-nc.x,fu.z,0,-fu.x,-tc.y,tc.x,0,-nc.y,nc.x,0,-fu.y,fu.x,0];return!nx(t,qh,$h,Xh,Ig)||(t=[1,0,0,0,1,0,0,0,1],!nx(t,qh,$h,Xh,Ig))?!1:(kg.crossVectors(tc,nc),t=[kg.x,kg.y,kg.z],nx(t,qh,$h,Xh,Ig))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Ns).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Ns).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(Yo[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Yo[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Yo[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Yo[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Yo[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Yo[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Yo[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Yo[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Yo),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Yo=[new it,new it,new it,new it,new it,new it,new it,new it],Ns=new it,Rg=new Zp,qh=new it,$h=new it,Xh=new it,tc=new it,nc=new it,fu=new it,L0=new it,Ig=new it,kg=new it,pu=new it;function nx(n,e,t,i,r){for(let l=0,h=n.length-3;l<=h;l+=3){pu.fromArray(n,l);const o=r.x*Math.abs(pu.x)+r.y*Math.abs(pu.y)+r.z*Math.abs(pu.z),p=e.dot(pu),v=t.dot(pu),x=i.dot(pu);if(Math.max(-Math.max(p,v,x),Math.min(p,v,x))>o)return!1}return!0}const Ez=new Zp,z0=new it,ix=new it;class bw{constructor(e=new it,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const i=this.center;t!==void 0?i.copy(t):Ez.setFromPoints(e).getCenter(i);let r=0;for(let l=0,h=e.length;l<h;l++)r=Math.max(r,i.distanceToSquared(e[l]));return this.radius=Math.sqrt(r),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const i=this.center.distanceToSquared(e);return t.copy(e),i>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;z0.subVectors(e,this.center);const t=z0.lengthSq();if(t>this.radius*this.radius){const i=Math.sqrt(t),r=(i-this.radius)*.5;this.center.addScaledVector(z0,r/i),this.radius+=r}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(ix.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(z0.copy(e.center).add(ix)),this.expandByPoint(z0.copy(e.center).sub(ix))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const Ko=new it,rx=new it,Dg=new it,ic=new it,ax=new it,Lg=new it,sx=new it;class t8{constructor(e=new it,t=new it(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,Ko)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const i=t.dot(this.direction);return i<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,i)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=Ko.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(Ko.copy(this.origin).addScaledVector(this.direction,t),Ko.distanceToSquared(e))}distanceSqToSegment(e,t,i,r){rx.copy(e).add(t).multiplyScalar(.5),Dg.copy(t).sub(e).normalize(),ic.copy(this.origin).sub(rx);const l=e.distanceTo(t)*.5,h=-this.direction.dot(Dg),o=ic.dot(this.direction),p=-ic.dot(Dg),v=ic.lengthSq(),x=Math.abs(1-h*h);let M,S,A,L;if(x>0)if(M=h*p-o,S=h*o-p,L=l*x,M>=0)if(S>=-L)if(S<=L){const F=1/x;M*=F,S*=F,A=M*(M+h*S+2*o)+S*(h*M+S+2*p)+v}else S=l,M=Math.max(0,-(h*S+o)),A=-M*M+S*(S+2*p)+v;else S=-l,M=Math.max(0,-(h*S+o)),A=-M*M+S*(S+2*p)+v;else S<=-L?(M=Math.max(0,-(-h*l+o)),S=M>0?-l:Math.min(Math.max(-l,-p),l),A=-M*M+S*(S+2*p)+v):S<=L?(M=0,S=Math.min(Math.max(-l,-p),l),A=S*(S+2*p)+v):(M=Math.max(0,-(h*l+o)),S=M>0?l:Math.min(Math.max(-l,-p),l),A=-M*M+S*(S+2*p)+v);else S=h>0?-l:l,M=Math.max(0,-(h*S+o)),A=-M*M+S*(S+2*p)+v;return i&&i.copy(this.origin).addScaledVector(this.direction,M),r&&r.copy(rx).addScaledVector(Dg,S),A}intersectSphere(e,t){Ko.subVectors(e.center,this.origin);const i=Ko.dot(this.direction),r=Ko.dot(Ko)-i*i,l=e.radius*e.radius;if(r>l)return null;const h=Math.sqrt(l-r),o=i-h,p=i+h;return p<0?null:o<0?this.at(p,t):this.at(o,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const i=-(this.origin.dot(e.normal)+e.constant)/t;return i>=0?i:null}intersectPlane(e,t){const i=this.distanceToPlane(e);return i===null?null:this.at(i,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let i,r,l,h,o,p;const v=1/this.direction.x,x=1/this.direction.y,M=1/this.direction.z,S=this.origin;return v>=0?(i=(e.min.x-S.x)*v,r=(e.max.x-S.x)*v):(i=(e.max.x-S.x)*v,r=(e.min.x-S.x)*v),x>=0?(l=(e.min.y-S.y)*x,h=(e.max.y-S.y)*x):(l=(e.max.y-S.y)*x,h=(e.min.y-S.y)*x),i>h||l>r||((l>i||isNaN(i))&&(i=l),(h<r||isNaN(r))&&(r=h),M>=0?(o=(e.min.z-S.z)*M,p=(e.max.z-S.z)*M):(o=(e.max.z-S.z)*M,p=(e.min.z-S.z)*M),i>p||o>r)||((o>i||i!==i)&&(i=o),(p<r||r!==r)&&(r=p),r<0)?null:this.at(i>=0?i:r,t)}intersectsBox(e){return this.intersectBox(e,Ko)!==null}intersectTriangle(e,t,i,r,l){ax.subVectors(t,e),Lg.subVectors(i,e),sx.crossVectors(ax,Lg);let h=this.direction.dot(sx),o;if(h>0){if(r)return null;o=1}else if(h<0)o=-1,h=-h;else return null;ic.subVectors(this.origin,e);const p=o*this.direction.dot(Lg.crossVectors(ic,Lg));if(p<0)return null;const v=o*this.direction.dot(ax.cross(ic));if(v<0||p+v>h)return null;const x=-o*ic.dot(sx);return x<0?null:this.at(x/h,l)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class wr{constructor(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k){wr.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k)}set(e,t,i,r,l,h,o,p,v,x,M,S,A,L,F,k){const C=this.elements;return C[0]=e,C[4]=t,C[8]=i,C[12]=r,C[1]=l,C[5]=h,C[9]=o,C[13]=p,C[2]=v,C[6]=x,C[10]=M,C[14]=S,C[3]=A,C[7]=L,C[11]=F,C[15]=k,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new wr().fromArray(this.elements)}copy(e){const t=this.elements,i=e.elements;return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],this}copyPosition(e){const t=this.elements,i=e.elements;return t[12]=i[12],t[13]=i[13],t[14]=i[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,i){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),i.setFromMatrixColumn(this,2),this}makeBasis(e,t,i){return this.set(e.x,t.x,i.x,0,e.y,t.y,i.y,0,e.z,t.z,i.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,i=e.elements,r=1/Zh.setFromMatrixColumn(e,0).length(),l=1/Zh.setFromMatrixColumn(e,1).length(),h=1/Zh.setFromMatrixColumn(e,2).length();return t[0]=i[0]*r,t[1]=i[1]*r,t[2]=i[2]*r,t[3]=0,t[4]=i[4]*l,t[5]=i[5]*l,t[6]=i[6]*l,t[7]=0,t[8]=i[8]*h,t[9]=i[9]*h,t[10]=i[10]*h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,i=e.x,r=e.y,l=e.z,h=Math.cos(i),o=Math.sin(i),p=Math.cos(r),v=Math.sin(r),x=Math.cos(l),M=Math.sin(l);if(e.order==="XYZ"){const S=h*x,A=h*M,L=o*x,F=o*M;t[0]=p*x,t[4]=-p*M,t[8]=v,t[1]=A+L*v,t[5]=S-F*v,t[9]=-o*p,t[2]=F-S*v,t[6]=L+A*v,t[10]=h*p}else if(e.order==="YXZ"){const S=p*x,A=p*M,L=v*x,F=v*M;t[0]=S+F*o,t[4]=L*o-A,t[8]=h*v,t[1]=h*M,t[5]=h*x,t[9]=-o,t[2]=A*o-L,t[6]=F+S*o,t[10]=h*p}else if(e.order==="ZXY"){const S=p*x,A=p*M,L=v*x,F=v*M;t[0]=S-F*o,t[4]=-h*M,t[8]=L+A*o,t[1]=A+L*o,t[5]=h*x,t[9]=F-S*o,t[2]=-h*v,t[6]=o,t[10]=h*p}else if(e.order==="ZYX"){const S=h*x,A=h*M,L=o*x,F=o*M;t[0]=p*x,t[4]=L*v-A,t[8]=S*v+F,t[1]=p*M,t[5]=F*v+S,t[9]=A*v-L,t[2]=-v,t[6]=o*p,t[10]=h*p}else if(e.order==="YZX"){const S=h*p,A=h*v,L=o*p,F=o*v;t[0]=p*x,t[4]=F-S*M,t[8]=L*M+A,t[1]=M,t[5]=h*x,t[9]=-o*x,t[2]=-v*x,t[6]=A*M+L,t[10]=S-F*M}else if(e.order==="XZY"){const S=h*p,A=h*v,L=o*p,F=o*v;t[0]=p*x,t[4]=-M,t[8]=v*x,t[1]=S*M+F,t[5]=h*x,t[9]=A*M-L,t[2]=L*M-A,t[6]=o*x,t[10]=F*M+S}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(Az,e,Cz)}lookAt(e,t,i){const r=this.elements;return $a.subVectors(e,t),$a.lengthSq()===0&&($a.z=1),$a.normalize(),rc.crossVectors(i,$a),rc.lengthSq()===0&&(Math.abs(i.z)===1?$a.x+=1e-4:$a.z+=1e-4,$a.normalize(),rc.crossVectors(i,$a)),rc.normalize(),zg.crossVectors($a,rc),r[0]=rc.x,r[4]=zg.x,r[8]=$a.x,r[1]=rc.y,r[5]=zg.y,r[9]=$a.y,r[2]=rc.z,r[6]=zg.z,r[10]=$a.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const i=e.elements,r=t.elements,l=this.elements,h=i[0],o=i[4],p=i[8],v=i[12],x=i[1],M=i[5],S=i[9],A=i[13],L=i[2],F=i[6],k=i[10],C=i[14],V=i[3],O=i[7],J=i[11],ue=i[15],Y=r[0],Q=r[4],xe=r[8],re=r[12],ee=r[1],Me=r[5],Fe=r[9],Ae=r[13],He=r[2],ot=r[6],ft=r[10],ct=r[14],De=r[3],Je=r[7],tt=r[11],_t=r[15];return l[0]=h*Y+o*ee+p*He+v*De,l[4]=h*Q+o*Me+p*ot+v*Je,l[8]=h*xe+o*Fe+p*ft+v*tt,l[12]=h*re+o*Ae+p*ct+v*_t,l[1]=x*Y+M*ee+S*He+A*De,l[5]=x*Q+M*Me+S*ot+A*Je,l[9]=x*xe+M*Fe+S*ft+A*tt,l[13]=x*re+M*Ae+S*ct+A*_t,l[2]=L*Y+F*ee+k*He+C*De,l[6]=L*Q+F*Me+k*ot+C*Je,l[10]=L*xe+F*Fe+k*ft+C*tt,l[14]=L*re+F*Ae+k*ct+C*_t,l[3]=V*Y+O*ee+J*He+ue*De,l[7]=V*Q+O*Me+J*ot+ue*Je,l[11]=V*xe+O*Fe+J*ft+ue*tt,l[15]=V*re+O*Ae+J*ct+ue*_t,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],i=e[4],r=e[8],l=e[12],h=e[1],o=e[5],p=e[9],v=e[13],x=e[2],M=e[6],S=e[10],A=e[14],L=e[3],F=e[7],k=e[11],C=e[15];return L*(+l*p*M-r*v*M-l*o*S+i*v*S+r*o*A-i*p*A)+F*(+t*p*A-t*v*S+l*h*S-r*h*A+r*v*x-l*p*x)+k*(+t*v*M-t*o*A-l*h*M+i*h*A+l*o*x-i*v*x)+C*(-r*o*x-t*p*M+t*o*S+r*h*M-i*h*S+i*p*x)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,i){const r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=i),this}invert(){const e=this.elements,t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8],M=e[9],S=e[10],A=e[11],L=e[12],F=e[13],k=e[14],C=e[15],V=M*k*v-F*S*v+F*p*A-o*k*A-M*p*C+o*S*C,O=L*S*v-x*k*v-L*p*A+h*k*A+x*p*C-h*S*C,J=x*F*v-L*M*v+L*o*A-h*F*A-x*o*C+h*M*C,ue=L*M*p-x*F*p-L*o*S+h*F*S+x*o*k-h*M*k,Y=t*V+i*O+r*J+l*ue;if(Y===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const Q=1/Y;return e[0]=V*Q,e[1]=(F*S*l-M*k*l-F*r*A+i*k*A+M*r*C-i*S*C)*Q,e[2]=(o*k*l-F*p*l+F*r*v-i*k*v-o*r*C+i*p*C)*Q,e[3]=(M*p*l-o*S*l-M*r*v+i*S*v+o*r*A-i*p*A)*Q,e[4]=O*Q,e[5]=(x*k*l-L*S*l+L*r*A-t*k*A-x*r*C+t*S*C)*Q,e[6]=(L*p*l-h*k*l-L*r*v+t*k*v+h*r*C-t*p*C)*Q,e[7]=(h*S*l-x*p*l+x*r*v-t*S*v-h*r*A+t*p*A)*Q,e[8]=J*Q,e[9]=(L*M*l-x*F*l-L*i*A+t*F*A+x*i*C-t*M*C)*Q,e[10]=(h*F*l-L*o*l+L*i*v-t*F*v-h*i*C+t*o*C)*Q,e[11]=(x*o*l-h*M*l-x*i*v+t*M*v+h*i*A-t*o*A)*Q,e[12]=ue*Q,e[13]=(x*F*r-L*M*r+L*i*S-t*F*S-x*i*k+t*M*k)*Q,e[14]=(L*o*r-h*F*r-L*i*p+t*F*p+h*i*k-t*o*k)*Q,e[15]=(h*M*r-x*o*r+x*i*p-t*M*p-h*i*S+t*o*S)*Q,this}scale(e){const t=this.elements,i=e.x,r=e.y,l=e.z;return t[0]*=i,t[4]*=r,t[8]*=l,t[1]*=i,t[5]*=r,t[9]*=l,t[2]*=i,t[6]*=r,t[10]*=l,t[3]*=i,t[7]*=r,t[11]*=l,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],i=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,i,r))}makeTranslation(e,t,i){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,i,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),i=Math.sin(e);return this.set(1,0,0,0,0,t,-i,0,0,i,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,0,i,0,0,1,0,0,-i,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),i=Math.sin(e);return this.set(t,-i,0,0,i,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const i=Math.cos(t),r=Math.sin(t),l=1-i,h=e.x,o=e.y,p=e.z,v=l*h,x=l*o;return this.set(v*h+i,v*o-r*p,v*p+r*o,0,v*o+r*p,x*o+i,x*p-r*h,0,v*p-r*o,x*p+r*h,l*p*p+i,0,0,0,0,1),this}makeScale(e,t,i){return this.set(e,0,0,0,0,t,0,0,0,0,i,0,0,0,0,1),this}makeShear(e,t,i,r,l,h){return this.set(1,i,l,0,e,1,h,0,t,r,1,0,0,0,0,1),this}compose(e,t,i){const r=this.elements,l=t._x,h=t._y,o=t._z,p=t._w,v=l+l,x=h+h,M=o+o,S=l*v,A=l*x,L=l*M,F=h*x,k=h*M,C=o*M,V=p*v,O=p*x,J=p*M,ue=i.x,Y=i.y,Q=i.z;return r[0]=(1-(F+C))*ue,r[1]=(A+J)*ue,r[2]=(L-O)*ue,r[3]=0,r[4]=(A-J)*Y,r[5]=(1-(S+C))*Y,r[6]=(k+V)*Y,r[7]=0,r[8]=(L+O)*Q,r[9]=(k-V)*Q,r[10]=(1-(S+F))*Q,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}decompose(e,t,i){const r=this.elements;let l=Zh.set(r[0],r[1],r[2]).length();const h=Zh.set(r[4],r[5],r[6]).length(),o=Zh.set(r[8],r[9],r[10]).length();this.determinant()<0&&(l=-l),e.x=r[12],e.y=r[13],e.z=r[14],Bs.copy(this);const v=1/l,x=1/h,M=1/o;return Bs.elements[0]*=v,Bs.elements[1]*=v,Bs.elements[2]*=v,Bs.elements[4]*=x,Bs.elements[5]*=x,Bs.elements[6]*=x,Bs.elements[8]*=M,Bs.elements[9]*=M,Bs.elements[10]*=M,t.setFromRotationMatrix(Bs),i.x=l,i.y=h,i.z=o,this}makePerspective(e,t,i,r,l,h,o=ul){const p=this.elements,v=2*l/(t-e),x=2*l/(i-r),M=(t+e)/(t-e),S=(i+r)/(i-r);let A,L;if(o===ul)A=-(h+l)/(h-l),L=-2*h*l/(h-l);else if(o===ly)A=-h/(h-l),L=-h*l/(h-l);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return p[0]=v,p[4]=0,p[8]=M,p[12]=0,p[1]=0,p[5]=x,p[9]=S,p[13]=0,p[2]=0,p[6]=0,p[10]=A,p[14]=L,p[3]=0,p[7]=0,p[11]=-1,p[15]=0,this}makeOrthographic(e,t,i,r,l,h,o=ul){const p=this.elements,v=1/(t-e),x=1/(i-r),M=1/(h-l),S=(t+e)*v,A=(i+r)*x;let L,F;if(o===ul)L=(h+l)*M,F=-2*M;else if(o===ly)L=l*M,F=-1*M;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return p[0]=2*v,p[4]=0,p[8]=0,p[12]=-S,p[1]=0,p[5]=2*x,p[9]=0,p[13]=-A,p[2]=0,p[6]=0,p[10]=F,p[14]=-L,p[3]=0,p[7]=0,p[11]=0,p[15]=1,this}equals(e){const t=this.elements,i=e.elements;for(let r=0;r<16;r++)if(t[r]!==i[r])return!1;return!0}fromArray(e,t=0){for(let i=0;i<16;i++)this.elements[i]=e[i+t];return this}toArray(e=[],t=0){const i=this.elements;return e[t]=i[0],e[t+1]=i[1],e[t+2]=i[2],e[t+3]=i[3],e[t+4]=i[4],e[t+5]=i[5],e[t+6]=i[6],e[t+7]=i[7],e[t+8]=i[8],e[t+9]=i[9],e[t+10]=i[10],e[t+11]=i[11],e[t+12]=i[12],e[t+13]=i[13],e[t+14]=i[14],e[t+15]=i[15],e}}const Zh=new it,Bs=new wr,Az=new it(0,0,0),Cz=new it(1,1,1),rc=new it,zg=new it,$a=new it,iM=new wr,rM=new $u;class xl{constructor(e=0,t=0,i=0,r=xl.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=i,this._order=r}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,i,r=this._order){return this._x=e,this._y=t,this._z=i,this._order=r,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,i=!0){const r=e.elements,l=r[0],h=r[4],o=r[8],p=r[1],v=r[5],x=r[9],M=r[2],S=r[6],A=r[10];switch(t){case"XYZ":this._y=Math.asin(ra(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-x,A),this._z=Math.atan2(-h,l)):(this._x=Math.atan2(S,v),this._z=0);break;case"YXZ":this._x=Math.asin(-ra(x,-1,1)),Math.abs(x)<.9999999?(this._y=Math.atan2(o,A),this._z=Math.atan2(p,v)):(this._y=Math.atan2(-M,l),this._z=0);break;case"ZXY":this._x=Math.asin(ra(S,-1,1)),Math.abs(S)<.9999999?(this._y=Math.atan2(-M,A),this._z=Math.atan2(-h,v)):(this._y=0,this._z=Math.atan2(p,l));break;case"ZYX":this._y=Math.asin(-ra(M,-1,1)),Math.abs(M)<.9999999?(this._x=Math.atan2(S,A),this._z=Math.atan2(p,l)):(this._x=0,this._z=Math.atan2(-h,v));break;case"YZX":this._z=Math.asin(ra(p,-1,1)),Math.abs(p)<.9999999?(this._x=Math.atan2(-x,v),this._y=Math.atan2(-M,l)):(this._x=0,this._y=Math.atan2(o,A));break;case"XZY":this._z=Math.asin(-ra(h,-1,1)),Math.abs(h)<.9999999?(this._x=Math.atan2(S,v),this._y=Math.atan2(o,l)):(this._x=Math.atan2(-x,A),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,i===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,i){return iM.makeRotationFromQuaternion(e),this.setFromRotationMatrix(iM,t,i)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return rM.setFromEuler(this),this.setFromQuaternion(rM,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}xl.DEFAULT_ORDER="XYZ";class n8{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let Pz=0;const aM=new it,Yh=new $u,Jo=new wr,Fg=new it,F0=new it,Rz=new it,Iz=new $u,sM=new it(1,0,0),oM=new it(0,1,0),lM=new it(0,0,1),cM={type:"added"},kz={type:"removed"},Kh={type:"childadded",child:null},ox={type:"childremoved",child:null};class es extends Ju{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:Pz++}),this.uuid=lf(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=es.DEFAULT_UP.clone();const e=new it,t=new xl,i=new $u,r=new it(1,1,1);function l(){i.setFromEuler(t,!1)}function h(){t.setFromQuaternion(i,void 0,!1)}t._onChange(l),i._onChange(h),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:r},modelViewMatrix:{value:new wr},normalMatrix:{value:new Jn}}),this.matrix=new wr,this.matrixWorld=new wr,this.matrixAutoUpdate=es.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=es.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new n8,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Yh.setFromAxisAngle(e,t),this.quaternion.multiply(Yh),this}rotateOnWorldAxis(e,t){return Yh.setFromAxisAngle(e,t),this.quaternion.premultiply(Yh),this}rotateX(e){return this.rotateOnAxis(sM,e)}rotateY(e){return this.rotateOnAxis(oM,e)}rotateZ(e){return this.rotateOnAxis(lM,e)}translateOnAxis(e,t){return aM.copy(e).applyQuaternion(this.quaternion),this.position.add(aM.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(sM,e)}translateY(e){return this.translateOnAxis(oM,e)}translateZ(e){return this.translateOnAxis(lM,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(Jo.copy(this.matrixWorld).invert())}lookAt(e,t,i){e.isVector3?Fg.copy(e):Fg.set(e,t,i);const r=this.parent;this.updateWorldMatrix(!0,!1),F0.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Jo.lookAt(F0,Fg,this.up):Jo.lookAt(Fg,F0,this.up),this.quaternion.setFromRotationMatrix(Jo),r&&(Jo.extractRotation(r.matrixWorld),Yh.setFromRotationMatrix(Jo),this.quaternion.premultiply(Yh.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(cM),Kh.child=e,this.dispatchEvent(Kh),Kh.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let i=0;i<arguments.length;i++)this.remove(arguments[i]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(kz),ox.child=e,this.dispatchEvent(ox),ox.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),Jo.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),Jo.multiply(e.parent.matrixWorld)),e.applyMatrix4(Jo),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(cM),Kh.child=e,this.dispatchEvent(Kh),Kh.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let i=0,r=this.children.length;i<r;i++){const h=this.children[i].getObjectByProperty(e,t);if(h!==void 0)return h}}getObjectsByProperty(e,t,i=[]){this[e]===t&&i.push(this);const r=this.children;for(let l=0,h=r.length;l<h;l++)r[l].getObjectsByProperty(e,t,i);return i}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(F0,e,Rz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(F0,Iz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let i=0,r=t.length;i<r;i++)t[i].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let i=0,r=t.length;i<r;i++){const l=t[i];(l.matrixWorldAutoUpdate===!0||e===!0)&&l.updateMatrixWorld(e)}}updateWorldMatrix(e,t){const i=this.parent;if(e===!0&&i!==null&&i.matrixWorldAutoUpdate===!0&&i.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0){const r=this.children;for(let l=0,h=r.length;l<h;l++){const o=r[l];o.matrixWorldAutoUpdate===!0&&o.updateWorldMatrix(!1,!0)}}}toJSON(e){const t=e===void 0||typeof e=="string",i={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},i.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const r={};r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.castShadow===!0&&(r.castShadow=!0),this.receiveShadow===!0&&(r.receiveShadow=!0),this.visible===!1&&(r.visible=!1),this.frustumCulled===!1&&(r.frustumCulled=!1),this.renderOrder!==0&&(r.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),r.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(r.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(r.type="BatchedMesh",r.perObjectFrustumCulled=this.perObjectFrustumCulled,r.sortObjects=this.sortObjects,r.drawRanges=this._drawRanges,r.reservedRanges=this._reservedRanges,r.visibility=this._visibility,r.active=this._active,r.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),r.maxGeometryCount=this._maxGeometryCount,r.maxVertexCount=this._maxVertexCount,r.maxIndexCount=this._maxIndexCount,r.geometryInitialized=this._geometryInitialized,r.geometryCount=this._geometryCount,r.matricesTexture=this._matricesTexture.toJSON(e),this.boundingSphere!==null&&(r.boundingSphere={center:r.boundingSphere.center.toArray(),radius:r.boundingSphere.radius}),this.boundingBox!==null&&(r.boundingBox={min:r.boundingBox.min.toArray(),max:r.boundingBox.max.toArray()}));function l(o,p){return o[p.uuid]===void 0&&(o[p.uuid]=p.toJSON(e)),p.uuid}if(this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=l(e.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const p=o.shapes;if(Array.isArray(p))for(let v=0,x=p.length;v<x;v++){const M=p[v];l(e.shapes,M)}else l(e.shapes,p)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(l(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let p=0,v=this.material.length;p<v;p++)o.push(l(e.materials,this.material[p]));r.material=o}else r.material=l(e.materials,this.material);if(this.children.length>0){r.children=[];for(let o=0;o<this.children.length;o++)r.children.push(this.children[o].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(let o=0;o<this.animations.length;o++){const p=this.animations[o];r.animations.push(l(e.animations,p))}}if(t){const o=h(e.geometries),p=h(e.materials),v=h(e.textures),x=h(e.images),M=h(e.shapes),S=h(e.skeletons),A=h(e.animations),L=h(e.nodes);o.length>0&&(i.geometries=o),p.length>0&&(i.materials=p),v.length>0&&(i.textures=v),x.length>0&&(i.images=x),M.length>0&&(i.shapes=M),S.length>0&&(i.skeletons=S),A.length>0&&(i.animations=A),L.length>0&&(i.nodes=L)}return i.object=r,i;function h(o){const p=[];for(const v in o){const x=o[v];delete x.metadata,p.push(x)}return p}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let i=0;i<e.children.length;i++){const r=e.children[i];this.add(r.clone())}return this}}es.DEFAULT_UP=new it(0,1,0);es.DEFAULT_MATRIX_AUTO_UPDATE=!0;es.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const Os=new it,Qo=new it,lx=new it,el=new it,Jh=new it,Qh=new it,uM=new it,cx=new it,ux=new it,hx=new it;class yo{constructor(e=new it,t=new it,i=new it){this.a=e,this.b=t,this.c=i}static getNormal(e,t,i,r){r.subVectors(i,t),Os.subVectors(e,t),r.cross(Os);const l=r.lengthSq();return l>0?r.multiplyScalar(1/Math.sqrt(l)):r.set(0,0,0)}static getBarycoord(e,t,i,r,l){Os.subVectors(r,t),Qo.subVectors(i,t),lx.subVectors(e,t);const h=Os.dot(Os),o=Os.dot(Qo),p=Os.dot(lx),v=Qo.dot(Qo),x=Qo.dot(lx),M=h*v-o*o;if(M===0)return l.set(0,0,0),null;const S=1/M,A=(v*p-o*x)*S,L=(h*x-o*p)*S;return l.set(1-A-L,L,A)}static containsPoint(e,t,i,r){return this.getBarycoord(e,t,i,r,el)===null?!1:el.x>=0&&el.y>=0&&el.x+el.y<=1}static getInterpolation(e,t,i,r,l,h,o,p){return this.getBarycoord(e,t,i,r,el)===null?(p.x=0,p.y=0,"z"in p&&(p.z=0),"w"in p&&(p.w=0),null):(p.setScalar(0),p.addScaledVector(l,el.x),p.addScaledVector(h,el.y),p.addScaledVector(o,el.z),p)}static isFrontFacing(e,t,i,r){return Os.subVectors(i,t),Qo.subVectors(e,t),Os.cross(Qo).dot(r)<0}set(e,t,i){return this.a.copy(e),this.b.copy(t),this.c.copy(i),this}setFromPointsAndIndices(e,t,i,r){return this.a.copy(e[t]),this.b.copy(e[i]),this.c.copy(e[r]),this}setFromAttributeAndIndices(e,t,i,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,i),this.c.fromBufferAttribute(e,r),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return Os.subVectors(this.c,this.b),Qo.subVectors(this.a,this.b),Os.cross(Qo).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return yo.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return yo.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,i,r,l){return yo.getInterpolation(e,this.a,this.b,this.c,t,i,r,l)}containsPoint(e){return yo.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return yo.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const i=this.a,r=this.b,l=this.c;let h,o;Jh.subVectors(r,i),Qh.subVectors(l,i),cx.subVectors(e,i);const p=Jh.dot(cx),v=Qh.dot(cx);if(p<=0&&v<=0)return t.copy(i);ux.subVectors(e,r);const x=Jh.dot(ux),M=Qh.dot(ux);if(x>=0&&M<=x)return t.copy(r);const S=p*M-x*v;if(S<=0&&p>=0&&x<=0)return h=p/(p-x),t.copy(i).addScaledVector(Jh,h);hx.subVectors(e,l);const A=Jh.dot(hx),L=Qh.dot(hx);if(L>=0&&A<=L)return t.copy(l);const F=A*v-p*L;if(F<=0&&v>=0&&L<=0)return o=v/(v-L),t.copy(i).addScaledVector(Qh,o);const k=x*L-A*M;if(k<=0&&M-x>=0&&A-L>=0)return uM.subVectors(l,r),o=(M-x)/(M-x+(A-L)),t.copy(r).addScaledVector(uM,o);const C=1/(k+F+S);return h=F*C,o=S*C,t.copy(i).addScaledVector(Jh,h).addScaledVector(Qh,o)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const i8={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},ac={h:0,s:0,l:0},Ng={h:0,s:0,l:0};function dx(n,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?n+(e-n)*6*t:t<1/2?e:t<2/3?n+(e-n)*6*(2/3-t):n}let Ti=class{constructor(e,t,i){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,i)}set(e,t,i){if(t===void 0&&i===void 0){const r=e;r&&r.isColor?this.copy(r):typeof r=="number"?this.setHex(r):typeof r=="string"&&this.setStyle(r)}else this.setRGB(e,t,i);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=uo){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,Mi.toWorkingColorSpace(this,t),this}setRGB(e,t,i,r=Mi.workingColorSpace){return this.r=e,this.g=t,this.b=i,Mi.toWorkingColorSpace(this,r),this}setHSL(e,t,i,r=Mi.workingColorSpace){if(e=xw(e,1),t=ra(t,0,1),i=ra(i,0,1),t===0)this.r=this.g=this.b=i;else{const l=i<=.5?i*(1+t):i+t-i*t,h=2*i-l;this.r=dx(h,l,e+1/3),this.g=dx(h,l,e),this.b=dx(h,l,e-1/3)}return Mi.toWorkingColorSpace(this,r),this}setStyle(e,t=uo){function i(l){l!==void 0&&parseFloat(l)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let r;if(r=/^(\w+)\(([^\)]*)\)/.exec(e)){let l;const h=r[1],o=r[2];switch(h){case"rgb":case"rgba":if(l=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setRGB(Math.min(255,parseInt(l[1],10))/255,Math.min(255,parseInt(l[2],10))/255,Math.min(255,parseInt(l[3],10))/255,t);if(l=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setRGB(Math.min(100,parseInt(l[1],10))/100,Math.min(100,parseInt(l[2],10))/100,Math.min(100,parseInt(l[3],10))/100,t);break;case"hsl":case"hsla":if(l=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return i(l[4]),this.setHSL(parseFloat(l[1])/360,parseFloat(l[2])/100,parseFloat(l[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(r=/^\#([A-Fa-f\d]+)$/.exec(e)){const l=r[1],h=l.length;if(h===3)return this.setRGB(parseInt(l.charAt(0),16)/15,parseInt(l.charAt(1),16)/15,parseInt(l.charAt(2),16)/15,t);if(h===6)return this.setHex(parseInt(l,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=uo){const i=i8[e.toLowerCase()];return i!==void 0?this.setHex(i,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Nd(e.r),this.g=Nd(e.g),this.b=Nd(e.b),this}copyLinearToSRGB(e){return this.r=Q_(e.r),this.g=Q_(e.g),this.b=Q_(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=uo){return Mi.fromWorkingColorSpace(na.copy(this),e),Math.round(ra(na.r*255,0,255))*65536+Math.round(ra(na.g*255,0,255))*256+Math.round(ra(na.b*255,0,255))}getHexString(e=uo){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=Mi.workingColorSpace){Mi.fromWorkingColorSpace(na.copy(this),t);const i=na.r,r=na.g,l=na.b,h=Math.max(i,r,l),o=Math.min(i,r,l);let p,v;const x=(o+h)/2;if(o===h)p=0,v=0;else{const M=h-o;switch(v=x<=.5?M/(h+o):M/(2-h-o),h){case i:p=(r-l)/M+(r<l?6:0);break;case r:p=(l-i)/M+2;break;case l:p=(i-r)/M+4;break}p/=6}return e.h=p,e.s=v,e.l=x,e}getRGB(e,t=Mi.workingColorSpace){return Mi.fromWorkingColorSpace(na.copy(this),t),e.r=na.r,e.g=na.g,e.b=na.b,e}getStyle(e=uo){Mi.fromWorkingColorSpace(na.copy(this),e);const t=na.r,i=na.g,r=na.b;return e!==uo?`color(${e} ${t.toFixed(3)} ${i.toFixed(3)} ${r.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(i*255)},${Math.round(r*255)})`}offsetHSL(e,t,i){return this.getHSL(ac),this.setHSL(ac.h+e,ac.s+t,ac.l+i)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,i){return this.r=e.r+(t.r-e.r)*i,this.g=e.g+(t.g-e.g)*i,this.b=e.b+(t.b-e.b)*i,this}lerpHSL(e,t){this.getHSL(ac),e.getHSL(Ng);const i=ap(ac.h,Ng.h,t),r=ap(ac.s,Ng.s,t),l=ap(ac.l,Ng.l,t);return this.setHSL(i,r,l),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,i=this.g,r=this.b,l=e.elements;return this.r=l[0]*t+l[3]*i+l[6]*r,this.g=l[1]*t+l[4]*i+l[7]*r,this.b=l[2]*t+l[5]*i+l[8]*r,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}};const na=new Ti;Ti.NAMES=i8;let Dz=0;class Zy extends Ju{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:Dz++}),this.uuid=lf(),this.name="",this.type="Material",this.blending=zd,this.side=Lc,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=V2,this.blendDst=H2,this.blendEquation=Eu,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new Ti(0,0,0),this.blendAlpha=0,this.depthFunc=iy,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Z5,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=jh,this.stencilZFail=jh,this.stencilZPass=jh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBuild(){}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const i=e[t];if(i===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const r=this[t];if(r===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}r&&r.isColor?r.set(i):r&&r.isVector3&&i&&i.isVector3?r.copy(i):this[t]=i}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const i={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.color&&this.color.isColor&&(i.color=this.color.getHex()),this.roughness!==void 0&&(i.roughness=this.roughness),this.metalness!==void 0&&(i.metalness=this.metalness),this.sheen!==void 0&&(i.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(i.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(i.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(i.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(i.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(i.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(i.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(i.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(i.shininess=this.shininess),this.clearcoat!==void 0&&(i.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(i.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(i.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(i.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,i.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.iridescence!==void 0&&(i.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(i.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(i.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(i.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(i.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(i.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(i.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(i.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(i.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(i.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(i.lightMap=this.lightMap.toJSON(e).uuid,i.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(i.aoMap=this.aoMap.toJSON(e).uuid,i.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(i.bumpMap=this.bumpMap.toJSON(e).uuid,i.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(i.normalMap=this.normalMap.toJSON(e).uuid,i.normalMapType=this.normalMapType,i.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(i.displacementMap=this.displacementMap.toJSON(e).uuid,i.displacementScale=this.displacementScale,i.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(i.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(i.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(i.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(i.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(i.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(i.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(i.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(i.combine=this.combine)),this.envMapRotation!==void 0&&(i.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(i.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(i.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(i.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(i.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(i.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(i.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(i.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(i.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(i.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(i.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(i.size=this.size),this.shadowSide!==null&&(i.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(i.sizeAttenuation=this.sizeAttenuation),this.blending!==zd&&(i.blending=this.blending),this.side!==Lc&&(i.side=this.side),this.vertexColors===!0&&(i.vertexColors=!0),this.opacity<1&&(i.opacity=this.opacity),this.transparent===!0&&(i.transparent=!0),this.blendSrc!==V2&&(i.blendSrc=this.blendSrc),this.blendDst!==H2&&(i.blendDst=this.blendDst),this.blendEquation!==Eu&&(i.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(i.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(i.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(i.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(i.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(i.blendAlpha=this.blendAlpha),this.depthFunc!==iy&&(i.depthFunc=this.depthFunc),this.depthTest===!1&&(i.depthTest=this.depthTest),this.depthWrite===!1&&(i.depthWrite=this.depthWrite),this.colorWrite===!1&&(i.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(i.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==Z5&&(i.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(i.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(i.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==jh&&(i.stencilFail=this.stencilFail),this.stencilZFail!==jh&&(i.stencilZFail=this.stencilZFail),this.stencilZPass!==jh&&(i.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(i.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(i.rotation=this.rotation),this.polygonOffset===!0&&(i.polygonOffset=!0),this.polygonOffsetFactor!==0&&(i.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(i.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(i.linewidth=this.linewidth),this.dashSize!==void 0&&(i.dashSize=this.dashSize),this.gapSize!==void 0&&(i.gapSize=this.gapSize),this.scale!==void 0&&(i.scale=this.scale),this.dithering===!0&&(i.dithering=!0),this.alphaTest>0&&(i.alphaTest=this.alphaTest),this.alphaHash===!0&&(i.alphaHash=!0),this.alphaToCoverage===!0&&(i.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(i.premultipliedAlpha=!0),this.forceSinglePass===!0&&(i.forceSinglePass=!0),this.wireframe===!0&&(i.wireframe=!0),this.wireframeLinewidth>1&&(i.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(i.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(i.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(i.flatShading=!0),this.visible===!1&&(i.visible=!1),this.toneMapped===!1&&(i.toneMapped=!1),this.fog===!1&&(i.fog=!1),Object.keys(this.userData).length>0&&(i.userData=this.userData);function r(l){const h=[];for(const o in l){const p=l[o];delete p.metadata,h.push(p)}return h}if(t){const l=r(e.textures),h=r(e.images);l.length>0&&(i.textures=l),h.length>0&&(i.images=h)}return i}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let i=null;if(t!==null){const r=t.length;i=new Array(r);for(let l=0;l!==r;++l)i[l]=t[l].clone()}return this.clippingPlanes=i,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}}class r8 extends Zy{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new Ti(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new xl,this.combine=VA,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const gr=new it,Bg=new $n;class So{constructor(e,t,i=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=i,this.usage=Y5,this._updateRange={offset:0,count:-1},this.updateRanges=[],this.gpuType=_c,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}get updateRange(){return _z("THREE.BufferAttribute: updateRange() is deprecated and will be removed in r169. Use addUpdateRange() instead."),this._updateRange}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,i){e*=this.itemSize,i*=t.itemSize;for(let r=0,l=this.itemSize;r<l;r++)this.array[e+r]=t.array[i+r];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,i=this.count;t<i;t++)Bg.fromBufferAttribute(this,t),Bg.applyMatrix3(e),this.setXY(t,Bg.x,Bg.y);else if(this.itemSize===3)for(let t=0,i=this.count;t<i;t++)gr.fromBufferAttribute(this,t),gr.applyMatrix3(e),this.setXYZ(t,gr.x,gr.y,gr.z);return this}applyMatrix4(e){for(let t=0,i=this.count;t<i;t++)gr.fromBufferAttribute(this,t),gr.applyMatrix4(e),this.setXYZ(t,gr.x,gr.y,gr.z);return this}applyNormalMatrix(e){for(let t=0,i=this.count;t<i;t++)gr.fromBufferAttribute(this,t),gr.applyNormalMatrix(e),this.setXYZ(t,gr.x,gr.y,gr.z);return this}transformDirection(e){for(let t=0,i=this.count;t<i;t++)gr.fromBufferAttribute(this,t),gr.transformDirection(e),this.setXYZ(t,gr.x,gr.y,gr.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let i=this.array[e*this.itemSize+t];return this.normalized&&(i=cd(i,this.array)),i}setComponent(e,t,i){return this.normalized&&(i=ma(i,this.array)),this.array[e*this.itemSize+t]=i,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=cd(t,this.array)),t}setX(e,t){return this.normalized&&(t=ma(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=cd(t,this.array)),t}setY(e,t){return this.normalized&&(t=ma(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=cd(t,this.array)),t}setZ(e,t){return this.normalized&&(t=ma(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=cd(t,this.array)),t}setW(e,t){return this.normalized&&(t=ma(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,i){return e*=this.itemSize,this.normalized&&(t=ma(t,this.array),i=ma(i,this.array)),this.array[e+0]=t,this.array[e+1]=i,this}setXYZ(e,t,i,r){return e*=this.itemSize,this.normalized&&(t=ma(t,this.array),i=ma(i,this.array),r=ma(r,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this}setXYZW(e,t,i,r,l){return e*=this.itemSize,this.normalized&&(t=ma(t,this.array),i=ma(i,this.array),r=ma(r,this.array),l=ma(l,this.array)),this.array[e+0]=t,this.array[e+1]=i,this.array[e+2]=r,this.array[e+3]=l,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Y5&&(e.usage=this.usage),e}}class a8 extends So{constructor(e,t,i){super(new Uint16Array(e),t,i)}}class s8 extends So{constructor(e,t,i){super(new Uint32Array(e),t,i)}}class Mo extends So{constructor(e,t,i){super(new Float32Array(e),t,i)}}let Lz=0;const fs=new wr,fx=new es,ed=new it,Xa=new Zp,N0=new Zp,Rr=new it;class jc extends Ju{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:Lz++}),this.uuid=lf(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(JA(e)?s8:a8)(e,1):this.index=e,this}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,i=0){this.groups.push({start:e,count:t,materialIndex:i})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const i=this.attributes.normal;if(i!==void 0){const l=new Jn().getNormalMatrix(e);i.applyNormalMatrix(l),i.needsUpdate=!0}const r=this.attributes.tangent;return r!==void 0&&(r.transformDirection(e),r.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return fs.makeRotationFromQuaternion(e),this.applyMatrix4(fs),this}rotateX(e){return fs.makeRotationX(e),this.applyMatrix4(fs),this}rotateY(e){return fs.makeRotationY(e),this.applyMatrix4(fs),this}rotateZ(e){return fs.makeRotationZ(e),this.applyMatrix4(fs),this}translate(e,t,i){return fs.makeTranslation(e,t,i),this.applyMatrix4(fs),this}scale(e,t,i){return fs.makeScale(e,t,i),this.applyMatrix4(fs),this}lookAt(e){return fx.lookAt(e),fx.updateMatrix(),this.applyMatrix4(fx.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(ed).negate(),this.translate(ed.x,ed.y,ed.z),this}setFromPoints(e){const t=[];for(let i=0,r=e.length;i<r;i++){const l=e[i];t.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new Mo(t,3)),this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new Zp);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new it(-1/0,-1/0,-1/0),new it(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let i=0,r=t.length;i<r;i++){const l=t[i];Xa.setFromBufferAttribute(l),this.morphTargetsRelative?(Rr.addVectors(this.boundingBox.min,Xa.min),this.boundingBox.expandByPoint(Rr),Rr.addVectors(this.boundingBox.max,Xa.max),this.boundingBox.expandByPoint(Rr)):(this.boundingBox.expandByPoint(Xa.min),this.boundingBox.expandByPoint(Xa.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new bw);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new it,1/0);return}if(e){const i=this.boundingSphere.center;if(Xa.setFromBufferAttribute(e),t)for(let l=0,h=t.length;l<h;l++){const o=t[l];N0.setFromBufferAttribute(o),this.morphTargetsRelative?(Rr.addVectors(Xa.min,N0.min),Xa.expandByPoint(Rr),Rr.addVectors(Xa.max,N0.max),Xa.expandByPoint(Rr)):(Xa.expandByPoint(N0.min),Xa.expandByPoint(N0.max))}Xa.getCenter(i);let r=0;for(let l=0,h=e.count;l<h;l++)Rr.fromBufferAttribute(e,l),r=Math.max(r,i.distanceToSquared(Rr));if(t)for(let l=0,h=t.length;l<h;l++){const o=t[l],p=this.morphTargetsRelative;for(let v=0,x=o.count;v<x;v++)Rr.fromBufferAttribute(o,v),p&&(ed.fromBufferAttribute(e,v),Rr.add(ed)),r=Math.max(r,i.distanceToSquared(Rr))}this.boundingSphere.radius=Math.sqrt(r),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const i=t.position,r=t.normal,l=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new So(new Float32Array(4*i.count),4));const h=this.getAttribute("tangent"),o=[],p=[];for(let xe=0;xe<i.count;xe++)o[xe]=new it,p[xe]=new it;const v=new it,x=new it,M=new it,S=new $n,A=new $n,L=new $n,F=new it,k=new it;function C(xe,re,ee){v.fromBufferAttribute(i,xe),x.fromBufferAttribute(i,re),M.fromBufferAttribute(i,ee),S.fromBufferAttribute(l,xe),A.fromBufferAttribute(l,re),L.fromBufferAttribute(l,ee),x.sub(v),M.sub(v),A.sub(S),L.sub(S);const Me=1/(A.x*L.y-L.x*A.y);isFinite(Me)&&(F.copy(x).multiplyScalar(L.y).addScaledVector(M,-A.y).multiplyScalar(Me),k.copy(M).multiplyScalar(A.x).addScaledVector(x,-L.x).multiplyScalar(Me),o[xe].add(F),o[re].add(F),o[ee].add(F),p[xe].add(k),p[re].add(k),p[ee].add(k))}let V=this.groups;V.length===0&&(V=[{start:0,count:e.count}]);for(let xe=0,re=V.length;xe<re;++xe){const ee=V[xe],Me=ee.start,Fe=ee.count;for(let Ae=Me,He=Me+Fe;Ae<He;Ae+=3)C(e.getX(Ae+0),e.getX(Ae+1),e.getX(Ae+2))}const O=new it,J=new it,ue=new it,Y=new it;function Q(xe){ue.fromBufferAttribute(r,xe),Y.copy(ue);const re=o[xe];O.copy(re),O.sub(ue.multiplyScalar(ue.dot(re))).normalize(),J.crossVectors(Y,re);const Me=J.dot(p[xe])<0?-1:1;h.setXYZW(xe,O.x,O.y,O.z,Me)}for(let xe=0,re=V.length;xe<re;++xe){const ee=V[xe],Me=ee.start,Fe=ee.count;for(let Ae=Me,He=Me+Fe;Ae<He;Ae+=3)Q(e.getX(Ae+0)),Q(e.getX(Ae+1)),Q(e.getX(Ae+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let i=this.getAttribute("normal");if(i===void 0)i=new So(new Float32Array(t.count*3),3),this.setAttribute("normal",i);else for(let S=0,A=i.count;S<A;S++)i.setXYZ(S,0,0,0);const r=new it,l=new it,h=new it,o=new it,p=new it,v=new it,x=new it,M=new it;if(e)for(let S=0,A=e.count;S<A;S+=3){const L=e.getX(S+0),F=e.getX(S+1),k=e.getX(S+2);r.fromBufferAttribute(t,L),l.fromBufferAttribute(t,F),h.fromBufferAttribute(t,k),x.subVectors(h,l),M.subVectors(r,l),x.cross(M),o.fromBufferAttribute(i,L),p.fromBufferAttribute(i,F),v.fromBufferAttribute(i,k),o.add(x),p.add(x),v.add(x),i.setXYZ(L,o.x,o.y,o.z),i.setXYZ(F,p.x,p.y,p.z),i.setXYZ(k,v.x,v.y,v.z)}else for(let S=0,A=t.count;S<A;S+=3)r.fromBufferAttribute(t,S+0),l.fromBufferAttribute(t,S+1),h.fromBufferAttribute(t,S+2),x.subVectors(h,l),M.subVectors(r,l),x.cross(M),i.setXYZ(S+0,x.x,x.y,x.z),i.setXYZ(S+1,x.x,x.y,x.z),i.setXYZ(S+2,x.x,x.y,x.z);this.normalizeNormals(),i.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,i=e.count;t<i;t++)Rr.fromBufferAttribute(e,t),Rr.normalize(),e.setXYZ(t,Rr.x,Rr.y,Rr.z)}toNonIndexed(){function e(o,p){const v=o.array,x=o.itemSize,M=o.normalized,S=new v.constructor(p.length*x);let A=0,L=0;for(let F=0,k=p.length;F<k;F++){o.isInterleavedBufferAttribute?A=p[F]*o.data.stride+o.offset:A=p[F]*x;for(let C=0;C<x;C++)S[L++]=v[A++]}return new So(S,x,M)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new jc,i=this.index.array,r=this.attributes;for(const o in r){const p=r[o],v=e(p,i);t.setAttribute(o,v)}const l=this.morphAttributes;for(const o in l){const p=[],v=l[o];for(let x=0,M=v.length;x<M;x++){const S=v[x],A=e(S,i);p.push(A)}t.morphAttributes[o]=p}t.morphTargetsRelative=this.morphTargetsRelative;const h=this.groups;for(let o=0,p=h.length;o<p;o++){const v=h[o];t.addGroup(v.start,v.count,v.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const p=this.parameters;for(const v in p)p[v]!==void 0&&(e[v]=p[v]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const i=this.attributes;for(const p in i){const v=i[p];e.data.attributes[p]=v.toJSON(e.data)}const r={};let l=!1;for(const p in this.morphAttributes){const v=this.morphAttributes[p],x=[];for(let M=0,S=v.length;M<S;M++){const A=v[M];x.push(A.toJSON(e.data))}x.length>0&&(r[p]=x,l=!0)}l&&(e.data.morphAttributes=r,e.data.morphTargetsRelative=this.morphTargetsRelative);const h=this.groups;h.length>0&&(e.data.groups=JSON.parse(JSON.stringify(h)));const o=this.boundingSphere;return o!==null&&(e.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const i=e.index;i!==null&&this.setIndex(i.clone(t));const r=e.attributes;for(const v in r){const x=r[v];this.setAttribute(v,x.clone(t))}const l=e.morphAttributes;for(const v in l){const x=[],M=l[v];for(let S=0,A=M.length;S<A;S++)x.push(M[S].clone(t));this.morphAttributes[v]=x}this.morphTargetsRelative=e.morphTargetsRelative;const h=e.groups;for(let v=0,x=h.length;v<x;v++){const M=h[v];this.addGroup(M.start,M.count,M.materialIndex)}const o=e.boundingBox;o!==null&&(this.boundingBox=o.clone());const p=e.boundingSphere;return p!==null&&(this.boundingSphere=p.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const hM=new wr,mu=new t8,Og=new bw,dM=new it,td=new it,nd=new it,id=new it,px=new it,Ug=new it,Vg=new $n,Hg=new $n,Gg=new $n,fM=new it,pM=new it,mM=new it,jg=new it,Wg=new it;class Ja extends es{constructor(e=new jc,t=new r8){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,i=Object.keys(t);if(i.length>0){const r=t[i[0]];if(r!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let l=0,h=r.length;l<h;l++){const o=r[l].name||String(l);this.morphTargetInfluences.push(0),this.morphTargetDictionary[o]=l}}}}getVertexPosition(e,t){const i=this.geometry,r=i.attributes.position,l=i.morphAttributes.position,h=i.morphTargetsRelative;t.fromBufferAttribute(r,e);const o=this.morphTargetInfluences;if(l&&o){Ug.set(0,0,0);for(let p=0,v=l.length;p<v;p++){const x=o[p],M=l[p];x!==0&&(px.fromBufferAttribute(M,e),h?Ug.addScaledVector(px,x):Ug.addScaledVector(px.sub(t),x))}t.add(Ug)}return t}raycast(e,t){const i=this.geometry,r=this.material,l=this.matrixWorld;r!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),Og.copy(i.boundingSphere),Og.applyMatrix4(l),mu.copy(e.ray).recast(e.near),!(Og.containsPoint(mu.origin)===!1&&(mu.intersectSphere(Og,dM)===null||mu.origin.distanceToSquared(dM)>(e.far-e.near)**2))&&(hM.copy(l).invert(),mu.copy(e.ray).applyMatrix4(hM),!(i.boundingBox!==null&&mu.intersectsBox(i.boundingBox)===!1)&&this._computeIntersections(e,t,mu)))}_computeIntersections(e,t,i){let r;const l=this.geometry,h=this.material,o=l.index,p=l.attributes.position,v=l.attributes.uv,x=l.attributes.uv1,M=l.attributes.normal,S=l.groups,A=l.drawRange;if(o!==null)if(Array.isArray(h))for(let L=0,F=S.length;L<F;L++){const k=S[L],C=h[k.materialIndex],V=Math.max(k.start,A.start),O=Math.min(o.count,Math.min(k.start+k.count,A.start+A.count));for(let J=V,ue=O;J<ue;J+=3){const Y=o.getX(J),Q=o.getX(J+1),xe=o.getX(J+2);r=qg(this,C,e,i,v,x,M,Y,Q,xe),r&&(r.faceIndex=Math.floor(J/3),r.face.materialIndex=k.materialIndex,t.push(r))}}else{const L=Math.max(0,A.start),F=Math.min(o.count,A.start+A.count);for(let k=L,C=F;k<C;k+=3){const V=o.getX(k),O=o.getX(k+1),J=o.getX(k+2);r=qg(this,h,e,i,v,x,M,V,O,J),r&&(r.faceIndex=Math.floor(k/3),t.push(r))}}else if(p!==void 0)if(Array.isArray(h))for(let L=0,F=S.length;L<F;L++){const k=S[L],C=h[k.materialIndex],V=Math.max(k.start,A.start),O=Math.min(p.count,Math.min(k.start+k.count,A.start+A.count));for(let J=V,ue=O;J<ue;J+=3){const Y=J,Q=J+1,xe=J+2;r=qg(this,C,e,i,v,x,M,Y,Q,xe),r&&(r.faceIndex=Math.floor(J/3),r.face.materialIndex=k.materialIndex,t.push(r))}}else{const L=Math.max(0,A.start),F=Math.min(p.count,A.start+A.count);for(let k=L,C=F;k<C;k+=3){const V=k,O=k+1,J=k+2;r=qg(this,h,e,i,v,x,M,V,O,J),r&&(r.faceIndex=Math.floor(k/3),t.push(r))}}}}function zz(n,e,t,i,r,l,h,o){let p;if(e.side===Fa?p=i.intersectTriangle(h,l,r,!0,o):p=i.intersectTriangle(r,l,h,e.side===Lc,o),p===null)return null;Wg.copy(o),Wg.applyMatrix4(n.matrixWorld);const v=t.ray.origin.distanceTo(Wg);return v<t.near||v>t.far?null:{distance:v,point:Wg.clone(),object:n}}function qg(n,e,t,i,r,l,h,o,p,v){n.getVertexPosition(o,td),n.getVertexPosition(p,nd),n.getVertexPosition(v,id);const x=zz(n,e,t,i,td,nd,id,jg);if(x){r&&(Vg.fromBufferAttribute(r,o),Hg.fromBufferAttribute(r,p),Gg.fromBufferAttribute(r,v),x.uv=yo.getInterpolation(jg,td,nd,id,Vg,Hg,Gg,new $n)),l&&(Vg.fromBufferAttribute(l,o),Hg.fromBufferAttribute(l,p),Gg.fromBufferAttribute(l,v),x.uv1=yo.getInterpolation(jg,td,nd,id,Vg,Hg,Gg,new $n)),h&&(fM.fromBufferAttribute(h,o),pM.fromBufferAttribute(h,p),mM.fromBufferAttribute(h,v),x.normal=yo.getInterpolation(jg,td,nd,id,fM,pM,mM,new it),x.normal.dot(i.direction)>0&&x.normal.multiplyScalar(-1));const M={a:o,b:p,c:v,normal:new it,materialIndex:0};yo.getNormal(td,nd,id,M.normal),x.face=M}return x}class Yp extends jc{constructor(e=1,t=1,i=1,r=1,l=1,h=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:i,widthSegments:r,heightSegments:l,depthSegments:h};const o=this;r=Math.floor(r),l=Math.floor(l),h=Math.floor(h);const p=[],v=[],x=[],M=[];let S=0,A=0;L("z","y","x",-1,-1,i,t,e,h,l,0),L("z","y","x",1,-1,i,t,-e,h,l,1),L("x","z","y",1,1,e,i,t,r,h,2),L("x","z","y",1,-1,e,i,-t,r,h,3),L("x","y","z",1,-1,e,t,i,r,l,4),L("x","y","z",-1,-1,e,t,-i,r,l,5),this.setIndex(p),this.setAttribute("position",new Mo(v,3)),this.setAttribute("normal",new Mo(x,3)),this.setAttribute("uv",new Mo(M,2));function L(F,k,C,V,O,J,ue,Y,Q,xe,re){const ee=J/Q,Me=ue/xe,Fe=J/2,Ae=ue/2,He=Y/2,ot=Q+1,ft=xe+1;let ct=0,De=0;const Je=new it;for(let tt=0;tt<ft;tt++){const _t=tt*Me-Ae;for(let Lt=0;Lt<ot;Lt++){const Cn=Lt*ee-Fe;Je[F]=Cn*V,Je[k]=_t*O,Je[C]=He,v.push(Je.x,Je.y,Je.z),Je[F]=0,Je[k]=0,Je[C]=Y>0?1:-1,x.push(Je.x,Je.y,Je.z),M.push(Lt/Q),M.push(1-tt/xe),ct+=1}}for(let tt=0;tt<xe;tt++)for(let _t=0;_t<Q;_t++){const Lt=S+_t+ot*tt,Cn=S+_t+ot*(tt+1),nt=S+(_t+1)+ot*(tt+1),wt=S+(_t+1)+ot*tt;p.push(Lt,Cn,wt),p.push(Cn,nt,wt),De+=6}o.addGroup(A,De,re),A+=De,S+=ct}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Yp(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Kd(n){const e={};for(const t in n){e[t]={};for(const i in n[t]){const r=n[t][i];r&&(r.isColor||r.isMatrix3||r.isMatrix4||r.isVector2||r.isVector3||r.isVector4||r.isTexture||r.isQuaternion)?r.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][i]=null):e[t][i]=r.clone():Array.isArray(r)?e[t][i]=r.slice():e[t][i]=r}}return e}function ga(n){const e={};for(let t=0;t<n.length;t++){const i=Kd(n[t]);for(const r in i)e[r]=i[r]}return e}function Fz(n){const e=[];for(let t=0;t<n.length;t++)e.push(n[t].clone());return e}function o8(n){const e=n.getRenderTarget();return e===null?n.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:Mi.workingColorSpace}const Nz={clone:Kd,merge:ga};var Bz=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Oz=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class bs extends Zy{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Bz,this.fragmentShader=Oz,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Kd(e.uniforms),this.uniformsGroups=Fz(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const r in this.uniforms){const h=this.uniforms[r].value;h&&h.isTexture?t.uniforms[r]={type:"t",value:h.toJSON(e).uuid}:h&&h.isColor?t.uniforms[r]={type:"c",value:h.getHex()}:h&&h.isVector2?t.uniforms[r]={type:"v2",value:h.toArray()}:h&&h.isVector3?t.uniforms[r]={type:"v3",value:h.toArray()}:h&&h.isVector4?t.uniforms[r]={type:"v4",value:h.toArray()}:h&&h.isMatrix3?t.uniforms[r]={type:"m3",value:h.toArray()}:h&&h.isMatrix4?t.uniforms[r]={type:"m4",value:h.toArray()}:t.uniforms[r]={value:h}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const i={};for(const r in this.extensions)this.extensions[r]===!0&&(i[r]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}class l8 extends es{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new wr,this.projectionMatrix=new wr,this.projectionMatrixInverse=new wr,this.coordinateSystem=ul}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const sc=new it,gM=new $n,yM=new $n;class ys extends l8{constructor(e=50,t=1,i=.1,r=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=i,this.far=r,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=Ip*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(rp*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return Ip*2*Math.atan(Math.tan(rp*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,i){sc.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(sc.x,sc.y).multiplyScalar(-e/sc.z),sc.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),i.set(sc.x,sc.y).multiplyScalar(-e/sc.z)}getViewSize(e,t){return this.getViewBounds(e,gM,yM),t.subVectors(yM,gM)}setViewOffset(e,t,i,r,l,h){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(rp*.5*this.fov)/this.zoom,i=2*t,r=this.aspect*i,l=-.5*r;const h=this.view;if(this.view!==null&&this.view.enabled){const p=h.fullWidth,v=h.fullHeight;l+=h.offsetX*r/p,t-=h.offsetY*i/v,r*=h.width/p,i*=h.height/v}const o=this.filmOffset;o!==0&&(l+=e*o/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+r,t,t-i,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}const rd=-90,ad=1;class Uz extends es{constructor(e,t,i){super(),this.type="CubeCamera",this.renderTarget=i,this.coordinateSystem=null,this.activeMipmapLevel=0;const r=new ys(rd,ad,e,t);r.layers=this.layers,this.add(r);const l=new ys(rd,ad,e,t);l.layers=this.layers,this.add(l);const h=new ys(rd,ad,e,t);h.layers=this.layers,this.add(h);const o=new ys(rd,ad,e,t);o.layers=this.layers,this.add(o);const p=new ys(rd,ad,e,t);p.layers=this.layers,this.add(p);const v=new ys(rd,ad,e,t);v.layers=this.layers,this.add(v)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[i,r,l,h,o,p]=t;for(const v of t)this.remove(v);if(e===ul)i.up.set(0,1,0),i.lookAt(1,0,0),r.up.set(0,1,0),r.lookAt(-1,0,0),l.up.set(0,0,-1),l.lookAt(0,1,0),h.up.set(0,0,1),h.lookAt(0,-1,0),o.up.set(0,1,0),o.lookAt(0,0,1),p.up.set(0,1,0),p.lookAt(0,0,-1);else if(e===ly)i.up.set(0,-1,0),i.lookAt(-1,0,0),r.up.set(0,-1,0),r.lookAt(1,0,0),l.up.set(0,0,1),l.lookAt(0,1,0),h.up.set(0,0,-1),h.lookAt(0,-1,0),o.up.set(0,-1,0),o.lookAt(0,0,1),p.up.set(0,-1,0),p.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const v of t)this.add(v),v.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:i,activeMipmapLevel:r}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[l,h,o,p,v,x]=this.children,M=e.getRenderTarget(),S=e.getActiveCubeFace(),A=e.getActiveMipmapLevel(),L=e.xr.enabled;e.xr.enabled=!1;const F=i.texture.generateMipmaps;i.texture.generateMipmaps=!1,e.setRenderTarget(i,0,r),e.render(t,l),e.setRenderTarget(i,1,r),e.render(t,h),e.setRenderTarget(i,2,r),e.render(t,o),e.setRenderTarget(i,3,r),e.render(t,p),e.setRenderTarget(i,4,r),e.render(t,v),i.texture.generateMipmaps=F,e.setRenderTarget(i,5,r),e.render(t,x),e.setRenderTarget(M,S,A),e.xr.enabled=L,i.texture.needsPMREMUpdate=!0}}class c8 extends xa{constructor(e,t,i,r,l,h,o,p,v,x){e=e!==void 0?e:[],t=t!==void 0?t:Xd,super(e,t,i,r,l,h,o,p,v,x),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class Vz extends qu{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const i={width:e,height:e,depth:1},r=[i,i,i,i,i,i];this.texture=new c8(r,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:$s}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const i={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},r=new Yp(5,5,5),l=new bs({name:"CubemapFromEquirect",uniforms:Kd(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:Fa,blending:Pc});l.uniforms.tEquirect.value=t;const h=new Ja(r,l),o=t.minFilter;return t.minFilter===Lu&&(t.minFilter=$s),new Uz(1,10,this).update(e,h),t.minFilter=o,h.geometry.dispose(),h.material.dispose(),this}clear(e,t,i,r){const l=e.getRenderTarget();for(let h=0;h<6;h++)e.setRenderTarget(this,h),e.clear(t,i,r);e.setRenderTarget(l)}}const mx=new it,Hz=new it,Gz=new Jn;class fc{constructor(e=new it(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,i,r){return this.normal.set(e,t,i),this.constant=r,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,i){const r=mx.subVectors(i,t).cross(Hz.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const i=e.delta(mx),r=this.normal.dot(i);if(r===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const l=-(e.start.dot(this.normal)+this.constant)/r;return l<0||l>1?null:t.copy(e.start).addScaledVector(i,l)}intersectsLine(e){const t=this.distanceToPoint(e.start),i=this.distanceToPoint(e.end);return t<0&&i>0||i<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const i=t||Gz.getNormalMatrix(e),r=this.coplanarPoint(mx).applyMatrix4(e),l=this.normal.applyMatrix3(i).normalize();return this.constant=-r.dot(l),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const gu=new bw,$g=new it;class u8{constructor(e=new fc,t=new fc,i=new fc,r=new fc,l=new fc,h=new fc){this.planes=[e,t,i,r,l,h]}set(e,t,i,r,l,h){const o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(i),o[3].copy(r),o[4].copy(l),o[5].copy(h),this}copy(e){const t=this.planes;for(let i=0;i<6;i++)t[i].copy(e.planes[i]);return this}setFromProjectionMatrix(e,t=ul){const i=this.planes,r=e.elements,l=r[0],h=r[1],o=r[2],p=r[3],v=r[4],x=r[5],M=r[6],S=r[7],A=r[8],L=r[9],F=r[10],k=r[11],C=r[12],V=r[13],O=r[14],J=r[15];if(i[0].setComponents(p-l,S-v,k-A,J-C).normalize(),i[1].setComponents(p+l,S+v,k+A,J+C).normalize(),i[2].setComponents(p+h,S+x,k+L,J+V).normalize(),i[3].setComponents(p-h,S-x,k-L,J-V).normalize(),i[4].setComponents(p-o,S-M,k-F,J-O).normalize(),t===ul)i[5].setComponents(p+o,S+M,k+F,J+O).normalize();else if(t===ly)i[5].setComponents(o,M,F,O).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),gu.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),gu.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(gu)}intersectsSprite(e){return gu.center.set(0,0,0),gu.radius=.7071067811865476,gu.applyMatrix4(e.matrixWorld),this.intersectsSphere(gu)}intersectsSphere(e){const t=this.planes,i=e.center,r=-e.radius;for(let l=0;l<6;l++)if(t[l].distanceToPoint(i)<r)return!1;return!0}intersectsBox(e){const t=this.planes;for(let i=0;i<6;i++){const r=t[i];if($g.x=r.normal.x>0?e.max.x:e.min.x,$g.y=r.normal.y>0?e.max.y:e.min.y,$g.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint($g)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let i=0;i<6;i++)if(t[i].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function h8(){let n=null,e=!1,t=null,i=null;function r(l,h){t(l,h),i=n.requestAnimationFrame(r)}return{start:function(){e!==!0&&t!==null&&(i=n.requestAnimationFrame(r),e=!0)},stop:function(){n.cancelAnimationFrame(i),e=!1},setAnimationLoop:function(l){t=l},setContext:function(l){n=l}}}function jz(n){const e=new WeakMap;function t(o,p){const v=o.array,x=o.usage,M=v.byteLength,S=n.createBuffer();n.bindBuffer(p,S),n.bufferData(p,v,x),o.onUploadCallback();let A;if(v instanceof Float32Array)A=n.FLOAT;else if(v instanceof Uint16Array)o.isFloat16BufferAttribute?A=n.HALF_FLOAT:A=n.UNSIGNED_SHORT;else if(v instanceof Int16Array)A=n.SHORT;else if(v instanceof Uint32Array)A=n.UNSIGNED_INT;else if(v instanceof Int32Array)A=n.INT;else if(v instanceof Int8Array)A=n.BYTE;else if(v instanceof Uint8Array)A=n.UNSIGNED_BYTE;else if(v instanceof Uint8ClampedArray)A=n.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+v);return{buffer:S,type:A,bytesPerElement:v.BYTES_PER_ELEMENT,version:o.version,size:M}}function i(o,p,v){const x=p.array,M=p._updateRange,S=p.updateRanges;if(n.bindBuffer(v,o),M.count===-1&&S.length===0&&n.bufferSubData(v,0,x),S.length!==0){for(let A=0,L=S.length;A<L;A++){const F=S[A];n.bufferSubData(v,F.start*x.BYTES_PER_ELEMENT,x,F.start,F.count)}p.clearUpdateRanges()}M.count!==-1&&(n.bufferSubData(v,M.offset*x.BYTES_PER_ELEMENT,x,M.offset,M.count),M.count=-1),p.onUploadCallback()}function r(o){return o.isInterleavedBufferAttribute&&(o=o.data),e.get(o)}function l(o){o.isInterleavedBufferAttribute&&(o=o.data);const p=e.get(o);p&&(n.deleteBuffer(p.buffer),e.delete(o))}function h(o,p){if(o.isGLBufferAttribute){const x=e.get(o);(!x||x.version<o.version)&&e.set(o,{buffer:o.buffer,type:o.type,bytesPerElement:o.elementSize,version:o.version});return}o.isInterleavedBufferAttribute&&(o=o.data);const v=e.get(o);if(v===void 0)e.set(o,t(o,p));else if(v.version<o.version){if(v.size!==o.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");i(v.buffer,o,p),v.version=o.version}}return{get:r,remove:l,update:h}}class Kp extends jc{constructor(e=1,t=1,i=1,r=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:i,heightSegments:r};const l=e/2,h=t/2,o=Math.floor(i),p=Math.floor(r),v=o+1,x=p+1,M=e/o,S=t/p,A=[],L=[],F=[],k=[];for(let C=0;C<x;C++){const V=C*S-h;for(let O=0;O<v;O++){const J=O*M-l;L.push(J,-V,0),F.push(0,0,1),k.push(O/o),k.push(1-C/p)}}for(let C=0;C<p;C++)for(let V=0;V<o;V++){const O=V+v*C,J=V+v*(C+1),ue=V+1+v*(C+1),Y=V+1+v*C;A.push(O,J,Y),A.push(J,ue,Y)}this.setIndex(A),this.setAttribute("position",new Mo(L,3)),this.setAttribute("normal",new Mo(F,3)),this.setAttribute("uv",new Mo(k,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Kp(e.width,e.height,e.widthSegments,e.heightSegments)}}var Wz=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,qz=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,$z=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,Xz=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,Zz=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,Yz=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,Kz=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,Jz=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,Qz=`#ifdef USE_BATCHING
	attribute float batchId;
	uniform highp sampler2D batchingTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,eF=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( batchId );
#endif`,tF=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,nF=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,iF=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,rF=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,aF=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,sF=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,oF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,lF=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,cF=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,uF=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,hF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,dF=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	varying vec3 vColor;
#endif`,fF=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif`,pF=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float luminance( const in vec3 rgb ) {
	const vec3 weights = vec3( 0.2126729, 0.7151522, 0.0721750 );
	return dot( weights, rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,mF=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,gF=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,yF=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,vF=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,_F=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,xF=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,bF="gl_FragColor = linearToOutputTexel( gl_FragColor );",wF=`
const mat3 LINEAR_SRGB_TO_LINEAR_DISPLAY_P3 = mat3(
	vec3( 0.8224621, 0.177538, 0.0 ),
	vec3( 0.0331941, 0.9668058, 0.0 ),
	vec3( 0.0170827, 0.0723974, 0.9105199 )
);
const mat3 LINEAR_DISPLAY_P3_TO_LINEAR_SRGB = mat3(
	vec3( 1.2249401, - 0.2249404, 0.0 ),
	vec3( - 0.0420569, 1.0420571, 0.0 ),
	vec3( - 0.0196376, - 0.0786361, 1.0982735 )
);
vec4 LinearSRGBToLinearDisplayP3( in vec4 value ) {
	return vec4( value.rgb * LINEAR_SRGB_TO_LINEAR_DISPLAY_P3, value.a );
}
vec4 LinearDisplayP3ToLinearSRGB( in vec4 value ) {
	return vec4( value.rgb * LINEAR_DISPLAY_P3_TO_LINEAR_SRGB, value.a );
}
vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 LinearTosRGB( in vec4 value ) {
	return sRGBTransferOETF( value );
}`,SF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,MF=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,TF=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,EF=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,AF=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,CF=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,PF=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,RF=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,IF=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,kF=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,DF=`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
	vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
	reflectedLight.indirectDiffuse += lightMapIrradiance;
#endif`,LF=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,zF=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,FF=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,NF=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	#if defined ( LEGACY_LIGHTS )
		if ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
			return pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );
		}
		return 1.0;
	#else
		float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
		if ( cutoffDistance > 0.0 ) {
			distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
		}
		return distanceFalloff;
	#endif
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,BF=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,OF=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,UF=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,VF=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,HF=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,GF=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,jF=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,WF=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,qF=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,$F=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,XF=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,ZF=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,YF=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,KF=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,JF=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );
	
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,QF=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,eN=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,tN=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,nN=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,iN=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,rN=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[MORPHTARGETS_COUNT];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,aN=`#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,sN=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
		objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
		objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
		objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
	#endif
#endif`,oN=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
	#endif
	#ifdef MORPHTARGETS_TEXTURE
		#ifndef USE_INSTANCING_MORPH
			uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
		#endif
		uniform sampler2DArray morphTargetsTexture;
		uniform ivec2 morphTargetsTextureSize;
		vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
			int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
			int y = texelIndex / morphTargetsTextureSize.x;
			int x = texelIndex - y * morphTargetsTextureSize.x;
			ivec3 morphUV = ivec3( x, y, morphTargetIndex );
			return texelFetch( morphTargetsTexture, morphUV, 0 );
		}
	#else
		#ifndef USE_MORPHNORMALS
			uniform float morphTargetInfluences[ 8 ];
		#else
			uniform float morphTargetInfluences[ 4 ];
		#endif
	#endif
#endif`,lN=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	#ifdef MORPHTARGETS_TEXTURE
		for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
			if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
		}
	#else
		transformed += morphTarget0 * morphTargetInfluences[ 0 ];
		transformed += morphTarget1 * morphTargetInfluences[ 1 ];
		transformed += morphTarget2 * morphTargetInfluences[ 2 ];
		transformed += morphTarget3 * morphTargetInfluences[ 3 ];
		#ifndef USE_MORPHNORMALS
			transformed += morphTarget4 * morphTargetInfluences[ 4 ];
			transformed += morphTarget5 * morphTargetInfluences[ 5 ];
			transformed += morphTarget6 * morphTargetInfluences[ 6 ];
			transformed += morphTarget7 * morphTargetInfluences[ 7 ];
		#endif
	#endif
#endif`,cN=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,uN=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,hN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,dN=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,fN=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,pN=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,mN=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,gN=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,yN=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,vN=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,_N=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,xN=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec2 packDepthToRG( in highp float v ) {
	return packDepthToRGBA( v ).yx;
}
float unpackRGToDepth( const in highp vec2 v ) {
	return unpackRGBAToDepth( vec4( v.xy, 0.0, 0.0 ) );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,bN=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,wN=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,SN=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,MN=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,TN=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,EN=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,AN=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return shadow;
	}
#endif`,CN=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,PN=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,RN=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,IN=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,kN=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,DN=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,LN=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,zN=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,FN=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,NN=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,BN=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	float startCompression = 0.8 - 0.04;
	float desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min(color.r, min(color.g, color.b));
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max(color.r, max(color.g, color.b));
	if (peak < startCompression) return color;
	float d = 1. - startCompression;
	float newPeak = 1. - d * d / (peak + d - startCompression);
	color *= newPeak / peak;
	float g = 1. - 1. / (desaturation * (peak - newPeak) + 1.);
	return mix(color, newPeak * vec3(1, 1, 1), g);
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,ON=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,UN=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
		vec3 refractedRayExit = position + transmissionRay;
		vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
		vec2 refractionCoords = ndcPos.xy / ndcPos.w;
		refractionCoords += 1.0;
		refractionCoords /= 2.0;
		vec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
		vec3 transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,VN=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,HN=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,GN=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,jN=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const WN=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,qN=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,$N=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,XN=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,ZN=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,YN=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,KN=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,JN=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#endif
}`,QN=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,eB=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,tB=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,nB=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,iB=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,rB=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,aB=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,sB=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,oB=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,lB=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,cB=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,uB=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,hB=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,dB=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,fB=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,pB=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,mB=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,gB=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,yB=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,vB=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,_B=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,xB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,bB=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,wB=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,SB=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,MB=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,Kn={alphahash_fragment:Wz,alphahash_pars_fragment:qz,alphamap_fragment:$z,alphamap_pars_fragment:Xz,alphatest_fragment:Zz,alphatest_pars_fragment:Yz,aomap_fragment:Kz,aomap_pars_fragment:Jz,batching_pars_vertex:Qz,batching_vertex:eF,begin_vertex:tF,beginnormal_vertex:nF,bsdfs:iF,iridescence_fragment:rF,bumpmap_pars_fragment:aF,clipping_planes_fragment:sF,clipping_planes_pars_fragment:oF,clipping_planes_pars_vertex:lF,clipping_planes_vertex:cF,color_fragment:uF,color_pars_fragment:hF,color_pars_vertex:dF,color_vertex:fF,common:pF,cube_uv_reflection_fragment:mF,defaultnormal_vertex:gF,displacementmap_pars_vertex:yF,displacementmap_vertex:vF,emissivemap_fragment:_F,emissivemap_pars_fragment:xF,colorspace_fragment:bF,colorspace_pars_fragment:wF,envmap_fragment:SF,envmap_common_pars_fragment:MF,envmap_pars_fragment:TF,envmap_pars_vertex:EF,envmap_physical_pars_fragment:BF,envmap_vertex:AF,fog_vertex:CF,fog_pars_vertex:PF,fog_fragment:RF,fog_pars_fragment:IF,gradientmap_pars_fragment:kF,lightmap_fragment:DF,lightmap_pars_fragment:LF,lights_lambert_fragment:zF,lights_lambert_pars_fragment:FF,lights_pars_begin:NF,lights_toon_fragment:OF,lights_toon_pars_fragment:UF,lights_phong_fragment:VF,lights_phong_pars_fragment:HF,lights_physical_fragment:GF,lights_physical_pars_fragment:jF,lights_fragment_begin:WF,lights_fragment_maps:qF,lights_fragment_end:$F,logdepthbuf_fragment:XF,logdepthbuf_pars_fragment:ZF,logdepthbuf_pars_vertex:YF,logdepthbuf_vertex:KF,map_fragment:JF,map_pars_fragment:QF,map_particle_fragment:eN,map_particle_pars_fragment:tN,metalnessmap_fragment:nN,metalnessmap_pars_fragment:iN,morphinstance_vertex:rN,morphcolor_vertex:aN,morphnormal_vertex:sN,morphtarget_pars_vertex:oN,morphtarget_vertex:lN,normal_fragment_begin:cN,normal_fragment_maps:uN,normal_pars_fragment:hN,normal_pars_vertex:dN,normal_vertex:fN,normalmap_pars_fragment:pN,clearcoat_normal_fragment_begin:mN,clearcoat_normal_fragment_maps:gN,clearcoat_pars_fragment:yN,iridescence_pars_fragment:vN,opaque_fragment:_N,packing:xN,premultiplied_alpha_fragment:bN,project_vertex:wN,dithering_fragment:SN,dithering_pars_fragment:MN,roughnessmap_fragment:TN,roughnessmap_pars_fragment:EN,shadowmap_pars_fragment:AN,shadowmap_pars_vertex:CN,shadowmap_vertex:PN,shadowmask_pars_fragment:RN,skinbase_vertex:IN,skinning_pars_vertex:kN,skinning_vertex:DN,skinnormal_vertex:LN,specularmap_fragment:zN,specularmap_pars_fragment:FN,tonemapping_fragment:NN,tonemapping_pars_fragment:BN,transmission_fragment:ON,transmission_pars_fragment:UN,uv_pars_fragment:VN,uv_pars_vertex:HN,uv_vertex:GN,worldpos_vertex:jN,background_vert:WN,background_frag:qN,backgroundCube_vert:$N,backgroundCube_frag:XN,cube_vert:ZN,cube_frag:YN,depth_vert:KN,depth_frag:JN,distanceRGBA_vert:QN,distanceRGBA_frag:eB,equirect_vert:tB,equirect_frag:nB,linedashed_vert:iB,linedashed_frag:rB,meshbasic_vert:aB,meshbasic_frag:sB,meshlambert_vert:oB,meshlambert_frag:lB,meshmatcap_vert:cB,meshmatcap_frag:uB,meshnormal_vert:hB,meshnormal_frag:dB,meshphong_vert:fB,meshphong_frag:pB,meshphysical_vert:mB,meshphysical_frag:gB,meshtoon_vert:yB,meshtoon_frag:vB,points_vert:_B,points_frag:xB,shadow_vert:bB,shadow_frag:wB,sprite_vert:SB,sprite_frag:MB},ln={common:{diffuse:{value:new Ti(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Jn}},envmap:{envMap:{value:null},envMapRotation:{value:new Jn},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Jn}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Jn}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Jn},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Jn},normalScale:{value:new $n(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Jn},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Jn}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Jn}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Jn}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Ti(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Ti(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0},uvTransform:{value:new Jn}},sprite:{diffuse:{value:new Ti(16777215)},opacity:{value:1},center:{value:new $n(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Jn},alphaMap:{value:null},alphaMapTransform:{value:new Jn},alphaTest:{value:0}}},ho={basic:{uniforms:ga([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.fog]),vertexShader:Kn.meshbasic_vert,fragmentShader:Kn.meshbasic_frag},lambert:{uniforms:ga([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Ti(0)}}]),vertexShader:Kn.meshlambert_vert,fragmentShader:Kn.meshlambert_frag},phong:{uniforms:ga([ln.common,ln.specularmap,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,ln.lights,{emissive:{value:new Ti(0)},specular:{value:new Ti(1118481)},shininess:{value:30}}]),vertexShader:Kn.meshphong_vert,fragmentShader:Kn.meshphong_frag},standard:{uniforms:ga([ln.common,ln.envmap,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.roughnessmap,ln.metalnessmap,ln.fog,ln.lights,{emissive:{value:new Ti(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:Kn.meshphysical_vert,fragmentShader:Kn.meshphysical_frag},toon:{uniforms:ga([ln.common,ln.aomap,ln.lightmap,ln.emissivemap,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.gradientmap,ln.fog,ln.lights,{emissive:{value:new Ti(0)}}]),vertexShader:Kn.meshtoon_vert,fragmentShader:Kn.meshtoon_frag},matcap:{uniforms:ga([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,ln.fog,{matcap:{value:null}}]),vertexShader:Kn.meshmatcap_vert,fragmentShader:Kn.meshmatcap_frag},points:{uniforms:ga([ln.points,ln.fog]),vertexShader:Kn.points_vert,fragmentShader:Kn.points_frag},dashed:{uniforms:ga([ln.common,ln.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Kn.linedashed_vert,fragmentShader:Kn.linedashed_frag},depth:{uniforms:ga([ln.common,ln.displacementmap]),vertexShader:Kn.depth_vert,fragmentShader:Kn.depth_frag},normal:{uniforms:ga([ln.common,ln.bumpmap,ln.normalmap,ln.displacementmap,{opacity:{value:1}}]),vertexShader:Kn.meshnormal_vert,fragmentShader:Kn.meshnormal_frag},sprite:{uniforms:ga([ln.sprite,ln.fog]),vertexShader:Kn.sprite_vert,fragmentShader:Kn.sprite_frag},background:{uniforms:{uvTransform:{value:new Jn},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:Kn.background_vert,fragmentShader:Kn.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Jn}},vertexShader:Kn.backgroundCube_vert,fragmentShader:Kn.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:Kn.cube_vert,fragmentShader:Kn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Kn.equirect_vert,fragmentShader:Kn.equirect_frag},distanceRGBA:{uniforms:ga([ln.common,ln.displacementmap,{referencePosition:{value:new it},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Kn.distanceRGBA_vert,fragmentShader:Kn.distanceRGBA_frag},shadow:{uniforms:ga([ln.lights,ln.fog,{color:{value:new Ti(0)},opacity:{value:1}}]),vertexShader:Kn.shadow_vert,fragmentShader:Kn.shadow_frag}};ho.physical={uniforms:ga([ho.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Jn},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Jn},clearcoatNormalScale:{value:new $n(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Jn},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Jn},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Jn},sheen:{value:0},sheenColor:{value:new Ti(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Jn},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Jn},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Jn},transmissionSamplerSize:{value:new $n},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Jn},attenuationDistance:{value:0},attenuationColor:{value:new Ti(0)},specularColor:{value:new Ti(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Jn},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Jn},anisotropyVector:{value:new $n},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Jn}}]),vertexShader:Kn.meshphysical_vert,fragmentShader:Kn.meshphysical_frag};const Xg={r:0,b:0,g:0},yu=new xl,TB=new wr;function EB(n,e,t,i,r,l,h){const o=new Ti(0);let p=l===!0?0:1,v,x,M=null,S=0,A=null;function L(k,C){let V=!1,O=C.isScene===!0?C.background:null;O&&O.isTexture&&(O=(C.backgroundBlurriness>0?t:e).get(O)),O===null?F(o,p):O&&O.isColor&&(F(O,1),V=!0);const J=n.xr.getEnvironmentBlendMode();J==="additive"?i.buffers.color.setClear(0,0,0,1,h):J==="alpha-blend"&&i.buffers.color.setClear(0,0,0,0,h),(n.autoClear||V)&&n.clear(n.autoClearColor,n.autoClearDepth,n.autoClearStencil),O&&(O.isCubeTexture||O.mapping===$y)?(x===void 0&&(x=new Ja(new Yp(1,1,1),new bs({name:"BackgroundCubeMaterial",uniforms:Kd(ho.backgroundCube.uniforms),vertexShader:ho.backgroundCube.vertexShader,fragmentShader:ho.backgroundCube.fragmentShader,side:Fa,depthTest:!1,depthWrite:!1,fog:!1})),x.geometry.deleteAttribute("normal"),x.geometry.deleteAttribute("uv"),x.onBeforeRender=function(ue,Y,Q){this.matrixWorld.copyPosition(Q.matrixWorld)},Object.defineProperty(x.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(x)),yu.copy(C.backgroundRotation),yu.x*=-1,yu.y*=-1,yu.z*=-1,O.isCubeTexture&&O.isRenderTargetTexture===!1&&(yu.y*=-1,yu.z*=-1),x.material.uniforms.envMap.value=O,x.material.uniforms.flipEnvMap.value=O.isCubeTexture&&O.isRenderTargetTexture===!1?-1:1,x.material.uniforms.backgroundBlurriness.value=C.backgroundBlurriness,x.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,x.material.uniforms.backgroundRotation.value.setFromMatrix4(TB.makeRotationFromEuler(yu)),x.material.toneMapped=Mi.getTransfer(O.colorSpace)!==Bi,(M!==O||S!==O.version||A!==n.toneMapping)&&(x.material.needsUpdate=!0,M=O,S=O.version,A=n.toneMapping),x.layers.enableAll(),k.unshift(x,x.geometry,x.material,0,0,null)):O&&O.isTexture&&(v===void 0&&(v=new Ja(new Kp(2,2),new bs({name:"BackgroundMaterial",uniforms:Kd(ho.background.uniforms),vertexShader:ho.background.vertexShader,fragmentShader:ho.background.fragmentShader,side:Lc,depthTest:!1,depthWrite:!1,fog:!1})),v.geometry.deleteAttribute("normal"),Object.defineProperty(v.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(v)),v.material.uniforms.t2D.value=O,v.material.uniforms.backgroundIntensity.value=C.backgroundIntensity,v.material.toneMapped=Mi.getTransfer(O.colorSpace)!==Bi,O.matrixAutoUpdate===!0&&O.updateMatrix(),v.material.uniforms.uvTransform.value.copy(O.matrix),(M!==O||S!==O.version||A!==n.toneMapping)&&(v.material.needsUpdate=!0,M=O,S=O.version,A=n.toneMapping),v.layers.enableAll(),k.unshift(v,v.geometry,v.material,0,0,null))}function F(k,C){k.getRGB(Xg,o8(n)),i.buffers.color.setClear(Xg.r,Xg.g,Xg.b,C,h)}return{getClearColor:function(){return o},setClearColor:function(k,C=1){o.set(k),p=C,F(o,p)},getClearAlpha:function(){return p},setClearAlpha:function(k){p=k,F(o,p)},render:L}}function AB(n,e){const t=n.getParameter(n.MAX_VERTEX_ATTRIBS),i={},r=S(null);let l=r,h=!1;function o(ee,Me,Fe,Ae,He){let ot=!1;const ft=M(Ae,Fe,Me);l!==ft&&(l=ft,v(l.object)),ot=A(ee,Ae,Fe,He),ot&&L(ee,Ae,Fe,He),He!==null&&e.update(He,n.ELEMENT_ARRAY_BUFFER),(ot||h)&&(h=!1,J(ee,Me,Fe,Ae),He!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.get(He).buffer))}function p(){return n.createVertexArray()}function v(ee){return n.bindVertexArray(ee)}function x(ee){return n.deleteVertexArray(ee)}function M(ee,Me,Fe){const Ae=Fe.wireframe===!0;let He=i[ee.id];He===void 0&&(He={},i[ee.id]=He);let ot=He[Me.id];ot===void 0&&(ot={},He[Me.id]=ot);let ft=ot[Ae];return ft===void 0&&(ft=S(p()),ot[Ae]=ft),ft}function S(ee){const Me=[],Fe=[],Ae=[];for(let He=0;He<t;He++)Me[He]=0,Fe[He]=0,Ae[He]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Me,enabledAttributes:Fe,attributeDivisors:Ae,object:ee,attributes:{},index:null}}function A(ee,Me,Fe,Ae){const He=l.attributes,ot=Me.attributes;let ft=0;const ct=Fe.getAttributes();for(const De in ct)if(ct[De].location>=0){const tt=He[De];let _t=ot[De];if(_t===void 0&&(De==="instanceMatrix"&&ee.instanceMatrix&&(_t=ee.instanceMatrix),De==="instanceColor"&&ee.instanceColor&&(_t=ee.instanceColor)),tt===void 0||tt.attribute!==_t||_t&&tt.data!==_t.data)return!0;ft++}return l.attributesNum!==ft||l.index!==Ae}function L(ee,Me,Fe,Ae){const He={},ot=Me.attributes;let ft=0;const ct=Fe.getAttributes();for(const De in ct)if(ct[De].location>=0){let tt=ot[De];tt===void 0&&(De==="instanceMatrix"&&ee.instanceMatrix&&(tt=ee.instanceMatrix),De==="instanceColor"&&ee.instanceColor&&(tt=ee.instanceColor));const _t={};_t.attribute=tt,tt&&tt.data&&(_t.data=tt.data),He[De]=_t,ft++}l.attributes=He,l.attributesNum=ft,l.index=Ae}function F(){const ee=l.newAttributes;for(let Me=0,Fe=ee.length;Me<Fe;Me++)ee[Me]=0}function k(ee){C(ee,0)}function C(ee,Me){const Fe=l.newAttributes,Ae=l.enabledAttributes,He=l.attributeDivisors;Fe[ee]=1,Ae[ee]===0&&(n.enableVertexAttribArray(ee),Ae[ee]=1),He[ee]!==Me&&(n.vertexAttribDivisor(ee,Me),He[ee]=Me)}function V(){const ee=l.newAttributes,Me=l.enabledAttributes;for(let Fe=0,Ae=Me.length;Fe<Ae;Fe++)Me[Fe]!==ee[Fe]&&(n.disableVertexAttribArray(Fe),Me[Fe]=0)}function O(ee,Me,Fe,Ae,He,ot,ft){ft===!0?n.vertexAttribIPointer(ee,Me,Fe,He,ot):n.vertexAttribPointer(ee,Me,Fe,Ae,He,ot)}function J(ee,Me,Fe,Ae){F();const He=Ae.attributes,ot=Fe.getAttributes(),ft=Me.defaultAttributeValues;for(const ct in ot){const De=ot[ct];if(De.location>=0){let Je=He[ct];if(Je===void 0&&(ct==="instanceMatrix"&&ee.instanceMatrix&&(Je=ee.instanceMatrix),ct==="instanceColor"&&ee.instanceColor&&(Je=ee.instanceColor)),Je!==void 0){const tt=Je.normalized,_t=Je.itemSize,Lt=e.get(Je);if(Lt===void 0)continue;const Cn=Lt.buffer,nt=Lt.type,wt=Lt.bytesPerElement,Ft=nt===n.INT||nt===n.UNSIGNED_INT||Je.gpuType===jA;if(Je.isInterleavedBufferAttribute){const At=Je.data,gn=At.stride,En=Je.offset;if(At.isInstancedInterleavedBuffer){for(let In=0;In<De.locationSize;In++)C(De.location+In,At.meshPerAttribute);ee.isInstancedMesh!==!0&&Ae._maxInstanceCount===void 0&&(Ae._maxInstanceCount=At.meshPerAttribute*At.count)}else for(let In=0;In<De.locationSize;In++)k(De.location+In);n.bindBuffer(n.ARRAY_BUFFER,Cn);for(let In=0;In<De.locationSize;In++)O(De.location+In,_t/De.locationSize,nt,tt,gn*wt,(En+_t/De.locationSize*In)*wt,Ft)}else{if(Je.isInstancedBufferAttribute){for(let At=0;At<De.locationSize;At++)C(De.location+At,Je.meshPerAttribute);ee.isInstancedMesh!==!0&&Ae._maxInstanceCount===void 0&&(Ae._maxInstanceCount=Je.meshPerAttribute*Je.count)}else for(let At=0;At<De.locationSize;At++)k(De.location+At);n.bindBuffer(n.ARRAY_BUFFER,Cn);for(let At=0;At<De.locationSize;At++)O(De.location+At,_t/De.locationSize,nt,tt,_t*wt,_t/De.locationSize*At*wt,Ft)}}else if(ft!==void 0){const tt=ft[ct];if(tt!==void 0)switch(tt.length){case 2:n.vertexAttrib2fv(De.location,tt);break;case 3:n.vertexAttrib3fv(De.location,tt);break;case 4:n.vertexAttrib4fv(De.location,tt);break;default:n.vertexAttrib1fv(De.location,tt)}}}}V()}function ue(){xe();for(const ee in i){const Me=i[ee];for(const Fe in Me){const Ae=Me[Fe];for(const He in Ae)x(Ae[He].object),delete Ae[He];delete Me[Fe]}delete i[ee]}}function Y(ee){if(i[ee.id]===void 0)return;const Me=i[ee.id];for(const Fe in Me){const Ae=Me[Fe];for(const He in Ae)x(Ae[He].object),delete Ae[He];delete Me[Fe]}delete i[ee.id]}function Q(ee){for(const Me in i){const Fe=i[Me];if(Fe[ee.id]===void 0)continue;const Ae=Fe[ee.id];for(const He in Ae)x(Ae[He].object),delete Ae[He];delete Fe[ee.id]}}function xe(){re(),h=!0,l!==r&&(l=r,v(l.object))}function re(){r.geometry=null,r.program=null,r.wireframe=!1}return{setup:o,reset:xe,resetDefaultState:re,dispose:ue,releaseStatesOfGeometry:Y,releaseStatesOfProgram:Q,initAttributes:F,enableAttribute:k,disableUnusedAttributes:V}}function CB(n,e,t){let i;function r(p){i=p}function l(p,v){n.drawArrays(i,p,v),t.update(v,i,1)}function h(p,v,x){x!==0&&(n.drawArraysInstanced(i,p,v,x),t.update(v,i,x))}function o(p,v,x){if(x===0)return;const M=e.get("WEBGL_multi_draw");if(M===null)for(let S=0;S<x;S++)this.render(p[S],v[S]);else{M.multiDrawArraysWEBGL(i,p,0,v,0,x);let S=0;for(let A=0;A<x;A++)S+=v[A];t.update(S,i,1)}}this.setMode=r,this.render=l,this.renderInstances=h,this.renderMultiDraw=o}function PB(n,e,t){let i;function r(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const O=e.get("EXT_texture_filter_anisotropic");i=n.getParameter(O.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function l(O){if(O==="highp"){if(n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.HIGH_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.HIGH_FLOAT).precision>0)return"highp";O="mediump"}return O==="mediump"&&n.getShaderPrecisionFormat(n.VERTEX_SHADER,n.MEDIUM_FLOAT).precision>0&&n.getShaderPrecisionFormat(n.FRAGMENT_SHADER,n.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let h=t.precision!==void 0?t.precision:"highp";const o=l(h);o!==h&&(console.warn("THREE.WebGLRenderer:",h,"not supported, using",o,"instead."),h=o);const p=t.logarithmicDepthBuffer===!0,v=n.getParameter(n.MAX_TEXTURE_IMAGE_UNITS),x=n.getParameter(n.MAX_VERTEX_TEXTURE_IMAGE_UNITS),M=n.getParameter(n.MAX_TEXTURE_SIZE),S=n.getParameter(n.MAX_CUBE_MAP_TEXTURE_SIZE),A=n.getParameter(n.MAX_VERTEX_ATTRIBS),L=n.getParameter(n.MAX_VERTEX_UNIFORM_VECTORS),F=n.getParameter(n.MAX_VARYING_VECTORS),k=n.getParameter(n.MAX_FRAGMENT_UNIFORM_VECTORS),C=x>0,V=n.getParameter(n.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:r,getMaxPrecision:l,precision:h,logarithmicDepthBuffer:p,maxTextures:v,maxVertexTextures:x,maxTextureSize:M,maxCubemapSize:S,maxAttributes:A,maxVertexUniforms:L,maxVaryings:F,maxFragmentUniforms:k,vertexTextures:C,maxSamples:V}}function RB(n){const e=this;let t=null,i=0,r=!1,l=!1;const h=new fc,o=new Jn,p={value:null,needsUpdate:!1};this.uniform=p,this.numPlanes=0,this.numIntersection=0,this.init=function(M,S){const A=M.length!==0||S||i!==0||r;return r=S,i=M.length,A},this.beginShadows=function(){l=!0,x(null)},this.endShadows=function(){l=!1},this.setGlobalState=function(M,S){t=x(M,S,0)},this.setState=function(M,S,A){const L=M.clippingPlanes,F=M.clipIntersection,k=M.clipShadows,C=n.get(M);if(!r||L===null||L.length===0||l&&!k)l?x(null):v();else{const V=l?0:i,O=V*4;let J=C.clippingState||null;p.value=J,J=x(L,S,O,A);for(let ue=0;ue!==O;++ue)J[ue]=t[ue];C.clippingState=J,this.numIntersection=F?this.numPlanes:0,this.numPlanes+=V}};function v(){p.value!==t&&(p.value=t,p.needsUpdate=i>0),e.numPlanes=i,e.numIntersection=0}function x(M,S,A,L){const F=M!==null?M.length:0;let k=null;if(F!==0){if(k=p.value,L!==!0||k===null){const C=A+F*4,V=S.matrixWorldInverse;o.getNormalMatrix(V),(k===null||k.length<C)&&(k=new Float32Array(C));for(let O=0,J=A;O!==F;++O,J+=4)h.copy(M[O]).applyMatrix4(V,o),h.normal.toArray(k,J),k[J+3]=h.constant}p.value=k,p.needsUpdate=!0}return e.numPlanes=F,e.numIntersection=0,k}}function IB(n){let e=new WeakMap;function t(h,o){return o===G2?h.mapping=Xd:o===j2&&(h.mapping=Zd),h}function i(h){if(h&&h.isTexture){const o=h.mapping;if(o===G2||o===j2)if(e.has(h)){const p=e.get(h).texture;return t(p,h.mapping)}else{const p=h.image;if(p&&p.height>0){const v=new Vz(p.height);return v.fromEquirectangularTexture(n,h),e.set(h,v),h.addEventListener("dispose",r),t(v.texture,h.mapping)}else return null}}return h}function r(h){const o=h.target;o.removeEventListener("dispose",r);const p=e.get(o);p!==void 0&&(e.delete(o),p.dispose())}function l(){e=new WeakMap}return{get:i,dispose:l}}class kB extends l8{constructor(e=-1,t=1,i=1,r=-1,l=.1,h=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=i,this.bottom=r,this.near=l,this.far=h,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,i,r,l,h){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=i,this.view.offsetY=r,this.view.width=l,this.view.height=h,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),i=(this.right+this.left)/2,r=(this.top+this.bottom)/2;let l=i-e,h=i+e,o=r+t,p=r-t;if(this.view!==null&&this.view.enabled){const v=(this.right-this.left)/this.view.fullWidth/this.zoom,x=(this.top-this.bottom)/this.view.fullHeight/this.zoom;l+=v*this.view.offsetX,h=l+v*this.view.width,o-=x*this.view.offsetY,p=o-x*this.view.height}this.projectionMatrix.makeOrthographic(l,h,o,p,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}const Ed=4,vM=[.125,.215,.35,.446,.526,.582],Au=20,gx=new kB,_M=new Ti;let yx=null,vx=0,_x=0,xx=!1;const Mu=(1+Math.sqrt(5))/2,sd=1/Mu,xM=[new it(1,1,1),new it(-1,1,1),new it(1,1,-1),new it(-1,1,-1),new it(0,Mu,sd),new it(0,Mu,-sd),new it(sd,0,Mu),new it(-sd,0,Mu),new it(Mu,sd,0),new it(-Mu,sd,0)];class bM{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,i=.1,r=100){yx=this._renderer.getRenderTarget(),vx=this._renderer.getActiveCubeFace(),_x=this._renderer.getActiveMipmapLevel(),xx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(256);const l=this._allocateTargets();return l.depthBuffer=!0,this._sceneToCubeUV(e,i,r,l),t>0&&this._blur(l,0,0,t),this._applyPMREM(l),this._cleanup(l),l}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=MM(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=SM(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(yx,vx,_x),this._renderer.xr.enabled=xx,e.scissorTest=!1,Zg(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===Xd||e.mapping===Zd?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),yx=this._renderer.getRenderTarget(),vx=this._renderer.getActiveCubeFace(),_x=this._renderer.getActiveMipmapLevel(),xx=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const i=t||this._allocateTargets();return this._textureToCubeUV(e,i),this._applyPMREM(i),this._cleanup(i),i}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,i={magFilter:$s,minFilter:$s,generateMipmaps:!1,type:ry,format:_o,colorSpace:Gc,depthBuffer:!1},r=wM(e,t,i);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=wM(e,t,i);const{_lodMax:l}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=DB(l)),this._blurMaterial=LB(l,e,t)}return r}_compileMaterial(e){const t=new Ja(this._lodPlanes[0],e);this._renderer.compile(t,gx)}_sceneToCubeUV(e,t,i,r){const o=new ys(90,1,t,i),p=[1,-1,1,1,1,1],v=[1,1,1,-1,-1,-1],x=this._renderer,M=x.autoClear,S=x.toneMapping;x.getClearColor(_M),x.toneMapping=Rc,x.autoClear=!1;const A=new r8({name:"PMREM.Background",side:Fa,depthWrite:!1,depthTest:!1}),L=new Ja(new Yp,A);let F=!1;const k=e.background;k?k.isColor&&(A.color.copy(k),e.background=null,F=!0):(A.color.copy(_M),F=!0);for(let C=0;C<6;C++){const V=C%3;V===0?(o.up.set(0,p[C],0),o.lookAt(v[C],0,0)):V===1?(o.up.set(0,0,p[C]),o.lookAt(0,v[C],0)):(o.up.set(0,p[C],0),o.lookAt(0,0,v[C]));const O=this._cubeSize;Zg(r,V*O,C>2?O:0,O,O),x.setRenderTarget(r),F&&x.render(L,o),x.render(e,o)}L.geometry.dispose(),L.material.dispose(),x.toneMapping=S,x.autoClear=M,e.background=k}_textureToCubeUV(e,t){const i=this._renderer,r=e.mapping===Xd||e.mapping===Zd;r?(this._cubemapMaterial===null&&(this._cubemapMaterial=MM()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=SM());const l=r?this._cubemapMaterial:this._equirectMaterial,h=new Ja(this._lodPlanes[0],l),o=l.uniforms;o.envMap.value=e;const p=this._cubeSize;Zg(t,0,0,3*p,2*p),i.setRenderTarget(t),i.render(h,gx)}_applyPMREM(e){const t=this._renderer,i=t.autoClear;t.autoClear=!1;for(let r=1;r<this._lodPlanes.length;r++){const l=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),h=xM[(r-1)%xM.length];this._blur(e,r-1,r,l,h)}t.autoClear=i}_blur(e,t,i,r,l){const h=this._pingPongRenderTarget;this._halfBlur(e,h,t,i,r,"latitudinal",l),this._halfBlur(h,e,i,i,r,"longitudinal",l)}_halfBlur(e,t,i,r,l,h,o){const p=this._renderer,v=this._blurMaterial;h!=="latitudinal"&&h!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const x=3,M=new Ja(this._lodPlanes[r],v),S=v.uniforms,A=this._sizeLods[i]-1,L=isFinite(l)?Math.PI/(2*A):2*Math.PI/(2*Au-1),F=l/L,k=isFinite(l)?1+Math.floor(x*F):Au;k>Au&&console.warn(`sigmaRadians, ${l}, is too large and will clip, as it requested ${k} samples when the maximum is set to ${Au}`);const C=[];let V=0;for(let Q=0;Q<Au;++Q){const xe=Q/F,re=Math.exp(-xe*xe/2);C.push(re),Q===0?V+=re:Q<k&&(V+=2*re)}for(let Q=0;Q<C.length;Q++)C[Q]=C[Q]/V;S.envMap.value=e.texture,S.samples.value=k,S.weights.value=C,S.latitudinal.value=h==="latitudinal",o&&(S.poleAxis.value=o);const{_lodMax:O}=this;S.dTheta.value=L,S.mipInt.value=O-i;const J=this._sizeLods[r],ue=3*J*(r>O-Ed?r-O+Ed:0),Y=4*(this._cubeSize-J);Zg(t,ue,Y,3*J,2*J),p.setRenderTarget(t),p.render(M,gx)}}function DB(n){const e=[],t=[],i=[];let r=n;const l=n-Ed+1+vM.length;for(let h=0;h<l;h++){const o=Math.pow(2,r);t.push(o);let p=1/o;h>n-Ed?p=vM[h-n+Ed-1]:h===0&&(p=0),i.push(p);const v=1/(o-2),x=-v,M=1+v,S=[x,x,M,x,M,M,x,x,M,M,x,M],A=6,L=6,F=3,k=2,C=1,V=new Float32Array(F*L*A),O=new Float32Array(k*L*A),J=new Float32Array(C*L*A);for(let Y=0;Y<A;Y++){const Q=Y%3*2/3-1,xe=Y>2?0:-1,re=[Q,xe,0,Q+2/3,xe,0,Q+2/3,xe+1,0,Q,xe,0,Q+2/3,xe+1,0,Q,xe+1,0];V.set(re,F*L*Y),O.set(S,k*L*Y);const ee=[Y,Y,Y,Y,Y,Y];J.set(ee,C*L*Y)}const ue=new jc;ue.setAttribute("position",new So(V,F)),ue.setAttribute("uv",new So(O,k)),ue.setAttribute("faceIndex",new So(J,C)),e.push(ue),r>Ed&&r--}return{lodPlanes:e,sizeLods:t,sigmas:i}}function wM(n,e,t){const i=new qu(n,e,t);return i.texture.mapping=$y,i.texture.name="PMREM.cubeUv",i.scissorTest=!0,i}function Zg(n,e,t,i,r){n.viewport.set(e,t,i,r),n.scissor.set(e,t,i,r)}function LB(n,e,t){const i=new Float32Array(Au),r=new it(0,1,0);return new bs({name:"SphericalGaussianBlur",defines:{n:Au,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${n}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:i},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:r}},vertexShader:ww(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Pc,depthTest:!1,depthWrite:!1})}function SM(){return new bs({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:ww(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Pc,depthTest:!1,depthWrite:!1})}function MM(){return new bs({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:ww(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Pc,depthTest:!1,depthWrite:!1})}function ww(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function zB(n){let e=new WeakMap,t=null;function i(o){if(o&&o.isTexture){const p=o.mapping,v=p===G2||p===j2,x=p===Xd||p===Zd;if(v||x){let M=e.get(o);const S=M!==void 0?M.texture.pmremVersion:0;if(o.isRenderTargetTexture&&o.pmremVersion!==S)return t===null&&(t=new bM(n)),M=v?t.fromEquirectangular(o,M):t.fromCubemap(o,M),M.texture.pmremVersion=o.pmremVersion,e.set(o,M),M.texture;if(M!==void 0)return M.texture;{const A=o.image;return v&&A&&A.height>0||x&&A&&r(A)?(t===null&&(t=new bM(n)),M=v?t.fromEquirectangular(o):t.fromCubemap(o),M.texture.pmremVersion=o.pmremVersion,e.set(o,M),o.addEventListener("dispose",l),M.texture):null}}}return o}function r(o){let p=0;const v=6;for(let x=0;x<v;x++)o[x]!==void 0&&p++;return p===v}function l(o){const p=o.target;p.removeEventListener("dispose",l);const v=e.get(p);v!==void 0&&(e.delete(p),v.dispose())}function h(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:i,dispose:h}}function FB(n){const e={};function t(i){if(e[i]!==void 0)return e[i];let r;switch(i){case"WEBGL_depth_texture":r=n.getExtension("WEBGL_depth_texture")||n.getExtension("MOZ_WEBGL_depth_texture")||n.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=n.getExtension("EXT_texture_filter_anisotropic")||n.getExtension("MOZ_EXT_texture_filter_anisotropic")||n.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=n.getExtension("WEBGL_compressed_texture_s3tc")||n.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=n.getExtension("WEBGL_compressed_texture_pvrtc")||n.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=n.getExtension(i)}return e[i]=r,r}return{has:function(i){return t(i)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(i){const r=t(i);return r===null&&console.warn("THREE.WebGLRenderer: "+i+" extension not supported."),r}}}function NB(n,e,t,i){const r={},l=new WeakMap;function h(M){const S=M.target;S.index!==null&&e.remove(S.index);for(const L in S.attributes)e.remove(S.attributes[L]);for(const L in S.morphAttributes){const F=S.morphAttributes[L];for(let k=0,C=F.length;k<C;k++)e.remove(F[k])}S.removeEventListener("dispose",h),delete r[S.id];const A=l.get(S);A&&(e.remove(A),l.delete(S)),i.releaseStatesOfGeometry(S),S.isInstancedBufferGeometry===!0&&delete S._maxInstanceCount,t.memory.geometries--}function o(M,S){return r[S.id]===!0||(S.addEventListener("dispose",h),r[S.id]=!0,t.memory.geometries++),S}function p(M){const S=M.attributes;for(const L in S)e.update(S[L],n.ARRAY_BUFFER);const A=M.morphAttributes;for(const L in A){const F=A[L];for(let k=0,C=F.length;k<C;k++)e.update(F[k],n.ARRAY_BUFFER)}}function v(M){const S=[],A=M.index,L=M.attributes.position;let F=0;if(A!==null){const V=A.array;F=A.version;for(let O=0,J=V.length;O<J;O+=3){const ue=V[O+0],Y=V[O+1],Q=V[O+2];S.push(ue,Y,Y,Q,Q,ue)}}else if(L!==void 0){const V=L.array;F=L.version;for(let O=0,J=V.length/3-1;O<J;O+=3){const ue=O+0,Y=O+1,Q=O+2;S.push(ue,Y,Y,Q,Q,ue)}}else return;const k=new(JA(S)?s8:a8)(S,1);k.version=F;const C=l.get(M);C&&e.remove(C),l.set(M,k)}function x(M){const S=l.get(M);if(S){const A=M.index;A!==null&&S.version<A.version&&v(M)}else v(M);return l.get(M)}return{get:o,update:p,getWireframeAttribute:x}}function BB(n,e,t){let i;function r(M){i=M}let l,h;function o(M){l=M.type,h=M.bytesPerElement}function p(M,S){n.drawElements(i,S,l,M*h),t.update(S,i,1)}function v(M,S,A){A!==0&&(n.drawElementsInstanced(i,S,l,M*h,A),t.update(S,i,A))}function x(M,S,A){if(A===0)return;const L=e.get("WEBGL_multi_draw");if(L===null)for(let F=0;F<A;F++)this.render(M[F]/h,S[F]);else{L.multiDrawElementsWEBGL(i,S,0,l,M,0,A);let F=0;for(let k=0;k<A;k++)F+=S[k];t.update(F,i,1)}}this.setMode=r,this.setIndex=o,this.render=p,this.renderInstances=v,this.renderMultiDraw=x}function OB(n){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function i(l,h,o){switch(t.calls++,h){case n.TRIANGLES:t.triangles+=o*(l/3);break;case n.LINES:t.lines+=o*(l/2);break;case n.LINE_STRIP:t.lines+=o*(l-1);break;case n.LINE_LOOP:t.lines+=o*l;break;case n.POINTS:t.points+=o*l;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",h);break}}function r(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:r,update:i}}function UB(n,e,t){const i=new WeakMap,r=new Ur;function l(h,o,p){const v=h.morphTargetInfluences,x=o.morphAttributes.position||o.morphAttributes.normal||o.morphAttributes.color,M=x!==void 0?x.length:0;let S=i.get(o);if(S===void 0||S.count!==M){let ee=function(){xe.dispose(),i.delete(o),o.removeEventListener("dispose",ee)};var A=ee;S!==void 0&&S.texture.dispose();const L=o.morphAttributes.position!==void 0,F=o.morphAttributes.normal!==void 0,k=o.morphAttributes.color!==void 0,C=o.morphAttributes.position||[],V=o.morphAttributes.normal||[],O=o.morphAttributes.color||[];let J=0;L===!0&&(J=1),F===!0&&(J=2),k===!0&&(J=3);let ue=o.attributes.position.count*J,Y=1;ue>e.maxTextureSize&&(Y=Math.ceil(ue/e.maxTextureSize),ue=e.maxTextureSize);const Q=new Float32Array(ue*Y*4*M),xe=new e8(Q,ue,Y,M);xe.type=_c,xe.needsUpdate=!0;const re=J*4;for(let Me=0;Me<M;Me++){const Fe=C[Me],Ae=V[Me],He=O[Me],ot=ue*Y*4*Me;for(let ft=0;ft<Fe.count;ft++){const ct=ft*re;L===!0&&(r.fromBufferAttribute(Fe,ft),Q[ot+ct+0]=r.x,Q[ot+ct+1]=r.y,Q[ot+ct+2]=r.z,Q[ot+ct+3]=0),F===!0&&(r.fromBufferAttribute(Ae,ft),Q[ot+ct+4]=r.x,Q[ot+ct+5]=r.y,Q[ot+ct+6]=r.z,Q[ot+ct+7]=0),k===!0&&(r.fromBufferAttribute(He,ft),Q[ot+ct+8]=r.x,Q[ot+ct+9]=r.y,Q[ot+ct+10]=r.z,Q[ot+ct+11]=He.itemSize===4?r.w:1)}}S={count:M,texture:xe,size:new $n(ue,Y)},i.set(o,S),o.addEventListener("dispose",ee)}if(h.isInstancedMesh===!0&&h.morphTexture!==null)p.getUniforms().setValue(n,"morphTexture",h.morphTexture,t);else{let L=0;for(let k=0;k<v.length;k++)L+=v[k];const F=o.morphTargetsRelative?1:1-L;p.getUniforms().setValue(n,"morphTargetBaseInfluence",F),p.getUniforms().setValue(n,"morphTargetInfluences",v)}p.getUniforms().setValue(n,"morphTargetsTexture",S.texture,t),p.getUniforms().setValue(n,"morphTargetsTextureSize",S.size)}return{update:l}}function VB(n,e,t,i){let r=new WeakMap;function l(p){const v=i.render.frame,x=p.geometry,M=e.get(p,x);if(r.get(M)!==v&&(e.update(M),r.set(M,v)),p.isInstancedMesh&&(p.hasEventListener("dispose",o)===!1&&p.addEventListener("dispose",o),r.get(p)!==v&&(t.update(p.instanceMatrix,n.ARRAY_BUFFER),p.instanceColor!==null&&t.update(p.instanceColor,n.ARRAY_BUFFER),r.set(p,v))),p.isSkinnedMesh){const S=p.skeleton;r.get(S)!==v&&(S.update(),r.set(S,v))}return M}function h(){r=new WeakMap}function o(p){const v=p.target;v.removeEventListener("dispose",o),t.remove(v.instanceMatrix),v.instanceColor!==null&&t.remove(v.instanceColor)}return{update:l,dispose:h}}class d8 extends xa{constructor(e,t,i,r,l,h,o,p,v,x){if(x=x!==void 0?x:Fd,x!==Fd&&x!==Rp)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");i===void 0&&x===Fd&&(i=Yd),i===void 0&&x===Rp&&(i=Xp),super(null,r,l,h,o,p,x,i,v),this.isDepthTexture=!0,this.image={width:e,height:t},this.magFilter=o!==void 0?o:xs,this.minFilter=p!==void 0?p:xs,this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}const f8=new xa,p8=new d8(1,1);p8.compareFunction=KA;const m8=new e8,g8=new Tz,y8=new c8,TM=[],EM=[],AM=new Float32Array(16),CM=new Float32Array(9),PM=new Float32Array(4);function cf(n,e,t){const i=n[0];if(i<=0||i>0)return n;const r=e*t;let l=TM[r];if(l===void 0&&(l=new Float32Array(r),TM[r]=l),e!==0){i.toArray(l,0);for(let h=1,o=0;h!==e;++h)o+=t,n[h].toArray(l,o)}return l}function Sr(n,e){if(n.length!==e.length)return!1;for(let t=0,i=n.length;t<i;t++)if(n[t]!==e[t])return!1;return!0}function Mr(n,e){for(let t=0,i=e.length;t<i;t++)n[t]=e[t]}function Yy(n,e){let t=EM[e];t===void 0&&(t=new Int32Array(e),EM[e]=t);for(let i=0;i!==e;++i)t[i]=n.allocateTextureUnit();return t}function HB(n,e){const t=this.cache;t[0]!==e&&(n.uniform1f(this.addr,e),t[0]=e)}function GB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;n.uniform2fv(this.addr,e),Mr(t,e)}}function jB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(n.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(Sr(t,e))return;n.uniform3fv(this.addr,e),Mr(t,e)}}function WB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;n.uniform4fv(this.addr,e),Mr(t,e)}}function qB(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Sr(t,e))return;n.uniformMatrix2fv(this.addr,!1,e),Mr(t,e)}else{if(Sr(t,i))return;PM.set(i),n.uniformMatrix2fv(this.addr,!1,PM),Mr(t,i)}}function $B(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Sr(t,e))return;n.uniformMatrix3fv(this.addr,!1,e),Mr(t,e)}else{if(Sr(t,i))return;CM.set(i),n.uniformMatrix3fv(this.addr,!1,CM),Mr(t,i)}}function XB(n,e){const t=this.cache,i=e.elements;if(i===void 0){if(Sr(t,e))return;n.uniformMatrix4fv(this.addr,!1,e),Mr(t,e)}else{if(Sr(t,i))return;AM.set(i),n.uniformMatrix4fv(this.addr,!1,AM),Mr(t,i)}}function ZB(n,e){const t=this.cache;t[0]!==e&&(n.uniform1i(this.addr,e),t[0]=e)}function YB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;n.uniform2iv(this.addr,e),Mr(t,e)}}function KB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;n.uniform3iv(this.addr,e),Mr(t,e)}}function JB(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;n.uniform4iv(this.addr,e),Mr(t,e)}}function QB(n,e){const t=this.cache;t[0]!==e&&(n.uniform1ui(this.addr,e),t[0]=e)}function eO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(n.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(Sr(t,e))return;n.uniform2uiv(this.addr,e),Mr(t,e)}}function tO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(n.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(Sr(t,e))return;n.uniform3uiv(this.addr,e),Mr(t,e)}}function nO(n,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(n.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(Sr(t,e))return;n.uniform4uiv(this.addr,e),Mr(t,e)}}function iO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r);const l=this.type===n.SAMPLER_2D_SHADOW?p8:f8;t.setTexture2D(e||l,r)}function rO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture3D(e||g8,r)}function aO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTextureCube(e||y8,r)}function sO(n,e,t){const i=this.cache,r=t.allocateTextureUnit();i[0]!==r&&(n.uniform1i(this.addr,r),i[0]=r),t.setTexture2DArray(e||m8,r)}function oO(n){switch(n){case 5126:return HB;case 35664:return GB;case 35665:return jB;case 35666:return WB;case 35674:return qB;case 35675:return $B;case 35676:return XB;case 5124:case 35670:return ZB;case 35667:case 35671:return YB;case 35668:case 35672:return KB;case 35669:case 35673:return JB;case 5125:return QB;case 36294:return eO;case 36295:return tO;case 36296:return nO;case 35678:case 36198:case 36298:case 36306:case 35682:return iO;case 35679:case 36299:case 36307:return rO;case 35680:case 36300:case 36308:case 36293:return aO;case 36289:case 36303:case 36311:case 36292:return sO}}function lO(n,e){n.uniform1fv(this.addr,e)}function cO(n,e){const t=cf(e,this.size,2);n.uniform2fv(this.addr,t)}function uO(n,e){const t=cf(e,this.size,3);n.uniform3fv(this.addr,t)}function hO(n,e){const t=cf(e,this.size,4);n.uniform4fv(this.addr,t)}function dO(n,e){const t=cf(e,this.size,4);n.uniformMatrix2fv(this.addr,!1,t)}function fO(n,e){const t=cf(e,this.size,9);n.uniformMatrix3fv(this.addr,!1,t)}function pO(n,e){const t=cf(e,this.size,16);n.uniformMatrix4fv(this.addr,!1,t)}function mO(n,e){n.uniform1iv(this.addr,e)}function gO(n,e){n.uniform2iv(this.addr,e)}function yO(n,e){n.uniform3iv(this.addr,e)}function vO(n,e){n.uniform4iv(this.addr,e)}function _O(n,e){n.uniform1uiv(this.addr,e)}function xO(n,e){n.uniform2uiv(this.addr,e)}function bO(n,e){n.uniform3uiv(this.addr,e)}function wO(n,e){n.uniform4uiv(this.addr,e)}function SO(n,e,t){const i=this.cache,r=e.length,l=Yy(t,r);Sr(i,l)||(n.uniform1iv(this.addr,l),Mr(i,l));for(let h=0;h!==r;++h)t.setTexture2D(e[h]||f8,l[h])}function MO(n,e,t){const i=this.cache,r=e.length,l=Yy(t,r);Sr(i,l)||(n.uniform1iv(this.addr,l),Mr(i,l));for(let h=0;h!==r;++h)t.setTexture3D(e[h]||g8,l[h])}function TO(n,e,t){const i=this.cache,r=e.length,l=Yy(t,r);Sr(i,l)||(n.uniform1iv(this.addr,l),Mr(i,l));for(let h=0;h!==r;++h)t.setTextureCube(e[h]||y8,l[h])}function EO(n,e,t){const i=this.cache,r=e.length,l=Yy(t,r);Sr(i,l)||(n.uniform1iv(this.addr,l),Mr(i,l));for(let h=0;h!==r;++h)t.setTexture2DArray(e[h]||m8,l[h])}function AO(n){switch(n){case 5126:return lO;case 35664:return cO;case 35665:return uO;case 35666:return hO;case 35674:return dO;case 35675:return fO;case 35676:return pO;case 5124:case 35670:return mO;case 35667:case 35671:return gO;case 35668:case 35672:return yO;case 35669:case 35673:return vO;case 5125:return _O;case 36294:return xO;case 36295:return bO;case 36296:return wO;case 35678:case 36198:case 36298:case 36306:case 35682:return SO;case 35679:case 36299:case 36307:return MO;case 35680:case 36300:case 36308:case 36293:return TO;case 36289:case 36303:case 36311:case 36292:return EO}}class CO{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.setValue=oO(t.type)}}class PO{constructor(e,t,i){this.id=e,this.addr=i,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=AO(t.type)}}class RO{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,i){const r=this.seq;for(let l=0,h=r.length;l!==h;++l){const o=r[l];o.setValue(e,t[o.id],i)}}}const bx=/(\w+)(\])?(\[|\.)?/g;function RM(n,e){n.seq.push(e),n.map[e.id]=e}function IO(n,e,t){const i=n.name,r=i.length;for(bx.lastIndex=0;;){const l=bx.exec(i),h=bx.lastIndex;let o=l[1];const p=l[2]==="]",v=l[3];if(p&&(o=o|0),v===void 0||v==="["&&h+2===r){RM(t,v===void 0?new CO(o,n,e):new PO(o,n,e));break}else{let M=t.map[o];M===void 0&&(M=new RO(o),RM(t,M)),t=M}}}class M1{constructor(e,t){this.seq=[],this.map={};const i=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let r=0;r<i;++r){const l=e.getActiveUniform(t,r),h=e.getUniformLocation(t,l.name);IO(l,h,this)}}setValue(e,t,i,r){const l=this.map[t];l!==void 0&&l.setValue(e,i,r)}setOptional(e,t,i){const r=t[i];r!==void 0&&this.setValue(e,i,r)}static upload(e,t,i,r){for(let l=0,h=t.length;l!==h;++l){const o=t[l],p=i[o.id];p.needsUpdate!==!1&&o.setValue(e,p.value,r)}}static seqWithValue(e,t){const i=[];for(let r=0,l=e.length;r!==l;++r){const h=e[r];h.id in t&&i.push(h)}return i}}function IM(n,e,t){const i=n.createShader(e);return n.shaderSource(i,t),n.compileShader(i),i}const kO=37297;let DO=0;function LO(n,e){const t=n.split(`
`),i=[],r=Math.max(e-6,0),l=Math.min(e+6,t.length);for(let h=r;h<l;h++){const o=h+1;i.push(`${o===e?">":" "} ${o}: ${t[h]}`)}return i.join(`
`)}function zO(n){const e=Mi.getPrimaries(Mi.workingColorSpace),t=Mi.getPrimaries(n);let i;switch(e===t?i="":e===oy&&t===sy?i="LinearDisplayP3ToLinearSRGB":e===sy&&t===oy&&(i="LinearSRGBToLinearDisplayP3"),n){case Gc:case Xy:return[i,"LinearTransferOETF"];case uo:case _w:return[i,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space:",n),[i,"LinearTransferOETF"]}}function kM(n,e,t){const i=n.getShaderParameter(e,n.COMPILE_STATUS),r=n.getShaderInfoLog(e).trim();if(i&&r==="")return"";const l=/ERROR: 0:(\d+)/.exec(r);if(l){const h=parseInt(l[1]);return t.toUpperCase()+`

`+r+`

`+LO(n.getShaderSource(e),h)}else return r}function FO(n,e){const t=zO(e);return`vec4 ${n}( vec4 value ) { return ${t[0]}( ${t[1]}( value ) ); }`}function NO(n,e){let t;switch(e){case EL:t="Linear";break;case AL:t="Reinhard";break;case CL:t="OptimizedCineon";break;case PL:t="ACESFilmic";break;case IL:t="AgX";break;case kL:t="Neutral";break;case RL:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+n+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}function BO(n){return[n.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",n.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(G0).join(`
`)}function OO(n){const e=[];for(const t in n){const i=n[t];i!==!1&&e.push("#define "+t+" "+i)}return e.join(`
`)}function UO(n,e){const t={},i=n.getProgramParameter(e,n.ACTIVE_ATTRIBUTES);for(let r=0;r<i;r++){const l=n.getActiveAttrib(e,r),h=l.name;let o=1;l.type===n.FLOAT_MAT2&&(o=2),l.type===n.FLOAT_MAT3&&(o=3),l.type===n.FLOAT_MAT4&&(o=4),t[h]={type:l.type,location:n.getAttribLocation(e,h),locationSize:o}}return t}function G0(n){return n!==""}function DM(n,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return n.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function LM(n,e){return n.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const VO=/^[ \t]*#include +<([\w\d./]+)>/gm;function $2(n){return n.replace(VO,GO)}const HO=new Map([["encodings_fragment","colorspace_fragment"],["encodings_pars_fragment","colorspace_pars_fragment"],["output_fragment","opaque_fragment"]]);function GO(n,e){let t=Kn[e];if(t===void 0){const i=HO.get(e);if(i!==void 0)t=Kn[i],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,i);else throw new Error("Can not resolve #include <"+e+">")}return $2(t)}const jO=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function zM(n){return n.replace(jO,WO)}function WO(n,e,t,i){let r="";for(let l=parseInt(e);l<parseInt(t);l++)r+=i.replace(/\[\s*i\s*\]/g,"[ "+l+" ]").replace(/UNROLLED_LOOP_INDEX/g,l);return r}function FM(n){let e=`precision ${n.precision} float;
	precision ${n.precision} int;
	precision ${n.precision} sampler2D;
	precision ${n.precision} samplerCube;
	precision ${n.precision} sampler3D;
	precision ${n.precision} sampler2DArray;
	precision ${n.precision} sampler2DShadow;
	precision ${n.precision} samplerCubeShadow;
	precision ${n.precision} sampler2DArrayShadow;
	precision ${n.precision} isampler2D;
	precision ${n.precision} isampler3D;
	precision ${n.precision} isamplerCube;
	precision ${n.precision} isampler2DArray;
	precision ${n.precision} usampler2D;
	precision ${n.precision} usampler3D;
	precision ${n.precision} usamplerCube;
	precision ${n.precision} usampler2DArray;
	`;return n.precision==="highp"?e+=`
#define HIGH_PRECISION`:n.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:n.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function qO(n){let e="SHADOWMAP_TYPE_BASIC";return n.shadowMapType===UA?e="SHADOWMAP_TYPE_PCF":n.shadowMapType===JD?e="SHADOWMAP_TYPE_PCF_SOFT":n.shadowMapType===il&&(e="SHADOWMAP_TYPE_VSM"),e}function $O(n){let e="ENVMAP_TYPE_CUBE";if(n.envMap)switch(n.envMapMode){case Xd:case Zd:e="ENVMAP_TYPE_CUBE";break;case $y:e="ENVMAP_TYPE_CUBE_UV";break}return e}function XO(n){let e="ENVMAP_MODE_REFLECTION";if(n.envMap)switch(n.envMapMode){case Zd:e="ENVMAP_MODE_REFRACTION";break}return e}function ZO(n){let e="ENVMAP_BLENDING_NONE";if(n.envMap)switch(n.combine){case VA:e="ENVMAP_BLENDING_MULTIPLY";break;case ML:e="ENVMAP_BLENDING_MIX";break;case TL:e="ENVMAP_BLENDING_ADD";break}return e}function YO(n){const e=n.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,i=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:i,maxMip:t}}function KO(n,e,t,i){const r=n.getContext(),l=t.defines;let h=t.vertexShader,o=t.fragmentShader;const p=qO(t),v=$O(t),x=XO(t),M=ZO(t),S=YO(t),A=BO(t),L=OO(l),F=r.createProgram();let k,C,V=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(k=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,L].filter(G0).join(`
`),k.length>0&&(k+=`
`),C=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,L].filter(G0).join(`
`),C.length>0&&(C+=`
`)):(k=[FM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,L,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+x:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(G0).join(`
`),C=[FM(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,L,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+v:"",t.envMap?"#define "+x:"",t.envMap?"#define "+M:"",S?"#define CUBEUV_TEXEL_WIDTH "+S.texelWidth:"",S?"#define CUBEUV_TEXEL_HEIGHT "+S.texelHeight:"",S?"#define CUBEUV_MAX_MIP "+S.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+p:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.useLegacyLights?"#define LEGACY_LIGHTS":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Rc?"#define TONE_MAPPING":"",t.toneMapping!==Rc?Kn.tonemapping_pars_fragment:"",t.toneMapping!==Rc?NO("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",Kn.colorspace_pars_fragment,FO("linearToOutputTexel",t.outputColorSpace),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(G0).join(`
`)),h=$2(h),h=DM(h,t),h=LM(h,t),o=$2(o),o=DM(o,t),o=LM(o,t),h=zM(h),o=zM(o),t.isRawShaderMaterial!==!0&&(V=`#version 300 es
`,k=[A,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+k,C=["#define varying in",t.glslVersion===K5?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===K5?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+C);const O=V+k+h,J=V+C+o,ue=IM(r,r.VERTEX_SHADER,O),Y=IM(r,r.FRAGMENT_SHADER,J);r.attachShader(F,ue),r.attachShader(F,Y),t.index0AttributeName!==void 0?r.bindAttribLocation(F,0,t.index0AttributeName):t.morphTargets===!0&&r.bindAttribLocation(F,0,"position"),r.linkProgram(F);function Q(Me){if(n.debug.checkShaderErrors){const Fe=r.getProgramInfoLog(F).trim(),Ae=r.getShaderInfoLog(ue).trim(),He=r.getShaderInfoLog(Y).trim();let ot=!0,ft=!0;if(r.getProgramParameter(F,r.LINK_STATUS)===!1)if(ot=!1,typeof n.debug.onShaderError=="function")n.debug.onShaderError(r,F,ue,Y);else{const ct=kM(r,ue,"vertex"),De=kM(r,Y,"fragment");console.error("THREE.WebGLProgram: Shader Error "+r.getError()+" - VALIDATE_STATUS "+r.getProgramParameter(F,r.VALIDATE_STATUS)+`

Material Name: `+Me.name+`
Material Type: `+Me.type+`

Program Info Log: `+Fe+`
`+ct+`
`+De)}else Fe!==""?console.warn("THREE.WebGLProgram: Program Info Log:",Fe):(Ae===""||He==="")&&(ft=!1);ft&&(Me.diagnostics={runnable:ot,programLog:Fe,vertexShader:{log:Ae,prefix:k},fragmentShader:{log:He,prefix:C}})}r.deleteShader(ue),r.deleteShader(Y),xe=new M1(r,F),re=UO(r,F)}let xe;this.getUniforms=function(){return xe===void 0&&Q(this),xe};let re;this.getAttributes=function(){return re===void 0&&Q(this),re};let ee=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return ee===!1&&(ee=r.getProgramParameter(F,kO)),ee},this.destroy=function(){i.releaseStatesOfProgram(this),r.deleteProgram(F),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=DO++,this.cacheKey=e,this.usedTimes=1,this.program=F,this.vertexShader=ue,this.fragmentShader=Y,this}let JO=0;class QO{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,i=e.fragmentShader,r=this._getShaderStage(t),l=this._getShaderStage(i),h=this._getShaderCacheForMaterial(e);return h.has(r)===!1&&(h.add(r),r.usedTimes++),h.has(l)===!1&&(h.add(l),l.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const i of t)i.usedTimes--,i.usedTimes===0&&this.shaderCache.delete(i.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let i=t.get(e);return i===void 0&&(i=new Set,t.set(e,i)),i}_getShaderStage(e){const t=this.shaderCache;let i=t.get(e);return i===void 0&&(i=new eU(e),t.set(e,i)),i}}class eU{constructor(e){this.id=JO++,this.code=e,this.usedTimes=0}}function tU(n,e,t,i,r,l,h){const o=new n8,p=new QO,v=new Set,x=[],M=r.logarithmicDepthBuffer,S=r.vertexTextures;let A=r.precision;const L={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function F(re){return v.add(re),re===0?"uv":`uv${re}`}function k(re,ee,Me,Fe,Ae){const He=Fe.fog,ot=Ae.geometry,ft=re.isMeshStandardMaterial?Fe.environment:null,ct=(re.isMeshStandardMaterial?t:e).get(re.envMap||ft),De=ct&&ct.mapping===$y?ct.image.height:null,Je=L[re.type];re.precision!==null&&(A=r.getMaxPrecision(re.precision),A!==re.precision&&console.warn("THREE.WebGLProgram.getParameters:",re.precision,"not supported, using",A,"instead."));const tt=ot.morphAttributes.position||ot.morphAttributes.normal||ot.morphAttributes.color,_t=tt!==void 0?tt.length:0;let Lt=0;ot.morphAttributes.position!==void 0&&(Lt=1),ot.morphAttributes.normal!==void 0&&(Lt=2),ot.morphAttributes.color!==void 0&&(Lt=3);let Cn,nt,wt,Ft;if(Je){const ne=ho[Je];Cn=ne.vertexShader,nt=ne.fragmentShader}else Cn=re.vertexShader,nt=re.fragmentShader,p.update(re),wt=p.getVertexShaderID(re),Ft=p.getFragmentShaderID(re);const At=n.getRenderTarget(),gn=Ae.isInstancedMesh===!0,En=Ae.isBatchedMesh===!0,In=!!re.map,je=!!re.matcap,An=!!ct,yn=!!re.aoMap,Qn=!!re.lightMap,Yt=!!re.bumpMap,Gn=!!re.normalMap,ie=!!re.displacementMap,le=!!re.emissiveMap,st=!!re.metalnessMap,rt=!!re.roughnessMap,mt=re.anisotropy>0,St=re.clearcoat>0,_n=re.iridescence>0,Mt=re.sheen>0,hn=re.transmission>0,xn=mt&&!!re.anisotropyMap,Nt=St&&!!re.clearcoatMap,an=St&&!!re.clearcoatNormalMap,at=St&&!!re.clearcoatRoughnessMap,tn=_n&&!!re.iridescenceMap,Kt=_n&&!!re.iridescenceThicknessMap,On=Mt&&!!re.sheenColorMap,Un=Mt&&!!re.sheenRoughnessMap,dt=!!re.specularMap,Ht=!!re.specularColorMap,jt=!!re.specularIntensityMap,Jt=hn&&!!re.transmissionMap,X=hn&&!!re.thicknessMap,Oe=!!re.gradientMap,pt=!!re.alphaMap,Dt=re.alphaTest>0,ce=!!re.alphaHash,B=!!re.extensions;let U=Rc;re.toneMapped&&(At===null||At.isXRRenderTarget===!0)&&(U=n.toneMapping);const q={shaderID:Je,shaderType:re.type,shaderName:re.name,vertexShader:Cn,fragmentShader:nt,defines:re.defines,customVertexShaderID:wt,customFragmentShaderID:Ft,isRawShaderMaterial:re.isRawShaderMaterial===!0,glslVersion:re.glslVersion,precision:A,batching:En,instancing:gn,instancingColor:gn&&Ae.instanceColor!==null,instancingMorph:gn&&Ae.morphTexture!==null,supportsVertexTextures:S,outputColorSpace:At===null?n.outputColorSpace:At.isXRRenderTarget===!0?At.texture.colorSpace:Gc,alphaToCoverage:!!re.alphaToCoverage,map:In,matcap:je,envMap:An,envMapMode:An&&ct.mapping,envMapCubeUVHeight:De,aoMap:yn,lightMap:Qn,bumpMap:Yt,normalMap:Gn,displacementMap:S&&ie,emissiveMap:le,normalMapObjectSpace:Gn&&re.normalMapType===$L,normalMapTangentSpace:Gn&&re.normalMapType===qL,metalnessMap:st,roughnessMap:rt,anisotropy:mt,anisotropyMap:xn,clearcoat:St,clearcoatMap:Nt,clearcoatNormalMap:an,clearcoatRoughnessMap:at,iridescence:_n,iridescenceMap:tn,iridescenceThicknessMap:Kt,sheen:Mt,sheenColorMap:On,sheenRoughnessMap:Un,specularMap:dt,specularColorMap:Ht,specularIntensityMap:jt,transmission:hn,transmissionMap:Jt,thicknessMap:X,gradientMap:Oe,opaque:re.transparent===!1&&re.blending===zd&&re.alphaToCoverage===!1,alphaMap:pt,alphaTest:Dt,alphaHash:ce,combine:re.combine,mapUv:In&&F(re.map.channel),aoMapUv:yn&&F(re.aoMap.channel),lightMapUv:Qn&&F(re.lightMap.channel),bumpMapUv:Yt&&F(re.bumpMap.channel),normalMapUv:Gn&&F(re.normalMap.channel),displacementMapUv:ie&&F(re.displacementMap.channel),emissiveMapUv:le&&F(re.emissiveMap.channel),metalnessMapUv:st&&F(re.metalnessMap.channel),roughnessMapUv:rt&&F(re.roughnessMap.channel),anisotropyMapUv:xn&&F(re.anisotropyMap.channel),clearcoatMapUv:Nt&&F(re.clearcoatMap.channel),clearcoatNormalMapUv:an&&F(re.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:at&&F(re.clearcoatRoughnessMap.channel),iridescenceMapUv:tn&&F(re.iridescenceMap.channel),iridescenceThicknessMapUv:Kt&&F(re.iridescenceThicknessMap.channel),sheenColorMapUv:On&&F(re.sheenColorMap.channel),sheenRoughnessMapUv:Un&&F(re.sheenRoughnessMap.channel),specularMapUv:dt&&F(re.specularMap.channel),specularColorMapUv:Ht&&F(re.specularColorMap.channel),specularIntensityMapUv:jt&&F(re.specularIntensityMap.channel),transmissionMapUv:Jt&&F(re.transmissionMap.channel),thicknessMapUv:X&&F(re.thicknessMap.channel),alphaMapUv:pt&&F(re.alphaMap.channel),vertexTangents:!!ot.attributes.tangent&&(Gn||mt),vertexColors:re.vertexColors,vertexAlphas:re.vertexColors===!0&&!!ot.attributes.color&&ot.attributes.color.itemSize===4,pointsUvs:Ae.isPoints===!0&&!!ot.attributes.uv&&(In||pt),fog:!!He,useFog:re.fog===!0,fogExp2:!!He&&He.isFogExp2,flatShading:re.flatShading===!0,sizeAttenuation:re.sizeAttenuation===!0,logarithmicDepthBuffer:M,skinning:Ae.isSkinnedMesh===!0,morphTargets:ot.morphAttributes.position!==void 0,morphNormals:ot.morphAttributes.normal!==void 0,morphColors:ot.morphAttributes.color!==void 0,morphTargetsCount:_t,morphTextureStride:Lt,numDirLights:ee.directional.length,numPointLights:ee.point.length,numSpotLights:ee.spot.length,numSpotLightMaps:ee.spotLightMap.length,numRectAreaLights:ee.rectArea.length,numHemiLights:ee.hemi.length,numDirLightShadows:ee.directionalShadowMap.length,numPointLightShadows:ee.pointShadowMap.length,numSpotLightShadows:ee.spotShadowMap.length,numSpotLightShadowsWithMaps:ee.numSpotLightShadowsWithMaps,numLightProbes:ee.numLightProbes,numClippingPlanes:h.numPlanes,numClipIntersection:h.numIntersection,dithering:re.dithering,shadowMapEnabled:n.shadowMap.enabled&&Me.length>0,shadowMapType:n.shadowMap.type,toneMapping:U,useLegacyLights:n._useLegacyLights,decodeVideoTexture:In&&re.map.isVideoTexture===!0&&Mi.getTransfer(re.map.colorSpace)===Bi,premultipliedAlpha:re.premultipliedAlpha,doubleSided:re.side===go,flipSided:re.side===Fa,useDepthPacking:re.depthPacking>=0,depthPacking:re.depthPacking||0,index0AttributeName:re.index0AttributeName,extensionClipCullDistance:B&&re.extensions.clipCullDistance===!0&&i.has("WEBGL_clip_cull_distance"),extensionMultiDraw:B&&re.extensions.multiDraw===!0&&i.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:i.has("KHR_parallel_shader_compile"),customProgramCacheKey:re.customProgramCacheKey()};return q.vertexUv1s=v.has(1),q.vertexUv2s=v.has(2),q.vertexUv3s=v.has(3),v.clear(),q}function C(re){const ee=[];if(re.shaderID?ee.push(re.shaderID):(ee.push(re.customVertexShaderID),ee.push(re.customFragmentShaderID)),re.defines!==void 0)for(const Me in re.defines)ee.push(Me),ee.push(re.defines[Me]);return re.isRawShaderMaterial===!1&&(V(ee,re),O(ee,re),ee.push(n.outputColorSpace)),ee.push(re.customProgramCacheKey),ee.join()}function V(re,ee){re.push(ee.precision),re.push(ee.outputColorSpace),re.push(ee.envMapMode),re.push(ee.envMapCubeUVHeight),re.push(ee.mapUv),re.push(ee.alphaMapUv),re.push(ee.lightMapUv),re.push(ee.aoMapUv),re.push(ee.bumpMapUv),re.push(ee.normalMapUv),re.push(ee.displacementMapUv),re.push(ee.emissiveMapUv),re.push(ee.metalnessMapUv),re.push(ee.roughnessMapUv),re.push(ee.anisotropyMapUv),re.push(ee.clearcoatMapUv),re.push(ee.clearcoatNormalMapUv),re.push(ee.clearcoatRoughnessMapUv),re.push(ee.iridescenceMapUv),re.push(ee.iridescenceThicknessMapUv),re.push(ee.sheenColorMapUv),re.push(ee.sheenRoughnessMapUv),re.push(ee.specularMapUv),re.push(ee.specularColorMapUv),re.push(ee.specularIntensityMapUv),re.push(ee.transmissionMapUv),re.push(ee.thicknessMapUv),re.push(ee.combine),re.push(ee.fogExp2),re.push(ee.sizeAttenuation),re.push(ee.morphTargetsCount),re.push(ee.morphAttributeCount),re.push(ee.numDirLights),re.push(ee.numPointLights),re.push(ee.numSpotLights),re.push(ee.numSpotLightMaps),re.push(ee.numHemiLights),re.push(ee.numRectAreaLights),re.push(ee.numDirLightShadows),re.push(ee.numPointLightShadows),re.push(ee.numSpotLightShadows),re.push(ee.numSpotLightShadowsWithMaps),re.push(ee.numLightProbes),re.push(ee.shadowMapType),re.push(ee.toneMapping),re.push(ee.numClippingPlanes),re.push(ee.numClipIntersection),re.push(ee.depthPacking)}function O(re,ee){o.disableAll(),ee.supportsVertexTextures&&o.enable(0),ee.instancing&&o.enable(1),ee.instancingColor&&o.enable(2),ee.instancingMorph&&o.enable(3),ee.matcap&&o.enable(4),ee.envMap&&o.enable(5),ee.normalMapObjectSpace&&o.enable(6),ee.normalMapTangentSpace&&o.enable(7),ee.clearcoat&&o.enable(8),ee.iridescence&&o.enable(9),ee.alphaTest&&o.enable(10),ee.vertexColors&&o.enable(11),ee.vertexAlphas&&o.enable(12),ee.vertexUv1s&&o.enable(13),ee.vertexUv2s&&o.enable(14),ee.vertexUv3s&&o.enable(15),ee.vertexTangents&&o.enable(16),ee.anisotropy&&o.enable(17),ee.alphaHash&&o.enable(18),ee.batching&&o.enable(19),re.push(o.mask),o.disableAll(),ee.fog&&o.enable(0),ee.useFog&&o.enable(1),ee.flatShading&&o.enable(2),ee.logarithmicDepthBuffer&&o.enable(3),ee.skinning&&o.enable(4),ee.morphTargets&&o.enable(5),ee.morphNormals&&o.enable(6),ee.morphColors&&o.enable(7),ee.premultipliedAlpha&&o.enable(8),ee.shadowMapEnabled&&o.enable(9),ee.useLegacyLights&&o.enable(10),ee.doubleSided&&o.enable(11),ee.flipSided&&o.enable(12),ee.useDepthPacking&&o.enable(13),ee.dithering&&o.enable(14),ee.transmission&&o.enable(15),ee.sheen&&o.enable(16),ee.opaque&&o.enable(17),ee.pointsUvs&&o.enable(18),ee.decodeVideoTexture&&o.enable(19),ee.alphaToCoverage&&o.enable(20),re.push(o.mask)}function J(re){const ee=L[re.type];let Me;if(ee){const Fe=ho[ee];Me=Nz.clone(Fe.uniforms)}else Me=re.uniforms;return Me}function ue(re,ee){let Me;for(let Fe=0,Ae=x.length;Fe<Ae;Fe++){const He=x[Fe];if(He.cacheKey===ee){Me=He,++Me.usedTimes;break}}return Me===void 0&&(Me=new KO(n,ee,re,l),x.push(Me)),Me}function Y(re){if(--re.usedTimes===0){const ee=x.indexOf(re);x[ee]=x[x.length-1],x.pop(),re.destroy()}}function Q(re){p.remove(re)}function xe(){p.dispose()}return{getParameters:k,getProgramCacheKey:C,getUniforms:J,acquireProgram:ue,releaseProgram:Y,releaseShaderCache:Q,programs:x,dispose:xe}}function nU(){let n=new WeakMap;function e(l){let h=n.get(l);return h===void 0&&(h={},n.set(l,h)),h}function t(l){n.delete(l)}function i(l,h,o){n.get(l)[h]=o}function r(){n=new WeakMap}return{get:e,remove:t,update:i,dispose:r}}function iU(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.material.id!==e.material.id?n.material.id-e.material.id:n.z!==e.z?n.z-e.z:n.id-e.id}function NM(n,e){return n.groupOrder!==e.groupOrder?n.groupOrder-e.groupOrder:n.renderOrder!==e.renderOrder?n.renderOrder-e.renderOrder:n.z!==e.z?e.z-n.z:n.id-e.id}function BM(){const n=[];let e=0;const t=[],i=[],r=[];function l(){e=0,t.length=0,i.length=0,r.length=0}function h(M,S,A,L,F,k){let C=n[e];return C===void 0?(C={id:M.id,object:M,geometry:S,material:A,groupOrder:L,renderOrder:M.renderOrder,z:F,group:k},n[e]=C):(C.id=M.id,C.object=M,C.geometry=S,C.material=A,C.groupOrder=L,C.renderOrder=M.renderOrder,C.z=F,C.group=k),e++,C}function o(M,S,A,L,F,k){const C=h(M,S,A,L,F,k);A.transmission>0?i.push(C):A.transparent===!0?r.push(C):t.push(C)}function p(M,S,A,L,F,k){const C=h(M,S,A,L,F,k);A.transmission>0?i.unshift(C):A.transparent===!0?r.unshift(C):t.unshift(C)}function v(M,S){t.length>1&&t.sort(M||iU),i.length>1&&i.sort(S||NM),r.length>1&&r.sort(S||NM)}function x(){for(let M=e,S=n.length;M<S;M++){const A=n[M];if(A.id===null)break;A.id=null,A.object=null,A.geometry=null,A.material=null,A.group=null}}return{opaque:t,transmissive:i,transparent:r,init:l,push:o,unshift:p,finish:x,sort:v}}function rU(){let n=new WeakMap;function e(i,r){const l=n.get(i);let h;return l===void 0?(h=new BM,n.set(i,[h])):r>=l.length?(h=new BM,l.push(h)):h=l[r],h}function t(){n=new WeakMap}return{get:e,dispose:t}}function aU(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new it,color:new Ti};break;case"SpotLight":t={position:new it,direction:new it,color:new Ti,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new it,color:new Ti,distance:0,decay:0};break;case"HemisphereLight":t={direction:new it,skyColor:new Ti,groundColor:new Ti};break;case"RectAreaLight":t={color:new Ti,position:new it,halfWidth:new it,halfHeight:new it};break}return n[e.id]=t,t}}}function sU(){const n={};return{get:function(e){if(n[e.id]!==void 0)return n[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n};break;case"SpotLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n};break;case"PointLight":t={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new $n,shadowCameraNear:1,shadowCameraFar:1e3};break}return n[e.id]=t,t}}}let oU=0;function lU(n,e){return(e.castShadow?2:0)-(n.castShadow?2:0)+(e.map?1:0)-(n.map?1:0)}function cU(n){const e=new aU,t=sU(),i={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let v=0;v<9;v++)i.probe.push(new it);const r=new it,l=new wr,h=new wr;function o(v,x){let M=0,S=0,A=0;for(let Me=0;Me<9;Me++)i.probe[Me].set(0,0,0);let L=0,F=0,k=0,C=0,V=0,O=0,J=0,ue=0,Y=0,Q=0,xe=0;v.sort(lU);const re=x===!0?Math.PI:1;for(let Me=0,Fe=v.length;Me<Fe;Me++){const Ae=v[Me],He=Ae.color,ot=Ae.intensity,ft=Ae.distance,ct=Ae.shadow&&Ae.shadow.map?Ae.shadow.map.texture:null;if(Ae.isAmbientLight)M+=He.r*ot*re,S+=He.g*ot*re,A+=He.b*ot*re;else if(Ae.isLightProbe){for(let De=0;De<9;De++)i.probe[De].addScaledVector(Ae.sh.coefficients[De],ot);xe++}else if(Ae.isDirectionalLight){const De=e.get(Ae);if(De.color.copy(Ae.color).multiplyScalar(Ae.intensity*re),Ae.castShadow){const Je=Ae.shadow,tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,i.directionalShadow[L]=tt,i.directionalShadowMap[L]=ct,i.directionalShadowMatrix[L]=Ae.shadow.matrix,O++}i.directional[L]=De,L++}else if(Ae.isSpotLight){const De=e.get(Ae);De.position.setFromMatrixPosition(Ae.matrixWorld),De.color.copy(He).multiplyScalar(ot*re),De.distance=ft,De.coneCos=Math.cos(Ae.angle),De.penumbraCos=Math.cos(Ae.angle*(1-Ae.penumbra)),De.decay=Ae.decay,i.spot[k]=De;const Je=Ae.shadow;if(Ae.map&&(i.spotLightMap[Y]=Ae.map,Y++,Je.updateMatrices(Ae),Ae.castShadow&&Q++),i.spotLightMatrix[k]=Je.matrix,Ae.castShadow){const tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,i.spotShadow[k]=tt,i.spotShadowMap[k]=ct,ue++}k++}else if(Ae.isRectAreaLight){const De=e.get(Ae);De.color.copy(He).multiplyScalar(ot),De.halfWidth.set(Ae.width*.5,0,0),De.halfHeight.set(0,Ae.height*.5,0),i.rectArea[C]=De,C++}else if(Ae.isPointLight){const De=e.get(Ae);if(De.color.copy(Ae.color).multiplyScalar(Ae.intensity*re),De.distance=Ae.distance,De.decay=Ae.decay,Ae.castShadow){const Je=Ae.shadow,tt=t.get(Ae);tt.shadowBias=Je.bias,tt.shadowNormalBias=Je.normalBias,tt.shadowRadius=Je.radius,tt.shadowMapSize=Je.mapSize,tt.shadowCameraNear=Je.camera.near,tt.shadowCameraFar=Je.camera.far,i.pointShadow[F]=tt,i.pointShadowMap[F]=ct,i.pointShadowMatrix[F]=Ae.shadow.matrix,J++}i.point[F]=De,F++}else if(Ae.isHemisphereLight){const De=e.get(Ae);De.skyColor.copy(Ae.color).multiplyScalar(ot*re),De.groundColor.copy(Ae.groundColor).multiplyScalar(ot*re),i.hemi[V]=De,V++}}C>0&&(n.has("OES_texture_float_linear")===!0?(i.rectAreaLTC1=ln.LTC_FLOAT_1,i.rectAreaLTC2=ln.LTC_FLOAT_2):(i.rectAreaLTC1=ln.LTC_HALF_1,i.rectAreaLTC2=ln.LTC_HALF_2)),i.ambient[0]=M,i.ambient[1]=S,i.ambient[2]=A;const ee=i.hash;(ee.directionalLength!==L||ee.pointLength!==F||ee.spotLength!==k||ee.rectAreaLength!==C||ee.hemiLength!==V||ee.numDirectionalShadows!==O||ee.numPointShadows!==J||ee.numSpotShadows!==ue||ee.numSpotMaps!==Y||ee.numLightProbes!==xe)&&(i.directional.length=L,i.spot.length=k,i.rectArea.length=C,i.point.length=F,i.hemi.length=V,i.directionalShadow.length=O,i.directionalShadowMap.length=O,i.pointShadow.length=J,i.pointShadowMap.length=J,i.spotShadow.length=ue,i.spotShadowMap.length=ue,i.directionalShadowMatrix.length=O,i.pointShadowMatrix.length=J,i.spotLightMatrix.length=ue+Y-Q,i.spotLightMap.length=Y,i.numSpotLightShadowsWithMaps=Q,i.numLightProbes=xe,ee.directionalLength=L,ee.pointLength=F,ee.spotLength=k,ee.rectAreaLength=C,ee.hemiLength=V,ee.numDirectionalShadows=O,ee.numPointShadows=J,ee.numSpotShadows=ue,ee.numSpotMaps=Y,ee.numLightProbes=xe,i.version=oU++)}function p(v,x){let M=0,S=0,A=0,L=0,F=0;const k=x.matrixWorldInverse;for(let C=0,V=v.length;C<V;C++){const O=v[C];if(O.isDirectionalLight){const J=i.directional[M];J.direction.setFromMatrixPosition(O.matrixWorld),r.setFromMatrixPosition(O.target.matrixWorld),J.direction.sub(r),J.direction.transformDirection(k),M++}else if(O.isSpotLight){const J=i.spot[A];J.position.setFromMatrixPosition(O.matrixWorld),J.position.applyMatrix4(k),J.direction.setFromMatrixPosition(O.matrixWorld),r.setFromMatrixPosition(O.target.matrixWorld),J.direction.sub(r),J.direction.transformDirection(k),A++}else if(O.isRectAreaLight){const J=i.rectArea[L];J.position.setFromMatrixPosition(O.matrixWorld),J.position.applyMatrix4(k),h.identity(),l.copy(O.matrixWorld),l.premultiply(k),h.extractRotation(l),J.halfWidth.set(O.width*.5,0,0),J.halfHeight.set(0,O.height*.5,0),J.halfWidth.applyMatrix4(h),J.halfHeight.applyMatrix4(h),L++}else if(O.isPointLight){const J=i.point[S];J.position.setFromMatrixPosition(O.matrixWorld),J.position.applyMatrix4(k),S++}else if(O.isHemisphereLight){const J=i.hemi[F];J.direction.setFromMatrixPosition(O.matrixWorld),J.direction.transformDirection(k),F++}}}return{setup:o,setupView:p,state:i}}function OM(n){const e=new cU(n),t=[],i=[];function r(){t.length=0,i.length=0}function l(x){t.push(x)}function h(x){i.push(x)}function o(x){e.setup(t,x)}function p(x){e.setupView(t,x)}return{init:r,state:{lightsArray:t,shadowsArray:i,lights:e,transmissionRenderTarget:null},setupLights:o,setupLightsView:p,pushLight:l,pushShadow:h}}function uU(n){let e=new WeakMap;function t(r,l=0){const h=e.get(r);let o;return h===void 0?(o=new OM(n),e.set(r,[o])):l>=h.length?(o=new OM(n),h.push(o)):o=h[l],o}function i(){e=new WeakMap}return{get:t,dispose:i}}class hU extends Zy{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=jL,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class dU extends Zy{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}const fU=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,pU=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function mU(n,e,t){let i=new u8;const r=new $n,l=new $n,h=new Ur,o=new hU({depthPacking:WL}),p=new dU,v={},x=t.maxTextureSize,M={[Lc]:Fa,[Fa]:Lc,[go]:go},S=new bs({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new $n},radius:{value:4}},vertexShader:fU,fragmentShader:pU}),A=S.clone();A.defines.HORIZONTAL_PASS=1;const L=new jc;L.setAttribute("position",new So(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const F=new Ja(L,S),k=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=UA;let C=this.type;this.render=function(Y,Q,xe){if(k.enabled===!1||k.autoUpdate===!1&&k.needsUpdate===!1||Y.length===0)return;const re=n.getRenderTarget(),ee=n.getActiveCubeFace(),Me=n.getActiveMipmapLevel(),Fe=n.state;Fe.setBlending(Pc),Fe.buffers.color.setClear(1,1,1,1),Fe.buffers.depth.setTest(!0),Fe.setScissorTest(!1);const Ae=C!==il&&this.type===il,He=C===il&&this.type!==il;for(let ot=0,ft=Y.length;ot<ft;ot++){const ct=Y[ot],De=ct.shadow;if(De===void 0){console.warn("THREE.WebGLShadowMap:",ct,"has no shadow.");continue}if(De.autoUpdate===!1&&De.needsUpdate===!1)continue;r.copy(De.mapSize);const Je=De.getFrameExtents();if(r.multiply(Je),l.copy(De.mapSize),(r.x>x||r.y>x)&&(r.x>x&&(l.x=Math.floor(x/Je.x),r.x=l.x*Je.x,De.mapSize.x=l.x),r.y>x&&(l.y=Math.floor(x/Je.y),r.y=l.y*Je.y,De.mapSize.y=l.y)),De.map===null||Ae===!0||He===!0){const _t=this.type!==il?{minFilter:xs,magFilter:xs}:{};De.map!==null&&De.map.dispose(),De.map=new qu(r.x,r.y,_t),De.map.texture.name=ct.name+".shadowMap",De.camera.updateProjectionMatrix()}n.setRenderTarget(De.map),n.clear();const tt=De.getViewportCount();for(let _t=0;_t<tt;_t++){const Lt=De.getViewport(_t);h.set(l.x*Lt.x,l.y*Lt.y,l.x*Lt.z,l.y*Lt.w),Fe.viewport(h),De.updateMatrices(ct,_t),i=De.getFrustum(),J(Q,xe,De.camera,ct,this.type)}De.isPointLightShadow!==!0&&this.type===il&&V(De,xe),De.needsUpdate=!1}C=this.type,k.needsUpdate=!1,n.setRenderTarget(re,ee,Me)};function V(Y,Q){const xe=e.update(F);S.defines.VSM_SAMPLES!==Y.blurSamples&&(S.defines.VSM_SAMPLES=Y.blurSamples,A.defines.VSM_SAMPLES=Y.blurSamples,S.needsUpdate=!0,A.needsUpdate=!0),Y.mapPass===null&&(Y.mapPass=new qu(r.x,r.y)),S.uniforms.shadow_pass.value=Y.map.texture,S.uniforms.resolution.value=Y.mapSize,S.uniforms.radius.value=Y.radius,n.setRenderTarget(Y.mapPass),n.clear(),n.renderBufferDirect(Q,null,xe,S,F,null),A.uniforms.shadow_pass.value=Y.mapPass.texture,A.uniforms.resolution.value=Y.mapSize,A.uniforms.radius.value=Y.radius,n.setRenderTarget(Y.map),n.clear(),n.renderBufferDirect(Q,null,xe,A,F,null)}function O(Y,Q,xe,re){let ee=null;const Me=xe.isPointLight===!0?Y.customDistanceMaterial:Y.customDepthMaterial;if(Me!==void 0)ee=Me;else if(ee=xe.isPointLight===!0?p:o,n.localClippingEnabled&&Q.clipShadows===!0&&Array.isArray(Q.clippingPlanes)&&Q.clippingPlanes.length!==0||Q.displacementMap&&Q.displacementScale!==0||Q.alphaMap&&Q.alphaTest>0||Q.map&&Q.alphaTest>0){const Fe=ee.uuid,Ae=Q.uuid;let He=v[Fe];He===void 0&&(He={},v[Fe]=He);let ot=He[Ae];ot===void 0&&(ot=ee.clone(),He[Ae]=ot,Q.addEventListener("dispose",ue)),ee=ot}if(ee.visible=Q.visible,ee.wireframe=Q.wireframe,re===il?ee.side=Q.shadowSide!==null?Q.shadowSide:Q.side:ee.side=Q.shadowSide!==null?Q.shadowSide:M[Q.side],ee.alphaMap=Q.alphaMap,ee.alphaTest=Q.alphaTest,ee.map=Q.map,ee.clipShadows=Q.clipShadows,ee.clippingPlanes=Q.clippingPlanes,ee.clipIntersection=Q.clipIntersection,ee.displacementMap=Q.displacementMap,ee.displacementScale=Q.displacementScale,ee.displacementBias=Q.displacementBias,ee.wireframeLinewidth=Q.wireframeLinewidth,ee.linewidth=Q.linewidth,xe.isPointLight===!0&&ee.isMeshDistanceMaterial===!0){const Fe=n.properties.get(ee);Fe.light=xe}return ee}function J(Y,Q,xe,re,ee){if(Y.visible===!1)return;if(Y.layers.test(Q.layers)&&(Y.isMesh||Y.isLine||Y.isPoints)&&(Y.castShadow||Y.receiveShadow&&ee===il)&&(!Y.frustumCulled||i.intersectsObject(Y))){Y.modelViewMatrix.multiplyMatrices(xe.matrixWorldInverse,Y.matrixWorld);const Ae=e.update(Y),He=Y.material;if(Array.isArray(He)){const ot=Ae.groups;for(let ft=0,ct=ot.length;ft<ct;ft++){const De=ot[ft],Je=He[De.materialIndex];if(Je&&Je.visible){const tt=O(Y,Je,re,ee);Y.onBeforeShadow(n,Y,Q,xe,Ae,tt,De),n.renderBufferDirect(xe,null,Ae,tt,Y,De),Y.onAfterShadow(n,Y,Q,xe,Ae,tt,De)}}}else if(He.visible){const ot=O(Y,He,re,ee);Y.onBeforeShadow(n,Y,Q,xe,Ae,ot,null),n.renderBufferDirect(xe,null,Ae,ot,Y,null),Y.onAfterShadow(n,Y,Q,xe,Ae,ot,null)}}const Fe=Y.children;for(let Ae=0,He=Fe.length;Ae<He;Ae++)J(Fe[Ae],Q,xe,re,ee)}function ue(Y){Y.target.removeEventListener("dispose",ue);for(const xe in v){const re=v[xe],ee=Y.target.uuid;ee in re&&(re[ee].dispose(),delete re[ee])}}}function gU(n){function e(){let X=!1;const Oe=new Ur;let pt=null;const Dt=new Ur(0,0,0,0);return{setMask:function(ce){pt!==ce&&!X&&(n.colorMask(ce,ce,ce,ce),pt=ce)},setLocked:function(ce){X=ce},setClear:function(ce,B,U,q,ne){ne===!0&&(ce*=q,B*=q,U*=q),Oe.set(ce,B,U,q),Dt.equals(Oe)===!1&&(n.clearColor(ce,B,U,q),Dt.copy(Oe))},reset:function(){X=!1,pt=null,Dt.set(-1,0,0,0)}}}function t(){let X=!1,Oe=null,pt=null,Dt=null;return{setTest:function(ce){ce?Ft(n.DEPTH_TEST):At(n.DEPTH_TEST)},setMask:function(ce){Oe!==ce&&!X&&(n.depthMask(ce),Oe=ce)},setFunc:function(ce){if(pt!==ce){switch(ce){case yL:n.depthFunc(n.NEVER);break;case vL:n.depthFunc(n.ALWAYS);break;case _L:n.depthFunc(n.LESS);break;case iy:n.depthFunc(n.LEQUAL);break;case xL:n.depthFunc(n.EQUAL);break;case bL:n.depthFunc(n.GEQUAL);break;case wL:n.depthFunc(n.GREATER);break;case SL:n.depthFunc(n.NOTEQUAL);break;default:n.depthFunc(n.LEQUAL)}pt=ce}},setLocked:function(ce){X=ce},setClear:function(ce){Dt!==ce&&(n.clearDepth(ce),Dt=ce)},reset:function(){X=!1,Oe=null,pt=null,Dt=null}}}function i(){let X=!1,Oe=null,pt=null,Dt=null,ce=null,B=null,U=null,q=null,ne=null;return{setTest:function(me){X||(me?Ft(n.STENCIL_TEST):At(n.STENCIL_TEST))},setMask:function(me){Oe!==me&&!X&&(n.stencilMask(me),Oe=me)},setFunc:function(me,Se,Ee){(pt!==me||Dt!==Se||ce!==Ee)&&(n.stencilFunc(me,Se,Ee),pt=me,Dt=Se,ce=Ee)},setOp:function(me,Se,Ee){(B!==me||U!==Se||q!==Ee)&&(n.stencilOp(me,Se,Ee),B=me,U=Se,q=Ee)},setLocked:function(me){X=me},setClear:function(me){ne!==me&&(n.clearStencil(me),ne=me)},reset:function(){X=!1,Oe=null,pt=null,Dt=null,ce=null,B=null,U=null,q=null,ne=null}}}const r=new e,l=new t,h=new i,o=new WeakMap,p=new WeakMap;let v={},x={},M=new WeakMap,S=[],A=null,L=!1,F=null,k=null,C=null,V=null,O=null,J=null,ue=null,Y=new Ti(0,0,0),Q=0,xe=!1,re=null,ee=null,Me=null,Fe=null,Ae=null;const He=n.getParameter(n.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let ot=!1,ft=0;const ct=n.getParameter(n.VERSION);ct.indexOf("WebGL")!==-1?(ft=parseFloat(/^WebGL (\d)/.exec(ct)[1]),ot=ft>=1):ct.indexOf("OpenGL ES")!==-1&&(ft=parseFloat(/^OpenGL ES (\d)/.exec(ct)[1]),ot=ft>=2);let De=null,Je={};const tt=n.getParameter(n.SCISSOR_BOX),_t=n.getParameter(n.VIEWPORT),Lt=new Ur().fromArray(tt),Cn=new Ur().fromArray(_t);function nt(X,Oe,pt,Dt){const ce=new Uint8Array(4),B=n.createTexture();n.bindTexture(X,B),n.texParameteri(X,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(X,n.TEXTURE_MAG_FILTER,n.NEAREST);for(let U=0;U<pt;U++)X===n.TEXTURE_3D||X===n.TEXTURE_2D_ARRAY?n.texImage3D(Oe,0,n.RGBA,1,1,Dt,0,n.RGBA,n.UNSIGNED_BYTE,ce):n.texImage2D(Oe+U,0,n.RGBA,1,1,0,n.RGBA,n.UNSIGNED_BYTE,ce);return B}const wt={};wt[n.TEXTURE_2D]=nt(n.TEXTURE_2D,n.TEXTURE_2D,1),wt[n.TEXTURE_CUBE_MAP]=nt(n.TEXTURE_CUBE_MAP,n.TEXTURE_CUBE_MAP_POSITIVE_X,6),wt[n.TEXTURE_2D_ARRAY]=nt(n.TEXTURE_2D_ARRAY,n.TEXTURE_2D_ARRAY,1,1),wt[n.TEXTURE_3D]=nt(n.TEXTURE_3D,n.TEXTURE_3D,1,1),r.setClear(0,0,0,1),l.setClear(1),h.setClear(0),Ft(n.DEPTH_TEST),l.setFunc(iy),Yt(!1),Gn(x5),Ft(n.CULL_FACE),yn(Pc);function Ft(X){v[X]!==!0&&(n.enable(X),v[X]=!0)}function At(X){v[X]!==!1&&(n.disable(X),v[X]=!1)}function gn(X,Oe){return x[X]!==Oe?(n.bindFramebuffer(X,Oe),x[X]=Oe,X===n.DRAW_FRAMEBUFFER&&(x[n.FRAMEBUFFER]=Oe),X===n.FRAMEBUFFER&&(x[n.DRAW_FRAMEBUFFER]=Oe),!0):!1}function En(X,Oe){let pt=S,Dt=!1;if(X){pt=M.get(Oe),pt===void 0&&(pt=[],M.set(Oe,pt));const ce=X.textures;if(pt.length!==ce.length||pt[0]!==n.COLOR_ATTACHMENT0){for(let B=0,U=ce.length;B<U;B++)pt[B]=n.COLOR_ATTACHMENT0+B;pt.length=ce.length,Dt=!0}}else pt[0]!==n.BACK&&(pt[0]=n.BACK,Dt=!0);Dt&&n.drawBuffers(pt)}function In(X){return A!==X?(n.useProgram(X),A=X,!0):!1}const je={[Eu]:n.FUNC_ADD,[eL]:n.FUNC_SUBTRACT,[tL]:n.FUNC_REVERSE_SUBTRACT};je[nL]=n.MIN,je[iL]=n.MAX;const An={[rL]:n.ZERO,[aL]:n.ONE,[sL]:n.SRC_COLOR,[V2]:n.SRC_ALPHA,[dL]:n.SRC_ALPHA_SATURATE,[uL]:n.DST_COLOR,[lL]:n.DST_ALPHA,[oL]:n.ONE_MINUS_SRC_COLOR,[H2]:n.ONE_MINUS_SRC_ALPHA,[hL]:n.ONE_MINUS_DST_COLOR,[cL]:n.ONE_MINUS_DST_ALPHA,[fL]:n.CONSTANT_COLOR,[pL]:n.ONE_MINUS_CONSTANT_COLOR,[mL]:n.CONSTANT_ALPHA,[gL]:n.ONE_MINUS_CONSTANT_ALPHA};function yn(X,Oe,pt,Dt,ce,B,U,q,ne,me){if(X===Pc){L===!0&&(At(n.BLEND),L=!1);return}if(L===!1&&(Ft(n.BLEND),L=!0),X!==QD){if(X!==F||me!==xe){if((k!==Eu||O!==Eu)&&(n.blendEquation(n.FUNC_ADD),k=Eu,O=Eu),me)switch(X){case zd:n.blendFuncSeparate(n.ONE,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case b5:n.blendFunc(n.ONE,n.ONE);break;case w5:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case S5:n.blendFuncSeparate(n.ZERO,n.SRC_COLOR,n.ZERO,n.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}else switch(X){case zd:n.blendFuncSeparate(n.SRC_ALPHA,n.ONE_MINUS_SRC_ALPHA,n.ONE,n.ONE_MINUS_SRC_ALPHA);break;case b5:n.blendFunc(n.SRC_ALPHA,n.ONE);break;case w5:n.blendFuncSeparate(n.ZERO,n.ONE_MINUS_SRC_COLOR,n.ZERO,n.ONE);break;case S5:n.blendFunc(n.ZERO,n.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",X);break}C=null,V=null,J=null,ue=null,Y.set(0,0,0),Q=0,F=X,xe=me}return}ce=ce||Oe,B=B||pt,U=U||Dt,(Oe!==k||ce!==O)&&(n.blendEquationSeparate(je[Oe],je[ce]),k=Oe,O=ce),(pt!==C||Dt!==V||B!==J||U!==ue)&&(n.blendFuncSeparate(An[pt],An[Dt],An[B],An[U]),C=pt,V=Dt,J=B,ue=U),(q.equals(Y)===!1||ne!==Q)&&(n.blendColor(q.r,q.g,q.b,ne),Y.copy(q),Q=ne),F=X,xe=!1}function Qn(X,Oe){X.side===go?At(n.CULL_FACE):Ft(n.CULL_FACE);let pt=X.side===Fa;Oe&&(pt=!pt),Yt(pt),X.blending===zd&&X.transparent===!1?yn(Pc):yn(X.blending,X.blendEquation,X.blendSrc,X.blendDst,X.blendEquationAlpha,X.blendSrcAlpha,X.blendDstAlpha,X.blendColor,X.blendAlpha,X.premultipliedAlpha),l.setFunc(X.depthFunc),l.setTest(X.depthTest),l.setMask(X.depthWrite),r.setMask(X.colorWrite);const Dt=X.stencilWrite;h.setTest(Dt),Dt&&(h.setMask(X.stencilWriteMask),h.setFunc(X.stencilFunc,X.stencilRef,X.stencilFuncMask),h.setOp(X.stencilFail,X.stencilZFail,X.stencilZPass)),le(X.polygonOffset,X.polygonOffsetFactor,X.polygonOffsetUnits),X.alphaToCoverage===!0?Ft(n.SAMPLE_ALPHA_TO_COVERAGE):At(n.SAMPLE_ALPHA_TO_COVERAGE)}function Yt(X){re!==X&&(X?n.frontFace(n.CW):n.frontFace(n.CCW),re=X)}function Gn(X){X!==YD?(Ft(n.CULL_FACE),X!==ee&&(X===x5?n.cullFace(n.BACK):X===KD?n.cullFace(n.FRONT):n.cullFace(n.FRONT_AND_BACK))):At(n.CULL_FACE),ee=X}function ie(X){X!==Me&&(ot&&n.lineWidth(X),Me=X)}function le(X,Oe,pt){X?(Ft(n.POLYGON_OFFSET_FILL),(Fe!==Oe||Ae!==pt)&&(n.polygonOffset(Oe,pt),Fe=Oe,Ae=pt)):At(n.POLYGON_OFFSET_FILL)}function st(X){X?Ft(n.SCISSOR_TEST):At(n.SCISSOR_TEST)}function rt(X){X===void 0&&(X=n.TEXTURE0+He-1),De!==X&&(n.activeTexture(X),De=X)}function mt(X,Oe,pt){pt===void 0&&(De===null?pt=n.TEXTURE0+He-1:pt=De);let Dt=Je[pt];Dt===void 0&&(Dt={type:void 0,texture:void 0},Je[pt]=Dt),(Dt.type!==X||Dt.texture!==Oe)&&(De!==pt&&(n.activeTexture(pt),De=pt),n.bindTexture(X,Oe||wt[X]),Dt.type=X,Dt.texture=Oe)}function St(){const X=Je[De];X!==void 0&&X.type!==void 0&&(n.bindTexture(X.type,null),X.type=void 0,X.texture=void 0)}function _n(){try{n.compressedTexImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Mt(){try{n.compressedTexImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function hn(){try{n.texSubImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function xn(){try{n.texSubImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Nt(){try{n.compressedTexSubImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function an(){try{n.compressedTexSubImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function at(){try{n.texStorage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function tn(){try{n.texStorage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Kt(){try{n.texImage2D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function On(){try{n.texImage3D.apply(n,arguments)}catch(X){console.error("THREE.WebGLState:",X)}}function Un(X){Lt.equals(X)===!1&&(n.scissor(X.x,X.y,X.z,X.w),Lt.copy(X))}function dt(X){Cn.equals(X)===!1&&(n.viewport(X.x,X.y,X.z,X.w),Cn.copy(X))}function Ht(X,Oe){let pt=p.get(Oe);pt===void 0&&(pt=new WeakMap,p.set(Oe,pt));let Dt=pt.get(X);Dt===void 0&&(Dt=n.getUniformBlockIndex(Oe,X.name),pt.set(X,Dt))}function jt(X,Oe){const Dt=p.get(Oe).get(X);o.get(Oe)!==Dt&&(n.uniformBlockBinding(Oe,Dt,X.__bindingPointIndex),o.set(Oe,Dt))}function Jt(){n.disable(n.BLEND),n.disable(n.CULL_FACE),n.disable(n.DEPTH_TEST),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SCISSOR_TEST),n.disable(n.STENCIL_TEST),n.disable(n.SAMPLE_ALPHA_TO_COVERAGE),n.blendEquation(n.FUNC_ADD),n.blendFunc(n.ONE,n.ZERO),n.blendFuncSeparate(n.ONE,n.ZERO,n.ONE,n.ZERO),n.blendColor(0,0,0,0),n.colorMask(!0,!0,!0,!0),n.clearColor(0,0,0,0),n.depthMask(!0),n.depthFunc(n.LESS),n.clearDepth(1),n.stencilMask(4294967295),n.stencilFunc(n.ALWAYS,0,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.KEEP),n.clearStencil(0),n.cullFace(n.BACK),n.frontFace(n.CCW),n.polygonOffset(0,0),n.activeTexture(n.TEXTURE0),n.bindFramebuffer(n.FRAMEBUFFER,null),n.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),n.bindFramebuffer(n.READ_FRAMEBUFFER,null),n.useProgram(null),n.lineWidth(1),n.scissor(0,0,n.canvas.width,n.canvas.height),n.viewport(0,0,n.canvas.width,n.canvas.height),v={},De=null,Je={},x={},M=new WeakMap,S=[],A=null,L=!1,F=null,k=null,C=null,V=null,O=null,J=null,ue=null,Y=new Ti(0,0,0),Q=0,xe=!1,re=null,ee=null,Me=null,Fe=null,Ae=null,Lt.set(0,0,n.canvas.width,n.canvas.height),Cn.set(0,0,n.canvas.width,n.canvas.height),r.reset(),l.reset(),h.reset()}return{buffers:{color:r,depth:l,stencil:h},enable:Ft,disable:At,bindFramebuffer:gn,drawBuffers:En,useProgram:In,setBlending:yn,setMaterial:Qn,setFlipSided:Yt,setCullFace:Gn,setLineWidth:ie,setPolygonOffset:le,setScissorTest:st,activeTexture:rt,bindTexture:mt,unbindTexture:St,compressedTexImage2D:_n,compressedTexImage3D:Mt,texImage2D:Kt,texImage3D:On,updateUBOMapping:Ht,uniformBlockBinding:jt,texStorage2D:at,texStorage3D:tn,texSubImage2D:hn,texSubImage3D:xn,compressedTexSubImage2D:Nt,compressedTexSubImage3D:an,scissor:Un,viewport:dt,reset:Jt}}function yU(n,e,t,i,r,l,h){const o=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,p=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),v=new $n,x=new WeakMap;let M;const S=new WeakMap;let A=!1;try{A=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function L(ie,le){return A?new OffscreenCanvas(ie,le):kp("canvas")}function F(ie,le,st){let rt=1;const mt=Gn(ie);if((mt.width>st||mt.height>st)&&(rt=st/Math.max(mt.width,mt.height)),rt<1)if(typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&ie instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&ie instanceof ImageBitmap||typeof VideoFrame<"u"&&ie instanceof VideoFrame){const St=Math.floor(rt*mt.width),_n=Math.floor(rt*mt.height);M===void 0&&(M=L(St,_n));const Mt=le?L(St,_n):M;return Mt.width=St,Mt.height=_n,Mt.getContext("2d").drawImage(ie,0,0,St,_n),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+mt.width+"x"+mt.height+") to ("+St+"x"+_n+")."),Mt}else return"data"in ie&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+mt.width+"x"+mt.height+")."),ie;return ie}function k(ie){return ie.generateMipmaps&&ie.minFilter!==xs&&ie.minFilter!==$s}function C(ie){n.generateMipmap(ie)}function V(ie,le,st,rt,mt=!1){if(ie!==null){if(n[ie]!==void 0)return n[ie];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+ie+"'")}let St=le;if(le===n.RED&&(st===n.FLOAT&&(St=n.R32F),st===n.HALF_FLOAT&&(St=n.R16F),st===n.UNSIGNED_BYTE&&(St=n.R8)),le===n.RED_INTEGER&&(st===n.UNSIGNED_BYTE&&(St=n.R8UI),st===n.UNSIGNED_SHORT&&(St=n.R16UI),st===n.UNSIGNED_INT&&(St=n.R32UI),st===n.BYTE&&(St=n.R8I),st===n.SHORT&&(St=n.R16I),st===n.INT&&(St=n.R32I)),le===n.RG&&(st===n.FLOAT&&(St=n.RG32F),st===n.HALF_FLOAT&&(St=n.RG16F),st===n.UNSIGNED_BYTE&&(St=n.RG8)),le===n.RG_INTEGER&&(st===n.UNSIGNED_BYTE&&(St=n.RG8UI),st===n.UNSIGNED_SHORT&&(St=n.RG16UI),st===n.UNSIGNED_INT&&(St=n.RG32UI),st===n.BYTE&&(St=n.RG8I),st===n.SHORT&&(St=n.RG16I),st===n.INT&&(St=n.RG32I)),le===n.RGB&&st===n.UNSIGNED_INT_5_9_9_9_REV&&(St=n.RGB9_E5),le===n.RGBA){const _n=mt?ay:Mi.getTransfer(rt);st===n.FLOAT&&(St=n.RGBA32F),st===n.HALF_FLOAT&&(St=n.RGBA16F),st===n.UNSIGNED_BYTE&&(St=_n===Bi?n.SRGB8_ALPHA8:n.RGBA8),st===n.UNSIGNED_SHORT_4_4_4_4&&(St=n.RGBA4),st===n.UNSIGNED_SHORT_5_5_5_1&&(St=n.RGB5_A1)}return(St===n.R16F||St===n.R32F||St===n.RG16F||St===n.RG32F||St===n.RGBA16F||St===n.RGBA32F)&&e.get("EXT_color_buffer_float"),St}function O(ie,le){return k(ie)===!0||ie.isFramebufferTexture&&ie.minFilter!==xs&&ie.minFilter!==$s?Math.log2(Math.max(le.width,le.height))+1:ie.mipmaps!==void 0&&ie.mipmaps.length>0?ie.mipmaps.length:ie.isCompressedTexture&&Array.isArray(ie.image)?le.mipmaps.length:1}function J(ie){const le=ie.target;le.removeEventListener("dispose",J),Y(le),le.isVideoTexture&&x.delete(le)}function ue(ie){const le=ie.target;le.removeEventListener("dispose",ue),xe(le)}function Y(ie){const le=i.get(ie);if(le.__webglInit===void 0)return;const st=ie.source,rt=S.get(st);if(rt){const mt=rt[le.__cacheKey];mt.usedTimes--,mt.usedTimes===0&&Q(ie),Object.keys(rt).length===0&&S.delete(st)}i.remove(ie)}function Q(ie){const le=i.get(ie);n.deleteTexture(le.__webglTexture);const st=ie.source,rt=S.get(st);delete rt[le.__cacheKey],h.memory.textures--}function xe(ie){const le=i.get(ie);if(ie.depthTexture&&ie.depthTexture.dispose(),ie.isWebGLCubeRenderTarget)for(let rt=0;rt<6;rt++){if(Array.isArray(le.__webglFramebuffer[rt]))for(let mt=0;mt<le.__webglFramebuffer[rt].length;mt++)n.deleteFramebuffer(le.__webglFramebuffer[rt][mt]);else n.deleteFramebuffer(le.__webglFramebuffer[rt]);le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer[rt])}else{if(Array.isArray(le.__webglFramebuffer))for(let rt=0;rt<le.__webglFramebuffer.length;rt++)n.deleteFramebuffer(le.__webglFramebuffer[rt]);else n.deleteFramebuffer(le.__webglFramebuffer);if(le.__webglDepthbuffer&&n.deleteRenderbuffer(le.__webglDepthbuffer),le.__webglMultisampledFramebuffer&&n.deleteFramebuffer(le.__webglMultisampledFramebuffer),le.__webglColorRenderbuffer)for(let rt=0;rt<le.__webglColorRenderbuffer.length;rt++)le.__webglColorRenderbuffer[rt]&&n.deleteRenderbuffer(le.__webglColorRenderbuffer[rt]);le.__webglDepthRenderbuffer&&n.deleteRenderbuffer(le.__webglDepthRenderbuffer)}const st=ie.textures;for(let rt=0,mt=st.length;rt<mt;rt++){const St=i.get(st[rt]);St.__webglTexture&&(n.deleteTexture(St.__webglTexture),h.memory.textures--),i.remove(st[rt])}i.remove(ie)}let re=0;function ee(){re=0}function Me(){const ie=re;return ie>=r.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+ie+" texture units while this GPU supports only "+r.maxTextures),re+=1,ie}function Fe(ie){const le=[];return le.push(ie.wrapS),le.push(ie.wrapT),le.push(ie.wrapR||0),le.push(ie.magFilter),le.push(ie.minFilter),le.push(ie.anisotropy),le.push(ie.internalFormat),le.push(ie.format),le.push(ie.type),le.push(ie.generateMipmaps),le.push(ie.premultiplyAlpha),le.push(ie.flipY),le.push(ie.unpackAlignment),le.push(ie.colorSpace),le.join()}function Ae(ie,le){const st=i.get(ie);if(ie.isVideoTexture&&Qn(ie),ie.isRenderTargetTexture===!1&&ie.version>0&&st.__version!==ie.version){const rt=ie.image;if(rt===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(rt.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{Lt(st,ie,le);return}}t.bindTexture(n.TEXTURE_2D,st.__webglTexture,n.TEXTURE0+le)}function He(ie,le){const st=i.get(ie);if(ie.version>0&&st.__version!==ie.version){Lt(st,ie,le);return}t.bindTexture(n.TEXTURE_2D_ARRAY,st.__webglTexture,n.TEXTURE0+le)}function ot(ie,le){const st=i.get(ie);if(ie.version>0&&st.__version!==ie.version){Lt(st,ie,le);return}t.bindTexture(n.TEXTURE_3D,st.__webglTexture,n.TEXTURE0+le)}function ft(ie,le){const st=i.get(ie);if(ie.version>0&&st.__version!==ie.version){Cn(st,ie,le);return}t.bindTexture(n.TEXTURE_CUBE_MAP,st.__webglTexture,n.TEXTURE0+le)}const ct={[W2]:n.REPEAT,[Du]:n.CLAMP_TO_EDGE,[q2]:n.MIRRORED_REPEAT},De={[xs]:n.NEAREST,[DL]:n.NEAREST_MIPMAP_NEAREST,[Cg]:n.NEAREST_MIPMAP_LINEAR,[$s]:n.LINEAR,[q_]:n.LINEAR_MIPMAP_NEAREST,[Lu]:n.LINEAR_MIPMAP_LINEAR},Je={[XL]:n.NEVER,[ez]:n.ALWAYS,[ZL]:n.LESS,[KA]:n.LEQUAL,[YL]:n.EQUAL,[QL]:n.GEQUAL,[KL]:n.GREATER,[JL]:n.NOTEQUAL};function tt(ie,le){if(le.type===_c&&e.has("OES_texture_float_linear")===!1&&(le.magFilter===$s||le.magFilter===q_||le.magFilter===Cg||le.magFilter===Lu||le.minFilter===$s||le.minFilter===q_||le.minFilter===Cg||le.minFilter===Lu)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),n.texParameteri(ie,n.TEXTURE_WRAP_S,ct[le.wrapS]),n.texParameteri(ie,n.TEXTURE_WRAP_T,ct[le.wrapT]),(ie===n.TEXTURE_3D||ie===n.TEXTURE_2D_ARRAY)&&n.texParameteri(ie,n.TEXTURE_WRAP_R,ct[le.wrapR]),n.texParameteri(ie,n.TEXTURE_MAG_FILTER,De[le.magFilter]),n.texParameteri(ie,n.TEXTURE_MIN_FILTER,De[le.minFilter]),le.compareFunction&&(n.texParameteri(ie,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(ie,n.TEXTURE_COMPARE_FUNC,Je[le.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(le.magFilter===xs||le.minFilter!==Cg&&le.minFilter!==Lu||le.type===_c&&e.has("OES_texture_float_linear")===!1)return;if(le.anisotropy>1||i.get(le).__currentAnisotropy){const st=e.get("EXT_texture_filter_anisotropic");n.texParameterf(ie,st.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(le.anisotropy,r.getMaxAnisotropy())),i.get(le).__currentAnisotropy=le.anisotropy}}}function _t(ie,le){let st=!1;ie.__webglInit===void 0&&(ie.__webglInit=!0,le.addEventListener("dispose",J));const rt=le.source;let mt=S.get(rt);mt===void 0&&(mt={},S.set(rt,mt));const St=Fe(le);if(St!==ie.__cacheKey){mt[St]===void 0&&(mt[St]={texture:n.createTexture(),usedTimes:0},h.memory.textures++,st=!0),mt[St].usedTimes++;const _n=mt[ie.__cacheKey];_n!==void 0&&(mt[ie.__cacheKey].usedTimes--,_n.usedTimes===0&&Q(le)),ie.__cacheKey=St,ie.__webglTexture=mt[St].texture}return st}function Lt(ie,le,st){let rt=n.TEXTURE_2D;(le.isDataArrayTexture||le.isCompressedArrayTexture)&&(rt=n.TEXTURE_2D_ARRAY),le.isData3DTexture&&(rt=n.TEXTURE_3D);const mt=_t(ie,le),St=le.source;t.bindTexture(rt,ie.__webglTexture,n.TEXTURE0+st);const _n=i.get(St);if(St.version!==_n.__version||mt===!0){t.activeTexture(n.TEXTURE0+st);const Mt=Mi.getPrimaries(Mi.workingColorSpace),hn=le.colorSpace===gc?null:Mi.getPrimaries(le.colorSpace),xn=le.colorSpace===gc||Mt===hn?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,xn);let Nt=F(le.image,!1,r.maxTextureSize);Nt=Yt(le,Nt);const an=l.convert(le.format,le.colorSpace),at=l.convert(le.type);let tn=V(le.internalFormat,an,at,le.colorSpace,le.isVideoTexture);tt(rt,le);let Kt;const On=le.mipmaps,Un=le.isVideoTexture!==!0&&tn!==YA,dt=_n.__version===void 0||mt===!0,Ht=St.dataReady,jt=O(le,Nt);if(le.isDepthTexture)tn=n.DEPTH_COMPONENT16,le.type===_c?tn=n.DEPTH_COMPONENT32F:le.type===Yd?tn=n.DEPTH_COMPONENT24:le.type===Xp&&(tn=n.DEPTH24_STENCIL8),dt&&(Un?t.texStorage2D(n.TEXTURE_2D,1,tn,Nt.width,Nt.height):t.texImage2D(n.TEXTURE_2D,0,tn,Nt.width,Nt.height,0,an,at,null));else if(le.isDataTexture)if(On.length>0){Un&&dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,On[0].width,On[0].height);for(let Jt=0,X=On.length;Jt<X;Jt++)Kt=On[Jt],Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,at,Kt.data):t.texImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,an,at,Kt.data);le.generateMipmaps=!1}else Un?(dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,Nt.width,Nt.height),Ht&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,Nt.width,Nt.height,an,at,Nt.data)):t.texImage2D(n.TEXTURE_2D,0,tn,Nt.width,Nt.height,0,an,at,Nt.data);else if(le.isCompressedTexture)if(le.isCompressedArrayTexture){Un&&dt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,jt,tn,On[0].width,On[0].height,Nt.depth);for(let Jt=0,X=On.length;Jt<X;Jt++)Kt=On[Jt],le.format!==_o?an!==null?Un?Ht&&t.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,Jt,0,0,0,Kt.width,Kt.height,Nt.depth,an,Kt.data,0,0):t.compressedTexImage3D(n.TEXTURE_2D_ARRAY,Jt,tn,Kt.width,Kt.height,Nt.depth,0,Kt.data,0,0):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Un?Ht&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,Jt,0,0,0,Kt.width,Kt.height,Nt.depth,an,at,Kt.data):t.texImage3D(n.TEXTURE_2D_ARRAY,Jt,tn,Kt.width,Kt.height,Nt.depth,0,an,at,Kt.data)}else{Un&&dt&&t.texStorage2D(n.TEXTURE_2D,jt,tn,On[0].width,On[0].height);for(let Jt=0,X=On.length;Jt<X;Jt++)Kt=On[Jt],le.format!==_o?an!==null?Un?Ht&&t.compressedTexSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,Kt.data):t.compressedTexImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,Kt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,Kt.width,Kt.height,an,at,Kt.data):t.texImage2D(n.TEXTURE_2D,Jt,tn,Kt.width,Kt.height,0,an,at,Kt.data)}else if(le.isDataArrayTexture)Un?(dt&&t.texStorage3D(n.TEXTURE_2D_ARRAY,jt,tn,Nt.width,Nt.height,Nt.depth),Ht&&t.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,Nt.width,Nt.height,Nt.depth,an,at,Nt.data)):t.texImage3D(n.TEXTURE_2D_ARRAY,0,tn,Nt.width,Nt.height,Nt.depth,0,an,at,Nt.data);else if(le.isData3DTexture)Un?(dt&&t.texStorage3D(n.TEXTURE_3D,jt,tn,Nt.width,Nt.height,Nt.depth),Ht&&t.texSubImage3D(n.TEXTURE_3D,0,0,0,0,Nt.width,Nt.height,Nt.depth,an,at,Nt.data)):t.texImage3D(n.TEXTURE_3D,0,tn,Nt.width,Nt.height,Nt.depth,0,an,at,Nt.data);else if(le.isFramebufferTexture){if(dt)if(Un)t.texStorage2D(n.TEXTURE_2D,jt,tn,Nt.width,Nt.height);else{let Jt=Nt.width,X=Nt.height;for(let Oe=0;Oe<jt;Oe++)t.texImage2D(n.TEXTURE_2D,Oe,tn,Jt,X,0,an,at,null),Jt>>=1,X>>=1}}else if(On.length>0){if(Un&&dt){const Jt=Gn(On[0]);t.texStorage2D(n.TEXTURE_2D,jt,tn,Jt.width,Jt.height)}for(let Jt=0,X=On.length;Jt<X;Jt++)Kt=On[Jt],Un?Ht&&t.texSubImage2D(n.TEXTURE_2D,Jt,0,0,an,at,Kt):t.texImage2D(n.TEXTURE_2D,Jt,tn,an,at,Kt);le.generateMipmaps=!1}else if(Un){if(dt){const Jt=Gn(Nt);t.texStorage2D(n.TEXTURE_2D,jt,tn,Jt.width,Jt.height)}Ht&&t.texSubImage2D(n.TEXTURE_2D,0,0,0,an,at,Nt)}else t.texImage2D(n.TEXTURE_2D,0,tn,an,at,Nt);k(le)&&C(rt),_n.__version=St.version,le.onUpdate&&le.onUpdate(le)}ie.__version=le.version}function Cn(ie,le,st){if(le.image.length!==6)return;const rt=_t(ie,le),mt=le.source;t.bindTexture(n.TEXTURE_CUBE_MAP,ie.__webglTexture,n.TEXTURE0+st);const St=i.get(mt);if(mt.version!==St.__version||rt===!0){t.activeTexture(n.TEXTURE0+st);const _n=Mi.getPrimaries(Mi.workingColorSpace),Mt=le.colorSpace===gc?null:Mi.getPrimaries(le.colorSpace),hn=le.colorSpace===gc||_n===Mt?n.NONE:n.BROWSER_DEFAULT_WEBGL;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,le.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,le.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,le.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,hn);const xn=le.isCompressedTexture||le.image[0].isCompressedTexture,Nt=le.image[0]&&le.image[0].isDataTexture,an=[];for(let X=0;X<6;X++)!xn&&!Nt?an[X]=F(le.image[X],!0,r.maxCubemapSize):an[X]=Nt?le.image[X].image:le.image[X],an[X]=Yt(le,an[X]);const at=an[0],tn=l.convert(le.format,le.colorSpace),Kt=l.convert(le.type),On=V(le.internalFormat,tn,Kt,le.colorSpace),Un=le.isVideoTexture!==!0,dt=St.__version===void 0||rt===!0,Ht=mt.dataReady;let jt=O(le,at);tt(n.TEXTURE_CUBE_MAP,le);let Jt;if(xn){Un&&dt&&t.texStorage2D(n.TEXTURE_CUBE_MAP,jt,On,at.width,at.height);for(let X=0;X<6;X++){Jt=an[X].mipmaps;for(let Oe=0;Oe<Jt.length;Oe++){const pt=Jt[Oe];le.format!==_o?tn!==null?Un?Ht&&t.compressedTexSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe,0,0,pt.width,pt.height,tn,pt.data):t.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe,On,pt.width,pt.height,0,pt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe,0,0,pt.width,pt.height,tn,Kt,pt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe,On,pt.width,pt.height,0,tn,Kt,pt.data)}}}else{if(Jt=le.mipmaps,Un&&dt){Jt.length>0&&jt++;const X=Gn(an[0]);t.texStorage2D(n.TEXTURE_CUBE_MAP,jt,On,X.width,X.height)}for(let X=0;X<6;X++)if(Nt){Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,an[X].width,an[X].height,tn,Kt,an[X].data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,On,an[X].width,an[X].height,0,tn,Kt,an[X].data);for(let Oe=0;Oe<Jt.length;Oe++){const Dt=Jt[Oe].image[X].image;Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe+1,0,0,Dt.width,Dt.height,tn,Kt,Dt.data):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe+1,On,Dt.width,Dt.height,0,tn,Kt,Dt.data)}}else{Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,0,0,tn,Kt,an[X]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,0,On,tn,Kt,an[X]);for(let Oe=0;Oe<Jt.length;Oe++){const pt=Jt[Oe];Un?Ht&&t.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe+1,0,0,tn,Kt,pt.image[X]):t.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+X,Oe+1,On,tn,Kt,pt.image[X])}}}k(le)&&C(n.TEXTURE_CUBE_MAP),St.__version=mt.version,le.onUpdate&&le.onUpdate(le)}ie.__version=le.version}function nt(ie,le,st,rt,mt,St){const _n=l.convert(st.format,st.colorSpace),Mt=l.convert(st.type),hn=V(st.internalFormat,_n,Mt,st.colorSpace);if(!i.get(le).__hasExternalTextures){const Nt=Math.max(1,le.width>>St),an=Math.max(1,le.height>>St);mt===n.TEXTURE_3D||mt===n.TEXTURE_2D_ARRAY?t.texImage3D(mt,St,hn,Nt,an,le.depth,0,_n,Mt,null):t.texImage2D(mt,St,hn,Nt,an,0,_n,Mt,null)}t.bindFramebuffer(n.FRAMEBUFFER,ie),yn(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,rt,mt,i.get(st).__webglTexture,0,An(le)):(mt===n.TEXTURE_2D||mt>=n.TEXTURE_CUBE_MAP_POSITIVE_X&&mt<=n.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&n.framebufferTexture2D(n.FRAMEBUFFER,rt,mt,i.get(st).__webglTexture,St),t.bindFramebuffer(n.FRAMEBUFFER,null)}function wt(ie,le,st){if(n.bindRenderbuffer(n.RENDERBUFFER,ie),le.depthBuffer&&!le.stencilBuffer){let rt=n.DEPTH_COMPONENT24;if(st||yn(le)){const mt=le.depthTexture;mt&&mt.isDepthTexture&&(mt.type===_c?rt=n.DEPTH_COMPONENT32F:mt.type===Yd&&(rt=n.DEPTH_COMPONENT24));const St=An(le);yn(le)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,St,rt,le.width,le.height):n.renderbufferStorageMultisample(n.RENDERBUFFER,St,rt,le.width,le.height)}else n.renderbufferStorage(n.RENDERBUFFER,rt,le.width,le.height);n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.RENDERBUFFER,ie)}else if(le.depthBuffer&&le.stencilBuffer){const rt=An(le);st&&yn(le)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,rt,n.DEPTH24_STENCIL8,le.width,le.height):yn(le)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,rt,n.DEPTH24_STENCIL8,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,le.width,le.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,ie)}else{const rt=le.textures;for(let mt=0;mt<rt.length;mt++){const St=rt[mt],_n=l.convert(St.format,St.colorSpace),Mt=l.convert(St.type),hn=V(St.internalFormat,_n,Mt,St.colorSpace),xn=An(le);st&&yn(le)===!1?n.renderbufferStorageMultisample(n.RENDERBUFFER,xn,hn,le.width,le.height):yn(le)?o.renderbufferStorageMultisampleEXT(n.RENDERBUFFER,xn,hn,le.width,le.height):n.renderbufferStorage(n.RENDERBUFFER,hn,le.width,le.height)}}n.bindRenderbuffer(n.RENDERBUFFER,null)}function Ft(ie,le){if(le&&le.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(n.FRAMEBUFFER,ie),!(le.depthTexture&&le.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");(!i.get(le.depthTexture).__webglTexture||le.depthTexture.image.width!==le.width||le.depthTexture.image.height!==le.height)&&(le.depthTexture.image.width=le.width,le.depthTexture.image.height=le.height,le.depthTexture.needsUpdate=!0),Ae(le.depthTexture,0);const rt=i.get(le.depthTexture).__webglTexture,mt=An(le);if(le.depthTexture.format===Fd)yn(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,rt,0,mt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,rt,0);else if(le.depthTexture.format===Rp)yn(le)?o.framebufferTexture2DMultisampleEXT(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,rt,0,mt):n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.TEXTURE_2D,rt,0);else throw new Error("Unknown depthTexture format")}function At(ie){const le=i.get(ie),st=ie.isWebGLCubeRenderTarget===!0;if(ie.depthTexture&&!le.__autoAllocateDepthBuffer){if(st)throw new Error("target.depthTexture not supported in Cube render targets");Ft(le.__webglFramebuffer,ie)}else if(st){le.__webglDepthbuffer=[];for(let rt=0;rt<6;rt++)t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer[rt]),le.__webglDepthbuffer[rt]=n.createRenderbuffer(),wt(le.__webglDepthbuffer[rt],ie,!1)}else t.bindFramebuffer(n.FRAMEBUFFER,le.__webglFramebuffer),le.__webglDepthbuffer=n.createRenderbuffer(),wt(le.__webglDepthbuffer,ie,!1);t.bindFramebuffer(n.FRAMEBUFFER,null)}function gn(ie,le,st){const rt=i.get(ie);le!==void 0&&nt(rt.__webglFramebuffer,ie,ie.texture,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,0),st!==void 0&&At(ie)}function En(ie){const le=ie.texture,st=i.get(ie),rt=i.get(le);ie.addEventListener("dispose",ue);const mt=ie.textures,St=ie.isWebGLCubeRenderTarget===!0,_n=mt.length>1;if(_n||(rt.__webglTexture===void 0&&(rt.__webglTexture=n.createTexture()),rt.__version=le.version,h.memory.textures++),St){st.__webglFramebuffer=[];for(let Mt=0;Mt<6;Mt++)if(le.mipmaps&&le.mipmaps.length>0){st.__webglFramebuffer[Mt]=[];for(let hn=0;hn<le.mipmaps.length;hn++)st.__webglFramebuffer[Mt][hn]=n.createFramebuffer()}else st.__webglFramebuffer[Mt]=n.createFramebuffer()}else{if(le.mipmaps&&le.mipmaps.length>0){st.__webglFramebuffer=[];for(let Mt=0;Mt<le.mipmaps.length;Mt++)st.__webglFramebuffer[Mt]=n.createFramebuffer()}else st.__webglFramebuffer=n.createFramebuffer();if(_n)for(let Mt=0,hn=mt.length;Mt<hn;Mt++){const xn=i.get(mt[Mt]);xn.__webglTexture===void 0&&(xn.__webglTexture=n.createTexture(),h.memory.textures++)}if(ie.samples>0&&yn(ie)===!1){st.__webglMultisampledFramebuffer=n.createFramebuffer(),st.__webglColorRenderbuffer=[],t.bindFramebuffer(n.FRAMEBUFFER,st.__webglMultisampledFramebuffer);for(let Mt=0;Mt<mt.length;Mt++){const hn=mt[Mt];st.__webglColorRenderbuffer[Mt]=n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,st.__webglColorRenderbuffer[Mt]);const xn=l.convert(hn.format,hn.colorSpace),Nt=l.convert(hn.type),an=V(hn.internalFormat,xn,Nt,hn.colorSpace,ie.isXRRenderTarget===!0),at=An(ie);n.renderbufferStorageMultisample(n.RENDERBUFFER,at,an,ie.width,ie.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+Mt,n.RENDERBUFFER,st.__webglColorRenderbuffer[Mt])}n.bindRenderbuffer(n.RENDERBUFFER,null),ie.depthBuffer&&(st.__webglDepthRenderbuffer=n.createRenderbuffer(),wt(st.__webglDepthRenderbuffer,ie,!0)),t.bindFramebuffer(n.FRAMEBUFFER,null)}}if(St){t.bindTexture(n.TEXTURE_CUBE_MAP,rt.__webglTexture),tt(n.TEXTURE_CUBE_MAP,le);for(let Mt=0;Mt<6;Mt++)if(le.mipmaps&&le.mipmaps.length>0)for(let hn=0;hn<le.mipmaps.length;hn++)nt(st.__webglFramebuffer[Mt][hn],ie,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,hn);else nt(st.__webglFramebuffer[Mt],ie,le,n.COLOR_ATTACHMENT0,n.TEXTURE_CUBE_MAP_POSITIVE_X+Mt,0);k(le)&&C(n.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(_n){for(let Mt=0,hn=mt.length;Mt<hn;Mt++){const xn=mt[Mt],Nt=i.get(xn);t.bindTexture(n.TEXTURE_2D,Nt.__webglTexture),tt(n.TEXTURE_2D,xn),nt(st.__webglFramebuffer,ie,xn,n.COLOR_ATTACHMENT0+Mt,n.TEXTURE_2D,0),k(xn)&&C(n.TEXTURE_2D)}t.unbindTexture()}else{let Mt=n.TEXTURE_2D;if((ie.isWebGL3DRenderTarget||ie.isWebGLArrayRenderTarget)&&(Mt=ie.isWebGL3DRenderTarget?n.TEXTURE_3D:n.TEXTURE_2D_ARRAY),t.bindTexture(Mt,rt.__webglTexture),tt(Mt,le),le.mipmaps&&le.mipmaps.length>0)for(let hn=0;hn<le.mipmaps.length;hn++)nt(st.__webglFramebuffer[hn],ie,le,n.COLOR_ATTACHMENT0,Mt,hn);else nt(st.__webglFramebuffer,ie,le,n.COLOR_ATTACHMENT0,Mt,0);k(le)&&C(Mt),t.unbindTexture()}ie.depthBuffer&&At(ie)}function In(ie){const le=ie.textures;for(let st=0,rt=le.length;st<rt;st++){const mt=le[st];if(k(mt)){const St=ie.isWebGLCubeRenderTarget?n.TEXTURE_CUBE_MAP:n.TEXTURE_2D,_n=i.get(mt).__webglTexture;t.bindTexture(St,_n),C(St),t.unbindTexture()}}}function je(ie){if(ie.samples>0&&yn(ie)===!1){const le=ie.textures,st=ie.width,rt=ie.height;let mt=n.COLOR_BUFFER_BIT;const St=[],_n=ie.stencilBuffer?n.DEPTH_STENCIL_ATTACHMENT:n.DEPTH_ATTACHMENT,Mt=i.get(ie),hn=le.length>1;if(hn)for(let xn=0;xn<le.length;xn++)t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.RENDERBUFFER,null),t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.TEXTURE_2D,null,0);t.bindFramebuffer(n.READ_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Mt.__webglFramebuffer);for(let xn=0;xn<le.length;xn++){St.push(n.COLOR_ATTACHMENT0+xn),ie.depthBuffer&&St.push(_n);const Nt=Mt.__ignoreDepthValues!==void 0?Mt.__ignoreDepthValues:!1;if(Nt===!1&&(ie.depthBuffer&&(mt|=n.DEPTH_BUFFER_BIT),ie.stencilBuffer&&Mt.__isTransmissionRenderTarget!==!0&&(mt|=n.STENCIL_BUFFER_BIT)),hn&&n.framebufferRenderbuffer(n.READ_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,Mt.__webglColorRenderbuffer[xn]),Nt===!0&&(n.invalidateFramebuffer(n.READ_FRAMEBUFFER,[_n]),n.invalidateFramebuffer(n.DRAW_FRAMEBUFFER,[_n])),hn){const an=i.get(le[xn]).__webglTexture;n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,an,0)}n.blitFramebuffer(0,0,st,rt,0,0,st,rt,mt,n.NEAREST),p&&n.invalidateFramebuffer(n.READ_FRAMEBUFFER,St)}if(t.bindFramebuffer(n.READ_FRAMEBUFFER,null),t.bindFramebuffer(n.DRAW_FRAMEBUFFER,null),hn)for(let xn=0;xn<le.length;xn++){t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglMultisampledFramebuffer),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.RENDERBUFFER,Mt.__webglColorRenderbuffer[xn]);const Nt=i.get(le[xn]).__webglTexture;t.bindFramebuffer(n.FRAMEBUFFER,Mt.__webglFramebuffer),n.framebufferTexture2D(n.DRAW_FRAMEBUFFER,n.COLOR_ATTACHMENT0+xn,n.TEXTURE_2D,Nt,0)}t.bindFramebuffer(n.DRAW_FRAMEBUFFER,Mt.__webglMultisampledFramebuffer)}}function An(ie){return Math.min(r.maxSamples,ie.samples)}function yn(ie){const le=i.get(ie);return ie.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&le.__useRenderToTexture!==!1}function Qn(ie){const le=h.render.frame;x.get(ie)!==le&&(x.set(ie,le),ie.update())}function Yt(ie,le){const st=ie.colorSpace,rt=ie.format,mt=ie.type;return ie.isCompressedTexture===!0||ie.isVideoTexture===!0||st!==Gc&&st!==gc&&(Mi.getTransfer(st)===Bi?(rt!==_o||mt!==Ic)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",st)),le}function Gn(ie){return typeof HTMLImageElement<"u"&&ie instanceof HTMLImageElement?(v.width=ie.naturalWidth||ie.width,v.height=ie.naturalHeight||ie.height):typeof VideoFrame<"u"&&ie instanceof VideoFrame?(v.width=ie.displayWidth,v.height=ie.displayHeight):(v.width=ie.width,v.height=ie.height),v}this.allocateTextureUnit=Me,this.resetTextureUnits=ee,this.setTexture2D=Ae,this.setTexture2DArray=He,this.setTexture3D=ot,this.setTextureCube=ft,this.rebindTextures=gn,this.setupRenderTarget=En,this.updateRenderTargetMipmap=In,this.updateMultisampleRenderTarget=je,this.setupDepthRenderbuffer=At,this.setupFrameBufferTexture=nt,this.useMultisampledRTT=yn}function vU(n,e){function t(i,r=gc){let l;const h=Mi.getTransfer(r);if(i===Ic)return n.UNSIGNED_BYTE;if(i===WA)return n.UNSIGNED_SHORT_4_4_4_4;if(i===qA)return n.UNSIGNED_SHORT_5_5_5_1;if(i===FL)return n.UNSIGNED_INT_5_9_9_9_REV;if(i===LL)return n.BYTE;if(i===zL)return n.SHORT;if(i===GA)return n.UNSIGNED_SHORT;if(i===jA)return n.INT;if(i===Yd)return n.UNSIGNED_INT;if(i===_c)return n.FLOAT;if(i===ry)return n.HALF_FLOAT;if(i===NL)return n.ALPHA;if(i===BL)return n.RGB;if(i===_o)return n.RGBA;if(i===OL)return n.LUMINANCE;if(i===UL)return n.LUMINANCE_ALPHA;if(i===Fd)return n.DEPTH_COMPONENT;if(i===Rp)return n.DEPTH_STENCIL;if(i===VL)return n.RED;if(i===$A)return n.RED_INTEGER;if(i===HL)return n.RG;if(i===XA)return n.RG_INTEGER;if(i===ZA)return n.RGBA_INTEGER;if(i===$_||i===X_||i===Z_||i===Y_)if(h===Bi)if(l=e.get("WEBGL_compressed_texture_s3tc_srgb"),l!==null){if(i===$_)return l.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(i===X_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(i===Z_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(i===Y_)return l.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(l=e.get("WEBGL_compressed_texture_s3tc"),l!==null){if(i===$_)return l.COMPRESSED_RGB_S3TC_DXT1_EXT;if(i===X_)return l.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(i===Z_)return l.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(i===Y_)return l.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(i===M5||i===T5||i===E5||i===A5)if(l=e.get("WEBGL_compressed_texture_pvrtc"),l!==null){if(i===M5)return l.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(i===T5)return l.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(i===E5)return l.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(i===A5)return l.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(i===YA)return l=e.get("WEBGL_compressed_texture_etc1"),l!==null?l.COMPRESSED_RGB_ETC1_WEBGL:null;if(i===C5||i===P5)if(l=e.get("WEBGL_compressed_texture_etc"),l!==null){if(i===C5)return h===Bi?l.COMPRESSED_SRGB8_ETC2:l.COMPRESSED_RGB8_ETC2;if(i===P5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:l.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(i===R5||i===I5||i===k5||i===D5||i===L5||i===z5||i===F5||i===N5||i===B5||i===O5||i===U5||i===V5||i===H5||i===G5)if(l=e.get("WEBGL_compressed_texture_astc"),l!==null){if(i===R5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:l.COMPRESSED_RGBA_ASTC_4x4_KHR;if(i===I5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:l.COMPRESSED_RGBA_ASTC_5x4_KHR;if(i===k5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:l.COMPRESSED_RGBA_ASTC_5x5_KHR;if(i===D5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:l.COMPRESSED_RGBA_ASTC_6x5_KHR;if(i===L5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:l.COMPRESSED_RGBA_ASTC_6x6_KHR;if(i===z5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:l.COMPRESSED_RGBA_ASTC_8x5_KHR;if(i===F5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:l.COMPRESSED_RGBA_ASTC_8x6_KHR;if(i===N5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:l.COMPRESSED_RGBA_ASTC_8x8_KHR;if(i===B5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:l.COMPRESSED_RGBA_ASTC_10x5_KHR;if(i===O5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:l.COMPRESSED_RGBA_ASTC_10x6_KHR;if(i===U5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:l.COMPRESSED_RGBA_ASTC_10x8_KHR;if(i===V5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:l.COMPRESSED_RGBA_ASTC_10x10_KHR;if(i===H5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:l.COMPRESSED_RGBA_ASTC_12x10_KHR;if(i===G5)return h===Bi?l.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:l.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(i===K_||i===j5||i===W5)if(l=e.get("EXT_texture_compression_bptc"),l!==null){if(i===K_)return h===Bi?l.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:l.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(i===j5)return l.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(i===W5)return l.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(i===GL||i===q5||i===$5||i===X5)if(l=e.get("EXT_texture_compression_rgtc"),l!==null){if(i===K_)return l.COMPRESSED_RED_RGTC1_EXT;if(i===q5)return l.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(i===$5)return l.COMPRESSED_RED_GREEN_RGTC2_EXT;if(i===X5)return l.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return i===Xp?n.UNSIGNED_INT_24_8:n[i]!==void 0?n[i]:null}return{convert:t}}class _U extends ys{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e}}class j0 extends es{constructor(){super(),this.isGroup=!0,this.type="Group"}}const xU={type:"move"};class wx{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new j0,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new j0,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new it,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new it),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new j0,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new it,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new it),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const i of e.hand.values())this._getHandJoint(t,i)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,i){let r=null,l=null,h=null;const o=this._targetRay,p=this._grip,v=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(v&&e.hand){h=!0;for(const F of e.hand.values()){const k=t.getJointPose(F,i),C=this._getHandJoint(v,F);k!==null&&(C.matrix.fromArray(k.transform.matrix),C.matrix.decompose(C.position,C.rotation,C.scale),C.matrixWorldNeedsUpdate=!0,C.jointRadius=k.radius),C.visible=k!==null}const x=v.joints["index-finger-tip"],M=v.joints["thumb-tip"],S=x.position.distanceTo(M.position),A=.02,L=.005;v.inputState.pinching&&S>A+L?(v.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!v.inputState.pinching&&S<=A-L&&(v.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else p!==null&&e.gripSpace&&(l=t.getPose(e.gripSpace,i),l!==null&&(p.matrix.fromArray(l.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.matrixWorldNeedsUpdate=!0,l.linearVelocity?(p.hasLinearVelocity=!0,p.linearVelocity.copy(l.linearVelocity)):p.hasLinearVelocity=!1,l.angularVelocity?(p.hasAngularVelocity=!0,p.angularVelocity.copy(l.angularVelocity)):p.hasAngularVelocity=!1));o!==null&&(r=t.getPose(e.targetRaySpace,i),r===null&&l!==null&&(r=l),r!==null&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),o.matrixWorldNeedsUpdate=!0,r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(xU)))}return o!==null&&(o.visible=r!==null),p!==null&&(p.visible=l!==null),v!==null&&(v.visible=h!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const i=new j0;i.matrixAutoUpdate=!1,i.visible=!1,e.joints[t.jointName]=i,e.add(i)}return e.joints[t.jointName]}}const bU=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,wU=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class SU{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,i){if(this.texture===null){const r=new xa,l=e.properties.get(r);l.__webglTexture=t.texture,(t.depthNear!=i.depthNear||t.depthFar!=i.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=r}}render(e,t){if(this.texture!==null){if(this.mesh===null){const i=t.cameras[0].viewport,r=new bs({vertexShader:bU,fragmentShader:wU,uniforms:{depthColor:{value:this.texture},depthWidth:{value:i.z},depthHeight:{value:i.w}}});this.mesh=new Ja(new Kp(20,20),r)}e.render(this.mesh,t)}}reset(){this.texture=null,this.mesh=null}}class MU extends Ju{constructor(e,t){super();const i=this;let r=null,l=1,h=null,o="local-floor",p=1,v=null,x=null,M=null,S=null,A=null,L=null;const F=new SU,k=t.getContextAttributes();let C=null,V=null;const O=[],J=[],ue=new $n;let Y=null;const Q=new ys;Q.layers.enable(1),Q.viewport=new Ur;const xe=new ys;xe.layers.enable(2),xe.viewport=new Ur;const re=[Q,xe],ee=new _U;ee.layers.enable(1),ee.layers.enable(2);let Me=null,Fe=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(nt){let wt=O[nt];return wt===void 0&&(wt=new wx,O[nt]=wt),wt.getTargetRaySpace()},this.getControllerGrip=function(nt){let wt=O[nt];return wt===void 0&&(wt=new wx,O[nt]=wt),wt.getGripSpace()},this.getHand=function(nt){let wt=O[nt];return wt===void 0&&(wt=new wx,O[nt]=wt),wt.getHandSpace()};function Ae(nt){const wt=J.indexOf(nt.inputSource);if(wt===-1)return;const Ft=O[wt];Ft!==void 0&&(Ft.update(nt.inputSource,nt.frame,v||h),Ft.dispatchEvent({type:nt.type,data:nt.inputSource}))}function He(){r.removeEventListener("select",Ae),r.removeEventListener("selectstart",Ae),r.removeEventListener("selectend",Ae),r.removeEventListener("squeeze",Ae),r.removeEventListener("squeezestart",Ae),r.removeEventListener("squeezeend",Ae),r.removeEventListener("end",He),r.removeEventListener("inputsourceschange",ot);for(let nt=0;nt<O.length;nt++){const wt=J[nt];wt!==null&&(J[nt]=null,O[nt].disconnect(wt))}Me=null,Fe=null,F.reset(),e.setRenderTarget(C),A=null,S=null,M=null,r=null,V=null,Cn.stop(),i.isPresenting=!1,e.setPixelRatio(Y),e.setSize(ue.width,ue.height,!1),i.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(nt){l=nt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(nt){o=nt,i.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return v||h},this.setReferenceSpace=function(nt){v=nt},this.getBaseLayer=function(){return S!==null?S:A},this.getBinding=function(){return M},this.getFrame=function(){return L},this.getSession=function(){return r},this.setSession=async function(nt){if(r=nt,r!==null){if(C=e.getRenderTarget(),r.addEventListener("select",Ae),r.addEventListener("selectstart",Ae),r.addEventListener("selectend",Ae),r.addEventListener("squeeze",Ae),r.addEventListener("squeezestart",Ae),r.addEventListener("squeezeend",Ae),r.addEventListener("end",He),r.addEventListener("inputsourceschange",ot),k.xrCompatible!==!0&&await t.makeXRCompatible(),Y=e.getPixelRatio(),e.getSize(ue),r.renderState.layers===void 0){const wt={antialias:k.antialias,alpha:!0,depth:k.depth,stencil:k.stencil,framebufferScaleFactor:l};A=new XRWebGLLayer(r,t,wt),r.updateRenderState({baseLayer:A}),e.setPixelRatio(1),e.setSize(A.framebufferWidth,A.framebufferHeight,!1),V=new qu(A.framebufferWidth,A.framebufferHeight,{format:_o,type:Ic,colorSpace:e.outputColorSpace,stencilBuffer:k.stencil})}else{let wt=null,Ft=null,At=null;k.depth&&(At=k.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,wt=k.stencil?Rp:Fd,Ft=k.stencil?Xp:Yd);const gn={colorFormat:t.RGBA8,depthFormat:At,scaleFactor:l};M=new XRWebGLBinding(r,t),S=M.createProjectionLayer(gn),r.updateRenderState({layers:[S]}),e.setPixelRatio(1),e.setSize(S.textureWidth,S.textureHeight,!1),V=new qu(S.textureWidth,S.textureHeight,{format:_o,type:Ic,depthTexture:new d8(S.textureWidth,S.textureHeight,Ft,void 0,void 0,void 0,void 0,void 0,void 0,wt),stencilBuffer:k.stencil,colorSpace:e.outputColorSpace,samples:k.antialias?4:0});const En=e.properties.get(V);En.__ignoreDepthValues=S.ignoreDepthValues}V.isXRRenderTarget=!0,this.setFoveation(p),v=null,h=await r.requestReferenceSpace(o),Cn.setContext(r),Cn.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(r!==null)return r.environmentBlendMode};function ot(nt){for(let wt=0;wt<nt.removed.length;wt++){const Ft=nt.removed[wt],At=J.indexOf(Ft);At>=0&&(J[At]=null,O[At].disconnect(Ft))}for(let wt=0;wt<nt.added.length;wt++){const Ft=nt.added[wt];let At=J.indexOf(Ft);if(At===-1){for(let En=0;En<O.length;En++)if(En>=J.length){J.push(Ft),At=En;break}else if(J[En]===null){J[En]=Ft,At=En;break}if(At===-1)break}const gn=O[At];gn&&gn.connect(Ft)}}const ft=new it,ct=new it;function De(nt,wt,Ft){ft.setFromMatrixPosition(wt.matrixWorld),ct.setFromMatrixPosition(Ft.matrixWorld);const At=ft.distanceTo(ct),gn=wt.projectionMatrix.elements,En=Ft.projectionMatrix.elements,In=gn[14]/(gn[10]-1),je=gn[14]/(gn[10]+1),An=(gn[9]+1)/gn[5],yn=(gn[9]-1)/gn[5],Qn=(gn[8]-1)/gn[0],Yt=(En[8]+1)/En[0],Gn=In*Qn,ie=In*Yt,le=At/(-Qn+Yt),st=le*-Qn;wt.matrixWorld.decompose(nt.position,nt.quaternion,nt.scale),nt.translateX(st),nt.translateZ(le),nt.matrixWorld.compose(nt.position,nt.quaternion,nt.scale),nt.matrixWorldInverse.copy(nt.matrixWorld).invert();const rt=In+le,mt=je+le,St=Gn-st,_n=ie+(At-st),Mt=An*je/mt*rt,hn=yn*je/mt*rt;nt.projectionMatrix.makePerspective(St,_n,Mt,hn,rt,mt),nt.projectionMatrixInverse.copy(nt.projectionMatrix).invert()}function Je(nt,wt){wt===null?nt.matrixWorld.copy(nt.matrix):nt.matrixWorld.multiplyMatrices(wt.matrixWorld,nt.matrix),nt.matrixWorldInverse.copy(nt.matrixWorld).invert()}this.updateCamera=function(nt){if(r===null)return;F.texture!==null&&(nt.near=F.depthNear,nt.far=F.depthFar),ee.near=xe.near=Q.near=nt.near,ee.far=xe.far=Q.far=nt.far,(Me!==ee.near||Fe!==ee.far)&&(r.updateRenderState({depthNear:ee.near,depthFar:ee.far}),Me=ee.near,Fe=ee.far,Q.near=Me,Q.far=Fe,xe.near=Me,xe.far=Fe,Q.updateProjectionMatrix(),xe.updateProjectionMatrix(),nt.updateProjectionMatrix());const wt=nt.parent,Ft=ee.cameras;Je(ee,wt);for(let At=0;At<Ft.length;At++)Je(Ft[At],wt);Ft.length===2?De(ee,Q,xe):ee.projectionMatrix.copy(Q.projectionMatrix),tt(nt,ee,wt)};function tt(nt,wt,Ft){Ft===null?nt.matrix.copy(wt.matrixWorld):(nt.matrix.copy(Ft.matrixWorld),nt.matrix.invert(),nt.matrix.multiply(wt.matrixWorld)),nt.matrix.decompose(nt.position,nt.quaternion,nt.scale),nt.updateMatrixWorld(!0),nt.projectionMatrix.copy(wt.projectionMatrix),nt.projectionMatrixInverse.copy(wt.projectionMatrixInverse),nt.isPerspectiveCamera&&(nt.fov=Ip*2*Math.atan(1/nt.projectionMatrix.elements[5]),nt.zoom=1)}this.getCamera=function(){return ee},this.getFoveation=function(){if(!(S===null&&A===null))return p},this.setFoveation=function(nt){p=nt,S!==null&&(S.fixedFoveation=nt),A!==null&&A.fixedFoveation!==void 0&&(A.fixedFoveation=nt)},this.hasDepthSensing=function(){return F.texture!==null};let _t=null;function Lt(nt,wt){if(x=wt.getViewerPose(v||h),L=wt,x!==null){const Ft=x.views;A!==null&&(e.setRenderTargetFramebuffer(V,A.framebuffer),e.setRenderTarget(V));let At=!1;Ft.length!==ee.cameras.length&&(ee.cameras.length=0,At=!0);for(let En=0;En<Ft.length;En++){const In=Ft[En];let je=null;if(A!==null)je=A.getViewport(In);else{const yn=M.getViewSubImage(S,In);je=yn.viewport,En===0&&(e.setRenderTargetTextures(V,yn.colorTexture,S.ignoreDepthValues?void 0:yn.depthStencilTexture),e.setRenderTarget(V))}let An=re[En];An===void 0&&(An=new ys,An.layers.enable(En),An.viewport=new Ur,re[En]=An),An.matrix.fromArray(In.transform.matrix),An.matrix.decompose(An.position,An.quaternion,An.scale),An.projectionMatrix.fromArray(In.projectionMatrix),An.projectionMatrixInverse.copy(An.projectionMatrix).invert(),An.viewport.set(je.x,je.y,je.width,je.height),En===0&&(ee.matrix.copy(An.matrix),ee.matrix.decompose(ee.position,ee.quaternion,ee.scale)),At===!0&&ee.cameras.push(An)}const gn=r.enabledFeatures;if(gn&&gn.includes("depth-sensing")){const En=M.getDepthInformation(Ft[0]);En&&En.isValid&&En.texture&&F.init(e,En,r.renderState)}}for(let Ft=0;Ft<O.length;Ft++){const At=J[Ft],gn=O[Ft];At!==null&&gn!==void 0&&gn.update(At,wt,v||h)}F.render(e,ee),_t&&_t(nt,wt),wt.detectedPlanes&&i.dispatchEvent({type:"planesdetected",data:wt}),L=null}const Cn=new h8;Cn.setAnimationLoop(Lt),this.setAnimationLoop=function(nt){_t=nt},this.dispose=function(){}}}const vu=new xl,TU=new wr;function EU(n,e){function t(k,C){k.matrixAutoUpdate===!0&&k.updateMatrix(),C.value.copy(k.matrix)}function i(k,C){C.color.getRGB(k.fogColor.value,o8(n)),C.isFog?(k.fogNear.value=C.near,k.fogFar.value=C.far):C.isFogExp2&&(k.fogDensity.value=C.density)}function r(k,C,V,O,J){C.isMeshBasicMaterial||C.isMeshLambertMaterial?l(k,C):C.isMeshToonMaterial?(l(k,C),M(k,C)):C.isMeshPhongMaterial?(l(k,C),x(k,C)):C.isMeshStandardMaterial?(l(k,C),S(k,C),C.isMeshPhysicalMaterial&&A(k,C,J)):C.isMeshMatcapMaterial?(l(k,C),L(k,C)):C.isMeshDepthMaterial?l(k,C):C.isMeshDistanceMaterial?(l(k,C),F(k,C)):C.isMeshNormalMaterial?l(k,C):C.isLineBasicMaterial?(h(k,C),C.isLineDashedMaterial&&o(k,C)):C.isPointsMaterial?p(k,C,V,O):C.isSpriteMaterial?v(k,C):C.isShadowMaterial?(k.color.value.copy(C.color),k.opacity.value=C.opacity):C.isShaderMaterial&&(C.uniformsNeedUpdate=!1)}function l(k,C){k.opacity.value=C.opacity,C.color&&k.diffuse.value.copy(C.color),C.emissive&&k.emissive.value.copy(C.emissive).multiplyScalar(C.emissiveIntensity),C.map&&(k.map.value=C.map,t(C.map,k.mapTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,t(C.alphaMap,k.alphaMapTransform)),C.bumpMap&&(k.bumpMap.value=C.bumpMap,t(C.bumpMap,k.bumpMapTransform),k.bumpScale.value=C.bumpScale,C.side===Fa&&(k.bumpScale.value*=-1)),C.normalMap&&(k.normalMap.value=C.normalMap,t(C.normalMap,k.normalMapTransform),k.normalScale.value.copy(C.normalScale),C.side===Fa&&k.normalScale.value.negate()),C.displacementMap&&(k.displacementMap.value=C.displacementMap,t(C.displacementMap,k.displacementMapTransform),k.displacementScale.value=C.displacementScale,k.displacementBias.value=C.displacementBias),C.emissiveMap&&(k.emissiveMap.value=C.emissiveMap,t(C.emissiveMap,k.emissiveMapTransform)),C.specularMap&&(k.specularMap.value=C.specularMap,t(C.specularMap,k.specularMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest);const V=e.get(C),O=V.envMap,J=V.envMapRotation;if(O&&(k.envMap.value=O,vu.copy(J),vu.x*=-1,vu.y*=-1,vu.z*=-1,O.isCubeTexture&&O.isRenderTargetTexture===!1&&(vu.y*=-1,vu.z*=-1),k.envMapRotation.value.setFromMatrix4(TU.makeRotationFromEuler(vu)),k.flipEnvMap.value=O.isCubeTexture&&O.isRenderTargetTexture===!1?-1:1,k.reflectivity.value=C.reflectivity,k.ior.value=C.ior,k.refractionRatio.value=C.refractionRatio),C.lightMap){k.lightMap.value=C.lightMap;const ue=n._useLegacyLights===!0?Math.PI:1;k.lightMapIntensity.value=C.lightMapIntensity*ue,t(C.lightMap,k.lightMapTransform)}C.aoMap&&(k.aoMap.value=C.aoMap,k.aoMapIntensity.value=C.aoMapIntensity,t(C.aoMap,k.aoMapTransform))}function h(k,C){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,C.map&&(k.map.value=C.map,t(C.map,k.mapTransform))}function o(k,C){k.dashSize.value=C.dashSize,k.totalSize.value=C.dashSize+C.gapSize,k.scale.value=C.scale}function p(k,C,V,O){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,k.size.value=C.size*V,k.scale.value=O*.5,C.map&&(k.map.value=C.map,t(C.map,k.uvTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,t(C.alphaMap,k.alphaMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest)}function v(k,C){k.diffuse.value.copy(C.color),k.opacity.value=C.opacity,k.rotation.value=C.rotation,C.map&&(k.map.value=C.map,t(C.map,k.mapTransform)),C.alphaMap&&(k.alphaMap.value=C.alphaMap,t(C.alphaMap,k.alphaMapTransform)),C.alphaTest>0&&(k.alphaTest.value=C.alphaTest)}function x(k,C){k.specular.value.copy(C.specular),k.shininess.value=Math.max(C.shininess,1e-4)}function M(k,C){C.gradientMap&&(k.gradientMap.value=C.gradientMap)}function S(k,C){k.metalness.value=C.metalness,C.metalnessMap&&(k.metalnessMap.value=C.metalnessMap,t(C.metalnessMap,k.metalnessMapTransform)),k.roughness.value=C.roughness,C.roughnessMap&&(k.roughnessMap.value=C.roughnessMap,t(C.roughnessMap,k.roughnessMapTransform)),C.envMap&&(k.envMapIntensity.value=C.envMapIntensity)}function A(k,C,V){k.ior.value=C.ior,C.sheen>0&&(k.sheenColor.value.copy(C.sheenColor).multiplyScalar(C.sheen),k.sheenRoughness.value=C.sheenRoughness,C.sheenColorMap&&(k.sheenColorMap.value=C.sheenColorMap,t(C.sheenColorMap,k.sheenColorMapTransform)),C.sheenRoughnessMap&&(k.sheenRoughnessMap.value=C.sheenRoughnessMap,t(C.sheenRoughnessMap,k.sheenRoughnessMapTransform))),C.clearcoat>0&&(k.clearcoat.value=C.clearcoat,k.clearcoatRoughness.value=C.clearcoatRoughness,C.clearcoatMap&&(k.clearcoatMap.value=C.clearcoatMap,t(C.clearcoatMap,k.clearcoatMapTransform)),C.clearcoatRoughnessMap&&(k.clearcoatRoughnessMap.value=C.clearcoatRoughnessMap,t(C.clearcoatRoughnessMap,k.clearcoatRoughnessMapTransform)),C.clearcoatNormalMap&&(k.clearcoatNormalMap.value=C.clearcoatNormalMap,t(C.clearcoatNormalMap,k.clearcoatNormalMapTransform),k.clearcoatNormalScale.value.copy(C.clearcoatNormalScale),C.side===Fa&&k.clearcoatNormalScale.value.negate())),C.iridescence>0&&(k.iridescence.value=C.iridescence,k.iridescenceIOR.value=C.iridescenceIOR,k.iridescenceThicknessMinimum.value=C.iridescenceThicknessRange[0],k.iridescenceThicknessMaximum.value=C.iridescenceThicknessRange[1],C.iridescenceMap&&(k.iridescenceMap.value=C.iridescenceMap,t(C.iridescenceMap,k.iridescenceMapTransform)),C.iridescenceThicknessMap&&(k.iridescenceThicknessMap.value=C.iridescenceThicknessMap,t(C.iridescenceThicknessMap,k.iridescenceThicknessMapTransform))),C.transmission>0&&(k.transmission.value=C.transmission,k.transmissionSamplerMap.value=V.texture,k.transmissionSamplerSize.value.set(V.width,V.height),C.transmissionMap&&(k.transmissionMap.value=C.transmissionMap,t(C.transmissionMap,k.transmissionMapTransform)),k.thickness.value=C.thickness,C.thicknessMap&&(k.thicknessMap.value=C.thicknessMap,t(C.thicknessMap,k.thicknessMapTransform)),k.attenuationDistance.value=C.attenuationDistance,k.attenuationColor.value.copy(C.attenuationColor)),C.anisotropy>0&&(k.anisotropyVector.value.set(C.anisotropy*Math.cos(C.anisotropyRotation),C.anisotropy*Math.sin(C.anisotropyRotation)),C.anisotropyMap&&(k.anisotropyMap.value=C.anisotropyMap,t(C.anisotropyMap,k.anisotropyMapTransform))),k.specularIntensity.value=C.specularIntensity,k.specularColor.value.copy(C.specularColor),C.specularColorMap&&(k.specularColorMap.value=C.specularColorMap,t(C.specularColorMap,k.specularColorMapTransform)),C.specularIntensityMap&&(k.specularIntensityMap.value=C.specularIntensityMap,t(C.specularIntensityMap,k.specularIntensityMapTransform))}function L(k,C){C.matcap&&(k.matcap.value=C.matcap)}function F(k,C){const V=e.get(C).light;k.referencePosition.value.setFromMatrixPosition(V.matrixWorld),k.nearDistance.value=V.shadow.camera.near,k.farDistance.value=V.shadow.camera.far}return{refreshFogUniforms:i,refreshMaterialUniforms:r}}function AU(n,e,t,i){let r={},l={},h=[];const o=n.getParameter(n.MAX_UNIFORM_BUFFER_BINDINGS);function p(V,O){const J=O.program;i.uniformBlockBinding(V,J)}function v(V,O){let J=r[V.id];J===void 0&&(L(V),J=x(V),r[V.id]=J,V.addEventListener("dispose",k));const ue=O.program;i.updateUBOMapping(V,ue);const Y=e.render.frame;l[V.id]!==Y&&(S(V),l[V.id]=Y)}function x(V){const O=M();V.__bindingPointIndex=O;const J=n.createBuffer(),ue=V.__size,Y=V.usage;return n.bindBuffer(n.UNIFORM_BUFFER,J),n.bufferData(n.UNIFORM_BUFFER,ue,Y),n.bindBuffer(n.UNIFORM_BUFFER,null),n.bindBufferBase(n.UNIFORM_BUFFER,O,J),J}function M(){for(let V=0;V<o;V++)if(h.indexOf(V)===-1)return h.push(V),V;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function S(V){const O=r[V.id],J=V.uniforms,ue=V.__cache;n.bindBuffer(n.UNIFORM_BUFFER,O);for(let Y=0,Q=J.length;Y<Q;Y++){const xe=Array.isArray(J[Y])?J[Y]:[J[Y]];for(let re=0,ee=xe.length;re<ee;re++){const Me=xe[re];if(A(Me,Y,re,ue)===!0){const Fe=Me.__offset,Ae=Array.isArray(Me.value)?Me.value:[Me.value];let He=0;for(let ot=0;ot<Ae.length;ot++){const ft=Ae[ot],ct=F(ft);typeof ft=="number"||typeof ft=="boolean"?(Me.__data[0]=ft,n.bufferSubData(n.UNIFORM_BUFFER,Fe+He,Me.__data)):ft.isMatrix3?(Me.__data[0]=ft.elements[0],Me.__data[1]=ft.elements[1],Me.__data[2]=ft.elements[2],Me.__data[3]=0,Me.__data[4]=ft.elements[3],Me.__data[5]=ft.elements[4],Me.__data[6]=ft.elements[5],Me.__data[7]=0,Me.__data[8]=ft.elements[6],Me.__data[9]=ft.elements[7],Me.__data[10]=ft.elements[8],Me.__data[11]=0):(ft.toArray(Me.__data,He),He+=ct.storage/Float32Array.BYTES_PER_ELEMENT)}n.bufferSubData(n.UNIFORM_BUFFER,Fe,Me.__data)}}}n.bindBuffer(n.UNIFORM_BUFFER,null)}function A(V,O,J,ue){const Y=V.value,Q=O+"_"+J;if(ue[Q]===void 0)return typeof Y=="number"||typeof Y=="boolean"?ue[Q]=Y:ue[Q]=Y.clone(),!0;{const xe=ue[Q];if(typeof Y=="number"||typeof Y=="boolean"){if(xe!==Y)return ue[Q]=Y,!0}else if(xe.equals(Y)===!1)return xe.copy(Y),!0}return!1}function L(V){const O=V.uniforms;let J=0;const ue=16;for(let Q=0,xe=O.length;Q<xe;Q++){const re=Array.isArray(O[Q])?O[Q]:[O[Q]];for(let ee=0,Me=re.length;ee<Me;ee++){const Fe=re[ee],Ae=Array.isArray(Fe.value)?Fe.value:[Fe.value];for(let He=0,ot=Ae.length;He<ot;He++){const ft=Ae[He],ct=F(ft),De=J%ue;De!==0&&ue-De<ct.boundary&&(J+=ue-De),Fe.__data=new Float32Array(ct.storage/Float32Array.BYTES_PER_ELEMENT),Fe.__offset=J,J+=ct.storage}}}const Y=J%ue;return Y>0&&(J+=ue-Y),V.__size=J,V.__cache={},this}function F(V){const O={boundary:0,storage:0};return typeof V=="number"||typeof V=="boolean"?(O.boundary=4,O.storage=4):V.isVector2?(O.boundary=8,O.storage=8):V.isVector3||V.isColor?(O.boundary=16,O.storage=12):V.isVector4?(O.boundary=16,O.storage=16):V.isMatrix3?(O.boundary=48,O.storage=48):V.isMatrix4?(O.boundary=64,O.storage=64):V.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",V),O}function k(V){const O=V.target;O.removeEventListener("dispose",k);const J=h.indexOf(O.__bindingPointIndex);h.splice(J,1),n.deleteBuffer(r[O.id]),delete r[O.id],delete l[O.id]}function C(){for(const V in r)n.deleteBuffer(r[V]);h=[],r={},l={}}return{bind:p,update:v,dispose:C}}class CU{constructor(e={}){const{canvas:t=vz(),context:i=null,depth:r=!0,stencil:l=!1,alpha:h=!1,antialias:o=!1,premultipliedAlpha:p=!0,preserveDrawingBuffer:v=!1,powerPreference:x="default",failIfMajorPerformanceCaveat:M=!1}=e;this.isWebGLRenderer=!0;let S;if(i!==null){if(typeof WebGLRenderingContext<"u"&&i instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");S=i.getContextAttributes().alpha}else S=h;const A=new Uint32Array(4),L=new Int32Array(4);let F=null,k=null;const C=[],V=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this._outputColorSpace=uo,this._useLegacyLights=!1,this.toneMapping=Rc,this.toneMappingExposure=1;const O=this;let J=!1,ue=0,Y=0,Q=null,xe=-1,re=null;const ee=new Ur,Me=new Ur;let Fe=null;const Ae=new Ti(0);let He=0,ot=t.width,ft=t.height,ct=1,De=null,Je=null;const tt=new Ur(0,0,ot,ft),_t=new Ur(0,0,ot,ft);let Lt=!1;const Cn=new u8;let nt=!1,wt=!1;const Ft=new wr,At=new $n,gn=new it,En={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function In(){return Q===null?ct:1}let je=i;function An(de,Le){const We=t.getContext(de,Le);return We!==null?We:null}try{const de={alpha:!0,depth:r,stencil:l,antialias:o,premultipliedAlpha:p,preserveDrawingBuffer:v,powerPreference:x,failIfMajorPerformanceCaveat:M};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${vw}`),t.addEventListener("webglcontextlost",Oe,!1),t.addEventListener("webglcontextrestored",pt,!1),t.addEventListener("webglcontextcreationerror",Dt,!1),je===null){const Le="webgl2";if(je=An(Le,de),je===null)throw An(Le)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(de){throw console.error("THREE.WebGLRenderer: "+de.message),de}let yn,Qn,Yt,Gn,ie,le,st,rt,mt,St,_n,Mt,hn,xn,Nt,an,at,tn,Kt,On,Un,dt,Ht,jt;function Jt(){yn=new FB(je),yn.init(),Qn=new PB(je,yn,e),dt=new vU(je,yn),Yt=new gU(je),Gn=new OB(je),ie=new nU,le=new yU(je,yn,Yt,ie,Qn,dt,Gn),st=new IB(O),rt=new zB(O),mt=new jz(je),Ht=new AB(je,mt),St=new NB(je,mt,Gn,Ht),_n=new VB(je,St,mt,Gn),Kt=new UB(je,Qn,le),an=new RB(ie),Mt=new tU(O,st,rt,yn,Qn,Ht,an),hn=new EU(O,ie),xn=new rU,Nt=new uU(yn),tn=new EB(O,st,rt,Yt,_n,S,p),at=new mU(O,_n,Qn),jt=new AU(je,Gn,Qn,Yt),On=new CB(je,yn,Gn),Un=new BB(je,yn,Gn),Gn.programs=Mt.programs,O.capabilities=Qn,O.extensions=yn,O.properties=ie,O.renderLists=xn,O.shadowMap=at,O.state=Yt,O.info=Gn}Jt();const X=new MU(O,je);this.xr=X,this.getContext=function(){return je},this.getContextAttributes=function(){return je.getContextAttributes()},this.forceContextLoss=function(){const de=yn.get("WEBGL_lose_context");de&&de.loseContext()},this.forceContextRestore=function(){const de=yn.get("WEBGL_lose_context");de&&de.restoreContext()},this.getPixelRatio=function(){return ct},this.setPixelRatio=function(de){de!==void 0&&(ct=de,this.setSize(ot,ft,!1))},this.getSize=function(de){return de.set(ot,ft)},this.setSize=function(de,Le,We=!0){if(X.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}ot=de,ft=Le,t.width=Math.floor(de*ct),t.height=Math.floor(Le*ct),We===!0&&(t.style.width=de+"px",t.style.height=Le+"px"),this.setViewport(0,0,de,Le)},this.getDrawingBufferSize=function(de){return de.set(ot*ct,ft*ct).floor()},this.setDrawingBufferSize=function(de,Le,We){ot=de,ft=Le,ct=We,t.width=Math.floor(de*We),t.height=Math.floor(Le*We),this.setViewport(0,0,de,Le)},this.getCurrentViewport=function(de){return de.copy(ee)},this.getViewport=function(de){return de.copy(tt)},this.setViewport=function(de,Le,We,Xe){de.isVector4?tt.set(de.x,de.y,de.z,de.w):tt.set(de,Le,We,Xe),Yt.viewport(ee.copy(tt).multiplyScalar(ct).round())},this.getScissor=function(de){return de.copy(_t)},this.setScissor=function(de,Le,We,Xe){de.isVector4?_t.set(de.x,de.y,de.z,de.w):_t.set(de,Le,We,Xe),Yt.scissor(Me.copy(_t).multiplyScalar(ct).round())},this.getScissorTest=function(){return Lt},this.setScissorTest=function(de){Yt.setScissorTest(Lt=de)},this.setOpaqueSort=function(de){De=de},this.setTransparentSort=function(de){Je=de},this.getClearColor=function(de){return de.copy(tn.getClearColor())},this.setClearColor=function(){tn.setClearColor.apply(tn,arguments)},this.getClearAlpha=function(){return tn.getClearAlpha()},this.setClearAlpha=function(){tn.setClearAlpha.apply(tn,arguments)},this.clear=function(de=!0,Le=!0,We=!0){let Xe=0;if(de){let Ze=!1;if(Q!==null){const Pt=Q.texture.format;Ze=Pt===ZA||Pt===XA||Pt===$A}if(Ze){const Pt=Q.texture.type,rn=Pt===Ic||Pt===Yd||Pt===GA||Pt===Xp||Pt===WA||Pt===qA,It=tn.getClearColor(),Qt=tn.getClearAlpha(),Sn=It.r,Xt=It.g,Fn=It.b;rn?(A[0]=Sn,A[1]=Xt,A[2]=Fn,A[3]=Qt,je.clearBufferuiv(je.COLOR,0,A)):(L[0]=Sn,L[1]=Xt,L[2]=Fn,L[3]=Qt,je.clearBufferiv(je.COLOR,0,L))}else Xe|=je.COLOR_BUFFER_BIT}Le&&(Xe|=je.DEPTH_BUFFER_BIT),We&&(Xe|=je.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),je.clear(Xe)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Oe,!1),t.removeEventListener("webglcontextrestored",pt,!1),t.removeEventListener("webglcontextcreationerror",Dt,!1),xn.dispose(),Nt.dispose(),ie.dispose(),st.dispose(),rt.dispose(),_n.dispose(),Ht.dispose(),jt.dispose(),Mt.dispose(),X.dispose(),X.removeEventListener("sessionstart",Se),X.removeEventListener("sessionend",Ee),ye.stop()};function Oe(de){de.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),J=!0}function pt(){console.log("THREE.WebGLRenderer: Context Restored."),J=!1;const de=Gn.autoReset,Le=at.enabled,We=at.autoUpdate,Xe=at.needsUpdate,Ze=at.type;Jt(),Gn.autoReset=de,at.enabled=Le,at.autoUpdate=We,at.needsUpdate=Xe,at.type=Ze}function Dt(de){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",de.statusMessage)}function ce(de){const Le=de.target;Le.removeEventListener("dispose",ce),B(Le)}function B(de){U(de),ie.remove(de)}function U(de){const Le=ie.get(de).programs;Le!==void 0&&(Le.forEach(function(We){Mt.releaseProgram(We)}),de.isShaderMaterial&&Mt.releaseShaderCache(de))}this.renderBufferDirect=function(de,Le,We,Xe,Ze,Pt){Le===null&&(Le=En);const rn=Ze.isMesh&&Ze.matrixWorld.determinant()<0,It=wn(de,Le,We,Xe,Ze);Yt.setMaterial(Xe,rn);let Qt=We.index,Sn=1;if(Xe.wireframe===!0){if(Qt=St.getWireframeAttribute(We),Qt===void 0)return;Sn=2}const Xt=We.drawRange,Fn=We.attributes.position;let Ei=Xt.start*Sn,gi=(Xt.start+Xt.count)*Sn;Pt!==null&&(Ei=Math.max(Ei,Pt.start*Sn),gi=Math.min(gi,(Pt.start+Pt.count)*Sn)),Qt!==null?(Ei=Math.max(Ei,0),gi=Math.min(gi,Qt.count)):Fn!=null&&(Ei=Math.max(Ei,0),gi=Math.min(gi,Fn.count));const ci=gi-Ei;if(ci<0||ci===1/0)return;Ht.setup(Ze,Xe,It,We,Qt);let Ma,Wn=On;if(Qt!==null&&(Ma=mt.get(Qt),Wn=Un,Wn.setIndex(Ma)),Ze.isMesh)Xe.wireframe===!0?(Yt.setLineWidth(Xe.wireframeLinewidth*In()),Wn.setMode(je.LINES)):Wn.setMode(je.TRIANGLES);else if(Ze.isLine){let Pn=Xe.linewidth;Pn===void 0&&(Pn=1),Yt.setLineWidth(Pn*In()),Ze.isLineSegments?Wn.setMode(je.LINES):Ze.isLineLoop?Wn.setMode(je.LINE_LOOP):Wn.setMode(je.LINE_STRIP)}else Ze.isPoints?Wn.setMode(je.POINTS):Ze.isSprite&&Wn.setMode(je.TRIANGLES);if(Ze.isBatchedMesh)Wn.renderMultiDraw(Ze._multiDrawStarts,Ze._multiDrawCounts,Ze._multiDrawCount);else if(Ze.isInstancedMesh)Wn.renderInstances(Ei,ci,Ze.count);else if(We.isInstancedBufferGeometry){const Pn=We._maxInstanceCount!==void 0?We._maxInstanceCount:1/0,Al=Math.min(We.instanceCount,Pn);Wn.renderInstances(Ei,ci,Al)}else Wn.render(Ei,ci)};function q(de,Le,We){de.transparent===!0&&de.side===go&&de.forceSinglePass===!1?(de.side=Fa,de.needsUpdate=!0,nn(de,Le,We),de.side=Lc,de.needsUpdate=!0,nn(de,Le,We),de.side=go):nn(de,Le,We)}this.compile=function(de,Le,We=null){We===null&&(We=de),k=Nt.get(We),k.init(),V.push(k),We.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Le.layers)&&(k.pushLight(Ze),Ze.castShadow&&k.pushShadow(Ze))}),de!==We&&de.traverseVisible(function(Ze){Ze.isLight&&Ze.layers.test(Le.layers)&&(k.pushLight(Ze),Ze.castShadow&&k.pushShadow(Ze))}),k.setupLights(O._useLegacyLights);const Xe=new Set;return de.traverse(function(Ze){const Pt=Ze.material;if(Pt)if(Array.isArray(Pt))for(let rn=0;rn<Pt.length;rn++){const It=Pt[rn];q(It,We,Ze),Xe.add(It)}else q(Pt,We,Ze),Xe.add(Pt)}),V.pop(),k=null,Xe},this.compileAsync=function(de,Le,We=null){const Xe=this.compile(de,Le,We);return new Promise(Ze=>{function Pt(){if(Xe.forEach(function(rn){ie.get(rn).currentProgram.isReady()&&Xe.delete(rn)}),Xe.size===0){Ze(de);return}setTimeout(Pt,10)}yn.get("KHR_parallel_shader_compile")!==null?Pt():setTimeout(Pt,10)})};let ne=null;function me(de){ne&&ne(de)}function Se(){ye.stop()}function Ee(){ye.start()}const ye=new h8;ye.setAnimationLoop(me),typeof self<"u"&&ye.setContext(self),this.setAnimationLoop=function(de){ne=de,X.setAnimationLoop(de),de===null?ye.stop():ye.start()},X.addEventListener("sessionstart",Se),X.addEventListener("sessionend",Ee),this.render=function(de,Le){if(Le!==void 0&&Le.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(J===!0)return;de.matrixWorldAutoUpdate===!0&&de.updateMatrixWorld(),Le.parent===null&&Le.matrixWorldAutoUpdate===!0&&Le.updateMatrixWorld(),X.enabled===!0&&X.isPresenting===!0&&(X.cameraAutoUpdate===!0&&X.updateCamera(Le),Le=X.getCamera()),de.isScene===!0&&de.onBeforeRender(O,de,Le,Q),k=Nt.get(de,V.length),k.init(),V.push(k),Ft.multiplyMatrices(Le.projectionMatrix,Le.matrixWorldInverse),Cn.setFromProjectionMatrix(Ft),wt=this.localClippingEnabled,nt=an.init(this.clippingPlanes,wt),F=xn.get(de,C.length),F.init(),C.push(F),Re(de,Le,0,O.sortObjects),F.finish(),O.sortObjects===!0&&F.sort(De,Je),this.info.render.frame++,nt===!0&&an.beginShadows();const We=k.state.shadowsArray;if(at.render(We,de,Le),nt===!0&&an.endShadows(),this.info.autoReset===!0&&this.info.reset(),(X.enabled===!1||X.isPresenting===!1||X.hasDepthSensing()===!1)&&tn.render(F,de),k.setupLights(O._useLegacyLights),Le.isArrayCamera){const Xe=Le.cameras;for(let Ze=0,Pt=Xe.length;Ze<Pt;Ze++){const rn=Xe[Ze];qe(F,de,rn,rn.viewport)}}else qe(F,de,Le);Q!==null&&(le.updateMultisampleRenderTarget(Q),le.updateRenderTargetMipmap(Q)),de.isScene===!0&&de.onAfterRender(O,de,Le),Ht.resetDefaultState(),xe=-1,re=null,V.pop(),V.length>0?k=V[V.length-1]:k=null,C.pop(),C.length>0?F=C[C.length-1]:F=null};function Re(de,Le,We,Xe){if(de.visible===!1)return;if(de.layers.test(Le.layers)){if(de.isGroup)We=de.renderOrder;else if(de.isLOD)de.autoUpdate===!0&&de.update(Le);else if(de.isLight)k.pushLight(de),de.castShadow&&k.pushShadow(de);else if(de.isSprite){if(!de.frustumCulled||Cn.intersectsSprite(de)){Xe&&gn.setFromMatrixPosition(de.matrixWorld).applyMatrix4(Ft);const rn=_n.update(de),It=de.material;It.visible&&F.push(de,rn,It,We,gn.z,null)}}else if((de.isMesh||de.isLine||de.isPoints)&&(!de.frustumCulled||Cn.intersectsObject(de))){const rn=_n.update(de),It=de.material;if(Xe&&(de.boundingSphere!==void 0?(de.boundingSphere===null&&de.computeBoundingSphere(),gn.copy(de.boundingSphere.center)):(rn.boundingSphere===null&&rn.computeBoundingSphere(),gn.copy(rn.boundingSphere.center)),gn.applyMatrix4(de.matrixWorld).applyMatrix4(Ft)),Array.isArray(It)){const Qt=rn.groups;for(let Sn=0,Xt=Qt.length;Sn<Xt;Sn++){const Fn=Qt[Sn],Ei=It[Fn.materialIndex];Ei&&Ei.visible&&F.push(de,rn,Ei,We,gn.z,Fn)}}else It.visible&&F.push(de,rn,It,We,gn.z,null)}}const Pt=de.children;for(let rn=0,It=Pt.length;rn<It;rn++)Re(Pt[rn],Le,We,Xe)}function qe(de,Le,We,Xe){const Ze=de.opaque,Pt=de.transmissive,rn=de.transparent;k.setupLightsView(We),nt===!0&&an.setGlobalState(O.clippingPlanes,We),Pt.length>0&&Ye(Ze,Pt,Le,We),Xe&&Yt.viewport(ee.copy(Xe)),Ze.length>0&&Ge(Ze,Le,We),Pt.length>0&&Ge(Pt,Le,We),rn.length>0&&Ge(rn,Le,We),Yt.buffers.depth.setTest(!0),Yt.buffers.depth.setMask(!0),Yt.buffers.color.setMask(!0),Yt.setPolygonOffset(!1)}function Ye(de,Le,We,Xe){if((We.isScene===!0?We.overrideMaterial:null)!==null)return;if(k.state.transmissionRenderTarget===null){k.state.transmissionRenderTarget=new qu(1,1,{generateMipmaps:!0,type:yn.has("EXT_color_buffer_half_float")||yn.has("EXT_color_buffer_float")?ry:Ic,minFilter:Lu,samples:4,stencilBuffer:l});const Sn=ie.get(k.state.transmissionRenderTarget);Sn.__isTransmissionRenderTarget=!0}const Pt=k.state.transmissionRenderTarget;O.getDrawingBufferSize(At),Pt.setSize(At.x,At.y);const rn=O.getRenderTarget();O.setRenderTarget(Pt),O.getClearColor(Ae),He=O.getClearAlpha(),He<1&&O.setClearColor(16777215,.5),O.clear();const It=O.toneMapping;O.toneMapping=Rc,Ge(de,We,Xe),le.updateMultisampleRenderTarget(Pt),le.updateRenderTargetMipmap(Pt);let Qt=!1;for(let Sn=0,Xt=Le.length;Sn<Xt;Sn++){const Fn=Le[Sn],Ei=Fn.object,gi=Fn.geometry,ci=Fn.material,Ma=Fn.group;if(ci.side===go&&Ei.layers.test(Xe.layers)){const Wn=ci.side;ci.side=Fa,ci.needsUpdate=!0,Ct(Ei,We,Xe,gi,ci,Ma),ci.side=Wn,ci.needsUpdate=!0,Qt=!0}}Qt===!0&&(le.updateMultisampleRenderTarget(Pt),le.updateRenderTargetMipmap(Pt)),O.setRenderTarget(rn),O.setClearColor(Ae,He),O.toneMapping=It}function Ge(de,Le,We){const Xe=Le.isScene===!0?Le.overrideMaterial:null;for(let Ze=0,Pt=de.length;Ze<Pt;Ze++){const rn=de[Ze],It=rn.object,Qt=rn.geometry,Sn=Xe===null?rn.material:Xe,Xt=rn.group;It.layers.test(We.layers)&&Ct(It,Le,We,Qt,Sn,Xt)}}function Ct(de,Le,We,Xe,Ze,Pt){de.onBeforeRender(O,Le,We,Xe,Ze,Pt),de.modelViewMatrix.multiplyMatrices(We.matrixWorldInverse,de.matrixWorld),de.normalMatrix.getNormalMatrix(de.modelViewMatrix),Ze.onBeforeRender(O,Le,We,Xe,de,Pt),Ze.transparent===!0&&Ze.side===go&&Ze.forceSinglePass===!1?(Ze.side=Fa,Ze.needsUpdate=!0,O.renderBufferDirect(We,Le,Xe,Ze,de,Pt),Ze.side=Lc,Ze.needsUpdate=!0,O.renderBufferDirect(We,Le,Xe,Ze,de,Pt),Ze.side=go):O.renderBufferDirect(We,Le,Xe,Ze,de,Pt),de.onAfterRender(O,Le,We,Xe,Ze,Pt)}function nn(de,Le,We){Le.isScene!==!0&&(Le=En);const Xe=ie.get(de),Ze=k.state.lights,Pt=k.state.shadowsArray,rn=Ze.state.version,It=Mt.getParameters(de,Ze.state,Pt,Le,We),Qt=Mt.getProgramCacheKey(It);let Sn=Xe.programs;Xe.environment=de.isMeshStandardMaterial?Le.environment:null,Xe.fog=Le.fog,Xe.envMap=(de.isMeshStandardMaterial?rt:st).get(de.envMap||Xe.environment),Xe.envMapRotation=Xe.environment!==null&&de.envMap===null?Le.environmentRotation:de.envMapRotation,Sn===void 0&&(de.addEventListener("dispose",ce),Sn=new Map,Xe.programs=Sn);let Xt=Sn.get(Qt);if(Xt!==void 0){if(Xe.currentProgram===Xt&&Xe.lightsStateVersion===rn)return bn(de,It),Xt}else It.uniforms=Mt.getUniforms(de),de.onBuild(We,It,O),de.onBeforeCompile(It,O),Xt=Mt.acquireProgram(It,Qt),Sn.set(Qt,Xt),Xe.uniforms=It.uniforms;const Fn=Xe.uniforms;return(!de.isShaderMaterial&&!de.isRawShaderMaterial||de.clipping===!0)&&(Fn.clippingPlanes=an.uniform),bn(de,It),Xe.needsLights=ei(de),Xe.lightsStateVersion=rn,Xe.needsLights&&(Fn.ambientLightColor.value=Ze.state.ambient,Fn.lightProbe.value=Ze.state.probe,Fn.directionalLights.value=Ze.state.directional,Fn.directionalLightShadows.value=Ze.state.directionalShadow,Fn.spotLights.value=Ze.state.spot,Fn.spotLightShadows.value=Ze.state.spotShadow,Fn.rectAreaLights.value=Ze.state.rectArea,Fn.ltc_1.value=Ze.state.rectAreaLTC1,Fn.ltc_2.value=Ze.state.rectAreaLTC2,Fn.pointLights.value=Ze.state.point,Fn.pointLightShadows.value=Ze.state.pointShadow,Fn.hemisphereLights.value=Ze.state.hemi,Fn.directionalShadowMap.value=Ze.state.directionalShadowMap,Fn.directionalShadowMatrix.value=Ze.state.directionalShadowMatrix,Fn.spotShadowMap.value=Ze.state.spotShadowMap,Fn.spotLightMatrix.value=Ze.state.spotLightMatrix,Fn.spotLightMap.value=Ze.state.spotLightMap,Fn.pointShadowMap.value=Ze.state.pointShadowMap,Fn.pointShadowMatrix.value=Ze.state.pointShadowMatrix),Xe.currentProgram=Xt,Xe.uniformsList=null,Xt}function on(de){if(de.uniformsList===null){const Le=de.currentProgram.getUniforms();de.uniformsList=M1.seqWithValue(Le.seq,de.uniforms)}return de.uniformsList}function bn(de,Le){const We=ie.get(de);We.outputColorSpace=Le.outputColorSpace,We.batching=Le.batching,We.instancing=Le.instancing,We.instancingColor=Le.instancingColor,We.instancingMorph=Le.instancingMorph,We.skinning=Le.skinning,We.morphTargets=Le.morphTargets,We.morphNormals=Le.morphNormals,We.morphColors=Le.morphColors,We.morphTargetsCount=Le.morphTargetsCount,We.numClippingPlanes=Le.numClippingPlanes,We.numIntersection=Le.numClipIntersection,We.vertexAlphas=Le.vertexAlphas,We.vertexTangents=Le.vertexTangents,We.toneMapping=Le.toneMapping}function wn(de,Le,We,Xe,Ze){Le.isScene!==!0&&(Le=En),le.resetTextureUnits();const Pt=Le.fog,rn=Xe.isMeshStandardMaterial?Le.environment:null,It=Q===null?O.outputColorSpace:Q.isXRRenderTarget===!0?Q.texture.colorSpace:Gc,Qt=(Xe.isMeshStandardMaterial?rt:st).get(Xe.envMap||rn),Sn=Xe.vertexColors===!0&&!!We.attributes.color&&We.attributes.color.itemSize===4,Xt=!!We.attributes.tangent&&(!!Xe.normalMap||Xe.anisotropy>0),Fn=!!We.morphAttributes.position,Ei=!!We.morphAttributes.normal,gi=!!We.morphAttributes.color;let ci=Rc;Xe.toneMapped&&(Q===null||Q.isXRRenderTarget===!0)&&(ci=O.toneMapping);const Ma=We.morphAttributes.position||We.morphAttributes.normal||We.morphAttributes.color,Wn=Ma!==void 0?Ma.length:0,Pn=ie.get(Xe),Al=k.state.lights;if(nt===!0&&(wt===!0||de!==re)){const Li=de===re&&Xe.id===xe;an.setState(Xe,de,Li)}let oi=!1;Xe.version===Pn.__version?(Pn.needsLights&&Pn.lightsStateVersion!==Al.state.version||Pn.outputColorSpace!==It||Ze.isBatchedMesh&&Pn.batching===!1||!Ze.isBatchedMesh&&Pn.batching===!0||Ze.isInstancedMesh&&Pn.instancing===!1||!Ze.isInstancedMesh&&Pn.instancing===!0||Ze.isSkinnedMesh&&Pn.skinning===!1||!Ze.isSkinnedMesh&&Pn.skinning===!0||Ze.isInstancedMesh&&Pn.instancingColor===!0&&Ze.instanceColor===null||Ze.isInstancedMesh&&Pn.instancingColor===!1&&Ze.instanceColor!==null||Ze.isInstancedMesh&&Pn.instancingMorph===!0&&Ze.morphTexture===null||Ze.isInstancedMesh&&Pn.instancingMorph===!1&&Ze.morphTexture!==null||Pn.envMap!==Qt||Xe.fog===!0&&Pn.fog!==Pt||Pn.numClippingPlanes!==void 0&&(Pn.numClippingPlanes!==an.numPlanes||Pn.numIntersection!==an.numIntersection)||Pn.vertexAlphas!==Sn||Pn.vertexTangents!==Xt||Pn.morphTargets!==Fn||Pn.morphNormals!==Ei||Pn.morphColors!==gi||Pn.toneMapping!==ci||Pn.morphTargetsCount!==Wn)&&(oi=!0):(oi=!0,Pn.__version=Xe.version);let fi=Pn.currentProgram;oi===!0&&(fi=nn(Xe,Le,Ze));let Qs=!1,sa=!1,xi=!1;const Ri=fi.getUniforms(),Ji=Pn.uniforms;if(Yt.useProgram(fi.program)&&(Qs=!0,sa=!0,xi=!0),Xe.id!==xe&&(xe=Xe.id,sa=!0),Qs||re!==de){Ri.setValue(je,"projectionMatrix",de.projectionMatrix),Ri.setValue(je,"viewMatrix",de.matrixWorldInverse);const Li=Ri.map.cameraPosition;Li!==void 0&&Li.setValue(je,gn.setFromMatrixPosition(de.matrixWorld)),Qn.logarithmicDepthBuffer&&Ri.setValue(je,"logDepthBufFC",2/(Math.log(de.far+1)/Math.LN2)),(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial)&&Ri.setValue(je,"isOrthographic",de.isOrthographicCamera===!0),re!==de&&(re=de,sa=!0,xi=!0)}if(Ze.isSkinnedMesh){Ri.setOptional(je,Ze,"bindMatrix"),Ri.setOptional(je,Ze,"bindMatrixInverse");const Li=Ze.skeleton;Li&&(Li.boneTexture===null&&Li.computeBoneTexture(),Ri.setValue(je,"boneTexture",Li.boneTexture,le))}Ze.isBatchedMesh&&(Ri.setOptional(je,Ze,"batchingTexture"),Ri.setValue(je,"batchingTexture",Ze._matricesTexture,le));const eo=We.morphAttributes;if((eo.position!==void 0||eo.normal!==void 0||eo.color!==void 0)&&Kt.update(Ze,We,fi),(sa||Pn.receiveShadow!==Ze.receiveShadow)&&(Pn.receiveShadow=Ze.receiveShadow,Ri.setValue(je,"receiveShadow",Ze.receiveShadow)),Xe.isMeshGouraudMaterial&&Xe.envMap!==null&&(Ji.envMap.value=Qt,Ji.flipEnvMap.value=Qt.isCubeTexture&&Qt.isRenderTargetTexture===!1?-1:1),Xe.isMeshStandardMaterial&&Xe.envMap===null&&Le.environment!==null&&(Ji.envMapIntensity.value=Le.environmentIntensity),sa&&(Ri.setValue(je,"toneMappingExposure",O.toneMappingExposure),Pn.needsLights&&li(Ji,xi),Pt&&Xe.fog===!0&&hn.refreshFogUniforms(Ji,Pt),hn.refreshMaterialUniforms(Ji,Xe,ct,ft,k.state.transmissionRenderTarget),M1.upload(je,on(Pn),Ji,le)),Xe.isShaderMaterial&&Xe.uniformsNeedUpdate===!0&&(M1.upload(je,on(Pn),Ji,le),Xe.uniformsNeedUpdate=!1),Xe.isSpriteMaterial&&Ri.setValue(je,"center",Ze.center),Ri.setValue(je,"modelViewMatrix",Ze.modelViewMatrix),Ri.setValue(je,"normalMatrix",Ze.normalMatrix),Ri.setValue(je,"modelMatrix",Ze.matrixWorld),Xe.isShaderMaterial||Xe.isRawShaderMaterial){const Li=Xe.uniformsGroups;for(let Io=0,to=Li.length;Io<to;Io++){const ii=Li[Io];jt.update(ii,fi),jt.bind(ii,fi)}}return fi}function li(de,Le){de.ambientLightColor.needsUpdate=Le,de.lightProbe.needsUpdate=Le,de.directionalLights.needsUpdate=Le,de.directionalLightShadows.needsUpdate=Le,de.pointLights.needsUpdate=Le,de.pointLightShadows.needsUpdate=Le,de.spotLights.needsUpdate=Le,de.spotLightShadows.needsUpdate=Le,de.rectAreaLights.needsUpdate=Le,de.hemisphereLights.needsUpdate=Le}function ei(de){return de.isMeshLambertMaterial||de.isMeshToonMaterial||de.isMeshPhongMaterial||de.isMeshStandardMaterial||de.isShadowMaterial||de.isShaderMaterial&&de.lights===!0}this.getActiveCubeFace=function(){return ue},this.getActiveMipmapLevel=function(){return Y},this.getRenderTarget=function(){return Q},this.setRenderTargetTextures=function(de,Le,We){ie.get(de.texture).__webglTexture=Le,ie.get(de.depthTexture).__webglTexture=We;const Xe=ie.get(de);Xe.__hasExternalTextures=!0,Xe.__autoAllocateDepthBuffer=We===void 0,Xe.__autoAllocateDepthBuffer||yn.has("WEBGL_multisampled_render_to_texture")===!0&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),Xe.__useRenderToTexture=!1)},this.setRenderTargetFramebuffer=function(de,Le){const We=ie.get(de);We.__webglFramebuffer=Le,We.__useDefaultFramebuffer=Le===void 0},this.setRenderTarget=function(de,Le=0,We=0){Q=de,ue=Le,Y=We;let Xe=!0,Ze=null,Pt=!1,rn=!1;if(de){const Qt=ie.get(de);Qt.__useDefaultFramebuffer!==void 0?(Yt.bindFramebuffer(je.FRAMEBUFFER,null),Xe=!1):Qt.__webglFramebuffer===void 0?le.setupRenderTarget(de):Qt.__hasExternalTextures&&le.rebindTextures(de,ie.get(de.texture).__webglTexture,ie.get(de.depthTexture).__webglTexture);const Sn=de.texture;(Sn.isData3DTexture||Sn.isDataArrayTexture||Sn.isCompressedArrayTexture)&&(rn=!0);const Xt=ie.get(de).__webglFramebuffer;de.isWebGLCubeRenderTarget?(Array.isArray(Xt[Le])?Ze=Xt[Le][We]:Ze=Xt[Le],Pt=!0):de.samples>0&&le.useMultisampledRTT(de)===!1?Ze=ie.get(de).__webglMultisampledFramebuffer:Array.isArray(Xt)?Ze=Xt[We]:Ze=Xt,ee.copy(de.viewport),Me.copy(de.scissor),Fe=de.scissorTest}else ee.copy(tt).multiplyScalar(ct).floor(),Me.copy(_t).multiplyScalar(ct).floor(),Fe=Lt;if(Yt.bindFramebuffer(je.FRAMEBUFFER,Ze)&&Xe&&Yt.drawBuffers(de,Ze),Yt.viewport(ee),Yt.scissor(Me),Yt.setScissorTest(Fe),Pt){const Qt=ie.get(de.texture);je.framebufferTexture2D(je.FRAMEBUFFER,je.COLOR_ATTACHMENT0,je.TEXTURE_CUBE_MAP_POSITIVE_X+Le,Qt.__webglTexture,We)}else if(rn){const Qt=ie.get(de.texture),Sn=Le||0;je.framebufferTextureLayer(je.FRAMEBUFFER,je.COLOR_ATTACHMENT0,Qt.__webglTexture,We||0,Sn)}xe=-1},this.readRenderTargetPixels=function(de,Le,We,Xe,Ze,Pt,rn){if(!(de&&de.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let It=ie.get(de).__webglFramebuffer;if(de.isWebGLCubeRenderTarget&&rn!==void 0&&(It=It[rn]),It){Yt.bindFramebuffer(je.FRAMEBUFFER,It);try{const Qt=de.texture,Sn=Qt.format,Xt=Qt.type;if(Sn!==_o&&dt.convert(Sn)!==je.getParameter(je.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}const Fn=Xt===ry&&(yn.has("EXT_color_buffer_half_float")||yn.has("EXT_color_buffer_float"));if(Xt!==Ic&&dt.convert(Xt)!==je.getParameter(je.IMPLEMENTATION_COLOR_READ_TYPE)&&Xt!==_c&&!Fn){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}Le>=0&&Le<=de.width-Xe&&We>=0&&We<=de.height-Ze&&je.readPixels(Le,We,Xe,Ze,dt.convert(Sn),dt.convert(Xt),Pt)}finally{const Qt=Q!==null?ie.get(Q).__webglFramebuffer:null;Yt.bindFramebuffer(je.FRAMEBUFFER,Qt)}}},this.copyFramebufferToTexture=function(de,Le,We=0){const Xe=Math.pow(2,-We),Ze=Math.floor(Le.image.width*Xe),Pt=Math.floor(Le.image.height*Xe);le.setTexture2D(Le,0),je.copyTexSubImage2D(je.TEXTURE_2D,We,0,0,de.x,de.y,Ze,Pt),Yt.unbindTexture()},this.copyTextureToTexture=function(de,Le,We,Xe=0){const Ze=Le.image.width,Pt=Le.image.height,rn=dt.convert(We.format),It=dt.convert(We.type);le.setTexture2D(We,0),je.pixelStorei(je.UNPACK_FLIP_Y_WEBGL,We.flipY),je.pixelStorei(je.UNPACK_PREMULTIPLY_ALPHA_WEBGL,We.premultiplyAlpha),je.pixelStorei(je.UNPACK_ALIGNMENT,We.unpackAlignment),Le.isDataTexture?je.texSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,Ze,Pt,rn,It,Le.image.data):Le.isCompressedTexture?je.compressedTexSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,Le.mipmaps[0].width,Le.mipmaps[0].height,rn,Le.mipmaps[0].data):je.texSubImage2D(je.TEXTURE_2D,Xe,de.x,de.y,rn,It,Le.image),Xe===0&&We.generateMipmaps&&je.generateMipmap(je.TEXTURE_2D),Yt.unbindTexture()},this.copyTextureToTexture3D=function(de,Le,We,Xe,Ze=0){const Pt=Math.round(de.max.x-de.min.x),rn=Math.round(de.max.y-de.min.y),It=de.max.z-de.min.z+1,Qt=dt.convert(Xe.format),Sn=dt.convert(Xe.type);let Xt;if(Xe.isData3DTexture)le.setTexture3D(Xe,0),Xt=je.TEXTURE_3D;else if(Xe.isDataArrayTexture||Xe.isCompressedArrayTexture)le.setTexture2DArray(Xe,0),Xt=je.TEXTURE_2D_ARRAY;else{console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");return}je.pixelStorei(je.UNPACK_FLIP_Y_WEBGL,Xe.flipY),je.pixelStorei(je.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Xe.premultiplyAlpha),je.pixelStorei(je.UNPACK_ALIGNMENT,Xe.unpackAlignment);const Fn=je.getParameter(je.UNPACK_ROW_LENGTH),Ei=je.getParameter(je.UNPACK_IMAGE_HEIGHT),gi=je.getParameter(je.UNPACK_SKIP_PIXELS),ci=je.getParameter(je.UNPACK_SKIP_ROWS),Ma=je.getParameter(je.UNPACK_SKIP_IMAGES),Wn=We.isCompressedTexture?We.mipmaps[Ze]:We.image;je.pixelStorei(je.UNPACK_ROW_LENGTH,Wn.width),je.pixelStorei(je.UNPACK_IMAGE_HEIGHT,Wn.height),je.pixelStorei(je.UNPACK_SKIP_PIXELS,de.min.x),je.pixelStorei(je.UNPACK_SKIP_ROWS,de.min.y),je.pixelStorei(je.UNPACK_SKIP_IMAGES,de.min.z),We.isDataTexture||We.isData3DTexture?je.texSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Sn,Wn.data):Xe.isCompressedArrayTexture?je.compressedTexSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Wn.data):je.texSubImage3D(Xt,Ze,Le.x,Le.y,Le.z,Pt,rn,It,Qt,Sn,Wn),je.pixelStorei(je.UNPACK_ROW_LENGTH,Fn),je.pixelStorei(je.UNPACK_IMAGE_HEIGHT,Ei),je.pixelStorei(je.UNPACK_SKIP_PIXELS,gi),je.pixelStorei(je.UNPACK_SKIP_ROWS,ci),je.pixelStorei(je.UNPACK_SKIP_IMAGES,Ma),Ze===0&&Xe.generateMipmaps&&je.generateMipmap(Xt),Yt.unbindTexture()},this.initTexture=function(de){de.isCubeTexture?le.setTextureCube(de,0):de.isData3DTexture?le.setTexture3D(de,0):de.isDataArrayTexture||de.isCompressedArrayTexture?le.setTexture2DArray(de,0):le.setTexture2D(de,0),Yt.unbindTexture()},this.resetState=function(){ue=0,Y=0,Q=null,Yt.reset(),Ht.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return ul}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=e===_w?"display-p3":"srgb",t.unpackColorSpace=Mi.workingColorSpace===Xy?"display-p3":"srgb"}get useLegacyLights(){return console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights}set useLegacyLights(e){console.warn("THREE.WebGLRenderer: The property .useLegacyLights has been deprecated. Migrate your lighting according to the following guide: https://discourse.threejs.org/t/updates-to-lighting-in-three-js-r155/53733."),this._useLegacyLights=e}}class PU extends es{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new xl,this.environmentIntensity=1,this.environmentRotation=new xl,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}}class sp extends jc{constructor(e=1,t=32,i=16,r=0,l=Math.PI*2,h=0,o=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:i,phiStart:r,phiLength:l,thetaStart:h,thetaLength:o},t=Math.max(3,Math.floor(t)),i=Math.max(2,Math.floor(i));const p=Math.min(h+o,Math.PI);let v=0;const x=[],M=new it,S=new it,A=[],L=[],F=[],k=[];for(let C=0;C<=i;C++){const V=[],O=C/i;let J=0;C===0&&h===0?J=.5/t:C===i&&p===Math.PI&&(J=-.5/t);for(let ue=0;ue<=t;ue++){const Y=ue/t;M.x=-e*Math.cos(r+Y*l)*Math.sin(h+O*o),M.y=e*Math.cos(h+O*o),M.z=e*Math.sin(r+Y*l)*Math.sin(h+O*o),L.push(M.x,M.y,M.z),S.copy(M).normalize(),F.push(S.x,S.y,S.z),k.push(Y+J,1-O),V.push(v++)}x.push(V)}for(let C=0;C<i;C++)for(let V=0;V<t;V++){const O=x[C][V+1],J=x[C][V],ue=x[C+1][V],Y=x[C+1][V+1];(C!==0||h>0)&&A.push(O,J,Y),(C!==i-1||p<Math.PI)&&A.push(J,ue,Y)}this.setIndex(A),this.setAttribute("position",new Mo(L,3)),this.setAttribute("normal",new Mo(F,3)),this.setAttribute("uv",new Mo(k,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new sp(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}const UM={enabled:!1,files:{},add:function(n,e){this.enabled!==!1&&(this.files[n]=e)},get:function(n){if(this.enabled!==!1)return this.files[n]},remove:function(n){delete this.files[n]},clear:function(){this.files={}}};class RU{constructor(e,t,i){const r=this;let l=!1,h=0,o=0,p;const v=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=i,this.itemStart=function(x){o++,l===!1&&r.onStart!==void 0&&r.onStart(x,h,o),l=!0},this.itemEnd=function(x){h++,r.onProgress!==void 0&&r.onProgress(x,h,o),h===o&&(l=!1,r.onLoad!==void 0&&r.onLoad())},this.itemError=function(x){r.onError!==void 0&&r.onError(x)},this.resolveURL=function(x){return p?p(x):x},this.setURLModifier=function(x){return p=x,this},this.addHandler=function(x,M){return v.push(x,M),this},this.removeHandler=function(x){const M=v.indexOf(x);return M!==-1&&v.splice(M,2),this},this.getHandler=function(x){for(let M=0,S=v.length;M<S;M+=2){const A=v[M],L=v[M+1];if(A.global&&(A.lastIndex=0),A.test(x))return L}return null}}}const IU=new RU;class Sw{constructor(e){this.manager=e!==void 0?e:IU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const i=this;return new Promise(function(r,l){i.load(e,r,t,l)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}Sw.DEFAULT_MATERIAL_NAME="__DEFAULT";class kU extends Sw{constructor(e){super(e)}load(e,t,i,r){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const l=this,h=UM.get(e);if(h!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(h),l.manager.itemEnd(e)},0),h;const o=kp("img");function p(){x(),UM.add(e,this),t&&t(this),l.manager.itemEnd(e)}function v(M){x(),r&&r(M),l.manager.itemError(e),l.manager.itemEnd(e)}function x(){o.removeEventListener("load",p,!1),o.removeEventListener("error",v,!1)}return o.addEventListener("load",p,!1),o.addEventListener("error",v,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(o.crossOrigin=this.crossOrigin),l.manager.itemStart(e),o.src=e,o}}class DU extends Sw{constructor(e){super(e)}load(e,t,i,r){const l=new xa,h=new kU(this.manager);return h.setCrossOrigin(this.crossOrigin),h.setPath(this.path),h.load(e,function(o){l.image=o,l.needsUpdate=!0,t!==void 0&&t(l)},i,r),l}}class VM{constructor(e=1,t=0,i=0){return this.radius=e,this.phi=t,this.theta=i,this}set(e,t,i){return this.radius=e,this.phi=t,this.theta=i,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,i){return this.radius=Math.sqrt(e*e+t*t+i*i),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,i),this.phi=Math.acos(ra(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:vw}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=vw);const HM={type:"change"},Sx={type:"start"},GM={type:"end"},Yg=new t8,jM=new fc,LU=Math.cos(70*yz.DEG2RAD);class zU extends Ju{constructor(e,t){super(),this.object=e,this.domElement=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new it,this.cursor=new it,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minTargetRadius=0,this.maxTargetRadius=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.zoomToCursor=!1,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:Hh.ROTATE,MIDDLE:Hh.DOLLY,RIGHT:Hh.PAN},this.touches={ONE:Gh.ROTATE,TWO:Gh.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return o.phi},this.getAzimuthalAngle=function(){return o.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(X){X.addEventListener("keydown",an),this._domElementKeyEvents=X},this.stopListenToKeyEvents=function(){this._domElementKeyEvents.removeEventListener("keydown",an),this._domElementKeyEvents=null},this.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object.zoom},this.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object.zoom=i.zoom0,i.object.updateProjectionMatrix(),i.dispatchEvent(HM),i.update(),l=r.NONE},this.update=function(){const X=new it,Oe=new $u().setFromUnitVectors(e.up,new it(0,1,0)),pt=Oe.clone().invert(),Dt=new it,ce=new $u,B=new it,U=2*Math.PI;return function(ne=null){const me=i.object.position;X.copy(me).sub(i.target),X.applyQuaternion(Oe),o.setFromVector3(X),i.autoRotate&&l===r.NONE&&Fe(ee(ne)),i.enableDamping?(o.theta+=p.theta*i.dampingFactor,o.phi+=p.phi*i.dampingFactor):(o.theta+=p.theta,o.phi+=p.phi);let Se=i.minAzimuthAngle,Ee=i.maxAzimuthAngle;isFinite(Se)&&isFinite(Ee)&&(Se<-Math.PI?Se+=U:Se>Math.PI&&(Se-=U),Ee<-Math.PI?Ee+=U:Ee>Math.PI&&(Ee-=U),Se<=Ee?o.theta=Math.max(Se,Math.min(Ee,o.theta)):o.theta=o.theta>(Se+Ee)/2?Math.max(Se,o.theta):Math.min(Ee,o.theta)),o.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,o.phi)),o.makeSafe(),i.enableDamping===!0?i.target.addScaledVector(x,i.dampingFactor):i.target.add(x),i.target.sub(i.cursor),i.target.clampLength(i.minTargetRadius,i.maxTargetRadius),i.target.add(i.cursor);let ye=!1;if(i.zoomToCursor&&Y||i.object.isOrthographicCamera)o.radius=tt(o.radius);else{const Re=o.radius;o.radius=tt(o.radius*v),ye=Re!=o.radius}if(X.setFromSpherical(o),X.applyQuaternion(pt),me.copy(i.target).add(X),i.object.lookAt(i.target),i.enableDamping===!0?(p.theta*=1-i.dampingFactor,p.phi*=1-i.dampingFactor,x.multiplyScalar(1-i.dampingFactor)):(p.set(0,0,0),x.set(0,0,0)),i.zoomToCursor&&Y){let Re=null;if(i.object.isPerspectiveCamera){const qe=X.length();Re=tt(qe*v);const Ye=qe-Re;i.object.position.addScaledVector(J,Ye),i.object.updateMatrixWorld(),ye=!!Ye}else if(i.object.isOrthographicCamera){const qe=new it(ue.x,ue.y,0);qe.unproject(i.object);const Ye=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/v)),i.object.updateProjectionMatrix(),ye=Ye!==i.object.zoom;const Ge=new it(ue.x,ue.y,0);Ge.unproject(i.object),i.object.position.sub(Ge).add(qe),i.object.updateMatrixWorld(),Re=X.length()}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - zoom to cursor disabled."),i.zoomToCursor=!1;Re!==null&&(this.screenSpacePanning?i.target.set(0,0,-1).transformDirection(i.object.matrix).multiplyScalar(Re).add(i.object.position):(Yg.origin.copy(i.object.position),Yg.direction.set(0,0,-1).transformDirection(i.object.matrix),Math.abs(i.object.up.dot(Yg.direction))<LU?e.lookAt(i.target):(jM.setFromNormalAndCoplanarPoint(i.object.up,i.target),Yg.intersectPlane(jM,i.target))))}else if(i.object.isOrthographicCamera){const Re=i.object.zoom;i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/v)),Re!==i.object.zoom&&(i.object.updateProjectionMatrix(),ye=!0)}return v=1,Y=!1,ye||Dt.distanceToSquared(i.object.position)>h||8*(1-ce.dot(i.object.quaternion))>h||B.distanceToSquared(i.target)>h?(i.dispatchEvent(HM),Dt.copy(i.object.position),ce.copy(i.object.quaternion),B.copy(i.target),!0):!1}}(),this.dispose=function(){i.domElement.removeEventListener("contextmenu",Kt),i.domElement.removeEventListener("pointerdown",st),i.domElement.removeEventListener("pointercancel",mt),i.domElement.removeEventListener("wheel",Mt),i.domElement.removeEventListener("pointermove",rt),i.domElement.removeEventListener("pointerup",mt),i.domElement.getRootNode().removeEventListener("keydown",xn,{capture:!0}),i._domElementKeyEvents!==null&&(i._domElementKeyEvents.removeEventListener("keydown",an),i._domElementKeyEvents=null)};const i=this,r={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=r.NONE;const h=1e-6,o=new VM,p=new VM;let v=1;const x=new it,M=new $n,S=new $n,A=new $n,L=new $n,F=new $n,k=new $n,C=new $n,V=new $n,O=new $n,J=new it,ue=new $n;let Y=!1;const Q=[],xe={};let re=!1;function ee(X){return X!==null?2*Math.PI/60*i.autoRotateSpeed*X:2*Math.PI/60/60*i.autoRotateSpeed}function Me(X){const Oe=Math.abs(X*.01);return Math.pow(.95,i.zoomSpeed*Oe)}function Fe(X){p.theta-=X}function Ae(X){p.phi-=X}const He=function(){const X=new it;return function(pt,Dt){X.setFromMatrixColumn(Dt,0),X.multiplyScalar(-pt),x.add(X)}}(),ot=function(){const X=new it;return function(pt,Dt){i.screenSpacePanning===!0?X.setFromMatrixColumn(Dt,1):(X.setFromMatrixColumn(Dt,0),X.crossVectors(i.object.up,X)),X.multiplyScalar(pt),x.add(X)}}(),ft=function(){const X=new it;return function(pt,Dt){const ce=i.domElement;if(i.object.isPerspectiveCamera){const B=i.object.position;X.copy(B).sub(i.target);let U=X.length();U*=Math.tan(i.object.fov/2*Math.PI/180),He(2*pt*U/ce.clientHeight,i.object.matrix),ot(2*Dt*U/ce.clientHeight,i.object.matrix)}else i.object.isOrthographicCamera?(He(pt*(i.object.right-i.object.left)/i.object.zoom/ce.clientWidth,i.object.matrix),ot(Dt*(i.object.top-i.object.bottom)/i.object.zoom/ce.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function ct(X){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?v/=X:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function De(X){i.object.isPerspectiveCamera||i.object.isOrthographicCamera?v*=X:(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function Je(X,Oe){if(!i.zoomToCursor)return;Y=!0;const pt=i.domElement.getBoundingClientRect(),Dt=X-pt.left,ce=Oe-pt.top,B=pt.width,U=pt.height;ue.x=Dt/B*2-1,ue.y=-(ce/U)*2+1,J.set(ue.x,ue.y,1).unproject(i.object).sub(i.object.position).normalize()}function tt(X){return Math.max(i.minDistance,Math.min(i.maxDistance,X))}function _t(X){M.set(X.clientX,X.clientY)}function Lt(X){Je(X.clientX,X.clientX),C.set(X.clientX,X.clientY)}function Cn(X){L.set(X.clientX,X.clientY)}function nt(X){S.set(X.clientX,X.clientY),A.subVectors(S,M).multiplyScalar(i.rotateSpeed);const Oe=i.domElement;Fe(2*Math.PI*A.x/Oe.clientHeight),Ae(2*Math.PI*A.y/Oe.clientHeight),M.copy(S),i.update()}function wt(X){V.set(X.clientX,X.clientY),O.subVectors(V,C),O.y>0?ct(Me(O.y)):O.y<0&&De(Me(O.y)),C.copy(V),i.update()}function Ft(X){F.set(X.clientX,X.clientY),k.subVectors(F,L).multiplyScalar(i.panSpeed),ft(k.x,k.y),L.copy(F),i.update()}function At(X){Je(X.clientX,X.clientY),X.deltaY<0?De(Me(X.deltaY)):X.deltaY>0&&ct(Me(X.deltaY)),i.update()}function gn(X){let Oe=!1;switch(X.code){case i.keys.UP:X.ctrlKey||X.metaKey||X.shiftKey?Ae(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ft(0,i.keyPanSpeed),Oe=!0;break;case i.keys.BOTTOM:X.ctrlKey||X.metaKey||X.shiftKey?Ae(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ft(0,-i.keyPanSpeed),Oe=!0;break;case i.keys.LEFT:X.ctrlKey||X.metaKey||X.shiftKey?Fe(2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ft(i.keyPanSpeed,0),Oe=!0;break;case i.keys.RIGHT:X.ctrlKey||X.metaKey||X.shiftKey?Fe(-2*Math.PI*i.rotateSpeed/i.domElement.clientHeight):ft(-i.keyPanSpeed,0),Oe=!0;break}Oe&&(X.preventDefault(),i.update())}function En(X){if(Q.length===1)M.set(X.pageX,X.pageY);else{const Oe=jt(X),pt=.5*(X.pageX+Oe.x),Dt=.5*(X.pageY+Oe.y);M.set(pt,Dt)}}function In(X){if(Q.length===1)L.set(X.pageX,X.pageY);else{const Oe=jt(X),pt=.5*(X.pageX+Oe.x),Dt=.5*(X.pageY+Oe.y);L.set(pt,Dt)}}function je(X){const Oe=jt(X),pt=X.pageX-Oe.x,Dt=X.pageY-Oe.y,ce=Math.sqrt(pt*pt+Dt*Dt);C.set(0,ce)}function An(X){i.enableZoom&&je(X),i.enablePan&&In(X)}function yn(X){i.enableZoom&&je(X),i.enableRotate&&En(X)}function Qn(X){if(Q.length==1)S.set(X.pageX,X.pageY);else{const pt=jt(X),Dt=.5*(X.pageX+pt.x),ce=.5*(X.pageY+pt.y);S.set(Dt,ce)}A.subVectors(S,M).multiplyScalar(i.rotateSpeed);const Oe=i.domElement;Fe(2*Math.PI*A.x/Oe.clientHeight),Ae(2*Math.PI*A.y/Oe.clientHeight),M.copy(S)}function Yt(X){if(Q.length===1)F.set(X.pageX,X.pageY);else{const Oe=jt(X),pt=.5*(X.pageX+Oe.x),Dt=.5*(X.pageY+Oe.y);F.set(pt,Dt)}k.subVectors(F,L).multiplyScalar(i.panSpeed),ft(k.x,k.y),L.copy(F)}function Gn(X){const Oe=jt(X),pt=X.pageX-Oe.x,Dt=X.pageY-Oe.y,ce=Math.sqrt(pt*pt+Dt*Dt);V.set(0,ce),O.set(0,Math.pow(V.y/C.y,i.zoomSpeed)),ct(O.y),C.copy(V);const B=(X.pageX+Oe.x)*.5,U=(X.pageY+Oe.y)*.5;Je(B,U)}function ie(X){i.enableZoom&&Gn(X),i.enablePan&&Yt(X)}function le(X){i.enableZoom&&Gn(X),i.enableRotate&&Qn(X)}function st(X){i.enabled!==!1&&(Q.length===0&&(i.domElement.setPointerCapture(X.pointerId),i.domElement.addEventListener("pointermove",rt),i.domElement.addEventListener("pointerup",mt)),!dt(X)&&(On(X),X.pointerType==="touch"?at(X):St(X)))}function rt(X){i.enabled!==!1&&(X.pointerType==="touch"?tn(X):_n(X))}function mt(X){switch(Un(X),Q.length){case 0:i.domElement.releasePointerCapture(X.pointerId),i.domElement.removeEventListener("pointermove",rt),i.domElement.removeEventListener("pointerup",mt),i.dispatchEvent(GM),l=r.NONE;break;case 1:const Oe=Q[0],pt=xe[Oe];at({pointerId:Oe,pageX:pt.x,pageY:pt.y});break}}function St(X){let Oe;switch(X.button){case 0:Oe=i.mouseButtons.LEFT;break;case 1:Oe=i.mouseButtons.MIDDLE;break;case 2:Oe=i.mouseButtons.RIGHT;break;default:Oe=-1}switch(Oe){case Hh.DOLLY:if(i.enableZoom===!1)return;Lt(X),l=r.DOLLY;break;case Hh.ROTATE:if(X.ctrlKey||X.metaKey||X.shiftKey){if(i.enablePan===!1)return;Cn(X),l=r.PAN}else{if(i.enableRotate===!1)return;_t(X),l=r.ROTATE}break;case Hh.PAN:if(X.ctrlKey||X.metaKey||X.shiftKey){if(i.enableRotate===!1)return;_t(X),l=r.ROTATE}else{if(i.enablePan===!1)return;Cn(X),l=r.PAN}break;default:l=r.NONE}l!==r.NONE&&i.dispatchEvent(Sx)}function _n(X){switch(l){case r.ROTATE:if(i.enableRotate===!1)return;nt(X);break;case r.DOLLY:if(i.enableZoom===!1)return;wt(X);break;case r.PAN:if(i.enablePan===!1)return;Ft(X);break}}function Mt(X){i.enabled===!1||i.enableZoom===!1||l!==r.NONE||(X.preventDefault(),i.dispatchEvent(Sx),At(hn(X)),i.dispatchEvent(GM))}function hn(X){const Oe=X.deltaMode,pt={clientX:X.clientX,clientY:X.clientY,deltaY:X.deltaY};switch(Oe){case 1:pt.deltaY*=16;break;case 2:pt.deltaY*=100;break}return X.ctrlKey&&!re&&(pt.deltaY*=10),pt}function xn(X){X.key==="Control"&&(re=!0,i.domElement.getRootNode().addEventListener("keyup",Nt,{passive:!0,capture:!0}))}function Nt(X){X.key==="Control"&&(re=!1,i.domElement.getRootNode().removeEventListener("keyup",Nt,{passive:!0,capture:!0}))}function an(X){i.enabled===!1||i.enablePan===!1||gn(X)}function at(X){switch(Ht(X),Q.length){case 1:switch(i.touches.ONE){case Gh.ROTATE:if(i.enableRotate===!1)return;En(X),l=r.TOUCH_ROTATE;break;case Gh.PAN:if(i.enablePan===!1)return;In(X),l=r.TOUCH_PAN;break;default:l=r.NONE}break;case 2:switch(i.touches.TWO){case Gh.DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;An(X),l=r.TOUCH_DOLLY_PAN;break;case Gh.DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;yn(X),l=r.TOUCH_DOLLY_ROTATE;break;default:l=r.NONE}break;default:l=r.NONE}l!==r.NONE&&i.dispatchEvent(Sx)}function tn(X){switch(Ht(X),l){case r.TOUCH_ROTATE:if(i.enableRotate===!1)return;Qn(X),i.update();break;case r.TOUCH_PAN:if(i.enablePan===!1)return;Yt(X),i.update();break;case r.TOUCH_DOLLY_PAN:if(i.enableZoom===!1&&i.enablePan===!1)return;ie(X),i.update();break;case r.TOUCH_DOLLY_ROTATE:if(i.enableZoom===!1&&i.enableRotate===!1)return;le(X),i.update();break;default:l=r.NONE}}function Kt(X){i.enabled!==!1&&X.preventDefault()}function On(X){Q.push(X.pointerId)}function Un(X){delete xe[X.pointerId];for(let Oe=0;Oe<Q.length;Oe++)if(Q[Oe]==X.pointerId){Q.splice(Oe,1);return}}function dt(X){for(let Oe=0;Oe<Q.length;Oe++)if(Q[Oe]==X.pointerId)return!0;return!1}function Ht(X){let Oe=xe[X.pointerId];Oe===void 0&&(Oe=new $n,xe[X.pointerId]=Oe),Oe.set(X.pageX,X.pageY)}function jt(X){const Oe=X.pointerId===Q[0]?Q[1]:Q[0];return xe[Oe]}i.domElement.addEventListener("contextmenu",Kt),i.domElement.addEventListener("pointerdown",st),i.domElement.addEventListener("pointercancel",mt),i.domElement.addEventListener("wheel",Mt,{passive:!1}),i.domElement.getRootNode().addEventListener("keydown",xn,{passive:!0,capture:!0}),this.update()}}const FU=`uniform float radius;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vPosWorld;
varying vec3 vLightPos;


void main() {
    vec3 sun = vLightPos;

    vec3 pos2sun = sun - vPos;
    float dist2sun = length(pos2sun) / (10.0 * radius);
    dist2sun *= dist2sun * dist2sun;
    float diffuseLightness = 1.0 - dist2sun - 0.2;

    float distanceFromCenter = length(vPosWorld - vec3(0)) / radius;

    float a = 0.0;
    float taperStart = 0.9;
    if (distanceFromCenter > taperStart) {
        float decline = 1.0 / (1.0 - taperStart);
        float offset = distanceFromCenter - taperStart;
        a = offset * decline;
    }
    float alpha = 1.0 - a;

    gl_FragColor = vec4(0.6, 0.7, 0.8, alpha - 0.2);
    gl_FragColor.w *= diffuseLightness;

    if (distanceFromCenter >= 1.0) {
        gl_FragColor = vec4(0);
    }
    // gl_FragColor = vec4(1. - a);
    // gl_FragColor = vec4(1);
    // gl_FragColor = vec4(1. - dist2sun);
}`,NU=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
varying vec3 vPosWorld;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vPosWorld = (modelMatrix * vec4(position, 1)).xyz;  // world-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}
`,BU=`varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;
uniform sampler2D cloudTex;


void main() {
    vec3 lightPos = vLightPos;
    vec3 lightDir = normalize(lightPos - vPos);
    float lightness = dot(lightDir, vNormal);
    vec4 cloudColor = texture(cloudTex, vUv);
    gl_FragColor = cloudColor;
    gl_FragColor.xyz *= lightness;
    // gl_FragColor.w = 1.0;
}
`,OU=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`,UU=`uniform sampler2D dayTexture;
uniform sampler2D nightTexture;
uniform sampler2D displacementMap;
uniform sampler2D normalMap;
varying vec2 vUv;
varying vec3 vNormal;
varying vec3 vPos;
varying vec3 vLightPos;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    // texture data
    vec3 normalColor = texture(normalMap, vUv).xyz;
    vec3 landColor = texture(dayTexture, vUv).xyz;
    vec3 nightColor = texture(nightTexture, vUv).xyz;

    // derived data
    vec3 sun = vLightPos;
    vec3 normal = normalize(vNormal + normalColor);
    vec3 posToSun = normalize(sun - vPos);
    float diffuseLightness = dot(posToSun, normal) + 0.6;

    // mixing
    landColor = brighten(landColor, diffuseLightness);
    nightColor = brighten(nightColor, 1.0 - diffuseLightness);
    vec3 outColor = mix(nightColor, landColor, diffuseLightness);

    gl_FragColor = vec4(outColor, 1.0);
}`,VU=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
uniform sampler2D displacementMap;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 heightColor = texture(displacementMap, uv);
  vec3 displacedPosition = position * (1.0 + 0.1 * heightColor.x);
  vec4 newPosCamSpace = modelViewMatrix * vec4(displacedPosition, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}`,HU=`varying vec2 vUv;           // texture-space
varying vec3 vNormal;       // cam-space
varying vec3 vPos;          // cam-space
varying vec3 vLightPos;     // cam-space
uniform float time;
uniform sampler2D landDistance;
uniform sampler2D heightMap;
uniform sampler2D groundTexture;
uniform sampler2D waterNormal1;
uniform sampler2D waterNormal2;


vec3 brighten(vec3 color, float light) {
    return color * light;
}

void main() {
    float landHeight = 0.5;

    // texture data
    float distFromShore = texture(landDistance, vUv).x;
    vec3 groundColor    = texture(groundTexture, vUv).xyz;
    float height        = texture(heightMap, vUv).x;
    vec3 normal1        = texture(waterNormal1, 2.0 * vUv + vec2(0.01, -0.01) * time).xyz;
    vec3 normal2        = texture(waterNormal2, 4.0 * vUv + vec2(-0.01, 0.01) * time).xyz;

    // derived values
    vec3 normal = normalize(vNormal +  0.1 * normal1 + 0.2 * normal2);
    vec3 pos = vPos;
    vec3 sun = vLightPos;
    vec3 pos2cam = vec3(0) - pos;
    vec3 pos2sun = sun - pos;
    float nScale = dot(normal, pos2sun);
    vec3 sunReflected = 2.0 * nScale * normal - sun;
    vec3 pos2reflection = sunReflected - pos;

    // 1. diffuse
    float sunNormalAlignment = dot(normalize(pos2sun), normal);
    float diffuseLightness = sunNormalAlignment;
    
    // 2. specular
    float m = 0.15;
    float pi = 3.14159265359;
    float specAngle = acos(dot(normalize(pos2cam), normalize(pos2reflection)));
    float specularLightness = exp(-(specAngle / m) * (specAngle / m));
    
    // 3. surf
    float surf = 0.0;
    float maxDistFromShore = 0.2;
    if (distFromShore < maxDistFromShore && height < landHeight) {
        surf = sin(distFromShore * 400.0 + time * 5.0) * (1.0 - distFromShore / maxDistFromShore);
    } 

    // 4. combine
    vec3 outColor = groundColor * 0.5                // night color
                  + groundColor * diffuseLightness   // diffuse sunlit color
                  + vec3(surf)  * 0.2                // surf
                  + vec3(1.0)   * specularLightness; // specular

    gl_FragColor = vec4(outColor, 1.0);

    // if (height >= landHeight) {
    //     gl_FragColor = vec4(0);
    // }
}`,GU=`//    = object.matrixWorld
// uniform mat4 modelMatrix;

//    = camera.matrixWorldInverse * object.matrixWorld
// uniform mat4 modelViewMatrix;

//    = camera.projectionMatrix
// uniform mat4 projectionMatrix;

//    = camera.matrixWorldInverse
// uniform mat4 viewMatrix;

//    = inverse transpose of modelViewMatrix
// uniform mat3 normalMatrix;

//    = camera position in world space
// uniform vec3 cameraPosition;

//    default vertex attributes provided by BufferGeometry
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 uv;


uniform vec3 lightPos;
varying vec3 vNormal;
varying vec2 vUv;
varying vec3 vLightPos;
varying vec3 vPos;

// normalMatrix:
// https://threejs.org/docs/#api/en/core/Object3D.normalMatrix
// upper left 3x3 sub-matrix of this object's modelViewMatrix

void main() {
  vec4 newPosCamSpace = modelViewMatrix * vec4(position, 1.0);
  vec4 newPosClipSpace = projectionMatrix * newPosCamSpace;
  gl_Position = newPosClipSpace;
  vPos = newPosCamSpace.xyz;                          // cam-space
  vUv = uv;
  vNormal = normalMatrix * normal;                    // cam-space
  vLightPos = (viewMatrix * vec4(lightPos, 1)).xyz;   // cam-space
}

/**
* My determining factor is normalMatrix.
* I can only get vNormal in camera-space
* so I want all my varyings to also be passed
* in camera-space.
* vLightPos = lightPosWorldSpace - cameraPosWorldSpace
*           = lightPosWorldSpace * viewMatrix
*/`;async function jU(n){const e=new DU,t={},i=[];for(const[r,l]of Object.entries(n)){const h=e.loadAsync(l).then(o=>t[r]=o);i.push(h)}return await Promise.all(i),t}class WU{constructor(e,t){ut(this,"water");ut(this,"sky");ut(this,"earth");ut(this,"renderer");ut(this,"camera");ut(this,"scene");ut(this,"controls");ut(this,"atmosphere");const{stars:i,earthDay:r,earthNight:l,earthNormal:h,earthHeight:o,landDistance:p,waterNormal1:v,waterNormal2:x,clouds:M}=t,S=100,A=new CU({canvas:e,antialias:!0,failIfMajorPerformanceCaveat:!0}),L=new PU;L.background=i;const F=new ys(50,e.clientWidth/e.clientHeight,.1*S,6*S);F.position.set(0,0,-3*S),F.lookAt(L.position);const k=new it(1e3,0,0),C=new zU(F,e);C.enableZoom=!1;const V=new j0;V.position.set(0,0,0),L.add(V);const O=new Ja(new sp(S,500,250),new bs({vertexShader:VU,fragmentShader:UU,uniforms:{lightPos:{value:k},dayTexture:{value:r},nightTexture:{value:l},normalMap:{value:h},displacementMap:{value:o}}}));V.add(O);const J=new Ja(new sp(S+5,200,100),new bs({vertexShader:GU,fragmentShader:HU,uniforms:{lightPos:{value:k},time:{value:0},groundTexture:{value:r},heightMap:{value:o},landDistance:{value:p},waterNormal1:{value:v},waterNormal2:{value:x}}}));V.add(J);const ue=new Ja(new sp(S+9),new bs({vertexShader:OU,fragmentShader:BU,uniforms:{lightPos:{value:k},cloudTex:{value:M}},transparent:!0,side:go}));V.add(ue),ue.renderOrder=.5;const Y=30,Q=new Ja(new Kp(2*(S+Y),2*(S+Y)),new bs({fragmentShader:FU,vertexShader:NU,uniforms:{radius:{value:S+Y},lightPos:{value:k}},transparent:!0}));L.add(Q),Q.renderOrder=.1,this.water=J,this.sky=ue,this.atmosphere=Q,this.earth=V,this.renderer=A,this.camera=F,this.scene=L,this.controls=C}step(e){this.water.material.uniforms.time.value=e.time,this.atmosphere.lookAt(this.camera.position),this.sky.rotateY(.001),this.earth.rotateY(.001),this.renderer.render(this.scene,this.camera),this.controls.update()}destroy(e){const t=i=>{i.dispose();for(const r of Object.keys(i)){const l=i[r];l&&typeof l=="object"&&"minFilter"in l&&l.dispose()}};this.renderer.dispose(),this.scene.traverse(i=>{if(i.isMesh)if(i.geometry.dispose(),i.material.isMaterial)t(i.material);else for(const r of i.material)t(r)})}}class qU{constructor(){ut(this,"destroyed",!1);ut(this,"loop");ut(this,"rp")}async init(e){e.width=e.clientWidth,e.height=e.clientHeight;const{earthDay:t,earthNight:i,earthHeight:r,earthNormal:l,landDistance:h,waterNormal1:o,waterNormal2:p,clouds:v,stars:x}=await jU({earthDay:"/earth.jpg",earthNight:"/earth_night.jpg",earthHeight:"/earth_height.jpg",earthNormal:"/earth_normal.jpg",landDistance:"/land_distance.jpg",waterNormal1:"/water-normal2.jpg",waterNormal2:"/water-normal3.jpg",clouds:"/earth_clouds.png",stars:"/stars.jpg"});if(o.wrapS=Td,o.wrapT=Td,p.wrapS=Td,p.wrapT=Td,this.destroyed)return;const M=new WU(e,{earthDay:t,earthNight:i,earthHeight:r,earthNormal:l,landDistance:h,waterNormal1:o,waterNormal2:p,clouds:v,stars:x});this.loop=new qp(30,S=>{M.step({time:S/1e3})}),this.rp=M}startLoop(){var e;(e=this.loop)==null||e.startLoop()}destroy(){var e,t;(e=this.loop)==null||e.stopLoop(),(t=this.rp)==null||t.destroy(!0),this.destroyed=!0}}function $U(){const n=gt.useRef(null);return gt.useEffect(()=>{const e=new qU;return n.current&&e.init(n.current).then(()=>e.startLoop()),()=>e.destroy()},[n.current]),ge.jsx("canvas",{ref:n,style:{width:"100%",height:"100%"}})}function XU(){return ge.jsxs(of,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"14rem",background:"linear-gradient(180deg, var(--primary4) 0%, var(--primary3) 100%)"},children:ge.jsx(Gy,{heroBackground:ge.jsx($U,{}),title:"Resources",subtitle:"Software and media used in creating this site"})}),children:[ge.jsx("h1",{children:"Software"}),ge.jsxs("ul",{children:[ge.jsx("li",{children:"d3-ease"}),ge.jsx("li",{children:"d3-scale"}),ge.jsx("li",{children:"d3-selection"}),ge.jsx("li",{children:"d3-shape"}),ge.jsx("li",{children:"d3-transition"}),ge.jsx("li",{children:"katex"}),ge.jsx("li",{children:"maplibre-gl"}),ge.jsx("li",{children:"react"}),ge.jsx("li",{children:"react-dom"}),ge.jsx("li",{children:"react-router-dom"}),ge.jsx("li",{children:"three"})]}),ge.jsx("h1",{children:"Media"}),ge.jsxs("ul",{children:[ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/de-de/foto/weisse-windmuhle-unter-blauem-und-weissem-himmel-tagsuber-112846/",children:"Photo by musicFactory lehmannsound on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/aerial-photography-of-rocks-beside-body-of-water-3575654/",children:"Photo by Luciann Photography on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/body-of-water-near-green-mountain-931018/",children:"Photo by Oliver Sjöström on Pexels"})}),ge.jsx("li",{children:ge.jsx("a",{href:"https://www.pexels.com/photo/close-up-shot-of-a-person-writing-on-a-contract-7841506/",children:"Photo by RDNE Stock project on Pexels"})})]})]})}function T1(n,e){return n==null||e==null?NaN:n<e?-1:n>e?1:n>=e?0:NaN}function ZU(n,e){return n==null||e==null?NaN:e<n?-1:e>n?1:e>=n?0:NaN}function v8(n){let e,t,i;n.length!==2?(e=T1,t=(o,p)=>T1(n(o),p),i=(o,p)=>n(o)-p):(e=n===T1||n===ZU?n:YU,t=n,i=n);function r(o,p,v=0,x=o.length){if(v<x){if(e(p,p)!==0)return x;do{const M=v+x>>>1;t(o[M],p)<0?v=M+1:x=M}while(v<x)}return v}function l(o,p,v=0,x=o.length){if(v<x){if(e(p,p)!==0)return x;do{const M=v+x>>>1;t(o[M],p)<=0?v=M+1:x=M}while(v<x)}return v}function h(o,p,v=0,x=o.length){const M=r(o,p,v,x-1);return M>v&&i(o[M-1],p)>-i(o[M],p)?M-1:M}return{left:r,center:h,right:l}}function YU(){return 0}function KU(n){return n===null?NaN:+n}const JU=v8(T1),QU=JU.right;v8(KU).center;const eV=Math.sqrt(50),tV=Math.sqrt(10),nV=Math.sqrt(2);function cy(n,e,t){const i=(e-n)/Math.max(0,t),r=Math.floor(Math.log10(i)),l=i/Math.pow(10,r),h=l>=eV?10:l>=tV?5:l>=nV?2:1;let o,p,v;return r<0?(v=Math.pow(10,-r)/h,o=Math.round(n*v),p=Math.round(e*v),o/v<n&&++o,p/v>e&&--p,v=-v):(v=Math.pow(10,r)*h,o=Math.round(n/v),p=Math.round(e/v),o*v<n&&++o,p*v>e&&--p),p<o&&.5<=t&&t<2?cy(n,e,t*2):[o,p,v]}function iV(n,e,t){if(e=+e,n=+n,t=+t,!(t>0))return[];if(n===e)return[n];const i=e<n,[r,l,h]=i?cy(e,n,t):cy(n,e,t);if(!(l>=r))return[];const o=l-r+1,p=new Array(o);if(i)if(h<0)for(let v=0;v<o;++v)p[v]=(l-v)/-h;else for(let v=0;v<o;++v)p[v]=(l-v)*h;else if(h<0)for(let v=0;v<o;++v)p[v]=(r+v)/-h;else for(let v=0;v<o;++v)p[v]=(r+v)*h;return p}function X2(n,e,t){return e=+e,n=+n,t=+t,cy(n,e,t)[2]}function rV(n,e,t){e=+e,n=+n,t=+t;const i=e<n,r=i?X2(e,n,t):X2(n,e,t);return(i?-1:1)*(r<0?1/-r:r)}function aV(n,e){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(e).domain(n);break}return this}function Mw(n,e,t){n.prototype=e.prototype=t,t.constructor=n}function _8(n,e){var t=Object.create(n.prototype);for(var i in e)t[i]=e[i];return t}function Jp(){}var Dp=.7,uy=1/Dp,Bd="\\s*([+-]?\\d+)\\s*",Lp="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",To="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",sV=/^#([0-9a-f]{3,8})$/,oV=new RegExp(`^rgb\\(${Bd},${Bd},${Bd}\\)$`),lV=new RegExp(`^rgb\\(${To},${To},${To}\\)$`),cV=new RegExp(`^rgba\\(${Bd},${Bd},${Bd},${Lp}\\)$`),uV=new RegExp(`^rgba\\(${To},${To},${To},${Lp}\\)$`),hV=new RegExp(`^hsl\\(${Lp},${To},${To}\\)$`),dV=new RegExp(`^hsla\\(${Lp},${To},${To},${Lp}\\)$`),WM={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};Mw(Jp,Xu,{copy(n){return Object.assign(new this.constructor,this,n)},displayable(){return this.rgb().displayable()},hex:qM,formatHex:qM,formatHex8:fV,formatHsl:pV,formatRgb:$M,toString:$M});function qM(){return this.rgb().formatHex()}function fV(){return this.rgb().formatHex8()}function pV(){return x8(this).formatHsl()}function $M(){return this.rgb().formatRgb()}function Xu(n){var e,t;return n=(n+"").trim().toLowerCase(),(e=sV.exec(n))?(t=e[1].length,e=parseInt(e[1],16),t===6?XM(e):t===3?new ka(e>>8&15|e>>4&240,e>>4&15|e&240,(e&15)<<4|e&15,1):t===8?Kg(e>>24&255,e>>16&255,e>>8&255,(e&255)/255):t===4?Kg(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|e&240,((e&15)<<4|e&15)/255):null):(e=oV.exec(n))?new ka(e[1],e[2],e[3],1):(e=lV.exec(n))?new ka(e[1]*255/100,e[2]*255/100,e[3]*255/100,1):(e=cV.exec(n))?Kg(e[1],e[2],e[3],e[4]):(e=uV.exec(n))?Kg(e[1]*255/100,e[2]*255/100,e[3]*255/100,e[4]):(e=hV.exec(n))?KM(e[1],e[2]/100,e[3]/100,1):(e=dV.exec(n))?KM(e[1],e[2]/100,e[3]/100,e[4]):WM.hasOwnProperty(n)?XM(WM[n]):n==="transparent"?new ka(NaN,NaN,NaN,0):null}function XM(n){return new ka(n>>16&255,n>>8&255,n&255,1)}function Kg(n,e,t,i){return i<=0&&(n=e=t=NaN),new ka(n,e,t,i)}function mV(n){return n instanceof Jp||(n=Xu(n)),n?(n=n.rgb(),new ka(n.r,n.g,n.b,n.opacity)):new ka}function Z2(n,e,t,i){return arguments.length===1?mV(n):new ka(n,e,t,i??1)}function ka(n,e,t,i){this.r=+n,this.g=+e,this.b=+t,this.opacity=+i}Mw(ka,Z2,_8(Jp,{brighter(n){return n=n==null?uy:Math.pow(uy,n),new ka(this.r*n,this.g*n,this.b*n,this.opacity)},darker(n){return n=n==null?Dp:Math.pow(Dp,n),new ka(this.r*n,this.g*n,this.b*n,this.opacity)},rgb(){return this},clamp(){return new ka(Bu(this.r),Bu(this.g),Bu(this.b),hy(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:ZM,formatHex:ZM,formatHex8:gV,formatRgb:YM,toString:YM}));function ZM(){return`#${zu(this.r)}${zu(this.g)}${zu(this.b)}`}function gV(){return`#${zu(this.r)}${zu(this.g)}${zu(this.b)}${zu((isNaN(this.opacity)?1:this.opacity)*255)}`}function YM(){const n=hy(this.opacity);return`${n===1?"rgb(":"rgba("}${Bu(this.r)}, ${Bu(this.g)}, ${Bu(this.b)}${n===1?")":`, ${n})`}`}function hy(n){return isNaN(n)?1:Math.max(0,Math.min(1,n))}function Bu(n){return Math.max(0,Math.min(255,Math.round(n)||0))}function zu(n){return n=Bu(n),(n<16?"0":"")+n.toString(16)}function KM(n,e,t,i){return i<=0?n=e=t=NaN:t<=0||t>=1?n=e=NaN:e<=0&&(n=NaN),new Xs(n,e,t,i)}function x8(n){if(n instanceof Xs)return new Xs(n.h,n.s,n.l,n.opacity);if(n instanceof Jp||(n=Xu(n)),!n)return new Xs;if(n instanceof Xs)return n;n=n.rgb();var e=n.r/255,t=n.g/255,i=n.b/255,r=Math.min(e,t,i),l=Math.max(e,t,i),h=NaN,o=l-r,p=(l+r)/2;return o?(e===l?h=(t-i)/o+(t<i)*6:t===l?h=(i-e)/o+2:h=(e-t)/o+4,o/=p<.5?l+r:2-l-r,h*=60):o=p>0&&p<1?0:h,new Xs(h,o,p,n.opacity)}function yV(n,e,t,i){return arguments.length===1?x8(n):new Xs(n,e,t,i??1)}function Xs(n,e,t,i){this.h=+n,this.s=+e,this.l=+t,this.opacity=+i}Mw(Xs,yV,_8(Jp,{brighter(n){return n=n==null?uy:Math.pow(uy,n),new Xs(this.h,this.s,this.l*n,this.opacity)},darker(n){return n=n==null?Dp:Math.pow(Dp,n),new Xs(this.h,this.s,this.l*n,this.opacity)},rgb(){var n=this.h%360+(this.h<0)*360,e=isNaN(n)||isNaN(this.s)?0:this.s,t=this.l,i=t+(t<.5?t:1-t)*e,r=2*t-i;return new ka(Mx(n>=240?n-240:n+120,r,i),Mx(n,r,i),Mx(n<120?n+240:n-120,r,i),this.opacity)},clamp(){return new Xs(JM(this.h),Jg(this.s),Jg(this.l),hy(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const n=hy(this.opacity);return`${n===1?"hsl(":"hsla("}${JM(this.h)}, ${Jg(this.s)*100}%, ${Jg(this.l)*100}%${n===1?")":`, ${n})`}`}}));function JM(n){return n=(n||0)%360,n<0?n+360:n}function Jg(n){return Math.max(0,Math.min(1,n||0))}function Mx(n,e,t){return(n<60?e+(t-e)*n/60:n<180?t:n<240?e+(t-e)*(240-n)/60:e)*255}const Tw=n=>()=>n;function vV(n,e){return function(t){return n+t*e}}function _V(n,e,t){return n=Math.pow(n,t),e=Math.pow(e,t)-n,t=1/t,function(i){return Math.pow(n+i*e,t)}}function xV(n){return(n=+n)==1?b8:function(e,t){return t-e?_V(e,t,n):Tw(isNaN(e)?t:e)}}function b8(n,e){var t=e-n;return t?vV(n,t):Tw(isNaN(n)?e:n)}const dy=function n(e){var t=xV(e);function i(r,l){var h=t((r=Z2(r)).r,(l=Z2(l)).r),o=t(r.g,l.g),p=t(r.b,l.b),v=b8(r.opacity,l.opacity);return function(x){return r.r=h(x),r.g=o(x),r.b=p(x),r.opacity=v(x),r+""}}return i.gamma=n,i}(1);function bV(n,e){e||(e=[]);var t=n?Math.min(e.length,n.length):0,i=e.slice(),r;return function(l){for(r=0;r<t;++r)i[r]=n[r]*(1-l)+e[r]*l;return i}}function wV(n){return ArrayBuffer.isView(n)&&!(n instanceof DataView)}function SV(n,e){var t=e?e.length:0,i=n?Math.min(t,n.length):0,r=new Array(i),l=new Array(t),h;for(h=0;h<i;++h)r[h]=Ew(n[h],e[h]);for(;h<t;++h)l[h]=e[h];return function(o){for(h=0;h<i;++h)l[h]=r[h](o);return l}}function MV(n,e){var t=new Date;return n=+n,e=+e,function(i){return t.setTime(n*(1-i)+e*i),t}}function qs(n,e){return n=+n,e=+e,function(t){return n*(1-t)+e*t}}function TV(n,e){var t={},i={},r;(n===null||typeof n!="object")&&(n={}),(e===null||typeof e!="object")&&(e={});for(r in e)r in n?t[r]=Ew(n[r],e[r]):i[r]=e[r];return function(l){for(r in t)i[r]=t[r](l);return i}}var Y2=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Tx=new RegExp(Y2.source,"g");function EV(n){return function(){return n}}function AV(n){return function(e){return n(e)+""}}function w8(n,e){var t=Y2.lastIndex=Tx.lastIndex=0,i,r,l,h=-1,o=[],p=[];for(n=n+"",e=e+"";(i=Y2.exec(n))&&(r=Tx.exec(e));)(l=r.index)>t&&(l=e.slice(t,l),o[h]?o[h]+=l:o[++h]=l),(i=i[0])===(r=r[0])?o[h]?o[h]+=r:o[++h]=r:(o[++h]=null,p.push({i:h,x:qs(i,r)})),t=Tx.lastIndex;return t<e.length&&(l=e.slice(t),o[h]?o[h]+=l:o[++h]=l),o.length<2?p[0]?AV(p[0].x):EV(e):(e=p.length,function(v){for(var x=0,M;x<e;++x)o[(M=p[x]).i]=M.x(v);return o.join("")})}function Ew(n,e){var t=typeof e,i;return e==null||t==="boolean"?Tw(e):(t==="number"?qs:t==="string"?(i=Xu(e))?(e=i,dy):w8:e instanceof Xu?dy:e instanceof Date?MV:wV(e)?bV:Array.isArray(e)?SV:typeof e.valueOf!="function"&&typeof e.toString!="function"||isNaN(e)?TV:qs)(n,e)}function CV(n,e){return n=+n,e=+e,function(t){return Math.round(n*(1-t)+e*t)}}var QM=180/Math.PI,K2={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function S8(n,e,t,i,r,l){var h,o,p;return(h=Math.sqrt(n*n+e*e))&&(n/=h,e/=h),(p=n*t+e*i)&&(t-=n*p,i-=e*p),(o=Math.sqrt(t*t+i*i))&&(t/=o,i/=o,p/=o),n*i<e*t&&(n=-n,e=-e,p=-p,h=-h),{translateX:r,translateY:l,rotate:Math.atan2(e,n)*QM,skewX:Math.atan(p)*QM,scaleX:h,scaleY:o}}var Qg;function PV(n){const e=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(n+"");return e.isIdentity?K2:S8(e.a,e.b,e.c,e.d,e.e,e.f)}function RV(n){return n==null||(Qg||(Qg=document.createElementNS("http://www.w3.org/2000/svg","g")),Qg.setAttribute("transform",n),!(n=Qg.transform.baseVal.consolidate()))?K2:(n=n.matrix,S8(n.a,n.b,n.c,n.d,n.e,n.f))}function M8(n,e,t,i){function r(v){return v.length?v.pop()+" ":""}function l(v,x,M,S,A,L){if(v!==M||x!==S){var F=A.push("translate(",null,e,null,t);L.push({i:F-4,x:qs(v,M)},{i:F-2,x:qs(x,S)})}else(M||S)&&A.push("translate("+M+e+S+t)}function h(v,x,M,S){v!==x?(v-x>180?x+=360:x-v>180&&(v+=360),S.push({i:M.push(r(M)+"rotate(",null,i)-2,x:qs(v,x)})):x&&M.push(r(M)+"rotate("+x+i)}function o(v,x,M,S){v!==x?S.push({i:M.push(r(M)+"skewX(",null,i)-2,x:qs(v,x)}):x&&M.push(r(M)+"skewX("+x+i)}function p(v,x,M,S,A,L){if(v!==M||x!==S){var F=A.push(r(A)+"scale(",null,",",null,")");L.push({i:F-4,x:qs(v,M)},{i:F-2,x:qs(x,S)})}else(M!==1||S!==1)&&A.push(r(A)+"scale("+M+","+S+")")}return function(v,x){var M=[],S=[];return v=n(v),x=n(x),l(v.translateX,v.translateY,x.translateX,x.translateY,M,S),h(v.rotate,x.rotate,M,S),o(v.skewX,x.skewX,M,S),p(v.scaleX,v.scaleY,x.scaleX,x.scaleY,M,S),v=x=null,function(A){for(var L=-1,F=S.length,k;++L<F;)M[(k=S[L]).i]=k.x(A);return M.join("")}}}var IV=M8(PV,"px, ","px)","deg)"),kV=M8(RV,", ",")",")");function DV(n){return function(){return n}}function LV(n){return+n}var eT=[0,1];function Ad(n){return n}function J2(n,e){return(e-=n=+n)?function(t){return(t-n)/e}:DV(isNaN(e)?NaN:.5)}function zV(n,e){var t;return n>e&&(t=n,n=e,e=t),function(i){return Math.max(n,Math.min(e,i))}}function FV(n,e,t){var i=n[0],r=n[1],l=e[0],h=e[1];return r<i?(i=J2(r,i),l=t(h,l)):(i=J2(i,r),l=t(l,h)),function(o){return l(i(o))}}function NV(n,e,t){var i=Math.min(n.length,e.length)-1,r=new Array(i),l=new Array(i),h=-1;for(n[i]<n[0]&&(n=n.slice().reverse(),e=e.slice().reverse());++h<i;)r[h]=J2(n[h],n[h+1]),l[h]=t(e[h],e[h+1]);return function(o){var p=QU(n,o,1,i)-1;return l[p](r[p](o))}}function BV(n,e){return e.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function OV(){var n=eT,e=eT,t=Ew,i,r,l,h=Ad,o,p,v;function x(){var S=Math.min(n.length,e.length);return h!==Ad&&(h=zV(n[0],n[S-1])),o=S>2?NV:FV,p=v=null,M}function M(S){return S==null||isNaN(S=+S)?l:(p||(p=o(n.map(i),e,t)))(i(h(S)))}return M.invert=function(S){return h(r((v||(v=o(e,n.map(i),qs)))(S)))},M.domain=function(S){return arguments.length?(n=Array.from(S,LV),x()):n.slice()},M.range=function(S){return arguments.length?(e=Array.from(S),x()):e.slice()},M.rangeRound=function(S){return e=Array.from(S),t=CV,x()},M.clamp=function(S){return arguments.length?(h=S?!0:Ad,x()):h!==Ad},M.interpolate=function(S){return arguments.length?(t=S,x()):t},M.unknown=function(S){return arguments.length?(l=S,M):l},function(S,A){return i=S,r=A,x()}}function UV(){return OV()(Ad,Ad)}function VV(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function fy(n,e){if((t=(n=e?n.toExponential(e-1):n.toExponential()).indexOf("e"))<0)return null;var t,i=n.slice(0,t);return[i.length>1?i[0]+i.slice(2):i,+n.slice(t+1)]}function Jd(n){return n=fy(Math.abs(n)),n?n[1]:NaN}function HV(n,e){return function(t,i){for(var r=t.length,l=[],h=0,o=n[0],p=0;r>0&&o>0&&(p+o+1>i&&(o=Math.max(1,i-p)),l.push(t.substring(r-=o,r+o)),!((p+=o+1)>i));)o=n[h=(h+1)%n.length];return l.reverse().join(e)}}function GV(n){return function(e){return e.replace(/[0-9]/g,function(t){return n[+t]})}}var jV=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function py(n){if(!(e=jV.exec(n)))throw new Error("invalid format: "+n);var e;return new Aw({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}py.prototype=Aw.prototype;function Aw(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Aw.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function WV(n){e:for(var e=n.length,t=1,i=-1,r;t<e;++t)switch(n[t]){case".":i=r=t;break;case"0":i===0&&(i=t),r=t;break;default:if(!+n[t])break e;i>0&&(i=0);break}return i>0?n.slice(0,i)+n.slice(r+1):n}var T8;function qV(n,e){var t=fy(n,e);if(!t)return n+"";var i=t[0],r=t[1],l=r-(T8=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,h=i.length;return l===h?i:l>h?i+new Array(l-h+1).join("0"):l>0?i.slice(0,l)+"."+i.slice(l):"0."+new Array(1-l).join("0")+fy(n,Math.max(0,e+l-1))[0]}function tT(n,e){var t=fy(n,e);if(!t)return n+"";var i=t[0],r=t[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const nT={"%":(n,e)=>(n*100).toFixed(e),b:n=>Math.round(n).toString(2),c:n=>n+"",d:VV,e:(n,e)=>n.toExponential(e),f:(n,e)=>n.toFixed(e),g:(n,e)=>n.toPrecision(e),o:n=>Math.round(n).toString(8),p:(n,e)=>tT(n*100,e),r:tT,s:qV,X:n=>Math.round(n).toString(16).toUpperCase(),x:n=>Math.round(n).toString(16)};function iT(n){return n}var rT=Array.prototype.map,aT=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function $V(n){var e=n.grouping===void 0||n.thousands===void 0?iT:HV(rT.call(n.grouping,Number),n.thousands+""),t=n.currency===void 0?"":n.currency[0]+"",i=n.currency===void 0?"":n.currency[1]+"",r=n.decimal===void 0?".":n.decimal+"",l=n.numerals===void 0?iT:GV(rT.call(n.numerals,String)),h=n.percent===void 0?"%":n.percent+"",o=n.minus===void 0?"−":n.minus+"",p=n.nan===void 0?"NaN":n.nan+"";function v(M){M=py(M);var S=M.fill,A=M.align,L=M.sign,F=M.symbol,k=M.zero,C=M.width,V=M.comma,O=M.precision,J=M.trim,ue=M.type;ue==="n"?(V=!0,ue="g"):nT[ue]||(O===void 0&&(O=12),J=!0,ue="g"),(k||S==="0"&&A==="=")&&(k=!0,S="0",A="=");var Y=F==="$"?t:F==="#"&&/[boxX]/.test(ue)?"0"+ue.toLowerCase():"",Q=F==="$"?i:/[%p]/.test(ue)?h:"",xe=nT[ue],re=/[defgprs%]/.test(ue);O=O===void 0?6:/[gprs]/.test(ue)?Math.max(1,Math.min(21,O)):Math.max(0,Math.min(20,O));function ee(Me){var Fe=Y,Ae=Q,He,ot,ft;if(ue==="c")Ae=xe(Me)+Ae,Me="";else{Me=+Me;var ct=Me<0||1/Me<0;if(Me=isNaN(Me)?p:xe(Math.abs(Me),O),J&&(Me=WV(Me)),ct&&+Me==0&&L!=="+"&&(ct=!1),Fe=(ct?L==="("?L:o:L==="-"||L==="("?"":L)+Fe,Ae=(ue==="s"?aT[8+T8/3]:"")+Ae+(ct&&L==="("?")":""),re){for(He=-1,ot=Me.length;++He<ot;)if(ft=Me.charCodeAt(He),48>ft||ft>57){Ae=(ft===46?r+Me.slice(He+1):Me.slice(He))+Ae,Me=Me.slice(0,He);break}}}V&&!k&&(Me=e(Me,1/0));var De=Fe.length+Me.length+Ae.length,Je=De<C?new Array(C-De+1).join(S):"";switch(V&&k&&(Me=e(Je+Me,Je.length?C-Ae.length:1/0),Je=""),A){case"<":Me=Fe+Me+Ae+Je;break;case"=":Me=Fe+Je+Me+Ae;break;case"^":Me=Je.slice(0,De=Je.length>>1)+Fe+Me+Ae+Je.slice(De);break;default:Me=Je+Fe+Me+Ae;break}return l(Me)}return ee.toString=function(){return M+""},ee}function x(M,S){var A=v((M=py(M),M.type="f",M)),L=Math.max(-8,Math.min(8,Math.floor(Jd(S)/3)))*3,F=Math.pow(10,-L),k=aT[8+L/3];return function(C){return A(F*C)+k}}return{format:v,formatPrefix:x}}var e1,E8,A8;XV({thousands:",",grouping:[3],currency:["$",""]});function XV(n){return e1=$V(n),E8=e1.format,A8=e1.formatPrefix,e1}function ZV(n){return Math.max(0,-Jd(Math.abs(n)))}function YV(n,e){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Jd(e)/3)))*3-Jd(Math.abs(n)))}function KV(n,e){return n=Math.abs(n),e=Math.abs(e)-n,Math.max(0,Jd(e)-Jd(n))+1}function JV(n,e,t,i){var r=rV(n,e,t),l;switch(i=py(i??",f"),i.type){case"s":{var h=Math.max(Math.abs(n),Math.abs(e));return i.precision==null&&!isNaN(l=YV(r,h))&&(i.precision=l),A8(i,h)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(l=KV(r,Math.max(Math.abs(n),Math.abs(e))))&&(i.precision=l-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(l=ZV(r))&&(i.precision=l-(i.type==="%")*2);break}}return E8(i)}function QV(n){var e=n.domain;return n.ticks=function(t){var i=e();return iV(i[0],i[i.length-1],t??10)},n.tickFormat=function(t,i){var r=e();return JV(r[0],r[r.length-1],t??10,i)},n.nice=function(t){t==null&&(t=10);var i=e(),r=0,l=i.length-1,h=i[r],o=i[l],p,v,x=10;for(o<h&&(v=h,h=o,o=v,v=r,r=l,l=v);x-- >0;){if(v=X2(h,o,t),v===p)return i[r]=h,i[l]=o,e(i);if(v>0)h=Math.floor(h/v)*v,o=Math.ceil(o/v)*v;else if(v<0)h=Math.ceil(h*v)/v,o=Math.floor(o*v)/v;else break;p=v}return n},n}function zp(){var n=UV();return n.copy=function(){return BV(n,zp())},aV.apply(n,arguments),QV(n)}var Q2="http://www.w3.org/1999/xhtml";const sT={svg:"http://www.w3.org/2000/svg",xhtml:Q2,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Ky(n){var e=n+="",t=e.indexOf(":");return t>=0&&(e=n.slice(0,t))!=="xmlns"&&(n=n.slice(t+1)),sT.hasOwnProperty(e)?{space:sT[e],local:n}:n}function eH(n){return function(){var e=this.ownerDocument,t=this.namespaceURI;return t===Q2&&e.documentElement.namespaceURI===Q2?e.createElement(n):e.createElementNS(t,n)}}function tH(n){return function(){return this.ownerDocument.createElementNS(n.space,n.local)}}function C8(n){var e=Ky(n);return(e.local?tH:eH)(e)}function nH(){}function Cw(n){return n==null?nH:function(){return this.querySelector(n)}}function iH(n){typeof n!="function"&&(n=Cw(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var l=e[r],h=l.length,o=i[r]=new Array(h),p,v,x=0;x<h;++x)(p=l[x])&&(v=n.call(p,p.__data__,x,l))&&("__data__"in p&&(v.__data__=p.__data__),o[x]=v);return new ns(i,this._parents)}function rH(n){return n==null?[]:Array.isArray(n)?n:Array.from(n)}function aH(){return[]}function P8(n){return n==null?aH:function(){return this.querySelectorAll(n)}}function sH(n){return function(){return rH(n.apply(this,arguments))}}function oH(n){typeof n=="function"?n=sH(n):n=P8(n);for(var e=this._groups,t=e.length,i=[],r=[],l=0;l<t;++l)for(var h=e[l],o=h.length,p,v=0;v<o;++v)(p=h[v])&&(i.push(n.call(p,p.__data__,v,h)),r.push(p));return new ns(i,r)}function R8(n){return function(){return this.matches(n)}}function I8(n){return function(e){return e.matches(n)}}var lH=Array.prototype.find;function cH(n){return function(){return lH.call(this.children,n)}}function uH(){return this.firstElementChild}function hH(n){return this.select(n==null?uH:cH(typeof n=="function"?n:I8(n)))}var dH=Array.prototype.filter;function fH(){return Array.from(this.children)}function pH(n){return function(){return dH.call(this.children,n)}}function mH(n){return this.selectAll(n==null?fH:pH(typeof n=="function"?n:I8(n)))}function gH(n){typeof n!="function"&&(n=R8(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var l=e[r],h=l.length,o=i[r]=[],p,v=0;v<h;++v)(p=l[v])&&n.call(p,p.__data__,v,l)&&o.push(p);return new ns(i,this._parents)}function k8(n){return new Array(n.length)}function yH(){return new ns(this._enter||this._groups.map(k8),this._parents)}function my(n,e){this.ownerDocument=n.ownerDocument,this.namespaceURI=n.namespaceURI,this._next=null,this._parent=n,this.__data__=e}my.prototype={constructor:my,appendChild:function(n){return this._parent.insertBefore(n,this._next)},insertBefore:function(n,e){return this._parent.insertBefore(n,e)},querySelector:function(n){return this._parent.querySelector(n)},querySelectorAll:function(n){return this._parent.querySelectorAll(n)}};function vH(n){return function(){return n}}function _H(n,e,t,i,r,l){for(var h=0,o,p=e.length,v=l.length;h<v;++h)(o=e[h])?(o.__data__=l[h],i[h]=o):t[h]=new my(n,l[h]);for(;h<p;++h)(o=e[h])&&(r[h]=o)}function xH(n,e,t,i,r,l,h){var o,p,v=new Map,x=e.length,M=l.length,S=new Array(x),A;for(o=0;o<x;++o)(p=e[o])&&(S[o]=A=h.call(p,p.__data__,o,e)+"",v.has(A)?r[o]=p:v.set(A,p));for(o=0;o<M;++o)A=h.call(n,l[o],o,l)+"",(p=v.get(A))?(i[o]=p,p.__data__=l[o],v.delete(A)):t[o]=new my(n,l[o]);for(o=0;o<x;++o)(p=e[o])&&v.get(S[o])===p&&(r[o]=p)}function bH(n){return n.__data__}function wH(n,e){if(!arguments.length)return Array.from(this,bH);var t=e?xH:_H,i=this._parents,r=this._groups;typeof n!="function"&&(n=vH(n));for(var l=r.length,h=new Array(l),o=new Array(l),p=new Array(l),v=0;v<l;++v){var x=i[v],M=r[v],S=M.length,A=SH(n.call(x,x&&x.__data__,v,i)),L=A.length,F=o[v]=new Array(L),k=h[v]=new Array(L),C=p[v]=new Array(S);t(x,M,F,k,C,A,e);for(var V=0,O=0,J,ue;V<L;++V)if(J=F[V]){for(V>=O&&(O=V+1);!(ue=k[O])&&++O<L;);J._next=ue||null}}return h=new ns(h,i),h._enter=o,h._exit=p,h}function SH(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function MH(){return new ns(this._exit||this._groups.map(k8),this._parents)}function TH(n,e,t){var i=this.enter(),r=this,l=this.exit();return typeof n=="function"?(i=n(i),i&&(i=i.selection())):i=i.append(n+""),e!=null&&(r=e(r),r&&(r=r.selection())),t==null?l.remove():t(l),i&&r?i.merge(r).order():r}function EH(n){for(var e=n.selection?n.selection():n,t=this._groups,i=e._groups,r=t.length,l=i.length,h=Math.min(r,l),o=new Array(r),p=0;p<h;++p)for(var v=t[p],x=i[p],M=v.length,S=o[p]=new Array(M),A,L=0;L<M;++L)(A=v[L]||x[L])&&(S[L]=A);for(;p<r;++p)o[p]=t[p];return new ns(o,this._parents)}function AH(){for(var n=this._groups,e=-1,t=n.length;++e<t;)for(var i=n[e],r=i.length-1,l=i[r],h;--r>=0;)(h=i[r])&&(l&&h.compareDocumentPosition(l)^4&&l.parentNode.insertBefore(h,l),l=h);return this}function CH(n){n||(n=PH);function e(M,S){return M&&S?n(M.__data__,S.__data__):!M-!S}for(var t=this._groups,i=t.length,r=new Array(i),l=0;l<i;++l){for(var h=t[l],o=h.length,p=r[l]=new Array(o),v,x=0;x<o;++x)(v=h[x])&&(p[x]=v);p.sort(e)}return new ns(r,this._parents).order()}function PH(n,e){return n<e?-1:n>e?1:n>=e?0:NaN}function RH(){var n=arguments[0];return arguments[0]=this,n.apply(null,arguments),this}function IH(){return Array.from(this)}function kH(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,l=i.length;r<l;++r){var h=i[r];if(h)return h}return null}function DH(){let n=0;for(const e of this)++n;return n}function LH(){return!this.node()}function zH(n){for(var e=this._groups,t=0,i=e.length;t<i;++t)for(var r=e[t],l=0,h=r.length,o;l<h;++l)(o=r[l])&&n.call(o,o.__data__,l,r);return this}function FH(n){return function(){this.removeAttribute(n)}}function NH(n){return function(){this.removeAttributeNS(n.space,n.local)}}function BH(n,e){return function(){this.setAttribute(n,e)}}function OH(n,e){return function(){this.setAttributeNS(n.space,n.local,e)}}function UH(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttribute(n):this.setAttribute(n,t)}}function VH(n,e){return function(){var t=e.apply(this,arguments);t==null?this.removeAttributeNS(n.space,n.local):this.setAttributeNS(n.space,n.local,t)}}function HH(n,e){var t=Ky(n);if(arguments.length<2){var i=this.node();return t.local?i.getAttributeNS(t.space,t.local):i.getAttribute(t)}return this.each((e==null?t.local?NH:FH:typeof e=="function"?t.local?VH:UH:t.local?OH:BH)(t,e))}function D8(n){return n.ownerDocument&&n.ownerDocument.defaultView||n.document&&n||n.defaultView}function GH(n){return function(){this.style.removeProperty(n)}}function jH(n,e,t){return function(){this.style.setProperty(n,e,t)}}function WH(n,e,t){return function(){var i=e.apply(this,arguments);i==null?this.style.removeProperty(n):this.style.setProperty(n,i,t)}}function qH(n,e,t){return arguments.length>1?this.each((e==null?GH:typeof e=="function"?WH:jH)(n,e,t??"")):Qd(this.node(),n)}function Qd(n,e){return n.style.getPropertyValue(e)||D8(n).getComputedStyle(n,null).getPropertyValue(e)}function $H(n){return function(){delete this[n]}}function XH(n,e){return function(){this[n]=e}}function ZH(n,e){return function(){var t=e.apply(this,arguments);t==null?delete this[n]:this[n]=t}}function YH(n,e){return arguments.length>1?this.each((e==null?$H:typeof e=="function"?ZH:XH)(n,e)):this.node()[n]}function L8(n){return n.trim().split(/^|\s+/)}function Pw(n){return n.classList||new z8(n)}function z8(n){this._node=n,this._names=L8(n.getAttribute("class")||"")}z8.prototype={add:function(n){var e=this._names.indexOf(n);e<0&&(this._names.push(n),this._node.setAttribute("class",this._names.join(" ")))},remove:function(n){var e=this._names.indexOf(n);e>=0&&(this._names.splice(e,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(n){return this._names.indexOf(n)>=0}};function F8(n,e){for(var t=Pw(n),i=-1,r=e.length;++i<r;)t.add(e[i])}function N8(n,e){for(var t=Pw(n),i=-1,r=e.length;++i<r;)t.remove(e[i])}function KH(n){return function(){F8(this,n)}}function JH(n){return function(){N8(this,n)}}function QH(n,e){return function(){(e.apply(this,arguments)?F8:N8)(this,n)}}function eG(n,e){var t=L8(n+"");if(arguments.length<2){for(var i=Pw(this.node()),r=-1,l=t.length;++r<l;)if(!i.contains(t[r]))return!1;return!0}return this.each((typeof e=="function"?QH:e?KH:JH)(t,e))}function tG(){this.textContent=""}function nG(n){return function(){this.textContent=n}}function iG(n){return function(){var e=n.apply(this,arguments);this.textContent=e??""}}function rG(n){return arguments.length?this.each(n==null?tG:(typeof n=="function"?iG:nG)(n)):this.node().textContent}function aG(){this.innerHTML=""}function sG(n){return function(){this.innerHTML=n}}function oG(n){return function(){var e=n.apply(this,arguments);this.innerHTML=e??""}}function lG(n){return arguments.length?this.each(n==null?aG:(typeof n=="function"?oG:sG)(n)):this.node().innerHTML}function cG(){this.nextSibling&&this.parentNode.appendChild(this)}function uG(){return this.each(cG)}function hG(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function dG(){return this.each(hG)}function fG(n){var e=typeof n=="function"?n:C8(n);return this.select(function(){return this.appendChild(e.apply(this,arguments))})}function pG(){return null}function mG(n,e){var t=typeof n=="function"?n:C8(n),i=e==null?pG:typeof e=="function"?e:Cw(e);return this.select(function(){return this.insertBefore(t.apply(this,arguments),i.apply(this,arguments)||null)})}function gG(){var n=this.parentNode;n&&n.removeChild(this)}function yG(){return this.each(gG)}function vG(){var n=this.cloneNode(!1),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function _G(){var n=this.cloneNode(!0),e=this.parentNode;return e?e.insertBefore(n,this.nextSibling):n}function xG(n){return this.select(n?_G:vG)}function bG(n){return arguments.length?this.property("__data__",n):this.node().__data__}function wG(n){return function(e){n.call(this,e,this.__data__)}}function SG(n){return n.trim().split(/^|\s+/).map(function(e){var t="",i=e.indexOf(".");return i>=0&&(t=e.slice(i+1),e=e.slice(0,i)),{type:e,name:t}})}function MG(n){return function(){var e=this.__on;if(e){for(var t=0,i=-1,r=e.length,l;t<r;++t)l=e[t],(!n.type||l.type===n.type)&&l.name===n.name?this.removeEventListener(l.type,l.listener,l.options):e[++i]=l;++i?e.length=i:delete this.__on}}}function TG(n,e,t){return function(){var i=this.__on,r,l=wG(e);if(i){for(var h=0,o=i.length;h<o;++h)if((r=i[h]).type===n.type&&r.name===n.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=l,r.options=t),r.value=e;return}}this.addEventListener(n.type,l,t),r={type:n.type,name:n.name,value:e,listener:l,options:t},i?i.push(r):this.__on=[r]}}function EG(n,e,t){var i=SG(n+""),r,l=i.length,h;if(arguments.length<2){var o=this.node().__on;if(o){for(var p=0,v=o.length,x;p<v;++p)for(r=0,x=o[p];r<l;++r)if((h=i[r]).type===x.type&&h.name===x.name)return x.value}return}for(o=e?TG:MG,r=0;r<l;++r)this.each(o(i[r],e,t));return this}function B8(n,e,t){var i=D8(n),r=i.CustomEvent;typeof r=="function"?r=new r(e,t):(r=i.document.createEvent("Event"),t?(r.initEvent(e,t.bubbles,t.cancelable),r.detail=t.detail):r.initEvent(e,!1,!1)),n.dispatchEvent(r)}function AG(n,e){return function(){return B8(this,n,e)}}function CG(n,e){return function(){return B8(this,n,e.apply(this,arguments))}}function PG(n,e){return this.each((typeof e=="function"?CG:AG)(n,e))}function*RG(){for(var n=this._groups,e=0,t=n.length;e<t;++e)for(var i=n[e],r=0,l=i.length,h;r<l;++r)(h=i[r])&&(yield h)}var O8=[null];function ns(n,e){this._groups=n,this._parents=e}function uf(){return new ns([[document.documentElement]],O8)}function IG(){return this}ns.prototype=uf.prototype={constructor:ns,select:iH,selectAll:oH,selectChild:hH,selectChildren:mH,filter:gH,data:wH,enter:yH,exit:MH,join:TH,merge:EH,selection:IG,order:AH,sort:CH,call:RH,nodes:IH,node:kH,size:DH,empty:LH,each:zH,attr:HH,style:qH,property:YH,classed:eG,text:rG,html:lG,raise:uG,lower:dG,append:fG,insert:mG,remove:yG,clone:xG,datum:bG,on:EG,dispatch:PG,[Symbol.iterator]:RG};function U8(n){return typeof n=="string"?new ns([[document.querySelector(n)]],[document.documentElement]):new ns([[n]],O8)}function od(n){return function(){return n}}const eb=Math.PI,tb=2*eb,Tu=1e-6,kG=tb-Tu;function V8(n){this._+=n[0];for(let e=1,t=n.length;e<t;++e)this._+=arguments[e]+n[e]}function DG(n){let e=Math.floor(n);if(!(e>=0))throw new Error(`invalid digits: ${n}`);if(e>15)return V8;const t=10**e;return function(i){this._+=i[0];for(let r=1,l=i.length;r<l;++r)this._+=Math.round(arguments[r]*t)/t+i[r]}}let LG=class{constructor(e){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=e==null?V8:DG(e)}moveTo(e,t){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(e,t){this._append`L${this._x1=+e},${this._y1=+t}`}quadraticCurveTo(e,t,i,r){this._append`Q${+e},${+t},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(e,t,i,r,l,h){this._append`C${+e},${+t},${+i},${+r},${this._x1=+l},${this._y1=+h}`}arcTo(e,t,i,r,l){if(e=+e,t=+t,i=+i,r=+r,l=+l,l<0)throw new Error(`negative radius: ${l}`);let h=this._x1,o=this._y1,p=i-e,v=r-t,x=h-e,M=o-t,S=x*x+M*M;if(this._x1===null)this._append`M${this._x1=e},${this._y1=t}`;else if(S>Tu)if(!(Math.abs(M*p-v*x)>Tu)||!l)this._append`L${this._x1=e},${this._y1=t}`;else{let A=i-h,L=r-o,F=p*p+v*v,k=A*A+L*L,C=Math.sqrt(F),V=Math.sqrt(S),O=l*Math.tan((eb-Math.acos((F+S-k)/(2*C*V)))/2),J=O/V,ue=O/C;Math.abs(J-1)>Tu&&this._append`L${e+J*x},${t+J*M}`,this._append`A${l},${l},0,0,${+(M*A>x*L)},${this._x1=e+ue*p},${this._y1=t+ue*v}`}}arc(e,t,i,r,l,h){if(e=+e,t=+t,i=+i,h=!!h,i<0)throw new Error(`negative radius: ${i}`);let o=i*Math.cos(r),p=i*Math.sin(r),v=e+o,x=t+p,M=1^h,S=h?r-l:l-r;this._x1===null?this._append`M${v},${x}`:(Math.abs(this._x1-v)>Tu||Math.abs(this._y1-x)>Tu)&&this._append`L${v},${x}`,i&&(S<0&&(S=S%tb+tb),S>kG?this._append`A${i},${i},0,1,${M},${e-o},${t-p}A${i},${i},0,1,${M},${this._x1=v},${this._y1=x}`:S>Tu&&this._append`A${i},${i},0,${+(S>=eb)},${M},${this._x1=e+i*Math.cos(l)},${this._y1=t+i*Math.sin(l)}`)}rect(e,t,i,r){this._append`M${this._x0=this._x1=+e},${this._y0=this._y1=+t}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}};function zG(n){let e=3;return n.digits=function(t){if(!arguments.length)return e;if(t==null)e=null;else{const i=Math.floor(t);if(!(i>=0))throw new RangeError(`invalid digits: ${t}`);e=i}return n},()=>new LG(e)}function FG(n){return typeof n=="object"&&"length"in n?n:Array.from(n)}function H8(n){this._context=n}H8.prototype={areaStart:function(){this._line=0},areaEnd:function(){this._line=NaN},lineStart:function(){this._point=0},lineEnd:function(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line},point:function(n,e){switch(n=+n,e=+e,this._point){case 0:this._point=1,this._line?this._context.lineTo(n,e):this._context.moveTo(n,e);break;case 1:this._point=2;default:this._context.lineTo(n,e);break}}};function NG(n){return new H8(n)}function BG(n){return n[0]}function OG(n){return n[1]}function UG(n,e){var t=od(!0),i=null,r=NG,l=null,h=zG(o);n=typeof n=="function"?n:n===void 0?BG:od(n),e=typeof e=="function"?e:e===void 0?OG:od(e);function o(p){var v,x=(p=FG(p)).length,M,S=!1,A;for(i==null&&(l=r(A=h())),v=0;v<=x;++v)!(v<x&&t(M=p[v],v,p))===S&&((S=!S)?l.lineStart():l.lineEnd()),S&&l.point(+n(M,v,p),+e(M,v,p));if(A)return l=null,A+""||null}return o.x=function(p){return arguments.length?(n=typeof p=="function"?p:od(+p),o):n},o.y=function(p){return arguments.length?(e=typeof p=="function"?p:od(+p),o):e},o.defined=function(p){return arguments.length?(t=typeof p=="function"?p:od(!!p),o):t},o.curve=function(p){return arguments.length?(r=p,i!=null&&(l=r(i)),o):r},o.context=function(p){return arguments.length?(p==null?i=l=null:l=r(i=p),o):i},o}var VG={value:()=>{}};function G8(){for(var n=0,e=arguments.length,t={},i;n<e;++n){if(!(i=arguments[n]+"")||i in t||/[\s.]/.test(i))throw new Error("illegal type: "+i);t[i]=[]}return new E1(t)}function E1(n){this._=n}function HG(n,e){return n.trim().split(/^|\s+/).map(function(t){var i="",r=t.indexOf(".");if(r>=0&&(i=t.slice(r+1),t=t.slice(0,r)),t&&!e.hasOwnProperty(t))throw new Error("unknown type: "+t);return{type:t,name:i}})}E1.prototype=G8.prototype={constructor:E1,on:function(n,e){var t=this._,i=HG(n+"",t),r,l=-1,h=i.length;if(arguments.length<2){for(;++l<h;)if((r=(n=i[l]).type)&&(r=GG(t[r],n.name)))return r;return}if(e!=null&&typeof e!="function")throw new Error("invalid callback: "+e);for(;++l<h;)if(r=(n=i[l]).type)t[r]=oT(t[r],n.name,e);else if(e==null)for(r in t)t[r]=oT(t[r],n.name,null);return this},copy:function(){var n={},e=this._;for(var t in e)n[t]=e[t].slice();return new E1(n)},call:function(n,e){if((r=arguments.length-2)>0)for(var t=new Array(r),i=0,r,l;i<r;++i)t[i]=arguments[i+2];if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(l=this._[n],i=0,r=l.length;i<r;++i)l[i].value.apply(e,t)},apply:function(n,e,t){if(!this._.hasOwnProperty(n))throw new Error("unknown type: "+n);for(var i=this._[n],r=0,l=i.length;r<l;++r)i[r].value.apply(e,t)}};function GG(n,e){for(var t=0,i=n.length,r;t<i;++t)if((r=n[t]).name===e)return r.value}function oT(n,e,t){for(var i=0,r=n.length;i<r;++i)if(n[i].name===e){n[i]=VG,n=n.slice(0,i).concat(n.slice(i+1));break}return t!=null&&n.push({name:e,value:t}),n}var ef=0,W0=0,B0=0,j8=1e3,gy,q0,yy=0,Zu=0,Jy=0,Fp=typeof performance=="object"&&performance.now?performance:Date,W8=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(n){setTimeout(n,17)};function Rw(){return Zu||(W8(jG),Zu=Fp.now()+Jy)}function jG(){Zu=0}function vy(){this._call=this._time=this._next=null}vy.prototype=q8.prototype={constructor:vy,restart:function(n,e,t){if(typeof n!="function")throw new TypeError("callback is not a function");t=(t==null?Rw():+t)+(e==null?0:+e),!this._next&&q0!==this&&(q0?q0._next=this:gy=this,q0=this),this._call=n,this._time=t,nb()},stop:function(){this._call&&(this._call=null,this._time=1/0,nb())}};function q8(n,e,t){var i=new vy;return i.restart(n,e,t),i}function WG(){Rw(),++ef;for(var n=gy,e;n;)(e=Zu-n._time)>=0&&n._call.call(void 0,e),n=n._next;--ef}function lT(){Zu=(yy=Fp.now())+Jy,ef=W0=0;try{WG()}finally{ef=0,$G(),Zu=0}}function qG(){var n=Fp.now(),e=n-yy;e>j8&&(Jy-=e,yy=n)}function $G(){for(var n,e=gy,t,i=1/0;e;)e._call?(i>e._time&&(i=e._time),n=e,e=e._next):(t=e._next,e._next=null,e=n?n._next=t:gy=t);q0=n,nb(i)}function nb(n){if(!ef){W0&&(W0=clearTimeout(W0));var e=n-Zu;e>24?(n<1/0&&(W0=setTimeout(lT,n-Fp.now()-Jy)),B0&&(B0=clearInterval(B0))):(B0||(yy=Fp.now(),B0=setInterval(qG,j8)),ef=1,W8(lT))}}function cT(n,e,t){var i=new vy;return e=e==null?0:+e,i.restart(r=>{i.stop(),n(r+e)},e,t),i}var XG=G8("start","end","cancel","interrupt"),ZG=[],$8=0,uT=1,ib=2,A1=3,hT=4,rb=5,C1=6;function Qy(n,e,t,i,r,l){var h=n.__transition;if(!h)n.__transition={};else if(t in h)return;YG(n,t,{name:e,index:i,group:r,on:XG,tween:ZG,time:l.time,delay:l.delay,duration:l.duration,ease:l.ease,timer:null,state:$8})}function Iw(n,e){var t=Js(n,e);if(t.state>$8)throw new Error("too late; already scheduled");return t}function Ao(n,e){var t=Js(n,e);if(t.state>A1)throw new Error("too late; already running");return t}function Js(n,e){var t=n.__transition;if(!t||!(t=t[e]))throw new Error("transition not found");return t}function YG(n,e,t){var i=n.__transition,r;i[e]=t,t.timer=q8(l,0,t.time);function l(v){t.state=uT,t.timer.restart(h,t.delay,t.time),t.delay<=v&&h(v-t.delay)}function h(v){var x,M,S,A;if(t.state!==uT)return p();for(x in i)if(A=i[x],A.name===t.name){if(A.state===A1)return cT(h);A.state===hT?(A.state=C1,A.timer.stop(),A.on.call("interrupt",n,n.__data__,A.index,A.group),delete i[x]):+x<e&&(A.state=C1,A.timer.stop(),A.on.call("cancel",n,n.__data__,A.index,A.group),delete i[x])}if(cT(function(){t.state===A1&&(t.state=hT,t.timer.restart(o,t.delay,t.time),o(v))}),t.state=ib,t.on.call("start",n,n.__data__,t.index,t.group),t.state===ib){for(t.state=A1,r=new Array(S=t.tween.length),x=0,M=-1;x<S;++x)(A=t.tween[x].value.call(n,n.__data__,t.index,t.group))&&(r[++M]=A);r.length=M+1}}function o(v){for(var x=v<t.duration?t.ease.call(null,v/t.duration):(t.timer.restart(p),t.state=rb,1),M=-1,S=r.length;++M<S;)r[M].call(n,x);t.state===rb&&(t.on.call("end",n,n.__data__,t.index,t.group),p())}function p(){t.state=C1,t.timer.stop(),delete i[e];for(var v in i)return;delete n.__transition}}function KG(n,e){var t=n.__transition,i,r,l=!0,h;if(t){e=e==null?null:e+"";for(h in t){if((i=t[h]).name!==e){l=!1;continue}r=i.state>ib&&i.state<rb,i.state=C1,i.timer.stop(),i.on.call(r?"interrupt":"cancel",n,n.__data__,i.index,i.group),delete t[h]}l&&delete n.__transition}}function JG(n){return this.each(function(){KG(this,n)})}function QG(n,e){var t,i;return function(){var r=Ao(this,n),l=r.tween;if(l!==t){i=t=l;for(var h=0,o=i.length;h<o;++h)if(i[h].name===e){i=i.slice(),i.splice(h,1);break}}r.tween=i}}function ej(n,e,t){var i,r;if(typeof t!="function")throw new Error;return function(){var l=Ao(this,n),h=l.tween;if(h!==i){r=(i=h).slice();for(var o={name:e,value:t},p=0,v=r.length;p<v;++p)if(r[p].name===e){r[p]=o;break}p===v&&r.push(o)}l.tween=r}}function tj(n,e){var t=this._id;if(n+="",arguments.length<2){for(var i=Js(this.node(),t).tween,r=0,l=i.length,h;r<l;++r)if((h=i[r]).name===n)return h.value;return null}return this.each((e==null?QG:ej)(t,n,e))}function kw(n,e,t){var i=n._id;return n.each(function(){var r=Ao(this,i);(r.value||(r.value={}))[e]=t.apply(this,arguments)}),function(r){return Js(r,i).value[e]}}function X8(n,e){var t;return(typeof e=="number"?qs:e instanceof Xu?dy:(t=Xu(e))?(e=t,dy):w8)(n,e)}function nj(n){return function(){this.removeAttribute(n)}}function ij(n){return function(){this.removeAttributeNS(n.space,n.local)}}function rj(n,e,t){var i,r=t+"",l;return function(){var h=this.getAttribute(n);return h===r?null:h===i?l:l=e(i=h,t)}}function aj(n,e,t){var i,r=t+"",l;return function(){var h=this.getAttributeNS(n.space,n.local);return h===r?null:h===i?l:l=e(i=h,t)}}function sj(n,e,t){var i,r,l;return function(){var h,o=t(this),p;return o==null?void this.removeAttribute(n):(h=this.getAttribute(n),p=o+"",h===p?null:h===i&&p===r?l:(r=p,l=e(i=h,o)))}}function oj(n,e,t){var i,r,l;return function(){var h,o=t(this),p;return o==null?void this.removeAttributeNS(n.space,n.local):(h=this.getAttributeNS(n.space,n.local),p=o+"",h===p?null:h===i&&p===r?l:(r=p,l=e(i=h,o)))}}function lj(n,e){var t=Ky(n),i=t==="transform"?kV:X8;return this.attrTween(n,typeof e=="function"?(t.local?oj:sj)(t,i,kw(this,"attr."+n,e)):e==null?(t.local?ij:nj)(t):(t.local?aj:rj)(t,i,e))}function cj(n,e){return function(t){this.setAttribute(n,e.call(this,t))}}function uj(n,e){return function(t){this.setAttributeNS(n.space,n.local,e.call(this,t))}}function hj(n,e){var t,i;function r(){var l=e.apply(this,arguments);return l!==i&&(t=(i=l)&&uj(n,l)),t}return r._value=e,r}function dj(n,e){var t,i;function r(){var l=e.apply(this,arguments);return l!==i&&(t=(i=l)&&cj(n,l)),t}return r._value=e,r}function fj(n,e){var t="attr."+n;if(arguments.length<2)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;var i=Ky(n);return this.tween(t,(i.local?hj:dj)(i,e))}function pj(n,e){return function(){Iw(this,n).delay=+e.apply(this,arguments)}}function mj(n,e){return e=+e,function(){Iw(this,n).delay=e}}function gj(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?pj:mj)(e,n)):Js(this.node(),e).delay}function yj(n,e){return function(){Ao(this,n).duration=+e.apply(this,arguments)}}function vj(n,e){return e=+e,function(){Ao(this,n).duration=e}}function _j(n){var e=this._id;return arguments.length?this.each((typeof n=="function"?yj:vj)(e,n)):Js(this.node(),e).duration}function xj(n,e){if(typeof e!="function")throw new Error;return function(){Ao(this,n).ease=e}}function bj(n){var e=this._id;return arguments.length?this.each(xj(e,n)):Js(this.node(),e).ease}function wj(n,e){return function(){var t=e.apply(this,arguments);if(typeof t!="function")throw new Error;Ao(this,n).ease=t}}function Sj(n){if(typeof n!="function")throw new Error;return this.each(wj(this._id,n))}function Mj(n){typeof n!="function"&&(n=R8(n));for(var e=this._groups,t=e.length,i=new Array(t),r=0;r<t;++r)for(var l=e[r],h=l.length,o=i[r]=[],p,v=0;v<h;++v)(p=l[v])&&n.call(p,p.__data__,v,l)&&o.push(p);return new bl(i,this._parents,this._name,this._id)}function Tj(n){if(n._id!==this._id)throw new Error;for(var e=this._groups,t=n._groups,i=e.length,r=t.length,l=Math.min(i,r),h=new Array(i),o=0;o<l;++o)for(var p=e[o],v=t[o],x=p.length,M=h[o]=new Array(x),S,A=0;A<x;++A)(S=p[A]||v[A])&&(M[A]=S);for(;o<i;++o)h[o]=e[o];return new bl(h,this._parents,this._name,this._id)}function Ej(n){return(n+"").trim().split(/^|\s+/).every(function(e){var t=e.indexOf(".");return t>=0&&(e=e.slice(0,t)),!e||e==="start"})}function Aj(n,e,t){var i,r,l=Ej(e)?Iw:Ao;return function(){var h=l(this,n),o=h.on;o!==i&&(r=(i=o).copy()).on(e,t),h.on=r}}function Cj(n,e){var t=this._id;return arguments.length<2?Js(this.node(),t).on.on(n):this.each(Aj(t,n,e))}function Pj(n){return function(){var e=this.parentNode;for(var t in this.__transition)if(+t!==n)return;e&&e.removeChild(this)}}function Rj(){return this.on("end.remove",Pj(this._id))}function Ij(n){var e=this._name,t=this._id;typeof n!="function"&&(n=Cw(n));for(var i=this._groups,r=i.length,l=new Array(r),h=0;h<r;++h)for(var o=i[h],p=o.length,v=l[h]=new Array(p),x,M,S=0;S<p;++S)(x=o[S])&&(M=n.call(x,x.__data__,S,o))&&("__data__"in x&&(M.__data__=x.__data__),v[S]=M,Qy(v[S],e,t,S,v,Js(x,t)));return new bl(l,this._parents,e,t)}function kj(n){var e=this._name,t=this._id;typeof n!="function"&&(n=P8(n));for(var i=this._groups,r=i.length,l=[],h=[],o=0;o<r;++o)for(var p=i[o],v=p.length,x,M=0;M<v;++M)if(x=p[M]){for(var S=n.call(x,x.__data__,M,p),A,L=Js(x,t),F=0,k=S.length;F<k;++F)(A=S[F])&&Qy(A,e,t,F,S,L);l.push(S),h.push(x)}return new bl(l,h,e,t)}var Dj=uf.prototype.constructor;function Lj(){return new Dj(this._groups,this._parents)}function zj(n,e){var t,i,r;return function(){var l=Qd(this,n),h=(this.style.removeProperty(n),Qd(this,n));return l===h?null:l===t&&h===i?r:r=e(t=l,i=h)}}function Z8(n){return function(){this.style.removeProperty(n)}}function Fj(n,e,t){var i,r=t+"",l;return function(){var h=Qd(this,n);return h===r?null:h===i?l:l=e(i=h,t)}}function Nj(n,e,t){var i,r,l;return function(){var h=Qd(this,n),o=t(this),p=o+"";return o==null&&(p=o=(this.style.removeProperty(n),Qd(this,n))),h===p?null:h===i&&p===r?l:(r=p,l=e(i=h,o))}}function Bj(n,e){var t,i,r,l="style."+e,h="end."+l,o;return function(){var p=Ao(this,n),v=p.on,x=p.value[l]==null?o||(o=Z8(e)):void 0;(v!==t||r!==x)&&(i=(t=v).copy()).on(h,r=x),p.on=i}}function Oj(n,e,t){var i=(n+="")=="transform"?IV:X8;return e==null?this.styleTween(n,zj(n,i)).on("end.style."+n,Z8(n)):typeof e=="function"?this.styleTween(n,Nj(n,i,kw(this,"style."+n,e))).each(Bj(this._id,n)):this.styleTween(n,Fj(n,i,e),t).on("end.style."+n,null)}function Uj(n,e,t){return function(i){this.style.setProperty(n,e.call(this,i),t)}}function Vj(n,e,t){var i,r;function l(){var h=e.apply(this,arguments);return h!==r&&(i=(r=h)&&Uj(n,h,t)),i}return l._value=e,l}function Hj(n,e,t){var i="style."+(n+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(e==null)return this.tween(i,null);if(typeof e!="function")throw new Error;return this.tween(i,Vj(n,e,t??""))}function Gj(n){return function(){this.textContent=n}}function jj(n){return function(){var e=n(this);this.textContent=e??""}}function Wj(n){return this.tween("text",typeof n=="function"?jj(kw(this,"text",n)):Gj(n==null?"":n+""))}function qj(n){return function(e){this.textContent=n.call(this,e)}}function $j(n){var e,t;function i(){var r=n.apply(this,arguments);return r!==t&&(e=(t=r)&&qj(r)),e}return i._value=n,i}function Xj(n){var e="text";if(arguments.length<1)return(e=this.tween(e))&&e._value;if(n==null)return this.tween(e,null);if(typeof n!="function")throw new Error;return this.tween(e,$j(n))}function Zj(){for(var n=this._name,e=this._id,t=Y8(),i=this._groups,r=i.length,l=0;l<r;++l)for(var h=i[l],o=h.length,p,v=0;v<o;++v)if(p=h[v]){var x=Js(p,e);Qy(p,n,t,v,h,{time:x.time+x.delay+x.duration,delay:0,duration:x.duration,ease:x.ease})}return new bl(i,this._parents,n,t)}function Yj(){var n,e,t=this,i=t._id,r=t.size();return new Promise(function(l,h){var o={value:h},p={value:function(){--r===0&&l()}};t.each(function(){var v=Ao(this,i),x=v.on;x!==n&&(e=(n=x).copy(),e._.cancel.push(o),e._.interrupt.push(o),e._.end.push(p)),v.on=e}),r===0&&l()})}var Kj=0;function bl(n,e,t,i){this._groups=n,this._parents=e,this._name=t,this._id=i}function _y(n){return uf().transition(n)}function Y8(){return++Kj}var tl=uf.prototype;bl.prototype=_y.prototype={constructor:bl,select:Ij,selectAll:kj,selectChild:tl.selectChild,selectChildren:tl.selectChildren,filter:Mj,merge:Tj,selection:Lj,transition:Zj,call:tl.call,nodes:tl.nodes,node:tl.node,size:tl.size,empty:tl.empty,each:tl.each,on:Cj,attr:lj,attrTween:fj,style:Oj,styleTween:Hj,text:Wj,textTween:Xj,remove:Rj,tween:tj,delay:gj,duration:_j,ease:bj,easeVarying:Sj,end:Yj,[Symbol.iterator]:tl[Symbol.iterator]};const dT=n=>+n;function Jj(n){return((n*=2)<=1?n*n*n:(n-=2)*n*n+2)/2}var Qj={time:null,delay:0,duration:250,ease:Jj};function eW(n,e){for(var t;!(t=n.__transition)||!(t=t[e]);)if(!(n=n.parentNode))throw new Error(`transition ${e} not found`);return t}function tW(n){var e,t;n instanceof bl?(e=n._id,n=n._name):(e=Y8(),(t=Qj).time=Rw(),n=n==null?null:n+"");for(var i=this._groups,r=i.length,l=0;l<r;++l)for(var h=i[l],o=h.length,p,v=0;v<o;++v)(p=h[v])&&Qy(p,n,e,v,h,t||eW(p,e));return new bl(i,this._parents,n,e)}uf.prototype.interrupt=JG;uf.prototype.transition=tW;class Ya{constructor(e,t,i){this.lexer=void 0,this.start=void 0,this.end=void 0,this.lexer=e,this.start=t,this.end=i}static range(e,t){return t?!e||!e.loc||!t.loc||e.loc.lexer!==t.loc.lexer?null:new Ya(e.loc.lexer,e.loc.start,t.loc.end):e&&e.loc}}class Ms{constructor(e,t){this.text=void 0,this.loc=void 0,this.noexpand=void 0,this.treatAsRelax=void 0,this.text=e,this.loc=t}range(e,t){return new Ms(t,Ya.range(this,e))}}class Ut{constructor(e,t){this.name=void 0,this.position=void 0,this.length=void 0,this.rawMessage=void 0;var i="KaTeX parse error: "+e,r,l,h=t&&t.loc;if(h&&h.start<=h.end){var o=h.lexer.input;r=h.start,l=h.end,r===o.length?i+=" at end of input: ":i+=" at position "+(r+1)+": ";var p=o.slice(r,l).replace(/[^]/g,"$&̲"),v;r>15?v="…"+o.slice(r-15,r):v=o.slice(0,r);var x;l+15<o.length?x=o.slice(l,l+15)+"…":x=o.slice(l),i+=v+p+x}var M=new Error(i);return M.name="ParseError",M.__proto__=Ut.prototype,M.position=r,r!=null&&l!=null&&(M.length=l-r),M.rawMessage=e,M}}Ut.prototype.__proto__=Error.prototype;var nW=function(e,t){return e.indexOf(t)!==-1},iW=function(e,t){return e===void 0?t:e},rW=/([A-Z])/g,aW=function(e){return e.replace(rW,"-$1").toLowerCase()},sW={"&":"&amp;",">":"&gt;","<":"&lt;",'"':"&quot;","'":"&#x27;"},oW=/[&><"']/g;function lW(n){return String(n).replace(oW,e=>sW[e])}var K8=function n(e){return e.type==="ordgroup"||e.type==="color"?e.body.length===1?n(e.body[0]):e:e.type==="font"?n(e.body):e},cW=function(e){var t=K8(e);return t.type==="mathord"||t.type==="textord"||t.type==="atom"},uW=function(e){if(!e)throw new Error("Expected non-null, but got "+String(e));return e},hW=function(e){var t=/^[\x00-\x20]*([^\\/#?]*?)(:|&#0*58|&#x0*3a|&colon)/i.exec(e);return t?t[2]!==":"||!/^[a-zA-Z][a-zA-Z0-9+\-.]*$/.test(t[1])?null:t[1].toLowerCase():"_relative"},kn={contains:nW,deflt:iW,escape:lW,hyphenate:aW,getBaseElem:K8,isCharacterBox:cW,protocolFromUrl:hW},P1={displayMode:{type:"boolean",description:"Render math in display mode, which puts the math in display style (so \\int and \\sum are large, for example), and centers the math on the page on its own line.",cli:"-d, --display-mode"},output:{type:{enum:["htmlAndMathml","html","mathml"]},description:"Determines the markup language of the output.",cli:"-F, --format <type>"},leqno:{type:"boolean",description:"Render display math in leqno style (left-justified tags)."},fleqn:{type:"boolean",description:"Render display math flush left."},throwOnError:{type:"boolean",default:!0,cli:"-t, --no-throw-on-error",cliDescription:"Render errors (in the color given by --error-color) instead of throwing a ParseError exception when encountering an error."},errorColor:{type:"string",default:"#cc0000",cli:"-c, --error-color <color>",cliDescription:"A color string given in the format 'rgb' or 'rrggbb' (no #). This option determines the color of errors rendered by the -t option.",cliProcessor:n=>"#"+n},macros:{type:"object",cli:"-m, --macro <def>",cliDescription:"Define custom macro of the form '\\foo:expansion' (use multiple -m arguments for multiple macros).",cliDefault:[],cliProcessor:(n,e)=>(e.push(n),e)},minRuleThickness:{type:"number",description:"Specifies a minimum thickness, in ems, for fraction lines, `\\sqrt` top lines, `{array}` vertical lines, `\\hline`, `\\hdashline`, `\\underline`, `\\overline`, and the borders of `\\fbox`, `\\boxed`, and `\\fcolorbox`.",processor:n=>Math.max(0,n),cli:"--min-rule-thickness <size>",cliProcessor:parseFloat},colorIsTextColor:{type:"boolean",description:"Makes \\color behave like LaTeX's 2-argument \\textcolor, instead of LaTeX's one-argument \\color mode change.",cli:"-b, --color-is-text-color"},strict:{type:[{enum:["warn","ignore","error"]},"boolean","function"],description:"Turn on strict / LaTeX faithfulness mode, which throws an error if the input uses features that are not supported by LaTeX.",cli:"-S, --strict",cliDefault:!1},trust:{type:["boolean","function"],description:"Trust the input, enabling all HTML features such as \\url.",cli:"-T, --trust"},maxSize:{type:"number",default:1/0,description:"If non-zero, all user-specified sizes, e.g. in \\rule{500em}{500em}, will be capped to maxSize ems. Otherwise, elements and spaces can be arbitrarily large",processor:n=>Math.max(0,n),cli:"-s, --max-size <n>",cliProcessor:parseInt},maxExpand:{type:"number",default:1e3,description:"Limit the number of macro expansions to the specified number, to prevent e.g. infinite macro loops. If set to Infinity, the macro expander will try to fully expand as in LaTeX.",processor:n=>Math.max(0,n),cli:"-e, --max-expand <n>",cliProcessor:n=>n==="Infinity"?1/0:parseInt(n)},globalGroup:{type:"boolean",cli:!1}};function dW(n){if(n.default)return n.default;var e=n.type,t=Array.isArray(e)?e[0]:e;if(typeof t!="string")return t.enum[0];switch(t){case"boolean":return!1;case"string":return"";case"number":return 0;case"object":return{}}}class Dw{constructor(e){this.displayMode=void 0,this.output=void 0,this.leqno=void 0,this.fleqn=void 0,this.throwOnError=void 0,this.errorColor=void 0,this.macros=void 0,this.minRuleThickness=void 0,this.colorIsTextColor=void 0,this.strict=void 0,this.trust=void 0,this.maxSize=void 0,this.maxExpand=void 0,this.globalGroup=void 0,e=e||{};for(var t in P1)if(P1.hasOwnProperty(t)){var i=P1[t];this[t]=e[t]!==void 0?i.processor?i.processor(e[t]):e[t]:dW(i)}}reportNonstrict(e,t,i){var r=this.strict;if(typeof r=="function"&&(r=r(e,t,i)),!(!r||r==="ignore")){if(r===!0||r==="error")throw new Ut("LaTeX-incompatible input and strict mode is set to 'error': "+(t+" ["+e+"]"),i);r==="warn"?typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")):typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+r+"': "+t+" ["+e+"]"))}}useStrictBehavior(e,t,i){var r=this.strict;if(typeof r=="function")try{r=r(e,t,i)}catch{r="error"}return!r||r==="ignore"?!1:r===!0||r==="error"?!0:r==="warn"?(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to 'warn': "+(t+" ["+e+"]")),!1):(typeof console<"u"&&console.warn("LaTeX-incompatible input and strict mode is set to "+("unrecognized '"+r+"': "+t+" ["+e+"]")),!1)}isTrusted(e){if(e.url&&!e.protocol){var t=kn.protocolFromUrl(e.url);if(t==null)return!1;e.protocol=t}var i=typeof this.trust=="function"?this.trust(e):this.trust;return!!i}}class oc{constructor(e,t,i){this.id=void 0,this.size=void 0,this.cramped=void 0,this.id=e,this.size=t,this.cramped=i}sup(){return fo[fW[this.id]]}sub(){return fo[pW[this.id]]}fracNum(){return fo[mW[this.id]]}fracDen(){return fo[gW[this.id]]}cramp(){return fo[yW[this.id]]}text(){return fo[vW[this.id]]}isTight(){return this.size>=2}}var Lw=0,xy=1,Od=2,fl=3,Np=4,ws=5,tf=6,va=7,fo=[new oc(Lw,0,!1),new oc(xy,0,!0),new oc(Od,1,!1),new oc(fl,1,!0),new oc(Np,2,!1),new oc(ws,2,!0),new oc(tf,3,!1),new oc(va,3,!0)],fW=[Np,ws,Np,ws,tf,va,tf,va],pW=[ws,ws,ws,ws,va,va,va,va],mW=[Od,fl,Np,ws,tf,va,tf,va],gW=[fl,fl,ws,ws,va,va,va,va],yW=[xy,xy,fl,fl,ws,ws,va,va],vW=[Lw,xy,Od,fl,Od,fl,Od,fl],Ln={DISPLAY:fo[Lw],TEXT:fo[Od],SCRIPT:fo[Np],SCRIPTSCRIPT:fo[tf]},ab=[{name:"latin",blocks:[[256,591],[768,879]]},{name:"cyrillic",blocks:[[1024,1279]]},{name:"armenian",blocks:[[1328,1423]]},{name:"brahmic",blocks:[[2304,4255]]},{name:"georgian",blocks:[[4256,4351]]},{name:"cjk",blocks:[[12288,12543],[19968,40879],[65280,65376]]},{name:"hangul",blocks:[[44032,55215]]}];function _W(n){for(var e=0;e<ab.length;e++)for(var t=ab[e],i=0;i<t.blocks.length;i++){var r=t.blocks[i];if(n>=r[0]&&n<=r[1])return t.name}return null}var R1=[];ab.forEach(n=>n.blocks.forEach(e=>R1.push(...e)));function J8(n){for(var e=0;e<R1.length;e+=2)if(n>=R1[e]&&n<=R1[e+1])return!0;return!1}var ld=80,xW=function(e,t){return"M95,"+(622+e+t)+`
c-2.7,0,-7.17,-2.7,-13.5,-8c-5.8,-5.3,-9.5,-10,-9.5,-14
c0,-2,0.3,-3.3,1,-4c1.3,-2.7,23.83,-20.7,67.5,-54
c44.2,-33.3,65.8,-50.3,66.5,-51c1.3,-1.3,3,-2,5,-2c4.7,0,8.7,3.3,12,10
s173,378,173,378c0.7,0,35.3,-71,104,-213c68.7,-142,137.5,-285,206.5,-429
c69,-144,104.5,-217.7,106.5,-221
l`+e/2.075+" -"+e+`
c5.3,-9.3,12,-14,20,-14
H400000v`+(40+e)+`H845.2724
s-225.272,467,-225.272,467s-235,486,-235,486c-2.7,4.7,-9,7,-19,7
c-6,0,-10,-1,-12,-3s-194,-422,-194,-422s-65,47,-65,47z
M`+(834+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},bW=function(e,t){return"M263,"+(601+e+t)+`c0.7,0,18,39.7,52,119
c34,79.3,68.167,158.7,102.5,238c34.3,79.3,51.8,119.3,52.5,120
c340,-704.7,510.7,-1060.3,512,-1067
l`+e/2.084+" -"+e+`
c4.7,-7.3,11,-11,19,-11
H40000v`+(40+e)+`H1012.3
s-271.3,567,-271.3,567c-38.7,80.7,-84,175,-136,283c-52,108,-89.167,185.3,-111.5,232
c-22.3,46.7,-33.8,70.3,-34.5,71c-4.7,4.7,-12.3,7,-23,7s-12,-1,-12,-1
s-109,-253,-109,-253c-72.7,-168,-109.3,-252,-110,-252c-10.7,8,-22,16.7,-34,26
c-22,17.3,-33.3,26,-34,26s-26,-26,-26,-26s76,-59,76,-59s76,-60,76,-60z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},wW=function(e,t){return"M983 "+(10+e+t)+`
l`+e/3.13+" -"+e+`
c4,-6.7,10,-10,18,-10 H400000v`+(40+e)+`
H1013.1s-83.4,268,-264.1,840c-180.7,572,-277,876.3,-289,913c-4.7,4.7,-12.7,7,-24,7
s-12,0,-12,0c-1.3,-3.3,-3.7,-11.7,-7,-25c-35.3,-125.3,-106.7,-373.3,-214,-744
c-10,12,-21,25,-33,39s-32,39,-32,39c-6,-5.3,-15,-14,-27,-26s25,-30,25,-30
c26.7,-32.7,52,-63,76,-91s52,-60,52,-60s208,722,208,722
c56,-175.3,126.3,-397.3,211,-666c84.7,-268.7,153.8,-488.2,207.5,-658.5
c53.7,-170.3,84.5,-266.8,92.5,-289.5z
M`+(1001+e)+" "+t+"h400000v"+(40+e)+"h-400000z"},SW=function(e,t){return"M424,"+(2398+e+t)+`
c-1.3,-0.7,-38.5,-172,-111.5,-514c-73,-342,-109.8,-513.3,-110.5,-514
c0,-2,-10.7,14.3,-32,49c-4.7,7.3,-9.8,15.7,-15.5,25c-5.7,9.3,-9.8,16,-12.5,20
s-5,7,-5,7c-4,-3.3,-8.3,-7.7,-13,-13s-13,-13,-13,-13s76,-122,76,-122s77,-121,77,-121
s209,968,209,968c0,-2,84.7,-361.7,254,-1079c169.3,-717.3,254.7,-1077.7,256,-1081
l`+e/4.223+" -"+e+`c4,-6.7,10,-10,18,-10 H400000
v`+(40+e)+`H1014.6
s-87.3,378.7,-272.6,1166c-185.3,787.3,-279.3,1182.3,-282,1185
c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2z M`+(1001+e)+" "+t+`
h400000v`+(40+e)+"h-400000z"},MW=function(e,t){return"M473,"+(2713+e+t)+`
c339.3,-1799.3,509.3,-2700,510,-2702 l`+e/5.298+" -"+e+`
c3.3,-7.3,9.3,-11,18,-11 H400000v`+(40+e)+`H1017.7
s-90.5,478,-276.2,1466c-185.7,988,-279.5,1483,-281.5,1485c-2,6,-10,9,-24,9
c-8,0,-12,-0.7,-12,-2c0,-1.3,-5.3,-32,-16,-92c-50.7,-293.3,-119.7,-693.3,-207,-1200
c0,-1.3,-5.3,8.7,-16,30c-10.7,21.3,-21.3,42.7,-32,64s-16,33,-16,33s-26,-26,-26,-26
s76,-153,76,-153s77,-151,77,-151c0.7,0.7,35.7,202,105,604c67.3,400.7,102,602.7,104,
606zM`+(1001+e)+" "+t+"h400000v"+(40+e)+"H1017.7z"},TW=function(e){var t=e/2;return"M400000 "+e+" H0 L"+t+" 0 l65 45 L145 "+(e-80)+" H400000z"},EW=function(e,t,i){var r=i-54-t-e;return"M702 "+(e+t)+"H400000"+(40+e)+`
H742v`+r+`l-4 4-4 4c-.667.7 -2 1.5-4 2.5s-4.167 1.833-6.5 2.5-5.5 1-9.5 1
h-12l-28-84c-16.667-52-96.667 -294.333-240-727l-212 -643 -85 170
c-4-3.333-8.333-7.667-13 -13l-13-13l77-155 77-156c66 199.333 139 419.667
219 661 l218 661zM702 `+t+"H400000v"+(40+e)+"H742z"},AW=function(e,t,i){t=1e3*t;var r="";switch(e){case"sqrtMain":r=xW(t,ld);break;case"sqrtSize1":r=bW(t,ld);break;case"sqrtSize2":r=wW(t,ld);break;case"sqrtSize3":r=SW(t,ld);break;case"sqrtSize4":r=MW(t,ld);break;case"sqrtTall":r=EW(t,ld,i)}return r},CW=function(e,t){switch(e){case"⎜":return"M291 0 H417 V"+t+" H291z M291 0 H417 V"+t+" H291z";case"∣":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z";case"∥":return"M145 0 H188 V"+t+" H145z M145 0 H188 V"+t+" H145z"+("M367 0 H410 V"+t+" H367z M367 0 H410 V"+t+" H367z");case"⎟":return"M457 0 H583 V"+t+" H457z M457 0 H583 V"+t+" H457z";case"⎢":return"M319 0 H403 V"+t+" H319z M319 0 H403 V"+t+" H319z";case"⎥":return"M263 0 H347 V"+t+" H263z M263 0 H347 V"+t+" H263z";case"⎪":return"M384 0 H504 V"+t+" H384z M384 0 H504 V"+t+" H384z";case"⏐":return"M312 0 H355 V"+t+" H312z M312 0 H355 V"+t+" H312z";case"‖":return"M257 0 H300 V"+t+" H257z M257 0 H300 V"+t+" H257z"+("M478 0 H521 V"+t+" H478z M478 0 H521 V"+t+" H478z");default:return""}},fT={doubleleftarrow:`M262 157
l10-10c34-36 62.7-77 86-123 3.3-8 5-13.3 5-16 0-5.3-6.7-8-20-8-7.3
 0-12.2.5-14.5 1.5-2.3 1-4.8 4.5-7.5 10.5-49.3 97.3-121.7 169.3-217 216-28
 14-57.3 25-88 33-6.7 2-11 3.8-13 5.5-2 1.7-3 4.2-3 7.5s1 5.8 3 7.5
c2 1.7 6.3 3.5 13 5.5 68 17.3 128.2 47.8 180.5 91.5 52.3 43.7 93.8 96.2 124.5
 157.5 9.3 8 15.3 12.3 18 13h6c12-.7 18-4 18-10 0-2-1.7-7-5-15-23.3-46-52-87
-86-123l-10-10h399738v-40H218c328 0 0 0 0 0l-10-8c-26.7-20-65.7-43-117-69 2.7
-2 6-3.7 10-5 36.7-16 72.3-37.3 107-64l10-8h399782v-40z
m8 0v40h399730v-40zm0 194v40h399730v-40z`,doublerightarrow:`M399738 392l
-10 10c-34 36-62.7 77-86 123-3.3 8-5 13.3-5 16 0 5.3 6.7 8 20 8 7.3 0 12.2-.5
 14.5-1.5 2.3-1 4.8-4.5 7.5-10.5 49.3-97.3 121.7-169.3 217-216 28-14 57.3-25 88
-33 6.7-2 11-3.8 13-5.5 2-1.7 3-4.2 3-7.5s-1-5.8-3-7.5c-2-1.7-6.3-3.5-13-5.5-68
-17.3-128.2-47.8-180.5-91.5-52.3-43.7-93.8-96.2-124.5-157.5-9.3-8-15.3-12.3-18
-13h-6c-12 .7-18 4-18 10 0 2 1.7 7 5 15 23.3 46 52 87 86 123l10 10H0v40h399782
c-328 0 0 0 0 0l10 8c26.7 20 65.7 43 117 69-2.7 2-6 3.7-10 5-36.7 16-72.3 37.3
-107 64l-10 8H0v40zM0 157v40h399730v-40zm0 194v40h399730v-40z`,leftarrow:`M400000 241H110l3-3c68.7-52.7 113.7-120
 135-202 4-14.7 6-23 6-25 0-7.3-7-11-21-11-8 0-13.2.8-15.5 2.5-2.3 1.7-4.2 5.8
-5.5 12.5-1.3 4.7-2.7 10.3-4 17-12 48.7-34.8 92-68.5 130S65.3 228.3 18 247
c-10 4-16 7.7-18 11 0 8.7 6 14.3 18 17 47.3 18.7 87.8 47 121.5 85S196 441.3 208
 490c.7 2 1.3 5 2 9s1.2 6.7 1.5 8c.3 1.3 1 3.3 2 6s2.2 4.5 3.5 5.5c1.3 1 3.3
 1.8 6 2.5s6 1 10 1c14 0 21-3.7 21-11 0-2-2-10.3-6-25-20-79.3-65-146.7-135-202
 l-3-3h399890zM100 241v40h399900v-40z`,leftbrace:`M6 548l-6-6v-35l6-11c56-104 135.3-181.3 238-232 57.3-28.7 117
-45 179-50h399577v120H403c-43.3 7-81 15-113 26-100.7 33-179.7 91-237 174-2.7
 5-6 9-10 13-.7 1-7.3 1-20 1H6z`,leftbraceunder:`M0 6l6-6h17c12.688 0 19.313.3 20 1 4 4 7.313 8.3 10 13
 35.313 51.3 80.813 93.8 136.5 127.5 55.688 33.7 117.188 55.8 184.5 66.5.688
 0 2 .3 4 1 18.688 2.7 76 4.3 172 5h399450v120H429l-6-1c-124.688-8-235-61.7
-331-161C60.687 138.7 32.312 99.3 7 54L0 41V6z`,leftgroup:`M400000 80
H435C64 80 168.3 229.4 21 260c-5.9 1.2-18 0-18 0-2 0-3-1-3-3v-38C76 61 257 0
 435 0h399565z`,leftgroupunder:`M400000 262
H435C64 262 168.3 112.6 21 82c-5.9-1.2-18 0-18 0-2 0-3 1-3 3v38c76 158 257 219
 435 219h399565z`,leftharpoon:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3
-3.3 10.2-9.5 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5
-18.3 3-21-1.3-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7
-196 228-6.7 4.7-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40z`,leftharpoonplus:`M0 267c.7 5.3 3 10 7 14h399993v-40H93c3.3-3.3 10.2-9.5
 20.5-18.5s17.8-15.8 22.5-20.5c50.7-52 88-110.3 112-175 4-11.3 5-18.3 3-21-1.3
-4-7.3-6-18-6-8 0-13 .7-15 2s-4.7 6.7-8 16c-42 98.7-107.3 174.7-196 228-6.7 4.7
-10.7 8-12 10-1.3 2-2 5.7-2 11zm100-26v40h399900v-40zM0 435v40h400000v-40z
m0 0v40h400000v-40z`,leftharpoondown:`M7 241c-4 4-6.333 8.667-7 14 0 5.333.667 9 2 11s5.333
 5.333 12 10c90.667 54 156 130 196 228 3.333 10.667 6.333 16.333 9 17 2 .667 5
 1 9 1h5c10.667 0 16.667-2 18-6 2-2.667 1-9.667-3-21-32-87.333-82.667-157.667
-152-211l-3-3h399907v-40zM93 281 H400000 v-40L7 241z`,leftharpoondownplus:`M7 435c-4 4-6.3 8.7-7 14 0 5.3.7 9 2 11s5.3 5.3 12
 10c90.7 54 156 130 196 228 3.3 10.7 6.3 16.3 9 17 2 .7 5 1 9 1h5c10.7 0 16.7
-2 18-6 2-2.7 1-9.7-3-21-32-87.3-82.7-157.7-152-211l-3-3h399907v-40H7zm93 0
v40h399900v-40zM0 241v40h399900v-40zm0 0v40h399900v-40z`,lefthook:`M400000 281 H103s-33-11.2-61-33.5S0 197.3 0 164s14.2-61.2 42.5
-83.5C70.8 58.2 104 47 142 47 c16.7 0 25 6.7 25 20 0 12-8.7 18.7-26 20-40 3.3
-68.7 15.7-86 37-10 12-15 25.3-15 40 0 22.7 9.8 40.7 29.5 54 19.7 13.3 43.5 21
 71.5 23h399859zM103 281v-40h399897v40z`,leftlinesegment:`M40 281 V428 H0 V94 H40 V241 H400000 v40z
M40 281 V428 H0 V94 H40 V241 H400000 v40z`,leftmapsto:`M40 281 V448H0V74H40V241H400000v40z
M40 281 V448H0V74H40V241H400000v40z`,leftToFrom:`M0 147h400000v40H0zm0 214c68 40 115.7 95.7 143 167h22c15.3 0 23
-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69-70-101l-7-8h399905v-40H95l7-8
c28.7-32 52-65.7 70-101 10.7-23.3 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 265.3
 68 321 0 361zm0-174v-40h399900v40zm100 154v40h399900v-40z`,longequal:`M0 50 h400000 v40H0z m0 194h40000v40H0z
M0 50 h400000 v40H0z m0 194h40000v40H0z`,midbrace:`M200428 334
c-100.7-8.3-195.3-44-280-108-55.3-42-101.7-93-139-153l-9-14c-2.7 4-5.7 8.7-9 14
-53.3 86.7-123.7 153-211 199-66.7 36-137.3 56.3-212 62H0V214h199568c178.3-11.7
 311.7-78.3 403-201 6-8 9.7-12 11-12 .7-.7 6.7-1 18-1s17.3.3 18 1c1.3 0 5 4 11
 12 44.7 59.3 101.3 106.3 170 141s145.3 54.3 229 60h199572v120z`,midbraceunder:`M199572 214
c100.7 8.3 195.3 44 280 108 55.3 42 101.7 93 139 153l9 14c2.7-4 5.7-8.7 9-14
 53.3-86.7 123.7-153 211-199 66.7-36 137.3-56.3 212-62h199568v120H200432c-178.3
 11.7-311.7 78.3-403 201-6 8-9.7 12-11 12-.7.7-6.7 1-18 1s-17.3-.3-18-1c-1.3 0
-5-4-11-12-44.7-59.3-101.3-106.3-170-141s-145.3-54.3-229-60H0V214z`,oiintSize1:`M512.6 71.6c272.6 0 320.3 106.8 320.3 178.2 0 70.8-47.7 177.6
-320.3 177.6S193.1 320.6 193.1 249.8c0-71.4 46.9-178.2 319.5-178.2z
m368.1 178.2c0-86.4-60.9-215.4-368.1-215.4-306.4 0-367.3 129-367.3 215.4 0 85.8
60.9 214.8 367.3 214.8 307.2 0 368.1-129 368.1-214.8z`,oiintSize2:`M757.8 100.1c384.7 0 451.1 137.6 451.1 230 0 91.3-66.4 228.8
-451.1 228.8-386.3 0-452.7-137.5-452.7-228.8 0-92.4 66.4-230 452.7-230z
m502.4 230c0-111.2-82.4-277.2-502.4-277.2s-504 166-504 277.2
c0 110 84 276 504 276s502.4-166 502.4-276z`,oiiintSize1:`M681.4 71.6c408.9 0 480.5 106.8 480.5 178.2 0 70.8-71.6 177.6
-480.5 177.6S202.1 320.6 202.1 249.8c0-71.4 70.5-178.2 479.3-178.2z
m525.8 178.2c0-86.4-86.8-215.4-525.7-215.4-437.9 0-524.7 129-524.7 215.4 0
85.8 86.8 214.8 524.7 214.8 438.9 0 525.7-129 525.7-214.8z`,oiiintSize2:`M1021.2 53c603.6 0 707.8 165.8 707.8 277.2 0 110-104.2 275.8
-707.8 275.8-606 0-710.2-165.8-710.2-275.8C311 218.8 415.2 53 1021.2 53z
m770.4 277.1c0-131.2-126.4-327.6-770.5-327.6S248.4 198.9 248.4 330.1
c0 130 128.8 326.4 772.7 326.4s770.5-196.4 770.5-326.4z`,rightarrow:`M0 241v40h399891c-47.3 35.3-84 78-110 128
-16.7 32-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20
 11 8 0 13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7
 39-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85
-40.5-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
 151.7 139 205zm0 0v40h399900v-40z`,rightbrace:`M400000 542l
-6 6h-17c-12.7 0-19.3-.3-20-1-4-4-7.3-8.3-10-13-35.3-51.3-80.8-93.8-136.5-127.5
s-117.2-55.8-184.5-66.5c-.7 0-2-.3-4-1-18.7-2.7-76-4.3-172-5H0V214h399571l6 1
c124.7 8 235 61.7 331 161 31.3 33.3 59.7 72.7 85 118l7 13v35z`,rightbraceunder:`M399994 0l6 6v35l-6 11c-56 104-135.3 181.3-238 232-57.3
 28.7-117 45-179 50H-300V214h399897c43.3-7 81-15 113-26 100.7-33 179.7-91 237
-174 2.7-5 6-9 10-13 .7-1 7.3-1 20-1h17z`,rightgroup:`M0 80h399565c371 0 266.7 149.4 414 180 5.9 1.2 18 0 18 0 2 0
 3-1 3-3v-38c-76-158-257-219-435-219H0z`,rightgroupunder:`M0 262h399565c371 0 266.7-149.4 414-180 5.9-1.2 18 0 18
 0 2 0 3 1 3 3v38c-76 158-257 219-435 219H0z`,rightharpoon:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3
-3.7-15.3-11-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2
-10.7 0-16.7 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58
 69.2 92 94.5zm0 0v40h399900v-40z`,rightharpoonplus:`M0 241v40h399993c4.7-4.7 7-9.3 7-14 0-9.3-3.7-15.3-11
-18-92.7-56.7-159-133.7-199-231-3.3-9.3-6-14.7-8-16-2-1.3-7-2-15-2-10.7 0-16.7
 2-18 6-2 2.7-1 9.7 3 21 15.3 42 36.7 81.8 64 119.5 27.3 37.7 58 69.2 92 94.5z
m0 0v40h399900v-40z m100 194v40h399900v-40zm0 0v40h399900v-40z`,rightharpoondown:`M399747 511c0 7.3 6.7 11 20 11 8 0 13-.8 15-2.5s4.7-6.8
 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3 8.5-5.8 9.5
-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3-64.7 57-92 95
-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 241v40h399900v-40z`,rightharpoondownplus:`M399747 705c0 7.3 6.7 11 20 11 8 0 13-.8
 15-2.5s4.7-6.8 8-15.5c40-94 99.3-166.3 178-217 13.3-8 20.3-12.3 21-13 5.3-3.3
 8.5-5.8 9.5-7.5 1-1.7 1.5-5.2 1.5-10.5s-2.3-10.3-7-15H0v40h399908c-34 25.3
-64.7 57-92 95-27.3 38-48.7 77.7-64 119-3.3 8.7-5 14-5 16zM0 435v40h399900v-40z
m0-194v40h400000v-40zm0 0v40h400000v-40z`,righthook:`M399859 241c-764 0 0 0 0 0 40-3.3 68.7-15.7 86-37 10-12 15-25.3
 15-40 0-22.7-9.8-40.7-29.5-54-19.7-13.3-43.5-21-71.5-23-17.3-1.3-26-8-26-20 0
-13.3 8.7-20 26-20 38 0 71 11.2 99 33.5 0 0 7 5.6 21 16.7 14 11.2 21 33.5 21
 66.8s-14 61.2-42 83.5c-28 22.3-61 33.5-99 33.5L0 241z M0 281v-40h399859v40z`,rightlinesegment:`M399960 241 V94 h40 V428 h-40 V281 H0 v-40z
M399960 241 V94 h40 V428 h-40 V281 H0 v-40z`,rightToFrom:`M400000 167c-70.7-42-118-97.7-142-167h-23c-15.3 0-23 .3-23
 1 0 1.3 5.3 13.7 16 37 18 35.3 41.3 69 70 101l7 8H0v40h399905l-7 8c-28.7 32
-52 65.7-70 101-10.7 23.3-16 35.7-16 37 0 .7 7.7 1 23 1h23c24-69.3 71.3-125 142
-167z M100 147v40h399900v-40zM0 341v40h399900v-40z`,twoheadleftarrow:`M0 167c68 40
 115.7 95.7 143 167h22c15.3 0 23-.3 23-1 0-1.3-5.3-13.7-16-37-18-35.3-41.3-69
-70-101l-7-8h125l9 7c50.7 39.3 85 86 103 140h46c0-4.7-6.3-18.7-19-42-18-35.3
-40-67.3-66-96l-9-9h399716v-40H284l9-9c26-28.7 48-60.7 66-96 12.7-23.333 19
-37.333 19-42h-46c-18 54-52.3 100.7-103 140l-9 7H95l7-8c28.7-32 52-65.7 70-101
 10.7-23.333 16-35.7 16-37 0-.7-7.7-1-23-1h-22C115.7 71.3 68 127 0 167z`,twoheadrightarrow:`M400000 167
c-68-40-115.7-95.7-143-167h-22c-15.3 0-23 .3-23 1 0 1.3 5.3 13.7 16 37 18 35.3
 41.3 69 70 101l7 8h-125l-9-7c-50.7-39.3-85-86-103-140h-46c0 4.7 6.3 18.7 19 42
 18 35.3 40 67.3 66 96l9 9H0v40h399716l-9 9c-26 28.7-48 60.7-66 96-12.7 23.333
-19 37.333-19 42h46c18-54 52.3-100.7 103-140l9-7h125l-7 8c-28.7 32-52 65.7-70
 101-10.7 23.333-16 35.7-16 37 0 .7 7.7 1 23 1h22c27.3-71.3 75-127 143-167z`,tilde1:`M200 55.538c-77 0-168 73.953-177 73.953-3 0-7
-2.175-9-5.437L2 97c-1-2-2-4-2-6 0-4 2-7 5-9l20-12C116 12 171 0 207 0c86 0
 114 68 191 68 78 0 168-68 177-68 4 0 7 2 9 5l12 19c1 2.175 2 4.35 2 6.525 0
 4.35-2 7.613-5 9.788l-19 13.05c-92 63.077-116.937 75.308-183 76.128
-68.267.847-113-73.952-191-73.952z`,tilde2:`M344 55.266c-142 0-300.638 81.316-311.5 86.418
-8.01 3.762-22.5 10.91-23.5 5.562L1 120c-1-2-1-3-1-4 0-5 3-9 8-10l18.4-9C160.9
 31.9 283 0 358 0c148 0 188 122 331 122s314-97 326-97c4 0 8 2 10 7l7 21.114
c1 2.14 1 3.21 1 4.28 0 5.347-3 9.626-7 10.696l-22.3 12.622C852.6 158.372 751
 181.476 676 181.476c-149 0-189-126.21-332-126.21z`,tilde3:`M786 59C457 59 32 175.242 13 175.242c-6 0-10-3.457
-11-10.37L.15 138c-1-7 3-12 10-13l19.2-6.4C378.4 40.7 634.3 0 804.3 0c337 0
 411.8 157 746.8 157 328 0 754-112 773-112 5 0 10 3 11 9l1 14.075c1 8.066-.697
 16.595-6.697 17.492l-21.052 7.31c-367.9 98.146-609.15 122.696-778.15 122.696
 -338 0-409-156.573-744-156.573z`,tilde4:`M786 58C457 58 32 177.487 13 177.487c-6 0-10-3.345
-11-10.035L.15 143c-1-7 3-12 10-13l22-6.7C381.2 35 637.15 0 807.15 0c337 0 409
 177 744 177 328 0 754-127 773-127 5 0 10 3 11 9l1 14.794c1 7.805-3 13.38-9
 14.495l-20.7 5.574c-366.85 99.79-607.3 139.372-776.3 139.372-338 0-409
 -175.236-744-175.236z`,vec:`M377 20c0-5.333 1.833-10 5.5-14S391 0 397 0c4.667 0 8.667 1.667 12 5
3.333 2.667 6.667 9 10 19 6.667 24.667 20.333 43.667 41 57 7.333 4.667 11
10.667 11 18 0 6-1 10-3 12s-6.667 5-14 9c-28.667 14.667-53.667 35.667-75 63
-1.333 1.333-3.167 3.5-5.5 6.5s-4 4.833-5 5.5c-1 .667-2.5 1.333-4.5 2s-4.333 1
-7 1c-4.667 0-9.167-1.833-13.5-5.5S337 184 337 178c0-12.667 15.667-32.333 47-59
H213l-171-1c-8.667-6-13-12.333-13-19 0-4.667 4.333-11.333 13-20h359
c-16-25.333-24-45-24-59z`,widehat1:`M529 0h5l519 115c5 1 9 5 9 10 0 1-1 2-1 3l-4 22
c-1 5-5 9-11 9h-2L532 67 19 159h-2c-5 0-9-4-11-9l-5-22c-1-6 2-12 8-13z`,widehat2:`M1181 0h2l1171 176c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 220h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat3:`M1181 0h2l1171 236c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 280h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widehat4:`M1181 0h2l1171 296c6 0 10 5 10 11l-2 23c-1 6-5 10
-11 10h-1L1182 67 15 340h-1c-6 0-10-4-11-10l-2-23c-1-6 4-11 10-11z`,widecheck1:`M529,159h5l519,-115c5,-1,9,-5,9,-10c0,-1,-1,-2,-1,-3l-4,-22c-1,
-5,-5,-9,-11,-9h-2l-512,92l-513,-92h-2c-5,0,-9,4,-11,9l-5,22c-1,6,2,12,8,13z`,widecheck2:`M1181,220h2l1171,-176c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,153l-1167,-153h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck3:`M1181,280h2l1171,-236c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,213l-1167,-213h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,widecheck4:`M1181,340h2l1171,-296c6,0,10,-5,10,-11l-2,-23c-1,-6,-5,-10,
-11,-10h-1l-1168,273l-1167,-273h-1c-6,0,-10,4,-11,10l-2,23c-1,6,4,11,10,11z`,baraboveleftarrow:`M400000 620h-399890l3 -3c68.7 -52.7 113.7 -120 135 -202
c4 -14.7 6 -23 6 -25c0 -7.3 -7 -11 -21 -11c-8 0 -13.2 0.8 -15.5 2.5
c-2.3 1.7 -4.2 5.8 -5.5 12.5c-1.3 4.7 -2.7 10.3 -4 17c-12 48.7 -34.8 92 -68.5 130
s-74.2 66.3 -121.5 85c-10 4 -16 7.7 -18 11c0 8.7 6 14.3 18 17c47.3 18.7 87.8 47
121.5 85s56.5 81.3 68.5 130c0.7 2 1.3 5 2 9s1.2 6.7 1.5 8c0.3 1.3 1 3.3 2 6
s2.2 4.5 3.5 5.5c1.3 1 3.3 1.8 6 2.5s6 1 10 1c14 0 21 -3.7 21 -11
c0 -2 -2 -10.3 -6 -25c-20 -79.3 -65 -146.7 -135 -202l-3 -3h399890z
M100 620v40h399900v-40z M0 241v40h399900v-40zM0 241v40h399900v-40z`,rightarrowabovebar:`M0 241v40h399891c-47.3 35.3-84 78-110 128-16.7 32
-27.7 63.7-33 95 0 1.3-.2 2.7-.5 4-.3 1.3-.5 2.3-.5 3 0 7.3 6.7 11 20 11 8 0
13.2-.8 15.5-2.5 2.3-1.7 4.2-5.5 5.5-11.5 2-13.3 5.7-27 11-41 14.7-44.7 39
-84.5 73-119.5s73.7-60.2 119-75.5c6-2 9-5.7 9-11s-3-9-9-11c-45.3-15.3-85-40.5
-119-75.5s-58.3-74.8-73-119.5c-4.7-14-8.3-27.3-11-40-1.3-6.7-3.2-10.8-5.5
-12.5-2.3-1.7-7.5-2.5-15.5-2.5-14 0-21 3.7-21 11 0 2 2 10.3 6 25 20.7 83.3 67
151.7 139 205zm96 379h399894v40H0zm0 0h399904v40H0z`,baraboveshortleftharpoon:`M507,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17
c2,0.7,5,1,9,1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21
c-32,-87.3,-82.7,-157.7,-152,-211c0,0,-3,-3,-3,-3l399351,0l0,-40
c-398570,0,-399437,0,-399437,0z M593 435 v40 H399500 v-40z
M0 281 v-40 H399908 v40z M0 281 v-40 H399908 v40z`,rightharpoonaboveshortbar:`M0,241 l0,40c399126,0,399993,0,399993,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M0 241 v40 H399908 v-40z M0 475 v-40 H399500 v40z M0 475 v-40 H399500 v40z`,shortbaraboveleftharpoon:`M7,435c-4,4,-6.3,8.7,-7,14c0,5.3,0.7,9,2,11
c1.3,2,5.3,5.3,12,10c90.7,54,156,130,196,228c3.3,10.7,6.3,16.3,9,17c2,0.7,5,1,9,
1c0,0,5,0,5,0c10.7,0,16.7,-2,18,-6c2,-2.7,1,-9.7,-3,-21c-32,-87.3,-82.7,-157.7,
-152,-211c0,0,-3,-3,-3,-3l399907,0l0,-40c-399126,0,-399993,0,-399993,0z
M93 435 v40 H400000 v-40z M500 241 v40 H400000 v-40z M500 241 v40 H400000 v-40z`,shortrightharpoonabovebar:`M53,241l0,40c398570,0,399437,0,399437,0
c4.7,-4.7,7,-9.3,7,-14c0,-9.3,-3.7,-15.3,-11,-18c-92.7,-56.7,-159,-133.7,-199,
-231c-3.3,-9.3,-6,-14.7,-8,-16c-2,-1.3,-7,-2,-15,-2c-10.7,0,-16.7,2,-18,6
c-2,2.7,-1,9.7,3,21c15.3,42,36.7,81.8,64,119.5c27.3,37.7,58,69.2,92,94.5z
M500 241 v40 H399408 v-40z M500 435 v40 H400000 v-40z`},PW=function(e,t){switch(e){case"lbrack":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v1759 h347 v-84
H403z M403 1759 V0 H319 V1759 v`+t+" v1759 h84z";case"rbrack":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v1759 H0 v84 H347z
M347 1759 V0 H263 V1759 v`+t+" v1759 h84z";case"vert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+" v585 h43z";case"doublevert":return"M145 15 v585 v"+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M188 15 H145 v585 v`+t+` v585 h43z
M367 15 v585 v`+t+` v585 c2.667,10,9.667,15,21,15
c10,0,16.667,-5,20,-15 v-585 v`+-t+` v-585 c-2.667,-10,-9.667,-15,-21,-15
c-10,0,-16.667,5,-20,15z M410 15 H367 v585 v`+t+" v585 h43z";case"lfloor":return"M319 602 V0 H403 V602 v"+t+` v1715 h263 v84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"rfloor":return"M319 602 V0 H403 V602 v"+t+` v1799 H0 v-84 H319z
MM319 602 V0 H403 V602 v`+t+" v1715 H319z";case"lceil":return"M403 1759 V84 H666 V0 H319 V1759 v"+t+` v602 h84z
M403 1759 V0 H319 V1759 v`+t+" v602 h84z";case"rceil":return"M347 1759 V0 H0 V84 H263 V1759 v"+t+` v602 h84z
M347 1759 V0 h-84 V1759 v`+t+" v602 h84z";case"lparen":return`M863,9c0,-2,-2,-5,-6,-9c0,0,-17,0,-17,0c-12.7,0,-19.3,0.3,-20,1
c-5.3,5.3,-10.3,11,-15,17c-242.7,294.7,-395.3,682,-458,1162c-21.3,163.3,-33.3,349,
-36,557 l0,`+(t+84)+`c0.2,6,0,26,0,60c2,159.3,10,310.7,24,454c53.3,528,210,
949.7,470,1265c4.7,6,9.7,11.7,15,17c0.7,0.7,7,1,19,1c0,0,18,0,18,0c4,-4,6,-7,6,-9
c0,-2.7,-3.3,-8.7,-10,-18c-135.3,-192.7,-235.5,-414.3,-300.5,-665c-65,-250.7,-102.5,
-544.7,-112.5,-882c-2,-104,-3,-167,-3,-189
l0,-`+(t+92)+`c0,-162.7,5.7,-314,17,-454c20.7,-272,63.7,-513,129,-723c65.3,
-210,155.3,-396.3,270,-559c6.7,-9.3,10,-15.3,10,-18z`;case"rparen":return`M76,0c-16.7,0,-25,3,-25,9c0,2,2,6.3,6,13c21.3,28.7,42.3,60.3,
63,95c96.7,156.7,172.8,332.5,228.5,527.5c55.7,195,92.8,416.5,111.5,664.5
c11.3,139.3,17,290.7,17,454c0,28,1.7,43,3.3,45l0,`+(t+9)+`
c-3,4,-3.3,16.7,-3.3,38c0,162,-5.7,313.7,-17,455c-18.7,248,-55.8,469.3,-111.5,664
c-55.7,194.7,-131.8,370.3,-228.5,527c-20.7,34.7,-41.7,66.3,-63,95c-2,3.3,-4,7,-6,11
c0,7.3,5.7,11,17,11c0,0,11,0,11,0c9.3,0,14.3,-0.3,15,-1c5.3,-5.3,10.3,-11,15,-17
c242.7,-294.7,395.3,-681.7,458,-1161c21.3,-164.7,33.3,-350.7,36,-558
l0,-`+(t+144)+`c-2,-159.3,-10,-310.7,-24,-454c-53.3,-528,-210,-949.7,
-470,-1265c-4.7,-6,-9.7,-11.7,-15,-17c-0.7,-0.7,-6.7,-1,-18,-1z`;default:throw new Error("Unknown stretchy delimiter.")}};class Qp{constructor(e){this.children=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.children=e,this.classes=[],this.height=0,this.depth=0,this.maxFontSize=0,this.style={}}hasClass(e){return kn.contains(this.classes,e)}toNode(){for(var e=document.createDocumentFragment(),t=0;t<this.children.length;t++)e.appendChild(this.children[t].toNode());return e}toMarkup(){for(var e="",t=0;t<this.children.length;t++)e+=this.children[t].toMarkup();return e}toText(){var e=t=>t.toText();return this.children.map(e).join("")}}var xo={"AMS-Regular":{32:[0,0,0,0,.25],65:[0,.68889,0,0,.72222],66:[0,.68889,0,0,.66667],67:[0,.68889,0,0,.72222],68:[0,.68889,0,0,.72222],69:[0,.68889,0,0,.66667],70:[0,.68889,0,0,.61111],71:[0,.68889,0,0,.77778],72:[0,.68889,0,0,.77778],73:[0,.68889,0,0,.38889],74:[.16667,.68889,0,0,.5],75:[0,.68889,0,0,.77778],76:[0,.68889,0,0,.66667],77:[0,.68889,0,0,.94445],78:[0,.68889,0,0,.72222],79:[.16667,.68889,0,0,.77778],80:[0,.68889,0,0,.61111],81:[.16667,.68889,0,0,.77778],82:[0,.68889,0,0,.72222],83:[0,.68889,0,0,.55556],84:[0,.68889,0,0,.66667],85:[0,.68889,0,0,.72222],86:[0,.68889,0,0,.72222],87:[0,.68889,0,0,1],88:[0,.68889,0,0,.72222],89:[0,.68889,0,0,.72222],90:[0,.68889,0,0,.66667],107:[0,.68889,0,0,.55556],160:[0,0,0,0,.25],165:[0,.675,.025,0,.75],174:[.15559,.69224,0,0,.94666],240:[0,.68889,0,0,.55556],295:[0,.68889,0,0,.54028],710:[0,.825,0,0,2.33334],732:[0,.9,0,0,2.33334],770:[0,.825,0,0,2.33334],771:[0,.9,0,0,2.33334],989:[.08167,.58167,0,0,.77778],1008:[0,.43056,.04028,0,.66667],8245:[0,.54986,0,0,.275],8463:[0,.68889,0,0,.54028],8487:[0,.68889,0,0,.72222],8498:[0,.68889,0,0,.55556],8502:[0,.68889,0,0,.66667],8503:[0,.68889,0,0,.44445],8504:[0,.68889,0,0,.66667],8513:[0,.68889,0,0,.63889],8592:[-.03598,.46402,0,0,.5],8594:[-.03598,.46402,0,0,.5],8602:[-.13313,.36687,0,0,1],8603:[-.13313,.36687,0,0,1],8606:[.01354,.52239,0,0,1],8608:[.01354,.52239,0,0,1],8610:[.01354,.52239,0,0,1.11111],8611:[.01354,.52239,0,0,1.11111],8619:[0,.54986,0,0,1],8620:[0,.54986,0,0,1],8621:[-.13313,.37788,0,0,1.38889],8622:[-.13313,.36687,0,0,1],8624:[0,.69224,0,0,.5],8625:[0,.69224,0,0,.5],8630:[0,.43056,0,0,1],8631:[0,.43056,0,0,1],8634:[.08198,.58198,0,0,.77778],8635:[.08198,.58198,0,0,.77778],8638:[.19444,.69224,0,0,.41667],8639:[.19444,.69224,0,0,.41667],8642:[.19444,.69224,0,0,.41667],8643:[.19444,.69224,0,0,.41667],8644:[.1808,.675,0,0,1],8646:[.1808,.675,0,0,1],8647:[.1808,.675,0,0,1],8648:[.19444,.69224,0,0,.83334],8649:[.1808,.675,0,0,1],8650:[.19444,.69224,0,0,.83334],8651:[.01354,.52239,0,0,1],8652:[.01354,.52239,0,0,1],8653:[-.13313,.36687,0,0,1],8654:[-.13313,.36687,0,0,1],8655:[-.13313,.36687,0,0,1],8666:[.13667,.63667,0,0,1],8667:[.13667,.63667,0,0,1],8669:[-.13313,.37788,0,0,1],8672:[-.064,.437,0,0,1.334],8674:[-.064,.437,0,0,1.334],8705:[0,.825,0,0,.5],8708:[0,.68889,0,0,.55556],8709:[.08167,.58167,0,0,.77778],8717:[0,.43056,0,0,.42917],8722:[-.03598,.46402,0,0,.5],8724:[.08198,.69224,0,0,.77778],8726:[.08167,.58167,0,0,.77778],8733:[0,.69224,0,0,.77778],8736:[0,.69224,0,0,.72222],8737:[0,.69224,0,0,.72222],8738:[.03517,.52239,0,0,.72222],8739:[.08167,.58167,0,0,.22222],8740:[.25142,.74111,0,0,.27778],8741:[.08167,.58167,0,0,.38889],8742:[.25142,.74111,0,0,.5],8756:[0,.69224,0,0,.66667],8757:[0,.69224,0,0,.66667],8764:[-.13313,.36687,0,0,.77778],8765:[-.13313,.37788,0,0,.77778],8769:[-.13313,.36687,0,0,.77778],8770:[-.03625,.46375,0,0,.77778],8774:[.30274,.79383,0,0,.77778],8776:[-.01688,.48312,0,0,.77778],8778:[.08167,.58167,0,0,.77778],8782:[.06062,.54986,0,0,.77778],8783:[.06062,.54986,0,0,.77778],8785:[.08198,.58198,0,0,.77778],8786:[.08198,.58198,0,0,.77778],8787:[.08198,.58198,0,0,.77778],8790:[0,.69224,0,0,.77778],8791:[.22958,.72958,0,0,.77778],8796:[.08198,.91667,0,0,.77778],8806:[.25583,.75583,0,0,.77778],8807:[.25583,.75583,0,0,.77778],8808:[.25142,.75726,0,0,.77778],8809:[.25142,.75726,0,0,.77778],8812:[.25583,.75583,0,0,.5],8814:[.20576,.70576,0,0,.77778],8815:[.20576,.70576,0,0,.77778],8816:[.30274,.79383,0,0,.77778],8817:[.30274,.79383,0,0,.77778],8818:[.22958,.72958,0,0,.77778],8819:[.22958,.72958,0,0,.77778],8822:[.1808,.675,0,0,.77778],8823:[.1808,.675,0,0,.77778],8828:[.13667,.63667,0,0,.77778],8829:[.13667,.63667,0,0,.77778],8830:[.22958,.72958,0,0,.77778],8831:[.22958,.72958,0,0,.77778],8832:[.20576,.70576,0,0,.77778],8833:[.20576,.70576,0,0,.77778],8840:[.30274,.79383,0,0,.77778],8841:[.30274,.79383,0,0,.77778],8842:[.13597,.63597,0,0,.77778],8843:[.13597,.63597,0,0,.77778],8847:[.03517,.54986,0,0,.77778],8848:[.03517,.54986,0,0,.77778],8858:[.08198,.58198,0,0,.77778],8859:[.08198,.58198,0,0,.77778],8861:[.08198,.58198,0,0,.77778],8862:[0,.675,0,0,.77778],8863:[0,.675,0,0,.77778],8864:[0,.675,0,0,.77778],8865:[0,.675,0,0,.77778],8872:[0,.69224,0,0,.61111],8873:[0,.69224,0,0,.72222],8874:[0,.69224,0,0,.88889],8876:[0,.68889,0,0,.61111],8877:[0,.68889,0,0,.61111],8878:[0,.68889,0,0,.72222],8879:[0,.68889,0,0,.72222],8882:[.03517,.54986,0,0,.77778],8883:[.03517,.54986,0,0,.77778],8884:[.13667,.63667,0,0,.77778],8885:[.13667,.63667,0,0,.77778],8888:[0,.54986,0,0,1.11111],8890:[.19444,.43056,0,0,.55556],8891:[.19444,.69224,0,0,.61111],8892:[.19444,.69224,0,0,.61111],8901:[0,.54986,0,0,.27778],8903:[.08167,.58167,0,0,.77778],8905:[.08167,.58167,0,0,.77778],8906:[.08167,.58167,0,0,.77778],8907:[0,.69224,0,0,.77778],8908:[0,.69224,0,0,.77778],8909:[-.03598,.46402,0,0,.77778],8910:[0,.54986,0,0,.76042],8911:[0,.54986,0,0,.76042],8912:[.03517,.54986,0,0,.77778],8913:[.03517,.54986,0,0,.77778],8914:[0,.54986,0,0,.66667],8915:[0,.54986,0,0,.66667],8916:[0,.69224,0,0,.66667],8918:[.0391,.5391,0,0,.77778],8919:[.0391,.5391,0,0,.77778],8920:[.03517,.54986,0,0,1.33334],8921:[.03517,.54986,0,0,1.33334],8922:[.38569,.88569,0,0,.77778],8923:[.38569,.88569,0,0,.77778],8926:[.13667,.63667,0,0,.77778],8927:[.13667,.63667,0,0,.77778],8928:[.30274,.79383,0,0,.77778],8929:[.30274,.79383,0,0,.77778],8934:[.23222,.74111,0,0,.77778],8935:[.23222,.74111,0,0,.77778],8936:[.23222,.74111,0,0,.77778],8937:[.23222,.74111,0,0,.77778],8938:[.20576,.70576,0,0,.77778],8939:[.20576,.70576,0,0,.77778],8940:[.30274,.79383,0,0,.77778],8941:[.30274,.79383,0,0,.77778],8994:[.19444,.69224,0,0,.77778],8995:[.19444,.69224,0,0,.77778],9416:[.15559,.69224,0,0,.90222],9484:[0,.69224,0,0,.5],9488:[0,.69224,0,0,.5],9492:[0,.37788,0,0,.5],9496:[0,.37788,0,0,.5],9585:[.19444,.68889,0,0,.88889],9586:[.19444,.74111,0,0,.88889],9632:[0,.675,0,0,.77778],9633:[0,.675,0,0,.77778],9650:[0,.54986,0,0,.72222],9651:[0,.54986,0,0,.72222],9654:[.03517,.54986,0,0,.77778],9660:[0,.54986,0,0,.72222],9661:[0,.54986,0,0,.72222],9664:[.03517,.54986,0,0,.77778],9674:[.11111,.69224,0,0,.66667],9733:[.19444,.69224,0,0,.94445],10003:[0,.69224,0,0,.83334],10016:[0,.69224,0,0,.83334],10731:[.11111,.69224,0,0,.66667],10846:[.19444,.75583,0,0,.61111],10877:[.13667,.63667,0,0,.77778],10878:[.13667,.63667,0,0,.77778],10885:[.25583,.75583,0,0,.77778],10886:[.25583,.75583,0,0,.77778],10887:[.13597,.63597,0,0,.77778],10888:[.13597,.63597,0,0,.77778],10889:[.26167,.75726,0,0,.77778],10890:[.26167,.75726,0,0,.77778],10891:[.48256,.98256,0,0,.77778],10892:[.48256,.98256,0,0,.77778],10901:[.13667,.63667,0,0,.77778],10902:[.13667,.63667,0,0,.77778],10933:[.25142,.75726,0,0,.77778],10934:[.25142,.75726,0,0,.77778],10935:[.26167,.75726,0,0,.77778],10936:[.26167,.75726,0,0,.77778],10937:[.26167,.75726,0,0,.77778],10938:[.26167,.75726,0,0,.77778],10949:[.25583,.75583,0,0,.77778],10950:[.25583,.75583,0,0,.77778],10955:[.28481,.79383,0,0,.77778],10956:[.28481,.79383,0,0,.77778],57350:[.08167,.58167,0,0,.22222],57351:[.08167,.58167,0,0,.38889],57352:[.08167,.58167,0,0,.77778],57353:[0,.43056,.04028,0,.66667],57356:[.25142,.75726,0,0,.77778],57357:[.25142,.75726,0,0,.77778],57358:[.41951,.91951,0,0,.77778],57359:[.30274,.79383,0,0,.77778],57360:[.30274,.79383,0,0,.77778],57361:[.41951,.91951,0,0,.77778],57366:[.25142,.75726,0,0,.77778],57367:[.25142,.75726,0,0,.77778],57368:[.25142,.75726,0,0,.77778],57369:[.25142,.75726,0,0,.77778],57370:[.13597,.63597,0,0,.77778],57371:[.13597,.63597,0,0,.77778]},"Caligraphic-Regular":{32:[0,0,0,0,.25],65:[0,.68333,0,.19445,.79847],66:[0,.68333,.03041,.13889,.65681],67:[0,.68333,.05834,.13889,.52653],68:[0,.68333,.02778,.08334,.77139],69:[0,.68333,.08944,.11111,.52778],70:[0,.68333,.09931,.11111,.71875],71:[.09722,.68333,.0593,.11111,.59487],72:[0,.68333,.00965,.11111,.84452],73:[0,.68333,.07382,0,.54452],74:[.09722,.68333,.18472,.16667,.67778],75:[0,.68333,.01445,.05556,.76195],76:[0,.68333,0,.13889,.68972],77:[0,.68333,0,.13889,1.2009],78:[0,.68333,.14736,.08334,.82049],79:[0,.68333,.02778,.11111,.79611],80:[0,.68333,.08222,.08334,.69556],81:[.09722,.68333,0,.11111,.81667],82:[0,.68333,0,.08334,.8475],83:[0,.68333,.075,.13889,.60556],84:[0,.68333,.25417,0,.54464],85:[0,.68333,.09931,.08334,.62583],86:[0,.68333,.08222,0,.61278],87:[0,.68333,.08222,.08334,.98778],88:[0,.68333,.14643,.13889,.7133],89:[.09722,.68333,.08222,.08334,.66834],90:[0,.68333,.07944,.13889,.72473],160:[0,0,0,0,.25]},"Fraktur-Regular":{32:[0,0,0,0,.25],33:[0,.69141,0,0,.29574],34:[0,.69141,0,0,.21471],38:[0,.69141,0,0,.73786],39:[0,.69141,0,0,.21201],40:[.24982,.74947,0,0,.38865],41:[.24982,.74947,0,0,.38865],42:[0,.62119,0,0,.27764],43:[.08319,.58283,0,0,.75623],44:[0,.10803,0,0,.27764],45:[.08319,.58283,0,0,.75623],46:[0,.10803,0,0,.27764],47:[.24982,.74947,0,0,.50181],48:[0,.47534,0,0,.50181],49:[0,.47534,0,0,.50181],50:[0,.47534,0,0,.50181],51:[.18906,.47534,0,0,.50181],52:[.18906,.47534,0,0,.50181],53:[.18906,.47534,0,0,.50181],54:[0,.69141,0,0,.50181],55:[.18906,.47534,0,0,.50181],56:[0,.69141,0,0,.50181],57:[.18906,.47534,0,0,.50181],58:[0,.47534,0,0,.21606],59:[.12604,.47534,0,0,.21606],61:[-.13099,.36866,0,0,.75623],63:[0,.69141,0,0,.36245],65:[0,.69141,0,0,.7176],66:[0,.69141,0,0,.88397],67:[0,.69141,0,0,.61254],68:[0,.69141,0,0,.83158],69:[0,.69141,0,0,.66278],70:[.12604,.69141,0,0,.61119],71:[0,.69141,0,0,.78539],72:[.06302,.69141,0,0,.7203],73:[0,.69141,0,0,.55448],74:[.12604,.69141,0,0,.55231],75:[0,.69141,0,0,.66845],76:[0,.69141,0,0,.66602],77:[0,.69141,0,0,1.04953],78:[0,.69141,0,0,.83212],79:[0,.69141,0,0,.82699],80:[.18906,.69141,0,0,.82753],81:[.03781,.69141,0,0,.82699],82:[0,.69141,0,0,.82807],83:[0,.69141,0,0,.82861],84:[0,.69141,0,0,.66899],85:[0,.69141,0,0,.64576],86:[0,.69141,0,0,.83131],87:[0,.69141,0,0,1.04602],88:[0,.69141,0,0,.71922],89:[.18906,.69141,0,0,.83293],90:[.12604,.69141,0,0,.60201],91:[.24982,.74947,0,0,.27764],93:[.24982,.74947,0,0,.27764],94:[0,.69141,0,0,.49965],97:[0,.47534,0,0,.50046],98:[0,.69141,0,0,.51315],99:[0,.47534,0,0,.38946],100:[0,.62119,0,0,.49857],101:[0,.47534,0,0,.40053],102:[.18906,.69141,0,0,.32626],103:[.18906,.47534,0,0,.5037],104:[.18906,.69141,0,0,.52126],105:[0,.69141,0,0,.27899],106:[0,.69141,0,0,.28088],107:[0,.69141,0,0,.38946],108:[0,.69141,0,0,.27953],109:[0,.47534,0,0,.76676],110:[0,.47534,0,0,.52666],111:[0,.47534,0,0,.48885],112:[.18906,.52396,0,0,.50046],113:[.18906,.47534,0,0,.48912],114:[0,.47534,0,0,.38919],115:[0,.47534,0,0,.44266],116:[0,.62119,0,0,.33301],117:[0,.47534,0,0,.5172],118:[0,.52396,0,0,.5118],119:[0,.52396,0,0,.77351],120:[.18906,.47534,0,0,.38865],121:[.18906,.47534,0,0,.49884],122:[.18906,.47534,0,0,.39054],160:[0,0,0,0,.25],8216:[0,.69141,0,0,.21471],8217:[0,.69141,0,0,.21471],58112:[0,.62119,0,0,.49749],58113:[0,.62119,0,0,.4983],58114:[.18906,.69141,0,0,.33328],58115:[.18906,.69141,0,0,.32923],58116:[.18906,.47534,0,0,.50343],58117:[0,.69141,0,0,.33301],58118:[0,.62119,0,0,.33409],58119:[0,.47534,0,0,.50073]},"Main-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.35],34:[0,.69444,0,0,.60278],35:[.19444,.69444,0,0,.95833],36:[.05556,.75,0,0,.575],37:[.05556,.75,0,0,.95833],38:[0,.69444,0,0,.89444],39:[0,.69444,0,0,.31944],40:[.25,.75,0,0,.44722],41:[.25,.75,0,0,.44722],42:[0,.75,0,0,.575],43:[.13333,.63333,0,0,.89444],44:[.19444,.15556,0,0,.31944],45:[0,.44444,0,0,.38333],46:[0,.15556,0,0,.31944],47:[.25,.75,0,0,.575],48:[0,.64444,0,0,.575],49:[0,.64444,0,0,.575],50:[0,.64444,0,0,.575],51:[0,.64444,0,0,.575],52:[0,.64444,0,0,.575],53:[0,.64444,0,0,.575],54:[0,.64444,0,0,.575],55:[0,.64444,0,0,.575],56:[0,.64444,0,0,.575],57:[0,.64444,0,0,.575],58:[0,.44444,0,0,.31944],59:[.19444,.44444,0,0,.31944],60:[.08556,.58556,0,0,.89444],61:[-.10889,.39111,0,0,.89444],62:[.08556,.58556,0,0,.89444],63:[0,.69444,0,0,.54305],64:[0,.69444,0,0,.89444],65:[0,.68611,0,0,.86944],66:[0,.68611,0,0,.81805],67:[0,.68611,0,0,.83055],68:[0,.68611,0,0,.88194],69:[0,.68611,0,0,.75555],70:[0,.68611,0,0,.72361],71:[0,.68611,0,0,.90416],72:[0,.68611,0,0,.9],73:[0,.68611,0,0,.43611],74:[0,.68611,0,0,.59444],75:[0,.68611,0,0,.90138],76:[0,.68611,0,0,.69166],77:[0,.68611,0,0,1.09166],78:[0,.68611,0,0,.9],79:[0,.68611,0,0,.86388],80:[0,.68611,0,0,.78611],81:[.19444,.68611,0,0,.86388],82:[0,.68611,0,0,.8625],83:[0,.68611,0,0,.63889],84:[0,.68611,0,0,.8],85:[0,.68611,0,0,.88472],86:[0,.68611,.01597,0,.86944],87:[0,.68611,.01597,0,1.18888],88:[0,.68611,0,0,.86944],89:[0,.68611,.02875,0,.86944],90:[0,.68611,0,0,.70277],91:[.25,.75,0,0,.31944],92:[.25,.75,0,0,.575],93:[.25,.75,0,0,.31944],94:[0,.69444,0,0,.575],95:[.31,.13444,.03194,0,.575],97:[0,.44444,0,0,.55902],98:[0,.69444,0,0,.63889],99:[0,.44444,0,0,.51111],100:[0,.69444,0,0,.63889],101:[0,.44444,0,0,.52708],102:[0,.69444,.10903,0,.35139],103:[.19444,.44444,.01597,0,.575],104:[0,.69444,0,0,.63889],105:[0,.69444,0,0,.31944],106:[.19444,.69444,0,0,.35139],107:[0,.69444,0,0,.60694],108:[0,.69444,0,0,.31944],109:[0,.44444,0,0,.95833],110:[0,.44444,0,0,.63889],111:[0,.44444,0,0,.575],112:[.19444,.44444,0,0,.63889],113:[.19444,.44444,0,0,.60694],114:[0,.44444,0,0,.47361],115:[0,.44444,0,0,.45361],116:[0,.63492,0,0,.44722],117:[0,.44444,0,0,.63889],118:[0,.44444,.01597,0,.60694],119:[0,.44444,.01597,0,.83055],120:[0,.44444,0,0,.60694],121:[.19444,.44444,.01597,0,.60694],122:[0,.44444,0,0,.51111],123:[.25,.75,0,0,.575],124:[.25,.75,0,0,.31944],125:[.25,.75,0,0,.575],126:[.35,.34444,0,0,.575],160:[0,0,0,0,.25],163:[0,.69444,0,0,.86853],168:[0,.69444,0,0,.575],172:[0,.44444,0,0,.76666],176:[0,.69444,0,0,.86944],177:[.13333,.63333,0,0,.89444],184:[.17014,0,0,0,.51111],198:[0,.68611,0,0,1.04166],215:[.13333,.63333,0,0,.89444],216:[.04861,.73472,0,0,.89444],223:[0,.69444,0,0,.59722],230:[0,.44444,0,0,.83055],247:[.13333,.63333,0,0,.89444],248:[.09722,.54167,0,0,.575],305:[0,.44444,0,0,.31944],338:[0,.68611,0,0,1.16944],339:[0,.44444,0,0,.89444],567:[.19444,.44444,0,0,.35139],710:[0,.69444,0,0,.575],711:[0,.63194,0,0,.575],713:[0,.59611,0,0,.575],714:[0,.69444,0,0,.575],715:[0,.69444,0,0,.575],728:[0,.69444,0,0,.575],729:[0,.69444,0,0,.31944],730:[0,.69444,0,0,.86944],732:[0,.69444,0,0,.575],733:[0,.69444,0,0,.575],915:[0,.68611,0,0,.69166],916:[0,.68611,0,0,.95833],920:[0,.68611,0,0,.89444],923:[0,.68611,0,0,.80555],926:[0,.68611,0,0,.76666],928:[0,.68611,0,0,.9],931:[0,.68611,0,0,.83055],933:[0,.68611,0,0,.89444],934:[0,.68611,0,0,.83055],936:[0,.68611,0,0,.89444],937:[0,.68611,0,0,.83055],8211:[0,.44444,.03194,0,.575],8212:[0,.44444,.03194,0,1.14999],8216:[0,.69444,0,0,.31944],8217:[0,.69444,0,0,.31944],8220:[0,.69444,0,0,.60278],8221:[0,.69444,0,0,.60278],8224:[.19444,.69444,0,0,.51111],8225:[.19444,.69444,0,0,.51111],8242:[0,.55556,0,0,.34444],8407:[0,.72444,.15486,0,.575],8463:[0,.69444,0,0,.66759],8465:[0,.69444,0,0,.83055],8467:[0,.69444,0,0,.47361],8472:[.19444,.44444,0,0,.74027],8476:[0,.69444,0,0,.83055],8501:[0,.69444,0,0,.70277],8592:[-.10889,.39111,0,0,1.14999],8593:[.19444,.69444,0,0,.575],8594:[-.10889,.39111,0,0,1.14999],8595:[.19444,.69444,0,0,.575],8596:[-.10889,.39111,0,0,1.14999],8597:[.25,.75,0,0,.575],8598:[.19444,.69444,0,0,1.14999],8599:[.19444,.69444,0,0,1.14999],8600:[.19444,.69444,0,0,1.14999],8601:[.19444,.69444,0,0,1.14999],8636:[-.10889,.39111,0,0,1.14999],8637:[-.10889,.39111,0,0,1.14999],8640:[-.10889,.39111,0,0,1.14999],8641:[-.10889,.39111,0,0,1.14999],8656:[-.10889,.39111,0,0,1.14999],8657:[.19444,.69444,0,0,.70277],8658:[-.10889,.39111,0,0,1.14999],8659:[.19444,.69444,0,0,.70277],8660:[-.10889,.39111,0,0,1.14999],8661:[.25,.75,0,0,.70277],8704:[0,.69444,0,0,.63889],8706:[0,.69444,.06389,0,.62847],8707:[0,.69444,0,0,.63889],8709:[.05556,.75,0,0,.575],8711:[0,.68611,0,0,.95833],8712:[.08556,.58556,0,0,.76666],8715:[.08556,.58556,0,0,.76666],8722:[.13333,.63333,0,0,.89444],8723:[.13333,.63333,0,0,.89444],8725:[.25,.75,0,0,.575],8726:[.25,.75,0,0,.575],8727:[-.02778,.47222,0,0,.575],8728:[-.02639,.47361,0,0,.575],8729:[-.02639,.47361,0,0,.575],8730:[.18,.82,0,0,.95833],8733:[0,.44444,0,0,.89444],8734:[0,.44444,0,0,1.14999],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.31944],8741:[.25,.75,0,0,.575],8743:[0,.55556,0,0,.76666],8744:[0,.55556,0,0,.76666],8745:[0,.55556,0,0,.76666],8746:[0,.55556,0,0,.76666],8747:[.19444,.69444,.12778,0,.56875],8764:[-.10889,.39111,0,0,.89444],8768:[.19444,.69444,0,0,.31944],8771:[.00222,.50222,0,0,.89444],8773:[.027,.638,0,0,.894],8776:[.02444,.52444,0,0,.89444],8781:[.00222,.50222,0,0,.89444],8801:[.00222,.50222,0,0,.89444],8804:[.19667,.69667,0,0,.89444],8805:[.19667,.69667,0,0,.89444],8810:[.08556,.58556,0,0,1.14999],8811:[.08556,.58556,0,0,1.14999],8826:[.08556,.58556,0,0,.89444],8827:[.08556,.58556,0,0,.89444],8834:[.08556,.58556,0,0,.89444],8835:[.08556,.58556,0,0,.89444],8838:[.19667,.69667,0,0,.89444],8839:[.19667,.69667,0,0,.89444],8846:[0,.55556,0,0,.76666],8849:[.19667,.69667,0,0,.89444],8850:[.19667,.69667,0,0,.89444],8851:[0,.55556,0,0,.76666],8852:[0,.55556,0,0,.76666],8853:[.13333,.63333,0,0,.89444],8854:[.13333,.63333,0,0,.89444],8855:[.13333,.63333,0,0,.89444],8856:[.13333,.63333,0,0,.89444],8857:[.13333,.63333,0,0,.89444],8866:[0,.69444,0,0,.70277],8867:[0,.69444,0,0,.70277],8868:[0,.69444,0,0,.89444],8869:[0,.69444,0,0,.89444],8900:[-.02639,.47361,0,0,.575],8901:[-.02639,.47361,0,0,.31944],8902:[-.02778,.47222,0,0,.575],8968:[.25,.75,0,0,.51111],8969:[.25,.75,0,0,.51111],8970:[.25,.75,0,0,.51111],8971:[.25,.75,0,0,.51111],8994:[-.13889,.36111,0,0,1.14999],8995:[-.13889,.36111,0,0,1.14999],9651:[.19444,.69444,0,0,1.02222],9657:[-.02778,.47222,0,0,.575],9661:[.19444,.69444,0,0,1.02222],9667:[-.02778,.47222,0,0,.575],9711:[.19444,.69444,0,0,1.14999],9824:[.12963,.69444,0,0,.89444],9825:[.12963,.69444,0,0,.89444],9826:[.12963,.69444,0,0,.89444],9827:[.12963,.69444,0,0,.89444],9837:[0,.75,0,0,.44722],9838:[.19444,.69444,0,0,.44722],9839:[.19444,.69444,0,0,.44722],10216:[.25,.75,0,0,.44722],10217:[.25,.75,0,0,.44722],10815:[0,.68611,0,0,.9],10927:[.19667,.69667,0,0,.89444],10928:[.19667,.69667,0,0,.89444],57376:[.19444,.69444,0,0,0]},"Main-BoldItalic":{32:[0,0,0,0,.25],33:[0,.69444,.11417,0,.38611],34:[0,.69444,.07939,0,.62055],35:[.19444,.69444,.06833,0,.94444],37:[.05556,.75,.12861,0,.94444],38:[0,.69444,.08528,0,.88555],39:[0,.69444,.12945,0,.35555],40:[.25,.75,.15806,0,.47333],41:[.25,.75,.03306,0,.47333],42:[0,.75,.14333,0,.59111],43:[.10333,.60333,.03306,0,.88555],44:[.19444,.14722,0,0,.35555],45:[0,.44444,.02611,0,.41444],46:[0,.14722,0,0,.35555],47:[.25,.75,.15806,0,.59111],48:[0,.64444,.13167,0,.59111],49:[0,.64444,.13167,0,.59111],50:[0,.64444,.13167,0,.59111],51:[0,.64444,.13167,0,.59111],52:[.19444,.64444,.13167,0,.59111],53:[0,.64444,.13167,0,.59111],54:[0,.64444,.13167,0,.59111],55:[.19444,.64444,.13167,0,.59111],56:[0,.64444,.13167,0,.59111],57:[0,.64444,.13167,0,.59111],58:[0,.44444,.06695,0,.35555],59:[.19444,.44444,.06695,0,.35555],61:[-.10889,.39111,.06833,0,.88555],63:[0,.69444,.11472,0,.59111],64:[0,.69444,.09208,0,.88555],65:[0,.68611,0,0,.86555],66:[0,.68611,.0992,0,.81666],67:[0,.68611,.14208,0,.82666],68:[0,.68611,.09062,0,.87555],69:[0,.68611,.11431,0,.75666],70:[0,.68611,.12903,0,.72722],71:[0,.68611,.07347,0,.89527],72:[0,.68611,.17208,0,.8961],73:[0,.68611,.15681,0,.47166],74:[0,.68611,.145,0,.61055],75:[0,.68611,.14208,0,.89499],76:[0,.68611,0,0,.69777],77:[0,.68611,.17208,0,1.07277],78:[0,.68611,.17208,0,.8961],79:[0,.68611,.09062,0,.85499],80:[0,.68611,.0992,0,.78721],81:[.19444,.68611,.09062,0,.85499],82:[0,.68611,.02559,0,.85944],83:[0,.68611,.11264,0,.64999],84:[0,.68611,.12903,0,.7961],85:[0,.68611,.17208,0,.88083],86:[0,.68611,.18625,0,.86555],87:[0,.68611,.18625,0,1.15999],88:[0,.68611,.15681,0,.86555],89:[0,.68611,.19803,0,.86555],90:[0,.68611,.14208,0,.70888],91:[.25,.75,.1875,0,.35611],93:[.25,.75,.09972,0,.35611],94:[0,.69444,.06709,0,.59111],95:[.31,.13444,.09811,0,.59111],97:[0,.44444,.09426,0,.59111],98:[0,.69444,.07861,0,.53222],99:[0,.44444,.05222,0,.53222],100:[0,.69444,.10861,0,.59111],101:[0,.44444,.085,0,.53222],102:[.19444,.69444,.21778,0,.4],103:[.19444,.44444,.105,0,.53222],104:[0,.69444,.09426,0,.59111],105:[0,.69326,.11387,0,.35555],106:[.19444,.69326,.1672,0,.35555],107:[0,.69444,.11111,0,.53222],108:[0,.69444,.10861,0,.29666],109:[0,.44444,.09426,0,.94444],110:[0,.44444,.09426,0,.64999],111:[0,.44444,.07861,0,.59111],112:[.19444,.44444,.07861,0,.59111],113:[.19444,.44444,.105,0,.53222],114:[0,.44444,.11111,0,.50167],115:[0,.44444,.08167,0,.48694],116:[0,.63492,.09639,0,.385],117:[0,.44444,.09426,0,.62055],118:[0,.44444,.11111,0,.53222],119:[0,.44444,.11111,0,.76777],120:[0,.44444,.12583,0,.56055],121:[.19444,.44444,.105,0,.56166],122:[0,.44444,.13889,0,.49055],126:[.35,.34444,.11472,0,.59111],160:[0,0,0,0,.25],168:[0,.69444,.11473,0,.59111],176:[0,.69444,0,0,.94888],184:[.17014,0,0,0,.53222],198:[0,.68611,.11431,0,1.02277],216:[.04861,.73472,.09062,0,.88555],223:[.19444,.69444,.09736,0,.665],230:[0,.44444,.085,0,.82666],248:[.09722,.54167,.09458,0,.59111],305:[0,.44444,.09426,0,.35555],338:[0,.68611,.11431,0,1.14054],339:[0,.44444,.085,0,.82666],567:[.19444,.44444,.04611,0,.385],710:[0,.69444,.06709,0,.59111],711:[0,.63194,.08271,0,.59111],713:[0,.59444,.10444,0,.59111],714:[0,.69444,.08528,0,.59111],715:[0,.69444,0,0,.59111],728:[0,.69444,.10333,0,.59111],729:[0,.69444,.12945,0,.35555],730:[0,.69444,0,0,.94888],732:[0,.69444,.11472,0,.59111],733:[0,.69444,.11472,0,.59111],915:[0,.68611,.12903,0,.69777],916:[0,.68611,0,0,.94444],920:[0,.68611,.09062,0,.88555],923:[0,.68611,0,0,.80666],926:[0,.68611,.15092,0,.76777],928:[0,.68611,.17208,0,.8961],931:[0,.68611,.11431,0,.82666],933:[0,.68611,.10778,0,.88555],934:[0,.68611,.05632,0,.82666],936:[0,.68611,.10778,0,.88555],937:[0,.68611,.0992,0,.82666],8211:[0,.44444,.09811,0,.59111],8212:[0,.44444,.09811,0,1.18221],8216:[0,.69444,.12945,0,.35555],8217:[0,.69444,.12945,0,.35555],8220:[0,.69444,.16772,0,.62055],8221:[0,.69444,.07939,0,.62055]},"Main-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.12417,0,.30667],34:[0,.69444,.06961,0,.51444],35:[.19444,.69444,.06616,0,.81777],37:[.05556,.75,.13639,0,.81777],38:[0,.69444,.09694,0,.76666],39:[0,.69444,.12417,0,.30667],40:[.25,.75,.16194,0,.40889],41:[.25,.75,.03694,0,.40889],42:[0,.75,.14917,0,.51111],43:[.05667,.56167,.03694,0,.76666],44:[.19444,.10556,0,0,.30667],45:[0,.43056,.02826,0,.35778],46:[0,.10556,0,0,.30667],47:[.25,.75,.16194,0,.51111],48:[0,.64444,.13556,0,.51111],49:[0,.64444,.13556,0,.51111],50:[0,.64444,.13556,0,.51111],51:[0,.64444,.13556,0,.51111],52:[.19444,.64444,.13556,0,.51111],53:[0,.64444,.13556,0,.51111],54:[0,.64444,.13556,0,.51111],55:[.19444,.64444,.13556,0,.51111],56:[0,.64444,.13556,0,.51111],57:[0,.64444,.13556,0,.51111],58:[0,.43056,.0582,0,.30667],59:[.19444,.43056,.0582,0,.30667],61:[-.13313,.36687,.06616,0,.76666],63:[0,.69444,.1225,0,.51111],64:[0,.69444,.09597,0,.76666],65:[0,.68333,0,0,.74333],66:[0,.68333,.10257,0,.70389],67:[0,.68333,.14528,0,.71555],68:[0,.68333,.09403,0,.755],69:[0,.68333,.12028,0,.67833],70:[0,.68333,.13305,0,.65277],71:[0,.68333,.08722,0,.77361],72:[0,.68333,.16389,0,.74333],73:[0,.68333,.15806,0,.38555],74:[0,.68333,.14028,0,.525],75:[0,.68333,.14528,0,.76888],76:[0,.68333,0,0,.62722],77:[0,.68333,.16389,0,.89666],78:[0,.68333,.16389,0,.74333],79:[0,.68333,.09403,0,.76666],80:[0,.68333,.10257,0,.67833],81:[.19444,.68333,.09403,0,.76666],82:[0,.68333,.03868,0,.72944],83:[0,.68333,.11972,0,.56222],84:[0,.68333,.13305,0,.71555],85:[0,.68333,.16389,0,.74333],86:[0,.68333,.18361,0,.74333],87:[0,.68333,.18361,0,.99888],88:[0,.68333,.15806,0,.74333],89:[0,.68333,.19383,0,.74333],90:[0,.68333,.14528,0,.61333],91:[.25,.75,.1875,0,.30667],93:[.25,.75,.10528,0,.30667],94:[0,.69444,.06646,0,.51111],95:[.31,.12056,.09208,0,.51111],97:[0,.43056,.07671,0,.51111],98:[0,.69444,.06312,0,.46],99:[0,.43056,.05653,0,.46],100:[0,.69444,.10333,0,.51111],101:[0,.43056,.07514,0,.46],102:[.19444,.69444,.21194,0,.30667],103:[.19444,.43056,.08847,0,.46],104:[0,.69444,.07671,0,.51111],105:[0,.65536,.1019,0,.30667],106:[.19444,.65536,.14467,0,.30667],107:[0,.69444,.10764,0,.46],108:[0,.69444,.10333,0,.25555],109:[0,.43056,.07671,0,.81777],110:[0,.43056,.07671,0,.56222],111:[0,.43056,.06312,0,.51111],112:[.19444,.43056,.06312,0,.51111],113:[.19444,.43056,.08847,0,.46],114:[0,.43056,.10764,0,.42166],115:[0,.43056,.08208,0,.40889],116:[0,.61508,.09486,0,.33222],117:[0,.43056,.07671,0,.53666],118:[0,.43056,.10764,0,.46],119:[0,.43056,.10764,0,.66444],120:[0,.43056,.12042,0,.46389],121:[.19444,.43056,.08847,0,.48555],122:[0,.43056,.12292,0,.40889],126:[.35,.31786,.11585,0,.51111],160:[0,0,0,0,.25],168:[0,.66786,.10474,0,.51111],176:[0,.69444,0,0,.83129],184:[.17014,0,0,0,.46],198:[0,.68333,.12028,0,.88277],216:[.04861,.73194,.09403,0,.76666],223:[.19444,.69444,.10514,0,.53666],230:[0,.43056,.07514,0,.71555],248:[.09722,.52778,.09194,0,.51111],338:[0,.68333,.12028,0,.98499],339:[0,.43056,.07514,0,.71555],710:[0,.69444,.06646,0,.51111],711:[0,.62847,.08295,0,.51111],713:[0,.56167,.10333,0,.51111],714:[0,.69444,.09694,0,.51111],715:[0,.69444,0,0,.51111],728:[0,.69444,.10806,0,.51111],729:[0,.66786,.11752,0,.30667],730:[0,.69444,0,0,.83129],732:[0,.66786,.11585,0,.51111],733:[0,.69444,.1225,0,.51111],915:[0,.68333,.13305,0,.62722],916:[0,.68333,0,0,.81777],920:[0,.68333,.09403,0,.76666],923:[0,.68333,0,0,.69222],926:[0,.68333,.15294,0,.66444],928:[0,.68333,.16389,0,.74333],931:[0,.68333,.12028,0,.71555],933:[0,.68333,.11111,0,.76666],934:[0,.68333,.05986,0,.71555],936:[0,.68333,.11111,0,.76666],937:[0,.68333,.10257,0,.71555],8211:[0,.43056,.09208,0,.51111],8212:[0,.43056,.09208,0,1.02222],8216:[0,.69444,.12417,0,.30667],8217:[0,.69444,.12417,0,.30667],8220:[0,.69444,.1685,0,.51444],8221:[0,.69444,.06961,0,.51444],8463:[0,.68889,0,0,.54028]},"Main-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.27778],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.77778],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.19444,.10556,0,0,.27778],45:[0,.43056,0,0,.33333],46:[0,.10556,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.64444,0,0,.5],49:[0,.64444,0,0,.5],50:[0,.64444,0,0,.5],51:[0,.64444,0,0,.5],52:[0,.64444,0,0,.5],53:[0,.64444,0,0,.5],54:[0,.64444,0,0,.5],55:[0,.64444,0,0,.5],56:[0,.64444,0,0,.5],57:[0,.64444,0,0,.5],58:[0,.43056,0,0,.27778],59:[.19444,.43056,0,0,.27778],60:[.0391,.5391,0,0,.77778],61:[-.13313,.36687,0,0,.77778],62:[.0391,.5391,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.77778],65:[0,.68333,0,0,.75],66:[0,.68333,0,0,.70834],67:[0,.68333,0,0,.72222],68:[0,.68333,0,0,.76389],69:[0,.68333,0,0,.68056],70:[0,.68333,0,0,.65278],71:[0,.68333,0,0,.78472],72:[0,.68333,0,0,.75],73:[0,.68333,0,0,.36111],74:[0,.68333,0,0,.51389],75:[0,.68333,0,0,.77778],76:[0,.68333,0,0,.625],77:[0,.68333,0,0,.91667],78:[0,.68333,0,0,.75],79:[0,.68333,0,0,.77778],80:[0,.68333,0,0,.68056],81:[.19444,.68333,0,0,.77778],82:[0,.68333,0,0,.73611],83:[0,.68333,0,0,.55556],84:[0,.68333,0,0,.72222],85:[0,.68333,0,0,.75],86:[0,.68333,.01389,0,.75],87:[0,.68333,.01389,0,1.02778],88:[0,.68333,0,0,.75],89:[0,.68333,.025,0,.75],90:[0,.68333,0,0,.61111],91:[.25,.75,0,0,.27778],92:[.25,.75,0,0,.5],93:[.25,.75,0,0,.27778],94:[0,.69444,0,0,.5],95:[.31,.12056,.02778,0,.5],97:[0,.43056,0,0,.5],98:[0,.69444,0,0,.55556],99:[0,.43056,0,0,.44445],100:[0,.69444,0,0,.55556],101:[0,.43056,0,0,.44445],102:[0,.69444,.07778,0,.30556],103:[.19444,.43056,.01389,0,.5],104:[0,.69444,0,0,.55556],105:[0,.66786,0,0,.27778],106:[.19444,.66786,0,0,.30556],107:[0,.69444,0,0,.52778],108:[0,.69444,0,0,.27778],109:[0,.43056,0,0,.83334],110:[0,.43056,0,0,.55556],111:[0,.43056,0,0,.5],112:[.19444,.43056,0,0,.55556],113:[.19444,.43056,0,0,.52778],114:[0,.43056,0,0,.39167],115:[0,.43056,0,0,.39445],116:[0,.61508,0,0,.38889],117:[0,.43056,0,0,.55556],118:[0,.43056,.01389,0,.52778],119:[0,.43056,.01389,0,.72222],120:[0,.43056,0,0,.52778],121:[.19444,.43056,.01389,0,.52778],122:[0,.43056,0,0,.44445],123:[.25,.75,0,0,.5],124:[.25,.75,0,0,.27778],125:[.25,.75,0,0,.5],126:[.35,.31786,0,0,.5],160:[0,0,0,0,.25],163:[0,.69444,0,0,.76909],167:[.19444,.69444,0,0,.44445],168:[0,.66786,0,0,.5],172:[0,.43056,0,0,.66667],176:[0,.69444,0,0,.75],177:[.08333,.58333,0,0,.77778],182:[.19444,.69444,0,0,.61111],184:[.17014,0,0,0,.44445],198:[0,.68333,0,0,.90278],215:[.08333,.58333,0,0,.77778],216:[.04861,.73194,0,0,.77778],223:[0,.69444,0,0,.5],230:[0,.43056,0,0,.72222],247:[.08333,.58333,0,0,.77778],248:[.09722,.52778,0,0,.5],305:[0,.43056,0,0,.27778],338:[0,.68333,0,0,1.01389],339:[0,.43056,0,0,.77778],567:[.19444,.43056,0,0,.30556],710:[0,.69444,0,0,.5],711:[0,.62847,0,0,.5],713:[0,.56778,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.66786,0,0,.27778],730:[0,.69444,0,0,.75],732:[0,.66786,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.68333,0,0,.625],916:[0,.68333,0,0,.83334],920:[0,.68333,0,0,.77778],923:[0,.68333,0,0,.69445],926:[0,.68333,0,0,.66667],928:[0,.68333,0,0,.75],931:[0,.68333,0,0,.72222],933:[0,.68333,0,0,.77778],934:[0,.68333,0,0,.72222],936:[0,.68333,0,0,.77778],937:[0,.68333,0,0,.72222],8211:[0,.43056,.02778,0,.5],8212:[0,.43056,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5],8224:[.19444,.69444,0,0,.44445],8225:[.19444,.69444,0,0,.44445],8230:[0,.123,0,0,1.172],8242:[0,.55556,0,0,.275],8407:[0,.71444,.15382,0,.5],8463:[0,.68889,0,0,.54028],8465:[0,.69444,0,0,.72222],8467:[0,.69444,0,.11111,.41667],8472:[.19444,.43056,0,.11111,.63646],8476:[0,.69444,0,0,.72222],8501:[0,.69444,0,0,.61111],8592:[-.13313,.36687,0,0,1],8593:[.19444,.69444,0,0,.5],8594:[-.13313,.36687,0,0,1],8595:[.19444,.69444,0,0,.5],8596:[-.13313,.36687,0,0,1],8597:[.25,.75,0,0,.5],8598:[.19444,.69444,0,0,1],8599:[.19444,.69444,0,0,1],8600:[.19444,.69444,0,0,1],8601:[.19444,.69444,0,0,1],8614:[.011,.511,0,0,1],8617:[.011,.511,0,0,1.126],8618:[.011,.511,0,0,1.126],8636:[-.13313,.36687,0,0,1],8637:[-.13313,.36687,0,0,1],8640:[-.13313,.36687,0,0,1],8641:[-.13313,.36687,0,0,1],8652:[.011,.671,0,0,1],8656:[-.13313,.36687,0,0,1],8657:[.19444,.69444,0,0,.61111],8658:[-.13313,.36687,0,0,1],8659:[.19444,.69444,0,0,.61111],8660:[-.13313,.36687,0,0,1],8661:[.25,.75,0,0,.61111],8704:[0,.69444,0,0,.55556],8706:[0,.69444,.05556,.08334,.5309],8707:[0,.69444,0,0,.55556],8709:[.05556,.75,0,0,.5],8711:[0,.68333,0,0,.83334],8712:[.0391,.5391,0,0,.66667],8715:[.0391,.5391,0,0,.66667],8722:[.08333,.58333,0,0,.77778],8723:[.08333,.58333,0,0,.77778],8725:[.25,.75,0,0,.5],8726:[.25,.75,0,0,.5],8727:[-.03472,.46528,0,0,.5],8728:[-.05555,.44445,0,0,.5],8729:[-.05555,.44445,0,0,.5],8730:[.2,.8,0,0,.83334],8733:[0,.43056,0,0,.77778],8734:[0,.43056,0,0,1],8736:[0,.69224,0,0,.72222],8739:[.25,.75,0,0,.27778],8741:[.25,.75,0,0,.5],8743:[0,.55556,0,0,.66667],8744:[0,.55556,0,0,.66667],8745:[0,.55556,0,0,.66667],8746:[0,.55556,0,0,.66667],8747:[.19444,.69444,.11111,0,.41667],8764:[-.13313,.36687,0,0,.77778],8768:[.19444,.69444,0,0,.27778],8771:[-.03625,.46375,0,0,.77778],8773:[-.022,.589,0,0,.778],8776:[-.01688,.48312,0,0,.77778],8781:[-.03625,.46375,0,0,.77778],8784:[-.133,.673,0,0,.778],8801:[-.03625,.46375,0,0,.77778],8804:[.13597,.63597,0,0,.77778],8805:[.13597,.63597,0,0,.77778],8810:[.0391,.5391,0,0,1],8811:[.0391,.5391,0,0,1],8826:[.0391,.5391,0,0,.77778],8827:[.0391,.5391,0,0,.77778],8834:[.0391,.5391,0,0,.77778],8835:[.0391,.5391,0,0,.77778],8838:[.13597,.63597,0,0,.77778],8839:[.13597,.63597,0,0,.77778],8846:[0,.55556,0,0,.66667],8849:[.13597,.63597,0,0,.77778],8850:[.13597,.63597,0,0,.77778],8851:[0,.55556,0,0,.66667],8852:[0,.55556,0,0,.66667],8853:[.08333,.58333,0,0,.77778],8854:[.08333,.58333,0,0,.77778],8855:[.08333,.58333,0,0,.77778],8856:[.08333,.58333,0,0,.77778],8857:[.08333,.58333,0,0,.77778],8866:[0,.69444,0,0,.61111],8867:[0,.69444,0,0,.61111],8868:[0,.69444,0,0,.77778],8869:[0,.69444,0,0,.77778],8872:[.249,.75,0,0,.867],8900:[-.05555,.44445,0,0,.5],8901:[-.05555,.44445,0,0,.27778],8902:[-.03472,.46528,0,0,.5],8904:[.005,.505,0,0,.9],8942:[.03,.903,0,0,.278],8943:[-.19,.313,0,0,1.172],8945:[-.1,.823,0,0,1.282],8968:[.25,.75,0,0,.44445],8969:[.25,.75,0,0,.44445],8970:[.25,.75,0,0,.44445],8971:[.25,.75,0,0,.44445],8994:[-.14236,.35764,0,0,1],8995:[-.14236,.35764,0,0,1],9136:[.244,.744,0,0,.412],9137:[.244,.745,0,0,.412],9651:[.19444,.69444,0,0,.88889],9657:[-.03472,.46528,0,0,.5],9661:[.19444,.69444,0,0,.88889],9667:[-.03472,.46528,0,0,.5],9711:[.19444,.69444,0,0,1],9824:[.12963,.69444,0,0,.77778],9825:[.12963,.69444,0,0,.77778],9826:[.12963,.69444,0,0,.77778],9827:[.12963,.69444,0,0,.77778],9837:[0,.75,0,0,.38889],9838:[.19444,.69444,0,0,.38889],9839:[.19444,.69444,0,0,.38889],10216:[.25,.75,0,0,.38889],10217:[.25,.75,0,0,.38889],10222:[.244,.744,0,0,.412],10223:[.244,.745,0,0,.412],10229:[.011,.511,0,0,1.609],10230:[.011,.511,0,0,1.638],10231:[.011,.511,0,0,1.859],10232:[.024,.525,0,0,1.609],10233:[.024,.525,0,0,1.638],10234:[.024,.525,0,0,1.858],10236:[.011,.511,0,0,1.638],10815:[0,.68333,0,0,.75],10927:[.13597,.63597,0,0,.77778],10928:[.13597,.63597,0,0,.77778],57376:[.19444,.69444,0,0,0]},"Math-BoldItalic":{32:[0,0,0,0,.25],48:[0,.44444,0,0,.575],49:[0,.44444,0,0,.575],50:[0,.44444,0,0,.575],51:[.19444,.44444,0,0,.575],52:[.19444,.44444,0,0,.575],53:[.19444,.44444,0,0,.575],54:[0,.64444,0,0,.575],55:[.19444,.44444,0,0,.575],56:[0,.64444,0,0,.575],57:[.19444,.44444,0,0,.575],65:[0,.68611,0,0,.86944],66:[0,.68611,.04835,0,.8664],67:[0,.68611,.06979,0,.81694],68:[0,.68611,.03194,0,.93812],69:[0,.68611,.05451,0,.81007],70:[0,.68611,.15972,0,.68889],71:[0,.68611,0,0,.88673],72:[0,.68611,.08229,0,.98229],73:[0,.68611,.07778,0,.51111],74:[0,.68611,.10069,0,.63125],75:[0,.68611,.06979,0,.97118],76:[0,.68611,0,0,.75555],77:[0,.68611,.11424,0,1.14201],78:[0,.68611,.11424,0,.95034],79:[0,.68611,.03194,0,.83666],80:[0,.68611,.15972,0,.72309],81:[.19444,.68611,0,0,.86861],82:[0,.68611,.00421,0,.87235],83:[0,.68611,.05382,0,.69271],84:[0,.68611,.15972,0,.63663],85:[0,.68611,.11424,0,.80027],86:[0,.68611,.25555,0,.67778],87:[0,.68611,.15972,0,1.09305],88:[0,.68611,.07778,0,.94722],89:[0,.68611,.25555,0,.67458],90:[0,.68611,.06979,0,.77257],97:[0,.44444,0,0,.63287],98:[0,.69444,0,0,.52083],99:[0,.44444,0,0,.51342],100:[0,.69444,0,0,.60972],101:[0,.44444,0,0,.55361],102:[.19444,.69444,.11042,0,.56806],103:[.19444,.44444,.03704,0,.5449],104:[0,.69444,0,0,.66759],105:[0,.69326,0,0,.4048],106:[.19444,.69326,.0622,0,.47083],107:[0,.69444,.01852,0,.6037],108:[0,.69444,.0088,0,.34815],109:[0,.44444,0,0,1.0324],110:[0,.44444,0,0,.71296],111:[0,.44444,0,0,.58472],112:[.19444,.44444,0,0,.60092],113:[.19444,.44444,.03704,0,.54213],114:[0,.44444,.03194,0,.5287],115:[0,.44444,0,0,.53125],116:[0,.63492,0,0,.41528],117:[0,.44444,0,0,.68102],118:[0,.44444,.03704,0,.56666],119:[0,.44444,.02778,0,.83148],120:[0,.44444,0,0,.65903],121:[.19444,.44444,.03704,0,.59028],122:[0,.44444,.04213,0,.55509],160:[0,0,0,0,.25],915:[0,.68611,.15972,0,.65694],916:[0,.68611,0,0,.95833],920:[0,.68611,.03194,0,.86722],923:[0,.68611,0,0,.80555],926:[0,.68611,.07458,0,.84125],928:[0,.68611,.08229,0,.98229],931:[0,.68611,.05451,0,.88507],933:[0,.68611,.15972,0,.67083],934:[0,.68611,0,0,.76666],936:[0,.68611,.11653,0,.71402],937:[0,.68611,.04835,0,.8789],945:[0,.44444,0,0,.76064],946:[.19444,.69444,.03403,0,.65972],947:[.19444,.44444,.06389,0,.59003],948:[0,.69444,.03819,0,.52222],949:[0,.44444,0,0,.52882],950:[.19444,.69444,.06215,0,.50833],951:[.19444,.44444,.03704,0,.6],952:[0,.69444,.03194,0,.5618],953:[0,.44444,0,0,.41204],954:[0,.44444,0,0,.66759],955:[0,.69444,0,0,.67083],956:[.19444,.44444,0,0,.70787],957:[0,.44444,.06898,0,.57685],958:[.19444,.69444,.03021,0,.50833],959:[0,.44444,0,0,.58472],960:[0,.44444,.03704,0,.68241],961:[.19444,.44444,0,0,.6118],962:[.09722,.44444,.07917,0,.42361],963:[0,.44444,.03704,0,.68588],964:[0,.44444,.13472,0,.52083],965:[0,.44444,.03704,0,.63055],966:[.19444,.44444,0,0,.74722],967:[.19444,.44444,0,0,.71805],968:[.19444,.69444,.03704,0,.75833],969:[0,.44444,.03704,0,.71782],977:[0,.69444,0,0,.69155],981:[.19444,.69444,0,0,.7125],982:[0,.44444,.03194,0,.975],1009:[.19444,.44444,0,0,.6118],1013:[0,.44444,0,0,.48333],57649:[0,.44444,0,0,.39352],57911:[.19444,.44444,0,0,.43889]},"Math-Italic":{32:[0,0,0,0,.25],48:[0,.43056,0,0,.5],49:[0,.43056,0,0,.5],50:[0,.43056,0,0,.5],51:[.19444,.43056,0,0,.5],52:[.19444,.43056,0,0,.5],53:[.19444,.43056,0,0,.5],54:[0,.64444,0,0,.5],55:[.19444,.43056,0,0,.5],56:[0,.64444,0,0,.5],57:[.19444,.43056,0,0,.5],65:[0,.68333,0,.13889,.75],66:[0,.68333,.05017,.08334,.75851],67:[0,.68333,.07153,.08334,.71472],68:[0,.68333,.02778,.05556,.82792],69:[0,.68333,.05764,.08334,.7382],70:[0,.68333,.13889,.08334,.64306],71:[0,.68333,0,.08334,.78625],72:[0,.68333,.08125,.05556,.83125],73:[0,.68333,.07847,.11111,.43958],74:[0,.68333,.09618,.16667,.55451],75:[0,.68333,.07153,.05556,.84931],76:[0,.68333,0,.02778,.68056],77:[0,.68333,.10903,.08334,.97014],78:[0,.68333,.10903,.08334,.80347],79:[0,.68333,.02778,.08334,.76278],80:[0,.68333,.13889,.08334,.64201],81:[.19444,.68333,0,.08334,.79056],82:[0,.68333,.00773,.08334,.75929],83:[0,.68333,.05764,.08334,.6132],84:[0,.68333,.13889,.08334,.58438],85:[0,.68333,.10903,.02778,.68278],86:[0,.68333,.22222,0,.58333],87:[0,.68333,.13889,0,.94445],88:[0,.68333,.07847,.08334,.82847],89:[0,.68333,.22222,0,.58056],90:[0,.68333,.07153,.08334,.68264],97:[0,.43056,0,0,.52859],98:[0,.69444,0,0,.42917],99:[0,.43056,0,.05556,.43276],100:[0,.69444,0,.16667,.52049],101:[0,.43056,0,.05556,.46563],102:[.19444,.69444,.10764,.16667,.48959],103:[.19444,.43056,.03588,.02778,.47697],104:[0,.69444,0,0,.57616],105:[0,.65952,0,0,.34451],106:[.19444,.65952,.05724,0,.41181],107:[0,.69444,.03148,0,.5206],108:[0,.69444,.01968,.08334,.29838],109:[0,.43056,0,0,.87801],110:[0,.43056,0,0,.60023],111:[0,.43056,0,.05556,.48472],112:[.19444,.43056,0,.08334,.50313],113:[.19444,.43056,.03588,.08334,.44641],114:[0,.43056,.02778,.05556,.45116],115:[0,.43056,0,.05556,.46875],116:[0,.61508,0,.08334,.36111],117:[0,.43056,0,.02778,.57246],118:[0,.43056,.03588,.02778,.48472],119:[0,.43056,.02691,.08334,.71592],120:[0,.43056,0,.02778,.57153],121:[.19444,.43056,.03588,.05556,.49028],122:[0,.43056,.04398,.05556,.46505],160:[0,0,0,0,.25],915:[0,.68333,.13889,.08334,.61528],916:[0,.68333,0,.16667,.83334],920:[0,.68333,.02778,.08334,.76278],923:[0,.68333,0,.16667,.69445],926:[0,.68333,.07569,.08334,.74236],928:[0,.68333,.08125,.05556,.83125],931:[0,.68333,.05764,.08334,.77986],933:[0,.68333,.13889,.05556,.58333],934:[0,.68333,0,.08334,.66667],936:[0,.68333,.11,.05556,.61222],937:[0,.68333,.05017,.08334,.7724],945:[0,.43056,.0037,.02778,.6397],946:[.19444,.69444,.05278,.08334,.56563],947:[.19444,.43056,.05556,0,.51773],948:[0,.69444,.03785,.05556,.44444],949:[0,.43056,0,.08334,.46632],950:[.19444,.69444,.07378,.08334,.4375],951:[.19444,.43056,.03588,.05556,.49653],952:[0,.69444,.02778,.08334,.46944],953:[0,.43056,0,.05556,.35394],954:[0,.43056,0,0,.57616],955:[0,.69444,0,0,.58334],956:[.19444,.43056,0,.02778,.60255],957:[0,.43056,.06366,.02778,.49398],958:[.19444,.69444,.04601,.11111,.4375],959:[0,.43056,0,.05556,.48472],960:[0,.43056,.03588,0,.57003],961:[.19444,.43056,0,.08334,.51702],962:[.09722,.43056,.07986,.08334,.36285],963:[0,.43056,.03588,0,.57141],964:[0,.43056,.1132,.02778,.43715],965:[0,.43056,.03588,.02778,.54028],966:[.19444,.43056,0,.08334,.65417],967:[.19444,.43056,0,.05556,.62569],968:[.19444,.69444,.03588,.11111,.65139],969:[0,.43056,.03588,0,.62245],977:[0,.69444,0,.08334,.59144],981:[.19444,.69444,0,.08334,.59583],982:[0,.43056,.02778,0,.82813],1009:[.19444,.43056,0,.08334,.51702],1013:[0,.43056,0,.05556,.4059],57649:[0,.43056,0,.02778,.32246],57911:[.19444,.43056,0,.08334,.38403]},"SansSerif-Bold":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.36667],34:[0,.69444,0,0,.55834],35:[.19444,.69444,0,0,.91667],36:[.05556,.75,0,0,.55],37:[.05556,.75,0,0,1.02912],38:[0,.69444,0,0,.83056],39:[0,.69444,0,0,.30556],40:[.25,.75,0,0,.42778],41:[.25,.75,0,0,.42778],42:[0,.75,0,0,.55],43:[.11667,.61667,0,0,.85556],44:[.10556,.13056,0,0,.30556],45:[0,.45833,0,0,.36667],46:[0,.13056,0,0,.30556],47:[.25,.75,0,0,.55],48:[0,.69444,0,0,.55],49:[0,.69444,0,0,.55],50:[0,.69444,0,0,.55],51:[0,.69444,0,0,.55],52:[0,.69444,0,0,.55],53:[0,.69444,0,0,.55],54:[0,.69444,0,0,.55],55:[0,.69444,0,0,.55],56:[0,.69444,0,0,.55],57:[0,.69444,0,0,.55],58:[0,.45833,0,0,.30556],59:[.10556,.45833,0,0,.30556],61:[-.09375,.40625,0,0,.85556],63:[0,.69444,0,0,.51945],64:[0,.69444,0,0,.73334],65:[0,.69444,0,0,.73334],66:[0,.69444,0,0,.73334],67:[0,.69444,0,0,.70278],68:[0,.69444,0,0,.79445],69:[0,.69444,0,0,.64167],70:[0,.69444,0,0,.61111],71:[0,.69444,0,0,.73334],72:[0,.69444,0,0,.79445],73:[0,.69444,0,0,.33056],74:[0,.69444,0,0,.51945],75:[0,.69444,0,0,.76389],76:[0,.69444,0,0,.58056],77:[0,.69444,0,0,.97778],78:[0,.69444,0,0,.79445],79:[0,.69444,0,0,.79445],80:[0,.69444,0,0,.70278],81:[.10556,.69444,0,0,.79445],82:[0,.69444,0,0,.70278],83:[0,.69444,0,0,.61111],84:[0,.69444,0,0,.73334],85:[0,.69444,0,0,.76389],86:[0,.69444,.01528,0,.73334],87:[0,.69444,.01528,0,1.03889],88:[0,.69444,0,0,.73334],89:[0,.69444,.0275,0,.73334],90:[0,.69444,0,0,.67223],91:[.25,.75,0,0,.34306],93:[.25,.75,0,0,.34306],94:[0,.69444,0,0,.55],95:[.35,.10833,.03056,0,.55],97:[0,.45833,0,0,.525],98:[0,.69444,0,0,.56111],99:[0,.45833,0,0,.48889],100:[0,.69444,0,0,.56111],101:[0,.45833,0,0,.51111],102:[0,.69444,.07639,0,.33611],103:[.19444,.45833,.01528,0,.55],104:[0,.69444,0,0,.56111],105:[0,.69444,0,0,.25556],106:[.19444,.69444,0,0,.28611],107:[0,.69444,0,0,.53056],108:[0,.69444,0,0,.25556],109:[0,.45833,0,0,.86667],110:[0,.45833,0,0,.56111],111:[0,.45833,0,0,.55],112:[.19444,.45833,0,0,.56111],113:[.19444,.45833,0,0,.56111],114:[0,.45833,.01528,0,.37222],115:[0,.45833,0,0,.42167],116:[0,.58929,0,0,.40417],117:[0,.45833,0,0,.56111],118:[0,.45833,.01528,0,.5],119:[0,.45833,.01528,0,.74445],120:[0,.45833,0,0,.5],121:[.19444,.45833,.01528,0,.5],122:[0,.45833,0,0,.47639],126:[.35,.34444,0,0,.55],160:[0,0,0,0,.25],168:[0,.69444,0,0,.55],176:[0,.69444,0,0,.73334],180:[0,.69444,0,0,.55],184:[.17014,0,0,0,.48889],305:[0,.45833,0,0,.25556],567:[.19444,.45833,0,0,.28611],710:[0,.69444,0,0,.55],711:[0,.63542,0,0,.55],713:[0,.63778,0,0,.55],728:[0,.69444,0,0,.55],729:[0,.69444,0,0,.30556],730:[0,.69444,0,0,.73334],732:[0,.69444,0,0,.55],733:[0,.69444,0,0,.55],915:[0,.69444,0,0,.58056],916:[0,.69444,0,0,.91667],920:[0,.69444,0,0,.85556],923:[0,.69444,0,0,.67223],926:[0,.69444,0,0,.73334],928:[0,.69444,0,0,.79445],931:[0,.69444,0,0,.79445],933:[0,.69444,0,0,.85556],934:[0,.69444,0,0,.79445],936:[0,.69444,0,0,.85556],937:[0,.69444,0,0,.79445],8211:[0,.45833,.03056,0,.55],8212:[0,.45833,.03056,0,1.10001],8216:[0,.69444,0,0,.30556],8217:[0,.69444,0,0,.30556],8220:[0,.69444,0,0,.55834],8221:[0,.69444,0,0,.55834]},"SansSerif-Italic":{32:[0,0,0,0,.25],33:[0,.69444,.05733,0,.31945],34:[0,.69444,.00316,0,.5],35:[.19444,.69444,.05087,0,.83334],36:[.05556,.75,.11156,0,.5],37:[.05556,.75,.03126,0,.83334],38:[0,.69444,.03058,0,.75834],39:[0,.69444,.07816,0,.27778],40:[.25,.75,.13164,0,.38889],41:[.25,.75,.02536,0,.38889],42:[0,.75,.11775,0,.5],43:[.08333,.58333,.02536,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,.01946,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,.13164,0,.5],48:[0,.65556,.11156,0,.5],49:[0,.65556,.11156,0,.5],50:[0,.65556,.11156,0,.5],51:[0,.65556,.11156,0,.5],52:[0,.65556,.11156,0,.5],53:[0,.65556,.11156,0,.5],54:[0,.65556,.11156,0,.5],55:[0,.65556,.11156,0,.5],56:[0,.65556,.11156,0,.5],57:[0,.65556,.11156,0,.5],58:[0,.44444,.02502,0,.27778],59:[.125,.44444,.02502,0,.27778],61:[-.13,.37,.05087,0,.77778],63:[0,.69444,.11809,0,.47222],64:[0,.69444,.07555,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,.08293,0,.66667],67:[0,.69444,.11983,0,.63889],68:[0,.69444,.07555,0,.72223],69:[0,.69444,.11983,0,.59722],70:[0,.69444,.13372,0,.56945],71:[0,.69444,.11983,0,.66667],72:[0,.69444,.08094,0,.70834],73:[0,.69444,.13372,0,.27778],74:[0,.69444,.08094,0,.47222],75:[0,.69444,.11983,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,.08094,0,.875],78:[0,.69444,.08094,0,.70834],79:[0,.69444,.07555,0,.73611],80:[0,.69444,.08293,0,.63889],81:[.125,.69444,.07555,0,.73611],82:[0,.69444,.08293,0,.64584],83:[0,.69444,.09205,0,.55556],84:[0,.69444,.13372,0,.68056],85:[0,.69444,.08094,0,.6875],86:[0,.69444,.1615,0,.66667],87:[0,.69444,.1615,0,.94445],88:[0,.69444,.13372,0,.66667],89:[0,.69444,.17261,0,.66667],90:[0,.69444,.11983,0,.61111],91:[.25,.75,.15942,0,.28889],93:[.25,.75,.08719,0,.28889],94:[0,.69444,.0799,0,.5],95:[.35,.09444,.08616,0,.5],97:[0,.44444,.00981,0,.48056],98:[0,.69444,.03057,0,.51667],99:[0,.44444,.08336,0,.44445],100:[0,.69444,.09483,0,.51667],101:[0,.44444,.06778,0,.44445],102:[0,.69444,.21705,0,.30556],103:[.19444,.44444,.10836,0,.5],104:[0,.69444,.01778,0,.51667],105:[0,.67937,.09718,0,.23889],106:[.19444,.67937,.09162,0,.26667],107:[0,.69444,.08336,0,.48889],108:[0,.69444,.09483,0,.23889],109:[0,.44444,.01778,0,.79445],110:[0,.44444,.01778,0,.51667],111:[0,.44444,.06613,0,.5],112:[.19444,.44444,.0389,0,.51667],113:[.19444,.44444,.04169,0,.51667],114:[0,.44444,.10836,0,.34167],115:[0,.44444,.0778,0,.38333],116:[0,.57143,.07225,0,.36111],117:[0,.44444,.04169,0,.51667],118:[0,.44444,.10836,0,.46111],119:[0,.44444,.10836,0,.68334],120:[0,.44444,.09169,0,.46111],121:[.19444,.44444,.10836,0,.46111],122:[0,.44444,.08752,0,.43472],126:[.35,.32659,.08826,0,.5],160:[0,0,0,0,.25],168:[0,.67937,.06385,0,.5],176:[0,.69444,0,0,.73752],184:[.17014,0,0,0,.44445],305:[0,.44444,.04169,0,.23889],567:[.19444,.44444,.04169,0,.26667],710:[0,.69444,.0799,0,.5],711:[0,.63194,.08432,0,.5],713:[0,.60889,.08776,0,.5],714:[0,.69444,.09205,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,.09483,0,.5],729:[0,.67937,.07774,0,.27778],730:[0,.69444,0,0,.73752],732:[0,.67659,.08826,0,.5],733:[0,.69444,.09205,0,.5],915:[0,.69444,.13372,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,.07555,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,.12816,0,.66667],928:[0,.69444,.08094,0,.70834],931:[0,.69444,.11983,0,.72222],933:[0,.69444,.09031,0,.77778],934:[0,.69444,.04603,0,.72222],936:[0,.69444,.09031,0,.77778],937:[0,.69444,.08293,0,.72222],8211:[0,.44444,.08616,0,.5],8212:[0,.44444,.08616,0,1],8216:[0,.69444,.07816,0,.27778],8217:[0,.69444,.07816,0,.27778],8220:[0,.69444,.14205,0,.5],8221:[0,.69444,.00316,0,.5]},"SansSerif-Regular":{32:[0,0,0,0,.25],33:[0,.69444,0,0,.31945],34:[0,.69444,0,0,.5],35:[.19444,.69444,0,0,.83334],36:[.05556,.75,0,0,.5],37:[.05556,.75,0,0,.83334],38:[0,.69444,0,0,.75834],39:[0,.69444,0,0,.27778],40:[.25,.75,0,0,.38889],41:[.25,.75,0,0,.38889],42:[0,.75,0,0,.5],43:[.08333,.58333,0,0,.77778],44:[.125,.08333,0,0,.27778],45:[0,.44444,0,0,.33333],46:[0,.08333,0,0,.27778],47:[.25,.75,0,0,.5],48:[0,.65556,0,0,.5],49:[0,.65556,0,0,.5],50:[0,.65556,0,0,.5],51:[0,.65556,0,0,.5],52:[0,.65556,0,0,.5],53:[0,.65556,0,0,.5],54:[0,.65556,0,0,.5],55:[0,.65556,0,0,.5],56:[0,.65556,0,0,.5],57:[0,.65556,0,0,.5],58:[0,.44444,0,0,.27778],59:[.125,.44444,0,0,.27778],61:[-.13,.37,0,0,.77778],63:[0,.69444,0,0,.47222],64:[0,.69444,0,0,.66667],65:[0,.69444,0,0,.66667],66:[0,.69444,0,0,.66667],67:[0,.69444,0,0,.63889],68:[0,.69444,0,0,.72223],69:[0,.69444,0,0,.59722],70:[0,.69444,0,0,.56945],71:[0,.69444,0,0,.66667],72:[0,.69444,0,0,.70834],73:[0,.69444,0,0,.27778],74:[0,.69444,0,0,.47222],75:[0,.69444,0,0,.69445],76:[0,.69444,0,0,.54167],77:[0,.69444,0,0,.875],78:[0,.69444,0,0,.70834],79:[0,.69444,0,0,.73611],80:[0,.69444,0,0,.63889],81:[.125,.69444,0,0,.73611],82:[0,.69444,0,0,.64584],83:[0,.69444,0,0,.55556],84:[0,.69444,0,0,.68056],85:[0,.69444,0,0,.6875],86:[0,.69444,.01389,0,.66667],87:[0,.69444,.01389,0,.94445],88:[0,.69444,0,0,.66667],89:[0,.69444,.025,0,.66667],90:[0,.69444,0,0,.61111],91:[.25,.75,0,0,.28889],93:[.25,.75,0,0,.28889],94:[0,.69444,0,0,.5],95:[.35,.09444,.02778,0,.5],97:[0,.44444,0,0,.48056],98:[0,.69444,0,0,.51667],99:[0,.44444,0,0,.44445],100:[0,.69444,0,0,.51667],101:[0,.44444,0,0,.44445],102:[0,.69444,.06944,0,.30556],103:[.19444,.44444,.01389,0,.5],104:[0,.69444,0,0,.51667],105:[0,.67937,0,0,.23889],106:[.19444,.67937,0,0,.26667],107:[0,.69444,0,0,.48889],108:[0,.69444,0,0,.23889],109:[0,.44444,0,0,.79445],110:[0,.44444,0,0,.51667],111:[0,.44444,0,0,.5],112:[.19444,.44444,0,0,.51667],113:[.19444,.44444,0,0,.51667],114:[0,.44444,.01389,0,.34167],115:[0,.44444,0,0,.38333],116:[0,.57143,0,0,.36111],117:[0,.44444,0,0,.51667],118:[0,.44444,.01389,0,.46111],119:[0,.44444,.01389,0,.68334],120:[0,.44444,0,0,.46111],121:[.19444,.44444,.01389,0,.46111],122:[0,.44444,0,0,.43472],126:[.35,.32659,0,0,.5],160:[0,0,0,0,.25],168:[0,.67937,0,0,.5],176:[0,.69444,0,0,.66667],184:[.17014,0,0,0,.44445],305:[0,.44444,0,0,.23889],567:[.19444,.44444,0,0,.26667],710:[0,.69444,0,0,.5],711:[0,.63194,0,0,.5],713:[0,.60889,0,0,.5],714:[0,.69444,0,0,.5],715:[0,.69444,0,0,.5],728:[0,.69444,0,0,.5],729:[0,.67937,0,0,.27778],730:[0,.69444,0,0,.66667],732:[0,.67659,0,0,.5],733:[0,.69444,0,0,.5],915:[0,.69444,0,0,.54167],916:[0,.69444,0,0,.83334],920:[0,.69444,0,0,.77778],923:[0,.69444,0,0,.61111],926:[0,.69444,0,0,.66667],928:[0,.69444,0,0,.70834],931:[0,.69444,0,0,.72222],933:[0,.69444,0,0,.77778],934:[0,.69444,0,0,.72222],936:[0,.69444,0,0,.77778],937:[0,.69444,0,0,.72222],8211:[0,.44444,.02778,0,.5],8212:[0,.44444,.02778,0,1],8216:[0,.69444,0,0,.27778],8217:[0,.69444,0,0,.27778],8220:[0,.69444,0,0,.5],8221:[0,.69444,0,0,.5]},"Script-Regular":{32:[0,0,0,0,.25],65:[0,.7,.22925,0,.80253],66:[0,.7,.04087,0,.90757],67:[0,.7,.1689,0,.66619],68:[0,.7,.09371,0,.77443],69:[0,.7,.18583,0,.56162],70:[0,.7,.13634,0,.89544],71:[0,.7,.17322,0,.60961],72:[0,.7,.29694,0,.96919],73:[0,.7,.19189,0,.80907],74:[.27778,.7,.19189,0,1.05159],75:[0,.7,.31259,0,.91364],76:[0,.7,.19189,0,.87373],77:[0,.7,.15981,0,1.08031],78:[0,.7,.3525,0,.9015],79:[0,.7,.08078,0,.73787],80:[0,.7,.08078,0,1.01262],81:[0,.7,.03305,0,.88282],82:[0,.7,.06259,0,.85],83:[0,.7,.19189,0,.86767],84:[0,.7,.29087,0,.74697],85:[0,.7,.25815,0,.79996],86:[0,.7,.27523,0,.62204],87:[0,.7,.27523,0,.80532],88:[0,.7,.26006,0,.94445],89:[0,.7,.2939,0,.70961],90:[0,.7,.24037,0,.8212],160:[0,0,0,0,.25]},"Size1-Regular":{32:[0,0,0,0,.25],40:[.35001,.85,0,0,.45834],41:[.35001,.85,0,0,.45834],47:[.35001,.85,0,0,.57778],91:[.35001,.85,0,0,.41667],92:[.35001,.85,0,0,.57778],93:[.35001,.85,0,0,.41667],123:[.35001,.85,0,0,.58334],125:[.35001,.85,0,0,.58334],160:[0,0,0,0,.25],710:[0,.72222,0,0,.55556],732:[0,.72222,0,0,.55556],770:[0,.72222,0,0,.55556],771:[0,.72222,0,0,.55556],8214:[-99e-5,.601,0,0,.77778],8593:[1e-5,.6,0,0,.66667],8595:[1e-5,.6,0,0,.66667],8657:[1e-5,.6,0,0,.77778],8659:[1e-5,.6,0,0,.77778],8719:[.25001,.75,0,0,.94445],8720:[.25001,.75,0,0,.94445],8721:[.25001,.75,0,0,1.05556],8730:[.35001,.85,0,0,1],8739:[-.00599,.606,0,0,.33333],8741:[-.00599,.606,0,0,.55556],8747:[.30612,.805,.19445,0,.47222],8748:[.306,.805,.19445,0,.47222],8749:[.306,.805,.19445,0,.47222],8750:[.30612,.805,.19445,0,.47222],8896:[.25001,.75,0,0,.83334],8897:[.25001,.75,0,0,.83334],8898:[.25001,.75,0,0,.83334],8899:[.25001,.75,0,0,.83334],8968:[.35001,.85,0,0,.47222],8969:[.35001,.85,0,0,.47222],8970:[.35001,.85,0,0,.47222],8971:[.35001,.85,0,0,.47222],9168:[-99e-5,.601,0,0,.66667],10216:[.35001,.85,0,0,.47222],10217:[.35001,.85,0,0,.47222],10752:[.25001,.75,0,0,1.11111],10753:[.25001,.75,0,0,1.11111],10754:[.25001,.75,0,0,1.11111],10756:[.25001,.75,0,0,.83334],10758:[.25001,.75,0,0,.83334]},"Size2-Regular":{32:[0,0,0,0,.25],40:[.65002,1.15,0,0,.59722],41:[.65002,1.15,0,0,.59722],47:[.65002,1.15,0,0,.81111],91:[.65002,1.15,0,0,.47222],92:[.65002,1.15,0,0,.81111],93:[.65002,1.15,0,0,.47222],123:[.65002,1.15,0,0,.66667],125:[.65002,1.15,0,0,.66667],160:[0,0,0,0,.25],710:[0,.75,0,0,1],732:[0,.75,0,0,1],770:[0,.75,0,0,1],771:[0,.75,0,0,1],8719:[.55001,1.05,0,0,1.27778],8720:[.55001,1.05,0,0,1.27778],8721:[.55001,1.05,0,0,1.44445],8730:[.65002,1.15,0,0,1],8747:[.86225,1.36,.44445,0,.55556],8748:[.862,1.36,.44445,0,.55556],8749:[.862,1.36,.44445,0,.55556],8750:[.86225,1.36,.44445,0,.55556],8896:[.55001,1.05,0,0,1.11111],8897:[.55001,1.05,0,0,1.11111],8898:[.55001,1.05,0,0,1.11111],8899:[.55001,1.05,0,0,1.11111],8968:[.65002,1.15,0,0,.52778],8969:[.65002,1.15,0,0,.52778],8970:[.65002,1.15,0,0,.52778],8971:[.65002,1.15,0,0,.52778],10216:[.65002,1.15,0,0,.61111],10217:[.65002,1.15,0,0,.61111],10752:[.55001,1.05,0,0,1.51112],10753:[.55001,1.05,0,0,1.51112],10754:[.55001,1.05,0,0,1.51112],10756:[.55001,1.05,0,0,1.11111],10758:[.55001,1.05,0,0,1.11111]},"Size3-Regular":{32:[0,0,0,0,.25],40:[.95003,1.45,0,0,.73611],41:[.95003,1.45,0,0,.73611],47:[.95003,1.45,0,0,1.04445],91:[.95003,1.45,0,0,.52778],92:[.95003,1.45,0,0,1.04445],93:[.95003,1.45,0,0,.52778],123:[.95003,1.45,0,0,.75],125:[.95003,1.45,0,0,.75],160:[0,0,0,0,.25],710:[0,.75,0,0,1.44445],732:[0,.75,0,0,1.44445],770:[0,.75,0,0,1.44445],771:[0,.75,0,0,1.44445],8730:[.95003,1.45,0,0,1],8968:[.95003,1.45,0,0,.58334],8969:[.95003,1.45,0,0,.58334],8970:[.95003,1.45,0,0,.58334],8971:[.95003,1.45,0,0,.58334],10216:[.95003,1.45,0,0,.75],10217:[.95003,1.45,0,0,.75]},"Size4-Regular":{32:[0,0,0,0,.25],40:[1.25003,1.75,0,0,.79167],41:[1.25003,1.75,0,0,.79167],47:[1.25003,1.75,0,0,1.27778],91:[1.25003,1.75,0,0,.58334],92:[1.25003,1.75,0,0,1.27778],93:[1.25003,1.75,0,0,.58334],123:[1.25003,1.75,0,0,.80556],125:[1.25003,1.75,0,0,.80556],160:[0,0,0,0,.25],710:[0,.825,0,0,1.8889],732:[0,.825,0,0,1.8889],770:[0,.825,0,0,1.8889],771:[0,.825,0,0,1.8889],8730:[1.25003,1.75,0,0,1],8968:[1.25003,1.75,0,0,.63889],8969:[1.25003,1.75,0,0,.63889],8970:[1.25003,1.75,0,0,.63889],8971:[1.25003,1.75,0,0,.63889],9115:[.64502,1.155,0,0,.875],9116:[1e-5,.6,0,0,.875],9117:[.64502,1.155,0,0,.875],9118:[.64502,1.155,0,0,.875],9119:[1e-5,.6,0,0,.875],9120:[.64502,1.155,0,0,.875],9121:[.64502,1.155,0,0,.66667],9122:[-99e-5,.601,0,0,.66667],9123:[.64502,1.155,0,0,.66667],9124:[.64502,1.155,0,0,.66667],9125:[-99e-5,.601,0,0,.66667],9126:[.64502,1.155,0,0,.66667],9127:[1e-5,.9,0,0,.88889],9128:[.65002,1.15,0,0,.88889],9129:[.90001,0,0,0,.88889],9130:[0,.3,0,0,.88889],9131:[1e-5,.9,0,0,.88889],9132:[.65002,1.15,0,0,.88889],9133:[.90001,0,0,0,.88889],9143:[.88502,.915,0,0,1.05556],10216:[1.25003,1.75,0,0,.80556],10217:[1.25003,1.75,0,0,.80556],57344:[-.00499,.605,0,0,1.05556],57345:[-.00499,.605,0,0,1.05556],57680:[0,.12,0,0,.45],57681:[0,.12,0,0,.45],57682:[0,.12,0,0,.45],57683:[0,.12,0,0,.45]},"Typewriter-Regular":{32:[0,0,0,0,.525],33:[0,.61111,0,0,.525],34:[0,.61111,0,0,.525],35:[0,.61111,0,0,.525],36:[.08333,.69444,0,0,.525],37:[.08333,.69444,0,0,.525],38:[0,.61111,0,0,.525],39:[0,.61111,0,0,.525],40:[.08333,.69444,0,0,.525],41:[.08333,.69444,0,0,.525],42:[0,.52083,0,0,.525],43:[-.08056,.53055,0,0,.525],44:[.13889,.125,0,0,.525],45:[-.08056,.53055,0,0,.525],46:[0,.125,0,0,.525],47:[.08333,.69444,0,0,.525],48:[0,.61111,0,0,.525],49:[0,.61111,0,0,.525],50:[0,.61111,0,0,.525],51:[0,.61111,0,0,.525],52:[0,.61111,0,0,.525],53:[0,.61111,0,0,.525],54:[0,.61111,0,0,.525],55:[0,.61111,0,0,.525],56:[0,.61111,0,0,.525],57:[0,.61111,0,0,.525],58:[0,.43056,0,0,.525],59:[.13889,.43056,0,0,.525],60:[-.05556,.55556,0,0,.525],61:[-.19549,.41562,0,0,.525],62:[-.05556,.55556,0,0,.525],63:[0,.61111,0,0,.525],64:[0,.61111,0,0,.525],65:[0,.61111,0,0,.525],66:[0,.61111,0,0,.525],67:[0,.61111,0,0,.525],68:[0,.61111,0,0,.525],69:[0,.61111,0,0,.525],70:[0,.61111,0,0,.525],71:[0,.61111,0,0,.525],72:[0,.61111,0,0,.525],73:[0,.61111,0,0,.525],74:[0,.61111,0,0,.525],75:[0,.61111,0,0,.525],76:[0,.61111,0,0,.525],77:[0,.61111,0,0,.525],78:[0,.61111,0,0,.525],79:[0,.61111,0,0,.525],80:[0,.61111,0,0,.525],81:[.13889,.61111,0,0,.525],82:[0,.61111,0,0,.525],83:[0,.61111,0,0,.525],84:[0,.61111,0,0,.525],85:[0,.61111,0,0,.525],86:[0,.61111,0,0,.525],87:[0,.61111,0,0,.525],88:[0,.61111,0,0,.525],89:[0,.61111,0,0,.525],90:[0,.61111,0,0,.525],91:[.08333,.69444,0,0,.525],92:[.08333,.69444,0,0,.525],93:[.08333,.69444,0,0,.525],94:[0,.61111,0,0,.525],95:[.09514,0,0,0,.525],96:[0,.61111,0,0,.525],97:[0,.43056,0,0,.525],98:[0,.61111,0,0,.525],99:[0,.43056,0,0,.525],100:[0,.61111,0,0,.525],101:[0,.43056,0,0,.525],102:[0,.61111,0,0,.525],103:[.22222,.43056,0,0,.525],104:[0,.61111,0,0,.525],105:[0,.61111,0,0,.525],106:[.22222,.61111,0,0,.525],107:[0,.61111,0,0,.525],108:[0,.61111,0,0,.525],109:[0,.43056,0,0,.525],110:[0,.43056,0,0,.525],111:[0,.43056,0,0,.525],112:[.22222,.43056,0,0,.525],113:[.22222,.43056,0,0,.525],114:[0,.43056,0,0,.525],115:[0,.43056,0,0,.525],116:[0,.55358,0,0,.525],117:[0,.43056,0,0,.525],118:[0,.43056,0,0,.525],119:[0,.43056,0,0,.525],120:[0,.43056,0,0,.525],121:[.22222,.43056,0,0,.525],122:[0,.43056,0,0,.525],123:[.08333,.69444,0,0,.525],124:[.08333,.69444,0,0,.525],125:[.08333,.69444,0,0,.525],126:[0,.61111,0,0,.525],127:[0,.61111,0,0,.525],160:[0,0,0,0,.525],176:[0,.61111,0,0,.525],184:[.19445,0,0,0,.525],305:[0,.43056,0,0,.525],567:[.22222,.43056,0,0,.525],711:[0,.56597,0,0,.525],713:[0,.56555,0,0,.525],714:[0,.61111,0,0,.525],715:[0,.61111,0,0,.525],728:[0,.61111,0,0,.525],730:[0,.61111,0,0,.525],770:[0,.61111,0,0,.525],771:[0,.61111,0,0,.525],776:[0,.61111,0,0,.525],915:[0,.61111,0,0,.525],916:[0,.61111,0,0,.525],920:[0,.61111,0,0,.525],923:[0,.61111,0,0,.525],926:[0,.61111,0,0,.525],928:[0,.61111,0,0,.525],931:[0,.61111,0,0,.525],933:[0,.61111,0,0,.525],934:[0,.61111,0,0,.525],936:[0,.61111,0,0,.525],937:[0,.61111,0,0,.525],8216:[0,.61111,0,0,.525],8217:[0,.61111,0,0,.525],8242:[0,.61111,0,0,.525],9251:[.11111,.21944,0,0,.525]}},t1={slant:[.25,.25,.25],space:[0,0,0],stretch:[0,0,0],shrink:[0,0,0],xHeight:[.431,.431,.431],quad:[1,1.171,1.472],extraSpace:[0,0,0],num1:[.677,.732,.925],num2:[.394,.384,.387],num3:[.444,.471,.504],denom1:[.686,.752,1.025],denom2:[.345,.344,.532],sup1:[.413,.503,.504],sup2:[.363,.431,.404],sup3:[.289,.286,.294],sub1:[.15,.143,.2],sub2:[.247,.286,.4],supDrop:[.386,.353,.494],subDrop:[.05,.071,.1],delim1:[2.39,1.7,1.98],delim2:[1.01,1.157,1.42],axisHeight:[.25,.25,.25],defaultRuleThickness:[.04,.049,.049],bigOpSpacing1:[.111,.111,.111],bigOpSpacing2:[.166,.166,.166],bigOpSpacing3:[.2,.2,.2],bigOpSpacing4:[.6,.611,.611],bigOpSpacing5:[.1,.143,.143],sqrtRuleThickness:[.04,.04,.04],ptPerEm:[10,10,10],doubleRuleSep:[.2,.2,.2],arrayRuleWidth:[.04,.04,.04],fboxsep:[.3,.3,.3],fboxrule:[.04,.04,.04]},pT={Å:"A",Ð:"D",Þ:"o",å:"a",ð:"d",þ:"o",А:"A",Б:"B",В:"B",Г:"F",Д:"A",Е:"E",Ж:"K",З:"3",И:"N",Й:"N",К:"K",Л:"N",М:"M",Н:"H",О:"O",П:"N",Р:"P",С:"C",Т:"T",У:"y",Ф:"O",Х:"X",Ц:"U",Ч:"h",Ш:"W",Щ:"W",Ъ:"B",Ы:"X",Ь:"B",Э:"3",Ю:"X",Я:"R",а:"a",б:"b",в:"a",г:"r",д:"y",е:"e",ж:"m",з:"e",и:"n",й:"n",к:"n",л:"n",м:"m",н:"n",о:"o",п:"n",р:"p",с:"c",т:"o",у:"y",ф:"b",х:"x",ц:"n",ч:"n",ш:"w",щ:"w",ъ:"a",ы:"m",ь:"a",э:"e",ю:"m",я:"r"};function RW(n,e){xo[n]=e}function zw(n,e,t){if(!xo[e])throw new Error("Font metrics not found for font: "+e+".");var i=n.charCodeAt(0),r=xo[e][i];if(!r&&n[0]in pT&&(i=pT[n[0]].charCodeAt(0),r=xo[e][i]),!r&&t==="text"&&J8(i)&&(r=xo[e][77]),r)return{depth:r[0],height:r[1],italic:r[2],skew:r[3],width:r[4]}}var Ex={};function IW(n){var e;if(n>=5?e=0:n>=3?e=1:e=2,!Ex[e]){var t=Ex[e]={cssEmPerMu:t1.quad[e]/18};for(var i in t1)t1.hasOwnProperty(i)&&(t[i]=t1[i][e])}return Ex[e]}var kW=[[1,1,1],[2,1,1],[3,1,1],[4,2,1],[5,2,1],[6,3,1],[7,4,2],[8,6,3],[9,7,6],[10,8,7],[11,10,9]],mT=[.5,.6,.7,.8,.9,1,1.2,1.44,1.728,2.074,2.488],gT=function(e,t){return t.size<2?e:kW[e-1][t.size-1]};class ol{constructor(e){this.style=void 0,this.color=void 0,this.size=void 0,this.textSize=void 0,this.phantom=void 0,this.font=void 0,this.fontFamily=void 0,this.fontWeight=void 0,this.fontShape=void 0,this.sizeMultiplier=void 0,this.maxSize=void 0,this.minRuleThickness=void 0,this._fontMetrics=void 0,this.style=e.style,this.color=e.color,this.size=e.size||ol.BASESIZE,this.textSize=e.textSize||this.size,this.phantom=!!e.phantom,this.font=e.font||"",this.fontFamily=e.fontFamily||"",this.fontWeight=e.fontWeight||"",this.fontShape=e.fontShape||"",this.sizeMultiplier=mT[this.size-1],this.maxSize=e.maxSize,this.minRuleThickness=e.minRuleThickness,this._fontMetrics=void 0}extend(e){var t={style:this.style,size:this.size,textSize:this.textSize,color:this.color,phantom:this.phantom,font:this.font,fontFamily:this.fontFamily,fontWeight:this.fontWeight,fontShape:this.fontShape,maxSize:this.maxSize,minRuleThickness:this.minRuleThickness};for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);return new ol(t)}havingStyle(e){return this.style===e?this:this.extend({style:e,size:gT(this.textSize,e)})}havingCrampedStyle(){return this.havingStyle(this.style.cramp())}havingSize(e){return this.size===e&&this.textSize===e?this:this.extend({style:this.style.text(),size:e,textSize:e,sizeMultiplier:mT[e-1]})}havingBaseStyle(e){e=e||this.style.text();var t=gT(ol.BASESIZE,e);return this.size===t&&this.textSize===ol.BASESIZE&&this.style===e?this:this.extend({style:e,size:t})}havingBaseSizing(){var e;switch(this.style.id){case 4:case 5:e=3;break;case 6:case 7:e=1;break;default:e=6}return this.extend({style:this.style.text(),size:e})}withColor(e){return this.extend({color:e})}withPhantom(){return this.extend({phantom:!0})}withFont(e){return this.extend({font:e})}withTextFontFamily(e){return this.extend({fontFamily:e,font:""})}withTextFontWeight(e){return this.extend({fontWeight:e,font:""})}withTextFontShape(e){return this.extend({fontShape:e,font:""})}sizingClasses(e){return e.size!==this.size?["sizing","reset-size"+e.size,"size"+this.size]:[]}baseSizingClasses(){return this.size!==ol.BASESIZE?["sizing","reset-size"+this.size,"size"+ol.BASESIZE]:[]}fontMetrics(){return this._fontMetrics||(this._fontMetrics=IW(this.size)),this._fontMetrics}getColor(){return this.phantom?"transparent":this.color}}ol.BASESIZE=6;var sb={pt:1,mm:7227/2540,cm:7227/254,in:72.27,bp:803/800,pc:12,dd:1238/1157,cc:14856/1157,nd:685/642,nc:1370/107,sp:1/65536,px:803/800},DW={ex:!0,em:!0,mu:!0},Q8=function(e){return typeof e!="string"&&(e=e.unit),e in sb||e in DW||e==="ex"},Zi=function(e,t){var i;if(e.unit in sb)i=sb[e.unit]/t.fontMetrics().ptPerEm/t.sizeMultiplier;else if(e.unit==="mu")i=t.fontMetrics().cssEmPerMu;else{var r;if(t.style.isTight()?r=t.havingStyle(t.style.text()):r=t,e.unit==="ex")i=r.fontMetrics().xHeight;else if(e.unit==="em")i=r.fontMetrics().quad;else throw new Ut("Invalid unit: '"+e.unit+"'");r!==t&&(i*=r.sizeMultiplier/t.sizeMultiplier)}return Math.min(e.number*i,t.maxSize)},$t=function(e){return+e.toFixed(4)+"em"},zc=function(e){return e.filter(t=>t).join(" ")},e7=function(e,t,i){if(this.classes=e||[],this.attributes={},this.height=0,this.depth=0,this.maxFontSize=0,this.style=i||{},t){t.style.isTight()&&this.classes.push("mtight");var r=t.getColor();r&&(this.style.color=r)}},t7=function(e){var t=document.createElement(e);t.className=zc(this.classes);for(var i in this.style)this.style.hasOwnProperty(i)&&(t.style[i]=this.style[i]);for(var r in this.attributes)this.attributes.hasOwnProperty(r)&&t.setAttribute(r,this.attributes[r]);for(var l=0;l<this.children.length;l++)t.appendChild(this.children[l].toNode());return t},n7=function(e){var t="<"+e;this.classes.length&&(t+=' class="'+kn.escape(zc(this.classes))+'"');var i="";for(var r in this.style)this.style.hasOwnProperty(r)&&(i+=kn.hyphenate(r)+":"+this.style[r]+";");i&&(t+=' style="'+kn.escape(i)+'"');for(var l in this.attributes)this.attributes.hasOwnProperty(l)&&(t+=" "+l+'="'+kn.escape(this.attributes[l])+'"');t+=">";for(var h=0;h<this.children.length;h++)t+=this.children[h].toMarkup();return t+="</"+e+">",t};class em{constructor(e,t,i,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.width=void 0,this.maxFontSize=void 0,this.style=void 0,e7.call(this,e,i,r),this.children=t||[]}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return kn.contains(this.classes,e)}toNode(){return t7.call(this,"span")}toMarkup(){return n7.call(this,"span")}}class Fw{constructor(e,t,i,r){this.children=void 0,this.attributes=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,e7.call(this,t,r),this.children=i||[],this.setAttribute("href",e)}setAttribute(e,t){this.attributes[e]=t}hasClass(e){return kn.contains(this.classes,e)}toNode(){return t7.call(this,"a")}toMarkup(){return n7.call(this,"a")}}class LW{constructor(e,t,i){this.src=void 0,this.alt=void 0,this.classes=void 0,this.height=void 0,this.depth=void 0,this.maxFontSize=void 0,this.style=void 0,this.alt=t,this.src=e,this.classes=["mord"],this.style=i}hasClass(e){return kn.contains(this.classes,e)}toNode(){var e=document.createElement("img");e.src=this.src,e.alt=this.alt,e.className="mord";for(var t in this.style)this.style.hasOwnProperty(t)&&(e.style[t]=this.style[t]);return e}toMarkup(){var e='<img src="'+kn.escape(this.src)+'"'+(' alt="'+kn.escape(this.alt)+'"'),t="";for(var i in this.style)this.style.hasOwnProperty(i)&&(t+=kn.hyphenate(i)+":"+this.style[i]+";");return t&&(e+=' style="'+kn.escape(t)+'"'),e+="'/>",e}}var zW={î:"ı̂",ï:"ı̈",í:"ı́",ì:"ı̀"};class As{constructor(e,t,i,r,l,h,o,p){this.text=void 0,this.height=void 0,this.depth=void 0,this.italic=void 0,this.skew=void 0,this.width=void 0,this.maxFontSize=void 0,this.classes=void 0,this.style=void 0,this.text=e,this.height=t||0,this.depth=i||0,this.italic=r||0,this.skew=l||0,this.width=h||0,this.classes=o||[],this.style=p||{},this.maxFontSize=0;var v=_W(this.text.charCodeAt(0));v&&this.classes.push(v+"_fallback"),/[îïíì]/.test(this.text)&&(this.text=zW[this.text])}hasClass(e){return kn.contains(this.classes,e)}toNode(){var e=document.createTextNode(this.text),t=null;this.italic>0&&(t=document.createElement("span"),t.style.marginRight=$t(this.italic)),this.classes.length>0&&(t=t||document.createElement("span"),t.className=zc(this.classes));for(var i in this.style)this.style.hasOwnProperty(i)&&(t=t||document.createElement("span"),t.style[i]=this.style[i]);return t?(t.appendChild(e),t):e}toMarkup(){var e=!1,t="<span";this.classes.length&&(e=!0,t+=' class="',t+=kn.escape(zc(this.classes)),t+='"');var i="";this.italic>0&&(i+="margin-right:"+this.italic+"em;");for(var r in this.style)this.style.hasOwnProperty(r)&&(i+=kn.hyphenate(r)+":"+this.style[r]+";");i&&(e=!0,t+=' style="'+kn.escape(i)+'"');var l=kn.escape(this.text);return e?(t+=">",t+=l,t+="</span>",t):l}}class wl{constructor(e,t){this.children=void 0,this.attributes=void 0,this.children=e||[],this.attributes=t||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"svg");for(var i in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,i)&&t.setAttribute(i,this.attributes[i]);for(var r=0;r<this.children.length;r++)t.appendChild(this.children[r].toNode());return t}toMarkup(){var e='<svg xmlns="http://www.w3.org/2000/svg"';for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+kn.escape(this.attributes[t])+'"');e+=">";for(var i=0;i<this.children.length;i++)e+=this.children[i].toMarkup();return e+="</svg>",e}}class Fc{constructor(e,t){this.pathName=void 0,this.alternate=void 0,this.pathName=e,this.alternate=t}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"path");return this.alternate?t.setAttribute("d",this.alternate):t.setAttribute("d",fT[this.pathName]),t}toMarkup(){return this.alternate?'<path d="'+kn.escape(this.alternate)+'"/>':'<path d="'+kn.escape(fT[this.pathName])+'"/>'}}class ob{constructor(e){this.attributes=void 0,this.attributes=e||{}}toNode(){var e="http://www.w3.org/2000/svg",t=document.createElementNS(e,"line");for(var i in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,i)&&t.setAttribute(i,this.attributes[i]);return t}toMarkup(){var e="<line";for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="'+kn.escape(this.attributes[t])+'"');return e+="/>",e}}function yT(n){if(n instanceof As)return n;throw new Error("Expected symbolNode but got "+String(n)+".")}function FW(n){if(n instanceof em)return n;throw new Error("Expected span<HtmlDomNode> but got "+String(n)+".")}var NW={bin:1,close:1,inner:1,open:1,punct:1,rel:1},BW={"accent-token":1,mathord:1,"op-token":1,spacing:1,textord:1},Di={math:{},text:{}};function N(n,e,t,i,r,l){Di[n][r]={font:e,group:t,replace:i},l&&i&&(Di[n][i]=Di[n][r])}var G="math",Et="text",te="main",Ce="ams",Gi="accent-token",fn="bin",Sa="close",hf="inner",Dn="mathord",vr="op-token",as="open",ev="punct",Ie="rel",El="spacing",Ue="textord";N(G,te,Ie,"≡","\\equiv",!0);N(G,te,Ie,"≺","\\prec",!0);N(G,te,Ie,"≻","\\succ",!0);N(G,te,Ie,"∼","\\sim",!0);N(G,te,Ie,"⊥","\\perp");N(G,te,Ie,"⪯","\\preceq",!0);N(G,te,Ie,"⪰","\\succeq",!0);N(G,te,Ie,"≃","\\simeq",!0);N(G,te,Ie,"∣","\\mid",!0);N(G,te,Ie,"≪","\\ll",!0);N(G,te,Ie,"≫","\\gg",!0);N(G,te,Ie,"≍","\\asymp",!0);N(G,te,Ie,"∥","\\parallel");N(G,te,Ie,"⋈","\\bowtie",!0);N(G,te,Ie,"⌣","\\smile",!0);N(G,te,Ie,"⊑","\\sqsubseteq",!0);N(G,te,Ie,"⊒","\\sqsupseteq",!0);N(G,te,Ie,"≐","\\doteq",!0);N(G,te,Ie,"⌢","\\frown",!0);N(G,te,Ie,"∋","\\ni",!0);N(G,te,Ie,"∝","\\propto",!0);N(G,te,Ie,"⊢","\\vdash",!0);N(G,te,Ie,"⊣","\\dashv",!0);N(G,te,Ie,"∋","\\owns");N(G,te,ev,".","\\ldotp");N(G,te,ev,"⋅","\\cdotp");N(G,te,Ue,"#","\\#");N(Et,te,Ue,"#","\\#");N(G,te,Ue,"&","\\&");N(Et,te,Ue,"&","\\&");N(G,te,Ue,"ℵ","\\aleph",!0);N(G,te,Ue,"∀","\\forall",!0);N(G,te,Ue,"ℏ","\\hbar",!0);N(G,te,Ue,"∃","\\exists",!0);N(G,te,Ue,"∇","\\nabla",!0);N(G,te,Ue,"♭","\\flat",!0);N(G,te,Ue,"ℓ","\\ell",!0);N(G,te,Ue,"♮","\\natural",!0);N(G,te,Ue,"♣","\\clubsuit",!0);N(G,te,Ue,"℘","\\wp",!0);N(G,te,Ue,"♯","\\sharp",!0);N(G,te,Ue,"♢","\\diamondsuit",!0);N(G,te,Ue,"ℜ","\\Re",!0);N(G,te,Ue,"♡","\\heartsuit",!0);N(G,te,Ue,"ℑ","\\Im",!0);N(G,te,Ue,"♠","\\spadesuit",!0);N(G,te,Ue,"§","\\S",!0);N(Et,te,Ue,"§","\\S");N(G,te,Ue,"¶","\\P",!0);N(Et,te,Ue,"¶","\\P");N(G,te,Ue,"†","\\dag");N(Et,te,Ue,"†","\\dag");N(Et,te,Ue,"†","\\textdagger");N(G,te,Ue,"‡","\\ddag");N(Et,te,Ue,"‡","\\ddag");N(Et,te,Ue,"‡","\\textdaggerdbl");N(G,te,Sa,"⎱","\\rmoustache",!0);N(G,te,as,"⎰","\\lmoustache",!0);N(G,te,Sa,"⟯","\\rgroup",!0);N(G,te,as,"⟮","\\lgroup",!0);N(G,te,fn,"∓","\\mp",!0);N(G,te,fn,"⊖","\\ominus",!0);N(G,te,fn,"⊎","\\uplus",!0);N(G,te,fn,"⊓","\\sqcap",!0);N(G,te,fn,"∗","\\ast");N(G,te,fn,"⊔","\\sqcup",!0);N(G,te,fn,"◯","\\bigcirc",!0);N(G,te,fn,"∙","\\bullet",!0);N(G,te,fn,"‡","\\ddagger");N(G,te,fn,"≀","\\wr",!0);N(G,te,fn,"⨿","\\amalg");N(G,te,fn,"&","\\And");N(G,te,Ie,"⟵","\\longleftarrow",!0);N(G,te,Ie,"⇐","\\Leftarrow",!0);N(G,te,Ie,"⟸","\\Longleftarrow",!0);N(G,te,Ie,"⟶","\\longrightarrow",!0);N(G,te,Ie,"⇒","\\Rightarrow",!0);N(G,te,Ie,"⟹","\\Longrightarrow",!0);N(G,te,Ie,"↔","\\leftrightarrow",!0);N(G,te,Ie,"⟷","\\longleftrightarrow",!0);N(G,te,Ie,"⇔","\\Leftrightarrow",!0);N(G,te,Ie,"⟺","\\Longleftrightarrow",!0);N(G,te,Ie,"↦","\\mapsto",!0);N(G,te,Ie,"⟼","\\longmapsto",!0);N(G,te,Ie,"↗","\\nearrow",!0);N(G,te,Ie,"↩","\\hookleftarrow",!0);N(G,te,Ie,"↪","\\hookrightarrow",!0);N(G,te,Ie,"↘","\\searrow",!0);N(G,te,Ie,"↼","\\leftharpoonup",!0);N(G,te,Ie,"⇀","\\rightharpoonup",!0);N(G,te,Ie,"↙","\\swarrow",!0);N(G,te,Ie,"↽","\\leftharpoondown",!0);N(G,te,Ie,"⇁","\\rightharpoondown",!0);N(G,te,Ie,"↖","\\nwarrow",!0);N(G,te,Ie,"⇌","\\rightleftharpoons",!0);N(G,Ce,Ie,"≮","\\nless",!0);N(G,Ce,Ie,"","\\@nleqslant");N(G,Ce,Ie,"","\\@nleqq");N(G,Ce,Ie,"⪇","\\lneq",!0);N(G,Ce,Ie,"≨","\\lneqq",!0);N(G,Ce,Ie,"","\\@lvertneqq");N(G,Ce,Ie,"⋦","\\lnsim",!0);N(G,Ce,Ie,"⪉","\\lnapprox",!0);N(G,Ce,Ie,"⊀","\\nprec",!0);N(G,Ce,Ie,"⋠","\\npreceq",!0);N(G,Ce,Ie,"⋨","\\precnsim",!0);N(G,Ce,Ie,"⪹","\\precnapprox",!0);N(G,Ce,Ie,"≁","\\nsim",!0);N(G,Ce,Ie,"","\\@nshortmid");N(G,Ce,Ie,"∤","\\nmid",!0);N(G,Ce,Ie,"⊬","\\nvdash",!0);N(G,Ce,Ie,"⊭","\\nvDash",!0);N(G,Ce,Ie,"⋪","\\ntriangleleft");N(G,Ce,Ie,"⋬","\\ntrianglelefteq",!0);N(G,Ce,Ie,"⊊","\\subsetneq",!0);N(G,Ce,Ie,"","\\@varsubsetneq");N(G,Ce,Ie,"⫋","\\subsetneqq",!0);N(G,Ce,Ie,"","\\@varsubsetneqq");N(G,Ce,Ie,"≯","\\ngtr",!0);N(G,Ce,Ie,"","\\@ngeqslant");N(G,Ce,Ie,"","\\@ngeqq");N(G,Ce,Ie,"⪈","\\gneq",!0);N(G,Ce,Ie,"≩","\\gneqq",!0);N(G,Ce,Ie,"","\\@gvertneqq");N(G,Ce,Ie,"⋧","\\gnsim",!0);N(G,Ce,Ie,"⪊","\\gnapprox",!0);N(G,Ce,Ie,"⊁","\\nsucc",!0);N(G,Ce,Ie,"⋡","\\nsucceq",!0);N(G,Ce,Ie,"⋩","\\succnsim",!0);N(G,Ce,Ie,"⪺","\\succnapprox",!0);N(G,Ce,Ie,"≆","\\ncong",!0);N(G,Ce,Ie,"","\\@nshortparallel");N(G,Ce,Ie,"∦","\\nparallel",!0);N(G,Ce,Ie,"⊯","\\nVDash",!0);N(G,Ce,Ie,"⋫","\\ntriangleright");N(G,Ce,Ie,"⋭","\\ntrianglerighteq",!0);N(G,Ce,Ie,"","\\@nsupseteqq");N(G,Ce,Ie,"⊋","\\supsetneq",!0);N(G,Ce,Ie,"","\\@varsupsetneq");N(G,Ce,Ie,"⫌","\\supsetneqq",!0);N(G,Ce,Ie,"","\\@varsupsetneqq");N(G,Ce,Ie,"⊮","\\nVdash",!0);N(G,Ce,Ie,"⪵","\\precneqq",!0);N(G,Ce,Ie,"⪶","\\succneqq",!0);N(G,Ce,Ie,"","\\@nsubseteqq");N(G,Ce,fn,"⊴","\\unlhd");N(G,Ce,fn,"⊵","\\unrhd");N(G,Ce,Ie,"↚","\\nleftarrow",!0);N(G,Ce,Ie,"↛","\\nrightarrow",!0);N(G,Ce,Ie,"⇍","\\nLeftarrow",!0);N(G,Ce,Ie,"⇏","\\nRightarrow",!0);N(G,Ce,Ie,"↮","\\nleftrightarrow",!0);N(G,Ce,Ie,"⇎","\\nLeftrightarrow",!0);N(G,Ce,Ie,"△","\\vartriangle");N(G,Ce,Ue,"ℏ","\\hslash");N(G,Ce,Ue,"▽","\\triangledown");N(G,Ce,Ue,"◊","\\lozenge");N(G,Ce,Ue,"Ⓢ","\\circledS");N(G,Ce,Ue,"®","\\circledR");N(Et,Ce,Ue,"®","\\circledR");N(G,Ce,Ue,"∡","\\measuredangle",!0);N(G,Ce,Ue,"∄","\\nexists");N(G,Ce,Ue,"℧","\\mho");N(G,Ce,Ue,"Ⅎ","\\Finv",!0);N(G,Ce,Ue,"⅁","\\Game",!0);N(G,Ce,Ue,"‵","\\backprime");N(G,Ce,Ue,"▲","\\blacktriangle");N(G,Ce,Ue,"▼","\\blacktriangledown");N(G,Ce,Ue,"■","\\blacksquare");N(G,Ce,Ue,"⧫","\\blacklozenge");N(G,Ce,Ue,"★","\\bigstar");N(G,Ce,Ue,"∢","\\sphericalangle",!0);N(G,Ce,Ue,"∁","\\complement",!0);N(G,Ce,Ue,"ð","\\eth",!0);N(Et,te,Ue,"ð","ð");N(G,Ce,Ue,"╱","\\diagup");N(G,Ce,Ue,"╲","\\diagdown");N(G,Ce,Ue,"□","\\square");N(G,Ce,Ue,"□","\\Box");N(G,Ce,Ue,"◊","\\Diamond");N(G,Ce,Ue,"¥","\\yen",!0);N(Et,Ce,Ue,"¥","\\yen",!0);N(G,Ce,Ue,"✓","\\checkmark",!0);N(Et,Ce,Ue,"✓","\\checkmark");N(G,Ce,Ue,"ℶ","\\beth",!0);N(G,Ce,Ue,"ℸ","\\daleth",!0);N(G,Ce,Ue,"ℷ","\\gimel",!0);N(G,Ce,Ue,"ϝ","\\digamma",!0);N(G,Ce,Ue,"ϰ","\\varkappa");N(G,Ce,as,"┌","\\@ulcorner",!0);N(G,Ce,Sa,"┐","\\@urcorner",!0);N(G,Ce,as,"└","\\@llcorner",!0);N(G,Ce,Sa,"┘","\\@lrcorner",!0);N(G,Ce,Ie,"≦","\\leqq",!0);N(G,Ce,Ie,"⩽","\\leqslant",!0);N(G,Ce,Ie,"⪕","\\eqslantless",!0);N(G,Ce,Ie,"≲","\\lesssim",!0);N(G,Ce,Ie,"⪅","\\lessapprox",!0);N(G,Ce,Ie,"≊","\\approxeq",!0);N(G,Ce,fn,"⋖","\\lessdot");N(G,Ce,Ie,"⋘","\\lll",!0);N(G,Ce,Ie,"≶","\\lessgtr",!0);N(G,Ce,Ie,"⋚","\\lesseqgtr",!0);N(G,Ce,Ie,"⪋","\\lesseqqgtr",!0);N(G,Ce,Ie,"≑","\\doteqdot");N(G,Ce,Ie,"≓","\\risingdotseq",!0);N(G,Ce,Ie,"≒","\\fallingdotseq",!0);N(G,Ce,Ie,"∽","\\backsim",!0);N(G,Ce,Ie,"⋍","\\backsimeq",!0);N(G,Ce,Ie,"⫅","\\subseteqq",!0);N(G,Ce,Ie,"⋐","\\Subset",!0);N(G,Ce,Ie,"⊏","\\sqsubset",!0);N(G,Ce,Ie,"≼","\\preccurlyeq",!0);N(G,Ce,Ie,"⋞","\\curlyeqprec",!0);N(G,Ce,Ie,"≾","\\precsim",!0);N(G,Ce,Ie,"⪷","\\precapprox",!0);N(G,Ce,Ie,"⊲","\\vartriangleleft");N(G,Ce,Ie,"⊴","\\trianglelefteq");N(G,Ce,Ie,"⊨","\\vDash",!0);N(G,Ce,Ie,"⊪","\\Vvdash",!0);N(G,Ce,Ie,"⌣","\\smallsmile");N(G,Ce,Ie,"⌢","\\smallfrown");N(G,Ce,Ie,"≏","\\bumpeq",!0);N(G,Ce,Ie,"≎","\\Bumpeq",!0);N(G,Ce,Ie,"≧","\\geqq",!0);N(G,Ce,Ie,"⩾","\\geqslant",!0);N(G,Ce,Ie,"⪖","\\eqslantgtr",!0);N(G,Ce,Ie,"≳","\\gtrsim",!0);N(G,Ce,Ie,"⪆","\\gtrapprox",!0);N(G,Ce,fn,"⋗","\\gtrdot");N(G,Ce,Ie,"⋙","\\ggg",!0);N(G,Ce,Ie,"≷","\\gtrless",!0);N(G,Ce,Ie,"⋛","\\gtreqless",!0);N(G,Ce,Ie,"⪌","\\gtreqqless",!0);N(G,Ce,Ie,"≖","\\eqcirc",!0);N(G,Ce,Ie,"≗","\\circeq",!0);N(G,Ce,Ie,"≜","\\triangleq",!0);N(G,Ce,Ie,"∼","\\thicksim");N(G,Ce,Ie,"≈","\\thickapprox");N(G,Ce,Ie,"⫆","\\supseteqq",!0);N(G,Ce,Ie,"⋑","\\Supset",!0);N(G,Ce,Ie,"⊐","\\sqsupset",!0);N(G,Ce,Ie,"≽","\\succcurlyeq",!0);N(G,Ce,Ie,"⋟","\\curlyeqsucc",!0);N(G,Ce,Ie,"≿","\\succsim",!0);N(G,Ce,Ie,"⪸","\\succapprox",!0);N(G,Ce,Ie,"⊳","\\vartriangleright");N(G,Ce,Ie,"⊵","\\trianglerighteq");N(G,Ce,Ie,"⊩","\\Vdash",!0);N(G,Ce,Ie,"∣","\\shortmid");N(G,Ce,Ie,"∥","\\shortparallel");N(G,Ce,Ie,"≬","\\between",!0);N(G,Ce,Ie,"⋔","\\pitchfork",!0);N(G,Ce,Ie,"∝","\\varpropto");N(G,Ce,Ie,"◀","\\blacktriangleleft");N(G,Ce,Ie,"∴","\\therefore",!0);N(G,Ce,Ie,"∍","\\backepsilon");N(G,Ce,Ie,"▶","\\blacktriangleright");N(G,Ce,Ie,"∵","\\because",!0);N(G,Ce,Ie,"⋘","\\llless");N(G,Ce,Ie,"⋙","\\gggtr");N(G,Ce,fn,"⊲","\\lhd");N(G,Ce,fn,"⊳","\\rhd");N(G,Ce,Ie,"≂","\\eqsim",!0);N(G,te,Ie,"⋈","\\Join");N(G,Ce,Ie,"≑","\\Doteq",!0);N(G,Ce,fn,"∔","\\dotplus",!0);N(G,Ce,fn,"∖","\\smallsetminus");N(G,Ce,fn,"⋒","\\Cap",!0);N(G,Ce,fn,"⋓","\\Cup",!0);N(G,Ce,fn,"⩞","\\doublebarwedge",!0);N(G,Ce,fn,"⊟","\\boxminus",!0);N(G,Ce,fn,"⊞","\\boxplus",!0);N(G,Ce,fn,"⋇","\\divideontimes",!0);N(G,Ce,fn,"⋉","\\ltimes",!0);N(G,Ce,fn,"⋊","\\rtimes",!0);N(G,Ce,fn,"⋋","\\leftthreetimes",!0);N(G,Ce,fn,"⋌","\\rightthreetimes",!0);N(G,Ce,fn,"⋏","\\curlywedge",!0);N(G,Ce,fn,"⋎","\\curlyvee",!0);N(G,Ce,fn,"⊝","\\circleddash",!0);N(G,Ce,fn,"⊛","\\circledast",!0);N(G,Ce,fn,"⋅","\\centerdot");N(G,Ce,fn,"⊺","\\intercal",!0);N(G,Ce,fn,"⋒","\\doublecap");N(G,Ce,fn,"⋓","\\doublecup");N(G,Ce,fn,"⊠","\\boxtimes",!0);N(G,Ce,Ie,"⇢","\\dashrightarrow",!0);N(G,Ce,Ie,"⇠","\\dashleftarrow",!0);N(G,Ce,Ie,"⇇","\\leftleftarrows",!0);N(G,Ce,Ie,"⇆","\\leftrightarrows",!0);N(G,Ce,Ie,"⇚","\\Lleftarrow",!0);N(G,Ce,Ie,"↞","\\twoheadleftarrow",!0);N(G,Ce,Ie,"↢","\\leftarrowtail",!0);N(G,Ce,Ie,"↫","\\looparrowleft",!0);N(G,Ce,Ie,"⇋","\\leftrightharpoons",!0);N(G,Ce,Ie,"↶","\\curvearrowleft",!0);N(G,Ce,Ie,"↺","\\circlearrowleft",!0);N(G,Ce,Ie,"↰","\\Lsh",!0);N(G,Ce,Ie,"⇈","\\upuparrows",!0);N(G,Ce,Ie,"↿","\\upharpoonleft",!0);N(G,Ce,Ie,"⇃","\\downharpoonleft",!0);N(G,te,Ie,"⊶","\\origof",!0);N(G,te,Ie,"⊷","\\imageof",!0);N(G,Ce,Ie,"⊸","\\multimap",!0);N(G,Ce,Ie,"↭","\\leftrightsquigarrow",!0);N(G,Ce,Ie,"⇉","\\rightrightarrows",!0);N(G,Ce,Ie,"⇄","\\rightleftarrows",!0);N(G,Ce,Ie,"↠","\\twoheadrightarrow",!0);N(G,Ce,Ie,"↣","\\rightarrowtail",!0);N(G,Ce,Ie,"↬","\\looparrowright",!0);N(G,Ce,Ie,"↷","\\curvearrowright",!0);N(G,Ce,Ie,"↻","\\circlearrowright",!0);N(G,Ce,Ie,"↱","\\Rsh",!0);N(G,Ce,Ie,"⇊","\\downdownarrows",!0);N(G,Ce,Ie,"↾","\\upharpoonright",!0);N(G,Ce,Ie,"⇂","\\downharpoonright",!0);N(G,Ce,Ie,"⇝","\\rightsquigarrow",!0);N(G,Ce,Ie,"⇝","\\leadsto");N(G,Ce,Ie,"⇛","\\Rrightarrow",!0);N(G,Ce,Ie,"↾","\\restriction");N(G,te,Ue,"‘","`");N(G,te,Ue,"$","\\$");N(Et,te,Ue,"$","\\$");N(Et,te,Ue,"$","\\textdollar");N(G,te,Ue,"%","\\%");N(Et,te,Ue,"%","\\%");N(G,te,Ue,"_","\\_");N(Et,te,Ue,"_","\\_");N(Et,te,Ue,"_","\\textunderscore");N(G,te,Ue,"∠","\\angle",!0);N(G,te,Ue,"∞","\\infty",!0);N(G,te,Ue,"′","\\prime");N(G,te,Ue,"△","\\triangle");N(G,te,Ue,"Γ","\\Gamma",!0);N(G,te,Ue,"Δ","\\Delta",!0);N(G,te,Ue,"Θ","\\Theta",!0);N(G,te,Ue,"Λ","\\Lambda",!0);N(G,te,Ue,"Ξ","\\Xi",!0);N(G,te,Ue,"Π","\\Pi",!0);N(G,te,Ue,"Σ","\\Sigma",!0);N(G,te,Ue,"Υ","\\Upsilon",!0);N(G,te,Ue,"Φ","\\Phi",!0);N(G,te,Ue,"Ψ","\\Psi",!0);N(G,te,Ue,"Ω","\\Omega",!0);N(G,te,Ue,"A","Α");N(G,te,Ue,"B","Β");N(G,te,Ue,"E","Ε");N(G,te,Ue,"Z","Ζ");N(G,te,Ue,"H","Η");N(G,te,Ue,"I","Ι");N(G,te,Ue,"K","Κ");N(G,te,Ue,"M","Μ");N(G,te,Ue,"N","Ν");N(G,te,Ue,"O","Ο");N(G,te,Ue,"P","Ρ");N(G,te,Ue,"T","Τ");N(G,te,Ue,"X","Χ");N(G,te,Ue,"¬","\\neg",!0);N(G,te,Ue,"¬","\\lnot");N(G,te,Ue,"⊤","\\top");N(G,te,Ue,"⊥","\\bot");N(G,te,Ue,"∅","\\emptyset");N(G,Ce,Ue,"∅","\\varnothing");N(G,te,Dn,"α","\\alpha",!0);N(G,te,Dn,"β","\\beta",!0);N(G,te,Dn,"γ","\\gamma",!0);N(G,te,Dn,"δ","\\delta",!0);N(G,te,Dn,"ϵ","\\epsilon",!0);N(G,te,Dn,"ζ","\\zeta",!0);N(G,te,Dn,"η","\\eta",!0);N(G,te,Dn,"θ","\\theta",!0);N(G,te,Dn,"ι","\\iota",!0);N(G,te,Dn,"κ","\\kappa",!0);N(G,te,Dn,"λ","\\lambda",!0);N(G,te,Dn,"μ","\\mu",!0);N(G,te,Dn,"ν","\\nu",!0);N(G,te,Dn,"ξ","\\xi",!0);N(G,te,Dn,"ο","\\omicron",!0);N(G,te,Dn,"π","\\pi",!0);N(G,te,Dn,"ρ","\\rho",!0);N(G,te,Dn,"σ","\\sigma",!0);N(G,te,Dn,"τ","\\tau",!0);N(G,te,Dn,"υ","\\upsilon",!0);N(G,te,Dn,"ϕ","\\phi",!0);N(G,te,Dn,"χ","\\chi",!0);N(G,te,Dn,"ψ","\\psi",!0);N(G,te,Dn,"ω","\\omega",!0);N(G,te,Dn,"ε","\\varepsilon",!0);N(G,te,Dn,"ϑ","\\vartheta",!0);N(G,te,Dn,"ϖ","\\varpi",!0);N(G,te,Dn,"ϱ","\\varrho",!0);N(G,te,Dn,"ς","\\varsigma",!0);N(G,te,Dn,"φ","\\varphi",!0);N(G,te,fn,"∗","*",!0);N(G,te,fn,"+","+");N(G,te,fn,"−","-",!0);N(G,te,fn,"⋅","\\cdot",!0);N(G,te,fn,"∘","\\circ",!0);N(G,te,fn,"÷","\\div",!0);N(G,te,fn,"±","\\pm",!0);N(G,te,fn,"×","\\times",!0);N(G,te,fn,"∩","\\cap",!0);N(G,te,fn,"∪","\\cup",!0);N(G,te,fn,"∖","\\setminus",!0);N(G,te,fn,"∧","\\land");N(G,te,fn,"∨","\\lor");N(G,te,fn,"∧","\\wedge",!0);N(G,te,fn,"∨","\\vee",!0);N(G,te,Ue,"√","\\surd");N(G,te,as,"⟨","\\langle",!0);N(G,te,as,"∣","\\lvert");N(G,te,as,"∥","\\lVert");N(G,te,Sa,"?","?");N(G,te,Sa,"!","!");N(G,te,Sa,"⟩","\\rangle",!0);N(G,te,Sa,"∣","\\rvert");N(G,te,Sa,"∥","\\rVert");N(G,te,Ie,"=","=");N(G,te,Ie,":",":");N(G,te,Ie,"≈","\\approx",!0);N(G,te,Ie,"≅","\\cong",!0);N(G,te,Ie,"≥","\\ge");N(G,te,Ie,"≥","\\geq",!0);N(G,te,Ie,"←","\\gets");N(G,te,Ie,">","\\gt",!0);N(G,te,Ie,"∈","\\in",!0);N(G,te,Ie,"","\\@not");N(G,te,Ie,"⊂","\\subset",!0);N(G,te,Ie,"⊃","\\supset",!0);N(G,te,Ie,"⊆","\\subseteq",!0);N(G,te,Ie,"⊇","\\supseteq",!0);N(G,Ce,Ie,"⊈","\\nsubseteq",!0);N(G,Ce,Ie,"⊉","\\nsupseteq",!0);N(G,te,Ie,"⊨","\\models");N(G,te,Ie,"←","\\leftarrow",!0);N(G,te,Ie,"≤","\\le");N(G,te,Ie,"≤","\\leq",!0);N(G,te,Ie,"<","\\lt",!0);N(G,te,Ie,"→","\\rightarrow",!0);N(G,te,Ie,"→","\\to");N(G,Ce,Ie,"≱","\\ngeq",!0);N(G,Ce,Ie,"≰","\\nleq",!0);N(G,te,El," ","\\ ");N(G,te,El," ","\\space");N(G,te,El," ","\\nobreakspace");N(Et,te,El," ","\\ ");N(Et,te,El," "," ");N(Et,te,El," ","\\space");N(Et,te,El," ","\\nobreakspace");N(G,te,El,null,"\\nobreak");N(G,te,El,null,"\\allowbreak");N(G,te,ev,",",",");N(G,te,ev,";",";");N(G,Ce,fn,"⊼","\\barwedge",!0);N(G,Ce,fn,"⊻","\\veebar",!0);N(G,te,fn,"⊙","\\odot",!0);N(G,te,fn,"⊕","\\oplus",!0);N(G,te,fn,"⊗","\\otimes",!0);N(G,te,Ue,"∂","\\partial",!0);N(G,te,fn,"⊘","\\oslash",!0);N(G,Ce,fn,"⊚","\\circledcirc",!0);N(G,Ce,fn,"⊡","\\boxdot",!0);N(G,te,fn,"△","\\bigtriangleup");N(G,te,fn,"▽","\\bigtriangledown");N(G,te,fn,"†","\\dagger");N(G,te,fn,"⋄","\\diamond");N(G,te,fn,"⋆","\\star");N(G,te,fn,"◃","\\triangleleft");N(G,te,fn,"▹","\\triangleright");N(G,te,as,"{","\\{");N(Et,te,Ue,"{","\\{");N(Et,te,Ue,"{","\\textbraceleft");N(G,te,Sa,"}","\\}");N(Et,te,Ue,"}","\\}");N(Et,te,Ue,"}","\\textbraceright");N(G,te,as,"{","\\lbrace");N(G,te,Sa,"}","\\rbrace");N(G,te,as,"[","\\lbrack",!0);N(Et,te,Ue,"[","\\lbrack",!0);N(G,te,Sa,"]","\\rbrack",!0);N(Et,te,Ue,"]","\\rbrack",!0);N(G,te,as,"(","\\lparen",!0);N(G,te,Sa,")","\\rparen",!0);N(Et,te,Ue,"<","\\textless",!0);N(Et,te,Ue,">","\\textgreater",!0);N(G,te,as,"⌊","\\lfloor",!0);N(G,te,Sa,"⌋","\\rfloor",!0);N(G,te,as,"⌈","\\lceil",!0);N(G,te,Sa,"⌉","\\rceil",!0);N(G,te,Ue,"\\","\\backslash");N(G,te,Ue,"∣","|");N(G,te,Ue,"∣","\\vert");N(Et,te,Ue,"|","\\textbar",!0);N(G,te,Ue,"∥","\\|");N(G,te,Ue,"∥","\\Vert");N(Et,te,Ue,"∥","\\textbardbl");N(Et,te,Ue,"~","\\textasciitilde");N(Et,te,Ue,"\\","\\textbackslash");N(Et,te,Ue,"^","\\textasciicircum");N(G,te,Ie,"↑","\\uparrow",!0);N(G,te,Ie,"⇑","\\Uparrow",!0);N(G,te,Ie,"↓","\\downarrow",!0);N(G,te,Ie,"⇓","\\Downarrow",!0);N(G,te,Ie,"↕","\\updownarrow",!0);N(G,te,Ie,"⇕","\\Updownarrow",!0);N(G,te,vr,"∐","\\coprod");N(G,te,vr,"⋁","\\bigvee");N(G,te,vr,"⋀","\\bigwedge");N(G,te,vr,"⨄","\\biguplus");N(G,te,vr,"⋂","\\bigcap");N(G,te,vr,"⋃","\\bigcup");N(G,te,vr,"∫","\\int");N(G,te,vr,"∫","\\intop");N(G,te,vr,"∬","\\iint");N(G,te,vr,"∭","\\iiint");N(G,te,vr,"∏","\\prod");N(G,te,vr,"∑","\\sum");N(G,te,vr,"⨂","\\bigotimes");N(G,te,vr,"⨁","\\bigoplus");N(G,te,vr,"⨀","\\bigodot");N(G,te,vr,"∮","\\oint");N(G,te,vr,"∯","\\oiint");N(G,te,vr,"∰","\\oiiint");N(G,te,vr,"⨆","\\bigsqcup");N(G,te,vr,"∫","\\smallint");N(Et,te,hf,"…","\\textellipsis");N(G,te,hf,"…","\\mathellipsis");N(Et,te,hf,"…","\\ldots",!0);N(G,te,hf,"…","\\ldots",!0);N(G,te,hf,"⋯","\\@cdots",!0);N(G,te,hf,"⋱","\\ddots",!0);N(G,te,Ue,"⋮","\\varvdots");N(G,te,Gi,"ˊ","\\acute");N(G,te,Gi,"ˋ","\\grave");N(G,te,Gi,"¨","\\ddot");N(G,te,Gi,"~","\\tilde");N(G,te,Gi,"ˉ","\\bar");N(G,te,Gi,"˘","\\breve");N(G,te,Gi,"ˇ","\\check");N(G,te,Gi,"^","\\hat");N(G,te,Gi,"⃗","\\vec");N(G,te,Gi,"˙","\\dot");N(G,te,Gi,"˚","\\mathring");N(G,te,Dn,"","\\@imath");N(G,te,Dn,"","\\@jmath");N(G,te,Ue,"ı","ı");N(G,te,Ue,"ȷ","ȷ");N(Et,te,Ue,"ı","\\i",!0);N(Et,te,Ue,"ȷ","\\j",!0);N(Et,te,Ue,"ß","\\ss",!0);N(Et,te,Ue,"æ","\\ae",!0);N(Et,te,Ue,"œ","\\oe",!0);N(Et,te,Ue,"ø","\\o",!0);N(Et,te,Ue,"Æ","\\AE",!0);N(Et,te,Ue,"Œ","\\OE",!0);N(Et,te,Ue,"Ø","\\O",!0);N(Et,te,Gi,"ˊ","\\'");N(Et,te,Gi,"ˋ","\\`");N(Et,te,Gi,"ˆ","\\^");N(Et,te,Gi,"˜","\\~");N(Et,te,Gi,"ˉ","\\=");N(Et,te,Gi,"˘","\\u");N(Et,te,Gi,"˙","\\.");N(Et,te,Gi,"¸","\\c");N(Et,te,Gi,"˚","\\r");N(Et,te,Gi,"ˇ","\\v");N(Et,te,Gi,"¨",'\\"');N(Et,te,Gi,"˝","\\H");N(Et,te,Gi,"◯","\\textcircled");var i7={"--":!0,"---":!0,"``":!0,"''":!0};N(Et,te,Ue,"–","--",!0);N(Et,te,Ue,"–","\\textendash");N(Et,te,Ue,"—","---",!0);N(Et,te,Ue,"—","\\textemdash");N(Et,te,Ue,"‘","`",!0);N(Et,te,Ue,"‘","\\textquoteleft");N(Et,te,Ue,"’","'",!0);N(Et,te,Ue,"’","\\textquoteright");N(Et,te,Ue,"“","``",!0);N(Et,te,Ue,"“","\\textquotedblleft");N(Et,te,Ue,"”","''",!0);N(Et,te,Ue,"”","\\textquotedblright");N(G,te,Ue,"°","\\degree",!0);N(Et,te,Ue,"°","\\degree");N(Et,te,Ue,"°","\\textdegree",!0);N(G,te,Ue,"£","\\pounds");N(G,te,Ue,"£","\\mathsterling",!0);N(Et,te,Ue,"£","\\pounds");N(Et,te,Ue,"£","\\textsterling",!0);N(G,Ce,Ue,"✠","\\maltese");N(Et,Ce,Ue,"✠","\\maltese");var vT='0123456789/@."';for(var Ax=0;Ax<vT.length;Ax++){var _T=vT.charAt(Ax);N(G,te,Ue,_T,_T)}var xT='0123456789!@*()-=+";:?/.,';for(var Cx=0;Cx<xT.length;Cx++){var bT=xT.charAt(Cx);N(Et,te,Ue,bT,bT)}var by="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";for(var Px=0;Px<by.length;Px++){var n1=by.charAt(Px);N(G,te,Dn,n1,n1),N(Et,te,Ue,n1,n1)}N(G,Ce,Ue,"C","ℂ");N(Et,Ce,Ue,"C","ℂ");N(G,Ce,Ue,"H","ℍ");N(Et,Ce,Ue,"H","ℍ");N(G,Ce,Ue,"N","ℕ");N(Et,Ce,Ue,"N","ℕ");N(G,Ce,Ue,"P","ℙ");N(Et,Ce,Ue,"P","ℙ");N(G,Ce,Ue,"Q","ℚ");N(Et,Ce,Ue,"Q","ℚ");N(G,Ce,Ue,"R","ℝ");N(Et,Ce,Ue,"R","ℝ");N(G,Ce,Ue,"Z","ℤ");N(Et,Ce,Ue,"Z","ℤ");N(G,te,Dn,"h","ℎ");N(Et,te,Dn,"h","ℎ");var Bn="";for(var pa=0;pa<by.length;pa++){var tr=by.charAt(pa);Bn=String.fromCharCode(55349,56320+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56372+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56424+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56580+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56684+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56736+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56788+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56840+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56944+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),pa<26&&(Bn=String.fromCharCode(55349,56632+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn),Bn=String.fromCharCode(55349,56476+pa),N(G,te,Dn,tr,Bn),N(Et,te,Ue,tr,Bn))}Bn="𝕜";N(G,te,Dn,"k",Bn);N(Et,te,Ue,"k",Bn);for(var _u=0;_u<10;_u++){var lc=_u.toString();Bn=String.fromCharCode(55349,57294+_u),N(G,te,Dn,lc,Bn),N(Et,te,Ue,lc,Bn),Bn=String.fromCharCode(55349,57314+_u),N(G,te,Dn,lc,Bn),N(Et,te,Ue,lc,Bn),Bn=String.fromCharCode(55349,57324+_u),N(G,te,Dn,lc,Bn),N(Et,te,Ue,lc,Bn),Bn=String.fromCharCode(55349,57334+_u),N(G,te,Dn,lc,Bn),N(Et,te,Ue,lc,Bn)}var lb="ÐÞþ";for(var Rx=0;Rx<lb.length;Rx++){var i1=lb.charAt(Rx);N(G,te,Dn,i1,i1),N(Et,te,Ue,i1,i1)}var r1=[["mathbf","textbf","Main-Bold"],["mathbf","textbf","Main-Bold"],["mathnormal","textit","Math-Italic"],["mathnormal","textit","Math-Italic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["boldsymbol","boldsymbol","Main-BoldItalic"],["mathscr","textscr","Script-Regular"],["","",""],["","",""],["","",""],["mathfrak","textfrak","Fraktur-Regular"],["mathfrak","textfrak","Fraktur-Regular"],["mathbb","textbb","AMS-Regular"],["mathbb","textbb","AMS-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathboldfrak","textboldfrak","Fraktur-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathitsf","textitsf","SansSerif-Italic"],["mathitsf","textitsf","SansSerif-Italic"],["","",""],["","",""],["mathtt","texttt","Typewriter-Regular"],["mathtt","texttt","Typewriter-Regular"]],wT=[["mathbf","textbf","Main-Bold"],["","",""],["mathsf","textsf","SansSerif-Regular"],["mathboldsf","textboldsf","SansSerif-Bold"],["mathtt","texttt","Typewriter-Regular"]],OW=function(e,t){var i=e.charCodeAt(0),r=e.charCodeAt(1),l=(i-55296)*1024+(r-56320)+65536,h=t==="math"?0:1;if(119808<=l&&l<120484){var o=Math.floor((l-119808)/26);return[r1[o][2],r1[o][h]]}else if(120782<=l&&l<=120831){var p=Math.floor((l-120782)/10);return[wT[p][2],wT[p][h]]}else{if(l===120485||l===120486)return[r1[0][2],r1[0][h]];if(120486<l&&l<120782)return["",""];throw new Ut("Unsupported character: "+e)}},tv=function(e,t,i){return Di[i][e]&&Di[i][e].replace&&(e=Di[i][e].replace),{value:e,metrics:zw(e,t,i)}},js=function(e,t,i,r,l){var h=tv(e,t,i),o=h.metrics;e=h.value;var p;if(o){var v=o.italic;(i==="text"||r&&r.font==="mathit")&&(v=0),p=new As(e,o.height,o.depth,v,o.skew,o.width,l)}else typeof console<"u"&&console.warn("No character metrics "+("for '"+e+"' in style '"+t+"' and mode '"+i+"'")),p=new As(e,0,0,0,0,0,l);if(r){p.maxFontSize=r.sizeMultiplier,r.style.isTight()&&p.classes.push("mtight");var x=r.getColor();x&&(p.style.color=x)}return p},UW=function(e,t,i,r){return r===void 0&&(r=[]),i.font==="boldsymbol"&&tv(e,"Main-Bold",t).metrics?js(e,"Main-Bold",t,i,r.concat(["mathbf"])):e==="\\"||Di[t][e].font==="main"?js(e,"Main-Regular",t,i,r):js(e,"AMS-Regular",t,i,r.concat(["amsrm"]))},VW=function(e,t,i,r,l){return l!=="textord"&&tv(e,"Math-BoldItalic",t).metrics?{fontName:"Math-BoldItalic",fontClass:"boldsymbol"}:{fontName:"Main-Bold",fontClass:"mathbf"}},HW=function(e,t,i){var r=e.mode,l=e.text,h=["mord"],o=r==="math"||r==="text"&&t.font,p=o?t.font:t.fontFamily,v="",x="";if(l.charCodeAt(0)===55349&&([v,x]=OW(l,r)),v.length>0)return js(l,v,r,t,h.concat(x));if(p){var M,S;if(p==="boldsymbol"){var A=VW(l,r,t,h,i);M=A.fontName,S=[A.fontClass]}else o?(M=s7[p].fontName,S=[p]):(M=a1(p,t.fontWeight,t.fontShape),S=[p,t.fontWeight,t.fontShape]);if(tv(l,M,r).metrics)return js(l,M,r,t,h.concat(S));if(i7.hasOwnProperty(l)&&M.slice(0,10)==="Typewriter"){for(var L=[],F=0;F<l.length;F++)L.push(js(l[F],M,r,t,h.concat(S)));return a7(L)}}if(i==="mathord")return js(l,"Math-Italic",r,t,h.concat(["mathnormal"]));if(i==="textord"){var k=Di[r][l]&&Di[r][l].font;if(k==="ams"){var C=a1("amsrm",t.fontWeight,t.fontShape);return js(l,C,r,t,h.concat("amsrm",t.fontWeight,t.fontShape))}else if(k==="main"||!k){var V=a1("textrm",t.fontWeight,t.fontShape);return js(l,V,r,t,h.concat(t.fontWeight,t.fontShape))}else{var O=a1(k,t.fontWeight,t.fontShape);return js(l,O,r,t,h.concat(O,t.fontWeight,t.fontShape))}}else throw new Error("unexpected type: "+i+" in makeOrd")},GW=(n,e)=>{if(zc(n.classes)!==zc(e.classes)||n.skew!==e.skew||n.maxFontSize!==e.maxFontSize)return!1;if(n.classes.length===1){var t=n.classes[0];if(t==="mbin"||t==="mord")return!1}for(var i in n.style)if(n.style.hasOwnProperty(i)&&n.style[i]!==e.style[i])return!1;for(var r in e.style)if(e.style.hasOwnProperty(r)&&n.style[r]!==e.style[r])return!1;return!0},jW=n=>{for(var e=0;e<n.length-1;e++){var t=n[e],i=n[e+1];t instanceof As&&i instanceof As&&GW(t,i)&&(t.text+=i.text,t.height=Math.max(t.height,i.height),t.depth=Math.max(t.depth,i.depth),t.italic=i.italic,n.splice(e+1,1),e--)}return n},Nw=function(e){for(var t=0,i=0,r=0,l=0;l<e.children.length;l++){var h=e.children[l];h.height>t&&(t=h.height),h.depth>i&&(i=h.depth),h.maxFontSize>r&&(r=h.maxFontSize)}e.height=t,e.depth=i,e.maxFontSize=r},Ca=function(e,t,i,r){var l=new em(e,t,i,r);return Nw(l),l},r7=(n,e,t,i)=>new em(n,e,t,i),WW=function(e,t,i){var r=Ca([e],[],t);return r.height=Math.max(i||t.fontMetrics().defaultRuleThickness,t.minRuleThickness),r.style.borderBottomWidth=$t(r.height),r.maxFontSize=1,r},qW=function(e,t,i,r){var l=new Fw(e,t,i,r);return Nw(l),l},a7=function(e){var t=new Qp(e);return Nw(t),t},$W=function(e,t){return e instanceof Qp?Ca([],[e],t):e},XW=function(e){if(e.positionType==="individualShift"){for(var t=e.children,i=[t[0]],r=-t[0].shift-t[0].elem.depth,l=r,h=1;h<t.length;h++){var o=-t[h].shift-l-t[h].elem.depth,p=o-(t[h-1].elem.height+t[h-1].elem.depth);l=l+o,i.push({type:"kern",size:p}),i.push(t[h])}return{children:i,depth:r}}var v;if(e.positionType==="top"){for(var x=e.positionData,M=0;M<e.children.length;M++){var S=e.children[M];x-=S.type==="kern"?S.size:S.elem.height+S.elem.depth}v=x}else if(e.positionType==="bottom")v=-e.positionData;else{var A=e.children[0];if(A.type!=="elem")throw new Error('First child must have type "elem".');if(e.positionType==="shift")v=-A.elem.depth-e.positionData;else if(e.positionType==="firstBaseline")v=-A.elem.depth;else throw new Error("Invalid positionType "+e.positionType+".")}return{children:e.children,depth:v}},ZW=function(e,t){for(var{children:i,depth:r}=XW(e),l=0,h=0;h<i.length;h++){var o=i[h];if(o.type==="elem"){var p=o.elem;l=Math.max(l,p.maxFontSize,p.height)}}l+=2;var v=Ca(["pstrut"],[]);v.style.height=$t(l);for(var x=[],M=r,S=r,A=r,L=0;L<i.length;L++){var F=i[L];if(F.type==="kern")A+=F.size;else{var k=F.elem,C=F.wrapperClasses||[],V=F.wrapperStyle||{},O=Ca(C,[v,k],void 0,V);O.style.top=$t(-l-A-k.depth),F.marginLeft&&(O.style.marginLeft=F.marginLeft),F.marginRight&&(O.style.marginRight=F.marginRight),x.push(O),A+=k.height+k.depth}M=Math.min(M,A),S=Math.max(S,A)}var J=Ca(["vlist"],x);J.style.height=$t(S);var ue;if(M<0){var Y=Ca([],[]),Q=Ca(["vlist"],[Y]);Q.style.height=$t(-M);var xe=Ca(["vlist-s"],[new As("​")]);ue=[Ca(["vlist-r"],[J,xe]),Ca(["vlist-r"],[Q])]}else ue=[Ca(["vlist-r"],[J])];var re=Ca(["vlist-t"],ue);return ue.length===2&&re.classes.push("vlist-t2"),re.height=S,re.depth=-M,re},YW=(n,e)=>{var t=Ca(["mspace"],[],e),i=Zi(n,e);return t.style.marginRight=$t(i),t},a1=function(e,t,i){var r="";switch(e){case"amsrm":r="AMS";break;case"textrm":r="Main";break;case"textsf":r="SansSerif";break;case"texttt":r="Typewriter";break;default:r=e}var l;return t==="textbf"&&i==="textit"?l="BoldItalic":t==="textbf"?l="Bold":t==="textit"?l="Italic":l="Regular",r+"-"+l},s7={mathbf:{variant:"bold",fontName:"Main-Bold"},mathrm:{variant:"normal",fontName:"Main-Regular"},textit:{variant:"italic",fontName:"Main-Italic"},mathit:{variant:"italic",fontName:"Main-Italic"},mathnormal:{variant:"italic",fontName:"Math-Italic"},mathbb:{variant:"double-struck",fontName:"AMS-Regular"},mathcal:{variant:"script",fontName:"Caligraphic-Regular"},mathfrak:{variant:"fraktur",fontName:"Fraktur-Regular"},mathscr:{variant:"script",fontName:"Script-Regular"},mathsf:{variant:"sans-serif",fontName:"SansSerif-Regular"},mathtt:{variant:"monospace",fontName:"Typewriter-Regular"}},o7={vec:["vec",.471,.714],oiintSize1:["oiintSize1",.957,.499],oiintSize2:["oiintSize2",1.472,.659],oiiintSize1:["oiiintSize1",1.304,.499],oiiintSize2:["oiiintSize2",1.98,.659]},KW=function(e,t){var[i,r,l]=o7[e],h=new Fc(i),o=new wl([h],{width:$t(r),height:$t(l),style:"width:"+$t(r),viewBox:"0 0 "+1e3*r+" "+1e3*l,preserveAspectRatio:"xMinYMin"}),p=r7(["overlay"],[o],t);return p.height=l,p.style.height=$t(l),p.style.width=$t(r),p},et={fontMap:s7,makeSymbol:js,mathsym:UW,makeSpan:Ca,makeSvgSpan:r7,makeLineSpan:WW,makeAnchor:qW,makeFragment:a7,wrapFragment:$W,makeVList:ZW,makeOrd:HW,makeGlue:YW,staticSvg:KW,svgData:o7,tryCombineChars:jW},$i={number:3,unit:"mu"},xu={number:4,unit:"mu"},nl={number:5,unit:"mu"},JW={mord:{mop:$i,mbin:xu,mrel:nl,minner:$i},mop:{mord:$i,mop:$i,mrel:nl,minner:$i},mbin:{mord:xu,mop:xu,mopen:xu,minner:xu},mrel:{mord:nl,mop:nl,mopen:nl,minner:nl},mopen:{},mclose:{mop:$i,mbin:xu,mrel:nl,minner:$i},mpunct:{mord:$i,mop:$i,mrel:nl,mopen:$i,mclose:$i,mpunct:$i,minner:$i},minner:{mord:$i,mop:$i,mbin:xu,mrel:nl,mopen:$i,mpunct:$i,minner:$i}},QW={mord:{mop:$i},mop:{mord:$i,mop:$i},mbin:{},mrel:{},mopen:{},mclose:{mop:$i},mpunct:{},minner:{mop:$i}},l7={},wy={},Sy={};function cn(n){for(var{type:e,names:t,props:i,handler:r,htmlBuilder:l,mathmlBuilder:h}=n,o={type:e,numArgs:i.numArgs,argTypes:i.argTypes,allowedInArgument:!!i.allowedInArgument,allowedInText:!!i.allowedInText,allowedInMath:i.allowedInMath===void 0?!0:i.allowedInMath,numOptionalArgs:i.numOptionalArgs||0,infix:!!i.infix,primitive:!!i.primitive,handler:r},p=0;p<t.length;++p)l7[t[p]]=o;e&&(l&&(wy[e]=l),h&&(Sy[e]=h))}function Qu(n){var{type:e,htmlBuilder:t,mathmlBuilder:i}=n;cn({type:e,names:[],props:{numArgs:0},handler(){throw new Error("Should never be called.")},htmlBuilder:t,mathmlBuilder:i})}var My=function(e){return e.type==="ordgroup"&&e.body.length===1?e.body[0]:e},fr=function(e){return e.type==="ordgroup"?e.body:[e]},Sl=et.makeSpan,eq=["leftmost","mbin","mopen","mrel","mop","mpunct"],tq=["rightmost","mrel","mclose","mpunct"],nq={display:Ln.DISPLAY,text:Ln.TEXT,script:Ln.SCRIPT,scriptscript:Ln.SCRIPTSCRIPT},iq={mord:"mord",mop:"mop",mbin:"mbin",mrel:"mrel",mopen:"mopen",mclose:"mclose",mpunct:"mpunct",minner:"minner"},Tr=function(e,t,i,r){r===void 0&&(r=[null,null]);for(var l=[],h=0;h<e.length;h++){var o=hi(e[h],t);if(o instanceof Qp){var p=o.children;l.push(...p)}else l.push(o)}if(et.tryCombineChars(l),!i)return l;var v=t;if(e.length===1){var x=e[0];x.type==="sizing"?v=t.havingSize(x.size):x.type==="styling"&&(v=t.havingStyle(nq[x.style]))}var M=Sl([r[0]||"leftmost"],[],t),S=Sl([r[1]||"rightmost"],[],t),A=i==="root";return ST(l,(L,F)=>{var k=F.classes[0],C=L.classes[0];k==="mbin"&&kn.contains(tq,C)?F.classes[0]="mord":C==="mbin"&&kn.contains(eq,k)&&(L.classes[0]="mord")},{node:M},S,A),ST(l,(L,F)=>{var k=cb(F),C=cb(L),V=k&&C?L.hasClass("mtight")?QW[k][C]:JW[k][C]:null;if(V)return et.makeGlue(V,v)},{node:M},S,A),l},ST=function n(e,t,i,r,l){r&&e.push(r);for(var h=0;h<e.length;h++){var o=e[h],p=c7(o);if(p){n(p.children,t,i,null,l);continue}var v=!o.hasClass("mspace");if(v){var x=t(o,i.node);x&&(i.insertAfter?i.insertAfter(x):(e.unshift(x),h++))}v?i.node=o:l&&o.hasClass("newline")&&(i.node=Sl(["leftmost"])),i.insertAfter=(M=>S=>{e.splice(M+1,0,S),h++})(h)}r&&e.pop()},c7=function(e){return e instanceof Qp||e instanceof Fw||e instanceof em&&e.hasClass("enclosing")?e:null},rq=function n(e,t){var i=c7(e);if(i){var r=i.children;if(r.length){if(t==="right")return n(r[r.length-1],"right");if(t==="left")return n(r[0],"left")}}return e},cb=function(e,t){return e?(t&&(e=rq(e,t)),iq[e.classes[0]]||null):null},Bp=function(e,t){var i=["nulldelimiter"].concat(e.baseSizingClasses());return Sl(t.concat(i))},hi=function(e,t,i){if(!e)return Sl();if(wy[e.type]){var r=wy[e.type](e,t);if(i&&t.size!==i.size){r=Sl(t.sizingClasses(i),[r],t);var l=t.sizeMultiplier/i.sizeMultiplier;r.height*=l,r.depth*=l}return r}else throw new Ut("Got group of unknown type: '"+e.type+"'")};function s1(n,e){var t=Sl(["base"],n,e),i=Sl(["strut"]);return i.style.height=$t(t.height+t.depth),t.depth&&(i.style.verticalAlign=$t(-t.depth)),t.children.unshift(i),t}function ub(n,e){var t=null;n.length===1&&n[0].type==="tag"&&(t=n[0].tag,n=n[0].body);var i=Tr(n,e,"root"),r;i.length===2&&i[1].hasClass("tag")&&(r=i.pop());for(var l=[],h=[],o=0;o<i.length;o++)if(h.push(i[o]),i[o].hasClass("mbin")||i[o].hasClass("mrel")||i[o].hasClass("allowbreak")){for(var p=!1;o<i.length-1&&i[o+1].hasClass("mspace")&&!i[o+1].hasClass("newline");)o++,h.push(i[o]),i[o].hasClass("nobreak")&&(p=!0);p||(l.push(s1(h,e)),h=[])}else i[o].hasClass("newline")&&(h.pop(),h.length>0&&(l.push(s1(h,e)),h=[]),l.push(i[o]));h.length>0&&l.push(s1(h,e));var v;t?(v=s1(Tr(t,e,!0)),v.classes=["tag"],l.push(v)):r&&l.push(r);var x=Sl(["katex-html"],l);if(x.setAttribute("aria-hidden","true"),v){var M=v.children[0];M.style.height=$t(x.height+x.depth),x.depth&&(M.style.verticalAlign=$t(-x.depth))}return x}function u7(n){return new Qp(n)}class vs{constructor(e,t,i){this.type=void 0,this.attributes=void 0,this.children=void 0,this.classes=void 0,this.type=e,this.attributes={},this.children=t||[],this.classes=i||[]}setAttribute(e,t){this.attributes[e]=t}getAttribute(e){return this.attributes[e]}toNode(){var e=document.createElementNS("http://www.w3.org/1998/Math/MathML",this.type);for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&e.setAttribute(t,this.attributes[t]);this.classes.length>0&&(e.className=zc(this.classes));for(var i=0;i<this.children.length;i++)e.appendChild(this.children[i].toNode());return e}toMarkup(){var e="<"+this.type;for(var t in this.attributes)Object.prototype.hasOwnProperty.call(this.attributes,t)&&(e+=" "+t+'="',e+=kn.escape(this.attributes[t]),e+='"');this.classes.length>0&&(e+=' class ="'+kn.escape(zc(this.classes))+'"'),e+=">";for(var i=0;i<this.children.length;i++)e+=this.children[i].toMarkup();return e+="</"+this.type+">",e}toText(){return this.children.map(e=>e.toText()).join("")}}class op{constructor(e){this.text=void 0,this.text=e}toNode(){return document.createTextNode(this.text)}toMarkup(){return kn.escape(this.toText())}toText(){return this.text}}class aq{constructor(e){this.width=void 0,this.character=void 0,this.width=e,e>=.05555&&e<=.05556?this.character=" ":e>=.1666&&e<=.1667?this.character=" ":e>=.2222&&e<=.2223?this.character=" ":e>=.2777&&e<=.2778?this.character="  ":e>=-.05556&&e<=-.05555?this.character=" ⁣":e>=-.1667&&e<=-.1666?this.character=" ⁣":e>=-.2223&&e<=-.2222?this.character=" ⁣":e>=-.2778&&e<=-.2777?this.character=" ⁣":this.character=null}toNode(){if(this.character)return document.createTextNode(this.character);var e=document.createElementNS("http://www.w3.org/1998/Math/MathML","mspace");return e.setAttribute("width",$t(this.width)),e}toMarkup(){return this.character?"<mtext>"+this.character+"</mtext>":'<mspace width="'+$t(this.width)+'"/>'}toText(){return this.character?this.character:" "}}var kt={MathNode:vs,TextNode:op,SpaceNode:aq,newDocumentFragment:u7},Cs=function(e,t,i){return Di[t][e]&&Di[t][e].replace&&e.charCodeAt(0)!==55349&&!(i7.hasOwnProperty(e)&&i&&(i.fontFamily&&i.fontFamily.slice(4,6)==="tt"||i.font&&i.font.slice(4,6)==="tt"))&&(e=Di[t][e].replace),new kt.TextNode(e)},Bw=function(e){return e.length===1?e[0]:new kt.MathNode("mrow",e)},Ow=function(e,t){if(t.fontFamily==="texttt")return"monospace";if(t.fontFamily==="textsf")return t.fontShape==="textit"&&t.fontWeight==="textbf"?"sans-serif-bold-italic":t.fontShape==="textit"?"sans-serif-italic":t.fontWeight==="textbf"?"bold-sans-serif":"sans-serif";if(t.fontShape==="textit"&&t.fontWeight==="textbf")return"bold-italic";if(t.fontShape==="textit")return"italic";if(t.fontWeight==="textbf")return"bold";var i=t.font;if(!i||i==="mathnormal")return null;var r=e.mode;if(i==="mathit")return"italic";if(i==="boldsymbol")return e.type==="textord"?"bold":"bold-italic";if(i==="mathbf")return"bold";if(i==="mathbb")return"double-struck";if(i==="mathfrak")return"fraktur";if(i==="mathscr"||i==="mathcal")return"script";if(i==="mathsf")return"sans-serif";if(i==="mathtt")return"monospace";var l=e.text;if(kn.contains(["\\imath","\\jmath"],l))return null;Di[r][l]&&Di[r][l].replace&&(l=Di[r][l].replace);var h=et.fontMap[i].fontName;return zw(l,h,r)?et.fontMap[i].variant:null},Na=function(e,t,i){if(e.length===1){var r=Pi(e[0],t);return i&&r instanceof vs&&r.type==="mo"&&(r.setAttribute("lspace","0em"),r.setAttribute("rspace","0em")),[r]}for(var l=[],h,o=0;o<e.length;o++){var p=Pi(e[o],t);if(p instanceof vs&&h instanceof vs){if(p.type==="mtext"&&h.type==="mtext"&&p.getAttribute("mathvariant")===h.getAttribute("mathvariant")){h.children.push(...p.children);continue}else if(p.type==="mn"&&h.type==="mn"){h.children.push(...p.children);continue}else if(p.type==="mi"&&p.children.length===1&&h.type==="mn"){var v=p.children[0];if(v instanceof op&&v.text==="."){h.children.push(...p.children);continue}}else if(h.type==="mi"&&h.children.length===1){var x=h.children[0];if(x instanceof op&&x.text==="̸"&&(p.type==="mo"||p.type==="mi"||p.type==="mn")){var M=p.children[0];M instanceof op&&M.text.length>0&&(M.text=M.text.slice(0,1)+"̸"+M.text.slice(1),l.pop())}}}l.push(p),h=p}return l},Nc=function(e,t,i){return Bw(Na(e,t,i))},Pi=function(e,t){if(!e)return new kt.MathNode("mrow");if(Sy[e.type]){var i=Sy[e.type](e,t);return i}else throw new Ut("Got group of unknown type: '"+e.type+"'")};function MT(n,e,t,i,r){var l=Na(n,t),h;l.length===1&&l[0]instanceof vs&&kn.contains(["mrow","mtable"],l[0].type)?h=l[0]:h=new kt.MathNode("mrow",l);var o=new kt.MathNode("annotation",[new kt.TextNode(e)]);o.setAttribute("encoding","application/x-tex");var p=new kt.MathNode("semantics",[h,o]),v=new kt.MathNode("math",[p]);v.setAttribute("xmlns","http://www.w3.org/1998/Math/MathML"),i&&v.setAttribute("display","block");var x=r?"katex":"katex-mathml";return et.makeSpan([x],[v])}var h7=function(e){return new ol({style:e.displayMode?Ln.DISPLAY:Ln.TEXT,maxSize:e.maxSize,minRuleThickness:e.minRuleThickness})},d7=function(e,t){if(t.displayMode){var i=["katex-display"];t.leqno&&i.push("leqno"),t.fleqn&&i.push("fleqn"),e=et.makeSpan(i,[e])}return e},sq=function(e,t,i){var r=h7(i),l;if(i.output==="mathml")return MT(e,t,r,i.displayMode,!0);if(i.output==="html"){var h=ub(e,r);l=et.makeSpan(["katex"],[h])}else{var o=MT(e,t,r,i.displayMode,!1),p=ub(e,r);l=et.makeSpan(["katex"],[o,p])}return d7(l,i)},oq=function(e,t,i){var r=h7(i),l=ub(e,r),h=et.makeSpan(["katex"],[l]);return d7(h,i)},lq={widehat:"^",widecheck:"ˇ",widetilde:"~",utilde:"~",overleftarrow:"←",underleftarrow:"←",xleftarrow:"←",overrightarrow:"→",underrightarrow:"→",xrightarrow:"→",underbrace:"⏟",overbrace:"⏞",overgroup:"⏠",undergroup:"⏡",overleftrightarrow:"↔",underleftrightarrow:"↔",xleftrightarrow:"↔",Overrightarrow:"⇒",xRightarrow:"⇒",overleftharpoon:"↼",xleftharpoonup:"↼",overrightharpoon:"⇀",xrightharpoonup:"⇀",xLeftarrow:"⇐",xLeftrightarrow:"⇔",xhookleftarrow:"↩",xhookrightarrow:"↪",xmapsto:"↦",xrightharpoondown:"⇁",xleftharpoondown:"↽",xrightleftharpoons:"⇌",xleftrightharpoons:"⇋",xtwoheadleftarrow:"↞",xtwoheadrightarrow:"↠",xlongequal:"=",xtofrom:"⇄",xrightleftarrows:"⇄",xrightequilibrium:"⇌",xleftequilibrium:"⇋","\\cdrightarrow":"→","\\cdleftarrow":"←","\\cdlongequal":"="},cq=function(e){var t=new kt.MathNode("mo",[new kt.TextNode(lq[e.replace(/^\\/,"")])]);return t.setAttribute("stretchy","true"),t},uq={overrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],overleftarrow:[["leftarrow"],.888,522,"xMinYMin"],underrightarrow:[["rightarrow"],.888,522,"xMaxYMin"],underleftarrow:[["leftarrow"],.888,522,"xMinYMin"],xrightarrow:[["rightarrow"],1.469,522,"xMaxYMin"],"\\cdrightarrow":[["rightarrow"],3,522,"xMaxYMin"],xleftarrow:[["leftarrow"],1.469,522,"xMinYMin"],"\\cdleftarrow":[["leftarrow"],3,522,"xMinYMin"],Overrightarrow:[["doublerightarrow"],.888,560,"xMaxYMin"],xRightarrow:[["doublerightarrow"],1.526,560,"xMaxYMin"],xLeftarrow:[["doubleleftarrow"],1.526,560,"xMinYMin"],overleftharpoon:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoonup:[["leftharpoon"],.888,522,"xMinYMin"],xleftharpoondown:[["leftharpoondown"],.888,522,"xMinYMin"],overrightharpoon:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoonup:[["rightharpoon"],.888,522,"xMaxYMin"],xrightharpoondown:[["rightharpoondown"],.888,522,"xMaxYMin"],xlongequal:[["longequal"],.888,334,"xMinYMin"],"\\cdlongequal":[["longequal"],3,334,"xMinYMin"],xtwoheadleftarrow:[["twoheadleftarrow"],.888,334,"xMinYMin"],xtwoheadrightarrow:[["twoheadrightarrow"],.888,334,"xMaxYMin"],overleftrightarrow:[["leftarrow","rightarrow"],.888,522],overbrace:[["leftbrace","midbrace","rightbrace"],1.6,548],underbrace:[["leftbraceunder","midbraceunder","rightbraceunder"],1.6,548],underleftrightarrow:[["leftarrow","rightarrow"],.888,522],xleftrightarrow:[["leftarrow","rightarrow"],1.75,522],xLeftrightarrow:[["doubleleftarrow","doublerightarrow"],1.75,560],xrightleftharpoons:[["leftharpoondownplus","rightharpoonplus"],1.75,716],xleftrightharpoons:[["leftharpoonplus","rightharpoondownplus"],1.75,716],xhookleftarrow:[["leftarrow","righthook"],1.08,522],xhookrightarrow:[["lefthook","rightarrow"],1.08,522],overlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],underlinesegment:[["leftlinesegment","rightlinesegment"],.888,522],overgroup:[["leftgroup","rightgroup"],.888,342],undergroup:[["leftgroupunder","rightgroupunder"],.888,342],xmapsto:[["leftmapsto","rightarrow"],1.5,522],xtofrom:[["leftToFrom","rightToFrom"],1.75,528],xrightleftarrows:[["baraboveleftarrow","rightarrowabovebar"],1.75,901],xrightequilibrium:[["baraboveshortleftharpoon","rightharpoonaboveshortbar"],1.75,716],xleftequilibrium:[["shortbaraboveleftharpoon","shortrightharpoonabovebar"],1.75,716]},hq=function(e){return e.type==="ordgroup"?e.body.length:1},dq=function(e,t){function i(){var o=4e5,p=e.label.slice(1);if(kn.contains(["widehat","widecheck","widetilde","utilde"],p)){var v=e,x=hq(v.base),M,S,A;if(x>5)p==="widehat"||p==="widecheck"?(M=420,o=2364,A=.42,S=p+"4"):(M=312,o=2340,A=.34,S="tilde4");else{var L=[1,1,2,2,3,3][x];p==="widehat"||p==="widecheck"?(o=[0,1062,2364,2364,2364][L],M=[0,239,300,360,420][L],A=[0,.24,.3,.3,.36,.42][L],S=p+L):(o=[0,600,1033,2339,2340][L],M=[0,260,286,306,312][L],A=[0,.26,.286,.3,.306,.34][L],S="tilde"+L)}var F=new Fc(S),k=new wl([F],{width:"100%",height:$t(A),viewBox:"0 0 "+o+" "+M,preserveAspectRatio:"none"});return{span:et.makeSvgSpan([],[k],t),minWidth:0,height:A}}else{var C=[],V=uq[p],[O,J,ue]=V,Y=ue/1e3,Q=O.length,xe,re;if(Q===1){var ee=V[3];xe=["hide-tail"],re=[ee]}else if(Q===2)xe=["halfarrow-left","halfarrow-right"],re=["xMinYMin","xMaxYMin"];else if(Q===3)xe=["brace-left","brace-center","brace-right"],re=["xMinYMin","xMidYMin","xMaxYMin"];else throw new Error(`Correct katexImagesData or update code here to support
                    `+Q+" children.");for(var Me=0;Me<Q;Me++){var Fe=new Fc(O[Me]),Ae=new wl([Fe],{width:"400em",height:$t(Y),viewBox:"0 0 "+o+" "+ue,preserveAspectRatio:re[Me]+" slice"}),He=et.makeSvgSpan([xe[Me]],[Ae],t);if(Q===1)return{span:He,minWidth:J,height:Y};He.style.height=$t(Y),C.push(He)}return{span:et.makeSpan(["stretchy"],C,t),minWidth:J,height:Y}}}var{span:r,minWidth:l,height:h}=i();return r.height=h,r.style.height=$t(h),l>0&&(r.style.minWidth=$t(l)),r},fq=function(e,t,i,r,l){var h,o=e.height+e.depth+i+r;if(/fbox|color|angl/.test(t)){if(h=et.makeSpan(["stretchy",t],[],l),t==="fbox"){var p=l.color&&l.getColor();p&&(h.style.borderColor=p)}}else{var v=[];/^[bx]cancel$/.test(t)&&v.push(new ob({x1:"0",y1:"0",x2:"100%",y2:"100%","stroke-width":"0.046em"})),/^x?cancel$/.test(t)&&v.push(new ob({x1:"0",y1:"100%",x2:"100%",y2:"0","stroke-width":"0.046em"}));var x=new wl(v,{width:"100%",height:$t(o)});h=et.makeSvgSpan([],[x],l)}return h.height=o,h.style.height=$t(o),h},Ml={encloseSpan:fq,mathMLnode:cq,svgSpan:dq};function Yn(n,e){if(!n||n.type!==e)throw new Error("Expected node of type "+e+", but got "+(n?"node of type "+n.type:String(n)));return n}function Uw(n){var e=nv(n);if(!e)throw new Error("Expected node of symbol group type, but got "+(n?"node of type "+n.type:String(n)));return e}function nv(n){return n&&(n.type==="atom"||BW.hasOwnProperty(n.type))?n:null}var Vw=(n,e)=>{var t,i,r;n&&n.type==="supsub"?(i=Yn(n.base,"accent"),t=i.base,n.base=t,r=FW(hi(n,e)),n.base=i):(i=Yn(n,"accent"),t=i.base);var l=hi(t,e.havingCrampedStyle()),h=i.isShifty&&kn.isCharacterBox(t),o=0;if(h){var p=kn.getBaseElem(t),v=hi(p,e.havingCrampedStyle());o=yT(v).skew}var x=i.label==="\\c",M=x?l.height+l.depth:Math.min(l.height,e.fontMetrics().xHeight),S;if(i.isStretchy)S=Ml.svgSpan(i,e),S=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"elem",elem:S,wrapperClasses:["svg-align"],wrapperStyle:o>0?{width:"calc(100% - "+$t(2*o)+")",marginLeft:$t(2*o)}:void 0}]},e);else{var A,L;i.label==="\\vec"?(A=et.staticSvg("vec",e),L=et.svgData.vec[1]):(A=et.makeOrd({mode:i.mode,text:i.label},e,"textord"),A=yT(A),A.italic=0,L=A.width,x&&(M+=A.depth)),S=et.makeSpan(["accent-body"],[A]);var F=i.label==="\\textcircled";F&&(S.classes.push("accent-full"),M=l.height);var k=o;F||(k-=L/2),S.style.left=$t(k),i.label==="\\textcircled"&&(S.style.top=".2em"),S=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:-M},{type:"elem",elem:S}]},e)}var C=et.makeSpan(["mord","accent"],[S],e);return r?(r.children[0]=C,r.height=Math.max(C.height,r.height),r.classes[0]="mord",r):C},f7=(n,e)=>{var t=n.isStretchy?Ml.mathMLnode(n.label):new kt.MathNode("mo",[Cs(n.label,n.mode)]),i=new kt.MathNode("mover",[Pi(n.base,e),t]);return i.setAttribute("accent","true"),i},pq=new RegExp(["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring"].map(n=>"\\"+n).join("|"));cn({type:"accent",names:["\\acute","\\grave","\\ddot","\\tilde","\\bar","\\breve","\\check","\\hat","\\vec","\\dot","\\mathring","\\widecheck","\\widehat","\\widetilde","\\overrightarrow","\\overleftarrow","\\Overrightarrow","\\overleftrightarrow","\\overgroup","\\overlinesegment","\\overleftharpoon","\\overrightharpoon"],props:{numArgs:1},handler:(n,e)=>{var t=My(e[0]),i=!pq.test(n.funcName),r=!i||n.funcName==="\\widehat"||n.funcName==="\\widetilde"||n.funcName==="\\widecheck";return{type:"accent",mode:n.parser.mode,label:n.funcName,isStretchy:i,isShifty:r,base:t}},htmlBuilder:Vw,mathmlBuilder:f7});cn({type:"accent",names:["\\'","\\`","\\^","\\~","\\=","\\u","\\.",'\\"',"\\c","\\r","\\H","\\v","\\textcircled"],props:{numArgs:1,allowedInText:!0,allowedInMath:!0,argTypes:["primitive"]},handler:(n,e)=>{var t=e[0],i=n.parser.mode;return i==="math"&&(n.parser.settings.reportNonstrict("mathVsTextAccents","LaTeX's accent "+n.funcName+" works only in text mode"),i="text"),{type:"accent",mode:i,label:n.funcName,isStretchy:!1,isShifty:!0,base:t}},htmlBuilder:Vw,mathmlBuilder:f7});cn({type:"accentUnder",names:["\\underleftarrow","\\underrightarrow","\\underleftrightarrow","\\undergroup","\\underlinesegment","\\utilde"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0];return{type:"accentUnder",mode:t.mode,label:i,base:r}},htmlBuilder:(n,e)=>{var t=hi(n.base,e),i=Ml.svgSpan(n,e),r=n.label==="\\utilde"?.12:0,l=et.makeVList({positionType:"top",positionData:t.height,children:[{type:"elem",elem:i,wrapperClasses:["svg-align"]},{type:"kern",size:r},{type:"elem",elem:t}]},e);return et.makeSpan(["mord","accentunder"],[l],e)},mathmlBuilder:(n,e)=>{var t=Ml.mathMLnode(n.label),i=new kt.MathNode("munder",[Pi(n.base,e),t]);return i.setAttribute("accentunder","true"),i}});var o1=n=>{var e=new kt.MathNode("mpadded",n?[n]:[]);return e.setAttribute("width","+0.6em"),e.setAttribute("lspace","0.3em"),e};cn({type:"xArrow",names:["\\xleftarrow","\\xrightarrow","\\xLeftarrow","\\xRightarrow","\\xleftrightarrow","\\xLeftrightarrow","\\xhookleftarrow","\\xhookrightarrow","\\xmapsto","\\xrightharpoondown","\\xrightharpoonup","\\xleftharpoondown","\\xleftharpoonup","\\xrightleftharpoons","\\xleftrightharpoons","\\xlongequal","\\xtwoheadrightarrow","\\xtwoheadleftarrow","\\xtofrom","\\xrightleftarrows","\\xrightequilibrium","\\xleftequilibrium","\\\\cdrightarrow","\\\\cdleftarrow","\\\\cdlongequal"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:i,funcName:r}=n;return{type:"xArrow",mode:i.mode,label:r,body:e[0],below:t[0]}},htmlBuilder(n,e){var t=e.style,i=e.havingStyle(t.sup()),r=et.wrapFragment(hi(n.body,i,e),e),l=n.label.slice(0,2)==="\\x"?"x":"cd";r.classes.push(l+"-arrow-pad");var h;n.below&&(i=e.havingStyle(t.sub()),h=et.wrapFragment(hi(n.below,i,e),e),h.classes.push(l+"-arrow-pad"));var o=Ml.svgSpan(n,e),p=-e.fontMetrics().axisHeight+.5*o.height,v=-e.fontMetrics().axisHeight-.5*o.height-.111;(r.depth>.25||n.label==="\\xleftequilibrium")&&(v-=r.depth);var x;if(h){var M=-e.fontMetrics().axisHeight+h.height+.5*o.height+.111;x=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:r,shift:v},{type:"elem",elem:o,shift:p},{type:"elem",elem:h,shift:M}]},e)}else x=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:r,shift:v},{type:"elem",elem:o,shift:p}]},e);return x.children[0].children[0].children[1].classes.push("svg-align"),et.makeSpan(["mrel","x-arrow"],[x],e)},mathmlBuilder(n,e){var t=Ml.mathMLnode(n.label);t.setAttribute("minsize",n.label.charAt(0)==="x"?"1.75em":"3.0em");var i;if(n.body){var r=o1(Pi(n.body,e));if(n.below){var l=o1(Pi(n.below,e));i=new kt.MathNode("munderover",[t,l,r])}else i=new kt.MathNode("mover",[t,r])}else if(n.below){var h=o1(Pi(n.below,e));i=new kt.MathNode("munder",[t,h])}else i=o1(),i=new kt.MathNode("mover",[t,i]);return i}});var mq=et.makeSpan;function p7(n,e){var t=Tr(n.body,e,!0);return mq([n.mclass],t,e)}function m7(n,e){var t,i=Na(n.body,e);return n.mclass==="minner"?t=new kt.MathNode("mpadded",i):n.mclass==="mord"?n.isCharacterBox?(t=i[0],t.type="mi"):t=new kt.MathNode("mi",i):(n.isCharacterBox?(t=i[0],t.type="mo"):t=new kt.MathNode("mo",i),n.mclass==="mbin"?(t.attributes.lspace="0.22em",t.attributes.rspace="0.22em"):n.mclass==="mpunct"?(t.attributes.lspace="0em",t.attributes.rspace="0.17em"):n.mclass==="mopen"||n.mclass==="mclose"?(t.attributes.lspace="0em",t.attributes.rspace="0em"):n.mclass==="minner"&&(t.attributes.lspace="0.0556em",t.attributes.width="+0.1111em")),t}cn({type:"mclass",names:["\\mathord","\\mathbin","\\mathrel","\\mathopen","\\mathclose","\\mathpunct","\\mathinner"],props:{numArgs:1,primitive:!0},handler(n,e){var{parser:t,funcName:i}=n,r=e[0];return{type:"mclass",mode:t.mode,mclass:"m"+i.slice(5),body:fr(r),isCharacterBox:kn.isCharacterBox(r)}},htmlBuilder:p7,mathmlBuilder:m7});var iv=n=>{var e=n.type==="ordgroup"&&n.body.length?n.body[0]:n;return e.type==="atom"&&(e.family==="bin"||e.family==="rel")?"m"+e.family:"mord"};cn({type:"mclass",names:["\\@binrel"],props:{numArgs:2},handler(n,e){var{parser:t}=n;return{type:"mclass",mode:t.mode,mclass:iv(e[0]),body:fr(e[1]),isCharacterBox:kn.isCharacterBox(e[1])}}});cn({type:"mclass",names:["\\stackrel","\\overset","\\underset"],props:{numArgs:2},handler(n,e){var{parser:t,funcName:i}=n,r=e[1],l=e[0],h;i!=="\\stackrel"?h=iv(r):h="mrel";var o={type:"op",mode:r.mode,limits:!0,alwaysHandleSupSub:!0,parentIsSupSub:!1,symbol:!1,suppressBaseShift:i!=="\\stackrel",body:fr(r)},p={type:"supsub",mode:l.mode,base:o,sup:i==="\\underset"?null:l,sub:i==="\\underset"?l:null};return{type:"mclass",mode:t.mode,mclass:h,body:[p],isCharacterBox:kn.isCharacterBox(p)}},htmlBuilder:p7,mathmlBuilder:m7});cn({type:"pmb",names:["\\pmb"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"pmb",mode:t.mode,mclass:iv(e[0]),body:fr(e[0])}},htmlBuilder(n,e){var t=Tr(n.body,e,!0),i=et.makeSpan([n.mclass],t,e);return i.style.textShadow="0.02em 0.01em 0.04px",i},mathmlBuilder(n,e){var t=Na(n.body,e),i=new kt.MathNode("mstyle",t);return i.setAttribute("style","text-shadow: 0.02em 0.01em 0.04px"),i}});var gq={">":"\\\\cdrightarrow","<":"\\\\cdleftarrow","=":"\\\\cdlongequal",A:"\\uparrow",V:"\\downarrow","|":"\\Vert",".":"no arrow"},TT=()=>({type:"styling",body:[],mode:"math",style:"display"}),ET=n=>n.type==="textord"&&n.text==="@",yq=(n,e)=>(n.type==="mathord"||n.type==="atom")&&n.text===e;function vq(n,e,t){var i=gq[n];switch(i){case"\\\\cdrightarrow":case"\\\\cdleftarrow":return t.callFunction(i,[e[0]],[e[1]]);case"\\uparrow":case"\\downarrow":{var r=t.callFunction("\\\\cdleft",[e[0]],[]),l={type:"atom",text:i,mode:"math",family:"rel"},h=t.callFunction("\\Big",[l],[]),o=t.callFunction("\\\\cdright",[e[1]],[]),p={type:"ordgroup",mode:"math",body:[r,h,o]};return t.callFunction("\\\\cdparent",[p],[])}case"\\\\cdlongequal":return t.callFunction("\\\\cdlongequal",[],[]);case"\\Vert":{var v={type:"textord",text:"\\Vert",mode:"math"};return t.callFunction("\\Big",[v],[])}default:return{type:"textord",text:" ",mode:"math"}}}function _q(n){var e=[];for(n.gullet.beginGroup(),n.gullet.macros.set("\\cr","\\\\\\relax"),n.gullet.beginGroup();;){e.push(n.parseExpression(!1,"\\\\")),n.gullet.endGroup(),n.gullet.beginGroup();var t=n.fetch().text;if(t==="&"||t==="\\\\")n.consume();else if(t==="\\end"){e[e.length-1].length===0&&e.pop();break}else throw new Ut("Expected \\\\ or \\cr or \\end",n.nextToken)}for(var i=[],r=[i],l=0;l<e.length;l++){for(var h=e[l],o=TT(),p=0;p<h.length;p++)if(!ET(h[p]))o.body.push(h[p]);else{i.push(o),p+=1;var v=Uw(h[p]).text,x=new Array(2);if(x[0]={type:"ordgroup",mode:"math",body:[]},x[1]={type:"ordgroup",mode:"math",body:[]},!("=|.".indexOf(v)>-1))if("<>AV".indexOf(v)>-1)for(var M=0;M<2;M++){for(var S=!0,A=p+1;A<h.length;A++){if(yq(h[A],v)){S=!1,p=A;break}if(ET(h[A]))throw new Ut("Missing a "+v+" character to complete a CD arrow.",h[A]);x[M].body.push(h[A])}if(S)throw new Ut("Missing a "+v+" character to complete a CD arrow.",h[p])}else throw new Ut('Expected one of "<>AV=|." after @',h[p]);var L=vq(v,x,n),F={type:"styling",body:[L],mode:"math",style:"display"};i.push(F),o=TT()}l%2===0?i.push(o):i.shift(),i=[],r.push(i)}n.gullet.endGroup(),n.gullet.endGroup();var k=new Array(r[0].length).fill({type:"align",align:"c",pregap:.25,postgap:.25});return{type:"array",mode:"math",body:r,arraystretch:1,addJot:!0,rowGaps:[null],cols:k,colSeparationType:"CD",hLinesBeforeRow:new Array(r.length+1).fill([])}}cn({type:"cdlabel",names:["\\\\cdleft","\\\\cdright"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:i}=n;return{type:"cdlabel",mode:t.mode,side:i.slice(4),label:e[0]}},htmlBuilder(n,e){var t=e.havingStyle(e.style.sup()),i=et.wrapFragment(hi(n.label,t,e),e);return i.classes.push("cd-label-"+n.side),i.style.bottom=$t(.8-i.depth),i.height=0,i.depth=0,i},mathmlBuilder(n,e){var t=new kt.MathNode("mrow",[Pi(n.label,e)]);return t=new kt.MathNode("mpadded",[t]),t.setAttribute("width","0"),n.side==="left"&&t.setAttribute("lspace","-1width"),t.setAttribute("voffset","0.7em"),t=new kt.MathNode("mstyle",[t]),t.setAttribute("displaystyle","false"),t.setAttribute("scriptlevel","1"),t}});cn({type:"cdlabelparent",names:["\\\\cdparent"],props:{numArgs:1},handler(n,e){var{parser:t}=n;return{type:"cdlabelparent",mode:t.mode,fragment:e[0]}},htmlBuilder(n,e){var t=et.wrapFragment(hi(n.fragment,e),e);return t.classes.push("cd-vert-arrow"),t},mathmlBuilder(n,e){return new kt.MathNode("mrow",[Pi(n.fragment,e)])}});cn({type:"textord",names:["\\@char"],props:{numArgs:1,allowedInText:!0},handler(n,e){for(var{parser:t}=n,i=Yn(e[0],"ordgroup"),r=i.body,l="",h=0;h<r.length;h++){var o=Yn(r[h],"textord");l+=o.text}var p=parseInt(l),v;if(isNaN(p))throw new Ut("\\@char has non-numeric argument "+l);if(p<0||p>=1114111)throw new Ut("\\@char with invalid code point "+l);return p<=65535?v=String.fromCharCode(p):(p-=65536,v=String.fromCharCode((p>>10)+55296,(p&1023)+56320)),{type:"textord",mode:t.mode,text:v}}});var g7=(n,e)=>{var t=Tr(n.body,e.withColor(n.color),!1);return et.makeFragment(t)},y7=(n,e)=>{var t=Na(n.body,e.withColor(n.color)),i=new kt.MathNode("mstyle",t);return i.setAttribute("mathcolor",n.color),i};cn({type:"color",names:["\\textcolor"],props:{numArgs:2,allowedInText:!0,argTypes:["color","original"]},handler(n,e){var{parser:t}=n,i=Yn(e[0],"color-token").color,r=e[1];return{type:"color",mode:t.mode,color:i,body:fr(r)}},htmlBuilder:g7,mathmlBuilder:y7});cn({type:"color",names:["\\color"],props:{numArgs:1,allowedInText:!0,argTypes:["color"]},handler(n,e){var{parser:t,breakOnTokenText:i}=n,r=Yn(e[0],"color-token").color;t.gullet.macros.set("\\current@color",r);var l=t.parseExpression(!0,i);return{type:"color",mode:t.mode,color:r,body:l}},htmlBuilder:g7,mathmlBuilder:y7});cn({type:"cr",names:["\\\\"],props:{numArgs:0,numOptionalArgs:0,allowedInText:!0},handler(n,e,t){var{parser:i}=n,r=i.gullet.future().text==="["?i.parseSizeGroup(!0):null,l=!i.settings.displayMode||!i.settings.useStrictBehavior("newLineInDisplayMode","In LaTeX, \\\\ or \\newline does nothing in display mode");return{type:"cr",mode:i.mode,newLine:l,size:r&&Yn(r,"size").value}},htmlBuilder(n,e){var t=et.makeSpan(["mspace"],[],e);return n.newLine&&(t.classes.push("newline"),n.size&&(t.style.marginTop=$t(Zi(n.size,e)))),t},mathmlBuilder(n,e){var t=new kt.MathNode("mspace");return n.newLine&&(t.setAttribute("linebreak","newline"),n.size&&t.setAttribute("height",$t(Zi(n.size,e)))),t}});var hb={"\\global":"\\global","\\long":"\\\\globallong","\\\\globallong":"\\\\globallong","\\def":"\\gdef","\\gdef":"\\gdef","\\edef":"\\xdef","\\xdef":"\\xdef","\\let":"\\\\globallet","\\futurelet":"\\\\globalfuture"},v7=n=>{var e=n.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(e))throw new Ut("Expected a control sequence",n);return e},xq=n=>{var e=n.gullet.popToken();return e.text==="="&&(e=n.gullet.popToken(),e.text===" "&&(e=n.gullet.popToken())),e},_7=(n,e,t,i)=>{var r=n.gullet.macros.get(t.text);r==null&&(t.noexpand=!0,r={tokens:[t],numArgs:0,unexpandable:!n.gullet.isExpandable(t.text)}),n.gullet.macros.set(e,r,i)};cn({type:"internal",names:["\\global","\\long","\\\\globallong"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e,funcName:t}=n;e.consumeSpaces();var i=e.fetch();if(hb[i.text])return(t==="\\global"||t==="\\\\globallong")&&(i.text=hb[i.text]),Yn(e.parseFunction(),"internal");throw new Ut("Invalid token after macro prefix",i)}});cn({type:"internal",names:["\\def","\\gdef","\\edef","\\xdef"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,i=e.gullet.popToken(),r=i.text;if(/^(?:[\\{}$&#^_]|EOF)$/.test(r))throw new Ut("Expected a control sequence",i);for(var l=0,h,o=[[]];e.gullet.future().text!=="{";)if(i=e.gullet.popToken(),i.text==="#"){if(e.gullet.future().text==="{"){h=e.gullet.future(),o[l].push("{");break}if(i=e.gullet.popToken(),!/^[1-9]$/.test(i.text))throw new Ut('Invalid argument number "'+i.text+'"');if(parseInt(i.text)!==l+1)throw new Ut('Argument number "'+i.text+'" out of order');l++,o.push([])}else{if(i.text==="EOF")throw new Ut("Expected a macro definition");o[l].push(i.text)}var{tokens:p}=e.gullet.consumeArg();return h&&p.unshift(h),(t==="\\edef"||t==="\\xdef")&&(p=e.gullet.expandTokens(p),p.reverse()),e.gullet.macros.set(r,{tokens:p,numArgs:l,delimiters:o},t===hb[t]),{type:"internal",mode:e.mode}}});cn({type:"internal",names:["\\let","\\\\globallet"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,i=v7(e.gullet.popToken());e.gullet.consumeSpaces();var r=xq(e);return _7(e,i,r,t==="\\\\globallet"),{type:"internal",mode:e.mode}}});cn({type:"internal",names:["\\futurelet","\\\\globalfuture"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n){var{parser:e,funcName:t}=n,i=v7(e.gullet.popToken()),r=e.gullet.popToken(),l=e.gullet.popToken();return _7(e,i,l,t==="\\\\globalfuture"),e.gullet.pushToken(l),e.gullet.pushToken(r),{type:"internal",mode:e.mode}}});var $0=function(e,t,i){var r=Di.math[e]&&Di.math[e].replace,l=zw(r||e,t,i);if(!l)throw new Error("Unsupported symbol "+e+" and font size "+t+".");return l},Hw=function(e,t,i,r){var l=i.havingBaseStyle(t),h=et.makeSpan(r.concat(l.sizingClasses(i)),[e],i),o=l.sizeMultiplier/i.sizeMultiplier;return h.height*=o,h.depth*=o,h.maxFontSize=l.sizeMultiplier,h},x7=function(e,t,i){var r=t.havingBaseStyle(i),l=(1-t.sizeMultiplier/r.sizeMultiplier)*t.fontMetrics().axisHeight;e.classes.push("delimcenter"),e.style.top=$t(l),e.height-=l,e.depth+=l},bq=function(e,t,i,r,l,h){var o=et.makeSymbol(e,"Main-Regular",l,r),p=Hw(o,t,r,h);return i&&x7(p,r,t),p},wq=function(e,t,i,r){return et.makeSymbol(e,"Size"+t+"-Regular",i,r)},b7=function(e,t,i,r,l,h){var o=wq(e,t,l,r),p=Hw(et.makeSpan(["delimsizing","size"+t],[o],r),Ln.TEXT,r,h);return i&&x7(p,r,Ln.TEXT),p},Ix=function(e,t,i){var r;t==="Size1-Regular"?r="delim-size1":r="delim-size4";var l=et.makeSpan(["delimsizinginner",r],[et.makeSpan([],[et.makeSymbol(e,t,i)])]);return{type:"elem",elem:l}},kx=function(e,t,i){var r=xo["Size4-Regular"][e.charCodeAt(0)]?xo["Size4-Regular"][e.charCodeAt(0)][4]:xo["Size1-Regular"][e.charCodeAt(0)][4],l=new Fc("inner",CW(e,Math.round(1e3*t))),h=new wl([l],{width:$t(r),height:$t(t),style:"width:"+$t(r),viewBox:"0 0 "+1e3*r+" "+Math.round(1e3*t),preserveAspectRatio:"xMinYMin"}),o=et.makeSvgSpan([],[h],i);return o.height=t,o.style.height=$t(t),o.style.width=$t(r),{type:"elem",elem:o}},db=.008,l1={type:"kern",size:-1*db},Sq=["|","\\lvert","\\rvert","\\vert"],Mq=["\\|","\\lVert","\\rVert","\\Vert"],w7=function(e,t,i,r,l,h){var o,p,v,x,M="",S=0;o=v=x=e,p=null;var A="Size1-Regular";e==="\\uparrow"?v=x="⏐":e==="\\Uparrow"?v=x="‖":e==="\\downarrow"?o=v="⏐":e==="\\Downarrow"?o=v="‖":e==="\\updownarrow"?(o="\\uparrow",v="⏐",x="\\downarrow"):e==="\\Updownarrow"?(o="\\Uparrow",v="‖",x="\\Downarrow"):kn.contains(Sq,e)?(v="∣",M="vert",S=333):kn.contains(Mq,e)?(v="∥",M="doublevert",S=556):e==="["||e==="\\lbrack"?(o="⎡",v="⎢",x="⎣",A="Size4-Regular",M="lbrack",S=667):e==="]"||e==="\\rbrack"?(o="⎤",v="⎥",x="⎦",A="Size4-Regular",M="rbrack",S=667):e==="\\lfloor"||e==="⌊"?(v=o="⎢",x="⎣",A="Size4-Regular",M="lfloor",S=667):e==="\\lceil"||e==="⌈"?(o="⎡",v=x="⎢",A="Size4-Regular",M="lceil",S=667):e==="\\rfloor"||e==="⌋"?(v=o="⎥",x="⎦",A="Size4-Regular",M="rfloor",S=667):e==="\\rceil"||e==="⌉"?(o="⎤",v=x="⎥",A="Size4-Regular",M="rceil",S=667):e==="("||e==="\\lparen"?(o="⎛",v="⎜",x="⎝",A="Size4-Regular",M="lparen",S=875):e===")"||e==="\\rparen"?(o="⎞",v="⎟",x="⎠",A="Size4-Regular",M="rparen",S=875):e==="\\{"||e==="\\lbrace"?(o="⎧",p="⎨",x="⎩",v="⎪",A="Size4-Regular"):e==="\\}"||e==="\\rbrace"?(o="⎫",p="⎬",x="⎭",v="⎪",A="Size4-Regular"):e==="\\lgroup"||e==="⟮"?(o="⎧",x="⎩",v="⎪",A="Size4-Regular"):e==="\\rgroup"||e==="⟯"?(o="⎫",x="⎭",v="⎪",A="Size4-Regular"):e==="\\lmoustache"||e==="⎰"?(o="⎧",x="⎭",v="⎪",A="Size4-Regular"):(e==="\\rmoustache"||e==="⎱")&&(o="⎫",x="⎩",v="⎪",A="Size4-Regular");var L=$0(o,A,l),F=L.height+L.depth,k=$0(v,A,l),C=k.height+k.depth,V=$0(x,A,l),O=V.height+V.depth,J=0,ue=1;if(p!==null){var Y=$0(p,A,l);J=Y.height+Y.depth,ue=2}var Q=F+O+J,xe=Math.max(0,Math.ceil((t-Q)/(ue*C))),re=Q+xe*ue*C,ee=r.fontMetrics().axisHeight;i&&(ee*=r.sizeMultiplier);var Me=re/2-ee,Fe=[];if(M.length>0){var Ae=re-F-O,He=Math.round(re*1e3),ot=PW(M,Math.round(Ae*1e3)),ft=new Fc(M,ot),ct=(S/1e3).toFixed(3)+"em",De=(He/1e3).toFixed(3)+"em",Je=new wl([ft],{width:ct,height:De,viewBox:"0 0 "+S+" "+He}),tt=et.makeSvgSpan([],[Je],r);tt.height=He/1e3,tt.style.width=ct,tt.style.height=De,Fe.push({type:"elem",elem:tt})}else{if(Fe.push(Ix(x,A,l)),Fe.push(l1),p===null){var _t=re-F-O+2*db;Fe.push(kx(v,_t,r))}else{var Lt=(re-F-O-J)/2+2*db;Fe.push(kx(v,Lt,r)),Fe.push(l1),Fe.push(Ix(p,A,l)),Fe.push(l1),Fe.push(kx(v,Lt,r))}Fe.push(l1),Fe.push(Ix(o,A,l))}var Cn=r.havingBaseStyle(Ln.TEXT),nt=et.makeVList({positionType:"bottom",positionData:Me,children:Fe},Cn);return Hw(et.makeSpan(["delimsizing","mult"],[nt],Cn),Ln.TEXT,r,h)},Dx=80,Lx=.08,zx=function(e,t,i,r,l){var h=AW(e,r,i),o=new Fc(e,h),p=new wl([o],{width:"400em",height:$t(t),viewBox:"0 0 400000 "+i,preserveAspectRatio:"xMinYMin slice"});return et.makeSvgSpan(["hide-tail"],[p],l)},Tq=function(e,t){var i=t.havingBaseSizing(),r=E7("\\surd",e*i.sizeMultiplier,T7,i),l=i.sizeMultiplier,h=Math.max(0,t.minRuleThickness-t.fontMetrics().sqrtRuleThickness),o,p=0,v=0,x=0,M;return r.type==="small"?(x=1e3+1e3*h+Dx,e<1?l=1:e<1.4&&(l=.7),p=(1+h+Lx)/l,v=(1+h)/l,o=zx("sqrtMain",p,x,h,t),o.style.minWidth="0.853em",M=.833/l):r.type==="large"?(x=(1e3+Dx)*lp[r.size],v=(lp[r.size]+h)/l,p=(lp[r.size]+h+Lx)/l,o=zx("sqrtSize"+r.size,p,x,h,t),o.style.minWidth="1.02em",M=1/l):(p=e+h+Lx,v=e+h,x=Math.floor(1e3*e+h)+Dx,o=zx("sqrtTall",p,x,h,t),o.style.minWidth="0.742em",M=1.056),o.height=v,o.style.height=$t(p),{span:o,advanceWidth:M,ruleWidth:(t.fontMetrics().sqrtRuleThickness+h)*l}},S7=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","\\surd"],Eq=["\\uparrow","\\downarrow","\\updownarrow","\\Uparrow","\\Downarrow","\\Updownarrow","|","\\|","\\vert","\\Vert","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱"],M7=["<",">","\\langle","\\rangle","/","\\backslash","\\lt","\\gt"],lp=[0,1.2,1.8,2.4,3],Aq=function(e,t,i,r,l){if(e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle"),kn.contains(S7,e)||kn.contains(M7,e))return b7(e,t,!1,i,r,l);if(kn.contains(Eq,e))return w7(e,lp[t],!1,i,r,l);throw new Ut("Illegal delimiter: '"+e+"'")},Cq=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4}],Pq=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"stack"}],T7=[{type:"small",style:Ln.SCRIPTSCRIPT},{type:"small",style:Ln.SCRIPT},{type:"small",style:Ln.TEXT},{type:"large",size:1},{type:"large",size:2},{type:"large",size:3},{type:"large",size:4},{type:"stack"}],Rq=function(e){if(e.type==="small")return"Main-Regular";if(e.type==="large")return"Size"+e.size+"-Regular";if(e.type==="stack")return"Size4-Regular";throw new Error("Add support for delim type '"+e.type+"' here.")},E7=function(e,t,i,r){for(var l=Math.min(2,3-r.style.size),h=l;h<i.length&&i[h].type!=="stack";h++){var o=$0(e,Rq(i[h]),"math"),p=o.height+o.depth;if(i[h].type==="small"){var v=r.havingBaseStyle(i[h].style);p*=v.sizeMultiplier}if(p>t)return i[h]}return i[i.length-1]},A7=function(e,t,i,r,l,h){e==="<"||e==="\\lt"||e==="⟨"?e="\\langle":(e===">"||e==="\\gt"||e==="⟩")&&(e="\\rangle");var o;kn.contains(M7,e)?o=Cq:kn.contains(S7,e)?o=T7:o=Pq;var p=E7(e,t,o,r);return p.type==="small"?bq(e,p.style,i,r,l,h):p.type==="large"?b7(e,p.size,i,r,l,h):w7(e,t,i,r,l,h)},Iq=function(e,t,i,r,l,h){var o=r.fontMetrics().axisHeight*r.sizeMultiplier,p=901,v=5/r.fontMetrics().ptPerEm,x=Math.max(t-o,i+o),M=Math.max(x/500*p,2*x-v);return A7(e,M,!0,r,l,h)},pl={sqrtImage:Tq,sizedDelim:Aq,sizeToMaxHeight:lp,customSizedDelim:A7,leftRightDelim:Iq},AT={"\\bigl":{mclass:"mopen",size:1},"\\Bigl":{mclass:"mopen",size:2},"\\biggl":{mclass:"mopen",size:3},"\\Biggl":{mclass:"mopen",size:4},"\\bigr":{mclass:"mclose",size:1},"\\Bigr":{mclass:"mclose",size:2},"\\biggr":{mclass:"mclose",size:3},"\\Biggr":{mclass:"mclose",size:4},"\\bigm":{mclass:"mrel",size:1},"\\Bigm":{mclass:"mrel",size:2},"\\biggm":{mclass:"mrel",size:3},"\\Biggm":{mclass:"mrel",size:4},"\\big":{mclass:"mord",size:1},"\\Big":{mclass:"mord",size:2},"\\bigg":{mclass:"mord",size:3},"\\Bigg":{mclass:"mord",size:4}},kq=["(","\\lparen",")","\\rparen","[","\\lbrack","]","\\rbrack","\\{","\\lbrace","\\}","\\rbrace","\\lfloor","\\rfloor","⌊","⌋","\\lceil","\\rceil","⌈","⌉","<",">","\\langle","⟨","\\rangle","⟩","\\lt","\\gt","\\lvert","\\rvert","\\lVert","\\rVert","\\lgroup","\\rgroup","⟮","⟯","\\lmoustache","\\rmoustache","⎰","⎱","/","\\backslash","|","\\vert","\\|","\\Vert","\\uparrow","\\Uparrow","\\downarrow","\\Downarrow","\\updownarrow","\\Updownarrow","."];function rv(n,e){var t=nv(n);if(t&&kn.contains(kq,t.text))return t;throw t?new Ut("Invalid delimiter '"+t.text+"' after '"+e.funcName+"'",n):new Ut("Invalid delimiter type '"+n.type+"'",n)}cn({type:"delimsizing",names:["\\bigl","\\Bigl","\\biggl","\\Biggl","\\bigr","\\Bigr","\\biggr","\\Biggr","\\bigm","\\Bigm","\\biggm","\\Biggm","\\big","\\Big","\\bigg","\\Bigg"],props:{numArgs:1,argTypes:["primitive"]},handler:(n,e)=>{var t=rv(e[0],n);return{type:"delimsizing",mode:n.parser.mode,size:AT[n.funcName].size,mclass:AT[n.funcName].mclass,delim:t.text}},htmlBuilder:(n,e)=>n.delim==="."?et.makeSpan([n.mclass]):pl.sizedDelim(n.delim,n.size,e,n.mode,[n.mclass]),mathmlBuilder:n=>{var e=[];n.delim!=="."&&e.push(Cs(n.delim,n.mode));var t=new kt.MathNode("mo",e);n.mclass==="mopen"||n.mclass==="mclose"?t.setAttribute("fence","true"):t.setAttribute("fence","false"),t.setAttribute("stretchy","true");var i=$t(pl.sizeToMaxHeight[n.size]);return t.setAttribute("minsize",i),t.setAttribute("maxsize",i),t}});function CT(n){if(!n.body)throw new Error("Bug: The leftright ParseNode wasn't fully parsed.")}cn({type:"leftright-right",names:["\\right"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=n.parser.gullet.macros.get("\\current@color");if(t&&typeof t!="string")throw new Ut("\\current@color set to non-string in \\right");return{type:"leftright-right",mode:n.parser.mode,delim:rv(e[0],n).text,color:t}}});cn({type:"leftright",names:["\\left"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=rv(e[0],n),i=n.parser;++i.leftrightDepth;var r=i.parseExpression(!1);--i.leftrightDepth,i.expect("\\right",!1);var l=Yn(i.parseFunction(),"leftright-right");return{type:"leftright",mode:i.mode,body:r,left:t.text,right:l.delim,rightColor:l.color}},htmlBuilder:(n,e)=>{CT(n);for(var t=Tr(n.body,e,!0,["mopen","mclose"]),i=0,r=0,l=!1,h=0;h<t.length;h++)t[h].isMiddle?l=!0:(i=Math.max(t[h].height,i),r=Math.max(t[h].depth,r));i*=e.sizeMultiplier,r*=e.sizeMultiplier;var o;if(n.left==="."?o=Bp(e,["mopen"]):o=pl.leftRightDelim(n.left,i,r,e,n.mode,["mopen"]),t.unshift(o),l)for(var p=1;p<t.length;p++){var v=t[p],x=v.isMiddle;x&&(t[p]=pl.leftRightDelim(x.delim,i,r,x.options,n.mode,[]))}var M;if(n.right===".")M=Bp(e,["mclose"]);else{var S=n.rightColor?e.withColor(n.rightColor):e;M=pl.leftRightDelim(n.right,i,r,S,n.mode,["mclose"])}return t.push(M),et.makeSpan(["minner"],t,e)},mathmlBuilder:(n,e)=>{CT(n);var t=Na(n.body,e);if(n.left!=="."){var i=new kt.MathNode("mo",[Cs(n.left,n.mode)]);i.setAttribute("fence","true"),t.unshift(i)}if(n.right!=="."){var r=new kt.MathNode("mo",[Cs(n.right,n.mode)]);r.setAttribute("fence","true"),n.rightColor&&r.setAttribute("mathcolor",n.rightColor),t.push(r)}return Bw(t)}});cn({type:"middle",names:["\\middle"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var t=rv(e[0],n);if(!n.parser.leftrightDepth)throw new Ut("\\middle without preceding \\left",t);return{type:"middle",mode:n.parser.mode,delim:t.text}},htmlBuilder:(n,e)=>{var t;if(n.delim===".")t=Bp(e,[]);else{t=pl.sizedDelim(n.delim,1,e,n.mode,[]);var i={delim:n.delim,options:e};t.isMiddle=i}return t},mathmlBuilder:(n,e)=>{var t=n.delim==="\\vert"||n.delim==="|"?Cs("|","text"):Cs(n.delim,n.mode),i=new kt.MathNode("mo",[t]);return i.setAttribute("fence","true"),i.setAttribute("lspace","0.05em"),i.setAttribute("rspace","0.05em"),i}});var Gw=(n,e)=>{var t=et.wrapFragment(hi(n.body,e),e),i=n.label.slice(1),r=e.sizeMultiplier,l,h=0,o=kn.isCharacterBox(n.body);if(i==="sout")l=et.makeSpan(["stretchy","sout"]),l.height=e.fontMetrics().defaultRuleThickness/r,h=-.5*e.fontMetrics().xHeight;else if(i==="phase"){var p=Zi({number:.6,unit:"pt"},e),v=Zi({number:.35,unit:"ex"},e),x=e.havingBaseSizing();r=r/x.sizeMultiplier;var M=t.height+t.depth+p+v;t.style.paddingLeft=$t(M/2+p);var S=Math.floor(1e3*M*r),A=TW(S),L=new wl([new Fc("phase",A)],{width:"400em",height:$t(S/1e3),viewBox:"0 0 400000 "+S,preserveAspectRatio:"xMinYMin slice"});l=et.makeSvgSpan(["hide-tail"],[L],e),l.style.height=$t(M),h=t.depth+p+v}else{/cancel/.test(i)?o||t.classes.push("cancel-pad"):i==="angl"?t.classes.push("anglpad"):t.classes.push("boxpad");var F=0,k=0,C=0;/box/.test(i)?(C=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness),F=e.fontMetrics().fboxsep+(i==="colorbox"?0:C),k=F):i==="angl"?(C=Math.max(e.fontMetrics().defaultRuleThickness,e.minRuleThickness),F=4*C,k=Math.max(0,.25-t.depth)):(F=o?.2:0,k=F),l=Ml.encloseSpan(t,i,F,k,e),/fbox|boxed|fcolorbox/.test(i)?(l.style.borderStyle="solid",l.style.borderWidth=$t(C)):i==="angl"&&C!==.049&&(l.style.borderTopWidth=$t(C),l.style.borderRightWidth=$t(C)),h=t.depth+k,n.backgroundColor&&(l.style.backgroundColor=n.backgroundColor,n.borderColor&&(l.style.borderColor=n.borderColor))}var V;if(n.backgroundColor)V=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:l,shift:h},{type:"elem",elem:t,shift:0}]},e);else{var O=/cancel|phase/.test(i)?["svg-align"]:[];V=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:t,shift:0},{type:"elem",elem:l,shift:h,wrapperClasses:O}]},e)}return/cancel/.test(i)&&(V.height=t.height,V.depth=t.depth),/cancel/.test(i)&&!o?et.makeSpan(["mord","cancel-lap"],[V],e):et.makeSpan(["mord"],[V],e)},jw=(n,e)=>{var t=0,i=new kt.MathNode(n.label.indexOf("colorbox")>-1?"mpadded":"menclose",[Pi(n.body,e)]);switch(n.label){case"\\cancel":i.setAttribute("notation","updiagonalstrike");break;case"\\bcancel":i.setAttribute("notation","downdiagonalstrike");break;case"\\phase":i.setAttribute("notation","phasorangle");break;case"\\sout":i.setAttribute("notation","horizontalstrike");break;case"\\fbox":i.setAttribute("notation","box");break;case"\\angl":i.setAttribute("notation","actuarial");break;case"\\fcolorbox":case"\\colorbox":if(t=e.fontMetrics().fboxsep*e.fontMetrics().ptPerEm,i.setAttribute("width","+"+2*t+"pt"),i.setAttribute("height","+"+2*t+"pt"),i.setAttribute("lspace",t+"pt"),i.setAttribute("voffset",t+"pt"),n.label==="\\fcolorbox"){var r=Math.max(e.fontMetrics().fboxrule,e.minRuleThickness);i.setAttribute("style","border: "+r+"em solid "+String(n.borderColor))}break;case"\\xcancel":i.setAttribute("notation","updiagonalstrike downdiagonalstrike");break}return n.backgroundColor&&i.setAttribute("mathbackground",n.backgroundColor),i};cn({type:"enclose",names:["\\colorbox"],props:{numArgs:2,allowedInText:!0,argTypes:["color","text"]},handler(n,e,t){var{parser:i,funcName:r}=n,l=Yn(e[0],"color-token").color,h=e[1];return{type:"enclose",mode:i.mode,label:r,backgroundColor:l,body:h}},htmlBuilder:Gw,mathmlBuilder:jw});cn({type:"enclose",names:["\\fcolorbox"],props:{numArgs:3,allowedInText:!0,argTypes:["color","color","text"]},handler(n,e,t){var{parser:i,funcName:r}=n,l=Yn(e[0],"color-token").color,h=Yn(e[1],"color-token").color,o=e[2];return{type:"enclose",mode:i.mode,label:r,backgroundColor:h,borderColor:l,body:o}},htmlBuilder:Gw,mathmlBuilder:jw});cn({type:"enclose",names:["\\fbox"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\fbox",body:e[0]}}});cn({type:"enclose",names:["\\cancel","\\bcancel","\\xcancel","\\sout","\\phase"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:i}=n,r=e[0];return{type:"enclose",mode:t.mode,label:i,body:r}},htmlBuilder:Gw,mathmlBuilder:jw});cn({type:"enclose",names:["\\angl"],props:{numArgs:1,argTypes:["hbox"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"enclose",mode:t.mode,label:"\\angl",body:e[0]}}});var C7={};function Co(n){for(var{type:e,names:t,props:i,handler:r,htmlBuilder:l,mathmlBuilder:h}=n,o={type:e,numArgs:i.numArgs||0,allowedInText:!1,numOptionalArgs:0,handler:r},p=0;p<t.length;++p)C7[t[p]]=o;l&&(wy[e]=l),h&&(Sy[e]=h)}var P7={};function he(n,e){P7[n]=e}function PT(n){var e=[];n.consumeSpaces();var t=n.fetch().text;for(t==="\\relax"&&(n.consume(),n.consumeSpaces(),t=n.fetch().text);t==="\\hline"||t==="\\hdashline";)n.consume(),e.push(t==="\\hdashline"),n.consumeSpaces(),t=n.fetch().text;return e}var av=n=>{var e=n.parser.settings;if(!e.displayMode)throw new Ut("{"+n.envName+"} can be used only in display mode.")};function Ww(n){if(n.indexOf("ed")===-1)return n.indexOf("*")===-1}function Wc(n,e,t){var{hskipBeforeAndAfter:i,addJot:r,cols:l,arraystretch:h,colSeparationType:o,autoTag:p,singleRow:v,emptySingleRow:x,maxNumCols:M,leqno:S}=e;if(n.gullet.beginGroup(),v||n.gullet.macros.set("\\cr","\\\\\\relax"),!h){var A=n.gullet.expandMacroAsText("\\arraystretch");if(A==null)h=1;else if(h=parseFloat(A),!h||h<0)throw new Ut("Invalid \\arraystretch: "+A)}n.gullet.beginGroup();var L=[],F=[L],k=[],C=[],V=p!=null?[]:void 0;function O(){p&&n.gullet.macros.set("\\@eqnsw","1",!0)}function J(){V&&(n.gullet.macros.get("\\df@tag")?(V.push(n.subparse([new Ms("\\df@tag")])),n.gullet.macros.set("\\df@tag",void 0,!0)):V.push(!!p&&n.gullet.macros.get("\\@eqnsw")==="1"))}for(O(),C.push(PT(n));;){var ue=n.parseExpression(!1,v?"\\end":"\\\\");n.gullet.endGroup(),n.gullet.beginGroup(),ue={type:"ordgroup",mode:n.mode,body:ue},t&&(ue={type:"styling",mode:n.mode,style:t,body:[ue]}),L.push(ue);var Y=n.fetch().text;if(Y==="&"){if(M&&L.length===M){if(v||o)throw new Ut("Too many tab characters: &",n.nextToken);n.settings.reportNonstrict("textEnv","Too few columns specified in the {array} column argument.")}n.consume()}else if(Y==="\\end"){J(),L.length===1&&ue.type==="styling"&&ue.body[0].body.length===0&&(F.length>1||!x)&&F.pop(),C.length<F.length+1&&C.push([]);break}else if(Y==="\\\\"){n.consume();var Q=void 0;n.gullet.future().text!==" "&&(Q=n.parseSizeGroup(!0)),k.push(Q?Q.value:null),J(),C.push(PT(n)),L=[],F.push(L),O()}else throw new Ut("Expected & or \\\\ or \\cr or \\end",n.nextToken)}return n.gullet.endGroup(),n.gullet.endGroup(),{type:"array",mode:n.mode,addJot:r,arraystretch:h,body:F,cols:l,rowGaps:k,hskipBeforeAndAfter:i,hLinesBeforeRow:C,colSeparationType:o,tags:V,leqno:S}}function qw(n){return n.slice(0,1)==="d"?"display":"text"}var Po=function(e,t){var i,r,l=e.body.length,h=e.hLinesBeforeRow,o=0,p=new Array(l),v=[],x=Math.max(t.fontMetrics().arrayRuleWidth,t.minRuleThickness),M=1/t.fontMetrics().ptPerEm,S=5*M;if(e.colSeparationType&&e.colSeparationType==="small"){var A=t.havingStyle(Ln.SCRIPT).sizeMultiplier;S=.2778*(A/t.sizeMultiplier)}var L=e.colSeparationType==="CD"?Zi({number:3,unit:"ex"},t):12*M,F=3*M,k=e.arraystretch*L,C=.7*k,V=.3*k,O=0;function J(le){for(var st=0;st<le.length;++st)st>0&&(O+=.25),v.push({pos:O,isDashed:le[st]})}for(J(h[0]),i=0;i<e.body.length;++i){var ue=e.body[i],Y=C,Q=V;o<ue.length&&(o=ue.length);var xe=new Array(ue.length);for(r=0;r<ue.length;++r){var re=hi(ue[r],t);Q<re.depth&&(Q=re.depth),Y<re.height&&(Y=re.height),xe[r]=re}var ee=e.rowGaps[i],Me=0;ee&&(Me=Zi(ee,t),Me>0&&(Me+=V,Q<Me&&(Q=Me),Me=0)),e.addJot&&(Q+=F),xe.height=Y,xe.depth=Q,O+=Y,xe.pos=O,O+=Q+Me,p[i]=xe,J(h[i+1])}var Fe=O/2+t.fontMetrics().axisHeight,Ae=e.cols||[],He=[],ot,ft,ct=[];if(e.tags&&e.tags.some(le=>le))for(i=0;i<l;++i){var De=p[i],Je=De.pos-Fe,tt=e.tags[i],_t=void 0;tt===!0?_t=et.makeSpan(["eqn-num"],[],t):tt===!1?_t=et.makeSpan([],[],t):_t=et.makeSpan([],Tr(tt,t,!0),t),_t.depth=De.depth,_t.height=De.height,ct.push({type:"elem",elem:_t,shift:Je})}for(r=0,ft=0;r<o||ft<Ae.length;++r,++ft){for(var Lt=Ae[ft]||{},Cn=!0;Lt.type==="separator";){if(Cn||(ot=et.makeSpan(["arraycolsep"],[]),ot.style.width=$t(t.fontMetrics().doubleRuleSep),He.push(ot)),Lt.separator==="|"||Lt.separator===":"){var nt=Lt.separator==="|"?"solid":"dashed",wt=et.makeSpan(["vertical-separator"],[],t);wt.style.height=$t(O),wt.style.borderRightWidth=$t(x),wt.style.borderRightStyle=nt,wt.style.margin="0 "+$t(-x/2);var Ft=O-Fe;Ft&&(wt.style.verticalAlign=$t(-Ft)),He.push(wt)}else throw new Ut("Invalid separator type: "+Lt.separator);ft++,Lt=Ae[ft]||{},Cn=!1}if(!(r>=o)){var At=void 0;(r>0||e.hskipBeforeAndAfter)&&(At=kn.deflt(Lt.pregap,S),At!==0&&(ot=et.makeSpan(["arraycolsep"],[]),ot.style.width=$t(At),He.push(ot)));var gn=[];for(i=0;i<l;++i){var En=p[i],In=En[r];if(In){var je=En.pos-Fe;In.depth=En.depth,In.height=En.height,gn.push({type:"elem",elem:In,shift:je})}}gn=et.makeVList({positionType:"individualShift",children:gn},t),gn=et.makeSpan(["col-align-"+(Lt.align||"c")],[gn]),He.push(gn),(r<o-1||e.hskipBeforeAndAfter)&&(At=kn.deflt(Lt.postgap,S),At!==0&&(ot=et.makeSpan(["arraycolsep"],[]),ot.style.width=$t(At),He.push(ot)))}}if(p=et.makeSpan(["mtable"],He),v.length>0){for(var An=et.makeLineSpan("hline",t,x),yn=et.makeLineSpan("hdashline",t,x),Qn=[{type:"elem",elem:p,shift:0}];v.length>0;){var Yt=v.pop(),Gn=Yt.pos-Fe;Yt.isDashed?Qn.push({type:"elem",elem:yn,shift:Gn}):Qn.push({type:"elem",elem:An,shift:Gn})}p=et.makeVList({positionType:"individualShift",children:Qn},t)}if(ct.length===0)return et.makeSpan(["mord"],[p],t);var ie=et.makeVList({positionType:"individualShift",children:ct},t);return ie=et.makeSpan(["tag"],[ie],t),et.makeFragment([p,ie])},Dq={c:"center ",l:"left ",r:"right "},Ro=function(e,t){for(var i=[],r=new kt.MathNode("mtd",[],["mtr-glue"]),l=new kt.MathNode("mtd",[],["mml-eqn-num"]),h=0;h<e.body.length;h++){for(var o=e.body[h],p=[],v=0;v<o.length;v++)p.push(new kt.MathNode("mtd",[Pi(o[v],t)]));e.tags&&e.tags[h]&&(p.unshift(r),p.push(r),e.leqno?p.unshift(l):p.push(l)),i.push(new kt.MathNode("mtr",p))}var x=new kt.MathNode("mtable",i),M=e.arraystretch===.5?.1:.16+e.arraystretch-1+(e.addJot?.09:0);x.setAttribute("rowspacing",$t(M));var S="",A="";if(e.cols&&e.cols.length>0){var L=e.cols,F="",k=!1,C=0,V=L.length;L[0].type==="separator"&&(S+="top ",C=1),L[L.length-1].type==="separator"&&(S+="bottom ",V-=1);for(var O=C;O<V;O++)L[O].type==="align"?(A+=Dq[L[O].align],k&&(F+="none "),k=!0):L[O].type==="separator"&&k&&(F+=L[O].separator==="|"?"solid ":"dashed ",k=!1);x.setAttribute("columnalign",A.trim()),/[sd]/.test(F)&&x.setAttribute("columnlines",F.trim())}if(e.colSeparationType==="align"){for(var J=e.cols||[],ue="",Y=1;Y<J.length;Y++)ue+=Y%2?"0em ":"1em ";x.setAttribute("columnspacing",ue.trim())}else e.colSeparationType==="alignat"||e.colSeparationType==="gather"?x.setAttribute("columnspacing","0em"):e.colSeparationType==="small"?x.setAttribute("columnspacing","0.2778em"):e.colSeparationType==="CD"?x.setAttribute("columnspacing","0.5em"):x.setAttribute("columnspacing","1em");var Q="",xe=e.hLinesBeforeRow;S+=xe[0].length>0?"left ":"",S+=xe[xe.length-1].length>0?"right ":"";for(var re=1;re<xe.length-1;re++)Q+=xe[re].length===0?"none ":xe[re][0]?"dashed ":"solid ";return/[sd]/.test(Q)&&x.setAttribute("rowlines",Q.trim()),S!==""&&(x=new kt.MathNode("menclose",[x]),x.setAttribute("notation",S.trim())),e.arraystretch&&e.arraystretch<1&&(x=new kt.MathNode("mstyle",[x]),x.setAttribute("scriptlevel","1")),x},R7=function(e,t){e.envName.indexOf("ed")===-1&&av(e);var i=[],r=e.envName.indexOf("at")>-1?"alignat":"align",l=e.envName==="split",h=Wc(e.parser,{cols:i,addJot:!0,autoTag:l?void 0:Ww(e.envName),emptySingleRow:!0,colSeparationType:r,maxNumCols:l?2:void 0,leqno:e.parser.settings.leqno},"display"),o,p=0,v={type:"ordgroup",mode:e.mode,body:[]};if(t[0]&&t[0].type==="ordgroup"){for(var x="",M=0;M<t[0].body.length;M++){var S=Yn(t[0].body[M],"textord");x+=S.text}o=Number(x),p=o*2}var A=!p;h.body.forEach(function(C){for(var V=1;V<C.length;V+=2){var O=Yn(C[V],"styling"),J=Yn(O.body[0],"ordgroup");J.body.unshift(v)}if(A)p<C.length&&(p=C.length);else{var ue=C.length/2;if(o<ue)throw new Ut("Too many math in a row: "+("expected "+o+", but got "+ue),C[0])}});for(var L=0;L<p;++L){var F="r",k=0;L%2===1?F="l":L>0&&A&&(k=1),i[L]={type:"align",align:F,pregap:k,postgap:0}}return h.colSeparationType=A?"align":"alignat",h};Co({type:"array",names:["array","darray"],props:{numArgs:1},handler(n,e){var t=nv(e[0]),i=t?[e[0]]:Yn(e[0],"ordgroup").body,r=i.map(function(h){var o=Uw(h),p=o.text;if("lcr".indexOf(p)!==-1)return{type:"align",align:p};if(p==="|")return{type:"separator",separator:"|"};if(p===":")return{type:"separator",separator:":"};throw new Ut("Unknown column alignment: "+p,h)}),l={cols:r,hskipBeforeAndAfter:!0,maxNumCols:r.length};return Wc(n.parser,l,qw(n.envName))},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["matrix","pmatrix","bmatrix","Bmatrix","vmatrix","Vmatrix","matrix*","pmatrix*","bmatrix*","Bmatrix*","vmatrix*","Vmatrix*"],props:{numArgs:0},handler(n){var e={matrix:null,pmatrix:["(",")"],bmatrix:["[","]"],Bmatrix:["\\{","\\}"],vmatrix:["|","|"],Vmatrix:["\\Vert","\\Vert"]}[n.envName.replace("*","")],t="c",i={hskipBeforeAndAfter:!1,cols:[{type:"align",align:t}]};if(n.envName.charAt(n.envName.length-1)==="*"){var r=n.parser;if(r.consumeSpaces(),r.fetch().text==="["){if(r.consume(),r.consumeSpaces(),t=r.fetch().text,"lcr".indexOf(t)===-1)throw new Ut("Expected l or c or r",r.nextToken);r.consume(),r.consumeSpaces(),r.expect("]"),r.consume(),i.cols=[{type:"align",align:t}]}}var l=Wc(n.parser,i,qw(n.envName)),h=Math.max(0,...l.body.map(o=>o.length));return l.cols=new Array(h).fill({type:"align",align:t}),e?{type:"leftright",mode:n.mode,body:[l],left:e[0],right:e[1],rightColor:void 0}:l},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["smallmatrix"],props:{numArgs:0},handler(n){var e={arraystretch:.5},t=Wc(n.parser,e,"script");return t.colSeparationType="small",t},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["subarray"],props:{numArgs:1},handler(n,e){var t=nv(e[0]),i=t?[e[0]]:Yn(e[0],"ordgroup").body,r=i.map(function(h){var o=Uw(h),p=o.text;if("lc".indexOf(p)!==-1)return{type:"align",align:p};throw new Ut("Unknown column alignment: "+p,h)});if(r.length>1)throw new Ut("{subarray} can contain only one column");var l={cols:r,hskipBeforeAndAfter:!1,arraystretch:.5};if(l=Wc(n.parser,l,"script"),l.body.length>0&&l.body[0].length>1)throw new Ut("{subarray} can contain only one column");return l},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["cases","dcases","rcases","drcases"],props:{numArgs:0},handler(n){var e={arraystretch:1.2,cols:[{type:"align",align:"l",pregap:0,postgap:1},{type:"align",align:"l",pregap:0,postgap:0}]},t=Wc(n.parser,e,qw(n.envName));return{type:"leftright",mode:n.mode,body:[t],left:n.envName.indexOf("r")>-1?".":"\\{",right:n.envName.indexOf("r")>-1?"\\}":".",rightColor:void 0}},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["align","align*","aligned","split"],props:{numArgs:0},handler:R7,htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["gathered","gather","gather*"],props:{numArgs:0},handler(n){kn.contains(["gather","gather*"],n.envName)&&av(n);var e={cols:[{type:"align",align:"c"}],addJot:!0,colSeparationType:"gather",autoTag:Ww(n.envName),emptySingleRow:!0,leqno:n.parser.settings.leqno};return Wc(n.parser,e,"display")},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["alignat","alignat*","alignedat"],props:{numArgs:1},handler:R7,htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["equation","equation*"],props:{numArgs:0},handler(n){av(n);var e={autoTag:Ww(n.envName),emptySingleRow:!0,singleRow:!0,maxNumCols:1,leqno:n.parser.settings.leqno};return Wc(n.parser,e,"display")},htmlBuilder:Po,mathmlBuilder:Ro});Co({type:"array",names:["CD"],props:{numArgs:0},handler(n){return av(n),_q(n.parser)},htmlBuilder:Po,mathmlBuilder:Ro});he("\\nonumber","\\gdef\\@eqnsw{0}");he("\\notag","\\nonumber");cn({type:"text",names:["\\hline","\\hdashline"],props:{numArgs:0,allowedInText:!0,allowedInMath:!0},handler(n,e){throw new Ut(n.funcName+" valid only within array environment")}});var RT=C7;cn({type:"environment",names:["\\begin","\\end"],props:{numArgs:1,argTypes:["text"]},handler(n,e){var{parser:t,funcName:i}=n,r=e[0];if(r.type!=="ordgroup")throw new Ut("Invalid environment name",r);for(var l="",h=0;h<r.body.length;++h)l+=Yn(r.body[h],"textord").text;if(i==="\\begin"){if(!RT.hasOwnProperty(l))throw new Ut("No such environment: "+l,r);var o=RT[l],{args:p,optArgs:v}=t.parseArguments("\\begin{"+l+"}",o),x={mode:t.mode,envName:l,parser:t},M=o.handler(x,p,v);t.expect("\\end",!1);var S=t.nextToken,A=Yn(t.parseFunction(),"environment");if(A.name!==l)throw new Ut("Mismatch: \\begin{"+l+"} matched by \\end{"+A.name+"}",S);return M}return{type:"environment",mode:t.mode,name:l,nameGroup:r}}});var I7=(n,e)=>{var t=n.font,i=e.withFont(t);return hi(n.body,i)},k7=(n,e)=>{var t=n.font,i=e.withFont(t);return Pi(n.body,i)},IT={"\\Bbb":"\\mathbb","\\bold":"\\mathbf","\\frak":"\\mathfrak","\\bm":"\\boldsymbol"};cn({type:"font",names:["\\mathrm","\\mathit","\\mathbf","\\mathnormal","\\mathbb","\\mathcal","\\mathfrak","\\mathscr","\\mathsf","\\mathtt","\\Bbb","\\bold","\\frak"],props:{numArgs:1,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=My(e[0]),l=i;return l in IT&&(l=IT[l]),{type:"font",mode:t.mode,font:l.slice(1),body:r}},htmlBuilder:I7,mathmlBuilder:k7});cn({type:"mclass",names:["\\boldsymbol","\\bm"],props:{numArgs:1},handler:(n,e)=>{var{parser:t}=n,i=e[0],r=kn.isCharacterBox(i);return{type:"mclass",mode:t.mode,mclass:iv(i),body:[{type:"font",mode:t.mode,font:"boldsymbol",body:i}],isCharacterBox:r}}});cn({type:"font",names:["\\rm","\\sf","\\tt","\\bf","\\it","\\cal"],props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:i,breakOnTokenText:r}=n,{mode:l}=t,h=t.parseExpression(!0,r),o="math"+i.slice(1);return{type:"font",mode:l,font:o,body:{type:"ordgroup",mode:t.mode,body:h}}},htmlBuilder:I7,mathmlBuilder:k7});var D7=(n,e)=>{var t=e;return n==="display"?t=t.id>=Ln.SCRIPT.id?t.text():Ln.DISPLAY:n==="text"&&t.size===Ln.DISPLAY.size?t=Ln.TEXT:n==="script"?t=Ln.SCRIPT:n==="scriptscript"&&(t=Ln.SCRIPTSCRIPT),t},$w=(n,e)=>{var t=D7(n.size,e.style),i=t.fracNum(),r=t.fracDen(),l;l=e.havingStyle(i);var h=hi(n.numer,l,e);if(n.continued){var o=8.5/e.fontMetrics().ptPerEm,p=3.5/e.fontMetrics().ptPerEm;h.height=h.height<o?o:h.height,h.depth=h.depth<p?p:h.depth}l=e.havingStyle(r);var v=hi(n.denom,l,e),x,M,S;n.hasBarLine?(n.barSize?(M=Zi(n.barSize,e),x=et.makeLineSpan("frac-line",e,M)):x=et.makeLineSpan("frac-line",e),M=x.height,S=x.height):(x=null,M=0,S=e.fontMetrics().defaultRuleThickness);var A,L,F;t.size===Ln.DISPLAY.size||n.size==="display"?(A=e.fontMetrics().num1,M>0?L=3*S:L=7*S,F=e.fontMetrics().denom1):(M>0?(A=e.fontMetrics().num2,L=S):(A=e.fontMetrics().num3,L=3*S),F=e.fontMetrics().denom2);var k;if(x){var V=e.fontMetrics().axisHeight;A-h.depth-(V+.5*M)<L&&(A+=L-(A-h.depth-(V+.5*M))),V-.5*M-(v.height-F)<L&&(F+=L-(V-.5*M-(v.height-F)));var O=-(V-.5*M);k=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:v,shift:F},{type:"elem",elem:x,shift:O},{type:"elem",elem:h,shift:-A}]},e)}else{var C=A-h.depth-(v.height-F);C<L&&(A+=.5*(L-C),F+=.5*(L-C)),k=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:v,shift:F},{type:"elem",elem:h,shift:-A}]},e)}l=e.havingStyle(t),k.height*=l.sizeMultiplier/e.sizeMultiplier,k.depth*=l.sizeMultiplier/e.sizeMultiplier;var J;t.size===Ln.DISPLAY.size?J=e.fontMetrics().delim1:t.size===Ln.SCRIPTSCRIPT.size?J=e.havingStyle(Ln.SCRIPT).fontMetrics().delim2:J=e.fontMetrics().delim2;var ue,Y;return n.leftDelim==null?ue=Bp(e,["mopen"]):ue=pl.customSizedDelim(n.leftDelim,J,!0,e.havingStyle(t),n.mode,["mopen"]),n.continued?Y=et.makeSpan([]):n.rightDelim==null?Y=Bp(e,["mclose"]):Y=pl.customSizedDelim(n.rightDelim,J,!0,e.havingStyle(t),n.mode,["mclose"]),et.makeSpan(["mord"].concat(l.sizingClasses(e)),[ue,et.makeSpan(["mfrac"],[k]),Y],e)},Xw=(n,e)=>{var t=new kt.MathNode("mfrac",[Pi(n.numer,e),Pi(n.denom,e)]);if(!n.hasBarLine)t.setAttribute("linethickness","0px");else if(n.barSize){var i=Zi(n.barSize,e);t.setAttribute("linethickness",$t(i))}var r=D7(n.size,e.style);if(r.size!==e.style.size){t=new kt.MathNode("mstyle",[t]);var l=r.size===Ln.DISPLAY.size?"true":"false";t.setAttribute("displaystyle",l),t.setAttribute("scriptlevel","0")}if(n.leftDelim!=null||n.rightDelim!=null){var h=[];if(n.leftDelim!=null){var o=new kt.MathNode("mo",[new kt.TextNode(n.leftDelim.replace("\\",""))]);o.setAttribute("fence","true"),h.push(o)}if(h.push(t),n.rightDelim!=null){var p=new kt.MathNode("mo",[new kt.TextNode(n.rightDelim.replace("\\",""))]);p.setAttribute("fence","true"),h.push(p)}return Bw(h)}return t};cn({type:"genfrac",names:["\\dfrac","\\frac","\\tfrac","\\dbinom","\\binom","\\tbinom","\\\\atopfrac","\\\\bracefrac","\\\\brackfrac"],props:{numArgs:2,allowedInArgument:!0},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0],l=e[1],h,o=null,p=null,v="auto";switch(i){case"\\dfrac":case"\\frac":case"\\tfrac":h=!0;break;case"\\\\atopfrac":h=!1;break;case"\\dbinom":case"\\binom":case"\\tbinom":h=!1,o="(",p=")";break;case"\\\\bracefrac":h=!1,o="\\{",p="\\}";break;case"\\\\brackfrac":h=!1,o="[",p="]";break;default:throw new Error("Unrecognized genfrac command")}switch(i){case"\\dfrac":case"\\dbinom":v="display";break;case"\\tfrac":case"\\tbinom":v="text";break}return{type:"genfrac",mode:t.mode,continued:!1,numer:r,denom:l,hasBarLine:h,leftDelim:o,rightDelim:p,size:v,barSize:null}},htmlBuilder:$w,mathmlBuilder:Xw});cn({type:"genfrac",names:["\\cfrac"],props:{numArgs:2},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0],l=e[1];return{type:"genfrac",mode:t.mode,continued:!0,numer:r,denom:l,hasBarLine:!0,leftDelim:null,rightDelim:null,size:"display",barSize:null}}});cn({type:"infix",names:["\\over","\\choose","\\atop","\\brace","\\brack"],props:{numArgs:0,infix:!0},handler(n){var{parser:e,funcName:t,token:i}=n,r;switch(t){case"\\over":r="\\frac";break;case"\\choose":r="\\binom";break;case"\\atop":r="\\\\atopfrac";break;case"\\brace":r="\\\\bracefrac";break;case"\\brack":r="\\\\brackfrac";break;default:throw new Error("Unrecognized infix genfrac command")}return{type:"infix",mode:e.mode,replaceWith:r,token:i}}});var kT=["display","text","script","scriptscript"],DT=function(e){var t=null;return e.length>0&&(t=e,t=t==="."?null:t),t};cn({type:"genfrac",names:["\\genfrac"],props:{numArgs:6,allowedInArgument:!0,argTypes:["math","math","size","text","math","math"]},handler(n,e){var{parser:t}=n,i=e[4],r=e[5],l=My(e[0]),h=l.type==="atom"&&l.family==="open"?DT(l.text):null,o=My(e[1]),p=o.type==="atom"&&o.family==="close"?DT(o.text):null,v=Yn(e[2],"size"),x,M=null;v.isBlank?x=!0:(M=v.value,x=M.number>0);var S="auto",A=e[3];if(A.type==="ordgroup"){if(A.body.length>0){var L=Yn(A.body[0],"textord");S=kT[Number(L.text)]}}else A=Yn(A,"textord"),S=kT[Number(A.text)];return{type:"genfrac",mode:t.mode,numer:i,denom:r,continued:!1,hasBarLine:x,barSize:M,leftDelim:h,rightDelim:p,size:S}},htmlBuilder:$w,mathmlBuilder:Xw});cn({type:"infix",names:["\\above"],props:{numArgs:1,argTypes:["size"],infix:!0},handler(n,e){var{parser:t,funcName:i,token:r}=n;return{type:"infix",mode:t.mode,replaceWith:"\\\\abovefrac",size:Yn(e[0],"size").value,token:r}}});cn({type:"genfrac",names:["\\\\abovefrac"],props:{numArgs:3,argTypes:["math","size","math"]},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0],l=uW(Yn(e[1],"infix").size),h=e[2],o=l.number>0;return{type:"genfrac",mode:t.mode,numer:r,denom:h,continued:!1,hasBarLine:o,barSize:l,leftDelim:null,rightDelim:null,size:"auto"}},htmlBuilder:$w,mathmlBuilder:Xw});var L7=(n,e)=>{var t=e.style,i,r;n.type==="supsub"?(i=n.sup?hi(n.sup,e.havingStyle(t.sup()),e):hi(n.sub,e.havingStyle(t.sub()),e),r=Yn(n.base,"horizBrace")):r=Yn(n,"horizBrace");var l=hi(r.base,e.havingBaseStyle(Ln.DISPLAY)),h=Ml.svgSpan(r,e),o;if(r.isOver?(o=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:l},{type:"kern",size:.1},{type:"elem",elem:h}]},e),o.children[0].children[0].children[1].classes.push("svg-align")):(o=et.makeVList({positionType:"bottom",positionData:l.depth+.1+h.height,children:[{type:"elem",elem:h},{type:"kern",size:.1},{type:"elem",elem:l}]},e),o.children[0].children[0].children[0].classes.push("svg-align")),i){var p=et.makeSpan(["mord",r.isOver?"mover":"munder"],[o],e);r.isOver?o=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:p},{type:"kern",size:.2},{type:"elem",elem:i}]},e):o=et.makeVList({positionType:"bottom",positionData:p.depth+.2+i.height+i.depth,children:[{type:"elem",elem:i},{type:"kern",size:.2},{type:"elem",elem:p}]},e)}return et.makeSpan(["mord",r.isOver?"mover":"munder"],[o],e)},Lq=(n,e)=>{var t=Ml.mathMLnode(n.label);return new kt.MathNode(n.isOver?"mover":"munder",[Pi(n.base,e),t])};cn({type:"horizBrace",names:["\\overbrace","\\underbrace"],props:{numArgs:1},handler(n,e){var{parser:t,funcName:i}=n;return{type:"horizBrace",mode:t.mode,label:i,isOver:/^\\over/.test(i),base:e[0]}},htmlBuilder:L7,mathmlBuilder:Lq});cn({type:"href",names:["\\href"],props:{numArgs:2,argTypes:["url","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,i=e[1],r=Yn(e[0],"url").url;return t.settings.isTrusted({command:"\\href",url:r})?{type:"href",mode:t.mode,href:r,body:fr(i)}:t.formatUnsupportedCmd("\\href")},htmlBuilder:(n,e)=>{var t=Tr(n.body,e,!1);return et.makeAnchor(n.href,[],t,e)},mathmlBuilder:(n,e)=>{var t=Nc(n.body,e);return t instanceof vs||(t=new vs("mrow",[t])),t.setAttribute("href",n.href),t}});cn({type:"href",names:["\\url"],props:{numArgs:1,argTypes:["url"],allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,i=Yn(e[0],"url").url;if(!t.settings.isTrusted({command:"\\url",url:i}))return t.formatUnsupportedCmd("\\url");for(var r=[],l=0;l<i.length;l++){var h=i[l];h==="~"&&(h="\\textasciitilde"),r.push({type:"textord",mode:"text",text:h})}var o={type:"text",mode:t.mode,font:"\\texttt",body:r};return{type:"href",mode:t.mode,href:i,body:fr(o)}}});cn({type:"hbox",names:["\\hbox"],props:{numArgs:1,argTypes:["text"],allowedInText:!0,primitive:!0},handler(n,e){var{parser:t}=n;return{type:"hbox",mode:t.mode,body:fr(e[0])}},htmlBuilder(n,e){var t=Tr(n.body,e,!1);return et.makeFragment(t)},mathmlBuilder(n,e){return new kt.MathNode("mrow",Na(n.body,e))}});cn({type:"html",names:["\\htmlClass","\\htmlId","\\htmlStyle","\\htmlData"],props:{numArgs:2,argTypes:["raw","original"],allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:i,token:r}=n,l=Yn(e[0],"raw").string,h=e[1];t.settings.strict&&t.settings.reportNonstrict("htmlExtension","HTML extension is disabled on strict mode");var o,p={};switch(i){case"\\htmlClass":p.class=l,o={command:"\\htmlClass",class:l};break;case"\\htmlId":p.id=l,o={command:"\\htmlId",id:l};break;case"\\htmlStyle":p.style=l,o={command:"\\htmlStyle",style:l};break;case"\\htmlData":{for(var v=l.split(","),x=0;x<v.length;x++){var M=v[x].split("=");if(M.length!==2)throw new Ut("Error parsing key-value for \\htmlData");p["data-"+M[0].trim()]=M[1].trim()}o={command:"\\htmlData",attributes:p};break}default:throw new Error("Unrecognized html command")}return t.settings.isTrusted(o)?{type:"html",mode:t.mode,attributes:p,body:fr(h)}:t.formatUnsupportedCmd(i)},htmlBuilder:(n,e)=>{var t=Tr(n.body,e,!1),i=["enclosing"];n.attributes.class&&i.push(...n.attributes.class.trim().split(/\s+/));var r=et.makeSpan(i,t,e);for(var l in n.attributes)l!=="class"&&n.attributes.hasOwnProperty(l)&&r.setAttribute(l,n.attributes[l]);return r},mathmlBuilder:(n,e)=>Nc(n.body,e)});cn({type:"htmlmathml",names:["\\html@mathml"],props:{numArgs:2,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"htmlmathml",mode:t.mode,html:fr(e[0]),mathml:fr(e[1])}},htmlBuilder:(n,e)=>{var t=Tr(n.html,e,!1);return et.makeFragment(t)},mathmlBuilder:(n,e)=>Nc(n.mathml,e)});var Fx=function(e){if(/^[-+]? *(\d+(\.\d*)?|\.\d+)$/.test(e))return{number:+e,unit:"bp"};var t=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(e);if(!t)throw new Ut("Invalid size: '"+e+"' in \\includegraphics");var i={number:+(t[1]+t[2]),unit:t[3]};if(!Q8(i))throw new Ut("Invalid unit: '"+i.unit+"' in \\includegraphics.");return i};cn({type:"includegraphics",names:["\\includegraphics"],props:{numArgs:1,numOptionalArgs:1,argTypes:["raw","url"],allowedInText:!1},handler:(n,e,t)=>{var{parser:i}=n,r={number:0,unit:"em"},l={number:.9,unit:"em"},h={number:0,unit:"em"},o="";if(t[0])for(var p=Yn(t[0],"raw").string,v=p.split(","),x=0;x<v.length;x++){var M=v[x].split("=");if(M.length===2){var S=M[1].trim();switch(M[0].trim()){case"alt":o=S;break;case"width":r=Fx(S);break;case"height":l=Fx(S);break;case"totalheight":h=Fx(S);break;default:throw new Ut("Invalid key: '"+M[0]+"' in \\includegraphics.")}}}var A=Yn(e[0],"url").url;return o===""&&(o=A,o=o.replace(/^.*[\\/]/,""),o=o.substring(0,o.lastIndexOf("."))),i.settings.isTrusted({command:"\\includegraphics",url:A})?{type:"includegraphics",mode:i.mode,alt:o,width:r,height:l,totalheight:h,src:A}:i.formatUnsupportedCmd("\\includegraphics")},htmlBuilder:(n,e)=>{var t=Zi(n.height,e),i=0;n.totalheight.number>0&&(i=Zi(n.totalheight,e)-t);var r=0;n.width.number>0&&(r=Zi(n.width,e));var l={height:$t(t+i)};r>0&&(l.width=$t(r)),i>0&&(l.verticalAlign=$t(-i));var h=new LW(n.src,n.alt,l);return h.height=t,h.depth=i,h},mathmlBuilder:(n,e)=>{var t=new kt.MathNode("mglyph",[]);t.setAttribute("alt",n.alt);var i=Zi(n.height,e),r=0;if(n.totalheight.number>0&&(r=Zi(n.totalheight,e)-i,t.setAttribute("valign",$t(-r))),t.setAttribute("height",$t(i+r)),n.width.number>0){var l=Zi(n.width,e);t.setAttribute("width",$t(l))}return t.setAttribute("src",n.src),t}});cn({type:"kern",names:["\\kern","\\mkern","\\hskip","\\mskip"],props:{numArgs:1,argTypes:["size"],primitive:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:i}=n,r=Yn(e[0],"size");if(t.settings.strict){var l=i[1]==="m",h=r.value.unit==="mu";l?(h||t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" supports only mu units, "+("not "+r.value.unit+" units")),t.mode!=="math"&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" works only in math mode")):h&&t.settings.reportNonstrict("mathVsTextUnits","LaTeX's "+i+" doesn't support mu units")}return{type:"kern",mode:t.mode,dimension:r.value}},htmlBuilder(n,e){return et.makeGlue(n.dimension,e)},mathmlBuilder(n,e){var t=Zi(n.dimension,e);return new kt.SpaceNode(t)}});cn({type:"lap",names:["\\mathllap","\\mathrlap","\\mathclap"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0];return{type:"lap",mode:t.mode,alignment:i.slice(5),body:r}},htmlBuilder:(n,e)=>{var t;n.alignment==="clap"?(t=et.makeSpan([],[hi(n.body,e)]),t=et.makeSpan(["inner"],[t],e)):t=et.makeSpan(["inner"],[hi(n.body,e)]);var i=et.makeSpan(["fix"],[]),r=et.makeSpan([n.alignment],[t,i],e),l=et.makeSpan(["strut"]);return l.style.height=$t(r.height+r.depth),r.depth&&(l.style.verticalAlign=$t(-r.depth)),r.children.unshift(l),r=et.makeSpan(["thinbox"],[r],e),et.makeSpan(["mord","vbox"],[r],e)},mathmlBuilder:(n,e)=>{var t=new kt.MathNode("mpadded",[Pi(n.body,e)]);if(n.alignment!=="rlap"){var i=n.alignment==="llap"?"-1":"-0.5";t.setAttribute("lspace",i+"width")}return t.setAttribute("width","0px"),t}});cn({type:"styling",names:["\\(","$"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){var{funcName:t,parser:i}=n,r=i.mode;i.switchMode("math");var l=t==="\\("?"\\)":"$",h=i.parseExpression(!1,l);return i.expect(l),i.switchMode(r),{type:"styling",mode:i.mode,style:"text",body:h}}});cn({type:"text",names:["\\)","\\]"],props:{numArgs:0,allowedInText:!0,allowedInMath:!1},handler(n,e){throw new Ut("Mismatched "+n.funcName)}});var LT=(n,e)=>{switch(e.style.size){case Ln.DISPLAY.size:return n.display;case Ln.TEXT.size:return n.text;case Ln.SCRIPT.size:return n.script;case Ln.SCRIPTSCRIPT.size:return n.scriptscript;default:return n.text}};cn({type:"mathchoice",names:["\\mathchoice"],props:{numArgs:4,primitive:!0},handler:(n,e)=>{var{parser:t}=n;return{type:"mathchoice",mode:t.mode,display:fr(e[0]),text:fr(e[1]),script:fr(e[2]),scriptscript:fr(e[3])}},htmlBuilder:(n,e)=>{var t=LT(n,e),i=Tr(t,e,!1);return et.makeFragment(i)},mathmlBuilder:(n,e)=>{var t=LT(n,e);return Nc(t,e)}});var z7=(n,e,t,i,r,l,h)=>{n=et.makeSpan([],[n]);var o=t&&kn.isCharacterBox(t),p,v;if(e){var x=hi(e,i.havingStyle(r.sup()),i);v={elem:x,kern:Math.max(i.fontMetrics().bigOpSpacing1,i.fontMetrics().bigOpSpacing3-x.depth)}}if(t){var M=hi(t,i.havingStyle(r.sub()),i);p={elem:M,kern:Math.max(i.fontMetrics().bigOpSpacing2,i.fontMetrics().bigOpSpacing4-M.height)}}var S;if(v&&p){var A=i.fontMetrics().bigOpSpacing5+p.elem.height+p.elem.depth+p.kern+n.depth+h;S=et.makeVList({positionType:"bottom",positionData:A,children:[{type:"kern",size:i.fontMetrics().bigOpSpacing5},{type:"elem",elem:p.elem,marginLeft:$t(-l)},{type:"kern",size:p.kern},{type:"elem",elem:n},{type:"kern",size:v.kern},{type:"elem",elem:v.elem,marginLeft:$t(l)},{type:"kern",size:i.fontMetrics().bigOpSpacing5}]},i)}else if(p){var L=n.height-h;S=et.makeVList({positionType:"top",positionData:L,children:[{type:"kern",size:i.fontMetrics().bigOpSpacing5},{type:"elem",elem:p.elem,marginLeft:$t(-l)},{type:"kern",size:p.kern},{type:"elem",elem:n}]},i)}else if(v){var F=n.depth+h;S=et.makeVList({positionType:"bottom",positionData:F,children:[{type:"elem",elem:n},{type:"kern",size:v.kern},{type:"elem",elem:v.elem,marginLeft:$t(l)},{type:"kern",size:i.fontMetrics().bigOpSpacing5}]},i)}else return n;var k=[S];if(p&&l!==0&&!o){var C=et.makeSpan(["mspace"],[],i);C.style.marginRight=$t(l),k.unshift(C)}return et.makeSpan(["mop","op-limits"],k,i)},F7=["\\smallint"],df=(n,e)=>{var t,i,r=!1,l;n.type==="supsub"?(t=n.sup,i=n.sub,l=Yn(n.base,"op"),r=!0):l=Yn(n,"op");var h=e.style,o=!1;h.size===Ln.DISPLAY.size&&l.symbol&&!kn.contains(F7,l.name)&&(o=!0);var p;if(l.symbol){var v=o?"Size2-Regular":"Size1-Regular",x="";if((l.name==="\\oiint"||l.name==="\\oiiint")&&(x=l.name.slice(1),l.name=x==="oiint"?"\\iint":"\\iiint"),p=et.makeSymbol(l.name,v,"math",e,["mop","op-symbol",o?"large-op":"small-op"]),x.length>0){var M=p.italic,S=et.staticSvg(x+"Size"+(o?"2":"1"),e);p=et.makeVList({positionType:"individualShift",children:[{type:"elem",elem:p,shift:0},{type:"elem",elem:S,shift:o?.08:0}]},e),l.name="\\"+x,p.classes.unshift("mop"),p.italic=M}}else if(l.body){var A=Tr(l.body,e,!0);A.length===1&&A[0]instanceof As?(p=A[0],p.classes[0]="mop"):p=et.makeSpan(["mop"],A,e)}else{for(var L=[],F=1;F<l.name.length;F++)L.push(et.mathsym(l.name[F],l.mode,e));p=et.makeSpan(["mop"],L,e)}var k=0,C=0;return(p instanceof As||l.name==="\\oiint"||l.name==="\\oiiint")&&!l.suppressBaseShift&&(k=(p.height-p.depth)/2-e.fontMetrics().axisHeight,C=p.italic),r?z7(p,t,i,e,h,C,k):(k&&(p.style.position="relative",p.style.top=$t(k)),p)},tm=(n,e)=>{var t;if(n.symbol)t=new vs("mo",[Cs(n.name,n.mode)]),kn.contains(F7,n.name)&&t.setAttribute("largeop","false");else if(n.body)t=new vs("mo",Na(n.body,e));else{t=new vs("mi",[new op(n.name.slice(1))]);var i=new vs("mo",[Cs("⁡","text")]);n.parentIsSupSub?t=new vs("mrow",[t,i]):t=u7([t,i])}return t},zq={"∏":"\\prod","∐":"\\coprod","∑":"\\sum","⋀":"\\bigwedge","⋁":"\\bigvee","⋂":"\\bigcap","⋃":"\\bigcup","⨀":"\\bigodot","⨁":"\\bigoplus","⨂":"\\bigotimes","⨄":"\\biguplus","⨆":"\\bigsqcup"};cn({type:"op",names:["\\coprod","\\bigvee","\\bigwedge","\\biguplus","\\bigcap","\\bigcup","\\intop","\\prod","\\sum","\\bigotimes","\\bigoplus","\\bigodot","\\bigsqcup","\\smallint","∏","∐","∑","⋀","⋁","⋂","⋃","⨀","⨁","⨂","⨄","⨆"],props:{numArgs:0},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=i;return r.length===1&&(r=zq[r]),{type:"op",mode:t.mode,limits:!0,parentIsSupSub:!1,symbol:!0,name:r}},htmlBuilder:df,mathmlBuilder:tm});cn({type:"op",names:["\\mathop"],props:{numArgs:1,primitive:!0},handler:(n,e)=>{var{parser:t}=n,i=e[0];return{type:"op",mode:t.mode,limits:!1,parentIsSupSub:!1,symbol:!1,body:fr(i)}},htmlBuilder:df,mathmlBuilder:tm});var Fq={"∫":"\\int","∬":"\\iint","∭":"\\iiint","∮":"\\oint","∯":"\\oiint","∰":"\\oiiint"};cn({type:"op",names:["\\arcsin","\\arccos","\\arctan","\\arctg","\\arcctg","\\arg","\\ch","\\cos","\\cosec","\\cosh","\\cot","\\cotg","\\coth","\\csc","\\ctg","\\cth","\\deg","\\dim","\\exp","\\hom","\\ker","\\lg","\\ln","\\log","\\sec","\\sin","\\sinh","\\sh","\\tan","\\tanh","\\tg","\\th"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:df,mathmlBuilder:tm});cn({type:"op",names:["\\det","\\gcd","\\inf","\\lim","\\max","\\min","\\Pr","\\sup"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n;return{type:"op",mode:e.mode,limits:!0,parentIsSupSub:!1,symbol:!1,name:t}},htmlBuilder:df,mathmlBuilder:tm});cn({type:"op",names:["\\int","\\iint","\\iiint","\\oint","\\oiint","\\oiiint","∫","∬","∭","∮","∯","∰"],props:{numArgs:0},handler(n){var{parser:e,funcName:t}=n,i=t;return i.length===1&&(i=Fq[i]),{type:"op",mode:e.mode,limits:!1,parentIsSupSub:!1,symbol:!0,name:i}},htmlBuilder:df,mathmlBuilder:tm});var N7=(n,e)=>{var t,i,r=!1,l;n.type==="supsub"?(t=n.sup,i=n.sub,l=Yn(n.base,"operatorname"),r=!0):l=Yn(n,"operatorname");var h;if(l.body.length>0){for(var o=l.body.map(M=>{var S=M.text;return typeof S=="string"?{type:"textord",mode:M.mode,text:S}:M}),p=Tr(o,e.withFont("mathrm"),!0),v=0;v<p.length;v++){var x=p[v];x instanceof As&&(x.text=x.text.replace(/\u2212/,"-").replace(/\u2217/,"*"))}h=et.makeSpan(["mop"],p,e)}else h=et.makeSpan(["mop"],[],e);return r?z7(h,t,i,e,e.style,0,0):h},Nq=(n,e)=>{for(var t=Na(n.body,e.withFont("mathrm")),i=!0,r=0;r<t.length;r++){var l=t[r];if(!(l instanceof kt.SpaceNode))if(l instanceof kt.MathNode)switch(l.type){case"mi":case"mn":case"ms":case"mspace":case"mtext":break;case"mo":{var h=l.children[0];l.children.length===1&&h instanceof kt.TextNode?h.text=h.text.replace(/\u2212/,"-").replace(/\u2217/,"*"):i=!1;break}default:i=!1}else i=!1}if(i){var o=t.map(x=>x.toText()).join("");t=[new kt.TextNode(o)]}var p=new kt.MathNode("mi",t);p.setAttribute("mathvariant","normal");var v=new kt.MathNode("mo",[Cs("⁡","text")]);return n.parentIsSupSub?new kt.MathNode("mrow",[p,v]):kt.newDocumentFragment([p,v])};cn({type:"operatorname",names:["\\operatorname@","\\operatornamewithlimits"],props:{numArgs:1},handler:(n,e)=>{var{parser:t,funcName:i}=n,r=e[0];return{type:"operatorname",mode:t.mode,body:fr(r),alwaysHandleSupSub:i==="\\operatornamewithlimits",limits:!1,parentIsSupSub:!1}},htmlBuilder:N7,mathmlBuilder:Nq});he("\\operatorname","\\@ifstar\\operatornamewithlimits\\operatorname@");Qu({type:"ordgroup",htmlBuilder(n,e){return n.semisimple?et.makeFragment(Tr(n.body,e,!1)):et.makeSpan(["mord"],Tr(n.body,e,!0),e)},mathmlBuilder(n,e){return Nc(n.body,e,!0)}});cn({type:"overline",names:["\\overline"],props:{numArgs:1},handler(n,e){var{parser:t}=n,i=e[0];return{type:"overline",mode:t.mode,body:i}},htmlBuilder(n,e){var t=hi(n.body,e.havingCrampedStyle()),i=et.makeLineSpan("overline-line",e),r=e.fontMetrics().defaultRuleThickness,l=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t},{type:"kern",size:3*r},{type:"elem",elem:i},{type:"kern",size:r}]},e);return et.makeSpan(["mord","overline"],[l],e)},mathmlBuilder(n,e){var t=new kt.MathNode("mo",[new kt.TextNode("‾")]);t.setAttribute("stretchy","true");var i=new kt.MathNode("mover",[Pi(n.body,e),t]);return i.setAttribute("accent","true"),i}});cn({type:"phantom",names:["\\phantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,i=e[0];return{type:"phantom",mode:t.mode,body:fr(i)}},htmlBuilder:(n,e)=>{var t=Tr(n.body,e.withPhantom(),!1);return et.makeFragment(t)},mathmlBuilder:(n,e)=>{var t=Na(n.body,e);return new kt.MathNode("mphantom",t)}});cn({type:"hphantom",names:["\\hphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,i=e[0];return{type:"hphantom",mode:t.mode,body:i}},htmlBuilder:(n,e)=>{var t=et.makeSpan([],[hi(n.body,e.withPhantom())]);if(t.height=0,t.depth=0,t.children)for(var i=0;i<t.children.length;i++)t.children[i].height=0,t.children[i].depth=0;return t=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e),et.makeSpan(["mord"],[t],e)},mathmlBuilder:(n,e)=>{var t=Na(fr(n.body),e),i=new kt.MathNode("mphantom",t),r=new kt.MathNode("mpadded",[i]);return r.setAttribute("height","0px"),r.setAttribute("depth","0px"),r}});cn({type:"vphantom",names:["\\vphantom"],props:{numArgs:1,allowedInText:!0},handler:(n,e)=>{var{parser:t}=n,i=e[0];return{type:"vphantom",mode:t.mode,body:i}},htmlBuilder:(n,e)=>{var t=et.makeSpan(["inner"],[hi(n.body,e.withPhantom())]),i=et.makeSpan(["fix"],[]);return et.makeSpan(["mord","rlap"],[t,i],e)},mathmlBuilder:(n,e)=>{var t=Na(fr(n.body),e),i=new kt.MathNode("mphantom",t),r=new kt.MathNode("mpadded",[i]);return r.setAttribute("width","0px"),r}});cn({type:"raisebox",names:["\\raisebox"],props:{numArgs:2,argTypes:["size","hbox"],allowedInText:!0},handler(n,e){var{parser:t}=n,i=Yn(e[0],"size").value,r=e[1];return{type:"raisebox",mode:t.mode,dy:i,body:r}},htmlBuilder(n,e){var t=hi(n.body,e),i=Zi(n.dy,e);return et.makeVList({positionType:"shift",positionData:-i,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){var t=new kt.MathNode("mpadded",[Pi(n.body,e)]),i=n.dy.number+n.dy.unit;return t.setAttribute("voffset",i),t}});cn({type:"internal",names:["\\relax"],props:{numArgs:0,allowedInText:!0},handler(n){var{parser:e}=n;return{type:"internal",mode:e.mode}}});cn({type:"rule",names:["\\rule"],props:{numArgs:2,numOptionalArgs:1,argTypes:["size","size","size"]},handler(n,e,t){var{parser:i}=n,r=t[0],l=Yn(e[0],"size"),h=Yn(e[1],"size");return{type:"rule",mode:i.mode,shift:r&&Yn(r,"size").value,width:l.value,height:h.value}},htmlBuilder(n,e){var t=et.makeSpan(["mord","rule"],[],e),i=Zi(n.width,e),r=Zi(n.height,e),l=n.shift?Zi(n.shift,e):0;return t.style.borderRightWidth=$t(i),t.style.borderTopWidth=$t(r),t.style.bottom=$t(l),t.width=i,t.height=r+l,t.depth=-l,t.maxFontSize=r*1.125*e.sizeMultiplier,t},mathmlBuilder(n,e){var t=Zi(n.width,e),i=Zi(n.height,e),r=n.shift?Zi(n.shift,e):0,l=e.color&&e.getColor()||"black",h=new kt.MathNode("mspace");h.setAttribute("mathbackground",l),h.setAttribute("width",$t(t)),h.setAttribute("height",$t(i));var o=new kt.MathNode("mpadded",[h]);return r>=0?o.setAttribute("height",$t(r)):(o.setAttribute("height",$t(r)),o.setAttribute("depth",$t(-r))),o.setAttribute("voffset",$t(r)),o}});function B7(n,e,t){for(var i=Tr(n,e,!1),r=e.sizeMultiplier/t.sizeMultiplier,l=0;l<i.length;l++){var h=i[l].classes.indexOf("sizing");h<0?Array.prototype.push.apply(i[l].classes,e.sizingClasses(t)):i[l].classes[h+1]==="reset-size"+e.size&&(i[l].classes[h+1]="reset-size"+t.size),i[l].height*=r,i[l].depth*=r}return et.makeFragment(i)}var zT=["\\tiny","\\sixptsize","\\scriptsize","\\footnotesize","\\small","\\normalsize","\\large","\\Large","\\LARGE","\\huge","\\Huge"],Bq=(n,e)=>{var t=e.havingSize(n.size);return B7(n.body,t,e)};cn({type:"sizing",names:zT,props:{numArgs:0,allowedInText:!0},handler:(n,e)=>{var{breakOnTokenText:t,funcName:i,parser:r}=n,l=r.parseExpression(!1,t);return{type:"sizing",mode:r.mode,size:zT.indexOf(i)+1,body:l}},htmlBuilder:Bq,mathmlBuilder:(n,e)=>{var t=e.havingSize(n.size),i=Na(n.body,t),r=new kt.MathNode("mstyle",i);return r.setAttribute("mathsize",$t(t.sizeMultiplier)),r}});cn({type:"smash",names:["\\smash"],props:{numArgs:1,numOptionalArgs:1,allowedInText:!0},handler:(n,e,t)=>{var{parser:i}=n,r=!1,l=!1,h=t[0]&&Yn(t[0],"ordgroup");if(h)for(var o="",p=0;p<h.body.length;++p){var v=h.body[p];if(o=v.text,o==="t")r=!0;else if(o==="b")l=!0;else{r=!1,l=!1;break}}else r=!0,l=!0;var x=e[0];return{type:"smash",mode:i.mode,body:x,smashHeight:r,smashDepth:l}},htmlBuilder:(n,e)=>{var t=et.makeSpan([],[hi(n.body,e)]);if(!n.smashHeight&&!n.smashDepth)return t;if(n.smashHeight&&(t.height=0,t.children))for(var i=0;i<t.children.length;i++)t.children[i].height=0;if(n.smashDepth&&(t.depth=0,t.children))for(var r=0;r<t.children.length;r++)t.children[r].depth=0;var l=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t}]},e);return et.makeSpan(["mord"],[l],e)},mathmlBuilder:(n,e)=>{var t=new kt.MathNode("mpadded",[Pi(n.body,e)]);return n.smashHeight&&t.setAttribute("height","0px"),n.smashDepth&&t.setAttribute("depth","0px"),t}});cn({type:"sqrt",names:["\\sqrt"],props:{numArgs:1,numOptionalArgs:1},handler(n,e,t){var{parser:i}=n,r=t[0],l=e[0];return{type:"sqrt",mode:i.mode,body:l,index:r}},htmlBuilder(n,e){var t=hi(n.body,e.havingCrampedStyle());t.height===0&&(t.height=e.fontMetrics().xHeight),t=et.wrapFragment(t,e);var i=e.fontMetrics(),r=i.defaultRuleThickness,l=r;e.style.id<Ln.TEXT.id&&(l=e.fontMetrics().xHeight);var h=r+l/4,o=t.height+t.depth+h+r,{span:p,ruleWidth:v,advanceWidth:x}=pl.sqrtImage(o,e),M=p.height-v;M>t.height+t.depth+h&&(h=(h+M-t.height-t.depth)/2);var S=p.height-t.height-h-v;t.style.paddingLeft=$t(x);var A=et.makeVList({positionType:"firstBaseline",children:[{type:"elem",elem:t,wrapperClasses:["svg-align"]},{type:"kern",size:-(t.height+S)},{type:"elem",elem:p},{type:"kern",size:v}]},e);if(n.index){var L=e.havingStyle(Ln.SCRIPTSCRIPT),F=hi(n.index,L,e),k=.6*(A.height-A.depth),C=et.makeVList({positionType:"shift",positionData:-k,children:[{type:"elem",elem:F}]},e),V=et.makeSpan(["root"],[C]);return et.makeSpan(["mord","sqrt"],[V,A],e)}else return et.makeSpan(["mord","sqrt"],[A],e)},mathmlBuilder(n,e){var{body:t,index:i}=n;return i?new kt.MathNode("mroot",[Pi(t,e),Pi(i,e)]):new kt.MathNode("msqrt",[Pi(t,e)])}});var FT={display:Ln.DISPLAY,text:Ln.TEXT,script:Ln.SCRIPT,scriptscript:Ln.SCRIPTSCRIPT};cn({type:"styling",names:["\\displaystyle","\\textstyle","\\scriptstyle","\\scriptscriptstyle"],props:{numArgs:0,allowedInText:!0,primitive:!0},handler(n,e){var{breakOnTokenText:t,funcName:i,parser:r}=n,l=r.parseExpression(!0,t),h=i.slice(1,i.length-5);return{type:"styling",mode:r.mode,style:h,body:l}},htmlBuilder(n,e){var t=FT[n.style],i=e.havingStyle(t).withFont("");return B7(n.body,i,e)},mathmlBuilder(n,e){var t=FT[n.style],i=e.havingStyle(t),r=Na(n.body,i),l=new kt.MathNode("mstyle",r),h={display:["0","true"],text:["0","false"],script:["1","false"],scriptscript:["2","false"]},o=h[n.style];return l.setAttribute("scriptlevel",o[0]),l.setAttribute("displaystyle",o[1]),l}});var Oq=function(e,t){var i=e.base;if(i)if(i.type==="op"){var r=i.limits&&(t.style.size===Ln.DISPLAY.size||i.alwaysHandleSupSub);return r?df:null}else if(i.type==="operatorname"){var l=i.alwaysHandleSupSub&&(t.style.size===Ln.DISPLAY.size||i.limits);return l?N7:null}else{if(i.type==="accent")return kn.isCharacterBox(i.base)?Vw:null;if(i.type==="horizBrace"){var h=!e.sub;return h===i.isOver?L7:null}else return null}else return null};Qu({type:"supsub",htmlBuilder(n,e){var t=Oq(n,e);if(t)return t(n,e);var{base:i,sup:r,sub:l}=n,h=hi(i,e),o,p,v=e.fontMetrics(),x=0,M=0,S=i&&kn.isCharacterBox(i);if(r){var A=e.havingStyle(e.style.sup());o=hi(r,A,e),S||(x=h.height-A.fontMetrics().supDrop*A.sizeMultiplier/e.sizeMultiplier)}if(l){var L=e.havingStyle(e.style.sub());p=hi(l,L,e),S||(M=h.depth+L.fontMetrics().subDrop*L.sizeMultiplier/e.sizeMultiplier)}var F;e.style===Ln.DISPLAY?F=v.sup1:e.style.cramped?F=v.sup3:F=v.sup2;var k=e.sizeMultiplier,C=$t(.5/v.ptPerEm/k),V=null;if(p){var O=n.base&&n.base.type==="op"&&n.base.name&&(n.base.name==="\\oiint"||n.base.name==="\\oiiint");(h instanceof As||O)&&(V=$t(-h.italic))}var J;if(o&&p){x=Math.max(x,F,o.depth+.25*v.xHeight),M=Math.max(M,v.sub2);var ue=v.defaultRuleThickness,Y=4*ue;if(x-o.depth-(p.height-M)<Y){M=Y-(x-o.depth)+p.height;var Q=.8*v.xHeight-(x-o.depth);Q>0&&(x+=Q,M-=Q)}var xe=[{type:"elem",elem:p,shift:M,marginRight:C,marginLeft:V},{type:"elem",elem:o,shift:-x,marginRight:C}];J=et.makeVList({positionType:"individualShift",children:xe},e)}else if(p){M=Math.max(M,v.sub1,p.height-.8*v.xHeight);var re=[{type:"elem",elem:p,marginLeft:V,marginRight:C}];J=et.makeVList({positionType:"shift",positionData:M,children:re},e)}else if(o)x=Math.max(x,F,o.depth+.25*v.xHeight),J=et.makeVList({positionType:"shift",positionData:-x,children:[{type:"elem",elem:o,marginRight:C}]},e);else throw new Error("supsub must have either sup or sub.");var ee=cb(h,"right")||"mord";return et.makeSpan([ee],[h,et.makeSpan(["msupsub"],[J])],e)},mathmlBuilder(n,e){var t=!1,i,r;n.base&&n.base.type==="horizBrace"&&(r=!!n.sup,r===n.base.isOver&&(t=!0,i=n.base.isOver)),n.base&&(n.base.type==="op"||n.base.type==="operatorname")&&(n.base.parentIsSupSub=!0);var l=[Pi(n.base,e)];n.sub&&l.push(Pi(n.sub,e)),n.sup&&l.push(Pi(n.sup,e));var h;if(t)h=i?"mover":"munder";else if(n.sub)if(n.sup){var v=n.base;v&&v.type==="op"&&v.limits&&e.style===Ln.DISPLAY||v&&v.type==="operatorname"&&v.alwaysHandleSupSub&&(e.style===Ln.DISPLAY||v.limits)?h="munderover":h="msubsup"}else{var p=n.base;p&&p.type==="op"&&p.limits&&(e.style===Ln.DISPLAY||p.alwaysHandleSupSub)||p&&p.type==="operatorname"&&p.alwaysHandleSupSub&&(p.limits||e.style===Ln.DISPLAY)?h="munder":h="msub"}else{var o=n.base;o&&o.type==="op"&&o.limits&&(e.style===Ln.DISPLAY||o.alwaysHandleSupSub)||o&&o.type==="operatorname"&&o.alwaysHandleSupSub&&(o.limits||e.style===Ln.DISPLAY)?h="mover":h="msup"}return new kt.MathNode(h,l)}});Qu({type:"atom",htmlBuilder(n,e){return et.mathsym(n.text,n.mode,e,["m"+n.family])},mathmlBuilder(n,e){var t=new kt.MathNode("mo",[Cs(n.text,n.mode)]);if(n.family==="bin"){var i=Ow(n,e);i==="bold-italic"&&t.setAttribute("mathvariant",i)}else n.family==="punct"?t.setAttribute("separator","true"):(n.family==="open"||n.family==="close")&&t.setAttribute("stretchy","false");return t}});var O7={mi:"italic",mn:"normal",mtext:"normal"};Qu({type:"mathord",htmlBuilder(n,e){return et.makeOrd(n,e,"mathord")},mathmlBuilder(n,e){var t=new kt.MathNode("mi",[Cs(n.text,n.mode,e)]),i=Ow(n,e)||"italic";return i!==O7[t.type]&&t.setAttribute("mathvariant",i),t}});Qu({type:"textord",htmlBuilder(n,e){return et.makeOrd(n,e,"textord")},mathmlBuilder(n,e){var t=Cs(n.text,n.mode,e),i=Ow(n,e)||"normal",r;return n.mode==="text"?r=new kt.MathNode("mtext",[t]):/[0-9]/.test(n.text)?r=new kt.MathNode("mn",[t]):n.text==="\\prime"?r=new kt.MathNode("mo",[t]):r=new kt.MathNode("mi",[t]),i!==O7[r.type]&&r.setAttribute("mathvariant",i),r}});var Nx={"\\nobreak":"nobreak","\\allowbreak":"allowbreak"},Bx={" ":{},"\\ ":{},"~":{className:"nobreak"},"\\space":{},"\\nobreakspace":{className:"nobreak"}};Qu({type:"spacing",htmlBuilder(n,e){if(Bx.hasOwnProperty(n.text)){var t=Bx[n.text].className||"";if(n.mode==="text"){var i=et.makeOrd(n,e,"textord");return i.classes.push(t),i}else return et.makeSpan(["mspace",t],[et.mathsym(n.text,n.mode,e)],e)}else{if(Nx.hasOwnProperty(n.text))return et.makeSpan(["mspace",Nx[n.text]],[],e);throw new Ut('Unknown type of space "'+n.text+'"')}},mathmlBuilder(n,e){var t;if(Bx.hasOwnProperty(n.text))t=new kt.MathNode("mtext",[new kt.TextNode(" ")]);else{if(Nx.hasOwnProperty(n.text))return new kt.MathNode("mspace");throw new Ut('Unknown type of space "'+n.text+'"')}return t}});var NT=()=>{var n=new kt.MathNode("mtd",[]);return n.setAttribute("width","50%"),n};Qu({type:"tag",mathmlBuilder(n,e){var t=new kt.MathNode("mtable",[new kt.MathNode("mtr",[NT(),new kt.MathNode("mtd",[Nc(n.body,e)]),NT(),new kt.MathNode("mtd",[Nc(n.tag,e)])])]);return t.setAttribute("width","100%"),t}});var BT={"\\text":void 0,"\\textrm":"textrm","\\textsf":"textsf","\\texttt":"texttt","\\textnormal":"textrm"},OT={"\\textbf":"textbf","\\textmd":"textmd"},Uq={"\\textit":"textit","\\textup":"textup"},UT=(n,e)=>{var t=n.font;return t?BT[t]?e.withTextFontFamily(BT[t]):OT[t]?e.withTextFontWeight(OT[t]):e.withTextFontShape(Uq[t]):e};cn({type:"text",names:["\\text","\\textrm","\\textsf","\\texttt","\\textnormal","\\textbf","\\textmd","\\textit","\\textup"],props:{numArgs:1,argTypes:["text"],allowedInArgument:!0,allowedInText:!0},handler(n,e){var{parser:t,funcName:i}=n,r=e[0];return{type:"text",mode:t.mode,body:fr(r),font:i}},htmlBuilder(n,e){var t=UT(n,e),i=Tr(n.body,t,!0);return et.makeSpan(["mord","text"],i,t)},mathmlBuilder(n,e){var t=UT(n,e);return Nc(n.body,t)}});cn({type:"underline",names:["\\underline"],props:{numArgs:1,allowedInText:!0},handler(n,e){var{parser:t}=n;return{type:"underline",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=hi(n.body,e),i=et.makeLineSpan("underline-line",e),r=e.fontMetrics().defaultRuleThickness,l=et.makeVList({positionType:"top",positionData:t.height,children:[{type:"kern",size:r},{type:"elem",elem:i},{type:"kern",size:3*r},{type:"elem",elem:t}]},e);return et.makeSpan(["mord","underline"],[l],e)},mathmlBuilder(n,e){var t=new kt.MathNode("mo",[new kt.TextNode("‾")]);t.setAttribute("stretchy","true");var i=new kt.MathNode("munder",[Pi(n.body,e),t]);return i.setAttribute("accentunder","true"),i}});cn({type:"vcenter",names:["\\vcenter"],props:{numArgs:1,argTypes:["original"],allowedInText:!1},handler(n,e){var{parser:t}=n;return{type:"vcenter",mode:t.mode,body:e[0]}},htmlBuilder(n,e){var t=hi(n.body,e),i=e.fontMetrics().axisHeight,r=.5*(t.height-i-(t.depth+i));return et.makeVList({positionType:"shift",positionData:r,children:[{type:"elem",elem:t}]},e)},mathmlBuilder(n,e){return new kt.MathNode("mpadded",[Pi(n.body,e)],["vcenter"])}});cn({type:"verb",names:["\\verb"],props:{numArgs:0,allowedInText:!0},handler(n,e,t){throw new Ut("\\verb ended by end of line instead of matching delimiter")},htmlBuilder(n,e){for(var t=VT(n),i=[],r=e.havingStyle(e.style.text()),l=0;l<t.length;l++){var h=t[l];h==="~"&&(h="\\textasciitilde"),i.push(et.makeSymbol(h,"Typewriter-Regular",n.mode,r,["mord","texttt"]))}return et.makeSpan(["mord","text"].concat(r.sizingClasses(e)),et.tryCombineChars(i),r)},mathmlBuilder(n,e){var t=new kt.TextNode(VT(n)),i=new kt.MathNode("mtext",[t]);return i.setAttribute("mathvariant","monospace"),i}});var VT=n=>n.body.replace(/ /g,n.star?"␣":" "),xc=l7,U7=`[ \r
	]`,Vq="\\\\[a-zA-Z@]+",Hq="\\\\[^\uD800-\uDFFF]",Gq="("+Vq+")"+U7+"*",jq=`\\\\(
|[ \r	]+
?)[ \r	]*`,fb="[̀-ͯ]",Wq=new RegExp(fb+"+$"),qq="("+U7+"+)|"+(jq+"|")+"([!-\\[\\]-‧‪-퟿豈-￿]"+(fb+"*")+"|[\uD800-\uDBFF][\uDC00-\uDFFF]"+(fb+"*")+"|\\\\verb\\*([^]).*?\\4|\\\\verb([^*a-zA-Z]).*?\\5"+("|"+Gq)+("|"+Hq+")");class HT{constructor(e,t){this.input=void 0,this.settings=void 0,this.tokenRegex=void 0,this.catcodes=void 0,this.input=e,this.settings=t,this.tokenRegex=new RegExp(qq,"g"),this.catcodes={"%":14,"~":13}}setCatcode(e,t){this.catcodes[e]=t}lex(){var e=this.input,t=this.tokenRegex.lastIndex;if(t===e.length)return new Ms("EOF",new Ya(this,t,t));var i=this.tokenRegex.exec(e);if(i===null||i.index!==t)throw new Ut("Unexpected character: '"+e[t]+"'",new Ms(e[t],new Ya(this,t,t+1)));var r=i[6]||i[3]||(i[2]?"\\ ":" ");if(this.catcodes[r]===14){var l=e.indexOf(`
`,this.tokenRegex.lastIndex);return l===-1?(this.tokenRegex.lastIndex=e.length,this.settings.reportNonstrict("commentAtEnd","% comment has no terminating newline; LaTeX would fail because of commenting the end of math mode (e.g. $)")):this.tokenRegex.lastIndex=l+1,this.lex()}return new Ms(r,new Ya(this,t,this.tokenRegex.lastIndex))}}class $q{constructor(e,t){e===void 0&&(e={}),t===void 0&&(t={}),this.current=void 0,this.builtins=void 0,this.undefStack=void 0,this.current=t,this.builtins=e,this.undefStack=[]}beginGroup(){this.undefStack.push({})}endGroup(){if(this.undefStack.length===0)throw new Ut("Unbalanced namespace destruction: attempt to pop global namespace; please report this as a bug");var e=this.undefStack.pop();for(var t in e)e.hasOwnProperty(t)&&(e[t]==null?delete this.current[t]:this.current[t]=e[t])}endGroups(){for(;this.undefStack.length>0;)this.endGroup()}has(e){return this.current.hasOwnProperty(e)||this.builtins.hasOwnProperty(e)}get(e){return this.current.hasOwnProperty(e)?this.current[e]:this.builtins[e]}set(e,t,i){if(i===void 0&&(i=!1),i){for(var r=0;r<this.undefStack.length;r++)delete this.undefStack[r][e];this.undefStack.length>0&&(this.undefStack[this.undefStack.length-1][e]=t)}else{var l=this.undefStack[this.undefStack.length-1];l&&!l.hasOwnProperty(e)&&(l[e]=this.current[e])}t==null?delete this.current[e]:this.current[e]=t}}var Xq=P7;he("\\noexpand",function(n){var e=n.popToken();return n.isExpandable(e.text)&&(e.noexpand=!0,e.treatAsRelax=!0),{tokens:[e],numArgs:0}});he("\\expandafter",function(n){var e=n.popToken();return n.expandOnce(!0),{tokens:[e],numArgs:0}});he("\\@firstoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[0],numArgs:0}});he("\\@secondoftwo",function(n){var e=n.consumeArgs(2);return{tokens:e[1],numArgs:0}});he("\\@ifnextchar",function(n){var e=n.consumeArgs(3);n.consumeSpaces();var t=n.future();return e[0].length===1&&e[0][0].text===t.text?{tokens:e[1],numArgs:0}:{tokens:e[2],numArgs:0}});he("\\@ifstar","\\@ifnextchar *{\\@firstoftwo{#1}}");he("\\TextOrMath",function(n){var e=n.consumeArgs(2);return n.mode==="text"?{tokens:e[0],numArgs:0}:{tokens:e[1],numArgs:0}});var GT={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,a:10,A:10,b:11,B:11,c:12,C:12,d:13,D:13,e:14,E:14,f:15,F:15};he("\\char",function(n){var e=n.popToken(),t,i="";if(e.text==="'")t=8,e=n.popToken();else if(e.text==='"')t=16,e=n.popToken();else if(e.text==="`")if(e=n.popToken(),e.text[0]==="\\")i=e.text.charCodeAt(1);else{if(e.text==="EOF")throw new Ut("\\char` missing argument");i=e.text.charCodeAt(0)}else t=10;if(t){if(i=GT[e.text],i==null||i>=t)throw new Ut("Invalid base-"+t+" digit "+e.text);for(var r;(r=GT[n.future().text])!=null&&r<t;)i*=t,i+=r,n.popToken()}return"\\@char{"+i+"}"});var Zw=(n,e,t)=>{var i=n.consumeArg().tokens;if(i.length!==1)throw new Ut("\\newcommand's first argument must be a macro name");var r=i[0].text,l=n.isDefined(r);if(l&&!e)throw new Ut("\\newcommand{"+r+"} attempting to redefine "+(r+"; use \\renewcommand"));if(!l&&!t)throw new Ut("\\renewcommand{"+r+"} when command "+r+" does not yet exist; use \\newcommand");var h=0;if(i=n.consumeArg().tokens,i.length===1&&i[0].text==="["){for(var o="",p=n.expandNextToken();p.text!=="]"&&p.text!=="EOF";)o+=p.text,p=n.expandNextToken();if(!o.match(/^\s*[0-9]+\s*$/))throw new Ut("Invalid number of arguments: "+o);h=parseInt(o),i=n.consumeArg().tokens}return n.macros.set(r,{tokens:i,numArgs:h}),""};he("\\newcommand",n=>Zw(n,!1,!0));he("\\renewcommand",n=>Zw(n,!0,!1));he("\\providecommand",n=>Zw(n,!0,!0));he("\\message",n=>{var e=n.consumeArgs(1)[0];return console.log(e.reverse().map(t=>t.text).join("")),""});he("\\errmessage",n=>{var e=n.consumeArgs(1)[0];return console.error(e.reverse().map(t=>t.text).join("")),""});he("\\show",n=>{var e=n.popToken(),t=e.text;return console.log(e,n.macros.get(t),xc[t],Di.math[t],Di.text[t]),""});he("\\bgroup","{");he("\\egroup","}");he("~","\\nobreakspace");he("\\lq","`");he("\\rq","'");he("\\aa","\\r a");he("\\AA","\\r A");he("\\textcopyright","\\html@mathml{\\textcircled{c}}{\\char`©}");he("\\copyright","\\TextOrMath{\\textcopyright}{\\text{\\textcopyright}}");he("\\textregistered","\\html@mathml{\\textcircled{\\scriptsize R}}{\\char`®}");he("ℬ","\\mathscr{B}");he("ℰ","\\mathscr{E}");he("ℱ","\\mathscr{F}");he("ℋ","\\mathscr{H}");he("ℐ","\\mathscr{I}");he("ℒ","\\mathscr{L}");he("ℳ","\\mathscr{M}");he("ℛ","\\mathscr{R}");he("ℭ","\\mathfrak{C}");he("ℌ","\\mathfrak{H}");he("ℨ","\\mathfrak{Z}");he("\\Bbbk","\\Bbb{k}");he("·","\\cdotp");he("\\llap","\\mathllap{\\textrm{#1}}");he("\\rlap","\\mathrlap{\\textrm{#1}}");he("\\clap","\\mathclap{\\textrm{#1}}");he("\\mathstrut","\\vphantom{(}");he("\\underbar","\\underline{\\text{#1}}");he("\\not",'\\html@mathml{\\mathrel{\\mathrlap\\@not}}{\\char"338}');he("\\neq","\\html@mathml{\\mathrel{\\not=}}{\\mathrel{\\char`≠}}");he("\\ne","\\neq");he("≠","\\neq");he("\\notin","\\html@mathml{\\mathrel{{\\in}\\mathllap{/\\mskip1mu}}}{\\mathrel{\\char`∉}}");he("∉","\\notin");he("≘","\\html@mathml{\\mathrel{=\\kern{-1em}\\raisebox{0.4em}{$\\scriptsize\\frown$}}}{\\mathrel{\\char`≘}}");he("≙","\\html@mathml{\\stackrel{\\tiny\\wedge}{=}}{\\mathrel{\\char`≘}}");he("≚","\\html@mathml{\\stackrel{\\tiny\\vee}{=}}{\\mathrel{\\char`≚}}");he("≛","\\html@mathml{\\stackrel{\\scriptsize\\star}{=}}{\\mathrel{\\char`≛}}");he("≝","\\html@mathml{\\stackrel{\\tiny\\mathrm{def}}{=}}{\\mathrel{\\char`≝}}");he("≞","\\html@mathml{\\stackrel{\\tiny\\mathrm{m}}{=}}{\\mathrel{\\char`≞}}");he("≟","\\html@mathml{\\stackrel{\\tiny?}{=}}{\\mathrel{\\char`≟}}");he("⟂","\\perp");he("‼","\\mathclose{!\\mkern-0.8mu!}");he("∌","\\notni");he("⌜","\\ulcorner");he("⌝","\\urcorner");he("⌞","\\llcorner");he("⌟","\\lrcorner");he("©","\\copyright");he("®","\\textregistered");he("️","\\textregistered");he("\\ulcorner",'\\html@mathml{\\@ulcorner}{\\mathop{\\char"231c}}');he("\\urcorner",'\\html@mathml{\\@urcorner}{\\mathop{\\char"231d}}');he("\\llcorner",'\\html@mathml{\\@llcorner}{\\mathop{\\char"231e}}');he("\\lrcorner",'\\html@mathml{\\@lrcorner}{\\mathop{\\char"231f}}');he("\\vdots","\\mathord{\\varvdots\\rule{0pt}{15pt}}");he("⋮","\\vdots");he("\\varGamma","\\mathit{\\Gamma}");he("\\varDelta","\\mathit{\\Delta}");he("\\varTheta","\\mathit{\\Theta}");he("\\varLambda","\\mathit{\\Lambda}");he("\\varXi","\\mathit{\\Xi}");he("\\varPi","\\mathit{\\Pi}");he("\\varSigma","\\mathit{\\Sigma}");he("\\varUpsilon","\\mathit{\\Upsilon}");he("\\varPhi","\\mathit{\\Phi}");he("\\varPsi","\\mathit{\\Psi}");he("\\varOmega","\\mathit{\\Omega}");he("\\substack","\\begin{subarray}{c}#1\\end{subarray}");he("\\colon","\\nobreak\\mskip2mu\\mathpunct{}\\mathchoice{\\mkern-3mu}{\\mkern-3mu}{}{}{:}\\mskip6mu\\relax");he("\\boxed","\\fbox{$\\displaystyle{#1}$}");he("\\iff","\\DOTSB\\;\\Longleftrightarrow\\;");he("\\implies","\\DOTSB\\;\\Longrightarrow\\;");he("\\impliedby","\\DOTSB\\;\\Longleftarrow\\;");var jT={",":"\\dotsc","\\not":"\\dotsb","+":"\\dotsb","=":"\\dotsb","<":"\\dotsb",">":"\\dotsb","-":"\\dotsb","*":"\\dotsb",":":"\\dotsb","\\DOTSB":"\\dotsb","\\coprod":"\\dotsb","\\bigvee":"\\dotsb","\\bigwedge":"\\dotsb","\\biguplus":"\\dotsb","\\bigcap":"\\dotsb","\\bigcup":"\\dotsb","\\prod":"\\dotsb","\\sum":"\\dotsb","\\bigotimes":"\\dotsb","\\bigoplus":"\\dotsb","\\bigodot":"\\dotsb","\\bigsqcup":"\\dotsb","\\And":"\\dotsb","\\longrightarrow":"\\dotsb","\\Longrightarrow":"\\dotsb","\\longleftarrow":"\\dotsb","\\Longleftarrow":"\\dotsb","\\longleftrightarrow":"\\dotsb","\\Longleftrightarrow":"\\dotsb","\\mapsto":"\\dotsb","\\longmapsto":"\\dotsb","\\hookrightarrow":"\\dotsb","\\doteq":"\\dotsb","\\mathbin":"\\dotsb","\\mathrel":"\\dotsb","\\relbar":"\\dotsb","\\Relbar":"\\dotsb","\\xrightarrow":"\\dotsb","\\xleftarrow":"\\dotsb","\\DOTSI":"\\dotsi","\\int":"\\dotsi","\\oint":"\\dotsi","\\iint":"\\dotsi","\\iiint":"\\dotsi","\\iiiint":"\\dotsi","\\idotsint":"\\dotsi","\\DOTSX":"\\dotsx"};he("\\dots",function(n){var e="\\dotso",t=n.expandAfterFuture().text;return t in jT?e=jT[t]:(t.slice(0,4)==="\\not"||t in Di.math&&kn.contains(["bin","rel"],Di.math[t].group))&&(e="\\dotsb"),e});var Yw={")":!0,"]":!0,"\\rbrack":!0,"\\}":!0,"\\rbrace":!0,"\\rangle":!0,"\\rceil":!0,"\\rfloor":!0,"\\rgroup":!0,"\\rmoustache":!0,"\\right":!0,"\\bigr":!0,"\\biggr":!0,"\\Bigr":!0,"\\Biggr":!0,$:!0,";":!0,".":!0,",":!0};he("\\dotso",function(n){var e=n.future().text;return e in Yw?"\\ldots\\,":"\\ldots"});he("\\dotsc",function(n){var e=n.future().text;return e in Yw&&e!==","?"\\ldots\\,":"\\ldots"});he("\\cdots",function(n){var e=n.future().text;return e in Yw?"\\@cdots\\,":"\\@cdots"});he("\\dotsb","\\cdots");he("\\dotsm","\\cdots");he("\\dotsi","\\!\\cdots");he("\\dotsx","\\ldots\\,");he("\\DOTSI","\\relax");he("\\DOTSB","\\relax");he("\\DOTSX","\\relax");he("\\tmspace","\\TextOrMath{\\kern#1#3}{\\mskip#1#2}\\relax");he("\\,","\\tmspace+{3mu}{.1667em}");he("\\thinspace","\\,");he("\\>","\\mskip{4mu}");he("\\:","\\tmspace+{4mu}{.2222em}");he("\\medspace","\\:");he("\\;","\\tmspace+{5mu}{.2777em}");he("\\thickspace","\\;");he("\\!","\\tmspace-{3mu}{.1667em}");he("\\negthinspace","\\!");he("\\negmedspace","\\tmspace-{4mu}{.2222em}");he("\\negthickspace","\\tmspace-{5mu}{.277em}");he("\\enspace","\\kern.5em ");he("\\enskip","\\hskip.5em\\relax");he("\\quad","\\hskip1em\\relax");he("\\qquad","\\hskip2em\\relax");he("\\tag","\\@ifstar\\tag@literal\\tag@paren");he("\\tag@paren","\\tag@literal{({#1})}");he("\\tag@literal",n=>{if(n.macros.get("\\df@tag"))throw new Ut("Multiple \\tag");return"\\gdef\\df@tag{\\text{#1}}"});he("\\bmod","\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}\\mathbin{\\rm mod}\\mathchoice{\\mskip1mu}{\\mskip1mu}{\\mskip5mu}{\\mskip5mu}");he("\\pod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern8mu}{\\mkern8mu}{\\mkern8mu}(#1)");he("\\pmod","\\pod{{\\rm mod}\\mkern6mu#1}");he("\\mod","\\allowbreak\\mathchoice{\\mkern18mu}{\\mkern12mu}{\\mkern12mu}{\\mkern12mu}{\\rm mod}\\,\\,#1");he("\\newline","\\\\\\relax");he("\\TeX","\\textrm{\\html@mathml{T\\kern-.1667em\\raisebox{-.5ex}{E}\\kern-.125emX}{TeX}}");var V7=$t(xo["Main-Regular"][84][1]-.7*xo["Main-Regular"][65][1]);he("\\LaTeX","\\textrm{\\html@mathml{"+("L\\kern-.36em\\raisebox{"+V7+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{LaTeX}}");he("\\KaTeX","\\textrm{\\html@mathml{"+("K\\kern-.17em\\raisebox{"+V7+"}{\\scriptstyle A}")+"\\kern-.15em\\TeX}{KaTeX}}");he("\\hspace","\\@ifstar\\@hspacer\\@hspace");he("\\@hspace","\\hskip #1\\relax");he("\\@hspacer","\\rule{0pt}{0pt}\\hskip #1\\relax");he("\\ordinarycolon",":");he("\\vcentcolon","\\mathrel{\\mathop\\ordinarycolon}");he("\\dblcolon",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-.9mu}\\vcentcolon}}{\\mathop{\\char"2237}}');he("\\coloneqq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2254}}');he("\\Coloneqq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}=}}{\\mathop{\\char"2237\\char"3d}}');he("\\coloneq",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"3a\\char"2212}}');he("\\Coloneq",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\mathrel{-}}}{\\mathop{\\char"2237\\char"2212}}');he("\\eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2255}}');he("\\Eqqcolon",'\\html@mathml{\\mathrel{=\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"3d\\char"2237}}');he("\\eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\vcentcolon}}{\\mathop{\\char"2239}}');he("\\Eqcolon",'\\html@mathml{\\mathrel{\\mathrel{-}\\mathrel{\\mkern-1.2mu}\\dblcolon}}{\\mathop{\\char"2212\\char"2237}}');he("\\colonapprox",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"3a\\char"2248}}');he("\\Colonapprox",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\approx}}{\\mathop{\\char"2237\\char"2248}}');he("\\colonsim",'\\html@mathml{\\mathrel{\\vcentcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"3a\\char"223c}}');he("\\Colonsim",'\\html@mathml{\\mathrel{\\dblcolon\\mathrel{\\mkern-1.2mu}\\sim}}{\\mathop{\\char"2237\\char"223c}}');he("∷","\\dblcolon");he("∹","\\eqcolon");he("≔","\\coloneqq");he("≕","\\eqqcolon");he("⩴","\\Coloneqq");he("\\ratio","\\vcentcolon");he("\\coloncolon","\\dblcolon");he("\\colonequals","\\coloneqq");he("\\coloncolonequals","\\Coloneqq");he("\\equalscolon","\\eqqcolon");he("\\equalscoloncolon","\\Eqqcolon");he("\\colonminus","\\coloneq");he("\\coloncolonminus","\\Coloneq");he("\\minuscolon","\\eqcolon");he("\\minuscoloncolon","\\Eqcolon");he("\\coloncolonapprox","\\Colonapprox");he("\\coloncolonsim","\\Colonsim");he("\\simcolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\vcentcolon}");he("\\simcoloncolon","\\mathrel{\\sim\\mathrel{\\mkern-1.2mu}\\dblcolon}");he("\\approxcolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\vcentcolon}");he("\\approxcoloncolon","\\mathrel{\\approx\\mathrel{\\mkern-1.2mu}\\dblcolon}");he("\\notni","\\html@mathml{\\not\\ni}{\\mathrel{\\char`∌}}");he("\\limsup","\\DOTSB\\operatorname*{lim\\,sup}");he("\\liminf","\\DOTSB\\operatorname*{lim\\,inf}");he("\\injlim","\\DOTSB\\operatorname*{inj\\,lim}");he("\\projlim","\\DOTSB\\operatorname*{proj\\,lim}");he("\\varlimsup","\\DOTSB\\operatorname*{\\overline{lim}}");he("\\varliminf","\\DOTSB\\operatorname*{\\underline{lim}}");he("\\varinjlim","\\DOTSB\\operatorname*{\\underrightarrow{lim}}");he("\\varprojlim","\\DOTSB\\operatorname*{\\underleftarrow{lim}}");he("\\gvertneqq","\\html@mathml{\\@gvertneqq}{≩}");he("\\lvertneqq","\\html@mathml{\\@lvertneqq}{≨}");he("\\ngeqq","\\html@mathml{\\@ngeqq}{≱}");he("\\ngeqslant","\\html@mathml{\\@ngeqslant}{≱}");he("\\nleqq","\\html@mathml{\\@nleqq}{≰}");he("\\nleqslant","\\html@mathml{\\@nleqslant}{≰}");he("\\nshortmid","\\html@mathml{\\@nshortmid}{∤}");he("\\nshortparallel","\\html@mathml{\\@nshortparallel}{∦}");he("\\nsubseteqq","\\html@mathml{\\@nsubseteqq}{⊈}");he("\\nsupseteqq","\\html@mathml{\\@nsupseteqq}{⊉}");he("\\varsubsetneq","\\html@mathml{\\@varsubsetneq}{⊊}");he("\\varsubsetneqq","\\html@mathml{\\@varsubsetneqq}{⫋}");he("\\varsupsetneq","\\html@mathml{\\@varsupsetneq}{⊋}");he("\\varsupsetneqq","\\html@mathml{\\@varsupsetneqq}{⫌}");he("\\imath","\\html@mathml{\\@imath}{ı}");he("\\jmath","\\html@mathml{\\@jmath}{ȷ}");he("\\llbracket","\\html@mathml{\\mathopen{[\\mkern-3.2mu[}}{\\mathopen{\\char`⟦}}");he("\\rrbracket","\\html@mathml{\\mathclose{]\\mkern-3.2mu]}}{\\mathclose{\\char`⟧}}");he("⟦","\\llbracket");he("⟧","\\rrbracket");he("\\lBrace","\\html@mathml{\\mathopen{\\{\\mkern-3.2mu[}}{\\mathopen{\\char`⦃}}");he("\\rBrace","\\html@mathml{\\mathclose{]\\mkern-3.2mu\\}}}{\\mathclose{\\char`⦄}}");he("⦃","\\lBrace");he("⦄","\\rBrace");he("\\minuso","\\mathbin{\\html@mathml{{\\mathrlap{\\mathchoice{\\kern{0.145em}}{\\kern{0.145em}}{\\kern{0.1015em}}{\\kern{0.0725em}}\\circ}{-}}}{\\char`⦵}}");he("⦵","\\minuso");he("\\darr","\\downarrow");he("\\dArr","\\Downarrow");he("\\Darr","\\Downarrow");he("\\lang","\\langle");he("\\rang","\\rangle");he("\\uarr","\\uparrow");he("\\uArr","\\Uparrow");he("\\Uarr","\\Uparrow");he("\\N","\\mathbb{N}");he("\\R","\\mathbb{R}");he("\\Z","\\mathbb{Z}");he("\\alef","\\aleph");he("\\alefsym","\\aleph");he("\\Alpha","\\mathrm{A}");he("\\Beta","\\mathrm{B}");he("\\bull","\\bullet");he("\\Chi","\\mathrm{X}");he("\\clubs","\\clubsuit");he("\\cnums","\\mathbb{C}");he("\\Complex","\\mathbb{C}");he("\\Dagger","\\ddagger");he("\\diamonds","\\diamondsuit");he("\\empty","\\emptyset");he("\\Epsilon","\\mathrm{E}");he("\\Eta","\\mathrm{H}");he("\\exist","\\exists");he("\\harr","\\leftrightarrow");he("\\hArr","\\Leftrightarrow");he("\\Harr","\\Leftrightarrow");he("\\hearts","\\heartsuit");he("\\image","\\Im");he("\\infin","\\infty");he("\\Iota","\\mathrm{I}");he("\\isin","\\in");he("\\Kappa","\\mathrm{K}");he("\\larr","\\leftarrow");he("\\lArr","\\Leftarrow");he("\\Larr","\\Leftarrow");he("\\lrarr","\\leftrightarrow");he("\\lrArr","\\Leftrightarrow");he("\\Lrarr","\\Leftrightarrow");he("\\Mu","\\mathrm{M}");he("\\natnums","\\mathbb{N}");he("\\Nu","\\mathrm{N}");he("\\Omicron","\\mathrm{O}");he("\\plusmn","\\pm");he("\\rarr","\\rightarrow");he("\\rArr","\\Rightarrow");he("\\Rarr","\\Rightarrow");he("\\real","\\Re");he("\\reals","\\mathbb{R}");he("\\Reals","\\mathbb{R}");he("\\Rho","\\mathrm{P}");he("\\sdot","\\cdot");he("\\sect","\\S");he("\\spades","\\spadesuit");he("\\sub","\\subset");he("\\sube","\\subseteq");he("\\supe","\\supseteq");he("\\Tau","\\mathrm{T}");he("\\thetasym","\\vartheta");he("\\weierp","\\wp");he("\\Zeta","\\mathrm{Z}");he("\\argmin","\\DOTSB\\operatorname*{arg\\,min}");he("\\argmax","\\DOTSB\\operatorname*{arg\\,max}");he("\\plim","\\DOTSB\\mathop{\\operatorname{plim}}\\limits");he("\\bra","\\mathinner{\\langle{#1}|}");he("\\ket","\\mathinner{|{#1}\\rangle}");he("\\braket","\\mathinner{\\langle{#1}\\rangle}");he("\\Bra","\\left\\langle#1\\right|");he("\\Ket","\\left|#1\\right\\rangle");var H7=n=>e=>{var t=e.consumeArg().tokens,i=e.consumeArg().tokens,r=e.consumeArg().tokens,l=e.consumeArg().tokens,h=e.macros.get("|"),o=e.macros.get("\\|");e.macros.beginGroup();var p=M=>S=>{n&&(S.macros.set("|",h),r.length&&S.macros.set("\\|",o));var A=M;if(!M&&r.length){var L=S.future();L.text==="|"&&(S.popToken(),A=!0)}return{tokens:A?r:i,numArgs:0}};e.macros.set("|",p(!1)),r.length&&e.macros.set("\\|",p(!0));var v=e.consumeArg().tokens,x=e.expandTokens([...l,...v,...t]);return e.macros.endGroup(),{tokens:x.reverse(),numArgs:0}};he("\\bra@ket",H7(!1));he("\\bra@set",H7(!0));he("\\Braket","\\bra@ket{\\left\\langle}{\\,\\middle\\vert\\,}{\\,\\middle\\vert\\,}{\\right\\rangle}");he("\\Set","\\bra@set{\\left\\{\\:}{\\;\\middle\\vert\\;}{\\;\\middle\\Vert\\;}{\\:\\right\\}}");he("\\set","\\bra@set{\\{\\,}{\\mid}{}{\\,\\}}");he("\\angln","{\\angl n}");he("\\blue","\\textcolor{##6495ed}{#1}");he("\\orange","\\textcolor{##ffa500}{#1}");he("\\pink","\\textcolor{##ff00af}{#1}");he("\\red","\\textcolor{##df0030}{#1}");he("\\green","\\textcolor{##28ae7b}{#1}");he("\\gray","\\textcolor{gray}{#1}");he("\\purple","\\textcolor{##9d38bd}{#1}");he("\\blueA","\\textcolor{##ccfaff}{#1}");he("\\blueB","\\textcolor{##80f6ff}{#1}");he("\\blueC","\\textcolor{##63d9ea}{#1}");he("\\blueD","\\textcolor{##11accd}{#1}");he("\\blueE","\\textcolor{##0c7f99}{#1}");he("\\tealA","\\textcolor{##94fff5}{#1}");he("\\tealB","\\textcolor{##26edd5}{#1}");he("\\tealC","\\textcolor{##01d1c1}{#1}");he("\\tealD","\\textcolor{##01a995}{#1}");he("\\tealE","\\textcolor{##208170}{#1}");he("\\greenA","\\textcolor{##b6ffb0}{#1}");he("\\greenB","\\textcolor{##8af281}{#1}");he("\\greenC","\\textcolor{##74cf70}{#1}");he("\\greenD","\\textcolor{##1fab54}{#1}");he("\\greenE","\\textcolor{##0d923f}{#1}");he("\\goldA","\\textcolor{##ffd0a9}{#1}");he("\\goldB","\\textcolor{##ffbb71}{#1}");he("\\goldC","\\textcolor{##ff9c39}{#1}");he("\\goldD","\\textcolor{##e07d10}{#1}");he("\\goldE","\\textcolor{##a75a05}{#1}");he("\\redA","\\textcolor{##fca9a9}{#1}");he("\\redB","\\textcolor{##ff8482}{#1}");he("\\redC","\\textcolor{##f9685d}{#1}");he("\\redD","\\textcolor{##e84d39}{#1}");he("\\redE","\\textcolor{##bc2612}{#1}");he("\\maroonA","\\textcolor{##ffbde0}{#1}");he("\\maroonB","\\textcolor{##ff92c6}{#1}");he("\\maroonC","\\textcolor{##ed5fa6}{#1}");he("\\maroonD","\\textcolor{##ca337c}{#1}");he("\\maroonE","\\textcolor{##9e034e}{#1}");he("\\purpleA","\\textcolor{##ddd7ff}{#1}");he("\\purpleB","\\textcolor{##c6b9fc}{#1}");he("\\purpleC","\\textcolor{##aa87ff}{#1}");he("\\purpleD","\\textcolor{##7854ab}{#1}");he("\\purpleE","\\textcolor{##543b78}{#1}");he("\\mintA","\\textcolor{##f5f9e8}{#1}");he("\\mintB","\\textcolor{##edf2df}{#1}");he("\\mintC","\\textcolor{##e0e5cc}{#1}");he("\\grayA","\\textcolor{##f6f7f7}{#1}");he("\\grayB","\\textcolor{##f0f1f2}{#1}");he("\\grayC","\\textcolor{##e3e5e6}{#1}");he("\\grayD","\\textcolor{##d6d8da}{#1}");he("\\grayE","\\textcolor{##babec2}{#1}");he("\\grayF","\\textcolor{##888d93}{#1}");he("\\grayG","\\textcolor{##626569}{#1}");he("\\grayH","\\textcolor{##3b3e40}{#1}");he("\\grayI","\\textcolor{##21242c}{#1}");he("\\kaBlue","\\textcolor{##314453}{#1}");he("\\kaGreen","\\textcolor{##71B307}{#1}");var G7={"^":!0,_:!0,"\\limits":!0,"\\nolimits":!0};class Zq{constructor(e,t,i){this.settings=void 0,this.expansionCount=void 0,this.lexer=void 0,this.macros=void 0,this.stack=void 0,this.mode=void 0,this.settings=t,this.expansionCount=0,this.feed(e),this.macros=new $q(Xq,t.macros),this.mode=i,this.stack=[]}feed(e){this.lexer=new HT(e,this.settings)}switchMode(e){this.mode=e}beginGroup(){this.macros.beginGroup()}endGroup(){this.macros.endGroup()}endGroups(){this.macros.endGroups()}future(){return this.stack.length===0&&this.pushToken(this.lexer.lex()),this.stack[this.stack.length-1]}popToken(){return this.future(),this.stack.pop()}pushToken(e){this.stack.push(e)}pushTokens(e){this.stack.push(...e)}scanArgument(e){var t,i,r;if(e){if(this.consumeSpaces(),this.future().text!=="[")return null;t=this.popToken(),{tokens:r,end:i}=this.consumeArg(["]"])}else({tokens:r,start:t,end:i}=this.consumeArg());return this.pushToken(new Ms("EOF",i.loc)),this.pushTokens(r),t.range(i,"")}consumeSpaces(){for(;;){var e=this.future();if(e.text===" ")this.stack.pop();else break}}consumeArg(e){var t=[],i=e&&e.length>0;i||this.consumeSpaces();var r=this.future(),l,h=0,o=0;do{if(l=this.popToken(),t.push(l),l.text==="{")++h;else if(l.text==="}"){if(--h,h===-1)throw new Ut("Extra }",l)}else if(l.text==="EOF")throw new Ut("Unexpected end of input in a macro argument, expected '"+(e&&i?e[o]:"}")+"'",l);if(e&&i)if((h===0||h===1&&e[o]==="{")&&l.text===e[o]){if(++o,o===e.length){t.splice(-o,o);break}}else o=0}while(h!==0||i);return r.text==="{"&&t[t.length-1].text==="}"&&(t.pop(),t.shift()),t.reverse(),{tokens:t,start:r,end:l}}consumeArgs(e,t){if(t){if(t.length!==e+1)throw new Ut("The length of delimiters doesn't match the number of args!");for(var i=t[0],r=0;r<i.length;r++){var l=this.popToken();if(i[r]!==l.text)throw new Ut("Use of the macro doesn't match its definition",l)}}for(var h=[],o=0;o<e;o++)h.push(this.consumeArg(t&&t[o+1]).tokens);return h}countExpansion(e){if(this.expansionCount+=e,this.expansionCount>this.settings.maxExpand)throw new Ut("Too many expansions: infinite loop or need to increase maxExpand setting")}expandOnce(e){var t=this.popToken(),i=t.text,r=t.noexpand?null:this._getExpansion(i);if(r==null||e&&r.unexpandable){if(e&&r==null&&i[0]==="\\"&&!this.isDefined(i))throw new Ut("Undefined control sequence: "+i);return this.pushToken(t),!1}this.countExpansion(1);var l=r.tokens,h=this.consumeArgs(r.numArgs,r.delimiters);if(r.numArgs){l=l.slice();for(var o=l.length-1;o>=0;--o){var p=l[o];if(p.text==="#"){if(o===0)throw new Ut("Incomplete placeholder at end of macro body",p);if(p=l[--o],p.text==="#")l.splice(o+1,1);else if(/^[1-9]$/.test(p.text))l.splice(o,2,...h[+p.text-1]);else throw new Ut("Not a valid argument number",p)}}}return this.pushTokens(l),l.length}expandAfterFuture(){return this.expandOnce(),this.future()}expandNextToken(){for(;;)if(this.expandOnce()===!1){var e=this.stack.pop();return e.treatAsRelax&&(e.text="\\relax"),e}throw new Error}expandMacro(e){return this.macros.has(e)?this.expandTokens([new Ms(e)]):void 0}expandTokens(e){var t=[],i=this.stack.length;for(this.pushTokens(e);this.stack.length>i;)if(this.expandOnce(!0)===!1){var r=this.stack.pop();r.treatAsRelax&&(r.noexpand=!1,r.treatAsRelax=!1),t.push(r)}return this.countExpansion(t.length),t}expandMacroAsText(e){var t=this.expandMacro(e);return t&&t.map(i=>i.text).join("")}_getExpansion(e){var t=this.macros.get(e);if(t==null)return t;if(e.length===1){var i=this.lexer.catcodes[e];if(i!=null&&i!==13)return}var r=typeof t=="function"?t(this):t;if(typeof r=="string"){var l=0;if(r.indexOf("#")!==-1)for(var h=r.replace(/##/g,"");h.indexOf("#"+(l+1))!==-1;)++l;for(var o=new HT(r,this.settings),p=[],v=o.lex();v.text!=="EOF";)p.push(v),v=o.lex();p.reverse();var x={tokens:p,numArgs:l};return x}return r}isDefined(e){return this.macros.has(e)||xc.hasOwnProperty(e)||Di.math.hasOwnProperty(e)||Di.text.hasOwnProperty(e)||G7.hasOwnProperty(e)}isExpandable(e){var t=this.macros.get(e);return t!=null?typeof t=="string"||typeof t=="function"||!t.unexpandable:xc.hasOwnProperty(e)&&!xc[e].primitive}}var WT=/^[₊₋₌₍₎₀₁₂₃₄₅₆₇₈₉ₐₑₕᵢⱼₖₗₘₙₒₚᵣₛₜᵤᵥₓᵦᵧᵨᵩᵪ]/,c1=Object.freeze({"₊":"+","₋":"-","₌":"=","₍":"(","₎":")","₀":"0","₁":"1","₂":"2","₃":"3","₄":"4","₅":"5","₆":"6","₇":"7","₈":"8","₉":"9","ₐ":"a","ₑ":"e","ₕ":"h","ᵢ":"i","ⱼ":"j","ₖ":"k","ₗ":"l","ₘ":"m","ₙ":"n","ₒ":"o","ₚ":"p","ᵣ":"r","ₛ":"s","ₜ":"t","ᵤ":"u","ᵥ":"v","ₓ":"x","ᵦ":"β","ᵧ":"γ","ᵨ":"ρ","ᵩ":"ϕ","ᵪ":"χ","⁺":"+","⁻":"-","⁼":"=","⁽":"(","⁾":")","⁰":"0","¹":"1","²":"2","³":"3","⁴":"4","⁵":"5","⁶":"6","⁷":"7","⁸":"8","⁹":"9","ᴬ":"A","ᴮ":"B","ᴰ":"D","ᴱ":"E","ᴳ":"G","ᴴ":"H","ᴵ":"I","ᴶ":"J","ᴷ":"K","ᴸ":"L","ᴹ":"M","ᴺ":"N","ᴼ":"O","ᴾ":"P","ᴿ":"R","ᵀ":"T","ᵁ":"U","ⱽ":"V","ᵂ":"W","ᵃ":"a","ᵇ":"b","ᶜ":"c","ᵈ":"d","ᵉ":"e","ᶠ":"f","ᵍ":"g",ʰ:"h","ⁱ":"i",ʲ:"j","ᵏ":"k",ˡ:"l","ᵐ":"m",ⁿ:"n","ᵒ":"o","ᵖ":"p",ʳ:"r",ˢ:"s","ᵗ":"t","ᵘ":"u","ᵛ":"v",ʷ:"w",ˣ:"x",ʸ:"y","ᶻ":"z","ᵝ":"β","ᵞ":"γ","ᵟ":"δ","ᵠ":"ϕ","ᵡ":"χ","ᶿ":"θ"}),Ox={"́":{text:"\\'",math:"\\acute"},"̀":{text:"\\`",math:"\\grave"},"̈":{text:'\\"',math:"\\ddot"},"̃":{text:"\\~",math:"\\tilde"},"̄":{text:"\\=",math:"\\bar"},"̆":{text:"\\u",math:"\\breve"},"̌":{text:"\\v",math:"\\check"},"̂":{text:"\\^",math:"\\hat"},"̇":{text:"\\.",math:"\\dot"},"̊":{text:"\\r",math:"\\mathring"},"̋":{text:"\\H"},"̧":{text:"\\c"}},qT={á:"á",à:"à",ä:"ä",ǟ:"ǟ",ã:"ã",ā:"ā",ă:"ă",ắ:"ắ",ằ:"ằ",ẵ:"ẵ",ǎ:"ǎ",â:"â",ấ:"ấ",ầ:"ầ",ẫ:"ẫ",ȧ:"ȧ",ǡ:"ǡ",å:"å",ǻ:"ǻ",ḃ:"ḃ",ć:"ć",ḉ:"ḉ",č:"č",ĉ:"ĉ",ċ:"ċ",ç:"ç",ď:"ď",ḋ:"ḋ",ḑ:"ḑ",é:"é",è:"è",ë:"ë",ẽ:"ẽ",ē:"ē",ḗ:"ḗ",ḕ:"ḕ",ĕ:"ĕ",ḝ:"ḝ",ě:"ě",ê:"ê",ế:"ế",ề:"ề",ễ:"ễ",ė:"ė",ȩ:"ȩ",ḟ:"ḟ",ǵ:"ǵ",ḡ:"ḡ",ğ:"ğ",ǧ:"ǧ",ĝ:"ĝ",ġ:"ġ",ģ:"ģ",ḧ:"ḧ",ȟ:"ȟ",ĥ:"ĥ",ḣ:"ḣ",ḩ:"ḩ",í:"í",ì:"ì",ï:"ï",ḯ:"ḯ",ĩ:"ĩ",ī:"ī",ĭ:"ĭ",ǐ:"ǐ",î:"î",ǰ:"ǰ",ĵ:"ĵ",ḱ:"ḱ",ǩ:"ǩ",ķ:"ķ",ĺ:"ĺ",ľ:"ľ",ļ:"ļ",ḿ:"ḿ",ṁ:"ṁ",ń:"ń",ǹ:"ǹ",ñ:"ñ",ň:"ň",ṅ:"ṅ",ņ:"ņ",ó:"ó",ò:"ò",ö:"ö",ȫ:"ȫ",õ:"õ",ṍ:"ṍ",ṏ:"ṏ",ȭ:"ȭ",ō:"ō",ṓ:"ṓ",ṑ:"ṑ",ŏ:"ŏ",ǒ:"ǒ",ô:"ô",ố:"ố",ồ:"ồ",ỗ:"ỗ",ȯ:"ȯ",ȱ:"ȱ",ő:"ő",ṕ:"ṕ",ṗ:"ṗ",ŕ:"ŕ",ř:"ř",ṙ:"ṙ",ŗ:"ŗ",ś:"ś",ṥ:"ṥ",š:"š",ṧ:"ṧ",ŝ:"ŝ",ṡ:"ṡ",ş:"ş",ẗ:"ẗ",ť:"ť",ṫ:"ṫ",ţ:"ţ",ú:"ú",ù:"ù",ü:"ü",ǘ:"ǘ",ǜ:"ǜ",ǖ:"ǖ",ǚ:"ǚ",ũ:"ũ",ṹ:"ṹ",ū:"ū",ṻ:"ṻ",ŭ:"ŭ",ǔ:"ǔ",û:"û",ů:"ů",ű:"ű",ṽ:"ṽ",ẃ:"ẃ",ẁ:"ẁ",ẅ:"ẅ",ŵ:"ŵ",ẇ:"ẇ",ẘ:"ẘ",ẍ:"ẍ",ẋ:"ẋ",ý:"ý",ỳ:"ỳ",ÿ:"ÿ",ỹ:"ỹ",ȳ:"ȳ",ŷ:"ŷ",ẏ:"ẏ",ẙ:"ẙ",ź:"ź",ž:"ž",ẑ:"ẑ",ż:"ż",Á:"Á",À:"À",Ä:"Ä",Ǟ:"Ǟ",Ã:"Ã",Ā:"Ā",Ă:"Ă",Ắ:"Ắ",Ằ:"Ằ",Ẵ:"Ẵ",Ǎ:"Ǎ",Â:"Â",Ấ:"Ấ",Ầ:"Ầ",Ẫ:"Ẫ",Ȧ:"Ȧ",Ǡ:"Ǡ",Å:"Å",Ǻ:"Ǻ",Ḃ:"Ḃ",Ć:"Ć",Ḉ:"Ḉ",Č:"Č",Ĉ:"Ĉ",Ċ:"Ċ",Ç:"Ç",Ď:"Ď",Ḋ:"Ḋ",Ḑ:"Ḑ",É:"É",È:"È",Ë:"Ë",Ẽ:"Ẽ",Ē:"Ē",Ḗ:"Ḗ",Ḕ:"Ḕ",Ĕ:"Ĕ",Ḝ:"Ḝ",Ě:"Ě",Ê:"Ê",Ế:"Ế",Ề:"Ề",Ễ:"Ễ",Ė:"Ė",Ȩ:"Ȩ",Ḟ:"Ḟ",Ǵ:"Ǵ",Ḡ:"Ḡ",Ğ:"Ğ",Ǧ:"Ǧ",Ĝ:"Ĝ",Ġ:"Ġ",Ģ:"Ģ",Ḧ:"Ḧ",Ȟ:"Ȟ",Ĥ:"Ĥ",Ḣ:"Ḣ",Ḩ:"Ḩ",Í:"Í",Ì:"Ì",Ï:"Ï",Ḯ:"Ḯ",Ĩ:"Ĩ",Ī:"Ī",Ĭ:"Ĭ",Ǐ:"Ǐ",Î:"Î",İ:"İ",Ĵ:"Ĵ",Ḱ:"Ḱ",Ǩ:"Ǩ",Ķ:"Ķ",Ĺ:"Ĺ",Ľ:"Ľ",Ļ:"Ļ",Ḿ:"Ḿ",Ṁ:"Ṁ",Ń:"Ń",Ǹ:"Ǹ",Ñ:"Ñ",Ň:"Ň",Ṅ:"Ṅ",Ņ:"Ņ",Ó:"Ó",Ò:"Ò",Ö:"Ö",Ȫ:"Ȫ",Õ:"Õ",Ṍ:"Ṍ",Ṏ:"Ṏ",Ȭ:"Ȭ",Ō:"Ō",Ṓ:"Ṓ",Ṑ:"Ṑ",Ŏ:"Ŏ",Ǒ:"Ǒ",Ô:"Ô",Ố:"Ố",Ồ:"Ồ",Ỗ:"Ỗ",Ȯ:"Ȯ",Ȱ:"Ȱ",Ő:"Ő",Ṕ:"Ṕ",Ṗ:"Ṗ",Ŕ:"Ŕ",Ř:"Ř",Ṙ:"Ṙ",Ŗ:"Ŗ",Ś:"Ś",Ṥ:"Ṥ",Š:"Š",Ṧ:"Ṧ",Ŝ:"Ŝ",Ṡ:"Ṡ",Ş:"Ş",Ť:"Ť",Ṫ:"Ṫ",Ţ:"Ţ",Ú:"Ú",Ù:"Ù",Ü:"Ü",Ǘ:"Ǘ",Ǜ:"Ǜ",Ǖ:"Ǖ",Ǚ:"Ǚ",Ũ:"Ũ",Ṹ:"Ṹ",Ū:"Ū",Ṻ:"Ṻ",Ŭ:"Ŭ",Ǔ:"Ǔ",Û:"Û",Ů:"Ů",Ű:"Ű",Ṽ:"Ṽ",Ẃ:"Ẃ",Ẁ:"Ẁ",Ẅ:"Ẅ",Ŵ:"Ŵ",Ẇ:"Ẇ",Ẍ:"Ẍ",Ẋ:"Ẋ",Ý:"Ý",Ỳ:"Ỳ",Ÿ:"Ÿ",Ỹ:"Ỹ",Ȳ:"Ȳ",Ŷ:"Ŷ",Ẏ:"Ẏ",Ź:"Ź",Ž:"Ž",Ẑ:"Ẑ",Ż:"Ż",ά:"ά",ὰ:"ὰ",ᾱ:"ᾱ",ᾰ:"ᾰ",έ:"έ",ὲ:"ὲ",ή:"ή",ὴ:"ὴ",ί:"ί",ὶ:"ὶ",ϊ:"ϊ",ΐ:"ΐ",ῒ:"ῒ",ῑ:"ῑ",ῐ:"ῐ",ό:"ό",ὸ:"ὸ",ύ:"ύ",ὺ:"ὺ",ϋ:"ϋ",ΰ:"ΰ",ῢ:"ῢ",ῡ:"ῡ",ῠ:"ῠ",ώ:"ώ",ὼ:"ὼ",Ύ:"Ύ",Ὺ:"Ὺ",Ϋ:"Ϋ",Ῡ:"Ῡ",Ῠ:"Ῠ",Ώ:"Ώ",Ὼ:"Ὼ"};class sv{constructor(e,t){this.mode=void 0,this.gullet=void 0,this.settings=void 0,this.leftrightDepth=void 0,this.nextToken=void 0,this.mode="math",this.gullet=new Zq(e,t,this.mode),this.settings=t,this.leftrightDepth=0}expect(e,t){if(t===void 0&&(t=!0),this.fetch().text!==e)throw new Ut("Expected '"+e+"', got '"+this.fetch().text+"'",this.fetch());t&&this.consume()}consume(){this.nextToken=null}fetch(){return this.nextToken==null&&(this.nextToken=this.gullet.expandNextToken()),this.nextToken}switchMode(e){this.mode=e,this.gullet.switchMode(e)}parse(){this.settings.globalGroup||this.gullet.beginGroup(),this.settings.colorIsTextColor&&this.gullet.macros.set("\\color","\\textcolor");try{var e=this.parseExpression(!1);return this.expect("EOF"),this.settings.globalGroup||this.gullet.endGroup(),e}finally{this.gullet.endGroups()}}subparse(e){var t=this.nextToken;this.consume(),this.gullet.pushToken(new Ms("}")),this.gullet.pushTokens(e);var i=this.parseExpression(!1);return this.expect("}"),this.nextToken=t,i}parseExpression(e,t){for(var i=[];;){this.mode==="math"&&this.consumeSpaces();var r=this.fetch();if(sv.endOfExpression.indexOf(r.text)!==-1||t&&r.text===t||e&&xc[r.text]&&xc[r.text].infix)break;var l=this.parseAtom(t);if(l){if(l.type==="internal")continue}else break;i.push(l)}return this.mode==="text"&&this.formLigatures(i),this.handleInfixNodes(i)}handleInfixNodes(e){for(var t=-1,i,r=0;r<e.length;r++)if(e[r].type==="infix"){if(t!==-1)throw new Ut("only one infix operator per group",e[r].token);t=r,i=e[r].replaceWith}if(t!==-1&&i){var l,h,o=e.slice(0,t),p=e.slice(t+1);o.length===1&&o[0].type==="ordgroup"?l=o[0]:l={type:"ordgroup",mode:this.mode,body:o},p.length===1&&p[0].type==="ordgroup"?h=p[0]:h={type:"ordgroup",mode:this.mode,body:p};var v;return i==="\\\\abovefrac"?v=this.callFunction(i,[l,e[t],h],[]):v=this.callFunction(i,[l,h],[]),[v]}else return e}handleSupSubscript(e){var t=this.fetch(),i=t.text;this.consume(),this.consumeSpaces();var r=this.parseGroup(e);if(!r)throw new Ut("Expected group after '"+i+"'",t);return r}formatUnsupportedCmd(e){for(var t=[],i=0;i<e.length;i++)t.push({type:"textord",mode:"text",text:e[i]});var r={type:"text",mode:this.mode,body:t},l={type:"color",mode:this.mode,color:this.settings.errorColor,body:[r]};return l}parseAtom(e){var t=this.parseGroup("atom",e);if(this.mode==="text")return t;for(var i,r;;){this.consumeSpaces();var l=this.fetch();if(l.text==="\\limits"||l.text==="\\nolimits"){if(t&&t.type==="op"){var h=l.text==="\\limits";t.limits=h,t.alwaysHandleSupSub=!0}else if(t&&t.type==="operatorname")t.alwaysHandleSupSub&&(t.limits=l.text==="\\limits");else throw new Ut("Limit controls must follow a math operator",l);this.consume()}else if(l.text==="^"){if(i)throw new Ut("Double superscript",l);i=this.handleSupSubscript("superscript")}else if(l.text==="_"){if(r)throw new Ut("Double subscript",l);r=this.handleSupSubscript("subscript")}else if(l.text==="'"){if(i)throw new Ut("Double superscript",l);var o={type:"textord",mode:this.mode,text:"\\prime"},p=[o];for(this.consume();this.fetch().text==="'";)p.push(o),this.consume();this.fetch().text==="^"&&p.push(this.handleSupSubscript("superscript")),i={type:"ordgroup",mode:this.mode,body:p}}else if(c1[l.text]){var v=WT.test(l.text),x=[];for(x.push(new Ms(c1[l.text])),this.consume();;){var M=this.fetch().text;if(!c1[M]||WT.test(M)!==v)break;x.unshift(new Ms(c1[M])),this.consume()}var S=this.subparse(x);v?r={type:"ordgroup",mode:"math",body:S}:i={type:"ordgroup",mode:"math",body:S}}else break}return i||r?{type:"supsub",mode:this.mode,base:t,sup:i,sub:r}:t}parseFunction(e,t){var i=this.fetch(),r=i.text,l=xc[r];if(!l)return null;if(this.consume(),t&&t!=="atom"&&!l.allowedInArgument)throw new Ut("Got function '"+r+"' with no arguments"+(t?" as "+t:""),i);if(this.mode==="text"&&!l.allowedInText)throw new Ut("Can't use function '"+r+"' in text mode",i);if(this.mode==="math"&&l.allowedInMath===!1)throw new Ut("Can't use function '"+r+"' in math mode",i);var{args:h,optArgs:o}=this.parseArguments(r,l);return this.callFunction(r,h,o,i,e)}callFunction(e,t,i,r,l){var h={funcName:e,parser:this,token:r,breakOnTokenText:l},o=xc[e];if(o&&o.handler)return o.handler(h,t,i);throw new Ut("No function handler for "+e)}parseArguments(e,t){var i=t.numArgs+t.numOptionalArgs;if(i===0)return{args:[],optArgs:[]};for(var r=[],l=[],h=0;h<i;h++){var o=t.argTypes&&t.argTypes[h],p=h<t.numOptionalArgs;(t.primitive&&o==null||t.type==="sqrt"&&h===1&&l[0]==null)&&(o="primitive");var v=this.parseGroupOfType("argument to '"+e+"'",o,p);if(p)l.push(v);else if(v!=null)r.push(v);else throw new Ut("Null argument, please report this as a bug")}return{args:r,optArgs:l}}parseGroupOfType(e,t,i){switch(t){case"color":return this.parseColorGroup(i);case"size":return this.parseSizeGroup(i);case"url":return this.parseUrlGroup(i);case"math":case"text":return this.parseArgumentGroup(i,t);case"hbox":{var r=this.parseArgumentGroup(i,"text");return r!=null?{type:"styling",mode:r.mode,body:[r],style:"text"}:null}case"raw":{var l=this.parseStringGroup("raw",i);return l!=null?{type:"raw",mode:"text",string:l.text}:null}case"primitive":{if(i)throw new Ut("A primitive argument cannot be optional");var h=this.parseGroup(e);if(h==null)throw new Ut("Expected group as "+e,this.fetch());return h}case"original":case null:case void 0:return this.parseArgumentGroup(i);default:throw new Ut("Unknown group type as "+e,this.fetch())}}consumeSpaces(){for(;this.fetch().text===" ";)this.consume()}parseStringGroup(e,t){var i=this.gullet.scanArgument(t);if(i==null)return null;for(var r="",l;(l=this.fetch()).text!=="EOF";)r+=l.text,this.consume();return this.consume(),i.text=r,i}parseRegexGroup(e,t){for(var i=this.fetch(),r=i,l="",h;(h=this.fetch()).text!=="EOF"&&e.test(l+h.text);)r=h,l+=r.text,this.consume();if(l==="")throw new Ut("Invalid "+t+": '"+i.text+"'",i);return i.range(r,l)}parseColorGroup(e){var t=this.parseStringGroup("color",e);if(t==null)return null;var i=/^(#[a-f0-9]{3}|#?[a-f0-9]{6}|[a-z]+)$/i.exec(t.text);if(!i)throw new Ut("Invalid color: '"+t.text+"'",t);var r=i[0];return/^[0-9a-f]{6}$/i.test(r)&&(r="#"+r),{type:"color-token",mode:this.mode,color:r}}parseSizeGroup(e){var t,i=!1;if(this.gullet.consumeSpaces(),!e&&this.gullet.future().text!=="{"?t=this.parseRegexGroup(/^[-+]? *(?:$|\d+|\d+\.\d*|\.\d*) *[a-z]{0,2} *$/,"size"):t=this.parseStringGroup("size",e),!t)return null;!e&&t.text.length===0&&(t.text="0pt",i=!0);var r=/([-+]?) *(\d+(?:\.\d*)?|\.\d+) *([a-z]{2})/.exec(t.text);if(!r)throw new Ut("Invalid size: '"+t.text+"'",t);var l={number:+(r[1]+r[2]),unit:r[3]};if(!Q8(l))throw new Ut("Invalid unit: '"+l.unit+"'",t);return{type:"size",mode:this.mode,value:l,isBlank:i}}parseUrlGroup(e){this.gullet.lexer.setCatcode("%",13),this.gullet.lexer.setCatcode("~",12);var t=this.parseStringGroup("url",e);if(this.gullet.lexer.setCatcode("%",14),this.gullet.lexer.setCatcode("~",13),t==null)return null;var i=t.text.replace(/\\([#$%&~_^{}])/g,"$1");return{type:"url",mode:this.mode,url:i}}parseArgumentGroup(e,t){var i=this.gullet.scanArgument(e);if(i==null)return null;var r=this.mode;t&&this.switchMode(t),this.gullet.beginGroup();var l=this.parseExpression(!1,"EOF");this.expect("EOF"),this.gullet.endGroup();var h={type:"ordgroup",mode:this.mode,loc:i.loc,body:l};return t&&this.switchMode(r),h}parseGroup(e,t){var i=this.fetch(),r=i.text,l;if(r==="{"||r==="\\begingroup"){this.consume();var h=r==="{"?"}":"\\endgroup";this.gullet.beginGroup();var o=this.parseExpression(!1,h),p=this.fetch();this.expect(h),this.gullet.endGroup(),l={type:"ordgroup",mode:this.mode,loc:Ya.range(i,p),body:o,semisimple:r==="\\begingroup"||void 0}}else if(l=this.parseFunction(t,e)||this.parseSymbol(),l==null&&r[0]==="\\"&&!G7.hasOwnProperty(r)){if(this.settings.throwOnError)throw new Ut("Undefined control sequence: "+r,i);l=this.formatUnsupportedCmd(r),this.consume()}return l}formLigatures(e){for(var t=e.length-1,i=0;i<t;++i){var r=e[i],l=r.text;l==="-"&&e[i+1].text==="-"&&(i+1<t&&e[i+2].text==="-"?(e.splice(i,3,{type:"textord",mode:"text",loc:Ya.range(r,e[i+2]),text:"---"}),t-=2):(e.splice(i,2,{type:"textord",mode:"text",loc:Ya.range(r,e[i+1]),text:"--"}),t-=1)),(l==="'"||l==="`")&&e[i+1].text===l&&(e.splice(i,2,{type:"textord",mode:"text",loc:Ya.range(r,e[i+1]),text:l+l}),t-=1)}}parseSymbol(){var e=this.fetch(),t=e.text;if(/^\\verb[^a-zA-Z]/.test(t)){this.consume();var i=t.slice(5),r=i.charAt(0)==="*";if(r&&(i=i.slice(1)),i.length<2||i.charAt(0)!==i.slice(-1))throw new Ut(`\\verb assertion failed --
                    please report what input caused this bug`);return i=i.slice(1,-1),{type:"verb",mode:"text",body:i,star:r}}qT.hasOwnProperty(t[0])&&!Di[this.mode][t[0]]&&(this.settings.strict&&this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Accented Unicode text character "'+t[0]+'" used in math mode',e),t=qT[t[0]]+t.slice(1));var l=Wq.exec(t);l&&(t=t.substring(0,l.index),t==="i"?t="ı":t==="j"&&(t="ȷ"));var h;if(Di[this.mode][t]){this.settings.strict&&this.mode==="math"&&lb.indexOf(t)>=0&&this.settings.reportNonstrict("unicodeTextInMathMode",'Latin-1/Unicode text character "'+t[0]+'" used in math mode',e);var o=Di[this.mode][t].group,p=Ya.range(e),v;if(NW.hasOwnProperty(o)){var x=o;v={type:"atom",mode:this.mode,family:x,loc:p,text:t}}else v={type:o,mode:this.mode,loc:p,text:t};h=v}else if(t.charCodeAt(0)>=128)this.settings.strict&&(J8(t.charCodeAt(0))?this.mode==="math"&&this.settings.reportNonstrict("unicodeTextInMathMode",'Unicode text character "'+t[0]+'" used in math mode',e):this.settings.reportNonstrict("unknownSymbol",'Unrecognized Unicode character "'+t[0]+'"'+(" ("+t.charCodeAt(0)+")"),e)),h={type:"textord",mode:"text",loc:Ya.range(e),text:t};else return null;if(this.consume(),l)for(var M=0;M<l[0].length;M++){var S=l[0][M];if(!Ox[S])throw new Ut("Unknown accent ' "+S+"'",e);var A=Ox[S][this.mode]||Ox[S].text;if(!A)throw new Ut("Accent "+S+" unsupported in "+this.mode+" mode",e);h={type:"accent",mode:this.mode,loc:Ya.range(e),label:A,isStretchy:!1,isShifty:!0,base:h}}return h}}sv.endOfExpression=["}","\\endgroup","\\end","\\right","&"];var Kw=function(e,t){if(!(typeof e=="string"||e instanceof String))throw new TypeError("KaTeX can only parse string typed expression");var i=new sv(e,t);delete i.gullet.macros.current["\\df@tag"];var r=i.parse();if(delete i.gullet.macros.current["\\current@color"],delete i.gullet.macros.current["\\color"],i.gullet.macros.get("\\df@tag")){if(!t.displayMode)throw new Ut("\\tag works only in display equations");r=[{type:"tag",mode:"text",body:r,tag:i.subparse([new Ms("\\df@tag")])}]}return r},j7=function(e,t,i){t.textContent="";var r=Jw(e,i).toNode();t.appendChild(r)};typeof document<"u"&&document.compatMode!=="CSS1Compat"&&(typeof console<"u"&&console.warn("Warning: KaTeX doesn't work in quirks mode. Make sure your website has a suitable doctype."),j7=function(){throw new Ut("KaTeX doesn't work in quirks mode.")});var Yq=function(e,t){var i=Jw(e,t).toMarkup();return i},Kq=function(e,t){var i=new Dw(t);return Kw(e,i)},W7=function(e,t,i){if(i.throwOnError||!(e instanceof Ut))throw e;var r=et.makeSpan(["katex-error"],[new As(t)]);return r.setAttribute("title",e.toString()),r.setAttribute("style","color:"+i.errorColor),r},Jw=function(e,t){var i=new Dw(t);try{var r=Kw(e,i);return sq(r,e,i)}catch(l){return W7(l,e,i)}},Jq=function(e,t){var i=new Dw(t);try{var r=Kw(e,i);return oq(r,e,i)}catch(l){return W7(l,e,i)}},q7={version:"0.16.10",render:j7,renderToString:Yq,ParseError:Ut,SETTINGS_SCHEMA:P1,__parse:Kq,__renderToDomTree:Jw,__renderToHTMLTree:Jq,__setFontMetrics:RW,__defineSymbol:N,__defineFunction:cn,__defineMacro:he,__domTree:{Span:em,Anchor:Fw,SymbolNode:As,SvgNode:wl,PathNode:Fc,LineNode:ob}};function Qq(n,e,t,i){const r=n.node().width.baseVal.value,l=n.node().height.baseVal.value,h=zp().domain([0,1]).range([0,r]),o=zp().domain([0,1]).range([l,0]),p=S=>e.nodes.find(A=>A.id===S),v=_y().duration(t).ease(dT),x=n.selectAll("line.edge").data(e.edges,S=>S.id1+" "+S.id2);x.enter().append("line").attr("class","edge").attr("x1",S=>h(p(S.id1).x)).attr("y1",S=>o(p(S.id1).y)).attr("x2",S=>h(p(S.id2).x)).attr("y2",S=>o(p(S.id2).y)).attr("stroke-width",0).transition(v).attr("stroke-width",1).attr("stroke",i),x.transition(v).attr("x1",S=>h(p(S.id1).x)).attr("y1",S=>o(p(S.id1).y)).attr("x2",S=>h(p(S.id2).x)).attr("y2",S=>o(p(S.id2).y)),x.exit().transition(_y().duration(150).ease(dT)).remove();const M=n.selectAll("circle.node").data(e.nodes,S=>S.id);M.enter().append("circle").attr("class","node").attr("fill",i).attr("cx",S=>h(S.x)).attr("cy",S=>o(S.y)).attr("r",0).transition(v).attr("r",5),M.transition(v).attr("cx",S=>h(S.x)).attr("cy",S=>o(S.y)),M.exit().transition(v).remove()}function $7(n,e){const t=n.x-e.x,i=n.y-e.y;return Math.sqrt(t*t+i*i)}function e$(n,e,t){const i={nodes:[],edges:[]};for(let r=0;r<n;r++)i.nodes.push({id:r,x:Math.random(),y:Math.random()});for(const r of i.nodes)for(const l of i.nodes){if(r.id===l.id)continue;const h=$7(r,l);e<h&&h<t&&i.edges.push({id1:r.id,id2:l.id})}return i}class t${constructor(){ut(this,"t");ut(this,"a");ut(this,"b");ut(this,"sa");ut(this,"sb");this.a=Math.random(),this.sa=Math.random(),this.b=Math.random(),this.sb=Math.random(),this.t=Math.random()*10*Math.PI}advance(e){this.t+=e;const t=this.sa*Math.sin(this.a*this.t),i=this.sb*Math.sin(this.b*this.t),r=.5+t,l=.5+i;return{x:r,y:l}}}function n$(n,e,t,i,r){for(let l=0;l<n.nodes.length;l++){const h=n.nodes[l],o=e[l],{x:p,y:v}=o.advance(t);h.x=p,h.y=v}n.edges=[];for(let l=0;l<n.nodes.length;l++)for(let h=l+1;h<n.nodes.length;h++){const o=n.nodes[l],p=n.nodes[h],v=$7(o,p);i<v&&v<r&&n.edges.push({id1:o.id,id2:p.id})}return n}let i$=class{constructor(e="rgba(10, 10, 10, 0.125)",t=50,i=.15,r=.18,l=1e3,h=.02){ut(this,"paths",[]);ut(this,"graph");ut(this,"svg");ut(this,"handle");this.color=e,this.N=t,this.dMin=i,this.dMax=r,this.loopTime=l,this.dt=h}setContainer(e){const t=e.getBoundingClientRect(),r=U8(e).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",[0,0,t.width,t.height]);let l=e$(this.N,this.dMin,this.dMax);const h=Array.apply(null,Array(l.nodes.length)).map(()=>new t$);this.svg=r,this.graph=l,this.paths=h,this.loop()}loop(){!this.graph||!this.svg||(this.graph=n$(this.graph,this.paths,this.dt,this.dMin,this.dMax),Qq(this.svg,this.graph,this.loopTime,this.color),this.handle=setTimeout(()=>this.loop(),this.loopTime))}destroy(){var e;clearTimeout(this.handle),(e=this.svg)==null||e.remove()}};function r$(n){const e=gt.useRef(null);return gt.useEffect(()=>{const t=new i$(n.color);return e.current&&t.setContainer(e.current),()=>t.destroy()},[e.current]),ge.jsx("div",{ref:e,style:{width:"100%",height:"100%"}})}class a${constructor(e){ut(this,"svg");ut(this,"sinData");ut(this,"gradData");ut(this,"approxData");ut(this,"betterApproxData");ut(this,"xScale");ut(this,"yScale");ut(this,"focussedStep",-1);this.container=e;const t=this.container.getBoundingClientRect(),r=U8(this.container).append("svg").attr("width",t.width).attr("height",t.height).attr("viewBox",[0,0,t.width,t.height]);this.svg=r,this.sinData=[];for(let S=0;S<100;S++){const A=S/10,L=Math.sin(A);this.sinData.push({x:A,y:L})}this.gradData=[];for(let S=0;S<100;S++){const A=S/10,L=Math.sin(A),F=Math.cos(A);this.gradData.push({x:A,y:L,dydx:F})}let l=this.sinData[0].x;const h=this.sinData[this.sinData.length-1].x;let o=this.sinData[0].y;const p=10,v=(h-l)/p;this.approxData=[{x:l,y:o}];for(let S=1;S<p;S++){const A=Math.round((this.sinData.length-1)*(S-1)/p),L=this.gradData[A].dydx,F=l+v,k=o+L*v;this.approxData.push({x:F,y:k}),l=F,o=k}l=this.sinData[0].x,o=this.sinData[0].y,this.betterApproxData=[{x:l,y:o}];for(let S=1;S<p;S++){const A=Math.round((this.sinData.length-1)*(S-1)/p),L=this.gradData[A].dydx,F=Math.round((this.sinData.length-1)*S/p),k=this.gradData[F].dydx,C=l+v,V=o+(L+k)*v/2;this.betterApproxData.push({x:C,y:V}),l=C,o=V}const x=zp().domain([-1,11]).range([0,parseFloat(this.svg.attr("width"))]),M=zp().domain([-2,2]).range([parseFloat(this.svg.attr("height")),0]);this.xScale=x,this.yScale=M}destroy(){this.svg.remove()}stepHasFocus(e){const t=Math.round(e);t!==this.focussedStep&&(this.focussedStep=t,t<=1.5?this.plot({sinData:this.sinData,gradients:[],approxData:[]}):t<=2.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,1)}):t<=3.1?this.plot({sinData:this.sinData,gradients:[this.gradData[0]],approxData:this.approxData.slice(0,2)}):t<=4.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,2)}):t<=5.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.approxData.slice(0,3)}):t<=6.1?this.plot({sinData:this.sinData,gradients:[],approxData:this.approxData}):t<=7.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:[this.approxData[0]]}):t<=8.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)]],approxData:this.approxData.slice(0,2)}):t<=9.1?this.plot({sinData:this.sinData,gradients:[this.gradData[this.approxIndexToRealIndex(0)],this.gradData[this.approxIndexToRealIndex(1)]],approxData:this.betterApproxData.slice(0,2)}):t<=10.1&&this.plot({sinData:this.sinData,gradients:[],approxData:this.betterApproxData}))}plot(e){const t=UG(p=>this.xScale(p.x),p=>this.yScale(p.y)),i=_y("simple appear").duration(1e3),r=parseInt(this.svg.attr("width"))*3.14;this.svg.selectAll("path.rawData").data([e.sinData],p=>p.length).enter().append("path").attr("class","rawData").attr("d",t).attr("fill","none").attr("stroke","gray").attr("stroke-dasharray",r+" "+r).attr("stroke-dashoffset",r).transition(i).attr("stroke-dashoffset",0).attr("stroke-dasharray","10 10");const h=this.svg.selectAll("line.gradient").data(e.gradients,p=>p.x);h.enter().append("line").attr("class","gradient").attr("x1",p=>this.xScale(p.x-10)).attr("x2",p=>this.xScale(p.x+10)).attr("y1",p=>this.yScale(p.y-10*p.dydx)).attr("y2",p=>this.yScale(p.y+10*p.dydx)).transition(i).attr("stroke","blue").attr("stroke-width",2).attr("stroke-dasharray","5 5"),h.exit().transition(i).remove();const o=this.svg.selectAll("path.simData").data([e.approxData],p=>p.map(v=>v.y).join(" "));o.enter().append("path").attr("class","simData").attr("stroke","black").attr("fill","none").attr("stroke-width",4).attr("d",t).attr("stroke-dasharray",r+" "+r).attr("stroke-dashoffset",r).transition(i).attr("stroke-dashoffset",0),o.transition(i).attr("d",t),o.exit().transition(i).attr("stroke-dashoffset",r).remove()}approxIndexToRealIndex(e){return Math.round(this.sinData.length*e/this.approxData.length)}}class s${constructor(){ut(this,"container");ut(this,"contents");ut(this,"slider");ut(this,"graphMgmt");ut(this,"io")}setContainer(e){this.container=e,this.contents=Array.from(e.querySelectorAll(".content")),this.slider=e.querySelector(".slider"),this.graphMgmt=new a$(this.slider);let t="-50% 0px -50% 0px";window.innerWidth<400&&(t="-10% 0px -90% 0px"),this.io=new IntersectionObserver((i,r)=>{i.forEach(l=>{var h;if(l.isIntersecting){const o=parseInt(l.target.dataset.stepnr);(h=this.graphMgmt)==null||h.stepHasFocus(o)}})},{rootMargin:t}),this.contents.map(i=>{var r;return(r=this.io)==null?void 0:r.observe(i)})}destroy(){var e,t;(e=this.graphMgmt)==null||e.destroy(),(t=this.io)==null||t.disconnect()}}function Us(n){return ge.jsx("span",{dangerouslySetInnerHTML:{__html:q7.renderToString(n.katexString)}})}function Ux(n){return ge.jsx("div",{dangerouslySetInnerHTML:{__html:q7.renderToString(n.katexString)}})}function o$(){const n=gt.useRef(null);return gt.useEffect(()=>{const e=new s$;return n.current&&e.setContainer(n.current),()=>e.destroy()},[n.current]),ge.jsxs(of,{hero:ge.jsx("div",{style:{width:"100%",aspectRatio:"2/1",minHeight:"400px",background:"linear-gradient(180deg, var(--primary2) 0%,  var(--primary1) 100%)"},children:ge.jsx(Gy,{title:"Math animations",subtitle:"Explaining math visually",heroBackground:ge.jsx(r$,{color:"var(--primary1-transparent25)"})})}),children:[ge.jsxs("p",{children:["This section showcases math text-formatting and animations. As an example, we give a brief introduction into"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Euler_method",target:"_blank",children:"Euler's method"})," ","for numerically solving differential equations, and show how it can be improved upon."]}),ge.jsxs("div",{ref:n,className:"container",children:[ge.jsx("div",{className:"rightCol",children:ge.jsx("div",{className:"slider"})}),ge.jsxs("div",{className:"leftCol",children:[ge.jsx("div",{className:"content","data-stepnr":"1",children:ge.jsxs("p",{children:["Let's assume there is some function ",ge.jsx(Us,{katexString:"y(t)"})," that we want to approximate. We don't know the analytical form of the function, but at each point we can evaluate its gradient as ",ge.jsx(Us,{katexString:"f(t, y)"}),"."]})}),ge.jsx("div",{className:"content","data-stepnr":"2",children:ge.jsxs("p",{children:["So we start at the first point, ",ge.jsx(Us,{katexString:"t_0, y_0"}),", and calculate the gradient ",ge.jsx(Us,{katexString:"f(t_0, y_0)"})," there (shown here as a blue tangent)."]})}),ge.jsxs("div",{className:"content","data-stepnr":"3",children:[ge.jsxs("p",{children:["We then simply follow along that gradient for some distance ",ge.jsx(Us,{katexString:"h"}),":"]}),ge.jsx(Ux,{katexString:"y_1 = y_0 + h f(t_0, y_0)"}),ge.jsx("p",{children:"Note that we've already made a small approximation error: we've ended up a bit higher than the true curve."})]}),ge.jsx("div",{className:"content","data-stepnr":"4",children:ge.jsxs("p",{children:["Undeterred, we soldier on: we again evaluate the gradient of the function, but now at the new position"," ",ge.jsx(Us,{katexString:"t_1, y_1"}),"."]})}),ge.jsx("div",{className:"content","data-stepnr":"5",children:ge.jsx("p",{children:"And again we take another step along that gradient."})}),ge.jsx("div",{className:"content","data-stepnr":"6",children:ge.jsx("p",{children:"We can repeat this process as long as required. As we do so, however, we continue to make small errors, causing our approximation to diverge quite a bit from the real function."})}),ge.jsx("div",{className:"content","data-stepnr":"7",children:ge.jsxs("p",{children:["One way to reduce those errors is in realizing that the functions gradient will change between the current and the next step. We can better approximate this effect by accounting for both the gradient at"," ",ge.jsx(Us,{katexString:"t_0, y_0"})," and at"," ",ge.jsx(Us,{katexString:"t_1, y_1"}),". This insight is known as the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Trapezoidal_rule",target:"_blank",children:"trapezoidal rule"}),"."]})}),ge.jsxs("div",{className:"content","data-stepnr":"8",children:[ge.jsxs("p",{children:["So we switch to a two-step-process. We begin with a first estimate of the function value, starting from"," ",ge.jsx(Us,{katexString:"t_0, y_0"}),":"," "]}),ge.jsx(Ux,{katexString:"\\tilde{y}_1 = y_0 + h f(t_0, y_0)"}),ge.jsx("p",{children:"This is identical to what we've already done before."})]}),ge.jsxs("div",{className:"content","data-stepnr":"9",children:[ge.jsxs("p",{children:["In a second step, however, we refine our prediction by taking the mean of the gradient at"," ",ge.jsx(Us,{katexString:"t_0, y_0"})," and the gradient at"," ",ge.jsx(Us,{katexString:"t_1, y_1"})," (both shown here as blue tangents):"]}),ge.jsx(Ux,{katexString:"y_1 = y_0 + \\frac{h}{2} f(t_0, y_0) + \\frac{h}{2} f(t_1, \\tilde{y}_1)"})]}),ge.jsx("div",{className:"content","data-stepnr":"10",style:{marginBottom:"15rem",marginTop:"20rem"},children:ge.jsxs("p",{children:["Using this schema, known as"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Heun%27s_method",target:"_blank",children:"Heun's method"}),", we get a much better function approximation."]})})]})]}),ge.jsx("div",{children:ge.jsxs("p",{children:["This simple method is surprisingly useful for approximating the solution to differential equations. Fairly straightforward refinements are the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"general Runge-Kutta"})," ","and"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Predictor%E2%80%93corrector_method",target:"_blank",children:"predictor-corrector"})," ","methods, which we use, for example, in our ",ge.jsx(ny,{to:"/swe",children:"shallow water simulation"}),"."]})})]})}class l${constructor(e,t,i,r,l,h,o=[1,1,1,1]){ut(this,"differentialGraph");ut(this,"summarizeGraph");ut(this,"dataTexture1");ut(this,"dataTexture2");ut(this,"k0Texture");ut(this,"k1Texture");ut(this,"k2Texture");ut(this,"k3Texture");ut(this,"k4Texture");ut(this,"gs");ut(this,"debugGraph");ut(this,"i",0);const p=e.gl,v={};for(const xe of l)v[xe.name]={type:xe.type,value:xe.value};const x={};for(const xe of h)x[xe.name]=xe.value;const M=Wy(0,0,2,2),S=new vo(p,{data:new Float32Array(M.flat()),changesOften:!1}),A=new n5(p,{data:i,t:"float4",edges:"clamp",interpolate:"none"}),L=new n5(p,{data:i,t:"float4",edges:"clamp",interpolate:"none"}),F=A.width,k=A.height,C=new mo(p,{width:F,height:k,type:"float4",edges:"clamp",interpolate:"none"}),V=new mo(p,{width:F,height:k,type:"float4",edges:"clamp",interpolate:"none"}),O=new mo(p,{width:F,height:k,type:"float4",edges:"clamp",interpolate:"none"}),J=new mo(p,{width:F,height:k,type:"float4",edges:"clamp",interpolate:"none"}),ue=new mo(p,{width:F,height:k,type:"float4",edges:"clamp",interpolate:"none"}),Y=new Ra(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          uniform vec2 textureSize;
          uniform sampler2D dataTexture;
          uniform sampler2D kTexture;
          uniform float kFactor;
          uniform float dt;
          ${l.map(xe=>`uniform ${xe.type} ${xe.name}; 
`)}
          ${h.map(xe=>`uniform sampler2D ${xe.name}; 
`)}
          in vec2 uv;
          out vec4 fragColor;
  
          void main() {
  
              vec2 deltaX = vec2(1.0 / textureSize.x, 0.0);
              vec2 deltaY = vec2(0.0, 1.0 / textureSize.y);
              vec4 data    = texture(dataTexture, uv          ) + dt * kFactor * texture(kTexture, uv          );
              vec4 data_px = texture(dataTexture, uv + deltaX ) + dt * kFactor * texture(kTexture, uv + deltaX );
              vec4 data_mx = texture(dataTexture, uv - deltaX ) + dt * kFactor * texture(kTexture, uv - deltaX );
              vec4 data_py = texture(dataTexture, uv + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaY );
              vec4 data_my = texture(dataTexture, uv - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaY );
  
              //-----------------------------------------------------------
              // Insert here shader code that takes "data", "data_px", ...
              // and fills "fragColor" with df/dt
              ${t}
              //-----------------------------------------------------------
  
          }`},inputs:{attributes:{pos:{buffer:S,config:{normalize:!1,nrInstances:0,type:"vec2"}}},textures:{...x,dataTexture:A,kTexture:C},uniforms:{...v,textureSize:{type:"vec2",value:[F,k]},kFactor:{type:"float",value:[0]},dt:{type:"float",value:[r]}}},outputs:{frameBuffer:{textures:[V]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,F,k]}}),Q=new Ra(e,{program:{vertexSource:`#version 300 es
          in vec2 pos;
          out vec2 uv;
          void main() {
              gl_Position = vec4(pos.xy, 0, 1);
              uv = (pos + 1.0) / 2.0;
          }`,fragmentSource:`#version 300 es
          precision highp float;
          in vec2 uv;
          uniform sampler2D dataTexture;
          uniform sampler2D k1Texture;
          uniform sampler2D k2Texture;
          uniform sampler2D k3Texture;
          uniform sampler2D k4Texture;
          uniform float dt;
          uniform vec4 dampingFactor;
          out vec4 fragColor;
  
          void main() {
              vec4 data = texture(dataTexture, uv);
              vec4 k1   = texture(k1Texture,   uv);
              vec4 k2   = texture(k2Texture,   uv);
              vec4 k3   = texture(k3Texture,   uv);
              vec4 k4   = texture(k4Texture,   uv);
  
              vec4 weightedAverage = data + dt * (k1 + 2.0 * k2 + 2.0 * k3 + k4) / 6.0;
              weightedAverage *= dampingFactor;
  
              fragColor = weightedAverage;
          }`},inputs:{attributes:{pos:{buffer:S,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{dt:{type:"float",value:[r]},dampingFactor:{type:"vec4",value:o}},textures:{dataTexture:A,k1Texture:V,k2Texture:O,k3Texture:J,k4Texture:ue}},outputs:{frameBuffer:{textures:[L]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,F,k]}});this.debugGraph=new Ra(e,{program:{vertexSource:`#version 300 es
              in vec2 pos;
              out vec2 uv;
              void main() {
                  gl_Position = vec4(pos.xy, 0, 1);
                  uv = (pos + 1.0) / 2.0;
              }`,fragmentSource:`#version 300 es
              precision highp float;
              in vec2 uv;
              uniform sampler2D drawTexture;
              out vec4 fragColor;
              void main() {
                  vec4 tex = texture(drawTexture, uv);
                  float h = (tex.x - 0.5) * 2.0;
                  fragColor = vec4(tex.x, tex.x, tex.x, 1.0);
              }`},inputs:{attributes:{pos:{buffer:S,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{},textures:{drawTexture:L}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:M.length,viewport:[0,0,F,k]}}),this.gs=e,this.differentialGraph=Y,this.summarizeGraph=Q,this.dataTexture1=A,this.dataTexture2=L,this.k0Texture=C,this.k1Texture=V,this.k2Texture=O,this.k3Texture=J,this.k4Texture=ue}loop(e){const t=this.differentialGraph,i=this.summarizeGraph;let r=this.dataTexture1,l=this.dataTexture2;if(this.i%2!==0&&(r=this.dataTexture2,l=this.dataTexture1),e)for(const h of e)t.updateUniform(h.name,h.value);return t.updateUniform("kFactor",[0]),t.updateTexture("dataTexture",r),t.updateTexture("kTexture",this.k0Texture),t.updateFramebuffer({textures:[this.k1Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k1Texture),t.updateFramebuffer({textures:[this.k2Texture]}),t.draw(),t.updateUniform("kFactor",[.5]),t.updateTexture("kTexture",this.k2Texture),t.updateFramebuffer({textures:[this.k3Texture]}),t.draw(),t.updateUniform("kFactor",[1]),t.updateTexture("kTexture",this.k3Texture),t.updateFramebuffer({textures:[this.k4Texture]}),t.draw(),i.updateTexture("dataTexture",r),i.updateFramebuffer({textures:[l]}),i.draw(),this.i+=1,l}destroy(e=!1){this.debugGraph.destroy(e),this.summarizeGraph.destroy(e),this.differentialGraph.destroy(e)}}let c$=class{constructor(e,t){ut(this,"rk");ut(this,"displayGraph");const i=e.getContext("webgl2"),r=5e-4,l=500,h=500;e.width=e.clientWidth,e.height=e.clientHeight;const o=Jk(()=>[0,0,0,1],l,h),p=Wy(0,0,2,2),v=new vo(i,{data:new Float32Array(p.flat()),changesOften:!1}),x=new kr(i,{image:t.bgImg}),M=new kr(i,{image:t.hImg}),S=new jy(i,{}),A=`

      // assuming a 6 x 6 m^2 field
      float dx = deltaX.x * 6.0;
      float dy = deltaY.y * 6.0;

      float h = data.x;
      float u = data.y;
      float v = data.z;
      float hPX = data_px.x;
      float uPX = data_px.y;
      float vPX = data_px.z;
      float hMX = data_mx.x;
      float uMX = data_mx.y;
      float vMX = data_mx.z;
      float hPY = data_py.x;
      float uPY = data_py.y;
      float vPY = data_py.z;
      float hMY = data_my.x;
      float uMY = data_my.y;
      float vMY = data_my.z;

      // finite differences
      vec2 uvTex = vec2(uv.x, 1.0 - uv.y);
      float H = texture(hTex, uvTex).x * 5.0; // 10.0;
      float f = 0.001;   // coriolis coefficient
      float b = 0.003;   // viscous drag
      float g = 9.831;   // fall acceleration

      float dudx = (uPX - uMX) / (2.0 * dx);
      float dvdy = (vPY - vMY) / (2.0 * dy);
      float dhdx = (hPX - hMX) / (2.0 * dx);
      float dhdy = (hPY - hMY) / (2.0 * dy);

      // user-interaction
      if (mousePos.w > 0.5) {
        float d = distance(mousePos.xy, uv);
        if (d < 0.01) {
          dhdx += mousePos.z;
          dhdy += mousePos.z;
        }
      }

      // edge conditions
      float x = gl_FragCoord.x;
      if (x < 2.0 || x > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dudx = 0.0;
        dhdx = 0.0; 
      }
      float y = gl_FragCoord.y;
      if (y < 2.0 || y > textureSize.x - 2.0) {
        v = 0.0;
        u = 0.0;
        dvdy = 0.0;
        dhdy = 0.0;
      }

      float dhdt =      - H * ( dudx + dvdy );
      float dudt = ( + f*v - b*u - g * dhdx );
      float dvdt = ( - f*u - b*v - g * dhdy );

      if (H < 0.1) {
        dhdt = 0.0;
        dudt = 0.0;
        dvdt = 0.0;
      }

      // detect and eliminate checkerboard pattern
      vec4 data_px_py = texture(dataTexture, uv + deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX + deltaY);
      vec4 data_px_my = texture(dataTexture, uv + deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv + deltaX - deltaY);
      vec4 data_mx_py = texture(dataTexture, uv - deltaX + deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX + deltaY);
      vec4 data_mx_my = texture(dataTexture, uv - deltaX - deltaY ) + dt * kFactor * texture(kTexture, uv - deltaX - deltaY);
      float neighborhoodSize = sqrt(
          data_mx_py.x * data_mx_py.x +  data_py.x * data_py.x + data_px_py.x * data_px_py.x
        + data_mx.x * data_mx.x       +  data.x * data.x       + data_px.x * data_px.x
        + data_mx_my.x * data_mx_my.x +  data_my.x * data_my.x + data_px_my.x * data_px_my.x
      );
      float h_norm       = data.x / neighborhoodSize;
      float h_mx_norm    = data_mx.x / neighborhoodSize;
      float h_px_norm    = data_px.x / neighborhoodSize;
      float h_my_norm    = data_my.x / neighborhoodSize;
      float h_py_norm    = data_py.x / neighborhoodSize;
      float h_mx_py_norm = data_mx_py.x / neighborhoodSize;
      float h_mx_my_norm = data_mx_my.x / neighborhoodSize;
      float h_px_py_norm = data_px_py.x / neighborhoodSize;
      float h_px_my_norm = data_px_my.x / neighborhoodSize;
      float signedSimilarity = (0.333 * h_mx_py_norm - 0.333 * h_py_norm  + 0.333 * h_px_py_norm  
                              - 0.333 * h_mx_norm    + 0.333 * h_norm     - 0.333 * h_px_norm  
                              + 0.333 * h_mx_my_norm - 0.333 * h_my_norm  + 0.333 * h_px_my_norm ) / 9.0;
      float similarityThreshold = 0.75;
      float nudgeStrength = 0.2;
      if (abs(signedSimilarity) > similarityThreshold) {
        float meanH = ( data_mx_py.x + data_py.x + data_px_py.x
                      + data_mx.x    + data.x    + data_px.x
                      + data_mx_my.x + data_my.x + data_px_my.x) / 9.0;
        float deltaHTarget = (meanH - data.x);
        float deltaHTrue = dhdt;
        float delta = deltaHTarget - deltaHTrue;
        dhdt += delta * nudgeStrength; 
      }

      fragColor = vec4(dhdt, dudt, dvdt, 1.0);
  `,L=new l$(S,A,o,r,[{name:"mousePos",type:"vec4",value:[0,0,0,0]}],[{name:"hTex",value:M}],[.995,.995,.995,1]),F=L.loop(),k=new Ra(S,{program:{vertexSource:`#version 300 es
        in vec2 pos;
        out vec2 uv;
        void main() {
            gl_Position = vec4(pos.xy, 0, 1);
            uv = (pos + 1.0) / 2.0;
        }`,fragmentSource:`#version 300 es
        precision highp float;
        in vec2 uv;
        uniform vec2 textureSize;
        uniform sampler2D tex;
        uniform sampler2D bgTex;
        out vec4 fragColor;

        float antiRound(float x) {
          float f = fract(x);
          if (f > 0.5) return floor(x);
          return ceil(x);
        }

        float prox(vec2 a, vec2 b) {
          float dx = a.x - b.x;
          float dy = a.y - b.y;
          float dist = sqrt(dx*dx + dy*dy);
          return 1. - dist;
        }

        // our data-texture allows no interpolation.
        // if we chose a low resolution R,C < 200, then the user can see individual pixels.
        // so we do interpolated sampling in software here.
        vec4 textureInterpolated(sampler2D tex, vec2 uv, vec2 textureSize) {
          vec2 rc = uv * textureSize;
          
          vec2 rcPicked = round(rc);
          float wPicked = prox(rc, rcPicked);

          vec2 rcAntiRow = vec2(antiRound(rc.x), rcPicked.y);
          float wAntiRow = prox(rc, rcAntiRow);

          vec2 rcAntiCol = vec2(rcPicked.x, antiRound(rc.y));
          float wAntiCol = prox(rc, rcAntiCol);

          float wTot = wPicked + wAntiRow + wAntiCol;
          wPicked    = wPicked  / wTot;
          wAntiRow   = wAntiRow / wTot;
          wAntiCol   = wAntiCol / wTot;

          vec4 valPicked  = texture(tex, rcPicked  / textureSize);
          vec4 valAntiRow = texture(tex, rcAntiRow / textureSize);
          vec4 valAntiCol = texture(tex, rcAntiCol / textureSize);

          vec4 valInterpol = valPicked * wPicked + valAntiRow * wAntiRow + valAntiCol * wAntiCol;
          return valInterpol;
        }

        void main() {
            // vec4 tex = texture(tex, uv);
            vec4 tex = textureInterpolated(tex, uv, textureSize);
            vec2 uvBg = vec2(uv.x, 1.0 - uv.y);
            uvBg += vec2(tex.x, tex.x) * 0.02;
            vec4 bg = texture(bgTex, uvBg);
            fragColor = bg;
        }`},inputs:{attributes:{pos:{buffer:v,config:{normalize:!1,nrInstances:0,type:"vec2"}}},uniforms:{textureSize:{type:"vec2",value:[h,l]}},textures:{tex:F,bgTex:x}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:p.length,viewport:[0,0,e.width,e.height]}});this.rk=L,this.displayGraph=k}step(e){const{userX:t,userY:i,userStrength:r,userMoving:l}=e,h=this.rk.loop([{name:"mousePos",type:"vec4",value:[t,i,r,l]}]);this.displayGraph.updateTexture("tex",h),this.displayGraph.draw()}destroy(e){this.rk.destroy(e),this.displayGraph.destroy(e)}};function X7(n){return ge.jsx(of,{hero:ge.jsx(IA,{backgroundImage:n.bgImg,title:n.title,subtitle:n.subTitle}),logo:n.logo,footerContent:ge.jsx(RA,{}),children:n.children})}class u${constructor(){ut(this,"looper");ut(this,"swe");ut(this,"canvas");ut(this,"mouseListener",e=>{if(!this.canvas)return;const t=this.canvas.getBoundingClientRect();this.userX=(e.clientX-t.left)/this.canvas.clientWidth,this.userY=1-(e.clientY-t.top)/this.canvas.clientHeight,this.userMoving=1});ut(this,"userX",0);ut(this,"userY",0);ut(this,"userMoving",0);ut(this,"destroyed",!1)}async init(e){this.canvas=e,this.canvas.width=this.canvas.clientWidth,this.canvas.height=this.canvas.clientHeight;const t=await kr.loadImage("/swe_bg.jpg"),i=await kr.loadImage("/swe_h2.jpg");this.destroyed||(this.swe=new c$(e,{bgImg:t,hImg:i}),this.looper=new qp(10,()=>{var r;(r=this.swe)==null||r.step({userX:this.userX,userY:this.userY,userMoving:this.userMoving,userStrength:1e3}),this.userMoving=0}),this.canvas.addEventListener("mousemove",this.mouseListener),this.startLoop())}startLoop(){var e;if(!this.canvas){console.warn(`Attempting to run an already destroyed effect. 
      This is only expected behavior in development.`);return}(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){var e,t;this.stopLoop(),this.mouseListener&&((e=this.canvas)==null||e.removeEventListener("mousemove",this.mouseListener)),(t=this.swe)==null||t.destroy(!0),this.swe=void 0,this.canvas=void 0,this.destroyed=!0}}function h$(){const n=gt.useRef(null);return gt.useEffect(()=>{const e=new u$;return n.current&&e.init(n.current),()=>e.destroy()},[n.current]),ge.jsxs(X7,{bgImg:"/swe_bg.jpg",title:"Wave simulations",subTitle:"using the shallow water equations",logo:ge.jsxs("svg",{width:"100%",height:"100%",viewBox:"0 0 5 4",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"squiggle",d:`M 0 0 
              C 0.5 0 0.5 0.5 1.0 0.5 
              S       1.5 0.0 2.0 0.0
              S       2.5 0.5 3.0 0.5
              S       3.5 0.0 4.0 0.0`,stroke:"black",strokeWidth:"0.2",strokeLinejoin:"round",fill:"none"})}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"1.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"2.0"}),ge.jsx("use",{href:"#squiggle",x:"0.5",y:"3.0"})]}),children:[ge.jsxs("p",{style:{margin:"2rem"},children:["Water-surface-movement can be simulated accurately with the"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Shallow_water_equations",target:"_blank",children:"shallow water equations"}),". To augment the numerical stability of that simulation, approximation methods like"," ",ge.jsx("a",{href:"https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods",target:"_blank",children:"Runge-Kutta"})," ","can be used."]}),ge.jsxs("p",{style:{margin:"2rem"},children:["The image below contains an implementation of this method. ",ge.jsx("b",{children:"Move your mouse over the water"})," to make waves!"]}),ge.jsx("canvas",{ref:n,style:{width:"100%",aspectRatio:"3/2"}}),ge.jsx("p",{style:{margin:"2rem"},children:"This method can be adjusted to be included in maps, 3d-scenes etc."})]})}var $T=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var n=0,e=arguments.length;e--;)n+=arguments[e]*arguments[e];return Math.sqrt(n)});function d$(){var n=new $T(16);return $T!=Float32Array&&(n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[11]=0,n[12]=0,n[13]=0,n[14]=0),n[0]=1,n[5]=1,n[10]=1,n[15]=1,n}function f$(n,e){var t=e[0],i=e[1],r=e[2],l=e[3],h=e[4],o=e[5],p=e[6],v=e[7],x=e[8],M=e[9],S=e[10],A=e[11],L=e[12],F=e[13],k=e[14],C=e[15],V=t*o-i*h,O=t*p-r*h,J=t*v-l*h,ue=i*p-r*o,Y=i*v-l*o,Q=r*v-l*p,xe=x*F-M*L,re=x*k-S*L,ee=x*C-A*L,Me=M*k-S*F,Fe=M*C-A*F,Ae=S*C-A*k,He=V*Ae-O*Fe+J*Me+ue*ee-Y*re+Q*xe;return He?(He=1/He,n[0]=(o*Ae-p*Fe+v*Me)*He,n[1]=(r*Fe-i*Ae-l*Me)*He,n[2]=(F*Q-k*Y+C*ue)*He,n[3]=(S*Y-M*Q-A*ue)*He,n[4]=(p*ee-h*Ae-v*re)*He,n[5]=(t*Ae-r*ee+l*re)*He,n[6]=(k*J-L*Q-C*O)*He,n[7]=(x*Q-S*J+A*O)*He,n[8]=(h*Fe-o*ee+v*xe)*He,n[9]=(i*ee-t*Fe-l*xe)*He,n[10]=(L*Y-F*J+C*V)*He,n[11]=(M*J-x*Y-A*V)*He,n[12]=(o*re-h*Me-p*xe)*He,n[13]=(t*Me-i*re+r*xe)*He,n[14]=(F*O-L*ue-k*V)*He,n[15]=(x*ue-M*O+S*V)*He,n):null}var Z7={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.1.2/LICENSE.txt
 */(function(n,e){(function(t,i){n.exports=i()})(GP,function(){var t={},i={};function r(h,o,p){if(i[h]=p,h==="index"){var v="var sharedModule = {}; ("+i.shared+")(sharedModule); ("+i.worker+")(sharedModule);",x={};return i.shared(x),i.index(t,x),typeof window<"u"&&t.setWorkerUrl(window.URL.createObjectURL(new Blob([v],{type:"text/javascript"}))),t}}r("shared",["exports"],function(h){function o(c,a,u,f){return new(u||(u=Promise))(function(y,w){function T(z){try{I(f.next(z))}catch(j){w(j)}}function E(z){try{I(f.throw(z))}catch(j){w(j)}}function I(z){var j;z.done?y(z.value):(j=z.value,j instanceof u?j:new u(function(W){W(j)})).then(T,E)}I((f=f.apply(c,a||[])).next())})}function p(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}typeof SuppressedError=="function"&&SuppressedError;var v=x;function x(c,a){this.x=c,this.y=a}x.prototype={clone:function(){return new x(this.x,this.y)},add:function(c){return this.clone()._add(c)},sub:function(c){return this.clone()._sub(c)},multByPoint:function(c){return this.clone()._multByPoint(c)},divByPoint:function(c){return this.clone()._divByPoint(c)},mult:function(c){return this.clone()._mult(c)},div:function(c){return this.clone()._div(c)},rotate:function(c){return this.clone()._rotate(c)},rotateAround:function(c,a){return this.clone()._rotateAround(c,a)},matMult:function(c){return this.clone()._matMult(c)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(c){return this.x===c.x&&this.y===c.y},dist:function(c){return Math.sqrt(this.distSqr(c))},distSqr:function(c){var a=c.x-this.x,u=c.y-this.y;return a*a+u*u},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(c){return Math.atan2(this.y-c.y,this.x-c.x)},angleWith:function(c){return this.angleWithSep(c.x,c.y)},angleWithSep:function(c,a){return Math.atan2(this.x*a-this.y*c,this.x*c+this.y*a)},_matMult:function(c){var a=c[2]*this.x+c[3]*this.y;return this.x=c[0]*this.x+c[1]*this.y,this.y=a,this},_add:function(c){return this.x+=c.x,this.y+=c.y,this},_sub:function(c){return this.x-=c.x,this.y-=c.y,this},_mult:function(c){return this.x*=c,this.y*=c,this},_div:function(c){return this.x/=c,this.y/=c,this},_multByPoint:function(c){return this.x*=c.x,this.y*=c.y,this},_divByPoint:function(c){return this.x/=c.x,this.y/=c.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var c=this.y;return this.y=this.x,this.x=-c,this},_rotate:function(c){var a=Math.cos(c),u=Math.sin(c),f=u*this.x+a*this.y;return this.x=a*this.x-u*this.y,this.y=f,this},_rotateAround:function(c,a){var u=Math.cos(c),f=Math.sin(c),y=a.y+f*(this.x-a.x)+u*(this.y-a.y);return this.x=a.x+u*(this.x-a.x)-f*(this.y-a.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},x.convert=function(c){return c instanceof x?c:Array.isArray(c)?new x(c[0],c[1]):c};var M=p(v),S=A;function A(c,a,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=u,this.p2y=f}A.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var y=this.sampleCurveX(u)-c;if(Math.abs(y)<a)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=y/w}var T=0,E=1;for(u=c,f=0;f<20&&(y=this.sampleCurveX(u),!(Math.abs(y-c)<a));f++)c>y?T=u:E=u,u=.5*(E-T)+T;return u},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var L=p(S);let F,k;function C(){return F==null&&(F=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),F}function V(){if(k==null&&(k=!1,C())){const a=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(a){for(let f=0;f<5*5;f++){const y=4*f;a.fillStyle=`rgb(${y},${y+1},${y+2})`,a.fillRect(f%5,Math.floor(f/5),1,1)}const u=a.getImageData(0,0,5,5).data;for(let f=0;f<5*5*4;f++)if(f%4!=3&&u[f]!==f){k=!0;break}}}return k||!1}function O(c,a,u,f){const y=new L(c,a,u,f);return function(w){return y.solve(w)}}const J=O(.25,.1,.25,1);function ue(c,a,u){return Math.min(u,Math.max(a,c))}function Y(c,a,u){const f=u-a,y=((c-a)%f+f)%f+a;return y===a?u:y}function Q(c,...a){for(const u of a)for(const f in u)c[f]=u[f];return c}let xe=1;function re(c,a,u){const f={};for(const y in c)f[y]=a.call(u||this,c[y],y,c);return f}function ee(c,a,u){const f={};for(const y in c)a.call(u||this,c[y],y,c)&&(f[y]=c[y]);return f}function Me(c){return Array.isArray(c)?c.map(Me):typeof c=="object"&&c?re(c,Me):c}const Fe={};function Ae(c){Fe[c]||(typeof console<"u"&&console.warn(c),Fe[c]=!0)}function He(c,a,u){return(u.y-c.y)*(a.x-c.x)>(a.y-c.y)*(u.x-c.x)}function ot(c){let a=0;for(let u,f,y=0,w=c.length,T=w-1;y<w;T=y++)u=c[y],f=c[T],a+=(f.x-u.x)*(u.y+f.y);return a}function ft(c){return typeof WorkerGlobalScope<"u"&&c!==void 0&&c instanceof WorkerGlobalScope}let ct=null;function De(c){return typeof ImageBitmap<"u"&&c instanceof ImageBitmap}const Je="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function tt(c,a,u,f,y){return o(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const w=new VideoFrame(c,{timestamp:0});try{const T=w==null?void 0:w.format;if(!T||!T.startsWith("BGR")&&!T.startsWith("RGB"))throw new Error(`Unrecognized format ${T}`);const E=T.startsWith("BGR"),I=new Uint8ClampedArray(f*y*4);if(yield w.copyTo(I,function(z,j,W,K,ae){const oe=4*Math.max(-j,0),pe=(Math.max(0,W)-W)*K*4+oe,be=4*K,Pe=Math.max(0,j),Ve=Math.max(0,W);return{rect:{x:Pe,y:Ve,width:Math.min(z.width,j+K)-Pe,height:Math.min(z.height,W+ae)-Ve},layout:[{offset:pe,stride:be}]}}(c,a,u,f,y)),E)for(let z=0;z<I.length;z+=4){const j=I[z];I[z]=I[z+2],I[z+2]=j}return I}finally{w.close()}})}let _t,Lt;const Cn="AbortError";function nt(){return new Error(Cn)}const wt={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function Ft(c){return wt.REGISTERED_PROTOCOLS[c.substring(0,c.indexOf("://"))]}const At="global-dispatcher";class gn extends Error{constructor(a,u,f,y){super(`AJAXError: ${u} (${a}): ${f}`),this.status=a,this.statusText=u,this.url=f,this.body=y}}const En=()=>ft(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,In=function(c,a){if(/:\/\//.test(c.url)&&!/^https?:|^file:/.test(c.url)){const f=Ft(c.url);if(f)return f(c,a);if(ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,targetMapId:At},a)}if(!(/^file:/.test(u=c.url)||/^file:/.test(En())&&!/^\w+:/.test(u))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(f,y){return o(this,void 0,void 0,function*(){const w=new Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,cache:f.cache,referrer:En(),signal:y.signal});f.type==="json"&&w.headers.set("Accept","application/json");const T=yield fetch(w);if(!T.ok){const z=yield T.blob();throw new gn(T.status,T.statusText,f.url,z)}let E;E=f.type==="arrayBuffer"||f.type==="image"?T.arrayBuffer():f.type==="json"?T.json():T.text();const I=yield E;if(y.signal.aborted)throw nt();return{data:I,cacheControl:T.headers.get("Cache-Control"),expires:T.headers.get("Expires")}})}(c,a);if(ft(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"getResource",data:c,mustQueue:!0,targetMapId:At},a)}var u;return function(f,y){return new Promise((w,T)=>{const E=new XMLHttpRequest;E.open(f.method||"GET",f.url,!0),f.type!=="arrayBuffer"&&f.type!=="image"||(E.responseType="arraybuffer");for(const I in f.headers)E.setRequestHeader(I,f.headers[I]);f.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=f.credentials==="include",E.onerror=()=>{T(new Error(E.statusText))},E.onload=()=>{if(!y.signal.aborted)if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){let I=E.response;if(f.type==="json")try{I=JSON.parse(E.response)}catch(z){return void T(z)}w({data:I,cacheControl:E.getResponseHeader("Cache-Control"),expires:E.getResponseHeader("Expires")})}else{const I=new Blob([E.response],{type:E.getResponseHeader("Content-Type")});T(new gn(E.status,E.statusText,f.url,I))}},y.signal.addEventListener("abort",()=>{E.abort(),T(nt())}),E.send(f.body)})}(c,a)};function je(c){if(!c||c.indexOf("://")<=0||c.indexOf("data:image/")===0||c.indexOf("blob:")===0)return!0;const a=new URL(c),u=window.location;return a.protocol===u.protocol&&a.host===u.host}function An(c,a,u){u[c]&&u[c].indexOf(a)!==-1||(u[c]=u[c]||[],u[c].push(a))}function yn(c,a,u){if(u&&u[c]){const f=u[c].indexOf(a);f!==-1&&u[c].splice(f,1)}}class Qn{constructor(a,u={}){Q(this,u),this.type=a}}class Yt extends Qn{constructor(a,u={}){super("error",Q({error:a},u))}}class Gn{on(a,u){return this._listeners=this._listeners||{},An(a,u,this._listeners),this}off(a,u){return yn(a,u,this._listeners),yn(a,u,this._oneTimeListeners),this}once(a,u){return u?(this._oneTimeListeners=this._oneTimeListeners||{},An(a,u,this._oneTimeListeners),this):new Promise(f=>this.once(a,f))}fire(a,u){typeof a=="string"&&(a=new Qn(a,u||{}));const f=a.type;if(this.listens(f)){a.target=this;const y=this._listeners&&this._listeners[f]?this._listeners[f].slice():[];for(const E of y)E.call(this,a);const w=this._oneTimeListeners&&this._oneTimeListeners[f]?this._oneTimeListeners[f].slice():[];for(const E of w)yn(f,E,this._oneTimeListeners),E.call(this,a);const T=this._eventedParent;T&&(Q(a,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),T.fire(a))}else a instanceof Yt&&console.error(a.error);return this}listens(a){return this._listeners&&this._listeners[a]&&this._listeners[a].length>0||this._oneTimeListeners&&this._oneTimeListeners[a]&&this._oneTimeListeners[a].length>0||this._eventedParent&&this._eventedParent.listens(a)}setEventedParent(a,u){return this._eventedParent=a,this._eventedParentData=u,this}}var ie={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const le=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function st(c,a){const u={};for(const f in c)f!=="ref"&&(u[f]=c[f]);return le.forEach(f=>{f in a&&(u[f]=a[f])}),u}function rt(c,a){if(Array.isArray(c)){if(!Array.isArray(a)||c.length!==a.length)return!1;for(let u=0;u<c.length;u++)if(!rt(c[u],a[u]))return!1;return!0}if(typeof c=="object"&&c!==null&&a!==null){if(typeof a!="object"||Object.keys(c).length!==Object.keys(a).length)return!1;for(const u in c)if(!rt(c[u],a[u]))return!1;return!0}return c===a}function mt(c,a){c.push(a)}function St(c,a,u){mt(u,{command:"addSource",args:[c,a[c]]})}function _n(c,a,u){mt(a,{command:"removeSource",args:[c]}),u[c]=!0}function Mt(c,a,u,f){_n(c,u,f),St(c,a,u)}function hn(c,a,u){let f;for(f in c[u])if(Object.prototype.hasOwnProperty.call(c[u],f)&&f!=="data"&&!rt(c[u][f],a[u][f]))return!1;for(f in a[u])if(Object.prototype.hasOwnProperty.call(a[u],f)&&f!=="data"&&!rt(c[u][f],a[u][f]))return!1;return!0}function xn(c,a,u,f,y,w){c=c||{},a=a||{};for(const T in c)Object.prototype.hasOwnProperty.call(c,T)&&(rt(c[T],a[T])||u.push({command:w,args:[f,T,a[T],y]}));for(const T in a)Object.prototype.hasOwnProperty.call(a,T)&&!Object.prototype.hasOwnProperty.call(c,T)&&(rt(c[T],a[T])||u.push({command:w,args:[f,T,a[T],y]}))}function Nt(c){return c.id}function an(c,a){return c[a.id]=a,c}class at{constructor(a,u,f,y){this.message=(a?`${a}: `:"")+f,y&&(this.identifier=y),u!=null&&u.__line__&&(this.line=u.__line__)}}function tn(c,...a){for(const u of a)for(const f in u)c[f]=u[f];return c}class Kt extends Error{constructor(a,u){super(u),this.message=u,this.key=a}}class On{constructor(a,u=[]){this.parent=a,this.bindings={};for(const[f,y]of u)this.bindings[f]=y}concat(a){return new On(this,a)}get(a){if(this.bindings[a])return this.bindings[a];if(this.parent)return this.parent.get(a);throw new Error(`${a} not found in scope.`)}has(a){return!!this.bindings[a]||!!this.parent&&this.parent.has(a)}}const Un={kind:"null"},dt={kind:"number"},Ht={kind:"string"},jt={kind:"boolean"},Jt={kind:"color"},X={kind:"object"},Oe={kind:"value"},pt={kind:"collator"},Dt={kind:"formatted"},ce={kind:"padding"},B={kind:"resolvedImage"},U={kind:"variableAnchorOffsetCollection"};function q(c,a){return{kind:"array",itemType:c,N:a}}function ne(c){if(c.kind==="array"){const a=ne(c.itemType);return typeof c.N=="number"?`array<${a}, ${c.N}>`:c.itemType.kind==="value"?"array":`array<${a}>`}return c.kind}const me=[Un,dt,Ht,jt,Jt,Dt,X,q(Oe),ce,B,U];function Se(c,a){if(a.kind==="error")return null;if(c.kind==="array"){if(a.kind==="array"&&(a.N===0&&a.itemType.kind==="value"||!Se(c.itemType,a.itemType))&&(typeof c.N!="number"||c.N===a.N))return null}else{if(c.kind===a.kind)return null;if(c.kind==="value"){for(const u of me)if(!Se(u,a))return null}}return`Expected ${ne(c)} but found ${ne(a)} instead.`}function Ee(c,a){return a.some(u=>u.kind===c.kind)}function ye(c,a){return a.some(u=>u==="null"?c===null:u==="array"?Array.isArray(c):u==="object"?c&&!Array.isArray(c)&&typeof c=="object":u===typeof c)}function Re(c,a){return c.kind==="array"&&a.kind==="array"?c.itemType.kind===a.itemType.kind&&typeof c.N=="number":c.kind===a.kind}const qe=.96422,Ye=.82521,Ge=4/29,Ct=6/29,nn=3*Ct*Ct,on=Ct*Ct*Ct,bn=Math.PI/180,wn=180/Math.PI;function li(c){return(c%=360)<0&&(c+=360),c}function ei([c,a,u,f]){let y,w;const T=Le((.2225045*(c=de(c))+.7168786*(a=de(a))+.0606169*(u=de(u)))/1);c===a&&a===u?y=w=T:(y=Le((.4360747*c+.3850649*a+.1430804*u)/qe),w=Le((.0139322*c+.0971045*a+.7141733*u)/Ye));const E=116*T-16;return[E<0?0:E,500*(y-T),200*(T-w),f]}function de(c){return c<=.04045?c/12.92:Math.pow((c+.055)/1.055,2.4)}function Le(c){return c>on?Math.pow(c,1/3):c/nn+Ge}function We([c,a,u,f]){let y=(c+16)/116,w=isNaN(a)?y:y+a/500,T=isNaN(u)?y:y-u/200;return y=1*Ze(y),w=qe*Ze(w),T=Ye*Ze(T),[Xe(3.1338561*w-1.6168667*y-.4906146*T),Xe(-.9787684*w+1.9161415*y+.033454*T),Xe(.0719453*w-.2289914*y+1.4052427*T),f]}function Xe(c){return(c=c<=.00304?12.92*c:1.055*Math.pow(c,1/2.4)-.055)<0?0:c>1?1:c}function Ze(c){return c>Ct?c*c*c:nn*(c-Ge)}function Pt(c){return parseInt(c.padEnd(2,c),16)/255}function rn(c,a){return It(a?c/100:c,0,1)}function It(c,a,u){return Math.min(Math.max(a,c),u)}function Qt(c){return!c.some(Number.isNaN)}const Sn={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Xt{constructor(a,u,f,y=1,w=!0){this.r=a,this.g=u,this.b=f,this.a=y,w||(this.r*=y,this.g*=y,this.b*=y,y||this.overwriteGetter("rgb",[a,u,f,y]))}static parse(a){if(a instanceof Xt)return a;if(typeof a!="string")return;const u=function(f){if((f=f.toLowerCase().trim())==="transparent")return[0,0,0,0];const y=Sn[f];if(y){const[T,E,I]=y;return[T/255,E/255,I/255,1]}if(f.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(f)){const T=f.length<6?1:2;let E=1;return[Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+=T)),Pt(f.slice(E,E+T)||"ff")]}if(f.startsWith("rgb")){const T=f.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(T){const[E,I,z,j,W,K,ae,oe,pe,be,Pe,Ve]=T,ke=[j||" ",ae||" ",be].join("");if(ke==="  "||ke==="  /"||ke===",,"||ke===",,,"){const Ne=[z,K,pe].join(""),ht=Ne==="%%%"?100:Ne===""?255:0;if(ht){const yt=[It(+I/ht,0,1),It(+W/ht,0,1),It(+oe/ht,0,1),Pe?rn(+Pe,Ve):1];if(Qt(yt))return yt}}return}}const w=f.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(w){const[T,E,I,z,j,W,K,ae,oe]=w,pe=[I||" ",j||" ",K].join("");if(pe==="  "||pe==="  /"||pe===",,"||pe===",,,"){const be=[+E,It(+z,0,100),It(+W,0,100),ae?rn(+ae,oe):1];if(Qt(be))return function([Pe,Ve,ke,Ne]){function ht(yt){const Wt=(yt+Pe/30)%12,un=Ve*Math.min(ke,1-ke);return ke-un*Math.max(-1,Math.min(Wt-3,9-Wt,1))}return Pe=li(Pe),Ve/=100,ke/=100,[ht(0),ht(8),ht(4),Ne]}(be)}}}(a);return u?new Xt(...u,!1):void 0}get rgb(){const{r:a,g:u,b:f,a:y}=this,w=y||1/0;return this.overwriteGetter("rgb",[a/w,u/w,f/w,y])}get hcl(){return this.overwriteGetter("hcl",function(a){const[u,f,y,w]=ei(a),T=Math.sqrt(f*f+y*y);return[Math.round(1e4*T)?li(Math.atan2(y,f)*wn):NaN,T,u,w]}(this.rgb))}get lab(){return this.overwriteGetter("lab",ei(this.rgb))}overwriteGetter(a,u){return Object.defineProperty(this,a,{value:u}),u}toString(){const[a,u,f,y]=this.rgb;return`rgba(${[a,u,f].map(w=>Math.round(255*w)).join(",")},${y})`}}Xt.black=new Xt(0,0,0,1),Xt.white=new Xt(1,1,1,1),Xt.transparent=new Xt(0,0,0,0),Xt.red=new Xt(1,0,0,1);class Fn{constructor(a,u,f){this.sensitivity=a?u?"variant":"case":u?"accent":"base",this.locale=f,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(a,u){return this.collator.compare(a,u)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ei{constructor(a,u,f,y,w){this.text=a,this.image=u,this.scale=f,this.fontStack=y,this.textColor=w}}class gi{constructor(a){this.sections=a}static fromString(a){return new gi([new Ei(a,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(a=>a.text.length!==0||a.image&&a.image.name.length!==0)}static factory(a){return a instanceof gi?a:gi.fromString(a)}toString(){return this.sections.length===0?"":this.sections.map(a=>a.text).join("")}}class ci{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof ci)return a;if(typeof a=="number")return new ci([a,a,a,a]);if(Array.isArray(a)&&!(a.length<1||a.length>4)){for(const u of a)if(typeof u!="number")return;switch(a.length){case 1:a=[a[0],a[0],a[0],a[0]];break;case 2:a=[a[0],a[1],a[0],a[1]];break;case 3:a=[a[0],a[1],a[2],a[1]]}return new ci(a)}}toString(){return JSON.stringify(this.values)}}const Ma=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Wn{constructor(a){this.values=a.slice()}static parse(a){if(a instanceof Wn)return a;if(Array.isArray(a)&&!(a.length<1)&&a.length%2==0){for(let u=0;u<a.length;u+=2){const f=a[u],y=a[u+1];if(typeof f!="string"||!Ma.has(f)||!Array.isArray(y)||y.length!==2||typeof y[0]!="number"||typeof y[1]!="number")return}return new Wn(a)}}toString(){return JSON.stringify(this.values)}}class Pn{constructor(a){this.name=a.name,this.available=a.available}toString(){return this.name}static fromString(a){return a?new Pn({name:a,available:!1}):null}}function Al(c,a,u,f){return typeof c=="number"&&c>=0&&c<=255&&typeof a=="number"&&a>=0&&a<=255&&typeof u=="number"&&u>=0&&u<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:`Invalid rgba value [${[c,a,u,f].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof f=="number"?[c,a,u,f]:[c,a,u]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function oi(c){if(c===null||typeof c=="string"||typeof c=="boolean"||typeof c=="number"||c instanceof Xt||c instanceof Fn||c instanceof gi||c instanceof ci||c instanceof Wn||c instanceof Pn)return!0;if(Array.isArray(c)){for(const a of c)if(!oi(a))return!1;return!0}if(typeof c=="object"){for(const a in c)if(!oi(c[a]))return!1;return!0}return!1}function fi(c){if(c===null)return Un;if(typeof c=="string")return Ht;if(typeof c=="boolean")return jt;if(typeof c=="number")return dt;if(c instanceof Xt)return Jt;if(c instanceof Fn)return pt;if(c instanceof gi)return Dt;if(c instanceof ci)return ce;if(c instanceof Wn)return U;if(c instanceof Pn)return B;if(Array.isArray(c)){const a=c.length;let u;for(const f of c){const y=fi(f);if(u){if(u===y)continue;u=Oe;break}u=y}return q(u||Oe,a)}return X}function Qs(c){const a=typeof c;return c===null?"":a==="string"||a==="number"||a==="boolean"?String(c):c instanceof Xt||c instanceof gi||c instanceof ci||c instanceof Wn||c instanceof Pn?c.toString():JSON.stringify(c)}class sa{constructor(a,u){this.type=a,this.value=u}static parse(a,u){if(a.length!==2)return u.error(`'literal' expression requires exactly one argument, but found ${a.length-1} instead.`);if(!oi(a[1]))return u.error("invalid value");const f=a[1];let y=fi(f);const w=u.expectedType;return y.kind!=="array"||y.N!==0||!w||w.kind!=="array"||typeof w.N=="number"&&w.N!==0||(y=w),new sa(y,f)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class xi{constructor(a){this.name="ExpressionEvaluationError",this.message=a}toJSON(){return this.message}}const Ri={string:Ht,number:dt,boolean:jt,object:X};class Ji{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");let f,y=1;const w=a[0];if(w==="array"){let E,I;if(a.length>2){const z=a[1];if(typeof z!="string"||!(z in Ri)||z==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=Ri[z],y++}else E=Oe;if(a.length>3){if(a[2]!==null&&(typeof a[2]!="number"||a[2]<0||a[2]!==Math.floor(a[2])))return u.error('The length argument to "array" must be a positive integer literal',2);I=a[2],y++}f=q(E,I)}else{if(!Ri[w])throw new Error(`Types doesn't contain name = ${w}`);f=Ri[w]}const T=[];for(;y<a.length;y++){const E=u.parse(a[y],y,Oe);if(!E)return null;T.push(E)}return new Ji(f,T)}evaluate(a){for(let u=0;u<this.args.length;u++){const f=this.args[u].evaluate(a);if(!Se(this.type,fi(f)))return f;if(u===this.args.length-1)throw new xi(`Expected value to be of type ${ne(this.type)}, but found ${ne(fi(f))} instead.`)}throw new Error}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const eo={"to-boolean":jt,"to-color":Jt,"to-number":dt,"to-string":Ht};class Li{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const f=a[0];if(!eo[f])throw new Error(`Can't parse ${f} as it is not part of the known types`);if((f==="to-boolean"||f==="to-string")&&a.length!==2)return u.error("Expected one argument.");const y=eo[f],w=[];for(let T=1;T<a.length;T++){const E=u.parse(a[T],T,Oe);if(!E)return null;w.push(E)}return new Li(y,w)}evaluate(a){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(a);case"color":{let u,f;for(const y of this.args){if(u=y.evaluate(a),f=null,u instanceof Xt)return u;if(typeof u=="string"){const w=a.parseColor(u);if(w)return w}else if(Array.isArray(u)&&(f=u.length<3||u.length>4?`Invalid rbga value ${JSON.stringify(u)}: expected an array containing either three or four numeric values.`:Al(u[0],u[1],u[2],u[3]),!f))return new Xt(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new xi(f||`Could not parse color from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"padding":{let u;for(const f of this.args){u=f.evaluate(a);const y=ci.parse(u);if(y)return y}throw new xi(`Could not parse padding from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"variableAnchorOffsetCollection":{let u;for(const f of this.args){u=f.evaluate(a);const y=Wn.parse(u);if(y)return y}throw new xi(`Could not parse variableAnchorOffsetCollection from value '${typeof u=="string"?u:JSON.stringify(u)}'`)}case"number":{let u=null;for(const f of this.args){if(u=f.evaluate(a),u===null)return 0;const y=Number(u);if(!isNaN(y))return y}throw new xi(`Could not convert ${JSON.stringify(u)} to number.`)}case"formatted":return gi.fromString(Qs(this.args[0].evaluate(a)));case"resolvedImage":return Pn.fromString(Qs(this.args[0].evaluate(a)));default:return Qs(this.args[0].evaluate(a))}}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}const Io=["Unknown","Point","LineString","Polygon"];class to{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Io[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(a){let u=this._parseColorCache[a];return u||(u=this._parseColorCache[a]=Xt.parse(a)),u}}class ii{constructor(a,u,f=[],y,w=new On,T=[]){this.registry=a,this.path=f,this.key=f.map(E=>`[${E}]`).join(""),this.scope=w,this.errors=T,this.expectedType=y,this._isConstant=u}parse(a,u,f,y,w={}){return u?this.concat(u,f,y)._parse(a,w):this._parse(a,w)}_parse(a,u){function f(y,w,T){return T==="assert"?new Ji(w,[y]):T==="coerce"?new Li(w,[y]):y}if(a!==null&&typeof a!="string"&&typeof a!="boolean"&&typeof a!="number"||(a=["literal",a]),Array.isArray(a)){if(a.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const y=a[0];if(typeof y!="string")return this.error(`Expression name must be a string, but found ${typeof y} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const w=this.registry[y];if(w){let T=w.parse(a,this);if(!T)return null;if(this.expectedType){const E=this.expectedType,I=T.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||I.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||I.kind!=="value"&&I.kind!=="string")if(E.kind!=="padding"||I.kind!=="value"&&I.kind!=="number"&&I.kind!=="array")if(E.kind!=="variableAnchorOffsetCollection"||I.kind!=="value"&&I.kind!=="array"){if(this.checkSubtype(E,I))return null}else T=f(T,E,u.typeAnnotation||"coerce");else T=f(T,E,u.typeAnnotation||"coerce");else T=f(T,E,u.typeAnnotation||"coerce");else T=f(T,E,u.typeAnnotation||"assert")}if(!(T instanceof sa)&&T.type.kind!=="resolvedImage"&&this._isConstant(T)){const E=new to;try{T=new sa(T.type,T.evaluate(E))}catch(I){return this.error(I.message),null}}return T}return this.error(`Unknown expression "${y}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(a===void 0?"'undefined' value invalid. Use null instead.":typeof a=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof a} instead.`)}concat(a,u,f){const y=typeof a=="number"?this.path.concat(a):this.path,w=f?this.scope.concat(f):this.scope;return new ii(this.registry,this._isConstant,y,u||null,w,this.errors)}error(a,...u){const f=`${this.key}${u.map(y=>`[${y}]`).join("")}`;this.errors.push(new Kt(f,a))}checkSubtype(a,u){const f=Se(a,u);return f&&this.error(f),f}}class eh{constructor(a,u,f){this.type=pt,this.locale=f,this.caseSensitive=a,this.diacriticSensitive=u}static parse(a,u){if(a.length!==2)return u.error("Expected one argument.");const f=a[1];if(typeof f!="object"||Array.isArray(f))return u.error("Collator options argument must be an object.");const y=u.parse(f["case-sensitive"]!==void 0&&f["case-sensitive"],1,jt);if(!y)return null;const w=u.parse(f["diacritic-sensitive"]!==void 0&&f["diacritic-sensitive"],1,jt);if(!w)return null;let T=null;return f.locale&&(T=u.parse(f.locale,1,Ht),!T)?null:new eh(y,w,T)}evaluate(a){return new Fn(this.caseSensitive.evaluate(a),this.diacriticSensitive.evaluate(a),this.locale?this.locale.evaluate(a):null)}eachChild(a){a(this.caseSensitive),a(this.diacriticSensitive),this.locale&&a(this.locale)}outputDefined(){return!1}}const ss=8192;function ff(c,a){c[0]=Math.min(c[0],a[0]),c[1]=Math.min(c[1],a[1]),c[2]=Math.max(c[2],a[0]),c[3]=Math.max(c[3],a[1])}function qc(c,a){return!(c[0]<=a[0]||c[2]>=a[2]||c[1]<=a[1]||c[3]>=a[3])}function nm(c,a){const u=(180+c[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c[1]*Math.PI/360)))/360,y=Math.pow(2,a.z);return[Math.round(u*y*ss),Math.round(f*y*ss)]}function ov(c,a,u){const f=c[0]-a[0],y=c[1]-a[1],w=c[0]-u[0],T=c[1]-u[1];return f*T-w*y==0&&f*w<=0&&y*T<=0}function th(c,a){let u=!1;for(let T=0,E=a.length;T<E;T++){const I=a[T];for(let z=0,j=I.length;z<j-1;z++){if(ov(c,I[z],I[z+1]))return!1;(y=I[z])[1]>(f=c)[1]!=(w=I[z+1])[1]>f[1]&&f[0]<(w[0]-y[0])*(f[1]-y[1])/(w[1]-y[1])+y[0]&&(u=!u)}}var f,y,w;return u}function im(c,a){for(let u=0;u<a.length;u++)if(th(c,a[u]))return!0;return!1}function rm(c,a,u,f){const y=f[0]-u[0],w=f[1]-u[1],T=(c[0]-u[0])*w-y*(c[1]-u[1]),E=(a[0]-u[0])*w-y*(a[1]-u[1]);return T>0&&E<0||T<0&&E>0}function lv(c,a,u){for(const z of u)for(let j=0;j<z.length-1;++j)if((E=[(T=z[j+1])[0]-(w=z[j])[0],T[1]-w[1]])[0]*(I=[(y=a)[0]-(f=c)[0],y[1]-f[1]])[1]-E[1]*I[0]!=0&&rm(f,y,w,T)&&rm(w,T,f,y))return!0;var f,y,w,T,E,I;return!1}function am(c,a){for(let u=0;u<c.length;++u)if(!th(c[u],a))return!1;for(let u=0;u<c.length-1;++u)if(lv(c[u],c[u+1],a))return!1;return!0}function cv(c,a){for(let u=0;u<a.length;u++)if(am(c,a[u]))return!0;return!1}function nh(c,a,u){const f=[];for(let y=0;y<c.length;y++){const w=[];for(let T=0;T<c[y].length;T++){const E=nm(c[y][T],u);ff(a,E),w.push(E)}f.push(w)}return f}function pf(c,a,u){const f=[];for(let y=0;y<c.length;y++){const w=nh(c[y],a,u);f.push(w)}return f}function sm(c,a,u,f){if(c[0]<u[0]||c[0]>u[2]){const y=.5*f;let w=c[0]-u[0]>y?-f:u[0]-c[0]>y?f:0;w===0&&(w=c[0]-u[2]>y?-f:u[2]-c[0]>y?f:0),c[0]+=w}ff(a,c)}function om(c,a,u,f){const y=Math.pow(2,f.z)*ss,w=[f.x*ss,f.y*ss],T=[];for(const E of c)for(const I of E){const z=[I.x+w[0],I.y+w[1]];sm(z,a,u,y),T.push(z)}return T}function ih(c,a,u,f){const y=Math.pow(2,f.z)*ss,w=[f.x*ss,f.y*ss],T=[];for(const I of c){const z=[];for(const j of I){const W=[j.x+w[0],j.y+w[1]];ff(a,W),z.push(W)}T.push(z)}if(a[2]-a[0]<=y/2){(E=a)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const I of T)for(const z of I)sm(z,a,u,y)}var E;return T}class ko{constructor(a,u){this.type=jt,this.geojson=a,this.geometries=u}static parse(a,u){if(a.length!==2)return u.error(`'within' expression requires exactly one argument, but found ${a.length-1} instead.`);if(oi(a[1])){const f=a[1];if(f.type==="FeatureCollection"){const y=[];for(const w of f.features){const{type:T,coordinates:E}=w.geometry;T==="Polygon"&&y.push(E),T==="MultiPolygon"&&y.push(...E)}if(y.length)return new ko(f,{type:"MultiPolygon",coordinates:y})}else if(f.type==="Feature"){const y=f.geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new ko(f,f.geometry)}else if(f.type==="Polygon"||f.type==="MultiPolygon")return new ko(f,f)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(a){if(a.geometry()!=null&&a.canonicalID()!=null){if(a.geometryType()==="Point")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const E=nh(f.coordinates,w,T),I=om(u.geometry(),y,w,T);if(!qc(y,w))return!1;for(const z of I)if(!th(z,E))return!1}if(f.type==="MultiPolygon"){const E=pf(f.coordinates,w,T),I=om(u.geometry(),y,w,T);if(!qc(y,w))return!1;for(const z of I)if(!im(z,E))return!1}return!0}(a,this.geometries);if(a.geometryType()==="LineString")return function(u,f){const y=[1/0,1/0,-1/0,-1/0],w=[1/0,1/0,-1/0,-1/0],T=u.canonicalID();if(f.type==="Polygon"){const E=nh(f.coordinates,w,T),I=ih(u.geometry(),y,w,T);if(!qc(y,w))return!1;for(const z of I)if(!am(z,E))return!1}if(f.type==="MultiPolygon"){const E=pf(f.coordinates,w,T),I=ih(u.geometry(),y,w,T);if(!qc(y,w))return!1;for(const z of I)if(!cv(z,E))return!1}return!0}(a,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class rh{constructor(a,u){this.type=u.type,this.name=a,this.boundExpression=u}static parse(a,u){if(a.length!==2||typeof a[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");const f=a[1];return u.scope.has(f)?new rh(f,u.scope.get(f)):u.error(`Unknown variable "${f}". Make sure "${f}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(a){return this.boundExpression.evaluate(a)}eachChild(){}outputDefined(){return!1}}class Ta{constructor(a,u,f,y){this.name=a,this.type=u,this._evaluate=f,this.args=y}evaluate(a){return this._evaluate(a,this.args)}eachChild(a){this.args.forEach(a)}outputDefined(){return!1}static parse(a,u){const f=a[0],y=Ta.definitions[f];if(!y)return u.error(`Unknown expression "${f}". If you wanted a literal array, use ["literal", [...]].`,0);const w=Array.isArray(y)?y[0]:y.type,T=Array.isArray(y)?[[y[1],y[2]]]:y.overloads,E=T.filter(([z])=>!Array.isArray(z)||z.length===a.length-1);let I=null;for(const[z,j]of E){I=new ii(u.registry,$c,u.path,null,u.scope);const W=[];let K=!1;for(let ae=1;ae<a.length;ae++){const oe=a[ae],pe=Array.isArray(z)?z[ae-1]:z.type,be=I.parse(oe,1+W.length,pe);if(!be){K=!0;break}W.push(be)}if(!K)if(Array.isArray(z)&&z.length!==W.length)I.error(`Expected ${z.length} arguments, but found ${W.length} instead.`);else{for(let ae=0;ae<W.length;ae++){const oe=Array.isArray(z)?z[ae]:z.type,pe=W[ae];I.concat(ae+1).checkSubtype(oe,pe.type)}if(I.errors.length===0)return new Ta(f,w,j,W)}}if(E.length===1)u.errors.push(...I.errors);else{const z=(E.length?E:T).map(([W])=>{return K=W,Array.isArray(K)?`(${K.map(ne).join(", ")})`:`(${ne(K.type)}...)`;var K}).join(" | "),j=[];for(let W=1;W<a.length;W++){const K=u.parse(a[W],1+j.length);if(!K)return null;j.push(ne(K.type))}u.error(`Expected arguments of type ${z}, but found (${j.join(", ")}) instead.`)}return null}static register(a,u){Ta.definitions=u;for(const f in u)a[f]=Ta}}function $c(c){if(c instanceof rh)return $c(c.boundExpression);if(c instanceof Ta&&c.name==="error"||c instanceof eh||c instanceof ko)return!1;const a=c instanceof Li||c instanceof Ji;let u=!0;return c.eachChild(f=>{u=a?u&&$c(f):u&&f instanceof sa}),!!u&&Xc(c)&&ah(c,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Xc(c){if(c instanceof Ta&&(c.name==="get"&&c.args.length===1||c.name==="feature-state"||c.name==="has"&&c.args.length===1||c.name==="properties"||c.name==="geometry-type"||c.name==="id"||/^filter-/.test(c.name))||c instanceof ko)return!1;let a=!0;return c.eachChild(u=>{a&&!Xc(u)&&(a=!1)}),a}function Zc(c){if(c instanceof Ta&&c.name==="feature-state")return!1;let a=!0;return c.eachChild(u=>{a&&!Zc(u)&&(a=!1)}),a}function ah(c,a){if(c instanceof Ta&&a.indexOf(c.name)>=0)return!1;let u=!0;return c.eachChild(f=>{u&&!ah(f,a)&&(u=!1)}),u}function Yc(c,a){const u=c.length-1;let f,y,w=0,T=u,E=0;for(;w<=T;)if(E=Math.floor((w+T)/2),f=c[E],y=c[E+1],f<=a){if(E===u||a<y)return E;w=E+1}else{if(!(f>a))throw new xi("Input is not a number.");T=E-1}return 0}class Cl{constructor(a,u,f){this.type=a,this.input=u,this.labels=[],this.outputs=[];for(const[y,w]of f)this.labels.push(y),this.outputs.push(w)}static parse(a,u){if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");const f=u.parse(a[1],1,dt);if(!f)return null;const y=[];let w=null;u.expectedType&&u.expectedType.kind!=="value"&&(w=u.expectedType);for(let T=1;T<a.length;T+=2){const E=T===1?-1/0:a[T],I=a[T+1],z=T,j=T+1;if(typeof E!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(y.length&&y[y.length-1][0]>=E)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',z);const W=u.parse(I,j,w);if(!W)return null;w=w||W.type,y.push([E,W])}return new Cl(w,f,y)}evaluate(a){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return f[0].evaluate(a);const w=u.length;return y>=u[w-1]?f[w-1].evaluate(a):f[Yc(u,y)].evaluate(a)}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function uv(c){return c&&c.__esModule&&Object.prototype.hasOwnProperty.call(c,"default")?c.default:c}var hv=lm;function lm(c,a,u,f){this.cx=3*c,this.bx=3*(u-c)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(f-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=c,this.p1y=a,this.p2x=u,this.p2y=f}lm.prototype={sampleCurveX:function(c){return((this.ax*c+this.bx)*c+this.cx)*c},sampleCurveY:function(c){return((this.ay*c+this.by)*c+this.cy)*c},sampleCurveDerivativeX:function(c){return(3*this.ax*c+2*this.bx)*c+this.cx},solveCurveX:function(c,a){if(a===void 0&&(a=1e-6),c<0)return 0;if(c>1)return 1;for(var u=c,f=0;f<8;f++){var y=this.sampleCurveX(u)-c;if(Math.abs(y)<a)return u;var w=this.sampleCurveDerivativeX(u);if(Math.abs(w)<1e-6)break;u-=y/w}var T=0,E=1;for(u=c,f=0;f<20&&(y=this.sampleCurveX(u),!(Math.abs(y-c)<a));f++)c>y?T=u:E=u,u=.5*(E-T)+T;return u},solve:function(c,a){return this.sampleCurveY(this.solveCurveX(c,a))}};var dv=uv(hv);function Do(c,a,u){return c+u*(a-c)}function sh(c,a,u){return c.map((f,y)=>Do(f,a[y],u))}const oa={number:Do,color:function(c,a,u,f="rgb"){switch(f){case"rgb":{const[y,w,T,E]=sh(c.rgb,a.rgb,u);return new Xt(y,w,T,E,!1)}case"hcl":{const[y,w,T,E]=c.hcl,[I,z,j,W]=a.hcl;let K,ae;if(isNaN(y)||isNaN(I))isNaN(y)?isNaN(I)?K=NaN:(K=I,T!==1&&T!==0||(ae=z)):(K=y,j!==1&&j!==0||(ae=w));else{let Ve=I-y;I>y&&Ve>180?Ve-=360:I<y&&y-I>180&&(Ve+=360),K=y+u*Ve}const[oe,pe,be,Pe]=function([Ve,ke,Ne,ht]){return Ve=isNaN(Ve)?0:Ve*bn,We([Ne,Math.cos(Ve)*ke,Math.sin(Ve)*ke,ht])}([K,ae??Do(w,z,u),Do(T,j,u),Do(E,W,u)]);return new Xt(oe,pe,be,Pe,!1)}case"lab":{const[y,w,T,E]=We(sh(c.lab,a.lab,u));return new Xt(y,w,T,E,!1)}}},array:sh,padding:function(c,a,u){return new ci(sh(c.values,a.values,u))},variableAnchorOffsetCollection:function(c,a,u){const f=c.values,y=a.values;if(f.length!==y.length)throw new xi(`Cannot interpolate values of different length. from: ${c.toString()}, to: ${a.toString()}`);const w=[];for(let T=0;T<f.length;T+=2){if(f[T]!==y[T])throw new xi(`Cannot interpolate values containing mismatched anchors. from[${T}]: ${f[T]}, to[${T}]: ${y[T]}`);w.push(f[T]);const[E,I]=f[T+1],[z,j]=y[T+1];w.push([Do(E,z,u),Do(I,j,u)])}return new Wn(w)}};class Lr{constructor(a,u,f,y,w){this.type=a,this.operator=u,this.interpolation=f,this.input=y,this.labels=[],this.outputs=[];for(const[T,E]of w)this.labels.push(T),this.outputs.push(E)}static interpolationFactor(a,u,f,y){let w=0;if(a.name==="exponential")w=Pl(u,a.base,f,y);else if(a.name==="linear")w=Pl(u,1,f,y);else if(a.name==="cubic-bezier"){const T=a.controlPoints;w=new dv(T[0],T[1],T[2],T[3]).solve(Pl(u,1,f,y))}return w}static parse(a,u){let[f,y,w,...T]=a;if(!Array.isArray(y)||y.length===0)return u.error("Expected an interpolation type expression.",1);if(y[0]==="linear")y={name:"linear"};else if(y[0]==="exponential"){const z=y[1];if(typeof z!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);y={name:"exponential",base:z}}else{if(y[0]!=="cubic-bezier")return u.error(`Unknown interpolation type ${String(y[0])}`,1,0);{const z=y.slice(1);if(z.length!==4||z.some(j=>typeof j!="number"||j<0||j>1))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);y={name:"cubic-bezier",controlPoints:z}}}if(a.length-1<4)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if((a.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(w=u.parse(w,2,dt),!w)return null;const E=[];let I=null;f==="interpolate-hcl"||f==="interpolate-lab"?I=Jt:u.expectedType&&u.expectedType.kind!=="value"&&(I=u.expectedType);for(let z=0;z<T.length;z+=2){const j=T[z],W=T[z+1],K=z+3,ae=z+4;if(typeof j!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',K);if(E.length&&E[E.length-1][0]>=j)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',K);const oe=u.parse(W,ae,I);if(!oe)return null;I=I||oe.type,E.push([j,oe])}return Re(I,dt)||Re(I,Jt)||Re(I,ce)||Re(I,U)||Re(I,q(dt))?new Lr(I,f,y,w,E):u.error(`Type ${ne(I)} is not interpolatable.`)}evaluate(a){const u=this.labels,f=this.outputs;if(u.length===1)return f[0].evaluate(a);const y=this.input.evaluate(a);if(y<=u[0])return f[0].evaluate(a);const w=u.length;if(y>=u[w-1])return f[w-1].evaluate(a);const T=Yc(u,y),E=Lr.interpolationFactor(this.interpolation,y,u[T],u[T+1]),I=f[T].evaluate(a),z=f[T+1].evaluate(a);switch(this.operator){case"interpolate":return oa[this.type.kind](I,z,E);case"interpolate-hcl":return oa.color(I,z,E,"hcl");case"interpolate-lab":return oa.color(I,z,E,"lab")}}eachChild(a){a(this.input);for(const u of this.outputs)a(u)}outputDefined(){return this.outputs.every(a=>a.outputDefined())}}function Pl(c,a,u,f){const y=f-u,w=c-u;return y===0?0:a===1?w/y:(Math.pow(a,w)-1)/(Math.pow(a,y)-1)}class ri{constructor(a,u){this.type=a,this.args=u}static parse(a,u){if(a.length<2)return u.error("Expectected at least one argument.");let f=null;const y=u.expectedType;y&&y.kind!=="value"&&(f=y);const w=[];for(const E of a.slice(1)){const I=u.parse(E,1+w.length,f,void 0,{typeAnnotation:"omit"});if(!I)return null;f=f||I.type,w.push(I)}if(!f)throw new Error("No output type");const T=y&&w.some(E=>Se(y,E.type));return new ri(T?Oe:f,w)}evaluate(a){let u,f=null,y=0;for(const w of this.args)if(y++,f=w.evaluate(a),f&&f instanceof Pn&&!f.available&&(u||(u=f.name),f=null,y===this.args.length&&(f=u)),f!==null)break;return f}eachChild(a){this.args.forEach(a)}outputDefined(){return this.args.every(a=>a.outputDefined())}}class oh{constructor(a,u){this.type=u.type,this.bindings=[].concat(a),this.result=u}evaluate(a){return this.result.evaluate(a)}eachChild(a){for(const u of this.bindings)a(u[1]);a(this.result)}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found ${a.length-1} instead.`);const f=[];for(let w=1;w<a.length-1;w+=2){const T=a[w];if(typeof T!="string")return u.error(`Expected string, but found ${typeof T} instead.`,w);if(/[^a-zA-Z0-9_]/.test(T))return u.error("Variable names must contain only alphanumeric characters or '_'.",w);const E=u.parse(a[w+1],w+1);if(!E)return null;f.push([T,E])}const y=u.parse(a[a.length-1],a.length-1,u.expectedType,f);return y?new oh(f,y):null}outputDefined(){return this.result.outputDefined()}}class mf{constructor(a,u,f){this.type=a,this.index=u,this.input=f}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,dt),y=u.parse(a[2],2,q(u.expectedType||Oe));return f&&y?new mf(y.type.itemType,f,y):null}evaluate(a){const u=this.index.evaluate(a),f=this.input.evaluate(a);if(u<0)throw new xi(`Array index out of bounds: ${u} < 0.`);if(u>=f.length)throw new xi(`Array index out of bounds: ${u} > ${f.length-1}.`);if(u!==Math.floor(u))throw new xi(`Array index must be an integer, but found ${u} instead.`);return f[u]}eachChild(a){a(this.index),a(this.input)}outputDefined(){return!1}}class gf{constructor(a,u){this.type=jt,this.needle=a,this.haystack=u}static parse(a,u){if(a.length!==3)return u.error(`Expected 2 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Oe),y=u.parse(a[2],2,Oe);return f&&y?Ee(f.type,[jt,Ht,dt,Un,Oe])?new gf(f,y):u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`):null}evaluate(a){const u=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!f)return!1;if(!ye(u,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${ne(fi(u))} instead.`);if(!ye(f,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${ne(fi(f))} instead.`);return f.indexOf(u)>=0}eachChild(a){a(this.needle),a(this.haystack)}outputDefined(){return!0}}class lh{constructor(a,u,f){this.type=dt,this.needle=a,this.haystack=u,this.fromIndex=f}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Oe),y=u.parse(a[2],2,Oe);if(!f||!y)return null;if(!Ee(f.type,[jt,Ht,dt,Un,Oe]))return u.error(`Expected first argument to be of type boolean, string, number or null, but found ${ne(f.type)} instead`);if(a.length===4){const w=u.parse(a[3],3,dt);return w?new lh(f,y,w):null}return new lh(f,y)}evaluate(a){const u=this.needle.evaluate(a),f=this.haystack.evaluate(a);if(!ye(u,["boolean","string","number","null"]))throw new xi(`Expected first argument to be of type boolean, string, number or null, but found ${ne(fi(u))} instead.`);if(!ye(f,["string","array"]))throw new xi(`Expected second argument to be of type array or string, but found ${ne(fi(f))} instead.`);if(this.fromIndex){const y=this.fromIndex.evaluate(a);return f.indexOf(u,y)}return f.indexOf(u)}eachChild(a){a(this.needle),a(this.haystack),this.fromIndex&&a(this.fromIndex)}outputDefined(){return!1}}class yf{constructor(a,u,f,y,w,T){this.inputType=a,this.type=u,this.input=f,this.cases=y,this.outputs=w,this.otherwise=T}static parse(a,u){if(a.length<5)return u.error(`Expected at least 4 arguments, but found only ${a.length-1}.`);if(a.length%2!=1)return u.error("Expected an even number of arguments.");let f,y;u.expectedType&&u.expectedType.kind!=="value"&&(y=u.expectedType);const w={},T=[];for(let z=2;z<a.length-1;z+=2){let j=a[z];const W=a[z+1];Array.isArray(j)||(j=[j]);const K=u.concat(z);if(j.length===0)return K.error("Expected at least one branch label.");for(const oe of j){if(typeof oe!="number"&&typeof oe!="string")return K.error("Branch labels must be numbers or strings.");if(typeof oe=="number"&&Math.abs(oe)>Number.MAX_SAFE_INTEGER)return K.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof oe=="number"&&Math.floor(oe)!==oe)return K.error("Numeric branch labels must be integer values.");if(f){if(K.checkSubtype(f,fi(oe)))return null}else f=fi(oe);if(w[String(oe)]!==void 0)return K.error("Branch labels must be unique.");w[String(oe)]=T.length}const ae=u.parse(W,z,y);if(!ae)return null;y=y||ae.type,T.push(ae)}const E=u.parse(a[1],1,Oe);if(!E)return null;const I=u.parse(a[a.length-1],a.length-1,y);return I?E.type.kind!=="value"&&u.concat(1).checkSubtype(f,E.type)?null:new yf(f,y,E,w,T,I):null}evaluate(a){const u=this.input.evaluate(a);return(fi(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(a)}eachChild(a){a(this.input),this.outputs.forEach(a),a(this.otherwise)}outputDefined(){return this.outputs.every(a=>a.outputDefined())&&this.otherwise.outputDefined()}}class vf{constructor(a,u,f){this.type=a,this.branches=u,this.otherwise=f}static parse(a,u){if(a.length<4)return u.error(`Expected at least 3 arguments, but found only ${a.length-1}.`);if(a.length%2!=0)return u.error("Expected an odd number of arguments.");let f;u.expectedType&&u.expectedType.kind!=="value"&&(f=u.expectedType);const y=[];for(let T=1;T<a.length-1;T+=2){const E=u.parse(a[T],T,jt);if(!E)return null;const I=u.parse(a[T+1],T+1,f);if(!I)return null;y.push([E,I]),f=f||I.type}const w=u.parse(a[a.length-1],a.length-1,f);if(!w)return null;if(!f)throw new Error("Can't infer output type");return new vf(f,y,w)}evaluate(a){for(const[u,f]of this.branches)if(u.evaluate(a))return f.evaluate(a);return this.otherwise.evaluate(a)}eachChild(a){for(const[u,f]of this.branches)a(u),a(f);a(this.otherwise)}outputDefined(){return this.branches.every(([a,u])=>u.outputDefined())&&this.otherwise.outputDefined()}}class ch{constructor(a,u,f,y){this.type=a,this.input=u,this.beginIndex=f,this.endIndex=y}static parse(a,u){if(a.length<=2||a.length>=5)return u.error(`Expected 3 or 4 arguments, but found ${a.length-1} instead.`);const f=u.parse(a[1],1,Oe),y=u.parse(a[2],2,dt);if(!f||!y)return null;if(!Ee(f.type,[q(Oe),Ht,Oe]))return u.error(`Expected first argument to be of type array or string, but found ${ne(f.type)} instead`);if(a.length===4){const w=u.parse(a[3],3,dt);return w?new ch(f.type,f,y,w):null}return new ch(f.type,f,y)}evaluate(a){const u=this.input.evaluate(a),f=this.beginIndex.evaluate(a);if(!ye(u,["string","array"]))throw new xi(`Expected first argument to be of type array or string, but found ${ne(fi(u))} instead.`);if(this.endIndex){const y=this.endIndex.evaluate(a);return u.slice(f,y)}return u.slice(f)}eachChild(a){a(this.input),a(this.beginIndex),this.endIndex&&a(this.endIndex)}outputDefined(){return!1}}function cm(c,a){return c==="=="||c==="!="?a.kind==="boolean"||a.kind==="string"||a.kind==="number"||a.kind==="null"||a.kind==="value":a.kind==="string"||a.kind==="number"||a.kind==="value"}function um(c,a,u,f){return f.compare(a,u)===0}function Rl(c,a,u){const f=c!=="=="&&c!=="!=";return class Y7{constructor(w,T,E){this.type=jt,this.lhs=w,this.rhs=T,this.collator=E,this.hasUntypedArgument=w.type.kind==="value"||T.type.kind==="value"}static parse(w,T){if(w.length!==3&&w.length!==4)return T.error("Expected two or three arguments.");const E=w[0];let I=T.parse(w[1],1,Oe);if(!I)return null;if(!cm(E,I.type))return T.concat(1).error(`"${E}" comparisons are not supported for type '${ne(I.type)}'.`);let z=T.parse(w[2],2,Oe);if(!z)return null;if(!cm(E,z.type))return T.concat(2).error(`"${E}" comparisons are not supported for type '${ne(z.type)}'.`);if(I.type.kind!==z.type.kind&&I.type.kind!=="value"&&z.type.kind!=="value")return T.error(`Cannot compare types '${ne(I.type)}' and '${ne(z.type)}'.`);f&&(I.type.kind==="value"&&z.type.kind!=="value"?I=new Ji(z.type,[I]):I.type.kind!=="value"&&z.type.kind==="value"&&(z=new Ji(I.type,[z])));let j=null;if(w.length===4){if(I.type.kind!=="string"&&z.type.kind!=="string"&&I.type.kind!=="value"&&z.type.kind!=="value")return T.error("Cannot use collator to compare non-string types.");if(j=T.parse(w[3],3,pt),!j)return null}return new Y7(I,z,j)}evaluate(w){const T=this.lhs.evaluate(w),E=this.rhs.evaluate(w);if(f&&this.hasUntypedArgument){const I=fi(T),z=fi(E);if(I.kind!==z.kind||I.kind!=="string"&&I.kind!=="number")throw new xi(`Expected arguments for "${c}" to be (string, string) or (number, number), but found (${I.kind}, ${z.kind}) instead.`)}if(this.collator&&!f&&this.hasUntypedArgument){const I=fi(T),z=fi(E);if(I.kind!=="string"||z.kind!=="string")return a(w,T,E)}return this.collator?u(w,T,E,this.collator.evaluate(w)):a(w,T,E)}eachChild(w){w(this.lhs),w(this.rhs),this.collator&&w(this.collator)}outputDefined(){return!0}}}const fv=Rl("==",function(c,a,u){return a===u},um),pv=Rl("!=",function(c,a,u){return a!==u},function(c,a,u,f){return!um(0,a,u,f)}),mv=Rl("<",function(c,a,u){return a<u},function(c,a,u,f){return f.compare(a,u)<0}),gv=Rl(">",function(c,a,u){return a>u},function(c,a,u,f){return f.compare(a,u)>0}),yv=Rl("<=",function(c,a,u){return a<=u},function(c,a,u,f){return f.compare(a,u)<=0}),vv=Rl(">=",function(c,a,u){return a>=u},function(c,a,u,f){return f.compare(a,u)>=0});class _f{constructor(a,u,f,y,w){this.type=Ht,this.number=a,this.locale=u,this.currency=f,this.minFractionDigits=y,this.maxFractionDigits=w}static parse(a,u){if(a.length!==3)return u.error("Expected two arguments.");const f=u.parse(a[1],1,dt);if(!f)return null;const y=a[2];if(typeof y!="object"||Array.isArray(y))return u.error("NumberFormat options argument must be an object.");let w=null;if(y.locale&&(w=u.parse(y.locale,1,Ht),!w))return null;let T=null;if(y.currency&&(T=u.parse(y.currency,1,Ht),!T))return null;let E=null;if(y["min-fraction-digits"]&&(E=u.parse(y["min-fraction-digits"],1,dt),!E))return null;let I=null;return y["max-fraction-digits"]&&(I=u.parse(y["max-fraction-digits"],1,dt),!I)?null:new _f(f,w,T,E,I)}evaluate(a){return new Intl.NumberFormat(this.locale?this.locale.evaluate(a):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(a):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(a):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(a):void 0}).format(this.number.evaluate(a))}eachChild(a){a(this.number),this.locale&&a(this.locale),this.currency&&a(this.currency),this.minFractionDigits&&a(this.minFractionDigits),this.maxFractionDigits&&a(this.maxFractionDigits)}outputDefined(){return!1}}class uh{constructor(a){this.type=Dt,this.sections=a}static parse(a,u){if(a.length<2)return u.error("Expected at least one argument.");const f=a[1];if(!Array.isArray(f)&&typeof f=="object")return u.error("First argument must be an image or text section.");const y=[];let w=!1;for(let T=1;T<=a.length-1;++T){const E=a[T];if(w&&typeof E=="object"&&!Array.isArray(E)){w=!1;let I=null;if(E["font-scale"]&&(I=u.parse(E["font-scale"],1,dt),!I))return null;let z=null;if(E["text-font"]&&(z=u.parse(E["text-font"],1,q(Ht)),!z))return null;let j=null;if(E["text-color"]&&(j=u.parse(E["text-color"],1,Jt),!j))return null;const W=y[y.length-1];W.scale=I,W.font=z,W.textColor=j}else{const I=u.parse(a[T],1,Oe);if(!I)return null;const z=I.type.kind;if(z!=="string"&&z!=="value"&&z!=="null"&&z!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");w=!0,y.push({content:I,scale:null,font:null,textColor:null})}}return new uh(y)}evaluate(a){return new gi(this.sections.map(u=>{const f=u.content.evaluate(a);return fi(f)===B?new Ei("",f,null,null,null):new Ei(Qs(f),null,u.scale?u.scale.evaluate(a):null,u.font?u.font.evaluate(a).join(","):null,u.textColor?u.textColor.evaluate(a):null)}))}eachChild(a){for(const u of this.sections)a(u.content),u.scale&&a(u.scale),u.font&&a(u.font),u.textColor&&a(u.textColor)}outputDefined(){return!1}}class xf{constructor(a){this.type=B,this.input=a}static parse(a,u){if(a.length!==2)return u.error("Expected two arguments.");const f=u.parse(a[1],1,Ht);return f?new xf(f):u.error("No image name provided.")}evaluate(a){const u=this.input.evaluate(a),f=Pn.fromString(u);return f&&a.availableImages&&(f.available=a.availableImages.indexOf(u)>-1),f}eachChild(a){a(this.input)}outputDefined(){return!1}}class bf{constructor(a){this.type=dt,this.input=a}static parse(a,u){if(a.length!==2)return u.error(`Expected 1 argument, but found ${a.length-1} instead.`);const f=u.parse(a[1],1);return f?f.type.kind!=="array"&&f.type.kind!=="string"&&f.type.kind!=="value"?u.error(`Expected argument of type string or array, but found ${ne(f.type)} instead.`):new bf(f):null}evaluate(a){const u=this.input.evaluate(a);if(typeof u=="string"||Array.isArray(u))return u.length;throw new xi(`Expected value to be of type string or array, but found ${ne(fi(u))} instead.`)}eachChild(a){a(this.input)}outputDefined(){return!1}}const Il={"==":fv,"!=":pv,">":gv,"<":mv,">=":vv,"<=":yv,array:Ji,at:mf,boolean:Ji,case:vf,coalesce:ri,collator:eh,format:uh,image:xf,in:gf,"index-of":lh,interpolate:Lr,"interpolate-hcl":Lr,"interpolate-lab":Lr,length:bf,let:oh,literal:sa,match:yf,number:Ji,"number-format":_f,object:Ji,slice:ch,step:Cl,string:Ji,"to-boolean":Li,"to-color":Li,"to-number":Li,"to-string":Li,var:rh,within:ko};function hm(c,[a,u,f,y]){a=a.evaluate(c),u=u.evaluate(c),f=f.evaluate(c);const w=y?y.evaluate(c):1,T=Al(a,u,f,w);if(T)throw new xi(T);return new Xt(a/255,u/255,f/255,w,!1)}function dm(c,a){return c in a}function wf(c,a){const u=a[c];return u===void 0?null:u}function Lo(c){return{type:c}}function fm(c){return{result:"success",value:c}}function kl(c){return{result:"error",value:c}}function Dl(c){return c["property-type"]==="data-driven"||c["property-type"]==="cross-faded-data-driven"}function pm(c){return!!c.expression&&c.expression.parameters.indexOf("zoom")>-1}function Sf(c){return!!c.expression&&c.expression.interpolated}function ai(c){return c instanceof Number?"number":c instanceof String?"string":c instanceof Boolean?"boolean":Array.isArray(c)?"array":c===null?"null":typeof c}function Ll(c){return typeof c=="object"&&c!==null&&!Array.isArray(c)}function _v(c){return c}function mm(c,a){const u=a.type==="color",f=c.stops&&typeof c.stops[0][0]=="object",y=f||!(f||c.property!==void 0),w=c.type||(Sf(a)?"exponential":"interval");if(u||a.type==="padding"){const j=u?Xt.parse:ci.parse;(c=tn({},c)).stops&&(c.stops=c.stops.map(W=>[W[0],j(W[1])])),c.default=j(c.default?c.default:a.default)}if(c.colorSpace&&(T=c.colorSpace)!=="rgb"&&T!=="hcl"&&T!=="lab")throw new Error(`Unknown color space: "${c.colorSpace}"`);var T;let E,I,z;if(w==="exponential")E=gm;else if(w==="interval")E=ji;else if(w==="categorical"){E=xv,I=Object.create(null);for(const j of c.stops)I[j[0]]=j[1];z=typeof c.stops[0][0]}else{if(w!=="identity")throw new Error(`Unknown function type "${w}"`);E=ti}if(f){const j={},W=[];for(let oe=0;oe<c.stops.length;oe++){const pe=c.stops[oe],be=pe[0].zoom;j[be]===void 0&&(j[be]={zoom:be,type:c.type,property:c.property,default:c.default,stops:[]},W.push(be)),j[be].stops.push([pe[0].value,pe[1]])}const K=[];for(const oe of W)K.push([j[oe].zoom,mm(j[oe],a)]);const ae={name:"linear"};return{kind:"composite",interpolationType:ae,interpolationFactor:Lr.interpolationFactor.bind(void 0,ae),zoomStops:K.map(oe=>oe[0]),evaluate:({zoom:oe},pe)=>gm({stops:K,base:c.base},a,oe).evaluate(oe,pe)}}if(y){const j=w==="exponential"?{name:"exponential",base:c.base!==void 0?c.base:1}:null;return{kind:"camera",interpolationType:j,interpolationFactor:Lr.interpolationFactor.bind(void 0,j),zoomStops:c.stops.map(W=>W[0]),evaluate:({zoom:W})=>E(c,a,W,I,z)}}return{kind:"source",evaluate(j,W){const K=W&&W.properties?W.properties[c.property]:void 0;return K===void 0?Kc(c.default,a.default):E(c,a,K,I,z)}}}function Kc(c,a,u){return c!==void 0?c:a!==void 0?a:u!==void 0?u:void 0}function xv(c,a,u,f,y){return Kc(typeof u===y?f[u]:void 0,c.default,a.default)}function ji(c,a,u){if(ai(u)!=="number")return Kc(c.default,a.default);const f=c.stops.length;if(f===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[f-1][0])return c.stops[f-1][1];const y=Yc(c.stops.map(w=>w[0]),u);return c.stops[y][1]}function gm(c,a,u){const f=c.base!==void 0?c.base:1;if(ai(u)!=="number")return Kc(c.default,a.default);const y=c.stops.length;if(y===1||u<=c.stops[0][0])return c.stops[0][1];if(u>=c.stops[y-1][0])return c.stops[y-1][1];const w=Yc(c.stops.map(j=>j[0]),u),T=function(j,W,K,ae){const oe=ae-K,pe=j-K;return oe===0?0:W===1?pe/oe:(Math.pow(W,pe)-1)/(Math.pow(W,oe)-1)}(u,f,c.stops[w][0],c.stops[w+1][0]),E=c.stops[w][1],I=c.stops[w+1][1],z=oa[a.type]||_v;return typeof E.evaluate=="function"?{evaluate(...j){const W=E.evaluate.apply(void 0,j),K=I.evaluate.apply(void 0,j);if(W!==void 0&&K!==void 0)return z(W,K,T,c.colorSpace)}}:z(E,I,T,c.colorSpace)}function ti(c,a,u){switch(a.type){case"color":u=Xt.parse(u);break;case"formatted":u=gi.fromString(u.toString());break;case"resolvedImage":u=Pn.fromString(u.toString());break;case"padding":u=ci.parse(u);break;default:ai(u)===a.type||a.type==="enum"&&a.values[u]||(u=void 0)}return Kc(u,c.default,a.default)}Ta.register(Il,{error:[{kind:"error"},[Ht],(c,[a])=>{throw new xi(a.evaluate(c))}],typeof:[Ht,[Oe],(c,[a])=>ne(fi(a.evaluate(c)))],"to-rgba":[q(dt,4),[Jt],(c,[a])=>{const[u,f,y,w]=a.evaluate(c).rgb;return[255*u,255*f,255*y,w]}],rgb:[Jt,[dt,dt,dt],hm],rgba:[Jt,[dt,dt,dt,dt],hm],has:{type:jt,overloads:[[[Ht],(c,[a])=>dm(a.evaluate(c),c.properties())],[[Ht,X],(c,[a,u])=>dm(a.evaluate(c),u.evaluate(c))]]},get:{type:Oe,overloads:[[[Ht],(c,[a])=>wf(a.evaluate(c),c.properties())],[[Ht,X],(c,[a,u])=>wf(a.evaluate(c),u.evaluate(c))]]},"feature-state":[Oe,[Ht],(c,[a])=>wf(a.evaluate(c),c.featureState||{})],properties:[X,[],c=>c.properties()],"geometry-type":[Ht,[],c=>c.geometryType()],id:[Oe,[],c=>c.id()],zoom:[dt,[],c=>c.globals.zoom],"heatmap-density":[dt,[],c=>c.globals.heatmapDensity||0],"line-progress":[dt,[],c=>c.globals.lineProgress||0],accumulated:[Oe,[],c=>c.globals.accumulated===void 0?null:c.globals.accumulated],"+":[dt,Lo(dt),(c,a)=>{let u=0;for(const f of a)u+=f.evaluate(c);return u}],"*":[dt,Lo(dt),(c,a)=>{let u=1;for(const f of a)u*=f.evaluate(c);return u}],"-":{type:dt,overloads:[[[dt,dt],(c,[a,u])=>a.evaluate(c)-u.evaluate(c)],[[dt],(c,[a])=>-a.evaluate(c)]]},"/":[dt,[dt,dt],(c,[a,u])=>a.evaluate(c)/u.evaluate(c)],"%":[dt,[dt,dt],(c,[a,u])=>a.evaluate(c)%u.evaluate(c)],ln2:[dt,[],()=>Math.LN2],pi:[dt,[],()=>Math.PI],e:[dt,[],()=>Math.E],"^":[dt,[dt,dt],(c,[a,u])=>Math.pow(a.evaluate(c),u.evaluate(c))],sqrt:[dt,[dt],(c,[a])=>Math.sqrt(a.evaluate(c))],log10:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN10],ln:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))],log2:[dt,[dt],(c,[a])=>Math.log(a.evaluate(c))/Math.LN2],sin:[dt,[dt],(c,[a])=>Math.sin(a.evaluate(c))],cos:[dt,[dt],(c,[a])=>Math.cos(a.evaluate(c))],tan:[dt,[dt],(c,[a])=>Math.tan(a.evaluate(c))],asin:[dt,[dt],(c,[a])=>Math.asin(a.evaluate(c))],acos:[dt,[dt],(c,[a])=>Math.acos(a.evaluate(c))],atan:[dt,[dt],(c,[a])=>Math.atan(a.evaluate(c))],min:[dt,Lo(dt),(c,a)=>Math.min(...a.map(u=>u.evaluate(c)))],max:[dt,Lo(dt),(c,a)=>Math.max(...a.map(u=>u.evaluate(c)))],abs:[dt,[dt],(c,[a])=>Math.abs(a.evaluate(c))],round:[dt,[dt],(c,[a])=>{const u=a.evaluate(c);return u<0?-Math.round(-u):Math.round(u)}],floor:[dt,[dt],(c,[a])=>Math.floor(a.evaluate(c))],ceil:[dt,[dt],(c,[a])=>Math.ceil(a.evaluate(c))],"filter-==":[jt,[Ht,Oe],(c,[a,u])=>c.properties()[a.value]===u.value],"filter-id-==":[jt,[Oe],(c,[a])=>c.id()===a.value],"filter-type-==":[jt,[Ht],(c,[a])=>c.geometryType()===a.value],"filter-<":[jt,[Ht,Oe],(c,[a,u])=>{const f=c.properties()[a.value],y=u.value;return typeof f==typeof y&&f<y}],"filter-id-<":[jt,[Oe],(c,[a])=>{const u=c.id(),f=a.value;return typeof u==typeof f&&u<f}],"filter->":[jt,[Ht,Oe],(c,[a,u])=>{const f=c.properties()[a.value],y=u.value;return typeof f==typeof y&&f>y}],"filter-id->":[jt,[Oe],(c,[a])=>{const u=c.id(),f=a.value;return typeof u==typeof f&&u>f}],"filter-<=":[jt,[Ht,Oe],(c,[a,u])=>{const f=c.properties()[a.value],y=u.value;return typeof f==typeof y&&f<=y}],"filter-id-<=":[jt,[Oe],(c,[a])=>{const u=c.id(),f=a.value;return typeof u==typeof f&&u<=f}],"filter->=":[jt,[Ht,Oe],(c,[a,u])=>{const f=c.properties()[a.value],y=u.value;return typeof f==typeof y&&f>=y}],"filter-id->=":[jt,[Oe],(c,[a])=>{const u=c.id(),f=a.value;return typeof u==typeof f&&u>=f}],"filter-has":[jt,[Oe],(c,[a])=>a.value in c.properties()],"filter-has-id":[jt,[],c=>c.id()!==null&&c.id()!==void 0],"filter-type-in":[jt,[q(Ht)],(c,[a])=>a.value.indexOf(c.geometryType())>=0],"filter-id-in":[jt,[q(Oe)],(c,[a])=>a.value.indexOf(c.id())>=0],"filter-in-small":[jt,[Ht,q(Oe)],(c,[a,u])=>u.value.indexOf(c.properties()[a.value])>=0],"filter-in-large":[jt,[Ht,q(Oe)],(c,[a,u])=>function(f,y,w,T){for(;w<=T;){const E=w+T>>1;if(y[E]===f)return!0;y[E]>f?T=E-1:w=E+1}return!1}(c.properties()[a.value],u.value,0,u.value.length-1)],all:{type:jt,overloads:[[[jt,jt],(c,[a,u])=>a.evaluate(c)&&u.evaluate(c)],[Lo(jt),(c,a)=>{for(const u of a)if(!u.evaluate(c))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],(c,[a,u])=>a.evaluate(c)||u.evaluate(c)],[Lo(jt),(c,a)=>{for(const u of a)if(u.evaluate(c))return!0;return!1}]]},"!":[jt,[jt],(c,[a])=>!a.evaluate(c)],"is-supported-script":[jt,[Ht],(c,[a])=>{const u=c.globals&&c.globals.isSupportedScript;return!u||u(a.evaluate(c))}],upcase:[Ht,[Ht],(c,[a])=>a.evaluate(c).toUpperCase()],downcase:[Ht,[Ht],(c,[a])=>a.evaluate(c).toLowerCase()],concat:[Ht,Lo(Oe),(c,a)=>a.map(u=>Qs(u.evaluate(c))).join("")],"resolved-locale":[Ht,[pt],(c,[a])=>a.evaluate(c).resolvedLocale()]});class Jc{constructor(a,u){var f;this.expression=a,this._warningHistory={},this._evaluator=new to,this._defaultValue=u?(f=u).type==="color"&&Ll(f.default)?new Xt(0,0,0,0):f.type==="color"?Xt.parse(f.default)||null:f.type==="padding"?ci.parse(f.default)||null:f.type==="variableAnchorOffsetCollection"?Wn.parse(f.default)||null:f.default===void 0?null:f.default:null,this._enumValues=u&&u.type==="enum"?u.values:null}evaluateWithoutErrorHandling(a,u,f,y,w,T){return this._evaluator.globals=a,this._evaluator.feature=u,this._evaluator.featureState=f,this._evaluator.canonical=y,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=T,this.expression.evaluate(this._evaluator)}evaluate(a,u,f,y,w,T){this._evaluator.globals=a,this._evaluator.feature=u||null,this._evaluator.featureState=f||null,this._evaluator.canonical=y,this._evaluator.availableImages=w||null,this._evaluator.formattedSection=T||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new xi(`Expected value to be one of ${Object.keys(this._enumValues).map(I=>JSON.stringify(I)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function yi(c){return Array.isArray(c)&&c.length>0&&typeof c[0]=="string"&&c[0]in Il}function pi(c,a){const u=new ii(Il,$c,[],a?function(y){const w={color:Jt,string:Ht,number:dt,enum:Ht,boolean:jt,formatted:Dt,padding:ce,resolvedImage:B,variableAnchorOffsetCollection:U};return y.type==="array"?q(w[y.value]||Oe,y.length):w[y.type]}(a):void 0),f=u.parse(c,void 0,void 0,void 0,a&&a.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?fm(new Jc(f,a)):kl(u.errors)}class zl{constructor(a,u){this.kind=a,this._styleExpression=u,this.isStateDependent=a!=="constant"&&!Zc(u.expression)}evaluateWithoutErrorHandling(a,u,f,y,w,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,f,y,w,T)}evaluate(a,u,f,y,w,T){return this._styleExpression.evaluate(a,u,f,y,w,T)}}class hh{constructor(a,u,f,y){this.kind=a,this.zoomStops=f,this._styleExpression=u,this.isStateDependent=a!=="camera"&&!Zc(u.expression),this.interpolationType=y}evaluateWithoutErrorHandling(a,u,f,y,w,T){return this._styleExpression.evaluateWithoutErrorHandling(a,u,f,y,w,T)}evaluate(a,u,f,y,w,T){return this._styleExpression.evaluate(a,u,f,y,w,T)}interpolationFactor(a,u,f){return this.interpolationType?Lr.interpolationFactor(this.interpolationType,a,u,f):0}}function ym(c,a){const u=pi(c,a);if(u.result==="error")return u;const f=u.value.expression,y=Xc(f);if(!y&&!Dl(a))return kl([new Kt("","data expressions not supported")]);const w=ah(f,["zoom"]);if(!w&&!pm(a))return kl([new Kt("","zoom expressions not supported")]);const T=fh(f);return T||w?T instanceof Kt?kl([T]):T instanceof Lr&&!Sf(a)?kl([new Kt("",'"interpolate" expressions cannot be used with this property')]):fm(T?new hh(y?"camera":"composite",u.value,T.labels,T instanceof Lr?T.interpolation:void 0):new zl(y?"constant":"source",u.value)):kl([new Kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class dh{constructor(a,u){this._parameters=a,this._specification=u,tn(this,mm(this._parameters,this._specification))}static deserialize(a){return new dh(a._parameters,a._specification)}static serialize(a){return{_parameters:a._parameters,_specification:a._specification}}}function fh(c){let a=null;if(c instanceof oh)a=fh(c.result);else if(c instanceof ri){for(const u of c.args)if(a=fh(u),a)break}else(c instanceof Cl||c instanceof Lr)&&c.input instanceof Ta&&c.input.name==="zoom"&&(a=c);return a instanceof Kt||c.eachChild(u=>{const f=fh(u);f instanceof Kt?a=f:!a&&f?a=new Kt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):a&&f&&a!==f&&(a=new Kt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),a}function Mf(c){if(c===!0||c===!1)return!0;if(!Array.isArray(c)||c.length===0)return!1;switch(c[0]){case"has":return c.length>=2&&c[1]!=="$id"&&c[1]!=="$type";case"in":return c.length>=3&&(typeof c[1]!="string"||Array.isArray(c[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return c.length!==3||Array.isArray(c[1])||Array.isArray(c[2]);case"any":case"all":for(const a of c.slice(1))if(!Mf(a)&&typeof a!="boolean")return!1;return!0;default:return!0}}const vm={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ph(c){if(c==null)return{filter:()=>!0,needGeometry:!1};Mf(c)||(c=Fl(c));const a=pi(c,vm);if(a.result==="error")throw new Error(a.value.map(u=>`${u.key}: ${u.message}`).join(", "));return{filter:(u,f,y)=>a.value.evaluate(u,f,{},y),needGeometry:Tf(c)}}function _m(c,a){return c<a?-1:c>a?1:0}function Tf(c){if(!Array.isArray(c))return!1;if(c[0]==="within")return!0;for(let a=1;a<c.length;a++)if(Tf(c[a]))return!0;return!1}function Fl(c){if(!c)return!0;const a=c[0];return c.length<=1?a!=="any":a==="=="?Ef(c[1],c[2],"=="):a==="!="?mh(Ef(c[1],c[2],"==")):a==="<"||a===">"||a==="<="||a===">="?Ef(c[1],c[2],a):a==="any"?(u=c.slice(1),["any"].concat(u.map(Fl))):a==="all"?["all"].concat(c.slice(1).map(Fl)):a==="none"?["all"].concat(c.slice(1).map(Fl).map(mh)):a==="in"?xm(c[1],c.slice(2)):a==="!in"?mh(xm(c[1],c.slice(2))):a==="has"?bm(c[1]):a==="!has"?mh(bm(c[1])):a!=="within"||c;var u}function Ef(c,a,u){switch(c){case"$type":return[`filter-type-${u}`,a];case"$id":return[`filter-id-${u}`,a];default:return[`filter-${u}`,c,a]}}function xm(c,a){if(a.length===0)return!1;switch(c){case"$type":return["filter-type-in",["literal",a]];case"$id":return["filter-id-in",["literal",a]];default:return a.length>200&&!a.some(u=>typeof u!=typeof a[0])?["filter-in-large",c,["literal",a.sort(_m)]]:["filter-in-small",c,["literal",a]]}}function bm(c){switch(c){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",c]}}function mh(c){return["!",c]}function Af(c){const a=typeof c;if(a==="number"||a==="boolean"||a==="string"||c==null)return JSON.stringify(c);if(Array.isArray(c)){let y="[";for(const w of c)y+=`${Af(w)},`;return`${y}]`}const u=Object.keys(c).sort();let f="{";for(let y=0;y<u.length;y++)f+=`${JSON.stringify(u[y])}:${Af(c[u[y]])},`;return`${f}}`}function bv(c){let a="";for(const u of le)a+=`/${Af(c[u])}`;return a}function wm(c){const a=c.value;return a?[new at(c.key,a,"constants have been deprecated as of v8")]:[]}function Ui(c){return c instanceof Number||c instanceof String||c instanceof Boolean?c.valueOf():c}function no(c){if(Array.isArray(c))return c.map(no);if(c instanceof Object&&!(c instanceof Number||c instanceof String||c instanceof Boolean)){const a={};for(const u in c)a[u]=no(c[u]);return a}return Ui(c)}function la(c){const a=c.key,u=c.value,f=c.valueSpec||{},y=c.objectElementValidators||{},w=c.style,T=c.styleSpec,E=c.validateSpec;let I=[];const z=ai(u);if(z!=="object")return[new at(a,u,`object expected, ${z} found`)];for(const j in u){const W=j.split(".")[0],K=f[W]||f["*"];let ae;if(y[W])ae=y[W];else if(f[W])ae=E;else if(y["*"])ae=y["*"];else{if(!f["*"]){I.push(new at(a,u[j],`unknown property "${j}"`));continue}ae=E}I=I.concat(ae({key:(a&&`${a}.`)+j,value:u[j],valueSpec:K,style:w,styleSpec:T,object:u,objectKey:j,validateSpec:E},u))}for(const j in f)y[j]||f[j].required&&f[j].default===void 0&&u[j]===void 0&&I.push(new at(a,u,`missing required property "${j}"`));return I}function Nl(c){const a=c.value,u=c.valueSpec,f=c.style,y=c.styleSpec,w=c.key,T=c.arrayElementValidator||c.validateSpec;if(ai(a)!=="array")return[new at(w,a,`array expected, ${ai(a)} found`)];if(u.length&&a.length!==u.length)return[new at(w,a,`array length ${u.length} expected, length ${a.length} found`)];if(u["min-length"]&&a.length<u["min-length"])return[new at(w,a,`array length at least ${u["min-length"]} expected, length ${a.length} found`)];let E={type:u.value,values:u.values};y.$version<7&&(E.function=u.function),ai(u.value)==="object"&&(E=u.value);let I=[];for(let z=0;z<a.length;z++)I=I.concat(T({array:a,arrayIndex:z,value:a[z],valueSpec:E,validateSpec:c.validateSpec,style:f,styleSpec:y,key:`${w}[${z}]`}));return I}function Cf(c){const a=c.key,u=c.value,f=c.valueSpec;let y=ai(u);return y==="number"&&u!=u&&(y="NaN"),y!=="number"?[new at(a,u,`number expected, ${y} found`)]:"minimum"in f&&u<f.minimum?[new at(a,u,`${u} is less than the minimum value ${f.minimum}`)]:"maximum"in f&&u>f.maximum?[new at(a,u,`${u} is greater than the maximum value ${f.maximum}`)]:[]}function Pf(c){const a=c.valueSpec,u=Ui(c.value.type);let f,y,w,T={};const E=u!=="categorical"&&c.value.property===void 0,I=!E,z=ai(c.value.stops)==="array"&&ai(c.value.stops[0])==="array"&&ai(c.value.stops[0][0])==="object",j=la({key:c.key,value:c.value,valueSpec:c.styleSpec.function,validateSpec:c.validateSpec,style:c.style,styleSpec:c.styleSpec,objectElementValidators:{stops:function(ae){if(u==="identity")return[new at(ae.key,ae.value,'identity function may not have a "stops" property')];let oe=[];const pe=ae.value;return oe=oe.concat(Nl({key:ae.key,value:pe,valueSpec:ae.valueSpec,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,arrayElementValidator:W})),ai(pe)==="array"&&pe.length===0&&oe.push(new at(ae.key,pe,"array must have at least one stop")),oe},default:function(ae){return ae.validateSpec({key:ae.key,value:ae.value,valueSpec:a,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec})}}});return u==="identity"&&E&&j.push(new at(c.key,c.value,'missing required property "property"')),u==="identity"||c.value.stops||j.push(new at(c.key,c.value,'missing required property "stops"')),u==="exponential"&&c.valueSpec.expression&&!Sf(c.valueSpec)&&j.push(new at(c.key,c.value,"exponential functions not supported")),c.styleSpec.$version>=8&&(I&&!Dl(c.valueSpec)?j.push(new at(c.key,c.value,"property functions not supported")):E&&!pm(c.valueSpec)&&j.push(new at(c.key,c.value,"zoom functions not supported"))),u!=="categorical"&&!z||c.value.property!==void 0||j.push(new at(c.key,c.value,'"property" property is required')),j;function W(ae){let oe=[];const pe=ae.value,be=ae.key;if(ai(pe)!=="array")return[new at(be,pe,`array expected, ${ai(pe)} found`)];if(pe.length!==2)return[new at(be,pe,`array length 2 expected, length ${pe.length} found`)];if(z){if(ai(pe[0])!=="object")return[new at(be,pe,`object expected, ${ai(pe[0])} found`)];if(pe[0].zoom===void 0)return[new at(be,pe,"object stop key must have zoom")];if(pe[0].value===void 0)return[new at(be,pe,"object stop key must have value")];if(w&&w>Ui(pe[0].zoom))return[new at(be,pe[0].zoom,"stop zoom values must appear in ascending order")];Ui(pe[0].zoom)!==w&&(w=Ui(pe[0].zoom),y=void 0,T={}),oe=oe.concat(la({key:`${be}[0]`,value:pe[0],valueSpec:{zoom:{}},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec,objectElementValidators:{zoom:Cf,value:K}}))}else oe=oe.concat(K({key:`${be}[0]`,value:pe[0],valueSpec:{},validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec},pe));return yi(no(pe[1]))?oe.concat([new at(`${be}[1]`,pe[1],"expressions are not allowed in function stops.")]):oe.concat(ae.validateSpec({key:`${be}[1]`,value:pe[1],valueSpec:a,validateSpec:ae.validateSpec,style:ae.style,styleSpec:ae.styleSpec}))}function K(ae,oe){const pe=ai(ae.value),be=Ui(ae.value),Pe=ae.value!==null?ae.value:oe;if(f){if(pe!==f)return[new at(ae.key,Pe,`${pe} stop domain type must match previous stop domain type ${f}`)]}else f=pe;if(pe!=="number"&&pe!=="string"&&pe!=="boolean")return[new at(ae.key,Pe,"stop domain value must be a number, string, or boolean")];if(pe!=="number"&&u!=="categorical"){let Ve=`number expected, ${pe} found`;return Dl(a)&&u===void 0&&(Ve+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new at(ae.key,Pe,Ve)]}return u!=="categorical"||pe!=="number"||isFinite(be)&&Math.floor(be)===be?u!=="categorical"&&pe==="number"&&y!==void 0&&be<y?[new at(ae.key,Pe,"stop domain values must appear in ascending order")]:(y=be,u==="categorical"&&be in T?[new at(ae.key,Pe,"stop domain values must be unique")]:(T[be]=!0,[])):[new at(ae.key,Pe,`integer expected, found ${be}`)]}}function Bl(c){const a=(c.expressionContext==="property"?ym:pi)(no(c.value),c.valueSpec);if(a.result==="error")return a.value.map(f=>new at(`${c.key}${f.key}`,c.value,f.message));const u=a.value.expression||a.value._styleExpression.expression;if(c.expressionContext==="property"&&c.propertyKey==="text-font"&&!u.outputDefined())return[new at(c.key,c.value,`Invalid data expression for "${c.propertyKey}". Output values must be contained as literals within the expression.`)];if(c.expressionContext==="property"&&c.propertyType==="layout"&&!Zc(u))return[new at(c.key,c.value,'"feature-state" data expressions are not supported with layout properties.')];if(c.expressionContext==="filter"&&!Zc(u))return[new at(c.key,c.value,'"feature-state" data expressions are not supported with filters.')];if(c.expressionContext&&c.expressionContext.indexOf("cluster")===0){if(!ah(u,["zoom","feature-state"]))return[new at(c.key,c.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(c.expressionContext==="cluster-initial"&&!Xc(u))return[new at(c.key,c.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zo(c){const a=c.key,u=c.value,f=c.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(Ui(u))===-1&&y.push(new at(a,u,`expected one of [${f.values.join(", ")}], ${JSON.stringify(u)} found`)):Object.keys(f.values).indexOf(Ui(u))===-1&&y.push(new at(a,u,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(u)} found`)),y}function Ol(c){return Mf(no(c.value))?Bl(tn({},c,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Qc(c)}function Qc(c){const a=c.value,u=c.key;if(ai(a)!=="array")return[new at(u,a,`array expected, ${ai(a)} found`)];const f=c.styleSpec;let y,w=[];if(a.length<1)return[new at(u,a,"filter array must have at least 1 element")];switch(w=w.concat(zo({key:`${u}[0]`,value:a[0],valueSpec:f.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ui(a[0])){case"<":case"<=":case">":case">=":a.length>=2&&Ui(a[1])==="$type"&&w.push(new at(u,a,`"$type" cannot be use with operator "${a[0]}"`));case"==":case"!=":a.length!==3&&w.push(new at(u,a,`filter array for operator "${a[0]}" must have 3 elements`));case"in":case"!in":a.length>=2&&(y=ai(a[1]),y!=="string"&&w.push(new at(`${u}[1]`,a[1],`string expected, ${y} found`)));for(let T=2;T<a.length;T++)y=ai(a[T]),Ui(a[1])==="$type"?w=w.concat(zo({key:`${u}[${T}]`,value:a[T],valueSpec:f.geometry_type,style:c.style,styleSpec:c.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&w.push(new at(`${u}[${T}]`,a[T],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let T=1;T<a.length;T++)w=w.concat(Qc({key:`${u}[${T}]`,value:a[T],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":y=ai(a[1]),a.length!==2?w.push(new at(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="string"&&w.push(new at(`${u}[1]`,a[1],`string expected, ${y} found`));break;case"within":y=ai(a[1]),a.length!==2?w.push(new at(u,a,`filter array for "${a[0]}" operator must have 2 elements`)):y!=="object"&&w.push(new at(`${u}[1]`,a[1],`object expected, ${y} found`))}return w}function Rf(c,a){const u=c.key,f=c.validateSpec,y=c.style,w=c.styleSpec,T=c.value,E=c.objectKey,I=w[`${a}_${c.layerType}`];if(!I)return[];const z=E.match(/^(.*)-transition$/);if(a==="paint"&&z&&I[z[1]]&&I[z[1]].transition)return f({key:u,value:T,valueSpec:w.transition,style:y,styleSpec:w});const j=c.valueSpec||I[E];if(!j)return[new at(u,T,`unknown property "${E}"`)];let W;if(ai(T)==="string"&&Dl(j)&&!j.tokens&&(W=/^{([^}]+)}$/.exec(T)))return[new at(u,T,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(W[1])} }\`.`)];const K=[];return c.layerType==="symbol"&&(E==="text-field"&&y&&!y.glyphs&&K.push(new at(u,T,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&Ll(no(T))&&Ui(T.type)==="identity"&&K.push(new at(u,T,'"text-font" does not support identity functions'))),K.concat(f({key:c.key,value:T,valueSpec:j,style:y,styleSpec:w,expressionContext:"property",propertyType:a,propertyKey:E}))}function gh(c){return Rf(c,"paint")}function If(c){return Rf(c,"layout")}function kf(c){let a=[];const u=c.value,f=c.key,y=c.style,w=c.styleSpec;u.type||u.ref||a.push(new at(f,u,'either "type" or "ref" is required'));let T=Ui(u.type);const E=Ui(u.ref);if(u.id){const I=Ui(u.id);for(let z=0;z<c.arrayIndex;z++){const j=y.layers[z];Ui(j.id)===I&&a.push(new at(f,u.id,`duplicate layer id "${u.id}", previously used at line ${j.id.__line__}`))}}if("ref"in u){let I;["type","source","source-layer","filter","layout"].forEach(z=>{z in u&&a.push(new at(f,u[z],`"${z}" is prohibited for ref layers`))}),y.layers.forEach(z=>{Ui(z.id)===E&&(I=z)}),I?I.ref?a.push(new at(f,u.ref,"ref cannot reference another ref layer")):T=Ui(I.type):a.push(new at(f,u.ref,`ref layer "${E}" not found`))}else if(T!=="background")if(u.source){const I=y.sources&&y.sources[u.source],z=I&&Ui(I.type);I?z==="vector"&&T==="raster"?a.push(new at(f,u.source,`layer "${u.id}" requires a raster source`)):z!=="raster-dem"&&T==="hillshade"?a.push(new at(f,u.source,`layer "${u.id}" requires a raster-dem source`)):z==="raster"&&T!=="raster"?a.push(new at(f,u.source,`layer "${u.id}" requires a vector source`)):z!=="vector"||u["source-layer"]?z==="raster-dem"&&T!=="hillshade"?a.push(new at(f,u.source,"raster-dem source can only be used with layer type 'hillshade'.")):T!=="line"||!u.paint||!u.paint["line-gradient"]||z==="geojson"&&I.lineMetrics||a.push(new at(f,u,`layer "${u.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):a.push(new at(f,u,`layer "${u.id}" must specify a "source-layer"`)):a.push(new at(f,u.source,`source "${u.source}" not found`))}else a.push(new at(f,u,'missing required property "source"'));return a=a.concat(la({key:f,value:u,valueSpec:w.layer,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,objectElementValidators:{"*":()=>[],type:()=>c.validateSpec({key:`${f}.type`,value:u.type,valueSpec:w.layer.type,style:c.style,styleSpec:c.styleSpec,validateSpec:c.validateSpec,object:u,objectKey:"type"}),filter:Ol,layout:I=>la({layer:u,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>If(tn({layerType:T},z))}}),paint:I=>la({layer:u,key:I.key,value:I.value,style:I.style,styleSpec:I.styleSpec,validateSpec:I.validateSpec,objectElementValidators:{"*":z=>gh(tn({layerType:T},z))}})}})),a}function os(c){const a=c.value,u=c.key,f=ai(a);return f!=="string"?[new at(u,a,`string expected, ${f} found`)]:[]}const Sm={promoteId:function({key:c,value:a}){if(ai(a)==="string")return os({key:c,value:a});{const u=[];for(const f in a)u.push(...os({key:`${c}.${f}`,value:a[f]}));return u}}};function Mm(c){const a=c.value,u=c.key,f=c.styleSpec,y=c.style,w=c.validateSpec;if(!a.type)return[new at(u,a,'"type" is required')];const T=Ui(a.type);let E;switch(T){case"vector":case"raster":return E=la({key:u,value:a,valueSpec:f[`source_${T.replace("-","_")}`],style:c.style,styleSpec:f,objectElementValidators:Sm,validateSpec:w}),E;case"raster-dem":return E=function(I){var z;const j=(z=I.sourceName)!==null&&z!==void 0?z:"",W=I.value,K=I.styleSpec,ae=K.source_raster_dem,oe=I.style;let pe=[];const be=ai(W);if(W===void 0)return pe;if(be!=="object")return pe.push(new at("source_raster_dem",W,`object expected, ${be} found`)),pe;const Pe=Ui(W.encoding)==="custom",Ve=["redFactor","greenFactor","blueFactor","baseShift"],ke=I.value.encoding?`"${I.value.encoding}"`:"Default";for(const Ne in W)!Pe&&Ve.includes(Ne)?pe.push(new at(Ne,W[Ne],`In "${j}": "${Ne}" is only valid when "encoding" is set to "custom". ${ke} encoding found`)):ae[Ne]?pe=pe.concat(I.validateSpec({key:Ne,value:W[Ne],valueSpec:ae[Ne],validateSpec:I.validateSpec,style:oe,styleSpec:K})):pe.push(new at(Ne,W[Ne],`unknown property "${Ne}"`));return pe}({sourceName:u,value:a,style:c.style,styleSpec:f,validateSpec:w}),E;case"geojson":if(E=la({key:u,value:a,valueSpec:f.source_geojson,style:y,styleSpec:f,validateSpec:w,objectElementValidators:Sm}),a.cluster)for(const I in a.clusterProperties){const[z,j]=a.clusterProperties[I],W=typeof z=="string"?[z,["accumulated"],["get",I]]:z;E.push(...Bl({key:`${u}.${I}.map`,value:j,validateSpec:w,expressionContext:"cluster-map"})),E.push(...Bl({key:`${u}.${I}.reduce`,value:W,validateSpec:w,expressionContext:"cluster-reduce"}))}return E;case"video":return la({key:u,value:a,valueSpec:f.source_video,style:y,validateSpec:w,styleSpec:f});case"image":return la({key:u,value:a,valueSpec:f.source_image,style:y,validateSpec:w,styleSpec:f});case"canvas":return[new at(u,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zo({key:`${u}.type`,value:a.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:y,validateSpec:w,styleSpec:f})}}function Tm(c){const a=c.value,u=c.styleSpec,f=u.light,y=c.style;let w=[];const T=ai(a);if(a===void 0)return w;if(T!=="object")return w=w.concat([new at("light",a,`object expected, ${T} found`)]),w;for(const E in a){const I=E.match(/^(.*)-transition$/);w=w.concat(I&&f[I[1]]&&f[I[1]].transition?c.validateSpec({key:E,value:a[E],valueSpec:u.transition,validateSpec:c.validateSpec,style:y,styleSpec:u}):f[E]?c.validateSpec({key:E,value:a[E],valueSpec:f[E],validateSpec:c.validateSpec,style:y,styleSpec:u}):[new at(E,a[E],`unknown property "${E}"`)])}return w}function Em(c){const a=c.value,u=c.styleSpec,f=u.sky,y=c.style,w=ai(a);if(a===void 0)return[];if(w!=="object")return[new at("sky",a,`object expected, ${w} found`)];let T=[];for(const E in a)T=T.concat(f[E]?pr({key:E,value:a[E],valueSpec:f[E],style:y,styleSpec:u}):[new at(E,a[E],`unknown property "${E}"`)]);return T}function Am(c){const a=c.value,u=c.styleSpec,f=u.terrain,y=c.style;let w=[];const T=ai(a);if(a===void 0)return w;if(T!=="object")return w=w.concat([new at("terrain",a,`object expected, ${T} found`)]),w;for(const E in a)w=w.concat(f[E]?c.validateSpec({key:E,value:a[E],valueSpec:f[E],validateSpec:c.validateSpec,style:y,styleSpec:u}):[new at(E,a[E],`unknown property "${E}"`)]);return w}function eu(c){let a=[];const u=c.value,f=c.key;if(Array.isArray(u)){const y=[],w=[];for(const T in u)u[T].id&&y.includes(u[T].id)&&a.push(new at(f,u,`all the sprites' ids must be unique, but ${u[T].id} is duplicated`)),y.push(u[T].id),u[T].url&&w.includes(u[T].url)&&a.push(new at(f,u,`all the sprites' URLs must be unique, but ${u[T].url} is duplicated`)),w.push(u[T].url),a=a.concat(la({key:`${f}[${T}]`,value:u[T],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:c.validateSpec}));return a}return os({key:f,value:u})}const tu={"*":()=>[],array:Nl,boolean:function(c){const a=c.value,u=c.key,f=ai(a);return f!=="boolean"?[new at(u,a,`boolean expected, ${f} found`)]:[]},number:Cf,color:function(c){const a=c.key,u=c.value,f=ai(u);return f!=="string"?[new at(a,u,`color expected, ${f} found`)]:Xt.parse(String(u))?[]:[new at(a,u,`color expected, "${u}" found`)]},constants:wm,enum:zo,filter:Ol,function:Pf,layer:kf,object:la,source:Mm,light:Tm,sky:Em,terrain:Am,string:os,formatted:function(c){return os(c).length===0?[]:Bl(c)},resolvedImage:function(c){return os(c).length===0?[]:Bl(c)},padding:function(c){const a=c.key,u=c.value;if(ai(u)==="array"){if(u.length<1||u.length>4)return[new at(a,u,`padding requires 1 to 4 values; ${u.length} values found`)];const f={type:"number"};let y=[];for(let w=0;w<u.length;w++)y=y.concat(c.validateSpec({key:`${a}[${w}]`,value:u[w],validateSpec:c.validateSpec,valueSpec:f}));return y}return Cf({key:a,value:u,valueSpec:{}})},variableAnchorOffsetCollection:function(c){const a=c.key,u=c.value,f=ai(u),y=c.styleSpec;if(f!=="array"||u.length<1||u.length%2!=0)return[new at(a,u,"variableAnchorOffsetCollection requires a non-empty array of even length")];let w=[];for(let T=0;T<u.length;T+=2)w=w.concat(zo({key:`${a}[${T}]`,value:u[T],valueSpec:y.layout_symbol["text-anchor"]})),w=w.concat(Nl({key:`${a}[${T+1}]`,value:u[T+1],valueSpec:{length:2,value:"number"},validateSpec:c.validateSpec,style:c.style,styleSpec:y}));return w},sprite:eu};function pr(c){const a=c.value,u=c.valueSpec,f=c.styleSpec;return c.validateSpec=pr,u.expression&&Ll(Ui(a))?Pf(c):u.expression&&yi(no(a))?Bl(c):u.type&&tu[u.type]?tu[u.type](c):la(tn({},c,{valueSpec:u.type?f[u.type]:u}))}function Ul(c){const a=c.value,u=c.key,f=os(c);return f.length||(a.indexOf("{fontstack}")===-1&&f.push(new at(u,a,'"glyphs" url must include a "{fontstack}" token')),a.indexOf("{range}")===-1&&f.push(new at(u,a,'"glyphs" url must include a "{range}" token'))),f}function Ea(c,a=ie){let u=[];return u=u.concat(pr({key:"",value:c,valueSpec:a.$root,styleSpec:a,style:c,validateSpec:pr,objectElementValidators:{glyphs:Ul,"*":()=>[]}})),c.constants&&(u=u.concat(wm({key:"constants",value:c.constants,style:c,styleSpec:a,validateSpec:pr}))),Cm(u)}function ls(c){return function(a){return c({...a,validateSpec:pr})}}function Cm(c){return[].concat(c).sort((a,u)=>a.line-u.line)}function jr(c){return function(...a){return Cm(c.apply(this,a))}}Ea.source=jr(ls(Mm)),Ea.sprite=jr(ls(eu)),Ea.glyphs=jr(ls(Ul)),Ea.light=jr(ls(Tm)),Ea.sky=jr(ls(Em)),Ea.terrain=jr(ls(Am)),Ea.layer=jr(ls(kf)),Ea.filter=jr(ls(Ol)),Ea.paintProperty=jr(ls(gh)),Ea.layoutProperty=jr(ls(If));const Vl=Ea,Df=Vl.light,wv=Vl.paintProperty,Lf=Vl.layoutProperty;function Pm(c,a){let u=!1;if(a&&a.length)for(const f of a)c.fire(new Yt(new Error(f.message))),u=!0;return u}class Ps{constructor(a,u,f){const y=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;const T=new Int32Array(this.arrayBuffer);a=T[0],this.d=(u=T[1])+2*(f=T[2]);for(let I=0;I<this.d*this.d;I++){const z=T[3+I],j=T[3+I+1];y.push(z===j?null:T.subarray(z,j))}const E=T[3+y.length+1];this.keys=T.subarray(T[3+y.length],E),this.bboxes=T.subarray(E),this.insert=this._insertReadonly}else{this.d=u+2*f;for(let T=0;T<this.d*this.d;T++)y.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=f,this.scale=u/a,this.uid=0;const w=f/u*a;this.min=-w,this.max=a+w}insert(a,u,f,y,w){this._forEachCell(u,f,y,w,this._insertCell,this.uid++,void 0,void 0),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(w)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(a,u,f,y,w,T){this.cells[w].push(T)}query(a,u,f,y,w){const T=this.min,E=this.max;if(a<=T&&u<=T&&E<=f&&E<=y&&!w)return Array.prototype.slice.call(this.keys);{const I=[];return this._forEachCell(a,u,f,y,this._queryCell,I,{},w),I}}_queryCell(a,u,f,y,w,T,E,I){const z=this.cells[w];if(z!==null){const j=this.keys,W=this.bboxes;for(let K=0;K<z.length;K++){const ae=z[K];if(E[ae]===void 0){const oe=4*ae;(I?I(W[oe+0],W[oe+1],W[oe+2],W[oe+3]):a<=W[oe+2]&&u<=W[oe+3]&&f>=W[oe+0]&&y>=W[oe+1])?(E[ae]=!0,T.push(j[ae])):E[ae]=!1}}}}_forEachCell(a,u,f,y,w,T,E,I){const z=this._convertToCellCoord(a),j=this._convertToCellCoord(u),W=this._convertToCellCoord(f),K=this._convertToCellCoord(y);for(let ae=z;ae<=W;ae++)for(let oe=j;oe<=K;oe++){const pe=this.d*oe+ae;if((!I||I(this._convertFromCellCoord(ae),this._convertFromCellCoord(oe),this._convertFromCellCoord(ae+1),this._convertFromCellCoord(oe+1)))&&w.call(this,a,u,f,y,pe,T,E,I))return}}_convertFromCellCoord(a){return(a-this.padding)/this.scale}_convertToCellCoord(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const a=this.cells,u=3+this.cells.length+1+1;let f=0;for(let T=0;T<this.cells.length;T++)f+=this.cells[T].length;const y=new Int32Array(u+f+this.keys.length+this.bboxes.length);y[0]=this.extent,y[1]=this.n,y[2]=this.padding;let w=u;for(let T=0;T<a.length;T++){const E=a[T];y[3+T]=w,y.set(E,w),w+=E.length}return y[3+a.length]=w,y.set(this.keys,w),w+=this.keys.length,y[3+a.length+1]=w,y.set(this.bboxes,w),w+=this.bboxes.length,y.buffer}static serialize(a,u){const f=a.toArrayBuffer();return u&&u.push(f),{buffer:f}}static deserialize(a){return new Ps(a.buffer)}}const io={};function en(c,a,u={}){if(io[c])throw new Error(`${c} is already registered.`);Object.defineProperty(a,"_classRegistryKey",{value:c,writeable:!1}),io[c]={klass:a,omit:u.omit||[],shallow:u.shallow||[]}}en("Object",Object),en("TransferableGridIndex",Ps),en("Color",Xt),en("Error",Error),en("AJAXError",gn),en("ResolvedImage",Pn),en("StylePropertyFunction",dh),en("StyleExpression",Jc,{omit:["_evaluator"]}),en("ZoomDependentExpression",hh),en("ZoomConstantExpression",zl),en("CompoundExpression",Ta,{omit:["_evaluate"]});for(const c in Il)Il[c]._classRegistryKey||en(`Expression_${c}`,Il[c]);function zf(c){return c&&typeof ArrayBuffer<"u"&&(c instanceof ArrayBuffer||c.constructor&&c.constructor.name==="ArrayBuffer")}function Fo(c,a){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error)return c;if(zf(c)||De(c))return a&&a.push(c),c;if(ArrayBuffer.isView(c)){const u=c;return a&&a.push(u.buffer),u}if(c instanceof ImageData)return a&&a.push(c.data.buffer),c;if(Array.isArray(c)){const u=[];for(const f of c)u.push(Fo(f,a));return u}if(typeof c=="object"){const u=c.constructor,f=u._classRegistryKey;if(!f)throw new Error(`can't serialize object of unregistered class ${u.name}`);if(!io[f])throw new Error(`${f} is not registered.`);const y=u.serialize?u.serialize(c,a):{};if(u.serialize){if(a&&y===a[a.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const w in c){if(!c.hasOwnProperty(w)||io[f].omit.indexOf(w)>=0)continue;const T=c[w];y[w]=io[f].shallow.indexOf(w)>=0?T:Fo(T,a)}c instanceof Error&&(y.message=c.message)}if(y.$name)throw new Error("$name property is reserved for worker serialization logic.");return f!=="Object"&&(y.$name=f),y}throw new Error("can't serialize object of type "+typeof c)}function Hl(c){if(c==null||typeof c=="boolean"||typeof c=="number"||typeof c=="string"||c instanceof Boolean||c instanceof Number||c instanceof String||c instanceof Date||c instanceof RegExp||c instanceof Blob||c instanceof Error||zf(c)||De(c)||ArrayBuffer.isView(c)||c instanceof ImageData)return c;if(Array.isArray(c))return c.map(Hl);if(typeof c=="object"){const a=c.$name||"Object";if(!io[a])throw new Error(`can't deserialize unregistered class ${a}`);const{klass:u}=io[a];if(!u)throw new Error(`can't deserialize unregistered class ${a}`);if(u.deserialize)return u.deserialize(c);const f=Object.create(u.prototype);for(const y of Object.keys(c)){if(y==="$name")continue;const w=c[y];f[y]=io[a].shallow.indexOf(y)>=0?w:Hl(w)}return f}throw new Error("can't deserialize object of type "+typeof c)}class Ff{constructor(){this.first=!0}update(a,u){const f=Math.floor(a);return this.first?(this.first=!1,this.lastIntegerZoom=f,this.lastIntegerZoomTime=0,this.lastZoom=a,this.lastFloorZoom=f,!0):(this.lastFloorZoom>f?(this.lastIntegerZoom=f+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<f&&(this.lastIntegerZoom=f,this.lastIntegerZoomTime=u),a!==this.lastZoom&&(this.lastZoom=a,this.lastFloorZoom=f,!0))}}const qt={"Latin-1 Supplement":c=>c>=128&&c<=255,Arabic:c=>c>=1536&&c<=1791,"Arabic Supplement":c=>c>=1872&&c<=1919,"Arabic Extended-A":c=>c>=2208&&c<=2303,"Hangul Jamo":c=>c>=4352&&c<=4607,"Unified Canadian Aboriginal Syllabics":c=>c>=5120&&c<=5759,Khmer:c=>c>=6016&&c<=6143,"Unified Canadian Aboriginal Syllabics Extended":c=>c>=6320&&c<=6399,"General Punctuation":c=>c>=8192&&c<=8303,"Letterlike Symbols":c=>c>=8448&&c<=8527,"Number Forms":c=>c>=8528&&c<=8591,"Miscellaneous Technical":c=>c>=8960&&c<=9215,"Control Pictures":c=>c>=9216&&c<=9279,"Optical Character Recognition":c=>c>=9280&&c<=9311,"Enclosed Alphanumerics":c=>c>=9312&&c<=9471,"Geometric Shapes":c=>c>=9632&&c<=9727,"Miscellaneous Symbols":c=>c>=9728&&c<=9983,"Miscellaneous Symbols and Arrows":c=>c>=11008&&c<=11263,"CJK Radicals Supplement":c=>c>=11904&&c<=12031,"Kangxi Radicals":c=>c>=12032&&c<=12255,"Ideographic Description Characters":c=>c>=12272&&c<=12287,"CJK Symbols and Punctuation":c=>c>=12288&&c<=12351,Hiragana:c=>c>=12352&&c<=12447,Katakana:c=>c>=12448&&c<=12543,Bopomofo:c=>c>=12544&&c<=12591,"Hangul Compatibility Jamo":c=>c>=12592&&c<=12687,Kanbun:c=>c>=12688&&c<=12703,"Bopomofo Extended":c=>c>=12704&&c<=12735,"CJK Strokes":c=>c>=12736&&c<=12783,"Katakana Phonetic Extensions":c=>c>=12784&&c<=12799,"Enclosed CJK Letters and Months":c=>c>=12800&&c<=13055,"CJK Compatibility":c=>c>=13056&&c<=13311,"CJK Unified Ideographs Extension A":c=>c>=13312&&c<=19903,"Yijing Hexagram Symbols":c=>c>=19904&&c<=19967,"CJK Unified Ideographs":c=>c>=19968&&c<=40959,"Yi Syllables":c=>c>=40960&&c<=42127,"Yi Radicals":c=>c>=42128&&c<=42191,"Hangul Jamo Extended-A":c=>c>=43360&&c<=43391,"Hangul Syllables":c=>c>=44032&&c<=55215,"Hangul Jamo Extended-B":c=>c>=55216&&c<=55295,"Private Use Area":c=>c>=57344&&c<=63743,"CJK Compatibility Ideographs":c=>c>=63744&&c<=64255,"Arabic Presentation Forms-A":c=>c>=64336&&c<=65023,"Vertical Forms":c=>c>=65040&&c<=65055,"CJK Compatibility Forms":c=>c>=65072&&c<=65103,"Small Form Variants":c=>c>=65104&&c<=65135,"Arabic Presentation Forms-B":c=>c>=65136&&c<=65279,"Halfwidth and Fullwidth Forms":c=>c>=65280&&c<=65519};function nu(c){for(const a of c)if(vh(a.charCodeAt(0)))return!0;return!1}function yh(c){for(const a of c)if(!Rm(a.charCodeAt(0)))return!1;return!0}function Rm(c){return!(qt.Arabic(c)||qt["Arabic Supplement"](c)||qt["Arabic Extended-A"](c)||qt["Arabic Presentation Forms-A"](c)||qt["Arabic Presentation Forms-B"](c))}function vh(c){return!(c!==746&&c!==747&&(c<4352||!(qt["Bopomofo Extended"](c)||qt.Bopomofo(c)||qt["CJK Compatibility Forms"](c)&&!(c>=65097&&c<=65103)||qt["CJK Compatibility Ideographs"](c)||qt["CJK Compatibility"](c)||qt["CJK Radicals Supplement"](c)||qt["CJK Strokes"](c)||!(!qt["CJK Symbols and Punctuation"](c)||c>=12296&&c<=12305||c>=12308&&c<=12319||c===12336)||qt["CJK Unified Ideographs Extension A"](c)||qt["CJK Unified Ideographs"](c)||qt["Enclosed CJK Letters and Months"](c)||qt["Hangul Compatibility Jamo"](c)||qt["Hangul Jamo Extended-A"](c)||qt["Hangul Jamo Extended-B"](c)||qt["Hangul Jamo"](c)||qt["Hangul Syllables"](c)||qt.Hiragana(c)||qt["Ideographic Description Characters"](c)||qt.Kanbun(c)||qt["Kangxi Radicals"](c)||qt["Katakana Phonetic Extensions"](c)||qt.Katakana(c)&&c!==12540||!(!qt["Halfwidth and Fullwidth Forms"](c)||c===65288||c===65289||c===65293||c>=65306&&c<=65310||c===65339||c===65341||c===65343||c>=65371&&c<=65503||c===65507||c>=65512&&c<=65519)||!(!qt["Small Form Variants"](c)||c>=65112&&c<=65118||c>=65123&&c<=65126)||qt["Unified Canadian Aboriginal Syllabics"](c)||qt["Unified Canadian Aboriginal Syllabics Extended"](c)||qt["Vertical Forms"](c)||qt["Yijing Hexagram Symbols"](c)||qt["Yi Syllables"](c)||qt["Yi Radicals"](c))))}function Nf(c){return!(vh(c)||function(a){return!!(qt["Latin-1 Supplement"](a)&&(a===167||a===169||a===174||a===177||a===188||a===189||a===190||a===215||a===247)||qt["General Punctuation"](a)&&(a===8214||a===8224||a===8225||a===8240||a===8241||a===8251||a===8252||a===8258||a===8263||a===8264||a===8265||a===8273)||qt["Letterlike Symbols"](a)||qt["Number Forms"](a)||qt["Miscellaneous Technical"](a)&&(a>=8960&&a<=8967||a>=8972&&a<=8991||a>=8996&&a<=9e3||a===9003||a>=9085&&a<=9114||a>=9150&&a<=9165||a===9167||a>=9169&&a<=9179||a>=9186&&a<=9215)||qt["Control Pictures"](a)&&a!==9251||qt["Optical Character Recognition"](a)||qt["Enclosed Alphanumerics"](a)||qt["Geometric Shapes"](a)||qt["Miscellaneous Symbols"](a)&&!(a>=9754&&a<=9759)||qt["Miscellaneous Symbols and Arrows"](a)&&(a>=11026&&a<=11055||a>=11088&&a<=11097||a>=11192&&a<=11243)||qt["CJK Symbols and Punctuation"](a)||qt.Katakana(a)||qt["Private Use Area"](a)||qt["CJK Compatibility Forms"](a)||qt["Small Form Variants"](a)||qt["Halfwidth and Fullwidth Forms"](a)||a===8734||a===8756||a===8757||a>=9984&&a<=10087||a>=10102&&a<=10131||a===65532||a===65533)}(c))}function Bf(c){return c>=1424&&c<=2303||qt["Arabic Presentation Forms-A"](c)||qt["Arabic Presentation Forms-B"](c)}function Of(c,a){return!(!a&&Bf(c)||c>=2304&&c<=3583||c>=3840&&c<=4255||qt.Khmer(c))}function Im(c){for(const a of c)if(Bf(a.charCodeAt(0)))return!0;return!1}const No=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(c){this.pluginStatus=c.pluginStatus,this.pluginURL=c.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(c){this.applyArabicShaping=c.applyArabicShaping,this.processBidirectionalText=c.processBidirectionalText,this.processStyledBidirectionalText=c.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class bi{constructor(a,u){this.zoom=a,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Ff,this.transition={})}isSupportedScript(a){return function(u,f){for(const y of u)if(!Of(y.charCodeAt(0),f))return!1;return!0}(a,No.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const a=this.zoom,u=a-Math.floor(a),f=this.crossFadingFactor();return a>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*f}:{fromScale:.5,toScale:1,t:1-(1-f)*u}}}class _h{constructor(a,u){this.property=a,this.value=u,this.expression=function(f,y){if(Ll(f))return new dh(f,y);if(yi(f)){const w=ym(f,y);if(w.result==="error")throw new Error(w.value.map(T=>`${T.key}: ${T.message}`).join(", "));return w.value}{let w=f;return y.type==="color"&&typeof f=="string"?w=Xt.parse(f):y.type!=="padding"||typeof f!="number"&&!Array.isArray(f)?y.type==="variableAnchorOffsetCollection"&&Array.isArray(f)&&(w=Wn.parse(f)):w=ci.parse(f),{kind:"constant",evaluate:()=>w}}}(u===void 0?a.specification.default:u,a.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(a,u,f){return this.property.possiblyEvaluate(this,a,u,f)}}class xh{constructor(a){this.property=a,this.value=new _h(a,void 0)}transitioned(a,u){return new Vf(this.property,this.value,u,Q({},a.transition,this.transition),a.now)}untransitioned(){return new Vf(this.property,this.value,null,{},0)}}class Uf{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitionablePropertyValues)}getValue(a){return Me(this._values[a].value.value)}setValue(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new xh(this._values[a].property)),this._values[a].value=new _h(this._values[a].property,u===null?void 0:Me(u))}getTransition(a){return Me(this._values[a].transition)}setTransition(a,u){Object.prototype.hasOwnProperty.call(this._values,a)||(this._values[a]=new xh(this._values[a].property)),this._values[a].transition=Me(u)||void 0}serialize(){const a={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(a[u]=f);const y=this.getTransition(u);y!==void 0&&(a[`${u}-transition`]=y)}return a}transitioned(a,u){const f=new km(this._properties);for(const y of Object.keys(this._values))f._values[y]=this._values[y].transitioned(a,u._values[y]);return f}untransitioned(){const a=new km(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].untransitioned();return a}}class Vf{constructor(a,u,f,y,w){this.property=a,this.value=u,this.begin=w+y.delay||0,this.end=this.begin+y.duration||0,a.specification.transition&&(y.delay||y.duration)&&(this.prior=f)}possiblyEvaluate(a,u,f){const y=a.now||0,w=this.value.possiblyEvaluate(a,u,f),T=this.prior;if(T){if(y>this.end)return this.prior=null,w;if(this.value.isDataDriven())return this.prior=null,w;if(y<this.begin)return T.possiblyEvaluate(a,u,f);{const E=(y-this.begin)/(this.end-this.begin);return this.property.interpolate(T.possiblyEvaluate(a,u,f),w,function(I){if(I<=0)return 0;if(I>=1)return 1;const z=I*I,j=z*I;return 4*(I<.5?j:3*(I-z)+j-.75)}(E))}}return w}}class km{constructor(a){this._properties=a,this._values=Object.create(a.defaultTransitioningPropertyValues)}possiblyEvaluate(a,u,f){const y=new iu(this._properties);for(const w of Object.keys(this._values))y._values[w]=this._values[w].possiblyEvaluate(a,u,f);return y}hasTransition(){for(const a of Object.keys(this._values))if(this._values[a].prior)return!0;return!1}}class Sv{constructor(a){this._properties=a,this._values=Object.create(a.defaultPropertyValues)}hasValue(a){return this._values[a].value!==void 0}getValue(a){return Me(this._values[a].value)}setValue(a,u){this._values[a]=new _h(this._values[a].property,u===null?void 0:Me(u))}serialize(){const a={};for(const u of Object.keys(this._values)){const f=this.getValue(u);f!==void 0&&(a[u]=f)}return a}possiblyEvaluate(a,u,f){const y=new iu(this._properties);for(const w of Object.keys(this._values))y._values[w]=this._values[w].possiblyEvaluate(a,u,f);return y}}class Ba{constructor(a,u,f){this.property=a,this.value=u,this.parameters=f}isConstant(){return this.value.kind==="constant"}constantOr(a){return this.value.kind==="constant"?this.value.value:a}evaluate(a,u,f,y){return this.property.evaluate(this.value,this.parameters,a,u,f,y)}}class iu{constructor(a){this._properties=a,this._values=Object.create(a.defaultPossiblyEvaluatedValues)}get(a){return this._values[a]}}class pn{constructor(a){this.specification=a}possiblyEvaluate(a,u){if(a.isDataDriven())throw new Error("Value should not be data driven");return a.expression.evaluate(u)}interpolate(a,u,f){const y=oa[this.specification.type];return y?y(a,u,f):a}}class Mn{constructor(a,u){this.specification=a,this.overrides=u}possiblyEvaluate(a,u,f,y){return new Ba(this,a.expression.kind==="constant"||a.expression.kind==="camera"?{kind:"constant",value:a.expression.evaluate(u,null,{},f,y)}:a.expression,u)}interpolate(a,u,f){if(a.value.kind!=="constant"||u.value.kind!=="constant")return a;if(a.value.value===void 0||u.value.value===void 0)return new Ba(this,{kind:"constant",value:void 0},a.parameters);const y=oa[this.specification.type];if(y){const w=y(a.value.value,u.value.value,f);return new Ba(this,{kind:"constant",value:w},a.parameters)}return a}evaluate(a,u,f,y,w,T){return a.kind==="constant"?a.value:a.evaluate(u,f,y,w,T)}}class Bo extends Mn{possiblyEvaluate(a,u,f,y){if(a.value===void 0)return new Ba(this,{kind:"constant",value:void 0},u);if(a.expression.kind==="constant"){const w=a.expression.evaluate(u,null,{},f,y),T=a.property.specification.type==="resolvedImage"&&typeof w!="string"?w.name:w,E=this._calculate(T,T,T,u);return new Ba(this,{kind:"constant",value:E},u)}if(a.expression.kind==="camera"){const w=this._calculate(a.expression.evaluate({zoom:u.zoom-1}),a.expression.evaluate({zoom:u.zoom}),a.expression.evaluate({zoom:u.zoom+1}),u);return new Ba(this,{kind:"constant",value:w},u)}return new Ba(this,a.expression,u)}evaluate(a,u,f,y,w,T){if(a.kind==="source"){const E=a.evaluate(u,f,y,w,T);return this._calculate(E,E,E,u)}return a.kind==="composite"?this._calculate(a.evaluate({zoom:Math.floor(u.zoom)-1},f,y),a.evaluate({zoom:Math.floor(u.zoom)},f,y),a.evaluate({zoom:Math.floor(u.zoom)+1},f,y),u):a.value}_calculate(a,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:f,to:u}}interpolate(a){return a}}class Hf{constructor(a){this.specification=a}possiblyEvaluate(a,u,f,y){if(a.value!==void 0){if(a.expression.kind==="constant"){const w=a.expression.evaluate(u,null,{},f,y);return this._calculate(w,w,w,u)}return this._calculate(a.expression.evaluate(new bi(Math.floor(u.zoom-1),u)),a.expression.evaluate(new bi(Math.floor(u.zoom),u)),a.expression.evaluate(new bi(Math.floor(u.zoom+1),u)),u)}}_calculate(a,u,f,y){return y.zoom>y.zoomHistory.lastIntegerZoom?{from:a,to:u}:{from:f,to:u}}interpolate(a){return a}}class ru{constructor(a){this.specification=a}possiblyEvaluate(a,u,f,y){return!!a.expression.evaluate(u,null,{},f,y)}interpolate(){return!1}}class Wr{constructor(a){this.properties=a,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const u in a){const f=a[u];f.specification.overridable&&this.overridableProperties.push(u);const y=this.defaultPropertyValues[u]=new _h(f,void 0),w=this.defaultTransitionablePropertyValues[u]=new xh(f);this.defaultTransitioningPropertyValues[u]=w.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=y.possiblyEvaluate({})}}}en("DataDrivenProperty",Mn),en("DataConstantProperty",pn),en("CrossFadedDataDrivenProperty",Bo),en("CrossFadedProperty",Hf),en("ColorRampProperty",ru);const Dm="-transition";class Oa extends Gn{constructor(a,u){if(super(),this.id=a.id,this.type=a.type,this._featureFilter={filter:()=>!0,needGeometry:!1},a.type!=="custom"&&(this.metadata=a.metadata,this.minzoom=a.minzoom,this.maxzoom=a.maxzoom,a.type!=="background"&&(this.source=a.source,this.sourceLayer=a["source-layer"],this.filter=a.filter),u.layout&&(this._unevaluatedLayout=new Sv(u.layout)),u.paint)){this._transitionablePaint=new Uf(u.paint);for(const f in a.paint)this.setPaintProperty(f,a.paint[f],{validate:!1});for(const f in a.layout)this.setLayoutProperty(f,a.layout[f],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new iu(u.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(a){return a==="visibility"?this.visibility:this._unevaluatedLayout.getValue(a)}setLayoutProperty(a,u,f={}){u!=null&&this._validate(Lf,`layers.${this.id}.layout.${a}`,a,u,f)||(a!=="visibility"?this._unevaluatedLayout.setValue(a,u):this.visibility=u)}getPaintProperty(a){return a.endsWith(Dm)?this._transitionablePaint.getTransition(a.slice(0,-11)):this._transitionablePaint.getValue(a)}setPaintProperty(a,u,f={}){if(u!=null&&this._validate(wv,`layers.${this.id}.paint.${a}`,a,u,f))return!1;if(a.endsWith(Dm))return this._transitionablePaint.setTransition(a.slice(0,-11),u||void 0),!1;{const y=this._transitionablePaint._values[a],w=y.property.specification["property-type"]==="cross-faded-data-driven",T=y.value.isDataDriven(),E=y.value;this._transitionablePaint.setValue(a,u),this._handleSpecialPaintPropertyUpdate(a);const I=this._transitionablePaint._values[a].value;return I.isDataDriven()||T||w||this._handleOverridablePaintPropertyUpdate(a,E,I)}}_handleSpecialPaintPropertyUpdate(a){}_handleOverridablePaintPropertyUpdate(a,u,f){return!1}isHidden(a){return!!(this.minzoom&&a<this.minzoom)||!!(this.maxzoom&&a>=this.maxzoom)||this.visibility==="none"}updateTransitions(a){this._transitioningPaint=this._transitionablePaint.transitioned(a,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(a,u){a.getCrossfadeParameters&&(this._crossfadeParameters=a.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(a,void 0,u)),this.paint=this._transitioningPaint.possiblyEvaluate(a,void 0,u)}serialize(){const a={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(a.layout=a.layout||{},a.layout.visibility=this.visibility),ee(a,(u,f)=>!(u===void 0||f==="layout"&&!Object.keys(u).length||f==="paint"&&!Object.keys(u).length))}_validate(a,u,f,y,w={}){return(!w||w.validate!==!1)&&Pm(this,a.call(Vl,{key:u,layerType:this.type,objectKey:f,value:y,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const a in this.paint._values){const u=this.paint.get(a);if(u instanceof Ba&&Dl(u.property.specification)&&(u.value.kind==="source"||u.value.kind==="composite")&&u.value.isStateDependent)return!0}return!1}}const Lm={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Gl{constructor(a,u){this._structArray=a,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class zi{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(a,u){return a._trim(),u&&(a.isTransferred=!0,u.push(a.arrayBuffer)),{length:a.length,arrayBuffer:a.arrayBuffer}}static deserialize(a){const u=Object.create(this.prototype);return u.arrayBuffer=a.arrayBuffer,u.length=a.length,u.capacity=a.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(a){this.reserve(a),this.length=a}reserve(a){if(a>this.capacity){this.capacity=Math.max(a,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Wi(c,a=1){let u=0,f=0;return{members:c.map(y=>{const w=Lm[y.type].BYTES_PER_ELEMENT,T=u=zm(u,Math.max(a,w)),E=y.components||1;return f=Math.max(f,w),u+=w*E,{name:y.name,type:y.type,components:E,offset:T}}),size:zm(u,Math.max(f,a)),alignment:a}}function zm(c,a){return Math.ceil(c/a)*a}class au extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.int16[y+0]=u,this.int16[y+1]=f,a}}au.prototype.bytesPerElement=4,en("StructArrayLayout2i4",au);class bh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const w=3*a;return this.int16[w+0]=u,this.int16[w+1]=f,this.int16[w+2]=y,a}}bh.prototype.bytesPerElement=6,en("StructArrayLayout3i6",bh);class ro extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,a,u,f,y)}emplace(a,u,f,y,w){const T=4*a;return this.int16[T+0]=u,this.int16[T+1]=f,this.int16[T+2]=y,this.int16[T+3]=w,a}}ro.prototype.bytesPerElement=8,en("StructArrayLayout4i8",ro);class Gf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,u,f,y,w,T)}emplace(a,u,f,y,w,T,E){const I=6*a;return this.int16[I+0]=u,this.int16[I+1]=f,this.int16[I+2]=y,this.int16[I+3]=w,this.int16[I+4]=T,this.int16[I+5]=E,a}}Gf.prototype.bytesPerElement=12,en("StructArrayLayout2i4i12",Gf);class jf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,u,f,y,w,T)}emplace(a,u,f,y,w,T,E){const I=4*a,z=8*a;return this.int16[I+0]=u,this.int16[I+1]=f,this.uint8[z+4]=y,this.uint8[z+5]=w,this.uint8[z+6]=T,this.uint8[z+7]=E,a}}jf.prototype.bytesPerElement=8,en("StructArrayLayout2i4ub8",jf);class su extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.float32[y+0]=u,this.float32[y+1]=f,a}}su.prototype.bytesPerElement=8,en("StructArrayLayout2f8",su);class Wf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T,E,I,z,j){const W=this.length;return this.resize(W+1),this.emplace(W,a,u,f,y,w,T,E,I,z,j)}emplace(a,u,f,y,w,T,E,I,z,j,W){const K=10*a;return this.uint16[K+0]=u,this.uint16[K+1]=f,this.uint16[K+2]=y,this.uint16[K+3]=w,this.uint16[K+4]=T,this.uint16[K+5]=E,this.uint16[K+6]=I,this.uint16[K+7]=z,this.uint16[K+8]=j,this.uint16[K+9]=W,a}}Wf.prototype.bytesPerElement=20,en("StructArrayLayout10ui20",Wf);class wh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T,E,I,z,j,W,K){const ae=this.length;return this.resize(ae+1),this.emplace(ae,a,u,f,y,w,T,E,I,z,j,W,K)}emplace(a,u,f,y,w,T,E,I,z,j,W,K,ae){const oe=12*a;return this.int16[oe+0]=u,this.int16[oe+1]=f,this.int16[oe+2]=y,this.int16[oe+3]=w,this.uint16[oe+4]=T,this.uint16[oe+5]=E,this.uint16[oe+6]=I,this.uint16[oe+7]=z,this.int16[oe+8]=j,this.int16[oe+9]=W,this.int16[oe+10]=K,this.int16[oe+11]=ae,a}}wh.prototype.bytesPerElement=24,en("StructArrayLayout4i4ui4i24",wh);class qf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const w=3*a;return this.float32[w+0]=u,this.float32[w+1]=f,this.float32[w+2]=y,a}}qf.prototype.bytesPerElement=12,en("StructArrayLayout3f12",qf);class $f extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint32[1*a+0]=u,a}}$f.prototype.bytesPerElement=4,en("StructArrayLayout1ul4",$f);class Rs extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T,E,I,z){const j=this.length;return this.resize(j+1),this.emplace(j,a,u,f,y,w,T,E,I,z)}emplace(a,u,f,y,w,T,E,I,z,j){const W=10*a,K=5*a;return this.int16[W+0]=u,this.int16[W+1]=f,this.int16[W+2]=y,this.int16[W+3]=w,this.int16[W+4]=T,this.int16[W+5]=E,this.uint32[K+3]=I,this.uint16[W+8]=z,this.uint16[W+9]=j,a}}Rs.prototype.bytesPerElement=20,en("StructArrayLayout6i1ul2ui20",Rs);class Sh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T){const E=this.length;return this.resize(E+1),this.emplace(E,a,u,f,y,w,T)}emplace(a,u,f,y,w,T,E){const I=6*a;return this.int16[I+0]=u,this.int16[I+1]=f,this.int16[I+2]=y,this.int16[I+3]=w,this.int16[I+4]=T,this.int16[I+5]=E,a}}Sh.prototype.bytesPerElement=12,en("StructArrayLayout2i2i2i12",Sh);class ou extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w){const T=this.length;return this.resize(T+1),this.emplace(T,a,u,f,y,w)}emplace(a,u,f,y,w,T){const E=4*a,I=8*a;return this.float32[E+0]=u,this.float32[E+1]=f,this.float32[E+2]=y,this.int16[I+6]=w,this.int16[I+7]=T,a}}ou.prototype.bytesPerElement=16,en("StructArrayLayout2f1f2i16",ou);class Mh extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,a,u,f,y)}emplace(a,u,f,y,w){const T=12*a,E=3*a;return this.uint8[T+0]=u,this.uint8[T+1]=f,this.float32[E+1]=y,this.float32[E+2]=w,a}}Mh.prototype.bytesPerElement=12,en("StructArrayLayout2ub2f12",Mh);class jl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const w=3*a;return this.uint16[w+0]=u,this.uint16[w+1]=f,this.uint16[w+2]=y,a}}jl.prototype.bytesPerElement=6,en("StructArrayLayout3ui6",jl);class Xf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe){const Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe)}emplace(a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe,Ve){const ke=24*a,Ne=12*a,ht=48*a;return this.int16[ke+0]=u,this.int16[ke+1]=f,this.uint16[ke+2]=y,this.uint16[ke+3]=w,this.uint32[Ne+2]=T,this.uint32[Ne+3]=E,this.uint32[Ne+4]=I,this.uint16[ke+10]=z,this.uint16[ke+11]=j,this.uint16[ke+12]=W,this.float32[Ne+7]=K,this.float32[Ne+8]=ae,this.uint8[ht+36]=oe,this.uint8[ht+37]=pe,this.uint8[ht+38]=be,this.uint32[Ne+10]=Pe,this.int16[ke+22]=Ve,a}}Xf.prototype.bytesPerElement=48,en("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Xf);class Wl extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe,Ve,ke,Ne,ht,yt,Wt,un,Gt,Vt,Rt,sn){const Ot=this.length;return this.resize(Ot+1),this.emplace(Ot,a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe,Ve,ke,Ne,ht,yt,Wt,un,Gt,Vt,Rt,sn)}emplace(a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe,be,Pe,Ve,ke,Ne,ht,yt,Wt,un,Gt,Vt,Rt,sn,Ot){const Tt=32*a,vn=16*a;return this.int16[Tt+0]=u,this.int16[Tt+1]=f,this.int16[Tt+2]=y,this.int16[Tt+3]=w,this.int16[Tt+4]=T,this.int16[Tt+5]=E,this.int16[Tt+6]=I,this.int16[Tt+7]=z,this.uint16[Tt+8]=j,this.uint16[Tt+9]=W,this.uint16[Tt+10]=K,this.uint16[Tt+11]=ae,this.uint16[Tt+12]=oe,this.uint16[Tt+13]=pe,this.uint16[Tt+14]=be,this.uint16[Tt+15]=Pe,this.uint16[Tt+16]=Ve,this.uint16[Tt+17]=ke,this.uint16[Tt+18]=Ne,this.uint16[Tt+19]=ht,this.uint16[Tt+20]=yt,this.uint16[Tt+21]=Wt,this.uint16[Tt+22]=un,this.uint32[vn+12]=Gt,this.float32[vn+13]=Vt,this.float32[vn+14]=Rt,this.uint16[Tt+30]=sn,this.uint16[Tt+31]=Ot,a}}Wl.prototype.bytesPerElement=64,en("StructArrayLayout8i15ui1ul2f2ui64",Wl);class ao extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.float32[1*a+0]=u,a}}ao.prototype.bytesPerElement=4,en("StructArrayLayout1f4",ao);class Zf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const w=3*a;return this.uint16[6*a+0]=u,this.float32[w+1]=f,this.float32[w+2]=y,a}}Zf.prototype.bytesPerElement=12,en("StructArrayLayout1ui2f12",Zf);class Th extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u,f){const y=this.length;return this.resize(y+1),this.emplace(y,a,u,f)}emplace(a,u,f,y){const w=4*a;return this.uint32[2*a+0]=u,this.uint16[w+2]=f,this.uint16[w+3]=y,a}}Th.prototype.bytesPerElement=8,en("StructArrayLayout1ul2ui8",Th);class Oo extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a,u){const f=this.length;return this.resize(f+1),this.emplace(f,a,u)}emplace(a,u,f){const y=2*a;return this.uint16[y+0]=u,this.uint16[y+1]=f,a}}Oo.prototype.bytesPerElement=4,en("StructArrayLayout2ui4",Oo);class Yf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(a){const u=this.length;return this.resize(u+1),this.emplace(u,a)}emplace(a,u){return this.uint16[1*a+0]=u,a}}Yf.prototype.bytesPerElement=2,en("StructArrayLayout1ui2",Yf);class Kf extends zi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(a,u,f,y){const w=this.length;return this.resize(w+1),this.emplace(w,a,u,f,y)}emplace(a,u,f,y,w){const T=4*a;return this.float32[T+0]=u,this.float32[T+1]=f,this.float32[T+2]=y,this.float32[T+3]=w,a}}Kf.prototype.bytesPerElement=16,en("StructArrayLayout4f16",Kf);class Jf extends Gl{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new M(this.anchorPointX,this.anchorPointY)}}Jf.prototype.size=20;class Fm extends Rs{get(a){return new Jf(this,a)}}en("CollisionBoxArray",Fm);class _ extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(a){this._structArray.uint8[this._pos1+37]=a}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(a){this._structArray.uint8[this._pos1+38]=a}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(a){this._structArray.uint32[this._pos4+10]=a}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}_.prototype.size=48;class s extends Xf{get(a){return new _(this,a)}}en("PlacedSymbolArray",s);class d extends Gl{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(a){this._structArray.uint32[this._pos4+12]=a}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}d.prototype.size=64;class m extends Wl{get(a){return new d(this,a)}}en("SymbolInstanceArray",m);class g extends ao{getoffsetX(a){return this.float32[1*a+0]}}en("GlyphOffsetArray",g);class b extends bh{getx(a){return this.int16[3*a+0]}gety(a){return this.int16[3*a+1]}gettileUnitDistanceFromAnchor(a){return this.int16[3*a+2]}}en("SymbolLineVertexArray",b);class P extends Gl{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}P.prototype.size=12;class R extends Zf{get(a){return new P(this,a)}}en("TextAnchorOffsetArray",R);class D extends Gl{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}D.prototype.size=8;class H extends Th{get(a){return new D(this,a)}}en("FeatureIndexArray",H);class $ extends au{}class Z extends au{}class se extends au{}class _e extends Gf{}class ve extends jf{}class we extends su{}class fe extends Wf{}class ze extends wh{}class $e extends qf{}class Te extends $f{}class Be extends Sh{}class Ke extends Mh{}class Qe extends jl{}class lt extends Oo{}const bt=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:vt}=bt;class xt{constructor(a=[]){this.segments=a}prepareSegment(a,u,f,y){let w=this.segments[this.segments.length-1];return a>xt.MAX_VERTEX_ARRAY_LENGTH&&Ae(`Max vertices per segment is ${xt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${a}`),(!w||w.vertexLength+a>xt.MAX_VERTEX_ARRAY_LENGTH||w.sortKey!==y)&&(w={vertexOffset:u.length,primitiveOffset:f.length,vertexLength:0,primitiveLength:0},y!==void 0&&(w.sortKey=y),this.segments.push(w)),w}get(){return this.segments}destroy(){for(const a of this.segments)for(const u in a.vaos)a.vaos[u].destroy()}static simpleSegment(a,u,f,y){return new xt([{vertexOffset:a,primitiveOffset:u,vertexLength:f,primitiveLength:y,vaos:{},sortKey:0}])}}function Zt(c,a){return 256*(c=ue(Math.floor(c),0,255))+ue(Math.floor(a),0,255)}xt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,en("SegmentVector",xt);const zn=Wi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Bt={exports:{}},Tn={exports:{}};Tn.exports=function(c,a){var u,f,y,w,T,E,I,z;for(f=c.length-(u=3&c.length),y=a,T=3432918353,E=461845907,z=0;z<f;)I=255&c.charCodeAt(z)|(255&c.charCodeAt(++z))<<8|(255&c.charCodeAt(++z))<<16|(255&c.charCodeAt(++z))<<24,++z,y=27492+(65535&(w=5*(65535&(y=(y^=I=(65535&(I=(I=(65535&I)*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295)<<13|y>>>19))+((5*(y>>>16)&65535)<<16)&4294967295))+((58964+(w>>>16)&65535)<<16);switch(I=0,u){case 3:I^=(255&c.charCodeAt(z+2))<<16;case 2:I^=(255&c.charCodeAt(z+1))<<8;case 1:y^=I=(65535&(I=(I=(65535&(I^=255&c.charCodeAt(z)))*T+(((I>>>16)*T&65535)<<16)&4294967295)<<15|I>>>17))*E+(((I>>>16)*E&65535)<<16)&4294967295}return y^=c.length,y=2246822507*(65535&(y^=y>>>16))+((2246822507*(y>>>16)&65535)<<16)&4294967295,y=3266489909*(65535&(y^=y>>>13))+((3266489909*(y>>>16)&65535)<<16)&4294967295,(y^=y>>>16)>>>0};var Nn=Tn.exports,Xn={exports:{}};Xn.exports=function(c,a){for(var u,f=c.length,y=a^f,w=0;f>=4;)u=1540483477*(65535&(u=255&c.charCodeAt(w)|(255&c.charCodeAt(++w))<<8|(255&c.charCodeAt(++w))<<16|(255&c.charCodeAt(++w))<<24))+((1540483477*(u>>>16)&65535)<<16),y=1540483477*(65535&y)+((1540483477*(y>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++w;switch(f){case 3:y^=(255&c.charCodeAt(w+2))<<16;case 2:y^=(255&c.charCodeAt(w+1))<<8;case 1:y=1540483477*(65535&(y^=255&c.charCodeAt(w)))+((1540483477*(y>>>16)&65535)<<16)}return y=1540483477*(65535&(y^=y>>>13))+((1540483477*(y>>>16)&65535)<<16),(y^=y>>>15)>>>0};var Rn=Nn,Vn=Xn.exports;Bt.exports=Rn,Bt.exports.murmur3=Rn,Bt.exports.murmur2=Vn;var Hn=p(Bt.exports);class Ii{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(a,u,f,y){this.ids.push(mi(a)),this.positions.push(u,f,y)}getPositions(a){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const u=mi(a);let f=0,y=this.ids.length-1;for(;f<y;){const T=f+y>>1;this.ids[T]>=u?y=T:f=T+1}const w=[];for(;this.ids[f]===u;)w.push({index:this.positions[3*f],start:this.positions[3*f+1],end:this.positions[3*f+2]}),f++;return w}static serialize(a,u){const f=new Float64Array(a.ids),y=new Uint32Array(a.positions);return qr(f,y,0,f.length-1),u&&u.push(f.buffer,y.buffer),{ids:f,positions:y}}static deserialize(a){const u=new Ii;return u.ids=a.ids,u.positions=a.positions,u.indexed=!0,u}}function mi(c){const a=+c;return!isNaN(a)&&a<=Number.MAX_SAFE_INTEGER?a:Hn(String(c))}function qr(c,a,u,f){for(;u<f;){const y=c[u+f>>1];let w=u-1,T=f+1;for(;;){do w++;while(c[w]<y);do T--;while(c[T]>y);if(w>=T)break;Qi(c,w,T),Qi(a,3*w,3*T),Qi(a,3*w+1,3*T+1),Qi(a,3*w+2,3*T+2)}T-u<f-T?(qr(c,a,u,T),u=T+1):(qr(c,a,T+1,f),f=T)}}function Qi(c,a,u){const f=c[a];c[a]=c[u],c[u]=f}en("FeaturePositionMap",Ii);class vi{constructor(a,u){this.gl=a.gl,this.location=u}}class Er extends vi{constructor(a,u){super(a,u),this.current=0}set(a){this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class Ua extends vi{constructor(a,u){super(a,u),this.current=[0,0,0,0]}set(a){a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3]))}}class cs extends vi{constructor(a,u){super(a,u),this.current=Xt.transparent}set(a){a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a))}}const Uo=new Float32Array(16);function Vo(c){return[Zt(255*c.r,255*c.g),Zt(255*c.b,255*c.a)]}class us{constructor(a,u,f){this.value=a,this.uniformNames=u.map(y=>`u_${y}`),this.type=f}setUniform(a,u,f){a.set(f.constantOr(this.value))}getBinding(a,u,f){return this.type==="color"?new cs(a,u):new Er(a,u)}}class Va{constructor(a,u){this.uniformNames=u.map(f=>`u_${f}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(a,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=a.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=a.tlbr}setUniform(a,u,f,y){const w=y==="u_pattern_to"?this.patternTo:y==="u_pattern_from"?this.patternFrom:y==="u_pixel_ratio_to"?this.pixelRatioTo:y==="u_pixel_ratio_from"?this.pixelRatioFrom:null;w&&a.set(w)}getBinding(a,u,f){return f.substr(0,9)==="u_pattern"?new Ua(a,u):new Er(a,u)}}class Fi{constructor(a,u,f,y){this.expression=a,this.type=f,this.maxValue=0,this.paintVertexAttributes=u.map(w=>({name:`a_${w}`,type:"Float32",components:f==="color"?2:1,offset:0})),this.paintVertexArray=new y}populatePaintArray(a,u,f,y,w){const T=this.paintVertexArray.length,E=this.expression.evaluate(new bi(0),u,{},y,[],w);this.paintVertexArray.resize(a),this._setPaintValue(T,a,E)}updatePaintArray(a,u,f,y){const w=this.expression.evaluate({zoom:0},f,y);this._setPaintValue(a,u,w)}_setPaintValue(a,u,f){if(this.type==="color"){const y=Vo(f);for(let w=a;w<u;w++)this.paintVertexArray.emplace(w,y[0],y[1])}else{for(let y=a;y<u;y++)this.paintVertexArray.emplace(y,f);this.maxValue=Math.max(this.maxValue,Math.abs(f))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class wi{constructor(a,u,f,y,w,T){this.expression=a,this.uniformNames=u.map(E=>`u_${E}_t`),this.type=f,this.useIntegerZoom=y,this.zoom=w,this.maxValue=0,this.paintVertexAttributes=u.map(E=>({name:`a_${E}`,type:"Float32",components:f==="color"?4:2,offset:0})),this.paintVertexArray=new T}populatePaintArray(a,u,f,y,w){const T=this.expression.evaluate(new bi(this.zoom),u,{},y,[],w),E=this.expression.evaluate(new bi(this.zoom+1),u,{},y,[],w),I=this.paintVertexArray.length;this.paintVertexArray.resize(a),this._setPaintValue(I,a,T,E)}updatePaintArray(a,u,f,y){const w=this.expression.evaluate({zoom:this.zoom},f,y),T=this.expression.evaluate({zoom:this.zoom+1},f,y);this._setPaintValue(a,u,w,T)}_setPaintValue(a,u,f,y){if(this.type==="color"){const w=Vo(f),T=Vo(y);for(let E=a;E<u;E++)this.paintVertexArray.emplace(E,w[0],w[1],T[0],T[1])}else{for(let w=a;w<u;w++)this.paintVertexArray.emplace(w,f,y);this.maxValue=Math.max(this.maxValue,Math.abs(f),Math.abs(y))}}upload(a){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=a.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(a,u){const f=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,y=ue(this.expression.interpolationFactor(f,this.zoom,this.zoom+1),0,1);a.set(y)}getBinding(a,u,f){return new Er(a,u)}}class Vi{constructor(a,u,f,y,w,T){this.expression=a,this.type=u,this.useIntegerZoom=f,this.zoom=y,this.layerId=T,this.zoomInPaintVertexArray=new w,this.zoomOutPaintVertexArray=new w}populatePaintArray(a,u,f){const y=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(a),this.zoomOutPaintVertexArray.resize(a),this._setPaintValues(y,a,u.patterns&&u.patterns[this.layerId],f)}updatePaintArray(a,u,f,y,w){this._setPaintValues(a,u,f.patterns&&f.patterns[this.layerId],w)}_setPaintValues(a,u,f,y){if(!y||!f)return;const{min:w,mid:T,max:E}=f,I=y[w],z=y[T],j=y[E];if(I&&z&&j)for(let W=a;W<u;W++)this.zoomInPaintVertexArray.emplace(W,z.tl[0],z.tl[1],z.br[0],z.br[1],I.tl[0],I.tl[1],I.br[0],I.br[1],z.pixelRatio,I.pixelRatio),this.zoomOutPaintVertexArray.emplace(W,z.tl[0],z.tl[1],z.br[0],z.br[1],j.tl[0],j.tl[1],j.br[0],j.br[1],z.pixelRatio,j.pixelRatio)}upload(a){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=a.createVertexBuffer(this.zoomInPaintVertexArray,zn.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=a.createVertexBuffer(this.zoomOutPaintVertexArray,zn.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ql{constructor(a,u,f){this.binders={},this._buffers=[];const y=[];for(const w in a.paint._values){if(!f(w))continue;const T=a.paint.get(w);if(!(T instanceof Ba&&Dl(T.property.specification)))continue;const E=mr(w,a.type),I=T.value,z=T.property.specification.type,j=T.property.useIntegerZoom,W=T.property.specification["property-type"],K=W==="cross-faded"||W==="cross-faded-data-driven";if(I.kind==="constant")this.binders[w]=K?new Va(I.value,E):new us(I.value,E,z),y.push(`/u_${w}`);else if(I.kind==="source"||K){const ae=ca(w,z,"source");this.binders[w]=K?new Vi(I,z,j,u,ae,a.id):new Fi(I,E,z,ae),y.push(`/a_${w}`)}else{const ae=ca(w,z,"composite");this.binders[w]=new wi(I,E,z,j,u,ae),y.push(`/z_${w}`)}}this.cacheKey=y.sort().join("")}getMaxValue(a){const u=this.binders[a];return u instanceof Fi||u instanceof wi?u.maxValue:0}populatePaintArrays(a,u,f,y,w){for(const T in this.binders){const E=this.binders[T];(E instanceof Fi||E instanceof wi||E instanceof Vi)&&E.populatePaintArray(a,u,f,y,w)}}setConstantPatternPositions(a,u){for(const f in this.binders){const y=this.binders[f];y instanceof Va&&y.setConstantPatternPositions(a,u)}}updatePaintArrays(a,u,f,y,w){let T=!1;for(const E in a){const I=u.getPositions(E);for(const z of I){const j=f.feature(z.index);for(const W in this.binders){const K=this.binders[W];if((K instanceof Fi||K instanceof wi||K instanceof Vi)&&K.expression.isStateDependent===!0){const ae=y.paint.get(W);K.expression=ae.value,K.updatePaintArray(z.start,z.end,j,a[E],w),T=!0}}}}return T}defines(){const a=[];for(const u in this.binders){const f=this.binders[u];(f instanceof us||f instanceof Va)&&a.push(...f.uniformNames.map(y=>`#define HAS_UNIFORM_${y}`))}return a}getBinderAttributes(){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof Fi||f instanceof wi)for(let y=0;y<f.paintVertexAttributes.length;y++)a.push(f.paintVertexAttributes[y].name);else if(f instanceof Vi)for(let y=0;y<zn.members.length;y++)a.push(zn.members[y].name)}return a}getBinderUniforms(){const a=[];for(const u in this.binders){const f=this.binders[u];if(f instanceof us||f instanceof Va||f instanceof wi)for(const y of f.uniformNames)a.push(y)}return a}getPaintVertexBuffers(){return this._buffers}getUniforms(a,u){const f=[];for(const y in this.binders){const w=this.binders[y];if(w instanceof us||w instanceof Va||w instanceof wi){for(const T of w.uniformNames)if(u[T]){const E=w.getBinding(a,u[T],T);f.push({name:T,property:y,binding:E})}}}return f}setUniforms(a,u,f,y){for(const{name:w,property:T,binding:E}of u)this.binders[T].setUniform(E,y,f.get(T),w)}updatePaintBuffers(a){this._buffers=[];for(const u in this.binders){const f=this.binders[u];if(a&&f instanceof Vi){const y=a.fromScale===2?f.zoomInPaintVertexBuffer:f.zoomOutPaintVertexBuffer;y&&this._buffers.push(y)}else(f instanceof Fi||f instanceof wi)&&f.paintVertexBuffer&&this._buffers.push(f.paintVertexBuffer)}}upload(a){for(const u in this.binders){const f=this.binders[u];(f instanceof Fi||f instanceof wi||f instanceof Vi)&&f.upload(a)}this.updatePaintBuffers()}destroy(){for(const a in this.binders){const u=this.binders[a];(u instanceof Fi||u instanceof wi||u instanceof Vi)&&u.destroy()}}}class Ai{constructor(a,u,f=()=>!0){this.programConfigurations={};for(const y of a)this.programConfigurations[y.id]=new ql(y,u,f);this.needsUpload=!1,this._featureMap=new Ii,this._bufferOffset=0}populatePaintArrays(a,u,f,y,w,T){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(a,u,y,w,T);u.id!==void 0&&this._featureMap.add(u.id,f,this._bufferOffset,a),this._bufferOffset=a,this.needsUpload=!0}updatePaintArrays(a,u,f,y){for(const w of f)this.needsUpload=this.programConfigurations[w.id].updatePaintArrays(a,this._featureMap,u,w,y)||this.needsUpload}get(a){return this.programConfigurations[a]}upload(a){if(this.needsUpload){for(const u in this.programConfigurations)this.programConfigurations[u].upload(a);this.needsUpload=!1}}destroy(){for(const a in this.programConfigurations)this.programConfigurations[a].destroy()}}function mr(c,a){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[c]||[c.replace(`${a}-`,"").replace(/-/g,"_")]}function ca(c,a,u){const f={color:{source:su,composite:Kf},number:{source:ao,composite:su}},y=function(w){return{"line-pattern":{source:fe,composite:fe},"fill-pattern":{source:fe,composite:fe},"fill-extrusion-pattern":{source:fe,composite:fe}}[w]}(c);return y&&y[u]||f[a][u]}en("ConstantBinder",us),en("CrossFadedConstantBinder",Va),en("SourceExpressionBinder",Fi),en("CrossFadedCompositeBinder",Vi),en("CompositeExpressionBinder",wi),en("ProgramConfiguration",ql,{omit:["_buffers"]}),en("ProgramConfigurationSet",Ai);const qn=8192,Qf=Math.pow(2,14)-1,Nm=-Qf-1;function Ho(c){const a=qn/c.extent,u=c.loadGeometry();for(let f=0;f<u.length;f++){const y=u[f];for(let w=0;w<y.length;w++){const T=y[w],E=Math.round(T.x*a),I=Math.round(T.y*a);T.x=ue(E,Nm,Qf),T.y=ue(I,Nm,Qf),(E<T.x||E>T.x+1||I<T.y||I>T.y+1)&&Ae("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return u}function Go(c,a){return{type:c.type,id:c.id,properties:c.properties,geometry:a?Ho(c):[]}}function Eh(c,a,u,f,y){c.emplaceBack(2*a+(f+1)/2,2*u+(y+1)/2)}class e0{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new Z,this.indexArray=new Qe,this.segments=new xt,this.programConfigurations=new Ai(a.layers,a.zoom),this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){const y=this.layers[0],w=[];let T=null,E=!1;y.type==="circle"&&(T=y.layout.get("circle-sort-key"),E=!T.isConstant());for(const{feature:I,id:z,index:j,sourceLayerIndex:W}of a){const K=this.layers[0]._featureFilter.needGeometry,ae=Go(I,K);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),ae,f))continue;const oe=E?T.evaluate(ae,{},f):void 0,pe={id:z,properties:I.properties,type:I.type,sourceLayerIndex:W,index:j,geometry:K?ae.geometry:Ho(I),patterns:{},sortKey:oe};w.push(pe)}E&&w.sort((I,z)=>I.sortKey-z.sortKey);for(const I of w){const{geometry:z,index:j,sourceLayerIndex:W}=I,K=a[j].feature;this.addFeature(I,z,j,f),u.featureIndex.insert(K,z,j,W,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,vt),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(a,u,f,y){for(const w of u)for(const T of w){const E=T.x,I=T.y;if(E<0||E>=qn||I<0||I>=qn)continue;const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,a.sortKey),j=z.vertexLength;Eh(this.layoutVertexArray,E,I,-1,-1),Eh(this.layoutVertexArray,E,I,1,-1),Eh(this.layoutVertexArray,E,I,1,1),Eh(this.layoutVertexArray,E,I,-1,1),this.indexArray.emplaceBack(j,j+1,j+2),this.indexArray.emplaceBack(j,j+3,j+2),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,{},y)}}function jo(c,a){for(let u=0;u<c.length;u++)if(Ah(a,c[u]))return!0;for(let u=0;u<a.length;u++)if(Ah(c,a[u]))return!0;return!!lu(c,a)}function Bm(c,a,u){return!!Ah(c,a)||!!cu(a,c,u)}function t0(c,a){if(c.length===1)return e4(a,c[0]);for(let u=0;u<a.length;u++){const f=a[u];for(let y=0;y<f.length;y++)if(Ah(c,f[y]))return!0}for(let u=0;u<c.length;u++)if(e4(a,c[u]))return!0;for(let u=0;u<a.length;u++)if(lu(c,a[u]))return!0;return!1}function Om(c,a,u){if(c.length>1){if(lu(c,a))return!0;for(let f=0;f<a.length;f++)if(cu(a[f],c,u))return!0}for(let f=0;f<c.length;f++)if(cu(c[f],a,u))return!0;return!1}function lu(c,a){if(c.length===0||a.length===0)return!1;for(let u=0;u<c.length-1;u++){const f=c[u],y=c[u+1];for(let w=0;w<a.length-1;w++)if(Um(f,y,a[w],a[w+1]))return!0}return!1}function Um(c,a,u,f){return He(c,u,f)!==He(a,u,f)&&He(c,a,u)!==He(c,a,f)}function cu(c,a,u){const f=u*u;if(a.length===1)return c.distSqr(a[0])<f;for(let y=1;y<a.length;y++)if(Qw(c,a[y-1],a[y])<f)return!0;return!1}function Qw(c,a,u){const f=a.distSqr(u);if(f===0)return c.distSqr(a);const y=((c.x-a.x)*(u.x-a.x)+(c.y-a.y)*(u.y-a.y))/f;return c.distSqr(y<0?a:y>1?u:u.sub(a)._mult(y)._add(a))}function e4(c,a){let u,f,y,w=!1;for(let T=0;T<c.length;T++){u=c[T];for(let E=0,I=u.length-1;E<u.length;I=E++)f=u[E],y=u[I],f.y>a.y!=y.y>a.y&&a.x<(y.x-f.x)*(a.y-f.y)/(y.y-f.y)+f.x&&(w=!w)}return w}function Ah(c,a){let u=!1;for(let f=0,y=c.length-1;f<c.length;y=f++){const w=c[f],T=c[y];w.y>a.y!=T.y>a.y&&a.x<(T.x-w.x)*(a.y-w.y)/(T.y-w.y)+w.x&&(u=!u)}return u}function K7(c,a,u){const f=u[0],y=u[2];if(c.x<f.x&&a.x<f.x||c.x>y.x&&a.x>y.x||c.y<f.y&&a.y<f.y||c.y>y.y&&a.y>y.y)return!1;const w=He(c,a,u[0]);return w!==He(c,a,u[1])||w!==He(c,a,u[2])||w!==He(c,a,u[3])}function n0(c,a,u){const f=a.paint.get(c).value;return f.kind==="constant"?f.value:u.programConfigurations.get(a.id).getMaxValue(c)}function Vm(c){return Math.sqrt(c[0]*c[0]+c[1]*c[1])}function Hm(c,a,u,f,y){if(!a[0]&&!a[1])return c;const w=M.convert(a)._mult(y);u==="viewport"&&w._rotate(-f);const T=[];for(let E=0;E<c.length;E++)T.push(c[E].sub(w));return T}let t4,n4;en("CircleBucket",e0,{omit:["layers"]});var J7={get paint(){return n4=n4||new Wr({"circle-radius":new Mn(ie.paint_circle["circle-radius"]),"circle-color":new Mn(ie.paint_circle["circle-color"]),"circle-blur":new Mn(ie.paint_circle["circle-blur"]),"circle-opacity":new Mn(ie.paint_circle["circle-opacity"]),"circle-translate":new pn(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new pn(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new pn(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new pn(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Mn(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Mn(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Mn(ie.paint_circle["circle-stroke-opacity"])})},get layout(){return t4=t4||new Wr({"circle-sort-key":new Mn(ie.layout_circle["circle-sort-key"])})}},$r=1e-6,Ch=typeof Float32Array<"u"?Float32Array:Array;function Mv(c){return c[0]=1,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=1,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=1,c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c}function i4(c,a,u){var f=a[0],y=a[1],w=a[2],T=a[3],E=a[4],I=a[5],z=a[6],j=a[7],W=a[8],K=a[9],ae=a[10],oe=a[11],pe=a[12],be=a[13],Pe=a[14],Ve=a[15],ke=u[0],Ne=u[1],ht=u[2],yt=u[3];return c[0]=ke*f+Ne*E+ht*W+yt*pe,c[1]=ke*y+Ne*I+ht*K+yt*be,c[2]=ke*w+Ne*z+ht*ae+yt*Pe,c[3]=ke*T+Ne*j+ht*oe+yt*Ve,c[4]=(ke=u[4])*f+(Ne=u[5])*E+(ht=u[6])*W+(yt=u[7])*pe,c[5]=ke*y+Ne*I+ht*K+yt*be,c[6]=ke*w+Ne*z+ht*ae+yt*Pe,c[7]=ke*T+Ne*j+ht*oe+yt*Ve,c[8]=(ke=u[8])*f+(Ne=u[9])*E+(ht=u[10])*W+(yt=u[11])*pe,c[9]=ke*y+Ne*I+ht*K+yt*be,c[10]=ke*w+Ne*z+ht*ae+yt*Pe,c[11]=ke*T+Ne*j+ht*oe+yt*Ve,c[12]=(ke=u[12])*f+(Ne=u[13])*E+(ht=u[14])*W+(yt=u[15])*pe,c[13]=ke*y+Ne*I+ht*K+yt*be,c[14]=ke*w+Ne*z+ht*ae+yt*Pe,c[15]=ke*T+Ne*j+ht*oe+yt*Ve,c}Math.hypot||(Math.hypot=function(){for(var c=0,a=arguments.length;a--;)c+=arguments[a]*arguments[a];return Math.sqrt(c)});var i0,Q7=i4;function Gm(c,a,u){var f=a[0],y=a[1],w=a[2],T=a[3];return c[0]=u[0]*f+u[4]*y+u[8]*w+u[12]*T,c[1]=u[1]*f+u[5]*y+u[9]*w+u[13]*T,c[2]=u[2]*f+u[6]*y+u[10]*w+u[14]*T,c[3]=u[3]*f+u[7]*y+u[11]*w+u[15]*T,c}i0=new Ch(4),Ch!=Float32Array&&(i0[0]=0,i0[1]=0,i0[2]=0,i0[3]=0);class eC extends Oa{constructor(a){super(a,J7)}createBucket(a){return new e0(a)}queryRadius(a){const u=a;return n0("circle-radius",this,u)+n0("circle-stroke-width",this,u)+Vm(this.paint.get("circle-translate"))}queryIntersectsFeature(a,u,f,y,w,T,E,I){const z=Hm(a,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),T.angle,E),j=this.paint.get("circle-radius").evaluate(u,f)+this.paint.get("circle-stroke-width").evaluate(u,f),W=this.paint.get("circle-pitch-alignment")==="map",K=W?z:function(oe,pe){return oe.map(be=>r4(be,pe))}(z,I),ae=W?j*E:j;for(const oe of y)for(const pe of oe){const be=W?pe:r4(pe,I);let Pe=ae;const Ve=Gm([],[pe.x,pe.y,0,1],I);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?Pe*=Ve[3]/T.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(Pe*=T.cameraToCenterDistance/Ve[3]),Bm(K,be,Pe))return!0}return!1}}function r4(c,a){const u=Gm([],[c.x,c.y,0,1],a);return new M(u[0]/u[3],u[1]/u[3])}class a4 extends e0{}let s4;en("HeatmapBucket",a4,{omit:["layers"]});var tC={get paint(){return s4=s4||new Wr({"heatmap-radius":new Mn(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Mn(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new pn(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new ru(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new pn(ie.paint_heatmap["heatmap-opacity"])})}};function Tv(c,{width:a,height:u},f,y){if(y){if(y instanceof Uint8ClampedArray)y=new Uint8Array(y.buffer);else if(y.length!==a*u*f)throw new RangeError(`mismatched image size. expected: ${y.length} but got: ${a*u*f}`)}else y=new Uint8Array(a*u*f);return c.width=a,c.height=u,c.data=y,c}function o4(c,{width:a,height:u},f){if(a===c.width&&u===c.height)return;const y=Tv({},{width:a,height:u},f);Ev(c,y,{x:0,y:0},{x:0,y:0},{width:Math.min(c.width,a),height:Math.min(c.height,u)},f),c.width=a,c.height=u,c.data=y.data}function Ev(c,a,u,f,y,w){if(y.width===0||y.height===0)return a;if(y.width>c.width||y.height>c.height||u.x>c.width-y.width||u.y>c.height-y.height)throw new RangeError("out of range source coordinates for image copy");if(y.width>a.width||y.height>a.height||f.x>a.width-y.width||f.y>a.height-y.height)throw new RangeError("out of range destination coordinates for image copy");const T=c.data,E=a.data;if(T===E)throw new Error("srcData equals dstData, so image is already copied");for(let I=0;I<y.height;I++){const z=((u.y+I)*c.width+u.x)*w,j=((f.y+I)*a.width+f.x)*w;for(let W=0;W<y.width*w;W++)E[j+W]=T[z+W]}return a}class r0{constructor(a,u){Tv(this,a,1,u)}resize(a){o4(this,a,1)}clone(){return new r0({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,f,y,w){Ev(a,u,f,y,w,1)}}class Ha{constructor(a,u){Tv(this,a,4,u)}resize(a){o4(this,a,4)}replace(a,u){u?this.data.set(a):this.data=a instanceof Uint8ClampedArray?new Uint8Array(a.buffer):a}clone(){return new Ha({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(a,u,f,y,w){Ev(a,u,f,y,w,4)}}function l4(c){const a={},u=c.resolution||256,f=c.clips?c.clips.length:1,y=c.image||new Ha({width:u,height:f});if(Math.log(u)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${u}`);const w=(T,E,I)=>{a[c.evaluationKey]=I;const z=c.expression.evaluate(a);y.data[T+E+0]=Math.floor(255*z.r/z.a),y.data[T+E+1]=Math.floor(255*z.g/z.a),y.data[T+E+2]=Math.floor(255*z.b/z.a),y.data[T+E+3]=Math.floor(255*z.a)};if(c.clips)for(let T=0,E=0;T<f;++T,E+=4*u)for(let I=0,z=0;I<u;I++,z+=4){const j=I/(u-1),{start:W,end:K}=c.clips[T];w(E,z,W*(1-j)+K*j)}else for(let T=0,E=0;T<u;T++,E+=4)w(0,E,T/(u-1));return y}en("AlphaImage",r0),en("RGBAImage",Ha);class nC extends Oa{createBucket(a){return new a4(a)}constructor(a){super(a,tC),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=l4({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let c4;var iC={get paint(){return c4=c4||new Wr({"hillshade-illumination-direction":new pn(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new pn(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new pn(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new pn(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new pn(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new pn(ie.paint_hillshade["hillshade-accent-color"])})}};class rC extends Oa{constructor(a){super(a,iC)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const aC=Wi([{name:"a_pos",components:2,type:"Int16"}],4),{members:sC}=aC;var Av={exports:{}};function jm(c,a,u){u=u||2;var f,y,w,T,E,I,z,j=a&&a.length,W=j?a[0]*u:c.length,K=u4(c,0,W,u,!0),ae=[];if(!K||K.next===K.prev)return ae;if(j&&(K=function(pe,be,Pe,Ve){var ke,Ne,ht,yt=[];for(ke=0,Ne=be.length;ke<Ne;ke++)(ht=u4(pe,be[ke]*Ve,ke<Ne-1?be[ke+1]*Ve:pe.length,Ve,!1))===ht.next&&(ht.steiner=!0),yt.push(pC(ht));for(yt.sort(hC),ke=0;ke<yt.length;ke++)Pe=dC(yt[ke],Pe);return Pe}(c,a,K,u)),c.length>80*u){f=w=c[0],y=T=c[1];for(var oe=u;oe<W;oe+=u)(E=c[oe])<f&&(f=E),(I=c[oe+1])<y&&(y=I),E>w&&(w=E),I>T&&(T=I);z=(z=Math.max(w-f,T-y))!==0?32767/z:0}return a0(K,ae,u,f,y,z,0),ae}function u4(c,a,u,f,y){var w,T;if(y===Rv(c,a,u,f)>0)for(w=a;w<u;w+=f)T=f4(w,c[w],c[w+1],T);else for(w=u-f;w>=a;w-=f)T=f4(w,c[w],c[w+1],T);return T&&Wm(T,T.next)&&(o0(T),T=T.next),T}function uu(c,a){if(!c)return c;a||(a=c);var u,f=c;do if(u=!1,f.steiner||!Wm(f,f.next)&&qi(f.prev,f,f.next)!==0)f=f.next;else{if(o0(f),(f=a=f.prev)===f.next)break;u=!0}while(u||f!==a);return a}function a0(c,a,u,f,y,w,T){if(c){!T&&w&&function(j,W,K,ae){var oe=j;do oe.z===0&&(oe.z=Cv(oe.x,oe.y,W,K,ae)),oe.prevZ=oe.prev,oe.nextZ=oe.next,oe=oe.next;while(oe!==j);oe.prevZ.nextZ=null,oe.prevZ=null,function(pe){var be,Pe,Ve,ke,Ne,ht,yt,Wt,un=1;do{for(Pe=pe,pe=null,Ne=null,ht=0;Pe;){for(ht++,Ve=Pe,yt=0,be=0;be<un&&(yt++,Ve=Ve.nextZ);be++);for(Wt=un;yt>0||Wt>0&&Ve;)yt!==0&&(Wt===0||!Ve||Pe.z<=Ve.z)?(ke=Pe,Pe=Pe.nextZ,yt--):(ke=Ve,Ve=Ve.nextZ,Wt--),Ne?Ne.nextZ=ke:pe=ke,ke.prevZ=Ne,Ne=ke;Pe=Ve}Ne.nextZ=null,un*=2}while(ht>1)}(oe)}(c,f,y,w);for(var E,I,z=c;c.prev!==c.next;)if(E=c.prev,I=c.next,w?lC(c,f,y,w):oC(c))a.push(E.i/u|0),a.push(c.i/u|0),a.push(I.i/u|0),o0(c),c=I.next,z=I.next;else if((c=I)===z){T?T===1?a0(c=cC(uu(c),a,u),a,u,f,y,w,2):T===2&&uC(c,a,u,f,y,w):a0(uu(c),a,u,f,y,w,1);break}}}function oC(c){var a=c.prev,u=c,f=c.next;if(qi(a,u,f)>=0)return!1;for(var y=a.x,w=u.x,T=f.x,E=a.y,I=u.y,z=f.y,j=y<w?y<T?y:T:w<T?w:T,W=E<I?E<z?E:z:I<z?I:z,K=y>w?y>T?y:T:w>T?w:T,ae=E>I?E>z?E:z:I>z?I:z,oe=f.next;oe!==a;){if(oe.x>=j&&oe.x<=K&&oe.y>=W&&oe.y<=ae&&Ph(y,E,w,I,T,z,oe.x,oe.y)&&qi(oe.prev,oe,oe.next)>=0)return!1;oe=oe.next}return!0}function lC(c,a,u,f){var y=c.prev,w=c,T=c.next;if(qi(y,w,T)>=0)return!1;for(var E=y.x,I=w.x,z=T.x,j=y.y,W=w.y,K=T.y,ae=E<I?E<z?E:z:I<z?I:z,oe=j<W?j<K?j:K:W<K?W:K,pe=E>I?E>z?E:z:I>z?I:z,be=j>W?j>K?j:K:W>K?W:K,Pe=Cv(ae,oe,a,u,f),Ve=Cv(pe,be,a,u,f),ke=c.prevZ,Ne=c.nextZ;ke&&ke.z>=Pe&&Ne&&Ne.z<=Ve;){if(ke.x>=ae&&ke.x<=pe&&ke.y>=oe&&ke.y<=be&&ke!==y&&ke!==T&&Ph(E,j,I,W,z,K,ke.x,ke.y)&&qi(ke.prev,ke,ke.next)>=0||(ke=ke.prevZ,Ne.x>=ae&&Ne.x<=pe&&Ne.y>=oe&&Ne.y<=be&&Ne!==y&&Ne!==T&&Ph(E,j,I,W,z,K,Ne.x,Ne.y)&&qi(Ne.prev,Ne,Ne.next)>=0))return!1;Ne=Ne.nextZ}for(;ke&&ke.z>=Pe;){if(ke.x>=ae&&ke.x<=pe&&ke.y>=oe&&ke.y<=be&&ke!==y&&ke!==T&&Ph(E,j,I,W,z,K,ke.x,ke.y)&&qi(ke.prev,ke,ke.next)>=0)return!1;ke=ke.prevZ}for(;Ne&&Ne.z<=Ve;){if(Ne.x>=ae&&Ne.x<=pe&&Ne.y>=oe&&Ne.y<=be&&Ne!==y&&Ne!==T&&Ph(E,j,I,W,z,K,Ne.x,Ne.y)&&qi(Ne.prev,Ne,Ne.next)>=0)return!1;Ne=Ne.nextZ}return!0}function cC(c,a,u){var f=c;do{var y=f.prev,w=f.next.next;!Wm(y,w)&&h4(y,f,f.next,w)&&s0(y,w)&&s0(w,y)&&(a.push(y.i/u|0),a.push(f.i/u|0),a.push(w.i/u|0),o0(f),o0(f.next),f=c=w),f=f.next}while(f!==c);return uu(f)}function uC(c,a,u,f,y,w){var T=c;do{for(var E=T.next.next;E!==T.prev;){if(T.i!==E.i&&mC(T,E)){var I=d4(T,E);return T=uu(T,T.next),I=uu(I,I.next),a0(T,a,u,f,y,w,0),void a0(I,a,u,f,y,w,0)}E=E.next}T=T.next}while(T!==c)}function hC(c,a){return c.x-a.x}function dC(c,a){var u=function(y,w){var T,E=w,I=y.x,z=y.y,j=-1/0;do{if(z<=E.y&&z>=E.next.y&&E.next.y!==E.y){var W=E.x+(z-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(W<=I&&W>j&&(j=W,T=E.x<E.next.x?E:E.next,W===I))return T}E=E.next}while(E!==w);if(!T)return null;var K,ae=T,oe=T.x,pe=T.y,be=1/0;E=T;do I>=E.x&&E.x>=oe&&I!==E.x&&Ph(z<pe?I:j,z,oe,pe,z<pe?j:I,z,E.x,E.y)&&(K=Math.abs(z-E.y)/(I-E.x),s0(E,y)&&(K<be||K===be&&(E.x>T.x||E.x===T.x&&fC(T,E)))&&(T=E,be=K)),E=E.next;while(E!==ae);return T}(c,a);if(!u)return a;var f=d4(u,c);return uu(f,f.next),uu(u,u.next)}function fC(c,a){return qi(c.prev,c,a.prev)<0&&qi(a.next,c,c.next)<0}function Cv(c,a,u,f,y){return(c=1431655765&((c=858993459&((c=252645135&((c=16711935&((c=(c-u)*y|0)|c<<8))|c<<4))|c<<2))|c<<1))|(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-f)*y|0)|a<<8))|a<<4))|a<<2))|a<<1))<<1}function pC(c){var a=c,u=c;do(a.x<u.x||a.x===u.x&&a.y<u.y)&&(u=a),a=a.next;while(a!==c);return u}function Ph(c,a,u,f,y,w,T,E){return(y-T)*(a-E)>=(c-T)*(w-E)&&(c-T)*(f-E)>=(u-T)*(a-E)&&(u-T)*(w-E)>=(y-T)*(f-E)}function mC(c,a){return c.next.i!==a.i&&c.prev.i!==a.i&&!function(u,f){var y=u;do{if(y.i!==u.i&&y.next.i!==u.i&&y.i!==f.i&&y.next.i!==f.i&&h4(y,y.next,u,f))return!0;y=y.next}while(y!==u);return!1}(c,a)&&(s0(c,a)&&s0(a,c)&&function(u,f){var y=u,w=!1,T=(u.x+f.x)/2,E=(u.y+f.y)/2;do y.y>E!=y.next.y>E&&y.next.y!==y.y&&T<(y.next.x-y.x)*(E-y.y)/(y.next.y-y.y)+y.x&&(w=!w),y=y.next;while(y!==u);return w}(c,a)&&(qi(c.prev,c,a.prev)||qi(c,a.prev,a))||Wm(c,a)&&qi(c.prev,c,c.next)>0&&qi(a.prev,a,a.next)>0)}function qi(c,a,u){return(a.y-c.y)*(u.x-a.x)-(a.x-c.x)*(u.y-a.y)}function Wm(c,a){return c.x===a.x&&c.y===a.y}function h4(c,a,u,f){var y=$m(qi(c,a,u)),w=$m(qi(c,a,f)),T=$m(qi(u,f,c)),E=$m(qi(u,f,a));return y!==w&&T!==E||!(y!==0||!qm(c,u,a))||!(w!==0||!qm(c,f,a))||!(T!==0||!qm(u,c,f))||!(E!==0||!qm(u,a,f))}function qm(c,a,u){return a.x<=Math.max(c.x,u.x)&&a.x>=Math.min(c.x,u.x)&&a.y<=Math.max(c.y,u.y)&&a.y>=Math.min(c.y,u.y)}function $m(c){return c>0?1:c<0?-1:0}function s0(c,a){return qi(c.prev,c,c.next)<0?qi(c,a,c.next)>=0&&qi(c,c.prev,a)>=0:qi(c,a,c.prev)<0||qi(c,c.next,a)<0}function d4(c,a){var u=new Pv(c.i,c.x,c.y),f=new Pv(a.i,a.x,a.y),y=c.next,w=a.prev;return c.next=a,a.prev=c,u.next=y,y.prev=u,f.next=u,u.prev=f,w.next=f,f.prev=w,f}function f4(c,a,u,f){var y=new Pv(c,a,u);return f?(y.next=f.next,y.prev=f,f.next.prev=y,f.next=y):(y.prev=y,y.next=y),y}function o0(c){c.next.prev=c.prev,c.prev.next=c.next,c.prevZ&&(c.prevZ.nextZ=c.nextZ),c.nextZ&&(c.nextZ.prevZ=c.prevZ)}function Pv(c,a,u){this.i=c,this.x=a,this.y=u,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Rv(c,a,u,f){for(var y=0,w=a,T=u-f;w<u;w+=f)y+=(c[T]-c[w])*(c[w+1]+c[T+1]),T=w;return y}Av.exports=jm,Av.exports.default=jm,jm.deviation=function(c,a,u,f){var y=a&&a.length,w=Math.abs(Rv(c,0,y?a[0]*u:c.length,u));if(y)for(var T=0,E=a.length;T<E;T++)w-=Math.abs(Rv(c,a[T]*u,T<E-1?a[T+1]*u:c.length,u));var I=0;for(T=0;T<f.length;T+=3){var z=f[T]*u,j=f[T+1]*u,W=f[T+2]*u;I+=Math.abs((c[z]-c[W])*(c[j+1]-c[z+1])-(c[z]-c[j])*(c[W+1]-c[z+1]))}return w===0&&I===0?0:Math.abs((I-w)/w)},jm.flatten=function(c){for(var a=c[0][0].length,u={vertices:[],holes:[],dimensions:a},f=0,y=0;y<c.length;y++){for(var w=0;w<c[y].length;w++)for(var T=0;T<a;T++)u.vertices.push(c[y][w][T]);y>0&&u.holes.push(f+=c[y-1].length)}return u};var p4=p(Av.exports);function gC(c,a,u,f,y){m4(c,a,u||0,f||c.length-1,y||yC)}function m4(c,a,u,f,y){for(;f>u;){if(f-u>600){var w=f-u+1,T=a-u+1,E=Math.log(w),I=.5*Math.exp(2*E/3),z=.5*Math.sqrt(E*I*(w-I)/w)*(T-w/2<0?-1:1);m4(c,a,Math.max(u,Math.floor(a-T*I/w+z)),Math.min(f,Math.floor(a+(w-T)*I/w+z)),y)}var j=c[a],W=u,K=f;for(l0(c,u,a),y(c[f],j)>0&&l0(c,u,f);W<K;){for(l0(c,W,K),W++,K--;y(c[W],j)<0;)W++;for(;y(c[K],j)>0;)K--}y(c[u],j)===0?l0(c,u,K):l0(c,++K,f),K<=a&&(u=K+1),a<=K&&(f=K-1)}}function l0(c,a,u){var f=c[a];c[a]=c[u],c[u]=f}function yC(c,a){return c<a?-1:c>a?1:0}function Iv(c,a){const u=c.length;if(u<=1)return[c];const f=[];let y,w;for(let T=0;T<u;T++){const E=ot(c[T]);E!==0&&(c[T].area=Math.abs(E),w===void 0&&(w=E<0),w===E<0?(y&&f.push(y),y=[c[T]]):y.push(c[T]))}if(y&&f.push(y),a>1)for(let T=0;T<f.length;T++)f[T].length<=a||(gC(f[T],a,1,f[T].length-1,vC),f[T]=f[T].slice(0,a));return f}function vC(c,a){return a.area-c.area}function kv(c,a,u){const f=u.patternDependencies;let y=!1;for(const w of a){const T=w.paint.get(`${c}-pattern`);T.isConstant()||(y=!0);const E=T.constantOr(null);E&&(y=!0,f[E.to]=!0,f[E.from]=!0)}return y}function Dv(c,a,u,f,y){const w=y.patternDependencies;for(const T of a){const E=T.paint.get(`${c}-pattern`).value;if(E.kind!=="constant"){let I=E.evaluate({zoom:f-1},u,{},y.availableImages),z=E.evaluate({zoom:f},u,{},y.availableImages),j=E.evaluate({zoom:f+1},u,{},y.availableImages);I=I&&I.name?I.name:I,z=z&&z.name?z.name:z,j=j&&j.name?j.name:j,w[I]=!0,w[z]=!0,w[j]=!0,u.patterns[T.id]={min:I,mid:z,max:j}}}return u}class Lv{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new se,this.indexArray=new Qe,this.indexArray2=new lt,this.programConfigurations=new Ai(a.layers,a.zoom),this.segments=new xt,this.segments2=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.hasPattern=kv("fill",this.layers,u);const y=this.layers[0].layout.get("fill-sort-key"),w=!y.isConstant(),T=[];for(const{feature:E,id:I,index:z,sourceLayerIndex:j}of a){const W=this.layers[0]._featureFilter.needGeometry,K=Go(E,W);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),K,f))continue;const ae=w?y.evaluate(K,{},f,u.availableImages):void 0,oe={id:I,properties:E.properties,type:E.type,sourceLayerIndex:j,index:z,geometry:W?K.geometry:Ho(E),patterns:{},sortKey:ae};T.push(oe)}w&&T.sort((E,I)=>E.sortKey-I.sortKey);for(const E of T){const{geometry:I,index:z,sourceLayerIndex:j}=E;if(this.hasPattern){const W=Dv("fill",this.layers,E,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(E,I,z,f,{});u.featureIndex.insert(a[z].feature,I,z,j,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}addFeatures(a,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,sC),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.indexBuffer2=a.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(a,u,f,y,w){for(const T of Iv(u,500)){let E=0;for(const ae of T)E+=ae.length;const I=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),z=I.vertexLength,j=[],W=[];for(const ae of T){if(ae.length===0)continue;ae!==T[0]&&W.push(j.length/2);const oe=this.segments2.prepareSegment(ae.length,this.layoutVertexArray,this.indexArray2),pe=oe.vertexLength;this.layoutVertexArray.emplaceBack(ae[0].x,ae[0].y),this.indexArray2.emplaceBack(pe+ae.length-1,pe),j.push(ae[0].x),j.push(ae[0].y);for(let be=1;be<ae.length;be++)this.layoutVertexArray.emplaceBack(ae[be].x,ae[be].y),this.indexArray2.emplaceBack(pe+be-1,pe+be),j.push(ae[be].x),j.push(ae[be].y);oe.vertexLength+=ae.length,oe.primitiveLength+=ae.length}const K=p4(j,W);for(let ae=0;ae<K.length;ae+=3)this.indexArray.emplaceBack(z+K[ae],z+K[ae+1],z+K[ae+2]);I.vertexLength+=E,I.primitiveLength+=K.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,w,y)}}let g4,y4;en("FillBucket",Lv,{omit:["layers","patternFeatures"]});var _C={get paint(){return y4=y4||new Wr({"fill-antialias":new pn(ie.paint_fill["fill-antialias"]),"fill-opacity":new Mn(ie.paint_fill["fill-opacity"]),"fill-color":new Mn(ie.paint_fill["fill-color"]),"fill-outline-color":new Mn(ie.paint_fill["fill-outline-color"]),"fill-translate":new pn(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new pn(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bo(ie.paint_fill["fill-pattern"])})},get layout(){return g4=g4||new Wr({"fill-sort-key":new Mn(ie.layout_fill["fill-sort-key"])})}};class xC extends Oa{constructor(a){super(a,_C)}recalculate(a,u){super.recalculate(a,u);const f=this.paint._values["fill-outline-color"];f.value.kind==="constant"&&f.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new Lv(a)}queryRadius(){return Vm(this.paint.get("fill-translate"))}queryIntersectsFeature(a,u,f,y,w,T,E){return t0(Hm(a,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),T.angle,E),y)}isTileClipped(){return!0}}const bC=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),wC=Wi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:SC}=bC;var $l={},MC=v,v4=Rh;function Rh(c,a,u,f,y){this.properties={},this.extent=u,this.type=0,this._pbf=c,this._geometry=-1,this._keys=f,this._values=y,c.readFields(TC,this,a)}function TC(c,a,u){c==1?a.id=u.readVarint():c==2?function(f,y){for(var w=f.readVarint()+f.pos;f.pos<w;){var T=y._keys[f.readVarint()],E=y._values[f.readVarint()];y.properties[T]=E}}(u,a):c==3?a.type=u.readVarint():c==4&&(a._geometry=u.pos)}function EC(c){for(var a,u,f=0,y=0,w=c.length,T=w-1;y<w;T=y++)f+=((u=c[T]).x-(a=c[y]).x)*(a.y+u.y);return f}Rh.types=["Unknown","Point","LineString","Polygon"],Rh.prototype.loadGeometry=function(){var c=this._pbf;c.pos=this._geometry;for(var a,u=c.readVarint()+c.pos,f=1,y=0,w=0,T=0,E=[];c.pos<u;){if(y<=0){var I=c.readVarint();f=7&I,y=I>>3}if(y--,f===1||f===2)w+=c.readSVarint(),T+=c.readSVarint(),f===1&&(a&&E.push(a),a=[]),a.push(new MC(w,T));else{if(f!==7)throw new Error("unknown command "+f);a&&a.push(a[0].clone())}}return a&&E.push(a),E},Rh.prototype.bbox=function(){var c=this._pbf;c.pos=this._geometry;for(var a=c.readVarint()+c.pos,u=1,f=0,y=0,w=0,T=1/0,E=-1/0,I=1/0,z=-1/0;c.pos<a;){if(f<=0){var j=c.readVarint();u=7&j,f=j>>3}if(f--,u===1||u===2)(y+=c.readSVarint())<T&&(T=y),y>E&&(E=y),(w+=c.readSVarint())<I&&(I=w),w>z&&(z=w);else if(u!==7)throw new Error("unknown command "+u)}return[T,I,E,z]},Rh.prototype.toGeoJSON=function(c,a,u){var f,y,w=this.extent*Math.pow(2,u),T=this.extent*c,E=this.extent*a,I=this.loadGeometry(),z=Rh.types[this.type];function j(ae){for(var oe=0;oe<ae.length;oe++){var pe=ae[oe];ae[oe]=[360*(pe.x+T)/w-180,360/Math.PI*Math.atan(Math.exp((180-360*(pe.y+E)/w)*Math.PI/180))-90]}}switch(this.type){case 1:var W=[];for(f=0;f<I.length;f++)W[f]=I[f][0];j(I=W);break;case 2:for(f=0;f<I.length;f++)j(I[f]);break;case 3:for(I=function(ae){var oe=ae.length;if(oe<=1)return[ae];for(var pe,be,Pe=[],Ve=0;Ve<oe;Ve++){var ke=EC(ae[Ve]);ke!==0&&(be===void 0&&(be=ke<0),be===ke<0?(pe&&Pe.push(pe),pe=[ae[Ve]]):pe.push(ae[Ve]))}return pe&&Pe.push(pe),Pe}(I),f=0;f<I.length;f++)for(y=0;y<I[f].length;y++)j(I[f][y])}I.length===1?I=I[0]:z="Multi"+z;var K={type:"Feature",geometry:{type:z,coordinates:I},properties:this.properties};return"id"in this&&(K.id=this.id),K};var AC=v4,_4=x4;function x4(c,a){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=c,this._keys=[],this._values=[],this._features=[],c.readFields(CC,this,a),this.length=this._features.length}function CC(c,a,u){c===15?a.version=u.readVarint():c===1?a.name=u.readString():c===5?a.extent=u.readVarint():c===2?a._features.push(u.pos):c===3?a._keys.push(u.readString()):c===4&&a._values.push(function(f){for(var y=null,w=f.readVarint()+f.pos;f.pos<w;){var T=f.readVarint()>>3;y=T===1?f.readString():T===2?f.readFloat():T===3?f.readDouble():T===4?f.readVarint64():T===5?f.readVarint():T===6?f.readSVarint():T===7?f.readBoolean():null}return y}(u))}x4.prototype.feature=function(c){if(c<0||c>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[c];var a=this._pbf.readVarint()+this._pbf.pos;return new AC(this._pbf,a,this.extent,this._keys,this._values)};var PC=_4;function RC(c,a,u){if(c===3){var f=new PC(u,u.readVarint()+u.pos);f.length&&(a[f.name]=f)}}$l.VectorTile=function(c,a){this.layers=c.readFields(RC,{},a)},$l.VectorTileFeature=v4,$l.VectorTileLayer=_4;const IC=$l.VectorTileFeature.types,zv=Math.pow(2,13);function c0(c,a,u,f,y,w,T,E){c.emplaceBack(a,u,2*Math.floor(f*zv)+T,y*zv*2,w*zv*2,Math.round(E))}class Fv{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.layoutVertexArray=new _e,this.centroidVertexArray=new $,this.indexArray=new Qe,this.programConfigurations=new Ai(a.layers,a.zoom),this.segments=new xt,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.features=[],this.hasPattern=kv("fill-extrusion",this.layers,u);for(const{feature:y,id:w,index:T,sourceLayerIndex:E}of a){const I=this.layers[0]._featureFilter.needGeometry,z=Go(y,I);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),z,f))continue;const j={id:w,sourceLayerIndex:E,index:T,geometry:I?z.geometry:Ho(y),properties:y.properties,type:y.type,patterns:{}};this.hasPattern?this.features.push(Dv("fill-extrusion",this.layers,j,this.zoom,u)):this.addFeature(j,j.geometry,T,f,{}),u.featureIndex.insert(y,j.geometry,T,E,this.index,!0)}}addFeatures(a,u,f){for(const y of this.features){const{geometry:w}=y;this.addFeature(y,w,y.index,u,f)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,SC),this.centroidVertexBuffer=a.createVertexBuffer(this.centroidVertexArray,wC.members,!0),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(a,u,f,y,w){const T={x:0,y:0,vertexCount:0};for(const E of Iv(u,500)){let I=0;for(const oe of E)I+=oe.length;let z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const oe of E){if(oe.length===0||DC(oe))continue;let pe=0;for(let be=0;be<oe.length;be++){const Pe=oe[be];if(be>=1){const Ve=oe[be-1];if(!kC(Pe,Ve)){z.vertexLength+4>xt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ke=Pe.sub(Ve)._perp()._unit(),Ne=Ve.dist(Pe);pe+Ne>32768&&(pe=0),c0(this.layoutVertexArray,Pe.x,Pe.y,ke.x,ke.y,0,0,pe),c0(this.layoutVertexArray,Pe.x,Pe.y,ke.x,ke.y,0,1,pe),T.x+=2*Pe.x,T.y+=2*Pe.y,T.vertexCount+=2,pe+=Ne,c0(this.layoutVertexArray,Ve.x,Ve.y,ke.x,ke.y,0,0,pe),c0(this.layoutVertexArray,Ve.x,Ve.y,ke.x,ke.y,0,1,pe),T.x+=2*Ve.x,T.y+=2*Ve.y,T.vertexCount+=2;const ht=z.vertexLength;this.indexArray.emplaceBack(ht,ht+2,ht+1),this.indexArray.emplaceBack(ht+1,ht+2,ht+3),z.vertexLength+=4,z.primitiveLength+=2}}}}if(z.vertexLength+I>xt.MAX_VERTEX_ARRAY_LENGTH&&(z=this.segments.prepareSegment(I,this.layoutVertexArray,this.indexArray)),IC[a.type]!=="Polygon")continue;const j=[],W=[],K=z.vertexLength;for(const oe of E)if(oe.length!==0){oe!==E[0]&&W.push(j.length/2);for(let pe=0;pe<oe.length;pe++){const be=oe[pe];c0(this.layoutVertexArray,be.x,be.y,0,0,1,1,0),T.x+=be.x,T.y+=be.y,T.vertexCount+=1,j.push(be.x),j.push(be.y)}}const ae=p4(j,W);for(let oe=0;oe<ae.length;oe+=3)this.indexArray.emplaceBack(K+ae[oe],K+ae[oe+2],K+ae[oe+1]);z.primitiveLength+=ae.length/3,z.vertexLength+=I}for(let E=0;E<T.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(T.x/T.vertexCount),Math.floor(T.y/T.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,w,y)}}function kC(c,a){return c.x===a.x&&(c.x<0||c.x>qn)||c.y===a.y&&(c.y<0||c.y>qn)}function DC(c){return c.every(a=>a.x<0)||c.every(a=>a.x>qn)||c.every(a=>a.y<0)||c.every(a=>a.y>qn)}let b4;en("FillExtrusionBucket",Fv,{omit:["layers","features"]});var LC={get paint(){return b4=b4||new Wr({"fill-extrusion-opacity":new pn(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new pn(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new pn(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bo(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Mn(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new pn(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class zC extends Oa{constructor(a){super(a,LC)}createBucket(a){return new Fv(a)}queryRadius(){return Vm(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(a,u,f,y,w,T,E,I){const z=Hm(a,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),T.angle,E),j=this.paint.get("fill-extrusion-height").evaluate(u,f),W=this.paint.get("fill-extrusion-base").evaluate(u,f),K=function(oe,pe,be,Pe){const Ve=[];for(const ke of oe){const Ne=[ke.x,ke.y,0,1];Gm(Ne,Ne,pe),Ve.push(new M(Ne[0]/Ne[3],Ne[1]/Ne[3]))}return Ve}(z,I),ae=function(oe,pe,be,Pe){const Ve=[],ke=[],Ne=Pe[8]*pe,ht=Pe[9]*pe,yt=Pe[10]*pe,Wt=Pe[11]*pe,un=Pe[8]*be,Gt=Pe[9]*be,Vt=Pe[10]*be,Rt=Pe[11]*be;for(const sn of oe){const Ot=[],Tt=[];for(const vn of sn){const dn=vn.x,jn=vn.y,Si=Pe[0]*dn+Pe[4]*jn+Pe[12],Ci=Pe[1]*dn+Pe[5]*jn+Pe[13],sr=Pe[2]*dn+Pe[6]*jn+Pe[14],Aa=Pe[3]*dn+Pe[7]*jn+Pe[15],Xr=sr+yt,er=Aa+Wt,_r=Si+un,Cr=Ci+Gt,Zr=sr+Vt,Yr=Aa+Rt,or=new M((Si+Ne)/er,(Ci+ht)/er);or.z=Xr/er,Ot.push(or);const lr=new M(_r/Yr,Cr/Yr);lr.z=Zr/Yr,Tt.push(lr)}Ve.push(Ot),ke.push(Tt)}return[Ve,ke]}(y,W,j,I);return function(oe,pe,be){let Pe=1/0;t0(be,pe)&&(Pe=w4(be,pe[0]));for(let Ve=0;Ve<pe.length;Ve++){const ke=pe[Ve],Ne=oe[Ve];for(let ht=0;ht<ke.length-1;ht++){const yt=ke[ht],Wt=[yt,ke[ht+1],Ne[ht+1],Ne[ht],yt];jo(be,Wt)&&(Pe=Math.min(Pe,w4(be,Wt)))}}return Pe!==1/0&&Pe}(ae[0],ae[1],K)}}function u0(c,a){return c.x*a.x+c.y*a.y}function w4(c,a){if(c.length===1){let u=0;const f=a[u++];let y;for(;!y||f.equals(y);)if(y=a[u++],!y)return 1/0;for(;u<a.length;u++){const w=a[u],T=c[0],E=y.sub(f),I=w.sub(f),z=T.sub(f),j=u0(E,E),W=u0(E,I),K=u0(I,I),ae=u0(z,E),oe=u0(z,I),pe=j*K-W*W,be=(K*ae-W*oe)/pe,Pe=(j*oe-W*ae)/pe,Ve=f.z*(1-be-Pe)+y.z*be+w.z*Pe;if(isFinite(Ve))return Ve}return 1/0}{let u=1/0;for(const f of a)u=Math.min(u,f.z);return u}}const FC=Wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:NC}=FC,BC=Wi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:OC}=BC,UC=$l.VectorTileFeature.types,VC=Math.cos(Math.PI/180*37.5),S4=Math.pow(2,14)/.5;class Nv{constructor(a){this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(u=>u.id),this.index=a.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(u=>{this.gradients[u.id]={}}),this.layoutVertexArray=new ve,this.layoutVertexArray2=new we,this.indexArray=new Qe,this.programConfigurations=new Ai(a.layers,a.zoom),this.segments=new xt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(u=>u.isStateDependent()).map(u=>u.id)}populate(a,u,f){this.hasPattern=kv("line",this.layers,u);const y=this.layers[0].layout.get("line-sort-key"),w=!y.isConstant(),T=[];for(const{feature:E,id:I,index:z,sourceLayerIndex:j}of a){const W=this.layers[0]._featureFilter.needGeometry,K=Go(E,W);if(!this.layers[0]._featureFilter.filter(new bi(this.zoom),K,f))continue;const ae=w?y.evaluate(K,{},f):void 0,oe={id:I,properties:E.properties,type:E.type,sourceLayerIndex:j,index:z,geometry:W?K.geometry:Ho(E),patterns:{},sortKey:ae};T.push(oe)}w&&T.sort((E,I)=>E.sortKey-I.sortKey);for(const E of T){const{geometry:I,index:z,sourceLayerIndex:j}=E;if(this.hasPattern){const W=Dv("line",this.layers,E,this.zoom,u);this.patternFeatures.push(W)}else this.addFeature(E,I,z,f,{});u.featureIndex.insert(a[z].feature,I,z,j,this.index)}}update(a,u,f){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(a,u,this.stateDependentLayers,f)}addFeatures(a,u,f){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,u,f)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(a){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=a.createVertexBuffer(this.layoutVertexArray2,OC)),this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,NC),this.indexBuffer=a.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(a),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(a){if(a.properties&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(a.properties,"mapbox_clip_end"))return{start:+a.properties.mapbox_clip_start,end:+a.properties.mapbox_clip_end}}addFeature(a,u,f,y,w){const T=this.layers[0].layout,E=T.get("line-join").evaluate(a,{}),I=T.get("line-cap"),z=T.get("line-miter-limit"),j=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(a);for(const W of u)this.addLine(W,a,E,I,z,j);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,f,w,y)}addLine(a,u,f,y,w,T){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let Pe=0;Pe<a.length-1;Pe++)this.totalDistance+=a[Pe].dist(a[Pe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=UC[u.type]==="Polygon";let I=a.length;for(;I>=2&&a[I-1].equals(a[I-2]);)I--;let z=0;for(;z<I-1&&a[z].equals(a[z+1]);)z++;if(I<(E?3:2))return;f==="bevel"&&(w=1.05);const j=this.overscaling<=16?15*qn/(512*this.overscaling):0,W=this.segments.prepareSegment(10*I,this.layoutVertexArray,this.indexArray);let K,ae,oe,pe,be;this.e1=this.e2=-1,E&&(K=a[I-2],be=a[z].sub(K)._unit()._perp());for(let Pe=z;Pe<I;Pe++){if(oe=Pe===I-1?E?a[z+1]:void 0:a[Pe+1],oe&&a[Pe].equals(oe))continue;be&&(pe=be),K&&(ae=K),K=a[Pe],be=oe?oe.sub(K)._unit()._perp():pe,pe=pe||be;let Ve=pe.add(be);Ve.x===0&&Ve.y===0||Ve._unit();const ke=pe.x*be.x+pe.y*be.y,Ne=Ve.x*be.x+Ve.y*be.y,ht=Ne!==0?1/Ne:1/0,yt=2*Math.sqrt(2-2*Ne),Wt=Ne<VC&&ae&&oe,un=pe.x*be.y-pe.y*be.x>0;if(Wt&&Pe>z){const Rt=K.dist(ae);if(Rt>2*j){const sn=K.sub(K.sub(ae)._mult(j/Rt)._round());this.updateDistance(ae,sn),this.addCurrentVertex(sn,pe,0,0,W),ae=sn}}const Gt=ae&&oe;let Vt=Gt?f:E?"butt":y;if(Gt&&Vt==="round"&&(ht<T?Vt="miter":ht<=2&&(Vt="fakeround")),Vt==="miter"&&ht>w&&(Vt="bevel"),Vt==="bevel"&&(ht>2&&(Vt="flipbevel"),ht<w&&(Vt="miter")),ae&&this.updateDistance(ae,K),Vt==="miter")Ve._mult(ht),this.addCurrentVertex(K,Ve,0,0,W);else if(Vt==="flipbevel"){if(ht>100)Ve=be.mult(-1);else{const Rt=ht*pe.add(be).mag()/pe.sub(be).mag();Ve._perp()._mult(Rt*(un?-1:1))}this.addCurrentVertex(K,Ve,0,0,W),this.addCurrentVertex(K,Ve.mult(-1),0,0,W)}else if(Vt==="bevel"||Vt==="fakeround"){const Rt=-Math.sqrt(ht*ht-1),sn=un?Rt:0,Ot=un?0:Rt;if(ae&&this.addCurrentVertex(K,pe,sn,Ot,W),Vt==="fakeround"){const Tt=Math.round(180*yt/Math.PI/20);for(let vn=1;vn<Tt;vn++){let dn=vn/Tt;if(dn!==.5){const Si=dn-.5;dn+=dn*Si*(dn-1)*((1.0904+ke*(ke*(3.55645-1.43519*ke)-3.2452))*Si*Si+(.848013+ke*(.215638*ke-1.06021)))}const jn=be.sub(pe)._mult(dn)._add(pe)._unit()._mult(un?-1:1);this.addHalfVertex(K,jn.x,jn.y,!1,un,0,W)}}oe&&this.addCurrentVertex(K,be,-sn,-Ot,W)}else if(Vt==="butt")this.addCurrentVertex(K,Ve,0,0,W);else if(Vt==="square"){const Rt=ae?1:-1;this.addCurrentVertex(K,Ve,Rt,Rt,W)}else Vt==="round"&&(ae&&(this.addCurrentVertex(K,pe,0,0,W),this.addCurrentVertex(K,pe,1,1,W,!0)),oe&&(this.addCurrentVertex(K,be,-1,-1,W,!0),this.addCurrentVertex(K,be,0,0,W)));if(Wt&&Pe<I-1){const Rt=K.dist(oe);if(Rt>2*j){const sn=K.add(oe.sub(K)._mult(j/Rt)._round());this.updateDistance(K,sn),this.addCurrentVertex(sn,be,0,0,W),K=sn}}}}addCurrentVertex(a,u,f,y,w,T=!1){const E=u.y*y-u.x,I=-u.y-u.x*y;this.addHalfVertex(a,u.x+u.y*f,u.y-u.x*f,T,!1,f,w),this.addHalfVertex(a,E,I,T,!0,-y,w),this.distance>S4/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(a,u,f,y,w,T))}addHalfVertex({x:a,y:u},f,y,w,T,E,I){const z=.5*(this.lineClips?this.scaledDistance*(S4-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((a<<1)+(w?1:0),(u<<1)+(T?1:0),Math.round(63*f)+128,Math.round(63*y)+128,1+(E===0?0:E<0?-1:1)|(63&z)<<2,z>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const j=I.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,j),I.primitiveLength++),T?this.e2=j:this.e1=j}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(a,u){this.distance+=a.dist(u),this.updateScaledDistance()}}let M4,T4;en("LineBucket",Nv,{omit:["layers","patternFeatures"]});var E4={get paint(){return T4=T4||new Wr({"line-opacity":new Mn(ie.paint_line["line-opacity"]),"line-color":new Mn(ie.paint_line["line-color"]),"line-translate":new pn(ie.paint_line["line-translate"]),"line-translate-anchor":new pn(ie.paint_line["line-translate-anchor"]),"line-width":new Mn(ie.paint_line["line-width"]),"line-gap-width":new Mn(ie.paint_line["line-gap-width"]),"line-offset":new Mn(ie.paint_line["line-offset"]),"line-blur":new Mn(ie.paint_line["line-blur"]),"line-dasharray":new Hf(ie.paint_line["line-dasharray"]),"line-pattern":new Bo(ie.paint_line["line-pattern"]),"line-gradient":new ru(ie.paint_line["line-gradient"])})},get layout(){return M4=M4||new Wr({"line-cap":new pn(ie.layout_line["line-cap"]),"line-join":new Mn(ie.layout_line["line-join"]),"line-miter-limit":new pn(ie.layout_line["line-miter-limit"]),"line-round-limit":new pn(ie.layout_line["line-round-limit"]),"line-sort-key":new Mn(ie.layout_line["line-sort-key"])})}};class HC extends Mn{possiblyEvaluate(a,u){return u=new bi(Math.floor(u.zoom),{now:u.now,fadeDuration:u.fadeDuration,zoomHistory:u.zoomHistory,transition:u.transition}),super.possiblyEvaluate(a,u)}evaluate(a,u,f,y){return u=Q({},u,{zoom:Math.floor(u.zoom)}),super.evaluate(a,u,f,y)}}let Xm;class GC extends Oa{constructor(a){super(a,E4),this.gradientVersion=0,Xm||(Xm=new HC(E4.paint.properties["line-width"].specification),Xm.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const u=this.gradientExpression();this.stepInterpolant=!!function(f){return f._styleExpression!==void 0}(u)&&u._styleExpression.expression instanceof Cl,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(a,u){super.recalculate(a,u),this.paint._values["line-floorwidth"]=Xm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Nv(a)}queryRadius(a){const u=a,f=A4(n0("line-width",this,u),n0("line-gap-width",this,u)),y=n0("line-offset",this,u);return f/2+Math.abs(y)+Vm(this.paint.get("line-translate"))}queryIntersectsFeature(a,u,f,y,w,T,E){const I=Hm(a,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),T.angle,E),z=E/2*A4(this.paint.get("line-width").evaluate(u,f),this.paint.get("line-gap-width").evaluate(u,f)),j=this.paint.get("line-offset").evaluate(u,f);return j&&(y=function(W,K){const ae=[];for(let oe=0;oe<W.length;oe++){const pe=W[oe],be=[];for(let Pe=0;Pe<pe.length;Pe++){const Ve=pe[Pe-1],ke=pe[Pe],Ne=pe[Pe+1],ht=Pe===0?new M(0,0):ke.sub(Ve)._unit()._perp(),yt=Pe===pe.length-1?new M(0,0):Ne.sub(ke)._unit()._perp(),Wt=ht._add(yt)._unit(),un=Wt.x*yt.x+Wt.y*yt.y;un!==0&&Wt._mult(1/un),be.push(Wt._mult(K)._add(ke))}ae.push(be)}return ae}(y,j*E)),function(W,K,ae){for(let oe=0;oe<K.length;oe++){const pe=K[oe];if(W.length>=3){for(let be=0;be<pe.length;be++)if(Ah(W,pe[be]))return!0}if(Om(W,pe,ae))return!0}return!1}(I,y,z)}isTileClipped(){return!0}}function A4(c,a){return a>0?a+2*c:c}const jC=Wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),WC=Wi([{name:"a_projected_pos",components:3,type:"Float32"}],4);Wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const qC=Wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Wi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const C4=Wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),$C=Wi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function XC(c,a,u){return c.sections.forEach(f=>{f.text=function(y,w,T){const E=w.layout.get("text-transform").evaluate(T,{});return E==="uppercase"?y=y.toLocaleUpperCase():E==="lowercase"&&(y=y.toLocaleLowerCase()),No.applyArabicShaping&&(y=No.applyArabicShaping(y)),y}(f.text,a,u)}),c}Wi([{name:"triangle",components:3,type:"Uint16"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Wi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),Wi([{type:"Float32",name:"offsetX"}]),Wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),Wi([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const h0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var ar=24,P4=di,R4=function(c,a,u,f,y){var w,T,E=8*y-f-1,I=(1<<E)-1,z=I>>1,j=-7,W=u?y-1:0,K=u?-1:1,ae=c[a+W];for(W+=K,w=ae&(1<<-j)-1,ae>>=-j,j+=E;j>0;w=256*w+c[a+W],W+=K,j-=8);for(T=w&(1<<-j)-1,w>>=-j,j+=f;j>0;T=256*T+c[a+W],W+=K,j-=8);if(w===0)w=1-z;else{if(w===I)return T?NaN:1/0*(ae?-1:1);T+=Math.pow(2,f),w-=z}return(ae?-1:1)*T*Math.pow(2,w-f)},I4=function(c,a,u,f,y,w){var T,E,I,z=8*w-y-1,j=(1<<z)-1,W=j>>1,K=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,ae=f?0:w-1,oe=f?1:-1,pe=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(E=isNaN(a)?1:0,T=j):(T=Math.floor(Math.log(a)/Math.LN2),a*(I=Math.pow(2,-T))<1&&(T--,I*=2),(a+=T+W>=1?K/I:K*Math.pow(2,1-W))*I>=2&&(T++,I/=2),T+W>=j?(E=0,T=j):T+W>=1?(E=(a*I-1)*Math.pow(2,y),T+=W):(E=a*Math.pow(2,W-1)*Math.pow(2,y),T=0));y>=8;c[u+ae]=255&E,ae+=oe,E/=256,y-=8);for(T=T<<y|E,z+=y;z>0;c[u+ae]=255&T,ae+=oe,T/=256,z-=8);c[u+ae-oe]|=128*pe};function di(c){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(c)?c:new Uint8Array(c||0),this.pos=0,this.type=0,this.length=this.buf.length}di.Varint=0,di.Fixed64=1,di.Bytes=2,di.Fixed32=5;var Bv=4294967296,k4=1/Bv,D4=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Wo(c){return c.type===di.Bytes?c.readVarint()+c.pos:c.pos+1}function Ih(c,a,u){return u?4294967296*a+(c>>>0):4294967296*(a>>>0)+(c>>>0)}function L4(c,a,u){var f=a<=16383?1:a<=2097151?2:a<=268435455?3:Math.floor(Math.log(a)/(7*Math.LN2));u.realloc(f);for(var y=u.pos-1;y>=c;y--)u.buf[y+f]=u.buf[y]}function ZC(c,a){for(var u=0;u<c.length;u++)a.writeVarint(c[u])}function YC(c,a){for(var u=0;u<c.length;u++)a.writeSVarint(c[u])}function KC(c,a){for(var u=0;u<c.length;u++)a.writeFloat(c[u])}function JC(c,a){for(var u=0;u<c.length;u++)a.writeDouble(c[u])}function QC(c,a){for(var u=0;u<c.length;u++)a.writeBoolean(c[u])}function eP(c,a){for(var u=0;u<c.length;u++)a.writeFixed32(c[u])}function tP(c,a){for(var u=0;u<c.length;u++)a.writeSFixed32(c[u])}function nP(c,a){for(var u=0;u<c.length;u++)a.writeFixed64(c[u])}function iP(c,a){for(var u=0;u<c.length;u++)a.writeSFixed64(c[u])}function Zm(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+16777216*c[a+3]}function kh(c,a,u){c[u]=a,c[u+1]=a>>>8,c[u+2]=a>>>16,c[u+3]=a>>>24}function z4(c,a){return(c[a]|c[a+1]<<8|c[a+2]<<16)+(c[a+3]<<24)}di.prototype={destroy:function(){this.buf=null},readFields:function(c,a,u){for(u=u||this.length;this.pos<u;){var f=this.readVarint(),y=f>>3,w=this.pos;this.type=7&f,c(y,a,this),this.pos===w&&this.skip(f)}return a},readMessage:function(c,a){return this.readFields(c,a,this.readVarint()+this.pos)},readFixed32:function(){var c=Zm(this.buf,this.pos);return this.pos+=4,c},readSFixed32:function(){var c=z4(this.buf,this.pos);return this.pos+=4,c},readFixed64:function(){var c=Zm(this.buf,this.pos)+Zm(this.buf,this.pos+4)*Bv;return this.pos+=8,c},readSFixed64:function(){var c=Zm(this.buf,this.pos)+z4(this.buf,this.pos+4)*Bv;return this.pos+=8,c},readFloat:function(){var c=R4(this.buf,this.pos,!0,23,4);return this.pos+=4,c},readDouble:function(){var c=R4(this.buf,this.pos,!0,52,8);return this.pos+=8,c},readVarint:function(c){var a,u,f=this.buf;return a=127&(u=f[this.pos++]),u<128?a:(a|=(127&(u=f[this.pos++]))<<7,u<128?a:(a|=(127&(u=f[this.pos++]))<<14,u<128?a:(a|=(127&(u=f[this.pos++]))<<21,u<128?a:function(y,w,T){var E,I,z=T.buf;if(E=(112&(I=z[T.pos++]))>>4,I<128||(E|=(127&(I=z[T.pos++]))<<3,I<128)||(E|=(127&(I=z[T.pos++]))<<10,I<128)||(E|=(127&(I=z[T.pos++]))<<17,I<128)||(E|=(127&(I=z[T.pos++]))<<24,I<128)||(E|=(1&(I=z[T.pos++]))<<31,I<128))return Ih(y,E,w);throw new Error("Expected varint not more than 10 bytes")}(a|=(15&(u=f[this.pos]))<<28,c,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var c=this.readVarint();return c%2==1?(c+1)/-2:c/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var c=this.readVarint()+this.pos,a=this.pos;return this.pos=c,c-a>=12&&D4?function(u,f,y){return D4.decode(u.subarray(f,y))}(this.buf,a,c):function(u,f,y){for(var w="",T=f;T<y;){var E,I,z,j=u[T],W=null,K=j>239?4:j>223?3:j>191?2:1;if(T+K>y)break;K===1?j<128&&(W=j):K===2?(192&(E=u[T+1]))==128&&(W=(31&j)<<6|63&E)<=127&&(W=null):K===3?(I=u[T+2],(192&(E=u[T+1]))==128&&(192&I)==128&&((W=(15&j)<<12|(63&E)<<6|63&I)<=2047||W>=55296&&W<=57343)&&(W=null)):K===4&&(I=u[T+2],z=u[T+3],(192&(E=u[T+1]))==128&&(192&I)==128&&(192&z)==128&&((W=(15&j)<<18|(63&E)<<12|(63&I)<<6|63&z)<=65535||W>=1114112)&&(W=null)),W===null?(W=65533,K=1):W>65535&&(W-=65536,w+=String.fromCharCode(W>>>10&1023|55296),W=56320|1023&W),w+=String.fromCharCode(W),T+=K}return w}(this.buf,a,c)},readBytes:function(){var c=this.readVarint()+this.pos,a=this.buf.subarray(this.pos,c);return this.pos=c,a},readPackedVarint:function(c,a){if(this.type!==di.Bytes)return c.push(this.readVarint(a));var u=Wo(this);for(c=c||[];this.pos<u;)c.push(this.readVarint(a));return c},readPackedSVarint:function(c){if(this.type!==di.Bytes)return c.push(this.readSVarint());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readSVarint());return c},readPackedBoolean:function(c){if(this.type!==di.Bytes)return c.push(this.readBoolean());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readBoolean());return c},readPackedFloat:function(c){if(this.type!==di.Bytes)return c.push(this.readFloat());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readFloat());return c},readPackedDouble:function(c){if(this.type!==di.Bytes)return c.push(this.readDouble());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readDouble());return c},readPackedFixed32:function(c){if(this.type!==di.Bytes)return c.push(this.readFixed32());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readFixed32());return c},readPackedSFixed32:function(c){if(this.type!==di.Bytes)return c.push(this.readSFixed32());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed32());return c},readPackedFixed64:function(c){if(this.type!==di.Bytes)return c.push(this.readFixed64());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readFixed64());return c},readPackedSFixed64:function(c){if(this.type!==di.Bytes)return c.push(this.readSFixed64());var a=Wo(this);for(c=c||[];this.pos<a;)c.push(this.readSFixed64());return c},skip:function(c){var a=7&c;if(a===di.Varint)for(;this.buf[this.pos++]>127;);else if(a===di.Bytes)this.pos=this.readVarint()+this.pos;else if(a===di.Fixed32)this.pos+=4;else{if(a!==di.Fixed64)throw new Error("Unimplemented type: "+a);this.pos+=8}},writeTag:function(c,a){this.writeVarint(c<<3|a)},realloc:function(c){for(var a=this.length||16;a<this.pos+c;)a*=2;if(a!==this.length){var u=new Uint8Array(a);u.set(this.buf),this.buf=u,this.length=a}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(c){this.realloc(4),kh(this.buf,c,this.pos),this.pos+=4},writeSFixed32:function(c){this.realloc(4),kh(this.buf,c,this.pos),this.pos+=4},writeFixed64:function(c){this.realloc(8),kh(this.buf,-1&c,this.pos),kh(this.buf,Math.floor(c*k4),this.pos+4),this.pos+=8},writeSFixed64:function(c){this.realloc(8),kh(this.buf,-1&c,this.pos),kh(this.buf,Math.floor(c*k4),this.pos+4),this.pos+=8},writeVarint:function(c){(c=+c||0)>268435455||c<0?function(a,u){var f,y;if(a>=0?(f=a%4294967296|0,y=a/4294967296|0):(y=~(-a/4294967296),4294967295^(f=~(-a%4294967296))?f=f+1|0:(f=0,y=y+1|0)),a>=18446744073709552e3||a<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");u.realloc(10),function(w,T,E){E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,w>>>=7,E.buf[E.pos++]=127&w|128,E.buf[E.pos]=127&(w>>>=7)}(f,0,u),function(w,T){var E=(7&w)<<4;T.buf[T.pos++]|=E|((w>>>=3)?128:0),w&&(T.buf[T.pos++]=127&w|((w>>>=7)?128:0),w&&(T.buf[T.pos++]=127&w|((w>>>=7)?128:0),w&&(T.buf[T.pos++]=127&w|((w>>>=7)?128:0),w&&(T.buf[T.pos++]=127&w|((w>>>=7)?128:0),w&&(T.buf[T.pos++]=127&w)))))}(y,u)}(c,this):(this.realloc(4),this.buf[this.pos++]=127&c|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=127&(c>>>=7)|(c>127?128:0),c<=127||(this.buf[this.pos++]=c>>>7&127))))},writeSVarint:function(c){this.writeVarint(c<0?2*-c-1:2*c)},writeBoolean:function(c){this.writeVarint(!!c)},writeString:function(c){c=String(c),this.realloc(4*c.length),this.pos++;var a=this.pos;this.pos=function(f,y,w){for(var T,E,I=0;I<y.length;I++){if((T=y.charCodeAt(I))>55295&&T<57344){if(!E){T>56319||I+1===y.length?(f[w++]=239,f[w++]=191,f[w++]=189):E=T;continue}if(T<56320){f[w++]=239,f[w++]=191,f[w++]=189,E=T;continue}T=E-55296<<10|T-56320|65536,E=null}else E&&(f[w++]=239,f[w++]=191,f[w++]=189,E=null);T<128?f[w++]=T:(T<2048?f[w++]=T>>6|192:(T<65536?f[w++]=T>>12|224:(f[w++]=T>>18|240,f[w++]=T>>12&63|128),f[w++]=T>>6&63|128),f[w++]=63&T|128)}return w}(this.buf,c,this.pos);var u=this.pos-a;u>=128&&L4(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u},writeFloat:function(c){this.realloc(4),I4(this.buf,c,this.pos,!0,23,4),this.pos+=4},writeDouble:function(c){this.realloc(8),I4(this.buf,c,this.pos,!0,52,8),this.pos+=8},writeBytes:function(c){var a=c.length;this.writeVarint(a),this.realloc(a);for(var u=0;u<a;u++)this.buf[this.pos++]=c[u]},writeRawMessage:function(c,a){this.pos++;var u=this.pos;c(a,this);var f=this.pos-u;f>=128&&L4(u,f,this),this.pos=u-1,this.writeVarint(f),this.pos+=f},writeMessage:function(c,a,u){this.writeTag(c,di.Bytes),this.writeRawMessage(a,u)},writePackedVarint:function(c,a){a.length&&this.writeMessage(c,ZC,a)},writePackedSVarint:function(c,a){a.length&&this.writeMessage(c,YC,a)},writePackedBoolean:function(c,a){a.length&&this.writeMessage(c,QC,a)},writePackedFloat:function(c,a){a.length&&this.writeMessage(c,KC,a)},writePackedDouble:function(c,a){a.length&&this.writeMessage(c,JC,a)},writePackedFixed32:function(c,a){a.length&&this.writeMessage(c,eP,a)},writePackedSFixed32:function(c,a){a.length&&this.writeMessage(c,tP,a)},writePackedFixed64:function(c,a){a.length&&this.writeMessage(c,nP,a)},writePackedSFixed64:function(c,a){a.length&&this.writeMessage(c,iP,a)},writeBytesField:function(c,a){this.writeTag(c,di.Bytes),this.writeBytes(a)},writeFixed32Field:function(c,a){this.writeTag(c,di.Fixed32),this.writeFixed32(a)},writeSFixed32Field:function(c,a){this.writeTag(c,di.Fixed32),this.writeSFixed32(a)},writeFixed64Field:function(c,a){this.writeTag(c,di.Fixed64),this.writeFixed64(a)},writeSFixed64Field:function(c,a){this.writeTag(c,di.Fixed64),this.writeSFixed64(a)},writeVarintField:function(c,a){this.writeTag(c,di.Varint),this.writeVarint(a)},writeSVarintField:function(c,a){this.writeTag(c,di.Varint),this.writeSVarint(a)},writeStringField:function(c,a){this.writeTag(c,di.Bytes),this.writeString(a)},writeFloatField:function(c,a){this.writeTag(c,di.Fixed32),this.writeFloat(a)},writeDoubleField:function(c,a){this.writeTag(c,di.Fixed64),this.writeDouble(a)},writeBooleanField:function(c,a){this.writeVarintField(c,!!a)}};var Ov=p(P4);const Uv=3;function rP(c,a,u){c===1&&u.readMessage(aP,a)}function aP(c,a,u){if(c===3){const{id:f,bitmap:y,width:w,height:T,left:E,top:I,advance:z}=u.readMessage(sP,{});a.push({id:f,bitmap:new r0({width:w+2*Uv,height:T+2*Uv},y),metrics:{width:w,height:T,left:E,top:I,advance:z}})}}function sP(c,a,u){c===1?a.id=u.readVarint():c===2?a.bitmap=u.readBytes():c===3?a.width=u.readVarint():c===4?a.height=u.readVarint():c===5?a.left=u.readSVarint():c===6?a.top=u.readSVarint():c===7&&(a.advance=u.readVarint())}const F4=Uv;function N4(c){let a=0,u=0;for(const T of c)a+=T.w*T.h,u=Math.max(u,T.w);c.sort((T,E)=>E.h-T.h);const f=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(a/.95)),u),h:1/0}];let y=0,w=0;for(const T of c)for(let E=f.length-1;E>=0;E--){const I=f[E];if(!(T.w>I.w||T.h>I.h)){if(T.x=I.x,T.y=I.y,w=Math.max(w,T.y+T.h),y=Math.max(y,T.x+T.w),T.w===I.w&&T.h===I.h){const z=f.pop();E<f.length&&(f[E]=z)}else T.h===I.h?(I.x+=T.w,I.w-=T.w):T.w===I.w?(I.y+=T.h,I.h-=T.h):(f.push({x:I.x+T.w,y:I.y,w:I.w-T.w,h:T.h}),I.y+=T.h,I.h-=T.h);break}}return{w:y,h:w,fill:a/(y*w)||0}}const ua=1;class Vv{constructor(a,{pixelRatio:u,version:f,stretchX:y,stretchY:w,content:T}){this.paddedRect=a,this.pixelRatio=u,this.stretchX=y,this.stretchY=w,this.content=T,this.version=f}get tl(){return[this.paddedRect.x+ua,this.paddedRect.y+ua]}get br(){return[this.paddedRect.x+this.paddedRect.w-ua,this.paddedRect.y+this.paddedRect.h-ua]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ua)/this.pixelRatio,(this.paddedRect.h-2*ua)/this.pixelRatio]}}class B4{constructor(a,u){const f={},y={};this.haveRenderCallbacks=[];const w=[];this.addImages(a,f,w),this.addImages(u,y,w);const{w:T,h:E}=N4(w),I=new Ha({width:T||1,height:E||1});for(const z in a){const j=a[z],W=f[z].paddedRect;Ha.copy(j.data,I,{x:0,y:0},{x:W.x+ua,y:W.y+ua},j.data)}for(const z in u){const j=u[z],W=y[z].paddedRect,K=W.x+ua,ae=W.y+ua,oe=j.data.width,pe=j.data.height;Ha.copy(j.data,I,{x:0,y:0},{x:K,y:ae},j.data),Ha.copy(j.data,I,{x:0,y:pe-1},{x:K,y:ae-1},{width:oe,height:1}),Ha.copy(j.data,I,{x:0,y:0},{x:K,y:ae+pe},{width:oe,height:1}),Ha.copy(j.data,I,{x:oe-1,y:0},{x:K-1,y:ae},{width:1,height:pe}),Ha.copy(j.data,I,{x:0,y:0},{x:K+oe,y:ae},{width:1,height:pe})}this.image=I,this.iconPositions=f,this.patternPositions=y}addImages(a,u,f){for(const y in a){const w=a[y],T={x:0,y:0,w:w.data.width+2*ua,h:w.data.height+2*ua};f.push(T),u[y]=new Vv(T,w),w.hasRenderCallback&&this.haveRenderCallbacks.push(y)}}patchUpdatedImages(a,u){a.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const f in a.updatedImages)this.patchUpdatedImage(this.iconPositions[f],a.getImage(f),u),this.patchUpdatedImage(this.patternPositions[f],a.getImage(f),u)}patchUpdatedImage(a,u,f){if(!a||!u||a.version===u.version)return;a.version=u.version;const[y,w]=a.tl;f.update(u.data,void 0,{x:y,y:w})}}var Xl;en("ImagePosition",Vv),en("ImageAtlas",B4),h.ah=void 0,(Xl=h.ah||(h.ah={}))[Xl.none=0]="none",Xl[Xl.horizontal=1]="horizontal",Xl[Xl.vertical=2]="vertical",Xl[Xl.horizontalOnly=3]="horizontalOnly";const d0=-17;class f0{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(a,u){const f=new f0;return f.scale=a||1,f.fontStack=u,f}static forImage(a){const u=new f0;return u.imageName=a,u}}class Dh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(a,u){const f=new Dh;for(let y=0;y<a.sections.length;y++){const w=a.sections[y];w.image?f.addImageSection(w):f.addTextSection(w,u)}return f}length(){return this.text.length}getSection(a){return this.sections[this.sectionIndex[a]]}getSectionIndex(a){return this.sectionIndex[a]}getCharCode(a){return this.text.charCodeAt(a)}verticalizePunctuation(){this.text=function(a){let u="";for(let f=0;f<a.length;f++){const y=a.charCodeAt(f+1)||null,w=a.charCodeAt(f-1)||null;u+=y&&Nf(y)&&!h0[a[f+1]]||w&&Nf(w)&&!h0[a[f-1]]||!h0[a[f]]?a[f]:h0[a[f]]}return u}(this.text)}trim(){let a=0;for(let f=0;f<this.text.length&&Km[this.text.charCodeAt(f)];f++)a++;let u=this.text.length;for(let f=this.text.length-1;f>=0&&f>=a&&Km[this.text.charCodeAt(f)];f--)u--;this.text=this.text.substring(a,u),this.sectionIndex=this.sectionIndex.slice(a,u)}substring(a,u){const f=new Dh;return f.text=this.text.substring(a,u),f.sectionIndex=this.sectionIndex.slice(a,u),f.sections=this.sections,f}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((a,u)=>Math.max(a,this.sections[u].scale),0)}addTextSection(a,u){this.text+=a.text,this.sections.push(f0.forText(a.scale,a.fontStack||u));const f=this.sections.length-1;for(let y=0;y<a.text.length;++y)this.sectionIndex.push(f)}addImageSection(a){const u=a.image?a.image.name:"";if(u.length===0)return void Ae("Can't add FormattedSection with an empty image.");const f=this.getNextImageSectionCharCode();f?(this.text+=String.fromCharCode(f),this.sections.push(f0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Ae("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ym(c,a,u,f,y,w,T,E,I,z,j,W,K,ae,oe,pe){const be=Dh.fromFeature(c,y);let Pe;W===h.ah.vertical&&be.verticalizePunctuation();const{processBidirectionalText:Ve,processStyledBidirectionalText:ke}=No;if(Ve&&be.sections.length===1){Pe=[];const yt=Ve(be.toString(),Hv(be,z,w,a,f,ae,oe));for(const Wt of yt){const un=new Dh;un.text=Wt,un.sections=be.sections;for(let Gt=0;Gt<Wt.length;Gt++)un.sectionIndex.push(0);Pe.push(un)}}else if(ke){Pe=[];const yt=ke(be.text,be.sectionIndex,Hv(be,z,w,a,f,ae,oe));for(const Wt of yt){const un=new Dh;un.text=Wt[0],un.sectionIndex=Wt[1],un.sections=be.sections,Pe.push(un)}}else Pe=function(yt,Wt){const un=[],Gt=yt.text;let Vt=0;for(const Rt of Wt)un.push(yt.substring(Vt,Rt)),Vt=Rt;return Vt<Gt.length&&un.push(yt.substring(Vt,Gt.length)),un}(be,Hv(be,z,w,a,f,ae,oe));const Ne=[],ht={positionedLines:Ne,text:be.toString(),top:j[1],bottom:j[1],left:j[0],right:j[0],writingMode:W,iconsInText:!1,verticalizable:!1};return function(yt,Wt,un,Gt,Vt,Rt,sn,Ot,Tt,vn,dn,jn){let Si=0,Ci=d0,sr=0,Aa=0;const Xr=Ot==="right"?1:Ot==="left"?0:.5;let er=0;for(const or of Vt){or.trim();const lr=or.getMaxScale(),zr=(lr-1)*ar,Kr={positionedGlyphs:[],lineOffset:0};yt.positionedLines[er]=Kr;const Fr=Kr.positionedGlyphs;let ha=0;if(!or.length()){Ci+=Rt,++er;continue}for(let cr=0;cr<or.length();cr++){const Zn=or.getSection(cr),Nr=or.getSectionIndex(cr),Pr=or.getCharCode(cr);let ur=0,hs=null,Is=null,ks=null,qo=ar;const ds=!(Tt===h.ah.horizontal||!dn&&!vh(Pr)||dn&&(Km[Pr]||(_r=Pr,qt.Arabic(_r)||qt["Arabic Supplement"](_r)||qt["Arabic Extended-A"](_r)||qt["Arabic Presentation Forms-A"](_r)||qt["Arabic Presentation Forms-B"](_r))));if(Zn.imageName){const ja=Gt[Zn.imageName];if(!ja)continue;ks=Zn.imageName,yt.iconsInText=yt.iconsInText||!0,Is=ja.paddedRect;const fa=ja.displaySize;Zn.scale=Zn.scale*ar/jn,hs={width:fa[0],height:fa[1],left:ua,top:-F4,advance:ds?fa[1]:fa[0]},ur=zr+(ar-fa[1]*Zn.scale),qo=hs.advance;const $o=ds?fa[0]*Zn.scale-ar*lr:fa[1]*Zn.scale-ar*lr;$o>0&&$o>ha&&(ha=$o)}else{const ja=un[Zn.fontStack],fa=ja&&ja[Pr];if(fa&&fa.rect)Is=fa.rect,hs=fa.metrics;else{const $o=Wt[Zn.fontStack],v0=$o&&$o[Pr];if(!v0)continue;hs=v0.metrics}ur=(lr-Zn.scale)*ar}ds?(yt.verticalizable=!0,Fr.push({glyph:Pr,imageName:ks,x:Si,y:Ci+ur,vertical:ds,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Nr,metrics:hs,rect:Is}),Si+=qo*Zn.scale+vn):(Fr.push({glyph:Pr,imageName:ks,x:Si,y:Ci+ur,vertical:ds,scale:Zn.scale,fontStack:Zn.fontStack,sectionIndex:Nr,metrics:hs,rect:Is}),Si+=hs.advance*Zn.scale+vn)}Fr.length!==0&&(sr=Math.max(Si-vn,sr),cP(Fr,0,Fr.length-1,Xr,ha)),Si=0;const da=Rt*lr+ha;Kr.lineOffset=Math.max(ha,zr),Ci+=da,Aa=Math.max(da,Aa),++er}var _r;const Cr=Ci-d0,{horizontalAlign:Zr,verticalAlign:Yr}=Gv(sn);(function(or,lr,zr,Kr,Fr,ha,da,cr,Zn){const Nr=(lr-zr)*Fr;let Pr=0;Pr=ha!==da?-cr*Kr-d0:(-Kr*Zn+.5)*da;for(const ur of or)for(const hs of ur.positionedGlyphs)hs.x+=Nr,hs.y+=Pr})(yt.positionedLines,Xr,Zr,Yr,sr,Aa,Rt,Cr,Vt.length),yt.top+=-Yr*Cr,yt.bottom=yt.top+Cr,yt.left+=-Zr*sr,yt.right=yt.left+sr}(ht,a,u,f,Pe,T,E,I,W,z,K,pe),!function(yt){for(const Wt of yt)if(Wt.positionedGlyphs.length!==0)return!1;return!0}(Ne)&&ht}const Km={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},oP={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function O4(c,a,u,f,y,w){if(a.imageName){const T=f[a.imageName];return T?T.displaySize[0]*a.scale*ar/w+y:0}{const T=u[a.fontStack],E=T&&T[c];return E?E.metrics.advance*a.scale+y:0}}function U4(c,a,u,f){const y=Math.pow(c-a,2);return f?c<a?y/2:2*y:y+Math.abs(u)*u}function lP(c,a,u){let f=0;return c===10&&(f-=1e4),u&&(f+=150),c!==40&&c!==65288||(f+=50),a!==41&&a!==65289||(f+=50),f}function V4(c,a,u,f,y,w){let T=null,E=U4(a,u,y,w);for(const I of f){const z=U4(a-I.x,u,y,w)+I.badness;z<=E&&(T=I,E=z)}return{index:c,x:a,priorBreak:T,badness:E}}function H4(c){return c?H4(c.priorBreak).concat(c.index):[]}function Hv(c,a,u,f,y,w,T){if(w!=="point")return[];if(!c)return[];const E=[],I=function(K,ae,oe,pe,be,Pe){let Ve=0;for(let ke=0;ke<K.length();ke++){const Ne=K.getSection(ke);Ve+=O4(K.getCharCode(ke),Ne,pe,be,ae,Pe)}return Ve/Math.max(1,Math.ceil(Ve/oe))}(c,a,u,f,y,T),z=c.text.indexOf("​")>=0;let j=0;for(let K=0;K<c.length();K++){const ae=c.getSection(K),oe=c.getCharCode(K);if(Km[oe]||(j+=O4(oe,ae,f,y,a,T)),K<c.length()-1){const pe=!((W=oe)<11904||!(qt["Bopomofo Extended"](W)||qt.Bopomofo(W)||qt["CJK Compatibility Forms"](W)||qt["CJK Compatibility Ideographs"](W)||qt["CJK Compatibility"](W)||qt["CJK Radicals Supplement"](W)||qt["CJK Strokes"](W)||qt["CJK Symbols and Punctuation"](W)||qt["CJK Unified Ideographs Extension A"](W)||qt["CJK Unified Ideographs"](W)||qt["Enclosed CJK Letters and Months"](W)||qt["Halfwidth and Fullwidth Forms"](W)||qt.Hiragana(W)||qt["Ideographic Description Characters"](W)||qt["Kangxi Radicals"](W)||qt["Katakana Phonetic Extensions"](W)||qt.Katakana(W)||qt["Vertical Forms"](W)||qt["Yi Radicals"](W)||qt["Yi Syllables"](W)));(oP[oe]||pe||ae.imageName)&&E.push(V4(K+1,j,I,E,lP(oe,c.getCharCode(K+1),pe&&z),!1))}}var W;return H4(V4(c.length(),j,I,E,0,!0))}function Gv(c){let a=.5,u=.5;switch(c){case"right":case"top-right":case"bottom-right":a=1;break;case"left":case"top-left":case"bottom-left":a=0}switch(c){case"bottom":case"bottom-right":case"bottom-left":u=1;break;case"top":case"top-right":case"top-left":u=0}return{horizontalAlign:a,verticalAlign:u}}function cP(c,a,u,f,y){if(!f&&!y)return;const w=c[u],T=(c[u].x+w.metrics.advance*w.scale)*f;for(let E=a;E<=u;E++)c[E].x-=T,c[E].y+=y}function uP(c,a,u){const{horizontalAlign:f,verticalAlign:y}=Gv(u),w=a[0]-c.displaySize[0]*f,T=a[1]-c.displaySize[1]*y;return{image:c,top:T,bottom:T+c.displaySize[1],left:w,right:w+c.displaySize[0]}}function G4(c,a,u,f,y,w){const T=c.image;let E;if(T.content){const be=T.content,Pe=T.pixelRatio||1;E=[be[0]/Pe,be[1]/Pe,T.displaySize[0]-be[2]/Pe,T.displaySize[1]-be[3]/Pe]}const I=a.left*w,z=a.right*w;let j,W,K,ae;u==="width"||u==="both"?(ae=y[0]+I-f[3],W=y[0]+z+f[1]):(ae=y[0]+(I+z-T.displaySize[0])/2,W=ae+T.displaySize[0]);const oe=a.top*w,pe=a.bottom*w;return u==="height"||u==="both"?(j=y[1]+oe-f[0],K=y[1]+pe+f[2]):(j=y[1]+(oe+pe-T.displaySize[1])/2,K=j+T.displaySize[1]),{image:T,top:j,right:W,bottom:K,left:ae,collisionPadding:E}}const p0=255,so=128,Zl=p0*so;function j4(c,a){const{expression:u}=a;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new bi(c+1))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:y}=u;let w=0;for(;w<f.length&&f[w]<=c;)w++;w=Math.max(0,w-1);let T=w;for(;T<f.length&&f[T]<c+1;)T++;T=Math.min(f.length-1,T);const E=f[w],I=f[T];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:I,interpolationType:y}:{kind:"camera",minZoom:E,maxZoom:I,minSize:u.evaluate(new bi(E)),maxSize:u.evaluate(new bi(I)),interpolationType:y}}}function jv(c,a,u){let f="never";const y=c.get(a);return y?f=y:c.get(u)&&(f="always"),f}const hP=$l.VectorTileFeature.types,dP=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Jm(c,a,u,f,y,w,T,E,I,z,j,W,K){const ae=E?Math.min(Zl,Math.round(E[0])):0,oe=E?Math.min(Zl,Math.round(E[1])):0;c.emplaceBack(a,u,Math.round(32*f),Math.round(32*y),w,T,(ae<<1)+(I?1:0),oe,16*z,16*j,256*W,256*K)}function Wv(c,a,u){c.emplaceBack(a.x,a.y,u),c.emplaceBack(a.x,a.y,u),c.emplaceBack(a.x,a.y,u),c.emplaceBack(a.x,a.y,u)}function fP(c){for(const a of c.sections)if(Im(a.text))return!0;return!1}class qv{constructor(a){this.layoutVertexArray=new ze,this.indexArray=new Qe,this.programConfigurations=a,this.segments=new xt,this.dynamicLayoutVertexArray=new $e,this.opacityVertexArray=new Te,this.hasVisibleVertices=!1,this.placedSymbolArray=new s}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(a,u,f,y){this.isEmpty()||(f&&(this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,jC.members),this.indexBuffer=a.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=a.createVertexBuffer(this.dynamicLayoutVertexArray,WC.members,!0),this.opacityVertexBuffer=a.createVertexBuffer(this.opacityVertexArray,dP,!0),this.opacityVertexBuffer.itemSize=1),(f||y)&&this.programConfigurations.upload(a))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}en("SymbolBuffers",qv);class $v{constructor(a,u,f){this.layoutVertexArray=new a,this.layoutAttributes=u,this.indexArray=new f,this.segments=new xt,this.collisionVertexArray=new Ke}upload(a){this.layoutVertexBuffer=a.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=a.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=a.createVertexBuffer(this.collisionVertexArray,qC.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}en("CollisionBuffers",$v);class Lh{constructor(a){this.collisionBoxArray=a.collisionBoxArray,this.zoom=a.zoom,this.overscaling=a.overscaling,this.layers=a.layers,this.layerIds=this.layers.map(T=>T.id),this.index=a.index,this.pixelRatio=a.pixelRatio,this.sourceLayerIndex=a.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Mv([]),this.placementViewportMatrix=Mv([]);const u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=j4(this.zoom,u["text-size"]),this.iconSizeData=j4(this.zoom,u["icon-size"]);const f=this.layers[0].layout,y=f.get("symbol-sort-key"),w=f.get("symbol-z-order");this.canOverlap=jv(f,"text-overlap","text-allow-overlap")!=="never"||jv(f,"icon-overlap","icon-allow-overlap")!=="never"||f.get("text-ignore-placement")||f.get("icon-ignore-placement"),this.sortFeaturesByKey=w!=="viewport-y"&&!y.isConstant(),this.sortFeaturesByY=(w==="viewport-y"||w==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,f.get("symbol-placement")==="point"&&(this.writingModes=f.get("text-writing-mode").map(T=>h.ah[T])),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.sourceID=a.sourceID}createArrays(){this.text=new qv(new Ai(this.layers,this.zoom,a=>/^text/.test(a))),this.icon=new qv(new Ai(this.layers,this.zoom,a=>/^icon/.test(a))),this.glyphOffsetArray=new g,this.lineVertexArray=new b,this.symbolInstances=new m,this.textAnchorOffsets=new R}calculateGlyphDependencies(a,u,f,y,w){for(let T=0;T<a.length;T++)if(u[a.charCodeAt(T)]=!0,(f||y)&&w){const E=h0[a.charAt(T)];E&&(u[E.charCodeAt(0)]=!0)}}populate(a,u,f){const y=this.layers[0],w=y.layout,T=w.get("text-font"),E=w.get("text-field"),I=w.get("icon-image"),z=(E.value.kind!=="constant"||E.value.value instanceof gi&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(T.value.kind!=="constant"||T.value.value.length>0),j=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,W=w.get("symbol-sort-key");if(this.features=[],!z&&!j)return;const K=u.iconDependencies,ae=u.glyphDependencies,oe=u.availableImages,pe=new bi(this.zoom);for(const{feature:be,id:Pe,index:Ve,sourceLayerIndex:ke}of a){const Ne=y._featureFilter.needGeometry,ht=Go(be,Ne);if(!y._featureFilter.filter(pe,ht,f))continue;let yt,Wt;if(Ne||(ht.geometry=Ho(be)),z){const Gt=y.getValueAndResolveTokens("text-field",ht,f,oe),Vt=gi.factory(Gt),Rt=this.hasRTLText=this.hasRTLText||fP(Vt);(!Rt||No.getRTLTextPluginStatus()==="unavailable"||Rt&&No.isParsed())&&(yt=XC(Vt,y,ht))}if(j){const Gt=y.getValueAndResolveTokens("icon-image",ht,f,oe);Wt=Gt instanceof Pn?Gt:Pn.fromString(Gt)}if(!yt&&!Wt)continue;const un=this.sortFeaturesByKey?W.evaluate(ht,{},f):void 0;if(this.features.push({id:Pe,text:yt,icon:Wt,index:Ve,sourceLayerIndex:ke,geometry:ht.geometry,properties:be.properties,type:hP[be.type],sortKey:un}),Wt&&(K[Wt.name]=!0),yt){const Gt=T.evaluate(ht,{},f).join(","),Vt=w.get("text-rotation-alignment")!=="viewport"&&w.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(h.ah.vertical)>=0;for(const Rt of yt.sections)if(Rt.image)K[Rt.image.name]=!0;else{const sn=nu(yt.toString()),Ot=Rt.fontStack||Gt,Tt=ae[Ot]=ae[Ot]||{};this.calculateGlyphDependencies(Rt.text,Tt,Vt,this.allowVerticalPlacement,sn)}}}w.get("symbol-placement")==="line"&&(this.features=function(be){const Pe={},Ve={},ke=[];let Ne=0;function ht(Gt){ke.push(be[Gt]),Ne++}function yt(Gt,Vt,Rt){const sn=Ve[Gt];return delete Ve[Gt],Ve[Vt]=sn,ke[sn].geometry[0].pop(),ke[sn].geometry[0]=ke[sn].geometry[0].concat(Rt[0]),sn}function Wt(Gt,Vt,Rt){const sn=Pe[Vt];return delete Pe[Vt],Pe[Gt]=sn,ke[sn].geometry[0].shift(),ke[sn].geometry[0]=Rt[0].concat(ke[sn].geometry[0]),sn}function un(Gt,Vt,Rt){const sn=Rt?Vt[0][Vt[0].length-1]:Vt[0][0];return`${Gt}:${sn.x}:${sn.y}`}for(let Gt=0;Gt<be.length;Gt++){const Vt=be[Gt],Rt=Vt.geometry,sn=Vt.text?Vt.text.toString():null;if(!sn){ht(Gt);continue}const Ot=un(sn,Rt),Tt=un(sn,Rt,!0);if(Ot in Ve&&Tt in Pe&&Ve[Ot]!==Pe[Tt]){const vn=Wt(Ot,Tt,Rt),dn=yt(Ot,Tt,ke[vn].geometry);delete Pe[Ot],delete Ve[Tt],Ve[un(sn,ke[dn].geometry,!0)]=dn,ke[vn].geometry=null}else Ot in Ve?yt(Ot,Tt,Rt):Tt in Pe?Wt(Ot,Tt,Rt):(ht(Gt),Pe[Ot]=Ne-1,Ve[Tt]=Ne-1)}return ke.filter(Gt=>Gt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((be,Pe)=>be.sortKey-Pe.sortKey)}update(a,u,f){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(a,u,this.layers,f),this.icon.programConfigurations.updatePaintArrays(a,u,this.layers,f))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(a){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(a),this.iconCollisionBox.upload(a)),this.text.upload(a,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(a,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(a,u){const f=this.lineVertexArray.length;if(a.segment!==void 0){let y=a.dist(u[a.segment+1]),w=a.dist(u[a.segment]);const T={};for(let E=a.segment+1;E<u.length;E++)T[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:y},E<u.length-1&&(y+=u[E+1].dist(u[E]));for(let E=a.segment||0;E>=0;E--)T[E]={x:u[E].x,y:u[E].y,tileUnitDistanceFromAnchor:w},E>0&&(w+=u[E-1].dist(u[E]));for(let E=0;E<u.length;E++){const I=T[E];this.lineVertexArray.emplaceBack(I.x,I.y,I.tileUnitDistanceFromAnchor)}}return{lineStartIndex:f,lineLength:this.lineVertexArray.length-f}}addSymbols(a,u,f,y,w,T,E,I,z,j,W,K){const ae=a.indexArray,oe=a.layoutVertexArray,pe=a.segments.prepareSegment(4*u.length,oe,ae,this.canOverlap?T.sortKey:void 0),be=this.glyphOffsetArray.length,Pe=pe.vertexLength,Ve=this.allowVerticalPlacement&&E===h.ah.vertical?Math.PI/2:0,ke=T.text&&T.text.sections;for(let Ne=0;Ne<u.length;Ne++){const{tl:ht,tr:yt,bl:Wt,br:un,tex:Gt,pixelOffsetTL:Vt,pixelOffsetBR:Rt,minFontScaleX:sn,minFontScaleY:Ot,glyphOffset:Tt,isSDF:vn,sectionIndex:dn}=u[Ne],jn=pe.vertexLength,Si=Tt[1];Jm(oe,I.x,I.y,ht.x,Si+ht.y,Gt.x,Gt.y,f,vn,Vt.x,Vt.y,sn,Ot),Jm(oe,I.x,I.y,yt.x,Si+yt.y,Gt.x+Gt.w,Gt.y,f,vn,Rt.x,Vt.y,sn,Ot),Jm(oe,I.x,I.y,Wt.x,Si+Wt.y,Gt.x,Gt.y+Gt.h,f,vn,Vt.x,Rt.y,sn,Ot),Jm(oe,I.x,I.y,un.x,Si+un.y,Gt.x+Gt.w,Gt.y+Gt.h,f,vn,Rt.x,Rt.y,sn,Ot),Wv(a.dynamicLayoutVertexArray,I,Ve),ae.emplaceBack(jn,jn+1,jn+2),ae.emplaceBack(jn+1,jn+2,jn+3),pe.vertexLength+=4,pe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Tt[0]),Ne!==u.length-1&&dn===u[Ne+1].sectionIndex||a.programConfigurations.populatePaintArrays(oe.length,T,T.index,{},K,ke&&ke[dn])}a.placedSymbolArray.emplaceBack(I.x,I.y,be,this.glyphOffsetArray.length-be,Pe,z,j,I.segment,f?f[0]:0,f?f[1]:0,y[0],y[1],E,0,!1,0,W)}_addCollisionDebugVertex(a,u,f,y,w,T){return u.emplaceBack(0,0),a.emplaceBack(f.x,f.y,y,w,Math.round(T.x),Math.round(T.y))}addCollisionDebugVertices(a,u,f,y,w,T,E){const I=w.segments.prepareSegment(4,w.layoutVertexArray,w.indexArray),z=I.vertexLength,j=w.layoutVertexArray,W=w.collisionVertexArray,K=E.anchorX,ae=E.anchorY;this._addCollisionDebugVertex(j,W,T,K,ae,new M(a,u)),this._addCollisionDebugVertex(j,W,T,K,ae,new M(f,u)),this._addCollisionDebugVertex(j,W,T,K,ae,new M(f,y)),this._addCollisionDebugVertex(j,W,T,K,ae,new M(a,y)),I.vertexLength+=4;const oe=w.indexArray;oe.emplaceBack(z,z+1),oe.emplaceBack(z+1,z+2),oe.emplaceBack(z+2,z+3),oe.emplaceBack(z+3,z),I.primitiveLength+=4}addDebugCollisionBoxes(a,u,f,y){for(let w=a;w<u;w++){const T=this.collisionBoxArray.get(w);this.addCollisionDebugVertices(T.x1,T.y1,T.x2,T.y2,y?this.textCollisionBox:this.iconCollisionBox,T.anchorPoint,f)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new $v(Be,C4.members,lt),this.iconCollisionBox=new $v(Be,C4.members,lt);for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}}_deserializeCollisionBoxesForSymbol(a,u,f,y,w,T,E,I,z){const j={};for(let W=u;W<f;W++){const K=a.get(W);j.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.textFeatureIndex=K.featureIndex;break}for(let W=y;W<w;W++){const K=a.get(W);j.verticalTextBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.verticalTextFeatureIndex=K.featureIndex;break}for(let W=T;W<E;W++){const K=a.get(W);j.iconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.iconFeatureIndex=K.featureIndex;break}for(let W=I;W<z;W++){const K=a.get(W);j.verticalIconBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},j.verticalIconFeatureIndex=K.featureIndex;break}return j}deserializeCollisionBoxes(a){this.collisionArrays=[];for(let u=0;u<this.symbolInstances.length;u++){const f=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(a,f.textBoxStartIndex,f.textBoxEndIndex,f.verticalTextBoxStartIndex,f.verticalTextBoxEndIndex,f.iconBoxStartIndex,f.iconBoxEndIndex,f.verticalIconBoxStartIndex,f.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(a,u){const f=a.placedSymbolArray.get(u),y=f.vertexStartIndex+4*f.numGlyphs;for(let w=f.vertexStartIndex;w<y;w+=4)a.indexArray.emplaceBack(w,w+1,w+2),a.indexArray.emplaceBack(w+1,w+2,w+3)}getSortedSymbolIndexes(a){if(this.sortedAngle===a&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const u=Math.sin(a),f=Math.cos(a),y=[],w=[],T=[];for(let E=0;E<this.symbolInstances.length;++E){T.push(E);const I=this.symbolInstances.get(E);y.push(0|Math.round(u*I.anchorX+f*I.anchorY)),w.push(I.featureIndex)}return T.sort((E,I)=>y[E]-y[I]||w[I]-w[E]),T}addToSortKeyRanges(a,u){const f=this.sortKeyRanges[this.sortKeyRanges.length-1];f&&f.sortKey===u?f.symbolInstanceEnd=a+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:a,symbolInstanceEnd:a+1})}sortFeatures(a){if(this.sortFeaturesByY&&this.sortedAngle!==a&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(a),this.sortedAngle=a,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const u of this.symbolInstanceIndexes){const f=this.symbolInstances.get(u);this.featureSortOrder.push(f.featureIndex),[f.rightJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.leftJustifiedTextSymbolIndex].forEach((y,w,T)=>{y>=0&&T.indexOf(y)===w&&this.addIndicesForPlacedSymbol(this.text,y)}),f.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,f.verticalPlacedTextSymbolIndex),f.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.placedIconSymbolIndex),f.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,f.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let W4,q4;en("SymbolBucket",Lh,{omit:["layers","collisionBoxArray","features","compareText"]}),Lh.MAX_GLYPHS=65535,Lh.addDynamicAttributes=Wv;var Xv={get paint(){return q4=q4||new Wr({"icon-opacity":new Mn(ie.paint_symbol["icon-opacity"]),"icon-color":new Mn(ie.paint_symbol["icon-color"]),"icon-halo-color":new Mn(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new Mn(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Mn(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new pn(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new pn(ie.paint_symbol["icon-translate-anchor"]),"text-opacity":new Mn(ie.paint_symbol["text-opacity"]),"text-color":new Mn(ie.paint_symbol["text-color"],{runtimeType:Jt,getOverride:c=>c.textColor,hasOverride:c=>!!c.textColor}),"text-halo-color":new Mn(ie.paint_symbol["text-halo-color"]),"text-halo-width":new Mn(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new Mn(ie.paint_symbol["text-halo-blur"]),"text-translate":new pn(ie.paint_symbol["text-translate"]),"text-translate-anchor":new pn(ie.paint_symbol["text-translate-anchor"])})},get layout(){return W4=W4||new Wr({"symbol-placement":new pn(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new pn(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new pn(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Mn(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new pn(ie.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new pn(ie.layout_symbol["icon-allow-overlap"]),"icon-overlap":new pn(ie.layout_symbol["icon-overlap"]),"icon-ignore-placement":new pn(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new pn(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new pn(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new Mn(ie.layout_symbol["icon-size"]),"icon-text-fit":new pn(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new pn(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new Mn(ie.layout_symbol["icon-image"]),"icon-rotate":new Mn(ie.layout_symbol["icon-rotate"]),"icon-padding":new Mn(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new pn(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new Mn(ie.layout_symbol["icon-offset"]),"icon-anchor":new Mn(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new pn(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new pn(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new pn(ie.layout_symbol["text-rotation-alignment"]),"text-field":new Mn(ie.layout_symbol["text-field"]),"text-font":new Mn(ie.layout_symbol["text-font"]),"text-size":new Mn(ie.layout_symbol["text-size"]),"text-max-width":new Mn(ie.layout_symbol["text-max-width"]),"text-line-height":new pn(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new Mn(ie.layout_symbol["text-letter-spacing"]),"text-justify":new Mn(ie.layout_symbol["text-justify"]),"text-radial-offset":new Mn(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new pn(ie.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new Mn(ie.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new Mn(ie.layout_symbol["text-anchor"]),"text-max-angle":new pn(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new pn(ie.layout_symbol["text-writing-mode"]),"text-rotate":new Mn(ie.layout_symbol["text-rotate"]),"text-padding":new pn(ie.layout_symbol["text-padding"]),"text-keep-upright":new pn(ie.layout_symbol["text-keep-upright"]),"text-transform":new Mn(ie.layout_symbol["text-transform"]),"text-offset":new Mn(ie.layout_symbol["text-offset"]),"text-allow-overlap":new pn(ie.layout_symbol["text-allow-overlap"]),"text-overlap":new pn(ie.layout_symbol["text-overlap"]),"text-ignore-placement":new pn(ie.layout_symbol["text-ignore-placement"]),"text-optional":new pn(ie.layout_symbol["text-optional"])})}};class $4{constructor(a){if(a.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=a.property.overrides?a.property.overrides.runtimeType:Un,this.defaultValue=a}evaluate(a){if(a.formattedSection){const u=this.defaultValue.property.overrides;if(u&&u.hasOverride(a.formattedSection))return u.getOverride(a.formattedSection)}return a.feature&&a.featureState?this.defaultValue.evaluate(a.feature,a.featureState):this.defaultValue.property.specification.default}eachChild(a){this.defaultValue.isConstant()||a(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}en("FormatSectionOverride",$4,{omit:["defaultValue"]});class Qm extends Oa{constructor(a){super(a,Xv)}recalculate(a,u){if(super.recalculate(a,u),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const f=this.layout.get("text-writing-mode");if(f){const y=[];for(const w of f)y.indexOf(w)<0&&y.push(w);this.layout._values["text-writing-mode"]=y}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(a,u,f,y){const w=this.layout.get(a).evaluate(u,{},f,y),T=this._unevaluatedLayout._values[a];return T.isDataDriven()||yi(T.value)||!w?w:function(E,I){return I.replace(/{([^{}]+)}/g,(z,j)=>E&&j in E?String(E[j]):"")}(u.properties,w)}createBucket(a){return new Lh(a)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const a of Xv.paint.overridableProperties){if(!Qm.hasPaintOverride(this.layout,a))continue;const u=this.paint.get(a),f=new $4(u),y=new Jc(f,u.property.specification);let w=null;w=u.value.kind==="constant"||u.value.kind==="source"?new zl("source",y):new hh("composite",y,u.value.zoomStops),this.paint._values[a]=new Ba(u.property,w,u.parameters)}}_handleOverridablePaintPropertyUpdate(a,u,f){return!(!this.layout||u.isDataDriven()||f.isDataDriven())&&Qm.hasPaintOverride(this.layout,a)}static hasPaintOverride(a,u){const f=a.get("text-field"),y=Xv.paint.properties[u];let w=!1;const T=E=>{for(const I of E)if(y.overrides&&y.overrides.hasOverride(I))return void(w=!0)};if(f.value.kind==="constant"&&f.value.value instanceof gi)T(f.value.value.sections);else if(f.value.kind==="source"){const E=z=>{w||(z instanceof sa&&fi(z.value)===Dt?T(z.value.sections):z instanceof uh?T(z.sections):z.eachChild(E))},I=f.value;I._styleExpression&&E(I._styleExpression.expression)}return w}}let X4;var pP={get paint(){return X4=X4||new Wr({"background-color":new pn(ie.paint_background["background-color"]),"background-pattern":new Hf(ie.paint_background["background-pattern"]),"background-opacity":new pn(ie.paint_background["background-opacity"])})}};class mP extends Oa{constructor(a){super(a,pP)}}let Z4;var gP={get paint(){return Z4=Z4||new Wr({"raster-opacity":new pn(ie.paint_raster["raster-opacity"]),"raster-hue-rotate":new pn(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new pn(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new pn(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new pn(ie.paint_raster["raster-saturation"]),"raster-contrast":new pn(ie.paint_raster["raster-contrast"]),"raster-resampling":new pn(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new pn(ie.paint_raster["raster-fade-duration"])})}};class yP extends Oa{constructor(a){super(a,gP)}}class vP extends Oa{constructor(a){super(a,{}),this.onAdd=u=>{this.implementation.onAdd&&this.implementation.onAdd(u,u.painter.context.gl)},this.onRemove=u=>{this.implementation.onRemove&&this.implementation.onRemove(u,u.painter.context.gl)},this.implementation=a}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class _P{constructor(a){this._methodToThrottle=a,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Zv=63710088e-1;class Yl{constructor(a,u){if(isNaN(a)||isNaN(u))throw new Error(`Invalid LngLat object: (${a}, ${u})`);if(this.lng=+a,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Yl(Y(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(a){const u=Math.PI/180,f=this.lat*u,y=a.lat*u,w=Math.sin(f)*Math.sin(y)+Math.cos(f)*Math.cos(y)*Math.cos((a.lng-this.lng)*u);return Zv*Math.acos(Math.min(w,1))}static convert(a){if(a instanceof Yl)return a;if(Array.isArray(a)&&(a.length===2||a.length===3))return new Yl(Number(a[0]),Number(a[1]));if(!Array.isArray(a)&&typeof a=="object"&&a!==null)return new Yl(Number("lng"in a?a.lng:a.lon),Number(a.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Y4=2*Math.PI*Zv;function K4(c){return Y4*Math.cos(c*Math.PI/180)}function J4(c){return(180+c)/360}function Q4(c){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+c*Math.PI/360)))/360}function e3(c,a){return c/K4(a)}function Yv(c){return 360/Math.PI*Math.atan(Math.exp((180-360*c)*Math.PI/180))-90}class eg{constructor(a,u,f=0){this.x=+a,this.y=+u,this.z=+f}static fromLngLat(a,u=0){const f=Yl.convert(a);return new eg(J4(f.lng),Q4(f.lat),e3(u,f.lat))}toLngLat(){return new Yl(360*this.x-180,Yv(this.y))}toAltitude(){return this.z*K4(Yv(this.y))}meterInMercatorCoordinateUnits(){return 1/Y4*(a=Yv(this.y),1/Math.cos(a*Math.PI/180));var a}}function t3(c,a,u){var f=2*Math.PI*6378137/256/Math.pow(2,u);return[c*f-2*Math.PI*6378137/2,a*f-2*Math.PI*6378137/2]}class Kv{constructor(a,u,f){if(a<0||a>25||f<0||f>=Math.pow(2,a)||u<0||u>=Math.pow(2,a))throw new Error(`x=${u}, y=${f}, z=${a} outside of bounds. 0<=x<${Math.pow(2,a)}, 0<=y<${Math.pow(2,a)} 0<=z<=25 `);this.z=a,this.x=u,this.y=f,this.key=m0(0,a,a,u,f)}equals(a){return this.z===a.z&&this.x===a.x&&this.y===a.y}url(a,u,f){const y=(T=this.y,E=this.z,I=t3(256*(w=this.x),256*(T=Math.pow(2,E)-T-1),E),z=t3(256*(w+1),256*(T+1),E),I[0]+","+I[1]+","+z[0]+","+z[1]);var w,T,E,I,z;const j=function(W,K,ae){let oe,pe="";for(let be=W;be>0;be--)oe=1<<be-1,pe+=(K&oe?1:0)+(ae&oe?2:0);return pe}(this.z,this.x,this.y);return a[(this.x+this.y)%a.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(f==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,u>1?"@2x":"").replace(/{quadkey}/g,j).replace(/{bbox-epsg-3857}/g,y)}isChildOf(a){const u=this.z-a.z;return u>0&&a.x===this.x>>u&&a.y===this.y>>u}getTilePoint(a){const u=Math.pow(2,this.z);return new M((a.x*u-this.x)*qn,(a.y*u-this.y)*qn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class n3{constructor(a,u){this.wrap=a,this.canonical=u,this.key=m0(a,u.z,u.z,u.x,u.y)}}class Ga{constructor(a,u,f,y,w){if(a<f)throw new Error(`overscaledZ should be >= z; overscaledZ = ${a}; z = ${f}`);this.overscaledZ=a,this.wrap=u,this.canonical=new Kv(f,+y,+w),this.key=m0(u,a,f,y,w)}clone(){return new Ga(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(a){return this.overscaledZ===a.overscaledZ&&this.wrap===a.wrap&&this.canonical.equals(a.canonical)}scaledTo(a){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const u=this.canonical.z-a;return a>this.canonical.z?new Ga(a,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ga(a,this.wrap,a,this.canonical.x>>u,this.canonical.y>>u)}calculateScaledKey(a,u){if(a>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${a}; overscaledZ = ${this.overscaledZ}`);const f=this.canonical.z-a;return a>this.canonical.z?m0(this.wrap*+u,a,this.canonical.z,this.canonical.x,this.canonical.y):m0(this.wrap*+u,a,a,this.canonical.x>>f,this.canonical.y>>f)}isChildOf(a){if(a.wrap!==this.wrap)return!1;const u=this.canonical.z-a.canonical.z;return a.overscaledZ===0||a.overscaledZ<this.overscaledZ&&a.canonical.x===this.canonical.x>>u&&a.canonical.y===this.canonical.y>>u}children(a){if(this.overscaledZ>=a)return[new Ga(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const u=this.canonical.z+1,f=2*this.canonical.x,y=2*this.canonical.y;return[new Ga(u,this.wrap,u,f,y),new Ga(u,this.wrap,u,f+1,y),new Ga(u,this.wrap,u,f,y+1),new Ga(u,this.wrap,u,f+1,y+1)]}isLessThan(a){return this.wrap<a.wrap||!(this.wrap>a.wrap)&&(this.overscaledZ<a.overscaledZ||!(this.overscaledZ>a.overscaledZ)&&(this.canonical.x<a.canonical.x||!(this.canonical.x>a.canonical.x)&&this.canonical.y<a.canonical.y))}wrapped(){return new Ga(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(a){return new Ga(this.overscaledZ,a,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new n3(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(a){return this.canonical.getTilePoint(new eg(a.x-this.wrap,a.y))}}function m0(c,a,u,f,y){(c*=2)<0&&(c=-1*c-1);const w=1<<u;return(w*w*c+w*y+f).toString(36)+u.toString(36)+a.toString(36)}en("CanonicalTileID",Kv),en("OverscaledTileID",Ga,{omit:["posMatrix"]});class i3{constructor(a,u,f,y=1,w=1,T=1,E=0){if(this.uid=a,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(f&&!["mapbox","terrarium","custom"].includes(f))return void Ae(`"${f}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=u.height;const I=this.dim=u.height-2;switch(this.data=new Uint32Array(u.data.buffer),f){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=y,this.greenFactor=w,this.blueFactor=T,this.baseShift=E;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let z=0;z<I;z++)this.data[this._idx(-1,z)]=this.data[this._idx(0,z)],this.data[this._idx(I,z)]=this.data[this._idx(I-1,z)],this.data[this._idx(z,-1)]=this.data[this._idx(z,0)],this.data[this._idx(z,I)]=this.data[this._idx(z,I-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(I,-1)]=this.data[this._idx(I-1,0)],this.data[this._idx(-1,I)]=this.data[this._idx(0,I-1)],this.data[this._idx(I,I)]=this.data[this._idx(I-1,I-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let z=0;z<I;z++)for(let j=0;j<I;j++){const W=this.get(z,j);W>this.max&&(this.max=W),W<this.min&&(this.min=W)}}get(a,u){const f=new Uint8Array(this.data.buffer),y=4*this._idx(a,u);return this.unpack(f[y],f[y+1],f[y+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(a,u){if(a<-1||a>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(a+1)}unpack(a,u,f){return a*this.redFactor+u*this.greenFactor+f*this.blueFactor-this.baseShift}getPixels(){return new Ha({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(a,u,f){if(this.dim!==a.dim)throw new Error("dem dimension mismatch");let y=u*this.dim,w=u*this.dim+this.dim,T=f*this.dim,E=f*this.dim+this.dim;switch(u){case-1:y=w-1;break;case 1:w=y+1}switch(f){case-1:T=E-1;break;case 1:E=T+1}const I=-u*this.dim,z=-f*this.dim;for(let j=T;j<E;j++)for(let W=y;W<w;W++)this.data[this._idx(W,j)]=a.data[this._idx(W+I,j+z)]}}en("DEMData",i3);class r3{constructor(a){this._stringToNumber={},this._numberToString=[];for(let u=0;u<a.length;u++){const f=a[u];this._stringToNumber[f]=u,this._numberToString[u]=f}}encode(a){return this._stringToNumber[a]}decode(a){if(a>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${a} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[a]}}class a3{constructor(a,u,f,y,w){this.type="Feature",this._vectorTileFeature=a,a._z=u,a._x=f,a._y=y,this.properties=a.properties,this.id=w}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(a){this._geometry=a}toJSON(){const a={geometry:this.geometry};for(const u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(a[u]=this[u]);return a}}class s3{constructor(a,u){this.tileID=a,this.x=a.canonical.x,this.y=a.canonical.y,this.z=a.canonical.z,this.grid=new Ps(qn,16,0),this.grid3D=new Ps(qn,16,0),this.featureIndexArray=new H,this.promoteId=u}insert(a,u,f,y,w,T){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(f,y,w);const I=T?this.grid3D:this.grid;for(let z=0;z<u.length;z++){const j=u[z],W=[1/0,1/0,-1/0,-1/0];for(let K=0;K<j.length;K++){const ae=j[K];W[0]=Math.min(W[0],ae.x),W[1]=Math.min(W[1],ae.y),W[2]=Math.max(W[2],ae.x),W[3]=Math.max(W[3],ae.y)}W[0]<qn&&W[1]<qn&&W[2]>=0&&W[3]>=0&&I.insert(E,W[0],W[1],W[2],W[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new $l.VectorTile(new Ov(this.rawTileData)).layers,this.sourceLayerCoder=new r3(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(a,u,f,y){this.loadVTLayers();const w=a.params||{},T=qn/a.tileSize/a.scale,E=ph(w.filter),I=a.queryGeometry,z=a.queryPadding*T,j=l3(I),W=this.grid.query(j.minX-z,j.minY-z,j.maxX+z,j.maxY+z),K=l3(a.cameraQueryGeometry),ae=this.grid3D.query(K.minX-z,K.minY-z,K.maxX+z,K.maxY+z,(be,Pe,Ve,ke)=>function(Ne,ht,yt,Wt,un){for(const Vt of Ne)if(ht<=Vt.x&&yt<=Vt.y&&Wt>=Vt.x&&un>=Vt.y)return!0;const Gt=[new M(ht,yt),new M(ht,un),new M(Wt,un),new M(Wt,yt)];if(Ne.length>2){for(const Vt of Gt)if(Ah(Ne,Vt))return!0}for(let Vt=0;Vt<Ne.length-1;Vt++)if(K7(Ne[Vt],Ne[Vt+1],Gt))return!0;return!1}(a.cameraQueryGeometry,be-z,Pe-z,Ve+z,ke+z));for(const be of ae)W.push(be);W.sort(xP);const oe={};let pe;for(let be=0;be<W.length;be++){const Pe=W[be];if(Pe===pe)continue;pe=Pe;const Ve=this.featureIndexArray.get(Pe);let ke=null;this.loadMatchingFeature(oe,Ve.bucketIndex,Ve.sourceLayerIndex,Ve.featureIndex,E,w.layers,w.availableImages,u,f,y,(Ne,ht,yt)=>(ke||(ke=Ho(Ne)),ht.queryIntersectsFeature(I,Ne,yt,ke,this.z,a.transform,T,a.pixelPosMatrix)))}return oe}loadMatchingFeature(a,u,f,y,w,T,E,I,z,j,W){const K=this.bucketLayerIDs[u];if(T&&!function(be,Pe){for(let Ve=0;Ve<be.length;Ve++)if(Pe.indexOf(be[Ve])>=0)return!0;return!1}(T,K))return;const ae=this.sourceLayerCoder.decode(f),oe=this.vtLayers[ae].feature(y);if(w.needGeometry){const be=Go(oe,!0);if(!w.filter(new bi(this.tileID.overscaledZ),be,this.tileID.canonical))return}else if(!w.filter(new bi(this.tileID.overscaledZ),oe))return;const pe=this.getId(oe,ae);for(let be=0;be<K.length;be++){const Pe=K[be];if(T&&T.indexOf(Pe)<0)continue;const Ve=I[Pe];if(!Ve)continue;let ke={};pe&&j&&(ke=j.getState(Ve.sourceLayer||"_geojsonTileLayer",pe));const Ne=Q({},z[Pe]);Ne.paint=o3(Ne.paint,Ve.paint,oe,ke,E),Ne.layout=o3(Ne.layout,Ve.layout,oe,ke,E);const ht=!W||W(oe,Ve,ke);if(!ht)continue;const yt=new a3(oe,this.z,this.x,this.y,pe);yt.layer=Ne;let Wt=a[Pe];Wt===void 0&&(Wt=a[Pe]=[]),Wt.push({featureIndex:y,feature:yt,intersectionZ:ht})}}lookupSymbolFeatures(a,u,f,y,w,T,E,I){const z={};this.loadVTLayers();const j=ph(w);for(const W of a)this.loadMatchingFeature(z,f,y,W,j,T,E,I,u);return z}hasLayer(a){for(const u of this.bucketLayerIDs)for(const f of u)if(a===f)return!0;return!1}getId(a,u){let f=a.id;return this.promoteId&&(f=a.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]],typeof f=="boolean"&&(f=Number(f))),f}}function o3(c,a,u,f,y){return re(c,(w,T)=>{const E=a instanceof iu?a.get(T):null;return E&&E.evaluate?E.evaluate(u,f,y):E})}function l3(c){let a=1/0,u=1/0,f=-1/0,y=-1/0;for(const w of c)a=Math.min(a,w.x),u=Math.min(u,w.y),f=Math.max(f,w.x),y=Math.max(y,w.y);return{minX:a,minY:u,maxX:f,maxY:y}}function xP(c,a){return a-c}function c3(c,a,u,f,y){const w=[];for(let T=0;T<c.length;T++){const E=c[T];let I;for(let z=0;z<E.length-1;z++){let j=E[z],W=E[z+1];j.x<a&&W.x<a||(j.x<a?j=new M(a,j.y+(a-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x<a&&(W=new M(a,j.y+(a-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y<u&&W.y<u||(j.y<u?j=new M(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round():W.y<u&&(W=new M(j.x+(u-j.y)/(W.y-j.y)*(W.x-j.x),u)._round()),j.x>=f&&W.x>=f||(j.x>=f?j=new M(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round():W.x>=f&&(W=new M(f,j.y+(f-j.x)/(W.x-j.x)*(W.y-j.y))._round()),j.y>=y&&W.y>=y||(j.y>=y?j=new M(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round():W.y>=y&&(W=new M(j.x+(y-j.y)/(W.y-j.y)*(W.x-j.x),y)._round()),I&&j.equals(I[I.length-1])||(I=[j],w.push(I)),I.push(W)))))}}return w}en("FeatureIndex",s3,{omit:["rawTileData","sourceLayerCoder"]});class Kl extends M{constructor(a,u,f,y){super(a,u),this.angle=f,y!==void 0&&(this.segment=y)}clone(){return new Kl(this.x,this.y,this.angle,this.segment)}}function u3(c,a,u,f,y){if(a.segment===void 0||u===0)return!0;let w=a,T=a.segment+1,E=0;for(;E>-u/2;){if(T--,T<0)return!1;E-=c[T].dist(w),w=c[T]}E+=c[T].dist(c[T+1]),T++;const I=[];let z=0;for(;E<u/2;){const j=c[T],W=c[T+1];if(!W)return!1;let K=c[T-1].angleTo(j)-j.angleTo(W);for(K=Math.abs((K+3*Math.PI)%(2*Math.PI)-Math.PI),I.push({distance:E,angleDelta:K}),z+=K;E-I[0].distance>f;)z-=I.shift().angleDelta;if(z>y)return!1;T++,E+=j.dist(W)}return!0}function h3(c){let a=0;for(let u=0;u<c.length-1;u++)a+=c[u].dist(c[u+1]);return a}function d3(c,a,u){return c?.6*a*u:0}function f3(c,a){return Math.max(c?c.right-c.left:0,a?a.right-a.left:0)}function bP(c,a,u,f,y,w){const T=d3(u,y,w),E=f3(u,f)*w;let I=0;const z=h3(c)/2;for(let j=0;j<c.length-1;j++){const W=c[j],K=c[j+1],ae=W.dist(K);if(I+ae>z){const oe=(z-I)/ae,pe=oa.number(W.x,K.x,oe),be=oa.number(W.y,K.y,oe),Pe=new Kl(pe,be,K.angleTo(W),j);return Pe._round(),!T||u3(c,Pe,E,T,a)?Pe:void 0}I+=ae}}function wP(c,a,u,f,y,w,T,E,I){const z=d3(f,w,T),j=f3(f,y),W=j*T,K=c[0].x===0||c[0].x===I||c[0].y===0||c[0].y===I;return a-W<a/4&&(a=W+a/4),p3(c,K?a/2*E%a:(j/2+2*w)*T*E%a,a,z,u,W,K,!1,I)}function p3(c,a,u,f,y,w,T,E,I){const z=w/2,j=h3(c);let W=0,K=a-u,ae=[];for(let oe=0;oe<c.length-1;oe++){const pe=c[oe],be=c[oe+1],Pe=pe.dist(be),Ve=be.angleTo(pe);for(;K+u<W+Pe;){K+=u;const ke=(K-W)/Pe,Ne=oa.number(pe.x,be.x,ke),ht=oa.number(pe.y,be.y,ke);if(Ne>=0&&Ne<I&&ht>=0&&ht<I&&K-z>=0&&K+z<=j){const yt=new Kl(Ne,ht,Ve,oe);yt._round(),f&&!u3(c,yt,w,f,y)||ae.push(yt)}}W+=Pe}return E||ae.length||T||(ae=p3(c,W/2,u,f,y,w,T,!0,I)),ae}en("Anchor",Kl);const zh=ua;function m3(c,a,u,f){const y=[],w=c.image,T=w.pixelRatio,E=w.paddedRect.w-2*zh,I=w.paddedRect.h-2*zh,z=c.right-c.left,j=c.bottom-c.top,W=w.stretchX||[[0,E]],K=w.stretchY||[[0,I]],ae=(Rt,sn)=>Rt+sn[1]-sn[0],oe=W.reduce(ae,0),pe=K.reduce(ae,0),be=E-oe,Pe=I-pe;let Ve=0,ke=oe,Ne=0,ht=pe,yt=0,Wt=be,un=0,Gt=Pe;if(w.content&&f){const Rt=w.content;Ve=tg(W,0,Rt[0]),Ne=tg(K,0,Rt[1]),ke=tg(W,Rt[0],Rt[2]),ht=tg(K,Rt[1],Rt[3]),yt=Rt[0]-Ve,un=Rt[1]-Ne,Wt=Rt[2]-Rt[0]-ke,Gt=Rt[3]-Rt[1]-ht}const Vt=(Rt,sn,Ot,Tt)=>{const vn=ng(Rt.stretch-Ve,ke,z,c.left),dn=ig(Rt.fixed-yt,Wt,Rt.stretch,oe),jn=ng(sn.stretch-Ne,ht,j,c.top),Si=ig(sn.fixed-un,Gt,sn.stretch,pe),Ci=ng(Ot.stretch-Ve,ke,z,c.left),sr=ig(Ot.fixed-yt,Wt,Ot.stretch,oe),Aa=ng(Tt.stretch-Ne,ht,j,c.top),Xr=ig(Tt.fixed-un,Gt,Tt.stretch,pe),er=new M(vn,jn),_r=new M(Ci,jn),Cr=new M(Ci,Aa),Zr=new M(vn,Aa),Yr=new M(dn/T,Si/T),or=new M(sr/T,Xr/T),lr=a*Math.PI/180;if(lr){const Fr=Math.sin(lr),ha=Math.cos(lr),da=[ha,-Fr,Fr,ha];er._matMult(da),_r._matMult(da),Zr._matMult(da),Cr._matMult(da)}const zr=Rt.stretch+Rt.fixed,Kr=sn.stretch+sn.fixed;return{tl:er,tr:_r,bl:Zr,br:Cr,tex:{x:w.paddedRect.x+zh+zr,y:w.paddedRect.y+zh+Kr,w:Ot.stretch+Ot.fixed-zr,h:Tt.stretch+Tt.fixed-Kr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Yr,pixelOffsetBR:or,minFontScaleX:Wt/T/z,minFontScaleY:Gt/T/j,isSDF:u}};if(f&&(w.stretchX||w.stretchY)){const Rt=g3(W,be,oe),sn=g3(K,Pe,pe);for(let Ot=0;Ot<Rt.length-1;Ot++){const Tt=Rt[Ot],vn=Rt[Ot+1];for(let dn=0;dn<sn.length-1;dn++)y.push(Vt(Tt,sn[dn],vn,sn[dn+1]))}}else y.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:I+1}));return y}function tg(c,a,u){let f=0;for(const y of c)f+=Math.max(a,Math.min(u,y[1]))-Math.max(a,Math.min(u,y[0]));return f}function g3(c,a,u){const f=[{fixed:-zh,stretch:0}];for(const[y,w]of c){const T=f[f.length-1];f.push({fixed:y-T.stretch,stretch:T.stretch}),f.push({fixed:y-T.stretch,stretch:T.stretch+(w-y)})}return f.push({fixed:a+zh,stretch:u}),f}function ng(c,a,u,f){return c/a*u+f}function ig(c,a,u,f){return c-a*u/f}class rg{constructor(a,u,f,y,w,T,E,I,z,j){if(this.boxStartIndex=a.length,z){let W=T.top,K=T.bottom;const ae=T.collisionPadding;ae&&(W-=ae[1],K+=ae[3]);let oe=K-W;oe>0&&(oe=Math.max(10,oe),this.circleDiameter=oe)}else{let W=T.top*E-I[0],K=T.bottom*E+I[2],ae=T.left*E-I[3],oe=T.right*E+I[1];const pe=T.collisionPadding;if(pe&&(ae-=pe[0]*E,W-=pe[1]*E,oe+=pe[2]*E,K+=pe[3]*E),j){const be=new M(ae,W),Pe=new M(oe,W),Ve=new M(ae,K),ke=new M(oe,K),Ne=j*Math.PI/180;be._rotate(Ne),Pe._rotate(Ne),Ve._rotate(Ne),ke._rotate(Ne),ae=Math.min(be.x,Pe.x,Ve.x,ke.x),oe=Math.max(be.x,Pe.x,Ve.x,ke.x),W=Math.min(be.y,Pe.y,Ve.y,ke.y),K=Math.max(be.y,Pe.y,Ve.y,ke.y)}a.emplaceBack(u.x,u.y,ae,W,oe,K,f,y,w)}this.boxEndIndex=a.length}}class SP{constructor(a=[],u=MP){if(this.data=a,this.length=this.data.length,this.compare=u,this.length>0)for(let f=(this.length>>1)-1;f>=0;f--)this._down(f)}push(a){this.data.push(a),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const a=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),a}peek(){return this.data[0]}_up(a){const{data:u,compare:f}=this,y=u[a];for(;a>0;){const w=a-1>>1,T=u[w];if(f(y,T)>=0)break;u[a]=T,a=w}u[a]=y}_down(a){const{data:u,compare:f}=this,y=this.length>>1,w=u[a];for(;a<y;){let T=1+(a<<1),E=u[T];const I=T+1;if(I<this.length&&f(u[I],E)<0&&(T=I,E=u[I]),f(E,w)>=0)break;u[a]=E,a=T}u[a]=w}}function MP(c,a){return c<a?-1:c>a?1:0}function TP(c,a=1,u=!1){let f=1/0,y=1/0,w=-1/0,T=-1/0;const E=c[0];for(let ae=0;ae<E.length;ae++){const oe=E[ae];(!ae||oe.x<f)&&(f=oe.x),(!ae||oe.y<y)&&(y=oe.y),(!ae||oe.x>w)&&(w=oe.x),(!ae||oe.y>T)&&(T=oe.y)}const I=Math.min(w-f,T-y);let z=I/2;const j=new SP([],EP);if(I===0)return new M(f,y);for(let ae=f;ae<w;ae+=I)for(let oe=y;oe<T;oe+=I)j.push(new Fh(ae+z,oe+z,z,c));let W=function(ae){let oe=0,pe=0,be=0;const Pe=ae[0];for(let Ve=0,ke=Pe.length,Ne=ke-1;Ve<ke;Ne=Ve++){const ht=Pe[Ve],yt=Pe[Ne],Wt=ht.x*yt.y-yt.x*ht.y;pe+=(ht.x+yt.x)*Wt,be+=(ht.y+yt.y)*Wt,oe+=3*Wt}return new Fh(pe/oe,be/oe,0,ae)}(c),K=j.length;for(;j.length;){const ae=j.pop();(ae.d>W.d||!W.d)&&(W=ae,u&&console.log("found best %d after %d probes",Math.round(1e4*ae.d)/1e4,K)),ae.max-W.d<=a||(z=ae.h/2,j.push(new Fh(ae.p.x-z,ae.p.y-z,z,c)),j.push(new Fh(ae.p.x+z,ae.p.y-z,z,c)),j.push(new Fh(ae.p.x-z,ae.p.y+z,z,c)),j.push(new Fh(ae.p.x+z,ae.p.y+z,z,c)),K+=4)}return u&&(console.log(`num probes: ${K}`),console.log(`best distance: ${W.d}`)),W.p}function EP(c,a){return a.max-c.max}function Fh(c,a,u,f){this.p=new M(c,a),this.h=u,this.d=function(y,w){let T=!1,E=1/0;for(let I=0;I<w.length;I++){const z=w[I];for(let j=0,W=z.length,K=W-1;j<W;K=j++){const ae=z[j],oe=z[K];ae.y>y.y!=oe.y>y.y&&y.x<(oe.x-ae.x)*(y.y-ae.y)/(oe.y-ae.y)+ae.x&&(T=!T),E=Math.min(E,Qw(y,ae,oe))}}return(T?1:-1)*Math.sqrt(E)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}var Ar;h.ap=void 0,(Ar=h.ap||(h.ap={}))[Ar.center=1]="center",Ar[Ar.left=2]="left",Ar[Ar.right=3]="right",Ar[Ar.top=4]="top",Ar[Ar.bottom=5]="bottom",Ar[Ar["top-left"]=6]="top-left",Ar[Ar["top-right"]=7]="top-right",Ar[Ar["bottom-left"]=8]="bottom-left",Ar[Ar["bottom-right"]=9]="bottom-right";const Jl=7,Jv=Number.POSITIVE_INFINITY;function y3(c,a){return a[1]!==Jv?function(u,f,y){let w=0,T=0;switch(f=Math.abs(f),y=Math.abs(y),u){case"top-right":case"top-left":case"top":T=y-Jl;break;case"bottom-right":case"bottom-left":case"bottom":T=-y+Jl}switch(u){case"top-right":case"bottom-right":case"right":w=-f;break;case"top-left":case"bottom-left":case"left":w=f}return[w,T]}(c,a[0],a[1]):function(u,f){let y=0,w=0;f<0&&(f=0);const T=f/Math.SQRT2;switch(u){case"top-right":case"top-left":w=T-Jl;break;case"bottom-right":case"bottom-left":w=-T+Jl;break;case"bottom":w=-f+Jl;break;case"top":w=f-Jl}switch(u){case"top-right":case"bottom-right":y=-T;break;case"top-left":case"bottom-left":y=T;break;case"left":y=f;break;case"right":y=-f}return[y,w]}(c,a[0])}function v3(c,a,u){var f;const y=c.layout,w=(f=y.get("text-variable-anchor-offset"))===null||f===void 0?void 0:f.evaluate(a,{},u);if(w){const E=w.values,I=[];for(let z=0;z<E.length;z+=2){const j=I[z]=E[z],W=E[z+1].map(K=>K*ar);j.startsWith("top")?W[1]-=Jl:j.startsWith("bottom")&&(W[1]+=Jl),I[z+1]=W}return new Wn(I)}const T=y.get("text-variable-anchor");if(T){let E;E=c._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[y.get("text-radial-offset").evaluate(a,{},u)*ar,Jv]:y.get("text-offset").evaluate(a,{},u).map(z=>z*ar);const I=[];for(const z of T)I.push(z,y3(z,E));return new Wn(I)}return null}function Qv(c){switch(c){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function AP(c,a,u,f,y,w,T,E,I,z,j){let W=w.textMaxSize.evaluate(a,{});W===void 0&&(W=T);const K=c.layers[0].layout,ae=K.get("icon-offset").evaluate(a,{},j),oe=x3(u.horizontal),pe=T/24,be=c.tilePixelRatio*pe,Pe=c.tilePixelRatio*W/24,Ve=c.tilePixelRatio*E,ke=c.tilePixelRatio*K.get("symbol-spacing"),Ne=K.get("text-padding")*c.tilePixelRatio,ht=function(Tt,vn,dn,jn=1){const Si=Tt.get("icon-padding").evaluate(vn,{},dn),Ci=Si&&Si.values;return[Ci[0]*jn,Ci[1]*jn,Ci[2]*jn,Ci[3]*jn]}(K,a,j,c.tilePixelRatio),yt=K.get("text-max-angle")/180*Math.PI,Wt=K.get("text-rotation-alignment")!=="viewport"&&K.get("symbol-placement")!=="point",un=K.get("icon-rotation-alignment")==="map"&&K.get("symbol-placement")!=="point",Gt=K.get("symbol-placement"),Vt=ke/2,Rt=K.get("icon-text-fit");let sn;f&&Rt!=="none"&&(c.allowVerticalPlacement&&u.vertical&&(sn=G4(f,u.vertical,Rt,K.get("icon-text-fit-padding"),ae,pe)),oe&&(f=G4(f,oe,Rt,K.get("icon-text-fit-padding"),ae,pe)));const Ot=(Tt,vn)=>{vn.x<0||vn.x>=qn||vn.y<0||vn.y>=qn||function(dn,jn,Si,Ci,sr,Aa,Xr,er,_r,Cr,Zr,Yr,or,lr,zr,Kr,Fr,ha,da,cr,Zn,Nr,Pr,ur,hs){const Is=dn.addToLineVertexArray(jn,Si);let ks,qo,ds,ja,fa=0,$o=0,v0=0,M3=0,o_=-1,l_=-1;const Xo={};let T3=Hn("");if(dn.allowVerticalPlacement&&Ci.vertical){const Br=er.layout.get("text-rotate").evaluate(Zn,{},ur)+90;ds=new rg(_r,jn,Cr,Zr,Yr,Ci.vertical,or,lr,zr,Br),Xr&&(ja=new rg(_r,jn,Cr,Zr,Yr,Xr,Fr,ha,zr,Br))}if(sr){const Br=er.layout.get("icon-rotate").evaluate(Zn,{}),Wa=er.layout.get("icon-text-fit")!=="none",hu=m3(sr,Br,Pr,Wa),Ls=Xr?m3(Xr,Br,Pr,Wa):void 0;qo=new rg(_r,jn,Cr,Zr,Yr,sr,Fr,ha,!1,Br),fa=4*hu.length;const du=dn.iconSizeData;let oo=null;du.kind==="source"?(oo=[so*er.layout.get("icon-size").evaluate(Zn,{})],oo[0]>Zl&&Ae(`${dn.layerIds[0]}: Value for "icon-size" is >= ${p0}. Reduce your "icon-size".`)):du.kind==="composite"&&(oo=[so*Nr.compositeIconSizes[0].evaluate(Zn,{},ur),so*Nr.compositeIconSizes[1].evaluate(Zn,{},ur)],(oo[0]>Zl||oo[1]>Zl)&&Ae(`${dn.layerIds[0]}: Value for "icon-size" is >= ${p0}. Reduce your "icon-size".`)),dn.addSymbols(dn.icon,hu,oo,cr,da,Zn,h.ah.none,jn,Is.lineStartIndex,Is.lineLength,-1,ur),o_=dn.icon.placedSymbolArray.length-1,Ls&&($o=4*Ls.length,dn.addSymbols(dn.icon,Ls,oo,cr,da,Zn,h.ah.vertical,jn,Is.lineStartIndex,Is.lineLength,-1,ur),l_=dn.icon.placedSymbolArray.length-1)}const E3=Object.keys(Ci.horizontal);for(const Br of E3){const Wa=Ci.horizontal[Br];if(!ks){T3=Hn(Wa.text);const Ls=er.layout.get("text-rotate").evaluate(Zn,{},ur);ks=new rg(_r,jn,Cr,Zr,Yr,Wa,or,lr,zr,Ls)}const hu=Wa.positionedLines.length===1;if(v0+=_3(dn,jn,Wa,Aa,er,zr,Zn,Kr,Is,Ci.vertical?h.ah.horizontal:h.ah.horizontalOnly,hu?E3:[Br],Xo,o_,Nr,ur),hu)break}Ci.vertical&&(M3+=_3(dn,jn,Ci.vertical,Aa,er,zr,Zn,Kr,Is,h.ah.vertical,["vertical"],Xo,l_,Nr,ur));const RP=ks?ks.boxStartIndex:dn.collisionBoxArray.length,IP=ks?ks.boxEndIndex:dn.collisionBoxArray.length,kP=ds?ds.boxStartIndex:dn.collisionBoxArray.length,DP=ds?ds.boxEndIndex:dn.collisionBoxArray.length,LP=qo?qo.boxStartIndex:dn.collisionBoxArray.length,zP=qo?qo.boxEndIndex:dn.collisionBoxArray.length,FP=ja?ja.boxStartIndex:dn.collisionBoxArray.length,NP=ja?ja.boxEndIndex:dn.collisionBoxArray.length;let Ds=-1;const sg=(Br,Wa)=>Br&&Br.circleDiameter?Math.max(Br.circleDiameter,Wa):Wa;Ds=sg(ks,Ds),Ds=sg(ds,Ds),Ds=sg(qo,Ds),Ds=sg(ja,Ds);const A3=Ds>-1?1:0;A3&&(Ds*=hs/ar),dn.glyphOffsetArray.length>=Lh.MAX_GLYPHS&&Ae("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Zn.sortKey!==void 0&&dn.addToSortKeyRanges(dn.symbolInstances.length,Zn.sortKey);const BP=v3(er,Zn,ur),[OP,UP]=function(Br,Wa){const hu=Br.length,Ls=Wa==null?void 0:Wa.values;if((Ls==null?void 0:Ls.length)>0)for(let du=0;du<Ls.length;du+=2){const oo=Ls[du+1];Br.emplaceBack(h.ap[Ls[du]],oo[0],oo[1])}return[hu,Br.length]}(dn.textAnchorOffsets,BP);dn.symbolInstances.emplaceBack(jn.x,jn.y,Xo.right>=0?Xo.right:-1,Xo.center>=0?Xo.center:-1,Xo.left>=0?Xo.left:-1,Xo.vertical||-1,o_,l_,T3,RP,IP,kP,DP,LP,zP,FP,NP,Cr,v0,M3,fa,$o,A3,0,or,Ds,OP,UP)}(c,vn,Tt,u,f,y,sn,c.layers[0],c.collisionBoxArray,a.index,a.sourceLayerIndex,c.index,be,[Ne,Ne,Ne,Ne],Wt,I,Ve,ht,un,ae,a,w,z,j,T)};if(Gt==="line")for(const Tt of c3(a.geometry,0,0,qn,qn)){const vn=wP(Tt,ke,yt,u.vertical||oe,f,24,Pe,c.overscaling,qn);for(const dn of vn)oe&&CP(c,oe.text,Vt,dn)||Ot(Tt,dn)}else if(Gt==="line-center"){for(const Tt of a.geometry)if(Tt.length>1){const vn=bP(Tt,yt,u.vertical||oe,f,24,Pe);vn&&Ot(Tt,vn)}}else if(a.type==="Polygon")for(const Tt of Iv(a.geometry,0)){const vn=TP(Tt,16);Ot(Tt[0],new Kl(vn.x,vn.y,0))}else if(a.type==="LineString")for(const Tt of a.geometry)Ot(Tt,new Kl(Tt[0].x,Tt[0].y,0));else if(a.type==="Point")for(const Tt of a.geometry)for(const vn of Tt)Ot([vn],new Kl(vn.x,vn.y,0))}function _3(c,a,u,f,y,w,T,E,I,z,j,W,K,ae,oe){const pe=function(Ve,ke,Ne,ht,yt,Wt,un,Gt){const Vt=ht.layout.get("text-rotate").evaluate(Wt,{})*Math.PI/180,Rt=[];for(const sn of ke.positionedLines)for(const Ot of sn.positionedGlyphs){if(!Ot.rect)continue;const Tt=Ot.rect||{};let vn=F4+1,dn=!0,jn=1,Si=0;const Ci=(yt||Gt)&&Ot.vertical,sr=Ot.metrics.advance*Ot.scale/2;if(Gt&&ke.verticalizable&&(Si=sn.lineOffset/2-(Ot.imageName?-(ar-Ot.metrics.width*Ot.scale)/2:(Ot.scale-1)*ar)),Ot.imageName){const cr=un[Ot.imageName];dn=cr.sdf,jn=cr.pixelRatio,vn=ua/jn}const Aa=yt?[Ot.x+sr,Ot.y]:[0,0];let Xr=yt?[0,0]:[Ot.x+sr+Ne[0],Ot.y+Ne[1]-Si],er=[0,0];Ci&&(er=Xr,Xr=[0,0]);const _r=Ot.metrics.isDoubleResolution?2:1,Cr=(Ot.metrics.left-vn)*Ot.scale-sr+Xr[0],Zr=(-Ot.metrics.top-vn)*Ot.scale+Xr[1],Yr=Cr+Tt.w/_r*Ot.scale/jn,or=Zr+Tt.h/_r*Ot.scale/jn,lr=new M(Cr,Zr),zr=new M(Yr,Zr),Kr=new M(Cr,or),Fr=new M(Yr,or);if(Ci){const cr=new M(-sr,sr-d0),Zn=-Math.PI/2,Nr=ar/2-sr,Pr=new M(5-d0-Nr,-(Ot.imageName?Nr:0)),ur=new M(...er);lr._rotateAround(Zn,cr)._add(Pr)._add(ur),zr._rotateAround(Zn,cr)._add(Pr)._add(ur),Kr._rotateAround(Zn,cr)._add(Pr)._add(ur),Fr._rotateAround(Zn,cr)._add(Pr)._add(ur)}if(Vt){const cr=Math.sin(Vt),Zn=Math.cos(Vt),Nr=[Zn,-cr,cr,Zn];lr._matMult(Nr),zr._matMult(Nr),Kr._matMult(Nr),Fr._matMult(Nr)}const ha=new M(0,0),da=new M(0,0);Rt.push({tl:lr,tr:zr,bl:Kr,br:Fr,tex:Tt,writingMode:ke.writingMode,glyphOffset:Aa,sectionIndex:Ot.sectionIndex,isSDF:dn,pixelOffsetTL:ha,pixelOffsetBR:da,minFontScaleX:0,minFontScaleY:0})}return Rt}(0,u,E,y,w,T,f,c.allowVerticalPlacement),be=c.textSizeData;let Pe=null;be.kind==="source"?(Pe=[so*y.layout.get("text-size").evaluate(T,{})],Pe[0]>Zl&&Ae(`${c.layerIds[0]}: Value for "text-size" is >= ${p0}. Reduce your "text-size".`)):be.kind==="composite"&&(Pe=[so*ae.compositeTextSizes[0].evaluate(T,{},oe),so*ae.compositeTextSizes[1].evaluate(T,{},oe)],(Pe[0]>Zl||Pe[1]>Zl)&&Ae(`${c.layerIds[0]}: Value for "text-size" is >= ${p0}. Reduce your "text-size".`)),c.addSymbols(c.text,pe,Pe,E,w,T,z,a,I.lineStartIndex,I.lineLength,K,oe);for(const Ve of j)W[Ve]=c.text.placedSymbolArray.length-1;return 4*pe.length}function x3(c){for(const a in c)return c[a];return null}function CP(c,a,u,f){const y=c.compareText;if(a in y){const w=y[a];for(let T=w.length-1;T>=0;T--)if(f.dist(w[T])<u)return!0}else y[a]=[];return y[a].push(f),!1}const b3=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class e_{static from(a){if(!(a instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[u,f]=new Uint8Array(a,0,2);if(u!==219)throw new Error("Data does not appear to be in a KDBush format.");const y=f>>4;if(y!==1)throw new Error(`Got v${y} data when expected v1.`);const w=b3[15&f];if(!w)throw new Error("Unrecognized array type.");const[T]=new Uint16Array(a,2,1),[E]=new Uint32Array(a,4,1);return new e_(E,T,w,a)}constructor(a,u=64,f=Float64Array,y){if(isNaN(a)||a<0)throw new Error(`Unpexpected numItems value: ${a}.`);this.numItems=+a,this.nodeSize=Math.min(Math.max(+u,2),65535),this.ArrayType=f,this.IndexArrayType=a<65536?Uint16Array:Uint32Array;const w=b3.indexOf(this.ArrayType),T=2*a*this.ArrayType.BYTES_PER_ELEMENT,E=a*this.IndexArrayType.BYTES_PER_ELEMENT,I=(8-E%8)%8;if(w<0)throw new Error(`Unexpected typed array class: ${f}.`);y&&y instanceof ArrayBuffer?(this.data=y,this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+I,2*a),this._pos=2*a,this._finished=!0):(this.data=new ArrayBuffer(8+T+E+I),this.ids=new this.IndexArrayType(this.data,8,a),this.coords=new this.ArrayType(this.data,8+E+I,2*a),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+w]),new Uint16Array(this.data,2,1)[0]=u,new Uint32Array(this.data,4,1)[0]=a)}add(a,u){const f=this._pos>>1;return this.ids[f]=f,this.coords[this._pos++]=a,this.coords[this._pos++]=u,f}finish(){const a=this._pos>>1;if(a!==this.numItems)throw new Error(`Added ${a} items when expected ${this.numItems}.`);return t_(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(a,u,f,y){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:w,coords:T,nodeSize:E}=this,I=[0,w.length-1,0],z=[];for(;I.length;){const j=I.pop()||0,W=I.pop()||0,K=I.pop()||0;if(W-K<=E){for(let be=K;be<=W;be++){const Pe=T[2*be],Ve=T[2*be+1];Pe>=a&&Pe<=f&&Ve>=u&&Ve<=y&&z.push(w[be])}continue}const ae=K+W>>1,oe=T[2*ae],pe=T[2*ae+1];oe>=a&&oe<=f&&pe>=u&&pe<=y&&z.push(w[ae]),(j===0?a<=oe:u<=pe)&&(I.push(K),I.push(ae-1),I.push(1-j)),(j===0?f>=oe:y>=pe)&&(I.push(ae+1),I.push(W),I.push(1-j))}return z}within(a,u,f){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:w,nodeSize:T}=this,E=[0,y.length-1,0],I=[],z=f*f;for(;E.length;){const j=E.pop()||0,W=E.pop()||0,K=E.pop()||0;if(W-K<=T){for(let be=K;be<=W;be++)S3(w[2*be],w[2*be+1],a,u)<=z&&I.push(y[be]);continue}const ae=K+W>>1,oe=w[2*ae],pe=w[2*ae+1];S3(oe,pe,a,u)<=z&&I.push(y[ae]),(j===0?a-f<=oe:u-f<=pe)&&(E.push(K),E.push(ae-1),E.push(1-j)),(j===0?a+f>=oe:u+f>=pe)&&(E.push(ae+1),E.push(W),E.push(1-j))}return I}}function t_(c,a,u,f,y,w){if(y-f<=u)return;const T=f+y>>1;w3(c,a,T,f,y,w),t_(c,a,u,f,T-1,1-w),t_(c,a,u,T+1,y,1-w)}function w3(c,a,u,f,y,w){for(;y>f;){if(y-f>600){const z=y-f+1,j=u-f+1,W=Math.log(z),K=.5*Math.exp(2*W/3),ae=.5*Math.sqrt(W*K*(z-K)/z)*(j-z/2<0?-1:1);w3(c,a,u,Math.max(f,Math.floor(u-j*K/z+ae)),Math.min(y,Math.floor(u+(z-j)*K/z+ae)),w)}const T=a[2*u+w];let E=f,I=y;for(g0(c,a,f,u),a[2*y+w]>T&&g0(c,a,f,y);E<I;){for(g0(c,a,E,I),E++,I--;a[2*E+w]<T;)E++;for(;a[2*I+w]>T;)I--}a[2*f+w]===T?g0(c,a,f,I):(I++,g0(c,a,I,y)),I<=u&&(f=I+1),u<=I&&(y=I-1)}}function g0(c,a,u,f){n_(c,u,f),n_(a,2*u,2*f),n_(a,2*u+1,2*f+1)}function n_(c,a,u){const f=c[a];c[a]=c[u],c[u]=f}function S3(c,a,u,f){const y=c-u,w=a-f;return y*y+w*w}var i_;h.bd=void 0,(i_=h.bd||(h.bd={})).create="create",i_.load="load",i_.fullLoad="fullLoad";let ag=null,y0=[];const r_=1e3/60,a_="loadTime",s_="fullLoadTime",PP={mark(c){performance.mark(c)},frame(c){const a=c;ag!=null&&y0.push(a-ag),ag=a},clearMetrics(){ag=null,y0=[],performance.clearMeasures(a_),performance.clearMeasures(s_);for(const c in h.bd)performance.clearMarks(h.bd[c])},getPerformanceMetrics(){performance.measure(a_,h.bd.create,h.bd.load),performance.measure(s_,h.bd.create,h.bd.fullLoad);const c=performance.getEntriesByName(a_)[0].duration,a=performance.getEntriesByName(s_)[0].duration,u=y0.length,f=1/(y0.reduce((w,T)=>w+T,0)/u/1e3),y=y0.filter(w=>w>r_).reduce((w,T)=>w+(T-r_)/r_,0);return{loadTime:c,fullLoadTime:a,fps:f,percentDroppedFrames:y/(u+y)*100,totalFrames:u}}};h.$=xt,h.A=Ch,h.B=function(c){if(ct==null){const a=c.navigator?c.navigator.userAgent:null;ct=!!c.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return ct},h.C=class{constructor(c,a){this.target=c,this.mapId=a,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new _P(()=>this.process()),this.subscription=function(u,f,y,w){return u.addEventListener(f,y,!1),{unsubscribe:()=>{u.removeEventListener(f,y,!1)}}}(this.target,"message",u=>this.receive(u)),this.globalScope=ft(self)?c:window}registerMessageHandler(c,a){this.messageHandlers[c]=a}sendAsync(c,a){return new Promise((u,f)=>{const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[y]={resolve:u,reject:f},a&&a.signal.addEventListener("abort",()=>{delete this.resolveRejects[y];const E={id:y,type:"<cancel>",origin:location.origin,targetMapId:c.targetMapId,sourceMapId:this.mapId};this.target.postMessage(E)},{once:!0});const w=[],T=Object.assign(Object.assign({},c),{id:y,sourceMapId:this.mapId,origin:location.origin,data:Fo(c.data,w)});this.target.postMessage(T,{transfer:w})})}receive(c){const a=c.data,u=a.id;if(!(a.origin!=="file://"&&location.origin!=="file://"&&a.origin!==location.origin||a.targetMapId&&this.mapId!==a.targetMapId)){if(a.type==="<cancel>"){delete this.tasks[u];const f=this.abortControllers[u];return delete this.abortControllers[u],void(f&&f.abort())}if(ft(self)||a.mustQueue)return this.tasks[u]=a,this.taskQueue.push(u),void this.invoker.trigger();this.processTask(u,a)}}process(){if(this.taskQueue.length===0)return;const c=this.taskQueue.shift(),a=this.tasks[c];delete this.tasks[c],this.taskQueue.length>0&&this.invoker.trigger(),a&&this.processTask(c,a)}processTask(c,a){return o(this,void 0,void 0,function*(){if(a.type==="<response>"){const y=this.resolveRejects[c];return delete this.resolveRejects[c],y?void(a.error?y.reject(Hl(a.error)):y.resolve(Hl(a.data))):void 0}if(!this.messageHandlers[a.type])return void this.completeTask(c,new Error(`Could not find a registered handler for ${a.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const u=Hl(a.data),f=new AbortController;this.abortControllers[c]=f;try{const y=yield this.messageHandlers[a.type](a.sourceMapId,u,f);this.completeTask(c,null,y)}catch(y){this.completeTask(c,y)}})}completeTask(c,a,u){const f=[];delete this.abortControllers[c];const y={id:c,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:a?Fo(a):null,data:Fo(u,f)};this.target.postMessage(y,{transfer:f})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},h.D=pn,h.E=Gn,h.F=function(){var c=new Ch(16);return Ch!=Float32Array&&(c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=0,c[12]=0,c[13]=0,c[14]=0),c[0]=1,c[5]=1,c[10]=1,c[15]=1,c},h.G=At,h.H=function(c,a,u){var f,y,w,T,E,I,z,j,W,K,ae,oe,pe=u[0],be=u[1],Pe=u[2];return a===c?(c[12]=a[0]*pe+a[4]*be+a[8]*Pe+a[12],c[13]=a[1]*pe+a[5]*be+a[9]*Pe+a[13],c[14]=a[2]*pe+a[6]*be+a[10]*Pe+a[14],c[15]=a[3]*pe+a[7]*be+a[11]*Pe+a[15]):(y=a[1],w=a[2],T=a[3],E=a[4],I=a[5],z=a[6],j=a[7],W=a[8],K=a[9],ae=a[10],oe=a[11],c[0]=f=a[0],c[1]=y,c[2]=w,c[3]=T,c[4]=E,c[5]=I,c[6]=z,c[7]=j,c[8]=W,c[9]=K,c[10]=ae,c[11]=oe,c[12]=f*pe+E*be+W*Pe+a[12],c[13]=y*pe+I*be+K*Pe+a[13],c[14]=w*pe+z*be+ae*Pe+a[14],c[15]=T*pe+j*be+oe*Pe+a[15]),c},h.I=Vv,h.J=function(c,a,u){var f=u[0],y=u[1],w=u[2];return c[0]=a[0]*f,c[1]=a[1]*f,c[2]=a[2]*f,c[3]=a[3]*f,c[4]=a[4]*y,c[5]=a[5]*y,c[6]=a[6]*y,c[7]=a[7]*y,c[8]=a[8]*w,c[9]=a[9]*w,c[10]=a[10]*w,c[11]=a[11]*w,c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},h.K=i4,h.L=function(c,a){const u={};for(let f=0;f<a.length;f++){const y=a[f];y in c&&(u[y]=c[y])}return u},h.M=Yl,h.N=J4,h.O=Q4,h.P=M,h.Q=Ga,h.R=Ha,h.S=C,h.T=Uf,h.U=V,h.V=tt,h.W=qn,h.X=Wi,h.Y=eg,h.Z=class extends ro{},h._=o,h.a=wt,h.a$=function(c,a,u){return c[0]=a[0]*u[0],c[1]=a[1]*u[1],c[2]=a[2]*u[2],c[3]=a[3]*u[3],c},h.a0=Kv,h.a1=at,h.a2=c=>{const a=window.document.createElement("video");return a.muted=!0,new Promise(u=>{a.onloadstart=()=>{u(a)};for(const f of c){const y=window.document.createElement("source");je(f)||(a.crossOrigin="Anonymous"),y.src=f,a.appendChild(y)}})},h.a3=function(){return xe++},h.a4=Fm,h.a5=Lh,h.a6=ph,h.a7=Go,h.a8=bi,h.a9=a3,h.aA=Me,h.aB=function(c,a){if(!c)return[{command:"setStyle",args:[a]}];let u=[];try{if(!rt(c.version,a.version))return[{command:"setStyle",args:[a]}];rt(c.center,a.center)||u.push({command:"setCenter",args:[a.center]}),rt(c.zoom,a.zoom)||u.push({command:"setZoom",args:[a.zoom]}),rt(c.bearing,a.bearing)||u.push({command:"setBearing",args:[a.bearing]}),rt(c.pitch,a.pitch)||u.push({command:"setPitch",args:[a.pitch]}),rt(c.sprite,a.sprite)||u.push({command:"setSprite",args:[a.sprite]}),rt(c.glyphs,a.glyphs)||u.push({command:"setGlyphs",args:[a.glyphs]}),rt(c.transition,a.transition)||u.push({command:"setTransition",args:[a.transition]}),rt(c.light,a.light)||u.push({command:"setLight",args:[a.light]}),rt(c.terrain,a.terrain)||u.push({command:"setTerrain",args:[a.terrain]}),rt(c.sky,a.sky)||u.push({command:"setSky",args:[a.sky]});const f={},y=[];(function(T,E,I,z){let j;for(j in E=E||{},T=T||{})Object.prototype.hasOwnProperty.call(T,j)&&(Object.prototype.hasOwnProperty.call(E,j)||_n(j,I,z));for(j in E)Object.prototype.hasOwnProperty.call(E,j)&&(Object.prototype.hasOwnProperty.call(T,j)?rt(T[j],E[j])||(T[j].type==="geojson"&&E[j].type==="geojson"&&hn(T,E,j)?mt(I,{command:"setGeoJSONSourceData",args:[j,E[j].data]}):Mt(j,E,I,z)):St(j,E,I))})(c.sources,a.sources,y,f);const w=[];c.layers&&c.layers.forEach(T=>{"source"in T&&f[T.source]?u.push({command:"removeLayer",args:[T.id]}):w.push(T)}),u=u.concat(y),function(T,E,I){E=E||[];const z=(T=T||[]).map(Nt),j=E.map(Nt),W=T.reduce(an,{}),K=E.reduce(an,{}),ae=z.slice(),oe=Object.create(null);let pe,be,Pe,Ve,ke;for(let Ne=0,ht=0;Ne<z.length;Ne++)pe=z[Ne],Object.prototype.hasOwnProperty.call(K,pe)?ht++:(mt(I,{command:"removeLayer",args:[pe]}),ae.splice(ae.indexOf(pe,ht),1));for(let Ne=0,ht=0;Ne<j.length;Ne++)pe=j[j.length-1-Ne],ae[ae.length-1-Ne]!==pe&&(Object.prototype.hasOwnProperty.call(W,pe)?(mt(I,{command:"removeLayer",args:[pe]}),ae.splice(ae.lastIndexOf(pe,ae.length-ht),1)):ht++,Ve=ae[ae.length-Ne],mt(I,{command:"addLayer",args:[K[pe],Ve]}),ae.splice(ae.length-Ne,0,pe),oe[pe]=!0);for(let Ne=0;Ne<j.length;Ne++)if(pe=j[Ne],be=W[pe],Pe=K[pe],!oe[pe]&&!rt(be,Pe))if(rt(be.source,Pe.source)&&rt(be["source-layer"],Pe["source-layer"])&&rt(be.type,Pe.type)){for(ke in xn(be.layout,Pe.layout,I,pe,null,"setLayoutProperty"),xn(be.paint,Pe.paint,I,pe,null,"setPaintProperty"),rt(be.filter,Pe.filter)||mt(I,{command:"setFilter",args:[pe,Pe.filter]}),rt(be.minzoom,Pe.minzoom)&&rt(be.maxzoom,Pe.maxzoom)||mt(I,{command:"setLayerZoomRange",args:[pe,Pe.minzoom,Pe.maxzoom]}),be)Object.prototype.hasOwnProperty.call(be,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?xn(be[ke],Pe[ke],I,pe,ke.slice(6),"setPaintProperty"):rt(be[ke],Pe[ke])||mt(I,{command:"setLayerProperty",args:[pe,ke,Pe[ke]]}));for(ke in Pe)Object.prototype.hasOwnProperty.call(Pe,ke)&&!Object.prototype.hasOwnProperty.call(be,ke)&&ke!=="layout"&&ke!=="paint"&&ke!=="filter"&&ke!=="metadata"&&ke!=="minzoom"&&ke!=="maxzoom"&&(ke.indexOf("paint.")===0?xn(be[ke],Pe[ke],I,pe,ke.slice(6),"setPaintProperty"):rt(be[ke],Pe[ke])||mt(I,{command:"setLayerProperty",args:[pe,ke,Pe[ke]]}))}else mt(I,{command:"removeLayer",args:[pe]}),Ve=ae[ae.lastIndexOf(pe)+1],mt(I,{command:"addLayer",args:[Pe,Ve]})}(w,a.layers,u)}catch(f){console.warn("Unable to compute style diff:",f),u=[{command:"setStyle",args:[a]}]}return u},h.aC=function(c){const a=[],u=c.id;return u===void 0&&a.push({message:`layers.${u}: missing required property "id"`}),c.render===void 0&&a.push({message:`layers.${u}: missing required method "render"`}),c.renderingMode&&c.renderingMode!=="2d"&&c.renderingMode!=="3d"&&a.push({message:`layers.${u}: property "renderingMode" must be either "2d" or "3d"`}),a},h.aD=function c(a,u){if(Array.isArray(a)){if(!Array.isArray(u)||a.length!==u.length)return!1;for(let f=0;f<a.length;f++)if(!c(a[f],u[f]))return!1;return!0}if(typeof a=="object"&&a!==null&&u!==null){if(typeof u!="object"||Object.keys(a).length!==Object.keys(u).length)return!1;for(const f in a)if(!c(a[f],u[f]))return!1;return!0}return a===u},h.aE=re,h.aF=ee,h.aG=class extends vi{constructor(c,a){super(c,a),this.current=0}set(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))}},h.aH=Er,h.aI=class extends vi{constructor(c,a){super(c,a),this.current=Uo}set(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(let a=1;a<16;a++)if(c[a]!==this.current[a]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}}},h.aJ=Ua,h.aK=class extends vi{constructor(c,a){super(c,a),this.current=[0,0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))}},h.aL=class extends vi{constructor(c,a){super(c,a),this.current=[0,0]}set(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))}},h.aM=cs,h.aN=function(c,a,u,f,y,w,T){var E=1/(a-u),I=1/(f-y),z=1/(w-T);return c[0]=-2*E,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=-2*I,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=2*z,c[11]=0,c[12]=(a+u)*E,c[13]=(y+f)*I,c[14]=(T+w)*z,c[15]=1,c},h.aO=Xt,h.aP=Q7,h.aQ=class extends ou{},h.aR=$C,h.aS=class extends jl{},h.aT=function(c){return c<=1?1:Math.pow(2,Math.ceil(Math.log(c)/Math.LN2))},h.aU=l4,h.aV=$,h.aW=class extends Yf{},h.aX=Qe,h.aY=function(c,a){return c[0]===a[0]&&c[1]===a[1]&&c[2]===a[2]&&c[3]===a[3]&&c[4]===a[4]&&c[5]===a[5]&&c[6]===a[6]&&c[7]===a[7]&&c[8]===a[8]&&c[9]===a[9]&&c[10]===a[10]&&c[11]===a[11]&&c[12]===a[12]&&c[13]===a[13]&&c[14]===a[14]&&c[15]===a[15]},h.aZ=function(c,a){var u=c[0],f=c[1],y=c[2],w=c[3],T=c[4],E=c[5],I=c[6],z=c[7],j=c[8],W=c[9],K=c[10],ae=c[11],oe=c[12],pe=c[13],be=c[14],Pe=c[15],Ve=a[0],ke=a[1],Ne=a[2],ht=a[3],yt=a[4],Wt=a[5],un=a[6],Gt=a[7],Vt=a[8],Rt=a[9],sn=a[10],Ot=a[11],Tt=a[12],vn=a[13],dn=a[14],jn=a[15];return Math.abs(u-Ve)<=$r*Math.max(1,Math.abs(u),Math.abs(Ve))&&Math.abs(f-ke)<=$r*Math.max(1,Math.abs(f),Math.abs(ke))&&Math.abs(y-Ne)<=$r*Math.max(1,Math.abs(y),Math.abs(Ne))&&Math.abs(w-ht)<=$r*Math.max(1,Math.abs(w),Math.abs(ht))&&Math.abs(T-yt)<=$r*Math.max(1,Math.abs(T),Math.abs(yt))&&Math.abs(E-Wt)<=$r*Math.max(1,Math.abs(E),Math.abs(Wt))&&Math.abs(I-un)<=$r*Math.max(1,Math.abs(I),Math.abs(un))&&Math.abs(z-Gt)<=$r*Math.max(1,Math.abs(z),Math.abs(Gt))&&Math.abs(j-Vt)<=$r*Math.max(1,Math.abs(j),Math.abs(Vt))&&Math.abs(W-Rt)<=$r*Math.max(1,Math.abs(W),Math.abs(Rt))&&Math.abs(K-sn)<=$r*Math.max(1,Math.abs(K),Math.abs(sn))&&Math.abs(ae-Ot)<=$r*Math.max(1,Math.abs(ae),Math.abs(Ot))&&Math.abs(oe-Tt)<=$r*Math.max(1,Math.abs(oe),Math.abs(Tt))&&Math.abs(pe-vn)<=$r*Math.max(1,Math.abs(pe),Math.abs(vn))&&Math.abs(be-dn)<=$r*Math.max(1,Math.abs(be),Math.abs(dn))&&Math.abs(Pe-jn)<=$r*Math.max(1,Math.abs(Pe),Math.abs(jn))},h.a_=function(c,a){return c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[4]=a[4],c[5]=a[5],c[6]=a[6],c[7]=a[7],c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15],c},h.aa=function(c){const a={};if(c.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(u,f,y,w)=>{const T=y||w;return a[f]=!T||T.toLowerCase(),""}),a["max-age"]){const u=parseInt(a["max-age"],10);isNaN(u)?delete a["max-age"]:a["max-age"]=u}return a},h.ab=function(c,a){const u=[];for(const f in c)f in a||u.push(f);return u},h.ac=ue,h.ad=function(c,a,u){var f=Math.sin(u),y=Math.cos(u),w=a[0],T=a[1],E=a[2],I=a[3],z=a[4],j=a[5],W=a[6],K=a[7];return a!==c&&(c[8]=a[8],c[9]=a[9],c[10]=a[10],c[11]=a[11],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[0]=w*y+z*f,c[1]=T*y+j*f,c[2]=E*y+W*f,c[3]=I*y+K*f,c[4]=z*y-w*f,c[5]=j*y-T*f,c[6]=W*y-E*f,c[7]=K*y-I*f,c},h.ae=function(c){var a=new Ch(16);return a[0]=c[0],a[1]=c[1],a[2]=c[2],a[3]=c[3],a[4]=c[4],a[5]=c[5],a[6]=c[6],a[7]=c[7],a[8]=c[8],a[9]=c[9],a[10]=c[10],a[11]=c[11],a[12]=c[12],a[13]=c[13],a[14]=c[14],a[15]=c[15],a},h.af=Gm,h.ag=function(c,a){let u=0,f=0;if(c.kind==="constant")f=c.layoutSize;else if(c.kind!=="source"){const{interpolationType:y,minZoom:w,maxZoom:T}=c,E=y?ue(Lr.interpolationFactor(y,a,w,T),0,1):0;c.kind==="camera"?f=oa.number(c.minSize,c.maxSize,E):u=E}return{uSizeT:u,uSize:f}},h.ai=function(c,{uSize:a,uSizeT:u},{lowerSize:f,upperSize:y}){return c.kind==="source"?f/so:c.kind==="composite"?oa.number(f/so,y/so,u):a},h.aj=Wv,h.ak=function(c,a,u,f){const y=a.y-c.y,w=a.x-c.x,T=f.y-u.y,E=f.x-u.x,I=T*w-E*y;if(I===0)return null;const z=(E*(c.y-u.y)-T*(c.x-u.x))/I;return new M(c.x+z*w,c.y+z*y)},h.al=c3,h.am=jo,h.an=Mv,h.ao=ar,h.aq=jv,h.ar=function(c,a){var u=a[0],f=a[1],y=a[2],w=a[3],T=a[4],E=a[5],I=a[6],z=a[7],j=a[8],W=a[9],K=a[10],ae=a[11],oe=a[12],pe=a[13],be=a[14],Pe=a[15],Ve=u*E-f*T,ke=u*I-y*T,Ne=u*z-w*T,ht=f*I-y*E,yt=f*z-w*E,Wt=y*z-w*I,un=j*pe-W*oe,Gt=j*be-K*oe,Vt=j*Pe-ae*oe,Rt=W*be-K*pe,sn=W*Pe-ae*pe,Ot=K*Pe-ae*be,Tt=Ve*Ot-ke*sn+Ne*Rt+ht*Vt-yt*Gt+Wt*un;return Tt?(c[0]=(E*Ot-I*sn+z*Rt)*(Tt=1/Tt),c[1]=(y*sn-f*Ot-w*Rt)*Tt,c[2]=(pe*Wt-be*yt+Pe*ht)*Tt,c[3]=(K*yt-W*Wt-ae*ht)*Tt,c[4]=(I*Vt-T*Ot-z*Gt)*Tt,c[5]=(u*Ot-y*Vt+w*Gt)*Tt,c[6]=(be*Ne-oe*Wt-Pe*ke)*Tt,c[7]=(j*Wt-K*Ne+ae*ke)*Tt,c[8]=(T*sn-E*Vt+z*un)*Tt,c[9]=(f*Vt-u*sn-w*un)*Tt,c[10]=(oe*yt-pe*Ne+Pe*Ve)*Tt,c[11]=(W*Ne-j*yt-ae*Ve)*Tt,c[12]=(E*Gt-T*Rt-I*un)*Tt,c[13]=(u*Rt-f*Gt+y*un)*Tt,c[14]=(pe*ke-oe*ht-be*Ve)*Tt,c[15]=(j*ht-W*ke+K*Ve)*Tt,c):null},h.as=Qv,h.at=Gv,h.au=e_,h.av=function(){const c={},a=ie.$version;for(const u in ie.$root){const f=ie.$root[u];if(f.required){let y=null;y=u==="version"?a:f.type==="array"?[]:{},y!=null&&(c[u]=y)}}return c},h.aw=Ff,h.ax=En,h.ay=function(c){c=c.slice();const a=Object.create(null);for(let u=0;u<c.length;u++)a[c[u].id]=c[u];for(let u=0;u<c.length;u++)"ref"in c[u]&&(c[u]=st(c[u],a[c[u].ref]));return c},h.az=function(c){if(c.type==="custom")return new vP(c);switch(c.type){case"background":return new mP(c);case"circle":return new eC(c);case"fill":return new xC(c);case"fill-extrusion":return new zC(c);case"heatmap":return new nC(c);case"hillshade":return new rC(c);case"line":return new GC(c);case"raster":return new yP(c);case"symbol":return new Qm(c)}},h.b=De,h.b0=function(c,a){return c[0]*a[0]+c[1]*a[1]+c[2]*a[2]+c[3]*a[3]},h.b1=Y,h.b2=n3,h.b3=e3,h.b4=function(c,a,u,f,y){var w,T=1/Math.tan(a/2);return c[0]=T/u,c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=T,c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[11]=-1,c[12]=0,c[13]=0,c[15]=0,y!=null&&y!==1/0?(c[10]=(y+f)*(w=1/(f-y)),c[14]=2*y*f*w):(c[10]=-1,c[14]=-2*f),c},h.b5=function(c,a,u){var f=Math.sin(u),y=Math.cos(u),w=a[4],T=a[5],E=a[6],I=a[7],z=a[8],j=a[9],W=a[10],K=a[11];return a!==c&&(c[0]=a[0],c[1]=a[1],c[2]=a[2],c[3]=a[3],c[12]=a[12],c[13]=a[13],c[14]=a[14],c[15]=a[15]),c[4]=w*y+z*f,c[5]=T*y+j*f,c[6]=E*y+W*f,c[7]=I*y+K*f,c[8]=z*y-w*f,c[9]=j*y-T*f,c[10]=W*y-E*f,c[11]=K*y-I*f,c},h.b6=O,h.b7=J,h.b8=function(c){return c*Math.PI/180},h.b9=function(c,a){return c[0]=a[0],c[1]=0,c[2]=0,c[3]=0,c[4]=0,c[5]=a[1],c[6]=0,c[7]=0,c[8]=0,c[9]=0,c[10]=a[2],c[11]=0,c[12]=0,c[13]=0,c[14]=0,c[15]=1,c},h.bA=No,h.ba=class extends bh{},h.bb=Zv,h.bc=PP,h.be=gn,h.bf=function(c,a){wt.REGISTERED_PROTOCOLS[c]=a},h.bg=function(c){delete wt.REGISTERED_PROTOCOLS[c]},h.bh=function(c,a){const u={};for(let y=0;y<c.length;y++){const w=a&&a[c[y].id]||bv(c[y]);a&&(a[c[y].id]=w);let T=u[w];T||(T=u[w]=[]),T.push(c[y])}const f=[];for(const y in u)f.push(u[y]);return f},h.bi=en,h.bj=r3,h.bk=s3,h.bl=B4,h.bm=function(c){c.bucket.createArrays(),c.bucket.tilePixelRatio=qn/(512*c.bucket.overscaling),c.bucket.compareText={},c.bucket.iconsNeedLinear=!1;const a=c.bucket.layers[0],u=a.layout,f=a._unevaluatedLayout._values,y={layoutIconSize:f["icon-size"].possiblyEvaluate(new bi(c.bucket.zoom+1),c.canonical),layoutTextSize:f["text-size"].possiblyEvaluate(new bi(c.bucket.zoom+1),c.canonical),textMaxSize:f["text-size"].possiblyEvaluate(new bi(18))};if(c.bucket.textSizeData.kind==="composite"){const{minZoom:z,maxZoom:j}=c.bucket.textSizeData;y.compositeTextSizes=[f["text-size"].possiblyEvaluate(new bi(z),c.canonical),f["text-size"].possiblyEvaluate(new bi(j),c.canonical)]}if(c.bucket.iconSizeData.kind==="composite"){const{minZoom:z,maxZoom:j}=c.bucket.iconSizeData;y.compositeIconSizes=[f["icon-size"].possiblyEvaluate(new bi(z),c.canonical),f["icon-size"].possiblyEvaluate(new bi(j),c.canonical)]}const w=u.get("text-line-height")*ar,T=u.get("text-rotation-alignment")!=="viewport"&&u.get("symbol-placement")!=="point",E=u.get("text-keep-upright"),I=u.get("text-size");for(const z of c.bucket.features){const j=u.get("text-font").evaluate(z,{},c.canonical).join(","),W=I.evaluate(z,{},c.canonical),K=y.layoutTextSize.evaluate(z,{},c.canonical),ae=y.layoutIconSize.evaluate(z,{},c.canonical),oe={horizontal:{},vertical:void 0},pe=z.text;let be,Pe=[0,0];if(pe){const Ne=pe.toString(),ht=u.get("text-letter-spacing").evaluate(z,{},c.canonical)*ar,yt=yh(Ne)?ht:0,Wt=u.get("text-anchor").evaluate(z,{},c.canonical),un=v3(a,z,c.canonical);if(!un){const Ot=u.get("text-radial-offset").evaluate(z,{},c.canonical);Pe=Ot?y3(Wt,[Ot*ar,Jv]):u.get("text-offset").evaluate(z,{},c.canonical).map(Tt=>Tt*ar)}let Gt=T?"center":u.get("text-justify").evaluate(z,{},c.canonical);const Vt=u.get("symbol-placement"),Rt=Vt==="point"?u.get("text-max-width").evaluate(z,{},c.canonical)*ar:0,sn=()=>{c.bucket.allowVerticalPlacement&&nu(Ne)&&(oe.vertical=Ym(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,w,Wt,"left",yt,Pe,h.ah.vertical,!0,Vt,K,W))};if(!T&&un){const Ot=new Set;if(Gt==="auto")for(let vn=0;vn<un.values.length;vn+=2)Ot.add(Qv(un.values[vn]));else Ot.add(Gt);let Tt=!1;for(const vn of Ot)if(!oe.horizontal[vn])if(Tt)oe.horizontal[vn]=oe.horizontal[0];else{const dn=Ym(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,w,"center",vn,yt,Pe,h.ah.horizontal,!1,Vt,K,W);dn&&(oe.horizontal[vn]=dn,Tt=dn.positionedLines.length===1)}sn()}else{Gt==="auto"&&(Gt=Qv(Wt));const Ot=Ym(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,w,Wt,Gt,yt,Pe,h.ah.horizontal,!1,Vt,K,W);Ot&&(oe.horizontal[Gt]=Ot),sn(),nu(Ne)&&T&&E&&(oe.vertical=Ym(pe,c.glyphMap,c.glyphPositions,c.imagePositions,j,Rt,w,Wt,Gt,yt,Pe,h.ah.vertical,!1,Vt,K,W))}}let Ve=!1;if(z.icon&&z.icon.name){const Ne=c.imageMap[z.icon.name];Ne&&(be=uP(c.imagePositions[z.icon.name],u.get("icon-offset").evaluate(z,{},c.canonical),u.get("icon-anchor").evaluate(z,{},c.canonical)),Ve=!!Ne.sdf,c.bucket.sdfIcons===void 0?c.bucket.sdfIcons=Ve:c.bucket.sdfIcons!==Ve&&Ae("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ne.pixelRatio!==c.bucket.pixelRatio||u.get("icon-rotate").constantOr(1)!==0)&&(c.bucket.iconsNeedLinear=!0))}const ke=x3(oe.horizontal)||oe.vertical;c.bucket.iconsInText=!!ke&&ke.iconsInText,(ke||be)&&AP(c.bucket,z,oe,be,c.imageMap,y,K,ae,Pe,Ve,c.canonical)}c.showCollisionBoxes&&c.bucket.generateCollisionDebugBuffers()},h.bn=Nv,h.bo=Lv,h.bp=Fv,h.bq=$l,h.br=Ov,h.bs=class{constructor(c){this._marks={start:[c.url,"start"].join("#"),end:[c.url,"end"].join("#"),measure:c.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let c=performance.getEntriesByName(this._marks.measure);return c.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),c=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),c}},h.bt=function(c,a,u,f,y){return o(this,void 0,void 0,function*(){if(V())try{return yield tt(c,a,u,f,y)}catch{}return function(w,T,E,I,z){const j=w.width,W=w.height;_t&&Lt||(_t=new OffscreenCanvas(j,W),Lt=_t.getContext("2d",{willReadFrequently:!0})),_t.width=j,_t.height=W,Lt.drawImage(w,0,0,j,W);const K=Lt.getImageData(T,E,I,z);return Lt.clearRect(0,0,j,W),K.data}(c,a,u,f,y)})},h.bu=i3,h.bv=p,h.bw=v,h.bx=P4,h.by=pi,h.bz=function(c){return c.message===Cn},h.c=nt,h.d=c=>o(void 0,void 0,void 0,function*(){if(c.byteLength===0)return createImageBitmap(new ImageData(1,1));const a=new Blob([new Uint8Array(c)],{type:"image/png"});try{return createImageBitmap(a)}catch(u){throw new Error(`Could not load image because of ${u.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),h.e=Q,h.f=c=>new Promise((a,u)=>{const f=new Image;f.onload=()=>{a(f),URL.revokeObjectURL(f.src),f.onload=null,window.requestAnimationFrame(()=>{f.src=Je})},f.onerror=()=>u(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const y=new Blob([new Uint8Array(c)],{type:"image/png"});f.src=c.byteLength?URL.createObjectURL(y):Je}),h.g=Ft,h.h=(c,a)=>In(Q(c,{type:"json"}),a),h.i=ft,h.j=Yt,h.k=Qn,h.l=(c,a)=>In(Q(c,{type:"arrayBuffer"}),a),h.m=In,h.n=function(c){return new Ov(c).readFields(rP,[])},h.o=r0,h.p=N4,h.q=Wr,h.r=Df,h.s=je,h.t=Pm,h.u=qt,h.v=ie,h.w=Ae,h.x=Vl,h.y=function([c,a,u]){return a+=90,a*=Math.PI/180,u*=Math.PI/180,{x:c*Math.cos(a)*Math.sin(u),y:c*Math.sin(a)*Math.sin(u),z:c*Math.cos(u)}},h.z=oa}),r("worker",["./shared"],function(h){class o{constructor(B){this.keyCache={},B&&this.replace(B)}replace(B){this._layerConfigs={},this._layers={},this.update(B,[])}update(B,U){for(const ne of B){this._layerConfigs[ne.id]=ne;const me=this._layers[ne.id]=h.az(ne);me._featureFilter=h.a6(me.filter),this.keyCache[ne.id]&&delete this.keyCache[ne.id]}for(const ne of U)delete this.keyCache[ne],delete this._layerConfigs[ne],delete this._layers[ne];this.familiesBySource={};const q=h.bh(Object.values(this._layerConfigs),this.keyCache);for(const ne of q){const me=ne.map(Ye=>this._layers[Ye.id]),Se=me[0];if(Se.visibility==="none")continue;const Ee=Se.source||"";let ye=this.familiesBySource[Ee];ye||(ye=this.familiesBySource[Ee]={});const Re=Se.sourceLayer||"_geojsonTileLayer";let qe=ye[Re];qe||(qe=ye[Re]=[]),qe.push(me)}}}class p{constructor(B){const U={},q=[];for(const Ee in B){const ye=B[Ee],Re=U[Ee]={};for(const qe in ye){const Ye=ye[+qe];if(!Ye||Ye.bitmap.width===0||Ye.bitmap.height===0)continue;const Ge={x:0,y:0,w:Ye.bitmap.width+2,h:Ye.bitmap.height+2};q.push(Ge),Re[qe]={rect:Ge,metrics:Ye.metrics}}}const{w:ne,h:me}=h.p(q),Se=new h.o({width:ne||1,height:me||1});for(const Ee in B){const ye=B[Ee];for(const Re in ye){const qe=ye[+Re];if(!qe||qe.bitmap.width===0||qe.bitmap.height===0)continue;const Ye=U[Ee][Re].rect;h.o.copy(qe.bitmap,Se,{x:0,y:0},{x:Ye.x+1,y:Ye.y+1},qe.bitmap)}}this.image=Se,this.positions=U}}h.bi("GlyphAtlas",p);class v{constructor(B){this.tileID=new h.Q(B.tileID.overscaledZ,B.tileID.wrap,B.tileID.canonical.z,B.tileID.canonical.x,B.tileID.canonical.y),this.uid=B.uid,this.zoom=B.zoom,this.pixelRatio=B.pixelRatio,this.tileSize=B.tileSize,this.source=B.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=B.showCollisionBoxes,this.collectResourceTiming=!!B.collectResourceTiming,this.returnDependencies=!!B.returnDependencies,this.promoteId=B.promoteId,this.inFlightDependencies=[]}parse(B,U,q,ne){return h._(this,void 0,void 0,function*(){this.status="parsing",this.data=B,this.collisionBoxArray=new h.a4;const me=new h.bj(Object.keys(B.layers).sort()),Se=new h.bk(this.tileID,this.promoteId);Se.bucketLayerIDs=[];const Ee={},ye={featureIndex:Se,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:q},Re=U.familiesBySource[this.source];for(const Le in Re){const We=B.layers[Le];if(!We)continue;We.version===1&&h.w(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Xe=me.encode(Le),Ze=[];for(let Pt=0;Pt<We.length;Pt++){const rn=We.feature(Pt),It=Se.getId(rn,Le);Ze.push({feature:rn,id:It,index:Pt,sourceLayerIndex:Xe})}for(const Pt of Re[Le]){const rn=Pt[0];rn.source!==this.source&&h.w(`layer.source = ${rn.source} does not equal this.source = ${this.source}`),rn.minzoom&&this.zoom<Math.floor(rn.minzoom)||rn.maxzoom&&this.zoom>=rn.maxzoom||rn.visibility!=="none"&&(x(Pt,this.zoom,q),(Ee[rn.id]=rn.createBucket({index:Se.bucketLayerIDs.length,layers:Pt,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xe,sourceID:this.source})).populate(Ze,ye,this.tileID.canonical),Se.bucketLayerIDs.push(Pt.map(It=>It.id)))}}const qe=h.aE(ye.glyphDependencies,Le=>Object.keys(Le).map(Number));this.inFlightDependencies.forEach(Le=>Le==null?void 0:Le.abort()),this.inFlightDependencies=[];let Ye=Promise.resolve({});if(Object.keys(qe).length){const Le=new AbortController;this.inFlightDependencies.push(Le),Ye=ne.sendAsync({type:"getGlyphs",data:{stacks:qe,source:this.source,tileID:this.tileID,type:"glyphs"}},Le)}const Ge=Object.keys(ye.iconDependencies);let Ct=Promise.resolve({});if(Ge.length){const Le=new AbortController;this.inFlightDependencies.push(Le),Ct=ne.sendAsync({type:"getImages",data:{icons:Ge,source:this.source,tileID:this.tileID,type:"icons"}},Le)}const nn=Object.keys(ye.patternDependencies);let on=Promise.resolve({});if(nn.length){const Le=new AbortController;this.inFlightDependencies.push(Le),on=ne.sendAsync({type:"getImages",data:{icons:nn,source:this.source,tileID:this.tileID,type:"patterns"}},Le)}const[bn,wn,li]=yield Promise.all([Ye,Ct,on]),ei=new p(bn),de=new h.bl(wn,li);for(const Le in Ee){const We=Ee[Le];We instanceof h.a5?(x(We.layers,this.zoom,q),h.bm({bucket:We,glyphMap:bn,glyphPositions:ei.positions,imageMap:wn,imagePositions:de.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):We.hasPattern&&(We instanceof h.bn||We instanceof h.bo||We instanceof h.bp)&&(x(We.layers,this.zoom,q),We.addFeatures(ye,this.tileID.canonical,de.patternPositions))}return this.status="done",{buckets:Object.values(Ee).filter(Le=>!Le.isEmpty()),featureIndex:Se,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ei.image,imageAtlas:de,glyphMap:this.returnDependencies?bn:null,iconMap:this.returnDependencies?wn:null,glyphPositions:this.returnDependencies?ei.positions:null}})}}function x(ce,B,U){const q=new h.a8(B);for(const ne of ce)ne.recalculate(q,U)}class M{constructor(B,U,q){this.actor=B,this.layerIndex=U,this.availableImages=q,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(B,U){return h._(this,void 0,void 0,function*(){const q=yield h.l(B.request,U);try{return{vectorTile:new h.bq.VectorTile(new h.br(q.data)),rawData:q.data,cacheControl:q.cacheControl,expires:q.expires}}catch(ne){const me=new Uint8Array(q.data);let Se=`Unable to parse the tile at ${B.request.url}, `;throw Se+=me[0]===31&&me[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${ne.messge}`,new Error(Se)}})}loadTile(B){return h._(this,void 0,void 0,function*(){const U=B.uid,q=!!(B&&B.request&&B.request.collectResourceTiming)&&new h.bs(B.request),ne=new v(B);this.loading[U]=ne;const me=new AbortController;ne.abort=me;try{const Se=yield this.loadVectorTile(B,me);if(delete this.loading[U],!Se)return null;const Ee=Se.rawData,ye={};Se.expires&&(ye.expires=Se.expires),Se.cacheControl&&(ye.cacheControl=Se.cacheControl);const Re={};if(q){const Ye=q.finish();Ye&&(Re.resourceTiming=JSON.parse(JSON.stringify(Ye)))}ne.vectorTile=Se.vectorTile;const qe=ne.parse(Se.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[U]=ne,this.fetching[U]={rawTileData:Ee,cacheControl:ye,resourceTiming:Re};try{const Ye=yield qe;return h.e({rawTileData:Ee.slice(0)},Ye,ye,Re)}finally{delete this.fetching[U]}}catch(Se){throw delete this.loading[U],ne.status="done",this.loaded[U]=ne,Se}})}reloadTile(B){return h._(this,void 0,void 0,function*(){const U=B.uid;if(!this.loaded||!this.loaded[U])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const q=this.loaded[U];if(q.showCollisionBoxes=B.showCollisionBoxes,q.status==="parsing"){const ne=yield q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor);let me;if(this.fetching[U]){const{rawTileData:Se,cacheControl:Ee,resourceTiming:ye}=this.fetching[U];delete this.fetching[U],me=h.e({rawTileData:Se.slice(0)},ne,Ee,ye)}else me=ne;return me}if(q.status==="done"&&q.vectorTile)return q.parse(q.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(B){return h._(this,void 0,void 0,function*(){const U=this.loading,q=B.uid;U&&U[q]&&U[q].abort&&(U[q].abort.abort(),delete U[q])})}removeTile(B){return h._(this,void 0,void 0,function*(){this.loaded&&this.loaded[B.uid]&&delete this.loaded[B.uid]})}}class S{constructor(){this.loaded={}}loadTile(B){return h._(this,void 0,void 0,function*(){const{uid:U,encoding:q,rawImageData:ne,redFactor:me,greenFactor:Se,blueFactor:Ee,baseShift:ye}=B,Re=ne.width+2,qe=ne.height+2,Ye=h.b(ne)?new h.R({width:Re,height:qe},yield h.bt(ne,-1,-1,Re,qe)):ne,Ge=new h.bu(U,Ye,q,me,Se,Ee,ye);return this.loaded=this.loaded||{},this.loaded[U]=Ge,Ge})}removeTile(B){const U=this.loaded,q=B.uid;U&&U[q]&&delete U[q]}}function A(ce,B){if(ce.length!==0){L(ce[0],B);for(var U=1;U<ce.length;U++)L(ce[U],!B)}}function L(ce,B){for(var U=0,q=0,ne=0,me=ce.length,Se=me-1;ne<me;Se=ne++){var Ee=(ce[ne][0]-ce[Se][0])*(ce[Se][1]+ce[ne][1]),ye=U+Ee;q+=Math.abs(U)>=Math.abs(Ee)?U-ye+Ee:Ee-ye+U,U=ye}U+q>=0!=!!B&&ce.reverse()}var F=h.bv(function ce(B,U){var q,ne=B&&B.type;if(ne==="FeatureCollection")for(q=0;q<B.features.length;q++)ce(B.features[q],U);else if(ne==="GeometryCollection")for(q=0;q<B.geometries.length;q++)ce(B.geometries[q],U);else if(ne==="Feature")ce(B.geometry,U);else if(ne==="Polygon")A(B.coordinates,U);else if(ne==="MultiPolygon")for(q=0;q<B.coordinates.length;q++)A(B.coordinates[q],U);return B});const k=h.bq.VectorTileFeature.prototype.toGeoJSON;var C={exports:{}},V=h.bw,O=h.bq.VectorTileFeature,J=ue;function ue(ce,B){this.options=B||{},this.features=ce,this.length=ce.length}function Y(ce,B){this.id=typeof ce.id=="number"?ce.id:void 0,this.type=ce.type,this.rawGeometry=ce.type===1?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=B||4096}ue.prototype.feature=function(ce){return new Y(this.features[ce],this.options.extent)},Y.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var B=0;B<ce.length;B++){for(var U=ce[B],q=[],ne=0;ne<U.length;ne++)q.push(new V(U[ne][0],U[ne][1]));this.geometry.push(q)}return this.geometry},Y.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,B=1/0,U=-1/0,q=1/0,ne=-1/0,me=0;me<ce.length;me++)for(var Se=ce[me],Ee=0;Ee<Se.length;Ee++){var ye=Se[Ee];B=Math.min(B,ye.x),U=Math.max(U,ye.x),q=Math.min(q,ye.y),ne=Math.max(ne,ye.y)}return[B,q,U,ne]},Y.prototype.toGeoJSON=O.prototype.toGeoJSON;var Q=h.bx,xe=J;function re(ce){var B=new Q;return function(U,q){for(var ne in U.layers)q.writeMessage(3,ee,U.layers[ne])}(ce,B),B.finish()}function ee(ce,B){var U;B.writeVarintField(15,ce.version||1),B.writeStringField(1,ce.name||""),B.writeVarintField(5,ce.extent||4096);var q={keys:[],values:[],keycache:{},valuecache:{}};for(U=0;U<ce.length;U++)q.feature=ce.feature(U),B.writeMessage(2,Me,q);var ne=q.keys;for(U=0;U<ne.length;U++)B.writeStringField(3,ne[U]);var me=q.values;for(U=0;U<me.length;U++)B.writeMessage(4,ft,me[U])}function Me(ce,B){var U=ce.feature;U.id!==void 0&&B.writeVarintField(1,U.id),B.writeMessage(2,Fe,ce),B.writeVarintField(3,U.type),B.writeMessage(4,ot,U)}function Fe(ce,B){var U=ce.feature,q=ce.keys,ne=ce.values,me=ce.keycache,Se=ce.valuecache;for(var Ee in U.properties){var ye=U.properties[Ee],Re=me[Ee];if(ye!==null){Re===void 0&&(q.push(Ee),me[Ee]=Re=q.length-1),B.writeVarint(Re);var qe=typeof ye;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(ye=JSON.stringify(ye));var Ye=qe+":"+ye,Ge=Se[Ye];Ge===void 0&&(ne.push(ye),Se[Ye]=Ge=ne.length-1),B.writeVarint(Ge)}}}function Ae(ce,B){return(B<<3)+(7&ce)}function He(ce){return ce<<1^ce>>31}function ot(ce,B){for(var U=ce.loadGeometry(),q=ce.type,ne=0,me=0,Se=U.length,Ee=0;Ee<Se;Ee++){var ye=U[Ee],Re=1;q===1&&(Re=ye.length),B.writeVarint(Ae(1,Re));for(var qe=q===3?ye.length-1:ye.length,Ye=0;Ye<qe;Ye++){Ye===1&&q!==1&&B.writeVarint(Ae(2,qe-1));var Ge=ye[Ye].x-ne,Ct=ye[Ye].y-me;B.writeVarint(He(Ge)),B.writeVarint(He(Ct)),ne+=Ge,me+=Ct}q===3&&B.writeVarint(Ae(7,1))}}function ft(ce,B){var U=typeof ce;U==="string"?B.writeStringField(1,ce):U==="boolean"?B.writeBooleanField(7,ce):U==="number"&&(ce%1!=0?B.writeDoubleField(3,ce):ce<0?B.writeSVarintField(6,ce):B.writeVarintField(5,ce))}C.exports=re,C.exports.fromVectorTileJs=re,C.exports.fromGeojsonVt=function(ce,B){B=B||{};var U={};for(var q in ce)U[q]=new xe(ce[q].features,B),U[q].name=q,U[q].version=B.version,U[q].extent=B.extent;return re({layers:U})},C.exports.GeoJSONWrapper=xe;var ct=h.bv(C.exports);const De={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Je=Math.fround||(tt=new Float32Array(1),ce=>(tt[0]=+ce,tt[0]));var tt;const _t=3,Lt=5,Cn=6;class nt{constructor(B){this.options=Object.assign(Object.create(De),B),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(B){const{log:U,minZoom:q,maxZoom:ne}=this.options;U&&console.time("total time");const me=`prepare ${B.length} points`;U&&console.time(me),this.points=B;const Se=[];for(let ye=0;ye<B.length;ye++){const Re=B[ye];if(!Re.geometry)continue;const[qe,Ye]=Re.geometry.coordinates,Ge=Je(At(qe)),Ct=Je(gn(Ye));Se.push(Ge,Ct,1/0,ye,-1,1),this.options.reduce&&Se.push(0)}let Ee=this.trees[ne+1]=this._createTree(Se);U&&console.timeEnd(me);for(let ye=ne;ye>=q;ye--){const Re=+Date.now();Ee=this.trees[ye]=this._createTree(this._cluster(Ee,ye)),U&&console.log("z%d: %d clusters in %dms",ye,Ee.numItems,+Date.now()-Re)}return U&&console.timeEnd("total time"),this}getClusters(B,U){let q=((B[0]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,B[1]));let me=B[2]===180?180:((B[2]+180)%360+360)%360-180;const Se=Math.max(-90,Math.min(90,B[3]));if(B[2]-B[0]>=360)q=-180,me=180;else if(q>me){const Ye=this.getClusters([q,ne,180,Se],U),Ge=this.getClusters([-180,ne,me,Se],U);return Ye.concat(Ge)}const Ee=this.trees[this._limitZoom(U)],ye=Ee.range(At(q),gn(Se),At(me),gn(ne)),Re=Ee.data,qe=[];for(const Ye of ye){const Ge=this.stride*Ye;qe.push(Re[Ge+Lt]>1?wt(Re,Ge,this.clusterProps):this.points[Re[Ge+_t]])}return qe}getChildren(B){const U=this._getOriginId(B),q=this._getOriginZoom(B),ne="No cluster with the specified id.",me=this.trees[q];if(!me)throw new Error(ne);const Se=me.data;if(U*this.stride>=Se.length)throw new Error(ne);const Ee=this.options.radius/(this.options.extent*Math.pow(2,q-1)),ye=me.within(Se[U*this.stride],Se[U*this.stride+1],Ee),Re=[];for(const qe of ye){const Ye=qe*this.stride;Se[Ye+4]===B&&Re.push(Se[Ye+Lt]>1?wt(Se,Ye,this.clusterProps):this.points[Se[Ye+_t]])}if(Re.length===0)throw new Error(ne);return Re}getLeaves(B,U,q){const ne=[];return this._appendLeaves(ne,B,U=U||10,q=q||0,0),ne}getTile(B,U,q){const ne=this.trees[this._limitZoom(B)],me=Math.pow(2,B),{extent:Se,radius:Ee}=this.options,ye=Ee/Se,Re=(q-ye)/me,qe=(q+1+ye)/me,Ye={features:[]};return this._addTileFeatures(ne.range((U-ye)/me,Re,(U+1+ye)/me,qe),ne.data,U,q,me,Ye),U===0&&this._addTileFeatures(ne.range(1-ye/me,Re,1,qe),ne.data,me,q,me,Ye),U===me-1&&this._addTileFeatures(ne.range(0,Re,ye/me,qe),ne.data,-1,q,me,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(B){let U=this._getOriginZoom(B)-1;for(;U<=this.options.maxZoom;){const q=this.getChildren(B);if(U++,q.length!==1)break;B=q[0].properties.cluster_id}return U}_appendLeaves(B,U,q,ne,me){const Se=this.getChildren(U);for(const Ee of Se){const ye=Ee.properties;if(ye&&ye.cluster?me+ye.point_count<=ne?me+=ye.point_count:me=this._appendLeaves(B,ye.cluster_id,q,ne,me):me<ne?me++:B.push(Ee),B.length===q)break}return me}_createTree(B){const U=new h.au(B.length/this.stride|0,this.options.nodeSize,Float32Array);for(let q=0;q<B.length;q+=this.stride)U.add(B[q],B[q+1]);return U.finish(),U.data=B,U}_addTileFeatures(B,U,q,ne,me,Se){for(const Ee of B){const ye=Ee*this.stride,Re=U[ye+Lt]>1;let qe,Ye,Ge;if(Re)qe=Ft(U,ye,this.clusterProps),Ye=U[ye],Ge=U[ye+1];else{const on=this.points[U[ye+_t]];qe=on.properties;const[bn,wn]=on.geometry.coordinates;Ye=At(bn),Ge=gn(wn)}const Ct={type:1,geometry:[[Math.round(this.options.extent*(Ye*me-q)),Math.round(this.options.extent*(Ge*me-ne))]],tags:qe};let nn;nn=Re||this.options.generateId?U[ye+_t]:this.points[U[ye+_t]].id,nn!==void 0&&(Ct.id=nn),Se.features.push(Ct)}}_limitZoom(B){return Math.max(this.options.minZoom,Math.min(Math.floor(+B),this.options.maxZoom+1))}_cluster(B,U){const{radius:q,extent:ne,reduce:me,minPoints:Se}=this.options,Ee=q/(ne*Math.pow(2,U)),ye=B.data,Re=[],qe=this.stride;for(let Ye=0;Ye<ye.length;Ye+=qe){if(ye[Ye+2]<=U)continue;ye[Ye+2]=U;const Ge=ye[Ye],Ct=ye[Ye+1],nn=B.within(ye[Ye],ye[Ye+1],Ee),on=ye[Ye+Lt];let bn=on;for(const wn of nn){const li=wn*qe;ye[li+2]>U&&(bn+=ye[li+Lt])}if(bn>on&&bn>=Se){let wn,li=Ge*on,ei=Ct*on,de=-1;const Le=((Ye/qe|0)<<5)+(U+1)+this.points.length;for(const We of nn){const Xe=We*qe;if(ye[Xe+2]<=U)continue;ye[Xe+2]=U;const Ze=ye[Xe+Lt];li+=ye[Xe]*Ze,ei+=ye[Xe+1]*Ze,ye[Xe+4]=Le,me&&(wn||(wn=this._map(ye,Ye,!0),de=this.clusterProps.length,this.clusterProps.push(wn)),me(wn,this._map(ye,Xe)))}ye[Ye+4]=Le,Re.push(li/bn,ei/bn,1/0,Le,-1,bn),me&&Re.push(de)}else{for(let wn=0;wn<qe;wn++)Re.push(ye[Ye+wn]);if(bn>1)for(const wn of nn){const li=wn*qe;if(!(ye[li+2]<=U)){ye[li+2]=U;for(let ei=0;ei<qe;ei++)Re.push(ye[li+ei])}}}}return Re}_getOriginId(B){return B-this.points.length>>5}_getOriginZoom(B){return(B-this.points.length)%32}_map(B,U,q){if(B[U+Lt]>1){const Se=this.clusterProps[B[U+Cn]];return q?Object.assign({},Se):Se}const ne=this.points[B[U+_t]].properties,me=this.options.map(ne);return q&&me===ne?Object.assign({},me):me}}function wt(ce,B,U){return{type:"Feature",id:ce[B+_t],properties:Ft(ce,B,U),geometry:{type:"Point",coordinates:[(q=ce[B],360*(q-.5)),En(ce[B+1])]}};var q}function Ft(ce,B,U){const q=ce[B+Lt],ne=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q,me=ce[B+Cn],Se=me===-1?{}:Object.assign({},U[me]);return Object.assign(Se,{cluster:!0,cluster_id:ce[B+_t],point_count:q,point_count_abbreviated:ne})}function At(ce){return ce/360+.5}function gn(ce){const B=Math.sin(ce*Math.PI/180),U=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return U<0?0:U>1?1:U}function En(ce){const B=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(B))/Math.PI-90}function In(ce,B,U,q){for(var ne,me=q,Se=U-B>>1,Ee=U-B,ye=ce[B],Re=ce[B+1],qe=ce[U],Ye=ce[U+1],Ge=B+3;Ge<U;Ge+=3){var Ct=je(ce[Ge],ce[Ge+1],ye,Re,qe,Ye);if(Ct>me)ne=Ge,me=Ct;else if(Ct===me){var nn=Math.abs(Ge-Se);nn<Ee&&(ne=Ge,Ee=nn)}}me>q&&(ne-B>3&&In(ce,B,ne,q),ce[ne+2]=me,U-ne>3&&In(ce,ne,U,q))}function je(ce,B,U,q,ne,me){var Se=ne-U,Ee=me-q;if(Se!==0||Ee!==0){var ye=((ce-U)*Se+(B-q)*Ee)/(Se*Se+Ee*Ee);ye>1?(U=ne,q=me):ye>0&&(U+=Se*ye,q+=Ee*ye)}return(Se=ce-U)*Se+(Ee=B-q)*Ee}function An(ce,B,U,q){var ne={id:ce===void 0?null:ce,type:B,geometry:U,tags:q,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(me){var Se=me.geometry,Ee=me.type;if(Ee==="Point"||Ee==="MultiPoint"||Ee==="LineString")yn(me,Se);else if(Ee==="Polygon"||Ee==="MultiLineString")for(var ye=0;ye<Se.length;ye++)yn(me,Se[ye]);else if(Ee==="MultiPolygon")for(ye=0;ye<Se.length;ye++)for(var Re=0;Re<Se[ye].length;Re++)yn(me,Se[ye][Re])}(ne),ne}function yn(ce,B){for(var U=0;U<B.length;U+=3)ce.minX=Math.min(ce.minX,B[U]),ce.minY=Math.min(ce.minY,B[U+1]),ce.maxX=Math.max(ce.maxX,B[U]),ce.maxY=Math.max(ce.maxY,B[U+1])}function Qn(ce,B,U,q){if(B.geometry){var ne=B.geometry.coordinates,me=B.geometry.type,Se=Math.pow(U.tolerance/((1<<U.maxZoom)*U.extent),2),Ee=[],ye=B.id;if(U.promoteId?ye=B.properties[U.promoteId]:U.generateId&&(ye=q||0),me==="Point")Yt(ne,Ee);else if(me==="MultiPoint")for(var Re=0;Re<ne.length;Re++)Yt(ne[Re],Ee);else if(me==="LineString")Gn(ne,Ee,Se,!1);else if(me==="MultiLineString"){if(U.lineMetrics){for(Re=0;Re<ne.length;Re++)Gn(ne[Re],Ee=[],Se,!1),ce.push(An(ye,"LineString",Ee,B.properties));return}ie(ne,Ee,Se,!1)}else if(me==="Polygon")ie(ne,Ee,Se,!0);else{if(me!=="MultiPolygon"){if(me==="GeometryCollection"){for(Re=0;Re<B.geometry.geometries.length;Re++)Qn(ce,{id:ye,geometry:B.geometry.geometries[Re],properties:B.properties},U,q);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Re=0;Re<ne.length;Re++){var qe=[];ie(ne[Re],qe,Se,!0),Ee.push(qe)}}ce.push(An(ye,me,Ee,B.properties))}}function Yt(ce,B){B.push(le(ce[0])),B.push(st(ce[1])),B.push(0)}function Gn(ce,B,U,q){for(var ne,me,Se=0,Ee=0;Ee<ce.length;Ee++){var ye=le(ce[Ee][0]),Re=st(ce[Ee][1]);B.push(ye),B.push(Re),B.push(0),Ee>0&&(Se+=q?(ne*Re-ye*me)/2:Math.sqrt(Math.pow(ye-ne,2)+Math.pow(Re-me,2))),ne=ye,me=Re}var qe=B.length-3;B[2]=1,In(B,0,qe,U),B[qe+2]=1,B.size=Math.abs(Se),B.start=0,B.end=B.size}function ie(ce,B,U,q){for(var ne=0;ne<ce.length;ne++){var me=[];Gn(ce[ne],me,U,q),B.push(me)}}function le(ce){return ce/360+.5}function st(ce){var B=Math.sin(ce*Math.PI/180),U=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return U<0?0:U>1?1:U}function rt(ce,B,U,q,ne,me,Se,Ee){if(q/=B,me>=(U/=B)&&Se<q)return ce;if(Se<U||me>=q)return null;for(var ye=[],Re=0;Re<ce.length;Re++){var qe=ce[Re],Ye=qe.geometry,Ge=qe.type,Ct=ne===0?qe.minX:qe.minY,nn=ne===0?qe.maxX:qe.maxY;if(Ct>=U&&nn<q)ye.push(qe);else if(!(nn<U||Ct>=q)){var on=[];if(Ge==="Point"||Ge==="MultiPoint")mt(Ye,on,U,q,ne);else if(Ge==="LineString")St(Ye,on,U,q,ne,!1,Ee.lineMetrics);else if(Ge==="MultiLineString")Mt(Ye,on,U,q,ne,!1);else if(Ge==="Polygon")Mt(Ye,on,U,q,ne,!0);else if(Ge==="MultiPolygon")for(var bn=0;bn<Ye.length;bn++){var wn=[];Mt(Ye[bn],wn,U,q,ne,!0),wn.length&&on.push(wn)}if(on.length){if(Ee.lineMetrics&&Ge==="LineString"){for(bn=0;bn<on.length;bn++)ye.push(An(qe.id,Ge,on[bn],qe.tags));continue}Ge!=="LineString"&&Ge!=="MultiLineString"||(on.length===1?(Ge="LineString",on=on[0]):Ge="MultiLineString"),Ge!=="Point"&&Ge!=="MultiPoint"||(Ge=on.length===3?"Point":"MultiPoint"),ye.push(An(qe.id,Ge,on,qe.tags))}}}return ye.length?ye:null}function mt(ce,B,U,q,ne){for(var me=0;me<ce.length;me+=3){var Se=ce[me+ne];Se>=U&&Se<=q&&(B.push(ce[me]),B.push(ce[me+1]),B.push(ce[me+2]))}}function St(ce,B,U,q,ne,me,Se){for(var Ee,ye,Re=_n(ce),qe=ne===0?xn:Nt,Ye=ce.start,Ge=0;Ge<ce.length-3;Ge+=3){var Ct=ce[Ge],nn=ce[Ge+1],on=ce[Ge+2],bn=ce[Ge+3],wn=ce[Ge+4],li=ne===0?Ct:nn,ei=ne===0?bn:wn,de=!1;Se&&(Ee=Math.sqrt(Math.pow(Ct-bn,2)+Math.pow(nn-wn,2))),li<U?ei>U&&(ye=qe(Re,Ct,nn,bn,wn,U),Se&&(Re.start=Ye+Ee*ye)):li>q?ei<q&&(ye=qe(Re,Ct,nn,bn,wn,q),Se&&(Re.start=Ye+Ee*ye)):hn(Re,Ct,nn,on),ei<U&&li>=U&&(ye=qe(Re,Ct,nn,bn,wn,U),de=!0),ei>q&&li<=q&&(ye=qe(Re,Ct,nn,bn,wn,q),de=!0),!me&&de&&(Se&&(Re.end=Ye+Ee*ye),B.push(Re),Re=_n(ce)),Se&&(Ye+=Ee)}var Le=ce.length-3;Ct=ce[Le],nn=ce[Le+1],on=ce[Le+2],(li=ne===0?Ct:nn)>=U&&li<=q&&hn(Re,Ct,nn,on),Le=Re.length-3,me&&Le>=3&&(Re[Le]!==Re[0]||Re[Le+1]!==Re[1])&&hn(Re,Re[0],Re[1],Re[2]),Re.length&&B.push(Re)}function _n(ce){var B=[];return B.size=ce.size,B.start=ce.start,B.end=ce.end,B}function Mt(ce,B,U,q,ne,me){for(var Se=0;Se<ce.length;Se++)St(ce[Se],B,U,q,ne,me,!1)}function hn(ce,B,U,q){ce.push(B),ce.push(U),ce.push(q)}function xn(ce,B,U,q,ne,me){var Se=(me-B)/(q-B);return ce.push(me),ce.push(U+(ne-U)*Se),ce.push(1),Se}function Nt(ce,B,U,q,ne,me){var Se=(me-U)/(ne-U);return ce.push(B+(q-B)*Se),ce.push(me),ce.push(1),Se}function an(ce,B){for(var U=[],q=0;q<ce.length;q++){var ne,me=ce[q],Se=me.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")ne=at(me.geometry,B);else if(Se==="MultiLineString"||Se==="Polygon"){ne=[];for(var Ee=0;Ee<me.geometry.length;Ee++)ne.push(at(me.geometry[Ee],B))}else if(Se==="MultiPolygon")for(ne=[],Ee=0;Ee<me.geometry.length;Ee++){for(var ye=[],Re=0;Re<me.geometry[Ee].length;Re++)ye.push(at(me.geometry[Ee][Re],B));ne.push(ye)}U.push(An(me.id,Se,ne,me.tags))}return U}function at(ce,B){var U=[];U.size=ce.size,ce.start!==void 0&&(U.start=ce.start,U.end=ce.end);for(var q=0;q<ce.length;q+=3)U.push(ce[q]+B,ce[q+1],ce[q+2]);return U}function tn(ce,B){if(ce.transformed)return ce;var U,q,ne,me=1<<ce.z,Se=ce.x,Ee=ce.y;for(U=0;U<ce.features.length;U++){var ye=ce.features[U],Re=ye.geometry,qe=ye.type;if(ye.geometry=[],qe===1)for(q=0;q<Re.length;q+=2)ye.geometry.push(Kt(Re[q],Re[q+1],B,me,Se,Ee));else for(q=0;q<Re.length;q++){var Ye=[];for(ne=0;ne<Re[q].length;ne+=2)Ye.push(Kt(Re[q][ne],Re[q][ne+1],B,me,Se,Ee));ye.geometry.push(Ye)}}return ce.transformed=!0,ce}function Kt(ce,B,U,q,ne,me){return[Math.round(U*(ce*q-ne)),Math.round(U*(B*q-me))]}function On(ce,B,U,q,ne){for(var me=B===ne.maxZoom?0:ne.tolerance/((1<<B)*ne.extent),Se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:U,y:q,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Ee=0;Ee<ce.length;Ee++){Se.numFeatures++,Un(Se,ce[Ee],me,ne);var ye=ce[Ee].minX,Re=ce[Ee].minY,qe=ce[Ee].maxX,Ye=ce[Ee].maxY;ye<Se.minX&&(Se.minX=ye),Re<Se.minY&&(Se.minY=Re),qe>Se.maxX&&(Se.maxX=qe),Ye>Se.maxY&&(Se.maxY=Ye)}return Se}function Un(ce,B,U,q){var ne=B.geometry,me=B.type,Se=[];if(me==="Point"||me==="MultiPoint")for(var Ee=0;Ee<ne.length;Ee+=3)Se.push(ne[Ee]),Se.push(ne[Ee+1]),ce.numPoints++,ce.numSimplified++;else if(me==="LineString")dt(Se,ne,ce,U,!1,!1);else if(me==="MultiLineString"||me==="Polygon")for(Ee=0;Ee<ne.length;Ee++)dt(Se,ne[Ee],ce,U,me==="Polygon",Ee===0);else if(me==="MultiPolygon")for(var ye=0;ye<ne.length;ye++){var Re=ne[ye];for(Ee=0;Ee<Re.length;Ee++)dt(Se,Re[Ee],ce,U,!0,Ee===0)}if(Se.length){var qe=B.tags||null;if(me==="LineString"&&q.lineMetrics){for(var Ye in qe={},B.tags)qe[Ye]=B.tags[Ye];qe.mapbox_clip_start=ne.start/ne.size,qe.mapbox_clip_end=ne.end/ne.size}var Ge={geometry:Se,type:me==="Polygon"||me==="MultiPolygon"?3:me==="LineString"||me==="MultiLineString"?2:1,tags:qe};B.id!==null&&(Ge.id=B.id),ce.features.push(Ge)}}function dt(ce,B,U,q,ne,me){var Se=q*q;if(q>0&&B.size<(ne?Se:q))U.numPoints+=B.length/3;else{for(var Ee=[],ye=0;ye<B.length;ye+=3)(q===0||B[ye+2]>Se)&&(U.numSimplified++,Ee.push(B[ye]),Ee.push(B[ye+1])),U.numPoints++;ne&&function(Re,qe){for(var Ye=0,Ge=0,Ct=Re.length,nn=Ct-2;Ge<Ct;nn=Ge,Ge+=2)Ye+=(Re[Ge]-Re[nn])*(Re[Ge+1]+Re[nn+1]);if(Ye>0===qe)for(Ge=0,Ct=Re.length;Ge<Ct/2;Ge+=2){var on=Re[Ge],bn=Re[Ge+1];Re[Ge]=Re[Ct-2-Ge],Re[Ge+1]=Re[Ct-1-Ge],Re[Ct-2-Ge]=on,Re[Ct-1-Ge]=bn}}(Ee,me),ce.push(Ee)}}function Ht(ce,B){var U=(B=this.options=function(ne,me){for(var Se in me)ne[Se]=me[Se];return ne}(Object.create(this.options),B)).debug;if(U&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var q=function(ne,me){var Se=[];if(ne.type==="FeatureCollection")for(var Ee=0;Ee<ne.features.length;Ee++)Qn(Se,ne.features[Ee],me,Ee);else Qn(Se,ne.type==="Feature"?ne:{geometry:ne},me);return Se}(ce,B);this.tiles={},this.tileCoords=[],U&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=function(ne,me){var Se=me.buffer/me.extent,Ee=ne,ye=rt(ne,1,-1-Se,Se,0,-1,2,me),Re=rt(ne,1,1-Se,2+Se,0,-1,2,me);return(ye||Re)&&(Ee=rt(ne,1,-Se,1+Se,0,-1,2,me)||[],ye&&(Ee=an(ye,1).concat(Ee)),Re&&(Ee=Ee.concat(an(Re,-1)))),Ee}(q,B),q.length&&this.splitTile(q,0,0,0),U&&(q.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function jt(ce,B,U){return 32*((1<<ce)*U+B)+ce}function Jt(ce,B){return B?ce.properties[B]:ce.id}function X(ce,B){if(ce==null)return!0;if(ce.type==="Feature")return Jt(ce,B)!=null;if(ce.type==="FeatureCollection"){const U=new Set;for(const q of ce.features){const ne=Jt(q,B);if(ne==null||U.has(ne))return!1;U.add(ne)}return!0}return!1}function Oe(ce,B){const U=new Map;if(ce!=null)if(ce.type==="Feature")U.set(Jt(ce,B),ce);else for(const q of ce.features)U.set(Jt(q,B),q);return U}Ht.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Ht.prototype.splitTile=function(ce,B,U,q,ne,me,Se){for(var Ee=[ce,B,U,q],ye=this.options,Re=ye.debug;Ee.length;){q=Ee.pop(),U=Ee.pop(),B=Ee.pop(),ce=Ee.pop();var qe=1<<B,Ye=jt(B,U,q),Ge=this.tiles[Ye];if(!Ge&&(Re>1&&console.time("creation"),Ge=this.tiles[Ye]=On(ce,B,U,q,ye),this.tileCoords.push({z:B,x:U,y:q}),Re)){Re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,U,q,Ge.numFeatures,Ge.numPoints,Ge.numSimplified),console.timeEnd("creation"));var Ct="z"+B;this.stats[Ct]=(this.stats[Ct]||0)+1,this.total++}if(Ge.source=ce,ne){if(B===ye.maxZoom||B===ne)continue;var nn=1<<ne-B;if(U!==Math.floor(me/nn)||q!==Math.floor(Se/nn))continue}else if(B===ye.indexMaxZoom||Ge.numPoints<=ye.indexMaxPoints)continue;if(Ge.source=null,ce.length!==0){Re>1&&console.time("clipping");var on,bn,wn,li,ei,de,Le=.5*ye.buffer/ye.extent,We=.5-Le,Xe=.5+Le,Ze=1+Le;on=bn=wn=li=null,ei=rt(ce,qe,U-Le,U+Xe,0,Ge.minX,Ge.maxX,ye),de=rt(ce,qe,U+We,U+Ze,0,Ge.minX,Ge.maxX,ye),ce=null,ei&&(on=rt(ei,qe,q-Le,q+Xe,1,Ge.minY,Ge.maxY,ye),bn=rt(ei,qe,q+We,q+Ze,1,Ge.minY,Ge.maxY,ye),ei=null),de&&(wn=rt(de,qe,q-Le,q+Xe,1,Ge.minY,Ge.maxY,ye),li=rt(de,qe,q+We,q+Ze,1,Ge.minY,Ge.maxY,ye),de=null),Re>1&&console.timeEnd("clipping"),Ee.push(on||[],B+1,2*U,2*q),Ee.push(bn||[],B+1,2*U,2*q+1),Ee.push(wn||[],B+1,2*U+1,2*q),Ee.push(li||[],B+1,2*U+1,2*q+1)}}},Ht.prototype.getTile=function(ce,B,U){var q=this.options,ne=q.extent,me=q.debug;if(ce<0||ce>24)return null;var Se=1<<ce,Ee=jt(ce,B=(B%Se+Se)%Se,U);if(this.tiles[Ee])return tn(this.tiles[Ee],ne);me>1&&console.log("drilling down to z%d-%d-%d",ce,B,U);for(var ye,Re=ce,qe=B,Ye=U;!ye&&Re>0;)Re--,qe=Math.floor(qe/2),Ye=Math.floor(Ye/2),ye=this.tiles[jt(Re,qe,Ye)];return ye&&ye.source?(me>1&&console.log("found parent tile z%d-%d-%d",Re,qe,Ye),me>1&&console.time("drilling down"),this.splitTile(ye.source,Re,qe,Ye,ce,B,U),me>1&&console.timeEnd("drilling down"),this.tiles[Ee]?tn(this.tiles[Ee],ne):null):null};class pt extends M{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(B,U){return h._(this,void 0,void 0,function*(){const q=B.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const ne=this._geoJSONIndex.getTile(q.z,q.x,q.y);if(!ne)return null;const me=new class{constructor(Ee){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=h.W,this.length=Ee.length,this._features=Ee}feature(Ee){return new class{constructor(ye){this._feature=ye,this.extent=h.W,this.type=ye.type,this.properties=ye.tags,"id"in ye&&!isNaN(ye.id)&&(this.id=parseInt(ye.id,10))}loadGeometry(){if(this._feature.type===1){const ye=[];for(const Re of this._feature.geometry)ye.push([new h.P(Re[0],Re[1])]);return ye}{const ye=[];for(const Re of this._feature.geometry){const qe=[];for(const Ye of Re)qe.push(new h.P(Ye[0],Ye[1]));ye.push(qe)}return ye}}toGeoJSON(ye,Re,qe){return k.call(this,ye,Re,qe)}}(this._features[Ee])}}(ne.features);let Se=ct(me);return Se.byteOffset===0&&Se.byteLength===Se.buffer.byteLength||(Se=new Uint8Array(Se)),{vectorTile:me,rawData:Se.buffer}})}loadData(B){return h._(this,void 0,void 0,function*(){var U;(U=this._pendingRequest)===null||U===void 0||U.abort();const q=!!(B&&B.request&&B.request.collectResourceTiming)&&new h.bs(B.request);this._pendingRequest=new AbortController;try{let ne=yield this.loadGeoJSON(B,this._pendingRequest);if(delete this._pendingRequest,typeof ne!="object")throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(F(ne,!0),B.filter){const Se=h.by(B.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Se.result==="error")throw new Error(Se.value.map(ye=>`${ye.key}: ${ye.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(ye=>Se.value.evaluate({zoom:0},ye))}}this._geoJSONIndex=B.cluster?new nt(function({superclusterOptions:Se,clusterProperties:Ee}){if(!Ee||!Se)return Se;const ye={},Re={},qe={accumulated:null,zoom:0},Ye={properties:null},Ge=Object.keys(Ee);for(const Ct of Ge){const[nn,on]=Ee[Ct],bn=h.by(on),wn=h.by(typeof nn=="string"?[nn,["accumulated"],["get",Ct]]:nn);ye[Ct]=bn.value,Re[Ct]=wn.value}return Se.map=Ct=>{Ye.properties=Ct;const nn={};for(const on of Ge)nn[on]=ye[on].evaluate(qe,Ye);return nn},Se.reduce=(Ct,nn)=>{Ye.properties=nn;for(const on of Ge)qe.accumulated=Ct[on],Ct[on]=Re[on].evaluate(qe,Ye)},Se}(B)).load(ne.features):function(Se,Ee){return new Ht(Se,Ee)}(ne,B.geojsonVtOptions),this.loaded={};const me={};if(q){const Se=q.finish();Se&&(me.resourceTiming={},me.resourceTiming[B.source]=JSON.parse(JSON.stringify(Se)))}return me}catch(ne){if(delete this._pendingRequest,h.bz(ne))return{abandoned:!0};throw ne}})}reloadTile(B){const U=this.loaded;return U&&U[B.uid]?super.reloadTile(B):this.loadTile(B)}loadGeoJSON(B,U){return h._(this,void 0,void 0,function*(){const{promoteId:q}=B;if(B.request){const ne=yield h.h(B.request,U);return this._dataUpdateable=X(ne.data,q)?Oe(ne.data,q):void 0,ne.data}if(typeof B.data=="string")try{const ne=JSON.parse(B.data);return this._dataUpdateable=X(ne,q)?Oe(ne,q):void 0,ne}catch{throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`)}if(!B.dataDiff)throw new Error(`Input data given to '${B.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${B.source}`);return function(ne,me,Se){var Ee,ye,Re,qe;if(me.removeAll&&ne.clear(),me.remove)for(const Ye of me.remove)ne.delete(Ye);if(me.add)for(const Ye of me.add){const Ge=Jt(Ye,Se);Ge!=null&&ne.set(Ge,Ye)}if(me.update)for(const Ye of me.update){let Ge=ne.get(Ye.id);if(Ge==null)continue;const Ct=!Ye.removeAllProperties&&(((Ee=Ye.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0||((ye=Ye.addOrUpdateProperties)===null||ye===void 0?void 0:ye.length)>0);if((Ye.newGeometry||Ye.removeAllProperties||Ct)&&(Ge=Object.assign({},Ge),ne.set(Ye.id,Ge),Ct&&(Ge.properties=Object.assign({},Ge.properties))),Ye.newGeometry&&(Ge.geometry=Ye.newGeometry),Ye.removeAllProperties)Ge.properties={};else if(((Re=Ye.removeProperties)===null||Re===void 0?void 0:Re.length)>0)for(const nn of Ye.removeProperties)Object.prototype.hasOwnProperty.call(Ge.properties,nn)&&delete Ge.properties[nn];if(((qe=Ye.addOrUpdateProperties)===null||qe===void 0?void 0:qe.length)>0)for(const{key:nn,value:on}of Ye.addOrUpdateProperties)Ge.properties[nn]=on}}(this._dataUpdateable,B.dataDiff,q),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(B){return h._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(B){return this._geoJSONIndex.getClusterExpansionZoom(B.clusterId)}getClusterChildren(B){return this._geoJSONIndex.getChildren(B.clusterId)}getClusterLeaves(B){return this._geoJSONIndex.getLeaves(B.clusterId,B.limit,B.offset)}}class Dt{constructor(B){this.self=B,this.actor=new h.C(B),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(U,q)=>{if(this.externalWorkerSourceTypes[U])throw new Error(`Worker source with name "${U}" already registered.`);this.externalWorkerSourceTypes[U]=q},this.self.addProtocol=h.bf,this.self.removeProtocol=h.bg,this.self.registerRTLTextPlugin=U=>{if(h.bA.isParsed())throw new Error("RTL text plugin already registered.");h.bA.setMethods(U)},this.actor.registerMessageHandler("loadDEMTile",(U,q)=>this._getDEMWorkerSource(U,q.source).loadTile(q)),this.actor.registerMessageHandler("removeDEMTile",(U,q)=>h._(this,void 0,void 0,function*(){this._getDEMWorkerSource(U,q.source).removeTile(q)})),this.actor.registerMessageHandler("getClusterExpansionZoom",(U,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(U,q.type,q.source).getClusterExpansionZoom(q)})),this.actor.registerMessageHandler("getClusterChildren",(U,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(U,q.type,q.source).getClusterChildren(q)})),this.actor.registerMessageHandler("getClusterLeaves",(U,q)=>h._(this,void 0,void 0,function*(){return this._getWorkerSource(U,q.type,q.source).getClusterLeaves(q)})),this.actor.registerMessageHandler("loadData",(U,q)=>this._getWorkerSource(U,q.type,q.source).loadData(q)),this.actor.registerMessageHandler("loadTile",(U,q)=>this._getWorkerSource(U,q.type,q.source).loadTile(q)),this.actor.registerMessageHandler("reloadTile",(U,q)=>this._getWorkerSource(U,q.type,q.source).reloadTile(q)),this.actor.registerMessageHandler("abortTile",(U,q)=>this._getWorkerSource(U,q.type,q.source).abortTile(q)),this.actor.registerMessageHandler("removeTile",(U,q)=>this._getWorkerSource(U,q.type,q.source).removeTile(q)),this.actor.registerMessageHandler("removeSource",(U,q)=>h._(this,void 0,void 0,function*(){if(!this.workerSources[U]||!this.workerSources[U][q.type]||!this.workerSources[U][q.type][q.source])return;const ne=this.workerSources[U][q.type][q.source];delete this.workerSources[U][q.type][q.source],ne.removeSource!==void 0&&ne.removeSource(q)})),this.actor.registerMessageHandler("removeMap",U=>h._(this,void 0,void 0,function*(){delete this.layerIndexes[U],delete this.availableImages[U],delete this.workerSources[U],delete this.demWorkerSources[U]})),this.actor.registerMessageHandler("setReferrer",(U,q)=>h._(this,void 0,void 0,function*(){this.referrer=q})),this.actor.registerMessageHandler("syncRTLPluginState",(U,q)=>this._syncRTLPluginState(U,q)),this.actor.registerMessageHandler("importScript",(U,q)=>h._(this,void 0,void 0,function*(){this.self.importScripts(q)})),this.actor.registerMessageHandler("setImages",(U,q)=>this._setImages(U,q)),this.actor.registerMessageHandler("updateLayers",(U,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(U).update(q.layers,q.removedIds)})),this.actor.registerMessageHandler("setLayers",(U,q)=>h._(this,void 0,void 0,function*(){this._getLayerIndex(U).replace(q)}))}_setImages(B,U){return h._(this,void 0,void 0,function*(){this.availableImages[B]=U;for(const q in this.workerSources[B]){const ne=this.workerSources[B][q];for(const me in ne)ne[me].availableImages=U}})}_syncRTLPluginState(B,U){return h._(this,void 0,void 0,function*(){if(h.bA.isParsed())return h.bA.getState();if(U.pluginStatus!=="loading")return h.bA.setState(U),U;const q=U.pluginURL;if(this.self.importScripts(q),h.bA.isParsed()){const ne={pluginStatus:"loaded",pluginURL:q};return h.bA.setState(ne),ne}throw h.bA.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${q}`)})}_getAvailableImages(B){let U=this.availableImages[B];return U||(U=[]),U}_getLayerIndex(B){let U=this.layerIndexes[B];return U||(U=this.layerIndexes[B]=new o),U}_getWorkerSource(B,U,q){if(this.workerSources[B]||(this.workerSources[B]={}),this.workerSources[B][U]||(this.workerSources[B][U]={}),!this.workerSources[B][U][q]){const ne={sendAsync:(me,Se)=>(me.targetMapId=B,this.actor.sendAsync(me,Se))};switch(U){case"vector":this.workerSources[B][U][q]=new M(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;case"geojson":this.workerSources[B][U][q]=new pt(ne,this._getLayerIndex(B),this._getAvailableImages(B));break;default:this.workerSources[B][U][q]=new this.externalWorkerSourceTypes[U](ne,this._getLayerIndex(B),this._getAvailableImages(B))}}return this.workerSources[B][U][q]}_getDEMWorkerSource(B,U){return this.demWorkerSources[B]||(this.demWorkerSources[B]={}),this.demWorkerSources[B][U]||(this.demWorkerSources[B][U]=new S),this.demWorkerSources[B][U]}}return h.i(self)&&(self.worker=new Dt(self)),Dt}),r("index",["exports","./shared"],function(h,o){var p="4.1.2";let v,x;const M={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:_=>new Promise((s,d)=>{const m=requestAnimationFrame(s);_.signal.addEventListener("abort",()=>{cancelAnimationFrame(m),d(o.c())})}),getImageData(_,s=0){return this.getImageCanvasContext(_).getImageData(-s,-s,_.width+2*s,_.height+2*s)},getImageCanvasContext(_){const s=window.document.createElement("canvas"),d=s.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return s.width=_.width,s.height=_.height,d.drawImage(_,0,0,_.width,_.height),d},resolveURL:_=>(v||(v=document.createElement("a")),v.href=_,v.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(x==null&&(x=matchMedia("(prefers-reduced-motion: reduce)")),x.matches)}};class S{static testProp(s){if(!S.docStyle)return s[0];for(let d=0;d<s.length;d++)if(s[d]in S.docStyle)return s[d];return s[0]}static create(s,d,m){const g=window.document.createElement(s);return d!==void 0&&(g.className=d),m&&m.appendChild(g),g}static createNS(s,d){return window.document.createElementNS(s,d)}static disableDrag(){S.docStyle&&S.selectProp&&(S.userSelect=S.docStyle[S.selectProp],S.docStyle[S.selectProp]="none")}static enableDrag(){S.docStyle&&S.selectProp&&(S.docStyle[S.selectProp]=S.userSelect)}static setTransform(s,d){s.style[S.transformProp]=d}static addEventListener(s,d,m,g={}){s.addEventListener(d,m,"passive"in g?g:g.capture)}static removeEventListener(s,d,m,g={}){s.removeEventListener(d,m,"passive"in g?g:g.capture)}static suppressClickInternal(s){s.preventDefault(),s.stopPropagation(),window.removeEventListener("click",S.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",S.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",S.suppressClickInternal,!0)},0)}static getScale(s){const d=s.getBoundingClientRect();return{x:d.width/s.offsetWidth||1,y:d.height/s.offsetHeight||1,boundingClientRect:d}}static getPoint(s,d,m){const g=d.boundingClientRect;return new o.P((m.clientX-g.left)/d.x-s.clientLeft,(m.clientY-g.top)/d.y-s.clientTop)}static mousePos(s,d){const m=S.getScale(s);return S.getPoint(s,m,d)}static touchPos(s,d){const m=[],g=S.getScale(s);for(let b=0;b<d.length;b++)m.push(S.getPoint(s,g,d[b]));return m}static mouseButton(s){return s.button}static remove(s){s.parentNode&&s.parentNode.removeChild(s)}}S.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,S.selectProp=S.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),S.transformProp=S.testProp(["transform","WebkitTransform"]);const A={supported:!1,testSupport:function(_){!k&&F&&(C?V(_):L=_)}};let L,F,k=!1,C=!1;function V(_){const s=_.createTexture();_.bindTexture(_.TEXTURE_2D,s);try{if(_.texImage2D(_.TEXTURE_2D,0,_.RGBA,_.RGBA,_.UNSIGNED_BYTE,F),_.isContextLost())return;A.supported=!0}catch{}_.deleteTexture(s),k=!0}var O,J;typeof document<"u"&&(F=document.createElement("img"),F.onload=function(){L&&V(L),L=null,C=!0},F.onerror=function(){k=!0,L=null},F.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(_){let s,d,m,g;_.resetRequestQueue=()=>{s=[],d=0,m=0,g={}},_.addThrottleControl=D=>{const H=m++;return g[H]=D,H},_.removeThrottleControl=D=>{delete g[D],P()},_.getImage=(D,H,$=!0)=>new Promise((Z,se)=>{A.supported&&(D.headers||(D.headers={}),D.headers.accept="image/webp,*/*"),o.e(D,{type:"image"}),s.push({abortController:H,requestParameters:D,supportImageRefresh:$,state:"queued",onError:_e=>{se(_e)},onSuccess:_e=>{Z(_e)}}),P()});const b=D=>o._(this,void 0,void 0,function*(){D.state="running";const{requestParameters:H,supportImageRefresh:$,onError:Z,onSuccess:se,abortController:_e}=D,ve=$===!1&&!o.i(self)&&!o.g(H.url)&&(!H.headers||Object.keys(H.headers).reduce((ze,$e)=>ze&&$e==="accept",!0));d++;const we=ve?R(H,_e):o.m(H,_e);try{const ze=yield we;delete D.abortController,D.state="completed",ze.data instanceof HTMLImageElement||o.b(ze.data)?se(ze):ze.data&&se({data:yield(fe=ze.data,typeof createImageBitmap=="function"?o.d(fe):o.f(fe)),cacheControl:ze.cacheControl,expires:ze.expires})}catch(ze){delete D.abortController,Z(ze)}finally{d--,P()}var fe}),P=()=>{const D=(()=>{for(const H of Object.keys(g))if(g[H]())return!0;return!1})()?o.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:o.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let H=d;H<D&&s.length>0;H++){const $=s.shift();$.abortController.signal.aborted?H--:b($)}},R=(D,H)=>new Promise(($,Z)=>{const se=new Image,_e=D.url,ve=D.credentials;ve&&ve==="include"?se.crossOrigin="use-credentials":(ve&&ve==="same-origin"||!o.s(_e))&&(se.crossOrigin="anonymous"),H.signal.addEventListener("abort",()=>{se.src="",Z(o.c())}),se.fetchPriority="high",se.onload=()=>{se.onerror=se.onload=null,$({data:se})},se.onerror=()=>{se.onerror=se.onload=null,H.signal.aborted||Z(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},se.src=_e})}(O||(O={})),O.resetRequestQueue(),function(_){_.Glyphs="Glyphs",_.Image="Image",_.Source="Source",_.SpriteImage="SpriteImage",_.SpriteJSON="SpriteJSON",_.Style="Style",_.Tile="Tile",_.Unknown="Unknown"}(J||(J={}));class ue{constructor(s){this._transformRequestFn=s}transformRequest(s,d){return this._transformRequestFn&&this._transformRequestFn(s,d)||{url:s}}normalizeSpriteURL(s,d,m){const g=function(b){const P=b.match(Y);if(!P)throw new Error(`Unable to parse URL "${b}"`);return{protocol:P[1],authority:P[2],path:P[3]||"/",params:P[4]?P[4].split("&"):[]}}(s);return g.path+=`${d}${m}`,function(b){const P=b.params.length?`?${b.params.join("&")}`:"";return`${b.protocol}://${b.authority}${b.path}${P}`}(g)}setTransformRequest(s){this._transformRequestFn=s}}const Y=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(_){var s=new o.A(3);return s[0]=_[0],s[1]=_[1],s[2]=_[2],s}var xe,re=function(_,s,d){return _[0]=s[0]-d[0],_[1]=s[1]-d[1],_[2]=s[2]-d[2],_};xe=new o.A(3),o.A!=Float32Array&&(xe[0]=0,xe[1]=0,xe[2]=0);var ee=function(_){var s=_[0],d=_[1];return s*s+d*d};function Me(_){const s=[];if(typeof _=="string")s.push({id:"default",url:_});else if(_&&_.length>0){const d=[];for(const{id:m,url:g}of _){const b=`${m}${g}`;d.indexOf(b)===-1&&(d.push(b),s.push({id:m,url:g}))}}return s}(function(){var _=new o.A(2);o.A!=Float32Array&&(_[0]=0,_[1]=0)})();class Fe{constructor(s,d,m,g){this.context=s,this.format=m,this.texture=s.gl.createTexture(),this.update(d,g)}update(s,d,m){const{width:g,height:b}=s,P=!(this.size&&this.size[0]===g&&this.size[1]===b||m),{context:R}=this,{gl:D}=R;if(this.useMipmap=!!(d&&d.useMipmap),D.bindTexture(D.TEXTURE_2D,this.texture),R.pixelStoreUnpackFlipY.set(!1),R.pixelStoreUnpack.set(1),R.pixelStoreUnpackPremultiplyAlpha.set(this.format===D.RGBA&&(!d||d.premultiply!==!1)),P)this.size=[g,b],s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.b(s)?D.texImage2D(D.TEXTURE_2D,0,this.format,this.format,D.UNSIGNED_BYTE,s):D.texImage2D(D.TEXTURE_2D,0,this.format,g,b,0,this.format,D.UNSIGNED_BYTE,s.data);else{const{x:H,y:$}=m||{x:0,y:0};s instanceof HTMLImageElement||s instanceof HTMLCanvasElement||s instanceof HTMLVideoElement||s instanceof ImageData||o.b(s)?D.texSubImage2D(D.TEXTURE_2D,0,H,$,D.RGBA,D.UNSIGNED_BYTE,s):D.texSubImage2D(D.TEXTURE_2D,0,H,$,g,b,D.RGBA,D.UNSIGNED_BYTE,s.data)}this.useMipmap&&this.isSizePowerOfTwo()&&D.generateMipmap(D.TEXTURE_2D)}bind(s,d,m){const{context:g}=this,{gl:b}=g;b.bindTexture(b.TEXTURE_2D,this.texture),m!==b.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(m=b.LINEAR),s!==this.filter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,s),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,m||s),this.filter=s),d!==this.wrap&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,d),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,d),this.wrap=d)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}}function Ae(_){const{userImage:s}=_;return!!(s&&s.render&&s.render())&&(_.data.replace(new Uint8Array(s.data.buffer)),!0)}class He extends o.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new o.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(s){if(this.loaded!==s&&(this.loaded=s,s)){for(const{ids:d,promiseResolve:m}of this.requestors)m(this._getImagesForIds(d));this.requestors=[]}}getImage(s){const d=this.images[s];if(d&&!d.data&&d.spriteData){const m=d.spriteData;d.data=new o.R({width:m.width,height:m.height},m.context.getImageData(m.x,m.y,m.width,m.height).data),d.spriteData=null}return d}addImage(s,d){if(this.images[s])throw new Error(`Image id ${s} already exist, use updateImage instead`);this._validate(s,d)&&(this.images[s]=d)}_validate(s,d){let m=!0;const g=d.data||d.spriteData;return this._validateStretch(d.stretchX,g&&g.width)||(this.fire(new o.j(new Error(`Image "${s}" has invalid "stretchX" value`))),m=!1),this._validateStretch(d.stretchY,g&&g.height)||(this.fire(new o.j(new Error(`Image "${s}" has invalid "stretchY" value`))),m=!1),this._validateContent(d.content,d)||(this.fire(new o.j(new Error(`Image "${s}" has invalid "content" value`))),m=!1),m}_validateStretch(s,d){if(!s)return!0;let m=0;for(const g of s){if(g[0]<m||g[1]<g[0]||d<g[1])return!1;m=g[1]}return!0}_validateContent(s,d){if(!s)return!0;if(s.length!==4)return!1;const m=d.spriteData,g=m&&m.width||d.data.width,b=m&&m.height||d.data.height;return!(s[0]<0||g<s[0]||s[1]<0||b<s[1]||s[2]<0||g<s[2]||s[3]<0||b<s[3]||s[2]<s[0]||s[3]<s[1])}updateImage(s,d,m=!0){const g=this.getImage(s);if(m&&(g.data.width!==d.data.width||g.data.height!==d.data.height))throw new Error(`size mismatch between old image (${g.data.width}x${g.data.height}) and new image (${d.data.width}x${d.data.height}).`);d.version=g.version+1,this.images[s]=d,this.updatedImages[s]=!0}removeImage(s){const d=this.images[s];delete this.images[s],delete this.patterns[s],d.userImage&&d.userImage.onRemove&&d.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(s){return new Promise((d,m)=>{let g=!0;if(!this.isLoaded())for(const b of s)this.images[b]||(g=!1);this.isLoaded()||g?d(this._getImagesForIds(s)):this.requestors.push({ids:s,promiseResolve:d})})}_getImagesForIds(s){const d={};for(const m of s){let g=this.getImage(m);g||(this.fire(new o.k("styleimagemissing",{id:m})),g=this.getImage(m)),g?d[m]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:!!(g.userImage&&g.userImage.render)}:o.w(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return d}getPixelSize(){const{width:s,height:d}=this.atlasImage;return{width:s,height:d}}getPattern(s){const d=this.patterns[s],m=this.getImage(s);if(!m)return null;if(d&&d.position.version===m.version)return d.position;if(d)d.position.version=m.version;else{const g={w:m.data.width+2,h:m.data.height+2,x:0,y:0},b=new o.I(g,m);this.patterns[s]={bin:g,position:b}}return this._updatePatternAtlas(),this.patterns[s].position}bind(s){const d=s.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new Fe(s,this.atlasImage,d.RGBA),this.atlasTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(){const s=[];for(const b in this.patterns)s.push(this.patterns[b].bin);const{w:d,h:m}=o.p(s),g=this.atlasImage;g.resize({width:d||1,height:m||1});for(const b in this.patterns){const{bin:P}=this.patterns[b],R=P.x+1,D=P.y+1,H=this.getImage(b).data,$=H.width,Z=H.height;o.R.copy(H,g,{x:0,y:0},{x:R,y:D},{width:$,height:Z}),o.R.copy(H,g,{x:0,y:Z-1},{x:R,y:D-1},{width:$,height:1}),o.R.copy(H,g,{x:0,y:0},{x:R,y:D+Z},{width:$,height:1}),o.R.copy(H,g,{x:$-1,y:0},{x:R-1,y:D},{width:1,height:Z}),o.R.copy(H,g,{x:0,y:0},{x:R+$,y:D},{width:1,height:Z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(s){for(const d of s){if(this.callbackDispatchedThisFrame[d])continue;this.callbackDispatchedThisFrame[d]=!0;const m=this.getImage(d);m||o.w(`Image with ID: "${d}" was not found`),Ae(m)&&this.updateImage(d,m)}}}const ot=1e20;function ft(_,s,d,m,g,b,P,R,D){for(let H=s;H<s+m;H++)ct(_,d*b+H,b,g,P,R,D);for(let H=d;H<d+g;H++)ct(_,H*b+s,1,m,P,R,D)}function ct(_,s,d,m,g,b,P){b[0]=0,P[0]=-ot,P[1]=ot,g[0]=_[s];for(let R=1,D=0,H=0;R<m;R++){g[R]=_[s+R*d];const $=R*R;do{const Z=b[D];H=(g[R]-g[Z]+$-Z*Z)/(R-Z)/2}while(H<=P[D]&&--D>-1);D++,b[D]=R,P[D]=H,P[D+1]=ot}for(let R=0,D=0;R<m;R++){for(;P[D+1]<R;)D++;const H=b[D],$=R-H;_[s+R*d]=g[H]+$*$}}class De{constructor(s,d){this.requestManager=s,this.localIdeographFontFamily=d,this.entries={}}setURL(s){this.url=s}getGlyphs(s){return o._(this,void 0,void 0,function*(){const d=[];for(const b in s)for(const P of s[b])d.push(this._getAndCacheGlyphsPromise(b,P));const m=yield Promise.all(d),g={};for(const{stack:b,id:P,glyph:R}of m)g[b]||(g[b]={}),g[b][P]=R&&{id:R.id,bitmap:R.bitmap.clone(),metrics:R.metrics};return g})}_getAndCacheGlyphsPromise(s,d){return o._(this,void 0,void 0,function*(){let m=this.entries[s];m||(m=this.entries[s]={glyphs:{},requests:{},ranges:{}});let g=m.glyphs[d];if(g!==void 0)return{stack:s,id:d,glyph:g};if(g=this._tinySDF(m,s,d),g)return m.glyphs[d]=g,{stack:s,id:d,glyph:g};const b=Math.floor(d/256);if(256*b>65535)throw new Error("glyphs > 65535 not supported");if(m.ranges[b])return{stack:s,id:d,glyph:g};if(!this.url)throw new Error("glyphsUrl is not set");if(!m.requests[b]){const R=De.loadGlyphRange(s,b,this.url,this.requestManager);m.requests[b]=R}const P=yield m.requests[b];for(const R in P)this._doesCharSupportLocalGlyph(+R)||(m.glyphs[+R]=P[+R]);return m.ranges[b]=!0,{stack:s,id:d,glyph:P[d]||null}})}_doesCharSupportLocalGlyph(s){return!!this.localIdeographFontFamily&&(o.u["CJK Unified Ideographs"](s)||o.u["Hangul Syllables"](s)||o.u.Hiragana(s)||o.u.Katakana(s))}_tinySDF(s,d,m){const g=this.localIdeographFontFamily;if(!g||!this._doesCharSupportLocalGlyph(m))return;let b=s.tinySDF;if(!b){let R="400";/bold/i.test(d)?R="900":/medium/i.test(d)?R="500":/light/i.test(d)&&(R="200"),b=s.tinySDF=new De.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:g,fontWeight:R})}const P=b.draw(String.fromCharCode(m));return{id:m,bitmap:new o.o({width:P.width||60,height:P.height||60},P.data),metrics:{width:P.glyphWidth/2||24,height:P.glyphHeight/2||24,left:P.glyphLeft/2+.5||0,top:P.glyphTop/2-27.5||-8,advance:P.glyphAdvance/2||24,isDoubleResolution:!0}}}}De.loadGlyphRange=function(_,s,d,m){return o._(this,void 0,void 0,function*(){const g=256*s,b=g+255,P=m.transformRequest(d.replace("{fontstack}",_).replace("{range}",`${g}-${b}`),J.Glyphs),R=yield o.l(P,new AbortController);if(!R||!R.data)throw new Error(`Could not load glyph range. range: ${s}, ${g}-${b}`);const D={};for(const H of o.n(R.data))D[H.id]=H;return D})},De.TinySDF=class{constructor({fontSize:_=24,buffer:s=3,radius:d=8,cutoff:m=.25,fontFamily:g="sans-serif",fontWeight:b="normal",fontStyle:P="normal"}={}){this.buffer=s,this.cutoff=m,this.radius=d;const R=this.size=_+4*s,D=this._createCanvas(R),H=this.ctx=D.getContext("2d",{willReadFrequently:!0});H.font=`${P} ${b} ${_}px ${g}`,H.textBaseline="alphabetic",H.textAlign="left",H.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}_createCanvas(_){const s=document.createElement("canvas");return s.width=s.height=_,s}draw(_){const{width:s,actualBoundingBoxAscent:d,actualBoundingBoxDescent:m,actualBoundingBoxLeft:g,actualBoundingBoxRight:b}=this.ctx.measureText(_),P=Math.ceil(d),R=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(b-g))),D=Math.min(this.size-this.buffer,P+Math.ceil(m)),H=R+2*this.buffer,$=D+2*this.buffer,Z=Math.max(H*$,0),se=new Uint8ClampedArray(Z),_e={data:se,width:H,height:$,glyphWidth:R,glyphHeight:D,glyphTop:P,glyphLeft:0,glyphAdvance:s};if(R===0||D===0)return _e;const{ctx:ve,buffer:we,gridInner:fe,gridOuter:ze}=this;ve.clearRect(we,we,R,D),ve.fillText(_,we,we+P);const $e=ve.getImageData(we,we,R,D);ze.fill(ot,0,Z),fe.fill(0,0,Z);for(let Te=0;Te<D;Te++)for(let Be=0;Be<R;Be++){const Ke=$e.data[4*(Te*R+Be)+3]/255;if(Ke===0)continue;const Qe=(Te+we)*H+Be+we;if(Ke===1)ze[Qe]=0,fe[Qe]=ot;else{const lt=.5-Ke;ze[Qe]=lt>0?lt*lt:0,fe[Qe]=lt<0?lt*lt:0}}ft(ze,0,0,H,$,H,this.f,this.v,this.z),ft(fe,we,we,R,D,H,this.f,this.v,this.z);for(let Te=0;Te<Z;Te++){const Be=Math.sqrt(ze[Te])-Math.sqrt(fe[Te]);se[Te]=Math.round(255-255*(Be/this.radius+this.cutoff))}return _e}};class Je{constructor(){this.specification=o.v.light.position}possiblyEvaluate(s,d){return o.y(s.expression.evaluate(d))}interpolate(s,d,m){return{x:o.z.number(s.x,d.x,m),y:o.z.number(s.y,d.y,m),z:o.z.number(s.z,d.z,m)}}}let tt;class _t extends o.E{constructor(s){super(),tt=tt||new o.q({anchor:new o.D(o.v.light.anchor),position:new Je,color:new o.D(o.v.light.color),intensity:new o.D(o.v.light.intensity)}),this._transitionable=new o.T(tt),this.setLight(s),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(s,d={}){if(!this._validate(o.r,s,d))for(const m in s){const g=s[m];m.endsWith("-transition")?this._transitionable.setTransition(m.slice(0,-11),g):this._transitionable.setValue(m,g)}}updateTransitions(s){this._transitioning=this._transitionable.transitioned(s,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(s){this.properties=this._transitioning.possiblyEvaluate(s)}_validate(s,d,m){return(!m||m.validate!==!1)&&o.t(this,s.call(o.x,{value:d,style:{glyphs:!0,sprite:!0},styleSpec:o.v}))}}class Lt{constructor(s,d){this.width=s,this.height=d,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(s,d){const m=s.join(",")+String(d);return this.dashEntry[m]||(this.dashEntry[m]=this.addDash(s,d)),this.dashEntry[m]}getDashRanges(s,d,m){const g=[];let b=s.length%2==1?-s[s.length-1]*m:0,P=s[0]*m,R=!0;g.push({left:b,right:P,isDash:R,zeroLength:s[0]===0});let D=s[0];for(let H=1;H<s.length;H++){R=!R;const $=s[H];b=D*m,D+=$,P=D*m,g.push({left:b,right:P,isDash:R,zeroLength:$===0})}return g}addRoundDash(s,d,m){const g=d/2;for(let b=-m;b<=m;b++){const P=this.width*(this.nextRow+m+b);let R=0,D=s[R];for(let H=0;H<this.width;H++){H/D.right>1&&(D=s[++R]);const $=Math.abs(H-D.left),Z=Math.abs(H-D.right),se=Math.min($,Z);let _e;const ve=b/m*(g+1);if(D.isDash){const we=g-Math.abs(ve);_e=Math.sqrt(se*se+we*we)}else _e=g-Math.sqrt(se*se+ve*ve);this.data[P+H]=Math.max(0,Math.min(255,_e+128))}}}addRegularDash(s){for(let R=s.length-1;R>=0;--R){const D=s[R],H=s[R+1];D.zeroLength?s.splice(R,1):H&&H.isDash===D.isDash&&(H.left=D.left,s.splice(R,1))}const d=s[0],m=s[s.length-1];d.isDash===m.isDash&&(d.left=m.left-this.width,m.right=d.right+this.width);const g=this.width*this.nextRow;let b=0,P=s[b];for(let R=0;R<this.width;R++){R/P.right>1&&(P=s[++b]);const D=Math.abs(R-P.left),H=Math.abs(R-P.right),$=Math.min(D,H);this.data[g+R]=Math.max(0,Math.min(255,(P.isDash?$:-$)+128))}}addDash(s,d){const m=d?7:0,g=2*m+1;if(this.nextRow+g>this.height)return o.w("LineAtlas out of space"),null;let b=0;for(let R=0;R<s.length;R++)b+=s[R];if(b!==0){const R=this.width/b,D=this.getDashRanges(s,this.width,R);d?this.addRoundDash(D,R,m):this.addRegularDash(D)}const P={y:(this.nextRow+m+.5)/this.height,height:2*m/this.height,width:b};return this.nextRow+=g,this.dirty=!0,P}bind(s){const d=s.gl;this.texture?(d.bindTexture(d.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,d.texSubImage2D(d.TEXTURE_2D,0,0,0,this.width,this.height,d.ALPHA,d.UNSIGNED_BYTE,this.data))):(this.texture=d.createTexture(),d.bindTexture(d.TEXTURE_2D,this.texture),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,d.REPEAT),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,d.LINEAR),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,d.LINEAR),d.texImage2D(d.TEXTURE_2D,0,d.ALPHA,this.width,this.height,0,d.ALPHA,d.UNSIGNED_BYTE,this.data))}}const Cn="maplibre_preloaded_worker_pool";class nt{constructor(){this.active={}}acquire(s){if(!this.workers)for(this.workers=[];this.workers.length<nt.workerCount;)this.workers.push(new Worker(o.a.WORKER_URL));return this.active[s]=!0,this.workers.slice()}release(s){delete this.active[s],this.numActive()===0&&(this.workers.forEach(d=>{d.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Cn]}numActive(){return Object.keys(this.active).length}}const wt=Math.floor(M.hardwareConcurrency/2);let Ft,At;function gn(){return Ft||(Ft=new nt),Ft}nt.workerCount=o.B(globalThis)?Math.max(Math.min(wt,3),1):1;class En{constructor(s,d){this.workerPool=s,this.actors=[],this.currentActor=0,this.id=d;const m=this.workerPool.acquire(d);for(let g=0;g<m.length;g++){const b=new o.C(m[g],d);b.name=`Worker ${g}`,this.actors.push(b)}if(!this.actors.length)throw new Error("No actors found")}broadcast(s,d){const m=[];for(const g of this.actors)m.push(g.sendAsync({type:s,data:d}));return Promise.all(m)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(s=!0){this.actors.forEach(d=>{d.remove()}),this.actors=[],s&&this.workerPool.release(this.id)}registerMessageHandler(s,d){for(const m of this.actors)m.registerMessageHandler(s,d)}}function In(){return At||(At=new En(gn(),o.G),At.registerMessageHandler("getResource",(_,s,d)=>o.m(s,d))),At}function je(_,s){const d=o.F();return o.H(d,d,[1,1,0]),o.J(d,d,[.5*_.width,.5*_.height,1]),o.K(d,d,_.calculatePosMatrix(s.toUnwrapped()))}function An(_,s,d,m,g,b){const P=function(Z,se,_e){if(Z)for(const ve of Z){const we=se[ve];if(we&&we.source===_e&&we.type==="fill-extrusion")return!0}else for(const ve in se){const we=se[ve];if(we.source===_e&&we.type==="fill-extrusion")return!0}return!1}(g&&g.layers,s,_.id),R=b.maxPitchScaleFactor(),D=_.tilesIn(m,R,P);D.sort(yn);const H=[];for(const Z of D)H.push({wrappedTileID:Z.tileID.wrapped().key,queryResults:Z.tile.queryRenderedFeatures(s,d,_._state,Z.queryGeometry,Z.cameraQueryGeometry,Z.scale,g,b,R,je(_.transform,Z.tileID))});const $=function(Z){const se={},_e={};for(const ve of Z){const we=ve.queryResults,fe=ve.wrappedTileID,ze=_e[fe]=_e[fe]||{};for(const $e in we){const Te=we[$e],Be=ze[$e]=ze[$e]||{},Ke=se[$e]=se[$e]||[];for(const Qe of Te)Be[Qe.featureIndex]||(Be[Qe.featureIndex]=!0,Ke.push(Qe))}}return se}(H);for(const Z in $)$[Z].forEach(se=>{const _e=se.feature,ve=_.getFeatureState(_e.layer["source-layer"],_e.id);_e.source=_e.layer.source,_e.layer["source-layer"]&&(_e.sourceLayer=_e.layer["source-layer"]),_e.state=ve});return $}function yn(_,s){const d=_.tileID,m=s.tileID;return d.overscaledZ-m.overscaledZ||d.canonical.y-m.canonical.y||d.wrap-m.wrap||d.canonical.x-m.canonical.x}function Qn(_,s,d){return o._(this,void 0,void 0,function*(){let m=_;if(_.url?m=(yield o.h(s.transformRequest(_.url,J.Source),d)).data:yield M.frameAsync(d),!m)return null;const g=o.L(o.e(m,_),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in m&&m.vector_layers&&(g.vectorLayerIds=m.vector_layers.map(b=>b.id)),g})}class Yt{constructor(s,d){s&&(d?this.setSouthWest(s).setNorthEast(d):Array.isArray(s)&&(s.length===4?this.setSouthWest([s[0],s[1]]).setNorthEast([s[2],s[3]]):this.setSouthWest(s[0]).setNorthEast(s[1])))}setNorthEast(s){return this._ne=s instanceof o.M?new o.M(s.lng,s.lat):o.M.convert(s),this}setSouthWest(s){return this._sw=s instanceof o.M?new o.M(s.lng,s.lat):o.M.convert(s),this}extend(s){const d=this._sw,m=this._ne;let g,b;if(s instanceof o.M)g=s,b=s;else{if(!(s instanceof Yt))return Array.isArray(s)?s.length===4||s.every(Array.isArray)?this.extend(Yt.convert(s)):this.extend(o.M.convert(s)):s&&("lng"in s||"lon"in s)&&"lat"in s?this.extend(o.M.convert(s)):this;if(g=s._sw,b=s._ne,!g||!b)return this}return d||m?(d.lng=Math.min(g.lng,d.lng),d.lat=Math.min(g.lat,d.lat),m.lng=Math.max(b.lng,m.lng),m.lat=Math.max(b.lat,m.lat)):(this._sw=new o.M(g.lng,g.lat),this._ne=new o.M(b.lng,b.lat)),this}getCenter(){return new o.M((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new o.M(this.getWest(),this.getNorth())}getSouthEast(){return new o.M(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(s){const{lng:d,lat:m}=o.M.convert(s);let g=this._sw.lng<=d&&d<=this._ne.lng;return this._sw.lng>this._ne.lng&&(g=this._sw.lng>=d&&d>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&g}static convert(s){return s instanceof Yt?s:s&&new Yt(s)}static fromLngLat(s,d=0){const m=360*d/40075017,g=m/Math.cos(Math.PI/180*s.lat);return new Yt(new o.M(s.lng-g,s.lat-m),new o.M(s.lng+g,s.lat+m))}}class Gn{constructor(s,d,m){this.bounds=Yt.convert(this.validateBounds(s)),this.minzoom=d||0,this.maxzoom=m||24}validateBounds(s){return Array.isArray(s)&&s.length===4?[Math.max(-180,s[0]),Math.max(-90,s[1]),Math.min(180,s[2]),Math.min(90,s[3])]:[-180,-90,180,90]}contains(s){const d=Math.pow(2,s.z),m=Math.floor(o.N(this.bounds.getWest())*d),g=Math.floor(o.O(this.bounds.getNorth())*d),b=Math.ceil(o.N(this.bounds.getEast())*d),P=Math.ceil(o.O(this.bounds.getSouth())*d);return s.x>=m&&s.x<b&&s.y>=g&&s.y<P}}class ie extends o.E{constructor(s,d,m,g){if(super(),this.id=s,this.dispatcher=m,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.e(this,o.L(d,["url","scheme","tileSize","promoteId"])),this._options=o.e({type:"vector"},d),this._collectResourceTiming=d.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g)}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),s&&(o.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new o.j(s))}})}loaded(){return this._loaded}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}onAdd(s){this.map=s,this.load()}setSourceProperty(s){this._tileJSONRequest&&this._tileJSONRequest.abort(),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return o.e({},this._options)}loadTile(s){return o._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(d,J.Tile),uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,tileSize:this.tileSize*s.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};m.request.collectResourceTiming=this._collectResourceTiming;let g="reloadTile";if(s.actor&&s.state!=="expired"){if(s.state==="loading")return new Promise((b,P)=>{s.reloadPromise={resolve:b,reject:P}})}else s.actor=this.dispatcher.getActor(),g="loadTile";s.abortController=new AbortController;try{const b=yield s.actor.sendAsync({type:g,data:m},s.abortController);if(delete s.abortController,s.aborted)return;this._afterTileLoadWorkerResponse(s,b)}catch(b){if(delete s.abortController,s.aborted)return;if(b&&b.status!==404)throw b;this._afterTileLoadWorkerResponse(s,null)}})}_afterTileLoadWorkerResponse(s,d){if(d&&d.resourceTiming&&(s.resourceTiming=d.resourceTiming),d&&this.map._refreshExpiredTiles&&s.setExpiryData(d),s.loadVectorData(d,this.map.painter),s.reloadPromise){const m=s.reloadPromise;s.reloadPromise=null,this.loadTile(s).then(m.resolve).catch(m.reject)}}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.actor&&(yield s.actor.sendAsync({type:"abortTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.unloadVectorData(),s.actor&&(yield s.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class le extends o.E{constructor(s,d,m,g){super(),this.id=s,this.dispatcher=m,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.e({type:"raster"},d),o.e(this,o.L(d,["url","scheme","tileSize"]))}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const s=yield Qn(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,s&&(o.e(this,s),s.bounds&&(this.tileBounds=new Gn(s.bounds,this.minzoom,this.maxzoom)),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})))}catch(s){this._tileJSONRequest=null,this.fire(new o.j(s))}})}loaded(){return this._loaded}onAdd(s){this.map=s,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(s){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),s(),this.load()}setTiles(s){return this.setSourceProperty(()=>{this._options.tiles=s}),this}setUrl(s){return this.setSourceProperty(()=>{this.url=s,this._options.url=s}),this}serialize(){return o.e({},this._options)}hasTile(s){return!this.tileBounds||this.tileBounds.contains(s.canonical)}loadTile(s){return o._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);s.abortController=new AbortController;try{const m=yield O.getImage(this.map._requestManager.transformRequest(d,J.Tile),s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(m&&m.data){this.map._refreshExpiredTiles&&m.cacheControl&&m.expires&&s.setExpiryData({cacheControl:m.cacheControl,expires:m.expires});const g=this.map.painter.context,b=g.gl,P=m.data;s.texture=this.map.painter.getTileTexture(P.width),s.texture?s.texture.update(P,{useMipmap:!0}):(s.texture=new Fe(g,P,b.RGBA,{useMipmap:!0}),s.texture.bind(b.LINEAR,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),g.extTextureFilterAnisotropic&&b.texParameterf(b.TEXTURE_2D,g.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,g.extTextureFilterAnisotropicMax)),s.state="loaded"}}catch(m){if(delete s.abortController,s.aborted)s.state="unloaded";else if(m)throw s.state="errored",m}})}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController)})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.texture&&this.map.painter.saveTileTexture(s.texture)})}hasTransition(){return!1}}class st extends le{constructor(s,d,m,g){super(s,d,m,g),this.type="raster-dem",this.maxzoom=22,this._options=o.e({type:"raster-dem"},d),this.encoding=d.encoding||"mapbox",this.redFactor=d.redFactor,this.greenFactor=d.greenFactor,this.blueFactor=d.blueFactor,this.baseShift=d.baseShift}loadTile(s){return o._(this,void 0,void 0,function*(){const d=s.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m=this.map._requestManager.transformRequest(d,J.Tile);s.neighboringTiles=this._getNeighboringTiles(s.tileID),s.abortController=new AbortController;try{const g=yield O.getImage(m,s.abortController,this.map._refreshExpiredTiles);if(delete s.abortController,s.aborted)return void(s.state="unloaded");if(g&&g.data){const b=g.data;this.map._refreshExpiredTiles&&g.cacheControl&&g.expires&&s.setExpiryData({cacheControl:g.cacheControl,expires:g.expires});const P=o.b(b)&&o.S()?b:yield this.readImageNow(b),R={type:this.type,uid:s.uid,source:this.id,rawImageData:P,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!s.actor||s.state==="expired"){s.actor=this.dispatcher.getActor();const D=yield s.actor.sendAsync({type:"loadDEMTile",data:R});s.dem=D,s.needsHillshadePrepare=!0,s.needsTerrainPrepare=!0,s.state="loaded"}}}catch(g){if(delete s.abortController,s.aborted)s.state="unloaded";else if(g)throw s.state="errored",g}})}readImageNow(s){return o._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&o.U()){const d=s.width+2,m=s.height+2;try{return new o.R({width:d,height:m},yield o.V(s,-1,-1,d,m))}catch{}}return M.getImageData(s,1)})}_getNeighboringTiles(s){const d=s.canonical,m=Math.pow(2,d.z),g=(d.x-1+m)%m,b=d.x===0?s.wrap-1:s.wrap,P=(d.x+1+m)%m,R=d.x+1===m?s.wrap+1:s.wrap,D={};return D[new o.Q(s.overscaledZ,b,d.z,g,d.y).key]={backfilled:!1},D[new o.Q(s.overscaledZ,R,d.z,P,d.y).key]={backfilled:!1},d.y>0&&(D[new o.Q(s.overscaledZ,b,d.z,g,d.y-1).key]={backfilled:!1},D[new o.Q(s.overscaledZ,s.wrap,d.z,d.x,d.y-1).key]={backfilled:!1},D[new o.Q(s.overscaledZ,R,d.z,P,d.y-1).key]={backfilled:!1}),d.y+1<m&&(D[new o.Q(s.overscaledZ,b,d.z,g,d.y+1).key]={backfilled:!1},D[new o.Q(s.overscaledZ,s.wrap,d.z,d.x,d.y+1).key]={backfilled:!1},D[new o.Q(s.overscaledZ,R,d.z,P,d.y+1).key]={backfilled:!1}),D}unloadTile(s){return o._(this,void 0,void 0,function*(){s.demTexture&&this.map.painter.saveTileTexture(s.demTexture),s.fbo&&(s.fbo.destroy(),delete s.fbo),s.dem&&delete s.dem,delete s.neighboringTiles,s.state="unloaded",s.actor&&(yield s.actor.sendAsync({type:"removeDEMTile",data:{type:this.type,uid:s.uid,source:this.id}}))})}}class rt extends o.E{constructor(s,d,m,g){super(),this.id=s,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=m.getActor(),this.setEventedParent(g),this._data=d.data,this._options=o.e({},d),this._collectResourceTiming=d.collectResourceTiming,d.maxzoom!==void 0&&(this.maxzoom=d.maxzoom),d.type&&(this.type=d.type),d.attribution&&(this.attribution=d.attribution),this.promoteId=d.promoteId;const b=o.W/this.tileSize;this.workerOptions=o.e({source:this.id,cluster:d.cluster||!1,geojsonVtOptions:{buffer:(d.buffer!==void 0?d.buffer:128)*b,tolerance:(d.tolerance!==void 0?d.tolerance:.375)*b,extent:o.W,maxZoom:this.maxzoom,lineMetrics:d.lineMetrics||!1,generateId:d.generateId||!1},superclusterOptions:{maxZoom:d.clusterMaxZoom!==void 0?d.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,d.clusterMinPoints||2),extent:o.W,radius:(d.clusterRadius||50)*b,log:!1,generateId:d.generateId||!1},clusterProperties:d.clusterProperties,filter:d.filter},d.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return o._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(s){this.map=s,this.load()}setData(s){return this._data=s,this._updateWorkerData(),this}updateData(s){return this._updateWorkerData(s),this}setClusterOptions(s){return this.workerOptions.cluster=s.cluster,s&&(s.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=s.clusterRadius),s.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=s.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(s){return this.actor.sendAsync({type:"getClusterExpansionZoom",data:{type:this.type,clusterId:s,source:this.id}})}getClusterChildren(s){return this.actor.sendAsync({type:"getClusterChildren",data:{type:this.type,clusterId:s,source:this.id}})}getClusterLeaves(s,d,m){return this.actor.sendAsync({type:"getClusterLeaves",data:{type:this.type,source:this.id,clusterId:s,limit:d,offset:m}})}_updateWorkerData(s){return o._(this,void 0,void 0,function*(){const d=o.e({type:this.type},this.workerOptions);s?d.dataDiff=s:typeof this._data=="string"?(d.request=this.map._requestManager.transformRequest(M.resolveURL(this._data),J.Source),d.request.collectResourceTiming=this._collectResourceTiming):d.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new o.k("dataloading",{dataType:"source"}));try{const m=yield this.actor.sendAsync({type:"loadData",data:d});if(this._pendingLoads--,this._removed||m.abandoned)return void this.fire(new o.k("dataabort",{dataType:"source"}));let g=null;m.resourceTiming&&m.resourceTiming[this.id]&&(g=m.resourceTiming[this.id].slice(0));const b={dataType:"source"};this._collectResourceTiming&&g&&g.length>0&&o.e(b,{resourceTiming:g}),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"metadata"}))),this.fire(new o.k("data",Object.assign(Object.assign({},b),{sourceDataType:"content"})))}catch(m){if(this._pendingLoads--,this._removed)return void this.fire(new o.k("dataabort",{dataType:"source"}));this.fire(new o.j(m))}})}loaded(){return this._pendingLoads===0}loadTile(s){return o._(this,void 0,void 0,function*(){const d=s.actor?"reloadTile":"loadTile";s.actor=this.actor;const m={type:this.type,uid:s.uid,tileID:s.tileID,zoom:s.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};s.abortController=new AbortController;const g=yield this.actor.sendAsync({type:d,data:m},s.abortController);delete s.abortController,s.unloadVectorData(),s.aborted||s.loadVectorData(g,this.map.painter,d==="reloadTile")})}abortTile(s){return o._(this,void 0,void 0,function*(){s.abortController&&(s.abortController.abort(),delete s.abortController),s.aborted=!0})}unloadTile(s){return o._(this,void 0,void 0,function*(){s.unloadVectorData(),yield this.actor.sendAsync({type:"removeTile",data:{uid:s.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"removeSource",data:{type:this.type,source:this.id}})}serialize(){return o.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var mt=o.X([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class St extends o.E{constructor(s,d,m,g){super(),this.id=s,this.dispatcher=m,this.coordinates=d.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(g),this.options=d}load(s){return o._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new o.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const d=yield O.getImage(this.map._requestManager.transformRequest(this.url,J.Image),this._request);this._request=null,this._loaded=!0,d&&d.data&&(this.image=d.data,s&&(this.coordinates=s),this._finishLoading())}catch(d){this._request=null,this.fire(new o.j(d))}})}loaded(){return this._loaded}updateImage(s){return s.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=s.url,this.load(s.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new o.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(s){this.map=s,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(s){this.coordinates=s;const d=s.map(o.Y.fromLngLat);this.tileID=function(g){let b=1/0,P=1/0,R=-1/0,D=-1/0;for(const se of g)b=Math.min(b,se.x),P=Math.min(P,se.y),R=Math.max(R,se.x),D=Math.max(D,se.y);const H=Math.max(R-b,D-P),$=Math.max(0,Math.floor(-Math.log(H)/Math.LN2)),Z=Math.pow(2,$);return new o.a0($,Math.floor((b+R)/2*Z),Math.floor((P+D)/2*Z))}(d),this.minzoom=this.maxzoom=this.tileID.z;const m=d.map(g=>this.tileID.getTilePoint(g)._round());return this._boundsArray=new o.Z,this._boundsArray.emplaceBack(m[0].x,m[0].y,0,0),this._boundsArray.emplaceBack(m[1].x,m[1].y,o.W,0),this._boundsArray.emplaceBack(m[3].x,m[3].y,0,o.W),this._boundsArray.emplaceBack(m[2].x,m[2].y,o.W,o.W),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new o.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture||(this.texture=new Fe(s,this.image,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(s){return o._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(s.tileID.canonical)?(this.tiles[String(s.tileID.wrap)]=s,s.buckets={}):s.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class _n extends St{constructor(s,d,m,g){super(s,d,m,g),this.roundZoom=!0,this.type="video",this.options=d}load(){return o._(this,void 0,void 0,function*(){this._loaded=!1;const s=this.options;this.urls=[];for(const d of s.urls)this.urls.push(this.map._requestManager.transformRequest(d,J.Source).url);try{const d=yield o.a2(this.urls);if(this._loaded=!0,!d)return;this.video=d,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(d){this.fire(new o.j(d))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(s){if(this.video){const d=this.video.seekable;s<d.start(0)||s>d.end(0)?this.fire(new o.j(new o.a1(`sources.${this.id}`,null,`Playback for this video can be set only between the ${d.start(0)} and ${d.end(0)}-second mark.`))):this.video.currentTime=s}}getVideo(){return this.video}onAdd(s){this.map||(this.map=s,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const s=this.map.painter.context,d=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE),d.texSubImage2D(d.TEXTURE_2D,0,0,0,d.RGBA,d.UNSIGNED_BYTE,this.video)):(this.texture=new Fe(s,this.video,d.RGBA),this.texture.bind(d.LINEAR,d.CLAMP_TO_EDGE));let m=!1;for(const g in this.tiles){const b=this.tiles[g];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,m=!0)}m&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Mt extends St{constructor(s,d,m,g){super(s,d,m,g),d.coordinates?Array.isArray(d.coordinates)&&d.coordinates.length===4&&!d.coordinates.some(b=>!Array.isArray(b)||b.length!==2||b.some(P=>typeof P!="number"))||this.fire(new o.j(new o.a1(`sources.${s}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.j(new o.a1(`sources.${s}`,null,'missing required property "coordinates"'))),d.animate&&typeof d.animate!="boolean"&&this.fire(new o.j(new o.a1(`sources.${s}`,null,'optional "animate" property must be a boolean value'))),d.canvas?typeof d.canvas=="string"||d.canvas instanceof HTMLCanvasElement||this.fire(new o.j(new o.a1(`sources.${s}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.j(new o.a1(`sources.${s}`,null,'missing required property "canvas"'))),this.options=d,this.animate=d.animate===void 0||d.animate}load(){return o._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(s){this.map=s,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let s=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,s=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,s=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const d=this.map.painter.context,m=d.gl;this.boundsBuffer||(this.boundsBuffer=d.createVertexBuffer(this._boundsArray,mt.members)),this.boundsSegments||(this.boundsSegments=o.$.simpleSegment(0,0,4,2)),this.texture?(s||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Fe(d,this.canvas,m.RGBA,{premultiply:!0});let g=!1;for(const b in this.tiles){const P=this.tiles[b];P.state!=="loaded"&&(P.state="loaded",P.texture=this.texture,g=!0)}g&&this.fire(new o.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const s of[this.canvas.width,this.canvas.height])if(isNaN(s)||s<=0)return!0;return!1}}const hn={},xn=_=>{switch(_){case"geojson":return rt;case"image":return St;case"raster":return le;case"raster-dem":return st;case"vector":return ie;case"video":return _n;case"canvas":return Mt}return hn[_]},Nt="RTLPluginLoaded";class an extends o.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=In()}_syncState(s){return this.status=s,this.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:s,pluginURL:this.url}).catch(d=>{throw this.status="error",d})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(s){return o._(this,arguments,void 0,function*(d,m=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=M.resolveURL(d),!this.url)throw new Error(`requested url ${d} is invalid`);if(this.status==="unavailable"){if(!m)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return o._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new o.k(Nt))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let at=null;function tn(){return at||(at=new an),at}class Kt{constructor(s,d){this.timeAdded=0,this.fadeEndTime=0,this.tileID=s,this.uid=o.a3(),this.uses=0,this.tileSize=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(s){const d=s+this.timeAdded;d<this.fadeEndTime||(this.fadeEndTime=d)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(s){this.demTexture&&s.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(s,d,m){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",s){s.featureIndex&&(this.latestFeatureIndex=s.featureIndex,s.rawTileData?(this.latestRawTileData=s.rawTileData,this.latestFeatureIndex.rawTileData=s.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=s.collisionBoxArray,this.buckets=function(g,b){const P={};if(!b)return P;for(const R of g){const D=R.layerIds.map(H=>b.getLayer(H)).filter(Boolean);if(D.length!==0){R.layers=D,R.stateDependentLayerIds&&(R.stateDependentLayers=R.stateDependentLayerIds.map(H=>D.filter($=>$.id===H)[0]));for(const H of D)P[H.id]=R}}return P}(s.buckets,d.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const b=this.buckets[g];if(b instanceof o.a5){if(this.hasSymbolBuckets=!0,!m)break;b.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const b=this.buckets[g];if(b instanceof o.a5&&b.hasRTLText){this.hasRTLText=!0,tn().lazyLoad();break}}this.queryPadding=0;for(const g in this.buckets){const b=this.buckets[g];this.queryPadding=Math.max(this.queryPadding,d.style.getLayer(g).queryRadius(b))}s.imageAtlas&&(this.imageAtlas=s.imageAtlas),s.glyphAtlasImage&&(this.glyphAtlasImage=s.glyphAtlasImage)}else this.collisionBoxArray=new o.a4}unloadVectorData(){for(const s in this.buckets)this.buckets[s].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(s){return this.buckets[s.id]}upload(s){for(const m in this.buckets){const g=this.buckets[m];g.uploadPending()&&g.upload(s)}const d=s.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Fe(s,this.imageAtlas.image,d.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Fe(s,this.glyphAtlasImage,d.ALPHA),this.glyphAtlasImage=null)}prepare(s){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(s,this.imageAtlasTexture)}queryRenderedFeatures(s,d,m,g,b,P,R,D,H,$){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:g,cameraQueryGeometry:b,scale:P,tileSize:this.tileSize,pixelPosMatrix:$,transform:D,params:R,queryPadding:this.queryPadding*H},s,d,m):{}}querySourceFeatures(s,d){const m=this.latestFeatureIndex;if(!m||!m.rawTileData)return;const g=m.loadVTLayers(),b=d&&d.sourceLayer?d.sourceLayer:"",P=g._geojsonTileLayer||g[b];if(!P)return;const R=o.a6(d&&d.filter),{z:D,x:H,y:$}=this.tileID.canonical,Z={z:D,x:H,y:$};for(let se=0;se<P.length;se++){const _e=P.feature(se);if(R.needGeometry){const fe=o.a7(_e,!0);if(!R.filter(new o.a8(this.tileID.overscaledZ),fe,this.tileID.canonical))continue}else if(!R.filter(new o.a8(this.tileID.overscaledZ),_e))continue;const ve=m.getId(_e,b),we=new o.a9(_e,D,H,$,ve);we.tile=Z,s.push(we)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(s){const d=this.expirationTime;if(s.cacheControl){const m=o.aa(s.cacheControl);m["max-age"]&&(this.expirationTime=Date.now()+1e3*m["max-age"])}else s.expires&&(this.expirationTime=new Date(s.expires).getTime());if(this.expirationTime){const m=Date.now();let g=!1;if(this.expirationTime>m)g=!1;else if(d)if(this.expirationTime<d)g=!0;else{const b=this.expirationTime-d;b?this.expirationTime=m+Math.max(b,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(s,d){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(s).length===0)return;const m=this.latestFeatureIndex.loadVTLayers();for(const g in this.buckets){if(!d.style.hasLayer(g))continue;const b=this.buckets[g],P=b.layers[0].sourceLayer||"_geojsonTileLayer",R=m[P],D=s[P];if(!R||!D||Object.keys(D).length===0)continue;b.update(D,R,this.imageAtlas&&this.imageAtlas.patternPositions||{});const H=d&&d.style&&d.style.getLayer(g);H&&(this.queryPadding=Math.max(this.queryPadding,H.queryRadius(b)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<M.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(s){this.symbolFadeHoldUntil=M.now()+s}setDependencies(s,d){const m={};for(const g of d)m[g]=!0;this.dependencies[s]=m}hasDependency(s,d){for(const m of s){const g=this.dependencies[m];if(g){for(const b of d)if(g[b])return!0}}return!1}}class On{constructor(s,d){this.max=s,this.onRemove=d,this.reset()}reset(){for(const s in this.data)for(const d of this.data[s])d.timeout&&clearTimeout(d.timeout),this.onRemove(d.value);return this.data={},this.order=[],this}add(s,d,m){const g=s.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const b={value:d,timeout:void 0};if(m!==void 0&&(b.timeout=setTimeout(()=>{this.remove(s,b)},m)),this.data[g].push(b),this.order.push(g),this.order.length>this.max){const P=this._getAndRemoveByKey(this.order[0]);P&&this.onRemove(P)}return this}has(s){return s.wrapped().key in this.data}getAndRemove(s){return this.has(s)?this._getAndRemoveByKey(s.wrapped().key):null}_getAndRemoveByKey(s){const d=this.data[s].shift();return d.timeout&&clearTimeout(d.timeout),this.data[s].length===0&&delete this.data[s],this.order.splice(this.order.indexOf(s),1),d.value}getByKey(s){const d=this.data[s];return d?d[0].value:null}get(s){return this.has(s)?this.data[s.wrapped().key][0].value:null}remove(s,d){if(!this.has(s))return this;const m=s.wrapped().key,g=d===void 0?0:this.data[m].indexOf(d),b=this.data[m][g];return this.data[m].splice(g,1),b.timeout&&clearTimeout(b.timeout),this.data[m].length===0&&delete this.data[m],this.onRemove(b.value),this.order.splice(this.order.indexOf(m),1),this}setMaxSize(s){for(this.max=s;this.order.length>this.max;){const d=this._getAndRemoveByKey(this.order[0]);d&&this.onRemove(d)}return this}filter(s){const d=[];for(const m in this.data)for(const g of this.data[m])s(g.value)||d.push(g);for(const m of d)this.remove(m.value.tileID,m)}}class Un{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(s,d,m){const g=String(d);if(this.stateChanges[s]=this.stateChanges[s]||{},this.stateChanges[s][g]=this.stateChanges[s][g]||{},o.e(this.stateChanges[s][g],m),this.deletedStates[s]===null){this.deletedStates[s]={};for(const b in this.state[s])b!==g&&(this.deletedStates[s][b]=null)}else if(this.deletedStates[s]&&this.deletedStates[s][g]===null){this.deletedStates[s][g]={};for(const b in this.state[s][g])m[b]||(this.deletedStates[s][g][b]=null)}else for(const b in m)this.deletedStates[s]&&this.deletedStates[s][g]&&this.deletedStates[s][g][b]===null&&delete this.deletedStates[s][g][b]}removeFeatureState(s,d,m){if(this.deletedStates[s]===null)return;const g=String(d);if(this.deletedStates[s]=this.deletedStates[s]||{},m&&d!==void 0)this.deletedStates[s][g]!==null&&(this.deletedStates[s][g]=this.deletedStates[s][g]||{},this.deletedStates[s][g][m]=null);else if(d!==void 0)if(this.stateChanges[s]&&this.stateChanges[s][g])for(m in this.deletedStates[s][g]={},this.stateChanges[s][g])this.deletedStates[s][g][m]=null;else this.deletedStates[s][g]=null;else this.deletedStates[s]=null}getState(s,d){const m=String(d),g=o.e({},(this.state[s]||{})[m],(this.stateChanges[s]||{})[m]);if(this.deletedStates[s]===null)return{};if(this.deletedStates[s]){const b=this.deletedStates[s][d];if(b===null)return{};for(const P in b)delete g[P]}return g}initializeTileState(s,d){s.setFeatureState(this.state,d)}coalesceChanges(s,d){const m={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const b={};for(const P in this.stateChanges[g])this.state[g][P]||(this.state[g][P]={}),o.e(this.state[g][P],this.stateChanges[g][P]),b[P]=this.state[g][P];m[g]=b}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const b={};if(this.deletedStates[g]===null)for(const P in this.state[g])b[P]={},this.state[g][P]={};else for(const P in this.deletedStates[g]){if(this.deletedStates[g][P]===null)this.state[g][P]={};else for(const R of Object.keys(this.deletedStates[g][P]))delete this.state[g][P][R];b[P]=this.state[g][P]}m[g]=m[g]||{},o.e(m[g],b)}if(this.stateChanges={},this.deletedStates={},Object.keys(m).length!==0)for(const g in s)s[g].setFeatureState(m,d)}}class dt extends o.E{constructor(s,d,m){super(),this.id=s,this.dispatcher=m,this.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((g,b,P,R)=>{const D=new(xn(b.type))(g,b,P,R);if(D.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${D.id}`);return D})(s,d,m,this),this._tiles={},this._cache=new On(0,g=>this._unloadTile(g)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Un,this._didEmitContent=!1,this._updated=!1}onAdd(s){this.map=s,this._maxTileCacheSize=s?s._maxTileCacheSize:null,this._maxTileCacheZoomLevels=s?s._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(s)}onRemove(s){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(s)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const s in this._tiles){const d=this._tiles[s];if(d.state!=="loaded"&&d.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const s=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,s&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(s,d,m){return o._(this,void 0,void 0,function*(){try{yield this._source.loadTile(s),this._tileLoaded(s,d,m)}catch(g){s.state="errored",g.status!==404?this._source.fire(new o.j(g,{tile:s})):this.update(this.transform,this.terrain)}})}_unloadTile(s){this._source.unloadTile&&this._source.unloadTile(s)}_abortTile(s){this._source.abortTile&&this._source.abortTile(s),this._source.fire(new o.k("dataabort",{tile:s,coord:s.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(s){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const d in this._tiles){const m=this._tiles[d];m.upload(s),m.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(s=>s.tileID).sort(Ht).map(s=>s.key)}getRenderableIds(s){const d=[];for(const m in this._tiles)this._isIdRenderable(m,s)&&d.push(this._tiles[m]);return s?d.sort((m,g)=>{const b=m.tileID,P=g.tileID,R=new o.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle),D=new o.P(P.canonical.x,P.canonical.y)._rotate(this.transform.angle);return b.overscaledZ-P.overscaledZ||D.y-R.y||D.x-R.x}).map(m=>m.tileID.key):d.map(m=>m.tileID).sort(Ht).map(m=>m.key)}hasRenderableParent(s){const d=this.findLoadedParent(s,0);return!!d&&this._isIdRenderable(d.tileID.key)}_isIdRenderable(s,d){return this._tiles[s]&&this._tiles[s].hasData()&&!this._coveredTiles[s]&&(d||!this._tiles[s].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const s in this._tiles)this._tiles[s].state!=="errored"&&this._reloadTile(s,"reloading")}}_reloadTile(s,d){return o._(this,void 0,void 0,function*(){const m=this._tiles[s];m&&(m.state!=="loading"&&(m.state=d),yield this._loadTile(m,s,d))})}_tileLoaded(s,d,m){s.timeAdded=M.now(),m==="expired"&&(s.refreshedUponExpiration=!0),this._setTileReloadTimer(d,s),this.getSource().type==="raster-dem"&&s.dem&&this._backfillDEM(s),this._state.initializeTileState(s,this.map?this.map.painter:null),s.aborted||this._source.fire(new o.k("data",{dataType:"source",tile:s,coord:s.tileID}))}_backfillDEM(s){const d=this.getRenderableIds();for(let g=0;g<d.length;g++){const b=d[g];if(s.neighboringTiles&&s.neighboringTiles[b]){const P=this.getTileByID(b);m(s,P),m(P,s)}}function m(g,b){g.needsHillshadePrepare=!0,g.needsTerrainPrepare=!0;let P=b.tileID.canonical.x-g.tileID.canonical.x;const R=b.tileID.canonical.y-g.tileID.canonical.y,D=Math.pow(2,g.tileID.canonical.z),H=b.tileID.key;P===0&&R===0||Math.abs(R)>1||(Math.abs(P)>1&&(Math.abs(P+D)===1?P+=D:Math.abs(P-D)===1&&(P-=D)),b.dem&&g.dem&&(g.dem.backfillBorder(b.dem,P,R),g.neighboringTiles&&g.neighboringTiles[H]&&(g.neighboringTiles[H].backfilled=!0)))}}getTile(s){return this.getTileByID(s.key)}getTileByID(s){return this._tiles[s]}_retainLoadedChildren(s,d,m,g){for(const b in this._tiles){let P=this._tiles[b];if(g[b]||!P.hasData()||P.tileID.overscaledZ<=d||P.tileID.overscaledZ>m)continue;let R=P.tileID;for(;P&&P.tileID.overscaledZ>d+1;){const H=P.tileID.scaledTo(P.tileID.overscaledZ-1);P=this._tiles[H.key],P&&P.hasData()&&(R=H)}let D=R;for(;D.overscaledZ>d;)if(D=D.scaledTo(D.overscaledZ-1),s[D.key]){g[R.key]=R;break}}}findLoadedParent(s,d){if(s.key in this._loadedParentTiles){const m=this._loadedParentTiles[s.key];return m&&m.tileID.overscaledZ>=d?m:null}for(let m=s.overscaledZ-1;m>=d;m--){const g=s.scaledTo(m),b=this._getLoadedTile(g);if(b)return b}}_getLoadedTile(s){const d=this._tiles[s.key];return d&&d.hasData()?d:this._cache.getByKey(s.wrapped().key)}updateCacheSize(s){const d=Math.ceil(s.width/this._source.tileSize)+1,m=Math.ceil(s.height/this._source.tileSize)+1,g=Math.floor(d*m*(this._maxTileCacheZoomLevels===null?o.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),b=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(s){const d=Math.round((s-(this._prevLng===void 0?s:this._prevLng))/360);if(this._prevLng=s,d){const m={};for(const g in this._tiles){const b=this._tiles[g];b.tileID=b.tileID.unwrapTo(b.tileID.wrap+d),m[b.tileID.key]=b}this._tiles=m;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(g,this._tiles[g])}}update(s,d){if(this.transform=s,this.terrain=d,!this._sourceLoaded||this._paused)return;let m;this.updateCacheSize(s),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?m=s.getVisibleUnwrappedCoordinates(this._source.tileID).map($=>new o.Q($.canonical.z,$.wrap,$.canonical.z,$.canonical.x,$.canonical.y)):(m=s.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:d}),this._source.hasTile&&(m=m.filter($=>this._source.hasTile($)))):m=[];const g=s.coveringZoomLevel(this._source),b=Math.max(g-dt.maxOverzooming,this._source.minzoom),P=Math.max(g+dt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const $={};for(const Z of m)if(Z.canonical.z>this._source.minzoom){const se=Z.scaledTo(Z.canonical.z-1);$[se.key]=se;const _e=Z.scaledTo(Math.max(this._source.minzoom,Math.min(Z.canonical.z,5)));$[_e.key]=_e}m=m.concat(Object.values($))}const R=m.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,R&&this.fire(new o.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const D=this._updateRetainedTiles(m,g);if(jt(this._source.type)){const $={},Z={},se=Object.keys(D),_e=M.now();for(const ve of se){const we=D[ve],fe=this._tiles[ve];if(!fe||fe.fadeEndTime!==0&&fe.fadeEndTime<=_e)continue;const ze=this.findLoadedParent(we,b);ze&&(this._addTile(ze.tileID),$[ze.tileID.key]=ze.tileID),Z[ve]=we}this._retainLoadedChildren(Z,g,P,D);for(const ve in $)D[ve]||(this._coveredTiles[ve]=!0,D[ve]=$[ve]);if(d){const ve={},we={};for(const fe of m)this._tiles[fe.key].hasData()?ve[fe.key]=fe:we[fe.key]=fe;for(const fe in we){const ze=we[fe].children(this._source.maxzoom);this._tiles[ze[0].key]&&this._tiles[ze[1].key]&&this._tiles[ze[2].key]&&this._tiles[ze[3].key]&&(ve[ze[0].key]=D[ze[0].key]=ze[0],ve[ze[1].key]=D[ze[1].key]=ze[1],ve[ze[2].key]=D[ze[2].key]=ze[2],ve[ze[3].key]=D[ze[3].key]=ze[3],delete we[fe])}for(const fe in we){const ze=this.findLoadedParent(we[fe],this._source.minzoom);if(ze){ve[ze.tileID.key]=D[ze.tileID.key]=ze.tileID;for(const $e in ve)ve[$e].isChildOf(ze.tileID)&&delete ve[$e]}}for(const fe in this._tiles)ve[fe]||(this._coveredTiles[fe]=!0)}}for(const $ in D)this._tiles[$].clearFadeHold();const H=o.ab(this._tiles,D);for(const $ of H){const Z=this._tiles[$];Z.hasSymbolBuckets&&!Z.holdingForFade()?Z.setHoldDuration(this.map._fadeDuration):Z.hasSymbolBuckets&&!Z.symbolFadeFinished()||this._removeTile($)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const s in this._tiles)this._tiles[s].holdingForFade()&&this._removeTile(s)}_updateRetainedTiles(s,d){const m={},g={},b=Math.max(d-dt.maxOverzooming,this._source.minzoom),P=Math.max(d+dt.maxUnderzooming,this._source.minzoom),R={};for(const D of s){const H=this._addTile(D);m[D.key]=D,H.hasData()||d<this._source.maxzoom&&(R[D.key]=D)}this._retainLoadedChildren(R,d,P,m);for(const D of s){let H=this._tiles[D.key];if(H.hasData())continue;if(d+1>this._source.maxzoom){const Z=D.children(this._source.maxzoom)[0],se=this.getTile(Z);if(se&&se.hasData()){m[Z.key]=Z;continue}}else{const Z=D.children(this._source.maxzoom);if(m[Z[0].key]&&m[Z[1].key]&&m[Z[2].key]&&m[Z[3].key])continue}let $=H.wasRequested();for(let Z=D.overscaledZ-1;Z>=b;--Z){const se=D.scaledTo(Z);if(g[se.key])break;if(g[se.key]=!0,H=this.getTile(se),!H&&$&&(H=this._addTile(se)),H){const _e=H.hasData();if(($||_e)&&(m[se.key]=se),$=H.wasRequested(),_e)break}}}return m}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const s in this._tiles){const d=[];let m,g=this._tiles[s].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){m=this._loadedParentTiles[g.key];break}d.push(g.key);const b=g.scaledTo(g.overscaledZ-1);if(m=this._getLoadedTile(b),m)break;g=b}for(const b of d)this._loadedParentTiles[b]=m}}_addTile(s){let d=this._tiles[s.key];if(d)return d;d=this._cache.getAndRemove(s),d&&(this._setTileReloadTimer(s.key,d),d.tileID=s,this._state.initializeTileState(d,this.map?this.map.painter:null),this._cacheTimers[s.key]&&(clearTimeout(this._cacheTimers[s.key]),delete this._cacheTimers[s.key],this._setTileReloadTimer(s.key,d)));const m=d;return d||(d=new Kt(s,this._source.tileSize*s.overscaleFactor()),this._loadTile(d,s.key,d.state)),d.uses++,this._tiles[s.key]=d,m||this._source.fire(new o.k("dataloading",{tile:d,coord:d.tileID,dataType:"source"})),d}_setTileReloadTimer(s,d){s in this._timers&&(clearTimeout(this._timers[s]),delete this._timers[s]);const m=d.getExpiryTimeout();m&&(this._timers[s]=setTimeout(()=>{this._reloadTile(s,"expired"),delete this._timers[s]},m))}_removeTile(s){const d=this._tiles[s];d&&(d.uses--,delete this._tiles[s],this._timers[s]&&(clearTimeout(this._timers[s]),delete this._timers[s]),d.uses>0||(d.hasData()&&d.state!=="reloading"?this._cache.add(d.tileID,d,d.getExpiryTimeout()):(d.aborted=!0,this._abortTile(d),this._unloadTile(d))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const s in this._tiles)this._removeTile(s);this._cache.reset()}tilesIn(s,d,m){const g=[],b=this.transform;if(!b)return g;const P=m?b.getCameraQueryGeometry(s):s,R=s.map(ve=>b.pointCoordinate(ve,this.terrain)),D=P.map(ve=>b.pointCoordinate(ve,this.terrain)),H=this.getIds();let $=1/0,Z=1/0,se=-1/0,_e=-1/0;for(const ve of D)$=Math.min($,ve.x),Z=Math.min(Z,ve.y),se=Math.max(se,ve.x),_e=Math.max(_e,ve.y);for(let ve=0;ve<H.length;ve++){const we=this._tiles[H[ve]];if(we.holdingForFade())continue;const fe=we.tileID,ze=Math.pow(2,b.zoom-we.tileID.overscaledZ),$e=d*we.queryPadding*o.W/we.tileSize/ze,Te=[fe.getTilePoint(new o.Y($,Z)),fe.getTilePoint(new o.Y(se,_e))];if(Te[0].x-$e<o.W&&Te[0].y-$e<o.W&&Te[1].x+$e>=0&&Te[1].y+$e>=0){const Be=R.map(Qe=>fe.getTilePoint(Qe)),Ke=D.map(Qe=>fe.getTilePoint(Qe));g.push({tile:we,tileID:fe,queryGeometry:Be,cameraQueryGeometry:Ke,scale:ze})}}return g}getVisibleCoordinates(s){const d=this.getRenderableIds(s).map(m=>this._tiles[m].tileID);for(const m of d)m.posMatrix=this.transform.calculatePosMatrix(m.toUnwrapped());return d}hasTransition(){if(this._source.hasTransition())return!0;if(jt(this._source.type)){const s=M.now();for(const d in this._tiles)if(this._tiles[d].fadeEndTime>=s)return!0}return!1}setFeatureState(s,d,m){this._state.updateState(s=s||"_geojsonTileLayer",d,m)}removeFeatureState(s,d,m){this._state.removeFeatureState(s=s||"_geojsonTileLayer",d,m)}getFeatureState(s,d){return this._state.getState(s=s||"_geojsonTileLayer",d)}setDependencies(s,d,m){const g=this._tiles[s];g&&g.setDependencies(d,m)}reloadTilesForDependencies(s,d){for(const m in this._tiles)this._tiles[m].hasDependency(s,d)&&this._reloadTile(m,"reloading");this._cache.filter(m=>!m.hasDependency(s,d))}}function Ht(_,s){const d=Math.abs(2*_.wrap)-+(_.wrap<0),m=Math.abs(2*s.wrap)-+(s.wrap<0);return _.overscaledZ-s.overscaledZ||m-d||s.canonical.y-_.canonical.y||s.canonical.x-_.canonical.x}function jt(_){return _==="raster"||_==="image"||_==="video"}dt.maxOverzooming=10,dt.maxUnderzooming=3;class Jt{constructor(s,d){this.reset(s,d)}reset(s,d){this.points=s||[],this._distances=[0];for(let m=1;m<this.points.length;m++)this._distances[m]=this._distances[m-1]+this.points[m].dist(this.points[m-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(d||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(s){if(this.points.length===1)return this.points[0];s=o.ac(s,0,1);let d=1,m=this._distances[d];const g=s*this.paddedLength+this.padding;for(;m<g&&d<this._distances.length;)m=this._distances[++d];const b=d-1,P=this._distances[b],R=m-P,D=R>0?(g-P)/R:0;return this.points[b].mult(1-D).add(this.points[d].mult(D))}}function X(_,s){let d=!0;return _==="always"||_!=="never"&&s!=="never"||(d=!1),d}class Oe{constructor(s,d,m){const g=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(s/m),this.yCellCount=Math.ceil(d/m);for(let P=0;P<this.xCellCount*this.yCellCount;P++)g.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=s,this.height=d,this.xScale=this.xCellCount/s,this.yScale=this.yCellCount/d,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(s,d,m,g,b){this._forEachCell(d,m,g,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(s),this.bboxes.push(d),this.bboxes.push(m),this.bboxes.push(g),this.bboxes.push(b)}insertCircle(s,d,m,g){this._forEachCell(d-g,m-g,d+g,m+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(s),this.circles.push(d),this.circles.push(m),this.circles.push(g)}_insertBoxCell(s,d,m,g,b,P){this.boxCells[b].push(P)}_insertCircleCell(s,d,m,g,b,P){this.circleCells[b].push(P)}_query(s,d,m,g,b,P,R){if(m<0||s>this.width||g<0||d>this.height)return[];const D=[];if(s<=0&&d<=0&&this.width<=m&&this.height<=g){if(b)return[{key:null,x1:s,y1:d,x2:m,y2:g}];for(let H=0;H<this.boxKeys.length;H++)D.push({key:this.boxKeys[H],x1:this.bboxes[4*H],y1:this.bboxes[4*H+1],x2:this.bboxes[4*H+2],y2:this.bboxes[4*H+3]});for(let H=0;H<this.circleKeys.length;H++){const $=this.circles[3*H],Z=this.circles[3*H+1],se=this.circles[3*H+2];D.push({key:this.circleKeys[H],x1:$-se,y1:Z-se,x2:$+se,y2:Z+se})}}else this._forEachCell(s,d,m,g,this._queryCell,D,{hitTest:b,overlapMode:P,seenUids:{box:{},circle:{}}},R);return D}query(s,d,m,g){return this._query(s,d,m,g,!1,null)}hitTest(s,d,m,g,b,P){return this._query(s,d,m,g,!0,b,P).length>0}hitTestCircle(s,d,m,g,b){const P=s-m,R=s+m,D=d-m,H=d+m;if(R<0||P>this.width||H<0||D>this.height)return!1;const $=[];return this._forEachCell(P,D,R,H,this._queryCellCircle,$,{hitTest:!0,overlapMode:g,circle:{x:s,y:d,radius:m},seenUids:{box:{},circle:{}}},b),$.length>0}_queryCell(s,d,m,g,b,P,R,D){const{seenUids:H,hitTest:$,overlapMode:Z}=R,se=this.boxCells[b];if(se!==null){const ve=this.bboxes;for(const we of se)if(!H.box[we]){H.box[we]=!0;const fe=4*we,ze=this.boxKeys[we];if(s<=ve[fe+2]&&d<=ve[fe+3]&&m>=ve[fe+0]&&g>=ve[fe+1]&&(!D||D(ze))&&(!$||!X(Z,ze.overlapMode))&&(P.push({key:ze,x1:ve[fe],y1:ve[fe+1],x2:ve[fe+2],y2:ve[fe+3]}),$))return!0}}const _e=this.circleCells[b];if(_e!==null){const ve=this.circles;for(const we of _e)if(!H.circle[we]){H.circle[we]=!0;const fe=3*we,ze=this.circleKeys[we];if(this._circleAndRectCollide(ve[fe],ve[fe+1],ve[fe+2],s,d,m,g)&&(!D||D(ze))&&(!$||!X(Z,ze.overlapMode))){const $e=ve[fe],Te=ve[fe+1],Be=ve[fe+2];if(P.push({key:ze,x1:$e-Be,y1:Te-Be,x2:$e+Be,y2:Te+Be}),$)return!0}}}return!1}_queryCellCircle(s,d,m,g,b,P,R,D){const{circle:H,seenUids:$,overlapMode:Z}=R,se=this.boxCells[b];if(se!==null){const ve=this.bboxes;for(const we of se)if(!$.box[we]){$.box[we]=!0;const fe=4*we,ze=this.boxKeys[we];if(this._circleAndRectCollide(H.x,H.y,H.radius,ve[fe+0],ve[fe+1],ve[fe+2],ve[fe+3])&&(!D||D(ze))&&!X(Z,ze.overlapMode))return P.push(!0),!0}}const _e=this.circleCells[b];if(_e!==null){const ve=this.circles;for(const we of _e)if(!$.circle[we]){$.circle[we]=!0;const fe=3*we,ze=this.circleKeys[we];if(this._circlesCollide(ve[fe],ve[fe+1],ve[fe+2],H.x,H.y,H.radius)&&(!D||D(ze))&&!X(Z,ze.overlapMode))return P.push(!0),!0}}}_forEachCell(s,d,m,g,b,P,R,D){const H=this._convertToXCellCoord(s),$=this._convertToYCellCoord(d),Z=this._convertToXCellCoord(m),se=this._convertToYCellCoord(g);for(let _e=H;_e<=Z;_e++)for(let ve=$;ve<=se;ve++)if(b.call(this,s,d,m,g,this.xCellCount*ve+_e,P,R,D))return}_convertToXCellCoord(s){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(s*this.xScale)))}_convertToYCellCoord(s){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(s*this.yScale)))}_circlesCollide(s,d,m,g,b,P){const R=g-s,D=b-d,H=m+P;return H*H>R*R+D*D}_circleAndRectCollide(s,d,m,g,b,P,R){const D=(P-g)/2,H=Math.abs(s-(g+D));if(H>D+m)return!1;const $=(R-b)/2,Z=Math.abs(d-(b+$));if(Z>$+m)return!1;if(H<=D||Z<=$)return!0;const se=H-D,_e=Z-$;return se*se+_e*_e<=m*m}}function pt(_,s,d,m,g){const b=o.F();return s?(o.J(b,b,[1/g,1/g,1]),d||o.ad(b,b,m.angle)):o.K(b,m.labelPlaneMatrix,_),b}function Dt(_,s,d,m,g){if(s){const b=o.ae(_);return o.J(b,b,[g,g,1]),d||o.ad(b,b,-m.angle),b}return m.glCoordMatrix}function ce(_,s,d){let m;d?(m=[_.x,_.y,d(_.x,_.y),1],o.af(m,m,s)):(m=[_.x,_.y,0,1],nn(m,m,s));const g=m[3];return{point:new o.P(m[0]/g,m[1]/g),signedDistanceFromCamera:g}}function B(_,s){return .5+_/s*.5}function U(_,s){const d=_[0]/_[3],m=_[1]/_[3];return d>=-s[0]&&d<=s[0]&&m>=-s[1]&&m<=s[1]}function q(_,s,d,m,g,b,P,R,D,H){const $=m?_.textSizeData:_.iconSizeData,Z=o.ag($,d.transform.zoom),se=[256/d.width*2+1,256/d.height*2+1],_e=m?_.text.dynamicLayoutVertexArray:_.icon.dynamicLayoutVertexArray;_e.clear();const ve=_.lineVertexArray,we=m?_.text.placedSymbolArray:_.icon.placedSymbolArray,fe=d.transform.width/d.transform.height;let ze=!1;for(let $e=0;$e<we.length;$e++){const Te=we.get($e);if(Te.hidden||Te.writingMode===o.ah.vertical&&!ze){Ct(Te.numGlyphs,_e);continue}let Be;if(ze=!1,H?(Be=[Te.anchorX,Te.anchorY,H(Te.anchorX,Te.anchorY),1],o.af(Be,Be,s)):(Be=[Te.anchorX,Te.anchorY,0,1],nn(Be,Be,s)),!U(Be,se)){Ct(Te.numGlyphs,_e);continue}const Ke=B(d.transform.cameraToCenterDistance,Be[3]),Qe=o.ai($,Z,Te),lt=P?Qe/Ke:Qe*Ke,bt=new o.P(Te.anchorX,Te.anchorY),vt=ce(bt,g,H).point,xt={projections:{},offsets:{}},Zt=Se(Te,lt,!1,R,s,g,b,_.glyphOffsetArray,ve,_e,vt,bt,xt,fe,D,H);ze=Zt.useVertical,(Zt.notEnoughRoom||ze||Zt.needsFlipping&&Se(Te,lt,!0,R,s,g,b,_.glyphOffsetArray,ve,_e,vt,bt,xt,fe,D,H).notEnoughRoom)&&Ct(Te.numGlyphs,_e)}m?_.text.dynamicLayoutVertexBuffer.updateData(_e):_.icon.dynamicLayoutVertexBuffer.updateData(_e)}function ne(_,s,d,m,g,b,P,R,D,H,$,Z,se){const _e=R.glyphStartIndex+R.numGlyphs,ve=R.lineStartIndex,we=R.lineStartIndex+R.lineLength,fe=s.getoffsetX(R.glyphStartIndex),ze=s.getoffsetX(_e-1),$e=Ye(_*fe,d,m,g,b,P,R.segment,ve,we,D,H,$,Z,se);if(!$e)return null;const Te=Ye(_*ze,d,m,g,b,P,R.segment,ve,we,D,H,$,Z,se);return Te?{first:$e,last:Te}:null}function me(_,s,d,m){return _===o.ah.horizontal&&Math.abs(d.y-s.y)>Math.abs(d.x-s.x)*m?{useVertical:!0}:(_===o.ah.vertical?s.y<d.y:s.x>d.x)?{needsFlipping:!0}:null}function Se(_,s,d,m,g,b,P,R,D,H,$,Z,se,_e,ve,we){const fe=s/24,ze=_.lineOffsetX*fe,$e=_.lineOffsetY*fe;let Te;if(_.numGlyphs>1){const Be=_.glyphStartIndex+_.numGlyphs,Ke=_.lineStartIndex,Qe=_.lineStartIndex+_.lineLength,lt=ne(fe,R,ze,$e,d,$,Z,_,D,b,se,ve,we);if(!lt)return{notEnoughRoom:!0};const bt=ce(lt.first.point,P,we).point,vt=ce(lt.last.point,P,we).point;if(m&&!d){const xt=me(_.writingMode,bt,vt,_e);if(xt)return xt}Te=[lt.first];for(let xt=_.glyphStartIndex+1;xt<Be-1;xt++)Te.push(Ye(fe*R.getoffsetX(xt),ze,$e,d,$,Z,_.segment,Ke,Qe,D,b,se,ve,we));Te.push(lt.last)}else{if(m&&!d){const Ke=ce(Z,g,we).point,Qe=_.lineStartIndex+_.segment+1,lt=new o.P(D.getx(Qe),D.gety(Qe)),bt=ce(lt,g,we),vt=bt.signedDistanceFromCamera>0?bt.point:Ee(Z,lt,Ke,1,g,we),xt=me(_.writingMode,Ke,vt,_e);if(xt)return xt}const Be=Ye(fe*R.getoffsetX(_.glyphStartIndex),ze,$e,d,$,Z,_.segment,_.lineStartIndex,_.lineStartIndex+_.lineLength,D,b,se,ve,we);if(!Be)return{notEnoughRoom:!0};Te=[Be]}for(const Be of Te)o.aj(H,Be.point,Be.angle);return{}}function Ee(_,s,d,m,g,b){const P=ce(_.add(_.sub(s)._unit()),g,b).point,R=d.sub(P);return d.add(R._mult(m/R.mag()))}function ye(_,s){const{projectionCache:d,lineVertexArray:m,labelPlaneMatrix:g,tileAnchorPoint:b,distanceFromAnchor:P,getElevation:R,previousVertex:D,direction:H,absOffsetX:$}=s;if(d.projections[_])return d.projections[_];const Z=new o.P(m.getx(_),m.gety(_)),se=ce(Z,g,R);if(se.signedDistanceFromCamera>0)return d.projections[_]=se.point,se.point;const _e=_-H;return Ee(P===0?b:new o.P(m.getx(_e),m.gety(_e)),Z,D,$-P+1,g,R)}function Re(_,s,d){return _._unit()._perp()._mult(s*d)}function qe(_,s,d,m,g,b,P,R){const{projectionCache:D,direction:H}=R;if(D.offsets[_])return D.offsets[_];const $=d.add(s);if(_+H<m||_+H>=g)return D.offsets[_]=$,$;const Z=ye(_+H,R),se=Re(Z.sub(d),P,H),_e=d.add(se),ve=Z.add(se);return D.offsets[_]=o.ak(b,$,_e,ve)||$,D.offsets[_]}function Ye(_,s,d,m,g,b,P,R,D,H,$,Z,se,_e){const ve=m?_-s:_+s;let we=ve>0?1:-1,fe=0;m&&(we*=-1,fe=Math.PI),we<0&&(fe+=Math.PI);let ze,$e,Te=we>0?R+P:R+P+1,Be=g,Ke=g,Qe=0,lt=0;const bt=Math.abs(ve),vt=[];let xt;for(;Qe+lt<=bt;){if(Te+=we,Te<R||Te>=D)return null;Qe+=lt,Ke=Be,$e=ze;const Bt={projectionCache:Z,lineVertexArray:H,labelPlaneMatrix:$,tileAnchorPoint:b,distanceFromAnchor:Qe,getElevation:_e,previousVertex:Ke,direction:we,absOffsetX:bt};if(Be=ye(Te,Bt),d===0)vt.push(Ke),xt=Be.sub(Ke);else{let Tn;const Nn=Be.sub(Ke);Tn=Nn.mag()===0?Re(ye(Te+we,Bt).sub(Be),d,we):Re(Nn,d,we),$e||($e=Ke.add(Tn)),ze=qe(Te,Tn,Be,R,D,$e,d,Bt),vt.push($e),xt=ze.sub($e)}lt=xt.mag()}const Zt=xt._mult((bt-Qe)/lt)._add($e||Ke),zn=fe+Math.atan2(Be.y-Ke.y,Be.x-Ke.x);return vt.push(Zt),{point:Zt,angle:se?zn:0,path:vt}}const Ge=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Ct(_,s){for(let d=0;d<_;d++){const m=s.length;s.resize(m+4),s.float32.set(Ge,3*m)}}function nn(_,s,d){const m=s[0],g=s[1];return _[0]=d[0]*m+d[4]*g+d[12],_[1]=d[1]*m+d[5]*g+d[13],_[3]=d[3]*m+d[7]*g+d[15],_}const on=100;class bn{constructor(s,d=new Oe(s.width+200,s.height+200,25),m=new Oe(s.width+200,s.height+200,25)){this.transform=s,this.grid=d,this.ignoredGrid=m,this.pitchfactor=Math.cos(s._pitch)*s.cameraToCenterDistance,this.screenRightBoundary=s.width+on,this.screenBottomBoundary=s.height+on,this.gridRightBoundary=s.width+200,this.gridBottomBoundary=s.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(s,d,m,g,b,P){const R=this.projectAndGetPerspectiveRatio(g,s.anchorPointX,s.anchorPointY,P),D=m*R.perspectiveRatio,H=s.x1*D+R.point.x,$=s.y1*D+R.point.y,Z=s.x2*D+R.point.x,se=s.y2*D+R.point.y;return!this.isInsideGrid(H,$,Z,se)||d!=="always"&&this.grid.hitTest(H,$,Z,se,d,b)||R.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[H,$,Z,se],offscreen:this.isOffscreen(H,$,Z,se)}}placeCollisionCircles(s,d,m,g,b,P,R,D,H,$,Z,se,_e,ve){const we=[],fe=new o.P(d.anchorX,d.anchorY),ze=ce(fe,P,ve),$e=B(this.transform.cameraToCenterDistance,ze.signedDistanceFromCamera),Te=($?b/$e:b*$e)/o.ao,Be=ce(fe,R,ve).point,Ke=ne(Te,g,d.lineOffsetX*Te,d.lineOffsetY*Te,!1,Be,fe,d,m,R,{projections:{},offsets:{}},!1,ve);let Qe=!1,lt=!1,bt=!0;if(Ke){const vt=.5*se*$e+_e,xt=new o.P(-100,-100),Zt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),zn=new Jt,Bt=Ke.first,Tn=Ke.last;let Nn=[];for(let Vn=Bt.path.length-1;Vn>=1;Vn--)Nn.push(Bt.path[Vn]);for(let Vn=1;Vn<Tn.path.length;Vn++)Nn.push(Tn.path[Vn]);const Xn=2.5*vt;if(D){const Vn=Nn.map(Hn=>ce(Hn,D,ve));Nn=Vn.some(Hn=>Hn.signedDistanceFromCamera<=0)?[]:Vn.map(Hn=>Hn.point)}let Rn=[];if(Nn.length>0){const Vn=Nn[0].clone(),Hn=Nn[0].clone();for(let Ii=1;Ii<Nn.length;Ii++)Vn.x=Math.min(Vn.x,Nn[Ii].x),Vn.y=Math.min(Vn.y,Nn[Ii].y),Hn.x=Math.max(Hn.x,Nn[Ii].x),Hn.y=Math.max(Hn.y,Nn[Ii].y);Rn=Vn.x>=xt.x&&Hn.x<=Zt.x&&Vn.y>=xt.y&&Hn.y<=Zt.y?[Nn]:Hn.x<xt.x||Vn.x>Zt.x||Hn.y<xt.y||Vn.y>Zt.y?[]:o.al([Nn],xt.x,xt.y,Zt.x,Zt.y)}for(const Vn of Rn){zn.reset(Vn,.25*vt);let Hn=0;Hn=zn.length<=.5*vt?1:Math.ceil(zn.paddedLength/Xn)+1;for(let Ii=0;Ii<Hn;Ii++){const mi=Ii/Math.max(Hn-1,1),qr=zn.lerp(mi),Qi=qr.x+on,vi=qr.y+on;we.push(Qi,vi,vt,0);const Er=Qi-vt,Ua=vi-vt,cs=Qi+vt,Uo=vi+vt;if(bt=bt&&this.isOffscreen(Er,Ua,cs,Uo),lt=lt||this.isInsideGrid(Er,Ua,cs,Uo),s!=="always"&&this.grid.hitTestCircle(Qi,vi,vt,s,Z)&&(Qe=!0,!H))return{circles:[],offscreen:!1,collisionDetected:Qe}}}}return{circles:!H&&Qe||!lt||$e<this.perspectiveRatioCutoff?[]:we,offscreen:bt,collisionDetected:Qe}}queryRenderedSymbols(s){if(s.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const d=[];let m=1/0,g=1/0,b=-1/0,P=-1/0;for(const $ of s){const Z=new o.P($.x+on,$.y+on);m=Math.min(m,Z.x),g=Math.min(g,Z.y),b=Math.max(b,Z.x),P=Math.max(P,Z.y),d.push(Z)}const R=this.grid.query(m,g,b,P).concat(this.ignoredGrid.query(m,g,b,P)),D={},H={};for(const $ of R){const Z=$.key;if(D[Z.bucketInstanceId]===void 0&&(D[Z.bucketInstanceId]={}),D[Z.bucketInstanceId][Z.featureIndex])continue;const se=[new o.P($.x1,$.y1),new o.P($.x2,$.y1),new o.P($.x2,$.y2),new o.P($.x1,$.y2)];o.am(d,se)&&(D[Z.bucketInstanceId][Z.featureIndex]=!0,H[Z.bucketInstanceId]===void 0&&(H[Z.bucketInstanceId]=[]),H[Z.bucketInstanceId].push(Z.featureIndex))}return H}insertCollisionBox(s,d,m,g,b,P){(m?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:b,collisionGroupID:P,overlapMode:d},s[0],s[1],s[2],s[3])}insertCollisionCircles(s,d,m,g,b,P){const R=m?this.ignoredGrid:this.grid,D={bucketInstanceId:g,featureIndex:b,collisionGroupID:P,overlapMode:d};for(let H=0;H<s.length;H+=4)R.insertCircle(D,s[H],s[H+1],s[H+2])}projectAndGetPerspectiveRatio(s,d,m,g){let b;return g?(b=[d,m,g(d,m),1],o.af(b,b,s)):(b=[d,m,0,1],nn(b,b,s)),{point:new o.P((b[0]/b[3]+1)/2*this.transform.width+on,(-b[1]/b[3]+1)/2*this.transform.height+on),perspectiveRatio:.5+this.transform.cameraToCenterDistance/b[3]*.5}}isOffscreen(s,d,m,g){return m<on||s>=this.screenRightBoundary||g<on||d>this.screenBottomBoundary}isInsideGrid(s,d,m,g){return m>=0&&s<this.gridRightBoundary&&g>=0&&d<this.gridBottomBoundary}getViewportMatrix(){const s=o.an([]);return o.H(s,s,[-100,-100,0]),s}}function wn(_,s,d){return s*(o.W/(_.tileSize*Math.pow(2,d-_.tileID.overscaledZ)))}class li{constructor(s,d,m,g){this.opacity=s?Math.max(0,Math.min(1,s.opacity+(s.placed?d:-d))):g&&m?1:0,this.placed=m}isHidden(){return this.opacity===0&&!this.placed}}class ei{constructor(s,d,m,g,b){this.text=new li(s?s.text:null,d,m,b),this.icon=new li(s?s.icon:null,d,g,b)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class de{constructor(s,d,m){this.text=s,this.icon=d,this.skipFade=m}}class Le{constructor(){this.invProjMatrix=o.F(),this.viewportMatrix=o.F(),this.circles=[]}}class We{constructor(s,d,m,g,b){this.bucketInstanceId=s,this.featureIndex=d,this.sourceLayerIndex=m,this.bucketIndex=g,this.tileID=b}}class Xe{constructor(s){this.crossSourceCollisions=s,this.maxGroupID=0,this.collisionGroups={}}get(s){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[s]){const d=++this.maxGroupID;this.collisionGroups[s]={ID:d,predicate:m=>m.collisionGroupID===d}}return this.collisionGroups[s]}}function Ze(_,s,d,m,g){const{horizontalAlign:b,verticalAlign:P}=o.at(_);return new o.P(-(b-.5)*s+m[0]*g,-(P-.5)*d+m[1]*g)}function Pt(_,s,d,m,g,b){const{x1:P,x2:R,y1:D,y2:H,anchorPointX:$,anchorPointY:Z}=_,se=new o.P(s,d);return m&&se._rotate(g?b:-b),{x1:P+se.x,y1:D+se.y,x2:R+se.x,y2:H+se.y,anchorPointX:$,anchorPointY:Z}}class rn{constructor(s,d,m,g,b){this.transform=s.clone(),this.terrain=d,this.collisionIndex=new bn(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=m,this.retainedQueryData={},this.collisionGroups=new Xe(g),this.collisionCircleArrays={},this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(s,d,m,g){const b=m.getBucket(d),P=m.latestFeatureIndex;if(!b||!P||d.id!==b.layerIds[0])return;const R=m.collisionBoxArray,D=b.layers[0].layout,H=Math.pow(2,this.transform.zoom-m.tileID.overscaledZ),$=m.tileSize/o.W,Z=this.transform.calculatePosMatrix(m.tileID.toUnwrapped()),se=D.get("text-pitch-alignment")==="map",_e=D.get("text-rotation-alignment")==="map",ve=wn(m,1,this.transform.zoom),we=pt(Z,se,_e,this.transform,ve);let fe=null;if(se){const $e=Dt(Z,se,_e,this.transform,ve);fe=o.K([],this.transform.labelPlaneMatrix,$e)}this.retainedQueryData[b.bucketInstanceId]=new We(b.bucketInstanceId,P,b.sourceLayerIndex,b.index,m.tileID);const ze={bucket:b,layout:D,posMatrix:Z,textLabelPlaneMatrix:we,labelToScreenMatrix:fe,scale:H,textPixelRatio:$,holdingForFade:m.holdingForFade(),collisionBoxArray:R,partiallyEvaluatedTextSize:o.ag(b.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(g)for(const $e of b.sortKeyRanges){const{sortKey:Te,symbolInstanceStart:Be,symbolInstanceEnd:Ke}=$e;s.push({sortKey:Te,symbolInstanceStart:Be,symbolInstanceEnd:Ke,parameters:ze})}else s.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:ze})}attemptAnchorPlacement(s,d,m,g,b,P,R,D,H,$,Z,se,_e,ve,we,fe){const ze=o.ap[s.textAnchor],$e=[s.textOffset0,s.textOffset1],Te=Ze(ze,m,g,$e,b),Be=this.collisionIndex.placeCollisionBox(Pt(d,Te.x,Te.y,P,R,this.transform.angle),Z,D,H,$.predicate,fe);if((!we||this.collisionIndex.placeCollisionBox(Pt(we,Te.x,Te.y,P,R,this.transform.angle),Z,D,H,$.predicate,fe).box.length!==0)&&Be.box.length>0){let Ke;if(this.prevPlacement&&this.prevPlacement.variableOffsets[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID]&&this.prevPlacement.placements[se.crossTileID].text&&(Ke=this.prevPlacement.variableOffsets[se.crossTileID].anchor),se.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[se.crossTileID]={textOffset:$e,width:m,height:g,anchor:ze,textBoxScale:b,prevAnchor:Ke},this.markUsedJustification(_e,ze,se,ve),_e.allowVerticalPlacement&&(this.markUsedOrientation(_e,ve,se),this.placedOrientations[se.crossTileID]=ve),{shift:Te,placedGlyphBoxes:Be}}}placeLayerBucketPart(s,d,m){const{bucket:g,layout:b,posMatrix:P,textLabelPlaneMatrix:R,labelToScreenMatrix:D,textPixelRatio:H,holdingForFade:$,collisionBoxArray:Z,partiallyEvaluatedTextSize:se,collisionGroup:_e}=s.parameters,ve=b.get("text-optional"),we=b.get("icon-optional"),fe=o.aq(b,"text-overlap","text-allow-overlap"),ze=fe==="always",$e=o.aq(b,"icon-overlap","icon-allow-overlap"),Te=$e==="always",Be=b.get("text-rotation-alignment")==="map",Ke=b.get("text-pitch-alignment")==="map",Qe=b.get("icon-text-fit")!=="none",lt=b.get("symbol-z-order")==="viewport-y",bt=ze&&(Te||!g.hasIconData()||we),vt=Te&&(ze||!g.hasTextData()||ve);!g.collisionArrays&&Z&&g.deserializeCollisionBoxes(Z);const xt=this.retainedQueryData[g.bucketInstanceId].tileID,Zt=this.terrain?(Bt,Tn)=>this.terrain.getElevation(xt,Bt,Tn):null,zn=(Bt,Tn)=>{var Nn,Xn;if(d[Bt.crossTileID])return;if($)return void(this.placements[Bt.crossTileID]=new de(!1,!1,!1));let Rn=!1,Vn=!1,Hn=!0,Ii=null,mi={box:null,offscreen:null},qr={box:null,offscreen:null},Qi=null,vi=null,Er=null,Ua=0,cs=0,Uo=0;Tn.textFeatureIndex?Ua=Tn.textFeatureIndex:Bt.useRuntimeCollisionCircles&&(Ua=Bt.featureIndex),Tn.verticalTextFeatureIndex&&(cs=Tn.verticalTextFeatureIndex);const Vo=Tn.textBox;if(Vo){const Fi=Ai=>{let mr=o.ah.horizontal;if(g.allowVerticalPlacement&&!Ai&&this.prevPlacement){const ca=this.prevPlacement.placedOrientations[Bt.crossTileID];ca&&(this.placedOrientations[Bt.crossTileID]=ca,mr=ca,this.markUsedOrientation(g,mr,Bt))}return mr},wi=(Ai,mr)=>{if(g.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&Tn.verticalTextBox){for(const ca of g.writingModes)if(ca===o.ah.vertical?(mi=mr(),qr=mi):mi=Ai(),mi&&mi.box&&mi.box.length)break}else mi=Ai()},Vi=Bt.textAnchorOffsetStartIndex,ql=Bt.textAnchorOffsetEndIndex;if(ql===Vi){const Ai=(mr,ca)=>{const qn=this.collisionIndex.placeCollisionBox(mr,fe,H,P,_e.predicate,Zt);return qn&&qn.box&&qn.box.length&&(this.markUsedOrientation(g,ca,Bt),this.placedOrientations[Bt.crossTileID]=ca),qn};wi(()=>Ai(Vo,o.ah.horizontal),()=>{const mr=Tn.verticalTextBox;return g.allowVerticalPlacement&&Bt.numVerticalGlyphVertices>0&&mr?Ai(mr,o.ah.vertical):{box:null,offscreen:null}}),Fi(mi&&mi.box&&mi.box.length)}else{let Ai=o.ap[(Xn=(Nn=this.prevPlacement)===null||Nn===void 0?void 0:Nn.variableOffsets[Bt.crossTileID])===null||Xn===void 0?void 0:Xn.anchor];const mr=(qn,Qf,Nm)=>{const Ho=qn.x2-qn.x1,Go=qn.y2-qn.y1,Eh=Bt.textBoxScale,e0=Qe&&$e==="never"?Qf:null;let jo={box:[],offscreen:!1},Bm=fe==="never"?1:2,t0="never";Ai&&Bm++;for(let Om=0;Om<Bm;Om++){for(let lu=Vi;lu<ql;lu++){const Um=g.textAnchorOffsets.get(lu);if(Ai&&Um.textAnchor!==Ai)continue;const cu=this.attemptAnchorPlacement(Um,qn,Ho,Go,Eh,Be,Ke,H,P,_e,t0,Bt,g,Nm,e0,Zt);if(cu&&(jo=cu.placedGlyphBoxes,jo&&jo.box&&jo.box.length))return Rn=!0,Ii=cu.shift,jo}Ai?Ai=null:t0=fe}return jo};wi(()=>mr(Vo,Tn.iconBox,o.ah.horizontal),()=>{const qn=Tn.verticalTextBox;return g.allowVerticalPlacement&&!(mi&&mi.box&&mi.box.length)&&Bt.numVerticalGlyphVertices>0&&qn?mr(qn,Tn.verticalIconBox,o.ah.vertical):{box:null,offscreen:null}}),mi&&(Rn=mi.box,Hn=mi.offscreen);const ca=Fi(mi&&mi.box);if(!Rn&&this.prevPlacement){const qn=this.prevPlacement.variableOffsets[Bt.crossTileID];qn&&(this.variableOffsets[Bt.crossTileID]=qn,this.markUsedJustification(g,qn.anchor,Bt,ca))}}}if(Qi=mi,Rn=Qi&&Qi.box&&Qi.box.length>0,Hn=Qi&&Qi.offscreen,Bt.useRuntimeCollisionCircles){const Fi=g.text.placedSymbolArray.get(Bt.centerJustifiedTextSymbolIndex),wi=o.ai(g.textSizeData,se,Fi),Vi=b.get("text-padding");vi=this.collisionIndex.placeCollisionCircles(fe,Fi,g.lineVertexArray,g.glyphOffsetArray,wi,P,R,D,m,Ke,_e.predicate,Bt.collisionCircleDiameter,Vi,Zt),vi.circles.length&&vi.collisionDetected&&!m&&o.w("Collisions detected, but collision boxes are not shown"),Rn=ze||vi.circles.length>0&&!vi.collisionDetected,Hn=Hn&&vi.offscreen}if(Tn.iconFeatureIndex&&(Uo=Tn.iconFeatureIndex),Tn.iconBox){const Fi=wi=>{const Vi=Qe&&Ii?Pt(wi,Ii.x,Ii.y,Be,Ke,this.transform.angle):wi;return this.collisionIndex.placeCollisionBox(Vi,$e,H,P,_e.predicate,Zt)};qr&&qr.box&&qr.box.length&&Tn.verticalIconBox?(Er=Fi(Tn.verticalIconBox),Vn=Er.box.length>0):(Er=Fi(Tn.iconBox),Vn=Er.box.length>0),Hn=Hn&&Er.offscreen}const us=ve||Bt.numHorizontalGlyphVertices===0&&Bt.numVerticalGlyphVertices===0,Va=we||Bt.numIconVertices===0;if(us||Va?Va?us||(Vn=Vn&&Rn):Rn=Vn&&Rn:Vn=Rn=Vn&&Rn,Rn&&Qi&&Qi.box&&this.collisionIndex.insertCollisionBox(Qi.box,fe,b.get("text-ignore-placement"),g.bucketInstanceId,qr&&qr.box&&cs?cs:Ua,_e.ID),Vn&&Er&&this.collisionIndex.insertCollisionBox(Er.box,$e,b.get("icon-ignore-placement"),g.bucketInstanceId,Uo,_e.ID),vi&&(Rn&&this.collisionIndex.insertCollisionCircles(vi.circles,fe,b.get("text-ignore-placement"),g.bucketInstanceId,Ua,_e.ID),m)){const Fi=g.bucketInstanceId;let wi=this.collisionCircleArrays[Fi];wi===void 0&&(wi=this.collisionCircleArrays[Fi]=new Le);for(let Vi=0;Vi<vi.circles.length;Vi+=4)wi.circles.push(vi.circles[Vi+0]),wi.circles.push(vi.circles[Vi+1]),wi.circles.push(vi.circles[Vi+2]),wi.circles.push(vi.collisionDetected?1:0)}if(Bt.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(g.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Bt.crossTileID]=new de(Rn||bt,Vn||vt,Hn||g.justReloaded),d[Bt.crossTileID]=!0};if(lt){if(s.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Bt=g.getSortedSymbolIndexes(this.transform.angle);for(let Tn=Bt.length-1;Tn>=0;--Tn){const Nn=Bt[Tn];zn(g.symbolInstances.get(Nn),g.collisionArrays[Nn])}}else for(let Bt=s.symbolInstanceStart;Bt<s.symbolInstanceEnd;Bt++)zn(g.symbolInstances.get(Bt),g.collisionArrays[Bt]);if(m&&g.bucketInstanceId in this.collisionCircleArrays){const Bt=this.collisionCircleArrays[g.bucketInstanceId];o.ar(Bt.invProjMatrix,P),Bt.viewportMatrix=this.collisionIndex.getViewportMatrix()}g.justReloaded=!1}markUsedJustification(s,d,m,g){let b;b=g===o.ah.vertical?m.verticalPlacedTextSymbolIndex:{left:m.leftJustifiedTextSymbolIndex,center:m.centerJustifiedTextSymbolIndex,right:m.rightJustifiedTextSymbolIndex}[o.as(d)];const P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex,m.verticalPlacedTextSymbolIndex];for(const R of P)R>=0&&(s.text.placedSymbolArray.get(R).crossTileID=b>=0&&R!==b?0:m.crossTileID)}markUsedOrientation(s,d,m){const g=d===o.ah.horizontal||d===o.ah.horizontalOnly?d:0,b=d===o.ah.vertical?d:0,P=[m.leftJustifiedTextSymbolIndex,m.centerJustifiedTextSymbolIndex,m.rightJustifiedTextSymbolIndex];for(const R of P)s.text.placedSymbolArray.get(R).placedOrientation=g;m.verticalPlacedTextSymbolIndex&&(s.text.placedSymbolArray.get(m.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(s){this.commitTime=s,this.zoomAtLastRecencyCheck=this.transform.zoom;const d=this.prevPlacement;let m=!1;this.prevZoomAdjustment=d?d.zoomAdjustment(this.transform.zoom):0;const g=d?d.symbolFadeChange(s):1,b=d?d.opacities:{},P=d?d.variableOffsets:{},R=d?d.placedOrientations:{};for(const D in this.placements){const H=this.placements[D],$=b[D];$?(this.opacities[D]=new ei($,g,H.text,H.icon),m=m||H.text!==$.text.placed||H.icon!==$.icon.placed):(this.opacities[D]=new ei(null,g,H.text,H.icon,H.skipFade),m=m||H.text||H.icon)}for(const D in b){const H=b[D];if(!this.opacities[D]){const $=new ei(H,g,!1,!1);$.isHidden()||(this.opacities[D]=$,m=m||H.text.placed||H.icon.placed)}}for(const D in P)this.variableOffsets[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.variableOffsets[D]=P[D]);for(const D in R)this.placedOrientations[D]||!this.opacities[D]||this.opacities[D].isHidden()||(this.placedOrientations[D]=R[D]);if(d&&d.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");m?this.lastPlacementChangeTime=s:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=d?d.lastPlacementChangeTime:s)}updateLayerOpacities(s,d){const m={};for(const g of d){const b=g.getBucket(s);b&&g.latestFeatureIndex&&s.id===b.layerIds[0]&&this.updateBucketOpacities(b,m,g.collisionBoxArray)}}updateBucketOpacities(s,d,m){s.hasTextData()&&(s.text.opacityVertexArray.clear(),s.text.hasVisibleVertices=!1),s.hasIconData()&&(s.icon.opacityVertexArray.clear(),s.icon.hasVisibleVertices=!1),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexArray.clear(),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexArray.clear();const g=s.layers[0],b=g.layout,P=new ei(null,0,!1,!1,!0),R=b.get("text-allow-overlap"),D=b.get("icon-allow-overlap"),H=g._unevaluatedLayout.hasValue("text-variable-anchor")||g._unevaluatedLayout.hasValue("text-variable-anchor-offset"),$=b.get("text-rotation-alignment")==="map",Z=b.get("text-pitch-alignment")==="map",se=b.get("icon-text-fit")!=="none",_e=new ei(null,0,R&&(D||!s.hasIconData()||b.get("icon-optional")),D&&(R||!s.hasTextData()||b.get("text-optional")),!0);!s.collisionArrays&&m&&(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData())&&s.deserializeCollisionBoxes(m);const ve=(we,fe,ze)=>{for(let $e=0;$e<fe/4;$e++)we.opacityVertexArray.emplaceBack(ze);we.hasVisibleVertices=we.hasVisibleVertices||ze!==Wn};for(let we=0;we<s.symbolInstances.length;we++){const fe=s.symbolInstances.get(we),{numHorizontalGlyphVertices:ze,numVerticalGlyphVertices:$e,crossTileID:Te}=fe;let Be=this.opacities[Te];d[Te]?Be=P:Be||(Be=_e,this.opacities[Te]=Be),d[Te]=!0;const Ke=fe.numIconVertices>0,Qe=this.placedOrientations[fe.crossTileID],lt=Qe===o.ah.vertical,bt=Qe===o.ah.horizontal||Qe===o.ah.horizontalOnly;if(ze>0||$e>0){const vt=Ma(Be.text);ve(s.text,ze,lt?Wn:vt),ve(s.text,$e,bt?Wn:vt);const xt=Be.text.isHidden();[fe.rightJustifiedTextSymbolIndex,fe.centerJustifiedTextSymbolIndex,fe.leftJustifiedTextSymbolIndex].forEach(Bt=>{Bt>=0&&(s.text.placedSymbolArray.get(Bt).hidden=xt||lt?1:0)}),fe.verticalPlacedTextSymbolIndex>=0&&(s.text.placedSymbolArray.get(fe.verticalPlacedTextSymbolIndex).hidden=xt||bt?1:0);const Zt=this.variableOffsets[fe.crossTileID];Zt&&this.markUsedJustification(s,Zt.anchor,fe,Qe);const zn=this.placedOrientations[fe.crossTileID];zn&&(this.markUsedJustification(s,"left",fe,zn),this.markUsedOrientation(s,zn,fe))}if(Ke){const vt=Ma(Be.icon),xt=!(se&&fe.verticalPlacedIconSymbolIndex&&lt);fe.placedIconSymbolIndex>=0&&(ve(s.icon,fe.numIconVertices,xt?vt:Wn),s.icon.placedSymbolArray.get(fe.placedIconSymbolIndex).hidden=Be.icon.isHidden()),fe.verticalPlacedIconSymbolIndex>=0&&(ve(s.icon,fe.numVerticalIconVertices,xt?Wn:vt),s.icon.placedSymbolArray.get(fe.verticalPlacedIconSymbolIndex).hidden=Be.icon.isHidden())}if(s.hasIconCollisionBoxData()||s.hasTextCollisionBoxData()){const vt=s.collisionArrays[we];if(vt){let xt=new o.P(0,0);if(vt.textBox||vt.verticalTextBox){let zn=!0;if(H){const Bt=this.variableOffsets[Te];Bt?(xt=Ze(Bt.anchor,Bt.width,Bt.height,Bt.textOffset,Bt.textBoxScale),$&&xt._rotate(Z?this.transform.angle:-this.transform.angle)):zn=!1}vt.textBox&&It(s.textCollisionBox.collisionVertexArray,Be.text.placed,!zn||lt,xt.x,xt.y),vt.verticalTextBox&&It(s.textCollisionBox.collisionVertexArray,Be.text.placed,!zn||bt,xt.x,xt.y)}const Zt=!!(!bt&&vt.verticalIconBox);vt.iconBox&&It(s.iconCollisionBox.collisionVertexArray,Be.icon.placed,Zt,se?xt.x:0,se?xt.y:0),vt.verticalIconBox&&It(s.iconCollisionBox.collisionVertexArray,Be.icon.placed,!Zt,se?xt.x:0,se?xt.y:0)}}}if(s.sortFeatures(this.transform.angle),this.retainedQueryData[s.bucketInstanceId]&&(this.retainedQueryData[s.bucketInstanceId].featureSortOrder=s.featureSortOrder),s.hasTextData()&&s.text.opacityVertexBuffer&&s.text.opacityVertexBuffer.updateData(s.text.opacityVertexArray),s.hasIconData()&&s.icon.opacityVertexBuffer&&s.icon.opacityVertexBuffer.updateData(s.icon.opacityVertexArray),s.hasIconCollisionBoxData()&&s.iconCollisionBox.collisionVertexBuffer&&s.iconCollisionBox.collisionVertexBuffer.updateData(s.iconCollisionBox.collisionVertexArray),s.hasTextCollisionBoxData()&&s.textCollisionBox.collisionVertexBuffer&&s.textCollisionBox.collisionVertexBuffer.updateData(s.textCollisionBox.collisionVertexArray),s.text.opacityVertexArray.length!==s.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${s.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${s.text.layoutVertexArray.length}) / 4`);if(s.icon.opacityVertexArray.length!==s.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${s.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${s.icon.layoutVertexArray.length}) / 4`);if(s.bucketInstanceId in this.collisionCircleArrays){const we=this.collisionCircleArrays[s.bucketInstanceId];s.placementInvProjMatrix=we.invProjMatrix,s.placementViewportMatrix=we.viewportMatrix,s.collisionCircleArray=we.circles,delete this.collisionCircleArrays[s.bucketInstanceId]}}symbolFadeChange(s){return this.fadeDuration===0?1:(s-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(s){return Math.max(0,(this.transform.zoom-s)/1.5)}hasTransitions(s){return this.stale||s-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(s,d){const m=this.zoomAtLastRecencyCheck===d?1-this.zoomAdjustment(d):1;return this.zoomAtLastRecencyCheck=d,this.commitTime+this.fadeDuration*m>s}setStale(){this.stale=!0}}function It(_,s,d,m,g){_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0),_.emplaceBack(s?1:0,d?1:0,m||0,g||0)}const Qt=Math.pow(2,25),Sn=Math.pow(2,24),Xt=Math.pow(2,17),Fn=Math.pow(2,16),Ei=Math.pow(2,9),gi=Math.pow(2,8),ci=Math.pow(2,1);function Ma(_){if(_.opacity===0&&!_.placed)return 0;if(_.opacity===1&&_.placed)return 4294967295;const s=_.placed?1:0,d=Math.floor(127*_.opacity);return d*Qt+s*Sn+d*Xt+s*Fn+d*Ei+s*gi+d*ci+s}const Wn=0;class Pn{constructor(s){this._sortAcrossTiles=s.layout.get("symbol-z-order")!=="viewport-y"&&!s.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(s,d,m,g,b){const P=this._bucketParts;for(;this._currentTileIndex<s.length;)if(d.getBucketParts(P,g,s[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((R,D)=>R.sortKey-D.sortKey));this._currentPartIndex<P.length;)if(d.placeLayerBucketPart(P[this._currentPartIndex],this._seenCrossTileIDs,m),this._currentPartIndex++,b())return!0;return!1}}class Al{constructor(s,d,m,g,b,P,R,D){this.placement=new rn(s,d,P,R,D),this._currentPlacementIndex=m.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=b,this._done=!1}isDone(){return this._done}continuePlacement(s,d,m){const g=M.now(),b=()=>!this._forceFullPlacement&&M.now()-g>2;for(;this._currentPlacementIndex>=0;){const P=d[s[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(P.type==="symbol"&&(!P.minzoom||P.minzoom<=R)&&(!P.maxzoom||P.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new Pn(P)),this._inProgressLayer.continuePlacement(m[P.source],this.placement,this._showCollisionBoxes,P,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(s){return this.placement.commit(s),this.placement}}const oi=512/o.W/2;class fi{constructor(s,d,m){this.tileID=s,this.bucketInstanceId=m,this._symbolsByKey={};const g=new Map;for(let b=0;b<d.length;b++){const P=d.get(b),R=P.key,D=g.get(R);D?D.push(P):g.set(R,[P])}for(const[b,P]of g){const R={positions:P.map(D=>({x:Math.floor(D.anchorX*oi),y:Math.floor(D.anchorY*oi)})),crossTileIDs:P.map(D=>D.crossTileID)};if(R.positions.length>128){const D=new o.au(R.positions.length,16,Uint16Array);for(const{x:H,y:$}of R.positions)D.add(H,$);D.finish(),delete R.positions,R.index=D}this._symbolsByKey[b]=R}}getScaledCoordinates(s,d){const{x:m,y:g,z:b}=this.tileID.canonical,{x:P,y:R,z:D}=d.canonical,H=oi/Math.pow(2,D-b),$=(R*o.W+s.anchorY)*H,Z=g*o.W*oi;return{x:Math.floor((P*o.W+s.anchorX)*H-m*o.W*oi),y:Math.floor($-Z)}}findMatches(s,d,m){const g=this.tileID.canonical.z<d.canonical.z?1:Math.pow(2,this.tileID.canonical.z-d.canonical.z);for(let b=0;b<s.length;b++){const P=s.get(b);if(P.crossTileID)continue;const R=this._symbolsByKey[P.key];if(!R)continue;const D=this.getScaledCoordinates(P,d);if(R.index){const H=R.index.range(D.x-g,D.y-g,D.x+g,D.y+g).sort();for(const $ of H){const Z=R.crossTileIDs[$];if(!m[Z]){m[Z]=!0,P.crossTileID=Z;break}}}else if(R.positions)for(let H=0;H<R.positions.length;H++){const $=R.positions[H],Z=R.crossTileIDs[H];if(Math.abs($.x-D.x)<=g&&Math.abs($.y-D.y)<=g&&!m[Z]){m[Z]=!0,P.crossTileID=Z;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:s})=>s)}}class Qs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class sa{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(s){const d=Math.round((s-this.lng)/360);if(d!==0)for(const m in this.indexes){const g=this.indexes[m],b={};for(const P in g){const R=g[P];R.tileID=R.tileID.unwrapTo(R.tileID.wrap+d),b[R.tileID.key]=R}this.indexes[m]=b}this.lng=s}addBucket(s,d,m){if(this.indexes[s.overscaledZ]&&this.indexes[s.overscaledZ][s.key]){if(this.indexes[s.overscaledZ][s.key].bucketInstanceId===d.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(s.overscaledZ,this.indexes[s.overscaledZ][s.key])}for(let b=0;b<d.symbolInstances.length;b++)d.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[s.overscaledZ]||(this.usedCrossTileIDs[s.overscaledZ]={});const g=this.usedCrossTileIDs[s.overscaledZ];for(const b in this.indexes){const P=this.indexes[b];if(Number(b)>s.overscaledZ)for(const R in P){const D=P[R];D.tileID.isChildOf(s)&&D.findMatches(d.symbolInstances,s,g)}else{const R=P[s.scaledTo(Number(b)).key];R&&R.findMatches(d.symbolInstances,s,g)}}for(let b=0;b<d.symbolInstances.length;b++){const P=d.symbolInstances.get(b);P.crossTileID||(P.crossTileID=m.generate(),g[P.crossTileID]=!0)}return this.indexes[s.overscaledZ]===void 0&&(this.indexes[s.overscaledZ]={}),this.indexes[s.overscaledZ][s.key]=new fi(s,d.symbolInstances,d.bucketInstanceId),!0}removeBucketCrossTileIDs(s,d){for(const m of d.getCrossTileIDsLists())for(const g of m)delete this.usedCrossTileIDs[s][g]}removeStaleBuckets(s){let d=!1;for(const m in this.indexes){const g=this.indexes[m];for(const b in g)s[g[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(m,g[b]),delete g[b],d=!0)}return d}}class xi{constructor(){this.layerIndexes={},this.crossTileIDs=new Qs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(s,d,m){let g=this.layerIndexes[s.id];g===void 0&&(g=this.layerIndexes[s.id]=new sa);let b=!1;const P={};g.handleWrapJump(m);for(const R of d){const D=R.getBucket(s);D&&s.id===D.layerIds[0]&&(D.bucketInstanceId||(D.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(R.tileID,D,this.crossTileIDs)&&(b=!0),P[D.bucketInstanceId]=!0)}return g.removeStaleBuckets(P)&&(b=!0),b}pruneUnusedLayers(s){const d={};s.forEach(m=>{d[m]=!0});for(const m in this.layerIndexes)d[m]||delete this.layerIndexes[m]}}const Ri=(_,s)=>o.t(_,s&&s.filter(d=>d.identifier!=="source.canvas")),Ji=o.av();class eo extends o.E{constructor(s,d={}){super(),this._rtlPluginLoaded=()=>{for(const m in this.sourceCaches){const g=this.sourceCaches[m].getSource().type;g!=="vector"&&g!=="geojson"||this.sourceCaches[m].reload()}},this.map=s,this.dispatcher=new En(gn(),s._getMapId()),this.dispatcher.registerMessageHandler("getGlyphs",(m,g)=>this.getGlyphs(m,g)),this.dispatcher.registerMessageHandler("getImages",(m,g)=>this.getImages(m,g)),this.imageManager=new He,this.imageManager.setEventedParent(this),this.glyphManager=new De(s._requestManager,d.localIdeographFontFamily),this.lineAtlas=new Lt(256,512),this.crossTileSymbolIndex=new xi,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new o.aw,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",o.ax()),tn().on(Nt,this._rtlPluginLoaded),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const g=this.sourceCaches[m.sourceId];if(!g)return;const b=g.getSource();if(b&&b.vectorLayerIds)for(const P in this._layers){const R=this._layers[P];R.source===b.id&&this._validateLayer(R)}})}loadURL(s,d={},m){this.fire(new o.k("dataloading",{dataType:"style"})),d.validate=typeof d.validate!="boolean"||d.validate;const g=this.map._requestManager.transformRequest(s,J.Style);this._loadStyleRequest=new AbortController,o.h(g,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,d,m)}).catch(b=>{this._loadStyleRequest=null,b&&this.fire(new o.j(b))})}loadJSON(s,d={},m){this.fire(new o.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,d.validate=d.validate!==!1,this._load(s,d,m)}).catch(()=>{})}loadEmpty(){this.fire(new o.k("dataloading",{dataType:"style"})),this._load(Ji,{validate:!1})}_load(s,d,m){var g;const b=d.transformStyle?d.transformStyle(m,s):s;if(!d.validate||!Ri(this,o.x(b))){this._loaded=!0,this.stylesheet=b;for(const P in b.sources)this.addSource(P,b.sources[P],{validate:!1});b.sprite?this._loadSprite(b.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(b.glyphs),this._createLayers(),this.light=new _t(this.stylesheet.light),this.map.setTerrain((g=this.stylesheet.terrain)!==null&&g!==void 0?g:null),this.fire(new o.k("data",{dataType:"style"})),this.fire(new o.k("style.load"))}}_createLayers(){const s=o.ay(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",s),this._order=s.map(d=>d.id),this._layers={},this._serializedLayers=null;for(const d of s){const m=o.az(d);m.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=m}}_loadSprite(s,d=!1,m=void 0){let g;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(b,P,R,D){return o._(this,void 0,void 0,function*(){const H=Me(b),$=R>1?"@2x":"",Z={},se={};for(const{id:_e,url:ve}of H){const we=P.transformRequest(P.normalizeSpriteURL(ve,$,".json"),J.SpriteJSON);Z[_e]=o.h(we,D);const fe=P.transformRequest(P.normalizeSpriteURL(ve,$,".png"),J.SpriteImage);se[_e]=O.getImage(fe,D)}return yield Promise.all([...Object.values(Z),...Object.values(se)]),function(_e,ve){return o._(this,void 0,void 0,function*(){const we={};for(const fe in _e){we[fe]={};const ze=M.getImageCanvasContext((yield ve[fe]).data),$e=(yield _e[fe]).data;for(const Te in $e){const{width:Be,height:Ke,x:Qe,y:lt,sdf:bt,pixelRatio:vt,stretchX:xt,stretchY:Zt,content:zn}=$e[Te];we[fe][Te]={data:null,pixelRatio:vt,sdf:bt,stretchX:xt,stretchY:Zt,content:zn,spriteData:{width:Be,height:Ke,x:Qe,y:lt,context:ze}}}}return we})}(Z,se)})}(s,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(b=>{if(this._spriteRequest=null,b)for(const P in b){this._spritesImagesIds[P]=[];const R=this._spritesImagesIds[P]?this._spritesImagesIds[P].filter(D=>!(D in b)):[];for(const D of R)this.imageManager.removeImage(D),this._changedImages[D]=!0;for(const D in b[P]){const H=P==="default"?D:`${P}:${D}`;this._spritesImagesIds[P].push(H),H in this.imageManager.images?this.imageManager.updateImage(H,b[P][D],!1):this.imageManager.addImage(H,b[P][D]),d&&(this._changedImages[H]=!0)}}}).catch(b=>{this._spriteRequest=null,g=b,this.fire(new o.j(g))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),d&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"})),m&&m(g)})}_unloadSprite(){for(const s of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(s),this._changedImages[s]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}_validateLayer(s){const d=this.sourceCaches[s.source];if(!d)return;const m=s.sourceLayer;if(!m)return;const g=d.getSource();(g.type==="geojson"||g.vectorLayerIds&&g.vectorLayerIds.indexOf(m)===-1)&&this.fire(new o.j(new Error(`Source layer "${m}" does not exist on source "${g.id}" as specified by style layer "${s.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const s in this.sourceCaches)if(!this.sourceCaches[s].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(s){const d=this._serializedAllLayers();if(!s||s.length===0)return Object.values(d);const m=[];for(const g of s)d[g]&&m.push(d[g]);return m}_serializedAllLayers(){let s=this._serializedLayers;if(s)return s;s=this._serializedLayers={};const d=Object.keys(this._layers);for(const m of d){const g=this._layers[m];g.type!=="custom"&&(s[m]=g.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const s in this.sourceCaches)if(this.sourceCaches[s].hasTransition())return!0;for(const s in this._layers)if(this._layers[s].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(s){if(!this._loaded)return;const d=this._changed;if(this._changed){const g=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(g.length||b.length)&&this._updateWorkerLayers(g,b);for(const P in this._updatedSources){const R=this._updatedSources[P];if(R==="reload")this._reloadSource(P);else{if(R!=="clear")throw new Error(`Invalid action ${R}`);this._clearSource(P)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(s);this.light.updateTransitions(s),this._resetUpdates()}const m={};for(const g in this.sourceCaches){const b=this.sourceCaches[g];m[g]=b.used,b.used=!1}for(const g of this._order){const b=this._layers[g];b.recalculate(s,this._availableImages),!b.isHidden(s.zoom)&&b.source&&(this.sourceCaches[b.source].used=!0)}for(const g in m){const b=this.sourceCaches[g];m[g]!==b.used&&b.fire(new o.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:g}))}this.light.recalculate(s),this.z=s.zoom,d&&this.fire(new o.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const s=Object.keys(this._changedImages);if(s.length){for(const d in this.sourceCaches)this.sourceCaches[d].reloadTilesForDependencies(["icons","patterns"],s);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(s,d){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(s),removedIds:d})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(s,d={}){var m;this._checkLoaded();const g=this.serialize();if(s=d.transformStyle?d.transformStyle(g,s):s,((m=d.validate)===null||m===void 0||m)&&Ri(this,o.x(s)))return!1;(s=o.aA(s)).layers=o.ay(s.layers);const b=o.aB(g,s),P=this._getOperationsToPerform(b);if(P.unimplemented.length>0)throw new Error(`Unimplemented: ${P.unimplemented.join(", ")}.`);if(P.operations.length===0)return!1;for(const R of P.operations)R();return this.stylesheet=s,this._serializedLayers=null,!0}_getOperationsToPerform(s){const d=[],m=[];for(const g of s)switch(g.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":d.push(()=>this.addLayer.apply(this,g.args));break;case"removeLayer":d.push(()=>this.removeLayer.apply(this,g.args));break;case"setPaintProperty":d.push(()=>this.setPaintProperty.apply(this,g.args));break;case"setLayoutProperty":d.push(()=>this.setLayoutProperty.apply(this,g.args));break;case"setFilter":d.push(()=>this.setFilter.apply(this,g.args));break;case"addSource":d.push(()=>this.addSource.apply(this,g.args));break;case"removeSource":d.push(()=>this.removeSource.apply(this,g.args));break;case"setLayerZoomRange":d.push(()=>this.setLayerZoomRange.apply(this,g.args));break;case"setLight":d.push(()=>this.setLight.apply(this,g.args));break;case"setGeoJSONSourceData":d.push(()=>this.setGeoJSONSourceData.apply(this,g.args));break;case"setGlyphs":d.push(()=>this.setGlyphs.apply(this,g.args));break;case"setSprite":d.push(()=>this.setSprite.apply(this,g.args));break;case"setTerrain":d.push(()=>this.map.setTerrain.apply(this,g.args));break;case"setTransition":d.push(()=>{});break;default:m.push(g.command)}return{operations:d,unimplemented:m}}addImage(s,d){if(this.getImage(s))return this.fire(new o.j(new Error(`An image named "${s}" already exists.`)));this.imageManager.addImage(s,d),this._afterImageUpdated(s)}updateImage(s,d){this.imageManager.updateImage(s,d)}getImage(s){return this.imageManager.getImage(s)}removeImage(s){if(!this.getImage(s))return this.fire(new o.j(new Error(`An image named "${s}" does not exist.`)));this.imageManager.removeImage(s),this._afterImageUpdated(s)}_afterImageUpdated(s){this._availableImages=this.imageManager.listImages(),this._changedImages[s]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(s,d,m={}){if(this._checkLoaded(),this.sourceCaches[s]!==void 0)throw new Error(`Source "${s}" already exists.`);if(!d.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(d).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(d.type)>=0&&this._validate(o.x.source,`sources.${s}`,d,null,m))return;this.map&&this.map._collectResourceTiming&&(d.collectResourceTiming=!0);const g=this.sourceCaches[s]=new dt(s,d,this.dispatcher);g.style=this,g.setEventedParent(this,()=>({isSourceLoaded:g.loaded(),source:g.serialize(),sourceId:s})),g.onAdd(this.map),this._changed=!0}removeSource(s){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error("There is no source with this ID");for(const m in this._layers)if(this._layers[m].source===s)return this.fire(new o.j(new Error(`Source "${s}" cannot be removed while layer "${m}" is using it.`)));const d=this.sourceCaches[s];delete this.sourceCaches[s],delete this._updatedSources[s],d.fire(new o.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:s})),d.setEventedParent(null),d.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(s,d){if(this._checkLoaded(),this.sourceCaches[s]===void 0)throw new Error(`There is no source with this ID=${s}`);const m=this.sourceCaches[s].getSource();if(m.type!=="geojson")throw new Error(`geojsonSource.type is ${m.type}, which is !== 'geojson`);m.setData(d),this._changed=!0}getSource(s){return this.sourceCaches[s]&&this.sourceCaches[s].getSource()}addLayer(s,d,m={}){this._checkLoaded();const g=s.id;if(this.getLayer(g))return void this.fire(new o.j(new Error(`Layer "${g}" already exists on this map.`)));let b;if(s.type==="custom"){if(Ri(this,o.aC(s)))return;b=o.az(s)}else{if("source"in s&&typeof s.source=="object"&&(this.addSource(g,s.source),s=o.aA(s),s=o.e(s,{source:g})),this._validate(o.x.layer,`layers.${g}`,s,{arrayIndex:-1},m))return;b=o.az(s),this._validateLayer(b),b.setEventedParent(this,{layer:{id:g}})}const P=d?this._order.indexOf(d):this._order.length;if(d&&P===-1)this.fire(new o.j(new Error(`Cannot add layer "${g}" before non-existing layer "${d}".`)));else{if(this._order.splice(P,0,g),this._layerOrderChanged=!0,this._layers[g]=b,this._removedLayers[g]&&b.source&&b.type!=="custom"){const R=this._removedLayers[g];delete this._removedLayers[g],R.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",this.sourceCaches[b.source].pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map)}}moveLayer(s,d){if(this._checkLoaded(),this._changed=!0,!this._layers[s])return void this.fire(new o.j(new Error(`The layer '${s}' does not exist in the map's style and cannot be moved.`)));if(s===d)return;const m=this._order.indexOf(s);this._order.splice(m,1);const g=d?this._order.indexOf(d):this._order.length;d&&g===-1?this.fire(new o.j(new Error(`Cannot move layer "${s}" before non-existing layer "${d}".`))):(this._order.splice(g,0,s),this._layerOrderChanged=!0)}removeLayer(s){this._checkLoaded();const d=this._layers[s];if(!d)return void this.fire(new o.j(new Error(`Cannot remove non-existing layer "${s}".`)));d.setEventedParent(null);const m=this._order.indexOf(s);this._order.splice(m,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[s]=d,delete this._layers[s],this._serializedLayers&&delete this._serializedLayers[s],delete this._updatedLayers[s],delete this._updatedPaintProps[s],d.onRemove&&d.onRemove(this.map)}getLayer(s){return this._layers[s]}getLayersOrder(){return[...this._order]}hasLayer(s){return s in this._layers}setLayerZoomRange(s,d,m){this._checkLoaded();const g=this.getLayer(s);g?g.minzoom===d&&g.maxzoom===m||(d!=null&&(g.minzoom=d),m!=null&&(g.maxzoom=m),this._updateLayer(g)):this.fire(new o.j(new Error(`Cannot set the zoom range of non-existing layer "${s}".`)))}setFilter(s,d,m={}){this._checkLoaded();const g=this.getLayer(s);if(g){if(!o.aD(g.filter,d))return d==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(o.x.filter,`layers.${g.id}.filter`,d,null,m)||(g.filter=o.aA(d),this._updateLayer(g)))}else this.fire(new o.j(new Error(`Cannot filter non-existing layer "${s}".`)))}getFilter(s){return o.aA(this.getLayer(s).filter)}setLayoutProperty(s,d,m,g={}){this._checkLoaded();const b=this.getLayer(s);b?o.aD(b.getLayoutProperty(d),m)||(b.setLayoutProperty(d,m,g),this._updateLayer(b)):this.fire(new o.j(new Error(`Cannot style non-existing layer "${s}".`)))}getLayoutProperty(s,d){const m=this.getLayer(s);if(m)return m.getLayoutProperty(d);this.fire(new o.j(new Error(`Cannot get style of non-existing layer "${s}".`)))}setPaintProperty(s,d,m,g={}){this._checkLoaded();const b=this.getLayer(s);b?o.aD(b.getPaintProperty(d),m)||(b.setPaintProperty(d,m,g)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[s]=!0):this.fire(new o.j(new Error(`Cannot style non-existing layer "${s}".`)))}getPaintProperty(s,d){return this.getLayer(s).getPaintProperty(d)}setFeatureState(s,d){this._checkLoaded();const m=s.source,g=s.sourceLayer,b=this.sourceCaches[m];if(b===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const P=b.getSource().type;P==="geojson"&&g?this.fire(new o.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):P!=="vector"||g?(s.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),b.setFeatureState(g,s.id,d)):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(s,d){this._checkLoaded();const m=s.source,g=this.sourceCaches[m];if(g===void 0)return void this.fire(new o.j(new Error(`The source '${m}' does not exist in the map's style.`)));const b=g.getSource().type,P=b==="vector"?s.sourceLayer:void 0;b!=="vector"||P?d&&typeof s.id!="string"&&typeof s.id!="number"?this.fire(new o.j(new Error("A feature id is required to remove its specific state property."))):g.removeFeatureState(P,s.id,d):this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(s){this._checkLoaded();const d=s.source,m=s.sourceLayer,g=this.sourceCaches[d];if(g!==void 0)return g.getSource().type!=="vector"||m?(s.id===void 0&&this.fire(new o.j(new Error("The feature id parameter must be provided."))),g.getFeatureState(m,s.id)):void this.fire(new o.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new o.j(new Error(`The source '${d}' does not exist in the map's style.`)))}getTransition(){return o.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const s=o.aE(this.sourceCaches,b=>b.serialize()),d=this._serializeByIds(this._order),m=this.map.getTerrain()||void 0,g=this.stylesheet;return o.aF({version:g.version,name:g.name,metadata:g.metadata,light:g.light,center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch,sprite:g.sprite,glyphs:g.glyphs,transition:g.transition,sources:s,layers:d,terrain:m},b=>b!==void 0)}_updateLayer(s){this._updatedLayers[s.id]=!0,s.source&&!this._updatedSources[s.source]&&this.sourceCaches[s.source].getSource().type!=="raster"&&(this._updatedSources[s.source]="reload",this.sourceCaches[s.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(s){const d=P=>this._layers[P].type==="fill-extrusion",m={},g=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(d(R)){m[R]=P;for(const D of s){const H=D[R];if(H)for(const $ of H)g.push($)}}}g.sort((P,R)=>R.intersectionZ-P.intersectionZ);const b=[];for(let P=this._order.length-1;P>=0;P--){const R=this._order[P];if(d(R))for(let D=g.length-1;D>=0;D--){const H=g[D].feature;if(m[H.layer.id]<P)break;b.push(H),g.pop()}else for(const D of s){const H=D[R];if(H)for(const $ of H)b.push($.feature)}}return b}queryRenderedFeatures(s,d,m){d&&d.filter&&this._validate(o.x.filter,"queryRenderedFeatures.filter",d.filter,null,d);const g={};if(d&&d.layers){if(!Array.isArray(d.layers))return this.fire(new o.j(new Error("parameters.layers must be an Array."))),[];for(const R of d.layers){const D=this._layers[R];if(!D)return this.fire(new o.j(new Error(`The layer '${R}' does not exist in the map's style and cannot be queried for features.`))),[];g[D.source]=!0}}const b=[];d.availableImages=this._availableImages;const P=this._serializedAllLayers();for(const R in this.sourceCaches)d.layers&&!g[R]||b.push(An(this.sourceCaches[R],this._layers,P,s,d,m));return this.placement&&b.push(function(R,D,H,$,Z,se,_e){const ve={},we=se.queryRenderedSymbols($),fe=[];for(const ze of Object.keys(we).map(Number))fe.push(_e[ze]);fe.sort(yn);for(const ze of fe){const $e=ze.featureIndex.lookupSymbolFeatures(we[ze.bucketInstanceId],D,ze.bucketIndex,ze.sourceLayerIndex,Z.filter,Z.layers,Z.availableImages,R);for(const Te in $e){const Be=ve[Te]=ve[Te]||[],Ke=$e[Te];Ke.sort((Qe,lt)=>{const bt=ze.featureSortOrder;if(bt){const vt=bt.indexOf(Qe.featureIndex);return bt.indexOf(lt.featureIndex)-vt}return lt.featureIndex-Qe.featureIndex});for(const Qe of Ke)Be.push(Qe)}}for(const ze in ve)ve[ze].forEach($e=>{const Te=$e.feature,Be=H[R[ze].source].getFeatureState(Te.layer["source-layer"],Te.id);Te.source=Te.layer.source,Te.layer["source-layer"]&&(Te.sourceLayer=Te.layer["source-layer"]),Te.state=Be});return ve}(this._layers,P,this.sourceCaches,s,d,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(s,d){d&&d.filter&&this._validate(o.x.filter,"querySourceFeatures.filter",d.filter,null,d);const m=this.sourceCaches[s];return m?function(g,b){const P=g.getRenderableIds().map(H=>g.getTileByID(H)),R=[],D={};for(let H=0;H<P.length;H++){const $=P[H],Z=$.tileID.canonical.key;D[Z]||(D[Z]=!0,$.querySourceFeatures(R,b))}return R}(m,d):[]}getLight(){return this.light.getLight()}setLight(s,d={}){this._checkLoaded();const m=this.light.getLight();let g=!1;for(const P in s)if(!o.aD(s[P],m[P])){g=!0;break}if(!g)return;const b={now:M.now(),transition:o.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(s,d),this.light.updateTransitions(b)}_validate(s,d,m,g,b={}){return(!b||b.validate!==!1)&&Ri(this,s.call(o.x,o.e({key:d,style:this.serialize(),value:m,styleSpec:o.v},g)))}_remove(s=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),tn().off(Nt,this._rtlPluginLoaded);for(const d in this._layers)this._layers[d].setEventedParent(null);for(const d in this.sourceCaches){const m=this.sourceCaches[d];m.setEventedParent(null),m.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),s&&this.dispatcher.broadcast("removeMap",void 0),this.dispatcher.remove(s)}_clearSource(s){this.sourceCaches[s].clearTiles()}_reloadSource(s){this.sourceCaches[s].resume(),this.sourceCaches[s].reload()}_updateSources(s){for(const d in this.sourceCaches)this.sourceCaches[d].update(s,this.map.terrain)}_generateCollisionBoxes(){for(const s in this.sourceCaches)this._reloadSource(s)}_updatePlacement(s,d,m,g,b=!1){let P=!1,R=!1;const D={};for(const H of this._order){const $=this._layers[H];if($.type!=="symbol")continue;if(!D[$.source]){const se=this.sourceCaches[$.source];D[$.source]=se.getRenderableIds(!0).map(_e=>se.getTileByID(_e)).sort((_e,ve)=>ve.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(ve.tileID)?-1:1))}const Z=this.crossTileSymbolIndex.addLayer($,D[$.source],s.center.lng);P=P||Z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((b=b||this._layerOrderChanged||m===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(M.now(),s.zoom))&&(this.pauseablePlacement=new Al(s,this.map.terrain,this._order,b,d,m,g,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,D),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(M.now()),R=!0),P&&this.pauseablePlacement.placement.setStale()),R||P)for(const H of this._order){const $=this._layers[H];$.type==="symbol"&&this.placement.updateLayerOpacities($,D[$.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(M.now())}_releaseSymbolFadeTiles(){for(const s in this.sourceCaches)this.sourceCaches[s].releaseSymbolFadeTiles()}getImages(s,d){return o._(this,void 0,void 0,function*(){const m=yield this.imageManager.getImages(d.icons);this._updateTilesForChangedImages();const g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,d.icons),m})}getGlyphs(s,d){return o._(this,void 0,void 0,function*(){const m=yield this.glyphManager.getGlyphs(d.stacks),g=this.sourceCaches[d.source];return g&&g.setDependencies(d.tileID.key,d.type,[""]),m})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(s,d={}){this._checkLoaded(),s&&this._validate(o.x.glyphs,"glyphs",s,null,d)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=s,this.glyphManager.entries={},this.glyphManager.setURL(s))}addSprite(s,d,m={},g){this._checkLoaded();const b=[{id:s,url:d}],P=[...Me(this.stylesheet.sprite),...b];this._validate(o.x.sprite,"sprite",P,null,m)||(this.stylesheet.sprite=P,this._loadSprite(b,!0,g))}removeSprite(s){this._checkLoaded();const d=Me(this.stylesheet.sprite);if(d.find(m=>m.id===s)){if(this._spritesImagesIds[s])for(const m of this._spritesImagesIds[s])this.imageManager.removeImage(m),this._changedImages[m]=!0;d.splice(d.findIndex(m=>m.id===s),1),this.stylesheet.sprite=d.length>0?d:void 0,delete this._spritesImagesIds[s],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new o.k("data",{dataType:"style"}))}else this.fire(new o.j(new Error(`Sprite "${s}" doesn't exists on this map.`)))}getSprite(){return Me(this.stylesheet.sprite)}setSprite(s,d={},m){this._checkLoaded(),s&&this._validate(o.x.sprite,"sprite",s,null,d)||(this.stylesheet.sprite=s,s?this._loadSprite(s,!0,m):(this._unloadSprite(),m&&m(null)))}}var Li=o.X([{name:"a_pos",type:"Int16",components:2}]),Io="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const to={prelude:ii(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:ii(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:ii(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:ii(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:ii("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ii(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:ii(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:ii("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:ii("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ii("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:ii(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:ii(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:ii(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:ii(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:ii(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ii(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:ii(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:ii(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:ii(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:ii(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:ii(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:ii(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:ii(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:ii("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Io),terrainDepth:ii("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Io),terrainCoords:ii("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Io)};function ii(_,s){const d=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,m=s.match(/attribute ([\w]+) ([\w]+)/g),g=_.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=s.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),P=b?b.concat(g):g,R={};return{fragmentSource:_=_.replace(d,(D,H,$,Z,se)=>(R[se]=!0,H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
varying ${$} ${Z} ${se};
#else
uniform ${$} ${Z} u_${se};
#endif
`:`
#ifdef HAS_UNIFORM_u_${se}
    ${$} ${Z} ${se} = u_${se};
#endif
`)),vertexSource:s=s.replace(d,(D,H,$,Z,se)=>{const _e=Z==="float"?"vec2":"vec4",ve=se.match(/color/)?"color":_e;return R[se]?H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
attribute ${$} ${_e} a_${se};
varying ${$} ${Z} ${se};
#else
uniform ${$} ${Z} u_${se};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = a_${se};
#else
    ${$} ${Z} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${se} = unpack_mix_${ve}(a_${se}, u_${se}_t);
#else
    ${$} ${Z} ${se} = u_${se};
#endif
`:H==="define"?`
#ifndef HAS_UNIFORM_u_${se}
uniform lowp float u_${se}_t;
attribute ${$} ${_e} a_${se};
#else
uniform ${$} ${Z} u_${se};
#endif
`:ve==="vec4"?`
#ifndef HAS_UNIFORM_u_${se}
    ${$} ${Z} ${se} = a_${se};
#else
    ${$} ${Z} ${se} = u_${se};
#endif
`:`
#ifndef HAS_UNIFORM_u_${se}
    ${$} ${Z} ${se} = unpack_mix_${ve}(a_${se}, u_${se}_t);
#else
    ${$} ${Z} ${se} = u_${se};
#endif
`}),staticAttributes:m,staticUniforms:P}}class eh{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(s,d,m,g,b,P,R,D,H){this.context=s;let $=this.boundPaintVertexBuffers.length!==g.length;for(let Z=0;!$&&Z<g.length;Z++)this.boundPaintVertexBuffers[Z]!==g[Z]&&($=!0);!this.vao||this.boundProgram!==d||this.boundLayoutVertexBuffer!==m||$||this.boundIndexBuffer!==b||this.boundVertexOffset!==P||this.boundDynamicVertexBuffer!==R||this.boundDynamicVertexBuffer2!==D||this.boundDynamicVertexBuffer3!==H?this.freshBind(d,m,g,b,P,R,D,H):(s.bindVertexArray.set(this.vao),R&&R.bind(),b&&b.dynamicDraw&&b.bind(),D&&D.bind(),H&&H.bind())}freshBind(s,d,m,g,b,P,R,D){const H=s.numAttributes,$=this.context,Z=$.gl;this.vao&&this.destroy(),this.vao=$.createVertexArray(),$.bindVertexArray.set(this.vao),this.boundProgram=s,this.boundLayoutVertexBuffer=d,this.boundPaintVertexBuffers=m,this.boundIndexBuffer=g,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=P,this.boundDynamicVertexBuffer2=R,this.boundDynamicVertexBuffer3=D,d.enableAttributes(Z,s);for(const se of m)se.enableAttributes(Z,s);P&&P.enableAttributes(Z,s),R&&R.enableAttributes(Z,s),D&&D.enableAttributes(Z,s),d.bind(),d.setVertexAttribPointers(Z,s,b);for(const se of m)se.bind(),se.setVertexAttribPointers(Z,s,b);P&&(P.bind(),P.setVertexAttribPointers(Z,s,b)),g&&g.bind(),R&&(R.bind(),R.setVertexAttribPointers(Z,s,b)),D&&(D.bind(),D.setVertexAttribPointers(Z,s,b)),$.currentNumAttributes=H}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function ss(_){const s=[];for(let d=0;d<_.length;d++){if(_[d]===null)continue;const m=_[d].split(" ");s.push(m.pop())}return s}class ff{constructor(s,d,m,g,b,P){const R=s.gl;this.program=R.createProgram();const D=ss(d.staticAttributes),H=m?m.getBinderAttributes():[],$=D.concat(H),Z=to.prelude.staticUniforms?ss(to.prelude.staticUniforms):[],se=d.staticUniforms?ss(d.staticUniforms):[],_e=m?m.getBinderUniforms():[],ve=Z.concat(se).concat(_e),we=[];for(const Qe of ve)we.indexOf(Qe)<0&&we.push(Qe);const fe=m?m.defines():[];b&&fe.push("#define OVERDRAW_INSPECTOR;"),P&&fe.push("#define TERRAIN3D;");const ze=fe.concat(to.prelude.fragmentSource,d.fragmentSource).join(`
`),$e=fe.concat(to.prelude.vertexSource,d.vertexSource).join(`
`),Te=R.createShader(R.FRAGMENT_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Te,ze),R.compileShader(Te),!R.getShaderParameter(Te,R.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${R.getShaderInfoLog(Te)}`);R.attachShader(this.program,Te);const Be=R.createShader(R.VERTEX_SHADER);if(R.isContextLost())return void(this.failedToCreate=!0);if(R.shaderSource(Be,$e),R.compileShader(Be),!R.getShaderParameter(Be,R.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${R.getShaderInfoLog(Be)}`);R.attachShader(this.program,Be),this.attributes={};const Ke={};this.numAttributes=$.length;for(let Qe=0;Qe<this.numAttributes;Qe++)$[Qe]&&(R.bindAttribLocation(this.program,Qe,$[Qe]),this.attributes[$[Qe]]=Qe);if(R.linkProgram(this.program),!R.getProgramParameter(this.program,R.LINK_STATUS))throw new Error(`Program failed to link: ${R.getProgramInfoLog(this.program)}`);R.deleteShader(Be),R.deleteShader(Te);for(let Qe=0;Qe<we.length;Qe++){const lt=we[Qe];if(lt&&!Ke[lt]){const bt=R.getUniformLocation(this.program,lt);bt&&(Ke[lt]=bt)}}this.fixedUniforms=g(s,Ke),this.terrainUniforms=((Qe,lt)=>({u_depth:new o.aG(Qe,lt.u_depth),u_terrain:new o.aG(Qe,lt.u_terrain),u_terrain_dim:new o.aH(Qe,lt.u_terrain_dim),u_terrain_matrix:new o.aI(Qe,lt.u_terrain_matrix),u_terrain_unpack:new o.aJ(Qe,lt.u_terrain_unpack),u_terrain_exaggeration:new o.aH(Qe,lt.u_terrain_exaggeration)}))(s,Ke),this.binderUniforms=m?m.getUniforms(s,Ke):[]}draw(s,d,m,g,b,P,R,D,H,$,Z,se,_e,ve,we,fe,ze,$e){const Te=s.gl;if(this.failedToCreate)return;if(s.program.set(this.program),s.setDepthMode(m),s.setStencilMode(g),s.setColorMode(b),s.setCullFace(P),D){s.activeTexture.set(Te.TEXTURE2),Te.bindTexture(Te.TEXTURE_2D,D.depthTexture),s.activeTexture.set(Te.TEXTURE3),Te.bindTexture(Te.TEXTURE_2D,D.texture);for(const Ke in this.terrainUniforms)this.terrainUniforms[Ke].set(D[Ke])}for(const Ke in this.fixedUniforms)this.fixedUniforms[Ke].set(R[Ke]);we&&we.setUniforms(s,this.binderUniforms,_e,{zoom:ve});let Be=0;switch(d){case Te.LINES:Be=2;break;case Te.TRIANGLES:Be=3;break;case Te.LINE_STRIP:Be=1}for(const Ke of se.get()){const Qe=Ke.vaos||(Ke.vaos={});(Qe[H]||(Qe[H]=new eh)).bind(s,this,$,we?we.getPaintVertexBuffers():[],Z,Ke.vertexOffset,fe,ze,$e),Te.drawElements(d,Ke.primitiveLength*Be,Te.UNSIGNED_SHORT,Ke.primitiveOffset*Be*2)}}}function qc(_,s,d){const m=1/wn(d,1,s.transform.tileZoom),g=Math.pow(2,d.tileID.overscaledZ),b=d.tileSize*Math.pow(2,s.transform.tileZoom)/g,P=b*(d.tileID.canonical.x+d.tileID.wrap*g),R=b*d.tileID.canonical.y;return{u_image:0,u_texsize:d.imageAtlasTexture.size,u_scale:[m,_.fromScale,_.toScale],u_fade:_.t,u_pixel_coord_upper:[P>>16,R>>16],u_pixel_coord_lower:[65535&P,65535&R]}}const nm=(_,s,d,m)=>{const g=s.style.light,b=g.properties.get("position"),P=[b.x,b.y,b.z],R=function(){var H=new o.A(9);return o.A!=Float32Array&&(H[1]=0,H[2]=0,H[3]=0,H[5]=0,H[6]=0,H[7]=0),H[0]=1,H[4]=1,H[8]=1,H}();g.properties.get("anchor")==="viewport"&&function(H,$){var Z=Math.sin($),se=Math.cos($);H[0]=se,H[1]=Z,H[2]=0,H[3]=-Z,H[4]=se,H[5]=0,H[6]=0,H[7]=0,H[8]=1}(R,-s.transform.angle),function(H,$,Z){var se=$[0],_e=$[1],ve=$[2];H[0]=se*Z[0]+_e*Z[3]+ve*Z[6],H[1]=se*Z[1]+_e*Z[4]+ve*Z[7],H[2]=se*Z[2]+_e*Z[5]+ve*Z[8]}(P,P,R);const D=g.properties.get("color");return{u_matrix:_,u_lightpos:P,u_lightintensity:g.properties.get("intensity"),u_lightcolor:[D.r,D.g,D.b],u_vertical_gradient:+d,u_opacity:m}},ov=(_,s,d,m,g,b,P)=>o.e(nm(_,s,d,m),qc(b,s,P),{u_height_factor:-Math.pow(2,g.overscaledZ)/P.tileSize/8}),th=_=>({u_matrix:_}),im=(_,s,d,m)=>o.e(th(_),qc(d,s,m)),rm=(_,s)=>({u_matrix:_,u_world:s}),lv=(_,s,d,m,g)=>o.e(im(_,s,d,m),{u_world:g}),am=(_,s,d,m)=>{const g=_.transform;let b,P;if(m.paint.get("circle-pitch-alignment")==="map"){const R=wn(d,1,g.zoom);b=!0,P=[R,R]}else b=!1,P=g.pixelsToGLUnits;return{u_camera_to_center_distance:g.cameraToCenterDistance,u_scale_with_map:+(m.paint.get("circle-pitch-scale")==="map"),u_matrix:_.translatePosMatrix(s.posMatrix,d,m.paint.get("circle-translate"),m.paint.get("circle-translate-anchor")),u_pitch_with_map:+b,u_device_pixel_ratio:_.pixelRatio,u_extrude_scale:P}},cv=(_,s,d)=>{const m=wn(d,1,s.zoom),g=Math.pow(2,s.zoom-d.tileID.overscaledZ),b=d.tileID.overscaleFactor();return{u_matrix:_,u_camera_to_center_distance:s.cameraToCenterDistance,u_pixels_to_tile_units:m,u_extrude_scale:[s.pixelsToGLUnits[0]/(m*g),s.pixelsToGLUnits[1]/(m*g)],u_overscale_factor:b}},nh=(_,s,d=1)=>({u_matrix:_,u_color:s,u_overlay:0,u_overlay_scale:d}),pf=_=>({u_matrix:_}),sm=(_,s,d,m)=>({u_matrix:_,u_extrude_scale:wn(s,1,d),u_intensity:m});function om(_,s){const d=Math.pow(2,s.canonical.z),m=s.canonical.y;return[new o.Y(0,m/d).toLngLat().lat,new o.Y(0,(m+1)/d).toLngLat().lat]}const ih=(_,s,d,m)=>{const g=_.transform;return{u_matrix:Xc(_,s,d,m),u_ratio:1/wn(s,1,g.zoom),u_device_pixel_ratio:_.pixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},ko=(_,s,d,m,g)=>o.e(ih(_,s,d,g),{u_image:0,u_image_height:m}),rh=(_,s,d,m,g)=>{const b=_.transform,P=$c(s,b);return{u_matrix:Xc(_,s,d,g),u_texsize:s.imageAtlasTexture.size,u_ratio:1/wn(s,1,b.zoom),u_device_pixel_ratio:_.pixelRatio,u_image:0,u_scale:[P,m.fromScale,m.toScale],u_fade:m.t,u_units_to_pixels:[1/b.pixelsToGLUnits[0],1/b.pixelsToGLUnits[1]]}},Ta=(_,s,d,m,g,b)=>{const P=_.lineAtlas,R=$c(s,_.transform),D=d.layout.get("line-cap")==="round",H=P.getDash(m.from,D),$=P.getDash(m.to,D),Z=H.width*g.fromScale,se=$.width*g.toScale;return o.e(ih(_,s,d,b),{u_patternscale_a:[R/Z,-H.height/2],u_patternscale_b:[R/se,-$.height/2],u_sdfgamma:P.width/(256*Math.min(Z,se)*_.pixelRatio)/2,u_image:0,u_tex_y_a:H.y,u_tex_y_b:$.y,u_mix:g.t})};function $c(_,s){return 1/wn(_,1,s.tileZoom)}function Xc(_,s,d,m){return _.translatePosMatrix(m?m.posMatrix:s.tileID.posMatrix,s,d.paint.get("line-translate"),d.paint.get("line-translate-anchor"))}const Zc=(_,s,d,m,g)=>{return{u_matrix:_,u_tl_parent:s,u_scale_parent:d,u_buffer_scale:1,u_fade_t:m.mix,u_opacity:m.opacity*g.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:g.paint.get("raster-brightness-min"),u_brightness_high:g.paint.get("raster-brightness-max"),u_saturation_factor:(P=g.paint.get("raster-saturation"),P>0?1-1/(1.001-P):-P),u_contrast_factor:(b=g.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:ah(g.paint.get("raster-hue-rotate"))};var b,P};function ah(_){_*=Math.PI/180;const s=Math.sin(_),d=Math.cos(_);return[(2*d+1)/3,(-Math.sqrt(3)*s-d+1)/3,(Math.sqrt(3)*s-d+1)/3]}const Yc=(_,s,d,m,g,b,P,R,D,H)=>{const $=g.transform;return{u_is_size_zoom_constant:+(_==="constant"||_==="source"),u_is_size_feature_constant:+(_==="constant"||_==="camera"),u_size_t:s?s.uSizeT:0,u_size:s?s.uSize:0,u_camera_to_center_distance:$.cameraToCenterDistance,u_pitch:$.pitch/360*2*Math.PI,u_rotate_symbol:+d,u_aspect_ratio:$.width/$.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:P,u_coord_matrix:R,u_is_text:+D,u_pitch_with_map:+m,u_texsize:H,u_texture:0}},Cl=(_,s,d,m,g,b,P,R,D,H,$)=>{const Z=g.transform;return o.e(Yc(_,s,d,m,g,b,P,R,D,H),{u_gamma_scale:m?Math.cos(Z._pitch)*Z.cameraToCenterDistance:1,u_device_pixel_ratio:g.pixelRatio,u_is_halo:+$})},uv=(_,s,d,m,g,b,P,R,D,H)=>o.e(Cl(_,s,d,m,g,b,P,R,!0,D,!0),{u_texsize_icon:H,u_texture_icon:1}),hv=(_,s,d)=>({u_matrix:_,u_opacity:s,u_color:d}),lm=(_,s,d,m,g,b)=>o.e(function(P,R,D,H){const $=D.imageManager.getPattern(P.from.toString()),Z=D.imageManager.getPattern(P.to.toString()),{width:se,height:_e}=D.imageManager.getPixelSize(),ve=Math.pow(2,H.tileID.overscaledZ),we=H.tileSize*Math.pow(2,D.transform.tileZoom)/ve,fe=we*(H.tileID.canonical.x+H.tileID.wrap*ve),ze=we*H.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:$.tl,u_pattern_br_a:$.br,u_pattern_tl_b:Z.tl,u_pattern_br_b:Z.br,u_texsize:[se,_e],u_mix:R.t,u_pattern_size_a:$.displaySize,u_pattern_size_b:Z.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/wn(H,1,D.transform.tileZoom),u_pixel_coord_upper:[fe>>16,ze>>16],u_pixel_coord_lower:[65535&fe,65535&ze]}}(m,b,d,g),{u_matrix:_,u_opacity:s}),dv={fillExtrusion:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_lightpos:new o.aK(_,s.u_lightpos),u_lightintensity:new o.aH(_,s.u_lightintensity),u_lightcolor:new o.aK(_,s.u_lightcolor),u_vertical_gradient:new o.aH(_,s.u_vertical_gradient),u_opacity:new o.aH(_,s.u_opacity)}),fillExtrusionPattern:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_lightpos:new o.aK(_,s.u_lightpos),u_lightintensity:new o.aH(_,s.u_lightintensity),u_lightcolor:new o.aK(_,s.u_lightcolor),u_vertical_gradient:new o.aH(_,s.u_vertical_gradient),u_height_factor:new o.aH(_,s.u_height_factor),u_image:new o.aG(_,s.u_image),u_texsize:new o.aL(_,s.u_texsize),u_pixel_coord_upper:new o.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(_,s.u_pixel_coord_lower),u_scale:new o.aK(_,s.u_scale),u_fade:new o.aH(_,s.u_fade),u_opacity:new o.aH(_,s.u_opacity)}),fill:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix)}),fillPattern:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_image:new o.aG(_,s.u_image),u_texsize:new o.aL(_,s.u_texsize),u_pixel_coord_upper:new o.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(_,s.u_pixel_coord_lower),u_scale:new o.aK(_,s.u_scale),u_fade:new o.aH(_,s.u_fade)}),fillOutline:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_world:new o.aL(_,s.u_world)}),fillOutlinePattern:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_world:new o.aL(_,s.u_world),u_image:new o.aG(_,s.u_image),u_texsize:new o.aL(_,s.u_texsize),u_pixel_coord_upper:new o.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(_,s.u_pixel_coord_lower),u_scale:new o.aK(_,s.u_scale),u_fade:new o.aH(_,s.u_fade)}),circle:(_,s)=>({u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_scale_with_map:new o.aG(_,s.u_scale_with_map),u_pitch_with_map:new o.aG(_,s.u_pitch_with_map),u_extrude_scale:new o.aL(_,s.u_extrude_scale),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_matrix:new o.aI(_,s.u_matrix)}),collisionBox:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_pixels_to_tile_units:new o.aH(_,s.u_pixels_to_tile_units),u_extrude_scale:new o.aL(_,s.u_extrude_scale),u_overscale_factor:new o.aH(_,s.u_overscale_factor)}),collisionCircle:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_inv_matrix:new o.aI(_,s.u_inv_matrix),u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_viewport_size:new o.aL(_,s.u_viewport_size)}),debug:(_,s)=>({u_color:new o.aM(_,s.u_color),u_matrix:new o.aI(_,s.u_matrix),u_overlay:new o.aG(_,s.u_overlay),u_overlay_scale:new o.aH(_,s.u_overlay_scale)}),clippingMask:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix)}),heatmap:(_,s)=>({u_extrude_scale:new o.aH(_,s.u_extrude_scale),u_intensity:new o.aH(_,s.u_intensity),u_matrix:new o.aI(_,s.u_matrix)}),heatmapTexture:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_world:new o.aL(_,s.u_world),u_image:new o.aG(_,s.u_image),u_color_ramp:new o.aG(_,s.u_color_ramp),u_opacity:new o.aH(_,s.u_opacity)}),hillshade:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_image:new o.aG(_,s.u_image),u_latrange:new o.aL(_,s.u_latrange),u_light:new o.aL(_,s.u_light),u_shadow:new o.aM(_,s.u_shadow),u_highlight:new o.aM(_,s.u_highlight),u_accent:new o.aM(_,s.u_accent)}),hillshadePrepare:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_image:new o.aG(_,s.u_image),u_dimension:new o.aL(_,s.u_dimension),u_zoom:new o.aH(_,s.u_zoom),u_unpack:new o.aJ(_,s.u_unpack)}),line:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_ratio:new o.aH(_,s.u_ratio),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new o.aL(_,s.u_units_to_pixels)}),lineGradient:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_ratio:new o.aH(_,s.u_ratio),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new o.aL(_,s.u_units_to_pixels),u_image:new o.aG(_,s.u_image),u_image_height:new o.aH(_,s.u_image_height)}),linePattern:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_texsize:new o.aL(_,s.u_texsize),u_ratio:new o.aH(_,s.u_ratio),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_image:new o.aG(_,s.u_image),u_units_to_pixels:new o.aL(_,s.u_units_to_pixels),u_scale:new o.aK(_,s.u_scale),u_fade:new o.aH(_,s.u_fade)}),lineSDF:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_ratio:new o.aH(_,s.u_ratio),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_units_to_pixels:new o.aL(_,s.u_units_to_pixels),u_patternscale_a:new o.aL(_,s.u_patternscale_a),u_patternscale_b:new o.aL(_,s.u_patternscale_b),u_sdfgamma:new o.aH(_,s.u_sdfgamma),u_image:new o.aG(_,s.u_image),u_tex_y_a:new o.aH(_,s.u_tex_y_a),u_tex_y_b:new o.aH(_,s.u_tex_y_b),u_mix:new o.aH(_,s.u_mix)}),raster:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_tl_parent:new o.aL(_,s.u_tl_parent),u_scale_parent:new o.aH(_,s.u_scale_parent),u_buffer_scale:new o.aH(_,s.u_buffer_scale),u_fade_t:new o.aH(_,s.u_fade_t),u_opacity:new o.aH(_,s.u_opacity),u_image0:new o.aG(_,s.u_image0),u_image1:new o.aG(_,s.u_image1),u_brightness_low:new o.aH(_,s.u_brightness_low),u_brightness_high:new o.aH(_,s.u_brightness_high),u_saturation_factor:new o.aH(_,s.u_saturation_factor),u_contrast_factor:new o.aH(_,s.u_contrast_factor),u_spin_weights:new o.aK(_,s.u_spin_weights)}),symbolIcon:(_,s)=>({u_is_size_zoom_constant:new o.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(_,s.u_is_size_feature_constant),u_size_t:new o.aH(_,s.u_size_t),u_size:new o.aH(_,s.u_size),u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_pitch:new o.aH(_,s.u_pitch),u_rotate_symbol:new o.aG(_,s.u_rotate_symbol),u_aspect_ratio:new o.aH(_,s.u_aspect_ratio),u_fade_change:new o.aH(_,s.u_fade_change),u_matrix:new o.aI(_,s.u_matrix),u_label_plane_matrix:new o.aI(_,s.u_label_plane_matrix),u_coord_matrix:new o.aI(_,s.u_coord_matrix),u_is_text:new o.aG(_,s.u_is_text),u_pitch_with_map:new o.aG(_,s.u_pitch_with_map),u_texsize:new o.aL(_,s.u_texsize),u_texture:new o.aG(_,s.u_texture)}),symbolSDF:(_,s)=>({u_is_size_zoom_constant:new o.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(_,s.u_is_size_feature_constant),u_size_t:new o.aH(_,s.u_size_t),u_size:new o.aH(_,s.u_size),u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_pitch:new o.aH(_,s.u_pitch),u_rotate_symbol:new o.aG(_,s.u_rotate_symbol),u_aspect_ratio:new o.aH(_,s.u_aspect_ratio),u_fade_change:new o.aH(_,s.u_fade_change),u_matrix:new o.aI(_,s.u_matrix),u_label_plane_matrix:new o.aI(_,s.u_label_plane_matrix),u_coord_matrix:new o.aI(_,s.u_coord_matrix),u_is_text:new o.aG(_,s.u_is_text),u_pitch_with_map:new o.aG(_,s.u_pitch_with_map),u_texsize:new o.aL(_,s.u_texsize),u_texture:new o.aG(_,s.u_texture),u_gamma_scale:new o.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_is_halo:new o.aG(_,s.u_is_halo)}),symbolTextAndIcon:(_,s)=>({u_is_size_zoom_constant:new o.aG(_,s.u_is_size_zoom_constant),u_is_size_feature_constant:new o.aG(_,s.u_is_size_feature_constant),u_size_t:new o.aH(_,s.u_size_t),u_size:new o.aH(_,s.u_size),u_camera_to_center_distance:new o.aH(_,s.u_camera_to_center_distance),u_pitch:new o.aH(_,s.u_pitch),u_rotate_symbol:new o.aG(_,s.u_rotate_symbol),u_aspect_ratio:new o.aH(_,s.u_aspect_ratio),u_fade_change:new o.aH(_,s.u_fade_change),u_matrix:new o.aI(_,s.u_matrix),u_label_plane_matrix:new o.aI(_,s.u_label_plane_matrix),u_coord_matrix:new o.aI(_,s.u_coord_matrix),u_is_text:new o.aG(_,s.u_is_text),u_pitch_with_map:new o.aG(_,s.u_pitch_with_map),u_texsize:new o.aL(_,s.u_texsize),u_texsize_icon:new o.aL(_,s.u_texsize_icon),u_texture:new o.aG(_,s.u_texture),u_texture_icon:new o.aG(_,s.u_texture_icon),u_gamma_scale:new o.aH(_,s.u_gamma_scale),u_device_pixel_ratio:new o.aH(_,s.u_device_pixel_ratio),u_is_halo:new o.aG(_,s.u_is_halo)}),background:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_opacity:new o.aH(_,s.u_opacity),u_color:new o.aM(_,s.u_color)}),backgroundPattern:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_opacity:new o.aH(_,s.u_opacity),u_image:new o.aG(_,s.u_image),u_pattern_tl_a:new o.aL(_,s.u_pattern_tl_a),u_pattern_br_a:new o.aL(_,s.u_pattern_br_a),u_pattern_tl_b:new o.aL(_,s.u_pattern_tl_b),u_pattern_br_b:new o.aL(_,s.u_pattern_br_b),u_texsize:new o.aL(_,s.u_texsize),u_mix:new o.aH(_,s.u_mix),u_pattern_size_a:new o.aL(_,s.u_pattern_size_a),u_pattern_size_b:new o.aL(_,s.u_pattern_size_b),u_scale_a:new o.aH(_,s.u_scale_a),u_scale_b:new o.aH(_,s.u_scale_b),u_pixel_coord_upper:new o.aL(_,s.u_pixel_coord_upper),u_pixel_coord_lower:new o.aL(_,s.u_pixel_coord_lower),u_tile_units_to_pixels:new o.aH(_,s.u_tile_units_to_pixels)}),terrain:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_texture:new o.aG(_,s.u_texture),u_ele_delta:new o.aH(_,s.u_ele_delta)}),terrainDepth:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_ele_delta:new o.aH(_,s.u_ele_delta)}),terrainCoords:(_,s)=>({u_matrix:new o.aI(_,s.u_matrix),u_texture:new o.aG(_,s.u_texture),u_terrain_coords_id:new o.aH(_,s.u_terrain_coords_id),u_ele_delta:new o.aH(_,s.u_ele_delta)})};class Do{constructor(s,d,m){this.context=s;const g=s.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!m,this.context.unbindVAO(),s.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(s){const d=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),d.bufferSubData(d.ELEMENT_ARRAY_BUFFER,0,s.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const sh={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class oa{constructor(s,d,m,g){this.length=d.length,this.attributes=m,this.itemSize=d.bytesPerElement,this.dynamicDraw=g,this.context=s;const b=s.gl;this.buffer=b.createBuffer(),s.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,d.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||delete d.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(s){if(s.length!==this.length)throw new Error(`Length of new data is ${s.length}, which doesn't match current length of ${this.length}`);const d=this.context.gl;this.bind(),d.bufferSubData(d.ARRAY_BUFFER,0,s.arrayBuffer)}enableAttributes(s,d){for(let m=0;m<this.attributes.length;m++){const g=d.attributes[this.attributes[m].name];g!==void 0&&s.enableVertexAttribArray(g)}}setVertexAttribPointers(s,d,m){for(let g=0;g<this.attributes.length;g++){const b=this.attributes[g],P=d.attributes[b.name];P!==void 0&&s.vertexAttribPointer(P,b.components,s[sh[b.type]],!1,this.itemSize,b.offset+this.itemSize*(m||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Lr=new WeakMap;function Pl(_){var s;if(Lr.has(_))return Lr.get(_);{const d=(s=_.getParameter(_.VERSION))===null||s===void 0?void 0:s.startsWith("WebGL 2.0");return Lr.set(_,d),d}}class ri{constructor(s){this.gl=s.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(s){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class oh extends ri{getDefault(){return o.aO.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.clearColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class mf extends ri{getDefault(){return 1}set(s){(s!==this.current||this.dirty)&&(this.gl.clearDepth(s),this.current=s,this.dirty=!1)}}class gf extends ri{getDefault(){return 0}set(s){(s!==this.current||this.dirty)&&(this.gl.clearStencil(s),this.current=s,this.dirty=!1)}}class lh extends ri{getDefault(){return[!0,!0,!0,!0]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.colorMask(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class yf extends ri{getDefault(){return!0}set(s){(s!==this.current||this.dirty)&&(this.gl.depthMask(s),this.current=s,this.dirty=!1)}}class vf extends ri{getDefault(){return 255}set(s){(s!==this.current||this.dirty)&&(this.gl.stencilMask(s),this.current=s,this.dirty=!1)}}class ch extends ri{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(s){const d=this.current;(s.func!==d.func||s.ref!==d.ref||s.mask!==d.mask||this.dirty)&&(this.gl.stencilFunc(s.func,s.ref,s.mask),this.current=s,this.dirty=!1)}}class cm extends ri{getDefault(){const s=this.gl;return[s.KEEP,s.KEEP,s.KEEP]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||this.dirty)&&(this.gl.stencilOp(s[0],s[1],s[2]),this.current=s,this.dirty=!1)}}class um extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.STENCIL_TEST):d.disable(d.STENCIL_TEST),this.current=s,this.dirty=!1}}class Rl extends ri{getDefault(){return[0,1]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.depthRange(s[0],s[1]),this.current=s,this.dirty=!1)}}class fv extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.DEPTH_TEST):d.disable(d.DEPTH_TEST),this.current=s,this.dirty=!1}}class pv extends ri{getDefault(){return this.gl.LESS}set(s){(s!==this.current||this.dirty)&&(this.gl.depthFunc(s),this.current=s,this.dirty=!1)}}class mv extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.BLEND):d.disable(d.BLEND),this.current=s,this.dirty=!1}}class gv extends ri{getDefault(){const s=this.gl;return[s.ONE,s.ZERO]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||this.dirty)&&(this.gl.blendFunc(s[0],s[1]),this.current=s,this.dirty=!1)}}class yv extends ri{getDefault(){return o.aO.transparent}set(s){const d=this.current;(s.r!==d.r||s.g!==d.g||s.b!==d.b||s.a!==d.a||this.dirty)&&(this.gl.blendColor(s.r,s.g,s.b,s.a),this.current=s,this.dirty=!1)}}class vv extends ri{getDefault(){return this.gl.FUNC_ADD}set(s){(s!==this.current||this.dirty)&&(this.gl.blendEquation(s),this.current=s,this.dirty=!1)}}class _f extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;s?d.enable(d.CULL_FACE):d.disable(d.CULL_FACE),this.current=s,this.dirty=!1}}class uh extends ri{getDefault(){return this.gl.BACK}set(s){(s!==this.current||this.dirty)&&(this.gl.cullFace(s),this.current=s,this.dirty=!1)}}class xf extends ri{getDefault(){return this.gl.CCW}set(s){(s!==this.current||this.dirty)&&(this.gl.frontFace(s),this.current=s,this.dirty=!1)}}class bf extends ri{getDefault(){return null}set(s){(s!==this.current||this.dirty)&&(this.gl.useProgram(s),this.current=s,this.dirty=!1)}}class Il extends ri{getDefault(){return this.gl.TEXTURE0}set(s){(s!==this.current||this.dirty)&&(this.gl.activeTexture(s),this.current=s,this.dirty=!1)}}class hm extends ri{getDefault(){const s=this.gl;return[0,0,s.drawingBufferWidth,s.drawingBufferHeight]}set(s){const d=this.current;(s[0]!==d[0]||s[1]!==d[1]||s[2]!==d[2]||s[3]!==d[3]||this.dirty)&&(this.gl.viewport(s[0],s[1],s[2],s[3]),this.current=s,this.dirty=!1)}}class dm extends ri{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindFramebuffer(d.FRAMEBUFFER,s),this.current=s,this.dirty=!1}}class wf extends ri{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindRenderbuffer(d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Lo extends ri{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindTexture(d.TEXTURE_2D,s),this.current=s,this.dirty=!1}}class fm extends ri{getDefault(){return null}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.bindBuffer(d.ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class kl extends ri{getDefault(){return null}set(s){const d=this.gl;d.bindBuffer(d.ELEMENT_ARRAY_BUFFER,s),this.current=s,this.dirty=!1}}class Dl extends ri{getDefault(){return null}set(s){var d;if(s===this.current&&!this.dirty)return;const m=this.gl;Pl(m)?m.bindVertexArray(s):(d=m.getExtension("OES_vertex_array_object"))===null||d===void 0||d.bindVertexArrayOES(s),this.current=s,this.dirty=!1}}class pm extends ri{getDefault(){return 4}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_ALIGNMENT,s),this.current=s,this.dirty=!1}}class Sf extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_PREMULTIPLY_ALPHA_WEBGL,s),this.current=s,this.dirty=!1}}class ai extends ri{getDefault(){return!1}set(s){if(s===this.current&&!this.dirty)return;const d=this.gl;d.pixelStorei(d.UNPACK_FLIP_Y_WEBGL,s),this.current=s,this.dirty=!1}}class Ll extends ri{constructor(s,d){super(s),this.context=s,this.parent=d}getDefault(){return null}}class _v extends Ll{setDirty(){this.dirty=!0}set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferTexture2D(d.FRAMEBUFFER,d.COLOR_ATTACHMENT0,d.TEXTURE_2D,s,0),this.current=s,this.dirty=!1}}class mm extends Ll{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class Kc extends Ll{set(s){if(s===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const d=this.gl;d.framebufferRenderbuffer(d.FRAMEBUFFER,d.DEPTH_STENCIL_ATTACHMENT,d.RENDERBUFFER,s),this.current=s,this.dirty=!1}}class xv{constructor(s,d,m,g,b){this.context=s,this.width=d,this.height=m;const P=s.gl,R=this.framebuffer=P.createFramebuffer();if(this.colorAttachment=new _v(s,R),g)this.depthAttachment=b?new Kc(s,R):new mm(s,R);else if(b)throw new Error("Stencil cannot be set without depth");if(P.checkFramebufferStatus(P.FRAMEBUFFER)!==P.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const s=this.context.gl,d=this.colorAttachment.get();if(d&&s.deleteTexture(d),this.depthAttachment){const m=this.depthAttachment.get();m&&s.deleteRenderbuffer(m)}s.deleteFramebuffer(this.framebuffer)}}class ji{constructor(s,d,m){this.blendFunction=s,this.blendColor=d,this.mask=m}}ji.Replace=[1,0],ji.disabled=new ji(ji.Replace,o.aO.transparent,[!1,!1,!1,!1]),ji.unblended=new ji(ji.Replace,o.aO.transparent,[!0,!0,!0,!0]),ji.alphaBlended=new ji([1,771],o.aO.transparent,[!0,!0,!0,!0]);class gm{constructor(s){var d,m;if(this.gl=s,this.clearColor=new oh(this),this.clearDepth=new mf(this),this.clearStencil=new gf(this),this.colorMask=new lh(this),this.depthMask=new yf(this),this.stencilMask=new vf(this),this.stencilFunc=new ch(this),this.stencilOp=new cm(this),this.stencilTest=new um(this),this.depthRange=new Rl(this),this.depthTest=new fv(this),this.depthFunc=new pv(this),this.blend=new mv(this),this.blendFunc=new gv(this),this.blendColor=new yv(this),this.blendEquation=new vv(this),this.cullFace=new _f(this),this.cullFaceSide=new uh(this),this.frontFace=new xf(this),this.program=new bf(this),this.activeTexture=new Il(this),this.viewport=new hm(this),this.bindFramebuffer=new dm(this),this.bindRenderbuffer=new wf(this),this.bindTexture=new Lo(this),this.bindVertexBuffer=new fm(this),this.bindElementBuffer=new kl(this),this.bindVertexArray=new Dl(this),this.pixelStoreUnpack=new pm(this),this.pixelStoreUnpackPremultiplyAlpha=new Sf(this),this.pixelStoreUnpackFlipY=new ai(this),this.extTextureFilterAnisotropic=s.getExtension("EXT_texture_filter_anisotropic")||s.getExtension("MOZ_EXT_texture_filter_anisotropic")||s.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=s.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=s.getParameter(s.MAX_TEXTURE_SIZE),Pl(s)){this.HALF_FLOAT=s.HALF_FLOAT;const g=s.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(d=s.RGBA16F)!==null&&d!==void 0?d:g==null?void 0:g.RGBA16F_EXT,this.RGB16F=(m=s.RGB16F)!==null&&m!==void 0?m:g==null?void 0:g.RGB16F_EXT,s.getExtension("EXT_color_buffer_float")}else{s.getExtension("EXT_color_buffer_half_float"),s.getExtension("OES_texture_half_float_linear");const g=s.getExtension("OES_texture_half_float");this.HALF_FLOAT=g==null?void 0:g.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(s,d){return new Do(this,s,d)}createVertexBuffer(s,d,m){return new oa(this,s,d,m)}createRenderbuffer(s,d,m){const g=this.gl,b=g.createRenderbuffer();return this.bindRenderbuffer.set(b),g.renderbufferStorage(g.RENDERBUFFER,s,d,m),this.bindRenderbuffer.set(null),b}createFramebuffer(s,d,m,g){return new xv(this,s,d,m,g)}clear({color:s,depth:d,stencil:m}){const g=this.gl;let b=0;s&&(b|=g.COLOR_BUFFER_BIT,this.clearColor.set(s),this.colorMask.set([!0,!0,!0,!0])),d!==void 0&&(b|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(d),this.depthMask.set(!0)),m!==void 0&&(b|=g.STENCIL_BUFFER_BIT,this.clearStencil.set(m),this.stencilMask.set(255)),g.clear(b)}setCullFace(s){s.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(s.mode),this.frontFace.set(s.frontFace))}setDepthMode(s){s.func!==this.gl.ALWAYS||s.mask?(this.depthTest.set(!0),this.depthFunc.set(s.func),this.depthMask.set(s.mask),this.depthRange.set(s.range)):this.depthTest.set(!1)}setStencilMode(s){s.test.func!==this.gl.ALWAYS||s.mask?(this.stencilTest.set(!0),this.stencilMask.set(s.mask),this.stencilOp.set([s.fail,s.depthFail,s.pass]),this.stencilFunc.set({func:s.test.func,ref:s.ref,mask:s.test.mask})):this.stencilTest.set(!1)}setColorMode(s){o.aD(s.blendFunction,ji.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(s.blendFunction),this.blendColor.set(s.blendColor)),this.colorMask.set(s.mask)}createVertexArray(){var s;return Pl(this.gl)?this.gl.createVertexArray():(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.createVertexArrayOES()}deleteVertexArray(s){var d;return Pl(this.gl)?this.gl.deleteVertexArray(s):(d=this.gl.getExtension("OES_vertex_array_object"))===null||d===void 0?void 0:d.deleteVertexArrayOES(s)}unbindVAO(){this.bindVertexArray.set(null)}}class ti{constructor(s,d,m){this.func=s,this.mask=d,this.range=m}}ti.ReadOnly=!1,ti.ReadWrite=!0,ti.disabled=new ti(519,ti.ReadOnly,[0,1]);const Jc=7680;class yi{constructor(s,d,m,g,b,P){this.test=s,this.ref=d,this.mask=m,this.fail=g,this.depthFail=b,this.pass=P}}yi.disabled=new yi({func:519,mask:0},0,0,Jc,Jc,Jc);class pi{constructor(s,d,m){this.enable=s,this.mode=d,this.frontFace=m}}let zl;function hh(_,s,d,m,g,b,P){const R=_.context,D=R.gl,H=_.useProgram("collisionBox"),$=[];let Z=0,se=0;for(let Te=0;Te<m.length;Te++){const Be=m[Te],Ke=s.getTile(Be),Qe=Ke.getBucket(d);if(!Qe)continue;let lt=Be.posMatrix;g[0]===0&&g[1]===0||(lt=_.translatePosMatrix(Be.posMatrix,Ke,g,b));const bt=P?Qe.textCollisionBox:Qe.iconCollisionBox,vt=Qe.collisionCircleArray;if(vt.length>0){const xt=o.F(),Zt=lt;o.aP(xt,Qe.placementInvProjMatrix,_.transform.glCoordMatrix),o.aP(xt,xt,Qe.placementViewportMatrix),$.push({circleArray:vt,circleOffset:se,transform:Zt,invTransform:xt,coord:Be}),Z+=vt.length/4,se=Z}bt&&H.draw(R,D.LINES,ti.disabled,yi.disabled,_.colorModeForRenderPass(),pi.disabled,cv(lt,_.transform,Ke),_.style.map.terrain&&_.style.map.terrain.getTerrainData(Be),d.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,null,_.transform.zoom,null,null,bt.collisionVertexBuffer)}if(!P||!$.length)return;const _e=_.useProgram("collisionCircle"),ve=new o.aQ;ve.resize(4*Z),ve._trim();let we=0;for(const Te of $)for(let Be=0;Be<Te.circleArray.length/4;Be++){const Ke=4*Be,Qe=Te.circleArray[Ke+0],lt=Te.circleArray[Ke+1],bt=Te.circleArray[Ke+2],vt=Te.circleArray[Ke+3];ve.emplace(we++,Qe,lt,bt,vt,0),ve.emplace(we++,Qe,lt,bt,vt,1),ve.emplace(we++,Qe,lt,bt,vt,2),ve.emplace(we++,Qe,lt,bt,vt,3)}(!zl||zl.length<2*Z)&&(zl=function(Te){const Be=2*Te,Ke=new o.aS;Ke.resize(Be),Ke._trim();for(let Qe=0;Qe<Be;Qe++){const lt=6*Qe;Ke.uint16[lt+0]=4*Qe+0,Ke.uint16[lt+1]=4*Qe+1,Ke.uint16[lt+2]=4*Qe+2,Ke.uint16[lt+3]=4*Qe+2,Ke.uint16[lt+4]=4*Qe+3,Ke.uint16[lt+5]=4*Qe+0}return Ke}(Z));const fe=R.createIndexBuffer(zl,!0),ze=R.createVertexBuffer(ve,o.aR.members,!0);for(const Te of $){const Be={u_matrix:Te.transform,u_inv_matrix:Te.invTransform,u_camera_to_center_distance:($e=_.transform).cameraToCenterDistance,u_viewport_size:[$e.width,$e.height]};_e.draw(R,D.TRIANGLES,ti.disabled,yi.disabled,_.colorModeForRenderPass(),pi.disabled,Be,_.style.map.terrain&&_.style.map.terrain.getTerrainData(Te.coord),d.id,ze,fe,o.$.simpleSegment(0,2*Te.circleOffset,Te.circleArray.length,Te.circleArray.length/2),null,_.transform.zoom,null,null,null)}var $e;ze.destroy(),fe.destroy()}pi.disabled=new pi(!1,1029,2305),pi.backCCW=new pi(!0,1029,2305);const ym=o.an(new Float32Array(16));function dh(_,s,d,m,g,b){const{horizontalAlign:P,verticalAlign:R}=o.at(_);return new o.P((-(P-.5)*s/g+m[0])*b,(-(R-.5)*d/g+m[1])*b)}function fh(_,s,d,m,g,b,P,R,D,H,$){const Z=_.text.placedSymbolArray,se=_.text.dynamicLayoutVertexArray,_e=_.icon.dynamicLayoutVertexArray,ve={};se.clear();for(let we=0;we<Z.length;we++){const fe=Z.get(we),ze=fe.hidden||!fe.crossTileID||_.allowVerticalPlacement&&!fe.placedOrientation?null:m[fe.crossTileID];if(ze){const $e=new o.P(fe.anchorX,fe.anchorY),Te=ce($e,d?P:b,$),Be=B(g.cameraToCenterDistance,Te.signedDistanceFromCamera);let Ke=o.ai(_.textSizeData,D,fe)*Be/o.ao;d&&(Ke*=_.tilePixelRatio/R);const{width:Qe,height:lt,anchor:bt,textOffset:vt,textBoxScale:xt}=ze,Zt=dh(bt,Qe,lt,vt,xt,Ke),zn=d?ce($e.add(Zt),b,$).point:Te.point.add(s?Zt.rotate(-g.angle):Zt),Bt=_.allowVerticalPlacement&&fe.placedOrientation===o.ah.vertical?Math.PI/2:0;for(let Tn=0;Tn<fe.numGlyphs;Tn++)o.aj(se,zn,Bt);H&&fe.associatedIconIndex>=0&&(ve[fe.associatedIconIndex]={shiftedAnchor:zn,angle:Bt})}else Ct(fe.numGlyphs,se)}if(H){_e.clear();const we=_.icon.placedSymbolArray;for(let fe=0;fe<we.length;fe++){const ze=we.get(fe);if(ze.hidden)Ct(ze.numGlyphs,_e);else{const $e=ve[fe];if($e)for(let Te=0;Te<ze.numGlyphs;Te++)o.aj(_e,$e.shiftedAnchor,$e.angle);else Ct(ze.numGlyphs,_e)}}_.icon.dynamicLayoutVertexBuffer.updateData(_e)}_.text.dynamicLayoutVertexBuffer.updateData(se)}function Mf(_,s,d){return d.iconsInText&&s?"symbolTextAndIcon":_?"symbolSDF":"symbolIcon"}function vm(_,s,d,m,g,b,P,R,D,H,$,Z){const se=_.context,_e=se.gl,ve=_.transform,we=R==="map",fe=D==="map",ze=R!=="viewport"&&d.layout.get("symbol-placement")!=="point",$e=we&&!fe&&!ze,Te=!d.layout.get("symbol-sort-key").isConstant();let Be=!1;const Ke=_.depthModeForSublayer(0,ti.ReadOnly),Qe=d._unevaluatedLayout.hasValue("text-variable-anchor")||d._unevaluatedLayout.hasValue("text-variable-anchor-offset"),lt=[];for(const bt of m){const vt=s.getTile(bt),xt=vt.getBucket(d);if(!xt)continue;const Zt=g?xt.text:xt.icon;if(!Zt||!Zt.segments.get().length||!Zt.hasVisibleVertices)continue;const zn=Zt.programConfigurations.get(d.id),Bt=g||xt.sdfIcons,Tn=g?xt.textSizeData:xt.iconSizeData,Nn=fe||ve.pitch!==0,Xn=_.useProgram(Mf(Bt,g,xt),zn),Rn=o.ag(Tn,ve.zoom),Vn=_.style.map.terrain&&_.style.map.terrain.getTerrainData(bt);let Hn,Ii,mi,qr,Qi=[0,0],vi=null;if(g)Ii=vt.glyphAtlasTexture,mi=_e.LINEAR,Hn=vt.glyphAtlasTexture.size,xt.iconsInText&&(Qi=vt.imageAtlasTexture.size,vi=vt.imageAtlasTexture,qr=Nn||_.options.rotating||_.options.zooming||Tn.kind==="composite"||Tn.kind==="camera"?_e.LINEAR:_e.NEAREST);else{const Ai=d.layout.get("icon-size").constantOr(0)!==1||xt.iconsNeedLinear;Ii=vt.imageAtlasTexture,mi=Bt||_.options.rotating||_.options.zooming||Ai||Nn?_e.LINEAR:_e.NEAREST,Hn=vt.imageAtlasTexture.size}const Er=wn(vt,1,_.transform.zoom),Ua=pt(bt.posMatrix,fe,we,_.transform,Er),cs=Dt(bt.posMatrix,fe,we,_.transform,Er),Uo=Qe&&xt.hasTextData(),Vo=d.layout.get("icon-text-fit")!=="none"&&Uo&&xt.hasIconData();if(ze){const Ai=_.style.map.terrain?(ca,qn)=>_.style.map.terrain.getElevation(bt,ca,qn):null,mr=d.layout.get("text-rotation-alignment")==="map";q(xt,bt.posMatrix,_,g,Ua,cs,fe,H,mr,Ai)}const us=_.translatePosMatrix(bt.posMatrix,vt,b,P),Va=ze||g&&Qe||Vo?ym:Ua,Fi=_.translatePosMatrix(cs,vt,b,P,!0),wi=Bt&&d.paint.get(g?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vi;Vi=Bt?xt.iconsInText?uv(Tn.kind,Rn,$e,fe,_,us,Va,Fi,Hn,Qi):Cl(Tn.kind,Rn,$e,fe,_,us,Va,Fi,g,Hn,!0):Yc(Tn.kind,Rn,$e,fe,_,us,Va,Fi,g,Hn);const ql={program:Xn,buffers:Zt,uniformValues:Vi,atlasTexture:Ii,atlasTextureIcon:vi,atlasInterpolation:mi,atlasInterpolationIcon:qr,isSDF:Bt,hasHalo:wi};if(Te&&xt.canOverlap){Be=!0;const Ai=Zt.segments.get();for(const mr of Ai)lt.push({segments:new o.$([mr]),sortKey:mr.sortKey,state:ql,terrainData:Vn})}else lt.push({segments:Zt.segments,sortKey:0,state:ql,terrainData:Vn})}Be&&lt.sort((bt,vt)=>bt.sortKey-vt.sortKey);for(const bt of lt){const vt=bt.state;if(se.activeTexture.set(_e.TEXTURE0),vt.atlasTexture.bind(vt.atlasInterpolation,_e.CLAMP_TO_EDGE),vt.atlasTextureIcon&&(se.activeTexture.set(_e.TEXTURE1),vt.atlasTextureIcon&&vt.atlasTextureIcon.bind(vt.atlasInterpolationIcon,_e.CLAMP_TO_EDGE)),vt.isSDF){const xt=vt.uniformValues;vt.hasHalo&&(xt.u_is_halo=1,ph(vt.buffers,bt.segments,d,_,vt.program,Ke,$,Z,xt,bt.terrainData)),xt.u_is_halo=0}ph(vt.buffers,bt.segments,d,_,vt.program,Ke,$,Z,vt.uniformValues,bt.terrainData)}}function ph(_,s,d,m,g,b,P,R,D,H){const $=m.context;g.draw($,$.gl.TRIANGLES,b,P,R,pi.disabled,D,H,d.id,_.layoutVertexBuffer,_.indexBuffer,s,d.paint,m.transform.zoom,_.programConfigurations.get(d.id),_.dynamicLayoutVertexBuffer,_.opacityVertexBuffer)}function _m(_,s,d,m,g){if(!d||!m||!m.imageAtlas)return;const b=m.imageAtlas.patternPositions;let P=b[d.to.toString()],R=b[d.from.toString()];if(!P&&R&&(P=R),!R&&P&&(R=P),!P||!R){const D=g.getPaintProperty(s);P=b[D],R=b[D]}P&&R&&_.setConstantPatternPositions(P,R)}function Tf(_,s,d,m,g,b,P){const R=_.context.gl,D="fill-pattern",H=d.paint.get(D),$=H&&H.constantOr(1),Z=d.getCrossfadeParameters();let se,_e,ve,we,fe;P?(_e=$&&!d.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",se=R.LINES):(_e=$?"fillPattern":"fill",se=R.TRIANGLES);const ze=H.constantOr(null);for(const $e of m){const Te=s.getTile($e);if($&&!Te.patternsLoaded())continue;const Be=Te.getBucket(d);if(!Be)continue;const Ke=Be.programConfigurations.get(d.id),Qe=_.useProgram(_e,Ke),lt=_.style.map.terrain&&_.style.map.terrain.getTerrainData($e);$&&(_.context.activeTexture.set(R.TEXTURE0),Te.imageAtlasTexture.bind(R.LINEAR,R.CLAMP_TO_EDGE),Ke.updatePaintBuffers(Z)),_m(Ke,D,ze,Te,d);const bt=lt?$e:null,vt=_.translatePosMatrix(bt?bt.posMatrix:$e.posMatrix,Te,d.paint.get("fill-translate"),d.paint.get("fill-translate-anchor"));if(P){we=Be.indexBuffer2,fe=Be.segments2;const xt=[R.drawingBufferWidth,R.drawingBufferHeight];ve=_e==="fillOutlinePattern"&&$?lv(vt,_,Z,Te,xt):rm(vt,xt)}else we=Be.indexBuffer,fe=Be.segments,ve=$?im(vt,_,Z,Te):th(vt);Qe.draw(_.context,se,g,_.stencilModeForClipping($e),b,pi.disabled,ve,lt,d.id,Be.layoutVertexBuffer,we,fe,d.paint,_.transform.zoom,Ke)}}function Fl(_,s,d,m,g,b,P){const R=_.context,D=R.gl,H="fill-extrusion-pattern",$=d.paint.get(H),Z=$.constantOr(1),se=d.getCrossfadeParameters(),_e=d.paint.get("fill-extrusion-opacity"),ve=$.constantOr(null);for(const we of m){const fe=s.getTile(we),ze=fe.getBucket(d);if(!ze)continue;const $e=_.style.map.terrain&&_.style.map.terrain.getTerrainData(we),Te=ze.programConfigurations.get(d.id),Be=_.useProgram(Z?"fillExtrusionPattern":"fillExtrusion",Te);Z&&(_.context.activeTexture.set(D.TEXTURE0),fe.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),Te.updatePaintBuffers(se)),_m(Te,H,ve,fe,d);const Ke=_.translatePosMatrix(we.posMatrix,fe,d.paint.get("fill-extrusion-translate"),d.paint.get("fill-extrusion-translate-anchor")),Qe=d.paint.get("fill-extrusion-vertical-gradient"),lt=Z?ov(Ke,_,Qe,_e,we,se,fe):nm(Ke,_,Qe,_e);Be.draw(R,R.gl.TRIANGLES,g,b,P,pi.backCCW,lt,$e,d.id,ze.layoutVertexBuffer,ze.indexBuffer,ze.segments,d.paint,_.transform.zoom,Te,_.style.map.terrain&&ze.centroidVertexBuffer)}}function Ef(_,s,d,m,g,b,P){const R=_.context,D=R.gl,H=d.fbo;if(!H)return;const $=_.useProgram("hillshade"),Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(s);R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,H.colorAttachment.get()),$.draw(R,D.TRIANGLES,g,b,P,pi.disabled,((se,_e,ve,we)=>{const fe=ve.paint.get("hillshade-shadow-color"),ze=ve.paint.get("hillshade-highlight-color"),$e=ve.paint.get("hillshade-accent-color");let Te=ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(Te-=se.transform.angle);const Be=!se.options.moving;return{u_matrix:we?we.posMatrix:se.transform.calculatePosMatrix(_e.tileID.toUnwrapped(),Be),u_image:0,u_latrange:om(0,_e.tileID),u_light:[ve.paint.get("hillshade-exaggeration"),Te],u_shadow:fe,u_highlight:ze,u_accent:$e}})(_,d,m,Z?s:null),Z,m.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments)}function xm(_,s,d,m,g,b){const P=_.context,R=P.gl,D=s.dem;if(D&&D.data){const H=D.dim,$=D.stride,Z=D.getPixels();if(P.activeTexture.set(R.TEXTURE1),P.pixelStoreUnpackPremultiplyAlpha.set(!1),s.demTexture=s.demTexture||_.getTileTexture($),s.demTexture){const _e=s.demTexture;_e.update(Z,{premultiply:!1}),_e.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else s.demTexture=new Fe(P,Z,R.RGBA,{premultiply:!1}),s.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);P.activeTexture.set(R.TEXTURE0);let se=s.fbo;if(!se){const _e=new Fe(P,{width:H,height:H,data:null},R.RGBA);_e.bind(R.LINEAR,R.CLAMP_TO_EDGE),se=s.fbo=P.createFramebuffer(H,H,!0,!1),se.colorAttachment.set(_e.texture)}P.bindFramebuffer.set(se.framebuffer),P.viewport.set([0,0,H,H]),_.useProgram("hillshadePrepare").draw(P,R.TRIANGLES,m,g,b,pi.disabled,((_e,ve)=>{const we=ve.stride,fe=o.F();return o.aN(fe,0,o.W,-o.W,0,0,1),o.H(fe,fe,[0,-o.W,0]),{u_matrix:fe,u_image:1,u_dimension:[we,we],u_zoom:_e.overscaledZ,u_unpack:ve.getUnpackVector()}})(s.tileID,D),null,d.id,_.rasterBoundsBuffer,_.quadTriangleIndexBuffer,_.rasterBoundsSegments),s.needsHillshadePrepare=!1}}function bm(_,s,d,m,g,b){const P=m.paint.get("raster-fade-duration");if(!b&&P>0){const R=M.now(),D=(R-_.timeAdded)/P,H=s?(R-s.timeAdded)/P:-1,$=d.getSource(),Z=g.coveringZoomLevel({tileSize:$.tileSize,roundZoom:$.roundZoom}),se=!s||Math.abs(s.tileID.overscaledZ-Z)>Math.abs(_.tileID.overscaledZ-Z),_e=se&&_.refreshedUponExpiration?1:o.ac(se?D:1-H,0,1);return _.refreshedUponExpiration&&D>=1&&(_.refreshedUponExpiration=!1),s?{opacity:1,mix:1-_e}:{opacity:_e,mix:0}}return{opacity:1,mix:0}}const mh=new o.aO(1,0,0,1),Af=new o.aO(0,1,0,1),bv=new o.aO(0,0,1,1),wm=new o.aO(1,0,1,1),Ui=new o.aO(0,1,1,1);function no(_,s,d,m){Nl(_,0,s+d/2,_.transform.width,d,m)}function la(_,s,d,m){Nl(_,s-d/2,0,d,_.transform.height,m)}function Nl(_,s,d,m,g,b){const P=_.context,R=P.gl;R.enable(R.SCISSOR_TEST),R.scissor(s*_.pixelRatio,d*_.pixelRatio,m*_.pixelRatio,g*_.pixelRatio),P.clear({color:b}),R.disable(R.SCISSOR_TEST)}function Cf(_,s,d){const m=_.context,g=m.gl,b=d.posMatrix,P=_.useProgram("debug"),R=ti.disabled,D=yi.disabled,H=_.colorModeForRenderPass(),$="$debug",Z=_.style.map.terrain&&_.style.map.terrain.getTerrainData(d);m.activeTexture.set(g.TEXTURE0);const se=s.getTileByID(d.key).latestRawTileData,_e=Math.floor((se&&se.byteLength||0)/1024),ve=s.getTile(d).tileSize,we=512/Math.min(ve,512)*(d.overscaledZ/_.transform.zoom)*.5;let fe=d.canonical.toString();d.overscaledZ!==d.canonical.z&&(fe+=` => ${d.overscaledZ}`),function(ze,$e){ze.initDebugOverlayCanvas();const Te=ze.debugOverlayCanvas,Be=ze.context.gl,Ke=ze.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,Te.width,Te.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText($e,5,5),Ke.strokeText($e,5,5),ze.debugOverlayTexture.update(Te),ze.debugOverlayTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE)}(_,`${fe} ${_e}kB`),P.draw(m,g.TRIANGLES,R,D,ji.alphaBlended,pi.disabled,nh(b,o.aO.transparent,we),null,$,_.debugBuffer,_.quadTriangleIndexBuffer,_.debugSegments),P.draw(m,g.LINE_STRIP,R,D,H,pi.disabled,nh(b,o.aO.red),Z,$,_.debugBuffer,_.tileBorderIndexBuffer,_.debugSegments)}function Pf(_,s,d){const m=_.context,g=m.gl,b=_.colorModeForRenderPass(),P=new ti(g.LEQUAL,ti.ReadWrite,_.depthRangeFor3D),R=_.useProgram("terrain"),D=s.getTerrainMesh();m.bindFramebuffer.set(null),m.viewport.set([0,0,_.width,_.height]);for(const H of d){const $=_.renderToTexture.getTexture(H),Z=s.getTerrainData(H.tileID);m.activeTexture.set(g.TEXTURE0),g.bindTexture(g.TEXTURE_2D,$.texture);const se={u_matrix:_.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_texture:0,u_ele_delta:s.getMeshFrameDelta(_.transform.zoom)};R.draw(m,g.TRIANGLES,P,yi.disabled,b,pi.backCCW,se,Z,"terrain",D.vertexBuffer,D.indexBuffer,D.segments)}}class Bl{constructor(s,d){this.context=new gm(s),this.transform=d,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:o.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=dt.maxUnderzooming+dt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new xi}resize(s,d,m){if(this.width=Math.floor(s*m),this.height=Math.floor(d*m),this.pixelRatio=m,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style._order)this.style._layers[g].resize()}setup(){const s=this.context,d=new o.aV;d.emplaceBack(0,0),d.emplaceBack(o.W,0),d.emplaceBack(0,o.W),d.emplaceBack(o.W,o.W),this.tileExtentBuffer=s.createVertexBuffer(d,Li.members),this.tileExtentSegments=o.$.simpleSegment(0,0,4,2);const m=new o.aV;m.emplaceBack(0,0),m.emplaceBack(o.W,0),m.emplaceBack(0,o.W),m.emplaceBack(o.W,o.W),this.debugBuffer=s.createVertexBuffer(m,Li.members),this.debugSegments=o.$.simpleSegment(0,0,4,5);const g=new o.Z;g.emplaceBack(0,0,0,0),g.emplaceBack(o.W,0,o.W,0),g.emplaceBack(0,o.W,0,o.W),g.emplaceBack(o.W,o.W,o.W,o.W),this.rasterBoundsBuffer=s.createVertexBuffer(g,mt.members),this.rasterBoundsSegments=o.$.simpleSegment(0,0,4,2);const b=new o.aV;b.emplaceBack(0,0),b.emplaceBack(1,0),b.emplaceBack(0,1),b.emplaceBack(1,1),this.viewportBuffer=s.createVertexBuffer(b,Li.members),this.viewportSegments=o.$.simpleSegment(0,0,4,2);const P=new o.aW;P.emplaceBack(0),P.emplaceBack(1),P.emplaceBack(3),P.emplaceBack(2),P.emplaceBack(0),this.tileBorderIndexBuffer=s.createIndexBuffer(P);const R=new o.aX;R.emplaceBack(0,1,2),R.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=s.createIndexBuffer(R);const D=this.context.gl;this.stencilClearMode=new yi({func:D.ALWAYS,mask:0},0,255,D.ZERO,D.ZERO,D.ZERO)}clearStencil(){const s=this.context,d=s.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const m=o.F();o.aN(m,0,this.width,this.height,0,0,1),o.J(m,m,[d.drawingBufferWidth,d.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(s,d.TRIANGLES,ti.disabled,this.stencilClearMode,ji.disabled,pi.disabled,pf(m),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(s,d){if(this.currentStencilSource===s.source||!s.isTileClipped()||!d||!d.length)return;this.currentStencilSource=s.source;const m=this.context,g=m.gl;this.nextStencilID+d.length>256&&this.clearStencil(),m.setColorMode(ji.disabled),m.setDepthMode(ti.disabled);const b=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const P of d){const R=this._tileClippingMaskIDs[P.key]=this.nextStencilID++,D=this.style.map.terrain&&this.style.map.terrain.getTerrainData(P);b.draw(m,g.TRIANGLES,ti.disabled,new yi({func:g.ALWAYS,mask:0},R,255,g.KEEP,g.KEEP,g.REPLACE),ji.disabled,pi.disabled,pf(P.posMatrix),D,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const s=this.nextStencilID++,d=this.context.gl;return new yi({func:d.NOTEQUAL,mask:255},s,255,d.KEEP,d.KEEP,d.REPLACE)}stencilModeForClipping(s){const d=this.context.gl;return new yi({func:d.EQUAL,mask:255},this._tileClippingMaskIDs[s.key],0,d.KEEP,d.KEEP,d.REPLACE)}stencilConfigForOverlap(s){const d=this.context.gl,m=s.sort((P,R)=>R.overscaledZ-P.overscaledZ),g=m[m.length-1].overscaledZ,b=m[0].overscaledZ-g+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const P={};for(let R=0;R<b;R++)P[R+g]=new yi({func:d.GEQUAL,mask:255},R+this.nextStencilID,255,d.KEEP,d.KEEP,d.REPLACE);return this.nextStencilID+=b,[P,m]}return[{[g]:yi.disabled},m]}colorModeForRenderPass(){const s=this.context.gl;return this._showOverdrawInspector?new ji([s.CONSTANT_COLOR,s.ONE],new o.aO(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ji.unblended:ji.alphaBlended}depthModeForSublayer(s,d,m){if(!this.opaquePassEnabledForLayer())return ti.disabled;const g=1-((1+this.currentLayer)*this.numSublayers+s)*this.depthEpsilon;return new ti(m||this.context.gl.LEQUAL,d,[g,g])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(s,d){this.style=s,this.options=d,this.lineAtlas=s.lineAtlas,this.imageManager=s.imageManager,this.glyphManager=s.glyphManager,this.symbolFadeChange=s.placement.symbolFadeChange(M.now()),this.imageManager.beginFrame();const m=this.style._order,g=this.style.sourceCaches,b={},P={},R={};for(const D in g){const H=g[D];H.used&&H.prepare(this.context),b[D]=H.getVisibleCoordinates(),P[D]=b[D].slice().reverse(),R[D]=H.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let D=0;D<m.length;D++)if(this.style._layers[m[D]].is3D()){this.opaquePassCutoff=D;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const D of m){const H=this.style._layers[D];if(!H.hasOffscreenPass()||H.isHidden(this.transform.zoom))continue;const $=P[H.source];(H.type==="custom"||$.length)&&this.renderLayer(this,g[H.source],H,$)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:d.showOverdrawInspector?o.aO.black:o.aO.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=d.showOverdrawInspector,this.depthRangeFor3D=[0,1-(s._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=m.length-1;this.currentLayer>=0;this.currentLayer--){const D=this.style._layers[m[this.currentLayer]],H=g[D.source],$=b[D.source];this._renderTileClippingMasks(D,$),this.renderLayer(this,H,D,$)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<m.length;this.currentLayer++){const D=this.style._layers[m[this.currentLayer]],H=g[D.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(D))continue;const $=(D.type==="symbol"?R:P)[D.source];this._renderTileClippingMasks(D,b[D.source]),this.renderLayer(this,H,D,$)}if(this.options.showTileBoundaries){const D=function(H,$){let Z=null;const se=Object.values(H._layers).flatMap(fe=>fe.source&&!fe.isHidden($)?[H.sourceCaches[fe.source]]:[]),_e=se.filter(fe=>fe.getSource().type==="vector"),ve=se.filter(fe=>fe.getSource().type!=="vector"),we=fe=>{(!Z||Z.getSource().maxzoom<fe.getSource().maxzoom)&&(Z=fe)};return _e.forEach(fe=>we(fe)),Z||ve.forEach(fe=>we(fe)),Z}(this.style,this.transform.zoom);D&&function(H,$,Z){for(let se=0;se<Z.length;se++)Cf(H,$,Z[se])}(this,D,D.getVisibleCoordinates())}this.options.showPadding&&function(D){const H=D.transform.padding;no(D,D.transform.height-(H.top||0),3,mh),no(D,H.bottom||0,3,Af),la(D,H.left||0,3,bv),la(D,D.transform.width-(H.right||0),3,wm);const $=D.transform.centerPoint;(function(Z,se,_e,ve){Nl(Z,se-1,_e-10,2,20,ve),Nl(Z,se-10,_e-1,20,2,ve)})(D,$.x,D.transform.height-$.y,Ui)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(s){if(!this.style||!this.style.map||!this.style.map.terrain)return;const d=this.terrainFacilitator.matrix,m=this.transform.projMatrix;let g=this.terrainFacilitator.dirty;g||(g=s?!o.aY(d,m):!o.aZ(d,m)),g||(g=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),g&&(o.a_(d,m),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(b,P){const R=b.context,D=R.gl,H=ji.unblended,$=new ti(D.LEQUAL,ti.ReadWrite,[0,1]),Z=P.getTerrainMesh(),se=P.sourceCache.getRenderableTiles(),_e=b.useProgram("terrainDepth");R.bindFramebuffer.set(P.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:o.aO.transparent,depth:1});for(const ve of se){const we=P.getTerrainData(ve.tileID),fe={u_matrix:b.transform.calculatePosMatrix(ve.tileID.toUnwrapped()),u_ele_delta:P.getMeshFrameDelta(b.transform.zoom)};_e.draw(R,D.TRIANGLES,$,yi.disabled,H,pi.backCCW,fe,we,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain),function(b,P){const R=b.context,D=R.gl,H=ji.unblended,$=new ti(D.LEQUAL,ti.ReadWrite,[0,1]),Z=P.getTerrainMesh(),se=P.getCoordsTexture(),_e=P.sourceCache.getRenderableTiles(),ve=b.useProgram("terrainCoords");R.bindFramebuffer.set(P.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,b.width/devicePixelRatio,b.height/devicePixelRatio]),R.clear({color:o.aO.transparent,depth:1}),P.coordsIndex=[];for(const we of _e){const fe=P.getTerrainData(we.tileID);R.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,se.texture);const ze={u_matrix:b.transform.calculatePosMatrix(we.tileID.toUnwrapped()),u_terrain_coords_id:(255-P.coordsIndex.length)/255,u_texture:0,u_ele_delta:P.getMeshFrameDelta(b.transform.zoom)};ve.draw(R,D.TRIANGLES,$,yi.disabled,H,pi.backCCW,ze,fe,"terrain",Z.vertexBuffer,Z.indexBuffer,Z.segments),P.coordsIndex.push(we.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,b.width,b.height])}(this,this.style.map.terrain))}renderLayer(s,d,m,g){if(!m.isHidden(this.transform.zoom)&&(m.type==="background"||m.type==="custom"||(g||[]).length))switch(this.id=m.id,m.type){case"symbol":(function(b,P,R,D,H){if(b.renderPass!=="translucent")return;const $=yi.disabled,Z=b.colorModeForRenderPass();(R._unevaluatedLayout.hasValue("text-variable-anchor")||R._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(se,_e,ve,we,fe,ze,$e){const Te=_e.transform,Be=fe==="map",Ke=ze==="map";for(const Qe of se){const lt=we.getTile(Qe),bt=lt.getBucket(ve);if(!bt||!bt.text||!bt.text.segments.get().length)continue;const vt=o.ag(bt.textSizeData,Te.zoom),xt=wn(lt,1,_e.transform.zoom),Zt=pt(Qe.posMatrix,Ke,Be,_e.transform,xt),zn=ve.layout.get("icon-text-fit")!=="none"&&bt.hasIconData();if(vt){const Bt=Math.pow(2,Te.zoom-lt.tileID.overscaledZ);fh(bt,Be,Ke,$e,Te,Zt,Qe.posMatrix,Bt,vt,zn,_e.style.map.terrain?(Tn,Nn)=>_e.style.map.terrain.getElevation(Qe,Tn,Nn):null)}}}(D,b,R,P,R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),H),R.paint.get("icon-opacity").constantOr(1)!==0&&vm(b,P,R,D,!1,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),R.layout.get("icon-rotation-alignment"),R.layout.get("icon-pitch-alignment"),R.layout.get("icon-keep-upright"),$,Z),R.paint.get("text-opacity").constantOr(1)!==0&&vm(b,P,R,D,!0,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),R.layout.get("text-rotation-alignment"),R.layout.get("text-pitch-alignment"),R.layout.get("text-keep-upright"),$,Z),P.map.showCollisionBoxes&&(hh(b,P,R,D,R.paint.get("text-translate"),R.paint.get("text-translate-anchor"),!0),hh(b,P,R,D,R.paint.get("icon-translate"),R.paint.get("icon-translate-anchor"),!1))})(s,d,m,g,this.style.placement.variableOffsets);break;case"circle":(function(b,P,R,D){if(b.renderPass!=="translucent")return;const H=R.paint.get("circle-opacity"),$=R.paint.get("circle-stroke-width"),Z=R.paint.get("circle-stroke-opacity"),se=!R.layout.get("circle-sort-key").isConstant();if(H.constantOr(1)===0&&($.constantOr(1)===0||Z.constantOr(1)===0))return;const _e=b.context,ve=_e.gl,we=b.depthModeForSublayer(0,ti.ReadOnly),fe=yi.disabled,ze=b.colorModeForRenderPass(),$e=[];for(let Te=0;Te<D.length;Te++){const Be=D[Te],Ke=P.getTile(Be),Qe=Ke.getBucket(R);if(!Qe)continue;const lt=Qe.programConfigurations.get(R.id),bt=b.useProgram("circle",lt),vt=Qe.layoutVertexBuffer,xt=Qe.indexBuffer,Zt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Be),zn={programConfiguration:lt,program:bt,layoutVertexBuffer:vt,indexBuffer:xt,uniformValues:am(b,Be,Ke,R),terrainData:Zt};if(se){const Bt=Qe.segments.get();for(const Tn of Bt)$e.push({segments:new o.$([Tn]),sortKey:Tn.sortKey,state:zn})}else $e.push({segments:Qe.segments,sortKey:0,state:zn})}se&&$e.sort((Te,Be)=>Te.sortKey-Be.sortKey);for(const Te of $e){const{programConfiguration:Be,program:Ke,layoutVertexBuffer:Qe,indexBuffer:lt,uniformValues:bt,terrainData:vt}=Te.state;Ke.draw(_e,ve.TRIANGLES,we,fe,ze,pi.disabled,bt,vt,R.id,Qe,lt,Te.segments,R.paint,b.transform.zoom,Be)}})(s,d,m,g);break;case"heatmap":(function(b,P,R,D){if(R.paint.get("heatmap-opacity")!==0)if(b.renderPass==="offscreen"){const H=b.context,$=H.gl,Z=yi.disabled,se=new ji([$.ONE,$.ONE],o.aO.transparent,[!0,!0,!0,!0]);(function(_e,ve,we){const fe=_e.gl;_e.activeTexture.set(fe.TEXTURE1),_e.viewport.set([0,0,ve.width/4,ve.height/4]);let ze=we.heatmapFbo;if(ze)fe.bindTexture(fe.TEXTURE_2D,ze.colorAttachment.get()),_e.bindFramebuffer.set(ze.framebuffer);else{const $e=fe.createTexture();fe.bindTexture(fe.TEXTURE_2D,$e),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_S,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_WRAP_T,fe.CLAMP_TO_EDGE),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MIN_FILTER,fe.LINEAR),fe.texParameteri(fe.TEXTURE_2D,fe.TEXTURE_MAG_FILTER,fe.LINEAR),ze=we.heatmapFbo=_e.createFramebuffer(ve.width/4,ve.height/4,!1,!1),function(Te,Be,Ke,Qe){var lt,bt;const vt=Te.gl,xt=(lt=Te.HALF_FLOAT)!==null&&lt!==void 0?lt:vt.UNSIGNED_BYTE,Zt=(bt=Te.RGBA16F)!==null&&bt!==void 0?bt:vt.RGBA;vt.texImage2D(vt.TEXTURE_2D,0,Zt,Be.width/4,Be.height/4,0,vt.RGBA,xt,null),Qe.colorAttachment.set(Ke)}(_e,ve,$e,ze)}})(H,b,R),H.clear({color:o.aO.transparent});for(let _e=0;_e<D.length;_e++){const ve=D[_e];if(P.hasRenderableParent(ve))continue;const we=P.getTile(ve),fe=we.getBucket(R);if(!fe)continue;const ze=fe.programConfigurations.get(R.id),$e=b.useProgram("heatmap",ze),{zoom:Te}=b.transform;$e.draw(H,$.TRIANGLES,ti.disabled,Z,se,pi.disabled,sm(ve.posMatrix,we,Te,R.paint.get("heatmap-intensity")),null,R.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,R.paint,b.transform.zoom,ze)}H.viewport.set([0,0,b.width,b.height])}else b.renderPass==="translucent"&&(b.context.setColorMode(b.colorModeForRenderPass()),function(H,$){const Z=H.context,se=Z.gl,_e=$.heatmapFbo;if(!_e)return;Z.activeTexture.set(se.TEXTURE0),se.bindTexture(se.TEXTURE_2D,_e.colorAttachment.get()),Z.activeTexture.set(se.TEXTURE1);let ve=$.colorRampTexture;ve||(ve=$.colorRampTexture=new Fe(Z,$.colorRamp,se.RGBA)),ve.bind(se.LINEAR,se.CLAMP_TO_EDGE),H.useProgram("heatmapTexture").draw(Z,se.TRIANGLES,ti.disabled,yi.disabled,H.colorModeForRenderPass(),pi.disabled,((we,fe,ze,$e)=>{const Te=o.F();o.aN(Te,0,we.width,we.height,0,0,1);const Be=we.context.gl;return{u_matrix:Te,u_world:[Be.drawingBufferWidth,Be.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:fe.paint.get("heatmap-opacity")}})(H,$),null,$.id,H.viewportBuffer,H.quadTriangleIndexBuffer,H.viewportSegments,$.paint,H.transform.zoom)}(b,R))})(s,d,m,g);break;case"line":(function(b,P,R,D){if(b.renderPass!=="translucent")return;const H=R.paint.get("line-opacity"),$=R.paint.get("line-width");if(H.constantOr(1)===0||$.constantOr(1)===0)return;const Z=b.depthModeForSublayer(0,ti.ReadOnly),se=b.colorModeForRenderPass(),_e=R.paint.get("line-dasharray"),ve=R.paint.get("line-pattern"),we=ve.constantOr(1),fe=R.paint.get("line-gradient"),ze=R.getCrossfadeParameters(),$e=we?"linePattern":_e?"lineSDF":fe?"lineGradient":"line",Te=b.context,Be=Te.gl;let Ke=!0;for(const Qe of D){const lt=P.getTile(Qe);if(we&&!lt.patternsLoaded())continue;const bt=lt.getBucket(R);if(!bt)continue;const vt=bt.programConfigurations.get(R.id),xt=b.context.program.get(),Zt=b.useProgram($e,vt),zn=Ke||Zt.program!==xt,Bt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(Qe),Tn=ve.constantOr(null);if(Tn&&lt.imageAtlas){const Rn=lt.imageAtlas,Vn=Rn.patternPositions[Tn.to.toString()],Hn=Rn.patternPositions[Tn.from.toString()];Vn&&Hn&&vt.setConstantPatternPositions(Vn,Hn)}const Nn=Bt?Qe:null,Xn=we?rh(b,lt,R,ze,Nn):_e?Ta(b,lt,R,_e,ze,Nn):fe?ko(b,lt,R,bt.lineClipsArray.length,Nn):ih(b,lt,R,Nn);if(we)Te.activeTexture.set(Be.TEXTURE0),lt.imageAtlasTexture.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),vt.updatePaintBuffers(ze);else if(_e&&(zn||b.lineAtlas.dirty))Te.activeTexture.set(Be.TEXTURE0),b.lineAtlas.bind(Te);else if(fe){const Rn=bt.gradients[R.id];let Vn=Rn.texture;if(R.gradientVersion!==Rn.version){let Hn=256;if(R.stepInterpolant){const Ii=P.getSource().maxzoom,mi=Qe.canonical.z===Ii?Math.ceil(1<<b.transform.maxZoom-Qe.canonical.z):1;Hn=o.ac(o.aT(bt.maxLineLength/o.W*1024*mi),256,Te.maxTextureSize)}Rn.gradient=o.aU({expression:R.gradientExpression(),evaluationKey:"lineProgress",resolution:Hn,image:Rn.gradient||void 0,clips:bt.lineClipsArray}),Rn.texture?Rn.texture.update(Rn.gradient):Rn.texture=new Fe(Te,Rn.gradient,Be.RGBA),Rn.version=R.gradientVersion,Vn=Rn.texture}Te.activeTexture.set(Be.TEXTURE0),Vn.bind(R.stepInterpolant?Be.NEAREST:Be.LINEAR,Be.CLAMP_TO_EDGE)}Zt.draw(Te,Be.TRIANGLES,Z,b.stencilModeForClipping(Qe),se,pi.disabled,Xn,Bt,R.id,bt.layoutVertexBuffer,bt.indexBuffer,bt.segments,R.paint,b.transform.zoom,vt,bt.layoutVertexBuffer2),Ke=!1}})(s,d,m,g);break;case"fill":(function(b,P,R,D){const H=R.paint.get("fill-color"),$=R.paint.get("fill-opacity");if($.constantOr(1)===0)return;const Z=b.colorModeForRenderPass(),se=R.paint.get("fill-pattern"),_e=b.opaquePassEnabledForLayer()&&!se.constantOr(1)&&H.constantOr(o.aO.transparent).a===1&&$.constantOr(0)===1?"opaque":"translucent";if(b.renderPass===_e){const ve=b.depthModeForSublayer(1,b.renderPass==="opaque"?ti.ReadWrite:ti.ReadOnly);Tf(b,P,R,D,ve,Z,!1)}if(b.renderPass==="translucent"&&R.paint.get("fill-antialias")){const ve=b.depthModeForSublayer(R.getPaintProperty("fill-outline-color")?2:0,ti.ReadOnly);Tf(b,P,R,D,ve,Z,!0)}})(s,d,m,g);break;case"fill-extrusion":(function(b,P,R,D){const H=R.paint.get("fill-extrusion-opacity");if(H!==0&&b.renderPass==="translucent"){const $=new ti(b.context.gl.LEQUAL,ti.ReadWrite,b.depthRangeFor3D);if(H!==1||R.paint.get("fill-extrusion-pattern").constantOr(1))Fl(b,P,R,D,$,yi.disabled,ji.disabled),Fl(b,P,R,D,$,b.stencilModeFor3D(),b.colorModeForRenderPass());else{const Z=b.colorModeForRenderPass();Fl(b,P,R,D,$,yi.disabled,Z)}}})(s,d,m,g);break;case"hillshade":(function(b,P,R,D){if(b.renderPass!=="offscreen"&&b.renderPass!=="translucent")return;const H=b.context,$=b.depthModeForSublayer(0,ti.ReadOnly),Z=b.colorModeForRenderPass(),[se,_e]=b.renderPass==="translucent"?b.stencilConfigForOverlap(D):[{},D];for(const ve of _e){const we=P.getTile(ve);we.needsHillshadePrepare!==void 0&&we.needsHillshadePrepare&&b.renderPass==="offscreen"?xm(b,we,R,$,yi.disabled,Z):b.renderPass==="translucent"&&Ef(b,ve,we,R,$,se[ve.overscaledZ],Z)}H.viewport.set([0,0,b.width,b.height])})(s,d,m,g);break;case"raster":(function(b,P,R,D){if(b.renderPass!=="translucent"||R.paint.get("raster-opacity")===0||!D.length)return;const H=b.context,$=H.gl,Z=P.getSource(),se=b.useProgram("raster"),_e=b.colorModeForRenderPass(),[ve,we]=Z instanceof St?[{},D]:b.stencilConfigForOverlap(D),fe=we[we.length-1].overscaledZ,ze=!b.options.moving;for(const $e of we){const Te=b.depthModeForSublayer($e.overscaledZ-fe,R.paint.get("raster-opacity")===1?ti.ReadWrite:ti.ReadOnly,$.LESS),Be=P.getTile($e);Be.registerFadeDuration(R.paint.get("raster-fade-duration"));const Ke=P.findLoadedParent($e,0),Qe=bm(Be,Ke,P,R,b.transform,b.style.map.terrain);let lt,bt;const vt=R.paint.get("raster-resampling")==="nearest"?$.NEAREST:$.LINEAR;H.activeTexture.set($.TEXTURE0),Be.texture.bind(vt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),H.activeTexture.set($.TEXTURE1),Ke?(Ke.texture.bind(vt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST),lt=Math.pow(2,Ke.tileID.overscaledZ-Be.tileID.overscaledZ),bt=[Be.tileID.canonical.x*lt%1,Be.tileID.canonical.y*lt%1]):Be.texture.bind(vt,$.CLAMP_TO_EDGE,$.LINEAR_MIPMAP_NEAREST);const xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData($e),Zt=xt?$e:null,zn=Zt?Zt.posMatrix:b.transform.calculatePosMatrix($e.toUnwrapped(),ze),Bt=Zc(zn,bt||[0,0],lt||1,Qe,R);Z instanceof St?se.draw(H,$.TRIANGLES,Te,yi.disabled,_e,pi.disabled,Bt,xt,R.id,Z.boundsBuffer,b.quadTriangleIndexBuffer,Z.boundsSegments):se.draw(H,$.TRIANGLES,Te,ve[$e.overscaledZ],_e,pi.disabled,Bt,xt,R.id,b.rasterBoundsBuffer,b.quadTriangleIndexBuffer,b.rasterBoundsSegments)}})(s,d,m,g);break;case"background":(function(b,P,R,D){const H=R.paint.get("background-color"),$=R.paint.get("background-opacity");if($===0)return;const Z=b.context,se=Z.gl,_e=b.transform,ve=_e.tileSize,we=R.paint.get("background-pattern");if(b.isPatternMissing(we))return;const fe=!we&&H.a===1&&$===1&&b.opaquePassEnabledForLayer()?"opaque":"translucent";if(b.renderPass!==fe)return;const ze=yi.disabled,$e=b.depthModeForSublayer(0,fe==="opaque"?ti.ReadWrite:ti.ReadOnly),Te=b.colorModeForRenderPass(),Be=b.useProgram(we?"backgroundPattern":"background"),Ke=D||_e.coveringTiles({tileSize:ve,terrain:b.style.map.terrain});we&&(Z.activeTexture.set(se.TEXTURE0),b.imageManager.bind(b.context));const Qe=R.getCrossfadeParameters();for(const lt of Ke){const bt=D?lt.posMatrix:b.transform.calculatePosMatrix(lt.toUnwrapped()),vt=we?lm(bt,$,b,we,{tileID:lt,tileSize:ve},Qe):hv(bt,$,H),xt=b.style.map.terrain&&b.style.map.terrain.getTerrainData(lt);Be.draw(Z,se.TRIANGLES,$e,ze,Te,pi.disabled,vt,xt,R.id,b.tileExtentBuffer,b.quadTriangleIndexBuffer,b.tileExtentSegments)}})(s,0,m,g);break;case"custom":(function(b,P,R){const D=b.context,H=R.implementation;if(b.renderPass==="offscreen"){const $=H.prerender;$&&(b.setCustomLayerDefaults(),D.setColorMode(b.colorModeForRenderPass()),$.call(H,D.gl,b.transform.customLayerMatrix()),D.setDirty(),b.setBaseState())}else if(b.renderPass==="translucent"){b.setCustomLayerDefaults(),D.setColorMode(b.colorModeForRenderPass()),D.setStencilMode(yi.disabled);const $=H.renderingMode==="3d"?new ti(b.context.gl.LEQUAL,ti.ReadWrite,b.depthRangeFor3D):b.depthModeForSublayer(0,ti.ReadOnly);D.setDepthMode($),H.render(D.gl,b.transform.customLayerMatrix()),D.setDirty(),b.setBaseState(),D.bindFramebuffer.set(null)}})(s,0,m)}}translatePosMatrix(s,d,m,g,b){if(!m[0]&&!m[1])return s;const P=b?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(P){const H=Math.sin(P),$=Math.cos(P);m=[m[0]*$-m[1]*H,m[0]*H+m[1]*$]}const R=[b?m[0]:wn(d,m[0],this.transform.zoom),b?m[1]:wn(d,m[1],this.transform.zoom),0],D=new Float32Array(16);return o.H(D,s,R),D}saveTileTexture(s){const d=this._tileTextures[s.size[0]];d?d.push(s):this._tileTextures[s.size[0]]=[s]}getTileTexture(s){const d=this._tileTextures[s];return d&&d.length>0?d.pop():null}isPatternMissing(s){if(!s)return!1;if(!s.from||!s.to)return!0;const d=this.imageManager.getPattern(s.from.toString()),m=this.imageManager.getPattern(s.to.toString());return!d||!m}useProgram(s,d){this.cache=this.cache||{};const m=s+(d?d.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[m]||(this.cache[m]=new ff(this.context,to[s],d,dv[s],this._showOverdrawInspector,this.style.map.terrain)),this.cache[m]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const s=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(s.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Fe(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:s,drawingBufferHeight:d}=this.context.gl;return this.width!==s||this.height!==d}}class zo{constructor(s,d){this.points=s,this.planes=d}static fromInvProjectionMatrix(s,d,m){const g=Math.pow(2,m),b=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(R=>{const D=1/(R=o.af([],R,s))[3]/d*g;return o.a$(R,R,[D,D,1/R[3],D])}),P=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(R=>{const D=function(se,_e){var ve=_e[0],we=_e[1],fe=_e[2],ze=ve*ve+we*we+fe*fe;return ze>0&&(ze=1/Math.sqrt(ze)),se[0]=_e[0]*ze,se[1]=_e[1]*ze,se[2]=_e[2]*ze,se}([],function(se,_e,ve){var we=_e[0],fe=_e[1],ze=_e[2],$e=ve[0],Te=ve[1],Be=ve[2];return se[0]=fe*Be-ze*Te,se[1]=ze*$e-we*Be,se[2]=we*Te-fe*$e,se}([],re([],b[R[0]],b[R[1]]),re([],b[R[2]],b[R[1]]))),H=-(($=D)[0]*(Z=b[R[1]])[0]+$[1]*Z[1]+$[2]*Z[2]);var $,Z;return D.concat(H)});return new zo(b,P)}}class Ol{constructor(s,d){this.min=s,this.max=d,this.center=function(m,g,b){return m[0]=.5*g[0],m[1]=.5*g[1],m[2]=.5*g[2],m}([],function(m,g,b){return m[0]=g[0]+b[0],m[1]=g[1]+b[1],m[2]=g[2]+b[2],m}([],this.min,this.max))}quadrant(s){const d=[s%2==0,s<2],m=Q(this.min),g=Q(this.max);for(let b=0;b<d.length;b++)m[b]=d[b]?this.min[b]:this.center[b],g[b]=d[b]?this.center[b]:this.max[b];return g[2]=this.max[2],new Ol(m,g)}distanceX(s){return Math.max(Math.min(this.max[0],s[0]),this.min[0])-s[0]}distanceY(s){return Math.max(Math.min(this.max[1],s[1]),this.min[1])-s[1]}intersects(s){const d=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let m=!0;for(let g=0;g<s.planes.length;g++){const b=s.planes[g];let P=0;for(let R=0;R<d.length;R++)o.b0(b,d[R])>=0&&P++;if(P===0)return 0;P!==d.length&&(m=!1)}if(m)return 2;for(let g=0;g<3;g++){let b=Number.MAX_VALUE,P=-Number.MAX_VALUE;for(let R=0;R<s.points.length;R++){const D=s.points[R][g]-this.min[g];b=Math.min(b,D),P=Math.max(P,D)}if(P<0||b>this.max[g]-this.min[g])return 0}return 1}}class Qc{constructor(s=0,d=0,m=0,g=0){if(isNaN(s)||s<0||isNaN(d)||d<0||isNaN(m)||m<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=s,this.bottom=d,this.left=m,this.right=g}interpolate(s,d,m){return d.top!=null&&s.top!=null&&(this.top=o.z.number(s.top,d.top,m)),d.bottom!=null&&s.bottom!=null&&(this.bottom=o.z.number(s.bottom,d.bottom,m)),d.left!=null&&s.left!=null&&(this.left=o.z.number(s.left,d.left,m)),d.right!=null&&s.right!=null&&(this.right=o.z.number(s.right,d.right,m)),this}getCenter(s,d){const m=o.ac((this.left+s-this.right)/2,0,s),g=o.ac((this.top+d-this.bottom)/2,0,d);return new o.P(m,g)}equals(s){return this.top===s.top&&this.bottom===s.bottom&&this.left===s.left&&this.right===s.right}clone(){return new Qc(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const Rf=85.051129;class gh{constructor(s,d,m,g,b){this.tileSize=512,this._renderWorldCopies=b===void 0||!!b,this._minZoom=s||0,this._maxZoom=d||22,this._minPitch=m??0,this._maxPitch=g??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new o.M(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Qc,this._posMatrixCache={},this._alignedPosMatrixCache={},this.minElevationForCurrentTile=0}clone(){const s=new gh(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return s.apply(this),s}apply(s){this.tileSize=s.tileSize,this.latRange=s.latRange,this.width=s.width,this.height=s.height,this._center=s._center,this._elevation=s._elevation,this.minElevationForCurrentTile=s.minElevationForCurrentTile,this.zoom=s.zoom,this.angle=s.angle,this._fov=s._fov,this._pitch=s._pitch,this._unmodified=s._unmodified,this._edgeInsets=s._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(s){this._minZoom!==s&&(this._minZoom=s,this.zoom=Math.max(this.zoom,s))}get maxZoom(){return this._maxZoom}set maxZoom(s){this._maxZoom!==s&&(this._maxZoom=s,this.zoom=Math.min(this.zoom,s))}get minPitch(){return this._minPitch}set minPitch(s){this._minPitch!==s&&(this._minPitch=s,this.pitch=Math.max(this.pitch,s))}get maxPitch(){return this._maxPitch}set maxPitch(s){this._maxPitch!==s&&(this._maxPitch=s,this.pitch=Math.min(this.pitch,s))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(s){s===void 0?s=!0:s===null&&(s=!1),this._renderWorldCopies=s}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(s){const d=-o.b1(s,-180,180)*Math.PI/180;this.angle!==d&&(this._unmodified=!1,this.angle=d,this._calcMatrices(),this.rotationMatrix=function(){var m=new o.A(4);return o.A!=Float32Array&&(m[1]=0,m[2]=0),m[0]=1,m[3]=1,m}(),function(m,g,b){var P=g[0],R=g[1],D=g[2],H=g[3],$=Math.sin(b),Z=Math.cos(b);m[0]=P*Z+D*$,m[1]=R*Z+H*$,m[2]=P*-$+D*Z,m[3]=R*-$+H*Z}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(s){const d=o.ac(s,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==d&&(this._unmodified=!1,this._pitch=d,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(s){s=Math.max(.01,Math.min(60,s)),this._fov!==s&&(this._unmodified=!1,this._fov=s/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(s){const d=Math.min(Math.max(s,this.minZoom),this.maxZoom);this._zoom!==d&&(this._unmodified=!1,this._zoom=d,this.tileZoom=Math.max(0,Math.floor(d)),this.scale=this.zoomScale(d),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(s){s.lat===this._center.lat&&s.lng===this._center.lng||(this._unmodified=!1,this._center=s,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(s){s!==this._elevation&&(this._elevation=s,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(s){this._edgeInsets.equals(s)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,s,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(s){return this._edgeInsets.equals(s)}interpolatePadding(s,d,m){this._unmodified=!1,this._edgeInsets.interpolate(s,d,m),this._constrain(),this._calcMatrices()}coveringZoomLevel(s){const d=(s.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/s.tileSize));return Math.max(0,d)}getVisibleUnwrappedCoordinates(s){const d=[new o.b2(0,s)];if(this._renderWorldCopies){const m=this.pointCoordinate(new o.P(0,0)),g=this.pointCoordinate(new o.P(this.width,0)),b=this.pointCoordinate(new o.P(this.width,this.height)),P=this.pointCoordinate(new o.P(0,this.height)),R=Math.floor(Math.min(m.x,g.x,b.x,P.x)),D=Math.floor(Math.max(m.x,g.x,b.x,P.x)),H=1;for(let $=R-H;$<=D+H;$++)$!==0&&d.push(new o.b2($,s))}return d}coveringTiles(s){var d,m;let g=this.coveringZoomLevel(s);const b=g;if(s.minzoom!==void 0&&g<s.minzoom)return[];s.maxzoom!==void 0&&g>s.maxzoom&&(g=s.maxzoom);const P=this.pointCoordinate(this.getCameraPoint()),R=o.Y.fromLngLat(this.center),D=Math.pow(2,g),H=[D*P.x,D*P.y,0],$=[D*R.x,D*R.y,0],Z=zo.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,g);let se=s.minzoom||0;!s.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(se=g);const _e=s.terrain?2/Math.min(this.tileSize,s.tileSize)*this.tileSize:3,ve=Te=>({aabb:new Ol([Te*D,0,0],[(Te+1)*D,D,0]),zoom:0,x:0,y:0,wrap:Te,fullyVisible:!1}),we=[],fe=[],ze=g,$e=s.reparseOverscaled?b:g;if(this._renderWorldCopies)for(let Te=1;Te<=3;Te++)we.push(ve(-Te)),we.push(ve(Te));for(we.push(ve(0));we.length>0;){const Te=we.pop(),Be=Te.x,Ke=Te.y;let Qe=Te.fullyVisible;if(!Qe){const Zt=Te.aabb.intersects(Z);if(Zt===0)continue;Qe=Zt===2}const lt=s.terrain?H:$,bt=Te.aabb.distanceX(lt),vt=Te.aabb.distanceY(lt),xt=Math.max(Math.abs(bt),Math.abs(vt));if(Te.zoom===ze||xt>_e+(1<<ze-Te.zoom)-2&&Te.zoom>=se){const Zt=ze-Te.zoom,zn=H[0]-.5-(Be<<Zt),Bt=H[1]-.5-(Ke<<Zt);fe.push({tileID:new o.Q(Te.zoom===ze?$e:Te.zoom,Te.wrap,Te.zoom,Be,Ke),distanceSq:ee([$[0]-.5-Be,$[1]-.5-Ke]),tileDistanceToCamera:Math.sqrt(zn*zn+Bt*Bt)})}else for(let Zt=0;Zt<4;Zt++){const zn=(Be<<1)+Zt%2,Bt=(Ke<<1)+(Zt>>1),Tn=Te.zoom+1;let Nn=Te.aabb.quadrant(Zt);if(s.terrain){const Xn=new o.Q(Tn,Te.wrap,Tn,zn,Bt),Rn=s.terrain.getMinMaxElevation(Xn),Vn=(d=Rn.minElevation)!==null&&d!==void 0?d:this.elevation,Hn=(m=Rn.maxElevation)!==null&&m!==void 0?m:this.elevation;Nn=new Ol([Nn.min[0],Nn.min[1],Vn],[Nn.max[0],Nn.max[1],Hn])}we.push({aabb:Nn,zoom:Tn,x:zn,y:Bt,wrap:Te.wrap,fullyVisible:Qe})}}return fe.sort((Te,Be)=>Te.distanceSq-Be.distanceSq).map(Te=>Te.tileID)}resize(s,d){this.width=s,this.height=d,this.pixelsToGLUnits=[2/s,-2/d],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(s){return Math.pow(2,s)}scaleZoom(s){return Math.log(s)/Math.LN2}project(s){const d=o.ac(s.lat,-85.051129,Rf);return new o.P(o.N(s.lng)*this.worldSize,o.O(d)*this.worldSize)}unproject(s){return new o.Y(s.x/this.worldSize,s.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(s){const d=this.elevation,m=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,g=this.pointLocation(this.centerPoint,s),b=s.getElevationForLngLatZoom(g,this.tileZoom);if(!(this.elevation-b))return;const P=m+d-b,R=Math.cos(this._pitch)*this.cameraToCenterDistance/P/o.b3(1,g.lat),D=this.scaleZoom(R/this.tileSize);this._elevation=b,this._center=g,this.zoom=D}setLocationAtPoint(s,d){const m=this.pointCoordinate(d),g=this.pointCoordinate(this.centerPoint),b=this.locationCoordinate(s),P=new o.Y(b.x-(m.x-g.x),b.y-(m.y-g.y));this.center=this.coordinateLocation(P),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(s,d){return d?this.coordinatePoint(this.locationCoordinate(s),d.getElevationForLngLatZoom(s,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(s))}pointLocation(s,d){return this.coordinateLocation(this.pointCoordinate(s,d))}locationCoordinate(s){return o.Y.fromLngLat(s)}coordinateLocation(s){return s&&s.toLngLat()}pointCoordinate(s,d){if(d){const se=d.pointCoordinate(s);if(se!=null)return se}const m=[s.x,s.y,0,1],g=[s.x,s.y,1,1];o.af(m,m,this.pixelMatrixInverse),o.af(g,g,this.pixelMatrixInverse);const b=m[3],P=g[3],R=m[1]/b,D=g[1]/P,H=m[2]/b,$=g[2]/P,Z=H===$?0:(0-H)/($-H);return new o.Y(o.z.number(m[0]/b,g[0]/P,Z)/this.worldSize,o.z.number(R,D,Z)/this.worldSize)}coordinatePoint(s,d=0,m=this.pixelMatrix){const g=[s.x*this.worldSize,s.y*this.worldSize,d,1];return o.af(g,g,m),new o.P(g[0]/g[3],g[1]/g[3])}getBounds(){const s=Math.max(0,this.height/2-this.getHorizon());return new Yt().extend(this.pointLocation(new o.P(0,s))).extend(this.pointLocation(new o.P(this.width,s))).extend(this.pointLocation(new o.P(this.width,this.height))).extend(this.pointLocation(new o.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new Yt([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(s){s?(this.lngRange=[s.getWest(),s.getEast()],this.latRange=[s.getSouth(),s.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,Rf])}calculatePosMatrix(s,d=!1){const m=s.key,g=d?this._alignedPosMatrixCache:this._posMatrixCache;if(g[m])return g[m];const b=s.canonical,P=this.worldSize/this.zoomScale(b.z),R=b.x+Math.pow(2,b.z)*s.wrap,D=o.an(new Float64Array(16));return o.H(D,D,[R*P,b.y*P,0]),o.J(D,D,[P/o.W,P/o.W,1]),o.K(D,d?this.alignedProjMatrix:this.projMatrix,D),g[m]=new Float32Array(D),g[m]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(s,d){d=o.ac(+d,this.minZoom,this.maxZoom);const m={center:new o.M(s.lng,s.lat),zoom:d};let g=this.lngRange;if(!this._renderWorldCopies&&g===null){const Te=179.9999999999;g=[-Te,Te]}const b=this.tileSize*this.zoomScale(m.zoom);let P=0,R=b,D=0,H=b,$=0,Z=0;const{x:se,y:_e}=this.size;if(this.latRange){const Te=this.latRange;P=o.O(Te[1])*b,R=o.O(Te[0])*b,R-P<_e&&($=_e/(R-P))}g&&(D=o.b1(o.N(g[0])*b,0,b),H=o.b1(o.N(g[1])*b,0,b),H<D&&(H+=b),H-D<se&&(Z=se/(H-D)));const{x:ve,y:we}=this.project.call({worldSize:b},s);let fe,ze;const $e=Math.max(Z||0,$||0);if($e){const Te=new o.P(Z?(H+D)/2:ve,$?(R+P)/2:we);return m.center=this.unproject.call({worldSize:b},Te).wrap(),m.zoom+=this.scaleZoom($e),m}if(this.latRange){const Te=_e/2;we-Te<P&&(ze=P+Te),we+Te>R&&(ze=R-Te)}if(g){const Te=(D+H)/2;let Be=ve;this._renderWorldCopies&&(Be=o.b1(ve,Te-b/2,Te+b/2));const Ke=se/2;Be-Ke<D&&(fe=D+Ke),Be+Ke>H&&(fe=H-Ke)}if(fe!==void 0||ze!==void 0){const Te=new o.P(fe??ve,ze??we);m.center=this.unproject.call({worldSize:b},Te).wrap()}return m}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const s=this._unmodified,{center:d,zoom:m}=this.getConstrained(this.center,this.zoom);this.center=d,this.zoom=m,this._unmodified=s,this._constraining=!1}_calcMatrices(){if(!this.height)return;const s=this.centerOffset,d=this.point.x,m=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=o.b3(1,this.center.lat)*this.worldSize;let g=o.an(new Float64Array(16));o.J(g,g,[this.width/2,-this.height/2,1]),o.H(g,g,[1,-1,0]),this.labelPlaneMatrix=g,g=o.an(new Float64Array(16)),o.J(g,g,[1,-1,1]),o.H(g,g,[-1,-1,0]),o.J(g,g,[2/this.width,2/this.height,1]),this.glCoordMatrix=g;const b=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),P=Math.min(this.elevation,this.minElevationForCurrentTile),R=b-P*this._pixelPerMeter/Math.cos(this._pitch),D=P<0?R:b,H=Math.PI/2+this._pitch,$=this._fov*(.5+s.y/this.height),Z=Math.sin($)*D/Math.sin(o.ac(Math.PI-H-$,.01,Math.PI-.01)),se=this.getHorizon(),_e=2*Math.atan(se/this.cameraToCenterDistance)*(.5+s.y/(2*se)),ve=Math.sin(_e)*D/Math.sin(o.ac(Math.PI-H-_e,.01,Math.PI-.01)),we=Math.min(Z,ve),fe=1.01*(Math.cos(Math.PI/2-this._pitch)*we+D),ze=this.height/50;g=new Float64Array(16),o.b4(g,this._fov,this.width/this.height,ze,fe),g[8]=2*-s.x/this.width,g[9]=2*s.y/this.height,o.J(g,g,[1,-1,1]),o.H(g,g,[0,0,-this.cameraToCenterDistance]),o.b5(g,g,this._pitch),o.ad(g,g,this.angle),o.H(g,g,[-d,-m,0]),this.mercatorMatrix=o.J([],g,[this.worldSize,this.worldSize,this.worldSize]),o.J(g,g,[1,1,this._pixelPerMeter]),this.pixelMatrix=o.K(new Float64Array(16),this.labelPlaneMatrix,g),o.H(g,g,[0,0,-this.elevation]),this.projMatrix=g,this.invProjMatrix=o.ar([],g),this.pixelMatrix3D=o.K(new Float64Array(16),this.labelPlaneMatrix,g);const $e=this.width%2/2,Te=this.height%2/2,Be=Math.cos(this.angle),Ke=Math.sin(this.angle),Qe=d-Math.round(d)+Be*$e+Ke*Te,lt=m-Math.round(m)+Be*Te+Ke*$e,bt=new Float64Array(g);if(o.H(bt,bt,[Qe>.5?Qe-1:Qe,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=bt,g=o.ar(new Float64Array(16),this.pixelMatrix),!g)throw new Error("failed to invert matrix");this.pixelMatrixInverse=g,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const s=this.pointCoordinate(new o.P(0,0)),d=[s.x*this.worldSize,s.y*this.worldSize,0,1];return o.af(d,d,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const s=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,s))}getCameraQueryGeometry(s){const d=this.getCameraPoint();if(s.length===1)return[s[0],d];{let m=d.x,g=d.y,b=d.x,P=d.y;for(const R of s)m=Math.min(m,R.x),g=Math.min(g,R.y),b=Math.max(b,R.x),P=Math.max(P,R.y);return[new o.P(m,g),new o.P(b,g),new o.P(b,P),new o.P(m,P),new o.P(m,g)]}}lngLatToCameraDepth(s,d){const m=this.locationCoordinate(s),g=[m.x*this.worldSize,m.y*this.worldSize,d,1];return o.af(g,g,this.projMatrix),g[2]/g[3]}}function If(_,s){let d,m=!1,g=null,b=null;const P=()=>{g=null,m&&(_.apply(b,d),g=setTimeout(P,s),m=!1)};return(...R)=>(m=!0,b=this,d=R,g||P(),g)}class kf{constructor(s){this._getCurrentHash=()=>{const d=window.location.hash.replace("#","");if(this._hashName){let m;return d.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(m=g)}),(m&&m[1]||"").split("/")}return d.split("/")},this._onHashChange=()=>{const d=this._getCurrentHash();if(d.length>=3&&!d.some(m=>isNaN(m))){const m=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(d[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+d[2],+d[1]],zoom:+d[0],bearing:m,pitch:+(d[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const d=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,d)}catch{}},this._updateHash=If(this._updateHashUnthrottled,300),this._hashName=s&&encodeURIComponent(s)}addTo(s){return this._map=s,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(s){const d=this._map.getCenter(),m=Math.round(100*this._map.getZoom())/100,g=Math.ceil((m*Math.LN2+Math.log(512/360/.5))/Math.LN10),b=Math.pow(10,g),P=Math.round(d.lng*b)/b,R=Math.round(d.lat*b)/b,D=this._map.getBearing(),H=this._map.getPitch();let $="";if($+=s?`/${P}/${R}/${m}`:`${m}/${R}/${P}`,(D||H)&&($+="/"+Math.round(10*D)/10),H&&($+=`/${Math.round(H)}`),this._hashName){const Z=this._hashName;let se=!1;const _e=window.location.hash.slice(1).split("&").map(ve=>{const we=ve.split("=")[0];return we===Z?(se=!0,`${we}=${$}`):ve}).filter(ve=>ve);return se||_e.push(`${Z}=${$}`),`#${_e.join("&")}`}return`#${$}`}}const os={linearity:.3,easing:o.b6(0,0,.3,1)},Sm=o.e({deceleration:2500,maxSpeed:1400},os),Mm=o.e({deceleration:20,maxSpeed:1400},os),Tm=o.e({deceleration:1e3,maxSpeed:360},os),Em=o.e({deceleration:1e3,maxSpeed:90},os);class Am{constructor(s){this._map=s,this.clear()}clear(){this._inertiaBuffer=[]}record(s){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:M.now(),settings:s})}_drainInertiaBuffer(){const s=this._inertiaBuffer,d=M.now();for(;s.length>0&&d-s[0].time>160;)s.shift()}_onMoveEnd(s){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const d={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)d.zoom+=b.zoomDelta||0,d.bearing+=b.bearingDelta||0,d.pitch+=b.pitchDelta||0,b.panDelta&&d.pan._add(b.panDelta),b.around&&(d.around=b.around),b.pinchAround&&(d.pinchAround=b.pinchAround);const m=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(d.pan.mag()){const b=tu(d.pan.mag(),m,o.e({},Sm,s||{}));g.offset=d.pan.mult(b.amount/d.pan.mag()),g.center=this._map.transform.center,eu(g,b)}if(d.zoom){const b=tu(d.zoom,m,Mm);g.zoom=this._map.transform.zoom+b.amount,eu(g,b)}if(d.bearing){const b=tu(d.bearing,m,Tm);g.bearing=this._map.transform.bearing+o.ac(b.amount,-179,179),eu(g,b)}if(d.pitch){const b=tu(d.pitch,m,Em);g.pitch=this._map.transform.pitch+b.amount,eu(g,b)}if(g.zoom||g.bearing){const b=d.pinchAround===void 0?d.around:d.pinchAround;g.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),o.e(g,{noMoveStart:!0})}}function eu(_,s){(!_.duration||_.duration<s.duration)&&(_.duration=s.duration,_.easing=s.easing)}function tu(_,s,d){const{maxSpeed:m,linearity:g,deceleration:b}=d,P=o.ac(_*g/(s/1e3),-m,m),R=Math.abs(P)/(b*g);return{easing:d.easing,duration:1e3*R,amount:P*(R/2)}}class pr extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m,g={}){const b=S.mousePos(d.getCanvas(),m),P=d.unproject(b);super(s,o.e({point:b,lngLat:P,originalEvent:m},g)),this._defaultPrevented=!1,this.target=d}}class Ul extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m){const g=s==="touchend"?m.changedTouches:m.touches,b=S.touchPos(d.getCanvasContainer(),g),P=b.map(D=>d.unproject(D)),R=b.reduce((D,H,$,Z)=>D.add(H.div(Z.length)),new o.P(0,0));super(s,{points:b,point:R,lngLats:P,lngLat:d.unproject(R),originalEvent:m}),this._defaultPrevented=!1}}class Ea extends o.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(s,d,m){super(s,{originalEvent:m}),this._defaultPrevented=!1}}class ls{constructor(s,d){this._map=s,this._clickTolerance=d.clickTolerance}reset(){delete this._mousedownPos}wheel(s){return this._firePreventable(new Ea(s.type,this._map,s))}mousedown(s,d){return this._mousedownPos=d,this._firePreventable(new pr(s.type,this._map,s))}mouseup(s){this._map.fire(new pr(s.type,this._map,s))}click(s,d){this._mousedownPos&&this._mousedownPos.dist(d)>=this._clickTolerance||this._map.fire(new pr(s.type,this._map,s))}dblclick(s){return this._firePreventable(new pr(s.type,this._map,s))}mouseover(s){this._map.fire(new pr(s.type,this._map,s))}mouseout(s){this._map.fire(new pr(s.type,this._map,s))}touchstart(s){return this._firePreventable(new Ul(s.type,this._map,s))}touchmove(s){this._map.fire(new Ul(s.type,this._map,s))}touchend(s){this._map.fire(new Ul(s.type,this._map,s))}touchcancel(s){this._map.fire(new Ul(s.type,this._map,s))}_firePreventable(s){if(this._map.fire(s),s.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cm{constructor(s){this._map=s}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(s){this._map.fire(new pr(s.type,this._map,s))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new pr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(s){this._delayContextMenu?this._contextMenuEvent=s:this._ignoreContextMenu||this._map.fire(new pr(s.type,this._map,s)),this._map.listens("contextmenu")&&s.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jr{constructor(s){this._map=s}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(s){return this.transform.pointLocation(o.P.convert(s),this._map.terrain)}}class Vl{constructor(s,d){this._map=s,this._tr=new jr(s),this._el=s.getCanvasContainer(),this._container=s.getContainer(),this._clickTolerance=d.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(s,d){this.isEnabled()&&s.shiftKey&&s.button===0&&(S.disableDrag(),this._startPos=this._lastPos=d,this._active=!0)}mousemoveWindow(s,d){if(!this._active)return;const m=d;if(this._lastPos.equals(m)||!this._box&&m.dist(this._startPos)<this._clickTolerance)return;const g=this._startPos;this._lastPos=m,this._box||(this._box=S.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",s));const b=Math.min(g.x,m.x),P=Math.max(g.x,m.x),R=Math.min(g.y,m.y),D=Math.max(g.y,m.y);S.setTransform(this._box,`translate(${b}px,${R}px)`),this._box.style.width=P-b+"px",this._box.style.height=D-R+"px"}mouseupWindow(s,d){if(!this._active||s.button!==0)return;const m=this._startPos,g=d;if(this.reset(),S.suppressClick(),m.x!==g.x||m.y!==g.y)return this._map.fire(new o.k("boxzoomend",{originalEvent:s})),{cameraAnimation:b=>b.fitScreenCoordinates(m,g,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",s)}keydown(s){this._active&&s.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",s))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(S.remove(this._box),this._box=null),S.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(s,d){return this._map.fire(new o.k(s,{originalEvent:d}))}}function Df(_,s){if(_.length!==s.length)throw new Error(`The number of touches and points are not equal - touches ${_.length}, points ${s.length}`);const d={};for(let m=0;m<_.length;m++)d[_[m].identifier]=s[m];return d}class wv{constructor(s){this.reset(),this.numTouches=s.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(s,d,m){(this.centroid||m.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=s.timeStamp),m.length===this.numTouches&&(this.centroid=function(g){const b=new o.P(0,0);for(const P of g)b._add(P);return b.div(g.length)}(d),this.touches=Df(m,d)))}touchmove(s,d,m){if(this.aborted||!this.centroid)return;const g=Df(m,d);for(const b in this.touches){const P=g[b];(!P||P.dist(this.touches[b])>30)&&(this.aborted=!0)}}touchend(s,d,m){if((!this.centroid||s.timeStamp-this.startTime>500)&&(this.aborted=!0),m.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class Lf{constructor(s){this.singleTap=new wv(s),this.numTaps=s.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(s,d,m){this.singleTap.touchstart(s,d,m)}touchmove(s,d,m){this.singleTap.touchmove(s,d,m)}touchend(s,d,m){const g=this.singleTap.touchend(s,d,m);if(g){const b=s.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(g)<30;if(b&&P||this.reset(),this.count++,this.lastTime=s.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Pm{constructor(s){this._tr=new jr(s),this._zoomIn=new Lf({numTouches:1,numTaps:2}),this._zoomOut=new Lf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(s,d,m){this._zoomIn.touchstart(s,d,m),this._zoomOut.touchstart(s,d,m)}touchmove(s,d,m){this._zoomIn.touchmove(s,d,m),this._zoomOut.touchmove(s,d,m)}touchend(s,d,m){const g=this._zoomIn.touchend(s,d,m),b=this._zoomOut.touchend(s,d,m),P=this._tr;return g?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom+1,around:P.unproject(g)},{originalEvent:s})}):b?(this._active=!0,s.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:R=>R.easeTo({duration:300,zoom:P.zoom-1,around:P.unproject(b)},{originalEvent:s})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ps{constructor(s){this._enabled=!!s.enable,this._moveStateManager=s.moveStateManager,this._clickTolerance=s.clickTolerance||1,this._moveFunction=s.move,this._activateOnStart=!!s.activateOnStart,s.assignEvents(this),this.reset()}reset(s){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(s)}_move(...s){const d=this._moveFunction(...s);if(d.bearingDelta||d.pitchDelta||d.around||d.panDelta)return this._active=!0,d}dragStart(s,d){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(s)&&(this._moveStateManager.startMove(s),this._lastPoint=d.length?d[0]:d,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(s,d){if(!this.isEnabled())return;const m=this._lastPoint;if(!m)return;if(s.preventDefault(),!this._moveStateManager.isValidMoveEvent(s))return void this.reset(s);const g=d.length?d[0]:d;return!this._moved&&g.dist(m)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=g,this._move(m,g))}dragEnd(s){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(s)&&(this._moved&&S.suppressClick(),this.reset(s))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const io={0:1,2:2};class en{constructor(s){this._correctEvent=s.checkCorrectEvent}startMove(s){const d=S.mouseButton(s);this._eventButton=d}endMove(s){delete this._eventButton}isValidStartEvent(s){return this._correctEvent(s)}isValidMoveEvent(s){return!function(d,m){const g=io[m];return d.buttons===void 0||(d.buttons&g)!==g}(s,this._eventButton)}isValidEndEvent(s){return S.mouseButton(s)===this._eventButton}}class zf{constructor(){this._firstTouch=void 0}_isOneFingerTouch(s){return s.targetTouches.length===1}_isSameTouchEvent(s){return s.targetTouches[0].identifier===this._firstTouch}startMove(s){this._firstTouch=s.targetTouches[0].identifier}endMove(s){delete this._firstTouch}isValidStartEvent(s){return this._isOneFingerTouch(s)}isValidMoveEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}isValidEndEvent(s){return this._isOneFingerTouch(s)&&this._isSameTouchEvent(s)}}const Fo=_=>{_.mousedown=_.dragStart,_.mousemoveWindow=_.dragMove,_.mouseup=_.dragEnd,_.contextmenu=function(s){s.preventDefault()}},Hl=({enable:_,clickTolerance:s,bearingDegreesPerPixelMoved:d=.8})=>{const m=new en({checkCorrectEvent:g=>S.mouseButton(g)===0&&g.ctrlKey||S.mouseButton(g)===2});return new Ps({clickTolerance:s,move:(g,b)=>({bearingDelta:(b.x-g.x)*d}),moveStateManager:m,enable:_,assignEvents:Fo})},Ff=({enable:_,clickTolerance:s,pitchDegreesPerPixelMoved:d=-.5})=>{const m=new en({checkCorrectEvent:g=>S.mouseButton(g)===0&&g.ctrlKey||S.mouseButton(g)===2});return new Ps({clickTolerance:s,move:(g,b)=>({pitchDelta:(b.y-g.y)*d}),moveStateManager:m,enable:_,assignEvents:Fo})};class qt{constructor(s,d){this._clickTolerance=s.clickTolerance||1,this._map=d,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}minTouchs(){return this._map.cooperativeGestures.isEnabled()?2:1}touchstart(s,d,m){return this._calculateTransform(s,d,m)}touchmove(s,d,m){if(this._active&&!(m.length<this.minTouchs()))return s.preventDefault(),this._calculateTransform(s,d,m)}touchend(s,d,m){this._calculateTransform(s,d,m),this._active&&m.length<this.minTouchs()&&this.reset()}touchcancel(){this.reset()}_calculateTransform(s,d,m){m.length>0&&(this._active=!0);const g=Df(m,d),b=new o.P(0,0),P=new o.P(0,0);let R=0;for(const H in g){const $=g[H],Z=this._touches[H];Z&&(b._add($),P._add($.sub(Z)),R++,g[H]=$)}if(this._touches=g,R<this.minTouchs()||!P.mag())return;const D=P.div(R);return this._sum._add(D),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(R),panDelta:D}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nu{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(s,d,m){this._firstTwoTouches||m.length<2||(this._firstTwoTouches=[m[0].identifier,m[1].identifier],this._start([d[0],d[1]]))}touchmove(s,d,m){if(!this._firstTwoTouches)return;s.preventDefault();const[g,b]=this._firstTwoTouches,P=yh(m,d,g),R=yh(m,d,b);if(!P||!R)return;const D=this._aroundCenter?null:P.add(R).div(2);return this._move([P,R],D,s)}touchend(s,d,m){if(!this._firstTwoTouches)return;const[g,b]=this._firstTwoTouches,P=yh(m,d,g),R=yh(m,d,b);P&&R||(this._active&&S.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(s){this._enabled=!0,this._aroundCenter=!!s&&s.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function yh(_,s,d){for(let m=0;m<_.length;m++)if(_[m].identifier===d)return s[m]}function Rm(_,s){return Math.log(_/s)/Math.LN2}class vh extends nu{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(s){this._startDistance=this._distance=s[0].dist(s[1])}_move(s,d){const m=this._distance;if(this._distance=s[0].dist(s[1]),this._active||!(Math.abs(Rm(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Rm(this._distance,m),pinchAround:d}}}function Nf(_,s){return 180*_.angleWith(s)/Math.PI}class Bf extends nu{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(s){this._startVector=this._vector=s[0].sub(s[1]),this._minDiameter=s[0].dist(s[1])}_move(s,d,m){const g=this._vector;if(this._vector=s[0].sub(s[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Nf(this._vector,g),pinchAround:d}}_isBelowThreshold(s){this._minDiameter=Math.min(this._minDiameter,s.mag());const d=25/(Math.PI*this._minDiameter)*360,m=Nf(s,this._startVector);return Math.abs(m)<d}}function Of(_){return Math.abs(_.y)>Math.abs(_.x)}class Im extends nu{constructor(s){super(),this._currentTouchCount=0,this._map=s}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(s,d,m){super.touchstart(s,d,m),this._currentTouchCount=m.length}_start(s){this._lastPoints=s,Of(s[0].sub(s[1]))&&(this._valid=!1)}_move(s,d,m){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const g=s[0].sub(this._lastPoints[0]),b=s[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(g,b,m.timeStamp),this._valid?(this._lastPoints=s,this._active=!0,{pitchDelta:(g.y+b.y)/2*-.5}):void 0}gestureBeginsVertically(s,d,m){if(this._valid!==void 0)return this._valid;const g=s.mag()>=2,b=d.mag()>=2;if(!g&&!b)return;if(!g||!b)return this._firstMove===void 0&&(this._firstMove=m),m-this._firstMove<100&&void 0;const P=s.y>0==d.y>0;return Of(s)&&Of(d)&&P}}const No={panStep:100,bearingStep:15,pitchStep:10};class bi{constructor(s){this._tr=new jr(s);const d=No;this._panStep=d.panStep,this._bearingStep=d.bearingStep,this._pitchStep=d.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(s){if(s.altKey||s.ctrlKey||s.metaKey)return;let d=0,m=0,g=0,b=0,P=0;switch(s.keyCode){case 61:case 107:case 171:case 187:d=1;break;case 189:case 109:case 173:d=-1;break;case 37:s.shiftKey?m=-1:(s.preventDefault(),b=-1);break;case 39:s.shiftKey?m=1:(s.preventDefault(),b=1);break;case 38:s.shiftKey?g=1:(s.preventDefault(),P=-1);break;case 40:s.shiftKey?g=-1:(s.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(m=0,g=0),{cameraAnimation:R=>{const D=this._tr;R.easeTo({duration:300,easeId:"keyboardHandler",easing:_h,zoom:d?Math.round(D.zoom)+d*(s.shiftKey?2:1):D.zoom,bearing:D.bearing+m*this._bearingStep,pitch:D.pitch+g*this._pitchStep,offset:[-b*this._panStep,-P*this._panStep],center:D.center},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function _h(_){return _*(2-_)}const xh=4.000244140625;class Uf{constructor(s,d){this._onTimeout=m=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(m)},this._map=s,this._tr=new jr(s),this._triggerRenderFrame=d,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(s){this._defaultZoomRate=s}setWheelZoomRate(s){this._wheelZoomRate=s}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(s){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!s&&s.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(s){if(!this.isEnabled()||this._map.cooperativeGestures.isEnabled()&&!s[this._map.cooperativeGestures._bypassKey])return;let d=s.deltaMode===WheelEvent.DOM_DELTA_LINE?40*s.deltaY:s.deltaY;const m=M.now(),g=m-(this._lastWheelEventTime||0);this._lastWheelEventTime=m,d!==0&&d%xh==0?this._type="wheel":d!==0&&Math.abs(d)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=d,this._timeout=setTimeout(this._onTimeout,40,s)):this._type||(this._type=Math.abs(g*d)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,d+=this._lastValue)),s.shiftKey&&d&&(d/=4),this._type&&(this._lastWheelEvent=s,this._delta-=d,this._active||this._start(s)),s.preventDefault()}_start(s){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const d=S.mousePos(this._map.getCanvas(),s),m=this._tr;this._around=d.y>m.transform.height/2-m.transform.getHorizon()?o.M.convert(this._aroundCenter?m.center:m.unproject(d)):o.M.convert(m.center),this._aroundPoint=m.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const s=this._tr.transform;if(this._delta!==0){const R=this._type==="wheel"&&Math.abs(this._delta)>xh?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*R)));this._delta<0&&D!==0&&(D=1/D);const H=typeof this._targetZoom=="number"?s.zoomScale(this._targetZoom):s.scale;this._targetZoom=Math.min(s.maxZoom,Math.max(s.minZoom,s.scaleZoom(H*D))),this._type==="wheel"&&(this._startZoom=s.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:s.zoom,m=this._startZoom,g=this._easing;let b,P=!1;if(this._type==="wheel"&&m&&g){const R=Math.min((M.now()-this._lastWheelEventTime)/200,1),D=g(R);b=o.z.number(m,d,D),R<1?this._frameId||(this._frameId=!0):P=!0}else b=d,P=!0;return this._active=!0,P&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!P,zoomDelta:b-s.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(s){let d=o.b7;if(this._prevEase){const m=this._prevEase,g=(M.now()-m.start)/m.duration,b=m.easing(g+.01)-m.easing(g),P=.27/Math.sqrt(b*b+1e-4)*.01,R=Math.sqrt(.0729-P*P);d=o.b6(P,R,.25,1)}return this._prevEase={start:M.now(),duration:s,easing:d},d}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class Vf{constructor(s,d){this._clickZoom=s,this._tapZoom=d}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class km{constructor(s){this._tr=new jr(s),this.reset()}reset(){this._active=!1}dblclick(s,d){return s.preventDefault(),{cameraAnimation:m=>{m.easeTo({duration:300,zoom:this._tr.zoom+(s.shiftKey?-1:1),around:this._tr.unproject(d)},{originalEvent:s})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Sv{constructor(){this._tap=new Lf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(s,d,m){if(!this._swipePoint)if(this._tapTime){const g=d[0],b=s.timeStamp-this._tapTime<500,P=this._tapPoint.dist(g)<30;b&&P?m.length>0&&(this._swipePoint=g,this._swipeTouch=m[0].identifier):this.reset()}else this._tap.touchstart(s,d,m)}touchmove(s,d,m){if(this._tapTime){if(this._swipePoint){if(m[0].identifier!==this._swipeTouch)return;const g=d[0],b=g.y-this._swipePoint.y;return this._swipePoint=g,s.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(s,d,m)}touchend(s,d,m){if(this._tapTime)this._swipePoint&&m.length===0&&this.reset();else{const g=this._tap.touchend(s,d,m);g&&(this._tapTime=s.timeStamp,this._tapPoint=g)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ba{constructor(s,d,m){this._el=s,this._mousePan=d,this._touchPan=m}enable(s){this._inertiaOptions=s||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class iu{constructor(s,d,m){this._pitchWithRotate=s.pitchWithRotate,this._mouseRotate=d,this._mousePitch=m}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class pn{constructor(s,d,m,g){this._el=s,this._touchZoom=d,this._touchRotate=m,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(s){this._touchZoom.enable(s),this._rotationDisabled||this._touchRotate.enable(s),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Mn{constructor(s,d){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=s,this._options=d,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const s=this._map.getCanvasContainer();s.classList.add("maplibregl-cooperative-gestures"),this._container=S.create("div","maplibregl-cooperative-gesture-screen",s);let d=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(d=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const m=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),g=document.createElement("div");g.className="maplibregl-desktop-message",g.textContent=d,this._container.appendChild(g);const b=document.createElement("div");b.className="maplibregl-mobile-message",b.textContent=m,this._container.appendChild(b),this._container.setAttribute("aria-hidden","true")}_destoryUI(){this._container&&(S.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destoryUI()}isEnabled(){return this._enabled}touchmove(s){this._onCooperativeGesture(s.touches.length===1)}wheel(s){this._map.scrollZoom.isEnabled()&&this._onCooperativeGesture(!s[this._bypassKey])}_onCooperativeGesture(s){this._enabled&&s&&(this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Bo=_=>_.zoom||_.drag||_.pitch||_.rotate;class Hf extends o.k{}function ru(_){return _.panDelta&&_.panDelta.mag()||_.zoomDelta||_.bearingDelta||_.pitchDelta}class Wr{constructor(s,d){this.handleWindowEvent=g=>{this.handleEvent(g,`${g.type}Window`)},this.handleEvent=(g,b)=>{if(g.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const P=g.type==="renderFrame"?void 0:g,R={needsRenderFrame:!1},D={},H={},$=g.touches,Z=$?this._getMapTouches($):void 0,se=Z?S.touchPos(this._map.getCanvas(),Z):S.mousePos(this._map.getCanvas(),g);for(const{handlerName:we,handler:fe,allowed:ze}of this._handlers){if(!fe.isEnabled())continue;let $e;this._blockedByActive(H,ze,we)?fe.reset():fe[b||g.type]&&($e=fe[b||g.type](g,se,Z),this.mergeHandlerResult(R,D,$e,we,P),$e&&$e.needsRenderFrame&&this._triggerRenderFrame()),($e||fe.isActive())&&(H[we]=fe)}const _e={};for(const we in this._previousActiveHandlers)H[we]||(_e[we]=P);this._previousActiveHandlers=H,(Object.keys(_e).length||ru(R))&&(this._changes.push([R,D,_e]),this._triggerRenderFrame()),(Object.keys(H).length||ru(R))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:ve}=R;ve&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],ve(this._map))},this._map=s,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Am(s),this._bearingSnap=d.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(d);const m=this._el;this._listeners=[[m,"touchstart",{passive:!0}],[m,"touchmove",{passive:!1}],[m,"touchend",void 0],[m,"touchcancel",void 0],[m,"mousedown",void 0],[m,"mousemove",void 0],[m,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[m,"mouseover",void 0],[m,"mouseout",void 0],[m,"dblclick",void 0],[m,"click",void 0],[m,"keydown",{capture:!1}],[m,"keyup",void 0],[m,"wheel",{passive:!1}],[m,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,b,P]of this._listeners)S.addEventListener(g,b,g===document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[s,d,m]of this._listeners)S.removeEventListener(s,d,s===document?this.handleWindowEvent:this.handleEvent,m)}_addDefaultHandlers(s){const d=this._map,m=d.getCanvasContainer();this._add("mapEvent",new ls(d,s));const g=d.boxZoom=new Vl(d,s);this._add("boxZoom",g),s.interactive&&s.boxZoom&&g.enable();const b=d.cooperativeGestures=new Mn(d,s.cooperativeGestures);this._add("cooperativeGestures",b),s.cooperativeGestures&&b.enable();const P=new Pm(d),R=new km(d);d.doubleClickZoom=new Vf(R,P),this._add("tapZoom",P),this._add("clickZoom",R),s.interactive&&s.doubleClickZoom&&d.doubleClickZoom.enable();const D=new Sv;this._add("tapDragZoom",D);const H=d.touchPitch=new Im(d);this._add("touchPitch",H),s.interactive&&s.touchPitch&&d.touchPitch.enable(s.touchPitch);const $=Hl(s),Z=Ff(s);d.dragRotate=new iu(s,$,Z),this._add("mouseRotate",$,["mousePitch"]),this._add("mousePitch",Z,["mouseRotate"]),s.interactive&&s.dragRotate&&d.dragRotate.enable();const se=(({enable:$e,clickTolerance:Te})=>{const Be=new en({checkCorrectEvent:Ke=>S.mouseButton(Ke)===0&&!Ke.ctrlKey});return new Ps({clickTolerance:Te,move:(Ke,Qe)=>({around:Qe,panDelta:Qe.sub(Ke)}),activateOnStart:!0,moveStateManager:Be,enable:$e,assignEvents:Fo})})(s),_e=new qt(s,d);d.dragPan=new Ba(m,se,_e),this._add("mousePan",se),this._add("touchPan",_e,["touchZoom","touchRotate"]),s.interactive&&s.dragPan&&d.dragPan.enable(s.dragPan);const ve=new Bf,we=new vh;d.touchZoomRotate=new pn(m,we,ve,D),this._add("touchRotate",ve,["touchPan","touchZoom"]),this._add("touchZoom",we,["touchPan","touchRotate"]),s.interactive&&s.touchZoomRotate&&d.touchZoomRotate.enable(s.touchZoomRotate);const fe=d.scrollZoom=new Uf(d,()=>this._triggerRenderFrame());this._add("scrollZoom",fe,["mousePan"]),s.interactive&&s.scrollZoom&&d.scrollZoom.enable(s.scrollZoom);const ze=d.keyboard=new bi(d);this._add("keyboard",ze),s.interactive&&s.keyboard&&d.keyboard.enable(),this._add("blockableMapEvent",new Cm(d))}_add(s,d,m){this._handlers.push({handlerName:s,handler:d,allowed:m}),this._handlersById[s]=d}stop(s){if(!this._updatingCamera){for(const{handler:d}of this._handlers)d.reset();this._inertia.clear(),this._fireEvents({},{},s),this._changes=[]}}isActive(){for(const{handler:s}of this._handlers)if(s.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Bo(this._eventsInProgress)||this.isZooming()}_blockedByActive(s,d,m){for(const g in s)if(g!==m&&(!d||d.indexOf(g)<0))return!0;return!1}_getMapTouches(s){const d=[];for(const m of s)this._el.contains(m.target)&&d.push(m);return d}mergeHandlerResult(s,d,m,g,b){if(!m)return;o.e(s,m);const P={handlerName:g,originalEvent:m.originalEvent||b};m.zoomDelta!==void 0&&(d.zoom=P),m.panDelta!==void 0&&(d.drag=P),m.pitchDelta!==void 0&&(d.pitch=P),m.bearingDelta!==void 0&&(d.rotate=P)}_applyChanges(){const s={},d={},m={};for(const[g,b,P]of this._changes)g.panDelta&&(s.panDelta=(s.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(s.zoomDelta=(s.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(s.bearingDelta=(s.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(s.pitchDelta=(s.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(s.around=g.around),g.pinchAround!==void 0&&(s.pinchAround=g.pinchAround),g.noInertia&&(s.noInertia=g.noInertia),o.e(d,b),o.e(m,P);this._updateMapTransform(s,d,m),this._changes=[]}_updateMapTransform(s,d,m){const g=this._map,b=g._getTransformForUpdate(),P=g.terrain;if(!(ru(s)||P&&this._terrainMovement))return this._fireEvents(d,m,!0);let{panDelta:R,zoomDelta:D,bearingDelta:H,pitchDelta:$,around:Z,pinchAround:se}=s;se!==void 0&&(Z=se),g._stop(!0),Z=Z||g.transform.centerPoint;const _e=b.pointLocation(R?Z.sub(R):Z);H&&(b.bearing+=H),$&&(b.pitch+=$),D&&(b.zoom+=D),P?this._terrainMovement||!d.drag&&!d.zoom?d.drag&&this._terrainMovement?b.center=b.pointLocation(b.centerPoint.sub(R)):b.setLocationAtPoint(_e,Z):(this._terrainMovement=!0,this._map._elevationFreeze=!0,b.setLocationAtPoint(_e,Z),this._map.once("moveend",()=>{this._map._elevationFreeze=!1,this._terrainMovement=!1,b.recalculateZoom(g.terrain)})):b.setLocationAtPoint(_e,Z),g._applyUpdatedTransform(b),this._map._update(),s.noInertia||this._inertia.record(s),this._fireEvents(d,m,!0)}_fireEvents(s,d,m){const g=Bo(this._eventsInProgress),b=Bo(s),P={};for(const $ in s){const{originalEvent:Z}=s[$];this._eventsInProgress[$]||(P[`${$}start`]=Z),this._eventsInProgress[$]=s[$]}!g&&b&&this._fireEvent("movestart",b.originalEvent);for(const $ in P)this._fireEvent($,P[$]);b&&this._fireEvent("move",b.originalEvent);for(const $ in s){const{originalEvent:Z}=s[$];this._fireEvent($,Z)}const R={};let D;for(const $ in this._eventsInProgress){const{handlerName:Z,originalEvent:se}=this._eventsInProgress[$];this._handlersById[Z].isActive()||(delete this._eventsInProgress[$],D=d[Z]||se,R[`${$}end`]=D)}for(const $ in R)this._fireEvent($,R[$]);const H=Bo(this._eventsInProgress);if(m&&(g||b)&&!H){this._updatingCamera=!0;const $=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Z=se=>se!==0&&-this._bearingSnap<se&&se<this._bearingSnap;!$||!$.essential&&M.prefersReducedMotion?(this._map.fire(new o.k("moveend",{originalEvent:D})),Z(this._map.getBearing())&&this._map.resetNorth()):(Z($.bearing||this._map.getBearing())&&($.bearing=0),$.freezeElevation=!0,this._map.easeTo($,{originalEvent:D})),this._updatingCamera=!1}}_fireEvent(s,d){this._map.fire(new o.k(s,d?{originalEvent:d}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(s=>{delete this._frameId,this.handleEvent(new Hf("renderFrame",{timeStamp:s})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Dm extends o.E{constructor(s,d){super(),this._renderFrameCallback=()=>{const m=Math.min((M.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(m)),m<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=s,this._bearingSnap=d.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new o.M(this.transform.center.lng,this.transform.center.lat)}setCenter(s,d){return this.jumpTo({center:s},d)}panBy(s,d,m){return s=o.P.convert(s).mult(-1),this.panTo(this.transform.center,o.e({offset:s},d),m)}panTo(s,d,m){return this.easeTo(o.e({center:s},d),m)}getZoom(){return this.transform.zoom}setZoom(s,d){return this.jumpTo({zoom:s},d),this}zoomTo(s,d,m){return this.easeTo(o.e({zoom:s},d),m)}zoomIn(s,d){return this.zoomTo(this.getZoom()+1,s,d),this}zoomOut(s,d){return this.zoomTo(this.getZoom()-1,s,d),this}getBearing(){return this.transform.bearing}setBearing(s,d){return this.jumpTo({bearing:s},d),this}getPadding(){return this.transform.padding}setPadding(s,d){return this.jumpTo({padding:s},d),this}rotateTo(s,d,m){return this.easeTo(o.e({bearing:s},d),m)}resetNorth(s,d){return this.rotateTo(0,o.e({duration:1e3},s),d),this}resetNorthPitch(s,d){return this.easeTo(o.e({bearing:0,pitch:0,duration:1e3},s),d),this}snapToNorth(s,d){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(s,d):this}getPitch(){return this.transform.pitch}setPitch(s,d){return this.jumpTo({pitch:s},d),this}cameraForBounds(s,d){s=Yt.convert(s);const m=d&&d.bearing||0;return this._cameraForBoxAndBearing(s.getNorthWest(),s.getSouthEast(),m,d)}_cameraForBoxAndBearing(s,d,m,g){const b={top:0,bottom:0,right:0,left:0};if(typeof(g=o.e({padding:b,offset:[0,0],maxZoom:this.transform.maxZoom},g)).padding=="number"){const Zt=g.padding;g.padding={top:Zt,bottom:Zt,right:Zt,left:Zt}}g.padding=o.e(b,g.padding);const P=this.transform,R=P.padding,D=new Yt(s,d),H=P.project(D.getNorthWest()),$=P.project(D.getNorthEast()),Z=P.project(D.getSouthEast()),se=P.project(D.getSouthWest()),_e=o.b8(-m),ve=H.rotate(_e),we=$.rotate(_e),fe=Z.rotate(_e),ze=se.rotate(_e),$e=new o.P(Math.max(ve.x,we.x,ze.x,fe.x),Math.max(ve.y,we.y,ze.y,fe.y)),Te=new o.P(Math.min(ve.x,we.x,ze.x,fe.x),Math.min(ve.y,we.y,ze.y,fe.y)),Be=$e.sub(Te),Ke=(P.width-(R.left+R.right+g.padding.left+g.padding.right))/Be.x,Qe=(P.height-(R.top+R.bottom+g.padding.top+g.padding.bottom))/Be.y;if(Qe<0||Ke<0)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const lt=Math.min(P.scaleZoom(P.scale*Math.min(Ke,Qe)),g.maxZoom),bt=o.P.convert(g.offset),vt=new o.P((g.padding.left-g.padding.right)/2,(g.padding.top-g.padding.bottom)/2).rotate(o.b8(m)),xt=bt.add(vt).mult(P.scale/P.zoomScale(lt));return{center:P.unproject(H.add(Z).div(2).sub(xt)),zoom:lt,bearing:m}}fitBounds(s,d,m){return this._fitInternal(this.cameraForBounds(s,d),d,m)}fitScreenCoordinates(s,d,m,g,b){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(o.P.convert(s)),this.transform.pointLocation(o.P.convert(d)),m,g),g,b)}_fitInternal(s,d,m){return s?(delete(d=o.e(s,d)).padding,d.linear?this.easeTo(d,m):this.flyTo(d,m)):this}jumpTo(s,d){this.stop();const m=this._getTransformForUpdate();let g=!1,b=!1,P=!1;return"zoom"in s&&m.zoom!==+s.zoom&&(g=!0,m.zoom=+s.zoom),s.center!==void 0&&(m.center=o.M.convert(s.center)),"bearing"in s&&m.bearing!==+s.bearing&&(b=!0,m.bearing=+s.bearing),"pitch"in s&&m.pitch!==+s.pitch&&(P=!0,m.pitch=+s.pitch),s.padding==null||m.isPaddingEqual(s.padding)||(m.padding=s.padding),this._applyUpdatedTransform(m),this.fire(new o.k("movestart",d)).fire(new o.k("move",d)),g&&this.fire(new o.k("zoomstart",d)).fire(new o.k("zoom",d)).fire(new o.k("zoomend",d)),b&&this.fire(new o.k("rotatestart",d)).fire(new o.k("rotate",d)).fire(new o.k("rotateend",d)),P&&this.fire(new o.k("pitchstart",d)).fire(new o.k("pitch",d)).fire(new o.k("pitchend",d)),this.fire(new o.k("moveend",d))}calculateCameraOptionsFromTo(s,d,m,g=0){const b=o.Y.fromLngLat(s,d),P=o.Y.fromLngLat(m,g),R=P.x-b.x,D=P.y-b.y,H=P.z-b.z,$=Math.hypot(R,D,H);if($===0)throw new Error("Can't calculate camera options with same From and To");const Z=Math.hypot(R,D),se=this.transform.scaleZoom(this.transform.cameraToCenterDistance/$/this.transform.tileSize),_e=180*Math.atan2(R,-D)/Math.PI;let ve=180*Math.acos(Z/$)/Math.PI;return ve=H<0?90-ve:90+ve,{center:P.toLngLat(),zoom:se,pitch:ve,bearing:_e}}easeTo(s,d){var m;this._stop(!1,s.easeId),((s=o.e({offset:[0,0],duration:500,easing:o.b7},s)).animate===!1||!s.essential&&M.prefersReducedMotion)&&(s.duration=0);const g=this._getTransformForUpdate(),b=this.getZoom(),P=this.getBearing(),R=this.getPitch(),D=this.getPadding(),H="bearing"in s?this._normalizeBearing(s.bearing,P):P,$="pitch"in s?+s.pitch:R,Z="padding"in s?s.padding:g.padding,se=o.P.convert(s.offset);let _e=g.centerPoint.add(se);const ve=g.pointLocation(_e),{center:we,zoom:fe}=g.getConstrained(o.M.convert(s.center||ve),(m=s.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(we);const ze=g.project(ve),$e=g.project(we).sub(ze),Te=g.zoomScale(fe-b);let Be,Ke;s.around&&(Be=o.M.convert(s.around),Ke=g.locationPoint(Be));const Qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||fe!==b,this._rotating=this._rotating||P!==H,this._pitching=this._pitching||$!==R,this._padding=!g.isPaddingEqual(Z),this._easeId=s.easeId,this._prepareEase(d,s.noMoveStart,Qe),this.terrain&&this._prepareElevation(we),this._ease(lt=>{if(this._zooming&&(g.zoom=o.z.number(b,fe,lt)),this._rotating&&(g.bearing=o.z.number(P,H,lt)),this._pitching&&(g.pitch=o.z.number(R,$,lt)),this._padding&&(g.interpolatePadding(D,Z,lt),_e=g.centerPoint.add(se)),this.terrain&&!s.freezeElevation&&this._updateElevation(lt),Be)g.setLocationAtPoint(Be,Ke);else{const bt=g.zoomScale(g.zoom-b),vt=fe>b?Math.min(2,Te):Math.max(.5,Te),xt=Math.pow(vt,1-lt),Zt=g.unproject(ze.add($e.mult(lt*xt)).mult(bt));g.setLocationAtPoint(g.renderWorldCopies?Zt.wrap():Zt,_e)}this._applyUpdatedTransform(g),this._fireMoveEvents(d)},lt=>{this.terrain&&this._finalizeElevation(),this._afterEase(d,lt)},s),this}_prepareEase(s,d,m={}){this._moving=!0,d||m.moving||this.fire(new o.k("movestart",s)),this._zooming&&!m.zooming&&this.fire(new o.k("zoomstart",s)),this._rotating&&!m.rotating&&this.fire(new o.k("rotatestart",s)),this._pitching&&!m.pitching&&this.fire(new o.k("pitchstart",s))}_prepareElevation(s){this._elevationCenter=s,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(s){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const d=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(s<1&&d!==this._elevationTarget){const m=this._elevationTarget-this._elevationStart;this._elevationStart+=s*(m-(d-(m*s+this._elevationStart))/(1-s)),this._elevationTarget=d}this.transform.elevation=o.z.number(this._elevationStart,this._elevationTarget,s)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(s){if(!this.transformCameraUpdate)return;const d=s.clone(),{center:m,zoom:g,pitch:b,bearing:P,elevation:R}=this.transformCameraUpdate(d);m&&(d.center=m),g!==void 0&&(d.zoom=g),b!==void 0&&(d.pitch=b),P!==void 0&&(d.bearing=P),R!==void 0&&(d.elevation=R),this.transform.apply(d)}_fireMoveEvents(s){this.fire(new o.k("move",s)),this._zooming&&this.fire(new o.k("zoom",s)),this._rotating&&this.fire(new o.k("rotate",s)),this._pitching&&this.fire(new o.k("pitch",s))}_afterEase(s,d){if(this._easeId&&d&&this._easeId===d)return;delete this._easeId;const m=this._zooming,g=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,m&&this.fire(new o.k("zoomend",s)),g&&this.fire(new o.k("rotateend",s)),b&&this.fire(new o.k("pitchend",s)),this.fire(new o.k("moveend",s))}flyTo(s,d){var m;if(!s.essential&&M.prefersReducedMotion){const Xn=o.L(s,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Xn,d)}this.stop(),s=o.e({offset:[0,0],speed:1.2,curve:1.42,easing:o.b7},s);const g=this._getTransformForUpdate(),b=this.getZoom(),P=this.getBearing(),R=this.getPitch(),D=this.getPadding(),H="bearing"in s?this._normalizeBearing(s.bearing,P):P,$="pitch"in s?+s.pitch:R,Z="padding"in s?s.padding:g.padding,se=o.P.convert(s.offset);let _e=g.centerPoint.add(se);const ve=g.pointLocation(_e),{center:we,zoom:fe}=g.getConstrained(o.M.convert(s.center||ve),(m=s.zoom)!==null&&m!==void 0?m:b);this._normalizeCenter(we);const ze=g.zoomScale(fe-b),$e=g.project(ve),Te=g.project(we).sub($e);let Be=s.curve;const Ke=Math.max(g.width,g.height),Qe=Ke/ze,lt=Te.mag();if("minZoom"in s){const Xn=o.ac(Math.min(s.minZoom,b,fe),g.minZoom,g.maxZoom),Rn=Ke/g.zoomScale(Xn-b);Be=Math.sqrt(Rn/lt*2)}const bt=Be*Be;function vt(Xn){const Rn=(Qe*Qe-Ke*Ke+(Xn?-1:1)*bt*bt*lt*lt)/(2*(Xn?Qe:Ke)*bt*lt);return Math.log(Math.sqrt(Rn*Rn+1)-Rn)}function xt(Xn){return(Math.exp(Xn)-Math.exp(-Xn))/2}function Zt(Xn){return(Math.exp(Xn)+Math.exp(-Xn))/2}const zn=vt(!1);let Bt=function(Xn){return Zt(zn)/Zt(zn+Be*Xn)},Tn=function(Xn){return Ke*((Zt(zn)*(xt(Rn=zn+Be*Xn)/Zt(Rn))-xt(zn))/bt)/lt;var Rn},Nn=(vt(!0)-zn)/Be;if(Math.abs(lt)<1e-6||!isFinite(Nn)){if(Math.abs(Ke-Qe)<1e-6)return this.easeTo(s,d);const Xn=Qe<Ke?-1:1;Nn=Math.abs(Math.log(Qe/Ke))/Be,Tn=function(){return 0},Bt=function(Rn){return Math.exp(Xn*Be*Rn)}}return s.duration="duration"in s?+s.duration:1e3*Nn/("screenSpeed"in s?+s.screenSpeed/Be:+s.speed),s.maxDuration&&s.duration>s.maxDuration&&(s.duration=0),this._zooming=!0,this._rotating=P!==H,this._pitching=$!==R,this._padding=!g.isPaddingEqual(Z),this._prepareEase(d,!1),this.terrain&&this._prepareElevation(we),this._ease(Xn=>{const Rn=Xn*Nn,Vn=1/Bt(Rn);g.zoom=Xn===1?fe:b+g.scaleZoom(Vn),this._rotating&&(g.bearing=o.z.number(P,H,Xn)),this._pitching&&(g.pitch=o.z.number(R,$,Xn)),this._padding&&(g.interpolatePadding(D,Z,Xn),_e=g.centerPoint.add(se)),this.terrain&&!s.freezeElevation&&this._updateElevation(Xn);const Hn=Xn===1?we:g.unproject($e.add(Te.mult(Tn(Rn))).mult(Vn));g.setLocationAtPoint(g.renderWorldCopies?Hn.wrap():Hn,_e),this._applyUpdatedTransform(g),this._fireMoveEvents(d)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(d)},s),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(s,d){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const m=this._onEaseEnd;delete this._onEaseEnd,m.call(this,d)}if(!s){const m=this.handlers;m&&m.stop(!1)}return this}_ease(s,d,m){m.animate===!1||m.duration===0?(s(1),d()):(this._easeStart=M.now(),this._easeOptions=m,this._onEaseFrame=s,this._onEaseEnd=d,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(s,d){s=o.b1(s,-180,180);const m=Math.abs(s-d);return Math.abs(s-360-d)<m&&(s-=360),Math.abs(s+360-d)<m&&(s+=360),s}_normalizeCenter(s){const d=this.transform;if(!d.renderWorldCopies||d.lngRange)return;const m=s.lng-d.center.lng;s.lng+=m>180?-360:m<-180?360:0}queryTerrainElevation(s){return this.terrain?this.terrain.getElevationForLngLatZoom(o.M.convert(s),this.transform.tileZoom)-this.transform.elevation:null}}const Oa={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class Lm{constructor(s=Oa){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=d=>{!d||d.sourceDataType!=="metadata"&&d.sourceDataType!=="visibility"&&d.dataType!=="style"&&d.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=s}getDefaultPosition(){return"bottom-right"}onAdd(s){return this._map=s,this._compact=this.options.compact,this._container=S.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=S.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=S.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){S.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(s,d){const m=this._map._getUIString(`AttributionControl.${d}`);s.title=m,s.setAttribute("aria-label",m)}_updateAttributions(){if(!this._map.style)return;let s=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?s=s.concat(this.options.customAttribution.map(g=>typeof g!="string"?"":g)):typeof this.options.customAttribution=="string"&&s.push(this.options.customAttribution)),this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const d=this._map.style.sourceCaches;for(const g in d){const b=d[g];if(b.used||b.usedForTerrain){const P=b.getSource();P.attribution&&s.indexOf(P.attribution)<0&&s.push(P.attribution)}}s=s.filter(g=>String(g).trim()),s.sort((g,b)=>g.length-b.length),s=s.filter((g,b)=>{for(let P=b+1;P<s.length;P++)if(s[P].indexOf(g)>=0)return!1;return!0});const m=s.join(" | ");m!==this._attribHTML&&(this._attribHTML=m,s.length?(this._innerContainer.innerHTML=m,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class Gl{constructor(s={}){this._updateCompact=()=>{const d=this._container.children;if(d.length){const m=d[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&m.classList.add("maplibregl-compact"):m.classList.remove("maplibregl-compact")}},this.options=s}getDefaultPosition(){return"bottom-left"}onAdd(s){this._map=s,this._compact=this.options&&this.options.compact,this._container=S.create("div","maplibregl-ctrl");const d=S.create("a","maplibregl-ctrl-logo");return d.target="_blank",d.rel="noopener nofollow",d.href="https://maplibre.org/",d.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),d.setAttribute("rel","noopener nofollow"),this._container.appendChild(d),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){S.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class zi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(s){const d=++this._id;return this._queue.push({callback:s,id:d,cancelled:!1}),d}remove(s){const d=this._currentlyRunning,m=d?this._queue.concat(d):this._queue;for(const g of m)if(g.id===s)return void(g.cancelled=!0)}run(s=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const d=this._currentlyRunning=this._queue;this._queue=[];for(const m of d)if(!m.cancelled&&(m.callback(s),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var Wi=o.X([{name:"a_pos3d",type:"Int16",components:3}]);class zm extends o.E{constructor(s){super(),this.sourceCache=s,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,s.usedForTerrain=!0,s.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(s,d){this.sourceCache.update(s,d),this._renderableTilesKeys=[];const m={};for(const g of s.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:d}))m[g.key]=!0,this._renderableTilesKeys.push(g.key),this._tiles[g.key]||(g.posMatrix=new Float64Array(16),o.aN(g.posMatrix,0,o.W,0,o.W,0,1),this._tiles[g.key]=new Kt(g,this.tileSize));for(const g in this._tiles)m[g]||delete this._tiles[g]}freeRtt(s){for(const d in this._tiles){const m=this._tiles[d];(!s||m.tileID.equals(s)||m.tileID.isChildOf(s)||s.isChildOf(m.tileID))&&(m.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(s=>this.getTileByID(s))}getTileByID(s){return this._tiles[s]}getTerrainCoords(s){const d={};for(const m of this._renderableTilesKeys){const g=this._tiles[m].tileID;if(g.canonical.equals(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16),o.aN(b.posMatrix,0,o.W,0,o.W,0,1),d[m]=b}else if(g.canonical.isChildOf(s.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const P=g.canonical.z-s.canonical.z,R=g.canonical.x-(g.canonical.x>>P<<P),D=g.canonical.y-(g.canonical.y>>P<<P),H=o.W>>P;o.aN(b.posMatrix,0,H,0,H,0,1),o.H(b.posMatrix,b.posMatrix,[-R*H,-D*H,0]),d[m]=b}else if(s.canonical.isChildOf(g.canonical)){const b=s.clone();b.posMatrix=new Float64Array(16);const P=s.canonical.z-g.canonical.z,R=s.canonical.x-(s.canonical.x>>P<<P),D=s.canonical.y-(s.canonical.y>>P<<P),H=o.W>>P;o.aN(b.posMatrix,0,o.W,0,o.W,0,1),o.H(b.posMatrix,b.posMatrix,[R*H,D*H,0]),o.J(b.posMatrix,b.posMatrix,[1/2**P,1/2**P,0]),d[m]=b}}return d}getSourceTile(s,d){const m=this.sourceCache._source;let g=s.overscaledZ-this.deltaZoom;if(g>m.maxzoom&&(g=m.maxzoom),g<m.minzoom)return null;this._sourceTileCache[s.key]||(this._sourceTileCache[s.key]=s.scaledTo(g).key);let b=this.sourceCache.getTileByID(this._sourceTileCache[s.key]);if((!b||!b.dem)&&d)for(;g>=m.minzoom&&(!b||!b.dem);)b=this.sourceCache.getTileByID(s.scaledTo(g--).key);return b}tilesAfterTime(s=Date.now()){return Object.values(this._tiles).filter(d=>d.timeAdded>=s)}}class au{constructor(s,d,m){this.painter=s,this.sourceCache=new zm(d),this.options=m,this.exaggeration=typeof m.exaggeration=="number"?m.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(s,d,m,g=o.W){var b;if(!(d>=0&&d<g&&m>=0&&m<g))return 0;const P=this.getTerrainData(s),R=(b=P.tile)===null||b===void 0?void 0:b.dem;if(!R)return 0;const D=function(ve,we,fe){var ze=we[0],$e=we[1];return ve[0]=fe[0]*ze+fe[4]*$e+fe[12],ve[1]=fe[1]*ze+fe[5]*$e+fe[13],ve}([],[d/g*o.W,m/g*o.W],P.u_terrain_matrix),H=[D[0]*R.dim,D[1]*R.dim],$=Math.floor(H[0]),Z=Math.floor(H[1]),se=H[0]-$,_e=H[1]-Z;return R.get($,Z)*(1-se)*(1-_e)+R.get($+1,Z)*se*(1-_e)+R.get($,Z+1)*(1-se)*_e+R.get($+1,Z+1)*se*_e}getElevationForLngLatZoom(s,d){const{tileID:m,mercatorX:g,mercatorY:b}=this._getOverscaledTileIDFromLngLatZoom(s,d);return this.getElevation(m,g%o.W,b%o.W,o.W)}getElevation(s,d,m,g=o.W){return this.getDEMElevation(s,d,m,g)*this.exaggeration}getTerrainData(s){if(!this._emptyDemTexture){const g=this.painter.context,b=new o.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new Fe(g,b,g.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new Fe(g,new o.R({width:1,height:1}),g.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=o.an([])}const d=this.sourceCache.getSourceTile(s,!0);if(d&&d.dem&&(!d.demTexture||d.needsTerrainPrepare)){const g=this.painter.context;d.demTexture=this.painter.getTileTexture(d.dem.stride),d.demTexture?d.demTexture.update(d.dem.getPixels(),{premultiply:!1}):d.demTexture=new Fe(g,d.dem.getPixels(),g.gl.RGBA,{premultiply:!1}),d.demTexture.bind(g.gl.NEAREST,g.gl.CLAMP_TO_EDGE),d.needsTerrainPrepare=!1}const m=d&&d+d.tileID.key+s.key;if(m&&!this._demMatrixCache[m]){const g=this.sourceCache.sourceCache._source.maxzoom;let b=s.canonical.z-d.tileID.canonical.z;s.overscaledZ>s.canonical.z&&(s.canonical.z>=g?b=s.canonical.z-g:o.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const P=s.canonical.x-(s.canonical.x>>b<<b),R=s.canonical.y-(s.canonical.y>>b<<b),D=o.b9(new Float64Array(16),[1/(o.W<<b),1/(o.W<<b),0]);o.H(D,D,[P*o.W,R*o.W,0]),this._demMatrixCache[s.key]={matrix:D,coord:s}}return{u_depth:2,u_terrain:3,u_terrain_dim:d&&d.dem&&d.dem.dim||1,u_terrain_matrix:m?this._demMatrixCache[s.key].matrix:this._emptyDemMatrix,u_terrain_unpack:d&&d.dem&&d.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(d&&d.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:d}}getFramebuffer(s){const d=this.painter,m=d.width/devicePixelRatio,g=d.height/devicePixelRatio;return!this._fbo||this._fbo.width===m&&this._fbo.height===g||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new Fe(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new Fe(d.context,{width:m,height:g,data:null},d.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(d.context.gl.NEAREST,d.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=d.context.createFramebuffer(m,g,!0,!1),this._fbo.depthAttachment.set(d.context.createRenderbuffer(d.context.gl.DEPTH_COMPONENT16,m,g))),this._fbo.colorAttachment.set(s==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const s=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const d=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let b=0,P=0;b<this._coordsTextureSize;b++)for(let R=0;R<this._coordsTextureSize;R++,P+=4)d[P+0]=255&R,d[P+1]=255&b,d[P+2]=R>>8<<4|b>>8,d[P+3]=0;const m=new o.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(d.buffer)),g=new Fe(s,m,s.gl.RGBA,{premultiply:!1});return g.bind(s.gl.NEAREST,s.gl.CLAMP_TO_EDGE),this._coordsTexture=g,g}pointCoordinate(s){this.painter.maybeDrawDepthAndCoords(!0);const d=new Uint8Array(4),m=this.painter.context,g=m.gl;m.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null);const b=d[0]+(d[2]>>4<<8),P=d[1]+((15&d[2])<<8),R=this.coordsIndex[255-d[3]],D=R&&this.sourceCache.getTileByID(R);if(!D)return null;const H=this._coordsTextureSize,$=(1<<D.tileID.canonical.z)*H;return new o.Y((D.tileID.canonical.x*H+b)/$+D.tileID.wrap,(D.tileID.canonical.y*H+P)/$,this.getElevation(D.tileID,b,P,H))}depthAtPoint(s){const d=new Uint8Array(4),m=this.painter.context,g=m.gl;return m.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),g.readPixels(s.x,this.painter.height/devicePixelRatio-s.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,d),m.bindFramebuffer.set(null),(d[0]/16777216+d[1]/65536+d[2]/256+d[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const s=this.painter.context,d=new o.ba,m=new o.aX,g=this.meshSize,b=o.W/g,P=g*g;for(let Z=0;Z<=g;Z++)for(let se=0;se<=g;se++)d.emplaceBack(se*b,Z*b,0);for(let Z=0;Z<P;Z+=g+1)for(let se=0;se<g;se++)m.emplaceBack(se+Z,g+se+Z+1,g+se+Z+2),m.emplaceBack(se+Z,g+se+Z+2,se+Z+1);const R=d.length,D=R+2*(g+1);for(const Z of[0,1])for(let se=0;se<=g;se++)for(const _e of[0,1])d.emplaceBack(se*b,Z*o.W,_e);for(let Z=0;Z<2*g;Z+=2)m.emplaceBack(D+Z,D+Z+1,D+Z+3),m.emplaceBack(D+Z,D+Z+3,D+Z+2),m.emplaceBack(R+Z,R+Z+3,R+Z+1),m.emplaceBack(R+Z,R+Z+2,R+Z+3);const H=d.length,$=H+2*(g+1);for(const Z of[0,1])for(let se=0;se<=g;se++)for(const _e of[0,1])d.emplaceBack(Z*o.W,se*b,_e);for(let Z=0;Z<2*g;Z+=2)m.emplaceBack(H+Z,H+Z+1,H+Z+3),m.emplaceBack(H+Z,H+Z+3,H+Z+2),m.emplaceBack($+Z,$+Z+3,$+Z+1),m.emplaceBack($+Z,$+Z+2,$+Z+3);return this._mesh={indexBuffer:s.createIndexBuffer(m),vertexBuffer:s.createVertexBuffer(d,Wi.members),segments:o.$.simpleSegment(0,0,d.length,m.length)},this._mesh}getMeshFrameDelta(s){return 2*Math.PI*o.bb/Math.pow(2,s)/5}getMinTileElevationForLngLatZoom(s,d){var m;const{tileID:g}=this._getOverscaledTileIDFromLngLatZoom(s,d);return(m=this.getMinMaxElevation(g).minElevation)!==null&&m!==void 0?m:0}getMinMaxElevation(s){const d=this.getTerrainData(s).tile,m={minElevation:null,maxElevation:null};return d&&d.dem&&(m.minElevation=d.dem.min*this.exaggeration,m.maxElevation=d.dem.max*this.exaggeration),m}_getOverscaledTileIDFromLngLatZoom(s,d){const m=o.Y.fromLngLat(s.wrap()),g=(1<<d)*o.W,b=m.x*g,P=m.y*g,R=Math.floor(b/o.W),D=Math.floor(P/o.W);return{tileID:new o.Q(d,0,d,R,D),mercatorX:b,mercatorY:P}}}class bh{constructor(s,d,m){this._context=s,this._size=d,this._tileSize=m,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const s of this._objects)s.texture.destroy(),s.fbo.destroy()}_createObject(s){const d=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),m=new Fe(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return m.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),d.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),d.colorAttachment.set(m.texture),{id:s,fbo:d,texture:m,stamp:-1,inUse:!1}}getObjectForId(s){return this._objects[s]}useObject(s){s.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(d=>s.id!==d),this._recentlyUsed.push(s.id)}stampObject(s){s.stamp=++this._stamp}getOrCreateFreeObject(){for(const d of this._recentlyUsed)if(!this._objects[d].inUse)return this._objects[d];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const s=this._createObject(this._objects.length);return this._objects.push(s),s}freeObject(s){s.inUse=!1}freeAllObjects(){for(const s of this._objects)this.freeObject(s)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(s=>!s.inUse)===!1}}const ro={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class Gf{constructor(s,d){this.painter=s,this.terrain=d,this.pool=new bh(s.context,30,d.sourceCache.tileSize*d.qualityFactor)}destruct(){this.pool.destruct()}getTexture(s){return this.pool.getObjectForId(s.rtt[this._stacks.length-1].id).texture}prepareForRender(s,d){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=s._order.filter(m=>!s._layers[m].isHidden(d)),this._coordsDescendingInv={};for(const m in s.sourceCaches){this._coordsDescendingInv[m]={};const g=s.sourceCaches[m].getVisibleCoordinates();for(const b of g){const P=this.terrain.sourceCache.getTerrainCoords(b);for(const R in P)this._coordsDescendingInv[m][R]||(this._coordsDescendingInv[m][R]=[]),this._coordsDescendingInv[m][R].push(P[R])}}this._coordsDescendingInvStr={};for(const m of s._order){const g=s._layers[m],b=g.source;if(ro[g.type]&&!this._coordsDescendingInvStr[b]){this._coordsDescendingInvStr[b]={};for(const P in this._coordsDescendingInv[b])this._coordsDescendingInvStr[b][P]=this._coordsDescendingInv[b][P].map(R=>R.key).sort().join()}}for(const m of this._renderableTiles)for(const g in this._coordsDescendingInvStr){const b=this._coordsDescendingInvStr[g][m.tileID.key];b&&b!==m.rttCoords[g]&&(m.rtt=[])}}renderLayer(s){if(s.isHidden(this.painter.transform.zoom))return!1;const d=s.type,m=this.painter,g=this._renderableLayerIds[this._renderableLayerIds.length-1]===s.id;if(ro[d]&&(this._prevType&&ro[this._prevType]||this._stacks.push([]),this._prevType=d,this._stacks[this._stacks.length-1].push(s.id),!g))return!0;if(ro[this._prevType]||ro[d]&&g){this._prevType=d;const b=this._stacks.length-1,P=this._stacks[b]||[];for(const R of this._renderableTiles){if(this.pool.isFull()&&(Pf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(R),R.rtt[b]){const H=this.pool.getObjectForId(R.rtt[b].id);if(H.stamp===R.rtt[b].stamp){this.pool.useObject(H);continue}}const D=this.pool.getOrCreateFreeObject();this.pool.useObject(D),this.pool.stampObject(D),R.rtt[b]={id:D.id,stamp:D.stamp},m.context.bindFramebuffer.set(D.fbo.framebuffer),m.context.clear({color:o.aO.transparent,stencil:0}),m.currentStencilSource=void 0;for(let H=0;H<P.length;H++){const $=m.style._layers[P[H]],Z=$.source?this._coordsDescendingInv[$.source][R.tileID.key]:[R.tileID];m.context.viewport.set([0,0,D.fbo.width,D.fbo.height]),m._renderTileClippingMasks($,Z),m.renderLayer(m,m.style.sourceCaches[$.source],$,Z),$.source&&(R.rttCoords[$.source]=this._coordsDescendingInvStr[$.source][R.tileID.key])}}return Pf(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ro[d]}return!1}}const jf={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use ⌘ + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},su=p,Wf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:Oa,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:o.a.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0,maxCanvasSize:[4096,4096]},wh=_=>{_.touchstart=_.dragStart,_.touchmoveWindow=_.dragMove,_.touchend=_.dragEnd},qf={showCompass:!0,showZoom:!0,visualizePitch:!1};class $f{constructor(s,d,m=!1){this.mousedown=P=>{this.startMouse(o.e({},P,{ctrlKey:!0,preventDefault:()=>P.preventDefault()}),S.mousePos(this.element,P)),S.addEventListener(window,"mousemove",this.mousemove),S.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=P=>{this.moveMouse(P,S.mousePos(this.element,P))},this.mouseup=P=>{this.mouseRotate.dragEnd(P),this.mousePitch&&this.mousePitch.dragEnd(P),this.offTemp()},this.touchstart=P=>{P.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=S.touchPos(this.element,P.targetTouches)[0],this.startTouch(P,this._startPos),S.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.addEventListener(window,"touchend",this.touchend))},this.touchmove=P=>{P.targetTouches.length!==1?this.reset():(this._lastPos=S.touchPos(this.element,P.targetTouches)[0],this.moveTouch(P,this._lastPos))},this.touchend=P=>{P.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const g=s.dragRotate._mouseRotate.getClickTolerance(),b=s.dragRotate._mousePitch.getClickTolerance();this.element=d,this.mouseRotate=Hl({clickTolerance:g,enable:!0}),this.touchRotate=(({enable:P,clickTolerance:R,bearingDegreesPerPixelMoved:D=.8})=>{const H=new zf;return new Ps({clickTolerance:R,move:($,Z)=>({bearingDelta:(Z.x-$.x)*D}),moveStateManager:H,enable:P,assignEvents:wh})})({clickTolerance:g,enable:!0}),this.map=s,m&&(this.mousePitch=Ff({clickTolerance:b,enable:!0}),this.touchPitch=(({enable:P,clickTolerance:R,pitchDegreesPerPixelMoved:D=-.5})=>{const H=new zf;return new Ps({clickTolerance:R,move:($,Z)=>({pitchDelta:(Z.y-$.y)*D}),moveStateManager:H,enable:P,assignEvents:wh})})({clickTolerance:b,enable:!0})),S.addEventListener(d,"mousedown",this.mousedown),S.addEventListener(d,"touchstart",this.touchstart,{passive:!1}),S.addEventListener(d,"touchcancel",this.reset)}startMouse(s,d){this.mouseRotate.dragStart(s,d),this.mousePitch&&this.mousePitch.dragStart(s,d),S.disableDrag()}startTouch(s,d){this.touchRotate.dragStart(s,d),this.touchPitch&&this.touchPitch.dragStart(s,d),S.disableDrag()}moveMouse(s,d){const m=this.map,{bearingDelta:g}=this.mouseRotate.dragMove(s,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.mousePitch){const{pitchDelta:b}=this.mousePitch.dragMove(s,d)||{};b&&m.setPitch(m.getPitch()+b)}}moveTouch(s,d){const m=this.map,{bearingDelta:g}=this.touchRotate.dragMove(s,d)||{};if(g&&m.setBearing(m.getBearing()+g),this.touchPitch){const{pitchDelta:b}=this.touchPitch.dragMove(s,d)||{};b&&m.setPitch(m.getPitch()+b)}}off(){const s=this.element;S.removeEventListener(s,"mousedown",this.mousedown),S.removeEventListener(s,"touchstart",this.touchstart,{passive:!1}),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend),S.removeEventListener(s,"touchcancel",this.reset),this.offTemp()}offTemp(){S.enableDrag(),S.removeEventListener(window,"mousemove",this.mousemove),S.removeEventListener(window,"mouseup",this.mouseup),S.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),S.removeEventListener(window,"touchend",this.touchend)}}let Rs;function Sh(_,s,d){const m=new o.M(_.lng,_.lat);if(_=new o.M(_.lng,_.lat),s){const g=new o.M(_.lng-360,_.lat),b=new o.M(_.lng+360,_.lat),P=d.locationPoint(_).distSqr(s);d.locationPoint(g).distSqr(s)<P?_=g:d.locationPoint(b).distSqr(s)<P&&(_=b)}for(;Math.abs(_.lng-d.center.lng)>180;){const g=d.locationPoint(_);if(g.x>=0&&g.y>=0&&g.x<=d.width&&g.y<=d.height)break;_.lng>d.center.lng?_.lng-=360:_.lng+=360}return _.lng!==m.lng&&d.locationPoint(_).y>d.height/2-d.getHorizon()?_:m}const ou={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Mh(_,s,d){const m=_.classList;for(const g in ou)m.remove(`maplibregl-${d}-anchor-${g}`);m.add(`maplibregl-${d}-anchor-${s}`)}class jl extends o.E{constructor(s){if(super(),this._onKeyPress=d=>{const m=d.code,g=d.charCode||d.keyCode;m!=="Space"&&m!=="Enter"&&g!==32&&g!==13||this.togglePopup()},this._onMapClick=d=>{const m=d.originalEvent.target,g=this._element;this._popup&&(m===g||g.contains(m))&&this.togglePopup()},this._update=d=>{var m;if(!this._map)return;const g=this._map.loaded()&&!this._map.isMoving();((d==null?void 0:d.type)==="terrain"||(d==null?void 0:d.type)==="render"&&!g)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?Sh(this._lngLat,this._flatPos,this._map.transform):(m=this._lngLat)===null||m===void 0?void 0:m.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let b="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?b=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(b=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let P="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?P="rotateX(0deg)":this._pitchAlignment==="map"&&(P=`rotateX(${this._map.getPitch()}deg)`),d&&d.type!=="moveend"||(this._pos=this._pos.round()),S.setTransform(this._element,`${ou[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${P} ${b}`),M.frameAsync(new AbortController).then(()=>{this._updateOpacity(d&&d.type==="moveend")}).catch(()=>{})},this._onMove=d=>{if(!this._isDragging){const m=this._clickTolerance||this._map._clickTolerance;this._isDragging=d.point.dist(this._pointerdownPos)>=m}this._isDragging&&(this._pos=d.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.k("dragstart"))),this.fire(new o.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new o.k("dragend")),this._state="inactive"},this._addDragHandler=d=>{this._element.contains(d.originalEvent.target)&&(d.preventDefault(),this._positionDelta=d.point.sub(this._pos).add(this._offset),this._pointerdownPos=d.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=s&&s.anchor||"center",this._color=s&&s.color||"#3FB1CE",this._scale=s&&s.scale||1,this._draggable=s&&s.draggable||!1,this._clickTolerance=s&&s.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=s&&s.rotation||0,this._rotationAlignment=s&&s.rotationAlignment||"auto",this._pitchAlignment=s&&s.pitchAlignment&&s.pitchAlignment!=="auto"?s.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(s==null?void 0:s.opacity,s==null?void 0:s.opacityWhenCovered),s&&s.element)this._element=s.element,this._offset=o.P.convert(s&&s.offset||[0,0]);else{this._defaultMarker=!0,this._element=S.create("div"),this._element.setAttribute("aria-label","Map marker");const d=S.createNS("http://www.w3.org/2000/svg","svg"),m=41,g=27;d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height",`${m}px`),d.setAttributeNS(null,"width",`${g}px`),d.setAttributeNS(null,"viewBox",`0 0 ${g} ${m}`);const b=S.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");const P=S.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const R=S.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");const D=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ze of D){const $e=S.createNS("http://www.w3.org/2000/svg","ellipse");$e.setAttributeNS(null,"opacity","0.04"),$e.setAttributeNS(null,"cx","10.5"),$e.setAttributeNS(null,"cy","5.80029008"),$e.setAttributeNS(null,"rx",ze.rx),$e.setAttributeNS(null,"ry",ze.ry),R.appendChild($e)}const H=S.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"fill",this._color);const $=S.createNS("http://www.w3.org/2000/svg","path");$.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),H.appendChild($);const Z=S.createNS("http://www.w3.org/2000/svg","g");Z.setAttributeNS(null,"opacity","0.25"),Z.setAttributeNS(null,"fill","#000000");const se=S.createNS("http://www.w3.org/2000/svg","path");se.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Z.appendChild(se);const _e=S.createNS("http://www.w3.org/2000/svg","g");_e.setAttributeNS(null,"transform","translate(6.0, 7.0)"),_e.setAttributeNS(null,"fill","#FFFFFF");const ve=S.createNS("http://www.w3.org/2000/svg","g");ve.setAttributeNS(null,"transform","translate(8.0, 8.0)");const we=S.createNS("http://www.w3.org/2000/svg","circle");we.setAttributeNS(null,"fill","#000000"),we.setAttributeNS(null,"opacity","0.25"),we.setAttributeNS(null,"cx","5.5"),we.setAttributeNS(null,"cy","5.5"),we.setAttributeNS(null,"r","5.4999962");const fe=S.createNS("http://www.w3.org/2000/svg","circle");fe.setAttributeNS(null,"fill","#FFFFFF"),fe.setAttributeNS(null,"cx","5.5"),fe.setAttributeNS(null,"cy","5.5"),fe.setAttributeNS(null,"r","5.4999962"),ve.appendChild(we),ve.appendChild(fe),P.appendChild(R),P.appendChild(H),P.appendChild(Z),P.appendChild(_e),P.appendChild(ve),d.appendChild(P),d.setAttributeNS(null,"height",m*this._scale+"px"),d.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(d),this._offset=o.P.convert(s&&s.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",d=>{d.preventDefault()}),this._element.addEventListener("mousedown",d=>{d.preventDefault()}),Mh(this._element,this._anchor,"marker"),s&&s.className)for(const d of s.className.split(" "))this._element.classList.add(d);this._popup=null}addTo(s){return this.remove(),this._map=s,s.getCanvasContainer().appendChild(this._element),s.on("move",this._update),s.on("moveend",this._update),s.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),S.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(s){return this._lngLat=o.M.convert(s),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(s){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),s){if(!("offset"in s.options)){const g=Math.abs(13.5)/Math.SQRT2;s.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=s,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}getPopup(){return this._popup}togglePopup(){const s=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:s?(s.isOpen()?s.remove():(s.setLngLat(this._lngLat),s.addTo(this._map)),this):this}_updateOpacity(s=!1){var d,m;if(!(!((d=this._map)===null||d===void 0)&&d.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(s)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const g=this._map,b=g.terrain.depthAtPoint(this._pos),P=g.terrain.getElevationForLngLatZoom(this._lngLat,g.transform.tileZoom);if(g.transform.lngLatToCameraDepth(this._lngLat,P)-b<.006)return void(this._element.style.opacity=this._opacity);const R=-this._offset.y/g.transform._pixelPerMeter,D=Math.sin(g.getPitch()*Math.PI/180)*R,H=g.terrain.depthAtPoint(new o.P(this._pos.x,this._pos.y-this._offset.y)),$=g.transform.lngLatToCameraDepth(this._lngLat,P+D)-H>.006;!((m=this._popup)===null||m===void 0)&&m.isOpen()&&$&&this._popup.remove(),this._element.style.opacity=$?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(s){return this._offset=o.P.convert(s),this._update(),this}addClassName(s){this._element.classList.add(s)}removeClassName(s){this._element.classList.remove(s)}toggleClassName(s){return this._element.classList.toggle(s)}setDraggable(s){return this._draggable=!!s,this._map&&(s?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(s){return this._rotation=s||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(s){return this._rotationAlignment=s||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(s){return this._pitchAlignment=s&&s!=="auto"?s:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(s,d){return s===void 0&&d===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),s!==void 0&&(this._opacity=s),d!==void 0&&(this._opacityWhenCovered=d),this._map&&this._updateOpacity(!0),this}}const Xf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wl=0,ao=!1;const Zf={maxWidth:100,unit:"metric"};function Th(_,s,d){const m=d&&d.maxWidth||100,g=_._container.clientHeight/2,b=_.unproject([0,g]),P=_.unproject([m,g]),R=b.distanceTo(P);if(d&&d.unit==="imperial"){const D=3.2808*R;D>5280?Oo(s,m,D/5280,_._getUIString("ScaleControl.Miles")):Oo(s,m,D,_._getUIString("ScaleControl.Feet"))}else d&&d.unit==="nautical"?Oo(s,m,R/1852,_._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Oo(s,m,R/1e3,_._getUIString("ScaleControl.Kilometers")):Oo(s,m,R,_._getUIString("ScaleControl.Meters"))}function Oo(_,s,d,m){const g=function(b){const P=Math.pow(10,`${Math.floor(b)}`.length-1);let R=b/P;return R=R>=10?10:R>=5?5:R>=3?3:R>=2?2:R>=1?1:function(D){const H=Math.pow(10,Math.ceil(-Math.log(D)/Math.LN10));return Math.round(D*H)/H}(R),P*R}(d);_.style.width=s*(g/d)+"px",_.innerHTML=`${g}&nbsp;${m}`}const Yf={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Kf=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Jf(_){if(_){if(typeof _=="number"){const s=Math.round(Math.abs(_)/Math.SQRT2);return{center:new o.P(0,0),top:new o.P(0,_),"top-left":new o.P(s,s),"top-right":new o.P(-s,s),bottom:new o.P(0,-_),"bottom-left":new o.P(s,-s),"bottom-right":new o.P(-s,-s),left:new o.P(_,0),right:new o.P(-_,0)}}if(_ instanceof o.P||Array.isArray(_)){const s=o.P.convert(_);return{center:s,top:s,"top-left":s,"top-right":s,bottom:s,"bottom-left":s,"bottom-right":s,left:s,right:s}}return{center:o.P.convert(_.center||[0,0]),top:o.P.convert(_.top||[0,0]),"top-left":o.P.convert(_["top-left"]||[0,0]),"top-right":o.P.convert(_["top-right"]||[0,0]),bottom:o.P.convert(_.bottom||[0,0]),"bottom-left":o.P.convert(_["bottom-left"]||[0,0]),"bottom-right":o.P.convert(_["bottom-right"]||[0,0]),left:o.P.convert(_.left||[0,0]),right:o.P.convert(_.right||[0,0])}}return Jf(new o.P(0,0))}const Fm=p;h.AJAXError=o.be,h.Evented=o.E,h.LngLat=o.M,h.MercatorCoordinate=o.Y,h.Point=o.P,h.addProtocol=o.bf,h.config=o.a,h.removeProtocol=o.bg,h.AttributionControl=Lm,h.BoxZoomHandler=Vl,h.CanvasSource=Mt,h.CooperativeGesturesHandler=Mn,h.DoubleClickZoomHandler=Vf,h.DragPanHandler=Ba,h.DragRotateHandler=iu,h.EdgeInsets=Qc,h.FullscreenControl=class extends o.E{constructor(_={}){super(),this._onFullscreenChange=()=>{var s;let d=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((s=d==null?void 0:d.shadowRoot)===null||s===void 0)&&s.fullscreenElement;)d=d.shadowRoot.fullscreenElement;d===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,_&&_.container&&(_.container instanceof HTMLElement?this._container=_.container:o.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(_){return this._map=_,this._container||(this._container=this._map.getContainer()),this._controlContainer=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){S.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const _=this._fullscreenButton=S.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);S.create("span","maplibregl-ctrl-icon",_).setAttribute("aria-hidden","true"),_.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const _=this._getTitle();this._fullscreenButton.setAttribute("aria-label",_),this._fullscreenButton.title=_}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new o.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new o.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},h.GeoJSONSource=rt,h.GeolocateControl=class extends o.E{constructor(_){super(),this._onSuccess=s=>{if(this._map){if(this._isOutOfMapMaxBounds(s))return this._setErrorState(),this.fire(new o.k("outofmaxbounds",s)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=s,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(s),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(s),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new o.k("geolocate",s)),this._finish()}},this._updateCamera=s=>{const d=new o.M(s.coords.longitude,s.coords.latitude),m=s.coords.accuracy,g=this._map.getBearing(),b=o.e({bearing:g},this.options.fitBoundsOptions),P=Yt.fromLngLat(d,m);this._map.fitBounds(P,b,{geolocateSource:!0})},this._updateMarker=s=>{if(s){const d=new o.M(s.coords.longitude,s.coords.latitude);this._accuracyCircleMarker.setLngLat(d).addTo(this._map),this._userLocationDotMarker.setLngLat(d).addTo(this._map),this._accuracy=s.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=s=>{if(this._map){if(this.options.trackUserLocation)if(s.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(s.code===3&&ao)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new o.k("error",s)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=s=>{if(this._map){if(this._container.addEventListener("contextmenu",d=>d.preventDefault()),this._geolocateButton=S.create("button","maplibregl-ctrl-geolocate",this._container),S.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",s===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const d=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}else{const d=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=d,this._geolocateButton.setAttribute("aria-label",d)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=S.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new jl({element:this._dotElement}),this._circleElement=S.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",d=>{d.geolocateSource||this._watchState!=="ACTIVE_LOCK"||d.originalEvent&&d.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new o.k("trackuserlocationend")))})}},this.options=o.e({},Xf,_)}onAdd(_){return this._map=_,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(){return o._(this,arguments,void 0,function*(s=!1){if(Rs!==void 0&&!s)return Rs;if(window.navigator.permissions===void 0)return Rs=!!window.navigator.geolocation,Rs;try{Rs=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{Rs=!!window.navigator.geolocation}return Rs})}().then(s=>this._setupUI(s)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),S.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wl=0,ao=!1}_isOutOfMapMaxBounds(_){const s=this._map.getMaxBounds(),d=_.coords;return s&&(d.longitude<s.getWest()||d.longitude>s.getEast()||d.latitude<s.getSouth()||d.latitude>s.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const _=this._map.getBounds(),s=_.getSouthEast(),d=_.getNorthEast(),m=s.distanceTo(d),g=Math.ceil(this._accuracy/(m/this._map._container.clientHeight)*2);this._circleElement.style.width=`${g}px`,this._circleElement.style.height=`${g}px`}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wl--,ao=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new o.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.k("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let _;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wl++,Wl>1?(_={maximumAge:6e5,timeout:0},ao=!0):(_=this.options.positionOptions,ao=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,_)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},h.Hash=kf,h.ImageSource=St,h.KeyboardHandler=bi,h.LngLatBounds=Yt,h.LogoControl=Gl,h.Map=class extends Dm{constructor(_){if(o.bc.mark(o.bd.create),(_=o.e({},Wf,_)).minZoom!=null&&_.maxZoom!=null&&_.minZoom>_.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(_.minPitch!=null&&_.maxPitch!=null&&_.minPitch>_.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(_.minPitch!=null&&_.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(_.maxPitch!=null&&_.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new gh(_.minZoom,_.maxZoom,_.minPitch,_.maxPitch,_.renderWorldCopies),{bearingSnap:_.bearingSnap}),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new o.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new o.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=_.interactive,this._maxTileCacheSize=_.maxTileCacheSize,this._maxTileCacheZoomLevels=_.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=_.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=_.preserveDrawingBuffer,this._antialias=_.antialias,this._trackResize=_.trackResize,this._bearingSnap=_.bearingSnap,this._refreshExpiredTiles=_.refreshExpiredTiles,this._fadeDuration=_.fadeDuration,this._crossSourceCollisions=_.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=_.collectResourceTiming,this._renderTaskQueue=new zi,this._controls=[],this._mapId=o.a3(),this._locale=o.e({},jf,_.locale),this._clickTolerance=_.clickTolerance,this._overridePixelRatio=_.pixelRatio,this._maxCanvasSize=_.maxCanvasSize,this.transformCameraUpdate=_.transformCameraUpdate,this._imageQueueHandle=O.addThrottleControl(()=>this.isMoving()),this._requestManager=new ue(_.transformRequest),typeof _.container=="string"){if(this._container=document.getElementById(_.container),!this._container)throw new Error(`Container '${_.container}' not found.`)}else{if(!(_.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=_.container}if(_.maxBounds&&this.setMaxBounds(_.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const d=If(m=>{this._trackResize&&!this._removed&&this.resize(m)._update()},50);this._resizeObserver=new ResizeObserver(m=>{s?d(m):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Wr(this,_),this._hash=_.hash&&new kf(typeof _.hash=="string"&&_.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:_.center,zoom:_.zoom,bearing:_.bearing,pitch:_.pitch}),_.bounds&&(this.resize(),this.fitBounds(_.bounds,o.e({},_.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=_.localIdeographFontFamily,this._validateStyle=_.validateStyle,_.style&&this.setStyle(_.style,{localIdeographFontFamily:_.localIdeographFontFamily}),_.attributionControl&&this.addControl(new Lm(typeof _.attributionControl=="boolean"?void 0:_.attributionControl)),_.maplibreLogo&&this.addControl(new Gl,_.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new o.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new o.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new o.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(_,s){if(s===void 0&&(s=_.getDefaultPosition?_.getDefaultPosition():"top-right"),!_||!_.onAdd)return this.fire(new o.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const d=_.onAdd(this);this._controls.push(_);const m=this._controlPositions[s];return s.indexOf("bottom")!==-1?m.insertBefore(d,m.firstChild):m.appendChild(d),this}removeControl(_){if(!_||!_.onRemove)return this.fire(new o.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const s=this._controls.indexOf(_);return s>-1&&this._controls.splice(s,1),_.onRemove(this),this}hasControl(_){return this._controls.indexOf(_)>-1}calculateCameraOptionsFromTo(_,s,d,m){return m==null&&this.terrain&&(m=this.terrain.getElevationForLngLatZoom(d,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(_,s,d,m)}resize(_){var s;const d=this._containerDimensions(),m=d[0],g=d[1],b=this._getClampedPixelRatio(m,g);if(this._resizeCanvas(m,g,b),this.painter.resize(m,g,b),this.painter.overLimit()){const R=this.painter.context.gl;this._maxCanvasSize=[R.drawingBufferWidth,R.drawingBufferHeight];const D=this._getClampedPixelRatio(m,g);this._resizeCanvas(m,g,D),this.painter.resize(m,g,D)}this.transform.resize(m,g),(s=this._requestedCameraState)===null||s===void 0||s.resize(m,g);const P=!this._moving;return P&&(this.stop(),this.fire(new o.k("movestart",_)).fire(new o.k("move",_))),this.fire(new o.k("resize",_)),P&&this.fire(new o.k("moveend",_)),this}_getClampedPixelRatio(_,s){const{0:d,1:m}=this._maxCanvasSize,g=this.getPixelRatio(),b=_*g,P=s*g;return Math.min(b>d?d/b:1,P>m?m/P:1)*g}getPixelRatio(){var _;return(_=this._overridePixelRatio)!==null&&_!==void 0?_:devicePixelRatio}setPixelRatio(_){this._overridePixelRatio=_,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(_){return this.transform.setMaxBounds(Yt.convert(_)),this._update()}setMinZoom(_){if((_=_??-2)>=-2&&_<=this.transform.maxZoom)return this.transform.minZoom=_,this._update(),this.getZoom()<_&&this.setZoom(_),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(_){if((_=_??22)>=this.transform.minZoom)return this.transform.maxZoom=_,this._update(),this.getZoom()>_&&this.setZoom(_),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(_){if((_=_??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(_>=0&&_<=this.transform.maxPitch)return this.transform.minPitch=_,this._update(),this.getPitch()<_&&this.setPitch(_),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(_){if((_=_??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(_>=this.transform.minPitch)return this.transform.maxPitch=_,this._update(),this.getPitch()>_&&this.setPitch(_),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(_){return this.transform.renderWorldCopies=_,this._update()}project(_){return this.transform.locationPoint(o.M.convert(_),this.style&&this.terrain)}unproject(_){return this.transform.pointLocation(o.P.convert(_),this.terrain)}isMoving(){var _;return this._moving||((_=this.handlers)===null||_===void 0?void 0:_.isMoving())}isZooming(){var _;return this._zooming||((_=this.handlers)===null||_===void 0?void 0:_.isZooming())}isRotating(){var _;return this._rotating||((_=this.handlers)===null||_===void 0?void 0:_.isRotating())}_createDelegatedListener(_,s,d){if(_==="mouseenter"||_==="mouseover"){let m=!1;return{layer:s,listener:d,delegates:{mousemove:b=>{const P=this.getLayer(s)?this.queryRenderedFeatures(b.point,{layers:[s]}):[];P.length?m||(m=!0,d.call(this,new pr(_,this,b.originalEvent,{features:P}))):m=!1},mouseout:()=>{m=!1}}}}if(_==="mouseleave"||_==="mouseout"){let m=!1;return{layer:s,listener:d,delegates:{mousemove:P=>{(this.getLayer(s)?this.queryRenderedFeatures(P.point,{layers:[s]}):[]).length?m=!0:m&&(m=!1,d.call(this,new pr(_,this,P.originalEvent)))},mouseout:P=>{m&&(m=!1,d.call(this,new pr(_,this,P.originalEvent)))}}}}{const m=g=>{const b=this.getLayer(s)?this.queryRenderedFeatures(g.point,{layers:[s]}):[];b.length&&(g.features=b,d.call(this,g),delete g.features)};return{layer:s,listener:d,delegates:{[_]:m}}}}on(_,s,d){if(d===void 0)return super.on(_,s);const m=this._createDelegatedListener(_,s,d);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[_]=this._delegatedListeners[_]||[],this._delegatedListeners[_].push(m);for(const g in m.delegates)this.on(g,m.delegates[g]);return this}once(_,s,d){if(d===void 0)return super.once(_,s);const m=this._createDelegatedListener(_,s,d);for(const g in m.delegates)this.once(g,m.delegates[g]);return this}off(_,s,d){return d===void 0?super.off(_,s):(this._delegatedListeners&&this._delegatedListeners[_]&&(m=>{const g=this._delegatedListeners[_];for(let b=0;b<g.length;b++){const P=g[b];if(P.layer===s&&P.listener===d){for(const R in P.delegates)this.off(R,P.delegates[R]);return g.splice(b,1),this}}})(),this)}queryRenderedFeatures(_,s){if(!this.style)return[];let d;const m=_ instanceof o.P||Array.isArray(_),g=m?_:[[0,0],[this.transform.width,this.transform.height]];if(s=s||(m?{}:_)||{},g instanceof o.P||typeof g[0]=="number")d=[o.P.convert(g)];else{const b=o.P.convert(g[0]),P=o.P.convert(g[1]);d=[b,new o.P(P.x,b.y),P,new o.P(b.x,P.y),b]}return this.style.queryRenderedFeatures(d,s,this.transform)}querySourceFeatures(_,s){return this.style.querySourceFeatures(_,s)}setStyle(_,s){return(s=o.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},s)).diff!==!1&&s.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&_?(this._diffStyle(_,s),this):(this._localIdeographFontFamily=s.localIdeographFontFamily,this._updateStyle(_,s))}setTransformRequest(_){return this._requestManager.setTransformRequest(_),this}_getUIString(_){const s=this._locale[_];if(s==null)throw new Error(`Missing UI string '${_}'`);return s}_updateStyle(_,s){if(s.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(_,s));const d=this.style&&s.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!_)),_?(this.style=new eo(this,s||{}),this.style.setEventedParent(this,{style:this.style}),typeof _=="string"?this.style.loadURL(_,s,d):this.style.loadJSON(_,s,d),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new eo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(_,s){if(typeof _=="string"){const d=this._requestManager.transformRequest(_,J.Style);o.h(d,new AbortController).then(m=>{this._updateDiff(m.data,s)}).catch(m=>{m&&this.fire(new o.j(m))})}else typeof _=="object"&&this._updateDiff(_,s)}_updateDiff(_,s){try{this.style.setState(_,s)&&this._update(!0)}catch(d){o.w(`Unable to perform style diff: ${d.message||d.error||d}.  Rebuilding the style from scratch.`),this._updateStyle(_,s)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():o.w("There is no style added to the map.")}addSource(_,s){return this._lazyInitEmptyStyle(),this.style.addSource(_,s),this._update(!0)}isSourceLoaded(_){const s=this.style&&this.style.sourceCaches[_];if(s!==void 0)return s.loaded();this.fire(new o.j(new Error(`There is no source with ID '${_}'`)))}setTerrain(_){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),_){const s=this.style.sourceCaches[_.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${_.source}`);this.terrain===null&&s.reload();for(const d in this.style._layers){const m=this.style._layers[d];m.type==="hillshade"&&m.source===_.source&&o.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new au(this.painter,s,_),this.painter.renderToTexture=new Gf(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=d=>{d.dataType==="style"?this.terrain.sourceCache.freeRtt():d.dataType==="source"&&d.tile&&(d.sourceId!==_.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(d.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new o.k("terrain",{terrain:_})),this}getTerrain(){var _,s;return(s=(_=this.terrain)===null||_===void 0?void 0:_.options)!==null&&s!==void 0?s:null}areTilesLoaded(){const _=this.style&&this.style.sourceCaches;for(const s in _){const d=_[s]._tiles;for(const m in d){const g=d[m];if(g.state!=="loaded"&&g.state!=="errored")return!1}}return!0}removeSource(_){return this.style.removeSource(_),this._update(!0)}getSource(_){return this.style.getSource(_)}addImage(_,s,d={}){const{pixelRatio:m=1,sdf:g=!1,stretchX:b,stretchY:P,content:R}=d;if(this._lazyInitEmptyStyle(),!(s instanceof HTMLImageElement||o.b(s))){if(s.width===void 0||s.height===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:D,height:H,data:$}=s,Z=s;return this.style.addImage(_,{data:new o.R({width:D,height:H},new Uint8Array($)),pixelRatio:m,stretchX:b,stretchY:P,content:R,sdf:g,version:0,userImage:Z}),Z.onAdd&&Z.onAdd(this,_),this}}{const{width:D,height:H,data:$}=M.getImageData(s);this.style.addImage(_,{data:new o.R({width:D,height:H},$),pixelRatio:m,stretchX:b,stretchY:P,content:R,sdf:g,version:0})}}updateImage(_,s){const d=this.style.getImage(_);if(!d)return this.fire(new o.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const m=s instanceof HTMLImageElement||o.b(s)?M.getImageData(s):s,{width:g,height:b,data:P}=m;if(g===void 0||b===void 0)return this.fire(new o.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(g!==d.data.width||b!==d.data.height)return this.fire(new o.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const R=!(s instanceof HTMLImageElement||o.b(s));return d.data.replace(P,R),this.style.updateImage(_,d),this}getImage(_){return this.style.getImage(_)}hasImage(_){return _?!!this.style.getImage(_):(this.fire(new o.j(new Error("Missing required image id"))),!1)}removeImage(_){this.style.removeImage(_)}loadImage(_){return O.getImage(this._requestManager.transformRequest(_,J.Image),new AbortController)}listImages(){return this.style.listImages()}addLayer(_,s){return this._lazyInitEmptyStyle(),this.style.addLayer(_,s),this._update(!0)}moveLayer(_,s){return this.style.moveLayer(_,s),this._update(!0)}removeLayer(_){return this.style.removeLayer(_),this._update(!0)}getLayer(_){return this.style.getLayer(_)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(_,s,d){return this.style.setLayerZoomRange(_,s,d),this._update(!0)}setFilter(_,s,d={}){return this.style.setFilter(_,s,d),this._update(!0)}getFilter(_){return this.style.getFilter(_)}setPaintProperty(_,s,d,m={}){return this.style.setPaintProperty(_,s,d,m),this._update(!0)}getPaintProperty(_,s){return this.style.getPaintProperty(_,s)}setLayoutProperty(_,s,d,m={}){return this.style.setLayoutProperty(_,s,d,m),this._update(!0)}getLayoutProperty(_,s){return this.style.getLayoutProperty(_,s)}setGlyphs(_,s={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(_,s),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(_,s,d={}){return this._lazyInitEmptyStyle(),this.style.addSprite(_,s,d,m=>{m||this._update(!0)}),this}removeSprite(_){return this._lazyInitEmptyStyle(),this.style.removeSprite(_),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(_,s={}){return this._lazyInitEmptyStyle(),this.style.setSprite(_,s,d=>{d||this._update(!0)}),this}setLight(_,s={}){return this._lazyInitEmptyStyle(),this.style.setLight(_,s),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(_,s){return this.style.setFeatureState(_,s),this._update()}removeFeatureState(_,s){return this.style.removeFeatureState(_,s),this._update()}getFeatureState(_){return this.style.getFeatureState(_)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let _=0,s=0;return this._container&&(_=this._container.clientWidth||400,s=this._container.clientHeight||300),[_,s]}_setupContainer(){const _=this._container;_.classList.add("maplibregl-map");const s=this._canvasContainer=S.create("div","maplibregl-canvas-container",_);this._interactive&&s.classList.add("maplibregl-interactive"),this._canvas=S.create("canvas","maplibregl-canvas",s),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const d=this._containerDimensions(),m=this._getClampedPixelRatio(d[0],d[1]);this._resizeCanvas(d[0],d[1],m);const g=this._controlContainer=S.create("div","maplibregl-control-container",_),b=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(P=>{b[P]=S.create("div",`maplibregl-ctrl-${P} `,g)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(_,s,d){this._canvas.width=Math.floor(d*_),this._canvas.height=Math.floor(d*s),this._canvas.style.width=`${_}px`,this._canvas.style.height=`${s}px`}_setupPainter(){const _={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let s=null;this._canvas.addEventListener("webglcontextcreationerror",m=>{s={requestedAttributes:_},m&&(s.statusMessage=m.statusMessage,s.type=m.type)},{once:!0});const d=this._canvas.getContext("webgl2",_)||this._canvas.getContext("webgl",_);if(!d){const m="Failed to initialize WebGL";throw s?(s.message=m,new Error(JSON.stringify(s))):new Error(m)}this.painter=new Bl(d,this.transform),A.testSupport(d)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(_){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||_,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(_){return this._update(),this._renderTaskQueue.add(_)}_cancelRenderFrame(_){this._renderTaskQueue.remove(_)}_render(_){const s=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(_),this._removed)return;let d=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const g=this.transform.zoom,b=M.now();this.style.zoomHistory.update(g,b);const P=new o.a8(g,{now:b,fadeDuration:s,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),R=P.crossFadingFactor();R===1&&R===this._crossFadingFactor||(d=!0,this._crossFadingFactor=R),this.style.update(P)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,showPadding:this.showPadding}),this.fire(new o.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.bc.mark(o.bd.load),this.fire(new o.k("load"))),this.style&&(this.style.hasTransitions()||d)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const m=this._sourcesDirty||this._styleDirty||this._placementDirty;return m||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new o.k("idle")),!this._loaded||this._fullyLoaded||m||(this._fullyLoaded=!0,o.bc.mark(o.bd.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var _;this._hash&&this._hash.remove();for(const d of this._controls)d.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),O.removeThrottleControl(this._imageQueueHandle),(_=this._resizeObserver)===null||_===void 0||_.disconnect();const s=this.painter.context.gl.getExtension("WEBGL_lose_context");s&&s.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),S.remove(this._canvasContainer),S.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),o.bc.clearMetrics(),this._removed=!0,this.fire(new o.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,M.frameAsync(this._frameRequest).then(_=>{o.bc.frame(_),this._frameRequest=null,this._render(_)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(_){this._showTileBoundaries!==_&&(this._showTileBoundaries=_,this._update())}get showPadding(){return!!this._showPadding}set showPadding(_){this._showPadding!==_&&(this._showPadding=_,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(_){this._showCollisionBoxes!==_&&(this._showCollisionBoxes=_,_?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(_){this._showOverdrawInspector!==_&&(this._showOverdrawInspector=_,this._update())}get repaint(){return!!this._repaint}set repaint(_){this._repaint!==_&&(this._repaint=_,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(_){this._vertices=_,this._update()}get version(){return su}getCameraTargetElevation(){return this.transform.elevation}},h.MapMouseEvent=pr,h.MapTouchEvent=Ul,h.MapWheelEvent=Ea,h.Marker=jl,h.NavigationControl=class{constructor(_){this._updateZoomButtons=()=>{const s=this._map.getZoom(),d=s===this._map.getMaxZoom(),m=s===this._map.getMinZoom();this._zoomInButton.disabled=d,this._zoomOutButton.disabled=m,this._zoomInButton.setAttribute("aria-disabled",d.toString()),this._zoomOutButton.setAttribute("aria-disabled",m.toString())},this._rotateCompassArrow=()=>{const s=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=s},this._setButtonTitle=(s,d)=>{const m=this._map._getUIString(`NavigationControl.${d}`);s.title=m,s.setAttribute("aria-label",m)},this.options=o.e({},qf,_),this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",s=>s.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",s=>this._map.zoomIn({},{originalEvent:s})),S.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",s=>this._map.zoomOut({},{originalEvent:s})),S.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",s=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:s}):this._map.resetNorth({},{originalEvent:s})}),this._compassIcon=S.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(_){return this._map=_,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new $f(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){S.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(_,s){const d=S.create("button",_,this._container);return d.type="button",d.addEventListener("click",s),d}},h.Popup=class extends o.E{constructor(_){super(),this.remove=()=>(this._content&&S.remove(this._content),this._container&&(S.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new o.k("close"))),this),this._onMouseUp=s=>{this._update(s.point)},this._onMouseMove=s=>{this._update(s.point)},this._onDrag=s=>{this._update(s.point)},this._update=s=>{var d;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=S.create("div","maplibregl-popup",this._map.getContainer()),this._tip=S.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const R of this.options.className.split(" "))this._container.classList.add(R);this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?Sh(this._lngLat,this._flatPos,this._map.transform):(d=this._lngLat)===null||d===void 0?void 0:d.wrap(),this._trackPointer&&!s)return;const m=this._flatPos=this._pos=this._trackPointer&&s?s:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&s?s:this._map.transform.locationPoint(this._lngLat));let g=this.options.anchor;const b=Jf(this.options.offset);if(!g){const R=this._container.offsetWidth,D=this._container.offsetHeight;let H;H=m.y+b.bottom.y<D?["top"]:m.y>this._map.transform.height-D?["bottom"]:[],m.x<R/2?H.push("left"):m.x>this._map.transform.width-R/2&&H.push("right"),g=H.length===0?"bottom":H.join("-")}let P=m.add(b[g]);this.options.subpixelPositioning||(P=P.round()),S.setTransform(this._container,`${ou[g]} translate(${P.x}px,${P.y}px)`),Mh(this._container,g,"popup")},this._onClose=()=>{this.remove()},this.options=o.e(Object.create(Yf),_)}addTo(_){return this._map&&this.remove(),this._map=_,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new o.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(_){return this._lngLat=o.M.convert(_),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(_){return this.setDOMContent(document.createTextNode(_))}setHTML(_){const s=document.createDocumentFragment(),d=document.createElement("body");let m;for(d.innerHTML=_;m=d.firstChild,m;)s.appendChild(m);return this.setDOMContent(s)}getMaxWidth(){var _;return(_=this._container)===null||_===void 0?void 0:_.style.maxWidth}setMaxWidth(_){return this.options.maxWidth=_,this._update(),this}setDOMContent(_){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=S.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(_),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(_){this._container&&this._container.classList.add(_)}removeClassName(_){this._container&&this._container.classList.remove(_)}setOffset(_){return this.options.offset=_,this._update(),this}toggleClassName(_){if(this._container)return this._container.classList.toggle(_)}setSubpixelPositioning(_){this.options.subpixelPositioning=_}_createCloseButton(){this.options.closeButton&&(this._closeButton=S.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const _=this._container.querySelector(Kf);_&&_.focus()}},h.RasterDEMTileSource=st,h.RasterTileSource=le,h.ScaleControl=class{constructor(_){this._onMove=()=>{Th(this._map,this._container,this.options)},this.setUnit=s=>{this.options.unit=s,Th(this._map,this._container,this.options)},this.options=o.e({},Zf,_)}getDefaultPosition(){return"bottom-left"}onAdd(_){return this._map=_,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-scale",_.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){S.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},h.ScrollZoomHandler=Uf,h.Style=eo,h.TerrainControl=class{constructor(_){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=_}onAdd(_){return this._map=_,this._container=S.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=S.create("button","maplibregl-ctrl-terrain",this._container),S.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){S.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},h.TwoFingersTouchPitchHandler=Im,h.TwoFingersTouchRotateHandler=Bf,h.TwoFingersTouchZoomHandler=vh,h.TwoFingersTouchZoomRotateHandler=pn,h.VectorTileSource=ie,h.VideoSource=_n,h.addSourceType=(_,s)=>o._(void 0,void 0,void 0,function*(){if(xn(_))throw new Error(`A source type called "${_}" already exists.`);((d,m)=>{hn[d]=m})(_,s)}),h.clearPrewarmedResources=function(){const _=Ft;_&&(_.isPreloaded()&&_.numActive()===1?(_.release(Cn),Ft=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},h.getMaxParallelImageRequests=function(){return o.a.MAX_PARALLEL_IMAGE_REQUESTS},h.getRTLTextPluginStatus=function(){return tn().getRTLTextPluginStatus()},h.getVersion=function(){return Fm},h.getWorkerCount=function(){return nt.workerCount},h.getWorkerUrl=function(){return o.a.WORKER_URL},h.importScriptInWorkers=function(_){return In().broadcast("importScript",_)},h.prewarm=function(){gn().acquire(Cn)},h.setMaxParallelImageRequests=function(_){o.a.MAX_PARALLEL_IMAGE_REQUESTS=_},h.setRTLTextPlugin=function(_,s){return tn().setRTLTextPlugin(_,s)},h.setWorkerCount=function(_){nt.workerCount=_},h.setWorkerUrl=function(_){o.a.WORKER_URL=_}});var l=t;return l})})(Z7);var bu=Z7.exports;function p$(n,e){const t=[];for(let i=0;i<n;i++)t.push(e(i));return t}let m$=class{constructor(e,t){ut(this,"canvas");ut(this,"gl");ut(this,"windGraph1");ut(this,"windGraph2");ut(this,"smudgeGraph1");ut(this,"smudgeGraph2");ut(this,"outGraph1");ut(this,"outGraph2");ut(this,"i",0);e.width=e.clientWidth,e.height=e.clientHeight;let i=e.getContext("webgl2");const r=new jy(i,{allowAlpha:!0}),l=e.width,h=e.height,o=2e3,p=p$(o,He=>[Math.random(),Math.random(),Math.random()]),v=new vo(i,{data:new Float32Array(p.flat()),changesOften:!0}),x=structuredClone(p),M=new vo(i,{data:new Float32Array(x.flat()),changesOften:!0}),S=[[1,1,0,1],[1,-1,0,1],[-1,1,0,1],[-1,1,0,1],[1,-1,0,1],[-1,-1,0,1]],A=new vo(i,{data:new Float32Array(S.flat()),changesOften:!1}),[L,F,k,C]=[t.tlMerc.x,t.tlMerc.y,t.brMerc.x,t.brMerc.y],V=[[k,C,0,1],[k,F,0,1],[L,C,0,1],[L,C,0,1],[k,F,0,1],[L,F,0,1]],O=new vo(i,{data:new Float32Array(V.flat()),changesOften:!1}),J=new mo(i,{width:l,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),ue=new mo(i,{width:l,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),Y=new mo(i,{width:l,height:h,type:"ubyte4",interpolate:"linear",edges:"clamp"}),Q=new kr(i,{image:t.speedImage}),xe=new Ra(r,{program:{vertexSource:`#version 300 es
                      in vec3 particles;              // [mercator.x, mercator.y, lifetime]
                      out vec3 particlesNew;          // [mercator.x, mercator.y, lifetime]
                      uniform mat4 projMatrix;        // mercator to clip-space
                      uniform mat4 projMatrixInv;     // clip-space to mercator
                      uniform sampler2D speedTexture;
                      uniform float time;
                      uniform float zoom;
                      uniform vec4 bbox;
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }
        
                      float rand(vec2 co) {
                        return fract(sin(dot(co, vec2(12.9898, 78.233))) * 43758.5453);
                      }
        
                      float zClipFromInverse(float xClip, float yClip) {
                        mat4 M = projMatrixInv;
                        return (- M[0][2] * xClip - M[1][2] * yClip - M[3][2]) / M[2][2];
                      }
        
                      // Or more generally, if zMerc !== 0:
                      float zClipFromInverseWithHeight(float xClip, float yClip, float zMerc) {
                        mat4 M = projMatrixInv;
                        float a = M[0][2] * xClip + M[1][2] * yClip + M[3][2]; 
                        float b = zMerc * ( M[0][3] * xClip + M[1][3] * yClip + M[3][3] );
                        float c = zMerc * M[2][3] - M[2][2];
                        return (a - b) / c;
                      }
        
                      void main() {
                          vec2 positionMerc = particles.xy;
                          float lifeTime = particles.z - 0.005;
                          
                          if (lifeTime < 0.0) {
                            float clipX = (rand(particles.xy) * 2.0 - 1.0) * 1.05;
                            float clipY = (rand(particles.yx) * 2.0 - 1.0) * 1.05;
                            float clipZ = zClipFromInverse(clipX, clipY);
                            vec4 randPointClip = vec4(clipX, clipY, clipZ, 1.0);
        
                            vec4 randPointMerc = projMatrixInv * randPointClip;
                            positionMerc.xy = randPointMerc.xy / randPointMerc.w;
                            lifeTime = 1.0;
                          }
        
                          gl_PointSize = 2.0;
                          vec4 speedMerc =  2.0 * texture(speedTexture, merc2uv(positionMerc.xy)) - 1.0;
                          vec4 updatedPositionMerc = vec4(positionMerc.xy, 0, 1) + 0.1 * speedMerc / (50.0 * zoom * zoom * zoom);
                          gl_Position = projMatrix * updatedPositionMerc;
                          particlesNew = vec3(updatedPositionMerc.xy, lifeTime);
                          // gl_Position = vec4(updatedPositionMerc.xy, 0, 1); <-- nothing
                          // gl_Position = vec4(positionMerc.xy, 0, 1); <-- something drawn before matrix is available, but fading.
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      out vec4 fragColor;
                      void main() {
                          fragColor = vec4(1, 0, 0, 1);
                      }
                  `},inputs:{attributes:{particles:{buffer:v,config:{type:"vec3",normalize:!1,nrInstances:0}}},textures:{speedTexture:Q},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},projMatrixInv:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},time:{type:"float",value:[0]},zoom:{type:"float",value:[0]},bbox:{type:"vec4",value:[L,F,k,C]}}},outputs:{transformFeedback:{data:{particlesNew:M},runFragmentShader:!0},frameBuffer:{textures:[J]}},settings:{drawingMode:"points",instanced:!1,nrVertices:o,viewport:[0,0,l,h]}}),re=new Ra(r,{...xe.config,program:xe.program,inputs:{...xe.config.inputs,attributes:{particles:{buffer:M,config:{type:"vec3",normalize:!1,nrInstances:0}}}},outputs:{...xe.config.outputs,transformFeedback:{data:{particlesNew:v},runFragmentShader:!0}}}),ee=new Ra(r,{program:{vertexSource:`#version 300 es
                in vec4 tposition;
                void main() {
                  gl_Position = vec4(tposition.x, tposition.y, 0, 1);
                }
              `,fragmentSource:`#version 300 es
                precision highp float;
                uniform sampler2D particlesTexture;
                uniform sampler2D smudgeTextureLast;
                uniform vec2 texSize;
                uniform bool isMoving;
                out vec4 fragColor;
                void main() {
                  vec2 uv = vec2(
                      gl_FragCoord.x / texSize.x, 
                      gl_FragCoord.y / texSize.y
                  );
                  vec4 lastColor = texture(smudgeTextureLast, uv);
                  lastColor *= 0.95;
                  vec4 particleColor = texture(particlesTexture, uv);
                  fragColor = particleColor + lastColor;
                  if (isMoving) fragColor = vec4(0,0,0,0);
                }
              `},inputs:{attributes:{tposition:{buffer:A,config:{normalize:!1,nrInstances:0,type:"vec4"}}},textures:{particlesTexture:J,smudgeTextureLast:ue},uniforms:{isMoving:{type:"bool",value:[0]},texSize:{type:"vec2",value:[l,h]}}},outputs:{frameBuffer:{textures:[Y]}},settings:{drawingMode:"triangles",instanced:!1,nrVertices:S.length,viewport:[0,0,l,h]}}),Me=new Ra(r,{...ee.config,program:ee.program,inputs:{...ee.config.inputs,textures:{particlesTexture:J,smudgeTextureLast:Y}},outputs:{...ee.config.outputs,frameBuffer:{textures:[ue]}}}),Fe=new Ra(r,{program:{vertexSource:`#version 300 es
                      in vec4 bboxPosMerc;
                      uniform mat4 projMatrix;
                      out vec2 positionMerc;
                      void main() {
                          gl_Position = projMatrix * vec4(bboxPosMerc.xy, 0, 1);  
                          positionMerc = bboxPosMerc.xy;
                      }
                  `,fragmentSource:`#version 300 es
                      precision highp float;
                      uniform sampler2D smudgedTexture;
                      uniform sampler2D speedTexture;
                      uniform vec4 bbox;
                      uniform vec2 texSize;
                      in vec2 positionMerc;
                      out highp vec4 fragColor;
        
                      vec2 currentClipUv() {
                        float u = gl_FragCoord.x / texSize.x;
                        float v = gl_FragCoord.y / texSize.y;
                        return vec2(u, v);
                      }
        
                      vec2 merc2uv(vec2 merc) {
                        // bbox: [left, top, right, bot]
                        float left = bbox[0];
                        float top = bbox[1];
                        float right = bbox[2];
                        float bot = bbox[3];
                        float u = (merc.x - left) / (right - left);
                        float v = (merc.y - top) / (bot - top);
                        return vec2(u, v);
                      }

                      vec3 colorRamp1 = vec3(0.07890625, 0.25546875, 0.4);
                      vec3 colorRamp2 = vec3(0.36015625, 0.2984375,  0.56015625);
                      vec3 colorRamp3 = vec3(0.653125,   0.18125,    0.29453125);

                      vec3 colorScale(float h) {
                        if (h < 0.5) {
                          float deg = 2.0 * h;
                          return mix(colorRamp1, colorRamp2, deg);
                        }
                        else {
                          float deg = (h - 0.5) * 2.0;
                          return mix(colorRamp2, colorRamp3, deg);
                        }
                      }
        
                      void main() {
                          vec2 uvSmudge = currentClipUv();
                          vec4 currentSmudge = texture(smudgedTexture, uvSmudge);
                          float p = currentSmudge.x;
                          vec3 particleColor = vec3(p);
                          
                          vec2 uvSpeed = merc2uv(positionMerc);
                          vec4 currentSpeed = texture(speedTexture, uvSpeed);
                          float magSpeed = length(currentSpeed) / 1.732; // 1.732: sqrt(1+1+1)
                          vec3 speedColor = colorScale(magSpeed);

                          fragColor = vec4(
                            max(particleColor.x, speedColor.x),
                            max(particleColor.y, speedColor.y),
                            max(particleColor.z, speedColor.z),
                            max(p, 0.3)
                          );

                          // if (p > 0.1) {
                          //   fragColor = vec4(particleColor.xyz, 1.0);
                          // } else {
                          //   fragColor = vec4(speedColor.xyz, 0.6);
                          // }
                          // fragColor = max(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0)
                          // );
                          // fragColor = mix(
                          //   vec4(speedColor.xyz, 0.8),
                          //   vec4(particleColor.xyz, 1.0),
                          //   p
                          // );
                          // fragColor = max(vec4(currentSmudge.x), vec4(magSpeed, 1.0 - magSpeed, 1.0 - magSpeed, 0.4));
                          // fragColor = vec4(currentSmudge.x) + vec4(0.1, 0.1, 0.1, 0.4);
                          // fragColor = vec4(currentSmudge.x) + currentSpeed;
                      }
              `},inputs:{attributes:{bboxPosMerc:{buffer:O,config:{type:"vec4",normalize:!1,nrInstances:0}}},uniforms:{projMatrix:{type:"mat4",value:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},bbox:{type:"vec4",value:[L,F,k,C]},texSize:{type:"vec2",value:[l,h]}},textures:{smudgedTexture:Y,speedTexture:Q}},outputs:{},settings:{drawingMode:"triangles",instanced:!1,nrVertices:V.length,viewport:[0,0,l,h]}}),Ae=new Ra(r,{...Fe.config,program:Fe.program,inputs:{...Fe.config.inputs,textures:{smudgedTexture:ue,speedTexture:Q}}});this.canvas=e,this.gl=i,this.windGraph1=xe,this.windGraph2=re,this.smudgeGraph1=ee,this.smudgeGraph2=Me,this.outGraph1=Fe,this.outGraph2=Ae}step(e){this.i%2===0?(this.windGraph1.updateUniform("projMatrix",e.matrix),this.windGraph1.updateUniform("projMatrixInv",e.invMatrix),this.windGraph1.updateUniform("time",[new Date().getTime()]),this.windGraph1.updateUniform("zoom",[e.zoom]),this.smudgeGraph1.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph1.updateUniform("projMatrix",e.matrix),this.outGraph1.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph1.draw([0,0,0,1]),this.smudgeGraph1.draw([0,0,0,1]),this.outGraph1.draw()):(this.windGraph2.updateUniform("projMatrix",e.matrix),this.windGraph2.updateUniform("projMatrixInv",e.invMatrix),this.windGraph2.updateUniform("time",[new Date().getTime()]),this.windGraph2.updateUniform("zoom",[e.zoom]),this.smudgeGraph2.updateUniform("isMoving",[e.isMoving?1:0]),this.smudgeGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.outGraph2.updateUniform("projMatrix",e.matrix),this.outGraph2.updateUniform("texSize",[this.canvas.clientWidth,this.canvas.clientHeight]),this.windGraph2.draw([0,0,0,1]),this.smudgeGraph2.draw([0,0,0,1]),this.outGraph2.draw()),this.i+=1}destroy(e){var t,i,r,l,h,o;(t=this.windGraph1)==null||t.destroy(e),(i=this.windGraph2)==null||i.destroy(e),(r=this.smudgeGraph1)==null||r.destroy(e),(l=this.smudgeGraph2)==null||l.destroy(e),(h=this.outGraph1)==null||h.destroy(e),(o=this.outGraph2)==null||o.destroy(e)}};const g$=8,y$="Dark Matter DLR",v$={"mapbox:autocomposite":!1,"mapbox:groups":{"101da9f13b64a08fa4b6ac1168e89e5f":{collapsed:!1,name:"Places"},a14c9607bc7954ba1df7205bf660433f:{name:"Boundaries"},b6371a3f2f5a9932464fa3867530a2e5:{collapsed:!1,name:"Transportation"}},"mapbox:type":"template","openmaptiles:mapbox:owner":"openmaptiles","openmaptiles:mapbox:source:url":"mapbox://openmaptiles.4qljc88t","openmaptiles:version":"3.x","maputnik:renderer":"mlgljs"},_$={openmaptiles:{type:"vector",tiles:["https://a.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://b.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true","https://c.tiles.geoservice.dlr.de/service/tms/1.0.0/planet_eoc@EPSG%3A900913@pbf/{z}/{x}/{y}.pbf?flipy=true"],minZoom:0,maxZoom:14}},x$="https://openmaptiles.github.io/dark-matter-gl-style/sprite",b$="https://orangemug.github.io/font-glyphs/glyphs/{fontstack}/{range}.pbf",w$=[{id:"background",type:"background",paint:{"background-color":"rgb(12,12,12)"}},{id:"water",type:"fill",source:"openmaptiles","source-layer":"water",filter:["all",["==","$type","Polygon"],["!=","brunnel","tunnel"]],layout:{visibility:"visible"},paint:{"fill-antialias":!1,"fill-color":"rgb(27 ,27 ,29)"}},{id:"landcover_ice_shelf",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","ice_shelf"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(12,12,12)","fill-opacity":.7}},{id:"landcover_glacier",type:"fill",source:"openmaptiles","source-layer":"landcover",maxzoom:8,filter:["all",["==","$type","Polygon"],["==","subclass","glacier"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 1%, 2%)","fill-opacity":{base:1,stops:[[0,1],[8,.5]]}}},{id:"landuse_residential",type:"fill",source:"openmaptiles","source-layer":"landuse",maxzoom:9,filter:["all",["==","$type","Polygon"],["==","class","residential"]],layout:{visibility:"visible"},paint:{"fill-color":"hsl(0, 2%, 5%)","fill-opacity":.4}},{id:"landcover_wood",type:"fill",source:"openmaptiles","source-layer":"landcover",minzoom:10,filter:["all",["==","$type","Polygon"],["==","class","wood"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)","fill-opacity":{base:.3,stops:[[8,0],[10,.8],[13,.4]]},"fill-pattern":"wood-pattern","fill-translate":[0,0]}},{id:"landuse_park",type:"fill",source:"openmaptiles","source-layer":"landuse",filter:["all",["==","$type","Polygon"],["==","class","park"]],layout:{visibility:"visible"},paint:{"fill-color":"rgb(32,32,32)"}},{id:"waterway",type:"line",source:"openmaptiles","source-layer":"waterway",filter:["==","$type","LineString"],layout:{visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)"}},{id:"water_name",type:"symbol",source:"openmaptiles","source-layer":"water_name",filter:["==","$type","LineString"],layout:{"symbol-placement":"line","symbol-spacing":500,"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Condensed Italic"],"text-rotation-alignment":"map","text-size":12},paint:{"text-color":"hsla(0, 0%, 0%, 0.7)","text-halo-color":"hsl(0, 0%, 27%)"}},{id:"building",type:"fill",source:"openmaptiles","source-layer":"building",minzoom:12,filter:["==","$type","Polygon"],paint:{"fill-antialias":!0,"fill-color":"rgb(10,10,10)","fill-outline-color":"rgb(27 ,27 ,29)"}},{id:"aeroway-taxiway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:12,filter:["all",["in","class","taxiway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":1,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"aeroway-runway-casing",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-opacity":1,"line-width":{base:1.5,stops:[[11,5],[17,55]]}}},{id:"aeroway-area",type:"fill",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:4,filter:["all",["==","$type","Polygon"],["in","class","runway","taxiway"]],layout:{visibility:"visible"},paint:{"fill-color":"#000","fill-opacity":1}},{id:"aeroway-runway",type:"line",metadata:{"mapbox:group":"1444849345966.4436"},source:"openmaptiles","source-layer":"aeroway",minzoom:11,filter:["all",["in","class","runway"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#000","line-opacity":1,"line-width":{base:1.5,stops:[[11,4],[17,50]]}}},{id:"road_area_pier",type:"fill",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","Polygon"],["==","class","pier"]],layout:{visibility:"visible"},paint:{"fill-antialias":!0,"fill-color":"rgb(12,12,12)"}},{id:"road_pier",type:"line",metadata:{},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["in","class","pier"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"rgb(12,12,12)","line-width":{base:1.2,stops:[[15,1],[17,4]]}}},{id:"highway_path",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",filter:["all",["==","$type","LineString"],["==","class","path"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(27 ,27 ,29)","line-dasharray":[1.5,1.5],"line-opacity":.9,"line-width":{base:1.2,stops:[[13,1],[20,10]]}}},{id:"highway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:8,filter:["all",["==","$type","LineString"],["in","class","minor","service","track"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-opacity":.9,"line-width":{base:1.55,stops:[[13,1.8],[20,20]]}}},{id:"highway_major_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[12,0],"line-width":{base:1.3,stops:[[10,3],[20,23]]}}},{id:"highway_major_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"hsl(0, 0%, 7%)","line-width":{base:1.3,stops:[[10,2],[20,20]]}}},{id:"highway_major_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,maxzoom:11,filter:["all",["==","$type","LineString"],["in","class","primary","secondary","tertiary","trunk"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#2a2a2a","line-width":{stops:[[6,0],[8,2]]}}},{id:"highway_motorway_casing",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"butt","line-join":"miter",visibility:"visible"},paint:{"line-color":"rgba(60,60,60,0.8)","line-dasharray":[2,0],"line-opacity":1,"line-width":{base:1.4,stops:[[5.8,0],[6,3],[20,40]]}}},{id:"highway_motorway_inner",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":{base:1,stops:[[5.8,"hsla(0, 0%, 85%, 0.53)"],[6,"#000"]]},"line-width":{base:1.4,stops:[[4,2],[6,1.3],[20,30]]}}},{id:"road_oneway",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":0,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"road_oneway_opposite",type:"symbol",source:"openmaptiles","source-layer":"transportation",minzoom:15,filter:["all",["==","oneway",-1]],layout:{"symbol-placement":"line","icon-image":"oneway","symbol-spacing":200,"icon-padding":2,"icon-rotation-alignment":"map","icon-rotate":180,"icon-size":{stops:[[15,.5],[19,1]]}},paint:{"icon-opacity":.5}},{id:"highway_motorway_subtle",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",maxzoom:6,filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-color":"#181818","line-width":{base:1.4,stops:[[4,2],[6,1.3]]}}},{id:"railway_transit",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_transit_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","transit"],["!in","brunnel","tunnel"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway_minor",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":3}},{id:"railway_minor_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:16,filter:["all",["==","$type","LineString"],["all",["==","class","rail"],["has","service"]]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":2}},{id:"railway",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(35,35,35)","line-width":{base:1.3,stops:[[16,3],[20,7]]}}},{id:"railway_dashline",type:"line",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation",minzoom:13,filter:["all",["==","$type","LineString"],["==","class","rail"],["!has","service"]],layout:{"line-join":"round",visibility:"visible"},paint:{"line-color":"rgb(12,12,12)","line-dasharray":[3,3],"line-width":{base:1.3,stops:[[16,2],[20,6]]}}},{id:"highway_name_other",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["!=","class","motorway"],["==","$type","LineString"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{name:latin} {name:nonlatin}","text-font":["Roboto Regular"],"text-max-angle":30,"text-pitch-alignment":"viewport","text-rotation-alignment":"map","text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgba(80, 78, 78, 1)","text-halo-blur":0,"text-halo-color":"rgba(0, 0, 0, 1)","text-halo-width":1,"text-translate":[0,0]}},{id:"highway_name_motorway",type:"symbol",metadata:{"mapbox:group":"b6371a3f2f5a9932464fa3867530a2e5"},source:"openmaptiles","source-layer":"transportation_name",filter:["all",["==","$type","LineString"],["==","class","motorway"]],layout:{"symbol-placement":"line","symbol-spacing":350,"text-field":"{ref}","text-font":["Roboto Light"],"text-pitch-alignment":"viewport","text-rotation-alignment":"viewport","text-size":10,visibility:"visible"},paint:{"text-color":"hsl(0, 0%, 37%)","text-translate":[0,2]}},{id:"boundary_state",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",filter:["==","admin_level",4],layout:{"line-cap":"round","line-join":"round",visibility:"visible"},paint:{"line-blur":.4,"line-color":"hsl(0, 0%, 21%)","line-dasharray":[2,2],"line-opacity":1,"line-width":{base:1.3,stops:[[3,1],[22,15]]}}},{id:"boundary_country_z0-4",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",maxzoom:5,filter:["all",["==","admin_level",2],["!has","claimed_by"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"boundary_country_z5-",type:"line",metadata:{"mapbox:group":"a14c9607bc7954ba1df7205bf660433f"},source:"openmaptiles","source-layer":"boundary",minzoom:5,filter:["==","admin_level",2],layout:{"line-cap":"round","line-join":"round"},paint:{"line-blur":{base:1,stops:[[0,.4],[22,4]]},"line-color":"hsl(0, 0%, 23%)","line-opacity":1,"line-width":{base:1.1,stops:[[3,1],[22,20]]}}},{id:"place_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["in","class","hamlet","isolated_dwelling","neighbourhood"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_suburb",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","suburb"]],layout:{"text-anchor":"center","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"center","text-offset":[.5,0],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_village",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","village"]],layout:{"icon-size":.4,"text-anchor":"left","text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_town",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:15,filter:["all",["==","$type","Point"],["==","class","town"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:14,filter:["all",["==","$type","Point"],["==","class","city"],[">","rank",3]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_city_large",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["<=","rank",3],["==","class","city"]],layout:{"icon-image":{base:1,stops:[[0,"circle-11"],[9,""]]},"icon-size":.4,"text-anchor":{base:1,stops:[[0,"left"],[8,"center"]]},"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-justify":"left","text-offset":[.5,.2],"text-size":14,"text-transform":"uppercase",visibility:"visible"},paint:{"icon-opacity":.7,"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_state",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:12,filter:["all",["==","$type","Point"],["==","class","state"]],layout:{"text-field":`{name:latin}
{name:nonlatin}`,"text-font":["Roboto Regular"],"text-size":10,"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-blur":1,"text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1}},{id:"place_country_other",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],["!has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Condensed Italic"],"text-size":{base:1,stops:[[0,9],[1,11]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_minor",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:8,filter:["all",["==","$type","Point"],["==","class","country"],[">=","rank",2],["has","iso_a2"]],layout:{"text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1,stops:[[0,10],[6,12]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}},{id:"place_country_major",type:"symbol",metadata:{"mapbox:group":"101da9f13b64a08fa4b6ac1168e89e5f"},source:"openmaptiles","source-layer":"place",maxzoom:6,filter:["all",["==","$type","Point"],["<=","rank",1],["==","class","country"],["has","iso_a2"]],layout:{"text-anchor":"center","text-field":"{name:latin}","text-font":["Roboto Regular"],"text-size":{base:1.4,stops:[[0,10],[3,12],[4,14]]},"text-transform":"uppercase",visibility:"visible"},paint:{"text-color":"rgb(101,101,101)","text-halo-color":"rgba(0,0,0,0.7)","text-halo-width":1.4}}],S$="dark-matter",M$={version:g$,name:y$,metadata:v$,sources:_$,sprite:x$,glyphs:b$,layers:w$,id:S$};class T${constructor(){ut(this,"container");ut(this,"overlay");ut(this,"looper");ut(this,"ws");ut(this,"map");ut(this,"destroyed",!1);ut(this,"zoom",1);ut(this,"movingTimeout");ut(this,"isMoving",!1);ut(this,"matrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);ut(this,"invMatrix",[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}async init(e,t){t.width=t.clientWidth,t.height=t.clientHeight,this.container=e,this.overlay=t;const i=52.99489512738211,r=55.20539216798002,l=6.787129861958135,h=12.989942944851833;this.map=new bu.Map({container:e,style:M$,center:new bu.LngLat((h-l)/2+l,(r-i)/2+i),maxZoom:11,minZoom:6,maxBounds:new bu.LngLatBounds(new bu.LngLat(l-1,i-1),new bu.LngLat(h+1,r+1)),zoom:8,bearing:15,pitch:30});const o=new bu.LngLat(l,r),p=new bu.LngLat(h,i),v=this.map.transform.locationCoordinate(o),x=this.map.transform.locationCoordinate(p),M=await kr.loadImage("/wind_map.jpg");this.ws=new m$(t,{tlMerc:v,brMerc:x,speedImage:M}),this.looper=new qp(30,()=>{var S;(S=this.ws)==null||S.step({zoom:this.zoom,isMoving:this.isMoving,matrix:this.matrix,invMatrix:this.invMatrix})}),this.map.addLayer({id:"windSim",type:"custom",render:(S,A)=>{this.matrix=Array.from(A),this.invMatrix=Array.from(f$(d$(),A)),this.map&&(this.zoom=this.map.getZoom()),this.isMoving=!0,this.movingTimeout&&(clearTimeout(this.movingTimeout),this.movingTimeout=void 0),this.movingTimeout=setTimeout(()=>this.isMoving=!1,100)}}),this.startLoop()}startLoop(){var e;!this.container||!this.overlay||(e=this.looper)==null||e.startLoop()}stopLoop(){var e;(e=this.looper)==null||e.stopLoop()}destroy(){this.stopLoop(),this.ws&&this.ws.destroy(!0),this.map&&this.map.remove(),this.overlay=void 0,this.container=void 0,this.destroyed=!0}}function E$(){const n=gt.useRef(null),e=gt.useRef(null);return gt.useEffect(()=>{const t=new T$;return n.current&&e.current&&t.init(n.current,e.current),()=>t.destroy()},[n.current,e.current]),ge.jsx("div",{ref:n,style:{width:"100%",height:"100%"},children:ge.jsx("canvas",{ref:e,style:{width:"100%",height:"100%",position:"absolute",zIndex:1,top:0,left:0,pointerEvents:"none"}})})}function A$(){return ge.jsxs(X7,{bgImg:"/turbine_img.jpg",title:"Wind visualization",subTitle:"Scaling to thousands of points",logo:ge.jsxs("svg",{id:"fullBuilding",width:"100%",height:"100%",viewBox:"0 0 100 200",children:[ge.jsx("rect",{x:"47.5",y:"70",width:"5",height:"100",fill:"black"}),ge.jsx("rect",{x:"45",y:"70",width:"10",height:"8",fill:"black"}),ge.jsxs("svg",{id:"fullRotor",x:"0",y:"20",width:"100",height:"100",viewBox:"0 0 100 100",children:[ge.jsx("defs",{children:ge.jsx("path",{id:"blade",d:"M 0,50 C 9,40, 0,30, 0,0 Z",fill:"black"})}),ge.jsxs("g",{transform:"rotate(10 50 50)",children:[ge.jsx("svg",{x:"45",y:"45",width:"10",height:"10",viewBox:"0 0 100 100",children:ge.jsx("g",{transform:"rotate(15 50 50)",children:ge.jsx("path",{d:"M 50 0 L 93.3 75 L 6.7 75 Z",fill:"black"})})}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:""}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(120 50 50)"}),ge.jsx("use",{href:"#blade",x:"50",y:"0",transform:"rotate(240 50 50)"}),ge.jsx("circle",{cx:"50",cy:"50",r:"2.5",fill:"black"})]})]})]}),children:[ge.jsx("p",{style:{margin:"2rem"},children:"Using particles is a highly readable and intuitive way of displaying wind speed and development. Such a visualization has the highest impact only with many hundreds or thousands of individual particles - which is not realistically possible on standard CPUs."}),ge.jsx("p",{style:{margin:"2rem"},children:"Here we've build custom glsl-shaders to simulate thousands of particles at a time. This way, your main site remains responsive, while the heavy lifting has been outsourced to the GPU."}),ge.jsx("div",{style:{width:"100%",aspectRatio:"3/2"},children:ge.jsx(E$,{})}),ge.jsx("p",{style:{margin:"2rem"},children:"The above example has been written for use in maplibre, but can be adjusted for other mapping libraries such as openlayers."})]})}const C$=Rk([{path:"/",element:ge.jsx(AD,{}),errorElement:ge.jsx(gD,{}),children:[{path:"/",element:ge.jsx(MD,{})},{path:"/contact",element:ge.jsx(mD,{})},{path:"/swe",element:ge.jsx(h$,{})},{path:"/wind",element:ge.jsx(A$,{})},{path:"/imprint",element:ge.jsx(CD,{})},{path:"/resources",element:ge.jsx(XU,{})},{path:"/math",element:ge.jsx(o$,{})}]}]);Vx.createRoot(document.getElementById("root")).render(ge.jsx(a6.StrictMode,{children:ge.jsx(Bk,{router:C$})}));
