(()=>{var t={551:t=>{var e={utf8:{stringToBytes:function(t){return e.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(e.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],r=0;r<t.length;r++)e.push(255&t.charCodeAt(r));return e},bytesToString:function(t){for(var e=[],r=0;r<t.length;r++)e.push(String.fromCharCode(t[r]));return e.join("")}}};t.exports=e},816:t=>{var e,r;e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",r={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&r.rotl(t,8)|4278255360&r.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=r.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],r=0,a=0;r<t.length;r++,a+=8)e[a>>>5]|=t[r]<<24-a%32;return e},wordsToBytes:function(t){for(var e=[],r=0;r<32*t.length;r+=8)e.push(t[r>>>5]>>>24-r%32&255);return e},bytesToHex:function(t){for(var e=[],r=0;r<t.length;r++)e.push((t[r]>>>4).toString(16)),e.push((15&t[r]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],r=0;r<t.length;r+=2)e.push(parseInt(t.substr(r,2),16));return e},bytesToBase64:function(t){for(var r=[],a=0;a<t.length;a+=3)for(var o=t[a]<<16|t[a+1]<<8|t[a+2],n=0;n<4;n++)8*a+6*n<=8*t.length?r.push(e.charAt(o>>>6*(3-n)&63)):r.push("=");return r.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var r=[],a=0,o=0;a<t.length;o=++a%4)0!=o&&r.push((e.indexOf(t.charAt(a-1))&Math.pow(2,-2*o+8)-1)<<2*o|e.indexOf(t.charAt(a))>>>6-2*o);return r}},t.exports=r},512:t=>{function e(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}t.exports=function(t){return null!=t&&(e(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&e(t.slice(0,0))}(t)||!!t._isBuffer)}},392:(t,e,r)=>{var a,o,n,i,s;a=r(816),o=r(551).utf8,n=r(512),i=r(551).bin,(s=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?i.stringToBytes(t):o.stringToBytes(t):n(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||t.constructor===Uint8Array||(t=t.toString());for(var r=a.bytesToWords(t),u=8*t.length,h=1732584193,c=-271733879,d=-1732584194,f=271733878,l=0;l<r.length;l++)r[l]=16711935&(r[l]<<8|r[l]>>>24)|4278255360&(r[l]<<24|r[l]>>>8);r[u>>>5]|=128<<u%32,r[14+(u+64>>>9<<4)]=u;var b=s._ff,m=s._gg,g=s._hh,v=s._ii;for(l=0;l<r.length;l+=16){var p=h,T=c,E=d,x=f;h=b(h,c,d,f,r[l+0],7,-680876936),f=b(f,h,c,d,r[l+1],12,-389564586),d=b(d,f,h,c,r[l+2],17,606105819),c=b(c,d,f,h,r[l+3],22,-1044525330),h=b(h,c,d,f,r[l+4],7,-176418897),f=b(f,h,c,d,r[l+5],12,1200080426),d=b(d,f,h,c,r[l+6],17,-1473231341),c=b(c,d,f,h,r[l+7],22,-45705983),h=b(h,c,d,f,r[l+8],7,1770035416),f=b(f,h,c,d,r[l+9],12,-1958414417),d=b(d,f,h,c,r[l+10],17,-42063),c=b(c,d,f,h,r[l+11],22,-1990404162),h=b(h,c,d,f,r[l+12],7,1804603682),f=b(f,h,c,d,r[l+13],12,-40341101),d=b(d,f,h,c,r[l+14],17,-1502002290),h=m(h,c=b(c,d,f,h,r[l+15],22,1236535329),d,f,r[l+1],5,-165796510),f=m(f,h,c,d,r[l+6],9,-1069501632),d=m(d,f,h,c,r[l+11],14,643717713),c=m(c,d,f,h,r[l+0],20,-373897302),h=m(h,c,d,f,r[l+5],5,-701558691),f=m(f,h,c,d,r[l+10],9,38016083),d=m(d,f,h,c,r[l+15],14,-660478335),c=m(c,d,f,h,r[l+4],20,-405537848),h=m(h,c,d,f,r[l+9],5,568446438),f=m(f,h,c,d,r[l+14],9,-1019803690),d=m(d,f,h,c,r[l+3],14,-187363961),c=m(c,d,f,h,r[l+8],20,1163531501),h=m(h,c,d,f,r[l+13],5,-1444681467),f=m(f,h,c,d,r[l+2],9,-51403784),d=m(d,f,h,c,r[l+7],14,1735328473),h=g(h,c=m(c,d,f,h,r[l+12],20,-1926607734),d,f,r[l+5],4,-378558),f=g(f,h,c,d,r[l+8],11,-2022574463),d=g(d,f,h,c,r[l+11],16,1839030562),c=g(c,d,f,h,r[l+14],23,-35309556),h=g(h,c,d,f,r[l+1],4,-1530992060),f=g(f,h,c,d,r[l+4],11,1272893353),d=g(d,f,h,c,r[l+7],16,-155497632),c=g(c,d,f,h,r[l+10],23,-1094730640),h=g(h,c,d,f,r[l+13],4,681279174),f=g(f,h,c,d,r[l+0],11,-358537222),d=g(d,f,h,c,r[l+3],16,-722521979),c=g(c,d,f,h,r[l+6],23,76029189),h=g(h,c,d,f,r[l+9],4,-640364487),f=g(f,h,c,d,r[l+12],11,-421815835),d=g(d,f,h,c,r[l+15],16,530742520),h=v(h,c=g(c,d,f,h,r[l+2],23,-995338651),d,f,r[l+0],6,-198630844),f=v(f,h,c,d,r[l+7],10,1126891415),d=v(d,f,h,c,r[l+14],15,-1416354905),c=v(c,d,f,h,r[l+5],21,-57434055),h=v(h,c,d,f,r[l+12],6,1700485571),f=v(f,h,c,d,r[l+3],10,-1894986606),d=v(d,f,h,c,r[l+10],15,-1051523),c=v(c,d,f,h,r[l+1],21,-2054922799),h=v(h,c,d,f,r[l+8],6,1873313359),f=v(f,h,c,d,r[l+15],10,-30611744),d=v(d,f,h,c,r[l+6],15,-1560198380),c=v(c,d,f,h,r[l+13],21,1309151649),h=v(h,c,d,f,r[l+4],6,-145523070),f=v(f,h,c,d,r[l+11],10,-1120210379),d=v(d,f,h,c,r[l+2],15,718787259),c=v(c,d,f,h,r[l+9],21,-343485551),h=h+p>>>0,c=c+T>>>0,d=d+E>>>0,f=f+x>>>0}return a.endian([h,c,d,f])})._ff=function(t,e,r,a,o,n,i){var s=t+(e&r|~e&a)+(o>>>0)+i;return(s<<n|s>>>32-n)+e},s._gg=function(t,e,r,a,o,n,i){var s=t+(e&a|r&~a)+(o>>>0)+i;return(s<<n|s>>>32-n)+e},s._hh=function(t,e,r,a,o,n,i){var s=t+(e^r^a)+(o>>>0)+i;return(s<<n|s>>>32-n)+e},s._ii=function(t,e,r,a,o,n,i){var s=t+(r^(e|~a))+(o>>>0)+i;return(s<<n|s>>>32-n)+e},s._blocksize=16,s._digestsize=16,t.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var r=a.wordsToBytes(s(t,e));return e&&e.asBytes?r:e&&e.asString?i.bytesToString(r):a.bytesToHex(r)}}},e={};function r(a){var o=e[a];if(void 0!==o)return o.exports;var n=e[a]={exports:{}};return t[a](n,n.exports,r),n.exports}r.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return r.d(e,{a:e}),e},r.d=(t,e)=>{for(var a in e)r.o(e,a)&&!r.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},r.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t=r(392),e=r.n(t);const a=(t,e)=>((t,e)=>Math.log(t)/Math.log(e))(t,e)%1==0,o=t=>{const e=t.length,r=t[0].length,a=Array(e*r);let o=0;for(let n=0;n<e;n++)for(let e=0;e<r;e++)a[o]=t[n][e],o++;return a},n=t=>{const e=t.length,r=t[0].length,a=t[0][0].length,o=Array(e*r*a);let n=0;for(let i=0;i<e;i++)for(let e=0;e<r;e++)for(let r=0;r<a;r++)o[n]=t[i][e][r],n++;return o},i={};function s(t,e){if(e in i)return i[e];{const r=t.getExtension(e);if(!r)throw Error(`couldn't get extension ${e}`);return i[e]=r,r}}const u=(t,e,r)=>{const a=t.createShader(e);if(!a)throw new Error("No shader was created");if(t.shaderSource(a,r),t.compileShader(a),!t.getShaderParameter(a,t.COMPILE_STATUS))throw t.deleteShader(a),new Error(`An error occurred compiling the shader: ${t.getShaderInfoLog(a)}.    \n\n Shader code: ${r}`);return a},h=(t,e)=>{t.useProgram(e)},c=(t,e)=>{s(t,"OES_vertex_array_object").bindVertexArrayOES(e.vao)},d=(t,e,r)=>{switch(e){case"ubyte4":return{internalFormat:t.RGBA,format:t.RGBA,type:t.UNSIGNED_BYTE,binData:new Uint8Array(r)};case"float4":return{internalFormat:t.RGBA,format:t.RGBA,type:t.FLOAT,binData:new Float32Array(r)}}},f=function(t){return e()(t)};class l{constructor(t,e,r){this.data=t,this.attributeType=e,this.changesOften=r,this.hash=f(t+""+e+r+Math.random())}upload(t){this.buffer=((t,e,r,a=!1)=>{const o=t.createBuffer();if(!o)throw new Error("No buffer was created");return t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,r,a?t.DYNAMIC_DRAW:t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),{buffer:o,dataPointType:t.FLOAT,staticOrDynamicDraw:a?t.DYNAMIC_DRAW:t.STATIC_DRAW,attributeType:e}})(t,this.attributeType,this.data,this.changesOften)}bind(t,e,r){if(!this.buffer)throw Error("No value set for AttributeData");return r=((t,e,r,a)=>(s(t,"OES_vertex_array_object").bindVertexArrayOES(a.vao),((t,e,r,a=0)=>{const o=s(t,"ANGLE_instanced_arrays");t.bindBuffer(t.ARRAY_BUFFER,r.buffer),t.enableVertexAttribArray(e);const n=((t,e)=>{switch(e){case t.FLOAT:return 4;case t.BYTE:case t.SHORT:case t.UNSIGNED_BYTE:case t.UNSIGNED_SHORT:default:throw new Error(`Unknown type ${e}`)}})(t,r.dataPointType);switch(r.attributeType){case"float":t.enableVertexAttribArray(e),t.vertexAttribPointer(e,1,r.dataPointType,!1,1*n,0),a&&o.vertexAttribDivisorANGLE(e,a);break;case"vec2":t.enableVertexAttribArray(e),t.vertexAttribPointer(e,2,r.dataPointType,!1,2*n,0),a&&o.vertexAttribDivisorANGLE(e,a);break;case"vec3":t.enableVertexAttribArray(e),t.vertexAttribPointer(e,3,r.dataPointType,!1,3*n,0),a&&o.vertexAttribDivisorANGLE(e,a);break;case"vec4":t.enableVertexAttribArray(e),t.vertexAttribPointer(e,4,r.dataPointType,!1,4*n,0),a&&o.vertexAttribDivisorANGLE(e,a);break;case"mat2":t.enableVertexAttribArray(e+0),t.vertexAttribPointer(e+0,2,r.dataPointType,!1,4*n,0*n),a&&o.vertexAttribDivisorANGLE(e,a),t.enableVertexAttribArray(e+1),t.vertexAttribPointer(e+1,2,r.dataPointType,!1,4*n,2*n),a&&o.vertexAttribDivisorANGLE(e+1,a);break;case"mat3":t.enableVertexAttribArray(e+0),t.vertexAttribPointer(e+0,3,r.dataPointType,!1,9*n,0*n),a&&o.vertexAttribDivisorANGLE(e,a),t.enableVertexAttribArray(e+1),t.vertexAttribPointer(e+1,3,r.dataPointType,!1,9*n,3*n),a&&o.vertexAttribDivisorANGLE(e+1,a),t.enableVertexAttribArray(e+2),t.vertexAttribPointer(e+2,3,r.dataPointType,!1,9*n,6*n),a&&o.vertexAttribDivisorANGLE(e+2,a);break;case"mat4":t.enableVertexAttribArray(e+0),t.vertexAttribPointer(e+0,4,r.dataPointType,!1,16*n,0*n),a&&o.vertexAttribDivisorANGLE(e,a),t.enableVertexAttribArray(e+1),t.vertexAttribPointer(e+1,4,r.dataPointType,!1,16*n,4*n),a&&o.vertexAttribDivisorANGLE(e+1,a),t.enableVertexAttribArray(e+2),t.vertexAttribPointer(e+2,4,r.dataPointType,!1,16*n,8*n),a&&o.vertexAttribDivisorANGLE(e+2,a),t.enableVertexAttribArray(e+3),t.vertexAttribPointer(e+3,4,r.dataPointType,!1,16*n,12*n),a&&o.vertexAttribDivisorANGLE(e+3,a)}})(t,e,r),a.buffers.push(r),a))(t,e,this.buffer,r),r}update(t,e){this.data=e,this.buffer=((t,e,r)=>(t.bindBuffer(t.ARRAY_BUFFER,e.buffer),t.bufferData(t.ARRAY_BUFFER,r,e.staticOrDynamicDraw),t.bindBuffer(t.ARRAY_BUFFER,null),{buffer:e.buffer,dataPointType:t.FLOAT,staticOrDynamicDraw:e.staticOrDynamicDraw,attributeType:e.attributeType}))(t,this.buffer,this.data)}}class b{constructor(t,e){this.uniformType=t,this.value=e,this.hash=f(e+""+t)}upload(t){}bind(t,e){((t,e,r,a)=>{switch(r){case"bool":case"int":t.uniform1i(e,a[0]);break;case"bvec2":case"ivec2":t.uniform2i(e,a[0],a[1]);break;case"bvec3":case"ivec3":t.uniform3i(e,a[0],a[1],a[2]);break;case"bvec4":case"ivec4":t.uniform4i(e,a[0],a[1],a[2],a[3]);break;case"bool[]":case"int[]":t.uniform1iv(e,a);break;case"bvec2[]":case"ivec2[]":t.uniform2iv(e,a);break;case"bvec3[]":case"ivec3[]":t.uniform3iv(e,a);break;case"bvec4[]":case"ivec4[]":t.uniform4iv(e,a);break;case"float":t.uniform1f(e,a[0]);break;case"vec2":t.uniform2f(e,a[0],a[1]);break;case"vec3":t.uniform3f(e,a[0],a[1],a[2]);break;case"vec4":t.uniform4f(e,a[0],a[1],a[2],a[3]);break;case"float[]":t.uniform1fv(e,a);break;case"vec2[]":t.uniform2fv(e,a);break;case"vec3[]":t.uniform3fv(e,a);break;case"vec4[]":t.uniform4fv(e,a);break;case"mat2":t.uniformMatrix2fv(e,!1,a);break;case"mat3":t.uniformMatrix3fv(e,!1,a);break;case"mat4":t.uniformMatrix4fv(e,!1,a);break;default:throw Error(`Type ${r} not implemented.`)}})(t,e,this.uniformType,this.value)}update(t,e,r){this.value=e,this.bind(t,r)}}class m{constructor(t,e){this.data=t,this.hash=this.makeHash(t),this.textureDataType=e}upload(t){this.data instanceof HTMLImageElement||this.data instanceof HTMLCanvasElement?this.texture=((t,e)=>{const r=t.createTexture();if(!r)throw new Error("No texture was created");t.activeTexture(t.TEXTURE0+7),t.bindTexture(t.TEXTURE_2D,r);const o=t.RGBA,n=t.RGBA,i=t.UNSIGNED_BYTE;let s,u;return t.texImage2D(t.TEXTURE_2D,0,o,n,i,e),a(e.width,2)&&a(e.height,2)?t.generateMipmap(t.TEXTURE_2D):console.warn("Not a power-of-two image: ",e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.bindTexture(t.TEXTURE_2D,null),e instanceof HTMLImageElement?(s=e.naturalWidth,u=e.naturalHeight):(s=e.width,u=e.height),{textureType:"ubyte4",texture:r,level:0,internalformat:o,format:n,type:i,width:s,height:u,border:0}})(t,this.data):this.data instanceof Array?this.texture=((t,e,r="ubyte4")=>{const o=e.length,i=e[0].length,u=e[0][0].length;if(!a(o,2)||!a(i,2))throw new Error("Expecting texture to have a power-two width and height");const h=t.createTexture();if(!h)throw new Error("No texture was created");t.activeTexture(t.TEXTURE0+7),t.bindTexture(t.TEXTURE_2D,h);const c=d(t,r,n(e));if("float4"===r&&(s(t,"OES_texture_float"),s(t,"WEBGL_color_buffer_float")),4!==u){const e=1;t.pixelStorei(t.UNPACK_ALIGNMENT,e)}return t.texImage2D(t.TEXTURE_2D,0,c.internalFormat,i,o,0,c.format,c.type,c.binData),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,null),{textureType:r,texture:h,level:0,internalformat:c.internalFormat,format:c.format,type:c.type,width:i,height:o,border:0}})(t,this.data,this.textureDataType):this.texture=this.data}bind(t,e,r){if(!this.texture)throw new Error("No texture for TextureData");((t,e,r,a)=>{if(r>t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS))throw new Error(`There are only ${t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS)} texture bind points, but you tried to bind to point nr. ${r}.`);7===r&&console.error(`You are about to bind to the dedicated texture-construction bind point (nr. ${r}).\n        If after this call another texture is built, your shader will now use that new texture instead of this one!\n        Consider using another bind point.`),t.activeTexture(t.TEXTURE0+r),t.bindTexture(t.TEXTURE_2D,e),t.uniform1i(a,r)})(t,this.texture.texture,r,e)}update(t,e){this.data=e;const r=this.texture;return e.texture?this.texture=e:this.texture=((t,e,r)=>{if(t.activeTexture(t.TEXTURE0+7),t.bindTexture(t.TEXTURE_2D,e.texture),r instanceof HTMLImageElement||r instanceof HTMLCanvasElement)t.texImage2D(t.TEXTURE_2D,0,e.internalformat,e.format,e.type,r),t.generateMipmap(t.TEXTURE_2D);else{const o=r[0].length,i=r.length;if(!a(o,2)||!a(i,2))throw new Error(`Texture-data-dimensions must be a power of two, but are ${i} x ${o}`);const s=d(t,e.textureType,n(r));t.texImage2D(t.TEXTURE_2D,e.level,e.internalformat,e.width,e.height,e.border,e.format,e.type,s.binData)}return t.bindTexture(t.TEXTURE_2D,null),r instanceof HTMLImageElement?(e.width=r.naturalWidth,e.height=r.naturalHeight):r instanceof HTMLCanvasElement?(e.width=r.width,e.height=r.height):(e.width=r[0].length,e.height=r.length),e})(t,this.texture,e),r}makeHash(t){if(Array.isArray(t))return f(t.flat().flat());if(t instanceof HTMLImageElement){if(t.src)return f(t.src);const e=document.createElement("canvas"),r=e.getContext("2d");e.width=t.width,e.height=t.height,r.drawImage(t,0,0);const a=r.getImageData(0,0,t.width,t.height);return f(a.data)}if(t instanceof HTMLCanvasElement){const e=t.getContext("2d").getImageData(0,0,t.width,t.height);return f(e.data)}return f(1e11*Math.random()+"")}}class g{constructor(t,e){this.vertexShaderSource=t,this.fragmentShaderSource=e,this.attributeLocations={},this.uniformLocations={},this.hash=f(t+e)}upload(t){this.program=((t,e,r)=>{const a=t.createProgram();if(!a)throw new Error("No program was created");const o=u(t,t.VERTEX_SHADER,e),n=u(t,t.FRAGMENT_SHADER,r);if(t.attachShader(a,o),t.attachShader(a,n),t.linkProgram(a),t.detachShader(a,o),t.detachShader(a,n),t.deleteShader(o),t.deleteShader(n),!t.getProgramParameter(a,t.LINK_STATUS))throw t.deleteProgram(a),new Error("Unable to initialize the shader program: "+t.getProgramInfoLog(a));return a})(t,this.vertexShaderSource,this.fragmentShaderSource)}bind(t){this.program||this.upload(t),h(t,this.program)}getUniformLocation(t,e){if(!this.uniformLocations[e]){const r=((t,e,r)=>{const a=t.getUniformLocation(e,r);if(null===a)throw new Error(`Couldn't find uniform ${r} in program.`);return a})(t,this.program,e);this.uniformLocations[e]=r}return this.uniformLocations[e]}getAttributeLocation(t,e){if(!this.attributeLocations[e]){const r=((t,e,r)=>{const a=t.getAttribLocation(e,r);if(-1===a)throw new Error(`Couldn't find attribute ${r} in program.`);return a})(t,this.program,e);this.attributeLocations[e]=r}return this.attributeLocations[e]}getTextureLocation(t,e){return this.getUniformLocation(t,e)}}class v{loadedPrograms=[];loadedAttributes=[];loadedUniforms=[];loadedTextures=[];constructor(t,e=!1){this.gl=t,this.verbose=e}uploadProgram(t){this.loadedPrograms.includes(t.hash)?this.verbose&&console.log(`Context: did not need to upload program ${t.hash}`):(t.upload(this.gl),this.loadedPrograms.push(t.hash),this.verbose&&console.log(`Context: uploaded program ${t.hash}`))}uploadAttribute(t){this.loadedAttributes.includes(t.hash)?this.verbose&&console.log(`Context: did not need to upload attribute ${t.hash}`):(t.upload(this.gl),this.loadedAttributes.push(t.hash),this.verbose&&console.log(`Context: uploaded attribute ${t.hash}`))}uploadUniform(t){this.loadedUniforms.includes(t.hash)?this.verbose&&console.log(`Context: did not need to upload uniform ${t.hash}`):(t.upload(this.gl),this.loadedUniforms.push(t.hash),this.verbose&&console.log(`Context: uploaded uniform ${t.hash}`))}uploadTexture(t,e=!1){e||!this.loadedTextures.includes(t.hash)?(t.upload(this.gl),this.loadedTextures.push(t.hash),this.verbose&&console.log(`Context: uploaded texture ${t.hash}`)):this.verbose&&console.log(`Context: did not need to upload texture ${t.hash}`)}bindFramebuffer(t){throw new Error("Not yet implemented")}}class p{constructor(t,e,r,a,o="triangles"){this.program=t,this.attributes=e,this.uniforms=r,this.textures=a,this.drawingMode=o,function(t,e,r,a){const[o,n,i,s]=function(t){const e=/^\s*attribute (int|float|vec2|vec3|vec4|mat2|mat3|mat4) (\w*);/gm,r=/^\s*uniform (int|float|vec2|vec3|vec4|mat2|mat3|mat4) (\w*)(\[\d\])*;/gm,a=/^\s*uniform sampler2D (\w*);/gm,o=/^\s*precision (\w*) float;/gm,n=t.fragmentShaderSource+"\n\n\n"+t.vertexShaderSource,i=[];let s;for(;null!==(s=e.exec(n));)i.push(s[2]);const u=[];let h;for(;null!==(h=r.exec(n));)u.push(h[2]);const c=[];let d;for(;null!==(d=a.exec(n));)c.push(d[1]);const f=[];let l;for(;null!==(l=o.exec(n));)f.push(l[1]);return[i,u,c,f]}(t);for(const t of o)if(!e[t])throw new Error(`Provided no values for shader's attribute ${t}.`);for(const t of n)if(!r[t])throw new Error(`Provided no values for shader's uniform ${t}.`);for(const t of i)if(!a[t])throw new Error(`Provided no values for shader's texture ${t}.`);1===s.length&&console.warn("You have only provided one precision qualifier.\n        This can cause issues when you want to use a uniform in both the vertex- and the fragment-shader.")}(t,e,r,a)}upload(t,e=!1){t.uploadProgram(this.program);for(const e in this.attributes){const r=this.attributes[e];t.uploadAttribute(r)}for(const e in this.uniforms){const r=this.uniforms[e];t.uploadUniform(r)}for(const r in this.textures){const a=this.textures[r];t.uploadTexture(a,e)}}initVertexArray(t){this.va={buffers:[],vao:s(t.gl,"OES_vertex_array_object").createVertexArrayOES()},c(t.gl,this.va);for(const e in this.attributes){const r=this.attributes[e],a=this.program.getAttributeLocation(t.gl,e);this.va=r.bind(t.gl,a,this.va)}}bind(t){h(t.gl,this.program.program),c(t.gl,this.va);for(const e in this.uniforms){const r=this.uniforms[e],a=this.program.getUniformLocation(t.gl,e);r.bind(t.gl,a)}let e=1;for(const r in this.textures){e+=1;const a=this.textures[r],o=this.program.getTextureLocation(t.gl,r);a.bind(t.gl,o,e)}}updateAttributeData(t,e,r){const a=this.attributes[e];if(!a)throw new Error(`No such attribute ${e} to be updated.`);a.update(t.gl,r)}updateUniformData(t,e,r){const a=this.uniforms[e];if(!a)throw new Error(`No such uniform ${e} to be updated.`);const o=this.program.getUniformLocation(t.gl,e);a.update(t.gl,r,o)}updateTextureData(t,e,r){const a=this.textures[e];if(!a)throw new Error(`No such texture ${e} to be updated.`);a.update(t.gl,r),this.bind(t)}draw(t,e,r,a){var o,n;r?r.bindToDrawingBuffer(t.gl,a):(n=a,(o=t.gl).bindFramebuffer(o.FRAMEBUFFER,null),n?(o.canvas.width/o.canvas.height!=n[2]/n[3]&&console.warn("Your viewport-aspect is different from the canvas-aspect."),o.viewport(...n)):o.viewport(0,0,o.canvas.width,o.canvas.height)),e&&((t,e)=>{t.clearColor(e[0],e[1],e[2],e[3]),t.clearDepth(1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT)})(t.gl,e)}}class T extends p{constructor(t,e,r,a,o="triangles",n){super(t,e,r,a,o),this.nrAttributes=n}draw(t,e,r,a){super.draw(t,e,r,a),((t,e,r,a=0)=>{let o;switch(e){case"lines":o=t.LINES;break;case"points":o=t.POINTS;break;case"triangles":o=t.TRIANGLES}t.drawArrays(o,a,r)})(t.gl,this.drawingMode,this.nrAttributes,0)}}Array.from(document.querySelectorAll(".pseudo3d")).map((t=>async function(t){const e=t.dataset.imageUrl,r=t.dataset.depthUrl,a=new Image;a.src=e;const n=new Image;n.src=r,await Promise.all([a.decode(),n.decode()]);const i=document.createElement("canvas");i.width=a.width,i.height=a.height,i.style.setProperty("width","100%"),i.style.setProperty("aspect-ratio",`${a.width}/${a.height}`),t.appendChild(i),function(t,e,r){t.width=t.clientWidth,t.height=t.clientHeight;const a=t.getContext("webgl");if(!a)throw new Error("no context");const n={vertices:[[-(u=2)/2,(h=2)/2,0,1],[-u/2,-h/2,0,1],[u/2,-h/2,0,1],[-u/2,h/2,0,1],[u/2,-h/2,0,1],[u/2,h/2,0,1]],texturePositions:[[0,1],[0,0],[1,0],[0,1],[1,0],[1,1]]},i=new v(a,!0),s=new T(new g("\n    precision mediump float;\n    attribute vec4 a_position;\n    attribute vec2 a_uv;\n    varying vec2 v_uv;\n    void main() {\n        gl_Position = a_position;\n        v_uv = vec2(a_uv.x, 1.0 - a_uv.y);\n    }\n","\n    precision mediump float;\n    varying vec2 v_uv;\n    uniform sampler2D u_image;\n    uniform sampler2D u_depth;\n    uniform float u_mousex;\n    uniform float u_mousey;\n\n    void main() {\n        float depth = texture2D(u_depth, v_uv).x;\n        vec2 mouse = vec2(u_mousex - 0.5, u_mousey - 0.5);\n        vec2 queryPoint = v_uv + depth * 0.05 * mouse;\n        gl_FragColor = texture2D(u_image, queryPoint);\n    }\n"),{a_position:new l(new Float32Array(o(n.vertices)),"vec4",!1),a_uv:new l(new Float32Array(o(n.texturePositions)),"vec2",!1)},{u_mousex:new b("float",[.5]),u_mousey:new b("float",[.5])},{u_image:new m(e),u_depth:new m(r)},"triangles",n.vertices.length);var u,h;s.upload(i),s.initVertexArray(i),s.bind(i),s.draw(i,[0,0,0,0]);let c=0,d=0;const f=t.getBoundingClientRect();t.addEventListener("mousemove",(t=>{c=t.offsetX/f.width,d=t.offsetY/f.height,s.updateUniformData(i,"u_mousex",[c]),s.updateUniformData(i,"u_mousey",[d]),s.draw(i,[0,0,0,0])}))}(i,a,n)}(t)))})()})();